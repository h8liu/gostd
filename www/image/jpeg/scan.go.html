<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3150892">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3150947">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3151001">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3151052">package</span>&nbsp;<span class="ident" id="3151060">jpeg</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3151066">import</span>&nbsp;<span class="op" id="3151073">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3151076">&#34;image&#34;</span><br>
<span class="lineno"></span><span class="op" id="3151084">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="3151087">//&nbsp;makeImg&nbsp;allocates&nbsp;and&nbsp;initializes&nbsp;the&nbsp;destination&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="3151147">func</span>&nbsp;<span class="op" id="3151152">(</span><span class="ident" id="3151153">d</span>&nbsp;<span class="op" id="3151155">*</span><span class="ident" id="3151156"><a href="/image/jpeg/reader.go.html#3138497">decoder</a></span><span class="op" id="3151163">)</span>&nbsp;<span class="ident" id="3151165">makeImg</span><span class="op" id="3151172">(</span><span class="ident" id="3151173">h0</span><span class="op" id="3151175">,</span>&nbsp;<span class="ident" id="3151177">v0</span><span class="op" id="3151179">,</span>&nbsp;<span class="ident" id="3151181">mxx</span><span class="op" id="3151184">,</span>&nbsp;<span class="ident" id="3151186">myy</span>&nbsp;<span class="builtintype" id="3151190">int</span><span class="op" id="3151193">)</span>&nbsp;<span class="op" id="3151195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3151198">if</span>&nbsp;<span class="ident" id="3151201"><a href="/image/jpeg/scan.go.html#3151153">d</a></span><span class="op" id="3151202">.</span><span class="ident" id="3151203">nComp</span>&nbsp;<span class="op" id="3151209">==</span>&nbsp;<span class="ident" id="3151212"><a href="/image/jpeg/reader.go.html#3136681">nGrayComponent</a></span>&nbsp;<span class="op" id="3151227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3151231">m</span>&nbsp;<span class="op" id="3151233">:=</span>&nbsp;<span class="ident" id="3151236"><a href="/image/jpeg/scan.go.html#3151076">image</a></span><span class="op" id="3151241">.</span><span class="ident" id="3151242">NewGray</span><span class="op" id="3151249">(</span><span class="ident" id="3151250"><a href="/image/jpeg/scan.go.html#3151076">image</a></span><span class="op" id="3151255">.</span><span class="ident" id="3151256">Rect</span><span class="op" id="3151260">(</span><span class="num" id="3151261">0</span><span class="op" id="3151262">,</span>&nbsp;<span class="num" id="3151264">0</span><span class="op" id="3151265">,</span>&nbsp;<span class="num" id="3151267">8</span><span class="op" id="3151268">*</span><span class="ident" id="3151269"><a href="/image/jpeg/scan.go.html#3151181">mxx</a></span><span class="op" id="3151272">,</span>&nbsp;<span class="num" id="3151274">8</span><span class="op" id="3151275">*</span><span class="ident" id="3151276"><a href="/image/jpeg/scan.go.html#3151186">myy</a></span><span class="op" id="3151279">)</span><span class="op" id="3151280">)</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3151284"><a href="/image/jpeg/scan.go.html#3151153">d</a></span><span class="op" id="3151285">.</span><span class="ident" id="3151286">img1</span>&nbsp;<span class="op" id="3151291">=</span>&nbsp;<span class="ident" id="3151293"><a href="/image/jpeg/scan.go.html#3151231">m</a></span><span class="op" id="3151294">.</span><span class="ident" id="3151295">SubImage</span><span class="op" id="3151303">(</span><span class="ident" id="3151304"><a href="/image/jpeg/scan.go.html#3151076">image</a></span><span class="op" id="3151309">.</span><span class="ident" id="3151310">Rect</span><span class="op" id="3151314">(</span><span class="num" id="3151315">0</span><span class="op" id="3151316">,</span>&nbsp;<span class="num" id="3151318">0</span><span class="op" id="3151319">,</span>&nbsp;<span class="ident" id="3151321"><a href="/image/jpeg/scan.go.html#3151153">d</a></span><span class="op" id="3151322">.</span><span class="ident" id="3151323">width</span><span class="op" id="3151328">,</span>&nbsp;<span class="ident" id="3151330"><a href="/image/jpeg/scan.go.html#3151153">d</a></span><span class="op" id="3151331">.</span><span class="ident" id="3151332">height</span><span class="op" id="3151338">)</span><span class="op" id="3151339">)</span><span class="op" id="3151340">.</span><span class="op" id="3151341">(</span><span class="op" id="3151342">*</span><span class="ident" id="3151343"><a href="/image/jpeg/scan.go.html#3151076">image</a></span><span class="op" id="3151348">.</span><span class="ident" id="3151349">Gray</span><span class="op" id="3151353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3151357">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3151365">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3151368">var</span>&nbsp;<span class="ident" id="3151372">subsampleRatio</span>&nbsp;<span class="ident" id="3151387"><a href="/image/jpeg/scan.go.html#3151076">image</a></span><span class="op" id="3151392">.</span><span class="ident" id="3151393">YCbCrSubsampleRatio</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3151414">switch</span>&nbsp;<span class="op" id="3151421">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3151424">case</span>&nbsp;<span class="ident" id="3151429"><a href="/image/jpeg/scan.go.html#3151173">h0</a></span>&nbsp;<span class="op" id="3151432">==</span>&nbsp;<span class="num" id="3151435">1</span>&nbsp;<span class="op" id="3151437">&amp;&amp;</span>&nbsp;<span class="ident" id="3151440"><a href="/image/jpeg/scan.go.html#3151177">v0</a></span>&nbsp;<span class="op" id="3151443">==</span>&nbsp;<span class="num" id="3151446">1</span><span class="op" id="3151447">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3151451"><a href="/image/jpeg/scan.go.html#3151372">subsampleRatio</a></span>&nbsp;<span class="op" id="3151466">=</span>&nbsp;<span class="ident" id="3151468"><a href="/image/jpeg/scan.go.html#3151076">image</a></span><span class="op" id="3151473">.</span><span class="ident" id="3151474">YCbCrSubsampleRatio444</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3151498">case</span>&nbsp;<span class="ident" id="3151503"><a href="/image/jpeg/scan.go.html#3151173">h0</a></span>&nbsp;<span class="op" id="3151506">==</span>&nbsp;<span class="num" id="3151509">1</span>&nbsp;<span class="op" id="3151511">&amp;&amp;</span>&nbsp;<span class="ident" id="3151514"><a href="/image/jpeg/scan.go.html#3151177">v0</a></span>&nbsp;<span class="op" id="3151517">==</span>&nbsp;<span class="num" id="3151520">2</span><span class="op" id="3151521">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3151525"><a href="/image/jpeg/scan.go.html#3151372">subsampleRatio</a></span>&nbsp;<span class="op" id="3151540">=</span>&nbsp;<span class="ident" id="3151542"><a href="/image/jpeg/scan.go.html#3151076">image</a></span><span class="op" id="3151547">.</span><span class="ident" id="3151548">YCbCrSubsampleRatio440</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3151572">case</span>&nbsp;<span class="ident" id="3151577"><a href="/image/jpeg/scan.go.html#3151173">h0</a></span>&nbsp;<span class="op" id="3151580">==</span>&nbsp;<span class="num" id="3151583">2</span>&nbsp;<span class="op" id="3151585">&amp;&amp;</span>&nbsp;<span class="ident" id="3151588"><a href="/image/jpeg/scan.go.html#3151177">v0</a></span>&nbsp;<span class="op" id="3151591">==</span>&nbsp;<span class="num" id="3151594">1</span><span class="op" id="3151595">:</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3151599"><a href="/image/jpeg/scan.go.html#3151372">subsampleRatio</a></span>&nbsp;<span class="op" id="3151614">=</span>&nbsp;<span class="ident" id="3151616"><a href="/image/jpeg/scan.go.html#3151076">image</a></span><span class="op" id="3151621">.</span><span class="ident" id="3151622">YCbCrSubsampleRatio422</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3151646">case</span>&nbsp;<span class="ident" id="3151651"><a href="/image/jpeg/scan.go.html#3151173">h0</a></span>&nbsp;<span class="op" id="3151654">==</span>&nbsp;<span class="num" id="3151657">2</span>&nbsp;<span class="op" id="3151659">&amp;&amp;</span>&nbsp;<span class="ident" id="3151662"><a href="/image/jpeg/scan.go.html#3151177">v0</a></span>&nbsp;<span class="op" id="3151665">==</span>&nbsp;<span class="num" id="3151668">2</span><span class="op" id="3151669">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3151673"><a href="/image/jpeg/scan.go.html#3151372">subsampleRatio</a></span>&nbsp;<span class="op" id="3151688">=</span>&nbsp;<span class="ident" id="3151690"><a href="/image/jpeg/scan.go.html#3151076">image</a></span><span class="op" id="3151695">.</span><span class="ident" id="3151696">YCbCrSubsampleRatio420</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3151720">default</span><span class="op" id="3151727">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3151731">panic</span><span class="op" id="3151736">(</span><span class="string" id="3151737">&#34;unreachable&#34;</span><span class="op" id="3151750">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3151753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3151756">m</span>&nbsp;<span class="op" id="3151758">:=</span>&nbsp;<span class="ident" id="3151761"><a href="/image/jpeg/scan.go.html#3151076">image</a></span><span class="op" id="3151766">.</span><span class="ident" id="3151767">NewYCbCr</span><span class="op" id="3151775">(</span><span class="ident" id="3151776"><a href="/image/jpeg/scan.go.html#3151076">image</a></span><span class="op" id="3151781">.</span><span class="ident" id="3151782">Rect</span><span class="op" id="3151786">(</span><span class="num" id="3151787">0</span><span class="op" id="3151788">,</span>&nbsp;<span class="num" id="3151790">0</span><span class="op" id="3151791">,</span>&nbsp;<span class="num" id="3151793">8</span><span class="op" id="3151794">*</span><span class="ident" id="3151795"><a href="/image/jpeg/scan.go.html#3151173">h0</a></span><span class="op" id="3151797">*</span><span class="ident" id="3151798"><a href="/image/jpeg/scan.go.html#3151181">mxx</a></span><span class="op" id="3151801">,</span>&nbsp;<span class="num" id="3151803">8</span><span class="op" id="3151804">*</span><span class="ident" id="3151805"><a href="/image/jpeg/scan.go.html#3151177">v0</a></span><span class="op" id="3151807">*</span><span class="ident" id="3151808"><a href="/image/jpeg/scan.go.html#3151186">myy</a></span><span class="op" id="3151811">)</span><span class="op" id="3151812">,</span>&nbsp;<span class="ident" id="3151814"><a href="/image/jpeg/scan.go.html#3151372">subsampleRatio</a></span><span class="op" id="3151828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3151831"><a href="/image/jpeg/scan.go.html#3151153">d</a></span><span class="op" id="3151832">.</span><span class="ident" id="3151833">img3</span>&nbsp;<span class="op" id="3151838">=</span>&nbsp;<span class="ident" id="3151840"><a href="/image/jpeg/scan.go.html#3151756">m</a></span><span class="op" id="3151841">.</span><span class="ident" id="3151842">SubImage</span><span class="op" id="3151850">(</span><span class="ident" id="3151851"><a href="/image/jpeg/scan.go.html#3151076">image</a></span><span class="op" id="3151856">.</span><span class="ident" id="3151857">Rect</span><span class="op" id="3151861">(</span><span class="num" id="3151862">0</span><span class="op" id="3151863">,</span>&nbsp;<span class="num" id="3151865">0</span><span class="op" id="3151866">,</span>&nbsp;<span class="ident" id="3151868"><a href="/image/jpeg/scan.go.html#3151153">d</a></span><span class="op" id="3151869">.</span><span class="ident" id="3151870">width</span><span class="op" id="3151875">,</span>&nbsp;<span class="ident" id="3151877"><a href="/image/jpeg/scan.go.html#3151153">d</a></span><span class="op" id="3151878">.</span><span class="ident" id="3151879">height</span><span class="op" id="3151885">)</span><span class="op" id="3151886">)</span><span class="op" id="3151887">.</span><span class="op" id="3151888">(</span><span class="op" id="3151889">*</span><span class="ident" id="3151890"><a href="/image/jpeg/scan.go.html#3151076">image</a></span><span class="op" id="3151895">.</span><span class="ident" id="3151896">YCbCr</span><span class="op" id="3151901">)</span><br>
<span class="lineno"></span><span class="op" id="3151903">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="3151906">//&nbsp;Specified&nbsp;in&nbsp;section&nbsp;B.2.3.</span><br>
<span class="lineno"></span><span class="keyword" id="3151937">func</span>&nbsp;<span class="op" id="3151942">(</span><span class="ident" id="3151943">d</span>&nbsp;<span class="op" id="3151945">*</span><span class="ident" id="3151946"><a href="/image/jpeg/reader.go.html#3138497">decoder</a></span><span class="op" id="3151953">)</span>&nbsp;<span class="ident" id="3151955">processSOS</span><span class="op" id="3151965">(</span><span class="ident" id="3151966">n</span>&nbsp;<span class="builtintype" id="3151968">int</span><span class="op" id="3151971">)</span>&nbsp;<span class="builtintype" id="3151973">error</span>&nbsp;<span class="op" id="3151979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3151982">if</span>&nbsp;<span class="ident" id="3151985"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3151986">.</span><span class="ident" id="3151987">nComp</span>&nbsp;<span class="op" id="3151993">==</span>&nbsp;<span class="num" id="3151996">0</span>&nbsp;<span class="op" id="3151998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3152002">return</span>&nbsp;<span class="ident" id="3152009"><a href="/image/jpeg/reader.go.html#3135984">FormatError</a></span><span class="op" id="3152020">(</span><span class="string" id="3152021">&#34;missing&nbsp;SOF&nbsp;marker&#34;</span><span class="op" id="3152041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3152044">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3152047">if</span>&nbsp;<span class="ident" id="3152050"><a href="/image/jpeg/scan.go.html#3151966">n</a></span>&nbsp;<span class="op" id="3152052">&lt;</span>&nbsp;<span class="num" id="3152054">6</span>&nbsp;<span class="op" id="3152056">||</span>&nbsp;<span class="num" id="3152059">4</span><span class="op" id="3152060">+</span><span class="num" id="3152061">2</span><span class="op" id="3152062">*</span><span class="ident" id="3152063"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3152064">.</span><span class="ident" id="3152065">nComp</span>&nbsp;<span class="op" id="3152071">&lt;</span>&nbsp;<span class="ident" id="3152073"><a href="/image/jpeg/scan.go.html#3151966">n</a></span>&nbsp;<span class="op" id="3152075">||</span>&nbsp;<span class="ident" id="3152078"><a href="/image/jpeg/scan.go.html#3151966">n</a></span><span class="op" id="3152079">%</span><span class="num" id="3152080">2</span>&nbsp;<span class="op" id="3152082">!=</span>&nbsp;<span class="num" id="3152085">0</span>&nbsp;<span class="op" id="3152087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3152091">return</span>&nbsp;<span class="ident" id="3152098"><a href="/image/jpeg/reader.go.html#3135984">FormatError</a></span><span class="op" id="3152109">(</span><span class="string" id="3152110">&#34;SOS&nbsp;has&nbsp;wrong&nbsp;length&#34;</span><span class="op" id="3152132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3152135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3152138">if</span>&nbsp;<span class="ident" id="3152141">err</span>&nbsp;<span class="op" id="3152145">:=</span>&nbsp;<span class="ident" id="3152148"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3152149">.</span><span class="ident" id="3152150">readFull</span><span class="op" id="3152158">(</span><span class="ident" id="3152159"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3152160">.</span><span class="ident" id="3152161">tmp</span><span class="op" id="3152164">[</span><span class="op" id="3152165">:</span><span class="ident" id="3152166"><a href="/image/jpeg/scan.go.html#3151966">n</a></span><span class="op" id="3152167">]</span><span class="op" id="3152168">)</span><span class="op" id="3152169">;</span>&nbsp;<span class="ident" id="3152171"><a href="/image/jpeg/scan.go.html#3152141">err</a></span>&nbsp;<span class="op" id="3152175">!=</span>&nbsp;<span class="ident" id="3152178">nil</span>&nbsp;<span class="op" id="3152182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3152186">return</span>&nbsp;<span class="ident" id="3152193"><a href="/image/jpeg/scan.go.html#3152141">err</a></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3152198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3152201">nComp</span>&nbsp;<span class="op" id="3152207">:=</span>&nbsp;<span class="builtintype" id="3152210">int</span><span class="op" id="3152213">(</span><span class="ident" id="3152214"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3152215">.</span><span class="ident" id="3152216">tmp</span><span class="op" id="3152219">[</span><span class="num" id="3152220">0</span><span class="op" id="3152221">]</span><span class="op" id="3152222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3152225">if</span>&nbsp;<span class="ident" id="3152228"><a href="/image/jpeg/scan.go.html#3151966">n</a></span>&nbsp;<span class="op" id="3152230">!=</span>&nbsp;<span class="num" id="3152233">4</span><span class="op" id="3152234">+</span><span class="num" id="3152235">2</span><span class="op" id="3152236">*</span><span class="ident" id="3152237"><a href="/image/jpeg/scan.go.html#3152201">nComp</a></span>&nbsp;<span class="op" id="3152243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3152247">return</span>&nbsp;<span class="ident" id="3152254"><a href="/image/jpeg/reader.go.html#3135984">FormatError</a></span><span class="op" id="3152265">(</span><span class="string" id="3152266">&#34;SOS&nbsp;length&nbsp;inconsistent&nbsp;with&nbsp;number&nbsp;of&nbsp;components&#34;</span><span class="op" id="3152317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3152320">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3152323">var</span>&nbsp;<span class="ident" id="3152327">scan</span>&nbsp;<span class="op" id="3152332">[</span><span class="ident" id="3152333"><a href="/image/jpeg/reader.go.html#3136753">nColorComponent</a></span><span class="op" id="3152348">]</span><span class="keyword" id="3152349">struct</span>&nbsp;<span class="op" id="3152356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3152360">compIndex</span>&nbsp;<span class="builtintype" id="3152370">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3152378">td</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3152388">uint8</span>&nbsp;<span class="comment" id="3152394">//&nbsp;DC&nbsp;table&nbsp;selector.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3152418">ta</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3152428">uint8</span>&nbsp;<span class="comment" id="3152434">//&nbsp;AC&nbsp;table&nbsp;selector.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3152457">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3152460">for</span>&nbsp;<span class="ident" id="3152464">i</span>&nbsp;<span class="op" id="3152466">:=</span>&nbsp;<span class="num" id="3152469">0</span><span class="op" id="3152470">;</span>&nbsp;<span class="ident" id="3152472"><a href="/image/jpeg/scan.go.html#3152464">i</a></span>&nbsp;<span class="op" id="3152474">&lt;</span>&nbsp;<span class="ident" id="3152476"><a href="/image/jpeg/scan.go.html#3152201">nComp</a></span><span class="op" id="3152481">;</span>&nbsp;<span class="ident" id="3152483"><a href="/image/jpeg/scan.go.html#3152464">i</a></span><span class="op" id="3152484">++</span>&nbsp;<span class="op" id="3152487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3152491">cs</span>&nbsp;<span class="op" id="3152494">:=</span>&nbsp;<span class="ident" id="3152497"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3152498">.</span><span class="ident" id="3152499">tmp</span><span class="op" id="3152502">[</span><span class="num" id="3152503">1</span><span class="op" id="3152504">+</span><span class="num" id="3152505">2</span><span class="op" id="3152506">*</span><span class="ident" id="3152507"><a href="/image/jpeg/scan.go.html#3152464">i</a></span><span class="op" id="3152508">]</span>&nbsp;<span class="comment" id="3152510">//&nbsp;Component&nbsp;selector.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3152535">compIndex</span>&nbsp;<span class="op" id="3152545">:=</span>&nbsp;<span class="op" id="3152548">-</span><span class="num" id="3152549">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3152553">for</span>&nbsp;<span class="ident" id="3152557">j</span><span class="op" id="3152558">,</span>&nbsp;<span class="ident" id="3152560">comp</span>&nbsp;<span class="op" id="3152565">:=</span>&nbsp;<span class="keyword" id="3152568">range</span>&nbsp;<span class="ident" id="3152574"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3152575">.</span><span class="ident" id="3152576">comp</span>&nbsp;<span class="op" id="3152581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3152586">if</span>&nbsp;<span class="ident" id="3152589"><a href="/image/jpeg/scan.go.html#3152491">cs</a></span>&nbsp;<span class="op" id="3152592">==</span>&nbsp;<span class="ident" id="3152595"><a href="/image/jpeg/scan.go.html#3152560">comp</a></span><span class="op" id="3152599">.</span><span class="ident" id="3152600">c</span>&nbsp;<span class="op" id="3152602">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3152608"><a href="/image/jpeg/scan.go.html#3152535">compIndex</a></span>&nbsp;<span class="op" id="3152618">=</span>&nbsp;<span class="ident" id="3152620"><a href="/image/jpeg/scan.go.html#3152557">j</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3152625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3152629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3152633">if</span>&nbsp;<span class="ident" id="3152636"><a href="/image/jpeg/scan.go.html#3152535">compIndex</a></span>&nbsp;<span class="op" id="3152646">&lt;</span>&nbsp;<span class="num" id="3152648">0</span>&nbsp;<span class="op" id="3152650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3152655">return</span>&nbsp;<span class="ident" id="3152662"><a href="/image/jpeg/reader.go.html#3135984">FormatError</a></span><span class="op" id="3152673">(</span><span class="string" id="3152674">&#34;unknown&nbsp;component&nbsp;selector&#34;</span><span class="op" id="3152702">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3152706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3152710"><a href="/image/jpeg/scan.go.html#3152327">scan</a></span><span class="op" id="3152714">[</span><span class="ident" id="3152715"><a href="/image/jpeg/scan.go.html#3152464">i</a></span><span class="op" id="3152716">]</span><span class="op" id="3152717">.</span><span class="ident" id="3152718">compIndex</span>&nbsp;<span class="op" id="3152728">=</span>&nbsp;<span class="builtintype" id="3152730">uint8</span><span class="op" id="3152735">(</span><span class="ident" id="3152736"><a href="/image/jpeg/scan.go.html#3152535">compIndex</a></span><span class="op" id="3152745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3152749"><a href="/image/jpeg/scan.go.html#3152327">scan</a></span><span class="op" id="3152753">[</span><span class="ident" id="3152754"><a href="/image/jpeg/scan.go.html#3152464">i</a></span><span class="op" id="3152755">]</span><span class="op" id="3152756">.</span><span class="ident" id="3152757">td</span>&nbsp;<span class="op" id="3152760">=</span>&nbsp;<span class="ident" id="3152762"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3152763">.</span><span class="ident" id="3152764">tmp</span><span class="op" id="3152767">[</span><span class="num" id="3152768">2</span><span class="op" id="3152769">+</span><span class="num" id="3152770">2</span><span class="op" id="3152771">*</span><span class="ident" id="3152772"><a href="/image/jpeg/scan.go.html#3152464">i</a></span><span class="op" id="3152773">]</span>&nbsp;<span class="op" id="3152775">&gt;&gt;</span>&nbsp;<span class="num" id="3152778">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3152782">if</span>&nbsp;<span class="ident" id="3152785"><a href="/image/jpeg/scan.go.html#3152327">scan</a></span><span class="op" id="3152789">[</span><span class="ident" id="3152790"><a href="/image/jpeg/scan.go.html#3152464">i</a></span><span class="op" id="3152791">]</span><span class="op" id="3152792">.</span><span class="ident" id="3152793">td</span>&nbsp;<span class="op" id="3152796">&gt;</span>&nbsp;<span class="ident" id="3152798"><a href="/image/jpeg/reader.go.html#3136603">maxTh</a></span>&nbsp;<span class="op" id="3152804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3152809">return</span>&nbsp;<span class="ident" id="3152816"><a href="/image/jpeg/reader.go.html#3135984">FormatError</a></span><span class="op" id="3152827">(</span><span class="string" id="3152828">&#34;bad&nbsp;Td&nbsp;value&#34;</span><span class="op" id="3152842">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3152846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3152850"><a href="/image/jpeg/scan.go.html#3152327">scan</a></span><span class="op" id="3152854">[</span><span class="ident" id="3152855"><a href="/image/jpeg/scan.go.html#3152464">i</a></span><span class="op" id="3152856">]</span><span class="op" id="3152857">.</span><span class="ident" id="3152858">ta</span>&nbsp;<span class="op" id="3152861">=</span>&nbsp;<span class="ident" id="3152863"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3152864">.</span><span class="ident" id="3152865">tmp</span><span class="op" id="3152868">[</span><span class="num" id="3152869">2</span><span class="op" id="3152870">+</span><span class="num" id="3152871">2</span><span class="op" id="3152872">*</span><span class="ident" id="3152873"><a href="/image/jpeg/scan.go.html#3152464">i</a></span><span class="op" id="3152874">]</span>&nbsp;<span class="op" id="3152876">&amp;</span>&nbsp;<span class="num" id="3152878">0x0f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3152885">if</span>&nbsp;<span class="ident" id="3152888"><a href="/image/jpeg/scan.go.html#3152327">scan</a></span><span class="op" id="3152892">[</span><span class="ident" id="3152893"><a href="/image/jpeg/scan.go.html#3152464">i</a></span><span class="op" id="3152894">]</span><span class="op" id="3152895">.</span><span class="ident" id="3152896">ta</span>&nbsp;<span class="op" id="3152899">&gt;</span>&nbsp;<span class="ident" id="3152901"><a href="/image/jpeg/reader.go.html#3136603">maxTh</a></span>&nbsp;<span class="op" id="3152907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3152912">return</span>&nbsp;<span class="ident" id="3152919"><a href="/image/jpeg/reader.go.html#3135984">FormatError</a></span><span class="op" id="3152930">(</span><span class="string" id="3152931">&#34;bad&nbsp;Ta&nbsp;value&#34;</span><span class="op" id="3152945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3152949">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3152952">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3152956">//&nbsp;zigStart&nbsp;and&nbsp;zigEnd&nbsp;are&nbsp;the&nbsp;spectral&nbsp;selection&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3153015">//&nbsp;ah&nbsp;and&nbsp;al&nbsp;are&nbsp;the&nbsp;successive&nbsp;approximation&nbsp;high&nbsp;and&nbsp;low&nbsp;values.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3153083">//&nbsp;The&nbsp;spec&nbsp;calls&nbsp;these&nbsp;values&nbsp;Ss,&nbsp;Se,&nbsp;Ah&nbsp;and&nbsp;Al.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3153134">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3153138">//&nbsp;For&nbsp;progressive&nbsp;JPEGs,&nbsp;these&nbsp;are&nbsp;the&nbsp;two&nbsp;more-or-less&nbsp;independent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3153208">//&nbsp;aspects&nbsp;of&nbsp;progression.&nbsp;Spectral&nbsp;selection&nbsp;progression&nbsp;is&nbsp;when&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3153279">//&nbsp;all&nbsp;of&nbsp;a&nbsp;block&#39;s&nbsp;64&nbsp;DCT&nbsp;coefficients&nbsp;are&nbsp;transmitted&nbsp;in&nbsp;one&nbsp;pass.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3153349">//&nbsp;For&nbsp;example,&nbsp;three&nbsp;passes&nbsp;could&nbsp;transmit&nbsp;coefficient&nbsp;0&nbsp;(the&nbsp;DC</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3153416">//&nbsp;component),&nbsp;coefficients&nbsp;1-5,&nbsp;and&nbsp;coefficients&nbsp;6-63,&nbsp;in&nbsp;zig-zag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3153484">//&nbsp;order.&nbsp;Successive&nbsp;approximation&nbsp;is&nbsp;when&nbsp;not&nbsp;all&nbsp;of&nbsp;the&nbsp;bits&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3153553">//&nbsp;band&nbsp;of&nbsp;coefficients&nbsp;are&nbsp;transmitted&nbsp;in&nbsp;one&nbsp;pass.&nbsp;For&nbsp;example,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3153620">//&nbsp;three&nbsp;passes&nbsp;could&nbsp;transmit&nbsp;the&nbsp;6&nbsp;most&nbsp;significant&nbsp;bits,&nbsp;followed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3153690">//&nbsp;by&nbsp;the&nbsp;second-least&nbsp;significant&nbsp;bit,&nbsp;followed&nbsp;by&nbsp;the&nbsp;least</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3153753">//&nbsp;significant&nbsp;bit.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3153774">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3153778">//&nbsp;For&nbsp;baseline&nbsp;JPEGs,&nbsp;these&nbsp;parameters&nbsp;are&nbsp;hard-coded&nbsp;to&nbsp;0/63/0/0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3153847">zigStart</span><span class="op" id="3153855">,</span>&nbsp;<span class="ident" id="3153857">zigEnd</span><span class="op" id="3153863">,</span>&nbsp;<span class="ident" id="3153865">ah</span><span class="op" id="3153867">,</span>&nbsp;<span class="ident" id="3153869">al</span>&nbsp;<span class="op" id="3153872">:=</span>&nbsp;<span class="builtintype" id="3153875">int32</span><span class="op" id="3153880">(</span><span class="num" id="3153881">0</span><span class="op" id="3153882">)</span><span class="op" id="3153883">,</span>&nbsp;<span class="builtintype" id="3153885">int32</span><span class="op" id="3153890">(</span><span class="ident" id="3153891"><a href="/image/jpeg/idct.go.html#3131898">blockSize</a></span><span class="op" id="3153900">-</span><span class="num" id="3153901">1</span><span class="op" id="3153902">)</span><span class="op" id="3153903">,</span>&nbsp;<span class="builtintype" id="3153905">uint32</span><span class="op" id="3153911">(</span><span class="num" id="3153912">0</span><span class="op" id="3153913">)</span><span class="op" id="3153914">,</span>&nbsp;<span class="builtintype" id="3153916">uint32</span><span class="op" id="3153922">(</span><span class="num" id="3153923">0</span><span class="op" id="3153924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3153927">if</span>&nbsp;<span class="ident" id="3153930"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3153931">.</span><span class="ident" id="3153932">progressive</span>&nbsp;<span class="op" id="3153944">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3153948"><a href="/image/jpeg/scan.go.html#3153847">zigStart</a></span>&nbsp;<span class="op" id="3153957">=</span>&nbsp;<span class="builtintype" id="3153959">int32</span><span class="op" id="3153964">(</span><span class="ident" id="3153965"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3153966">.</span><span class="ident" id="3153967">tmp</span><span class="op" id="3153970">[</span><span class="num" id="3153971">1</span><span class="op" id="3153972">+</span><span class="num" id="3153973">2</span><span class="op" id="3153974">*</span><span class="ident" id="3153975"><a href="/image/jpeg/scan.go.html#3152201">nComp</a></span><span class="op" id="3153980">]</span><span class="op" id="3153981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3153985"><a href="/image/jpeg/scan.go.html#3153857">zigEnd</a></span>&nbsp;<span class="op" id="3153992">=</span>&nbsp;<span class="builtintype" id="3153994">int32</span><span class="op" id="3153999">(</span><span class="ident" id="3154000"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3154001">.</span><span class="ident" id="3154002">tmp</span><span class="op" id="3154005">[</span><span class="num" id="3154006">2</span><span class="op" id="3154007">+</span><span class="num" id="3154008">2</span><span class="op" id="3154009">*</span><span class="ident" id="3154010"><a href="/image/jpeg/scan.go.html#3152201">nComp</a></span><span class="op" id="3154015">]</span><span class="op" id="3154016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3154020"><a href="/image/jpeg/scan.go.html#3153865">ah</a></span>&nbsp;<span class="op" id="3154023">=</span>&nbsp;<span class="builtintype" id="3154025">uint32</span><span class="op" id="3154031">(</span><span class="ident" id="3154032"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3154033">.</span><span class="ident" id="3154034">tmp</span><span class="op" id="3154037">[</span><span class="num" id="3154038">3</span><span class="op" id="3154039">+</span><span class="num" id="3154040">2</span><span class="op" id="3154041">*</span><span class="ident" id="3154042"><a href="/image/jpeg/scan.go.html#3152201">nComp</a></span><span class="op" id="3154047">]</span>&nbsp;<span class="op" id="3154049">&gt;&gt;</span>&nbsp;<span class="num" id="3154052">4</span><span class="op" id="3154053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3154057"><a href="/image/jpeg/scan.go.html#3153869">al</a></span>&nbsp;<span class="op" id="3154060">=</span>&nbsp;<span class="builtintype" id="3154062">uint32</span><span class="op" id="3154068">(</span><span class="ident" id="3154069"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3154070">.</span><span class="ident" id="3154071">tmp</span><span class="op" id="3154074">[</span><span class="num" id="3154075">3</span><span class="op" id="3154076">+</span><span class="num" id="3154077">2</span><span class="op" id="3154078">*</span><span class="ident" id="3154079"><a href="/image/jpeg/scan.go.html#3152201">nComp</a></span><span class="op" id="3154084">]</span>&nbsp;<span class="op" id="3154086">&amp;</span>&nbsp;<span class="num" id="3154088">0x0f</span><span class="op" id="3154092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3154096">if</span>&nbsp;<span class="op" id="3154099">(</span><span class="ident" id="3154100"><a href="/image/jpeg/scan.go.html#3153847">zigStart</a></span>&nbsp;<span class="op" id="3154109">==</span>&nbsp;<span class="num" id="3154112">0</span>&nbsp;<span class="op" id="3154114">&amp;&amp;</span>&nbsp;<span class="ident" id="3154117"><a href="/image/jpeg/scan.go.html#3153857">zigEnd</a></span>&nbsp;<span class="op" id="3154124">!=</span>&nbsp;<span class="num" id="3154127">0</span><span class="op" id="3154128">)</span>&nbsp;<span class="op" id="3154130">||</span>&nbsp;<span class="ident" id="3154133"><a href="/image/jpeg/scan.go.html#3153847">zigStart</a></span>&nbsp;<span class="op" id="3154142">&gt;</span>&nbsp;<span class="ident" id="3154144"><a href="/image/jpeg/scan.go.html#3153857">zigEnd</a></span>&nbsp;<span class="op" id="3154151">||</span>&nbsp;<span class="ident" id="3154154"><a href="/image/jpeg/idct.go.html#3131898">blockSize</a></span>&nbsp;<span class="op" id="3154164">&lt;=</span>&nbsp;<span class="ident" id="3154167"><a href="/image/jpeg/scan.go.html#3153857">zigEnd</a></span>&nbsp;<span class="op" id="3154174">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3154179">return</span>&nbsp;<span class="ident" id="3154186"><a href="/image/jpeg/reader.go.html#3135984">FormatError</a></span><span class="op" id="3154197">(</span><span class="string" id="3154198">&#34;bad&nbsp;spectral&nbsp;selection&nbsp;bounds&#34;</span><span class="op" id="3154229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3154233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3154237">if</span>&nbsp;<span class="ident" id="3154240"><a href="/image/jpeg/scan.go.html#3153847">zigStart</a></span>&nbsp;<span class="op" id="3154249">!=</span>&nbsp;<span class="num" id="3154252">0</span>&nbsp;<span class="op" id="3154254">&amp;&amp;</span>&nbsp;<span class="ident" id="3154257"><a href="/image/jpeg/scan.go.html#3152201">nComp</a></span>&nbsp;<span class="op" id="3154263">!=</span>&nbsp;<span class="num" id="3154266">1</span>&nbsp;<span class="op" id="3154268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3154273">return</span>&nbsp;<span class="ident" id="3154280"><a href="/image/jpeg/reader.go.html#3135984">FormatError</a></span><span class="op" id="3154291">(</span><span class="string" id="3154292">&#34;progressive&nbsp;AC&nbsp;coefficients&nbsp;for&nbsp;more&nbsp;than&nbsp;one&nbsp;component&#34;</span><span class="op" id="3154349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3154353">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3154357">if</span>&nbsp;<span class="ident" id="3154360"><a href="/image/jpeg/scan.go.html#3153865">ah</a></span>&nbsp;<span class="op" id="3154363">!=</span>&nbsp;<span class="num" id="3154366">0</span>&nbsp;<span class="op" id="3154368">&amp;&amp;</span>&nbsp;<span class="ident" id="3154371"><a href="/image/jpeg/scan.go.html#3153865">ah</a></span>&nbsp;<span class="op" id="3154374">!=</span>&nbsp;<span class="ident" id="3154377"><a href="/image/jpeg/scan.go.html#3153869">al</a></span><span class="op" id="3154379">+</span><span class="num" id="3154380">1</span>&nbsp;<span class="op" id="3154382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3154387">return</span>&nbsp;<span class="ident" id="3154394"><a href="/image/jpeg/reader.go.html#3135984">FormatError</a></span><span class="op" id="3154405">(</span><span class="string" id="3154406">&#34;bad&nbsp;successive&nbsp;approximation&nbsp;values&#34;</span><span class="op" id="3154443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3154447">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3154450">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3154454">//&nbsp;mxx&nbsp;and&nbsp;myy&nbsp;are&nbsp;the&nbsp;number&nbsp;of&nbsp;MCUs&nbsp;(Minimum&nbsp;Coded&nbsp;Units)&nbsp;in&nbsp;the&nbsp;image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3154529">h0</span><span class="op" id="3154531">,</span>&nbsp;<span class="ident" id="3154533">v0</span>&nbsp;<span class="op" id="3154536">:=</span>&nbsp;<span class="ident" id="3154539"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3154540">.</span><span class="ident" id="3154541">comp</span><span class="op" id="3154545">[</span><span class="num" id="3154546">0</span><span class="op" id="3154547">]</span><span class="op" id="3154548">.</span><span class="ident" id="3154549">h</span><span class="op" id="3154550">,</span>&nbsp;<span class="ident" id="3154552"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3154553">.</span><span class="ident" id="3154554">comp</span><span class="op" id="3154558">[</span><span class="num" id="3154559">0</span><span class="op" id="3154560">]</span><span class="op" id="3154561">.</span><span class="ident" id="3154562">v</span>&nbsp;<span class="comment" id="3154564">//&nbsp;The&nbsp;h&nbsp;and&nbsp;v&nbsp;values&nbsp;from&nbsp;the&nbsp;Y&nbsp;components.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3154610">mxx</span>&nbsp;<span class="op" id="3154614">:=</span>&nbsp;<span class="op" id="3154617">(</span><span class="ident" id="3154618"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3154619">.</span><span class="ident" id="3154620">width</span>&nbsp;<span class="op" id="3154626">+</span>&nbsp;<span class="num" id="3154628">8</span><span class="op" id="3154629">*</span><span class="ident" id="3154630"><a href="/image/jpeg/scan.go.html#3154529">h0</a></span>&nbsp;<span class="op" id="3154633">-</span>&nbsp;<span class="num" id="3154635">1</span><span class="op" id="3154636">)</span>&nbsp;<span class="op" id="3154638">/</span>&nbsp;<span class="op" id="3154640">(</span><span class="num" id="3154641">8</span>&nbsp;<span class="op" id="3154643">*</span>&nbsp;<span class="ident" id="3154645"><a href="/image/jpeg/scan.go.html#3154529">h0</a></span><span class="op" id="3154647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3154650">myy</span>&nbsp;<span class="op" id="3154654">:=</span>&nbsp;<span class="op" id="3154657">(</span><span class="ident" id="3154658"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3154659">.</span><span class="ident" id="3154660">height</span>&nbsp;<span class="op" id="3154667">+</span>&nbsp;<span class="num" id="3154669">8</span><span class="op" id="3154670">*</span><span class="ident" id="3154671"><a href="/image/jpeg/scan.go.html#3154533">v0</a></span>&nbsp;<span class="op" id="3154674">-</span>&nbsp;<span class="num" id="3154676">1</span><span class="op" id="3154677">)</span>&nbsp;<span class="op" id="3154679">/</span>&nbsp;<span class="op" id="3154681">(</span><span class="num" id="3154682">8</span>&nbsp;<span class="op" id="3154684">*</span>&nbsp;<span class="ident" id="3154686"><a href="/image/jpeg/scan.go.html#3154533">v0</a></span><span class="op" id="3154688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3154691">if</span>&nbsp;<span class="ident" id="3154694"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3154695">.</span><span class="ident" id="3154696">img1</span>&nbsp;<span class="op" id="3154701">==</span>&nbsp;<span class="ident" id="3154704">nil</span>&nbsp;<span class="op" id="3154708">&amp;&amp;</span>&nbsp;<span class="ident" id="3154711"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3154712">.</span><span class="ident" id="3154713">img3</span>&nbsp;<span class="op" id="3154718">==</span>&nbsp;<span class="ident" id="3154721">nil</span>&nbsp;<span class="op" id="3154725">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3154729"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3154730">.</span><span class="ident" id="3154731">makeImg</span><span class="op" id="3154738">(</span><span class="ident" id="3154739"><a href="/image/jpeg/scan.go.html#3154529">h0</a></span><span class="op" id="3154741">,</span>&nbsp;<span class="ident" id="3154743"><a href="/image/jpeg/scan.go.html#3154533">v0</a></span><span class="op" id="3154745">,</span>&nbsp;<span class="ident" id="3154747"><a href="/image/jpeg/scan.go.html#3154610">mxx</a></span><span class="op" id="3154750">,</span>&nbsp;<span class="ident" id="3154752"><a href="/image/jpeg/scan.go.html#3154650">myy</a></span><span class="op" id="3154755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3154758">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3154761">if</span>&nbsp;<span class="ident" id="3154764"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3154765">.</span><span class="ident" id="3154766">progressive</span>&nbsp;<span class="op" id="3154778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3154782">for</span>&nbsp;<span class="ident" id="3154786">i</span>&nbsp;<span class="op" id="3154788">:=</span>&nbsp;<span class="num" id="3154791">0</span><span class="op" id="3154792">;</span>&nbsp;<span class="ident" id="3154794"><a href="/image/jpeg/scan.go.html#3154786">i</a></span>&nbsp;<span class="op" id="3154796">&lt;</span>&nbsp;<span class="ident" id="3154798"><a href="/image/jpeg/scan.go.html#3152201">nComp</a></span><span class="op" id="3154803">;</span>&nbsp;<span class="ident" id="3154805"><a href="/image/jpeg/scan.go.html#3154786">i</a></span><span class="op" id="3154806">++</span>&nbsp;<span class="op" id="3154809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3154814">compIndex</span>&nbsp;<span class="op" id="3154824">:=</span>&nbsp;<span class="ident" id="3154827"><a href="/image/jpeg/scan.go.html#3152327">scan</a></span><span class="op" id="3154831">[</span><span class="ident" id="3154832"><a href="/image/jpeg/scan.go.html#3154786">i</a></span><span class="op" id="3154833">]</span><span class="op" id="3154834">.</span><span class="ident" id="3154835">compIndex</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3154848">if</span>&nbsp;<span class="ident" id="3154851"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3154852">.</span><span class="ident" id="3154853">progCoeffs</span><span class="op" id="3154863">[</span><span class="ident" id="3154864"><a href="/image/jpeg/scan.go.html#3154814">compIndex</a></span><span class="op" id="3154873">]</span>&nbsp;<span class="op" id="3154875">==</span>&nbsp;<span class="ident" id="3154878">nil</span>&nbsp;<span class="op" id="3154882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3154888"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3154889">.</span><span class="ident" id="3154890">progCoeffs</span><span class="op" id="3154900">[</span><span class="ident" id="3154901"><a href="/image/jpeg/scan.go.html#3154814">compIndex</a></span><span class="op" id="3154910">]</span>&nbsp;<span class="op" id="3154912">=</span>&nbsp;<span class="builtinfunc" id="3154914">make</span><span class="op" id="3154918">(</span><span class="op" id="3154919">[</span><span class="op" id="3154920">]</span><span class="ident" id="3154921"><a href="/image/jpeg/idct.go.html#3131942">block</a></span><span class="op" id="3154926">,</span>&nbsp;<span class="ident" id="3154928"><a href="/image/jpeg/scan.go.html#3154610">mxx</a></span><span class="op" id="3154931">*</span><span class="ident" id="3154932"><a href="/image/jpeg/scan.go.html#3154650">myy</a></span><span class="op" id="3154935">*</span><span class="ident" id="3154936"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3154937">.</span><span class="ident" id="3154938">comp</span><span class="op" id="3154942">[</span><span class="ident" id="3154943"><a href="/image/jpeg/scan.go.html#3154814">compIndex</a></span><span class="op" id="3154952">]</span><span class="op" id="3154953">.</span><span class="ident" id="3154954">h</span><span class="op" id="3154955">*</span><span class="ident" id="3154956"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3154957">.</span><span class="ident" id="3154958">comp</span><span class="op" id="3154962">[</span><span class="ident" id="3154963"><a href="/image/jpeg/scan.go.html#3154814">compIndex</a></span><span class="op" id="3154972">]</span><span class="op" id="3154973">.</span><span class="ident" id="3154974">v</span><span class="op" id="3154975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3154980">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3154984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3154987">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3154991"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3154992">.</span><span class="ident" id="3154993">bits</span>&nbsp;<span class="op" id="3154998">=</span>&nbsp;<span class="ident" id="3155000"><a href="/image/jpeg/reader.go.html#3138342">bits</a></span><span class="op" id="3155004">{</span><span class="op" id="3155005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3155008">mcu</span><span class="op" id="3155011">,</span>&nbsp;<span class="ident" id="3155013">expectedRST</span>&nbsp;<span class="op" id="3155025">:=</span>&nbsp;<span class="num" id="3155028">0</span><span class="op" id="3155029">,</span>&nbsp;<span class="builtintype" id="3155031">uint8</span><span class="op" id="3155036">(</span><span class="ident" id="3155037"><a href="/image/jpeg/reader.go.html#3137361">rst0Marker</a></span><span class="op" id="3155047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3155050">var</span>&nbsp;<span class="op" id="3155054">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3155058">//&nbsp;b&nbsp;is&nbsp;the&nbsp;decoded&nbsp;coefficients,&nbsp;in&nbsp;natural&nbsp;(not&nbsp;zig-zag)&nbsp;order.</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3155126">b</span>&nbsp;&nbsp;<span class="ident" id="3155129"><a href="/image/jpeg/idct.go.html#3131942">block</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3155137">dc</span>&nbsp;<span class="op" id="3155140">[</span><span class="ident" id="3155141"><a href="/image/jpeg/reader.go.html#3136753">nColorComponent</a></span><span class="op" id="3155156">]</span><span class="builtintype" id="3155157">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3155165">//&nbsp;bx&nbsp;and&nbsp;by&nbsp;are&nbsp;the&nbsp;location&nbsp;of&nbsp;the&nbsp;current&nbsp;(in&nbsp;terms&nbsp;of&nbsp;8x8&nbsp;blocks).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3155238">//&nbsp;For&nbsp;example,&nbsp;with&nbsp;4:2:0&nbsp;chroma&nbsp;subsampling,&nbsp;the&nbsp;block&nbsp;whose&nbsp;top&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3155312">//&nbsp;pixel&nbsp;co-ordinates&nbsp;are&nbsp;(16,&nbsp;8)&nbsp;is&nbsp;the&nbsp;third&nbsp;block&nbsp;in&nbsp;the&nbsp;first&nbsp;row:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3155385">//&nbsp;bx&nbsp;is&nbsp;2&nbsp;and&nbsp;by&nbsp;is&nbsp;0,&nbsp;even&nbsp;though&nbsp;the&nbsp;pixel&nbsp;is&nbsp;in&nbsp;the&nbsp;second&nbsp;MCU.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3155455">bx</span><span class="op" id="3155457">,</span>&nbsp;<span class="ident" id="3155459">by</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3155466">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3155472">blockCount</span>&nbsp;<span class="builtintype" id="3155483">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3155488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3155491">for</span>&nbsp;<span class="ident" id="3155495">my</span>&nbsp;<span class="op" id="3155498">:=</span>&nbsp;<span class="num" id="3155501">0</span><span class="op" id="3155502">;</span>&nbsp;<span class="ident" id="3155504"><a href="/image/jpeg/scan.go.html#3155495">my</a></span>&nbsp;<span class="op" id="3155507">&lt;</span>&nbsp;<span class="ident" id="3155509"><a href="/image/jpeg/scan.go.html#3154650">myy</a></span><span class="op" id="3155512">;</span>&nbsp;<span class="ident" id="3155514"><a href="/image/jpeg/scan.go.html#3155495">my</a></span><span class="op" id="3155516">++</span>&nbsp;<span class="op" id="3155519">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3155523">for</span>&nbsp;<span class="ident" id="3155527">mx</span>&nbsp;<span class="op" id="3155530">:=</span>&nbsp;<span class="num" id="3155533">0</span><span class="op" id="3155534">;</span>&nbsp;<span class="ident" id="3155536"><a href="/image/jpeg/scan.go.html#3155527">mx</a></span>&nbsp;<span class="op" id="3155539">&lt;</span>&nbsp;<span class="ident" id="3155541"><a href="/image/jpeg/scan.go.html#3154610">mxx</a></span><span class="op" id="3155544">;</span>&nbsp;<span class="ident" id="3155546"><a href="/image/jpeg/scan.go.html#3155527">mx</a></span><span class="op" id="3155548">++</span>&nbsp;<span class="op" id="3155551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3155556">for</span>&nbsp;<span class="ident" id="3155560">i</span>&nbsp;<span class="op" id="3155562">:=</span>&nbsp;<span class="num" id="3155565">0</span><span class="op" id="3155566">;</span>&nbsp;<span class="ident" id="3155568"><a href="/image/jpeg/scan.go.html#3155560">i</a></span>&nbsp;<span class="op" id="3155570">&lt;</span>&nbsp;<span class="ident" id="3155572"><a href="/image/jpeg/scan.go.html#3152201">nComp</a></span><span class="op" id="3155577">;</span>&nbsp;<span class="ident" id="3155579"><a href="/image/jpeg/scan.go.html#3155560">i</a></span><span class="op" id="3155580">++</span>&nbsp;<span class="op" id="3155583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3155589">compIndex</span>&nbsp;<span class="op" id="3155599">:=</span>&nbsp;<span class="ident" id="3155602"><a href="/image/jpeg/scan.go.html#3152327">scan</a></span><span class="op" id="3155606">[</span><span class="ident" id="3155607"><a href="/image/jpeg/scan.go.html#3155560">i</a></span><span class="op" id="3155608">]</span><span class="op" id="3155609">.</span><span class="ident" id="3155610">compIndex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3155624">qt</span>&nbsp;<span class="op" id="3155627">:=</span>&nbsp;<span class="op" id="3155630">&amp;</span><span class="ident" id="3155631"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3155632">.</span><span class="ident" id="3155633">quant</span><span class="op" id="3155638">[</span><span class="ident" id="3155639"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3155640">.</span><span class="ident" id="3155641">comp</span><span class="op" id="3155645">[</span><span class="ident" id="3155646"><a href="/image/jpeg/scan.go.html#3155589">compIndex</a></span><span class="op" id="3155655">]</span><span class="op" id="3155656">.</span><span class="ident" id="3155657">tq</span><span class="op" id="3155659">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3155665">for</span>&nbsp;<span class="ident" id="3155669">j</span>&nbsp;<span class="op" id="3155671">:=</span>&nbsp;<span class="num" id="3155674">0</span><span class="op" id="3155675">;</span>&nbsp;<span class="ident" id="3155677"><a href="/image/jpeg/scan.go.html#3155669">j</a></span>&nbsp;<span class="op" id="3155679">&lt;</span>&nbsp;<span class="ident" id="3155681"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3155682">.</span><span class="ident" id="3155683">comp</span><span class="op" id="3155687">[</span><span class="ident" id="3155688"><a href="/image/jpeg/scan.go.html#3155589">compIndex</a></span><span class="op" id="3155697">]</span><span class="op" id="3155698">.</span><span class="ident" id="3155699">h</span><span class="op" id="3155700">*</span><span class="ident" id="3155701"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3155702">.</span><span class="ident" id="3155703">comp</span><span class="op" id="3155707">[</span><span class="ident" id="3155708"><a href="/image/jpeg/scan.go.html#3155589">compIndex</a></span><span class="op" id="3155717">]</span><span class="op" id="3155718">.</span><span class="ident" id="3155719">v</span><span class="op" id="3155720">;</span>&nbsp;<span class="ident" id="3155722"><a href="/image/jpeg/scan.go.html#3155669">j</a></span><span class="op" id="3155723">++</span>&nbsp;<span class="op" id="3155726">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3155733">//&nbsp;The&nbsp;blocks&nbsp;are&nbsp;traversed&nbsp;one&nbsp;MCU&nbsp;at&nbsp;a&nbsp;time.&nbsp;For&nbsp;4:2:0&nbsp;chroma</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3155802">//&nbsp;subsampling,&nbsp;there&nbsp;are&nbsp;four&nbsp;Y&nbsp;8x8&nbsp;blocks&nbsp;in&nbsp;every&nbsp;16x16&nbsp;MCU.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3155871">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3155879">//&nbsp;For&nbsp;a&nbsp;baseline&nbsp;32x16&nbsp;pixel&nbsp;image,&nbsp;the&nbsp;Y&nbsp;blocks&nbsp;visiting&nbsp;order&nbsp;is:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3155953">//&nbsp;&nbsp;&nbsp;&nbsp0&nbsp;1&nbsp;4&nbsp;5</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3155969">//&nbsp;&nbsp;&nbsp;&nbsp2&nbsp;3&nbsp;6&nbsp;7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3155985">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3155993">//&nbsp;For&nbsp;progressive&nbsp;images,&nbsp;the&nbsp;interleaved&nbsp;scans&nbsp;(those&nbsp;with&nbsp;nComp&nbsp;&gt;&nbsp;1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3156070">//&nbsp;are&nbsp;traversed&nbsp;as&nbsp;above,&nbsp;but&nbsp;non-interleaved&nbsp;scans&nbsp;are&nbsp;traversed&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3156147">//&nbsp;to&nbsp;right,&nbsp;top&nbsp;to&nbsp;bottom:</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3156180">//&nbsp;&nbsp;&nbsp;&nbsp0&nbsp;1&nbsp;2&nbsp;3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3156196">//&nbsp;&nbsp;&nbsp;&nbsp4&nbsp;5&nbsp;6&nbsp;7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3156212">//&nbsp;Only&nbsp;DC&nbsp;scans&nbsp;(zigStart&nbsp;==&nbsp;0)&nbsp;can&nbsp;be&nbsp;interleaved.&nbsp;AC&nbsp;scans&nbsp;must&nbsp;have</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3156289">//&nbsp;only&nbsp;one&nbsp;component.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3156317">//</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3156325">//&nbsp;To&nbsp;further&nbsp;complicate&nbsp;matters,&nbsp;for&nbsp;non-interleaved&nbsp;scans,&nbsp;there&nbsp;is&nbsp;no</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3156403">//&nbsp;data&nbsp;for&nbsp;any&nbsp;blocks&nbsp;that&nbsp;are&nbsp;inside&nbsp;the&nbsp;image&nbsp;at&nbsp;the&nbsp;MCU&nbsp;level&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3156478">//&nbsp;outside&nbsp;the&nbsp;image&nbsp;at&nbsp;the&nbsp;pixel&nbsp;level.&nbsp;For&nbsp;example,&nbsp;a&nbsp;24x16&nbsp;pixel&nbsp;4:2:0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3156557">//&nbsp;progressive&nbsp;image&nbsp;consists&nbsp;of&nbsp;two&nbsp;16x16&nbsp;MCUs.&nbsp;The&nbsp;interleaved&nbsp;scans</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3156633">//&nbsp;will&nbsp;process&nbsp;8&nbsp;Y&nbsp;blocks:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3156666">//&nbsp;&nbsp;&nbsp;&nbsp0&nbsp;1&nbsp;4&nbsp;5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3156682">//&nbsp;&nbsp;&nbsp;&nbsp2&nbsp;3&nbsp;6&nbsp;7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3156698">//&nbsp;The&nbsp;non-interleaved&nbsp;scans&nbsp;will&nbsp;process&nbsp;only&nbsp;6&nbsp;Y&nbsp;blocks:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3156762">//&nbsp;&nbsp;&nbsp;&nbsp0&nbsp;1&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3156776">//&nbsp;&nbsp;&nbsp;&nbsp3&nbsp;4&nbsp;5</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3156790">if</span>&nbsp;<span class="ident" id="3156793"><a href="/image/jpeg/scan.go.html#3152201">nComp</a></span>&nbsp;<span class="op" id="3156799">!=</span>&nbsp;<span class="num" id="3156802">1</span>&nbsp;<span class="op" id="3156804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3156812"><a href="/image/jpeg/scan.go.html#3155455">bx</a></span><span class="op" id="3156814">,</span>&nbsp;<span class="ident" id="3156816"><a href="/image/jpeg/scan.go.html#3155459">by</a></span>&nbsp;<span class="op" id="3156819">=</span>&nbsp;<span class="ident" id="3156821"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3156822">.</span><span class="ident" id="3156823">comp</span><span class="op" id="3156827">[</span><span class="ident" id="3156828"><a href="/image/jpeg/scan.go.html#3155589">compIndex</a></span><span class="op" id="3156837">]</span><span class="op" id="3156838">.</span><span class="ident" id="3156839">h</span><span class="op" id="3156840">*</span><span class="ident" id="3156841"><a href="/image/jpeg/scan.go.html#3155527">mx</a></span><span class="op" id="3156843">,</span>&nbsp;<span class="ident" id="3156845"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3156846">.</span><span class="ident" id="3156847">comp</span><span class="op" id="3156851">[</span><span class="ident" id="3156852"><a href="/image/jpeg/scan.go.html#3155589">compIndex</a></span><span class="op" id="3156861">]</span><span class="op" id="3156862">.</span><span class="ident" id="3156863">v</span><span class="op" id="3156864">*</span><span class="ident" id="3156865"><a href="/image/jpeg/scan.go.html#3155495">my</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3156874">if</span>&nbsp;<span class="ident" id="3156877"><a href="/image/jpeg/scan.go.html#3154529">h0</a></span>&nbsp;<span class="op" id="3156880">==</span>&nbsp;<span class="num" id="3156883">1</span>&nbsp;<span class="op" id="3156885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3156894"><a href="/image/jpeg/scan.go.html#3155459">by</a></span>&nbsp;<span class="op" id="3156897">+=</span>&nbsp;<span class="ident" id="3156900"><a href="/image/jpeg/scan.go.html#3155669">j</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3156908">}</span>&nbsp;<span class="keyword" id="3156910">else</span>&nbsp;<span class="op" id="3156915">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3156924"><a href="/image/jpeg/scan.go.html#3155455">bx</a></span>&nbsp;<span class="op" id="3156927">+=</span>&nbsp;<span class="ident" id="3156930"><a href="/image/jpeg/scan.go.html#3155669">j</a></span>&nbsp;<span class="op" id="3156932">%</span>&nbsp;<span class="num" id="3156934">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3156943"><a href="/image/jpeg/scan.go.html#3155459">by</a></span>&nbsp;<span class="op" id="3156946">+=</span>&nbsp;<span class="ident" id="3156949"><a href="/image/jpeg/scan.go.html#3155669">j</a></span>&nbsp;<span class="op" id="3156951">/</span>&nbsp;<span class="num" id="3156953">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3156961">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3156968">}</span>&nbsp;<span class="keyword" id="3156970">else</span>&nbsp;<span class="op" id="3156975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3156983">q</span>&nbsp;<span class="op" id="3156985">:=</span>&nbsp;<span class="ident" id="3156988"><a href="/image/jpeg/scan.go.html#3154610">mxx</a></span>&nbsp;<span class="op" id="3156992">*</span>&nbsp;<span class="ident" id="3156994"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3156995">.</span><span class="ident" id="3156996">comp</span><span class="op" id="3157000">[</span><span class="ident" id="3157001"><a href="/image/jpeg/scan.go.html#3155589">compIndex</a></span><span class="op" id="3157010">]</span><span class="op" id="3157011">.</span><span class="ident" id="3157012">h</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3157020"><a href="/image/jpeg/scan.go.html#3155455">bx</a></span>&nbsp;<span class="op" id="3157023">=</span>&nbsp;<span class="ident" id="3157025"><a href="/image/jpeg/scan.go.html#3155472">blockCount</a></span>&nbsp;<span class="op" id="3157036">%</span>&nbsp;<span class="ident" id="3157038"><a href="/image/jpeg/scan.go.html#3156983">q</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3157046"><a href="/image/jpeg/scan.go.html#3155459">by</a></span>&nbsp;<span class="op" id="3157049">=</span>&nbsp;<span class="ident" id="3157051"><a href="/image/jpeg/scan.go.html#3155472">blockCount</a></span>&nbsp;<span class="op" id="3157062">/</span>&nbsp;<span class="ident" id="3157064"><a href="/image/jpeg/scan.go.html#3156983">q</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3157072"><a href="/image/jpeg/scan.go.html#3155472">blockCount</a></span><span class="op" id="3157082">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3157091">if</span>&nbsp;<span class="ident" id="3157094"><a href="/image/jpeg/scan.go.html#3155455">bx</a></span><span class="op" id="3157096">*</span><span class="num" id="3157097">8</span>&nbsp;<span class="op" id="3157099">&gt;=</span>&nbsp;<span class="ident" id="3157102"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3157103">.</span><span class="ident" id="3157104">width</span>&nbsp;<span class="op" id="3157110">||</span>&nbsp;<span class="ident" id="3157113"><a href="/image/jpeg/scan.go.html#3155459">by</a></span><span class="op" id="3157115">*</span><span class="num" id="3157116">8</span>&nbsp;<span class="op" id="3157118">&gt;=</span>&nbsp;<span class="ident" id="3157121"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3157122">.</span><span class="ident" id="3157123">height</span>&nbsp;<span class="op" id="3157130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3157139">continue</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3157154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3157161">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3157169">//&nbsp;Load&nbsp;the&nbsp;previous&nbsp;partially&nbsp;decoded&nbsp;coefficients,&nbsp;if&nbsp;applicable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3157242">if</span>&nbsp;<span class="ident" id="3157245"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3157246">.</span><span class="ident" id="3157247">progressive</span>&nbsp;<span class="op" id="3157259">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3157267"><a href="/image/jpeg/scan.go.html#3155126">b</a></span>&nbsp;<span class="op" id="3157269">=</span>&nbsp;<span class="ident" id="3157271"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3157272">.</span><span class="ident" id="3157273">progCoeffs</span><span class="op" id="3157283">[</span><span class="ident" id="3157284"><a href="/image/jpeg/scan.go.html#3155589">compIndex</a></span><span class="op" id="3157293">]</span><span class="op" id="3157294">[</span><span class="ident" id="3157295"><a href="/image/jpeg/scan.go.html#3155459">by</a></span><span class="op" id="3157297">*</span><span class="ident" id="3157298"><a href="/image/jpeg/scan.go.html#3154610">mxx</a></span><span class="op" id="3157301">*</span><span class="ident" id="3157302"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3157303">.</span><span class="ident" id="3157304">comp</span><span class="op" id="3157308">[</span><span class="ident" id="3157309"><a href="/image/jpeg/scan.go.html#3155589">compIndex</a></span><span class="op" id="3157318">]</span><span class="op" id="3157319">.</span><span class="ident" id="3157320">h</span><span class="op" id="3157321">+</span><span class="ident" id="3157322"><a href="/image/jpeg/scan.go.html#3155455">bx</a></span><span class="op" id="3157324">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3157331">}</span>&nbsp;<span class="keyword" id="3157333">else</span>&nbsp;<span class="op" id="3157338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3157346"><a href="/image/jpeg/scan.go.html#3155126">b</a></span>&nbsp;<span class="op" id="3157348">=</span>&nbsp;<span class="ident" id="3157350"><a href="/image/jpeg/idct.go.html#3131942">block</a></span><span class="op" id="3157355">{</span><span class="op" id="3157356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3157363">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3157371">if</span>&nbsp;<span class="ident" id="3157374"><a href="/image/jpeg/scan.go.html#3153865">ah</a></span>&nbsp;<span class="op" id="3157377">!=</span>&nbsp;<span class="num" id="3157380">0</span>&nbsp;<span class="op" id="3157382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3157390">if</span>&nbsp;<span class="ident" id="3157393">err</span>&nbsp;<span class="op" id="3157397">:=</span>&nbsp;<span class="ident" id="3157400"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3157401">.</span><span class="ident" id="3157402">refine</span><span class="op" id="3157408">(</span><span class="op" id="3157409">&amp;</span><span class="ident" id="3157410"><a href="/image/jpeg/scan.go.html#3155126">b</a></span><span class="op" id="3157411">,</span>&nbsp;<span class="op" id="3157413">&amp;</span><span class="ident" id="3157414"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3157415">.</span><span class="ident" id="3157416">huff</span><span class="op" id="3157420">[</span><span class="ident" id="3157421"><a href="/image/jpeg/reader.go.html#3136577">acTable</a></span><span class="op" id="3157428">]</span><span class="op" id="3157429">[</span><span class="ident" id="3157430"><a href="/image/jpeg/scan.go.html#3152327">scan</a></span><span class="op" id="3157434">[</span><span class="ident" id="3157435"><a href="/image/jpeg/scan.go.html#3155560">i</a></span><span class="op" id="3157436">]</span><span class="op" id="3157437">.</span><span class="ident" id="3157438">ta</span><span class="op" id="3157440">]</span><span class="op" id="3157441">,</span>&nbsp;<span class="ident" id="3157443"><a href="/image/jpeg/scan.go.html#3153847">zigStart</a></span><span class="op" id="3157451">,</span>&nbsp;<span class="ident" id="3157453"><a href="/image/jpeg/scan.go.html#3153857">zigEnd</a></span><span class="op" id="3157459">,</span>&nbsp;<span class="num" id="3157461">1</span><span class="op" id="3157462">&lt;&lt;</span><span class="ident" id="3157464"><a href="/image/jpeg/scan.go.html#3153869">al</a></span><span class="op" id="3157466">)</span><span class="op" id="3157467">;</span>&nbsp;<span class="ident" id="3157469"><a href="/image/jpeg/scan.go.html#3157393">err</a></span>&nbsp;<span class="op" id="3157473">!=</span>&nbsp;<span class="ident" id="3157476">nil</span>&nbsp;<span class="op" id="3157480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3157489">return</span>&nbsp;<span class="ident" id="3157496"><a href="/image/jpeg/scan.go.html#3157393">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3157506">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3157513">}</span>&nbsp;<span class="keyword" id="3157515">else</span>&nbsp;<span class="op" id="3157520">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3157528">zig</span>&nbsp;<span class="op" id="3157532">:=</span>&nbsp;<span class="ident" id="3157535"><a href="/image/jpeg/scan.go.html#3153847">zigStart</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3157550">if</span>&nbsp;<span class="ident" id="3157553"><a href="/image/jpeg/scan.go.html#3157528">zig</a></span>&nbsp;<span class="op" id="3157557">==</span>&nbsp;<span class="num" id="3157560">0</span>&nbsp;<span class="op" id="3157562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3157571"><a href="/image/jpeg/scan.go.html#3157528">zig</a></span><span class="op" id="3157574">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3157584">//&nbsp;Decode&nbsp;the&nbsp;DC&nbsp;coefficient,&nbsp;as&nbsp;specified&nbsp;in&nbsp;section&nbsp;F.2.2.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3157654">value</span><span class="op" id="3157659">,</span>&nbsp;<span class="ident" id="3157661">err</span>&nbsp;<span class="op" id="3157665">:=</span>&nbsp;<span class="ident" id="3157668"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3157669">.</span><span class="ident" id="3157670">decodeHuffman</span><span class="op" id="3157683">(</span><span class="op" id="3157684">&amp;</span><span class="ident" id="3157685"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3157686">.</span><span class="ident" id="3157687">huff</span><span class="op" id="3157691">[</span><span class="ident" id="3157692"><a href="/image/jpeg/reader.go.html#3136564">dcTable</a></span><span class="op" id="3157699">]</span><span class="op" id="3157700">[</span><span class="ident" id="3157701"><a href="/image/jpeg/scan.go.html#3152327">scan</a></span><span class="op" id="3157705">[</span><span class="ident" id="3157706"><a href="/image/jpeg/scan.go.html#3155560">i</a></span><span class="op" id="3157707">]</span><span class="op" id="3157708">.</span><span class="ident" id="3157709">td</span><span class="op" id="3157711">]</span><span class="op" id="3157712">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3157721">if</span>&nbsp;<span class="ident" id="3157724"><a href="/image/jpeg/scan.go.html#3157661">err</a></span>&nbsp;<span class="op" id="3157728">!=</span>&nbsp;<span class="ident" id="3157731">nil</span>&nbsp;<span class="op" id="3157735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3157745">return</span>&nbsp;<span class="ident" id="3157752"><a href="/image/jpeg/scan.go.html#3157661">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3157763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3157772">if</span>&nbsp;<span class="ident" id="3157775"><a href="/image/jpeg/scan.go.html#3157654">value</a></span>&nbsp;<span class="op" id="3157781">&gt;</span>&nbsp;<span class="num" id="3157783">16</span>&nbsp;<span class="op" id="3157786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3157796">return</span>&nbsp;<span class="ident" id="3157803"><a href="/image/jpeg/reader.go.html#3136184">UnsupportedError</a></span><span class="op" id="3157819">(</span><span class="string" id="3157820">&#34;excessive&nbsp;DC&nbsp;component&#34;</span><span class="op" id="3157844">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3157853">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3157862">dcDelta</span><span class="op" id="3157869">,</span>&nbsp;<span class="ident" id="3157871"><a href="/image/jpeg/scan.go.html#3157661">err</a></span>&nbsp;<span class="op" id="3157875">:=</span>&nbsp;<span class="ident" id="3157878"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3157879">.</span><span class="ident" id="3157880">receiveExtend</span><span class="op" id="3157893">(</span><span class="ident" id="3157894"><a href="/image/jpeg/scan.go.html#3157654">value</a></span><span class="op" id="3157899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3157908">if</span>&nbsp;<span class="ident" id="3157911"><a href="/image/jpeg/scan.go.html#3157661">err</a></span>&nbsp;<span class="op" id="3157915">!=</span>&nbsp;<span class="ident" id="3157918">nil</span>&nbsp;<span class="op" id="3157922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3157932">return</span>&nbsp;<span class="ident" id="3157939"><a href="/image/jpeg/scan.go.html#3157661">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3157950">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3157959"><a href="/image/jpeg/scan.go.html#3155137">dc</a></span><span class="op" id="3157961">[</span><span class="ident" id="3157962"><a href="/image/jpeg/scan.go.html#3155589">compIndex</a></span><span class="op" id="3157971">]</span>&nbsp;<span class="op" id="3157973">+=</span>&nbsp;<span class="ident" id="3157976"><a href="/image/jpeg/scan.go.html#3157862">dcDelta</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3157991"><a href="/image/jpeg/scan.go.html#3155126">b</a></span><span class="op" id="3157992">[</span><span class="num" id="3157993">0</span><span class="op" id="3157994">]</span>&nbsp;<span class="op" id="3157996">=</span>&nbsp;<span class="ident" id="3157998"><a href="/image/jpeg/scan.go.html#3155137">dc</a></span><span class="op" id="3158000">[</span><span class="ident" id="3158001"><a href="/image/jpeg/scan.go.html#3155589">compIndex</a></span><span class="op" id="3158010">]</span>&nbsp;<span class="op" id="3158012">&lt;&lt;</span>&nbsp;<span class="ident" id="3158015"><a href="/image/jpeg/scan.go.html#3153869">al</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3158024">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3158033">if</span>&nbsp;<span class="ident" id="3158036"><a href="/image/jpeg/scan.go.html#3157528">zig</a></span>&nbsp;<span class="op" id="3158040">&lt;=</span>&nbsp;<span class="ident" id="3158043"><a href="/image/jpeg/scan.go.html#3153857">zigEnd</a></span>&nbsp;<span class="op" id="3158050">&amp;&amp;</span>&nbsp;<span class="ident" id="3158053"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3158054">.</span><span class="ident" id="3158055">eobRun</span>&nbsp;<span class="op" id="3158062">&gt;</span>&nbsp;<span class="num" id="3158064">0</span>&nbsp;<span class="op" id="3158066">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3158075"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3158076">.</span><span class="ident" id="3158077">eobRun</span><span class="op" id="3158083">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3158092">}</span>&nbsp;<span class="keyword" id="3158094">else</span>&nbsp;<span class="op" id="3158099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3158108">//&nbsp;Decode&nbsp;the&nbsp;AC&nbsp;coefficients,&nbsp;as&nbsp;specified&nbsp;in&nbsp;section&nbsp;F.2.2.2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3158179">huff</span>&nbsp;<span class="op" id="3158184">:=</span>&nbsp;<span class="op" id="3158187">&amp;</span><span class="ident" id="3158188"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3158189">.</span><span class="ident" id="3158190">huff</span><span class="op" id="3158194">[</span><span class="ident" id="3158195"><a href="/image/jpeg/reader.go.html#3136577">acTable</a></span><span class="op" id="3158202">]</span><span class="op" id="3158203">[</span><span class="ident" id="3158204"><a href="/image/jpeg/scan.go.html#3152327">scan</a></span><span class="op" id="3158208">[</span><span class="ident" id="3158209"><a href="/image/jpeg/scan.go.html#3155560">i</a></span><span class="op" id="3158210">]</span><span class="op" id="3158211">.</span><span class="ident" id="3158212">ta</span><span class="op" id="3158214">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3158223">for</span>&nbsp;<span class="op" id="3158227">;</span>&nbsp;<span class="ident" id="3158229"><a href="/image/jpeg/scan.go.html#3157528">zig</a></span>&nbsp;<span class="op" id="3158233">&lt;=</span>&nbsp;<span class="ident" id="3158236"><a href="/image/jpeg/scan.go.html#3153857">zigEnd</a></span><span class="op" id="3158242">;</span>&nbsp;<span class="ident" id="3158244"><a href="/image/jpeg/scan.go.html#3157528">zig</a></span><span class="op" id="3158247">++</span>&nbsp;<span class="op" id="3158250">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3158260">value</span><span class="op" id="3158265">,</span>&nbsp;<span class="ident" id="3158267">err</span>&nbsp;<span class="op" id="3158271">:=</span>&nbsp;<span class="ident" id="3158274"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3158275">.</span><span class="ident" id="3158276">decodeHuffman</span><span class="op" id="3158289">(</span><span class="ident" id="3158290"><a href="/image/jpeg/scan.go.html#3158179">huff</a></span><span class="op" id="3158294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3158304">if</span>&nbsp;<span class="ident" id="3158307"><a href="/image/jpeg/scan.go.html#3158267">err</a></span>&nbsp;<span class="op" id="3158311">!=</span>&nbsp;<span class="ident" id="3158314">nil</span>&nbsp;<span class="op" id="3158318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3158329">return</span>&nbsp;<span class="ident" id="3158336"><a href="/image/jpeg/scan.go.html#3158267">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3158348">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3158358">val0</span>&nbsp;<span class="op" id="3158363">:=</span>&nbsp;<span class="ident" id="3158366"><a href="/image/jpeg/scan.go.html#3158260">value</a></span>&nbsp;<span class="op" id="3158372">&gt;&gt;</span>&nbsp;<span class="num" id="3158375">4</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3158385">val1</span>&nbsp;<span class="op" id="3158390">:=</span>&nbsp;<span class="ident" id="3158393"><a href="/image/jpeg/scan.go.html#3158260">value</a></span>&nbsp;<span class="op" id="3158399">&amp;</span>&nbsp;<span class="num" id="3158401">0x0f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3158414">if</span>&nbsp;<span class="ident" id="3158417"><a href="/image/jpeg/scan.go.html#3158385">val1</a></span>&nbsp;<span class="op" id="3158422">!=</span>&nbsp;<span class="num" id="3158425">0</span>&nbsp;<span class="op" id="3158427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3158438"><a href="/image/jpeg/scan.go.html#3157528">zig</a></span>&nbsp;<span class="op" id="3158442">+=</span>&nbsp;<span class="builtintype" id="3158445">int32</span><span class="op" id="3158450">(</span><span class="ident" id="3158451"><a href="/image/jpeg/scan.go.html#3158358">val0</a></span><span class="op" id="3158455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3158466">if</span>&nbsp;<span class="ident" id="3158469"><a href="/image/jpeg/scan.go.html#3157528">zig</a></span>&nbsp;<span class="op" id="3158473">&gt;</span>&nbsp;<span class="ident" id="3158475"><a href="/image/jpeg/scan.go.html#3153857">zigEnd</a></span>&nbsp;<span class="op" id="3158482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3158494">break</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3158509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3158520">ac</span><span class="op" id="3158522">,</span>&nbsp;<span class="ident" id="3158524">err</span>&nbsp;<span class="op" id="3158528">:=</span>&nbsp;<span class="ident" id="3158531"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3158532">.</span><span class="ident" id="3158533">receiveExtend</span><span class="op" id="3158546">(</span><span class="ident" id="3158547"><a href="/image/jpeg/scan.go.html#3158385">val1</a></span><span class="op" id="3158551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3158562">if</span>&nbsp;<span class="ident" id="3158565"><a href="/image/jpeg/scan.go.html#3158524">err</a></span>&nbsp;<span class="op" id="3158569">!=</span>&nbsp;<span class="ident" id="3158572">nil</span>&nbsp;<span class="op" id="3158576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3158588">return</span>&nbsp;<span class="ident" id="3158595"><a href="/image/jpeg/scan.go.html#3158524">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3158608">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3158619"><a href="/image/jpeg/scan.go.html#3155126">b</a></span><span class="op" id="3158620">[</span><span class="ident" id="3158621"><a href="/image/jpeg/reader.go.html#3137806">unzig</a></span><span class="op" id="3158626">[</span><span class="ident" id="3158627"><a href="/image/jpeg/scan.go.html#3157528">zig</a></span><span class="op" id="3158630">]</span><span class="op" id="3158631">]</span>&nbsp;<span class="op" id="3158633">=</span>&nbsp;<span class="ident" id="3158635"><a href="/image/jpeg/scan.go.html#3158520">ac</a></span>&nbsp;<span class="op" id="3158638">&lt;&lt;</span>&nbsp;<span class="ident" id="3158641"><a href="/image/jpeg/scan.go.html#3153869">al</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3158652">}</span>&nbsp;<span class="keyword" id="3158654">else</span>&nbsp;<span class="op" id="3158659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3158670">if</span>&nbsp;<span class="ident" id="3158673"><a href="/image/jpeg/scan.go.html#3158358">val0</a></span>&nbsp;<span class="op" id="3158678">!=</span>&nbsp;<span class="num" id="3158681">0x0f</span>&nbsp;<span class="op" id="3158686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3158698"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3158699">.</span><span class="ident" id="3158700">eobRun</span>&nbsp;<span class="op" id="3158707">=</span>&nbsp;<span class="builtintype" id="3158709">uint16</span><span class="op" id="3158715">(</span><span class="num" id="3158716">1</span>&nbsp;<span class="op" id="3158718">&lt;&lt;</span>&nbsp;<span class="ident" id="3158721"><a href="/image/jpeg/scan.go.html#3158358">val0</a></span><span class="op" id="3158725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3158737">if</span>&nbsp;<span class="ident" id="3158740"><a href="/image/jpeg/scan.go.html#3158358">val0</a></span>&nbsp;<span class="op" id="3158745">!=</span>&nbsp;<span class="num" id="3158748">0</span>&nbsp;<span class="op" id="3158750">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3158763">bits</span><span class="op" id="3158767">,</span>&nbsp;<span class="ident" id="3158769">err</span>&nbsp;<span class="op" id="3158773">:=</span>&nbsp;<span class="ident" id="3158776"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3158777">.</span><span class="ident" id="3158778">decodeBits</span><span class="op" id="3158788">(</span><span class="builtintype" id="3158789">int32</span><span class="op" id="3158794">(</span><span class="ident" id="3158795"><a href="/image/jpeg/scan.go.html#3158358">val0</a></span><span class="op" id="3158799">)</span><span class="op" id="3158800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3158813">if</span>&nbsp;<span class="ident" id="3158816"><a href="/image/jpeg/scan.go.html#3158769">err</a></span>&nbsp;<span class="op" id="3158820">!=</span>&nbsp;<span class="ident" id="3158823">nil</span>&nbsp;<span class="op" id="3158827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3158841">return</span>&nbsp;<span class="ident" id="3158848"><a href="/image/jpeg/scan.go.html#3158769">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3158863">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3158876"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3158877">.</span><span class="ident" id="3158878">eobRun</span>&nbsp;<span class="op" id="3158885">|=</span>&nbsp;<span class="builtintype" id="3158888">uint16</span><span class="op" id="3158894">(</span><span class="ident" id="3158895"><a href="/image/jpeg/scan.go.html#3158763">bits</a></span><span class="op" id="3158899">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3158911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3158923"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3158924">.</span><span class="ident" id="3158925">eobRun</span><span class="op" id="3158931">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3158944">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3158959">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3158970"><a href="/image/jpeg/scan.go.html#3157528">zig</a></span>&nbsp;<span class="op" id="3158974">+=</span>&nbsp;<span class="num" id="3158977">0x0f</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3158990">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3158999">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3159007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3159014">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3159022">if</span>&nbsp;<span class="ident" id="3159025"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3159026">.</span><span class="ident" id="3159027">progressive</span>&nbsp;<span class="op" id="3159039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3159047">if</span>&nbsp;<span class="ident" id="3159050"><a href="/image/jpeg/scan.go.html#3153857">zigEnd</a></span>&nbsp;<span class="op" id="3159057">!=</span>&nbsp;<span class="ident" id="3159060"><a href="/image/jpeg/idct.go.html#3131898">blockSize</a></span><span class="op" id="3159069">-</span><span class="num" id="3159070">1</span>&nbsp;<span class="op" id="3159072">||</span>&nbsp;<span class="ident" id="3159075"><a href="/image/jpeg/scan.go.html#3153869">al</a></span>&nbsp;<span class="op" id="3159078">!=</span>&nbsp;<span class="num" id="3159081">0</span>&nbsp;<span class="op" id="3159083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3159092">//&nbsp;We&nbsp;haven&#39;t&nbsp;completely&nbsp;decoded&nbsp;this&nbsp;8x8&nbsp;block.&nbsp;Save&nbsp;the&nbsp;coefficients.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3159171"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3159172">.</span><span class="ident" id="3159173">progCoeffs</span><span class="op" id="3159183">[</span><span class="ident" id="3159184"><a href="/image/jpeg/scan.go.html#3155589">compIndex</a></span><span class="op" id="3159193">]</span><span class="op" id="3159194">[</span><span class="ident" id="3159195"><a href="/image/jpeg/scan.go.html#3155459">by</a></span><span class="op" id="3159197">*</span><span class="ident" id="3159198"><a href="/image/jpeg/scan.go.html#3154610">mxx</a></span><span class="op" id="3159201">*</span><span class="ident" id="3159202"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3159203">.</span><span class="ident" id="3159204">comp</span><span class="op" id="3159208">[</span><span class="ident" id="3159209"><a href="/image/jpeg/scan.go.html#3155589">compIndex</a></span><span class="op" id="3159218">]</span><span class="op" id="3159219">.</span><span class="ident" id="3159220">h</span><span class="op" id="3159221">+</span><span class="ident" id="3159222"><a href="/image/jpeg/scan.go.html#3155455">bx</a></span><span class="op" id="3159224">]</span>&nbsp;<span class="op" id="3159226">=</span>&nbsp;<span class="ident" id="3159228"><a href="/image/jpeg/scan.go.html#3155126">b</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3159237">//&nbsp;At&nbsp;this&nbsp;point,&nbsp;we&nbsp;could&nbsp;execute&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;loop&nbsp;body&nbsp;to&nbsp;dequantize&nbsp;and</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3159323">//&nbsp;perform&nbsp;the&nbsp;inverse&nbsp;DCT,&nbsp;to&nbsp;save&nbsp;early&nbsp;stages&nbsp;of&nbsp;a&nbsp;progressive&nbsp;image&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3159409">//&nbsp;*image.YCbCr&nbsp;buffers&nbsp;(the&nbsp;whole&nbsp;point&nbsp;of&nbsp;progressive&nbsp;encoding),&nbsp;but&nbsp;in&nbsp;Go,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3159494">//&nbsp;the&nbsp;jpeg.Decode&nbsp;function&nbsp;does&nbsp;not&nbsp;return&nbsp;until&nbsp;the&nbsp;entire&nbsp;image&nbsp;is&nbsp;decoded,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3159580">//&nbsp;so&nbsp;we&nbsp;&#34;continue&#34;&nbsp;here&nbsp;to&nbsp;avoid&nbsp;wasted&nbsp;computation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3159641">continue</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3159656">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3159663">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3159671">//&nbsp;Dequantize,&nbsp;perform&nbsp;the&nbsp;inverse&nbsp;DCT&nbsp;and&nbsp;store&nbsp;the&nbsp;block&nbsp;to&nbsp;the&nbsp;image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3159749">for</span>&nbsp;<span class="ident" id="3159753">zig</span>&nbsp;<span class="op" id="3159757">:=</span>&nbsp;<span class="num" id="3159760">0</span><span class="op" id="3159761">;</span>&nbsp;<span class="ident" id="3159763"><a href="/image/jpeg/scan.go.html#3159753">zig</a></span>&nbsp;<span class="op" id="3159767">&lt;</span>&nbsp;<span class="ident" id="3159769"><a href="/image/jpeg/idct.go.html#3131898">blockSize</a></span><span class="op" id="3159778">;</span>&nbsp;<span class="ident" id="3159780"><a href="/image/jpeg/scan.go.html#3159753">zig</a></span><span class="op" id="3159783">++</span>&nbsp;<span class="op" id="3159786">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3159794"><a href="/image/jpeg/scan.go.html#3155126">b</a></span><span class="op" id="3159795">[</span><span class="ident" id="3159796"><a href="/image/jpeg/reader.go.html#3137806">unzig</a></span><span class="op" id="3159801">[</span><span class="ident" id="3159802"><a href="/image/jpeg/scan.go.html#3159753">zig</a></span><span class="op" id="3159805">]</span><span class="op" id="3159806">]</span>&nbsp;<span class="op" id="3159808">*=</span>&nbsp;<span class="ident" id="3159811"><a href="/image/jpeg/scan.go.html#3155624">qt</a></span><span class="op" id="3159813">[</span><span class="ident" id="3159814"><a href="/image/jpeg/scan.go.html#3159753">zig</a></span><span class="op" id="3159817">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3159824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3159831"><a href="/image/jpeg/idct.go.html#3132856">idct</a></span><span class="op" id="3159835">(</span><span class="op" id="3159836">&amp;</span><span class="ident" id="3159837"><a href="/image/jpeg/scan.go.html#3155126">b</a></span><span class="op" id="3159838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3159845">dst</span><span class="op" id="3159848">,</span>&nbsp;<span class="ident" id="3159850">stride</span>&nbsp;<span class="op" id="3159857">:=</span>&nbsp;<span class="op" id="3159860">[</span><span class="op" id="3159861">]</span><span class="builtintype" id="3159862">byte</span><span class="op" id="3159866">(</span><span class="ident" id="3159867">nil</span><span class="op" id="3159870">)</span><span class="op" id="3159871">,</span>&nbsp;<span class="num" id="3159873">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3159880">if</span>&nbsp;<span class="ident" id="3159883"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3159884">.</span><span class="ident" id="3159885">nComp</span>&nbsp;<span class="op" id="3159891">==</span>&nbsp;<span class="ident" id="3159894"><a href="/image/jpeg/reader.go.html#3136681">nGrayComponent</a></span>&nbsp;<span class="op" id="3159909">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3159917"><a href="/image/jpeg/scan.go.html#3159845">dst</a></span><span class="op" id="3159920">,</span>&nbsp;<span class="ident" id="3159922"><a href="/image/jpeg/scan.go.html#3159850">stride</a></span>&nbsp;<span class="op" id="3159929">=</span>&nbsp;<span class="ident" id="3159931"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3159932">.</span><span class="ident" id="3159933">img1</span><span class="op" id="3159937">.</span><span class="ident" id="3159938">Pix</span><span class="op" id="3159941">[</span><span class="num" id="3159942">8</span><span class="op" id="3159943">*</span><span class="op" id="3159944">(</span><span class="ident" id="3159945"><a href="/image/jpeg/scan.go.html#3155459">by</a></span><span class="op" id="3159947">*</span><span class="ident" id="3159948"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3159949">.</span><span class="ident" id="3159950">img1</span><span class="op" id="3159954">.</span><span class="ident" id="3159955">Stride</span><span class="op" id="3159961">+</span><span class="ident" id="3159962"><a href="/image/jpeg/scan.go.html#3155455">bx</a></span><span class="op" id="3159964">)</span><span class="op" id="3159965">:</span><span class="op" id="3159966">]</span><span class="op" id="3159967">,</span>&nbsp;<span class="ident" id="3159969"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3159970">.</span><span class="ident" id="3159971">img1</span><span class="op" id="3159975">.</span><span class="ident" id="3159976">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3159988">}</span>&nbsp;<span class="keyword" id="3159990">else</span>&nbsp;<span class="op" id="3159995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3160003">switch</span>&nbsp;<span class="ident" id="3160010"><a href="/image/jpeg/scan.go.html#3155589">compIndex</a></span>&nbsp;<span class="op" id="3160020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3160028">case</span>&nbsp;<span class="num" id="3160033">0</span><span class="op" id="3160034">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3160043"><a href="/image/jpeg/scan.go.html#3159845">dst</a></span><span class="op" id="3160046">,</span>&nbsp;<span class="ident" id="3160048"><a href="/image/jpeg/scan.go.html#3159850">stride</a></span>&nbsp;<span class="op" id="3160055">=</span>&nbsp;<span class="ident" id="3160057"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3160058">.</span><span class="ident" id="3160059">img3</span><span class="op" id="3160063">.</span><span class="ident" id="3160064">Y</span><span class="op" id="3160065">[</span><span class="num" id="3160066">8</span><span class="op" id="3160067">*</span><span class="op" id="3160068">(</span><span class="ident" id="3160069"><a href="/image/jpeg/scan.go.html#3155459">by</a></span><span class="op" id="3160071">*</span><span class="ident" id="3160072"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3160073">.</span><span class="ident" id="3160074">img3</span><span class="op" id="3160078">.</span><span class="ident" id="3160079">YStride</span><span class="op" id="3160086">+</span><span class="ident" id="3160087"><a href="/image/jpeg/scan.go.html#3155455">bx</a></span><span class="op" id="3160089">)</span><span class="op" id="3160090">:</span><span class="op" id="3160091">]</span><span class="op" id="3160092">,</span>&nbsp;<span class="ident" id="3160094"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3160095">.</span><span class="ident" id="3160096">img3</span><span class="op" id="3160100">.</span><span class="ident" id="3160101">YStride</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3160115">case</span>&nbsp;<span class="num" id="3160120">1</span><span class="op" id="3160121">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3160130"><a href="/image/jpeg/scan.go.html#3159845">dst</a></span><span class="op" id="3160133">,</span>&nbsp;<span class="ident" id="3160135"><a href="/image/jpeg/scan.go.html#3159850">stride</a></span>&nbsp;<span class="op" id="3160142">=</span>&nbsp;<span class="ident" id="3160144"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3160145">.</span><span class="ident" id="3160146">img3</span><span class="op" id="3160150">.</span><span class="ident" id="3160151">Cb</span><span class="op" id="3160153">[</span><span class="num" id="3160154">8</span><span class="op" id="3160155">*</span><span class="op" id="3160156">(</span><span class="ident" id="3160157"><a href="/image/jpeg/scan.go.html#3155459">by</a></span><span class="op" id="3160159">*</span><span class="ident" id="3160160"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3160161">.</span><span class="ident" id="3160162">img3</span><span class="op" id="3160166">.</span><span class="ident" id="3160167">CStride</span><span class="op" id="3160174">+</span><span class="ident" id="3160175"><a href="/image/jpeg/scan.go.html#3155455">bx</a></span><span class="op" id="3160177">)</span><span class="op" id="3160178">:</span><span class="op" id="3160179">]</span><span class="op" id="3160180">,</span>&nbsp;<span class="ident" id="3160182"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3160183">.</span><span class="ident" id="3160184">img3</span><span class="op" id="3160188">.</span><span class="ident" id="3160189">CStride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3160203">case</span>&nbsp;<span class="num" id="3160208">2</span><span class="op" id="3160209">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3160218"><a href="/image/jpeg/scan.go.html#3159845">dst</a></span><span class="op" id="3160221">,</span>&nbsp;<span class="ident" id="3160223"><a href="/image/jpeg/scan.go.html#3159850">stride</a></span>&nbsp;<span class="op" id="3160230">=</span>&nbsp;<span class="ident" id="3160232"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3160233">.</span><span class="ident" id="3160234">img3</span><span class="op" id="3160238">.</span><span class="ident" id="3160239">Cr</span><span class="op" id="3160241">[</span><span class="num" id="3160242">8</span><span class="op" id="3160243">*</span><span class="op" id="3160244">(</span><span class="ident" id="3160245"><a href="/image/jpeg/scan.go.html#3155459">by</a></span><span class="op" id="3160247">*</span><span class="ident" id="3160248"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3160249">.</span><span class="ident" id="3160250">img3</span><span class="op" id="3160254">.</span><span class="ident" id="3160255">CStride</span><span class="op" id="3160262">+</span><span class="ident" id="3160263"><a href="/image/jpeg/scan.go.html#3155455">bx</a></span><span class="op" id="3160265">)</span><span class="op" id="3160266">:</span><span class="op" id="3160267">]</span><span class="op" id="3160268">,</span>&nbsp;<span class="ident" id="3160270"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3160271">.</span><span class="ident" id="3160272">img3</span><span class="op" id="3160276">.</span><span class="ident" id="3160277">CStride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3160291">default</span><span class="op" id="3160298">:</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3160307">return</span>&nbsp;<span class="ident" id="3160314"><a href="/image/jpeg/reader.go.html#3136184">UnsupportedError</a></span><span class="op" id="3160330">(</span><span class="string" id="3160331">&#34;too&nbsp;many&nbsp;components&#34;</span><span class="op" id="3160352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3160360">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3160367">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3160374">//&nbsp;Level&nbsp;shift&nbsp;by&nbsp;+128,&nbsp;clip&nbsp;to&nbsp;[0,&nbsp;255],&nbsp;and&nbsp;write&nbsp;to&nbsp;dst.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3160439">for</span>&nbsp;<span class="ident" id="3160443">y</span>&nbsp;<span class="op" id="3160445">:=</span>&nbsp;<span class="num" id="3160448">0</span><span class="op" id="3160449">;</span>&nbsp;<span class="ident" id="3160451"><a href="/image/jpeg/scan.go.html#3160443">y</a></span>&nbsp;<span class="op" id="3160453">&lt;</span>&nbsp;<span class="num" id="3160455">8</span><span class="op" id="3160456">;</span>&nbsp;<span class="ident" id="3160458"><a href="/image/jpeg/scan.go.html#3160443">y</a></span><span class="op" id="3160459">++</span>&nbsp;<span class="op" id="3160462">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3160470">y8</span>&nbsp;<span class="op" id="3160473">:=</span>&nbsp;<span class="ident" id="3160476"><a href="/image/jpeg/scan.go.html#3160443">y</a></span>&nbsp;<span class="op" id="3160478">*</span>&nbsp;<span class="num" id="3160480">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3160488">yStride</span>&nbsp;<span class="op" id="3160496">:=</span>&nbsp;<span class="ident" id="3160499"><a href="/image/jpeg/scan.go.html#3160443">y</a></span>&nbsp;<span class="op" id="3160501">*</span>&nbsp;<span class="ident" id="3160503"><a href="/image/jpeg/scan.go.html#3159850">stride</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3160516">for</span>&nbsp;<span class="ident" id="3160520">x</span>&nbsp;<span class="op" id="3160522">:=</span>&nbsp;<span class="num" id="3160525">0</span><span class="op" id="3160526">;</span>&nbsp;<span class="ident" id="3160528"><a href="/image/jpeg/scan.go.html#3160520">x</a></span>&nbsp;<span class="op" id="3160530">&lt;</span>&nbsp;<span class="num" id="3160532">8</span><span class="op" id="3160533">;</span>&nbsp;<span class="ident" id="3160535"><a href="/image/jpeg/scan.go.html#3160520">x</a></span><span class="op" id="3160536">++</span>&nbsp;<span class="op" id="3160539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3160548">c</span>&nbsp;<span class="op" id="3160550">:=</span>&nbsp;<span class="ident" id="3160553"><a href="/image/jpeg/scan.go.html#3155126">b</a></span><span class="op" id="3160554">[</span><span class="ident" id="3160555"><a href="/image/jpeg/scan.go.html#3160470">y8</a></span><span class="op" id="3160557">+</span><span class="ident" id="3160558"><a href="/image/jpeg/scan.go.html#3160520">x</a></span><span class="op" id="3160559">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3160568">if</span>&nbsp;<span class="ident" id="3160571"><a href="/image/jpeg/scan.go.html#3160548">c</a></span>&nbsp;<span class="op" id="3160573">&lt;</span>&nbsp;<span class="op" id="3160575">-</span><span class="num" id="3160576">128</span>&nbsp;<span class="op" id="3160580">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3160590"><a href="/image/jpeg/scan.go.html#3160548">c</a></span>&nbsp;<span class="op" id="3160592">=</span>&nbsp;<span class="num" id="3160594">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3160603">}</span>&nbsp;<span class="keyword" id="3160605">else</span>&nbsp;<span class="keyword" id="3160610">if</span>&nbsp;<span class="ident" id="3160613"><a href="/image/jpeg/scan.go.html#3160548">c</a></span>&nbsp;<span class="op" id="3160615">&gt;</span>&nbsp;<span class="num" id="3160617">127</span>&nbsp;<span class="op" id="3160621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3160631"><a href="/image/jpeg/scan.go.html#3160548">c</a></span>&nbsp;<span class="op" id="3160633">=</span>&nbsp;<span class="num" id="3160635">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3160646">}</span>&nbsp;<span class="keyword" id="3160648">else</span>&nbsp;<span class="op" id="3160653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3160663"><a href="/image/jpeg/scan.go.html#3160548">c</a></span>&nbsp;<span class="op" id="3160665">+=</span>&nbsp;<span class="num" id="3160668">128</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3160679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3160688"><a href="/image/jpeg/scan.go.html#3159845">dst</a></span><span class="op" id="3160691">[</span><span class="ident" id="3160692"><a href="/image/jpeg/scan.go.html#3160488">yStride</a></span><span class="op" id="3160699">+</span><span class="ident" id="3160700"><a href="/image/jpeg/scan.go.html#3160520">x</a></span><span class="op" id="3160701">]</span>&nbsp;<span class="op" id="3160703">=</span>&nbsp;<span class="builtintype" id="3160705">uint8</span><span class="op" id="3160710">(</span><span class="ident" id="3160711"><a href="/image/jpeg/scan.go.html#3160548">c</a></span><span class="op" id="3160712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3160720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3160727">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3160733">}</span>&nbsp;<span class="comment" id="3160735">//&nbsp;for&nbsp;j</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3160747">}</span>&nbsp;<span class="comment" id="3160749">//&nbsp;for&nbsp;i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3160761"><a href="/image/jpeg/scan.go.html#3155008">mcu</a></span><span class="op" id="3160764">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3160770">if</span>&nbsp;<span class="ident" id="3160773"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3160774">.</span><span class="ident" id="3160775">ri</span>&nbsp;<span class="op" id="3160778">&gt;</span>&nbsp;<span class="num" id="3160780">0</span>&nbsp;<span class="op" id="3160782">&amp;&amp;</span>&nbsp;<span class="ident" id="3160785"><a href="/image/jpeg/scan.go.html#3155008">mcu</a></span><span class="op" id="3160788">%</span><span class="ident" id="3160789"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3160790">.</span><span class="ident" id="3160791">ri</span>&nbsp;<span class="op" id="3160794">==</span>&nbsp;<span class="num" id="3160797">0</span>&nbsp;<span class="op" id="3160799">&amp;&amp;</span>&nbsp;<span class="ident" id="3160802"><a href="/image/jpeg/scan.go.html#3155008">mcu</a></span>&nbsp;<span class="op" id="3160806">&lt;</span>&nbsp;<span class="ident" id="3160808"><a href="/image/jpeg/scan.go.html#3154610">mxx</a></span><span class="op" id="3160811">*</span><span class="ident" id="3160812"><a href="/image/jpeg/scan.go.html#3154650">myy</a></span>&nbsp;<span class="op" id="3160816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3160822">//&nbsp;A&nbsp;more&nbsp;sophisticated&nbsp;decoder&nbsp;could&nbsp;use&nbsp;RST[0-7]&nbsp;markers&nbsp;to&nbsp;resynchronize&nbsp;from&nbsp;corrupt&nbsp;input,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3160922">//&nbsp;but&nbsp;this&nbsp;one&nbsp;assumes&nbsp;well-formed&nbsp;input,&nbsp;and&nbsp;hence&nbsp;the&nbsp;restart&nbsp;marker&nbsp;follows&nbsp;immediately.</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3161019">if</span>&nbsp;<span class="ident" id="3161022">err</span>&nbsp;<span class="op" id="3161026">:=</span>&nbsp;<span class="ident" id="3161029"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3161030">.</span><span class="ident" id="3161031">readFull</span><span class="op" id="3161039">(</span><span class="ident" id="3161040"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3161041">.</span><span class="ident" id="3161042">tmp</span><span class="op" id="3161045">[</span><span class="op" id="3161046">:</span><span class="num" id="3161047">2</span><span class="op" id="3161048">]</span><span class="op" id="3161049">)</span><span class="op" id="3161050">;</span>&nbsp;<span class="ident" id="3161052"><a href="/image/jpeg/scan.go.html#3161022">err</a></span>&nbsp;<span class="op" id="3161056">!=</span>&nbsp;<span class="ident" id="3161059">nil</span>&nbsp;<span class="op" id="3161063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3161070">return</span>&nbsp;<span class="ident" id="3161077"><a href="/image/jpeg/scan.go.html#3161022">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3161085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3161091">if</span>&nbsp;<span class="ident" id="3161094"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3161095">.</span><span class="ident" id="3161096">tmp</span><span class="op" id="3161099">[</span><span class="num" id="3161100">0</span><span class="op" id="3161101">]</span>&nbsp;<span class="op" id="3161103">!=</span>&nbsp;<span class="num" id="3161106">0xff</span>&nbsp;<span class="op" id="3161111">||</span>&nbsp;<span class="ident" id="3161114"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3161115">.</span><span class="ident" id="3161116">tmp</span><span class="op" id="3161119">[</span><span class="num" id="3161120">1</span><span class="op" id="3161121">]</span>&nbsp;<span class="op" id="3161123">!=</span>&nbsp;<span class="ident" id="3161126"><a href="/image/jpeg/scan.go.html#3155013">expectedRST</a></span>&nbsp;<span class="op" id="3161138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3161145">return</span>&nbsp;<span class="ident" id="3161152"><a href="/image/jpeg/reader.go.html#3135984">FormatError</a></span><span class="op" id="3161163">(</span><span class="string" id="3161164">&#34;bad&nbsp;RST&nbsp;marker&#34;</span><span class="op" id="3161180">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3161186">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3161192"><a href="/image/jpeg/scan.go.html#3155013">expectedRST</a></span><span class="op" id="3161203">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3161210">if</span>&nbsp;<span class="ident" id="3161213"><a href="/image/jpeg/scan.go.html#3155013">expectedRST</a></span>&nbsp;<span class="op" id="3161225">==</span>&nbsp;<span class="ident" id="3161228"><a href="/image/jpeg/reader.go.html#3137397">rst7Marker</a></span><span class="op" id="3161238">+</span><span class="num" id="3161239">1</span>&nbsp;<span class="op" id="3161241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3161248"><a href="/image/jpeg/scan.go.html#3155013">expectedRST</a></span>&nbsp;<span class="op" id="3161260">=</span>&nbsp;<span class="ident" id="3161262"><a href="/image/jpeg/reader.go.html#3137361">rst0Marker</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3161277">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3161283">//&nbsp;Reset&nbsp;the&nbsp;Huffman&nbsp;decoder.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3161317"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3161318">.</span><span class="ident" id="3161319">bits</span>&nbsp;<span class="op" id="3161324">=</span>&nbsp;<span class="ident" id="3161326"><a href="/image/jpeg/reader.go.html#3138342">bits</a></span><span class="op" id="3161330">{</span><span class="op" id="3161331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3161337">//&nbsp;Reset&nbsp;the&nbsp;DC&nbsp;components,&nbsp;as&nbsp;per&nbsp;section&nbsp;F.2.1.3.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3161395"><a href="/image/jpeg/scan.go.html#3155137">dc</a></span>&nbsp;<span class="op" id="3161398">=</span>&nbsp;<span class="op" id="3161400">[</span><span class="ident" id="3161401"><a href="/image/jpeg/reader.go.html#3136753">nColorComponent</a></span><span class="op" id="3161416">]</span><span class="builtintype" id="3161417">int32</span><span class="op" id="3161422">{</span><span class="op" id="3161423">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3161429">//&nbsp;Reset&nbsp;the&nbsp;progressive&nbsp;decoder&nbsp;state,&nbsp;as&nbsp;per&nbsp;section&nbsp;G.1.2.2.</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3161497"><a href="/image/jpeg/scan.go.html#3151943">d</a></span><span class="op" id="3161498">.</span><span class="ident" id="3161499">eobRun</span>&nbsp;<span class="op" id="3161506">=</span>&nbsp;<span class="num" id="3161508">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3161513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3161517">}</span>&nbsp;<span class="comment" id="3161519">//&nbsp;for&nbsp;mx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3161530">}</span>&nbsp;<span class="comment" id="3161532">//&nbsp;for&nbsp;my</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3161544">return</span>&nbsp;<span class="ident" id="3161551">nil</span><br>
<span class="lineno"></span><span class="op" id="3161555">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3161558">//&nbsp;refine&nbsp;decodes&nbsp;a&nbsp;successive&nbsp;approximation&nbsp;refinement&nbsp;block,&nbsp;as&nbsp;specified&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3161637">//&nbsp;section&nbsp;G.1.2.</span><br>
<span class="lineno">340</span><span class="keyword" id="3161655">func</span>&nbsp;<span class="op" id="3161660">(</span><span class="ident" id="3161661">d</span>&nbsp;<span class="op" id="3161663">*</span><span class="ident" id="3161664"><a href="/image/jpeg/reader.go.html#3138497">decoder</a></span><span class="op" id="3161671">)</span>&nbsp;<span class="ident" id="3161673">refine</span><span class="op" id="3161679">(</span><span class="ident" id="3161680">b</span>&nbsp;<span class="op" id="3161682">*</span><span class="ident" id="3161683"><a href="/image/jpeg/idct.go.html#3131942">block</a></span><span class="op" id="3161688">,</span>&nbsp;<span class="ident" id="3161690">h</span>&nbsp;<span class="op" id="3161692">*</span><span class="ident" id="3161693"><a href="/image/jpeg/huffman.go.html#3124508">huffman</a></span><span class="op" id="3161700">,</span>&nbsp;<span class="ident" id="3161702">zigStart</span><span class="op" id="3161710">,</span>&nbsp;<span class="ident" id="3161712">zigEnd</span><span class="op" id="3161718">,</span>&nbsp;<span class="ident" id="3161720">delta</span>&nbsp;<span class="builtintype" id="3161726">int32</span><span class="op" id="3161731">)</span>&nbsp;<span class="builtintype" id="3161733">error</span>&nbsp;<span class="op" id="3161739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3161742">//&nbsp;Refining&nbsp;a&nbsp;DC&nbsp;component&nbsp;is&nbsp;trivial.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3161782">if</span>&nbsp;<span class="ident" id="3161785"><a href="/image/jpeg/scan.go.html#3161702">zigStart</a></span>&nbsp;<span class="op" id="3161794">==</span>&nbsp;<span class="num" id="3161797">0</span>&nbsp;<span class="op" id="3161799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3161803">if</span>&nbsp;<span class="ident" id="3161806"><a href="/image/jpeg/scan.go.html#3161712">zigEnd</a></span>&nbsp;<span class="op" id="3161813">!=</span>&nbsp;<span class="num" id="3161816">0</span>&nbsp;<span class="op" id="3161818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3161823">panic</span><span class="op" id="3161828">(</span><span class="string" id="3161829">&#34;unreachable&#34;</span><span class="op" id="3161842">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3161846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3161850">bit</span><span class="op" id="3161853">,</span>&nbsp;<span class="ident" id="3161855">err</span>&nbsp;<span class="op" id="3161859">:=</span>&nbsp;<span class="ident" id="3161862"><a href="/image/jpeg/scan.go.html#3161661">d</a></span><span class="op" id="3161863">.</span><span class="ident" id="3161864">decodeBit</span><span class="op" id="3161873">(</span><span class="op" id="3161874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3161878">if</span>&nbsp;<span class="ident" id="3161881"><a href="/image/jpeg/scan.go.html#3161855">err</a></span>&nbsp;<span class="op" id="3161885">!=</span>&nbsp;<span class="ident" id="3161888">nil</span>&nbsp;<span class="op" id="3161892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3161897">return</span>&nbsp;<span class="ident" id="3161904"><a href="/image/jpeg/scan.go.html#3161855">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3161910">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3161914">if</span>&nbsp;<span class="ident" id="3161917"><a href="/image/jpeg/scan.go.html#3161850">bit</a></span>&nbsp;<span class="op" id="3161921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3161926"><a href="/image/jpeg/scan.go.html#3161680">b</a></span><span class="op" id="3161927">[</span><span class="num" id="3161928">0</span><span class="op" id="3161929">]</span>&nbsp;<span class="op" id="3161931">|=</span>&nbsp;<span class="ident" id="3161934"><a href="/image/jpeg/scan.go.html#3161720">delta</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3161942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3161946">return</span>&nbsp;<span class="ident" id="3161953">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3161958">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3161962">//&nbsp;Refining&nbsp;AC&nbsp;components&nbsp;is&nbsp;more&nbsp;complicated;&nbsp;see&nbsp;sections&nbsp;G.1.2.2&nbsp;and&nbsp;G.1.2.3.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3162044">zig</span>&nbsp;<span class="op" id="3162048">:=</span>&nbsp;<span class="ident" id="3162051"><a href="/image/jpeg/scan.go.html#3161702">zigStart</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3162061">if</span>&nbsp;<span class="ident" id="3162064"><a href="/image/jpeg/scan.go.html#3161661">d</a></span><span class="op" id="3162065">.</span><span class="ident" id="3162066">eobRun</span>&nbsp;<span class="op" id="3162073">==</span>&nbsp;<span class="num" id="3162076">0</span>&nbsp;<span class="op" id="3162078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3162081">loop</span><span class="op" id="3162085">:</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3162089">for</span>&nbsp;<span class="op" id="3162093">;</span>&nbsp;<span class="ident" id="3162095"><a href="/image/jpeg/scan.go.html#3162044">zig</a></span>&nbsp;<span class="op" id="3162099">&lt;=</span>&nbsp;<span class="ident" id="3162102"><a href="/image/jpeg/scan.go.html#3161712">zigEnd</a></span><span class="op" id="3162108">;</span>&nbsp;<span class="ident" id="3162110"><a href="/image/jpeg/scan.go.html#3162044">zig</a></span><span class="op" id="3162113">++</span>&nbsp;<span class="op" id="3162116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3162121">z</span>&nbsp;<span class="op" id="3162123">:=</span>&nbsp;<span class="builtintype" id="3162126">int32</span><span class="op" id="3162131">(</span><span class="num" id="3162132">0</span><span class="op" id="3162133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3162138">value</span><span class="op" id="3162143">,</span>&nbsp;<span class="ident" id="3162145">err</span>&nbsp;<span class="op" id="3162149">:=</span>&nbsp;<span class="ident" id="3162152"><a href="/image/jpeg/scan.go.html#3161661">d</a></span><span class="op" id="3162153">.</span><span class="ident" id="3162154">decodeHuffman</span><span class="op" id="3162167">(</span><span class="ident" id="3162168"><a href="/image/jpeg/scan.go.html#3161690">h</a></span><span class="op" id="3162169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3162174">if</span>&nbsp;<span class="ident" id="3162177"><a href="/image/jpeg/scan.go.html#3162145">err</a></span>&nbsp;<span class="op" id="3162181">!=</span>&nbsp;<span class="ident" id="3162184">nil</span>&nbsp;<span class="op" id="3162188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3162194">return</span>&nbsp;<span class="ident" id="3162201"><a href="/image/jpeg/scan.go.html#3162145">err</a></span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3162208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3162213">val0</span>&nbsp;<span class="op" id="3162218">:=</span>&nbsp;<span class="ident" id="3162221"><a href="/image/jpeg/scan.go.html#3162138">value</a></span>&nbsp;<span class="op" id="3162227">&gt;&gt;</span>&nbsp;<span class="num" id="3162230">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3162235">val1</span>&nbsp;<span class="op" id="3162240">:=</span>&nbsp;<span class="ident" id="3162243"><a href="/image/jpeg/scan.go.html#3162138">value</a></span>&nbsp;<span class="op" id="3162249">&amp;</span>&nbsp;<span class="num" id="3162251">0x0f</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3162260">switch</span>&nbsp;<span class="ident" id="3162267"><a href="/image/jpeg/scan.go.html#3162235">val1</a></span>&nbsp;<span class="op" id="3162272">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3162277">case</span>&nbsp;<span class="num" id="3162282">0</span><span class="op" id="3162283">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3162289">if</span>&nbsp;<span class="ident" id="3162292"><a href="/image/jpeg/scan.go.html#3162213">val0</a></span>&nbsp;<span class="op" id="3162297">!=</span>&nbsp;<span class="num" id="3162300">0x0f</span>&nbsp;<span class="op" id="3162305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3162312"><a href="/image/jpeg/scan.go.html#3161661">d</a></span><span class="op" id="3162313">.</span><span class="ident" id="3162314">eobRun</span>&nbsp;<span class="op" id="3162321">=</span>&nbsp;<span class="builtintype" id="3162323">uint16</span><span class="op" id="3162329">(</span><span class="num" id="3162330">1</span>&nbsp;<span class="op" id="3162332">&lt;&lt;</span>&nbsp;<span class="ident" id="3162335"><a href="/image/jpeg/scan.go.html#3162213">val0</a></span><span class="op" id="3162339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3162346">if</span>&nbsp;<span class="ident" id="3162349"><a href="/image/jpeg/scan.go.html#3162213">val0</a></span>&nbsp;<span class="op" id="3162354">!=</span>&nbsp;<span class="num" id="3162357">0</span>&nbsp;<span class="op" id="3162359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3162367">bits</span><span class="op" id="3162371">,</span>&nbsp;<span class="ident" id="3162373">err</span>&nbsp;<span class="op" id="3162377">:=</span>&nbsp;<span class="ident" id="3162380"><a href="/image/jpeg/scan.go.html#3161661">d</a></span><span class="op" id="3162381">.</span><span class="ident" id="3162382">decodeBits</span><span class="op" id="3162392">(</span><span class="builtintype" id="3162393">int32</span><span class="op" id="3162398">(</span><span class="ident" id="3162399"><a href="/image/jpeg/scan.go.html#3162213">val0</a></span><span class="op" id="3162403">)</span><span class="op" id="3162404">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3162412">if</span>&nbsp;<span class="ident" id="3162415"><a href="/image/jpeg/scan.go.html#3162373">err</a></span>&nbsp;<span class="op" id="3162419">!=</span>&nbsp;<span class="ident" id="3162422">nil</span>&nbsp;<span class="op" id="3162426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3162435">return</span>&nbsp;<span class="ident" id="3162442"><a href="/image/jpeg/scan.go.html#3162373">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3162452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3162460"><a href="/image/jpeg/scan.go.html#3161661">d</a></span><span class="op" id="3162461">.</span><span class="ident" id="3162462">eobRun</span>&nbsp;<span class="op" id="3162469">|=</span>&nbsp;<span class="builtintype" id="3162472">uint16</span><span class="op" id="3162478">(</span><span class="ident" id="3162479"><a href="/image/jpeg/scan.go.html#3162367">bits</a></span><span class="op" id="3162483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3162490">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3162497">break</span>&nbsp;<span class="ident" id="3162503">loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3162512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3162517">case</span>&nbsp;<span class="num" id="3162522">1</span><span class="op" id="3162523">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3162529"><a href="/image/jpeg/scan.go.html#3162121">z</a></span>&nbsp;<span class="op" id="3162531">=</span>&nbsp;<span class="ident" id="3162533"><a href="/image/jpeg/scan.go.html#3161720">delta</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3162543">bit</span><span class="op" id="3162546">,</span>&nbsp;<span class="ident" id="3162548">err</span>&nbsp;<span class="op" id="3162552">:=</span>&nbsp;<span class="ident" id="3162555"><a href="/image/jpeg/scan.go.html#3161661">d</a></span><span class="op" id="3162556">.</span><span class="ident" id="3162557">decodeBit</span><span class="op" id="3162566">(</span><span class="op" id="3162567">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3162573">if</span>&nbsp;<span class="ident" id="3162576"><a href="/image/jpeg/scan.go.html#3162548">err</a></span>&nbsp;<span class="op" id="3162580">!=</span>&nbsp;<span class="ident" id="3162583">nil</span>&nbsp;<span class="op" id="3162587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3162594">return</span>&nbsp;<span class="ident" id="3162601"><a href="/image/jpeg/scan.go.html#3162548">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3162609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3162615">if</span>&nbsp;<span class="op" id="3162618">!</span><span class="ident" id="3162619"><a href="/image/jpeg/scan.go.html#3162543">bit</a></span>&nbsp;<span class="op" id="3162623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3162630"><a href="/image/jpeg/scan.go.html#3162121">z</a></span>&nbsp;<span class="op" id="3162632">=</span>&nbsp;<span class="op" id="3162634">-</span><span class="ident" id="3162635"><a href="/image/jpeg/scan.go.html#3162121">z</a></span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3162641">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3162646">default</span><span class="op" id="3162653">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3162659">return</span>&nbsp;<span class="ident" id="3162666"><a href="/image/jpeg/reader.go.html#3135984">FormatError</a></span><span class="op" id="3162677">(</span><span class="string" id="3162678">&#34;unexpected&nbsp;Huffman&nbsp;code&#34;</span><span class="op" id="3162703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3162708">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3162714"><a href="/image/jpeg/scan.go.html#3162044">zig</a></span><span class="op" id="3162717">,</span>&nbsp;<span class="ident" id="3162719"><a href="/image/jpeg/scan.go.html#3162145">err</a></span>&nbsp;<span class="op" id="3162723">=</span>&nbsp;<span class="ident" id="3162725"><a href="/image/jpeg/scan.go.html#3161661">d</a></span><span class="op" id="3162726">.</span><span class="ident" id="3162727">refineNonZeroes</span><span class="op" id="3162742">(</span><span class="ident" id="3162743"><a href="/image/jpeg/scan.go.html#3161680">b</a></span><span class="op" id="3162744">,</span>&nbsp;<span class="ident" id="3162746"><a href="/image/jpeg/scan.go.html#3162044">zig</a></span><span class="op" id="3162749">,</span>&nbsp;<span class="ident" id="3162751"><a href="/image/jpeg/scan.go.html#3161712">zigEnd</a></span><span class="op" id="3162757">,</span>&nbsp;<span class="builtintype" id="3162759">int32</span><span class="op" id="3162764">(</span><span class="ident" id="3162765"><a href="/image/jpeg/scan.go.html#3162213">val0</a></span><span class="op" id="3162769">)</span><span class="op" id="3162770">,</span>&nbsp;<span class="ident" id="3162772"><a href="/image/jpeg/scan.go.html#3161720">delta</a></span><span class="op" id="3162777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3162782">if</span>&nbsp;<span class="ident" id="3162785"><a href="/image/jpeg/scan.go.html#3162145">err</a></span>&nbsp;<span class="op" id="3162789">!=</span>&nbsp;<span class="ident" id="3162792">nil</span>&nbsp;<span class="op" id="3162796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3162802">return</span>&nbsp;<span class="ident" id="3162809"><a href="/image/jpeg/scan.go.html#3162145">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3162816">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3162821">if</span>&nbsp;<span class="ident" id="3162824"><a href="/image/jpeg/scan.go.html#3162044">zig</a></span>&nbsp;<span class="op" id="3162828">&gt;</span>&nbsp;<span class="ident" id="3162830"><a href="/image/jpeg/scan.go.html#3161712">zigEnd</a></span>&nbsp;<span class="op" id="3162837">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3162843">return</span>&nbsp;<span class="ident" id="3162850"><a href="/image/jpeg/reader.go.html#3135984">FormatError</a></span><span class="op" id="3162861">(</span><span class="string" id="3162862">&#34;too&nbsp;many&nbsp;coefficients&#34;</span><span class="op" id="3162885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3162890">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3162895">if</span>&nbsp;<span class="ident" id="3162898"><a href="/image/jpeg/scan.go.html#3162121">z</a></span>&nbsp;<span class="op" id="3162900">!=</span>&nbsp;<span class="num" id="3162903">0</span>&nbsp;<span class="op" id="3162905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3162911"><a href="/image/jpeg/scan.go.html#3161680">b</a></span><span class="op" id="3162912">[</span><span class="ident" id="3162913"><a href="/image/jpeg/reader.go.html#3137806">unzig</a></span><span class="op" id="3162918">[</span><span class="ident" id="3162919"><a href="/image/jpeg/scan.go.html#3162044">zig</a></span><span class="op" id="3162922">]</span><span class="op" id="3162923">]</span>&nbsp;<span class="op" id="3162925">=</span>&nbsp;<span class="ident" id="3162927"><a href="/image/jpeg/scan.go.html#3162121">z</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3162932">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3162936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3162939">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3162942">if</span>&nbsp;<span class="ident" id="3162945"><a href="/image/jpeg/scan.go.html#3161661">d</a></span><span class="op" id="3162946">.</span><span class="ident" id="3162947">eobRun</span>&nbsp;<span class="op" id="3162954">&gt;</span>&nbsp;<span class="num" id="3162956">0</span>&nbsp;<span class="op" id="3162958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3162962"><a href="/image/jpeg/scan.go.html#3161661">d</a></span><span class="op" id="3162963">.</span><span class="ident" id="3162964">eobRun</span><span class="op" id="3162970">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3162975">if</span>&nbsp;<span class="ident" id="3162978">_</span><span class="op" id="3162979">,</span>&nbsp;<span class="ident" id="3162981">err</span>&nbsp;<span class="op" id="3162985">:=</span>&nbsp;<span class="ident" id="3162988"><a href="/image/jpeg/scan.go.html#3161661">d</a></span><span class="op" id="3162989">.</span><span class="ident" id="3162990">refineNonZeroes</span><span class="op" id="3163005">(</span><span class="ident" id="3163006"><a href="/image/jpeg/scan.go.html#3161680">b</a></span><span class="op" id="3163007">,</span>&nbsp;<span class="ident" id="3163009"><a href="/image/jpeg/scan.go.html#3162044">zig</a></span><span class="op" id="3163012">,</span>&nbsp;<span class="ident" id="3163014"><a href="/image/jpeg/scan.go.html#3161712">zigEnd</a></span><span class="op" id="3163020">,</span>&nbsp;<span class="op" id="3163022">-</span><span class="num" id="3163023">1</span><span class="op" id="3163024">,</span>&nbsp;<span class="ident" id="3163026"><a href="/image/jpeg/scan.go.html#3161720">delta</a></span><span class="op" id="3163031">)</span><span class="op" id="3163032">;</span>&nbsp;<span class="ident" id="3163034"><a href="/image/jpeg/scan.go.html#3162981">err</a></span>&nbsp;<span class="op" id="3163038">!=</span>&nbsp;<span class="ident" id="3163041">nil</span>&nbsp;<span class="op" id="3163045">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3163050">return</span>&nbsp;<span class="ident" id="3163057"><a href="/image/jpeg/scan.go.html#3162981">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3163063">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3163066">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3163069">return</span>&nbsp;<span class="ident" id="3163076">nil</span><br>
<span class="lineno"></span><span class="op" id="3163080">}</span><br>
<span class="lineno">415</span><br>
<span class="lineno"></span><span class="comment" id="3163083">//&nbsp;refineNonZeroes&nbsp;refines&nbsp;non-zero&nbsp;entries&nbsp;of&nbsp;b&nbsp;in&nbsp;zig-zag&nbsp;order.&nbsp;If&nbsp;nz&nbsp;&gt;=&nbsp;0,</span><br>
<span class="lineno"></span><span class="comment" id="3163162">//&nbsp;the&nbsp;first&nbsp;nz&nbsp;zero&nbsp;entries&nbsp;are&nbsp;skipped&nbsp;over.</span><br>
<span class="lineno"></span><span class="keyword" id="3163209">func</span>&nbsp;<span class="op" id="3163214">(</span><span class="ident" id="3163215">d</span>&nbsp;<span class="op" id="3163217">*</span><span class="ident" id="3163218"><a href="/image/jpeg/reader.go.html#3138497">decoder</a></span><span class="op" id="3163225">)</span>&nbsp;<span class="ident" id="3163227">refineNonZeroes</span><span class="op" id="3163242">(</span><span class="ident" id="3163243">b</span>&nbsp;<span class="op" id="3163245">*</span><span class="ident" id="3163246"><a href="/image/jpeg/idct.go.html#3131942">block</a></span><span class="op" id="3163251">,</span>&nbsp;<span class="ident" id="3163253">zig</span><span class="op" id="3163256">,</span>&nbsp;<span class="ident" id="3163258">zigEnd</span><span class="op" id="3163264">,</span>&nbsp;<span class="ident" id="3163266">nz</span><span class="op" id="3163268">,</span>&nbsp;<span class="ident" id="3163270">delta</span>&nbsp;<span class="builtintype" id="3163276">int32</span><span class="op" id="3163281">)</span>&nbsp;<span class="op" id="3163283">(</span><span class="builtintype" id="3163284">int32</span><span class="op" id="3163289">,</span>&nbsp;<span class="builtintype" id="3163291">error</span><span class="op" id="3163296">)</span>&nbsp;<span class="op" id="3163298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3163301">for</span>&nbsp;<span class="op" id="3163305">;</span>&nbsp;<span class="ident" id="3163307"><a href="/image/jpeg/scan.go.html#3163253">zig</a></span>&nbsp;<span class="op" id="3163311">&lt;=</span>&nbsp;<span class="ident" id="3163314"><a href="/image/jpeg/scan.go.html#3163258">zigEnd</a></span><span class="op" id="3163320">;</span>&nbsp;<span class="ident" id="3163322"><a href="/image/jpeg/scan.go.html#3163253">zig</a></span><span class="op" id="3163325">++</span>&nbsp;<span class="op" id="3163328">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3163332">u</span>&nbsp;<span class="op" id="3163334">:=</span>&nbsp;<span class="ident" id="3163337"><a href="/image/jpeg/reader.go.html#3137806">unzig</a></span><span class="op" id="3163342">[</span><span class="ident" id="3163343"><a href="/image/jpeg/scan.go.html#3163253">zig</a></span><span class="op" id="3163346">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3163350">if</span>&nbsp;<span class="ident" id="3163353"><a href="/image/jpeg/scan.go.html#3163243">b</a></span><span class="op" id="3163354">[</span><span class="ident" id="3163355"><a href="/image/jpeg/scan.go.html#3163332">u</a></span><span class="op" id="3163356">]</span>&nbsp;<span class="op" id="3163358">==</span>&nbsp;<span class="num" id="3163361">0</span>&nbsp;<span class="op" id="3163363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3163368">if</span>&nbsp;<span class="ident" id="3163371"><a href="/image/jpeg/scan.go.html#3163266">nz</a></span>&nbsp;<span class="op" id="3163374">==</span>&nbsp;<span class="num" id="3163377">0</span>&nbsp;<span class="op" id="3163379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3163385">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3163394">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3163399"><a href="/image/jpeg/scan.go.html#3163266">nz</a></span><span class="op" id="3163401">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3163407">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3163418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3163422">bit</span><span class="op" id="3163425">,</span>&nbsp;<span class="ident" id="3163427">err</span>&nbsp;<span class="op" id="3163431">:=</span>&nbsp;<span class="ident" id="3163434"><a href="/image/jpeg/scan.go.html#3163215">d</a></span><span class="op" id="3163435">.</span><span class="ident" id="3163436">decodeBit</span><span class="op" id="3163445">(</span><span class="op" id="3163446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3163450">if</span>&nbsp;<span class="ident" id="3163453"><a href="/image/jpeg/scan.go.html#3163427">err</a></span>&nbsp;<span class="op" id="3163457">!=</span>&nbsp;<span class="ident" id="3163460">nil</span>&nbsp;<span class="op" id="3163464">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3163469">return</span>&nbsp;<span class="num" id="3163476">0</span><span class="op" id="3163477">,</span>&nbsp;<span class="ident" id="3163479"><a href="/image/jpeg/scan.go.html#3163427">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3163485">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3163489">if</span>&nbsp;<span class="op" id="3163492">!</span><span class="ident" id="3163493"><a href="/image/jpeg/scan.go.html#3163422">bit</a></span>&nbsp;<span class="op" id="3163497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3163502">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3163513">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3163517">if</span>&nbsp;<span class="ident" id="3163520"><a href="/image/jpeg/scan.go.html#3163243">b</a></span><span class="op" id="3163521">[</span><span class="ident" id="3163522"><a href="/image/jpeg/scan.go.html#3163332">u</a></span><span class="op" id="3163523">]</span>&nbsp;<span class="op" id="3163525">&gt;=</span>&nbsp;<span class="num" id="3163528">0</span>&nbsp;<span class="op" id="3163530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3163535"><a href="/image/jpeg/scan.go.html#3163243">b</a></span><span class="op" id="3163536">[</span><span class="ident" id="3163537"><a href="/image/jpeg/scan.go.html#3163332">u</a></span><span class="op" id="3163538">]</span>&nbsp;<span class="op" id="3163540">+=</span>&nbsp;<span class="ident" id="3163543"><a href="/image/jpeg/scan.go.html#3163270">delta</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3163551">}</span>&nbsp;<span class="keyword" id="3163553">else</span>&nbsp;<span class="op" id="3163558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3163563"><a href="/image/jpeg/scan.go.html#3163243">b</a></span><span class="op" id="3163564">[</span><span class="ident" id="3163565"><a href="/image/jpeg/scan.go.html#3163332">u</a></span><span class="op" id="3163566">]</span>&nbsp;<span class="op" id="3163568">-=</span>&nbsp;<span class="ident" id="3163571"><a href="/image/jpeg/scan.go.html#3163270">delta</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3163579">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3163582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3163585">return</span>&nbsp;<span class="ident" id="3163592"><a href="/image/jpeg/scan.go.html#3163253">zig</a></span><span class="op" id="3163595">,</span>&nbsp;<span class="ident" id="3163597">nil</span><br>
<span class="lineno"></span><span class="op" id="3163601">}</span>
</div>
</body>
</html>
