<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/cookiejar</h2>
<ul>
<li><a href="/gostd/net/http/cookiejar/jar.go.html">jar.go</a></li>
<li><a href="/gostd/net/http/cookiejar/jar_test.go.html">jar_test.go</a></li>
<li><a href="/gostd/net/http/cookiejar/punycode.go.html">punycode.go</a></li>
<li><a href="/gostd/net/http/cookiejar/punycode_test.go.html">punycode_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6174300">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6174355">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6174409">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6174460">//&nbsp;Package&nbsp;cookiejar&nbsp;implements&nbsp;an&nbsp;in-memory&nbsp;RFC&nbsp;6265-compliant&nbsp;http.CookieJar.</span><br>
<span class="lineno"></span><span class="keyword" id="6174540">package</span>&nbsp;<span class="ident" id="6174548">cookiejar</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6174559">import</span>&nbsp;<span class="op" id="6174566">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6174569">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6174579">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6174586">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6174593">&#34;net/http&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6174605">&#34;net/url&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6174616">&#34;sort&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6174624">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6174635">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6174643">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6174650">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="6174653">//&nbsp;PublicSuffixList&nbsp;provides&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;a&nbsp;domain.&nbsp;For&nbsp;example:</span><br>
<span class="lineno"></span><span class="comment" id="6174726">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;&#34;example.com&#34;&nbsp;is&nbsp;&#34;com&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="6174781">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;&#34;foo1.foo2.foo3.co.uk&#34;&nbsp;is&nbsp;&#34;co.uk&#34;,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="6174851">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;&#34;bar.pvt.k12.ma.us&#34;&nbsp;is&nbsp;&#34;pvt.k12.ma.us&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="6174922">//</span><br>
<span class="lineno">25</span><span class="comment" id="6174925">//&nbsp;Implementations&nbsp;of&nbsp;PublicSuffixList&nbsp;must&nbsp;be&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="6174999">//&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="comment" id="6175023">//</span><br>
<span class="lineno"></span><span class="comment" id="6175026">//&nbsp;An&nbsp;implementation&nbsp;that&nbsp;always&nbsp;returns&nbsp;&#34;&#34;&nbsp;is&nbsp;valid&nbsp;and&nbsp;may&nbsp;be&nbsp;useful&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="6175101">//&nbsp;testing&nbsp;but&nbsp;it&nbsp;is&nbsp;not&nbsp;secure:&nbsp;it&nbsp;means&nbsp;that&nbsp;the&nbsp;HTTP&nbsp;server&nbsp;for&nbsp;foo.com&nbsp;can</span><br>
<span class="lineno">30</span><span class="comment" id="6175180">//&nbsp;set&nbsp;a&nbsp;cookie&nbsp;for&nbsp;bar.com.</span><br>
<span class="lineno"></span><span class="comment" id="6175209">//</span><br>
<span class="lineno"></span><span class="comment" id="6175212">//&nbsp;A&nbsp;public&nbsp;suffix&nbsp;list&nbsp;implementation&nbsp;is&nbsp;in&nbsp;the&nbsp;package</span><br>
<span class="lineno"></span><span class="comment" id="6175269">//&nbsp;golang.org/x/net/publicsuffix.</span><br>
<span class="lineno"></span><span class="keyword" id="6175303">type</span>&nbsp;<span class="ident" id="6175308">PublicSuffixList</span>&nbsp;<span class="keyword" id="6175325">interface</span>&nbsp;<span class="op" id="6175335">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6175338">//&nbsp;PublicSuffix&nbsp;returns&nbsp;the&nbsp;public&nbsp;suffix&nbsp;of&nbsp;domain.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6175392">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6175396">//&nbsp;TODO:&nbsp;specify&nbsp;which&nbsp;of&nbsp;the&nbsp;caller&nbsp;and&nbsp;callee&nbsp;is&nbsp;responsible&nbsp;for&nbsp;IP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6175467">//&nbsp;addresses,&nbsp;for&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;dots,&nbsp;for&nbsp;case&nbsp;sensitivity,&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6175539">//&nbsp;for&nbsp;IDN/Punycode.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6175561">PublicSuffix</span><span class="op" id="6175573">(</span><span class="ident" id="6175574">domain</span>&nbsp;<span class="builtintype" id="6175581">string</span><span class="op" id="6175587">)</span>&nbsp;<span class="builtintype" id="6175589">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6175598">//&nbsp;String&nbsp;returns&nbsp;a&nbsp;description&nbsp;of&nbsp;the&nbsp;source&nbsp;of&nbsp;this&nbsp;public&nbsp;suffix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6175667">//&nbsp;list.&nbsp;The&nbsp;description&nbsp;will&nbsp;typically&nbsp;contain&nbsp;something&nbsp;like&nbsp;a&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6175738">//&nbsp;stamp&nbsp;or&nbsp;version&nbsp;number.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6175767">String</span><span class="op" id="6175773">(</span><span class="op" id="6175774">)</span>&nbsp;<span class="builtintype" id="6175776">string</span><br>
<span class="lineno"></span><span class="op" id="6175783">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6175786">//&nbsp;Options&nbsp;are&nbsp;the&nbsp;options&nbsp;for&nbsp;creating&nbsp;a&nbsp;new&nbsp;Jar.</span><br>
<span class="lineno"></span><span class="keyword" id="6175837">type</span>&nbsp;<span class="ident" id="6175842">Options</span>&nbsp;<span class="keyword" id="6175850">struct</span>&nbsp;<span class="op" id="6175857">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6175860">//&nbsp;PublicSuffixList&nbsp;is&nbsp;the&nbsp;public&nbsp;suffix&nbsp;list&nbsp;that&nbsp;determines&nbsp;whether</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6175931">//&nbsp;an&nbsp;HTTP&nbsp;server&nbsp;can&nbsp;set&nbsp;a&nbsp;cookie&nbsp;for&nbsp;a&nbsp;domain.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6175981">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6175985">//&nbsp;A&nbsp;nil&nbsp;value&nbsp;is&nbsp;valid&nbsp;and&nbsp;may&nbsp;be&nbsp;useful&nbsp;for&nbsp;testing&nbsp;but&nbsp;it&nbsp;is&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6176054">//&nbsp;secure:&nbsp;it&nbsp;means&nbsp;that&nbsp;the&nbsp;HTTP&nbsp;server&nbsp;for&nbsp;foo.co.uk&nbsp;can&nbsp;set&nbsp;a&nbsp;cookie</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6176127">//&nbsp;for&nbsp;bar.co.uk.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6176146">PublicSuffixList</span>&nbsp;<span class="ident" id="6176163">PublicSuffixList</span><br>
<span class="lineno"></span><span class="op" id="6176180">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6176183">//&nbsp;Jar&nbsp;implements&nbsp;the&nbsp;http.CookieJar&nbsp;interface&nbsp;from&nbsp;the&nbsp;net/http&nbsp;package.</span><br>
<span class="lineno">60</span><span class="keyword" id="6176257">type</span>&nbsp;<span class="ident" id="6176262">Jar</span>&nbsp;<span class="keyword" id="6176266">struct</span>&nbsp;<span class="op" id="6176273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6176276">psList</span>&nbsp;<span class="ident" id="6176283">PublicSuffixList</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6176302">//&nbsp;mu&nbsp;locks&nbsp;the&nbsp;remaining&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6176337">mu</span>&nbsp;<span class="ident" id="6176340">sync</span><span class="op" id="6176344">.</span><span class="ident" id="6176345">Mutex</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6176353">//&nbsp;entries&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;entries,&nbsp;keyed&nbsp;by&nbsp;their&nbsp;eTLD+1&nbsp;and&nbsp;subkeyed&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6176424">//&nbsp;their&nbsp;name/domain/path.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6176452">entries</span>&nbsp;<span class="keyword" id="6176460">map</span><span class="op" id="6176463">[</span><span class="builtintype" id="6176464">string</span><span class="op" id="6176470">]</span><span class="keyword" id="6176471">map</span><span class="op" id="6176474">[</span><span class="builtintype" id="6176475">string</span><span class="op" id="6176481">]</span><span class="ident" id="6176482">entry</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6176490">//&nbsp;nextSeqNum&nbsp;is&nbsp;the&nbsp;next&nbsp;sequence&nbsp;number&nbsp;assigned&nbsp;to&nbsp;a&nbsp;new&nbsp;cookie</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6176558">//&nbsp;created&nbsp;SetCookies.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6176582">nextSeqNum</span>&nbsp;<span class="ident" id="6176593">uint64</span><br>
<span class="lineno"></span><span class="op" id="6176600">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="comment" id="6176603">//&nbsp;New&nbsp;returns&nbsp;a&nbsp;new&nbsp;cookie&nbsp;jar.&nbsp;A&nbsp;nil&nbsp;*Options&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;a&nbsp;zero</span><br>
<span class="lineno"></span><span class="comment" id="6176675">//&nbsp;Options.</span><br>
<span class="lineno"></span><span class="keyword" id="6176687">func</span>&nbsp;<span class="ident" id="6176692">New</span><span class="op" id="6176695">(</span><span class="ident" id="6176696">o</span>&nbsp;<span class="op" id="6176698">*</span><span class="ident" id="6176699">Options</span><span class="op" id="6176706">)</span>&nbsp;<span class="op" id="6176708">(</span><span class="op" id="6176709">*</span><span class="ident" id="6176710">Jar</span><span class="op" id="6176713">,</span>&nbsp;<span class="builtintype" id="6176715">error</span><span class="op" id="6176720">)</span>&nbsp;<span class="op" id="6176722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6176725">jar</span>&nbsp;<span class="op" id="6176729">:=</span>&nbsp;<span class="op" id="6176732">&amp;</span><span class="ident" id="6176733">Jar</span><span class="op" id="6176736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6176740">entries</span><span class="op" id="6176747">:</span>&nbsp;<span class="builtinfunc" id="6176749">make</span><span class="op" id="6176753">(</span><span class="keyword" id="6176754">map</span><span class="op" id="6176757">[</span><span class="builtintype" id="6176758">string</span><span class="op" id="6176764">]</span><span class="keyword" id="6176765">map</span><span class="op" id="6176768">[</span><span class="builtintype" id="6176769">string</span><span class="op" id="6176775">]</span><span class="ident" id="6176776">entry</span><span class="op" id="6176781">)</span><span class="op" id="6176782">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6176785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6176788">if</span>&nbsp;<span class="ident" id="6176791">o</span>&nbsp;<span class="op" id="6176793">!=</span>&nbsp;<span class="ident" id="6176796">nil</span>&nbsp;<span class="op" id="6176800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6176804">jar</span><span class="op" id="6176807">.</span><span class="ident" id="6176808">psList</span>&nbsp;<span class="op" id="6176815">=</span>&nbsp;<span class="ident" id="6176817">o</span><span class="op" id="6176818">.</span><span class="ident" id="6176819">PublicSuffixList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6176837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6176840">return</span>&nbsp;<span class="ident" id="6176847">jar</span><span class="op" id="6176850">,</span>&nbsp;<span class="ident" id="6176852">nil</span><br>
<span class="lineno">85</span><span class="op" id="6176856">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6176859">//&nbsp;entry&nbsp;is&nbsp;the&nbsp;internal&nbsp;representation&nbsp;of&nbsp;a&nbsp;cookie.</span><br>
<span class="lineno"></span><span class="comment" id="6176912">//</span><br>
<span class="lineno"></span><span class="comment" id="6176915">//&nbsp;This&nbsp;struct&nbsp;type&nbsp;is&nbsp;not&nbsp;used&nbsp;outside&nbsp;of&nbsp;this&nbsp;package&nbsp;per&nbsp;se,&nbsp;but&nbsp;the&nbsp;exported</span><br>
<span class="lineno">90</span><span class="comment" id="6176996">//&nbsp;fields&nbsp;are&nbsp;those&nbsp;of&nbsp;RFC&nbsp;6265.</span><br>
<span class="lineno"></span><span class="keyword" id="6177029">type</span>&nbsp;<span class="ident" id="6177034">entry</span>&nbsp;<span class="keyword" id="6177040">struct</span>&nbsp;<span class="op" id="6177047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6177050">Name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6177061">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6177069">Value</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6177080">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6177088">Domain</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6177099">string</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6177107">Path</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6177118">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6177126">Secure</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6177137">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6177143">HttpOnly</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6177154">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6177160">Persistent</span>&nbsp;<span class="builtintype" id="6177171">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6177177">HostOnly</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6177188">bool</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6177194">Expires</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6177205">time</span><span class="op" id="6177209">.</span><span class="ident" id="6177210">Time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6177216">Creation</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6177227">time</span><span class="op" id="6177231">.</span><span class="ident" id="6177232">Time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6177238">LastAccess</span>&nbsp;<span class="ident" id="6177249">time</span><span class="op" id="6177253">.</span><span class="ident" id="6177254">Time</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6177261">//&nbsp;seqNum&nbsp;is&nbsp;a&nbsp;sequence&nbsp;number&nbsp;so&nbsp;that&nbsp;Cookies&nbsp;returns&nbsp;cookies&nbsp;in&nbsp;a</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6177330">//&nbsp;deterministic&nbsp;order,&nbsp;even&nbsp;for&nbsp;cookies&nbsp;that&nbsp;have&nbsp;equal&nbsp;Path&nbsp;length&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6177404">//&nbsp;equal&nbsp;Creation&nbsp;time.&nbsp;This&nbsp;simplifies&nbsp;testing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6177454">seqNum</span>&nbsp;<span class="ident" id="6177461">uint64</span><br>
<span class="lineno"></span><span class="op" id="6177468">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="6177471">//&nbsp;Id&nbsp;returns&nbsp;the&nbsp;domain;path;name&nbsp;triple&nbsp;of&nbsp;e&nbsp;as&nbsp;an&nbsp;id.</span><br>
<span class="lineno"></span><span class="keyword" id="6177528">func</span>&nbsp;<span class="op" id="6177533">(</span><span class="ident" id="6177534">e</span>&nbsp;<span class="op" id="6177536">*</span><span class="ident" id="6177537">entry</span><span class="op" id="6177542">)</span>&nbsp;<span class="ident" id="6177544">id</span><span class="op" id="6177546">(</span><span class="op" id="6177547">)</span>&nbsp;<span class="builtintype" id="6177549">string</span>&nbsp;<span class="op" id="6177556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6177559">return</span>&nbsp;<span class="ident" id="6177566">fmt</span><span class="op" id="6177569">.</span><span class="ident" id="6177570">Sprintf</span><span class="op" id="6177577">(</span><span class="string" id="6177578">&#34;%s;%s;%s&#34;</span><span class="op" id="6177588">,</span>&nbsp;<span class="ident" id="6177590">e</span><span class="op" id="6177591">.</span><span class="ident" id="6177592">Domain</span><span class="op" id="6177598">,</span>&nbsp;<span class="ident" id="6177600">e</span><span class="op" id="6177601">.</span><span class="ident" id="6177602">Path</span><span class="op" id="6177606">,</span>&nbsp;<span class="ident" id="6177608">e</span><span class="op" id="6177609">.</span><span class="ident" id="6177610">Name</span><span class="op" id="6177614">)</span><br>
<span class="lineno"></span><span class="op" id="6177616">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="6177619">//&nbsp;shouldSend&nbsp;determines&nbsp;whether&nbsp;e&#39;s&nbsp;cookie&nbsp;qualifies&nbsp;to&nbsp;be&nbsp;included&nbsp;in&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="6177693">//&nbsp;request&nbsp;to&nbsp;host/path.&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;check&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6177768">//&nbsp;cookie&nbsp;is&nbsp;expired.</span><br>
<span class="lineno"></span><span class="keyword" id="6177790">func</span>&nbsp;<span class="op" id="6177795">(</span><span class="ident" id="6177796">e</span>&nbsp;<span class="op" id="6177798">*</span><span class="ident" id="6177799">entry</span><span class="op" id="6177804">)</span>&nbsp;<span class="ident" id="6177806">shouldSend</span><span class="op" id="6177816">(</span><span class="ident" id="6177817">https</span>&nbsp;<span class="builtintype" id="6177823">bool</span><span class="op" id="6177827">,</span>&nbsp;<span class="ident" id="6177829">host</span><span class="op" id="6177833">,</span>&nbsp;<span class="ident" id="6177835">path</span>&nbsp;<span class="builtintype" id="6177840">string</span><span class="op" id="6177846">)</span>&nbsp;<span class="builtintype" id="6177848">bool</span>&nbsp;<span class="op" id="6177853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6177856">return</span>&nbsp;<span class="ident" id="6177863">e</span><span class="op" id="6177864">.</span><span class="ident" id="6177865">domainMatch</span><span class="op" id="6177876">(</span><span class="ident" id="6177877">host</span><span class="op" id="6177881">)</span>&nbsp;<span class="op" id="6177883">&amp;&amp;</span>&nbsp;<span class="ident" id="6177886">e</span><span class="op" id="6177887">.</span><span class="ident" id="6177888">pathMatch</span><span class="op" id="6177897">(</span><span class="ident" id="6177898">path</span><span class="op" id="6177902">)</span>&nbsp;<span class="op" id="6177904">&amp;&amp;</span>&nbsp;<span class="op" id="6177907">(</span><span class="ident" id="6177908">https</span>&nbsp;<span class="op" id="6177914">||</span>&nbsp;<span class="op" id="6177917">!</span><span class="ident" id="6177918">e</span><span class="op" id="6177919">.</span><span class="ident" id="6177920">Secure</span><span class="op" id="6177926">)</span><br>
<span class="lineno">120</span><span class="op" id="6177928">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6177931">//&nbsp;domainMatch&nbsp;implements&nbsp;&#34;domain-match&#34;&nbsp;of&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.1.3.</span><br>
<span class="lineno"></span><span class="keyword" id="6177999">func</span>&nbsp;<span class="op" id="6178004">(</span><span class="ident" id="6178005">e</span>&nbsp;<span class="op" id="6178007">*</span><span class="ident" id="6178008">entry</span><span class="op" id="6178013">)</span>&nbsp;<span class="ident" id="6178015">domainMatch</span><span class="op" id="6178026">(</span><span class="ident" id="6178027">host</span>&nbsp;<span class="builtintype" id="6178032">string</span><span class="op" id="6178038">)</span>&nbsp;<span class="builtintype" id="6178040">bool</span>&nbsp;<span class="op" id="6178045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6178048">if</span>&nbsp;<span class="ident" id="6178051">e</span><span class="op" id="6178052">.</span><span class="ident" id="6178053">Domain</span>&nbsp;<span class="op" id="6178060">==</span>&nbsp;<span class="ident" id="6178063">host</span>&nbsp;<span class="op" id="6178068">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6178072">return</span>&nbsp;<span class="builtintype" id="6178079">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6178085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6178088">return</span>&nbsp;<span class="op" id="6178095">!</span><span class="ident" id="6178096">e</span><span class="op" id="6178097">.</span><span class="ident" id="6178098">HostOnly</span>&nbsp;<span class="op" id="6178107">&amp;&amp;</span>&nbsp;<span class="ident" id="6178110">hasDotSuffix</span><span class="op" id="6178122">(</span><span class="ident" id="6178123">host</span><span class="op" id="6178127">,</span>&nbsp;<span class="ident" id="6178129">e</span><span class="op" id="6178130">.</span><span class="ident" id="6178131">Domain</span><span class="op" id="6178137">)</span><br>
<span class="lineno"></span><span class="op" id="6178139">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="6178142">//&nbsp;pathMatch&nbsp;implements&nbsp;&#34;path-match&#34;&nbsp;according&nbsp;to&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.1.4.</span><br>
<span class="lineno"></span><span class="keyword" id="6178216">func</span>&nbsp;<span class="op" id="6178221">(</span><span class="ident" id="6178222">e</span>&nbsp;<span class="op" id="6178224">*</span><span class="ident" id="6178225">entry</span><span class="op" id="6178230">)</span>&nbsp;<span class="ident" id="6178232">pathMatch</span><span class="op" id="6178241">(</span><span class="ident" id="6178242">requestPath</span>&nbsp;<span class="builtintype" id="6178254">string</span><span class="op" id="6178260">)</span>&nbsp;<span class="builtintype" id="6178262">bool</span>&nbsp;<span class="op" id="6178267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6178270">if</span>&nbsp;<span class="ident" id="6178273">requestPath</span>&nbsp;<span class="op" id="6178285">==</span>&nbsp;<span class="ident" id="6178288">e</span><span class="op" id="6178289">.</span><span class="ident" id="6178290">Path</span>&nbsp;<span class="op" id="6178295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6178299">return</span>&nbsp;<span class="builtintype" id="6178306">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6178312">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6178315">if</span>&nbsp;<span class="ident" id="6178318">strings</span><span class="op" id="6178325">.</span><span class="ident" id="6178326">HasPrefix</span><span class="op" id="6178335">(</span><span class="ident" id="6178336">requestPath</span><span class="op" id="6178347">,</span>&nbsp;<span class="ident" id="6178349">e</span><span class="op" id="6178350">.</span><span class="ident" id="6178351">Path</span><span class="op" id="6178355">)</span>&nbsp;<span class="op" id="6178357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6178361">if</span>&nbsp;<span class="ident" id="6178364">e</span><span class="op" id="6178365">.</span><span class="ident" id="6178366">Path</span><span class="op" id="6178370">[</span><span class="builtinfunc" id="6178371">len</span><span class="op" id="6178374">(</span><span class="ident" id="6178375">e</span><span class="op" id="6178376">.</span><span class="ident" id="6178377">Path</span><span class="op" id="6178381">)</span><span class="op" id="6178382">-</span><span class="num" id="6178383">1</span><span class="op" id="6178384">]</span>&nbsp;<span class="op" id="6178386">==</span>&nbsp;<span class="string" id="6178389">&#39;/&#39;</span>&nbsp;<span class="op" id="6178393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6178398">return</span>&nbsp;<span class="builtintype" id="6178405">true</span>&nbsp;<span class="comment" id="6178410">//&nbsp;The&nbsp;&#34;/any/&#34;&nbsp;matches&nbsp;&#34;/any/path&#34;&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6178453">}</span>&nbsp;<span class="keyword" id="6178455">else</span>&nbsp;<span class="keyword" id="6178460">if</span>&nbsp;<span class="ident" id="6178463">requestPath</span><span class="op" id="6178474">[</span><span class="builtinfunc" id="6178475">len</span><span class="op" id="6178478">(</span><span class="ident" id="6178479">e</span><span class="op" id="6178480">.</span><span class="ident" id="6178481">Path</span><span class="op" id="6178485">)</span><span class="op" id="6178486">]</span>&nbsp;<span class="op" id="6178488">==</span>&nbsp;<span class="string" id="6178491">&#39;/&#39;</span>&nbsp;<span class="op" id="6178495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6178500">return</span>&nbsp;<span class="builtintype" id="6178507">true</span>&nbsp;<span class="comment" id="6178512">//&nbsp;The&nbsp;&#34;/any&#34;&nbsp;matches&nbsp;&#34;/any/path&#34;&nbsp;case.</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6178554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6178557">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6178560">return</span>&nbsp;<span class="builtintype" id="6178567">false</span><br>
<span class="lineno"></span><span class="op" id="6178573">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="comment" id="6178576">//&nbsp;hasDotSuffix&nbsp;reports&nbsp;whether&nbsp;s&nbsp;ends&nbsp;in&nbsp;&#34;.&#34;+suffix.</span><br>
<span class="lineno"></span><span class="keyword" id="6178630">func</span>&nbsp;<span class="ident" id="6178635">hasDotSuffix</span><span class="op" id="6178647">(</span><span class="ident" id="6178648">s</span><span class="op" id="6178649">,</span>&nbsp;<span class="ident" id="6178651">suffix</span>&nbsp;<span class="builtintype" id="6178658">string</span><span class="op" id="6178664">)</span>&nbsp;<span class="builtintype" id="6178666">bool</span>&nbsp;<span class="op" id="6178671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6178674">return</span>&nbsp;<span class="builtinfunc" id="6178681">len</span><span class="op" id="6178684">(</span><span class="ident" id="6178685">s</span><span class="op" id="6178686">)</span>&nbsp;<span class="op" id="6178688">&gt;</span>&nbsp;<span class="builtinfunc" id="6178690">len</span><span class="op" id="6178693">(</span><span class="ident" id="6178694">suffix</span><span class="op" id="6178700">)</span>&nbsp;<span class="op" id="6178702">&amp;&amp;</span>&nbsp;<span class="ident" id="6178705">s</span><span class="op" id="6178706">[</span><span class="builtinfunc" id="6178707">len</span><span class="op" id="6178710">(</span><span class="ident" id="6178711">s</span><span class="op" id="6178712">)</span><span class="op" id="6178713">-</span><span class="builtinfunc" id="6178714">len</span><span class="op" id="6178717">(</span><span class="ident" id="6178718">suffix</span><span class="op" id="6178724">)</span><span class="op" id="6178725">-</span><span class="num" id="6178726">1</span><span class="op" id="6178727">]</span>&nbsp;<span class="op" id="6178729">==</span>&nbsp;<span class="string" id="6178732">&#39;.&#39;</span>&nbsp;<span class="op" id="6178736">&amp;&amp;</span>&nbsp;<span class="ident" id="6178739">s</span><span class="op" id="6178740">[</span><span class="builtinfunc" id="6178741">len</span><span class="op" id="6178744">(</span><span class="ident" id="6178745">s</span><span class="op" id="6178746">)</span><span class="op" id="6178747">-</span><span class="builtinfunc" id="6178748">len</span><span class="op" id="6178751">(</span><span class="ident" id="6178752">suffix</span><span class="op" id="6178758">)</span><span class="op" id="6178759">:</span><span class="op" id="6178760">]</span>&nbsp;<span class="op" id="6178762">==</span>&nbsp;<span class="ident" id="6178765">suffix</span><br>
<span class="lineno"></span><span class="op" id="6178772">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="comment" id="6178775">//&nbsp;byPathLength&nbsp;is&nbsp;a&nbsp;[]entry&nbsp;sort.Interface&nbsp;that&nbsp;sorts&nbsp;according&nbsp;to&nbsp;RFC&nbsp;6265</span><br>
<span class="lineno"></span><span class="comment" id="6178852">//&nbsp;section&nbsp;5.4&nbsp;point&nbsp;2:&nbsp;by&nbsp;longest&nbsp;path&nbsp;and&nbsp;then&nbsp;by&nbsp;earliest&nbsp;creation&nbsp;time.</span><br>
<span class="lineno"></span><span class="keyword" id="6178928">type</span>&nbsp;<span class="ident" id="6178933">byPathLength</span>&nbsp;<span class="op" id="6178946">[</span><span class="op" id="6178947">]</span><span class="ident" id="6178948">entry</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6178955">func</span>&nbsp;<span class="op" id="6178960">(</span><span class="ident" id="6178961">s</span>&nbsp;<span class="ident" id="6178963">byPathLength</span><span class="op" id="6178975">)</span>&nbsp;<span class="ident" id="6178977">Len</span><span class="op" id="6178980">(</span><span class="op" id="6178981">)</span>&nbsp;<span class="builtintype" id="6178983">int</span>&nbsp;<span class="op" id="6178987">{</span>&nbsp;<span class="keyword" id="6178989">return</span>&nbsp;<span class="builtinfunc" id="6178996">len</span><span class="op" id="6178999">(</span><span class="ident" id="6179000">s</span><span class="op" id="6179001">)</span>&nbsp;<span class="op" id="6179003">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="keyword" id="6179006">func</span>&nbsp;<span class="op" id="6179011">(</span><span class="ident" id="6179012">s</span>&nbsp;<span class="ident" id="6179014">byPathLength</span><span class="op" id="6179026">)</span>&nbsp;<span class="ident" id="6179028">Less</span><span class="op" id="6179032">(</span><span class="ident" id="6179033">i</span><span class="op" id="6179034">,</span>&nbsp;<span class="ident" id="6179036">j</span>&nbsp;<span class="builtintype" id="6179038">int</span><span class="op" id="6179041">)</span>&nbsp;<span class="builtintype" id="6179043">bool</span>&nbsp;<span class="op" id="6179048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6179051">if</span>&nbsp;<span class="builtinfunc" id="6179054">len</span><span class="op" id="6179057">(</span><span class="ident" id="6179058">s</span><span class="op" id="6179059">[</span><span class="ident" id="6179060">i</span><span class="op" id="6179061">]</span><span class="op" id="6179062">.</span><span class="ident" id="6179063">Path</span><span class="op" id="6179067">)</span>&nbsp;<span class="op" id="6179069">!=</span>&nbsp;<span class="builtinfunc" id="6179072">len</span><span class="op" id="6179075">(</span><span class="ident" id="6179076">s</span><span class="op" id="6179077">[</span><span class="ident" id="6179078">j</span><span class="op" id="6179079">]</span><span class="op" id="6179080">.</span><span class="ident" id="6179081">Path</span><span class="op" id="6179085">)</span>&nbsp;<span class="op" id="6179087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6179091">return</span>&nbsp;<span class="builtinfunc" id="6179098">len</span><span class="op" id="6179101">(</span><span class="ident" id="6179102">s</span><span class="op" id="6179103">[</span><span class="ident" id="6179104">i</span><span class="op" id="6179105">]</span><span class="op" id="6179106">.</span><span class="ident" id="6179107">Path</span><span class="op" id="6179111">)</span>&nbsp;<span class="op" id="6179113">&gt;</span>&nbsp;<span class="builtinfunc" id="6179115">len</span><span class="op" id="6179118">(</span><span class="ident" id="6179119">s</span><span class="op" id="6179120">[</span><span class="ident" id="6179121">j</span><span class="op" id="6179122">]</span><span class="op" id="6179123">.</span><span class="ident" id="6179124">Path</span><span class="op" id="6179128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6179131">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6179134">if</span>&nbsp;<span class="op" id="6179137">!</span><span class="ident" id="6179138">s</span><span class="op" id="6179139">[</span><span class="ident" id="6179140">i</span><span class="op" id="6179141">]</span><span class="op" id="6179142">.</span><span class="ident" id="6179143">Creation</span><span class="op" id="6179151">.</span><span class="ident" id="6179152">Equal</span><span class="op" id="6179157">(</span><span class="ident" id="6179158">s</span><span class="op" id="6179159">[</span><span class="ident" id="6179160">j</span><span class="op" id="6179161">]</span><span class="op" id="6179162">.</span><span class="ident" id="6179163">Creation</span><span class="op" id="6179171">)</span>&nbsp;<span class="op" id="6179173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6179177">return</span>&nbsp;<span class="ident" id="6179184">s</span><span class="op" id="6179185">[</span><span class="ident" id="6179186">i</span><span class="op" id="6179187">]</span><span class="op" id="6179188">.</span><span class="ident" id="6179189">Creation</span><span class="op" id="6179197">.</span><span class="ident" id="6179198">Before</span><span class="op" id="6179204">(</span><span class="ident" id="6179205">s</span><span class="op" id="6179206">[</span><span class="ident" id="6179207">j</span><span class="op" id="6179208">]</span><span class="op" id="6179209">.</span><span class="ident" id="6179210">Creation</span><span class="op" id="6179218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6179221">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6179224">return</span>&nbsp;<span class="ident" id="6179231">s</span><span class="op" id="6179232">[</span><span class="ident" id="6179233">i</span><span class="op" id="6179234">]</span><span class="op" id="6179235">.</span><span class="ident" id="6179236">seqNum</span>&nbsp;<span class="op" id="6179243">&lt;</span>&nbsp;<span class="ident" id="6179245">s</span><span class="op" id="6179246">[</span><span class="ident" id="6179247">j</span><span class="op" id="6179248">]</span><span class="op" id="6179249">.</span><span class="ident" id="6179250">seqNum</span><br>
<span class="lineno"></span><span class="op" id="6179257">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="keyword" id="6179260">func</span>&nbsp;<span class="op" id="6179265">(</span><span class="ident" id="6179266">s</span>&nbsp;<span class="ident" id="6179268">byPathLength</span><span class="op" id="6179280">)</span>&nbsp;<span class="ident" id="6179282">Swap</span><span class="op" id="6179286">(</span><span class="ident" id="6179287">i</span><span class="op" id="6179288">,</span>&nbsp;<span class="ident" id="6179290">j</span>&nbsp;<span class="builtintype" id="6179292">int</span><span class="op" id="6179295">)</span>&nbsp;<span class="op" id="6179297">{</span>&nbsp;<span class="ident" id="6179299">s</span><span class="op" id="6179300">[</span><span class="ident" id="6179301">i</span><span class="op" id="6179302">]</span><span class="op" id="6179303">,</span>&nbsp;<span class="ident" id="6179305">s</span><span class="op" id="6179306">[</span><span class="ident" id="6179307">j</span><span class="op" id="6179308">]</span>&nbsp;<span class="op" id="6179310">=</span>&nbsp;<span class="ident" id="6179312">s</span><span class="op" id="6179313">[</span><span class="ident" id="6179314">j</span><span class="op" id="6179315">]</span><span class="op" id="6179316">,</span>&nbsp;<span class="ident" id="6179318">s</span><span class="op" id="6179319">[</span><span class="ident" id="6179320">i</span><span class="op" id="6179321">]</span>&nbsp;<span class="op" id="6179323">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6179326">//&nbsp;Cookies&nbsp;implements&nbsp;the&nbsp;Cookies&nbsp;method&nbsp;of&nbsp;the&nbsp;http.CookieJar&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="6179400">//</span><br>
<span class="lineno">170</span><span class="comment" id="6179403">//&nbsp;It&nbsp;returns&nbsp;an&nbsp;empty&nbsp;slice&nbsp;if&nbsp;the&nbsp;URL&#39;s&nbsp;scheme&nbsp;is&nbsp;not&nbsp;HTTP&nbsp;or&nbsp;HTTPS.</span><br>
<span class="lineno"></span><span class="keyword" id="6179474">func</span>&nbsp;<span class="op" id="6179479">(</span><span class="ident" id="6179480">j</span>&nbsp;<span class="op" id="6179482">*</span><span class="ident" id="6179483">Jar</span><span class="op" id="6179486">)</span>&nbsp;<span class="ident" id="6179488">Cookies</span><span class="op" id="6179495">(</span><span class="ident" id="6179496">u</span>&nbsp;<span class="op" id="6179498">*</span><span class="ident" id="6179499">url</span><span class="op" id="6179502">.</span><span class="ident" id="6179503">URL</span><span class="op" id="6179506">)</span>&nbsp;<span class="op" id="6179508">(</span><span class="ident" id="6179509">cookies</span>&nbsp;<span class="op" id="6179517">[</span><span class="op" id="6179518">]</span><span class="op" id="6179519">*</span><span class="ident" id="6179520">http</span><span class="op" id="6179524">.</span><span class="ident" id="6179525">Cookie</span><span class="op" id="6179531">)</span>&nbsp;<span class="op" id="6179533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6179536">return</span>&nbsp;<span class="ident" id="6179543">j</span><span class="op" id="6179544">.</span><span class="ident" id="6179545">cookies</span><span class="op" id="6179552">(</span><span class="ident" id="6179553">u</span><span class="op" id="6179554">,</span>&nbsp;<span class="ident" id="6179556">time</span><span class="op" id="6179560">.</span><span class="ident" id="6179561">Now</span><span class="op" id="6179564">(</span><span class="op" id="6179565">)</span><span class="op" id="6179566">)</span><br>
<span class="lineno"></span><span class="op" id="6179568">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="6179571">//&nbsp;cookies&nbsp;is&nbsp;like&nbsp;Cookies&nbsp;but&nbsp;takes&nbsp;the&nbsp;current&nbsp;time&nbsp;as&nbsp;a&nbsp;parameter.</span><br>
<span class="lineno"></span><span class="keyword" id="6179641">func</span>&nbsp;<span class="op" id="6179646">(</span><span class="ident" id="6179647">j</span>&nbsp;<span class="op" id="6179649">*</span><span class="ident" id="6179650">Jar</span><span class="op" id="6179653">)</span>&nbsp;<span class="ident" id="6179655">cookies</span><span class="op" id="6179662">(</span><span class="ident" id="6179663">u</span>&nbsp;<span class="op" id="6179665">*</span><span class="ident" id="6179666">url</span><span class="op" id="6179669">.</span><span class="ident" id="6179670">URL</span><span class="op" id="6179673">,</span>&nbsp;<span class="ident" id="6179675">now</span>&nbsp;<span class="ident" id="6179679">time</span><span class="op" id="6179683">.</span><span class="ident" id="6179684">Time</span><span class="op" id="6179688">)</span>&nbsp;<span class="op" id="6179690">(</span><span class="ident" id="6179691">cookies</span>&nbsp;<span class="op" id="6179699">[</span><span class="op" id="6179700">]</span><span class="op" id="6179701">*</span><span class="ident" id="6179702">http</span><span class="op" id="6179706">.</span><span class="ident" id="6179707">Cookie</span><span class="op" id="6179713">)</span>&nbsp;<span class="op" id="6179715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6179718">if</span>&nbsp;<span class="ident" id="6179721">u</span><span class="op" id="6179722">.</span><span class="ident" id="6179723">Scheme</span>&nbsp;<span class="op" id="6179730">!=</span>&nbsp;<span class="string" id="6179733">&#34;http&#34;</span>&nbsp;<span class="op" id="6179740">&amp;&amp;</span>&nbsp;<span class="ident" id="6179743">u</span><span class="op" id="6179744">.</span><span class="ident" id="6179745">Scheme</span>&nbsp;<span class="op" id="6179752">!=</span>&nbsp;<span class="string" id="6179755">&#34;https&#34;</span>&nbsp;<span class="op" id="6179763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6179767">return</span>&nbsp;<span class="ident" id="6179774">cookies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6179783">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6179786">host</span><span class="op" id="6179790">,</span>&nbsp;<span class="ident" id="6179792">err</span>&nbsp;<span class="op" id="6179796">:=</span>&nbsp;<span class="ident" id="6179799">canonicalHost</span><span class="op" id="6179812">(</span><span class="ident" id="6179813">u</span><span class="op" id="6179814">.</span><span class="ident" id="6179815">Host</span><span class="op" id="6179819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6179822">if</span>&nbsp;<span class="ident" id="6179825">err</span>&nbsp;<span class="op" id="6179829">!=</span>&nbsp;<span class="ident" id="6179832">nil</span>&nbsp;<span class="op" id="6179836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6179840">return</span>&nbsp;<span class="ident" id="6179847">cookies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6179856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6179859">key</span>&nbsp;<span class="op" id="6179863">:=</span>&nbsp;<span class="ident" id="6179866">jarKey</span><span class="op" id="6179872">(</span><span class="ident" id="6179873">host</span><span class="op" id="6179877">,</span>&nbsp;<span class="ident" id="6179879">j</span><span class="op" id="6179880">.</span><span class="ident" id="6179881">psList</span><span class="op" id="6179887">)</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6179891">j</span><span class="op" id="6179892">.</span><span class="ident" id="6179893">mu</span><span class="op" id="6179895">.</span><span class="ident" id="6179896">Lock</span><span class="op" id="6179900">(</span><span class="op" id="6179901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6179904">defer</span>&nbsp;<span class="ident" id="6179910">j</span><span class="op" id="6179911">.</span><span class="ident" id="6179912">mu</span><span class="op" id="6179914">.</span><span class="ident" id="6179915">Unlock</span><span class="op" id="6179921">(</span><span class="op" id="6179922">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6179926">submap</span>&nbsp;<span class="op" id="6179933">:=</span>&nbsp;<span class="ident" id="6179936">j</span><span class="op" id="6179937">.</span><span class="ident" id="6179938">entries</span><span class="op" id="6179945">[</span><span class="ident" id="6179946">key</span><span class="op" id="6179949">]</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6179952">if</span>&nbsp;<span class="ident" id="6179955">submap</span>&nbsp;<span class="op" id="6179962">==</span>&nbsp;<span class="ident" id="6179965">nil</span>&nbsp;<span class="op" id="6179969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6179973">return</span>&nbsp;<span class="ident" id="6179980">cookies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6179989">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6179993">https</span>&nbsp;<span class="op" id="6179999">:=</span>&nbsp;<span class="ident" id="6180002">u</span><span class="op" id="6180003">.</span><span class="ident" id="6180004">Scheme</span>&nbsp;<span class="op" id="6180011">==</span>&nbsp;<span class="string" id="6180014">&#34;https&#34;</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6180023">path</span>&nbsp;<span class="op" id="6180028">:=</span>&nbsp;<span class="ident" id="6180031">u</span><span class="op" id="6180032">.</span><span class="ident" id="6180033">Path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6180039">if</span>&nbsp;<span class="ident" id="6180042">path</span>&nbsp;<span class="op" id="6180047">==</span>&nbsp;<span class="string" id="6180050">&#34;&#34;</span>&nbsp;<span class="op" id="6180053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6180057">path</span>&nbsp;<span class="op" id="6180062">=</span>&nbsp;<span class="string" id="6180064">&#34;/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6180069">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6180073">modified</span>&nbsp;<span class="op" id="6180082">:=</span>&nbsp;<span class="builtintype" id="6180085">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6180092">var</span>&nbsp;<span class="ident" id="6180096">selected</span>&nbsp;<span class="op" id="6180105">[</span><span class="op" id="6180106">]</span><span class="ident" id="6180107">entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6180114">for</span>&nbsp;<span class="ident" id="6180118">id</span><span class="op" id="6180120">,</span>&nbsp;<span class="ident" id="6180122">e</span>&nbsp;<span class="op" id="6180124">:=</span>&nbsp;<span class="keyword" id="6180127">range</span>&nbsp;<span class="ident" id="6180133">submap</span>&nbsp;<span class="op" id="6180140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6180144">if</span>&nbsp;<span class="ident" id="6180147">e</span><span class="op" id="6180148">.</span><span class="ident" id="6180149">Persistent</span>&nbsp;<span class="op" id="6180160">&amp;&amp;</span>&nbsp;<span class="op" id="6180163">!</span><span class="ident" id="6180164">e</span><span class="op" id="6180165">.</span><span class="ident" id="6180166">Expires</span><span class="op" id="6180173">.</span><span class="ident" id="6180174">After</span><span class="op" id="6180179">(</span><span class="ident" id="6180180">now</span><span class="op" id="6180183">)</span>&nbsp;<span class="op" id="6180185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6180190">delete</span><span class="op" id="6180196">(</span><span class="ident" id="6180197">submap</span><span class="op" id="6180203">,</span>&nbsp;<span class="ident" id="6180205">id</span><span class="op" id="6180207">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6180212">modified</span>&nbsp;<span class="op" id="6180221">=</span>&nbsp;<span class="builtintype" id="6180223">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6180231">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6180242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6180246">if</span>&nbsp;<span class="op" id="6180249">!</span><span class="ident" id="6180250">e</span><span class="op" id="6180251">.</span><span class="ident" id="6180252">shouldSend</span><span class="op" id="6180262">(</span><span class="ident" id="6180263">https</span><span class="op" id="6180268">,</span>&nbsp;<span class="ident" id="6180270">host</span><span class="op" id="6180274">,</span>&nbsp;<span class="ident" id="6180276">path</span><span class="op" id="6180280">)</span>&nbsp;<span class="op" id="6180282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6180287">continue</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6180298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6180302">e</span><span class="op" id="6180303">.</span><span class="ident" id="6180304">LastAccess</span>&nbsp;<span class="op" id="6180315">=</span>&nbsp;<span class="ident" id="6180317">now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6180323">submap</span><span class="op" id="6180329">[</span><span class="ident" id="6180330">id</span><span class="op" id="6180332">]</span>&nbsp;<span class="op" id="6180334">=</span>&nbsp;<span class="ident" id="6180336">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6180340">selected</span>&nbsp;<span class="op" id="6180349">=</span>&nbsp;<span class="builtinfunc" id="6180351">append</span><span class="op" id="6180357">(</span><span class="ident" id="6180358">selected</span><span class="op" id="6180366">,</span>&nbsp;<span class="ident" id="6180368">e</span><span class="op" id="6180369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6180373">modified</span>&nbsp;<span class="op" id="6180382">=</span>&nbsp;<span class="builtintype" id="6180384">true</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6180390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6180393">if</span>&nbsp;<span class="ident" id="6180396">modified</span>&nbsp;<span class="op" id="6180405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6180409">if</span>&nbsp;<span class="builtinfunc" id="6180412">len</span><span class="op" id="6180415">(</span><span class="ident" id="6180416">submap</span><span class="op" id="6180422">)</span>&nbsp;<span class="op" id="6180424">==</span>&nbsp;<span class="num" id="6180427">0</span>&nbsp;<span class="op" id="6180429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6180434">delete</span><span class="op" id="6180440">(</span><span class="ident" id="6180441">j</span><span class="op" id="6180442">.</span><span class="ident" id="6180443">entries</span><span class="op" id="6180450">,</span>&nbsp;<span class="ident" id="6180452">key</span><span class="op" id="6180455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6180459">}</span>&nbsp;<span class="keyword" id="6180461">else</span>&nbsp;<span class="op" id="6180466">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6180471">j</span><span class="op" id="6180472">.</span><span class="ident" id="6180473">entries</span><span class="op" id="6180480">[</span><span class="ident" id="6180481">key</span><span class="op" id="6180484">]</span>&nbsp;<span class="op" id="6180486">=</span>&nbsp;<span class="ident" id="6180488">submap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6180497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6180500">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6180504">sort</span><span class="op" id="6180508">.</span><span class="ident" id="6180509">Sort</span><span class="op" id="6180513">(</span><span class="ident" id="6180514">byPathLength</span><span class="op" id="6180526">(</span><span class="ident" id="6180527">selected</span><span class="op" id="6180535">)</span><span class="op" id="6180536">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6180539">for</span>&nbsp;<span class="ident" id="6180543">_</span><span class="op" id="6180544">,</span>&nbsp;<span class="ident" id="6180546">e</span>&nbsp;<span class="op" id="6180548">:=</span>&nbsp;<span class="keyword" id="6180551">range</span>&nbsp;<span class="ident" id="6180557">selected</span>&nbsp;<span class="op" id="6180566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6180570">cookies</span>&nbsp;<span class="op" id="6180578">=</span>&nbsp;<span class="builtinfunc" id="6180580">append</span><span class="op" id="6180586">(</span><span class="ident" id="6180587">cookies</span><span class="op" id="6180594">,</span>&nbsp;<span class="op" id="6180596">&amp;</span><span class="ident" id="6180597">http</span><span class="op" id="6180601">.</span><span class="ident" id="6180602">Cookie</span><span class="op" id="6180608">{</span><span class="ident" id="6180609">Name</span><span class="op" id="6180613">:</span>&nbsp;<span class="ident" id="6180615">e</span><span class="op" id="6180616">.</span><span class="ident" id="6180617">Name</span><span class="op" id="6180621">,</span>&nbsp;<span class="ident" id="6180623">Value</span><span class="op" id="6180628">:</span>&nbsp;<span class="ident" id="6180630">e</span><span class="op" id="6180631">.</span><span class="ident" id="6180632">Value</span><span class="op" id="6180637">}</span><span class="op" id="6180638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6180641">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6180645">return</span>&nbsp;<span class="ident" id="6180652">cookies</span><br>
<span class="lineno">230</span><span class="op" id="6180660">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6180663">//&nbsp;SetCookies&nbsp;implements&nbsp;the&nbsp;SetCookies&nbsp;method&nbsp;of&nbsp;the&nbsp;http.CookieJar&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="6180743">//</span><br>
<span class="lineno"></span><span class="comment" id="6180746">//&nbsp;It&nbsp;does&nbsp;nothing&nbsp;if&nbsp;the&nbsp;URL&#39;s&nbsp;scheme&nbsp;is&nbsp;not&nbsp;HTTP&nbsp;or&nbsp;HTTPS.</span><br>
<span class="lineno">235</span><span class="keyword" id="6180807">func</span>&nbsp;<span class="op" id="6180812">(</span><span class="ident" id="6180813">j</span>&nbsp;<span class="op" id="6180815">*</span><span class="ident" id="6180816">Jar</span><span class="op" id="6180819">)</span>&nbsp;<span class="ident" id="6180821">SetCookies</span><span class="op" id="6180831">(</span><span class="ident" id="6180832">u</span>&nbsp;<span class="op" id="6180834">*</span><span class="ident" id="6180835">url</span><span class="op" id="6180838">.</span><span class="ident" id="6180839">URL</span><span class="op" id="6180842">,</span>&nbsp;<span class="ident" id="6180844">cookies</span>&nbsp;<span class="op" id="6180852">[</span><span class="op" id="6180853">]</span><span class="op" id="6180854">*</span><span class="ident" id="6180855">http</span><span class="op" id="6180859">.</span><span class="ident" id="6180860">Cookie</span><span class="op" id="6180866">)</span>&nbsp;<span class="op" id="6180868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6180871">j</span><span class="op" id="6180872">.</span><span class="ident" id="6180873">setCookies</span><span class="op" id="6180883">(</span><span class="ident" id="6180884">u</span><span class="op" id="6180885">,</span>&nbsp;<span class="ident" id="6180887">cookies</span><span class="op" id="6180894">,</span>&nbsp;<span class="ident" id="6180896">time</span><span class="op" id="6180900">.</span><span class="ident" id="6180901">Now</span><span class="op" id="6180904">(</span><span class="op" id="6180905">)</span><span class="op" id="6180906">)</span><br>
<span class="lineno"></span><span class="op" id="6180908">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6180911">//&nbsp;setCookies&nbsp;is&nbsp;like&nbsp;SetCookies&nbsp;but&nbsp;takes&nbsp;the&nbsp;current&nbsp;time&nbsp;as&nbsp;parameter.</span><br>
<span class="lineno">240</span><span class="keyword" id="6180985">func</span>&nbsp;<span class="op" id="6180990">(</span><span class="ident" id="6180991">j</span>&nbsp;<span class="op" id="6180993">*</span><span class="ident" id="6180994">Jar</span><span class="op" id="6180997">)</span>&nbsp;<span class="ident" id="6180999">setCookies</span><span class="op" id="6181009">(</span><span class="ident" id="6181010">u</span>&nbsp;<span class="op" id="6181012">*</span><span class="ident" id="6181013">url</span><span class="op" id="6181016">.</span><span class="ident" id="6181017">URL</span><span class="op" id="6181020">,</span>&nbsp;<span class="ident" id="6181022">cookies</span>&nbsp;<span class="op" id="6181030">[</span><span class="op" id="6181031">]</span><span class="op" id="6181032">*</span><span class="ident" id="6181033">http</span><span class="op" id="6181037">.</span><span class="ident" id="6181038">Cookie</span><span class="op" id="6181044">,</span>&nbsp;<span class="ident" id="6181046">now</span>&nbsp;<span class="ident" id="6181050">time</span><span class="op" id="6181054">.</span><span class="ident" id="6181055">Time</span><span class="op" id="6181059">)</span>&nbsp;<span class="op" id="6181061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6181064">if</span>&nbsp;<span class="builtinfunc" id="6181067">len</span><span class="op" id="6181070">(</span><span class="ident" id="6181071">cookies</span><span class="op" id="6181078">)</span>&nbsp;<span class="op" id="6181080">==</span>&nbsp;<span class="num" id="6181083">0</span>&nbsp;<span class="op" id="6181085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6181089">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6181097">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6181100">if</span>&nbsp;<span class="ident" id="6181103">u</span><span class="op" id="6181104">.</span><span class="ident" id="6181105">Scheme</span>&nbsp;<span class="op" id="6181112">!=</span>&nbsp;<span class="string" id="6181115">&#34;http&#34;</span>&nbsp;<span class="op" id="6181122">&amp;&amp;</span>&nbsp;<span class="ident" id="6181125">u</span><span class="op" id="6181126">.</span><span class="ident" id="6181127">Scheme</span>&nbsp;<span class="op" id="6181134">!=</span>&nbsp;<span class="string" id="6181137">&#34;https&#34;</span>&nbsp;<span class="op" id="6181145">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6181149">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6181157">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6181160">host</span><span class="op" id="6181164">,</span>&nbsp;<span class="ident" id="6181166">err</span>&nbsp;<span class="op" id="6181170">:=</span>&nbsp;<span class="ident" id="6181173">canonicalHost</span><span class="op" id="6181186">(</span><span class="ident" id="6181187">u</span><span class="op" id="6181188">.</span><span class="ident" id="6181189">Host</span><span class="op" id="6181193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6181196">if</span>&nbsp;<span class="ident" id="6181199">err</span>&nbsp;<span class="op" id="6181203">!=</span>&nbsp;<span class="ident" id="6181206">nil</span>&nbsp;<span class="op" id="6181210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6181214">return</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6181222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6181225">key</span>&nbsp;<span class="op" id="6181229">:=</span>&nbsp;<span class="ident" id="6181232">jarKey</span><span class="op" id="6181238">(</span><span class="ident" id="6181239">host</span><span class="op" id="6181243">,</span>&nbsp;<span class="ident" id="6181245">j</span><span class="op" id="6181246">.</span><span class="ident" id="6181247">psList</span><span class="op" id="6181253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6181256">defPath</span>&nbsp;<span class="op" id="6181264">:=</span>&nbsp;<span class="ident" id="6181267">defaultPath</span><span class="op" id="6181278">(</span><span class="ident" id="6181279">u</span><span class="op" id="6181280">.</span><span class="ident" id="6181281">Path</span><span class="op" id="6181285">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6181289">j</span><span class="op" id="6181290">.</span><span class="ident" id="6181291">mu</span><span class="op" id="6181293">.</span><span class="ident" id="6181294">Lock</span><span class="op" id="6181298">(</span><span class="op" id="6181299">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6181302">defer</span>&nbsp;<span class="ident" id="6181308">j</span><span class="op" id="6181309">.</span><span class="ident" id="6181310">mu</span><span class="op" id="6181312">.</span><span class="ident" id="6181313">Unlock</span><span class="op" id="6181319">(</span><span class="op" id="6181320">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6181324">submap</span>&nbsp;<span class="op" id="6181331">:=</span>&nbsp;<span class="ident" id="6181334">j</span><span class="op" id="6181335">.</span><span class="ident" id="6181336">entries</span><span class="op" id="6181343">[</span><span class="ident" id="6181344">key</span><span class="op" id="6181347">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6181351">modified</span>&nbsp;<span class="op" id="6181360">:=</span>&nbsp;<span class="builtintype" id="6181363">false</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6181370">for</span>&nbsp;<span class="ident" id="6181374">_</span><span class="op" id="6181375">,</span>&nbsp;<span class="ident" id="6181377">cookie</span>&nbsp;<span class="op" id="6181384">:=</span>&nbsp;<span class="keyword" id="6181387">range</span>&nbsp;<span class="ident" id="6181393">cookies</span>&nbsp;<span class="op" id="6181401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6181405">e</span><span class="op" id="6181406">,</span>&nbsp;<span class="ident" id="6181408">remove</span><span class="op" id="6181414">,</span>&nbsp;<span class="ident" id="6181416">err</span>&nbsp;<span class="op" id="6181420">:=</span>&nbsp;<span class="ident" id="6181423">j</span><span class="op" id="6181424">.</span><span class="ident" id="6181425">newEntry</span><span class="op" id="6181433">(</span><span class="ident" id="6181434">cookie</span><span class="op" id="6181440">,</span>&nbsp;<span class="ident" id="6181442">now</span><span class="op" id="6181445">,</span>&nbsp;<span class="ident" id="6181447">defPath</span><span class="op" id="6181454">,</span>&nbsp;<span class="ident" id="6181456">host</span><span class="op" id="6181460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6181464">if</span>&nbsp;<span class="ident" id="6181467">err</span>&nbsp;<span class="op" id="6181471">!=</span>&nbsp;<span class="ident" id="6181474">nil</span>&nbsp;<span class="op" id="6181478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6181483">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6181494">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6181498">id</span>&nbsp;<span class="op" id="6181501">:=</span>&nbsp;<span class="ident" id="6181504">e</span><span class="op" id="6181505">.</span><span class="ident" id="6181506">id</span><span class="op" id="6181508">(</span><span class="op" id="6181509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6181513">if</span>&nbsp;<span class="ident" id="6181516">remove</span>&nbsp;<span class="op" id="6181523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6181528">if</span>&nbsp;<span class="ident" id="6181531">submap</span>&nbsp;<span class="op" id="6181538">!=</span>&nbsp;<span class="ident" id="6181541">nil</span>&nbsp;<span class="op" id="6181545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6181551">if</span>&nbsp;<span class="ident" id="6181554">_</span><span class="op" id="6181555">,</span>&nbsp;<span class="ident" id="6181557">ok</span>&nbsp;<span class="op" id="6181560">:=</span>&nbsp;<span class="ident" id="6181563">submap</span><span class="op" id="6181569">[</span><span class="ident" id="6181570">id</span><span class="op" id="6181572">]</span><span class="op" id="6181573">;</span>&nbsp;<span class="ident" id="6181575">ok</span>&nbsp;<span class="op" id="6181578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6181585">delete</span><span class="op" id="6181591">(</span><span class="ident" id="6181592">submap</span><span class="op" id="6181598">,</span>&nbsp;<span class="ident" id="6181600">id</span><span class="op" id="6181602">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6181609">modified</span>&nbsp;<span class="op" id="6181618">=</span>&nbsp;<span class="builtintype" id="6181620">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6181629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6181634">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6181639">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6181650">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6181654">if</span>&nbsp;<span class="ident" id="6181657">submap</span>&nbsp;<span class="op" id="6181664">==</span>&nbsp;<span class="ident" id="6181667">nil</span>&nbsp;<span class="op" id="6181671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6181676">submap</span>&nbsp;<span class="op" id="6181683">=</span>&nbsp;<span class="builtinfunc" id="6181685">make</span><span class="op" id="6181689">(</span><span class="keyword" id="6181690">map</span><span class="op" id="6181693">[</span><span class="builtintype" id="6181694">string</span><span class="op" id="6181700">]</span><span class="ident" id="6181701">entry</span><span class="op" id="6181706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6181710">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6181715">if</span>&nbsp;<span class="ident" id="6181718">old</span><span class="op" id="6181721">,</span>&nbsp;<span class="ident" id="6181723">ok</span>&nbsp;<span class="op" id="6181726">:=</span>&nbsp;<span class="ident" id="6181729">submap</span><span class="op" id="6181735">[</span><span class="ident" id="6181736">id</span><span class="op" id="6181738">]</span><span class="op" id="6181739">;</span>&nbsp;<span class="ident" id="6181741">ok</span>&nbsp;<span class="op" id="6181744">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6181749">e</span><span class="op" id="6181750">.</span><span class="ident" id="6181751">Creation</span>&nbsp;<span class="op" id="6181760">=</span>&nbsp;<span class="ident" id="6181762">old</span><span class="op" id="6181765">.</span><span class="ident" id="6181766">Creation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6181778">e</span><span class="op" id="6181779">.</span><span class="ident" id="6181780">seqNum</span>&nbsp;<span class="op" id="6181787">=</span>&nbsp;<span class="ident" id="6181789">old</span><span class="op" id="6181792">.</span><span class="ident" id="6181793">seqNum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6181802">}</span>&nbsp;<span class="keyword" id="6181804">else</span>&nbsp;<span class="op" id="6181809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6181814">e</span><span class="op" id="6181815">.</span><span class="ident" id="6181816">Creation</span>&nbsp;<span class="op" id="6181825">=</span>&nbsp;<span class="ident" id="6181827">now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6181834">e</span><span class="op" id="6181835">.</span><span class="ident" id="6181836">seqNum</span>&nbsp;<span class="op" id="6181843">=</span>&nbsp;<span class="ident" id="6181845">j</span><span class="op" id="6181846">.</span><span class="ident" id="6181847">nextSeqNum</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6181861">j</span><span class="op" id="6181862">.</span><span class="ident" id="6181863">nextSeqNum</span><span class="op" id="6181873">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6181878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6181882">e</span><span class="op" id="6181883">.</span><span class="ident" id="6181884">LastAccess</span>&nbsp;<span class="op" id="6181895">=</span>&nbsp;<span class="ident" id="6181897">now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6181903">submap</span><span class="op" id="6181909">[</span><span class="ident" id="6181910">id</span><span class="op" id="6181912">]</span>&nbsp;<span class="op" id="6181914">=</span>&nbsp;<span class="ident" id="6181916">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6181920">modified</span>&nbsp;<span class="op" id="6181929">=</span>&nbsp;<span class="builtintype" id="6181931">true</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6181937">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6181941">if</span>&nbsp;<span class="ident" id="6181944">modified</span>&nbsp;<span class="op" id="6181953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6181957">if</span>&nbsp;<span class="builtinfunc" id="6181960">len</span><span class="op" id="6181963">(</span><span class="ident" id="6181964">submap</span><span class="op" id="6181970">)</span>&nbsp;<span class="op" id="6181972">==</span>&nbsp;<span class="num" id="6181975">0</span>&nbsp;<span class="op" id="6181977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6181982">delete</span><span class="op" id="6181988">(</span><span class="ident" id="6181989">j</span><span class="op" id="6181990">.</span><span class="ident" id="6181991">entries</span><span class="op" id="6181998">,</span>&nbsp;<span class="ident" id="6182000">key</span><span class="op" id="6182003">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6182007">}</span>&nbsp;<span class="keyword" id="6182009">else</span>&nbsp;<span class="op" id="6182014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6182019">j</span><span class="op" id="6182020">.</span><span class="ident" id="6182021">entries</span><span class="op" id="6182028">[</span><span class="ident" id="6182029">key</span><span class="op" id="6182032">]</span>&nbsp;<span class="op" id="6182034">=</span>&nbsp;<span class="ident" id="6182036">submap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6182045">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6182048">}</span><br>
<span class="lineno"></span><span class="op" id="6182050">}</span><br>
<span class="lineno">300</span><br>
<span class="lineno"></span><span class="comment" id="6182053">//&nbsp;canonicalHost&nbsp;strips&nbsp;port&nbsp;from&nbsp;host&nbsp;if&nbsp;present&nbsp;and&nbsp;returns&nbsp;the&nbsp;canonicalized</span><br>
<span class="lineno"></span><span class="comment" id="6182133">//&nbsp;host&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="6182147">func</span>&nbsp;<span class="ident" id="6182152">canonicalHost</span><span class="op" id="6182165">(</span><span class="ident" id="6182166">host</span>&nbsp;<span class="builtintype" id="6182171">string</span><span class="op" id="6182177">)</span>&nbsp;<span class="op" id="6182179">(</span><span class="builtintype" id="6182180">string</span><span class="op" id="6182186">,</span>&nbsp;<span class="builtintype" id="6182188">error</span><span class="op" id="6182193">)</span>&nbsp;<span class="op" id="6182195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6182198">var</span>&nbsp;<span class="ident" id="6182202">err</span>&nbsp;<span class="builtintype" id="6182206">error</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6182213">host</span>&nbsp;<span class="op" id="6182218">=</span>&nbsp;<span class="ident" id="6182220">strings</span><span class="op" id="6182227">.</span><span class="ident" id="6182228">ToLower</span><span class="op" id="6182235">(</span><span class="ident" id="6182236">host</span><span class="op" id="6182240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6182243">if</span>&nbsp;<span class="ident" id="6182246">hasPort</span><span class="op" id="6182253">(</span><span class="ident" id="6182254">host</span><span class="op" id="6182258">)</span>&nbsp;<span class="op" id="6182260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6182264">host</span><span class="op" id="6182268">,</span>&nbsp;<span class="ident" id="6182270">_</span><span class="op" id="6182271">,</span>&nbsp;<span class="ident" id="6182273">err</span>&nbsp;<span class="op" id="6182277">=</span>&nbsp;<span class="ident" id="6182279">net</span><span class="op" id="6182282">.</span><span class="ident" id="6182283">SplitHostPort</span><span class="op" id="6182296">(</span><span class="ident" id="6182297">host</span><span class="op" id="6182301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6182305">if</span>&nbsp;<span class="ident" id="6182308">err</span>&nbsp;<span class="op" id="6182312">!=</span>&nbsp;<span class="ident" id="6182315">nil</span>&nbsp;<span class="op" id="6182319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6182324">return</span>&nbsp;<span class="string" id="6182331">&#34;&#34;</span><span class="op" id="6182333">,</span>&nbsp;<span class="ident" id="6182335">err</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6182341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6182344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6182347">if</span>&nbsp;<span class="ident" id="6182350">strings</span><span class="op" id="6182357">.</span><span class="ident" id="6182358">HasSuffix</span><span class="op" id="6182367">(</span><span class="ident" id="6182368">host</span><span class="op" id="6182372">,</span>&nbsp;<span class="string" id="6182374">&#34;.&#34;</span><span class="op" id="6182377">)</span>&nbsp;<span class="op" id="6182379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6182383">//&nbsp;Strip&nbsp;trailing&nbsp;dot&nbsp;from&nbsp;fully&nbsp;qualified&nbsp;domain&nbsp;names.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6182442">host</span>&nbsp;<span class="op" id="6182447">=</span>&nbsp;<span class="ident" id="6182449">host</span><span class="op" id="6182453">[</span><span class="op" id="6182454">:</span><span class="builtinfunc" id="6182455">len</span><span class="op" id="6182458">(</span><span class="ident" id="6182459">host</span><span class="op" id="6182463">)</span><span class="op" id="6182464">-</span><span class="num" id="6182465">1</span><span class="op" id="6182466">]</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6182469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6182472">return</span>&nbsp;<span class="ident" id="6182479">toASCII</span><span class="op" id="6182486">(</span><span class="ident" id="6182487">host</span><span class="op" id="6182491">)</span><br>
<span class="lineno"></span><span class="op" id="6182493">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6182496">//&nbsp;hasPort&nbsp;reports&nbsp;whether&nbsp;host&nbsp;contains&nbsp;a&nbsp;port&nbsp;number.&nbsp;host&nbsp;may&nbsp;be&nbsp;a&nbsp;host</span><br>
<span class="lineno">320</span><span class="comment" id="6182571">//&nbsp;name,&nbsp;an&nbsp;IPv4&nbsp;or&nbsp;an&nbsp;IPv6&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="6182608">func</span>&nbsp;<span class="ident" id="6182613">hasPort</span><span class="op" id="6182620">(</span><span class="ident" id="6182621">host</span>&nbsp;<span class="builtintype" id="6182626">string</span><span class="op" id="6182632">)</span>&nbsp;<span class="builtintype" id="6182634">bool</span>&nbsp;<span class="op" id="6182639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6182642">colons</span>&nbsp;<span class="op" id="6182649">:=</span>&nbsp;<span class="ident" id="6182652">strings</span><span class="op" id="6182659">.</span><span class="ident" id="6182660">Count</span><span class="op" id="6182665">(</span><span class="ident" id="6182666">host</span><span class="op" id="6182670">,</span>&nbsp;<span class="string" id="6182672">&#34;:&#34;</span><span class="op" id="6182675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6182678">if</span>&nbsp;<span class="ident" id="6182681">colons</span>&nbsp;<span class="op" id="6182688">==</span>&nbsp;<span class="num" id="6182691">0</span>&nbsp;<span class="op" id="6182693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6182697">return</span>&nbsp;<span class="builtintype" id="6182704">false</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6182711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6182714">if</span>&nbsp;<span class="ident" id="6182717">colons</span>&nbsp;<span class="op" id="6182724">==</span>&nbsp;<span class="num" id="6182727">1</span>&nbsp;<span class="op" id="6182729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6182733">return</span>&nbsp;<span class="builtintype" id="6182740">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6182746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6182749">return</span>&nbsp;<span class="ident" id="6182756">host</span><span class="op" id="6182760">[</span><span class="num" id="6182761">0</span><span class="op" id="6182762">]</span>&nbsp;<span class="op" id="6182764">==</span>&nbsp;<span class="string" id="6182767">&#39;[&#39;</span>&nbsp;<span class="op" id="6182771">&amp;&amp;</span>&nbsp;<span class="ident" id="6182774">strings</span><span class="op" id="6182781">.</span><span class="ident" id="6182782">Contains</span><span class="op" id="6182790">(</span><span class="ident" id="6182791">host</span><span class="op" id="6182795">,</span>&nbsp;<span class="string" id="6182797">&#34;]:&#34;</span><span class="op" id="6182801">)</span><br>
<span class="lineno">330</span><span class="op" id="6182803">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6182806">//&nbsp;jarKey&nbsp;returns&nbsp;the&nbsp;key&nbsp;to&nbsp;use&nbsp;for&nbsp;a&nbsp;jar.</span><br>
<span class="lineno"></span><span class="keyword" id="6182850">func</span>&nbsp;<span class="ident" id="6182855">jarKey</span><span class="op" id="6182861">(</span><span class="ident" id="6182862">host</span>&nbsp;<span class="builtintype" id="6182867">string</span><span class="op" id="6182873">,</span>&nbsp;<span class="ident" id="6182875">psl</span>&nbsp;<span class="ident" id="6182879">PublicSuffixList</span><span class="op" id="6182895">)</span>&nbsp;<span class="builtintype" id="6182897">string</span>&nbsp;<span class="op" id="6182904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6182907">if</span>&nbsp;<span class="ident" id="6182910">isIP</span><span class="op" id="6182914">(</span><span class="ident" id="6182915">host</span><span class="op" id="6182919">)</span>&nbsp;<span class="op" id="6182921">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6182925">return</span>&nbsp;<span class="ident" id="6182932">host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6182938">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6182942">var</span>&nbsp;<span class="ident" id="6182946">i</span>&nbsp;<span class="builtintype" id="6182948">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6182953">if</span>&nbsp;<span class="ident" id="6182956">psl</span>&nbsp;<span class="op" id="6182960">==</span>&nbsp;<span class="ident" id="6182963">nil</span>&nbsp;<span class="op" id="6182967">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6182971">i</span>&nbsp;<span class="op" id="6182973">=</span>&nbsp;<span class="ident" id="6182975">strings</span><span class="op" id="6182982">.</span><span class="ident" id="6182983">LastIndex</span><span class="op" id="6182992">(</span><span class="ident" id="6182993">host</span><span class="op" id="6182997">,</span>&nbsp;<span class="string" id="6182999">&#34;.&#34;</span><span class="op" id="6183002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6183006">if</span>&nbsp;<span class="ident" id="6183009">i</span>&nbsp;<span class="op" id="6183011">==</span>&nbsp;<span class="op" id="6183014">-</span><span class="num" id="6183015">1</span>&nbsp;<span class="op" id="6183017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6183022">return</span>&nbsp;<span class="ident" id="6183029">host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6183036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6183039">}</span>&nbsp;<span class="keyword" id="6183041">else</span>&nbsp;<span class="op" id="6183046">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6183050">suffix</span>&nbsp;<span class="op" id="6183057">:=</span>&nbsp;<span class="ident" id="6183060">psl</span><span class="op" id="6183063">.</span><span class="ident" id="6183064">PublicSuffix</span><span class="op" id="6183076">(</span><span class="ident" id="6183077">host</span><span class="op" id="6183081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6183085">if</span>&nbsp;<span class="ident" id="6183088">suffix</span>&nbsp;<span class="op" id="6183095">==</span>&nbsp;<span class="ident" id="6183098">host</span>&nbsp;<span class="op" id="6183103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6183108">return</span>&nbsp;<span class="ident" id="6183115">host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6183122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6183126">i</span>&nbsp;<span class="op" id="6183128">=</span>&nbsp;<span class="builtinfunc" id="6183130">len</span><span class="op" id="6183133">(</span><span class="ident" id="6183134">host</span><span class="op" id="6183138">)</span>&nbsp;<span class="op" id="6183140">-</span>&nbsp;<span class="builtinfunc" id="6183142">len</span><span class="op" id="6183145">(</span><span class="ident" id="6183146">suffix</span><span class="op" id="6183152">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6183156">if</span>&nbsp;<span class="ident" id="6183159">i</span>&nbsp;<span class="op" id="6183161">&lt;=</span>&nbsp;<span class="num" id="6183164">0</span>&nbsp;<span class="op" id="6183166">||</span>&nbsp;<span class="ident" id="6183169">host</span><span class="op" id="6183173">[</span><span class="ident" id="6183174">i</span><span class="op" id="6183175">-</span><span class="num" id="6183176">1</span><span class="op" id="6183177">]</span>&nbsp;<span class="op" id="6183179">!=</span>&nbsp;<span class="string" id="6183182">&#39;.&#39;</span>&nbsp;<span class="op" id="6183186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6183191">//&nbsp;The&nbsp;provided&nbsp;public&nbsp;suffix&nbsp;list&nbsp;psl&nbsp;is&nbsp;broken.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6183244">//&nbsp;Storing&nbsp;cookies&nbsp;under&nbsp;host&nbsp;is&nbsp;a&nbsp;safe&nbsp;stopgap.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6183296">return</span>&nbsp;<span class="ident" id="6183303">host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6183310">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6183313">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6183316">prevDot</span>&nbsp;<span class="op" id="6183324">:=</span>&nbsp;<span class="ident" id="6183327">strings</span><span class="op" id="6183334">.</span><span class="ident" id="6183335">LastIndex</span><span class="op" id="6183344">(</span><span class="ident" id="6183345">host</span><span class="op" id="6183349">[</span><span class="op" id="6183350">:</span><span class="ident" id="6183351">i</span><span class="op" id="6183352">-</span><span class="num" id="6183353">1</span><span class="op" id="6183354">]</span><span class="op" id="6183355">,</span>&nbsp;<span class="string" id="6183357">&#34;.&#34;</span><span class="op" id="6183360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6183363">return</span>&nbsp;<span class="ident" id="6183370">host</span><span class="op" id="6183374">[</span><span class="ident" id="6183375">prevDot</span><span class="op" id="6183382">+</span><span class="num" id="6183383">1</span><span class="op" id="6183384">:</span><span class="op" id="6183385">]</span><br>
<span class="lineno"></span><span class="op" id="6183387">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">360</span><span class="comment" id="6183390">//&nbsp;isIP&nbsp;reports&nbsp;whether&nbsp;host&nbsp;is&nbsp;an&nbsp;IP&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="6183437">func</span>&nbsp;<span class="ident" id="6183442">isIP</span><span class="op" id="6183446">(</span><span class="ident" id="6183447">host</span>&nbsp;<span class="builtintype" id="6183452">string</span><span class="op" id="6183458">)</span>&nbsp;<span class="builtintype" id="6183460">bool</span>&nbsp;<span class="op" id="6183465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6183468">return</span>&nbsp;<span class="ident" id="6183475">net</span><span class="op" id="6183478">.</span><span class="ident" id="6183479">ParseIP</span><span class="op" id="6183486">(</span><span class="ident" id="6183487">host</span><span class="op" id="6183491">)</span>&nbsp;<span class="op" id="6183493">!=</span>&nbsp;<span class="ident" id="6183496">nil</span><br>
<span class="lineno"></span><span class="op" id="6183500">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="comment" id="6183503">//&nbsp;defaultPath&nbsp;returns&nbsp;the&nbsp;directory&nbsp;part&nbsp;of&nbsp;an&nbsp;URL&#39;s&nbsp;path&nbsp;according&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="6183575">//&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.1.4.</span><br>
<span class="lineno"></span><span class="keyword" id="6183602">func</span>&nbsp;<span class="ident" id="6183607">defaultPath</span><span class="op" id="6183618">(</span><span class="ident" id="6183619">path</span>&nbsp;<span class="builtintype" id="6183624">string</span><span class="op" id="6183630">)</span>&nbsp;<span class="builtintype" id="6183632">string</span>&nbsp;<span class="op" id="6183639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6183642">if</span>&nbsp;<span class="builtinfunc" id="6183645">len</span><span class="op" id="6183648">(</span><span class="ident" id="6183649">path</span><span class="op" id="6183653">)</span>&nbsp;<span class="op" id="6183655">==</span>&nbsp;<span class="num" id="6183658">0</span>&nbsp;<span class="op" id="6183660">||</span>&nbsp;<span class="ident" id="6183663">path</span><span class="op" id="6183667">[</span><span class="num" id="6183668">0</span><span class="op" id="6183669">]</span>&nbsp;<span class="op" id="6183671">!=</span>&nbsp;<span class="string" id="6183674">&#39;/&#39;</span>&nbsp;<span class="op" id="6183678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6183682">return</span>&nbsp;<span class="string" id="6183689">&#34;/&#34;</span>&nbsp;<span class="comment" id="6183693">//&nbsp;Path&nbsp;is&nbsp;empty&nbsp;or&nbsp;malformed.</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6183725">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6183729">i</span>&nbsp;<span class="op" id="6183731">:=</span>&nbsp;<span class="ident" id="6183734">strings</span><span class="op" id="6183741">.</span><span class="ident" id="6183742">LastIndex</span><span class="op" id="6183751">(</span><span class="ident" id="6183752">path</span><span class="op" id="6183756">,</span>&nbsp;<span class="string" id="6183758">&#34;/&#34;</span><span class="op" id="6183761">)</span>&nbsp;<span class="comment" id="6183763">//&nbsp;Path&nbsp;starts&nbsp;with&nbsp;&#34;/&#34;,&nbsp;so&nbsp;i&nbsp;!=&nbsp;-1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6183801">if</span>&nbsp;<span class="ident" id="6183804">i</span>&nbsp;<span class="op" id="6183806">==</span>&nbsp;<span class="num" id="6183809">0</span>&nbsp;<span class="op" id="6183811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6183815">return</span>&nbsp;<span class="string" id="6183822">&#34;/&#34;</span>&nbsp;<span class="comment" id="6183826">//&nbsp;Path&nbsp;has&nbsp;the&nbsp;form&nbsp;&#34;/abc&#34;.</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6183856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6183859">return</span>&nbsp;<span class="ident" id="6183866">path</span><span class="op" id="6183870">[</span><span class="op" id="6183871">:</span><span class="ident" id="6183872">i</span><span class="op" id="6183873">]</span>&nbsp;<span class="comment" id="6183875">//&nbsp;Path&nbsp;is&nbsp;either&nbsp;of&nbsp;form&nbsp;&#34;/abc/xyz&#34;&nbsp;or&nbsp;&#34;/abc/xyz/&#34;.</span><br>
<span class="lineno"></span><span class="op" id="6183928">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6183931">//&nbsp;newEntry&nbsp;creates&nbsp;an&nbsp;entry&nbsp;from&nbsp;a&nbsp;http.Cookie&nbsp;c.&nbsp;now&nbsp;is&nbsp;the&nbsp;current&nbsp;time&nbsp;and</span><br>
<span class="lineno">380</span><span class="comment" id="6184010">//&nbsp;is&nbsp;compared&nbsp;to&nbsp;c.Expires&nbsp;to&nbsp;determine&nbsp;deletion&nbsp;of&nbsp;c.&nbsp;defPath&nbsp;and&nbsp;host&nbsp;are&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6184091">//&nbsp;default-path&nbsp;and&nbsp;the&nbsp;canonical&nbsp;host&nbsp;name&nbsp;of&nbsp;the&nbsp;URL&nbsp;c&nbsp;was&nbsp;received&nbsp;from.</span><br>
<span class="lineno"></span><span class="comment" id="6184167">//</span><br>
<span class="lineno"></span><span class="comment" id="6184170">//&nbsp;remove&nbsp;records&nbsp;whether&nbsp;the&nbsp;jar&nbsp;should&nbsp;delete&nbsp;this&nbsp;cookie,&nbsp;as&nbsp;it&nbsp;has&nbsp;already</span><br>
<span class="lineno"></span><span class="comment" id="6184249">//&nbsp;expired&nbsp;with&nbsp;respect&nbsp;to&nbsp;now.&nbsp;In&nbsp;this&nbsp;case,&nbsp;e&nbsp;may&nbsp;be&nbsp;incomplete,&nbsp;but&nbsp;it&nbsp;will</span><br>
<span class="lineno">385</span><span class="comment" id="6184328">//&nbsp;be&nbsp;valid&nbsp;to&nbsp;call&nbsp;e.id&nbsp;(which&nbsp;depends&nbsp;on&nbsp;e&#39;s&nbsp;Name,&nbsp;Domain&nbsp;and&nbsp;Path).</span><br>
<span class="lineno"></span><span class="comment" id="6184399">//</span><br>
<span class="lineno"></span><span class="comment" id="6184402">//&nbsp;A&nbsp;malformed&nbsp;c.Domain&nbsp;will&nbsp;result&nbsp;in&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="keyword" id="6184451">func</span>&nbsp;<span class="op" id="6184456">(</span><span class="ident" id="6184457">j</span>&nbsp;<span class="op" id="6184459">*</span><span class="ident" id="6184460">Jar</span><span class="op" id="6184463">)</span>&nbsp;<span class="ident" id="6184465">newEntry</span><span class="op" id="6184473">(</span><span class="ident" id="6184474">c</span>&nbsp;<span class="op" id="6184476">*</span><span class="ident" id="6184477">http</span><span class="op" id="6184481">.</span><span class="ident" id="6184482">Cookie</span><span class="op" id="6184488">,</span>&nbsp;<span class="ident" id="6184490">now</span>&nbsp;<span class="ident" id="6184494">time</span><span class="op" id="6184498">.</span><span class="ident" id="6184499">Time</span><span class="op" id="6184503">,</span>&nbsp;<span class="ident" id="6184505">defPath</span><span class="op" id="6184512">,</span>&nbsp;<span class="ident" id="6184514">host</span>&nbsp;<span class="builtintype" id="6184519">string</span><span class="op" id="6184525">)</span>&nbsp;<span class="op" id="6184527">(</span><span class="ident" id="6184528">e</span>&nbsp;<span class="ident" id="6184530">entry</span><span class="op" id="6184535">,</span>&nbsp;<span class="ident" id="6184537">remove</span>&nbsp;<span class="builtintype" id="6184544">bool</span><span class="op" id="6184548">,</span>&nbsp;<span class="ident" id="6184550">err</span>&nbsp;<span class="builtintype" id="6184554">error</span><span class="op" id="6184559">)</span>&nbsp;<span class="op" id="6184561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6184564">e</span><span class="op" id="6184565">.</span><span class="ident" id="6184566">Name</span>&nbsp;<span class="op" id="6184571">=</span>&nbsp;<span class="ident" id="6184573">c</span><span class="op" id="6184574">.</span><span class="ident" id="6184575">Name</span><br>
<span class="lineno">390</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6184582">if</span>&nbsp;<span class="ident" id="6184585">c</span><span class="op" id="6184586">.</span><span class="ident" id="6184587">Path</span>&nbsp;<span class="op" id="6184592">==</span>&nbsp;<span class="string" id="6184595">&#34;&#34;</span>&nbsp;<span class="op" id="6184598">||</span>&nbsp;<span class="ident" id="6184601">c</span><span class="op" id="6184602">.</span><span class="ident" id="6184603">Path</span><span class="op" id="6184607">[</span><span class="num" id="6184608">0</span><span class="op" id="6184609">]</span>&nbsp;<span class="op" id="6184611">!=</span>&nbsp;<span class="string" id="6184614">&#39;/&#39;</span>&nbsp;<span class="op" id="6184618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6184622">e</span><span class="op" id="6184623">.</span><span class="ident" id="6184624">Path</span>&nbsp;<span class="op" id="6184629">=</span>&nbsp;<span class="ident" id="6184631">defPath</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6184640">}</span>&nbsp;<span class="keyword" id="6184642">else</span>&nbsp;<span class="op" id="6184647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6184651">e</span><span class="op" id="6184652">.</span><span class="ident" id="6184653">Path</span>&nbsp;<span class="op" id="6184658">=</span>&nbsp;<span class="ident" id="6184660">c</span><span class="op" id="6184661">.</span><span class="ident" id="6184662">Path</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6184668">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6184672">e</span><span class="op" id="6184673">.</span><span class="ident" id="6184674">Domain</span><span class="op" id="6184680">,</span>&nbsp;<span class="ident" id="6184682">e</span><span class="op" id="6184683">.</span><span class="ident" id="6184684">HostOnly</span><span class="op" id="6184692">,</span>&nbsp;<span class="ident" id="6184694">err</span>&nbsp;<span class="op" id="6184698">=</span>&nbsp;<span class="ident" id="6184700">j</span><span class="op" id="6184701">.</span><span class="ident" id="6184702">domainAndType</span><span class="op" id="6184715">(</span><span class="ident" id="6184716">host</span><span class="op" id="6184720">,</span>&nbsp;<span class="ident" id="6184722">c</span><span class="op" id="6184723">.</span><span class="ident" id="6184724">Domain</span><span class="op" id="6184730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6184733">if</span>&nbsp;<span class="ident" id="6184736">err</span>&nbsp;<span class="op" id="6184740">!=</span>&nbsp;<span class="ident" id="6184743">nil</span>&nbsp;<span class="op" id="6184747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6184751">return</span>&nbsp;<span class="ident" id="6184758">e</span><span class="op" id="6184759">,</span>&nbsp;<span class="builtintype" id="6184761">false</span><span class="op" id="6184766">,</span>&nbsp;<span class="ident" id="6184768">err</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6184773">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6184777">//&nbsp;MaxAge&nbsp;takes&nbsp;precedence&nbsp;over&nbsp;Expires.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6184819">if</span>&nbsp;<span class="ident" id="6184822">c</span><span class="op" id="6184823">.</span><span class="ident" id="6184824">MaxAge</span>&nbsp;<span class="op" id="6184831">&lt;</span>&nbsp;<span class="num" id="6184833">0</span>&nbsp;<span class="op" id="6184835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6184839">return</span>&nbsp;<span class="ident" id="6184846">e</span><span class="op" id="6184847">,</span>&nbsp;<span class="builtintype" id="6184849">true</span><span class="op" id="6184853">,</span>&nbsp;<span class="ident" id="6184855">nil</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6184860">}</span>&nbsp;<span class="keyword" id="6184862">else</span>&nbsp;<span class="keyword" id="6184867">if</span>&nbsp;<span class="ident" id="6184870">c</span><span class="op" id="6184871">.</span><span class="ident" id="6184872">MaxAge</span>&nbsp;<span class="op" id="6184879">&gt;</span>&nbsp;<span class="num" id="6184881">0</span>&nbsp;<span class="op" id="6184883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6184887">e</span><span class="op" id="6184888">.</span><span class="ident" id="6184889">Expires</span>&nbsp;<span class="op" id="6184897">=</span>&nbsp;<span class="ident" id="6184899">now</span><span class="op" id="6184902">.</span><span class="ident" id="6184903">Add</span><span class="op" id="6184906">(</span><span class="ident" id="6184907">time</span><span class="op" id="6184911">.</span><span class="ident" id="6184912">Duration</span><span class="op" id="6184920">(</span><span class="ident" id="6184921">c</span><span class="op" id="6184922">.</span><span class="ident" id="6184923">MaxAge</span><span class="op" id="6184929">)</span>&nbsp;<span class="op" id="6184931">*</span>&nbsp;<span class="ident" id="6184933">time</span><span class="op" id="6184937">.</span><span class="ident" id="6184938">Second</span><span class="op" id="6184944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6184948">e</span><span class="op" id="6184949">.</span><span class="ident" id="6184950">Persistent</span>&nbsp;<span class="op" id="6184961">=</span>&nbsp;<span class="builtintype" id="6184963">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6184969">}</span>&nbsp;<span class="keyword" id="6184971">else</span>&nbsp;<span class="op" id="6184976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6184980">if</span>&nbsp;<span class="ident" id="6184983">c</span><span class="op" id="6184984">.</span><span class="ident" id="6184985">Expires</span><span class="op" id="6184992">.</span><span class="ident" id="6184993">IsZero</span><span class="op" id="6184999">(</span><span class="op" id="6185000">)</span>&nbsp;<span class="op" id="6185002">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6185007">e</span><span class="op" id="6185008">.</span><span class="ident" id="6185009">Expires</span>&nbsp;<span class="op" id="6185017">=</span>&nbsp;<span class="ident" id="6185019">endOfTime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6185032">e</span><span class="op" id="6185033">.</span><span class="ident" id="6185034">Persistent</span>&nbsp;<span class="op" id="6185045">=</span>&nbsp;<span class="builtintype" id="6185047">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6185055">}</span>&nbsp;<span class="keyword" id="6185057">else</span>&nbsp;<span class="op" id="6185062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6185067">if</span>&nbsp;<span class="op" id="6185070">!</span><span class="ident" id="6185071">c</span><span class="op" id="6185072">.</span><span class="ident" id="6185073">Expires</span><span class="op" id="6185080">.</span><span class="ident" id="6185081">After</span><span class="op" id="6185086">(</span><span class="ident" id="6185087">now</span><span class="op" id="6185090">)</span>&nbsp;<span class="op" id="6185092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6185098">return</span>&nbsp;<span class="ident" id="6185105">e</span><span class="op" id="6185106">,</span>&nbsp;<span class="builtintype" id="6185108">true</span><span class="op" id="6185112">,</span>&nbsp;<span class="ident" id="6185114">nil</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6185121">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6185126">e</span><span class="op" id="6185127">.</span><span class="ident" id="6185128">Expires</span>&nbsp;<span class="op" id="6185136">=</span>&nbsp;<span class="ident" id="6185138">c</span><span class="op" id="6185139">.</span><span class="ident" id="6185140">Expires</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6185151">e</span><span class="op" id="6185152">.</span><span class="ident" id="6185153">Persistent</span>&nbsp;<span class="op" id="6185164">=</span>&nbsp;<span class="builtintype" id="6185166">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6185173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6185176">}</span><br>
<span class="lineno">420</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6185180">e</span><span class="op" id="6185181">.</span><span class="ident" id="6185182">Value</span>&nbsp;<span class="op" id="6185188">=</span>&nbsp;<span class="ident" id="6185190">c</span><span class="op" id="6185191">.</span><span class="ident" id="6185192">Value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6185199">e</span><span class="op" id="6185200">.</span><span class="ident" id="6185201">Secure</span>&nbsp;<span class="op" id="6185208">=</span>&nbsp;<span class="ident" id="6185210">c</span><span class="op" id="6185211">.</span><span class="ident" id="6185212">Secure</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6185220">e</span><span class="op" id="6185221">.</span><span class="ident" id="6185222">HttpOnly</span>&nbsp;<span class="op" id="6185231">=</span>&nbsp;<span class="ident" id="6185233">c</span><span class="op" id="6185234">.</span><span class="ident" id="6185235">HttpOnly</span><br>
<span class="lineno"></span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6185246">return</span>&nbsp;<span class="ident" id="6185253">e</span><span class="op" id="6185254">,</span>&nbsp;<span class="builtintype" id="6185256">false</span><span class="op" id="6185261">,</span>&nbsp;<span class="ident" id="6185263">nil</span><br>
<span class="lineno"></span><span class="op" id="6185267">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6185270">var</span>&nbsp;<span class="op" id="6185274">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6185277">errIllegalDomain</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6185296">=</span>&nbsp;<span class="ident" id="6185298">errors</span><span class="op" id="6185304">.</span><span class="ident" id="6185305">New</span><span class="op" id="6185308">(</span><span class="string" id="6185309">&#34;cookiejar:&nbsp;illegal&nbsp;cookie&nbsp;domain&nbsp;attribute&#34;</span><span class="op" id="6185353">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6185356">errMalformedDomain</span>&nbsp;<span class="op" id="6185375">=</span>&nbsp;<span class="ident" id="6185377">errors</span><span class="op" id="6185383">.</span><span class="ident" id="6185384">New</span><span class="op" id="6185387">(</span><span class="string" id="6185388">&#34;cookiejar:&nbsp;malformed&nbsp;cookie&nbsp;domain&nbsp;attribute&#34;</span><span class="op" id="6185434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6185437">errNoHostname</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6185456">=</span>&nbsp;<span class="ident" id="6185458">errors</span><span class="op" id="6185464">.</span><span class="ident" id="6185465">New</span><span class="op" id="6185468">(</span><span class="string" id="6185469">&#34;cookiejar:&nbsp;no&nbsp;host&nbsp;name&nbsp;available&nbsp;(IP&nbsp;only)&#34;</span><span class="op" id="6185514">)</span><br>
<span class="lineno"></span><span class="op" id="6185516">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6185519">//&nbsp;endOfTime&nbsp;is&nbsp;the&nbsp;time&nbsp;when&nbsp;session&nbsp;(non-persistent)&nbsp;cookies&nbsp;expire.</span><br>
<span class="lineno">435</span><span class="comment" id="6185590">//&nbsp;This&nbsp;instant&nbsp;is&nbsp;representable&nbsp;in&nbsp;most&nbsp;date/time&nbsp;formats&nbsp;(not&nbsp;just</span><br>
<span class="lineno"></span><span class="comment" id="6185659">//&nbsp;Go&#39;s&nbsp;time.Time)&nbsp;and&nbsp;should&nbsp;be&nbsp;far&nbsp;enough&nbsp;in&nbsp;the&nbsp;future.</span><br>
<span class="lineno"></span><span class="keyword" id="6185718">var</span>&nbsp;<span class="ident" id="6185722">endOfTime</span>&nbsp;<span class="op" id="6185732">=</span>&nbsp;<span class="ident" id="6185734">time</span><span class="op" id="6185738">.</span><span class="ident" id="6185739">Date</span><span class="op" id="6185743">(</span><span class="num" id="6185744">9999</span><span class="op" id="6185748">,</span>&nbsp;<span class="num" id="6185750">12</span><span class="op" id="6185752">,</span>&nbsp;<span class="num" id="6185754">31</span><span class="op" id="6185756">,</span>&nbsp;<span class="num" id="6185758">23</span><span class="op" id="6185760">,</span>&nbsp;<span class="num" id="6185762">59</span><span class="op" id="6185764">,</span>&nbsp;<span class="num" id="6185766">59</span><span class="op" id="6185768">,</span>&nbsp;<span class="num" id="6185770">0</span><span class="op" id="6185771">,</span>&nbsp;<span class="ident" id="6185773">time</span><span class="op" id="6185777">.</span><span class="ident" id="6185778">UTC</span><span class="op" id="6185781">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6185784">//&nbsp;domainAndType&nbsp;determines&nbsp;the&nbsp;cookie&#39;s&nbsp;domain&nbsp;and&nbsp;hostOnly&nbsp;attribute.</span><br>
<span class="lineno">440</span><span class="keyword" id="6185856">func</span>&nbsp;<span class="op" id="6185861">(</span><span class="ident" id="6185862">j</span>&nbsp;<span class="op" id="6185864">*</span><span class="ident" id="6185865">Jar</span><span class="op" id="6185868">)</span>&nbsp;<span class="ident" id="6185870">domainAndType</span><span class="op" id="6185883">(</span><span class="ident" id="6185884">host</span><span class="op" id="6185888">,</span>&nbsp;<span class="ident" id="6185890">domain</span>&nbsp;<span class="builtintype" id="6185897">string</span><span class="op" id="6185903">)</span>&nbsp;<span class="op" id="6185905">(</span><span class="builtintype" id="6185906">string</span><span class="op" id="6185912">,</span>&nbsp;<span class="builtintype" id="6185914">bool</span><span class="op" id="6185918">,</span>&nbsp;<span class="builtintype" id="6185920">error</span><span class="op" id="6185925">)</span>&nbsp;<span class="op" id="6185927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6185930">if</span>&nbsp;<span class="ident" id="6185933">domain</span>&nbsp;<span class="op" id="6185940">==</span>&nbsp;<span class="string" id="6185943">&#34;&#34;</span>&nbsp;<span class="op" id="6185946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6185950">//&nbsp;No&nbsp;domain&nbsp;attribute&nbsp;in&nbsp;the&nbsp;SetCookie&nbsp;header&nbsp;indicates&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6186011">//&nbsp;host&nbsp;cookie.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6186029">return</span>&nbsp;<span class="ident" id="6186036">host</span><span class="op" id="6186040">,</span>&nbsp;<span class="builtintype" id="6186042">true</span><span class="op" id="6186046">,</span>&nbsp;<span class="ident" id="6186048">nil</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6186053">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6186057">if</span>&nbsp;<span class="ident" id="6186060">isIP</span><span class="op" id="6186064">(</span><span class="ident" id="6186065">host</span><span class="op" id="6186069">)</span>&nbsp;<span class="op" id="6186071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6186075">//&nbsp;According&nbsp;to&nbsp;RFC&nbsp;6265&nbsp;domain-matching&nbsp;includes&nbsp;not&nbsp;being</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6186137">//&nbsp;an&nbsp;IP&nbsp;address.</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6186157">//&nbsp;TODO:&nbsp;This&nbsp;might&nbsp;be&nbsp;relaxed&nbsp;as&nbsp;in&nbsp;common&nbsp;browsers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6186213">return</span>&nbsp;<span class="string" id="6186220">&#34;&#34;</span><span class="op" id="6186222">,</span>&nbsp;<span class="builtintype" id="6186224">false</span><span class="op" id="6186229">,</span>&nbsp;<span class="ident" id="6186231">errNoHostname</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6186246">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6186250">//&nbsp;From&nbsp;here&nbsp;on:&nbsp;If&nbsp;the&nbsp;cookie&nbsp;is&nbsp;valid,&nbsp;it&nbsp;is&nbsp;a&nbsp;domain&nbsp;cookie&nbsp;(with</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6186320">//&nbsp;the&nbsp;one&nbsp;exception&nbsp;of&nbsp;a&nbsp;public&nbsp;suffix&nbsp;below).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6186369">//&nbsp;See&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.2.3.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6186401">if</span>&nbsp;<span class="ident" id="6186404">domain</span><span class="op" id="6186410">[</span><span class="num" id="6186411">0</span><span class="op" id="6186412">]</span>&nbsp;<span class="op" id="6186414">==</span>&nbsp;<span class="string" id="6186417">&#39;.&#39;</span>&nbsp;<span class="op" id="6186421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6186425">domain</span>&nbsp;<span class="op" id="6186432">=</span>&nbsp;<span class="ident" id="6186434">domain</span><span class="op" id="6186440">[</span><span class="num" id="6186441">1</span><span class="op" id="6186442">:</span><span class="op" id="6186443">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6186446">}</span><br>
<span class="lineno">460</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6186450">if</span>&nbsp;<span class="builtinfunc" id="6186453">len</span><span class="op" id="6186456">(</span><span class="ident" id="6186457">domain</span><span class="op" id="6186463">)</span>&nbsp;<span class="op" id="6186465">==</span>&nbsp;<span class="num" id="6186468">0</span>&nbsp;<span class="op" id="6186470">||</span>&nbsp;<span class="ident" id="6186473">domain</span><span class="op" id="6186479">[</span><span class="num" id="6186480">0</span><span class="op" id="6186481">]</span>&nbsp;<span class="op" id="6186483">==</span>&nbsp;<span class="string" id="6186486">&#39;.&#39;</span>&nbsp;<span class="op" id="6186490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6186494">//&nbsp;Received&nbsp;either&nbsp;&#34;Domain=.&#34;&nbsp;or&nbsp;&#34;Domain=..some.thing&#34;,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6186552">//&nbsp;both&nbsp;are&nbsp;illegal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6186575">return</span>&nbsp;<span class="string" id="6186582">&#34;&#34;</span><span class="op" id="6186584">,</span>&nbsp;<span class="builtintype" id="6186586">false</span><span class="op" id="6186591">,</span>&nbsp;<span class="ident" id="6186593">errMalformedDomain</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6186613">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6186616">domain</span>&nbsp;<span class="op" id="6186623">=</span>&nbsp;<span class="ident" id="6186625">strings</span><span class="op" id="6186632">.</span><span class="ident" id="6186633">ToLower</span><span class="op" id="6186640">(</span><span class="ident" id="6186641">domain</span><span class="op" id="6186647">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6186651">if</span>&nbsp;<span class="ident" id="6186654">domain</span><span class="op" id="6186660">[</span><span class="builtinfunc" id="6186661">len</span><span class="op" id="6186664">(</span><span class="ident" id="6186665">domain</span><span class="op" id="6186671">)</span><span class="op" id="6186672">-</span><span class="num" id="6186673">1</span><span class="op" id="6186674">]</span>&nbsp;<span class="op" id="6186676">==</span>&nbsp;<span class="string" id="6186679">&#39;.&#39;</span>&nbsp;<span class="op" id="6186683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6186687">//&nbsp;We&nbsp;received&nbsp;stuff&nbsp;like&nbsp;&#34;Domain=www.example.com.&#34;.</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6186742">//&nbsp;Browsers&nbsp;do&nbsp;handle&nbsp;such&nbsp;stuff&nbsp;(actually&nbsp;differently)&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6186804">//&nbsp;RFC&nbsp;6265&nbsp;seems&nbsp;to&nbsp;be&nbsp;clear&nbsp;here&nbsp;(e.g.&nbsp;section&nbsp;4.1.2.3)&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6186867">//&nbsp;requiring&nbsp;a&nbsp;reject.&nbsp;&nbsp;4.1.2.3&nbsp;is&nbsp;not&nbsp;normative,&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6186923">//&nbsp;&#34;Domain&nbsp;Matching&#34;&nbsp;(5.1.3)&nbsp;and&nbsp;&#34;Canonicalized&nbsp;Host&nbsp;Names&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6186985">//&nbsp;(5.1.2)&nbsp;are.</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6187003">return</span>&nbsp;<span class="string" id="6187010">&#34;&#34;</span><span class="op" id="6187012">,</span>&nbsp;<span class="builtintype" id="6187014">false</span><span class="op" id="6187019">,</span>&nbsp;<span class="ident" id="6187021">errMalformedDomain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6187041">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6187045">//&nbsp;See&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.3&nbsp;#5.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6187078">if</span>&nbsp;<span class="ident" id="6187081">j</span><span class="op" id="6187082">.</span><span class="ident" id="6187083">psList</span>&nbsp;<span class="op" id="6187090">!=</span>&nbsp;<span class="ident" id="6187093">nil</span>&nbsp;<span class="op" id="6187097">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6187101">if</span>&nbsp;<span class="ident" id="6187104">ps</span>&nbsp;<span class="op" id="6187107">:=</span>&nbsp;<span class="ident" id="6187110">j</span><span class="op" id="6187111">.</span><span class="ident" id="6187112">psList</span><span class="op" id="6187118">.</span><span class="ident" id="6187119">PublicSuffix</span><span class="op" id="6187131">(</span><span class="ident" id="6187132">domain</span><span class="op" id="6187138">)</span><span class="op" id="6187139">;</span>&nbsp;<span class="ident" id="6187141">ps</span>&nbsp;<span class="op" id="6187144">!=</span>&nbsp;<span class="string" id="6187147">&#34;&#34;</span>&nbsp;<span class="op" id="6187150">&amp;&amp;</span>&nbsp;<span class="op" id="6187153">!</span><span class="ident" id="6187154">hasDotSuffix</span><span class="op" id="6187166">(</span><span class="ident" id="6187167">domain</span><span class="op" id="6187173">,</span>&nbsp;<span class="ident" id="6187175">ps</span><span class="op" id="6187177">)</span>&nbsp;<span class="op" id="6187179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6187184">if</span>&nbsp;<span class="ident" id="6187187">host</span>&nbsp;<span class="op" id="6187192">==</span>&nbsp;<span class="ident" id="6187195">domain</span>&nbsp;<span class="op" id="6187202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6187208">//&nbsp;This&nbsp;is&nbsp;the&nbsp;one&nbsp;exception&nbsp;in&nbsp;which&nbsp;a&nbsp;cookie</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6187259">//&nbsp;with&nbsp;a&nbsp;domain&nbsp;attribute&nbsp;is&nbsp;a&nbsp;host&nbsp;cookie.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6187308">return</span>&nbsp;<span class="ident" id="6187315">host</span><span class="op" id="6187319">,</span>&nbsp;<span class="builtintype" id="6187321">true</span><span class="op" id="6187325">,</span>&nbsp;<span class="ident" id="6187327">nil</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6187334">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6187339">return</span>&nbsp;<span class="string" id="6187346">&#34;&#34;</span><span class="op" id="6187348">,</span>&nbsp;<span class="builtintype" id="6187350">false</span><span class="op" id="6187355">,</span>&nbsp;<span class="ident" id="6187357">errIllegalDomain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6187376">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6187379">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6187383">//&nbsp;The&nbsp;domain&nbsp;must&nbsp;domain-match&nbsp;host:&nbsp;www.mycompany.com&nbsp;cannot</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6187447">//&nbsp;set&nbsp;cookies&nbsp;for&nbsp;.ourcompetitors.com.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6187488">if</span>&nbsp;<span class="ident" id="6187491">host</span>&nbsp;<span class="op" id="6187496">!=</span>&nbsp;<span class="ident" id="6187499">domain</span>&nbsp;<span class="op" id="6187506">&amp;&amp;</span>&nbsp;<span class="op" id="6187509">!</span><span class="ident" id="6187510">hasDotSuffix</span><span class="op" id="6187522">(</span><span class="ident" id="6187523">host</span><span class="op" id="6187527">,</span>&nbsp;<span class="ident" id="6187529">domain</span><span class="op" id="6187535">)</span>&nbsp;<span class="op" id="6187537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6187541">return</span>&nbsp;<span class="string" id="6187548">&#34;&#34;</span><span class="op" id="6187550">,</span>&nbsp;<span class="builtintype" id="6187552">false</span><span class="op" id="6187557">,</span>&nbsp;<span class="ident" id="6187559">errIllegalDomain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6187577">}</span><br>
<span class="lineno">495</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6187581">return</span>&nbsp;<span class="ident" id="6187588">domain</span><span class="op" id="6187594">,</span>&nbsp;<span class="builtintype" id="6187596">false</span><span class="op" id="6187601">,</span>&nbsp;<span class="ident" id="6187603">nil</span><br>
<span class="lineno"></span><span class="op" id="6187607">}</span>
</div>
</body>
</html>
