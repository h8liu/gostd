<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/tar</h2>
<ul>
<li><a href="/gostd/archive/tar/common.go.html">common.go</a></li>
<li><a href="/gostd/archive/tar/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/tar/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/tar/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/tar/stat_atim.go.html">stat_atim.go</a></li>
<li><a href="/gostd/archive/tar/stat_unix.go.html">stat_unix.go</a></li>
<li><a href="/gostd/archive/tar/tar_test.go.html">tar_test.go</a></li>
<li><a href="/gostd/archive/tar/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/tar/writer_test.go.html" class="current">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6429029">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6429084">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6429138">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6429189">package</span>&nbsp;<span class="ident" id="6429197">tar</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6429202">import</span>&nbsp;<span class="op" id="6429209">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6429212">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6429221">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6429228">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6429234">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6429247">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6429253">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6429264">&#34;strings&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6429275">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6429286">&#34;testing/iotest&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6429304">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6429311">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="6429314">type</span>&nbsp;<span class="ident" id="6429319">writerTestEntry</span>&nbsp;<span class="keyword" id="6429335">struct</span>&nbsp;<span class="op" id="6429342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6429345">header</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6429354">*</span><span class="ident" id="6429355">Header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6429363">contents</span>&nbsp;<span class="builtintype" id="6429372">string</span><br>
<span class="lineno"></span><span class="op" id="6429379">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="6429382">type</span>&nbsp;<span class="ident" id="6429387">writerTest</span>&nbsp;<span class="keyword" id="6429398">struct</span>&nbsp;<span class="op" id="6429405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6429408">file</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6429416">string</span>&nbsp;<span class="comment" id="6429423">//&nbsp;filename&nbsp;of&nbsp;expected&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6429455">entries</span>&nbsp;<span class="op" id="6429463">[</span><span class="op" id="6429464">]</span><span class="op" id="6429465">*</span><span class="ident" id="6429466">writerTestEntry</span><br>
<span class="lineno"></span><span class="op" id="6429482">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="6429485">var</span>&nbsp;<span class="ident" id="6429489">writerTests</span>&nbsp;<span class="op" id="6429501">=</span>&nbsp;<span class="op" id="6429503">[</span><span class="op" id="6429504">]</span><span class="op" id="6429505">*</span><span class="ident" id="6429506">writerTest</span><span class="op" id="6429516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6429519">//&nbsp;The&nbsp;writer&nbsp;test&nbsp;file&nbsp;was&nbsp;produced&nbsp;with&nbsp;this&nbsp;command:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6429576">//&nbsp;tar&nbsp;(GNU&nbsp;tar)&nbsp;1.26</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6429599">//&nbsp;&nbsp;&nbsp;ln&nbsp;-s&nbsp;small.txt&nbsp;link.txt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6429630">//&nbsp;&nbsp;&nbsp;tar&nbsp;-b&nbsp;1&nbsp;--format=ustar&nbsp;-c&nbsp;-f&nbsp;writer.tar&nbsp;small.txt&nbsp;small2.txt&nbsp;link.txt</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6429707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6429711">file</span><span class="op" id="6429715">:</span>&nbsp;<span class="string" id="6429717">&#34;testdata/writer.tar&#34;</span><span class="op" id="6429738">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6429742">entries</span><span class="op" id="6429749">:</span>&nbsp;<span class="op" id="6429751">[</span><span class="op" id="6429752">]</span><span class="op" id="6429753">*</span><span class="ident" id="6429754">writerTestEntry</span><span class="op" id="6429769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6429774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6429780">header</span><span class="op" id="6429786">:</span>&nbsp;<span class="op" id="6429788">&amp;</span><span class="ident" id="6429789">Header</span><span class="op" id="6429795">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6429802">Name</span><span class="op" id="6429806">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6429812">&#34;small.txt&#34;</span><span class="op" id="6429823">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6429830">Mode</span><span class="op" id="6429834">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6429840">0640</span><span class="op" id="6429844">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6429851">Uid</span><span class="op" id="6429854">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6429861">73025</span><span class="op" id="6429866">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6429873">Gid</span><span class="op" id="6429876">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6429883">5000</span><span class="op" id="6429887">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6429894">Size</span><span class="op" id="6429898">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6429904">5</span><span class="op" id="6429905">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6429912">ModTime</span><span class="op" id="6429919">:</span>&nbsp;&nbsp;<span class="ident" id="6429922">time</span><span class="op" id="6429926">.</span><span class="ident" id="6429927">Unix</span><span class="op" id="6429931">(</span><span class="num" id="6429932">1246508266</span><span class="op" id="6429942">,</span>&nbsp;<span class="num" id="6429944">0</span><span class="op" id="6429945">)</span><span class="op" id="6429946">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6429953">Typeflag</span><span class="op" id="6429961">:</span>&nbsp;<span class="string" id="6429963">&#39;0&#39;</span><span class="op" id="6429966">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6429973">Uname</span><span class="op" id="6429978">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6429983">&#34;dsymonds&#34;</span><span class="op" id="6429993">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6430000">Gname</span><span class="op" id="6430005">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6430010">&#34;eng&#34;</span><span class="op" id="6430015">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6430021">}</span><span class="op" id="6430022">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6430028">contents</span><span class="op" id="6430036">:</span>&nbsp;<span class="string" id="6430038">&#34;Kilts&#34;</span><span class="op" id="6430045">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6430050">}</span><span class="op" id="6430051">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6430056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6430062">header</span><span class="op" id="6430068">:</span>&nbsp;<span class="op" id="6430070">&amp;</span><span class="ident" id="6430071">Header</span><span class="op" id="6430077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6430084">Name</span><span class="op" id="6430088">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6430094">&#34;small2.txt&#34;</span><span class="op" id="6430106">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6430113">Mode</span><span class="op" id="6430117">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6430123">0640</span><span class="op" id="6430127">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6430134">Uid</span><span class="op" id="6430137">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6430144">73025</span><span class="op" id="6430149">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6430156">Gid</span><span class="op" id="6430159">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6430166">5000</span><span class="op" id="6430170">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6430177">Size</span><span class="op" id="6430181">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6430187">11</span><span class="op" id="6430189">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6430196">ModTime</span><span class="op" id="6430203">:</span>&nbsp;&nbsp;<span class="ident" id="6430206">time</span><span class="op" id="6430210">.</span><span class="ident" id="6430211">Unix</span><span class="op" id="6430215">(</span><span class="num" id="6430216">1245217492</span><span class="op" id="6430226">,</span>&nbsp;<span class="num" id="6430228">0</span><span class="op" id="6430229">)</span><span class="op" id="6430230">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6430237">Typeflag</span><span class="op" id="6430245">:</span>&nbsp;<span class="string" id="6430247">&#39;0&#39;</span><span class="op" id="6430250">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6430257">Uname</span><span class="op" id="6430262">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6430267">&#34;dsymonds&#34;</span><span class="op" id="6430277">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6430284">Gname</span><span class="op" id="6430289">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6430294">&#34;eng&#34;</span><span class="op" id="6430299">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6430305">}</span><span class="op" id="6430306">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6430312">contents</span><span class="op" id="6430320">:</span>&nbsp;<span class="string" id="6430322">&#34;Google.com\n&#34;</span><span class="op" id="6430336">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6430341">}</span><span class="op" id="6430342">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6430347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6430353">header</span><span class="op" id="6430359">:</span>&nbsp;<span class="op" id="6430361">&amp;</span><span class="ident" id="6430362">Header</span><span class="op" id="6430368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6430375">Name</span><span class="op" id="6430379">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6430385">&#34;link.txt&#34;</span><span class="op" id="6430395">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6430402">Mode</span><span class="op" id="6430406">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6430412">0777</span><span class="op" id="6430416">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6430423">Uid</span><span class="op" id="6430426">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6430433">1000</span><span class="op" id="6430437">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6430444">Gid</span><span class="op" id="6430447">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6430454">1000</span><span class="op" id="6430458">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6430465">Size</span><span class="op" id="6430469">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6430475">0</span><span class="op" id="6430476">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6430483">ModTime</span><span class="op" id="6430490">:</span>&nbsp;&nbsp;<span class="ident" id="6430493">time</span><span class="op" id="6430497">.</span><span class="ident" id="6430498">Unix</span><span class="op" id="6430502">(</span><span class="num" id="6430503">1314603082</span><span class="op" id="6430513">,</span>&nbsp;<span class="num" id="6430515">0</span><span class="op" id="6430516">)</span><span class="op" id="6430517">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6430524">Typeflag</span><span class="op" id="6430532">:</span>&nbsp;<span class="string" id="6430534">&#39;2&#39;</span><span class="op" id="6430537">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6430544">Linkname</span><span class="op" id="6430552">:</span>&nbsp;<span class="string" id="6430554">&#34;small.txt&#34;</span><span class="op" id="6430565">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6430572">Uname</span><span class="op" id="6430577">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6430582">&#34;strings&#34;</span><span class="op" id="6430591">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6430598">Gname</span><span class="op" id="6430603">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6430608">&#34;strings&#34;</span><span class="op" id="6430617">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6430623">}</span><span class="op" id="6430624">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6430630">//&nbsp;no&nbsp;contents</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6430648">}</span><span class="op" id="6430649">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6430653">}</span><span class="op" id="6430654">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6430657">}</span><span class="op" id="6430658">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6430661">//&nbsp;The&nbsp;truncated&nbsp;test&nbsp;file&nbsp;was&nbsp;produced&nbsp;using&nbsp;these&nbsp;commands:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6430724">//&nbsp;&nbsp;&nbsp;dd&nbsp;if=/dev/zero&nbsp;bs=1048576&nbsp;count=16384&nbsp;&gt;&nbsp;/tmp/16gig.txt</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6430786">//&nbsp;&nbsp;&nbsp;tar&nbsp;-b&nbsp;1&nbsp;-c&nbsp;-f-&nbsp;/tmp/16gig.txt&nbsp;|&nbsp;dd&nbsp;bs=512&nbsp;count=8&nbsp;&gt;&nbsp;writer-big.tar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6430860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6430864">file</span><span class="op" id="6430868">:</span>&nbsp;<span class="string" id="6430870">&#34;testdata/writer-big.tar&#34;</span><span class="op" id="6430895">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6430899">entries</span><span class="op" id="6430906">:</span>&nbsp;<span class="op" id="6430908">[</span><span class="op" id="6430909">]</span><span class="op" id="6430910">*</span><span class="ident" id="6430911">writerTestEntry</span><span class="op" id="6430926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6430931">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6430937">header</span><span class="op" id="6430943">:</span>&nbsp;<span class="op" id="6430945">&amp;</span><span class="ident" id="6430946">Header</span><span class="op" id="6430952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6430959">Name</span><span class="op" id="6430963">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6430969">&#34;tmp/16gig.txt&#34;</span><span class="op" id="6430984">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6430991">Mode</span><span class="op" id="6430995">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6431001">0640</span><span class="op" id="6431005">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6431012">Uid</span><span class="op" id="6431015">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6431022">73025</span><span class="op" id="6431027">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6431034">Gid</span><span class="op" id="6431037">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6431044">5000</span><span class="op" id="6431048">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6431055">Size</span><span class="op" id="6431059">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6431065">16</span>&nbsp;<span class="op" id="6431068">&lt;&lt;</span>&nbsp;<span class="num" id="6431071">30</span><span class="op" id="6431073">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6431080">ModTime</span><span class="op" id="6431087">:</span>&nbsp;&nbsp;<span class="ident" id="6431090">time</span><span class="op" id="6431094">.</span><span class="ident" id="6431095">Unix</span><span class="op" id="6431099">(</span><span class="num" id="6431100">1254699560</span><span class="op" id="6431110">,</span>&nbsp;<span class="num" id="6431112">0</span><span class="op" id="6431113">)</span><span class="op" id="6431114">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6431121">Typeflag</span><span class="op" id="6431129">:</span>&nbsp;<span class="string" id="6431131">&#39;0&#39;</span><span class="op" id="6431134">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6431141">Uname</span><span class="op" id="6431146">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6431151">&#34;dsymonds&#34;</span><span class="op" id="6431161">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6431168">Gname</span><span class="op" id="6431173">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6431178">&#34;eng&#34;</span><span class="op" id="6431183">,</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6431189">}</span><span class="op" id="6431190">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6431196">//&nbsp;fake&nbsp;contents</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6431217">contents</span><span class="op" id="6431225">:</span>&nbsp;<span class="ident" id="6431227">strings</span><span class="op" id="6431234">.</span><span class="ident" id="6431235">Repeat</span><span class="op" id="6431241">(</span><span class="string" id="6431242">&#34;\x00&#34;</span><span class="op" id="6431248">,</span>&nbsp;<span class="num" id="6431250">4</span><span class="op" id="6431251">&lt;&lt;</span><span class="num" id="6431253">10</span><span class="op" id="6431255">)</span><span class="op" id="6431256">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6431261">}</span><span class="op" id="6431262">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6431266">}</span><span class="op" id="6431267">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6431270">}</span><span class="op" id="6431271">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6431274">//&nbsp;The&nbsp;truncated&nbsp;test&nbsp;file&nbsp;was&nbsp;produced&nbsp;using&nbsp;these&nbsp;commands:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6431337">//&nbsp;&nbsp;&nbsp;dd&nbsp;if=/dev/zero&nbsp;bs=1048576&nbsp;count=16384&nbsp;&gt;&nbsp;(longname/)*15&nbsp;/16gig.txt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6431410">//&nbsp;&nbsp;&nbsp;tar&nbsp;-b&nbsp;1&nbsp;-c&nbsp;-f-&nbsp;(longname/)*15&nbsp;/16gig.txt&nbsp;|&nbsp;dd&nbsp;bs=512&nbsp;count=8&nbsp;&gt;&nbsp;writer-big-long.tar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6431500">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6431504">file</span><span class="op" id="6431508">:</span>&nbsp;<span class="string" id="6431510">&#34;testdata/writer-big-long.tar&#34;</span><span class="op" id="6431540">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6431544">entries</span><span class="op" id="6431551">:</span>&nbsp;<span class="op" id="6431553">[</span><span class="op" id="6431554">]</span><span class="op" id="6431555">*</span><span class="ident" id="6431556">writerTestEntry</span><span class="op" id="6431571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6431576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6431582">header</span><span class="op" id="6431588">:</span>&nbsp;<span class="op" id="6431590">&amp;</span><span class="ident" id="6431591">Header</span><span class="op" id="6431597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6431604">Name</span><span class="op" id="6431608">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6431614">strings</span><span class="op" id="6431621">.</span><span class="ident" id="6431622">Repeat</span><span class="op" id="6431628">(</span><span class="string" id="6431629">&#34;longname/&#34;</span><span class="op" id="6431640">,</span>&nbsp;<span class="num" id="6431642">15</span><span class="op" id="6431644">)</span>&nbsp;<span class="op" id="6431646">+</span>&nbsp;<span class="string" id="6431648">&#34;16gig.txt&#34;</span><span class="op" id="6431659">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6431666">Mode</span><span class="op" id="6431670">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6431676">0644</span><span class="op" id="6431680">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6431687">Uid</span><span class="op" id="6431690">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6431697">1000</span><span class="op" id="6431701">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6431708">Gid</span><span class="op" id="6431711">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6431718">1000</span><span class="op" id="6431722">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6431729">Size</span><span class="op" id="6431733">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6431739">16</span>&nbsp;<span class="op" id="6431742">&lt;&lt;</span>&nbsp;<span class="num" id="6431745">30</span><span class="op" id="6431747">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6431754">ModTime</span><span class="op" id="6431761">:</span>&nbsp;&nbsp;<span class="ident" id="6431764">time</span><span class="op" id="6431768">.</span><span class="ident" id="6431769">Unix</span><span class="op" id="6431773">(</span><span class="num" id="6431774">1399583047</span><span class="op" id="6431784">,</span>&nbsp;<span class="num" id="6431786">0</span><span class="op" id="6431787">)</span><span class="op" id="6431788">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6431795">Typeflag</span><span class="op" id="6431803">:</span>&nbsp;<span class="string" id="6431805">&#39;0&#39;</span><span class="op" id="6431808">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6431815">Uname</span><span class="op" id="6431820">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6431825">&#34;guillaume&#34;</span><span class="op" id="6431836">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6431843">Gname</span><span class="op" id="6431848">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6431853">&#34;guillaume&#34;</span><span class="op" id="6431864">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6431870">}</span><span class="op" id="6431871">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6431877">//&nbsp;fake&nbsp;contents</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6431898">contents</span><span class="op" id="6431906">:</span>&nbsp;<span class="ident" id="6431908">strings</span><span class="op" id="6431915">.</span><span class="ident" id="6431916">Repeat</span><span class="op" id="6431922">(</span><span class="string" id="6431923">&#34;\x00&#34;</span><span class="op" id="6431929">,</span>&nbsp;<span class="num" id="6431931">4</span><span class="op" id="6431932">&lt;&lt;</span><span class="num" id="6431934">10</span><span class="op" id="6431936">)</span><span class="op" id="6431937">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6431942">}</span><span class="op" id="6431943">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6431947">}</span><span class="op" id="6431948">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6431951">}</span><span class="op" id="6431952">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6431955">//&nbsp;This&nbsp;file&nbsp;was&nbsp;produced&nbsp;using&nbsp;gnu&nbsp;tar&nbsp;1.17</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6432001">//&nbsp;gnutar&nbsp;&nbsp;-b&nbsp;4&nbsp;--format=ustar&nbsp;(longname/)*15&nbsp;+&nbsp;file.txt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6432059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6432063">file</span><span class="op" id="6432067">:</span>&nbsp;<span class="string" id="6432069">&#34;testdata/ustar.tar&#34;</span><span class="op" id="6432089">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6432093">entries</span><span class="op" id="6432100">:</span>&nbsp;<span class="op" id="6432102">[</span><span class="op" id="6432103">]</span><span class="op" id="6432104">*</span><span class="ident" id="6432105">writerTestEntry</span><span class="op" id="6432120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6432125">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6432131">header</span><span class="op" id="6432137">:</span>&nbsp;<span class="op" id="6432139">&amp;</span><span class="ident" id="6432140">Header</span><span class="op" id="6432146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6432153">Name</span><span class="op" id="6432157">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6432163">strings</span><span class="op" id="6432170">.</span><span class="ident" id="6432171">Repeat</span><span class="op" id="6432177">(</span><span class="string" id="6432178">&#34;longname/&#34;</span><span class="op" id="6432189">,</span>&nbsp;<span class="num" id="6432191">15</span><span class="op" id="6432193">)</span>&nbsp;<span class="op" id="6432195">+</span>&nbsp;<span class="string" id="6432197">&#34;file.txt&#34;</span><span class="op" id="6432207">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6432214">Mode</span><span class="op" id="6432218">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6432224">0644</span><span class="op" id="6432228">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6432235">Uid</span><span class="op" id="6432238">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6432245">0765</span><span class="op" id="6432249">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6432256">Gid</span><span class="op" id="6432259">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6432266">024</span><span class="op" id="6432269">,</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6432276">Size</span><span class="op" id="6432280">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6432286">06</span><span class="op" id="6432288">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6432295">ModTime</span><span class="op" id="6432302">:</span>&nbsp;&nbsp;<span class="ident" id="6432305">time</span><span class="op" id="6432309">.</span><span class="ident" id="6432310">Unix</span><span class="op" id="6432314">(</span><span class="num" id="6432315">1360135598</span><span class="op" id="6432325">,</span>&nbsp;<span class="num" id="6432327">0</span><span class="op" id="6432328">)</span><span class="op" id="6432329">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6432336">Typeflag</span><span class="op" id="6432344">:</span>&nbsp;<span class="string" id="6432346">&#39;0&#39;</span><span class="op" id="6432349">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6432356">Uname</span><span class="op" id="6432361">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6432366">&#34;shane&#34;</span><span class="op" id="6432373">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6432380">Gname</span><span class="op" id="6432385">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6432390">&#34;staff&#34;</span><span class="op" id="6432397">,</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6432403">}</span><span class="op" id="6432404">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6432410">contents</span><span class="op" id="6432418">:</span>&nbsp;<span class="string" id="6432420">&#34;hello\n&#34;</span><span class="op" id="6432429">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6432434">}</span><span class="op" id="6432435">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6432439">}</span><span class="op" id="6432440">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6432443">}</span><span class="op" id="6432444">,</span><br>
<span class="lineno">150</span><span class="op" id="6432446">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6432449">//&nbsp;Render&nbsp;byte&nbsp;array&nbsp;in&nbsp;a&nbsp;two-character&nbsp;hexadecimal&nbsp;string,&nbsp;spaced&nbsp;for&nbsp;easy&nbsp;visual&nbsp;inspection.</span><br>
<span class="lineno"></span><span class="keyword" id="6432544">func</span>&nbsp;<span class="ident" id="6432549">bytestr</span><span class="op" id="6432556">(</span><span class="ident" id="6432557">offset</span>&nbsp;<span class="builtintype" id="6432564">int</span><span class="op" id="6432567">,</span>&nbsp;<span class="ident" id="6432569">b</span>&nbsp;<span class="op" id="6432571">[</span><span class="op" id="6432572">]</span><span class="builtintype" id="6432573">byte</span><span class="op" id="6432577">)</span>&nbsp;<span class="builtintype" id="6432579">string</span>&nbsp;<span class="op" id="6432586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6432589">const</span>&nbsp;<span class="ident" id="6432595">rowLen</span>&nbsp;<span class="op" id="6432602">=</span>&nbsp;<span class="num" id="6432604">32</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6432608">s</span>&nbsp;<span class="op" id="6432610">:=</span>&nbsp;<span class="ident" id="6432613">fmt</span><span class="op" id="6432616">.</span><span class="ident" id="6432617">Sprintf</span><span class="op" id="6432624">(</span><span class="string" id="6432625">&#34;%04x&nbsp;&#34;</span><span class="op" id="6432632">,</span>&nbsp;<span class="ident" id="6432634">offset</span><span class="op" id="6432640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6432643">for</span>&nbsp;<span class="ident" id="6432647">_</span><span class="op" id="6432648">,</span>&nbsp;<span class="ident" id="6432650">ch</span>&nbsp;<span class="op" id="6432653">:=</span>&nbsp;<span class="keyword" id="6432656">range</span>&nbsp;<span class="ident" id="6432662">b</span>&nbsp;<span class="op" id="6432664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6432668">switch</span>&nbsp;<span class="op" id="6432675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6432679">case</span>&nbsp;<span class="string" id="6432684">&#39;0&#39;</span>&nbsp;<span class="op" id="6432688">&lt;=</span>&nbsp;<span class="ident" id="6432691">ch</span>&nbsp;<span class="op" id="6432694">&amp;&amp;</span>&nbsp;<span class="ident" id="6432697">ch</span>&nbsp;<span class="op" id="6432700">&lt;=</span>&nbsp;<span class="string" id="6432703">&#39;9&#39;</span><span class="op" id="6432706">,</span>&nbsp;<span class="string" id="6432708">&#39;A&#39;</span>&nbsp;<span class="op" id="6432712">&lt;=</span>&nbsp;<span class="ident" id="6432715">ch</span>&nbsp;<span class="op" id="6432718">&amp;&amp;</span>&nbsp;<span class="ident" id="6432721">ch</span>&nbsp;<span class="op" id="6432724">&lt;=</span>&nbsp;<span class="string" id="6432727">&#39;Z&#39;</span><span class="op" id="6432730">,</span>&nbsp;<span class="string" id="6432732">&#39;a&#39;</span>&nbsp;<span class="op" id="6432736">&lt;=</span>&nbsp;<span class="ident" id="6432739">ch</span>&nbsp;<span class="op" id="6432742">&amp;&amp;</span>&nbsp;<span class="ident" id="6432745">ch</span>&nbsp;<span class="op" id="6432748">&lt;=</span>&nbsp;<span class="string" id="6432751">&#39;z&#39;</span><span class="op" id="6432754">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6432759">s</span>&nbsp;<span class="op" id="6432761">+=</span>&nbsp;<span class="ident" id="6432764">fmt</span><span class="op" id="6432767">.</span><span class="ident" id="6432768">Sprintf</span><span class="op" id="6432775">(</span><span class="string" id="6432776">&#34;&nbsp;&nbsp;%c&#34;</span><span class="op" id="6432782">,</span>&nbsp;<span class="ident" id="6432784">ch</span><span class="op" id="6432786">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6432790">default</span><span class="op" id="6432797">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6432802">s</span>&nbsp;<span class="op" id="6432804">+=</span>&nbsp;<span class="ident" id="6432807">fmt</span><span class="op" id="6432810">.</span><span class="ident" id="6432811">Sprintf</span><span class="op" id="6432818">(</span><span class="string" id="6432819">&#34;&nbsp;%02x&#34;</span><span class="op" id="6432826">,</span>&nbsp;<span class="ident" id="6432828">ch</span><span class="op" id="6432830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6432834">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6432837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6432840">return</span>&nbsp;<span class="ident" id="6432847">s</span><br>
<span class="lineno">165</span><span class="op" id="6432849">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6432852">//&nbsp;Render&nbsp;a&nbsp;pseudo-diff&nbsp;between&nbsp;two&nbsp;blocks&nbsp;of&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="6432905">func</span>&nbsp;<span class="ident" id="6432910">bytediff</span><span class="op" id="6432918">(</span><span class="ident" id="6432919">a</span>&nbsp;<span class="op" id="6432921">[</span><span class="op" id="6432922">]</span><span class="builtintype" id="6432923">byte</span><span class="op" id="6432927">,</span>&nbsp;<span class="ident" id="6432929">b</span>&nbsp;<span class="op" id="6432931">[</span><span class="op" id="6432932">]</span><span class="builtintype" id="6432933">byte</span><span class="op" id="6432937">)</span>&nbsp;<span class="builtintype" id="6432939">string</span>&nbsp;<span class="op" id="6432946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6432949">const</span>&nbsp;<span class="ident" id="6432955">rowLen</span>&nbsp;<span class="op" id="6432962">=</span>&nbsp;<span class="num" id="6432964">32</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6432968">s</span>&nbsp;<span class="op" id="6432970">:=</span>&nbsp;<span class="ident" id="6432973">fmt</span><span class="op" id="6432976">.</span><span class="ident" id="6432977">Sprintf</span><span class="op" id="6432984">(</span><span class="string" id="6432985">&#34;(%d&nbsp;bytes&nbsp;vs.&nbsp;%d&nbsp;bytes)\n&#34;</span><span class="op" id="6433012">,</span>&nbsp;<span class="builtinfunc" id="6433014">len</span><span class="op" id="6433017">(</span><span class="ident" id="6433018">a</span><span class="op" id="6433019">)</span><span class="op" id="6433020">,</span>&nbsp;<span class="builtinfunc" id="6433022">len</span><span class="op" id="6433025">(</span><span class="ident" id="6433026">b</span><span class="op" id="6433027">)</span><span class="op" id="6433028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6433031">for</span>&nbsp;<span class="ident" id="6433035">offset</span>&nbsp;<span class="op" id="6433042">:=</span>&nbsp;<span class="num" id="6433045">0</span><span class="op" id="6433046">;</span>&nbsp;<span class="builtinfunc" id="6433048">len</span><span class="op" id="6433051">(</span><span class="ident" id="6433052">a</span><span class="op" id="6433053">)</span><span class="op" id="6433054">+</span><span class="builtinfunc" id="6433055">len</span><span class="op" id="6433058">(</span><span class="ident" id="6433059">b</span><span class="op" id="6433060">)</span>&nbsp;<span class="op" id="6433062">&gt;</span>&nbsp;<span class="num" id="6433064">0</span><span class="op" id="6433065">;</span>&nbsp;<span class="ident" id="6433067">offset</span>&nbsp;<span class="op" id="6433074">+=</span>&nbsp;<span class="ident" id="6433077">rowLen</span>&nbsp;<span class="op" id="6433084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6433088">na</span><span class="op" id="6433090">,</span>&nbsp;<span class="ident" id="6433092">nb</span>&nbsp;<span class="op" id="6433095">:=</span>&nbsp;<span class="ident" id="6433098">rowLen</span><span class="op" id="6433104">,</span>&nbsp;<span class="ident" id="6433106">rowLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6433115">if</span>&nbsp;<span class="ident" id="6433118">na</span>&nbsp;<span class="op" id="6433121">&gt;</span>&nbsp;<span class="builtinfunc" id="6433123">len</span><span class="op" id="6433126">(</span><span class="ident" id="6433127">a</span><span class="op" id="6433128">)</span>&nbsp;<span class="op" id="6433130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6433135">na</span>&nbsp;<span class="op" id="6433138">=</span>&nbsp;<span class="builtinfunc" id="6433140">len</span><span class="op" id="6433143">(</span><span class="ident" id="6433144">a</span><span class="op" id="6433145">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6433149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6433153">if</span>&nbsp;<span class="ident" id="6433156">nb</span>&nbsp;<span class="op" id="6433159">&gt;</span>&nbsp;<span class="builtinfunc" id="6433161">len</span><span class="op" id="6433164">(</span><span class="ident" id="6433165">b</span><span class="op" id="6433166">)</span>&nbsp;<span class="op" id="6433168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6433173">nb</span>&nbsp;<span class="op" id="6433176">=</span>&nbsp;<span class="builtinfunc" id="6433178">len</span><span class="op" id="6433181">(</span><span class="ident" id="6433182">b</span><span class="op" id="6433183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6433187">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6433191">sa</span>&nbsp;<span class="op" id="6433194">:=</span>&nbsp;<span class="ident" id="6433197">bytestr</span><span class="op" id="6433204">(</span><span class="ident" id="6433205">offset</span><span class="op" id="6433211">,</span>&nbsp;<span class="ident" id="6433213">a</span><span class="op" id="6433214">[</span><span class="num" id="6433215">0</span><span class="op" id="6433216">:</span><span class="ident" id="6433217">na</span><span class="op" id="6433219">]</span><span class="op" id="6433220">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6433224">sb</span>&nbsp;<span class="op" id="6433227">:=</span>&nbsp;<span class="ident" id="6433230">bytestr</span><span class="op" id="6433237">(</span><span class="ident" id="6433238">offset</span><span class="op" id="6433244">,</span>&nbsp;<span class="ident" id="6433246">b</span><span class="op" id="6433247">[</span><span class="num" id="6433248">0</span><span class="op" id="6433249">:</span><span class="ident" id="6433250">nb</span><span class="op" id="6433252">]</span><span class="op" id="6433253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6433257">if</span>&nbsp;<span class="ident" id="6433260">sa</span>&nbsp;<span class="op" id="6433263">!=</span>&nbsp;<span class="ident" id="6433266">sb</span>&nbsp;<span class="op" id="6433269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6433274">s</span>&nbsp;<span class="op" id="6433276">+=</span>&nbsp;<span class="ident" id="6433279">fmt</span><span class="op" id="6433282">.</span><span class="ident" id="6433283">Sprintf</span><span class="op" id="6433290">(</span><span class="string" id="6433291">&#34;-%v\n+%v\n&#34;</span><span class="op" id="6433303">,</span>&nbsp;<span class="ident" id="6433305">sa</span><span class="op" id="6433307">,</span>&nbsp;<span class="ident" id="6433309">sb</span><span class="op" id="6433311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6433315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6433319">a</span>&nbsp;<span class="op" id="6433321">=</span>&nbsp;<span class="ident" id="6433323">a</span><span class="op" id="6433324">[</span><span class="ident" id="6433325">na</span><span class="op" id="6433327">:</span><span class="op" id="6433328">]</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6433332">b</span>&nbsp;<span class="op" id="6433334">=</span>&nbsp;<span class="ident" id="6433336">b</span><span class="op" id="6433337">[</span><span class="ident" id="6433338">nb</span><span class="op" id="6433340">:</span><span class="op" id="6433341">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6433344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6433347">return</span>&nbsp;<span class="ident" id="6433354">s</span><br>
<span class="lineno"></span><span class="op" id="6433356">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="keyword" id="6433359">func</span>&nbsp;<span class="ident" id="6433364">TestWriter</span><span class="op" id="6433374">(</span><span class="ident" id="6433375">t</span>&nbsp;<span class="op" id="6433377">*</span><span class="ident" id="6433378">testing</span><span class="op" id="6433385">.</span><span class="ident" id="6433386">T</span><span class="op" id="6433387">)</span>&nbsp;<span class="op" id="6433389">{</span><br>
<span class="lineno"></span><span class="ident" id="6433391">testLoop</span><span class="op" id="6433399">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6433402">for</span>&nbsp;<span class="ident" id="6433406">i</span><span class="op" id="6433407">,</span>&nbsp;<span class="ident" id="6433409">test</span>&nbsp;<span class="op" id="6433414">:=</span>&nbsp;<span class="keyword" id="6433417">range</span>&nbsp;<span class="ident" id="6433423">writerTests</span>&nbsp;<span class="op" id="6433435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6433439">expected</span><span class="op" id="6433447">,</span>&nbsp;<span class="ident" id="6433449">err</span>&nbsp;<span class="op" id="6433453">:=</span>&nbsp;<span class="ident" id="6433456">ioutil</span><span class="op" id="6433462">.</span><span class="ident" id="6433463">ReadFile</span><span class="op" id="6433471">(</span><span class="ident" id="6433472">test</span><span class="op" id="6433476">.</span><span class="ident" id="6433477">file</span><span class="op" id="6433481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6433485">if</span>&nbsp;<span class="ident" id="6433488">err</span>&nbsp;<span class="op" id="6433492">!=</span>&nbsp;<span class="builtintype" id="6433495">nil</span>&nbsp;<span class="op" id="6433499">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6433504">t</span><span class="op" id="6433505">.</span><span class="ident" id="6433506">Errorf</span><span class="op" id="6433512">(</span><span class="string" id="6433513">&#34;test&nbsp;%d:&nbsp;Unexpected&nbsp;error:&nbsp;%v&#34;</span><span class="op" id="6433544">,</span>&nbsp;<span class="ident" id="6433546">i</span><span class="op" id="6433547">,</span>&nbsp;<span class="ident" id="6433549">err</span><span class="op" id="6433552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6433557">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6433568">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6433573">buf</span>&nbsp;<span class="op" id="6433577">:=</span>&nbsp;<span class="builtinfunc" id="6433580">new</span><span class="op" id="6433583">(</span><span class="ident" id="6433584">bytes</span><span class="op" id="6433589">.</span><span class="ident" id="6433590">Buffer</span><span class="op" id="6433596">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6433600">tw</span>&nbsp;<span class="op" id="6433603">:=</span>&nbsp;<span class="ident" id="6433606">NewWriter</span><span class="op" id="6433615">(</span><span class="ident" id="6433616">iotest</span><span class="op" id="6433622">.</span><span class="ident" id="6433623">TruncateWriter</span><span class="op" id="6433637">(</span><span class="ident" id="6433638">buf</span><span class="op" id="6433641">,</span>&nbsp;<span class="num" id="6433643">4</span><span class="op" id="6433644">&lt;&lt;</span><span class="num" id="6433646">10</span><span class="op" id="6433648">)</span><span class="op" id="6433649">)</span>&nbsp;<span class="comment" id="6433651">//&nbsp;only&nbsp;catch&nbsp;the&nbsp;first&nbsp;4&nbsp;KB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6433682">big</span>&nbsp;<span class="op" id="6433686">:=</span>&nbsp;<span class="builtintype" id="6433689">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6433697">for</span>&nbsp;<span class="ident" id="6433701">j</span><span class="op" id="6433702">,</span>&nbsp;<span class="ident" id="6433704">entry</span>&nbsp;<span class="op" id="6433710">:=</span>&nbsp;<span class="keyword" id="6433713">range</span>&nbsp;<span class="ident" id="6433719">test</span><span class="op" id="6433723">.</span><span class="ident" id="6433724">entries</span>&nbsp;<span class="op" id="6433732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6433737">big</span>&nbsp;<span class="op" id="6433741">=</span>&nbsp;<span class="ident" id="6433743">big</span>&nbsp;<span class="op" id="6433747">||</span>&nbsp;<span class="ident" id="6433750">entry</span><span class="op" id="6433755">.</span><span class="ident" id="6433756">header</span><span class="op" id="6433762">.</span><span class="ident" id="6433763">Size</span>&nbsp;<span class="op" id="6433768">&gt;</span>&nbsp;<span class="num" id="6433770">1</span><span class="op" id="6433771">&lt;&lt;</span><span class="num" id="6433773">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6433779">if</span>&nbsp;<span class="ident" id="6433782">err</span>&nbsp;<span class="op" id="6433786">:=</span>&nbsp;<span class="ident" id="6433789">tw</span><span class="op" id="6433791">.</span><span class="ident" id="6433792">WriteHeader</span><span class="op" id="6433803">(</span><span class="ident" id="6433804">entry</span><span class="op" id="6433809">.</span><span class="ident" id="6433810">header</span><span class="op" id="6433816">)</span><span class="op" id="6433817">;</span>&nbsp;<span class="ident" id="6433819">err</span>&nbsp;<span class="op" id="6433823">!=</span>&nbsp;<span class="builtintype" id="6433826">nil</span>&nbsp;<span class="op" id="6433830">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6433836">t</span><span class="op" id="6433837">.</span><span class="ident" id="6433838">Errorf</span><span class="op" id="6433844">(</span><span class="string" id="6433845">&#34;test&nbsp;%d,&nbsp;entry&nbsp;%d:&nbsp;Failed&nbsp;writing&nbsp;header:&nbsp;%v&#34;</span><span class="op" id="6433891">,</span>&nbsp;<span class="ident" id="6433893">i</span><span class="op" id="6433894">,</span>&nbsp;<span class="ident" id="6433896">j</span><span class="op" id="6433897">,</span>&nbsp;<span class="ident" id="6433899">err</span><span class="op" id="6433902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6433908">continue</span>&nbsp;<span class="ident" id="6433917">testLoop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6433929">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6433934">if</span>&nbsp;<span class="ident" id="6433937">_</span><span class="op" id="6433938">,</span>&nbsp;<span class="ident" id="6433940">err</span>&nbsp;<span class="op" id="6433944">:=</span>&nbsp;<span class="ident" id="6433947">io</span><span class="op" id="6433949">.</span><span class="ident" id="6433950">WriteString</span><span class="op" id="6433961">(</span><span class="ident" id="6433962">tw</span><span class="op" id="6433964">,</span>&nbsp;<span class="ident" id="6433966">entry</span><span class="op" id="6433971">.</span><span class="ident" id="6433972">contents</span><span class="op" id="6433980">)</span><span class="op" id="6433981">;</span>&nbsp;<span class="ident" id="6433983">err</span>&nbsp;<span class="op" id="6433987">!=</span>&nbsp;<span class="builtintype" id="6433990">nil</span>&nbsp;<span class="op" id="6433994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6434000">t</span><span class="op" id="6434001">.</span><span class="ident" id="6434002">Errorf</span><span class="op" id="6434008">(</span><span class="string" id="6434009">&#34;test&nbsp;%d,&nbsp;entry&nbsp;%d:&nbsp;Failed&nbsp;writing&nbsp;contents:&nbsp;%v&#34;</span><span class="op" id="6434057">,</span>&nbsp;<span class="ident" id="6434059">i</span><span class="op" id="6434060">,</span>&nbsp;<span class="ident" id="6434062">j</span><span class="op" id="6434063">,</span>&nbsp;<span class="ident" id="6434065">err</span><span class="op" id="6434068">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6434074">continue</span>&nbsp;<span class="ident" id="6434083">testLoop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6434095">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6434099">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6434103">//&nbsp;Only&nbsp;interested&nbsp;in&nbsp;Close&nbsp;failures&nbsp;for&nbsp;the&nbsp;small&nbsp;tests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6434163">if</span>&nbsp;<span class="ident" id="6434166">err</span>&nbsp;<span class="op" id="6434170">:=</span>&nbsp;<span class="ident" id="6434173">tw</span><span class="op" id="6434175">.</span><span class="ident" id="6434176">Close</span><span class="op" id="6434181">(</span><span class="op" id="6434182">)</span><span class="op" id="6434183">;</span>&nbsp;<span class="ident" id="6434185">err</span>&nbsp;<span class="op" id="6434189">!=</span>&nbsp;<span class="builtintype" id="6434192">nil</span>&nbsp;<span class="op" id="6434196">&amp;&amp;</span>&nbsp;<span class="op" id="6434199">!</span><span class="ident" id="6434200">big</span>&nbsp;<span class="op" id="6434204">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6434209">t</span><span class="op" id="6434210">.</span><span class="ident" id="6434211">Errorf</span><span class="op" id="6434217">(</span><span class="string" id="6434218">&#34;test&nbsp;%d:&nbsp;Failed&nbsp;closing&nbsp;archive:&nbsp;%v&#34;</span><span class="op" id="6434255">,</span>&nbsp;<span class="ident" id="6434257">i</span><span class="op" id="6434258">,</span>&nbsp;<span class="ident" id="6434260">err</span><span class="op" id="6434263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6434268">continue</span>&nbsp;<span class="ident" id="6434277">testLoop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6434288">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6434293">actual</span>&nbsp;<span class="op" id="6434300">:=</span>&nbsp;<span class="ident" id="6434303">buf</span><span class="op" id="6434306">.</span><span class="ident" id="6434307">Bytes</span><span class="op" id="6434312">(</span><span class="op" id="6434313">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6434317">if</span>&nbsp;<span class="op" id="6434320">!</span><span class="ident" id="6434321">bytes</span><span class="op" id="6434326">.</span><span class="ident" id="6434327">Equal</span><span class="op" id="6434332">(</span><span class="ident" id="6434333">expected</span><span class="op" id="6434341">,</span>&nbsp;<span class="ident" id="6434343">actual</span><span class="op" id="6434349">)</span>&nbsp;<span class="op" id="6434351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6434356">t</span><span class="op" id="6434357">.</span><span class="ident" id="6434358">Errorf</span><span class="op" id="6434364">(</span><span class="string" id="6434365">&#34;test&nbsp;%d:&nbsp;Incorrect&nbsp;result:&nbsp;(-=expected,&nbsp;+=actual)\n%v&#34;</span><span class="op" id="6434420">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6434426">i</span><span class="op" id="6434427">,</span>&nbsp;<span class="ident" id="6434429">bytediff</span><span class="op" id="6434437">(</span><span class="ident" id="6434438">expected</span><span class="op" id="6434446">,</span>&nbsp;<span class="ident" id="6434448">actual</span><span class="op" id="6434454">)</span><span class="op" id="6434455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6434459">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6434463">if</span>&nbsp;<span class="ident" id="6434466">testing</span><span class="op" id="6434473">.</span><span class="ident" id="6434474">Short</span><span class="op" id="6434479">(</span><span class="op" id="6434480">)</span>&nbsp;<span class="op" id="6434482">{</span>&nbsp;<span class="comment" id="6434484">//&nbsp;The&nbsp;second&nbsp;test&nbsp;is&nbsp;expensive.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6434520">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6434528">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6434531">}</span><br>
<span class="lineno"></span><span class="op" id="6434533">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="6434536">func</span>&nbsp;<span class="ident" id="6434541">TestPax</span><span class="op" id="6434548">(</span><span class="ident" id="6434549">t</span>&nbsp;<span class="op" id="6434551">*</span><span class="ident" id="6434552">testing</span><span class="op" id="6434559">.</span><span class="ident" id="6434560">T</span><span class="op" id="6434561">)</span>&nbsp;<span class="op" id="6434563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6434566">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;a&nbsp;large&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6434606">fileinfo</span><span class="op" id="6434614">,</span>&nbsp;<span class="ident" id="6434616">err</span>&nbsp;<span class="op" id="6434620">:=</span>&nbsp;<span class="ident" id="6434623">os</span><span class="op" id="6434625">.</span><span class="ident" id="6434626">Stat</span><span class="op" id="6434630">(</span><span class="string" id="6434631">&#34;testdata/small.txt&#34;</span><span class="op" id="6434651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6434654">if</span>&nbsp;<span class="ident" id="6434657">err</span>&nbsp;<span class="op" id="6434661">!=</span>&nbsp;<span class="builtintype" id="6434664">nil</span>&nbsp;<span class="op" id="6434668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6434672">t</span><span class="op" id="6434673">.</span><span class="ident" id="6434674">Fatal</span><span class="op" id="6434679">(</span><span class="ident" id="6434680">err</span><span class="op" id="6434683">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6434686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6434689">hdr</span><span class="op" id="6434692">,</span>&nbsp;<span class="ident" id="6434694">err</span>&nbsp;<span class="op" id="6434698">:=</span>&nbsp;<span class="ident" id="6434701">FileInfoHeader</span><span class="op" id="6434715">(</span><span class="ident" id="6434716">fileinfo</span><span class="op" id="6434724">,</span>&nbsp;<span class="string" id="6434726">&#34;&#34;</span><span class="op" id="6434728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6434731">if</span>&nbsp;<span class="ident" id="6434734">err</span>&nbsp;<span class="op" id="6434738">!=</span>&nbsp;<span class="builtintype" id="6434741">nil</span>&nbsp;<span class="op" id="6434745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6434749">t</span><span class="op" id="6434750">.</span><span class="ident" id="6434751">Fatalf</span><span class="op" id="6434757">(</span><span class="string" id="6434758">&#34;os.Stat:&nbsp;%v&#34;</span><span class="op" id="6434771">,</span>&nbsp;<span class="ident" id="6434773">err</span><span class="op" id="6434776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6434779">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6434782">//&nbsp;Force&nbsp;a&nbsp;PAX&nbsp;long&nbsp;name&nbsp;to&nbsp;be&nbsp;written</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6434822">longName</span>&nbsp;<span class="op" id="6434831">:=</span>&nbsp;<span class="ident" id="6434834">strings</span><span class="op" id="6434841">.</span><span class="ident" id="6434842">Repeat</span><span class="op" id="6434848">(</span><span class="string" id="6434849">&#34;ab&#34;</span><span class="op" id="6434853">,</span>&nbsp;<span class="num" id="6434855">100</span><span class="op" id="6434858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6434861">contents</span>&nbsp;<span class="op" id="6434870">:=</span>&nbsp;<span class="ident" id="6434873">strings</span><span class="op" id="6434880">.</span><span class="ident" id="6434881">Repeat</span><span class="op" id="6434887">(</span><span class="string" id="6434888">&#34;&nbsp;&#34;</span><span class="op" id="6434891">,</span>&nbsp;<span class="builtintype" id="6434893">int</span><span class="op" id="6434896">(</span><span class="ident" id="6434897">hdr</span><span class="op" id="6434900">.</span><span class="ident" id="6434901">Size</span><span class="op" id="6434905">)</span><span class="op" id="6434906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6434909">hdr</span><span class="op" id="6434912">.</span><span class="ident" id="6434913">Name</span>&nbsp;<span class="op" id="6434918">=</span>&nbsp;<span class="ident" id="6434920">longName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6434930">var</span>&nbsp;<span class="ident" id="6434934">buf</span>&nbsp;<span class="ident" id="6434938">bytes</span><span class="op" id="6434943">.</span><span class="ident" id="6434944">Buffer</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6434952">writer</span>&nbsp;<span class="op" id="6434959">:=</span>&nbsp;<span class="ident" id="6434962">NewWriter</span><span class="op" id="6434971">(</span><span class="op" id="6434972">&amp;</span><span class="ident" id="6434973">buf</span><span class="op" id="6434976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6434979">if</span>&nbsp;<span class="ident" id="6434982">err</span>&nbsp;<span class="op" id="6434986">:=</span>&nbsp;<span class="ident" id="6434989">writer</span><span class="op" id="6434995">.</span><span class="ident" id="6434996">WriteHeader</span><span class="op" id="6435007">(</span><span class="ident" id="6435008">hdr</span><span class="op" id="6435011">)</span><span class="op" id="6435012">;</span>&nbsp;<span class="ident" id="6435014">err</span>&nbsp;<span class="op" id="6435018">!=</span>&nbsp;<span class="builtintype" id="6435021">nil</span>&nbsp;<span class="op" id="6435025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6435029">t</span><span class="op" id="6435030">.</span><span class="ident" id="6435031">Fatal</span><span class="op" id="6435036">(</span><span class="ident" id="6435037">err</span><span class="op" id="6435040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6435043">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6435046">if</span>&nbsp;<span class="ident" id="6435049">_</span><span class="op" id="6435050">,</span>&nbsp;<span class="ident" id="6435052">err</span>&nbsp;<span class="op" id="6435056">=</span>&nbsp;<span class="ident" id="6435058">writer</span><span class="op" id="6435064">.</span><span class="ident" id="6435065">Write</span><span class="op" id="6435070">(</span><span class="op" id="6435071">[</span><span class="op" id="6435072">]</span><span class="builtintype" id="6435073">byte</span><span class="op" id="6435077">(</span><span class="ident" id="6435078">contents</span><span class="op" id="6435086">)</span><span class="op" id="6435087">)</span><span class="op" id="6435088">;</span>&nbsp;<span class="ident" id="6435090">err</span>&nbsp;<span class="op" id="6435094">!=</span>&nbsp;<span class="builtintype" id="6435097">nil</span>&nbsp;<span class="op" id="6435101">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6435105">t</span><span class="op" id="6435106">.</span><span class="ident" id="6435107">Fatal</span><span class="op" id="6435112">(</span><span class="ident" id="6435113">err</span><span class="op" id="6435116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6435119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6435122">if</span>&nbsp;<span class="ident" id="6435125">err</span>&nbsp;<span class="op" id="6435129">:=</span>&nbsp;<span class="ident" id="6435132">writer</span><span class="op" id="6435138">.</span><span class="ident" id="6435139">Close</span><span class="op" id="6435144">(</span><span class="op" id="6435145">)</span><span class="op" id="6435146">;</span>&nbsp;<span class="ident" id="6435148">err</span>&nbsp;<span class="op" id="6435152">!=</span>&nbsp;<span class="builtintype" id="6435155">nil</span>&nbsp;<span class="op" id="6435159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6435163">t</span><span class="op" id="6435164">.</span><span class="ident" id="6435165">Fatal</span><span class="op" id="6435170">(</span><span class="ident" id="6435171">err</span><span class="op" id="6435174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6435177">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6435180">//&nbsp;Simple&nbsp;test&nbsp;to&nbsp;make&nbsp;sure&nbsp;PAX&nbsp;extensions&nbsp;are&nbsp;in&nbsp;effect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6435238">if</span>&nbsp;<span class="op" id="6435241">!</span><span class="ident" id="6435242">bytes</span><span class="op" id="6435247">.</span><span class="ident" id="6435248">Contains</span><span class="op" id="6435256">(</span><span class="ident" id="6435257">buf</span><span class="op" id="6435260">.</span><span class="ident" id="6435261">Bytes</span><span class="op" id="6435266">(</span><span class="op" id="6435267">)</span><span class="op" id="6435268">,</span>&nbsp;<span class="op" id="6435270">[</span><span class="op" id="6435271">]</span><span class="builtintype" id="6435272">byte</span><span class="op" id="6435276">(</span><span class="string" id="6435277">&#34;PaxHeaders.&#34;</span><span class="op" id="6435290">)</span><span class="op" id="6435291">)</span>&nbsp;<span class="op" id="6435293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6435297">t</span><span class="op" id="6435298">.</span><span class="ident" id="6435299">Fatal</span><span class="op" id="6435304">(</span><span class="string" id="6435305">&#34;Expected&nbsp;at&nbsp;least&nbsp;one&nbsp;PAX&nbsp;header&nbsp;to&nbsp;be&nbsp;written.&#34;</span><span class="op" id="6435354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6435357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6435360">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;long&nbsp;name&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6435422">reader</span>&nbsp;<span class="op" id="6435429">:=</span>&nbsp;<span class="ident" id="6435432">NewReader</span><span class="op" id="6435441">(</span><span class="op" id="6435442">&amp;</span><span class="ident" id="6435443">buf</span><span class="op" id="6435446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6435449">hdr</span><span class="op" id="6435452">,</span>&nbsp;<span class="ident" id="6435454">err</span>&nbsp;<span class="op" id="6435458">=</span>&nbsp;<span class="ident" id="6435460">reader</span><span class="op" id="6435466">.</span><span class="ident" id="6435467">Next</span><span class="op" id="6435471">(</span><span class="op" id="6435472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6435475">if</span>&nbsp;<span class="ident" id="6435478">err</span>&nbsp;<span class="op" id="6435482">!=</span>&nbsp;<span class="builtintype" id="6435485">nil</span>&nbsp;<span class="op" id="6435489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6435493">t</span><span class="op" id="6435494">.</span><span class="ident" id="6435495">Fatal</span><span class="op" id="6435500">(</span><span class="ident" id="6435501">err</span><span class="op" id="6435504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6435507">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6435510">if</span>&nbsp;<span class="ident" id="6435513">hdr</span><span class="op" id="6435516">.</span><span class="ident" id="6435517">Name</span>&nbsp;<span class="op" id="6435522">!=</span>&nbsp;<span class="ident" id="6435525">longName</span>&nbsp;<span class="op" id="6435534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6435538">t</span><span class="op" id="6435539">.</span><span class="ident" id="6435540">Fatal</span><span class="op" id="6435545">(</span><span class="string" id="6435546">&#34;Couldn&#39;t&nbsp;recover&nbsp;long&nbsp;file&nbsp;name&#34;</span><span class="op" id="6435579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6435582">}</span><br>
<span class="lineno"></span><span class="op" id="6435584">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="keyword" id="6435587">func</span>&nbsp;<span class="ident" id="6435592">TestPaxSymlink</span><span class="op" id="6435606">(</span><span class="ident" id="6435607">t</span>&nbsp;<span class="op" id="6435609">*</span><span class="ident" id="6435610">testing</span><span class="op" id="6435617">.</span><span class="ident" id="6435618">T</span><span class="op" id="6435619">)</span>&nbsp;<span class="op" id="6435621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6435624">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;a&nbsp;large&nbsp;linkname</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6435668">fileinfo</span><span class="op" id="6435676">,</span>&nbsp;<span class="ident" id="6435678">err</span>&nbsp;<span class="op" id="6435682">:=</span>&nbsp;<span class="ident" id="6435685">os</span><span class="op" id="6435687">.</span><span class="ident" id="6435688">Stat</span><span class="op" id="6435692">(</span><span class="string" id="6435693">&#34;testdata/small.txt&#34;</span><span class="op" id="6435713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6435716">if</span>&nbsp;<span class="ident" id="6435719">err</span>&nbsp;<span class="op" id="6435723">!=</span>&nbsp;<span class="builtintype" id="6435726">nil</span>&nbsp;<span class="op" id="6435730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6435734">t</span><span class="op" id="6435735">.</span><span class="ident" id="6435736">Fatal</span><span class="op" id="6435741">(</span><span class="ident" id="6435742">err</span><span class="op" id="6435745">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6435748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6435751">hdr</span><span class="op" id="6435754">,</span>&nbsp;<span class="ident" id="6435756">err</span>&nbsp;<span class="op" id="6435760">:=</span>&nbsp;<span class="ident" id="6435763">FileInfoHeader</span><span class="op" id="6435777">(</span><span class="ident" id="6435778">fileinfo</span><span class="op" id="6435786">,</span>&nbsp;<span class="string" id="6435788">&#34;&#34;</span><span class="op" id="6435790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6435793">hdr</span><span class="op" id="6435796">.</span><span class="ident" id="6435797">Typeflag</span>&nbsp;<span class="op" id="6435806">=</span>&nbsp;<span class="ident" id="6435808">TypeSymlink</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6435821">if</span>&nbsp;<span class="ident" id="6435824">err</span>&nbsp;<span class="op" id="6435828">!=</span>&nbsp;<span class="builtintype" id="6435831">nil</span>&nbsp;<span class="op" id="6435835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6435839">t</span><span class="op" id="6435840">.</span><span class="ident" id="6435841">Fatalf</span><span class="op" id="6435847">(</span><span class="string" id="6435848">&#34;os.Stat:1&nbsp;%v&#34;</span><span class="op" id="6435862">,</span>&nbsp;<span class="ident" id="6435864">err</span><span class="op" id="6435867">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6435870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6435873">//&nbsp;Force&nbsp;a&nbsp;PAX&nbsp;long&nbsp;linkname&nbsp;to&nbsp;be&nbsp;written</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6435917">longLinkname</span>&nbsp;<span class="op" id="6435930">:=</span>&nbsp;<span class="ident" id="6435933">strings</span><span class="op" id="6435940">.</span><span class="ident" id="6435941">Repeat</span><span class="op" id="6435947">(</span><span class="string" id="6435948">&#34;1234567890/1234567890&#34;</span><span class="op" id="6435971">,</span>&nbsp;<span class="num" id="6435973">10</span><span class="op" id="6435975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6435978">hdr</span><span class="op" id="6435981">.</span><span class="ident" id="6435982">Linkname</span>&nbsp;<span class="op" id="6435991">=</span>&nbsp;<span class="ident" id="6435993">longLinkname</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6436008">hdr</span><span class="op" id="6436011">.</span><span class="ident" id="6436012">Size</span>&nbsp;<span class="op" id="6436017">=</span>&nbsp;<span class="num" id="6436019">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6436022">var</span>&nbsp;<span class="ident" id="6436026">buf</span>&nbsp;<span class="ident" id="6436030">bytes</span><span class="op" id="6436035">.</span><span class="ident" id="6436036">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6436044">writer</span>&nbsp;<span class="op" id="6436051">:=</span>&nbsp;<span class="ident" id="6436054">NewWriter</span><span class="op" id="6436063">(</span><span class="op" id="6436064">&amp;</span><span class="ident" id="6436065">buf</span><span class="op" id="6436068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6436071">if</span>&nbsp;<span class="ident" id="6436074">err</span>&nbsp;<span class="op" id="6436078">:=</span>&nbsp;<span class="ident" id="6436081">writer</span><span class="op" id="6436087">.</span><span class="ident" id="6436088">WriteHeader</span><span class="op" id="6436099">(</span><span class="ident" id="6436100">hdr</span><span class="op" id="6436103">)</span><span class="op" id="6436104">;</span>&nbsp;<span class="ident" id="6436106">err</span>&nbsp;<span class="op" id="6436110">!=</span>&nbsp;<span class="builtintype" id="6436113">nil</span>&nbsp;<span class="op" id="6436117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6436121">t</span><span class="op" id="6436122">.</span><span class="ident" id="6436123">Fatal</span><span class="op" id="6436128">(</span><span class="ident" id="6436129">err</span><span class="op" id="6436132">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6436135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6436138">if</span>&nbsp;<span class="ident" id="6436141">err</span>&nbsp;<span class="op" id="6436145">:=</span>&nbsp;<span class="ident" id="6436148">writer</span><span class="op" id="6436154">.</span><span class="ident" id="6436155">Close</span><span class="op" id="6436160">(</span><span class="op" id="6436161">)</span><span class="op" id="6436162">;</span>&nbsp;<span class="ident" id="6436164">err</span>&nbsp;<span class="op" id="6436168">!=</span>&nbsp;<span class="builtintype" id="6436171">nil</span>&nbsp;<span class="op" id="6436175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6436179">t</span><span class="op" id="6436180">.</span><span class="ident" id="6436181">Fatal</span><span class="op" id="6436186">(</span><span class="ident" id="6436187">err</span><span class="op" id="6436190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6436193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6436196">//&nbsp;Simple&nbsp;test&nbsp;to&nbsp;make&nbsp;sure&nbsp;PAX&nbsp;extensions&nbsp;are&nbsp;in&nbsp;effect</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6436254">if</span>&nbsp;<span class="op" id="6436257">!</span><span class="ident" id="6436258">bytes</span><span class="op" id="6436263">.</span><span class="ident" id="6436264">Contains</span><span class="op" id="6436272">(</span><span class="ident" id="6436273">buf</span><span class="op" id="6436276">.</span><span class="ident" id="6436277">Bytes</span><span class="op" id="6436282">(</span><span class="op" id="6436283">)</span><span class="op" id="6436284">,</span>&nbsp;<span class="op" id="6436286">[</span><span class="op" id="6436287">]</span><span class="builtintype" id="6436288">byte</span><span class="op" id="6436292">(</span><span class="string" id="6436293">&#34;PaxHeaders.&#34;</span><span class="op" id="6436306">)</span><span class="op" id="6436307">)</span>&nbsp;<span class="op" id="6436309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6436313">t</span><span class="op" id="6436314">.</span><span class="ident" id="6436315">Fatal</span><span class="op" id="6436320">(</span><span class="string" id="6436321">&#34;Expected&nbsp;at&nbsp;least&nbsp;one&nbsp;PAX&nbsp;header&nbsp;to&nbsp;be&nbsp;written.&#34;</span><span class="op" id="6436370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6436373">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6436376">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;long&nbsp;name&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6436438">reader</span>&nbsp;<span class="op" id="6436445">:=</span>&nbsp;<span class="ident" id="6436448">NewReader</span><span class="op" id="6436457">(</span><span class="op" id="6436458">&amp;</span><span class="ident" id="6436459">buf</span><span class="op" id="6436462">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6436465">hdr</span><span class="op" id="6436468">,</span>&nbsp;<span class="ident" id="6436470">err</span>&nbsp;<span class="op" id="6436474">=</span>&nbsp;<span class="ident" id="6436476">reader</span><span class="op" id="6436482">.</span><span class="ident" id="6436483">Next</span><span class="op" id="6436487">(</span><span class="op" id="6436488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6436491">if</span>&nbsp;<span class="ident" id="6436494">err</span>&nbsp;<span class="op" id="6436498">!=</span>&nbsp;<span class="builtintype" id="6436501">nil</span>&nbsp;<span class="op" id="6436505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6436509">t</span><span class="op" id="6436510">.</span><span class="ident" id="6436511">Fatal</span><span class="op" id="6436516">(</span><span class="ident" id="6436517">err</span><span class="op" id="6436520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6436523">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6436526">if</span>&nbsp;<span class="ident" id="6436529">hdr</span><span class="op" id="6436532">.</span><span class="ident" id="6436533">Linkname</span>&nbsp;<span class="op" id="6436542">!=</span>&nbsp;<span class="ident" id="6436545">longLinkname</span>&nbsp;<span class="op" id="6436558">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6436562">t</span><span class="op" id="6436563">.</span><span class="ident" id="6436564">Fatal</span><span class="op" id="6436569">(</span><span class="string" id="6436570">&#34;Couldn&#39;t&nbsp;recover&nbsp;long&nbsp;link&nbsp;name&#34;</span><span class="op" id="6436603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6436606">}</span><br>
<span class="lineno"></span><span class="op" id="6436608">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6436611">func</span>&nbsp;<span class="ident" id="6436616">TestPaxNonAscii</span><span class="op" id="6436631">(</span><span class="ident" id="6436632">t</span>&nbsp;<span class="op" id="6436634">*</span><span class="ident" id="6436635">testing</span><span class="op" id="6436642">.</span><span class="ident" id="6436643">T</span><span class="op" id="6436644">)</span>&nbsp;<span class="op" id="6436646">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6436649">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;non&nbsp;ascii.&nbsp;These&nbsp;should&nbsp;trigger&nbsp;a&nbsp;pax&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6436721">//&nbsp;because&nbsp;pax&nbsp;headers&nbsp;have&nbsp;a&nbsp;defined&nbsp;utf-8&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6436776">fileinfo</span><span class="op" id="6436784">,</span>&nbsp;<span class="ident" id="6436786">err</span>&nbsp;<span class="op" id="6436790">:=</span>&nbsp;<span class="ident" id="6436793">os</span><span class="op" id="6436795">.</span><span class="ident" id="6436796">Stat</span><span class="op" id="6436800">(</span><span class="string" id="6436801">&#34;testdata/small.txt&#34;</span><span class="op" id="6436821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6436824">if</span>&nbsp;<span class="ident" id="6436827">err</span>&nbsp;<span class="op" id="6436831">!=</span>&nbsp;<span class="builtintype" id="6436834">nil</span>&nbsp;<span class="op" id="6436838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6436842">t</span><span class="op" id="6436843">.</span><span class="ident" id="6436844">Fatal</span><span class="op" id="6436849">(</span><span class="ident" id="6436850">err</span><span class="op" id="6436853">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6436856">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6436860">hdr</span><span class="op" id="6436863">,</span>&nbsp;<span class="ident" id="6436865">err</span>&nbsp;<span class="op" id="6436869">:=</span>&nbsp;<span class="ident" id="6436872">FileInfoHeader</span><span class="op" id="6436886">(</span><span class="ident" id="6436887">fileinfo</span><span class="op" id="6436895">,</span>&nbsp;<span class="string" id="6436897">&#34;&#34;</span><span class="op" id="6436899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6436902">if</span>&nbsp;<span class="ident" id="6436905">err</span>&nbsp;<span class="op" id="6436909">!=</span>&nbsp;<span class="builtintype" id="6436912">nil</span>&nbsp;<span class="op" id="6436916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6436920">t</span><span class="op" id="6436921">.</span><span class="ident" id="6436922">Fatalf</span><span class="op" id="6436928">(</span><span class="string" id="6436929">&#34;os.Stat:1&nbsp;%v&#34;</span><span class="op" id="6436943">,</span>&nbsp;<span class="ident" id="6436945">err</span><span class="op" id="6436948">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6436951">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6436955">//&nbsp;some&nbsp;sample&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6436976">chineseFilename</span>&nbsp;<span class="op" id="6436992">:=</span>&nbsp;<span class="string" id="6436995">&#34;文件名&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6437008">chineseGroupname</span>&nbsp;<span class="op" id="6437025">:=</span>&nbsp;<span class="string" id="6437028">&#34;組&#34;</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6437035">chineseUsername</span>&nbsp;<span class="op" id="6437051">:=</span>&nbsp;<span class="string" id="6437054">&#34;用戶名&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6437068">hdr</span><span class="op" id="6437071">.</span><span class="ident" id="6437072">Name</span>&nbsp;<span class="op" id="6437077">=</span>&nbsp;<span class="ident" id="6437079">chineseFilename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6437096">hdr</span><span class="op" id="6437099">.</span><span class="ident" id="6437100">Gname</span>&nbsp;<span class="op" id="6437106">=</span>&nbsp;<span class="ident" id="6437108">chineseGroupname</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6437126">hdr</span><span class="op" id="6437129">.</span><span class="ident" id="6437130">Uname</span>&nbsp;<span class="op" id="6437136">=</span>&nbsp;<span class="ident" id="6437138">chineseUsername</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6437156">contents</span>&nbsp;<span class="op" id="6437165">:=</span>&nbsp;<span class="ident" id="6437168">strings</span><span class="op" id="6437175">.</span><span class="ident" id="6437176">Repeat</span><span class="op" id="6437182">(</span><span class="string" id="6437183">&#34;&nbsp;&#34;</span><span class="op" id="6437186">,</span>&nbsp;<span class="builtintype" id="6437188">int</span><span class="op" id="6437191">(</span><span class="ident" id="6437192">hdr</span><span class="op" id="6437195">.</span><span class="ident" id="6437196">Size</span><span class="op" id="6437200">)</span><span class="op" id="6437201">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6437205">var</span>&nbsp;<span class="ident" id="6437209">buf</span>&nbsp;<span class="ident" id="6437213">bytes</span><span class="op" id="6437218">.</span><span class="ident" id="6437219">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6437227">writer</span>&nbsp;<span class="op" id="6437234">:=</span>&nbsp;<span class="ident" id="6437237">NewWriter</span><span class="op" id="6437246">(</span><span class="op" id="6437247">&amp;</span><span class="ident" id="6437248">buf</span><span class="op" id="6437251">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6437254">if</span>&nbsp;<span class="ident" id="6437257">err</span>&nbsp;<span class="op" id="6437261">:=</span>&nbsp;<span class="ident" id="6437264">writer</span><span class="op" id="6437270">.</span><span class="ident" id="6437271">WriteHeader</span><span class="op" id="6437282">(</span><span class="ident" id="6437283">hdr</span><span class="op" id="6437286">)</span><span class="op" id="6437287">;</span>&nbsp;<span class="ident" id="6437289">err</span>&nbsp;<span class="op" id="6437293">!=</span>&nbsp;<span class="builtintype" id="6437296">nil</span>&nbsp;<span class="op" id="6437300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6437304">t</span><span class="op" id="6437305">.</span><span class="ident" id="6437306">Fatal</span><span class="op" id="6437311">(</span><span class="ident" id="6437312">err</span><span class="op" id="6437315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6437318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6437321">if</span>&nbsp;<span class="ident" id="6437324">_</span><span class="op" id="6437325">,</span>&nbsp;<span class="ident" id="6437327">err</span>&nbsp;<span class="op" id="6437331">=</span>&nbsp;<span class="ident" id="6437333">writer</span><span class="op" id="6437339">.</span><span class="ident" id="6437340">Write</span><span class="op" id="6437345">(</span><span class="op" id="6437346">[</span><span class="op" id="6437347">]</span><span class="builtintype" id="6437348">byte</span><span class="op" id="6437352">(</span><span class="ident" id="6437353">contents</span><span class="op" id="6437361">)</span><span class="op" id="6437362">)</span><span class="op" id="6437363">;</span>&nbsp;<span class="ident" id="6437365">err</span>&nbsp;<span class="op" id="6437369">!=</span>&nbsp;<span class="builtintype" id="6437372">nil</span>&nbsp;<span class="op" id="6437376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6437380">t</span><span class="op" id="6437381">.</span><span class="ident" id="6437382">Fatal</span><span class="op" id="6437387">(</span><span class="ident" id="6437388">err</span><span class="op" id="6437391">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6437394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6437397">if</span>&nbsp;<span class="ident" id="6437400">err</span>&nbsp;<span class="op" id="6437404">:=</span>&nbsp;<span class="ident" id="6437407">writer</span><span class="op" id="6437413">.</span><span class="ident" id="6437414">Close</span><span class="op" id="6437419">(</span><span class="op" id="6437420">)</span><span class="op" id="6437421">;</span>&nbsp;<span class="ident" id="6437423">err</span>&nbsp;<span class="op" id="6437427">!=</span>&nbsp;<span class="builtintype" id="6437430">nil</span>&nbsp;<span class="op" id="6437434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6437438">t</span><span class="op" id="6437439">.</span><span class="ident" id="6437440">Fatal</span><span class="op" id="6437445">(</span><span class="ident" id="6437446">err</span><span class="op" id="6437449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6437452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6437455">//&nbsp;Simple&nbsp;test&nbsp;to&nbsp;make&nbsp;sure&nbsp;PAX&nbsp;extensions&nbsp;are&nbsp;in&nbsp;effect</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6437513">if</span>&nbsp;<span class="op" id="6437516">!</span><span class="ident" id="6437517">bytes</span><span class="op" id="6437522">.</span><span class="ident" id="6437523">Contains</span><span class="op" id="6437531">(</span><span class="ident" id="6437532">buf</span><span class="op" id="6437535">.</span><span class="ident" id="6437536">Bytes</span><span class="op" id="6437541">(</span><span class="op" id="6437542">)</span><span class="op" id="6437543">,</span>&nbsp;<span class="op" id="6437545">[</span><span class="op" id="6437546">]</span><span class="builtintype" id="6437547">byte</span><span class="op" id="6437551">(</span><span class="string" id="6437552">&#34;PaxHeaders.&#34;</span><span class="op" id="6437565">)</span><span class="op" id="6437566">)</span>&nbsp;<span class="op" id="6437568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6437572">t</span><span class="op" id="6437573">.</span><span class="ident" id="6437574">Fatal</span><span class="op" id="6437579">(</span><span class="string" id="6437580">&#34;Expected&nbsp;at&nbsp;least&nbsp;one&nbsp;PAX&nbsp;header&nbsp;to&nbsp;be&nbsp;written.&#34;</span><span class="op" id="6437629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6437632">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6437635">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;long&nbsp;name&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6437697">reader</span>&nbsp;<span class="op" id="6437704">:=</span>&nbsp;<span class="ident" id="6437707">NewReader</span><span class="op" id="6437716">(</span><span class="op" id="6437717">&amp;</span><span class="ident" id="6437718">buf</span><span class="op" id="6437721">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6437724">hdr</span><span class="op" id="6437727">,</span>&nbsp;<span class="ident" id="6437729">err</span>&nbsp;<span class="op" id="6437733">=</span>&nbsp;<span class="ident" id="6437735">reader</span><span class="op" id="6437741">.</span><span class="ident" id="6437742">Next</span><span class="op" id="6437746">(</span><span class="op" id="6437747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6437750">if</span>&nbsp;<span class="ident" id="6437753">err</span>&nbsp;<span class="op" id="6437757">!=</span>&nbsp;<span class="builtintype" id="6437760">nil</span>&nbsp;<span class="op" id="6437764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6437768">t</span><span class="op" id="6437769">.</span><span class="ident" id="6437770">Fatal</span><span class="op" id="6437775">(</span><span class="ident" id="6437776">err</span><span class="op" id="6437779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6437782">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6437785">if</span>&nbsp;<span class="ident" id="6437788">hdr</span><span class="op" id="6437791">.</span><span class="ident" id="6437792">Name</span>&nbsp;<span class="op" id="6437797">!=</span>&nbsp;<span class="ident" id="6437800">chineseFilename</span>&nbsp;<span class="op" id="6437816">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6437820">t</span><span class="op" id="6437821">.</span><span class="ident" id="6437822">Fatal</span><span class="op" id="6437827">(</span><span class="string" id="6437828">&#34;Couldn&#39;t&nbsp;recover&nbsp;unicode&nbsp;name&#34;</span><span class="op" id="6437859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6437862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6437865">if</span>&nbsp;<span class="ident" id="6437868">hdr</span><span class="op" id="6437871">.</span><span class="ident" id="6437872">Gname</span>&nbsp;<span class="op" id="6437878">!=</span>&nbsp;<span class="ident" id="6437881">chineseGroupname</span>&nbsp;<span class="op" id="6437898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6437902">t</span><span class="op" id="6437903">.</span><span class="ident" id="6437904">Fatal</span><span class="op" id="6437909">(</span><span class="string" id="6437910">&#34;Couldn&#39;t&nbsp;recover&nbsp;unicode&nbsp;group&#34;</span><span class="op" id="6437942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6437945">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6437948">if</span>&nbsp;<span class="ident" id="6437951">hdr</span><span class="op" id="6437954">.</span><span class="ident" id="6437955">Uname</span>&nbsp;<span class="op" id="6437961">!=</span>&nbsp;<span class="ident" id="6437964">chineseUsername</span>&nbsp;<span class="op" id="6437980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6437984">t</span><span class="op" id="6437985">.</span><span class="ident" id="6437986">Fatal</span><span class="op" id="6437991">(</span><span class="string" id="6437992">&#34;Couldn&#39;t&nbsp;recover&nbsp;unicode&nbsp;user&#34;</span><span class="op" id="6438023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6438026">}</span><br>
<span class="lineno"></span><span class="op" id="6438028">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="keyword" id="6438031">func</span>&nbsp;<span class="ident" id="6438036">TestPaxXattrs</span><span class="op" id="6438049">(</span><span class="ident" id="6438050">t</span>&nbsp;<span class="op" id="6438052">*</span><span class="ident" id="6438053">testing</span><span class="op" id="6438060">.</span><span class="ident" id="6438061">T</span><span class="op" id="6438062">)</span>&nbsp;<span class="op" id="6438064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6438067">xattrs</span>&nbsp;<span class="op" id="6438074">:=</span>&nbsp;<span class="keyword" id="6438077">map</span><span class="op" id="6438080">[</span><span class="builtintype" id="6438081">string</span><span class="op" id="6438087">]</span><span class="builtintype" id="6438088">string</span><span class="op" id="6438094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6438098">&#34;user.key&#34;</span><span class="op" id="6438108">:</span>&nbsp;<span class="string" id="6438110">&#34;value&#34;</span><span class="op" id="6438117">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6438120">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6438124">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;an&nbsp;xattr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6438160">fileinfo</span><span class="op" id="6438168">,</span>&nbsp;<span class="ident" id="6438170">err</span>&nbsp;<span class="op" id="6438174">:=</span>&nbsp;<span class="ident" id="6438177">os</span><span class="op" id="6438179">.</span><span class="ident" id="6438180">Stat</span><span class="op" id="6438184">(</span><span class="string" id="6438185">&#34;testdata/small.txt&#34;</span><span class="op" id="6438205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6438208">if</span>&nbsp;<span class="ident" id="6438211">err</span>&nbsp;<span class="op" id="6438215">!=</span>&nbsp;<span class="builtintype" id="6438218">nil</span>&nbsp;<span class="op" id="6438222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6438226">t</span><span class="op" id="6438227">.</span><span class="ident" id="6438228">Fatal</span><span class="op" id="6438233">(</span><span class="ident" id="6438234">err</span><span class="op" id="6438237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6438240">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6438243">hdr</span><span class="op" id="6438246">,</span>&nbsp;<span class="ident" id="6438248">err</span>&nbsp;<span class="op" id="6438252">:=</span>&nbsp;<span class="ident" id="6438255">FileInfoHeader</span><span class="op" id="6438269">(</span><span class="ident" id="6438270">fileinfo</span><span class="op" id="6438278">,</span>&nbsp;<span class="string" id="6438280">&#34;&#34;</span><span class="op" id="6438282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6438285">if</span>&nbsp;<span class="ident" id="6438288">err</span>&nbsp;<span class="op" id="6438292">!=</span>&nbsp;<span class="builtintype" id="6438295">nil</span>&nbsp;<span class="op" id="6438299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6438303">t</span><span class="op" id="6438304">.</span><span class="ident" id="6438305">Fatalf</span><span class="op" id="6438311">(</span><span class="string" id="6438312">&#34;os.Stat:&nbsp;%v&#34;</span><span class="op" id="6438325">,</span>&nbsp;<span class="ident" id="6438327">err</span><span class="op" id="6438330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6438333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6438336">contents</span>&nbsp;<span class="op" id="6438345">:=</span>&nbsp;<span class="string" id="6438348">&#34;Kilts&#34;</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6438357">hdr</span><span class="op" id="6438360">.</span><span class="ident" id="6438361">Xattrs</span>&nbsp;<span class="op" id="6438368">=</span>&nbsp;<span class="ident" id="6438370">xattrs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6438378">var</span>&nbsp;<span class="ident" id="6438382">buf</span>&nbsp;<span class="ident" id="6438386">bytes</span><span class="op" id="6438391">.</span><span class="ident" id="6438392">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6438400">writer</span>&nbsp;<span class="op" id="6438407">:=</span>&nbsp;<span class="ident" id="6438410">NewWriter</span><span class="op" id="6438419">(</span><span class="op" id="6438420">&amp;</span><span class="ident" id="6438421">buf</span><span class="op" id="6438424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6438427">if</span>&nbsp;<span class="ident" id="6438430">err</span>&nbsp;<span class="op" id="6438434">:=</span>&nbsp;<span class="ident" id="6438437">writer</span><span class="op" id="6438443">.</span><span class="ident" id="6438444">WriteHeader</span><span class="op" id="6438455">(</span><span class="ident" id="6438456">hdr</span><span class="op" id="6438459">)</span><span class="op" id="6438460">;</span>&nbsp;<span class="ident" id="6438462">err</span>&nbsp;<span class="op" id="6438466">!=</span>&nbsp;<span class="builtintype" id="6438469">nil</span>&nbsp;<span class="op" id="6438473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6438477">t</span><span class="op" id="6438478">.</span><span class="ident" id="6438479">Fatal</span><span class="op" id="6438484">(</span><span class="ident" id="6438485">err</span><span class="op" id="6438488">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6438491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6438494">if</span>&nbsp;<span class="ident" id="6438497">_</span><span class="op" id="6438498">,</span>&nbsp;<span class="ident" id="6438500">err</span>&nbsp;<span class="op" id="6438504">=</span>&nbsp;<span class="ident" id="6438506">writer</span><span class="op" id="6438512">.</span><span class="ident" id="6438513">Write</span><span class="op" id="6438518">(</span><span class="op" id="6438519">[</span><span class="op" id="6438520">]</span><span class="builtintype" id="6438521">byte</span><span class="op" id="6438525">(</span><span class="ident" id="6438526">contents</span><span class="op" id="6438534">)</span><span class="op" id="6438535">)</span><span class="op" id="6438536">;</span>&nbsp;<span class="ident" id="6438538">err</span>&nbsp;<span class="op" id="6438542">!=</span>&nbsp;<span class="builtintype" id="6438545">nil</span>&nbsp;<span class="op" id="6438549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6438553">t</span><span class="op" id="6438554">.</span><span class="ident" id="6438555">Fatal</span><span class="op" id="6438560">(</span><span class="ident" id="6438561">err</span><span class="op" id="6438564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6438567">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6438570">if</span>&nbsp;<span class="ident" id="6438573">err</span>&nbsp;<span class="op" id="6438577">:=</span>&nbsp;<span class="ident" id="6438580">writer</span><span class="op" id="6438586">.</span><span class="ident" id="6438587">Close</span><span class="op" id="6438592">(</span><span class="op" id="6438593">)</span><span class="op" id="6438594">;</span>&nbsp;<span class="ident" id="6438596">err</span>&nbsp;<span class="op" id="6438600">!=</span>&nbsp;<span class="builtintype" id="6438603">nil</span>&nbsp;<span class="op" id="6438607">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6438611">t</span><span class="op" id="6438612">.</span><span class="ident" id="6438613">Fatal</span><span class="op" id="6438618">(</span><span class="ident" id="6438619">err</span><span class="op" id="6438622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6438625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6438628">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;the&nbsp;xattrs&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6438689">reader</span>&nbsp;<span class="op" id="6438696">:=</span>&nbsp;<span class="ident" id="6438699">NewReader</span><span class="op" id="6438708">(</span><span class="op" id="6438709">&amp;</span><span class="ident" id="6438710">buf</span><span class="op" id="6438713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6438716">hdr</span><span class="op" id="6438719">,</span>&nbsp;<span class="ident" id="6438721">err</span>&nbsp;<span class="op" id="6438725">=</span>&nbsp;<span class="ident" id="6438727">reader</span><span class="op" id="6438733">.</span><span class="ident" id="6438734">Next</span><span class="op" id="6438738">(</span><span class="op" id="6438739">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6438742">if</span>&nbsp;<span class="ident" id="6438745">err</span>&nbsp;<span class="op" id="6438749">!=</span>&nbsp;<span class="builtintype" id="6438752">nil</span>&nbsp;<span class="op" id="6438756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6438760">t</span><span class="op" id="6438761">.</span><span class="ident" id="6438762">Fatal</span><span class="op" id="6438767">(</span><span class="ident" id="6438768">err</span><span class="op" id="6438771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6438774">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6438777">if</span>&nbsp;<span class="op" id="6438780">!</span><span class="ident" id="6438781">reflect</span><span class="op" id="6438788">.</span><span class="ident" id="6438789">DeepEqual</span><span class="op" id="6438798">(</span><span class="ident" id="6438799">hdr</span><span class="op" id="6438802">.</span><span class="ident" id="6438803">Xattrs</span><span class="op" id="6438809">,</span>&nbsp;<span class="ident" id="6438811">xattrs</span><span class="op" id="6438817">)</span>&nbsp;<span class="op" id="6438819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6438823">t</span><span class="op" id="6438824">.</span><span class="ident" id="6438825">Fatalf</span><span class="op" id="6438831">(</span><span class="string" id="6438832">&#34;xattrs&nbsp;did&nbsp;not&nbsp;survive&nbsp;round&nbsp;trip:&nbsp;got&nbsp;%+v,&nbsp;want&nbsp;%+v&#34;</span><span class="op" id="6438886">,</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6438891">hdr</span><span class="op" id="6438894">.</span><span class="ident" id="6438895">Xattrs</span><span class="op" id="6438901">,</span>&nbsp;<span class="ident" id="6438903">xattrs</span><span class="op" id="6438909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6438912">}</span><br>
<span class="lineno"></span><span class="op" id="6438914">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6438917">func</span>&nbsp;<span class="ident" id="6438922">TestPAXHeader</span><span class="op" id="6438935">(</span><span class="ident" id="6438936">t</span>&nbsp;<span class="op" id="6438938">*</span><span class="ident" id="6438939">testing</span><span class="op" id="6438946">.</span><span class="ident" id="6438947">T</span><span class="op" id="6438948">)</span>&nbsp;<span class="op" id="6438950">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6438953">medName</span>&nbsp;<span class="op" id="6438961">:=</span>&nbsp;<span class="ident" id="6438964">strings</span><span class="op" id="6438971">.</span><span class="ident" id="6438972">Repeat</span><span class="op" id="6438978">(</span><span class="string" id="6438979">&#34;CD&#34;</span><span class="op" id="6438983">,</span>&nbsp;<span class="num" id="6438985">50</span><span class="op" id="6438987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6438990">longName</span>&nbsp;<span class="op" id="6438999">:=</span>&nbsp;<span class="ident" id="6439002">strings</span><span class="op" id="6439009">.</span><span class="ident" id="6439010">Repeat</span><span class="op" id="6439016">(</span><span class="string" id="6439017">&#34;AB&#34;</span><span class="op" id="6439021">,</span>&nbsp;<span class="num" id="6439023">100</span><span class="op" id="6439026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6439029">paxTests</span>&nbsp;<span class="op" id="6439038">:=</span>&nbsp;<span class="op" id="6439041">[</span><span class="op" id="6439042">]</span><span class="op" id="6439043">[</span><span class="num" id="6439044">2</span><span class="op" id="6439045">]</span><span class="builtintype" id="6439046">string</span><span class="op" id="6439052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6439056">{</span><span class="ident" id="6439057">paxPath</span>&nbsp;<span class="op" id="6439065">+</span>&nbsp;<span class="string" id="6439067">&#34;=/etc/hosts&#34;</span><span class="op" id="6439080">,</span>&nbsp;<span class="string" id="6439082">&#34;19&nbsp;path=/etc/hosts\n&#34;</span><span class="op" id="6439104">}</span><span class="op" id="6439105">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6439109">{</span><span class="string" id="6439110">&#34;a=b&#34;</span><span class="op" id="6439115">,</span>&nbsp;<span class="string" id="6439117">&#34;6&nbsp;a=b\n&#34;</span><span class="op" id="6439126">}</span><span class="op" id="6439127">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6439138">//&nbsp;Single&nbsp;digit&nbsp;length</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6439163">{</span><span class="string" id="6439164">&#34;a=names&#34;</span><span class="op" id="6439173">,</span>&nbsp;<span class="string" id="6439175">&#34;11&nbsp;a=names\n&#34;</span><span class="op" id="6439189">}</span><span class="op" id="6439190">,</span>&nbsp;<span class="comment" id="6439192">//&nbsp;Test&nbsp;case&nbsp;involving&nbsp;carries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6439225">{</span><span class="ident" id="6439226">paxPath</span>&nbsp;<span class="op" id="6439234">+</span>&nbsp;<span class="string" id="6439236">&#34;=&#34;</span>&nbsp;<span class="op" id="6439240">+</span>&nbsp;<span class="ident" id="6439242">longName</span><span class="op" id="6439250">,</span>&nbsp;<span class="ident" id="6439252">fmt</span><span class="op" id="6439255">.</span><span class="ident" id="6439256">Sprintf</span><span class="op" id="6439263">(</span><span class="string" id="6439264">&#34;210&nbsp;path=%s\n&#34;</span><span class="op" id="6439279">,</span>&nbsp;<span class="ident" id="6439281">longName</span><span class="op" id="6439289">)</span><span class="op" id="6439290">}</span><span class="op" id="6439291">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6439295">{</span><span class="ident" id="6439296">paxPath</span>&nbsp;<span class="op" id="6439304">+</span>&nbsp;<span class="string" id="6439306">&#34;=&#34;</span>&nbsp;<span class="op" id="6439310">+</span>&nbsp;<span class="ident" id="6439312">medName</span><span class="op" id="6439319">,</span>&nbsp;<span class="ident" id="6439321">fmt</span><span class="op" id="6439324">.</span><span class="ident" id="6439325">Sprintf</span><span class="op" id="6439332">(</span><span class="string" id="6439333">&#34;110&nbsp;path=%s\n&#34;</span><span class="op" id="6439348">,</span>&nbsp;<span class="ident" id="6439350">medName</span><span class="op" id="6439357">)</span><span class="op" id="6439358">}</span><span class="op" id="6439359">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6439363">for</span>&nbsp;<span class="ident" id="6439367">_</span><span class="op" id="6439368">,</span>&nbsp;<span class="ident" id="6439370">test</span>&nbsp;<span class="op" id="6439375">:=</span>&nbsp;<span class="keyword" id="6439378">range</span>&nbsp;<span class="ident" id="6439384">paxTests</span>&nbsp;<span class="op" id="6439393">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6439397">key</span><span class="op" id="6439400">,</span>&nbsp;<span class="ident" id="6439402">expected</span>&nbsp;<span class="op" id="6439411">:=</span>&nbsp;<span class="ident" id="6439414">test</span><span class="op" id="6439418">[</span><span class="num" id="6439419">0</span><span class="op" id="6439420">]</span><span class="op" id="6439421">,</span>&nbsp;<span class="ident" id="6439423">test</span><span class="op" id="6439427">[</span><span class="num" id="6439428">1</span><span class="op" id="6439429">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6439433">if</span>&nbsp;<span class="ident" id="6439436">result</span>&nbsp;<span class="op" id="6439443">:=</span>&nbsp;<span class="ident" id="6439446">paxHeader</span><span class="op" id="6439455">(</span><span class="ident" id="6439456">key</span><span class="op" id="6439459">)</span><span class="op" id="6439460">;</span>&nbsp;<span class="ident" id="6439462">result</span>&nbsp;<span class="op" id="6439469">!=</span>&nbsp;<span class="ident" id="6439472">expected</span>&nbsp;<span class="op" id="6439481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6439486">t</span><span class="op" id="6439487">.</span><span class="ident" id="6439488">Fatalf</span><span class="op" id="6439494">(</span><span class="string" id="6439495">&#34;paxHeader:&nbsp;got&nbsp;%s,&nbsp;expected&nbsp;%s&#34;</span><span class="op" id="6439527">,</span>&nbsp;<span class="ident" id="6439529">result</span><span class="op" id="6439535">,</span>&nbsp;<span class="ident" id="6439537">expected</span><span class="op" id="6439545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6439549">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6439552">}</span><br>
<span class="lineno">420</span><span class="op" id="6439554">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6439557">func</span>&nbsp;<span class="ident" id="6439562">TestUSTARLongName</span><span class="op" id="6439579">(</span><span class="ident" id="6439580">t</span>&nbsp;<span class="op" id="6439582">*</span><span class="ident" id="6439583">testing</span><span class="op" id="6439590">.</span><span class="ident" id="6439591">T</span><span class="op" id="6439592">)</span>&nbsp;<span class="op" id="6439594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6439597">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;a&nbsp;path&nbsp;that&nbsp;failed&nbsp;to&nbsp;split&nbsp;with&nbsp;USTAR&nbsp;extension&nbsp;in&nbsp;previous&nbsp;versions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6439695">fileinfo</span><span class="op" id="6439703">,</span>&nbsp;<span class="ident" id="6439705">err</span>&nbsp;<span class="op" id="6439709">:=</span>&nbsp;<span class="ident" id="6439712">os</span><span class="op" id="6439714">.</span><span class="ident" id="6439715">Stat</span><span class="op" id="6439719">(</span><span class="string" id="6439720">&#34;testdata/small.txt&#34;</span><span class="op" id="6439740">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6439743">if</span>&nbsp;<span class="ident" id="6439746">err</span>&nbsp;<span class="op" id="6439750">!=</span>&nbsp;<span class="builtintype" id="6439753">nil</span>&nbsp;<span class="op" id="6439757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6439761">t</span><span class="op" id="6439762">.</span><span class="ident" id="6439763">Fatal</span><span class="op" id="6439768">(</span><span class="ident" id="6439769">err</span><span class="op" id="6439772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6439775">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6439778">hdr</span><span class="op" id="6439781">,</span>&nbsp;<span class="ident" id="6439783">err</span>&nbsp;<span class="op" id="6439787">:=</span>&nbsp;<span class="ident" id="6439790">FileInfoHeader</span><span class="op" id="6439804">(</span><span class="ident" id="6439805">fileinfo</span><span class="op" id="6439813">,</span>&nbsp;<span class="string" id="6439815">&#34;&#34;</span><span class="op" id="6439817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6439820">hdr</span><span class="op" id="6439823">.</span><span class="ident" id="6439824">Typeflag</span>&nbsp;<span class="op" id="6439833">=</span>&nbsp;<span class="ident" id="6439835">TypeDir</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6439844">if</span>&nbsp;<span class="ident" id="6439847">err</span>&nbsp;<span class="op" id="6439851">!=</span>&nbsp;<span class="builtintype" id="6439854">nil</span>&nbsp;<span class="op" id="6439858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6439862">t</span><span class="op" id="6439863">.</span><span class="ident" id="6439864">Fatalf</span><span class="op" id="6439870">(</span><span class="string" id="6439871">&#34;os.Stat:1&nbsp;%v&#34;</span><span class="op" id="6439885">,</span>&nbsp;<span class="ident" id="6439887">err</span><span class="op" id="6439890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6439893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6439896">//&nbsp;Force&nbsp;a&nbsp;PAX&nbsp;long&nbsp;name&nbsp;to&nbsp;be&nbsp;written.&nbsp;The&nbsp;name&nbsp;was&nbsp;taken&nbsp;from&nbsp;a&nbsp;practical&nbsp;example</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6439981">//&nbsp;that&nbsp;fails&nbsp;and&nbsp;replaced&nbsp;ever&nbsp;char&nbsp;through&nbsp;numbers&nbsp;to&nbsp;anonymize&nbsp;the&nbsp;sample.</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6440060">longName</span>&nbsp;<span class="op" id="6440069">:=</span>&nbsp;<span class="string" id="6440072">&#34;/0000_0000000/00000-000000000/0000_0000000/00000-0000000000000/0000_0000000/00000-0000000-00000000/0000_0000000/00000000/0000_0000000/000/0000_0000000/00000000v00/0000_0000000/000000/0000_0000000/0000000/0000_0000000/00000y-00/0000/0000/00000000/0x000000/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6440331">hdr</span><span class="op" id="6440334">.</span><span class="ident" id="6440335">Name</span>&nbsp;<span class="op" id="6440340">=</span>&nbsp;<span class="ident" id="6440342">longName</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6440353">hdr</span><span class="op" id="6440356">.</span><span class="ident" id="6440357">Size</span>&nbsp;<span class="op" id="6440362">=</span>&nbsp;<span class="num" id="6440364">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6440367">var</span>&nbsp;<span class="ident" id="6440371">buf</span>&nbsp;<span class="ident" id="6440375">bytes</span><span class="op" id="6440380">.</span><span class="ident" id="6440381">Buffer</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6440389">writer</span>&nbsp;<span class="op" id="6440396">:=</span>&nbsp;<span class="ident" id="6440399">NewWriter</span><span class="op" id="6440408">(</span><span class="op" id="6440409">&amp;</span><span class="ident" id="6440410">buf</span><span class="op" id="6440413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6440416">if</span>&nbsp;<span class="ident" id="6440419">err</span>&nbsp;<span class="op" id="6440423">:=</span>&nbsp;<span class="ident" id="6440426">writer</span><span class="op" id="6440432">.</span><span class="ident" id="6440433">WriteHeader</span><span class="op" id="6440444">(</span><span class="ident" id="6440445">hdr</span><span class="op" id="6440448">)</span><span class="op" id="6440449">;</span>&nbsp;<span class="ident" id="6440451">err</span>&nbsp;<span class="op" id="6440455">!=</span>&nbsp;<span class="builtintype" id="6440458">nil</span>&nbsp;<span class="op" id="6440462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6440466">t</span><span class="op" id="6440467">.</span><span class="ident" id="6440468">Fatal</span><span class="op" id="6440473">(</span><span class="ident" id="6440474">err</span><span class="op" id="6440477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6440480">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6440483">if</span>&nbsp;<span class="ident" id="6440486">err</span>&nbsp;<span class="op" id="6440490">:=</span>&nbsp;<span class="ident" id="6440493">writer</span><span class="op" id="6440499">.</span><span class="ident" id="6440500">Close</span><span class="op" id="6440505">(</span><span class="op" id="6440506">)</span><span class="op" id="6440507">;</span>&nbsp;<span class="ident" id="6440509">err</span>&nbsp;<span class="op" id="6440513">!=</span>&nbsp;<span class="builtintype" id="6440516">nil</span>&nbsp;<span class="op" id="6440520">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6440524">t</span><span class="op" id="6440525">.</span><span class="ident" id="6440526">Fatal</span><span class="op" id="6440531">(</span><span class="ident" id="6440532">err</span><span class="op" id="6440535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6440538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6440541">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;long&nbsp;name&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6440603">reader</span>&nbsp;<span class="op" id="6440610">:=</span>&nbsp;<span class="ident" id="6440613">NewReader</span><span class="op" id="6440622">(</span><span class="op" id="6440623">&amp;</span><span class="ident" id="6440624">buf</span><span class="op" id="6440627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6440630">hdr</span><span class="op" id="6440633">,</span>&nbsp;<span class="ident" id="6440635">err</span>&nbsp;<span class="op" id="6440639">=</span>&nbsp;<span class="ident" id="6440641">reader</span><span class="op" id="6440647">.</span><span class="ident" id="6440648">Next</span><span class="op" id="6440652">(</span><span class="op" id="6440653">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6440656">if</span>&nbsp;<span class="ident" id="6440659">err</span>&nbsp;<span class="op" id="6440663">!=</span>&nbsp;<span class="builtintype" id="6440666">nil</span>&nbsp;<span class="op" id="6440670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6440674">t</span><span class="op" id="6440675">.</span><span class="ident" id="6440676">Fatal</span><span class="op" id="6440681">(</span><span class="ident" id="6440682">err</span><span class="op" id="6440685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6440688">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6440691">if</span>&nbsp;<span class="ident" id="6440694">hdr</span><span class="op" id="6440697">.</span><span class="ident" id="6440698">Name</span>&nbsp;<span class="op" id="6440703">!=</span>&nbsp;<span class="ident" id="6440706">longName</span>&nbsp;<span class="op" id="6440715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6440719">t</span><span class="op" id="6440720">.</span><span class="ident" id="6440721">Fatal</span><span class="op" id="6440726">(</span><span class="string" id="6440727">&#34;Couldn&#39;t&nbsp;recover&nbsp;long&nbsp;name&#34;</span><span class="op" id="6440755">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6440758">}</span><br>
<span class="lineno"></span><span class="op" id="6440760">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6440763">func</span>&nbsp;<span class="ident" id="6440768">TestValidTypeflagWithPAXHeader</span><span class="op" id="6440798">(</span><span class="ident" id="6440799">t</span>&nbsp;<span class="op" id="6440801">*</span><span class="ident" id="6440802">testing</span><span class="op" id="6440809">.</span><span class="ident" id="6440810">T</span><span class="op" id="6440811">)</span>&nbsp;<span class="op" id="6440813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6440816">var</span>&nbsp;<span class="ident" id="6440820">buffer</span>&nbsp;<span class="ident" id="6440827">bytes</span><span class="op" id="6440832">.</span><span class="ident" id="6440833">Buffer</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6440841">tw</span>&nbsp;<span class="op" id="6440844">:=</span>&nbsp;<span class="ident" id="6440847">NewWriter</span><span class="op" id="6440856">(</span><span class="op" id="6440857">&amp;</span><span class="ident" id="6440858">buffer</span><span class="op" id="6440864">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6440868">fileName</span>&nbsp;<span class="op" id="6440877">:=</span>&nbsp;<span class="ident" id="6440880">strings</span><span class="op" id="6440887">.</span><span class="ident" id="6440888">Repeat</span><span class="op" id="6440894">(</span><span class="string" id="6440895">&#34;ab&#34;</span><span class="op" id="6440899">,</span>&nbsp;<span class="num" id="6440901">100</span><span class="op" id="6440904">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6440908">hdr</span>&nbsp;<span class="op" id="6440912">:=</span>&nbsp;<span class="op" id="6440915">&amp;</span><span class="ident" id="6440916">Header</span><span class="op" id="6440922">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6440926">Name</span><span class="op" id="6440930">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6440936">fileName</span><span class="op" id="6440944">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6440948">Size</span><span class="op" id="6440952">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6440958">4</span><span class="op" id="6440959">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6440963">Typeflag</span><span class="op" id="6440971">:</span>&nbsp;<span class="num" id="6440973">0</span><span class="op" id="6440974">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6440977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6440980">if</span>&nbsp;<span class="ident" id="6440983">err</span>&nbsp;<span class="op" id="6440987">:=</span>&nbsp;<span class="ident" id="6440990">tw</span><span class="op" id="6440992">.</span><span class="ident" id="6440993">WriteHeader</span><span class="op" id="6441004">(</span><span class="ident" id="6441005">hdr</span><span class="op" id="6441008">)</span><span class="op" id="6441009">;</span>&nbsp;<span class="ident" id="6441011">err</span>&nbsp;<span class="op" id="6441015">!=</span>&nbsp;<span class="builtintype" id="6441018">nil</span>&nbsp;<span class="op" id="6441022">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6441026">t</span><span class="op" id="6441027">.</span><span class="ident" id="6441028">Fatalf</span><span class="op" id="6441034">(</span><span class="string" id="6441035">&#34;Failed&nbsp;to&nbsp;write&nbsp;header:&nbsp;%s&#34;</span><span class="op" id="6441063">,</span>&nbsp;<span class="ident" id="6441065">err</span><span class="op" id="6441068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6441071">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6441074">if</span>&nbsp;<span class="ident" id="6441077">_</span><span class="op" id="6441078">,</span>&nbsp;<span class="ident" id="6441080">err</span>&nbsp;<span class="op" id="6441084">:=</span>&nbsp;<span class="ident" id="6441087">tw</span><span class="op" id="6441089">.</span><span class="ident" id="6441090">Write</span><span class="op" id="6441095">(</span><span class="op" id="6441096">[</span><span class="op" id="6441097">]</span><span class="builtintype" id="6441098">byte</span><span class="op" id="6441102">(</span><span class="string" id="6441103">&#34;fooo&#34;</span><span class="op" id="6441109">)</span><span class="op" id="6441110">)</span><span class="op" id="6441111">;</span>&nbsp;<span class="ident" id="6441113">err</span>&nbsp;<span class="op" id="6441117">!=</span>&nbsp;<span class="builtintype" id="6441120">nil</span>&nbsp;<span class="op" id="6441124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6441128">t</span><span class="op" id="6441129">.</span><span class="ident" id="6441130">Fatalf</span><span class="op" id="6441136">(</span><span class="string" id="6441137">&#34;Failed&nbsp;to&nbsp;write&nbsp;the&nbsp;file&#39;s&nbsp;data:&nbsp;%s&#34;</span><span class="op" id="6441174">,</span>&nbsp;<span class="ident" id="6441176">err</span><span class="op" id="6441179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6441182">}</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6441185">tw</span><span class="op" id="6441187">.</span><span class="ident" id="6441188">Close</span><span class="op" id="6441193">(</span><span class="op" id="6441194">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6441198">tr</span>&nbsp;<span class="op" id="6441201">:=</span>&nbsp;<span class="ident" id="6441204">NewReader</span><span class="op" id="6441213">(</span><span class="op" id="6441214">&amp;</span><span class="ident" id="6441215">buffer</span><span class="op" id="6441221">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6441225">for</span>&nbsp;<span class="op" id="6441229">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6441233">header</span><span class="op" id="6441239">,</span>&nbsp;<span class="ident" id="6441241">err</span>&nbsp;<span class="op" id="6441245">:=</span>&nbsp;<span class="ident" id="6441248">tr</span><span class="op" id="6441250">.</span><span class="ident" id="6441251">Next</span><span class="op" id="6441255">(</span><span class="op" id="6441256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6441260">if</span>&nbsp;<span class="ident" id="6441263">err</span>&nbsp;<span class="op" id="6441267">==</span>&nbsp;<span class="ident" id="6441270">io</span><span class="op" id="6441272">.</span><span class="ident" id="6441273">EOF</span>&nbsp;<span class="op" id="6441277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6441282">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6441290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6441294">if</span>&nbsp;<span class="ident" id="6441297">err</span>&nbsp;<span class="op" id="6441301">!=</span>&nbsp;<span class="builtintype" id="6441304">nil</span>&nbsp;<span class="op" id="6441308">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6441313">t</span><span class="op" id="6441314">.</span><span class="ident" id="6441315">Fatalf</span><span class="op" id="6441321">(</span><span class="string" id="6441322">&#34;Failed&nbsp;to&nbsp;read&nbsp;header:&nbsp;%s&#34;</span><span class="op" id="6441349">,</span>&nbsp;<span class="ident" id="6441351">err</span><span class="op" id="6441354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6441358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6441362">if</span>&nbsp;<span class="ident" id="6441365">header</span><span class="op" id="6441371">.</span><span class="ident" id="6441372">Typeflag</span>&nbsp;<span class="op" id="6441381">!=</span>&nbsp;<span class="num" id="6441384">0</span>&nbsp;<span class="op" id="6441386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6441391">t</span><span class="op" id="6441392">.</span><span class="ident" id="6441393">Fatalf</span><span class="op" id="6441399">(</span><span class="string" id="6441400">&#34;Typeflag&nbsp;should&#39;ve&nbsp;been&nbsp;0,&nbsp;found&nbsp;%d&#34;</span><span class="op" id="6441437">,</span>&nbsp;<span class="ident" id="6441439">header</span><span class="op" id="6441445">.</span><span class="ident" id="6441446">Typeflag</span><span class="op" id="6441454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6441458">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6441461">}</span><br>
<span class="lineno"></span><span class="op" id="6441463">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
