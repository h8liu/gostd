<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/token</h2>
<ul>
<li><a href="/gostd/go/token/position.go.html">position.go</a></li>
<li><a href="/gostd/go/token/position_test.go.html">position_test.go</a></li>
<li><a href="/gostd/go/token/serialize.go.html">serialize.go</a></li>
<li><a href="/gostd/go/token/serialize_test.go.html">serialize_test.go</a></li>
<li><a href="/gostd/go/token/token.go.html">token.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3639455">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3639510">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3639564">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3639615">package</span>&nbsp;<span class="ident" id="3639623">token</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3639630">import</span>&nbsp;<span class="op" id="3639637">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3639640">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3639647">&#34;sort&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3639655">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="3639662">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3639665">//&nbsp;-----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="3639746">//&nbsp;Positions</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="3639760">//&nbsp;Position&nbsp;describes&nbsp;an&nbsp;arbitrary&nbsp;source&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="3639811">//&nbsp;including&nbsp;the&nbsp;file,&nbsp;line,&nbsp;and&nbsp;column&nbsp;location.</span><br>
<span class="lineno"></span><span class="comment" id="3639861">//&nbsp;A&nbsp;Position&nbsp;is&nbsp;valid&nbsp;if&nbsp;the&nbsp;line&nbsp;number&nbsp;is&nbsp;&gt;&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="3639911">//</span><br>
<span class="lineno">20</span><span class="keyword" id="3639914">type</span>&nbsp;<span class="ident" id="3639919">Position</span>&nbsp;<span class="keyword" id="3639928">struct</span>&nbsp;<span class="op" id="3639935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3639938">Filename</span>&nbsp;<span class="builtintype" id="3639947">string</span>&nbsp;<span class="comment" id="3639954">//&nbsp;filename,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3639975">Offset</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3639984">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3639991">//&nbsp;offset,&nbsp;starting&nbsp;at&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3640017">Line</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3640026">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3640033">//&nbsp;line&nbsp;number,&nbsp;starting&nbsp;at&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3640064">Column</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3640073">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3640080">//&nbsp;column&nbsp;number,&nbsp;starting&nbsp;at&nbsp;1&nbsp;(character&nbsp;count)</span><br>
<span class="lineno">25</span><span class="op" id="3640130">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3640133">//&nbsp;IsValid&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;position&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="3640183">func</span>&nbsp;<span class="op" id="3640188">(</span><span class="ident" id="3640189">pos</span>&nbsp;<span class="op" id="3640193">*</span><span class="ident" id="3640194">Position</span><span class="op" id="3640202">)</span>&nbsp;<span class="ident" id="3640204">IsValid</span><span class="op" id="3640211">(</span><span class="op" id="3640212">)</span>&nbsp;<span class="builtintype" id="3640214">bool</span>&nbsp;<span class="op" id="3640219">{</span>&nbsp;<span class="keyword" id="3640221">return</span>&nbsp;<span class="ident" id="3640228">pos</span><span class="op" id="3640231">.</span><span class="ident" id="3640232">Line</span>&nbsp;<span class="op" id="3640237">&gt;</span>&nbsp;<span class="num" id="3640239">0</span>&nbsp;<span class="op" id="3640241">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="3640244">//&nbsp;String&nbsp;returns&nbsp;a&nbsp;string&nbsp;in&nbsp;one&nbsp;of&nbsp;several&nbsp;forms:</span><br>
<span class="lineno"></span><span class="comment" id="3640296">//</span><br>
<span class="lineno"></span><span class="comment" id="3640299">//&nbsp;&nbsp;&nbsp;&nbspfile:line:column&nbsp;&nbsp;&nbsp;&nbsp;valid&nbsp;position&nbsp;with&nbsp;file&nbsp;name</span><br>
<span class="lineno"></span><span class="comment" id="3640352">//&nbsp;&nbsp;&nbsp;&nbspline:column&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;valid&nbsp;position&nbsp;without&nbsp;file&nbsp;name</span><br>
<span class="lineno"></span><span class="comment" id="3640408">//&nbsp;&nbsp;&nbsp;&nbspfile&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;invalid&nbsp;position&nbsp;with&nbsp;file&nbsp;name</span><br>
<span class="lineno">35</span><span class="comment" id="3640463">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;invalid&nbsp;position&nbsp;without&nbsp;file&nbsp;name</span><br>
<span class="lineno"></span><span class="comment" id="3640521">//</span><br>
<span class="lineno"></span><span class="keyword" id="3640524">func</span>&nbsp;<span class="op" id="3640529">(</span><span class="ident" id="3640530">pos</span>&nbsp;<span class="ident" id="3640534">Position</span><span class="op" id="3640542">)</span>&nbsp;<span class="ident" id="3640544">String</span><span class="op" id="3640550">(</span><span class="op" id="3640551">)</span>&nbsp;<span class="builtintype" id="3640553">string</span>&nbsp;<span class="op" id="3640560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3640563">s</span>&nbsp;<span class="op" id="3640565">:=</span>&nbsp;<span class="ident" id="3640568">pos</span><span class="op" id="3640571">.</span><span class="ident" id="3640572">Filename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3640582">if</span>&nbsp;<span class="ident" id="3640585">pos</span><span class="op" id="3640588">.</span><span class="ident" id="3640589">IsValid</span><span class="op" id="3640596">(</span><span class="op" id="3640597">)</span>&nbsp;<span class="op" id="3640599">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3640603">if</span>&nbsp;<span class="ident" id="3640606">s</span>&nbsp;<span class="op" id="3640608">!=</span>&nbsp;<span class="string" id="3640611">&#34;&#34;</span>&nbsp;<span class="op" id="3640614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3640619">s</span>&nbsp;<span class="op" id="3640621">+=</span>&nbsp;<span class="string" id="3640624">&#34;:&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3640630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3640634">s</span>&nbsp;<span class="op" id="3640636">+=</span>&nbsp;<span class="ident" id="3640639">fmt</span><span class="op" id="3640642">.</span><span class="ident" id="3640643">Sprintf</span><span class="op" id="3640650">(</span><span class="string" id="3640651">&#34;%d:%d&#34;</span><span class="op" id="3640658">,</span>&nbsp;<span class="ident" id="3640660">pos</span><span class="op" id="3640663">.</span><span class="ident" id="3640664">Line</span><span class="op" id="3640668">,</span>&nbsp;<span class="ident" id="3640670">pos</span><span class="op" id="3640673">.</span><span class="ident" id="3640674">Column</span><span class="op" id="3640680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3640683">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3640686">if</span>&nbsp;<span class="ident" id="3640689">s</span>&nbsp;<span class="op" id="3640691">==</span>&nbsp;<span class="string" id="3640694">&#34;&#34;</span>&nbsp;<span class="op" id="3640697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3640701">s</span>&nbsp;<span class="op" id="3640703">=</span>&nbsp;<span class="string" id="3640705">&#34;-&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3640710">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3640713">return</span>&nbsp;<span class="ident" id="3640720">s</span><br>
<span class="lineno"></span><span class="op" id="3640722">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="comment" id="3640725">//&nbsp;Pos&nbsp;is&nbsp;a&nbsp;compact&nbsp;encoding&nbsp;of&nbsp;a&nbsp;source&nbsp;position&nbsp;within&nbsp;a&nbsp;file&nbsp;set.</span><br>
<span class="lineno"></span><span class="comment" id="3640794">//&nbsp;It&nbsp;can&nbsp;be&nbsp;converted&nbsp;into&nbsp;a&nbsp;Position&nbsp;for&nbsp;a&nbsp;more&nbsp;convenient,&nbsp;but&nbsp;much</span><br>
<span class="lineno"></span><span class="comment" id="3640865">//&nbsp;larger,&nbsp;representation.</span><br>
<span class="lineno"></span><span class="comment" id="3640892">//</span><br>
<span class="lineno">55</span><span class="comment" id="3640895">//&nbsp;The&nbsp;Pos&nbsp;value&nbsp;for&nbsp;a&nbsp;given&nbsp;file&nbsp;is&nbsp;a&nbsp;number&nbsp;in&nbsp;the&nbsp;range&nbsp;[base,&nbsp;base+size],</span><br>
<span class="lineno"></span><span class="comment" id="3640973">//&nbsp;where&nbsp;base&nbsp;and&nbsp;size&nbsp;are&nbsp;specified&nbsp;when&nbsp;adding&nbsp;the&nbsp;file&nbsp;to&nbsp;the&nbsp;file&nbsp;set&nbsp;via</span><br>
<span class="lineno"></span><span class="comment" id="3641051">//&nbsp;AddFile.</span><br>
<span class="lineno"></span><span class="comment" id="3641063">//</span><br>
<span class="lineno"></span><span class="comment" id="3641066">//&nbsp;To&nbsp;create&nbsp;the&nbsp;Pos&nbsp;value&nbsp;for&nbsp;a&nbsp;specific&nbsp;source&nbsp;offset,&nbsp;first&nbsp;add</span><br>
<span class="lineno">60</span><span class="comment" id="3641133">//&nbsp;the&nbsp;respective&nbsp;file&nbsp;to&nbsp;the&nbsp;current&nbsp;file&nbsp;set&nbsp;(via&nbsp;FileSet.AddFile)</span><br>
<span class="lineno"></span><span class="comment" id="3641202">//&nbsp;and&nbsp;then&nbsp;call&nbsp;File.Pos(offset)&nbsp;for&nbsp;that&nbsp;file.&nbsp;Given&nbsp;a&nbsp;Pos&nbsp;value&nbsp;p</span><br>
<span class="lineno"></span><span class="comment" id="3641271">//&nbsp;for&nbsp;a&nbsp;specific&nbsp;file&nbsp;set&nbsp;fset,&nbsp;the&nbsp;corresponding&nbsp;Position&nbsp;value&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3641340">//&nbsp;obtained&nbsp;by&nbsp;calling&nbsp;fset.Position(p).</span><br>
<span class="lineno"></span><span class="comment" id="3641381">//</span><br>
<span class="lineno">65</span><span class="comment" id="3641384">//&nbsp;Pos&nbsp;values&nbsp;can&nbsp;be&nbsp;compared&nbsp;directly&nbsp;with&nbsp;the&nbsp;usual&nbsp;comparison&nbsp;operators:</span><br>
<span class="lineno"></span><span class="comment" id="3641460">//&nbsp;If&nbsp;two&nbsp;Pos&nbsp;values&nbsp;p&nbsp;and&nbsp;q&nbsp;are&nbsp;in&nbsp;the&nbsp;same&nbsp;file,&nbsp;comparing&nbsp;p&nbsp;and&nbsp;q&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3641532">//&nbsp;equivalent&nbsp;to&nbsp;comparing&nbsp;the&nbsp;respective&nbsp;source&nbsp;file&nbsp;offsets.&nbsp;If&nbsp;p&nbsp;and&nbsp;q</span><br>
<span class="lineno"></span><span class="comment" id="3641606">//&nbsp;are&nbsp;in&nbsp;different&nbsp;files,&nbsp;p&nbsp;&lt;&nbsp;q&nbsp;is&nbsp;true&nbsp;if&nbsp;the&nbsp;file&nbsp;implied&nbsp;by&nbsp;p&nbsp;was&nbsp;added</span><br>
<span class="lineno"></span><span class="comment" id="3641682">//&nbsp;to&nbsp;the&nbsp;respective&nbsp;file&nbsp;set&nbsp;before&nbsp;the&nbsp;file&nbsp;implied&nbsp;by&nbsp;q.</span><br>
<span class="lineno">70</span><span class="comment" id="3641742">//</span><br>
<span class="lineno"></span><span class="keyword" id="3641745">type</span>&nbsp;<span class="ident" id="3641750">Pos</span>&nbsp;<span class="builtintype" id="3641754">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3641759">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;for&nbsp;Pos&nbsp;is&nbsp;NoPos;&nbsp;there&nbsp;is&nbsp;no&nbsp;file&nbsp;and&nbsp;line&nbsp;information</span><br>
<span class="lineno"></span><span class="comment" id="3641833">//&nbsp;associated&nbsp;with&nbsp;it,&nbsp;and&nbsp;NoPos().IsValid()&nbsp;is&nbsp;false.&nbsp;NoPos&nbsp;is&nbsp;always</span><br>
<span class="lineno">75</span><span class="comment" id="3641904">//&nbsp;smaller&nbsp;than&nbsp;any&nbsp;other&nbsp;Pos&nbsp;value.&nbsp;The&nbsp;corresponding&nbsp;Position&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="3641974">//&nbsp;for&nbsp;NoPos&nbsp;is&nbsp;the&nbsp;zero&nbsp;value&nbsp;for&nbsp;Position.</span><br>
<span class="lineno"></span><span class="comment" id="3642019">//</span><br>
<span class="lineno"></span><span class="keyword" id="3642022">const</span>&nbsp;<span class="ident" id="3642028">NoPos</span>&nbsp;<span class="ident" id="3642034">Pos</span>&nbsp;<span class="op" id="3642038">=</span>&nbsp;<span class="num" id="3642040">0</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="3642043">//&nbsp;IsValid&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;position&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="3642093">func</span>&nbsp;<span class="op" id="3642098">(</span><span class="ident" id="3642099">p</span>&nbsp;<span class="ident" id="3642101">Pos</span><span class="op" id="3642104">)</span>&nbsp;<span class="ident" id="3642106">IsValid</span><span class="op" id="3642113">(</span><span class="op" id="3642114">)</span>&nbsp;<span class="builtintype" id="3642116">bool</span>&nbsp;<span class="op" id="3642121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3642124">return</span>&nbsp;<span class="ident" id="3642131">p</span>&nbsp;<span class="op" id="3642133">!=</span>&nbsp;<span class="ident" id="3642136">NoPos</span><br>
<span class="lineno"></span><span class="op" id="3642142">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="3642145">//&nbsp;-----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="3642226">//&nbsp;File</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3642235">//&nbsp;A&nbsp;File&nbsp;is&nbsp;a&nbsp;handle&nbsp;for&nbsp;a&nbsp;file&nbsp;belonging&nbsp;to&nbsp;a&nbsp;FileSet.</span><br>
<span class="lineno"></span><span class="comment" id="3642292">//&nbsp;A&nbsp;File&nbsp;has&nbsp;a&nbsp;name,&nbsp;size,&nbsp;and&nbsp;line&nbsp;offset&nbsp;table.</span><br>
<span class="lineno">90</span><span class="comment" id="3642343">//</span><br>
<span class="lineno"></span><span class="keyword" id="3642346">type</span>&nbsp;<span class="ident" id="3642351">File</span>&nbsp;<span class="keyword" id="3642356">struct</span>&nbsp;<span class="op" id="3642363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3642366">set</span>&nbsp;&nbsp;<span class="op" id="3642371">*</span><span class="ident" id="3642372">FileSet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3642381">name</span>&nbsp;<span class="builtintype" id="3642386">string</span>&nbsp;<span class="comment" id="3642393">//&nbsp;file&nbsp;name&nbsp;as&nbsp;provided&nbsp;to&nbsp;AddFile</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3642430">base</span>&nbsp;<span class="builtintype" id="3642435">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3642442">//&nbsp;Pos&nbsp;value&nbsp;range&nbsp;for&nbsp;this&nbsp;file&nbsp;is&nbsp;[base...base+size]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3642498">size</span>&nbsp;<span class="builtintype" id="3642503">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3642510">//&nbsp;file&nbsp;size&nbsp;as&nbsp;provided&nbsp;to&nbsp;AddFile</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3642548">//&nbsp;lines&nbsp;and&nbsp;infos&nbsp;are&nbsp;protected&nbsp;by&nbsp;set.mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3642595">lines</span>&nbsp;<span class="op" id="3642601">[</span><span class="op" id="3642602">]</span><span class="builtintype" id="3642603">int</span>&nbsp;<span class="comment" id="3642607">//&nbsp;lines&nbsp;contains&nbsp;the&nbsp;offset&nbsp;of&nbsp;the&nbsp;first&nbsp;character&nbsp;for&nbsp;each&nbsp;line&nbsp;(the&nbsp;first&nbsp;entry&nbsp;is&nbsp;always&nbsp;0)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3642704">infos</span>&nbsp;<span class="op" id="3642710">[</span><span class="op" id="3642711">]</span><span class="ident" id="3642712">lineInfo</span><br>
<span class="lineno">100</span><span class="op" id="3642721">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3642724">//&nbsp;Name&nbsp;returns&nbsp;the&nbsp;file&nbsp;name&nbsp;of&nbsp;file&nbsp;f&nbsp;as&nbsp;registered&nbsp;with&nbsp;AddFile.</span><br>
<span class="lineno"></span><span class="keyword" id="3642792">func</span>&nbsp;<span class="op" id="3642797">(</span><span class="ident" id="3642798">f</span>&nbsp;<span class="op" id="3642800">*</span><span class="ident" id="3642801">File</span><span class="op" id="3642805">)</span>&nbsp;<span class="ident" id="3642807">Name</span><span class="op" id="3642811">(</span><span class="op" id="3642812">)</span>&nbsp;<span class="builtintype" id="3642814">string</span>&nbsp;<span class="op" id="3642821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3642824">return</span>&nbsp;<span class="ident" id="3642831">f</span><span class="op" id="3642832">.</span><span class="ident" id="3642833">name</span><br>
<span class="lineno">105</span><span class="op" id="3642838">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3642841">//&nbsp;Base&nbsp;returns&nbsp;the&nbsp;base&nbsp;offset&nbsp;of&nbsp;file&nbsp;f&nbsp;as&nbsp;registered&nbsp;with&nbsp;AddFile.</span><br>
<span class="lineno"></span><span class="keyword" id="3642911">func</span>&nbsp;<span class="op" id="3642916">(</span><span class="ident" id="3642917">f</span>&nbsp;<span class="op" id="3642919">*</span><span class="ident" id="3642920">File</span><span class="op" id="3642924">)</span>&nbsp;<span class="ident" id="3642926">Base</span><span class="op" id="3642930">(</span><span class="op" id="3642931">)</span>&nbsp;<span class="builtintype" id="3642933">int</span>&nbsp;<span class="op" id="3642937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3642940">return</span>&nbsp;<span class="ident" id="3642947">f</span><span class="op" id="3642948">.</span><span class="ident" id="3642949">base</span><br>
<span class="lineno">110</span><span class="op" id="3642954">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3642957">//&nbsp;Size&nbsp;returns&nbsp;the&nbsp;size&nbsp;of&nbsp;file&nbsp;f&nbsp;as&nbsp;registered&nbsp;with&nbsp;AddFile.</span><br>
<span class="lineno"></span><span class="keyword" id="3643020">func</span>&nbsp;<span class="op" id="3643025">(</span><span class="ident" id="3643026">f</span>&nbsp;<span class="op" id="3643028">*</span><span class="ident" id="3643029">File</span><span class="op" id="3643033">)</span>&nbsp;<span class="ident" id="3643035">Size</span><span class="op" id="3643039">(</span><span class="op" id="3643040">)</span>&nbsp;<span class="builtintype" id="3643042">int</span>&nbsp;<span class="op" id="3643046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3643049">return</span>&nbsp;<span class="ident" id="3643056">f</span><span class="op" id="3643057">.</span><span class="ident" id="3643058">size</span><br>
<span class="lineno">115</span><span class="op" id="3643063">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3643066">//&nbsp;LineCount&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;lines&nbsp;in&nbsp;file&nbsp;f.</span><br>
<span class="lineno"></span><span class="keyword" id="3643118">func</span>&nbsp;<span class="op" id="3643123">(</span><span class="ident" id="3643124">f</span>&nbsp;<span class="op" id="3643126">*</span><span class="ident" id="3643127">File</span><span class="op" id="3643131">)</span>&nbsp;<span class="ident" id="3643133">LineCount</span><span class="op" id="3643142">(</span><span class="op" id="3643143">)</span>&nbsp;<span class="builtintype" id="3643145">int</span>&nbsp;<span class="op" id="3643149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3643152">f</span><span class="op" id="3643153">.</span><span class="ident" id="3643154">set</span><span class="op" id="3643157">.</span><span class="ident" id="3643158">mutex</span><span class="op" id="3643163">.</span><span class="ident" id="3643164">RLock</span><span class="op" id="3643169">(</span><span class="op" id="3643170">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3643173">n</span>&nbsp;<span class="op" id="3643175">:=</span>&nbsp;<span class="builtinfunc" id="3643178">len</span><span class="op" id="3643181">(</span><span class="ident" id="3643182">f</span><span class="op" id="3643183">.</span><span class="ident" id="3643184">lines</span><span class="op" id="3643189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3643192">f</span><span class="op" id="3643193">.</span><span class="ident" id="3643194">set</span><span class="op" id="3643197">.</span><span class="ident" id="3643198">mutex</span><span class="op" id="3643203">.</span><span class="ident" id="3643204">RUnlock</span><span class="op" id="3643211">(</span><span class="op" id="3643212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3643215">return</span>&nbsp;<span class="ident" id="3643222">n</span><br>
<span class="lineno"></span><span class="op" id="3643224">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="3643227">//&nbsp;AddLine&nbsp;adds&nbsp;the&nbsp;line&nbsp;offset&nbsp;for&nbsp;a&nbsp;new&nbsp;line.</span><br>
<span class="lineno"></span><span class="comment" id="3643275">//&nbsp;The&nbsp;line&nbsp;offset&nbsp;must&nbsp;be&nbsp;larger&nbsp;than&nbsp;the&nbsp;offset&nbsp;for&nbsp;the&nbsp;previous&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="3643347">//&nbsp;and&nbsp;smaller&nbsp;than&nbsp;the&nbsp;file&nbsp;size;&nbsp;otherwise&nbsp;the&nbsp;line&nbsp;offset&nbsp;is&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="3643420">//</span><br>
<span class="lineno"></span><span class="keyword" id="3643423">func</span>&nbsp;<span class="op" id="3643428">(</span><span class="ident" id="3643429">f</span>&nbsp;<span class="op" id="3643431">*</span><span class="ident" id="3643432">File</span><span class="op" id="3643436">)</span>&nbsp;<span class="ident" id="3643438">AddLine</span><span class="op" id="3643445">(</span><span class="ident" id="3643446">offset</span>&nbsp;<span class="builtintype" id="3643453">int</span><span class="op" id="3643456">)</span>&nbsp;<span class="op" id="3643458">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3643461">f</span><span class="op" id="3643462">.</span><span class="ident" id="3643463">set</span><span class="op" id="3643466">.</span><span class="ident" id="3643467">mutex</span><span class="op" id="3643472">.</span><span class="ident" id="3643473">Lock</span><span class="op" id="3643477">(</span><span class="op" id="3643478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3643481">if</span>&nbsp;<span class="ident" id="3643484">i</span>&nbsp;<span class="op" id="3643486">:=</span>&nbsp;<span class="builtinfunc" id="3643489">len</span><span class="op" id="3643492">(</span><span class="ident" id="3643493">f</span><span class="op" id="3643494">.</span><span class="ident" id="3643495">lines</span><span class="op" id="3643500">)</span><span class="op" id="3643501">;</span>&nbsp;<span class="op" id="3643503">(</span><span class="ident" id="3643504">i</span>&nbsp;<span class="op" id="3643506">==</span>&nbsp;<span class="num" id="3643509">0</span>&nbsp;<span class="op" id="3643511">||</span>&nbsp;<span class="ident" id="3643514">f</span><span class="op" id="3643515">.</span><span class="ident" id="3643516">lines</span><span class="op" id="3643521">[</span><span class="ident" id="3643522">i</span><span class="op" id="3643523">-</span><span class="num" id="3643524">1</span><span class="op" id="3643525">]</span>&nbsp;<span class="op" id="3643527">&lt;</span>&nbsp;<span class="ident" id="3643529">offset</span><span class="op" id="3643535">)</span>&nbsp;<span class="op" id="3643537">&amp;&amp;</span>&nbsp;<span class="ident" id="3643540">offset</span>&nbsp;<span class="op" id="3643547">&lt;</span>&nbsp;<span class="ident" id="3643549">f</span><span class="op" id="3643550">.</span><span class="ident" id="3643551">size</span>&nbsp;<span class="op" id="3643556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3643560">f</span><span class="op" id="3643561">.</span><span class="ident" id="3643562">lines</span>&nbsp;<span class="op" id="3643568">=</span>&nbsp;<span class="builtinfunc" id="3643570">append</span><span class="op" id="3643576">(</span><span class="ident" id="3643577">f</span><span class="op" id="3643578">.</span><span class="ident" id="3643579">lines</span><span class="op" id="3643584">,</span>&nbsp;<span class="ident" id="3643586">offset</span><span class="op" id="3643592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3643595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3643598">f</span><span class="op" id="3643599">.</span><span class="ident" id="3643600">set</span><span class="op" id="3643603">.</span><span class="ident" id="3643604">mutex</span><span class="op" id="3643609">.</span><span class="ident" id="3643610">Unlock</span><span class="op" id="3643616">(</span><span class="op" id="3643617">)</span><br>
<span class="lineno">135</span><span class="op" id="3643619">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3643622">//&nbsp;MergeLine&nbsp;merges&nbsp;a&nbsp;line&nbsp;with&nbsp;the&nbsp;following&nbsp;line.&nbsp;It&nbsp;is&nbsp;akin&nbsp;to&nbsp;replacing</span><br>
<span class="lineno"></span><span class="comment" id="3643698">//&nbsp;the&nbsp;newline&nbsp;character&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;line&nbsp;with&nbsp;a&nbsp;space&nbsp;(to&nbsp;not&nbsp;change&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3643778">//&nbsp;remaining&nbsp;offsets).&nbsp;To&nbsp;obtain&nbsp;the&nbsp;line&nbsp;number,&nbsp;consult&nbsp;e.g.&nbsp;Position.Line.</span><br>
<span class="lineno">140</span><span class="comment" id="3643856">//&nbsp;MergeLine&nbsp;will&nbsp;panic&nbsp;if&nbsp;given&nbsp;an&nbsp;invalid&nbsp;line&nbsp;number.</span><br>
<span class="lineno"></span><span class="comment" id="3643913">//</span><br>
<span class="lineno"></span><span class="keyword" id="3643916">func</span>&nbsp;<span class="op" id="3643921">(</span><span class="ident" id="3643922">f</span>&nbsp;<span class="op" id="3643924">*</span><span class="ident" id="3643925">File</span><span class="op" id="3643929">)</span>&nbsp;<span class="ident" id="3643931">MergeLine</span><span class="op" id="3643940">(</span><span class="ident" id="3643941">line</span>&nbsp;<span class="builtintype" id="3643946">int</span><span class="op" id="3643949">)</span>&nbsp;<span class="op" id="3643951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3643954">if</span>&nbsp;<span class="ident" id="3643957">line</span>&nbsp;<span class="op" id="3643962">&lt;=</span>&nbsp;<span class="num" id="3643965">0</span>&nbsp;<span class="op" id="3643967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3643971">panic</span><span class="op" id="3643976">(</span><span class="string" id="3643977">&#34;illegal&nbsp;line&nbsp;number&nbsp;(line&nbsp;numbering&nbsp;starts&nbsp;at&nbsp;1)&#34;</span><span class="op" id="3644027">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3644030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3644033">f</span><span class="op" id="3644034">.</span><span class="ident" id="3644035">set</span><span class="op" id="3644038">.</span><span class="ident" id="3644039">mutex</span><span class="op" id="3644044">.</span><span class="ident" id="3644045">Lock</span><span class="op" id="3644049">(</span><span class="op" id="3644050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3644053">defer</span>&nbsp;<span class="ident" id="3644059">f</span><span class="op" id="3644060">.</span><span class="ident" id="3644061">set</span><span class="op" id="3644064">.</span><span class="ident" id="3644065">mutex</span><span class="op" id="3644070">.</span><span class="ident" id="3644071">Unlock</span><span class="op" id="3644077">(</span><span class="op" id="3644078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3644081">if</span>&nbsp;<span class="ident" id="3644084">line</span>&nbsp;<span class="op" id="3644089">&gt;=</span>&nbsp;<span class="builtinfunc" id="3644092">len</span><span class="op" id="3644095">(</span><span class="ident" id="3644096">f</span><span class="op" id="3644097">.</span><span class="ident" id="3644098">lines</span><span class="op" id="3644103">)</span>&nbsp;<span class="op" id="3644105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3644109">panic</span><span class="op" id="3644114">(</span><span class="string" id="3644115">&#34;illegal&nbsp;line&nbsp;number&#34;</span><span class="op" id="3644136">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3644139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3644142">//&nbsp;To&nbsp;merge&nbsp;the&nbsp;line&nbsp;numbered&nbsp;&lt;line&gt;&nbsp;with&nbsp;the&nbsp;line&nbsp;numbered&nbsp;&lt;line+1&gt;,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3644213">//&nbsp;we&nbsp;need&nbsp;to&nbsp;remove&nbsp;the&nbsp;entry&nbsp;in&nbsp;lines&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3644280">//&nbsp;numbered&nbsp;&lt;line+1&gt;.&nbsp;The&nbsp;entry&nbsp;in&nbsp;lines&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3644348">//&nbsp;numbered&nbsp;&lt;line+1&gt;&nbsp;is&nbsp;located&nbsp;at&nbsp;index&nbsp;&lt;line&gt;,&nbsp;since&nbsp;indices&nbsp;in&nbsp;lines</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3644421">//&nbsp;are&nbsp;0-based&nbsp;and&nbsp;line&nbsp;numbers&nbsp;are&nbsp;1-based.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3644467">copy</span><span class="op" id="3644471">(</span><span class="ident" id="3644472">f</span><span class="op" id="3644473">.</span><span class="ident" id="3644474">lines</span><span class="op" id="3644479">[</span><span class="ident" id="3644480">line</span><span class="op" id="3644484">:</span><span class="op" id="3644485">]</span><span class="op" id="3644486">,</span>&nbsp;<span class="ident" id="3644488">f</span><span class="op" id="3644489">.</span><span class="ident" id="3644490">lines</span><span class="op" id="3644495">[</span><span class="ident" id="3644496">line</span><span class="op" id="3644500">+</span><span class="num" id="3644501">1</span><span class="op" id="3644502">:</span><span class="op" id="3644503">]</span><span class="op" id="3644504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3644507">f</span><span class="op" id="3644508">.</span><span class="ident" id="3644509">lines</span>&nbsp;<span class="op" id="3644515">=</span>&nbsp;<span class="ident" id="3644517">f</span><span class="op" id="3644518">.</span><span class="ident" id="3644519">lines</span><span class="op" id="3644524">[</span><span class="op" id="3644525">:</span><span class="builtinfunc" id="3644526">len</span><span class="op" id="3644529">(</span><span class="ident" id="3644530">f</span><span class="op" id="3644531">.</span><span class="ident" id="3644532">lines</span><span class="op" id="3644537">)</span><span class="op" id="3644538">-</span><span class="num" id="3644539">1</span><span class="op" id="3644540">]</span><br>
<span class="lineno"></span><span class="op" id="3644542">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="3644545">//&nbsp;SetLines&nbsp;sets&nbsp;the&nbsp;line&nbsp;offsets&nbsp;for&nbsp;a&nbsp;file&nbsp;and&nbsp;returns&nbsp;true&nbsp;if&nbsp;successful.</span><br>
<span class="lineno"></span><span class="comment" id="3644622">//&nbsp;The&nbsp;line&nbsp;offsets&nbsp;are&nbsp;the&nbsp;offsets&nbsp;of&nbsp;the&nbsp;first&nbsp;character&nbsp;of&nbsp;each&nbsp;line;</span><br>
<span class="lineno"></span><span class="comment" id="3644695">//&nbsp;for&nbsp;instance&nbsp;for&nbsp;the&nbsp;content&nbsp;&#34;ab\nc\n&#34;&nbsp;the&nbsp;line&nbsp;offsets&nbsp;are&nbsp;{0,&nbsp;3}.</span><br>
<span class="lineno"></span><span class="comment" id="3644766">//&nbsp;An&nbsp;empty&nbsp;file&nbsp;has&nbsp;an&nbsp;empty&nbsp;line&nbsp;offset&nbsp;table.</span><br>
<span class="lineno"></span><span class="comment" id="3644815">//&nbsp;Each&nbsp;line&nbsp;offset&nbsp;must&nbsp;be&nbsp;larger&nbsp;than&nbsp;the&nbsp;offset&nbsp;for&nbsp;the&nbsp;previous&nbsp;line</span><br>
<span class="lineno">165</span><span class="comment" id="3644888">//&nbsp;and&nbsp;smaller&nbsp;than&nbsp;the&nbsp;file&nbsp;size;&nbsp;otherwise&nbsp;SetLines&nbsp;fails&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="3644960">//&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="3644970">//</span><br>
<span class="lineno"></span><span class="keyword" id="3644973">func</span>&nbsp;<span class="op" id="3644978">(</span><span class="ident" id="3644979">f</span>&nbsp;<span class="op" id="3644981">*</span><span class="ident" id="3644982">File</span><span class="op" id="3644986">)</span>&nbsp;<span class="ident" id="3644988">SetLines</span><span class="op" id="3644996">(</span><span class="ident" id="3644997">lines</span>&nbsp;<span class="op" id="3645003">[</span><span class="op" id="3645004">]</span><span class="builtintype" id="3645005">int</span><span class="op" id="3645008">)</span>&nbsp;<span class="builtintype" id="3645010">bool</span>&nbsp;<span class="op" id="3645015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3645018">//&nbsp;verify&nbsp;validity&nbsp;of&nbsp;lines&nbsp;table</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3645053">size</span>&nbsp;<span class="op" id="3645058">:=</span>&nbsp;<span class="ident" id="3645061">f</span><span class="op" id="3645062">.</span><span class="ident" id="3645063">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3645069">for</span>&nbsp;<span class="ident" id="3645073">i</span><span class="op" id="3645074">,</span>&nbsp;<span class="ident" id="3645076">offset</span>&nbsp;<span class="op" id="3645083">:=</span>&nbsp;<span class="keyword" id="3645086">range</span>&nbsp;<span class="ident" id="3645092">lines</span>&nbsp;<span class="op" id="3645098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3645102">if</span>&nbsp;<span class="ident" id="3645105">i</span>&nbsp;<span class="op" id="3645107">&gt;</span>&nbsp;<span class="num" id="3645109">0</span>&nbsp;<span class="op" id="3645111">&amp;&amp;</span>&nbsp;<span class="ident" id="3645114">offset</span>&nbsp;<span class="op" id="3645121">&lt;=</span>&nbsp;<span class="ident" id="3645124">lines</span><span class="op" id="3645129">[</span><span class="ident" id="3645130">i</span><span class="op" id="3645131">-</span><span class="num" id="3645132">1</span><span class="op" id="3645133">]</span>&nbsp;<span class="op" id="3645135">||</span>&nbsp;<span class="ident" id="3645138">size</span>&nbsp;<span class="op" id="3645143">&lt;=</span>&nbsp;<span class="ident" id="3645146">offset</span>&nbsp;<span class="op" id="3645153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3645158">return</span>&nbsp;<span class="builtintype" id="3645165">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3645173">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3645176">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3645180">//&nbsp;set&nbsp;lines&nbsp;table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3645200">f</span><span class="op" id="3645201">.</span><span class="ident" id="3645202">set</span><span class="op" id="3645205">.</span><span class="ident" id="3645206">mutex</span><span class="op" id="3645211">.</span><span class="ident" id="3645212">Lock</span><span class="op" id="3645216">(</span><span class="op" id="3645217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3645220">f</span><span class="op" id="3645221">.</span><span class="ident" id="3645222">lines</span>&nbsp;<span class="op" id="3645228">=</span>&nbsp;<span class="ident" id="3645230">lines</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3645237">f</span><span class="op" id="3645238">.</span><span class="ident" id="3645239">set</span><span class="op" id="3645242">.</span><span class="ident" id="3645243">mutex</span><span class="op" id="3645248">.</span><span class="ident" id="3645249">Unlock</span><span class="op" id="3645255">(</span><span class="op" id="3645256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3645259">return</span>&nbsp;<span class="builtintype" id="3645266">true</span><br>
<span class="lineno"></span><span class="op" id="3645271">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3645274">//&nbsp;SetLinesForContent&nbsp;sets&nbsp;the&nbsp;line&nbsp;offsets&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;content.</span><br>
<span class="lineno">185</span><span class="comment" id="3645346">//&nbsp;It&nbsp;ignores&nbsp;position-altering&nbsp;//line&nbsp;comments.</span><br>
<span class="lineno"></span><span class="keyword" id="3645395">func</span>&nbsp;<span class="op" id="3645400">(</span><span class="ident" id="3645401">f</span>&nbsp;<span class="op" id="3645403">*</span><span class="ident" id="3645404">File</span><span class="op" id="3645408">)</span>&nbsp;<span class="ident" id="3645410">SetLinesForContent</span><span class="op" id="3645428">(</span><span class="ident" id="3645429">content</span>&nbsp;<span class="op" id="3645437">[</span><span class="op" id="3645438">]</span><span class="builtintype" id="3645439">byte</span><span class="op" id="3645443">)</span>&nbsp;<span class="op" id="3645445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3645448">var</span>&nbsp;<span class="ident" id="3645452">lines</span>&nbsp;<span class="op" id="3645458">[</span><span class="op" id="3645459">]</span><span class="builtintype" id="3645460">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3645465">line</span>&nbsp;<span class="op" id="3645470">:=</span>&nbsp;<span class="num" id="3645473">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3645476">for</span>&nbsp;<span class="ident" id="3645480">offset</span><span class="op" id="3645486">,</span>&nbsp;<span class="ident" id="3645488">b</span>&nbsp;<span class="op" id="3645490">:=</span>&nbsp;<span class="keyword" id="3645493">range</span>&nbsp;<span class="ident" id="3645499">content</span>&nbsp;<span class="op" id="3645507">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3645511">if</span>&nbsp;<span class="ident" id="3645514">line</span>&nbsp;<span class="op" id="3645519">&gt;=</span>&nbsp;<span class="num" id="3645522">0</span>&nbsp;<span class="op" id="3645524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3645529">lines</span>&nbsp;<span class="op" id="3645535">=</span>&nbsp;<span class="builtinfunc" id="3645537">append</span><span class="op" id="3645543">(</span><span class="ident" id="3645544">lines</span><span class="op" id="3645549">,</span>&nbsp;<span class="ident" id="3645551">line</span><span class="op" id="3645555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3645559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3645563">line</span>&nbsp;<span class="op" id="3645568">=</span>&nbsp;<span class="op" id="3645570">-</span><span class="num" id="3645571">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3645575">if</span>&nbsp;<span class="ident" id="3645578">b</span>&nbsp;<span class="op" id="3645580">==</span>&nbsp;<span class="string" id="3645583">&#39;\n&#39;</span>&nbsp;<span class="op" id="3645588">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3645593">line</span>&nbsp;<span class="op" id="3645598">=</span>&nbsp;<span class="ident" id="3645600">offset</span>&nbsp;<span class="op" id="3645607">+</span>&nbsp;<span class="num" id="3645609">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3645613">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3645616">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3645620">//&nbsp;set&nbsp;lines&nbsp;table</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3645640">f</span><span class="op" id="3645641">.</span><span class="ident" id="3645642">set</span><span class="op" id="3645645">.</span><span class="ident" id="3645646">mutex</span><span class="op" id="3645651">.</span><span class="ident" id="3645652">Lock</span><span class="op" id="3645656">(</span><span class="op" id="3645657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3645660">f</span><span class="op" id="3645661">.</span><span class="ident" id="3645662">lines</span>&nbsp;<span class="op" id="3645668">=</span>&nbsp;<span class="ident" id="3645670">lines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3645677">f</span><span class="op" id="3645678">.</span><span class="ident" id="3645679">set</span><span class="op" id="3645682">.</span><span class="ident" id="3645683">mutex</span><span class="op" id="3645688">.</span><span class="ident" id="3645689">Unlock</span><span class="op" id="3645695">(</span><span class="op" id="3645696">)</span><br>
<span class="lineno"></span><span class="op" id="3645698">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="comment" id="3645701">//&nbsp;A&nbsp;lineInfo&nbsp;object&nbsp;describes&nbsp;alternative&nbsp;file&nbsp;and&nbsp;line&nbsp;number</span><br>
<span class="lineno"></span><span class="comment" id="3645765">//&nbsp;information&nbsp;(such&nbsp;as&nbsp;provided&nbsp;via&nbsp;a&nbsp;//line&nbsp;comment&nbsp;in&nbsp;a&nbsp;.go</span><br>
<span class="lineno"></span><span class="comment" id="3645828">//&nbsp;file)&nbsp;for&nbsp;a&nbsp;given&nbsp;file&nbsp;offset.</span><br>
<span class="lineno"></span><span class="keyword" id="3645862">type</span>&nbsp;<span class="ident" id="3645867">lineInfo</span>&nbsp;<span class="keyword" id="3645876">struct</span>&nbsp;<span class="op" id="3645883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3645886">//&nbsp;fields&nbsp;are&nbsp;exported&nbsp;to&nbsp;make&nbsp;them&nbsp;accessible&nbsp;to&nbsp;gob</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3645941">Offset</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3645950">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3645955">Filename</span>&nbsp;<span class="builtintype" id="3645964">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3645972">Line</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3645981">int</span><br>
<span class="lineno"></span><span class="op" id="3645985">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="comment" id="3645988">//&nbsp;AddLineInfo&nbsp;adds&nbsp;alternative&nbsp;file&nbsp;and&nbsp;line&nbsp;number&nbsp;information&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="3646057">//&nbsp;a&nbsp;given&nbsp;file&nbsp;offset.&nbsp;The&nbsp;offset&nbsp;must&nbsp;be&nbsp;larger&nbsp;than&nbsp;the&nbsp;offset&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="3646127">//&nbsp;the&nbsp;previously&nbsp;added&nbsp;alternative&nbsp;line&nbsp;info&nbsp;and&nbsp;smaller&nbsp;than&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3646194">//&nbsp;file&nbsp;size;&nbsp;otherwise&nbsp;the&nbsp;information&nbsp;is&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="3646246">//</span><br>
<span class="lineno">220</span><span class="comment" id="3646249">//&nbsp;AddLineInfo&nbsp;is&nbsp;typically&nbsp;used&nbsp;to&nbsp;register&nbsp;alternative&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="3646315">//&nbsp;information&nbsp;for&nbsp;//line&nbsp;filename:line&nbsp;comments&nbsp;in&nbsp;source&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="3646381">//</span><br>
<span class="lineno"></span><span class="keyword" id="3646384">func</span>&nbsp;<span class="op" id="3646389">(</span><span class="ident" id="3646390">f</span>&nbsp;<span class="op" id="3646392">*</span><span class="ident" id="3646393">File</span><span class="op" id="3646397">)</span>&nbsp;<span class="ident" id="3646399">AddLineInfo</span><span class="op" id="3646410">(</span><span class="ident" id="3646411">offset</span>&nbsp;<span class="builtintype" id="3646418">int</span><span class="op" id="3646421">,</span>&nbsp;<span class="ident" id="3646423">filename</span>&nbsp;<span class="builtintype" id="3646432">string</span><span class="op" id="3646438">,</span>&nbsp;<span class="ident" id="3646440">line</span>&nbsp;<span class="builtintype" id="3646445">int</span><span class="op" id="3646448">)</span>&nbsp;<span class="op" id="3646450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3646453">f</span><span class="op" id="3646454">.</span><span class="ident" id="3646455">set</span><span class="op" id="3646458">.</span><span class="ident" id="3646459">mutex</span><span class="op" id="3646464">.</span><span class="ident" id="3646465">Lock</span><span class="op" id="3646469">(</span><span class="op" id="3646470">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3646473">if</span>&nbsp;<span class="ident" id="3646476">i</span>&nbsp;<span class="op" id="3646478">:=</span>&nbsp;<span class="builtinfunc" id="3646481">len</span><span class="op" id="3646484">(</span><span class="ident" id="3646485">f</span><span class="op" id="3646486">.</span><span class="ident" id="3646487">infos</span><span class="op" id="3646492">)</span><span class="op" id="3646493">;</span>&nbsp;<span class="ident" id="3646495">i</span>&nbsp;<span class="op" id="3646497">==</span>&nbsp;<span class="num" id="3646500">0</span>&nbsp;<span class="op" id="3646502">||</span>&nbsp;<span class="ident" id="3646505">f</span><span class="op" id="3646506">.</span><span class="ident" id="3646507">infos</span><span class="op" id="3646512">[</span><span class="ident" id="3646513">i</span><span class="op" id="3646514">-</span><span class="num" id="3646515">1</span><span class="op" id="3646516">]</span><span class="op" id="3646517">.</span><span class="ident" id="3646518">Offset</span>&nbsp;<span class="op" id="3646525">&lt;</span>&nbsp;<span class="ident" id="3646527">offset</span>&nbsp;<span class="op" id="3646534">&amp;&amp;</span>&nbsp;<span class="ident" id="3646537">offset</span>&nbsp;<span class="op" id="3646544">&lt;</span>&nbsp;<span class="ident" id="3646546">f</span><span class="op" id="3646547">.</span><span class="ident" id="3646548">size</span>&nbsp;<span class="op" id="3646553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3646557">f</span><span class="op" id="3646558">.</span><span class="ident" id="3646559">infos</span>&nbsp;<span class="op" id="3646565">=</span>&nbsp;<span class="builtinfunc" id="3646567">append</span><span class="op" id="3646573">(</span><span class="ident" id="3646574">f</span><span class="op" id="3646575">.</span><span class="ident" id="3646576">infos</span><span class="op" id="3646581">,</span>&nbsp;<span class="ident" id="3646583">lineInfo</span><span class="op" id="3646591">{</span><span class="ident" id="3646592">offset</span><span class="op" id="3646598">,</span>&nbsp;<span class="ident" id="3646600">filename</span><span class="op" id="3646608">,</span>&nbsp;<span class="ident" id="3646610">line</span><span class="op" id="3646614">}</span><span class="op" id="3646615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3646618">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3646621">f</span><span class="op" id="3646622">.</span><span class="ident" id="3646623">set</span><span class="op" id="3646626">.</span><span class="ident" id="3646627">mutex</span><span class="op" id="3646632">.</span><span class="ident" id="3646633">Unlock</span><span class="op" id="3646639">(</span><span class="op" id="3646640">)</span><br>
<span class="lineno"></span><span class="op" id="3646642">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="3646645">//&nbsp;Pos&nbsp;returns&nbsp;the&nbsp;Pos&nbsp;value&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;offset;</span><br>
<span class="lineno"></span><span class="comment" id="3646701">//&nbsp;the&nbsp;offset&nbsp;must&nbsp;be&nbsp;&lt;=&nbsp;f.Size().</span><br>
<span class="lineno"></span><span class="comment" id="3646736">//&nbsp;f.Pos(f.Offset(p))&nbsp;==&nbsp;p.</span><br>
<span class="lineno"></span><span class="comment" id="3646764">//</span><br>
<span class="lineno">235</span><span class="keyword" id="3646767">func</span>&nbsp;<span class="op" id="3646772">(</span><span class="ident" id="3646773">f</span>&nbsp;<span class="op" id="3646775">*</span><span class="ident" id="3646776">File</span><span class="op" id="3646780">)</span>&nbsp;<span class="ident" id="3646782">Pos</span><span class="op" id="3646785">(</span><span class="ident" id="3646786">offset</span>&nbsp;<span class="builtintype" id="3646793">int</span><span class="op" id="3646796">)</span>&nbsp;<span class="ident" id="3646798">Pos</span>&nbsp;<span class="op" id="3646802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3646805">if</span>&nbsp;<span class="ident" id="3646808">offset</span>&nbsp;<span class="op" id="3646815">&gt;</span>&nbsp;<span class="ident" id="3646817">f</span><span class="op" id="3646818">.</span><span class="ident" id="3646819">size</span>&nbsp;<span class="op" id="3646824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3646828">panic</span><span class="op" id="3646833">(</span><span class="string" id="3646834">&#34;illegal&nbsp;file&nbsp;offset&#34;</span><span class="op" id="3646855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3646858">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3646861">return</span>&nbsp;<span class="ident" id="3646868">Pos</span><span class="op" id="3646871">(</span><span class="ident" id="3646872">f</span><span class="op" id="3646873">.</span><span class="ident" id="3646874">base</span>&nbsp;<span class="op" id="3646879">+</span>&nbsp;<span class="ident" id="3646881">offset</span><span class="op" id="3646887">)</span><br>
<span class="lineno">240</span><span class="op" id="3646889">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3646892">//&nbsp;Offset&nbsp;returns&nbsp;the&nbsp;offset&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;position&nbsp;p;</span><br>
<span class="lineno"></span><span class="comment" id="3646952">//&nbsp;p&nbsp;must&nbsp;be&nbsp;a&nbsp;valid&nbsp;Pos&nbsp;value&nbsp;in&nbsp;that&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="3646997">//&nbsp;f.Offset(f.Pos(offset))&nbsp;==&nbsp;offset.</span><br>
<span class="lineno">245</span><span class="comment" id="3647035">//</span><br>
<span class="lineno"></span><span class="keyword" id="3647038">func</span>&nbsp;<span class="op" id="3647043">(</span><span class="ident" id="3647044">f</span>&nbsp;<span class="op" id="3647046">*</span><span class="ident" id="3647047">File</span><span class="op" id="3647051">)</span>&nbsp;<span class="ident" id="3647053">Offset</span><span class="op" id="3647059">(</span><span class="ident" id="3647060">p</span>&nbsp;<span class="ident" id="3647062">Pos</span><span class="op" id="3647065">)</span>&nbsp;<span class="builtintype" id="3647067">int</span>&nbsp;<span class="op" id="3647071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3647074">if</span>&nbsp;<span class="builtintype" id="3647077">int</span><span class="op" id="3647080">(</span><span class="ident" id="3647081">p</span><span class="op" id="3647082">)</span>&nbsp;<span class="op" id="3647084">&lt;</span>&nbsp;<span class="ident" id="3647086">f</span><span class="op" id="3647087">.</span><span class="ident" id="3647088">base</span>&nbsp;<span class="op" id="3647093">||</span>&nbsp;<span class="builtintype" id="3647096">int</span><span class="op" id="3647099">(</span><span class="ident" id="3647100">p</span><span class="op" id="3647101">)</span>&nbsp;<span class="op" id="3647103">&gt;</span>&nbsp;<span class="ident" id="3647105">f</span><span class="op" id="3647106">.</span><span class="ident" id="3647107">base</span><span class="op" id="3647111">+</span><span class="ident" id="3647112">f</span><span class="op" id="3647113">.</span><span class="ident" id="3647114">size</span>&nbsp;<span class="op" id="3647119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3647123">panic</span><span class="op" id="3647128">(</span><span class="string" id="3647129">&#34;illegal&nbsp;Pos&nbsp;value&#34;</span><span class="op" id="3647148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3647151">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3647154">return</span>&nbsp;<span class="builtintype" id="3647161">int</span><span class="op" id="3647164">(</span><span class="ident" id="3647165">p</span><span class="op" id="3647166">)</span>&nbsp;<span class="op" id="3647168">-</span>&nbsp;<span class="ident" id="3647170">f</span><span class="op" id="3647171">.</span><span class="ident" id="3647172">base</span><br>
<span class="lineno"></span><span class="op" id="3647177">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3647180">//&nbsp;Line&nbsp;returns&nbsp;the&nbsp;line&nbsp;number&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;position&nbsp;p;</span><br>
<span class="lineno"></span><span class="comment" id="3647243">//&nbsp;p&nbsp;must&nbsp;be&nbsp;a&nbsp;Pos&nbsp;value&nbsp;in&nbsp;that&nbsp;file&nbsp;or&nbsp;NoPos.</span><br>
<span class="lineno">255</span><span class="comment" id="3647291">//</span><br>
<span class="lineno"></span><span class="keyword" id="3647294">func</span>&nbsp;<span class="op" id="3647299">(</span><span class="ident" id="3647300">f</span>&nbsp;<span class="op" id="3647302">*</span><span class="ident" id="3647303">File</span><span class="op" id="3647307">)</span>&nbsp;<span class="ident" id="3647309">Line</span><span class="op" id="3647313">(</span><span class="ident" id="3647314">p</span>&nbsp;<span class="ident" id="3647316">Pos</span><span class="op" id="3647319">)</span>&nbsp;<span class="builtintype" id="3647321">int</span>&nbsp;<span class="op" id="3647325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3647328">return</span>&nbsp;<span class="ident" id="3647335">f</span><span class="op" id="3647336">.</span><span class="ident" id="3647337">Position</span><span class="op" id="3647345">(</span><span class="ident" id="3647346">p</span><span class="op" id="3647347">)</span><span class="op" id="3647348">.</span><span class="ident" id="3647349">Line</span><br>
<span class="lineno"></span><span class="op" id="3647354">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="keyword" id="3647357">func</span>&nbsp;<span class="ident" id="3647362">searchLineInfos</span><span class="op" id="3647377">(</span><span class="ident" id="3647378">a</span>&nbsp;<span class="op" id="3647380">[</span><span class="op" id="3647381">]</span><span class="ident" id="3647382">lineInfo</span><span class="op" id="3647390">,</span>&nbsp;<span class="ident" id="3647392">x</span>&nbsp;<span class="builtintype" id="3647394">int</span><span class="op" id="3647397">)</span>&nbsp;<span class="builtintype" id="3647399">int</span>&nbsp;<span class="op" id="3647403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3647406">return</span>&nbsp;<span class="ident" id="3647413">sort</span><span class="op" id="3647417">.</span><span class="ident" id="3647418">Search</span><span class="op" id="3647424">(</span><span class="builtinfunc" id="3647425">len</span><span class="op" id="3647428">(</span><span class="ident" id="3647429">a</span><span class="op" id="3647430">)</span><span class="op" id="3647431">,</span>&nbsp;<span class="keyword" id="3647433">func</span><span class="op" id="3647437">(</span><span class="ident" id="3647438">i</span>&nbsp;<span class="builtintype" id="3647440">int</span><span class="op" id="3647443">)</span>&nbsp;<span class="builtintype" id="3647445">bool</span>&nbsp;<span class="op" id="3647450">{</span>&nbsp;<span class="keyword" id="3647452">return</span>&nbsp;<span class="ident" id="3647459">a</span><span class="op" id="3647460">[</span><span class="ident" id="3647461">i</span><span class="op" id="3647462">]</span><span class="op" id="3647463">.</span><span class="ident" id="3647464">Offset</span>&nbsp;<span class="op" id="3647471">&gt;</span>&nbsp;<span class="ident" id="3647473">x</span>&nbsp;<span class="op" id="3647475">}</span><span class="op" id="3647476">)</span>&nbsp;<span class="op" id="3647478">-</span>&nbsp;<span class="num" id="3647480">1</span><br>
<span class="lineno"></span><span class="op" id="3647482">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3647485">//&nbsp;unpack&nbsp;returns&nbsp;the&nbsp;filename&nbsp;and&nbsp;line&nbsp;and&nbsp;column&nbsp;number&nbsp;for&nbsp;a&nbsp;file&nbsp;offset.</span><br>
<span class="lineno">265</span><span class="comment" id="3647562">//&nbsp;If&nbsp;adjusted&nbsp;is&nbsp;set,&nbsp;unpack&nbsp;will&nbsp;return&nbsp;the&nbsp;filename&nbsp;and&nbsp;line&nbsp;information</span><br>
<span class="lineno"></span><span class="comment" id="3647638">//&nbsp;possibly&nbsp;adjusted&nbsp;by&nbsp;//line&nbsp;comments;&nbsp;otherwise&nbsp;those&nbsp;comments&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="3647717">//</span><br>
<span class="lineno"></span><span class="keyword" id="3647720">func</span>&nbsp;<span class="op" id="3647725">(</span><span class="ident" id="3647726">f</span>&nbsp;<span class="op" id="3647728">*</span><span class="ident" id="3647729">File</span><span class="op" id="3647733">)</span>&nbsp;<span class="ident" id="3647735">unpack</span><span class="op" id="3647741">(</span><span class="ident" id="3647742">offset</span>&nbsp;<span class="builtintype" id="3647749">int</span><span class="op" id="3647752">,</span>&nbsp;<span class="ident" id="3647754">adjusted</span>&nbsp;<span class="builtintype" id="3647763">bool</span><span class="op" id="3647767">)</span>&nbsp;<span class="op" id="3647769">(</span><span class="ident" id="3647770">filename</span>&nbsp;<span class="builtintype" id="3647779">string</span><span class="op" id="3647785">,</span>&nbsp;<span class="ident" id="3647787">line</span><span class="op" id="3647791">,</span>&nbsp;<span class="ident" id="3647793">column</span>&nbsp;<span class="builtintype" id="3647800">int</span><span class="op" id="3647803">)</span>&nbsp;<span class="op" id="3647805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3647808">filename</span>&nbsp;<span class="op" id="3647817">=</span>&nbsp;<span class="ident" id="3647819">f</span><span class="op" id="3647820">.</span><span class="ident" id="3647821">name</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3647827">if</span>&nbsp;<span class="ident" id="3647830">i</span>&nbsp;<span class="op" id="3647832">:=</span>&nbsp;<span class="ident" id="3647835">searchInts</span><span class="op" id="3647845">(</span><span class="ident" id="3647846">f</span><span class="op" id="3647847">.</span><span class="ident" id="3647848">lines</span><span class="op" id="3647853">,</span>&nbsp;<span class="ident" id="3647855">offset</span><span class="op" id="3647861">)</span><span class="op" id="3647862">;</span>&nbsp;<span class="ident" id="3647864">i</span>&nbsp;<span class="op" id="3647866">&gt;=</span>&nbsp;<span class="num" id="3647869">0</span>&nbsp;<span class="op" id="3647871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3647875">line</span><span class="op" id="3647879">,</span>&nbsp;<span class="ident" id="3647881">column</span>&nbsp;<span class="op" id="3647888">=</span>&nbsp;<span class="ident" id="3647890">i</span><span class="op" id="3647891">+</span><span class="num" id="3647892">1</span><span class="op" id="3647893">,</span>&nbsp;<span class="ident" id="3647895">offset</span><span class="op" id="3647901">-</span><span class="ident" id="3647902">f</span><span class="op" id="3647903">.</span><span class="ident" id="3647904">lines</span><span class="op" id="3647909">[</span><span class="ident" id="3647910">i</span><span class="op" id="3647911">]</span><span class="op" id="3647912">+</span><span class="num" id="3647913">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3647916">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3647919">if</span>&nbsp;<span class="ident" id="3647922">adjusted</span>&nbsp;<span class="op" id="3647931">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3647934">len</span><span class="op" id="3647937">(</span><span class="ident" id="3647938">f</span><span class="op" id="3647939">.</span><span class="ident" id="3647940">infos</span><span class="op" id="3647945">)</span>&nbsp;<span class="op" id="3647947">&gt;</span>&nbsp;<span class="num" id="3647949">0</span>&nbsp;<span class="op" id="3647951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3647955">//&nbsp;almost&nbsp;no&nbsp;files&nbsp;have&nbsp;extra&nbsp;line&nbsp;infos</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3647998">if</span>&nbsp;<span class="ident" id="3648001">i</span>&nbsp;<span class="op" id="3648003">:=</span>&nbsp;<span class="ident" id="3648006">searchLineInfos</span><span class="op" id="3648021">(</span><span class="ident" id="3648022">f</span><span class="op" id="3648023">.</span><span class="ident" id="3648024">infos</span><span class="op" id="3648029">,</span>&nbsp;<span class="ident" id="3648031">offset</span><span class="op" id="3648037">)</span><span class="op" id="3648038">;</span>&nbsp;<span class="ident" id="3648040">i</span>&nbsp;<span class="op" id="3648042">&gt;=</span>&nbsp;<span class="num" id="3648045">0</span>&nbsp;<span class="op" id="3648047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3648052">alt</span>&nbsp;<span class="op" id="3648056">:=</span>&nbsp;<span class="op" id="3648059">&amp;</span><span class="ident" id="3648060">f</span><span class="op" id="3648061">.</span><span class="ident" id="3648062">infos</span><span class="op" id="3648067">[</span><span class="ident" id="3648068">i</span><span class="op" id="3648069">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3648074">filename</span>&nbsp;<span class="op" id="3648083">=</span>&nbsp;<span class="ident" id="3648085">alt</span><span class="op" id="3648088">.</span><span class="ident" id="3648089">Filename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3648101">if</span>&nbsp;<span class="ident" id="3648104">i</span>&nbsp;<span class="op" id="3648106">:=</span>&nbsp;<span class="ident" id="3648109">searchInts</span><span class="op" id="3648119">(</span><span class="ident" id="3648120">f</span><span class="op" id="3648121">.</span><span class="ident" id="3648122">lines</span><span class="op" id="3648127">,</span>&nbsp;<span class="ident" id="3648129">alt</span><span class="op" id="3648132">.</span><span class="ident" id="3648133">Offset</span><span class="op" id="3648139">)</span><span class="op" id="3648140">;</span>&nbsp;<span class="ident" id="3648142">i</span>&nbsp;<span class="op" id="3648144">&gt;=</span>&nbsp;<span class="num" id="3648147">0</span>&nbsp;<span class="op" id="3648149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3648155">line</span>&nbsp;<span class="op" id="3648160">+=</span>&nbsp;<span class="ident" id="3648163">alt</span><span class="op" id="3648166">.</span><span class="ident" id="3648167">Line</span>&nbsp;<span class="op" id="3648172">-</span>&nbsp;<span class="ident" id="3648174">i</span>&nbsp;<span class="op" id="3648176">-</span>&nbsp;<span class="num" id="3648178">1</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3648183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3648187">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3648190">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3648193">return</span><br>
<span class="lineno"></span><span class="op" id="3648200">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="keyword" id="3648203">func</span>&nbsp;<span class="op" id="3648208">(</span><span class="ident" id="3648209">f</span>&nbsp;<span class="op" id="3648211">*</span><span class="ident" id="3648212">File</span><span class="op" id="3648216">)</span>&nbsp;<span class="ident" id="3648218">position</span><span class="op" id="3648226">(</span><span class="ident" id="3648227">p</span>&nbsp;<span class="ident" id="3648229">Pos</span><span class="op" id="3648232">,</span>&nbsp;<span class="ident" id="3648234">adjusted</span>&nbsp;<span class="builtintype" id="3648243">bool</span><span class="op" id="3648247">)</span>&nbsp;<span class="op" id="3648249">(</span><span class="ident" id="3648250">pos</span>&nbsp;<span class="ident" id="3648254">Position</span><span class="op" id="3648262">)</span>&nbsp;<span class="op" id="3648264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3648267">offset</span>&nbsp;<span class="op" id="3648274">:=</span>&nbsp;<span class="builtintype" id="3648277">int</span><span class="op" id="3648280">(</span><span class="ident" id="3648281">p</span><span class="op" id="3648282">)</span>&nbsp;<span class="op" id="3648284">-</span>&nbsp;<span class="ident" id="3648286">f</span><span class="op" id="3648287">.</span><span class="ident" id="3648288">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3648294">pos</span><span class="op" id="3648297">.</span><span class="ident" id="3648298">Offset</span>&nbsp;<span class="op" id="3648305">=</span>&nbsp;<span class="ident" id="3648307">offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3648315">pos</span><span class="op" id="3648318">.</span><span class="ident" id="3648319">Filename</span><span class="op" id="3648327">,</span>&nbsp;<span class="ident" id="3648329">pos</span><span class="op" id="3648332">.</span><span class="ident" id="3648333">Line</span><span class="op" id="3648337">,</span>&nbsp;<span class="ident" id="3648339">pos</span><span class="op" id="3648342">.</span><span class="ident" id="3648343">Column</span>&nbsp;<span class="op" id="3648350">=</span>&nbsp;<span class="ident" id="3648352">f</span><span class="op" id="3648353">.</span><span class="ident" id="3648354">unpack</span><span class="op" id="3648360">(</span><span class="ident" id="3648361">offset</span><span class="op" id="3648367">,</span>&nbsp;<span class="ident" id="3648369">adjusted</span><span class="op" id="3648377">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3648380">return</span><br>
<span class="lineno"></span><span class="op" id="3648387">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3648390">//&nbsp;PositionFor&nbsp;returns&nbsp;the&nbsp;Position&nbsp;value&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;position&nbsp;p.</span><br>
<span class="lineno"></span><span class="comment" id="3648463">//&nbsp;If&nbsp;adjusted&nbsp;is&nbsp;set,&nbsp;the&nbsp;position&nbsp;may&nbsp;be&nbsp;adjusted&nbsp;by&nbsp;position-altering</span><br>
<span class="lineno">295</span><span class="comment" id="3648536">//&nbsp;//line&nbsp;comments;&nbsp;otherwise&nbsp;those&nbsp;comments&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="3648594">//&nbsp;p&nbsp;must&nbsp;be&nbsp;a&nbsp;Pos&nbsp;value&nbsp;in&nbsp;f&nbsp;or&nbsp;NoPos.</span><br>
<span class="lineno"></span><span class="comment" id="3648634">//</span><br>
<span class="lineno"></span><span class="keyword" id="3648637">func</span>&nbsp;<span class="op" id="3648642">(</span><span class="ident" id="3648643">f</span>&nbsp;<span class="op" id="3648645">*</span><span class="ident" id="3648646">File</span><span class="op" id="3648650">)</span>&nbsp;<span class="ident" id="3648652">PositionFor</span><span class="op" id="3648663">(</span><span class="ident" id="3648664">p</span>&nbsp;<span class="ident" id="3648666">Pos</span><span class="op" id="3648669">,</span>&nbsp;<span class="ident" id="3648671">adjusted</span>&nbsp;<span class="builtintype" id="3648680">bool</span><span class="op" id="3648684">)</span>&nbsp;<span class="op" id="3648686">(</span><span class="ident" id="3648687">pos</span>&nbsp;<span class="ident" id="3648691">Position</span><span class="op" id="3648699">)</span>&nbsp;<span class="op" id="3648701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3648704">if</span>&nbsp;<span class="ident" id="3648707">p</span>&nbsp;<span class="op" id="3648709">!=</span>&nbsp;<span class="ident" id="3648712">NoPos</span>&nbsp;<span class="op" id="3648718">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3648722">if</span>&nbsp;<span class="builtintype" id="3648725">int</span><span class="op" id="3648728">(</span><span class="ident" id="3648729">p</span><span class="op" id="3648730">)</span>&nbsp;<span class="op" id="3648732">&lt;</span>&nbsp;<span class="ident" id="3648734">f</span><span class="op" id="3648735">.</span><span class="ident" id="3648736">base</span>&nbsp;<span class="op" id="3648741">||</span>&nbsp;<span class="builtintype" id="3648744">int</span><span class="op" id="3648747">(</span><span class="ident" id="3648748">p</span><span class="op" id="3648749">)</span>&nbsp;<span class="op" id="3648751">&gt;</span>&nbsp;<span class="ident" id="3648753">f</span><span class="op" id="3648754">.</span><span class="ident" id="3648755">base</span><span class="op" id="3648759">+</span><span class="ident" id="3648760">f</span><span class="op" id="3648761">.</span><span class="ident" id="3648762">size</span>&nbsp;<span class="op" id="3648767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3648772">panic</span><span class="op" id="3648777">(</span><span class="string" id="3648778">&#34;illegal&nbsp;Pos&nbsp;value&#34;</span><span class="op" id="3648797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3648801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3648805">pos</span>&nbsp;<span class="op" id="3648809">=</span>&nbsp;<span class="ident" id="3648811">f</span><span class="op" id="3648812">.</span><span class="ident" id="3648813">position</span><span class="op" id="3648821">(</span><span class="ident" id="3648822">p</span><span class="op" id="3648823">,</span>&nbsp;<span class="ident" id="3648825">adjusted</span><span class="op" id="3648833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3648836">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3648839">return</span><br>
<span class="lineno"></span><span class="op" id="3648846">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3648849">//&nbsp;Position&nbsp;returns&nbsp;the&nbsp;Position&nbsp;value&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;position&nbsp;p.</span><br>
<span class="lineno"></span><span class="comment" id="3648919">//&nbsp;Calling&nbsp;f.Position(p)&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;calling&nbsp;f.PositionFor(p,&nbsp;true).</span><br>
<span class="lineno">310</span><span class="comment" id="3648993">//</span><br>
<span class="lineno"></span><span class="keyword" id="3648996">func</span>&nbsp;<span class="op" id="3649001">(</span><span class="ident" id="3649002">f</span>&nbsp;<span class="op" id="3649004">*</span><span class="ident" id="3649005">File</span><span class="op" id="3649009">)</span>&nbsp;<span class="ident" id="3649011">Position</span><span class="op" id="3649019">(</span><span class="ident" id="3649020">p</span>&nbsp;<span class="ident" id="3649022">Pos</span><span class="op" id="3649025">)</span>&nbsp;<span class="op" id="3649027">(</span><span class="ident" id="3649028">pos</span>&nbsp;<span class="ident" id="3649032">Position</span><span class="op" id="3649040">)</span>&nbsp;<span class="op" id="3649042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3649045">return</span>&nbsp;<span class="ident" id="3649052">f</span><span class="op" id="3649053">.</span><span class="ident" id="3649054">PositionFor</span><span class="op" id="3649065">(</span><span class="ident" id="3649066">p</span><span class="op" id="3649067">,</span>&nbsp;<span class="builtintype" id="3649069">true</span><span class="op" id="3649073">)</span><br>
<span class="lineno"></span><span class="op" id="3649075">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="comment" id="3649078">//&nbsp;-----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="3649159">//&nbsp;FileSet</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3649171">//&nbsp;A&nbsp;FileSet&nbsp;represents&nbsp;a&nbsp;set&nbsp;of&nbsp;source&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="3649218">//&nbsp;Methods&nbsp;of&nbsp;file&nbsp;sets&nbsp;are&nbsp;synchronized;&nbsp;multiple&nbsp;goroutines</span><br>
<span class="lineno">320</span><span class="comment" id="3649280">//&nbsp;may&nbsp;invoke&nbsp;them&nbsp;concurrently.</span><br>
<span class="lineno"></span><span class="comment" id="3649313">//</span><br>
<span class="lineno"></span><span class="keyword" id="3649316">type</span>&nbsp;<span class="ident" id="3649321">FileSet</span>&nbsp;<span class="keyword" id="3649329">struct</span>&nbsp;<span class="op" id="3649336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3649339">mutex</span>&nbsp;<span class="ident" id="3649345">sync</span><span class="op" id="3649349">.</span><span class="ident" id="3649350">RWMutex</span>&nbsp;<span class="comment" id="3649358">//&nbsp;protects&nbsp;the&nbsp;file&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3649384">base</span>&nbsp;&nbsp;<span class="builtintype" id="3649390">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3649403">//&nbsp;base&nbsp;offset&nbsp;for&nbsp;the&nbsp;next&nbsp;file</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3649437">files</span>&nbsp;<span class="op" id="3649443">[</span><span class="op" id="3649444">]</span><span class="op" id="3649445">*</span><span class="ident" id="3649446">File</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3649456">//&nbsp;list&nbsp;of&nbsp;files&nbsp;in&nbsp;the&nbsp;order&nbsp;added&nbsp;to&nbsp;the&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3649504">last</span>&nbsp;&nbsp;<span class="op" id="3649510">*</span><span class="ident" id="3649511">File</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3649523">//&nbsp;cache&nbsp;of&nbsp;last&nbsp;file&nbsp;looked&nbsp;up</span><br>
<span class="lineno"></span><span class="op" id="3649555">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3649558">//&nbsp;NewFileSet&nbsp;creates&nbsp;a&nbsp;new&nbsp;file&nbsp;set.</span><br>
<span class="lineno">330</span><span class="keyword" id="3649596">func</span>&nbsp;<span class="ident" id="3649601">NewFileSet</span><span class="op" id="3649611">(</span><span class="op" id="3649612">)</span>&nbsp;<span class="op" id="3649614">*</span><span class="ident" id="3649615">FileSet</span>&nbsp;<span class="op" id="3649623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3649626">return</span>&nbsp;<span class="op" id="3649633">&amp;</span><span class="ident" id="3649634">FileSet</span><span class="op" id="3649641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3649645">base</span><span class="op" id="3649649">:</span>&nbsp;<span class="num" id="3649651">1</span><span class="op" id="3649652">,</span>&nbsp;<span class="comment" id="3649654">//&nbsp;0&nbsp;==&nbsp;NoPos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3649669">}</span><br>
<span class="lineno"></span><span class="op" id="3649671">}</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span><span class="comment" id="3649674">//&nbsp;Base&nbsp;returns&nbsp;the&nbsp;minimum&nbsp;base&nbsp;offset&nbsp;that&nbsp;must&nbsp;be&nbsp;provided&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3649739">//&nbsp;AddFile&nbsp;when&nbsp;adding&nbsp;the&nbsp;next&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="3649777">//</span><br>
<span class="lineno"></span><span class="keyword" id="3649780">func</span>&nbsp;<span class="op" id="3649785">(</span><span class="ident" id="3649786">s</span>&nbsp;<span class="op" id="3649788">*</span><span class="ident" id="3649789">FileSet</span><span class="op" id="3649796">)</span>&nbsp;<span class="ident" id="3649798">Base</span><span class="op" id="3649802">(</span><span class="op" id="3649803">)</span>&nbsp;<span class="builtintype" id="3649805">int</span>&nbsp;<span class="op" id="3649809">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3649812">s</span><span class="op" id="3649813">.</span><span class="ident" id="3649814">mutex</span><span class="op" id="3649819">.</span><span class="ident" id="3649820">RLock</span><span class="op" id="3649825">(</span><span class="op" id="3649826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3649829">b</span>&nbsp;<span class="op" id="3649831">:=</span>&nbsp;<span class="ident" id="3649834">s</span><span class="op" id="3649835">.</span><span class="ident" id="3649836">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3649842">s</span><span class="op" id="3649843">.</span><span class="ident" id="3649844">mutex</span><span class="op" id="3649849">.</span><span class="ident" id="3649850">RUnlock</span><span class="op" id="3649857">(</span><span class="op" id="3649858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3649861">return</span>&nbsp;<span class="ident" id="3649868">b</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span><span class="op" id="3649871">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3649874">//&nbsp;AddFile&nbsp;adds&nbsp;a&nbsp;new&nbsp;file&nbsp;with&nbsp;a&nbsp;given&nbsp;filename,&nbsp;base&nbsp;offset,&nbsp;and&nbsp;file&nbsp;size</span><br>
<span class="lineno"></span><span class="comment" id="3649951">//&nbsp;to&nbsp;the&nbsp;file&nbsp;set&nbsp;s&nbsp;and&nbsp;returns&nbsp;the&nbsp;file.&nbsp;Multiple&nbsp;files&nbsp;may&nbsp;have&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span><span class="comment" id="3650027">//&nbsp;name.&nbsp;The&nbsp;base&nbsp;offset&nbsp;must&nbsp;not&nbsp;be&nbsp;smaller&nbsp;than&nbsp;the&nbsp;FileSet&#39;s&nbsp;Base(),&nbsp;and</span><br>
<span class="lineno">350</span><span class="comment" id="3650103">//&nbsp;size&nbsp;must&nbsp;not&nbsp;be&nbsp;negative.&nbsp;As&nbsp;a&nbsp;special&nbsp;case,&nbsp;if&nbsp;a&nbsp;negative&nbsp;base&nbsp;is&nbsp;provided,</span><br>
<span class="lineno"></span><span class="comment" id="3650184">//&nbsp;the&nbsp;current&nbsp;value&nbsp;of&nbsp;the&nbsp;FileSet&#39;s&nbsp;Base()&nbsp;is&nbsp;used&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="3650246">//</span><br>
<span class="lineno"></span><span class="comment" id="3650249">//&nbsp;Adding&nbsp;the&nbsp;file&nbsp;will&nbsp;set&nbsp;the&nbsp;file&nbsp;set&#39;s&nbsp;Base()&nbsp;value&nbsp;to&nbsp;base&nbsp;+&nbsp;size&nbsp;+&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="3650324">//&nbsp;as&nbsp;the&nbsp;minimum&nbsp;base&nbsp;value&nbsp;for&nbsp;the&nbsp;next&nbsp;file.&nbsp;The&nbsp;following&nbsp;relationship</span><br>
<span class="lineno">355</span><span class="comment" id="3650399">//&nbsp;exists&nbsp;between&nbsp;a&nbsp;Pos&nbsp;value&nbsp;p&nbsp;for&nbsp;a&nbsp;given&nbsp;file&nbsp;offset&nbsp;offs:</span><br>
<span class="lineno"></span><span class="comment" id="3650461">//</span><br>
<span class="lineno"></span><span class="comment" id="3650464">//&nbsp;&nbsp;&nbsp;&nbspint(p)&nbsp;=&nbsp;base&nbsp;+&nbsp;offs</span><br>
<span class="lineno"></span><span class="comment" id="3650488">//</span><br>
<span class="lineno"></span><span class="comment" id="3650491">//&nbsp;with&nbsp;offs&nbsp;in&nbsp;the&nbsp;range&nbsp;[0,&nbsp;size]&nbsp;and&nbsp;thus&nbsp;p&nbsp;in&nbsp;the&nbsp;range&nbsp;[base,&nbsp;base+size].</span><br>
<span class="lineno">360</span><span class="comment" id="3650570">//&nbsp;For&nbsp;convenience,&nbsp;File.Pos&nbsp;may&nbsp;be&nbsp;used&nbsp;to&nbsp;create&nbsp;file-specific&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="3650644">//&nbsp;values&nbsp;from&nbsp;a&nbsp;file&nbsp;offset.</span><br>
<span class="lineno"></span><span class="comment" id="3650674">//</span><br>
<span class="lineno"></span><span class="keyword" id="3650677">func</span>&nbsp;<span class="op" id="3650682">(</span><span class="ident" id="3650683">s</span>&nbsp;<span class="op" id="3650685">*</span><span class="ident" id="3650686">FileSet</span><span class="op" id="3650693">)</span>&nbsp;<span class="ident" id="3650695">AddFile</span><span class="op" id="3650702">(</span><span class="ident" id="3650703">filename</span>&nbsp;<span class="builtintype" id="3650712">string</span><span class="op" id="3650718">,</span>&nbsp;<span class="ident" id="3650720">base</span><span class="op" id="3650724">,</span>&nbsp;<span class="ident" id="3650726">size</span>&nbsp;<span class="builtintype" id="3650731">int</span><span class="op" id="3650734">)</span>&nbsp;<span class="op" id="3650736">*</span><span class="ident" id="3650737">File</span>&nbsp;<span class="op" id="3650742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3650745">s</span><span class="op" id="3650746">.</span><span class="ident" id="3650747">mutex</span><span class="op" id="3650752">.</span><span class="ident" id="3650753">Lock</span><span class="op" id="3650757">(</span><span class="op" id="3650758">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3650761">defer</span>&nbsp;<span class="ident" id="3650767">s</span><span class="op" id="3650768">.</span><span class="ident" id="3650769">mutex</span><span class="op" id="3650774">.</span><span class="ident" id="3650775">Unlock</span><span class="op" id="3650781">(</span><span class="op" id="3650782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3650785">if</span>&nbsp;<span class="ident" id="3650788">base</span>&nbsp;<span class="op" id="3650793">&lt;</span>&nbsp;<span class="num" id="3650795">0</span>&nbsp;<span class="op" id="3650797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3650801">base</span>&nbsp;<span class="op" id="3650806">=</span>&nbsp;<span class="ident" id="3650808">s</span><span class="op" id="3650809">.</span><span class="ident" id="3650810">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3650816">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3650819">if</span>&nbsp;<span class="ident" id="3650822">base</span>&nbsp;<span class="op" id="3650827">&lt;</span>&nbsp;<span class="ident" id="3650829">s</span><span class="op" id="3650830">.</span><span class="ident" id="3650831">base</span>&nbsp;<span class="op" id="3650836">||</span>&nbsp;<span class="ident" id="3650839">size</span>&nbsp;<span class="op" id="3650844">&lt;</span>&nbsp;<span class="num" id="3650846">0</span>&nbsp;<span class="op" id="3650848">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3650852">panic</span><span class="op" id="3650857">(</span><span class="string" id="3650858">&#34;illegal&nbsp;base&nbsp;or&nbsp;size&#34;</span><span class="op" id="3650880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3650883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3650886">//&nbsp;base&nbsp;&gt;=&nbsp;s.base&nbsp;&amp;&amp;&nbsp;size&nbsp;&gt;=&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3650918">f</span>&nbsp;<span class="op" id="3650920">:=</span>&nbsp;<span class="op" id="3650923">&amp;</span><span class="ident" id="3650924">File</span><span class="op" id="3650928">{</span><span class="ident" id="3650929">s</span><span class="op" id="3650930">,</span>&nbsp;<span class="ident" id="3650932">filename</span><span class="op" id="3650940">,</span>&nbsp;<span class="ident" id="3650942">base</span><span class="op" id="3650946">,</span>&nbsp;<span class="ident" id="3650948">size</span><span class="op" id="3650952">,</span>&nbsp;<span class="op" id="3650954">[</span><span class="op" id="3650955">]</span><span class="builtintype" id="3650956">int</span><span class="op" id="3650959">{</span><span class="num" id="3650960">0</span><span class="op" id="3650961">}</span><span class="op" id="3650962">,</span>&nbsp;<span class="ident" id="3650964">nil</span><span class="op" id="3650967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3650970">base</span>&nbsp;<span class="op" id="3650975">+=</span>&nbsp;<span class="ident" id="3650978">size</span>&nbsp;<span class="op" id="3650983">+</span>&nbsp;<span class="num" id="3650985">1</span>&nbsp;<span class="comment" id="3650987">//&nbsp;+1&nbsp;because&nbsp;EOF&nbsp;also&nbsp;has&nbsp;a&nbsp;position</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3651026">if</span>&nbsp;<span class="ident" id="3651029">base</span>&nbsp;<span class="op" id="3651034">&lt;</span>&nbsp;<span class="num" id="3651036">0</span>&nbsp;<span class="op" id="3651038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3651042">panic</span><span class="op" id="3651047">(</span><span class="string" id="3651048">&#34;token.Pos&nbsp;offset&nbsp;overflow&nbsp;(&gt;&nbsp;2G&nbsp;of&nbsp;source&nbsp;code&nbsp;in&nbsp;file&nbsp;set)&#34;</span><span class="op" id="3651109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3651112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3651115">//&nbsp;add&nbsp;the&nbsp;file&nbsp;to&nbsp;the&nbsp;file&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3651148">s</span><span class="op" id="3651149">.</span><span class="ident" id="3651150">base</span>&nbsp;<span class="op" id="3651155">=</span>&nbsp;<span class="ident" id="3651157">base</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3651163">s</span><span class="op" id="3651164">.</span><span class="ident" id="3651165">files</span>&nbsp;<span class="op" id="3651171">=</span>&nbsp;<span class="builtinfunc" id="3651173">append</span><span class="op" id="3651179">(</span><span class="ident" id="3651180">s</span><span class="op" id="3651181">.</span><span class="ident" id="3651182">files</span><span class="op" id="3651187">,</span>&nbsp;<span class="ident" id="3651189">f</span><span class="op" id="3651190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3651193">s</span><span class="op" id="3651194">.</span><span class="ident" id="3651195">last</span>&nbsp;<span class="op" id="3651200">=</span>&nbsp;<span class="ident" id="3651202">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3651205">return</span>&nbsp;<span class="ident" id="3651212">f</span><br>
<span class="lineno"></span><span class="op" id="3651214">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="comment" id="3651217">//&nbsp;Iterate&nbsp;calls&nbsp;f&nbsp;for&nbsp;the&nbsp;files&nbsp;in&nbsp;the&nbsp;file&nbsp;set&nbsp;in&nbsp;the&nbsp;order&nbsp;they&nbsp;were&nbsp;added</span><br>
<span class="lineno"></span><span class="comment" id="3651295">//&nbsp;until&nbsp;f&nbsp;returns&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="3651321">//</span><br>
<span class="lineno"></span><span class="keyword" id="3651324">func</span>&nbsp;<span class="op" id="3651329">(</span><span class="ident" id="3651330">s</span>&nbsp;<span class="op" id="3651332">*</span><span class="ident" id="3651333">FileSet</span><span class="op" id="3651340">)</span>&nbsp;<span class="ident" id="3651342">Iterate</span><span class="op" id="3651349">(</span><span class="ident" id="3651350">f</span>&nbsp;<span class="keyword" id="3651352">func</span><span class="op" id="3651356">(</span><span class="op" id="3651357">*</span><span class="ident" id="3651358">File</span><span class="op" id="3651362">)</span>&nbsp;<span class="builtintype" id="3651364">bool</span><span class="op" id="3651368">)</span>&nbsp;<span class="op" id="3651370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3651373">for</span>&nbsp;<span class="ident" id="3651377">i</span>&nbsp;<span class="op" id="3651379">:=</span>&nbsp;<span class="num" id="3651382">0</span><span class="op" id="3651383">;</span>&nbsp;<span class="op" id="3651385">;</span>&nbsp;<span class="ident" id="3651387">i</span><span class="op" id="3651388">++</span>&nbsp;<span class="op" id="3651391">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3651395">var</span>&nbsp;<span class="ident" id="3651399">file</span>&nbsp;<span class="op" id="3651404">*</span><span class="ident" id="3651405">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3651412">s</span><span class="op" id="3651413">.</span><span class="ident" id="3651414">mutex</span><span class="op" id="3651419">.</span><span class="ident" id="3651420">RLock</span><span class="op" id="3651425">(</span><span class="op" id="3651426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3651430">if</span>&nbsp;<span class="ident" id="3651433">i</span>&nbsp;<span class="op" id="3651435">&lt;</span>&nbsp;<span class="builtinfunc" id="3651437">len</span><span class="op" id="3651440">(</span><span class="ident" id="3651441">s</span><span class="op" id="3651442">.</span><span class="ident" id="3651443">files</span><span class="op" id="3651448">)</span>&nbsp;<span class="op" id="3651450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3651455">file</span>&nbsp;<span class="op" id="3651460">=</span>&nbsp;<span class="ident" id="3651462">s</span><span class="op" id="3651463">.</span><span class="ident" id="3651464">files</span><span class="op" id="3651469">[</span><span class="ident" id="3651470">i</span><span class="op" id="3651471">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3651475">}</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3651479">s</span><span class="op" id="3651480">.</span><span class="ident" id="3651481">mutex</span><span class="op" id="3651486">.</span><span class="ident" id="3651487">RUnlock</span><span class="op" id="3651494">(</span><span class="op" id="3651495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3651499">if</span>&nbsp;<span class="ident" id="3651502">file</span>&nbsp;<span class="op" id="3651507">==</span>&nbsp;<span class="ident" id="3651510">nil</span>&nbsp;<span class="op" id="3651514">||</span>&nbsp;<span class="op" id="3651517">!</span><span class="ident" id="3651518">f</span><span class="op" id="3651519">(</span><span class="ident" id="3651520">file</span><span class="op" id="3651524">)</span>&nbsp;<span class="op" id="3651526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3651531">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3651539">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3651542">}</span><br>
<span class="lineno">400</span><span class="op" id="3651544">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3651547">func</span>&nbsp;<span class="ident" id="3651552">searchFiles</span><span class="op" id="3651563">(</span><span class="ident" id="3651564">a</span>&nbsp;<span class="op" id="3651566">[</span><span class="op" id="3651567">]</span><span class="op" id="3651568">*</span><span class="ident" id="3651569">File</span><span class="op" id="3651573">,</span>&nbsp;<span class="ident" id="3651575">x</span>&nbsp;<span class="builtintype" id="3651577">int</span><span class="op" id="3651580">)</span>&nbsp;<span class="builtintype" id="3651582">int</span>&nbsp;<span class="op" id="3651586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3651589">return</span>&nbsp;<span class="ident" id="3651596">sort</span><span class="op" id="3651600">.</span><span class="ident" id="3651601">Search</span><span class="op" id="3651607">(</span><span class="builtinfunc" id="3651608">len</span><span class="op" id="3651611">(</span><span class="ident" id="3651612">a</span><span class="op" id="3651613">)</span><span class="op" id="3651614">,</span>&nbsp;<span class="keyword" id="3651616">func</span><span class="op" id="3651620">(</span><span class="ident" id="3651621">i</span>&nbsp;<span class="builtintype" id="3651623">int</span><span class="op" id="3651626">)</span>&nbsp;<span class="builtintype" id="3651628">bool</span>&nbsp;<span class="op" id="3651633">{</span>&nbsp;<span class="keyword" id="3651635">return</span>&nbsp;<span class="ident" id="3651642">a</span><span class="op" id="3651643">[</span><span class="ident" id="3651644">i</span><span class="op" id="3651645">]</span><span class="op" id="3651646">.</span><span class="ident" id="3651647">base</span>&nbsp;<span class="op" id="3651652">&gt;</span>&nbsp;<span class="ident" id="3651654">x</span>&nbsp;<span class="op" id="3651656">}</span><span class="op" id="3651657">)</span>&nbsp;<span class="op" id="3651659">-</span>&nbsp;<span class="num" id="3651661">1</span><br>
<span class="lineno"></span><span class="op" id="3651663">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="keyword" id="3651666">func</span>&nbsp;<span class="op" id="3651671">(</span><span class="ident" id="3651672">s</span>&nbsp;<span class="op" id="3651674">*</span><span class="ident" id="3651675">FileSet</span><span class="op" id="3651682">)</span>&nbsp;<span class="ident" id="3651684">file</span><span class="op" id="3651688">(</span><span class="ident" id="3651689">p</span>&nbsp;<span class="ident" id="3651691">Pos</span><span class="op" id="3651694">)</span>&nbsp;<span class="op" id="3651696">*</span><span class="ident" id="3651697">File</span>&nbsp;<span class="op" id="3651702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3651705">s</span><span class="op" id="3651706">.</span><span class="ident" id="3651707">mutex</span><span class="op" id="3651712">.</span><span class="ident" id="3651713">RLock</span><span class="op" id="3651718">(</span><span class="op" id="3651719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3651722">//&nbsp;common&nbsp;case:&nbsp;p&nbsp;is&nbsp;in&nbsp;last&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3651757">if</span>&nbsp;<span class="ident" id="3651760">f</span>&nbsp;<span class="op" id="3651762">:=</span>&nbsp;<span class="ident" id="3651765">s</span><span class="op" id="3651766">.</span><span class="ident" id="3651767">last</span><span class="op" id="3651771">;</span>&nbsp;<span class="ident" id="3651773">f</span>&nbsp;<span class="op" id="3651775">!=</span>&nbsp;<span class="ident" id="3651778">nil</span>&nbsp;<span class="op" id="3651782">&amp;&amp;</span>&nbsp;<span class="ident" id="3651785">f</span><span class="op" id="3651786">.</span><span class="ident" id="3651787">base</span>&nbsp;<span class="op" id="3651792">&lt;=</span>&nbsp;<span class="builtintype" id="3651795">int</span><span class="op" id="3651798">(</span><span class="ident" id="3651799">p</span><span class="op" id="3651800">)</span>&nbsp;<span class="op" id="3651802">&amp;&amp;</span>&nbsp;<span class="builtintype" id="3651805">int</span><span class="op" id="3651808">(</span><span class="ident" id="3651809">p</span><span class="op" id="3651810">)</span>&nbsp;<span class="op" id="3651812">&lt;=</span>&nbsp;<span class="ident" id="3651815">f</span><span class="op" id="3651816">.</span><span class="ident" id="3651817">base</span><span class="op" id="3651821">+</span><span class="ident" id="3651822">f</span><span class="op" id="3651823">.</span><span class="ident" id="3651824">size</span>&nbsp;<span class="op" id="3651829">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3651833">s</span><span class="op" id="3651834">.</span><span class="ident" id="3651835">mutex</span><span class="op" id="3651840">.</span><span class="ident" id="3651841">RUnlock</span><span class="op" id="3651848">(</span><span class="op" id="3651849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3651853">return</span>&nbsp;<span class="ident" id="3651860">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3651863">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3651866">//&nbsp;p&nbsp;is&nbsp;not&nbsp;in&nbsp;last&nbsp;file&nbsp;-&nbsp;search&nbsp;all&nbsp;files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3651911">if</span>&nbsp;<span class="ident" id="3651914">i</span>&nbsp;<span class="op" id="3651916">:=</span>&nbsp;<span class="ident" id="3651919">searchFiles</span><span class="op" id="3651930">(</span><span class="ident" id="3651931">s</span><span class="op" id="3651932">.</span><span class="ident" id="3651933">files</span><span class="op" id="3651938">,</span>&nbsp;<span class="builtintype" id="3651940">int</span><span class="op" id="3651943">(</span><span class="ident" id="3651944">p</span><span class="op" id="3651945">)</span><span class="op" id="3651946">)</span><span class="op" id="3651947">;</span>&nbsp;<span class="ident" id="3651949">i</span>&nbsp;<span class="op" id="3651951">&gt;=</span>&nbsp;<span class="num" id="3651954">0</span>&nbsp;<span class="op" id="3651956">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3651960">f</span>&nbsp;<span class="op" id="3651962">:=</span>&nbsp;<span class="ident" id="3651965">s</span><span class="op" id="3651966">.</span><span class="ident" id="3651967">files</span><span class="op" id="3651972">[</span><span class="ident" id="3651973">i</span><span class="op" id="3651974">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3651978">//&nbsp;f.base&nbsp;&lt;=&nbsp;int(p)&nbsp;by&nbsp;definition&nbsp;of&nbsp;searchFiles</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3652029">if</span>&nbsp;<span class="builtintype" id="3652032">int</span><span class="op" id="3652035">(</span><span class="ident" id="3652036">p</span><span class="op" id="3652037">)</span>&nbsp;<span class="op" id="3652039">&lt;=</span>&nbsp;<span class="ident" id="3652042">f</span><span class="op" id="3652043">.</span><span class="ident" id="3652044">base</span><span class="op" id="3652048">+</span><span class="ident" id="3652049">f</span><span class="op" id="3652050">.</span><span class="ident" id="3652051">size</span>&nbsp;<span class="op" id="3652056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3652061">s</span><span class="op" id="3652062">.</span><span class="ident" id="3652063">mutex</span><span class="op" id="3652068">.</span><span class="ident" id="3652069">RUnlock</span><span class="op" id="3652076">(</span><span class="op" id="3652077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3652082">s</span><span class="op" id="3652083">.</span><span class="ident" id="3652084">mutex</span><span class="op" id="3652089">.</span><span class="ident" id="3652090">Lock</span><span class="op" id="3652094">(</span><span class="op" id="3652095">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3652100">s</span><span class="op" id="3652101">.</span><span class="ident" id="3652102">last</span>&nbsp;<span class="op" id="3652107">=</span>&nbsp;<span class="ident" id="3652109">f</span>&nbsp;<span class="comment" id="3652111">//&nbsp;race&nbsp;is&nbsp;ok&nbsp;-&nbsp;s.last&nbsp;is&nbsp;only&nbsp;a&nbsp;cache</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3652153">s</span><span class="op" id="3652154">.</span><span class="ident" id="3652155">mutex</span><span class="op" id="3652160">.</span><span class="ident" id="3652161">Unlock</span><span class="op" id="3652167">(</span><span class="op" id="3652168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3652173">return</span>&nbsp;<span class="ident" id="3652180">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3652184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3652187">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3652190">s</span><span class="op" id="3652191">.</span><span class="ident" id="3652192">mutex</span><span class="op" id="3652197">.</span><span class="ident" id="3652198">RUnlock</span><span class="op" id="3652205">(</span><span class="op" id="3652206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3652209">return</span>&nbsp;<span class="ident" id="3652216">nil</span><br>
<span class="lineno"></span><span class="op" id="3652220">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3652223">//&nbsp;File&nbsp;returns&nbsp;the&nbsp;file&nbsp;that&nbsp;contains&nbsp;the&nbsp;position&nbsp;p.</span><br>
<span class="lineno">430</span><span class="comment" id="3652278">//&nbsp;If&nbsp;no&nbsp;such&nbsp;file&nbsp;is&nbsp;found&nbsp;(for&nbsp;instance&nbsp;for&nbsp;p&nbsp;==&nbsp;NoPos),</span><br>
<span class="lineno"></span><span class="comment" id="3652337">//&nbsp;the&nbsp;result&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="comment" id="3652359">//</span><br>
<span class="lineno"></span><span class="keyword" id="3652362">func</span>&nbsp;<span class="op" id="3652367">(</span><span class="ident" id="3652368">s</span>&nbsp;<span class="op" id="3652370">*</span><span class="ident" id="3652371">FileSet</span><span class="op" id="3652378">)</span>&nbsp;<span class="ident" id="3652380">File</span><span class="op" id="3652384">(</span><span class="ident" id="3652385">p</span>&nbsp;<span class="ident" id="3652387">Pos</span><span class="op" id="3652390">)</span>&nbsp;<span class="op" id="3652392">(</span><span class="ident" id="3652393">f</span>&nbsp;<span class="op" id="3652395">*</span><span class="ident" id="3652396">File</span><span class="op" id="3652400">)</span>&nbsp;<span class="op" id="3652402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3652405">if</span>&nbsp;<span class="ident" id="3652408">p</span>&nbsp;<span class="op" id="3652410">!=</span>&nbsp;<span class="ident" id="3652413">NoPos</span>&nbsp;<span class="op" id="3652419">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3652423">f</span>&nbsp;<span class="op" id="3652425">=</span>&nbsp;<span class="ident" id="3652427">s</span><span class="op" id="3652428">.</span><span class="ident" id="3652429">file</span><span class="op" id="3652433">(</span><span class="ident" id="3652434">p</span><span class="op" id="3652435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3652438">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3652441">return</span><br>
<span class="lineno"></span><span class="op" id="3652448">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">440</span><span class="comment" id="3652451">//&nbsp;PositionFor&nbsp;converts&nbsp;a&nbsp;Pos&nbsp;p&nbsp;in&nbsp;the&nbsp;fileset&nbsp;into&nbsp;a&nbsp;Position&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="3652521">//&nbsp;If&nbsp;adjusted&nbsp;is&nbsp;set,&nbsp;the&nbsp;position&nbsp;may&nbsp;be&nbsp;adjusted&nbsp;by&nbsp;position-altering</span><br>
<span class="lineno"></span><span class="comment" id="3652594">//&nbsp;//line&nbsp;comments;&nbsp;otherwise&nbsp;those&nbsp;comments&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="3652652">//&nbsp;p&nbsp;must&nbsp;be&nbsp;a&nbsp;Pos&nbsp;value&nbsp;in&nbsp;s&nbsp;or&nbsp;NoPos.</span><br>
<span class="lineno"></span><span class="comment" id="3652692">//</span><br>
<span class="lineno">445</span><span class="keyword" id="3652695">func</span>&nbsp;<span class="op" id="3652700">(</span><span class="ident" id="3652701">s</span>&nbsp;<span class="op" id="3652703">*</span><span class="ident" id="3652704">FileSet</span><span class="op" id="3652711">)</span>&nbsp;<span class="ident" id="3652713">PositionFor</span><span class="op" id="3652724">(</span><span class="ident" id="3652725">p</span>&nbsp;<span class="ident" id="3652727">Pos</span><span class="op" id="3652730">,</span>&nbsp;<span class="ident" id="3652732">adjusted</span>&nbsp;<span class="builtintype" id="3652741">bool</span><span class="op" id="3652745">)</span>&nbsp;<span class="op" id="3652747">(</span><span class="ident" id="3652748">pos</span>&nbsp;<span class="ident" id="3652752">Position</span><span class="op" id="3652760">)</span>&nbsp;<span class="op" id="3652762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3652765">if</span>&nbsp;<span class="ident" id="3652768">p</span>&nbsp;<span class="op" id="3652770">!=</span>&nbsp;<span class="ident" id="3652773">NoPos</span>&nbsp;<span class="op" id="3652779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3652783">if</span>&nbsp;<span class="ident" id="3652786">f</span>&nbsp;<span class="op" id="3652788">:=</span>&nbsp;<span class="ident" id="3652791">s</span><span class="op" id="3652792">.</span><span class="ident" id="3652793">file</span><span class="op" id="3652797">(</span><span class="ident" id="3652798">p</span><span class="op" id="3652799">)</span><span class="op" id="3652800">;</span>&nbsp;<span class="ident" id="3652802">f</span>&nbsp;<span class="op" id="3652804">!=</span>&nbsp;<span class="ident" id="3652807">nil</span>&nbsp;<span class="op" id="3652811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3652816">pos</span>&nbsp;<span class="op" id="3652820">=</span>&nbsp;<span class="ident" id="3652822">f</span><span class="op" id="3652823">.</span><span class="ident" id="3652824">position</span><span class="op" id="3652832">(</span><span class="ident" id="3652833">p</span><span class="op" id="3652834">,</span>&nbsp;<span class="ident" id="3652836">adjusted</span><span class="op" id="3652844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3652848">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3652851">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3652854">return</span><br>
<span class="lineno"></span><span class="op" id="3652861">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3652864">//&nbsp;Position&nbsp;converts&nbsp;a&nbsp;Pos&nbsp;p&nbsp;in&nbsp;the&nbsp;fileset&nbsp;into&nbsp;a&nbsp;Position&nbsp;value.</span><br>
<span class="lineno">455</span><span class="comment" id="3652931">//&nbsp;Calling&nbsp;s.Position(p)&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;calling&nbsp;s.PositionFor(p,&nbsp;true).</span><br>
<span class="lineno"></span><span class="comment" id="3653005">//</span><br>
<span class="lineno"></span><span class="keyword" id="3653008">func</span>&nbsp;<span class="op" id="3653013">(</span><span class="ident" id="3653014">s</span>&nbsp;<span class="op" id="3653016">*</span><span class="ident" id="3653017">FileSet</span><span class="op" id="3653024">)</span>&nbsp;<span class="ident" id="3653026">Position</span><span class="op" id="3653034">(</span><span class="ident" id="3653035">p</span>&nbsp;<span class="ident" id="3653037">Pos</span><span class="op" id="3653040">)</span>&nbsp;<span class="op" id="3653042">(</span><span class="ident" id="3653043">pos</span>&nbsp;<span class="ident" id="3653047">Position</span><span class="op" id="3653055">)</span>&nbsp;<span class="op" id="3653057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3653060">return</span>&nbsp;<span class="ident" id="3653067">s</span><span class="op" id="3653068">.</span><span class="ident" id="3653069">PositionFor</span><span class="op" id="3653080">(</span><span class="ident" id="3653081">p</span><span class="op" id="3653082">,</span>&nbsp;<span class="builtintype" id="3653084">true</span><span class="op" id="3653088">)</span><br>
<span class="lineno"></span><span class="op" id="3653090">}</span><br>
<span class="lineno">460</span><br>
<span class="lineno"></span><span class="comment" id="3653093">//&nbsp;-----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="3653174">//&nbsp;Helper&nbsp;functions</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3653195">func</span>&nbsp;<span class="ident" id="3653200">searchInts</span><span class="op" id="3653210">(</span><span class="ident" id="3653211">a</span>&nbsp;<span class="op" id="3653213">[</span><span class="op" id="3653214">]</span><span class="builtintype" id="3653215">int</span><span class="op" id="3653218">,</span>&nbsp;<span class="ident" id="3653220">x</span>&nbsp;<span class="builtintype" id="3653222">int</span><span class="op" id="3653225">)</span>&nbsp;<span class="builtintype" id="3653227">int</span>&nbsp;<span class="op" id="3653231">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3653234">//&nbsp;This&nbsp;function&nbsp;body&nbsp;is&nbsp;a&nbsp;manually&nbsp;inlined&nbsp;version&nbsp;of:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3653291">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3653295">//&nbsp;&nbsp;&nbsp;return&nbsp;sort.Search(len(a),&nbsp;func(i&nbsp;int)&nbsp;bool&nbsp;{&nbsp;return&nbsp;a[i]&nbsp;&gt;&nbsp;x&nbsp;})&nbsp;-&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3653370">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3653374">//&nbsp;With&nbsp;better&nbsp;compiler&nbsp;optimizations,&nbsp;this&nbsp;may&nbsp;not&nbsp;be&nbsp;needed&nbsp;in&nbsp;the</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3653444">//&nbsp;future,&nbsp;but&nbsp;at&nbsp;the&nbsp;moment&nbsp;this&nbsp;change&nbsp;improves&nbsp;the&nbsp;go/printer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3653510">//&nbsp;benchmark&nbsp;performance&nbsp;by&nbsp;~30%.&nbsp;This&nbsp;has&nbsp;a&nbsp;direct&nbsp;impact&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3653577">//&nbsp;speed&nbsp;of&nbsp;gofmt&nbsp;and&nbsp;thus&nbsp;seems&nbsp;worthwhile&nbsp;(2011-04-29).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3653636">//&nbsp;TODO(gri):&nbsp;Remove&nbsp;this&nbsp;when&nbsp;compilers&nbsp;have&nbsp;caught&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3653694">i</span><span class="op" id="3653695">,</span>&nbsp;<span class="ident" id="3653697">j</span>&nbsp;<span class="op" id="3653699">:=</span>&nbsp;<span class="num" id="3653702">0</span><span class="op" id="3653703">,</span>&nbsp;<span class="builtinfunc" id="3653705">len</span><span class="op" id="3653708">(</span><span class="ident" id="3653709">a</span><span class="op" id="3653710">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3653713">for</span>&nbsp;<span class="ident" id="3653717">i</span>&nbsp;<span class="op" id="3653719">&lt;</span>&nbsp;<span class="ident" id="3653721">j</span>&nbsp;<span class="op" id="3653723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3653727">h</span>&nbsp;<span class="op" id="3653729">:=</span>&nbsp;<span class="ident" id="3653732">i</span>&nbsp;<span class="op" id="3653734">+</span>&nbsp;<span class="op" id="3653736">(</span><span class="ident" id="3653737">j</span><span class="op" id="3653738">-</span><span class="ident" id="3653739">i</span><span class="op" id="3653740">)</span><span class="op" id="3653741">/</span><span class="num" id="3653742">2</span>&nbsp;<span class="comment" id="3653744">//&nbsp;avoid&nbsp;overflow&nbsp;when&nbsp;computing&nbsp;h</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3653781">//&nbsp;i&nbsp;≤&nbsp;h&nbsp;&lt;&nbsp;j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3653798">if</span>&nbsp;<span class="ident" id="3653801">a</span><span class="op" id="3653802">[</span><span class="ident" id="3653803">h</span><span class="op" id="3653804">]</span>&nbsp;<span class="op" id="3653806">&lt;=</span>&nbsp;<span class="ident" id="3653809">x</span>&nbsp;<span class="op" id="3653811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3653816">i</span>&nbsp;<span class="op" id="3653818">=</span>&nbsp;<span class="ident" id="3653820">h</span>&nbsp;<span class="op" id="3653822">+</span>&nbsp;<span class="num" id="3653824">1</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3653828">}</span>&nbsp;<span class="keyword" id="3653830">else</span>&nbsp;<span class="op" id="3653835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3653840">j</span>&nbsp;<span class="op" id="3653842">=</span>&nbsp;<span class="ident" id="3653844">h</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3653848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3653851">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3653854">return</span>&nbsp;<span class="ident" id="3653861">i</span>&nbsp;<span class="op" id="3653863">-</span>&nbsp;<span class="num" id="3653865">1</span><br>
<span class="lineno">485</span><span class="op" id="3653867">}</span>
</div>
</body>
</html>
