<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8416231">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8416287">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8416341">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8416392">package</span>&nbsp;<span class="ident" id="8416400">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8416405">import</span>&nbsp;<span class="op" id="8416412">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8416415">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8416424">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8416431">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8416437">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8416448">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8416459">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8416470">&#34;time&#34;</span><br>
<span class="lineno">15</span><span class="op" id="8416477">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8416480">type</span>&nbsp;<span class="ident" id="8416485">resolveIPAddrTest</span>&nbsp;<span class="keyword" id="8416503">struct</span>&nbsp;<span class="op" id="8416510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8416513">net</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8416527">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8416535">litAddrOrName</span>&nbsp;<span class="builtintype" id="8416549">string</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8416557">addr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8416571">*</span><span class="ident" id="8416572">IPAddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8416580">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8416594">error</span><br>
<span class="lineno"></span><span class="op" id="8416600">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8416603">var</span>&nbsp;<span class="ident" id="8416607">resolveIPAddrTests</span>&nbsp;<span class="op" id="8416626">=</span>&nbsp;<span class="op" id="8416628">[</span><span class="op" id="8416629">]</span><span class="ident" id="8416630">resolveIPAddrTest</span><span class="op" id="8416647">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8416650">{</span><span class="string" id="8416651">&#34;ip&#34;</span><span class="op" id="8416655">,</span>&nbsp;<span class="string" id="8416657">&#34;127.0.0.1&#34;</span><span class="op" id="8416668">,</span>&nbsp;<span class="op" id="8416670">&amp;</span><span class="ident" id="8416671">IPAddr</span><span class="op" id="8416677">{</span><span class="ident" id="8416678">IP</span><span class="op" id="8416680">:</span>&nbsp;<span class="ident" id="8416682">IPv4</span><span class="op" id="8416686">(</span><span class="num" id="8416687">127</span><span class="op" id="8416690">,</span>&nbsp;<span class="num" id="8416692">0</span><span class="op" id="8416693">,</span>&nbsp;<span class="num" id="8416695">0</span><span class="op" id="8416696">,</span>&nbsp;<span class="num" id="8416698">1</span><span class="op" id="8416699">)</span><span class="op" id="8416700">}</span><span class="op" id="8416701">,</span>&nbsp;<span class="ident" id="8416703">nil</span><span class="op" id="8416706">}</span><span class="op" id="8416707">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8416710">{</span><span class="string" id="8416711">&#34;ip4&#34;</span><span class="op" id="8416716">,</span>&nbsp;<span class="string" id="8416718">&#34;127.0.0.1&#34;</span><span class="op" id="8416729">,</span>&nbsp;<span class="op" id="8416731">&amp;</span><span class="ident" id="8416732">IPAddr</span><span class="op" id="8416738">{</span><span class="ident" id="8416739">IP</span><span class="op" id="8416741">:</span>&nbsp;<span class="ident" id="8416743">IPv4</span><span class="op" id="8416747">(</span><span class="num" id="8416748">127</span><span class="op" id="8416751">,</span>&nbsp;<span class="num" id="8416753">0</span><span class="op" id="8416754">,</span>&nbsp;<span class="num" id="8416756">0</span><span class="op" id="8416757">,</span>&nbsp;<span class="num" id="8416759">1</span><span class="op" id="8416760">)</span><span class="op" id="8416761">}</span><span class="op" id="8416762">,</span>&nbsp;<span class="ident" id="8416764">nil</span><span class="op" id="8416767">}</span><span class="op" id="8416768">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8416771">{</span><span class="string" id="8416772">&#34;ip4:icmp&#34;</span><span class="op" id="8416782">,</span>&nbsp;<span class="string" id="8416784">&#34;127.0.0.1&#34;</span><span class="op" id="8416795">,</span>&nbsp;<span class="op" id="8416797">&amp;</span><span class="ident" id="8416798">IPAddr</span><span class="op" id="8416804">{</span><span class="ident" id="8416805">IP</span><span class="op" id="8416807">:</span>&nbsp;<span class="ident" id="8416809">IPv4</span><span class="op" id="8416813">(</span><span class="num" id="8416814">127</span><span class="op" id="8416817">,</span>&nbsp;<span class="num" id="8416819">0</span><span class="op" id="8416820">,</span>&nbsp;<span class="num" id="8416822">0</span><span class="op" id="8416823">,</span>&nbsp;<span class="num" id="8416825">1</span><span class="op" id="8416826">)</span><span class="op" id="8416827">}</span><span class="op" id="8416828">,</span>&nbsp;<span class="ident" id="8416830">nil</span><span class="op" id="8416833">}</span><span class="op" id="8416834">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8416838">{</span><span class="string" id="8416839">&#34;ip&#34;</span><span class="op" id="8416843">,</span>&nbsp;<span class="string" id="8416845">&#34;::1&#34;</span><span class="op" id="8416850">,</span>&nbsp;<span class="op" id="8416852">&amp;</span><span class="ident" id="8416853">IPAddr</span><span class="op" id="8416859">{</span><span class="ident" id="8416860">IP</span><span class="op" id="8416862">:</span>&nbsp;<span class="ident" id="8416864">ParseIP</span><span class="op" id="8416871">(</span><span class="string" id="8416872">&#34;::1&#34;</span><span class="op" id="8416877">)</span><span class="op" id="8416878">}</span><span class="op" id="8416879">,</span>&nbsp;<span class="ident" id="8416881">nil</span><span class="op" id="8416884">}</span><span class="op" id="8416885">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8416888">{</span><span class="string" id="8416889">&#34;ip6&#34;</span><span class="op" id="8416894">,</span>&nbsp;<span class="string" id="8416896">&#34;::1&#34;</span><span class="op" id="8416901">,</span>&nbsp;<span class="op" id="8416903">&amp;</span><span class="ident" id="8416904">IPAddr</span><span class="op" id="8416910">{</span><span class="ident" id="8416911">IP</span><span class="op" id="8416913">:</span>&nbsp;<span class="ident" id="8416915">ParseIP</span><span class="op" id="8416922">(</span><span class="string" id="8416923">&#34;::1&#34;</span><span class="op" id="8416928">)</span><span class="op" id="8416929">}</span><span class="op" id="8416930">,</span>&nbsp;<span class="ident" id="8416932">nil</span><span class="op" id="8416935">}</span><span class="op" id="8416936">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8416939">{</span><span class="string" id="8416940">&#34;ip6:ipv6-icmp&#34;</span><span class="op" id="8416955">,</span>&nbsp;<span class="string" id="8416957">&#34;::1&#34;</span><span class="op" id="8416962">,</span>&nbsp;<span class="op" id="8416964">&amp;</span><span class="ident" id="8416965">IPAddr</span><span class="op" id="8416971">{</span><span class="ident" id="8416972">IP</span><span class="op" id="8416974">:</span>&nbsp;<span class="ident" id="8416976">ParseIP</span><span class="op" id="8416983">(</span><span class="string" id="8416984">&#34;::1&#34;</span><span class="op" id="8416989">)</span><span class="op" id="8416990">}</span><span class="op" id="8416991">,</span>&nbsp;<span class="ident" id="8416993">nil</span><span class="op" id="8416996">}</span><span class="op" id="8416997">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8417000">{</span><span class="string" id="8417001">&#34;ip6:IPv6-ICMP&#34;</span><span class="op" id="8417016">,</span>&nbsp;<span class="string" id="8417018">&#34;::1&#34;</span><span class="op" id="8417023">,</span>&nbsp;<span class="op" id="8417025">&amp;</span><span class="ident" id="8417026">IPAddr</span><span class="op" id="8417032">{</span><span class="ident" id="8417033">IP</span><span class="op" id="8417035">:</span>&nbsp;<span class="ident" id="8417037">ParseIP</span><span class="op" id="8417044">(</span><span class="string" id="8417045">&#34;::1&#34;</span><span class="op" id="8417050">)</span><span class="op" id="8417051">}</span><span class="op" id="8417052">,</span>&nbsp;<span class="ident" id="8417054">nil</span><span class="op" id="8417057">}</span><span class="op" id="8417058">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8417062">{</span><span class="string" id="8417063">&#34;ip&#34;</span><span class="op" id="8417067">,</span>&nbsp;<span class="string" id="8417069">&#34;::1%en0&#34;</span><span class="op" id="8417078">,</span>&nbsp;<span class="op" id="8417080">&amp;</span><span class="ident" id="8417081">IPAddr</span><span class="op" id="8417087">{</span><span class="ident" id="8417088">IP</span><span class="op" id="8417090">:</span>&nbsp;<span class="ident" id="8417092">ParseIP</span><span class="op" id="8417099">(</span><span class="string" id="8417100">&#34;::1&#34;</span><span class="op" id="8417105">)</span><span class="op" id="8417106">,</span>&nbsp;<span class="ident" id="8417108">Zone</span><span class="op" id="8417112">:</span>&nbsp;<span class="string" id="8417114">&#34;en0&#34;</span><span class="op" id="8417119">}</span><span class="op" id="8417120">,</span>&nbsp;<span class="ident" id="8417122">nil</span><span class="op" id="8417125">}</span><span class="op" id="8417126">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8417129">{</span><span class="string" id="8417130">&#34;ip6&#34;</span><span class="op" id="8417135">,</span>&nbsp;<span class="string" id="8417137">&#34;::1%911&#34;</span><span class="op" id="8417146">,</span>&nbsp;<span class="op" id="8417148">&amp;</span><span class="ident" id="8417149">IPAddr</span><span class="op" id="8417155">{</span><span class="ident" id="8417156">IP</span><span class="op" id="8417158">:</span>&nbsp;<span class="ident" id="8417160">ParseIP</span><span class="op" id="8417167">(</span><span class="string" id="8417168">&#34;::1&#34;</span><span class="op" id="8417173">)</span><span class="op" id="8417174">,</span>&nbsp;<span class="ident" id="8417176">Zone</span><span class="op" id="8417180">:</span>&nbsp;<span class="string" id="8417182">&#34;911&#34;</span><span class="op" id="8417187">}</span><span class="op" id="8417188">,</span>&nbsp;<span class="ident" id="8417190">nil</span><span class="op" id="8417193">}</span><span class="op" id="8417194">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8417198">{</span><span class="string" id="8417199">&#34;&#34;</span><span class="op" id="8417201">,</span>&nbsp;<span class="string" id="8417203">&#34;127.0.0.1&#34;</span><span class="op" id="8417214">,</span>&nbsp;<span class="op" id="8417216">&amp;</span><span class="ident" id="8417217">IPAddr</span><span class="op" id="8417223">{</span><span class="ident" id="8417224">IP</span><span class="op" id="8417226">:</span>&nbsp;<span class="ident" id="8417228">IPv4</span><span class="op" id="8417232">(</span><span class="num" id="8417233">127</span><span class="op" id="8417236">,</span>&nbsp;<span class="num" id="8417238">0</span><span class="op" id="8417239">,</span>&nbsp;<span class="num" id="8417241">0</span><span class="op" id="8417242">,</span>&nbsp;<span class="num" id="8417244">1</span><span class="op" id="8417245">)</span><span class="op" id="8417246">}</span><span class="op" id="8417247">,</span>&nbsp;<span class="ident" id="8417249">nil</span><span class="op" id="8417252">}</span><span class="op" id="8417253">,</span>&nbsp;<span class="comment" id="8417255">//&nbsp;Go&nbsp;1.0&nbsp;behavior</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8417275">{</span><span class="string" id="8417276">&#34;&#34;</span><span class="op" id="8417278">,</span>&nbsp;<span class="string" id="8417280">&#34;::1&#34;</span><span class="op" id="8417285">,</span>&nbsp;<span class="op" id="8417287">&amp;</span><span class="ident" id="8417288">IPAddr</span><span class="op" id="8417294">{</span><span class="ident" id="8417295">IP</span><span class="op" id="8417297">:</span>&nbsp;<span class="ident" id="8417299">ParseIP</span><span class="op" id="8417306">(</span><span class="string" id="8417307">&#34;::1&#34;</span><span class="op" id="8417312">)</span><span class="op" id="8417313">}</span><span class="op" id="8417314">,</span>&nbsp;<span class="ident" id="8417316">nil</span><span class="op" id="8417319">}</span><span class="op" id="8417320">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8417332">//&nbsp;Go&nbsp;1.0&nbsp;behavior</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8417353">{</span><span class="string" id="8417354">&#34;l2tp&#34;</span><span class="op" id="8417360">,</span>&nbsp;<span class="string" id="8417362">&#34;127.0.0.1&#34;</span><span class="op" id="8417373">,</span>&nbsp;<span class="ident" id="8417375">nil</span><span class="op" id="8417378">,</span>&nbsp;<span class="ident" id="8417380">UnknownNetworkError</span><span class="op" id="8417399">(</span><span class="string" id="8417400">&#34;l2tp&#34;</span><span class="op" id="8417406">)</span><span class="op" id="8417407">}</span><span class="op" id="8417408">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8417411">{</span><span class="string" id="8417412">&#34;l2tp:gre&#34;</span><span class="op" id="8417422">,</span>&nbsp;<span class="string" id="8417424">&#34;127.0.0.1&#34;</span><span class="op" id="8417435">,</span>&nbsp;<span class="ident" id="8417437">nil</span><span class="op" id="8417440">,</span>&nbsp;<span class="ident" id="8417442">UnknownNetworkError</span><span class="op" id="8417461">(</span><span class="string" id="8417462">&#34;l2tp:gre&#34;</span><span class="op" id="8417472">)</span><span class="op" id="8417473">}</span><span class="op" id="8417474">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8417477">{</span><span class="string" id="8417478">&#34;tcp&#34;</span><span class="op" id="8417483">,</span>&nbsp;<span class="string" id="8417485">&#34;1.2.3.4:123&#34;</span><span class="op" id="8417498">,</span>&nbsp;<span class="ident" id="8417500">nil</span><span class="op" id="8417503">,</span>&nbsp;<span class="ident" id="8417505">UnknownNetworkError</span><span class="op" id="8417524">(</span><span class="string" id="8417525">&#34;tcp&#34;</span><span class="op" id="8417530">)</span><span class="op" id="8417531">}</span><span class="op" id="8417532">,</span><br>
<span class="lineno"></span><span class="op" id="8417534">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="8417537">func</span>&nbsp;<span class="ident" id="8417542">init</span><span class="op" id="8417546">(</span><span class="op" id="8417547">)</span>&nbsp;<span class="op" id="8417549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8417552">if</span>&nbsp;<span class="ident" id="8417555">ifi</span>&nbsp;<span class="op" id="8417559">:=</span>&nbsp;<span class="ident" id="8417562">loopbackInterface</span><span class="op" id="8417579">(</span><span class="op" id="8417580">)</span><span class="op" id="8417581">;</span>&nbsp;<span class="ident" id="8417583">ifi</span>&nbsp;<span class="op" id="8417587">!=</span>&nbsp;<span class="ident" id="8417590">nil</span>&nbsp;<span class="op" id="8417594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8417598">index</span>&nbsp;<span class="op" id="8417604">:=</span>&nbsp;<span class="ident" id="8417607">fmt</span><span class="op" id="8417610">.</span><span class="ident" id="8417611">Sprintf</span><span class="op" id="8417618">(</span><span class="string" id="8417619">&#34;%v&#34;</span><span class="op" id="8417623">,</span>&nbsp;<span class="ident" id="8417625">ifi</span><span class="op" id="8417628">.</span><span class="ident" id="8417629">Index</span><span class="op" id="8417634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8417638">resolveIPAddrTests</span>&nbsp;<span class="op" id="8417657">=</span>&nbsp;<span class="builtinfunc" id="8417659">append</span><span class="op" id="8417665">(</span><span class="ident" id="8417666">resolveIPAddrTests</span><span class="op" id="8417684">,</span>&nbsp;<span class="op" id="8417686">[</span><span class="op" id="8417687">]</span><span class="ident" id="8417688">resolveIPAddrTest</span><span class="op" id="8417705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8417710">{</span><span class="string" id="8417711">&#34;ip6&#34;</span><span class="op" id="8417716">,</span>&nbsp;<span class="string" id="8417718">&#34;fe80::1%&#34;</span>&nbsp;<span class="op" id="8417729">+</span>&nbsp;<span class="ident" id="8417731">ifi</span><span class="op" id="8417734">.</span><span class="ident" id="8417735">Name</span><span class="op" id="8417739">,</span>&nbsp;<span class="op" id="8417741">&amp;</span><span class="ident" id="8417742">IPAddr</span><span class="op" id="8417748">{</span><span class="ident" id="8417749">IP</span><span class="op" id="8417751">:</span>&nbsp;<span class="ident" id="8417753">ParseIP</span><span class="op" id="8417760">(</span><span class="string" id="8417761">&#34;fe80::1&#34;</span><span class="op" id="8417770">)</span><span class="op" id="8417771">,</span>&nbsp;<span class="ident" id="8417773">Zone</span><span class="op" id="8417777">:</span>&nbsp;<span class="ident" id="8417779">zoneToString</span><span class="op" id="8417791">(</span><span class="ident" id="8417792">ifi</span><span class="op" id="8417795">.</span><span class="ident" id="8417796">Index</span><span class="op" id="8417801">)</span><span class="op" id="8417802">}</span><span class="op" id="8417803">,</span>&nbsp;<span class="ident" id="8417805">nil</span><span class="op" id="8417808">}</span><span class="op" id="8417809">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8417814">{</span><span class="string" id="8417815">&#34;ip6&#34;</span><span class="op" id="8417820">,</span>&nbsp;<span class="string" id="8417822">&#34;fe80::1%&#34;</span>&nbsp;<span class="op" id="8417833">+</span>&nbsp;<span class="ident" id="8417835">index</span><span class="op" id="8417840">,</span>&nbsp;<span class="op" id="8417842">&amp;</span><span class="ident" id="8417843">IPAddr</span><span class="op" id="8417849">{</span><span class="ident" id="8417850">IP</span><span class="op" id="8417852">:</span>&nbsp;<span class="ident" id="8417854">ParseIP</span><span class="op" id="8417861">(</span><span class="string" id="8417862">&#34;fe80::1&#34;</span><span class="op" id="8417871">)</span><span class="op" id="8417872">,</span>&nbsp;<span class="ident" id="8417874">Zone</span><span class="op" id="8417878">:</span>&nbsp;<span class="ident" id="8417880">index</span><span class="op" id="8417885">}</span><span class="op" id="8417886">,</span>&nbsp;<span class="ident" id="8417888">nil</span><span class="op" id="8417891">}</span><span class="op" id="8417892">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8417896">}</span><span class="op" id="8417897">...</span><span class="op" id="8417900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8417903">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8417906">if</span>&nbsp;<span class="ident" id="8417909">ips</span><span class="op" id="8417912">,</span>&nbsp;<span class="ident" id="8417914">err</span>&nbsp;<span class="op" id="8417918">:=</span>&nbsp;<span class="ident" id="8417921">LookupIP</span><span class="op" id="8417929">(</span><span class="string" id="8417930">&#34;localhost&#34;</span><span class="op" id="8417941">)</span><span class="op" id="8417942">;</span>&nbsp;<span class="ident" id="8417944">err</span>&nbsp;<span class="op" id="8417948">==</span>&nbsp;<span class="ident" id="8417951">nil</span>&nbsp;<span class="op" id="8417955">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="8417958">len</span><span class="op" id="8417961">(</span><span class="ident" id="8417962">ips</span><span class="op" id="8417965">)</span>&nbsp;<span class="op" id="8417967">&gt;</span>&nbsp;<span class="num" id="8417969">1</span>&nbsp;<span class="op" id="8417971">&amp;&amp;</span>&nbsp;<span class="ident" id="8417974">supportsIPv4</span>&nbsp;<span class="op" id="8417987">&amp;&amp;</span>&nbsp;<span class="ident" id="8417990">supportsIPv6</span>&nbsp;<span class="op" id="8418003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8418007">resolveIPAddrTests</span>&nbsp;<span class="op" id="8418026">=</span>&nbsp;<span class="builtinfunc" id="8418028">append</span><span class="op" id="8418034">(</span><span class="ident" id="8418035">resolveIPAddrTests</span><span class="op" id="8418053">,</span>&nbsp;<span class="op" id="8418055">[</span><span class="op" id="8418056">]</span><span class="ident" id="8418057">resolveIPAddrTest</span><span class="op" id="8418074">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8418079">{</span><span class="string" id="8418080">&#34;ip&#34;</span><span class="op" id="8418084">,</span>&nbsp;<span class="string" id="8418086">&#34;localhost&#34;</span><span class="op" id="8418097">,</span>&nbsp;<span class="op" id="8418099">&amp;</span><span class="ident" id="8418100">IPAddr</span><span class="op" id="8418106">{</span><span class="ident" id="8418107">IP</span><span class="op" id="8418109">:</span>&nbsp;<span class="ident" id="8418111">IPv4</span><span class="op" id="8418115">(</span><span class="num" id="8418116">127</span><span class="op" id="8418119">,</span>&nbsp;<span class="num" id="8418121">0</span><span class="op" id="8418122">,</span>&nbsp;<span class="num" id="8418124">0</span><span class="op" id="8418125">,</span>&nbsp;<span class="num" id="8418127">1</span><span class="op" id="8418128">)</span><span class="op" id="8418129">}</span><span class="op" id="8418130">,</span>&nbsp;<span class="ident" id="8418132">nil</span><span class="op" id="8418135">}</span><span class="op" id="8418136">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8418141">{</span><span class="string" id="8418142">&#34;ip4&#34;</span><span class="op" id="8418147">,</span>&nbsp;<span class="string" id="8418149">&#34;localhost&#34;</span><span class="op" id="8418160">,</span>&nbsp;<span class="op" id="8418162">&amp;</span><span class="ident" id="8418163">IPAddr</span><span class="op" id="8418169">{</span><span class="ident" id="8418170">IP</span><span class="op" id="8418172">:</span>&nbsp;<span class="ident" id="8418174">IPv4</span><span class="op" id="8418178">(</span><span class="num" id="8418179">127</span><span class="op" id="8418182">,</span>&nbsp;<span class="num" id="8418184">0</span><span class="op" id="8418185">,</span>&nbsp;<span class="num" id="8418187">0</span><span class="op" id="8418188">,</span>&nbsp;<span class="num" id="8418190">1</span><span class="op" id="8418191">)</span><span class="op" id="8418192">}</span><span class="op" id="8418193">,</span>&nbsp;<span class="ident" id="8418195">nil</span><span class="op" id="8418198">}</span><span class="op" id="8418199">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8418204">{</span><span class="string" id="8418205">&#34;ip6&#34;</span><span class="op" id="8418210">,</span>&nbsp;<span class="string" id="8418212">&#34;localhost&#34;</span><span class="op" id="8418223">,</span>&nbsp;<span class="op" id="8418225">&amp;</span><span class="ident" id="8418226">IPAddr</span><span class="op" id="8418232">{</span><span class="ident" id="8418233">IP</span><span class="op" id="8418235">:</span>&nbsp;<span class="ident" id="8418237">IPv6loopback</span><span class="op" id="8418249">}</span><span class="op" id="8418250">,</span>&nbsp;<span class="ident" id="8418252">nil</span><span class="op" id="8418255">}</span><span class="op" id="8418256">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8418260">}</span><span class="op" id="8418261">...</span><span class="op" id="8418264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8418267">}</span><br>
<span class="lineno">60</span><span class="op" id="8418269">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8418272">func</span>&nbsp;<span class="ident" id="8418277">skipRawSocketTest</span><span class="op" id="8418294">(</span><span class="ident" id="8418295">t</span>&nbsp;<span class="op" id="8418297">*</span><span class="ident" id="8418298">testing</span><span class="op" id="8418305">.</span><span class="ident" id="8418306">T</span><span class="op" id="8418307">)</span>&nbsp;<span class="op" id="8418309">(</span><span class="ident" id="8418310">skip</span>&nbsp;<span class="builtintype" id="8418315">bool</span><span class="op" id="8418319">,</span>&nbsp;<span class="ident" id="8418321">skipmsg</span>&nbsp;<span class="builtintype" id="8418329">string</span><span class="op" id="8418335">)</span>&nbsp;<span class="op" id="8418337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8418340">skip</span><span class="op" id="8418344">,</span>&nbsp;<span class="ident" id="8418346">skipmsg</span><span class="op" id="8418353">,</span>&nbsp;<span class="ident" id="8418355">err</span>&nbsp;<span class="op" id="8418359">:=</span>&nbsp;<span class="ident" id="8418362">skipRawSocketTests</span><span class="op" id="8418380">(</span><span class="op" id="8418381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8418384">if</span>&nbsp;<span class="ident" id="8418387">err</span>&nbsp;<span class="op" id="8418391">!=</span>&nbsp;<span class="ident" id="8418394">nil</span>&nbsp;<span class="op" id="8418398">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8418402">t</span><span class="op" id="8418403">.</span><span class="ident" id="8418404">Fatal</span><span class="op" id="8418409">(</span><span class="ident" id="8418410">err</span><span class="op" id="8418413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8418416">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8418419">return</span>&nbsp;<span class="ident" id="8418426">skip</span><span class="op" id="8418430">,</span>&nbsp;<span class="ident" id="8418432">skipmsg</span><br>
<span class="lineno"></span><span class="op" id="8418440">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="8418443">func</span>&nbsp;<span class="ident" id="8418448">TestResolveIPAddr</span><span class="op" id="8418465">(</span><span class="ident" id="8418466">t</span>&nbsp;<span class="op" id="8418468">*</span><span class="ident" id="8418469">testing</span><span class="op" id="8418476">.</span><span class="ident" id="8418477">T</span><span class="op" id="8418478">)</span>&nbsp;<span class="op" id="8418480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8418483">switch</span>&nbsp;<span class="ident" id="8418490">runtime</span><span class="op" id="8418497">.</span><span class="ident" id="8418498">GOOS</span>&nbsp;<span class="op" id="8418503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8418506">case</span>&nbsp;<span class="string" id="8418511">&#34;nacl&#34;</span><span class="op" id="8418517">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8418521">t</span><span class="op" id="8418522">.</span><span class="ident" id="8418523">Skipf</span><span class="op" id="8418528">(</span><span class="string" id="8418529">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8418550">,</span>&nbsp;<span class="ident" id="8418552">runtime</span><span class="op" id="8418559">.</span><span class="ident" id="8418560">GOOS</span><span class="op" id="8418564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8418567">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8418571">for</span>&nbsp;<span class="ident" id="8418575">_</span><span class="op" id="8418576">,</span>&nbsp;<span class="ident" id="8418578">tt</span>&nbsp;<span class="op" id="8418581">:=</span>&nbsp;<span class="keyword" id="8418584">range</span>&nbsp;<span class="ident" id="8418590">resolveIPAddrTests</span>&nbsp;<span class="op" id="8418609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8418613">addr</span><span class="op" id="8418617">,</span>&nbsp;<span class="ident" id="8418619">err</span>&nbsp;<span class="op" id="8418623">:=</span>&nbsp;<span class="ident" id="8418626">ResolveIPAddr</span><span class="op" id="8418639">(</span><span class="ident" id="8418640">tt</span><span class="op" id="8418642">.</span><span class="ident" id="8418643">net</span><span class="op" id="8418646">,</span>&nbsp;<span class="ident" id="8418648">tt</span><span class="op" id="8418650">.</span><span class="ident" id="8418651">litAddrOrName</span><span class="op" id="8418664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8418668">if</span>&nbsp;<span class="ident" id="8418671">err</span>&nbsp;<span class="op" id="8418675">!=</span>&nbsp;<span class="ident" id="8418678">tt</span><span class="op" id="8418680">.</span><span class="ident" id="8418681">err</span>&nbsp;<span class="op" id="8418685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8418690">t</span><span class="op" id="8418691">.</span><span class="ident" id="8418692">Fatalf</span><span class="op" id="8418698">(</span><span class="string" id="8418699">&#34;ResolveIPAddr(%v,&nbsp;%v)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8418733">,</span>&nbsp;<span class="ident" id="8418735">tt</span><span class="op" id="8418737">.</span><span class="ident" id="8418738">net</span><span class="op" id="8418741">,</span>&nbsp;<span class="ident" id="8418743">tt</span><span class="op" id="8418745">.</span><span class="ident" id="8418746">litAddrOrName</span><span class="op" id="8418759">,</span>&nbsp;<span class="ident" id="8418761">err</span><span class="op" id="8418764">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8418768">}</span>&nbsp;<span class="keyword" id="8418770">else</span>&nbsp;<span class="keyword" id="8418775">if</span>&nbsp;<span class="op" id="8418778">!</span><span class="ident" id="8418779">reflect</span><span class="op" id="8418786">.</span><span class="ident" id="8418787">DeepEqual</span><span class="op" id="8418796">(</span><span class="ident" id="8418797">addr</span><span class="op" id="8418801">,</span>&nbsp;<span class="ident" id="8418803">tt</span><span class="op" id="8418805">.</span><span class="ident" id="8418806">addr</span><span class="op" id="8418810">)</span>&nbsp;<span class="op" id="8418812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8418817">t</span><span class="op" id="8418818">.</span><span class="ident" id="8418819">Fatalf</span><span class="op" id="8418825">(</span><span class="string" id="8418826">&#34;got&nbsp;%#v;&nbsp;expected&nbsp;%#v&#34;</span><span class="op" id="8418849">,</span>&nbsp;<span class="ident" id="8418851">addr</span><span class="op" id="8418855">,</span>&nbsp;<span class="ident" id="8418857">tt</span><span class="op" id="8418859">.</span><span class="ident" id="8418860">addr</span><span class="op" id="8418864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8418868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8418871">}</span><br>
<span class="lineno"></span><span class="op" id="8418873">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="8418876">var</span>&nbsp;<span class="ident" id="8418880">icmpEchoTests</span>&nbsp;<span class="op" id="8418894">=</span>&nbsp;<span class="op" id="8418896">[</span><span class="op" id="8418897">]</span><span class="keyword" id="8418898">struct</span>&nbsp;<span class="op" id="8418905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8418908">net</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8418914">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8418922">laddr</span>&nbsp;<span class="builtintype" id="8418928">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8418936">raddr</span>&nbsp;<span class="builtintype" id="8418942">string</span><br>
<span class="lineno">90</span><span class="op" id="8418949">}</span><span class="op" id="8418950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8418953">{</span><span class="string" id="8418954">&#34;ip4:icmp&#34;</span><span class="op" id="8418964">,</span>&nbsp;<span class="string" id="8418966">&#34;0.0.0.0&#34;</span><span class="op" id="8418975">,</span>&nbsp;<span class="string" id="8418977">&#34;127.0.0.1&#34;</span><span class="op" id="8418988">}</span><span class="op" id="8418989">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8418992">{</span><span class="string" id="8418993">&#34;ip6:ipv6-icmp&#34;</span><span class="op" id="8419008">,</span>&nbsp;<span class="string" id="8419010">&#34;::&#34;</span><span class="op" id="8419014">,</span>&nbsp;<span class="string" id="8419016">&#34;::1&#34;</span><span class="op" id="8419021">}</span><span class="op" id="8419022">,</span><br>
<span class="lineno"></span><span class="op" id="8419024">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="8419027">func</span>&nbsp;<span class="ident" id="8419032">TestConnICMPEcho</span><span class="op" id="8419048">(</span><span class="ident" id="8419049">t</span>&nbsp;<span class="op" id="8419051">*</span><span class="ident" id="8419052">testing</span><span class="op" id="8419059">.</span><span class="ident" id="8419060">T</span><span class="op" id="8419061">)</span>&nbsp;<span class="op" id="8419063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8419066">if</span>&nbsp;<span class="ident" id="8419069">skip</span><span class="op" id="8419073">,</span>&nbsp;<span class="ident" id="8419075">skipmsg</span>&nbsp;<span class="op" id="8419083">:=</span>&nbsp;<span class="ident" id="8419086">skipRawSocketTest</span><span class="op" id="8419103">(</span><span class="ident" id="8419104">t</span><span class="op" id="8419105">)</span><span class="op" id="8419106">;</span>&nbsp;<span class="ident" id="8419108">skip</span>&nbsp;<span class="op" id="8419113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8419117">t</span><span class="op" id="8419118">.</span><span class="ident" id="8419119">Skip</span><span class="op" id="8419123">(</span><span class="ident" id="8419124">skipmsg</span><span class="op" id="8419131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8419134">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8419138">for</span>&nbsp;<span class="ident" id="8419142">i</span><span class="op" id="8419143">,</span>&nbsp;<span class="ident" id="8419145">tt</span>&nbsp;<span class="op" id="8419148">:=</span>&nbsp;<span class="keyword" id="8419151">range</span>&nbsp;<span class="ident" id="8419157">icmpEchoTests</span>&nbsp;<span class="op" id="8419171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8419175">net</span><span class="op" id="8419178">,</span>&nbsp;<span class="ident" id="8419180">_</span><span class="op" id="8419181">,</span>&nbsp;<span class="ident" id="8419183">err</span>&nbsp;<span class="op" id="8419187">:=</span>&nbsp;<span class="ident" id="8419190">parseNetwork</span><span class="op" id="8419202">(</span><span class="ident" id="8419203">tt</span><span class="op" id="8419205">.</span><span class="ident" id="8419206">net</span><span class="op" id="8419209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8419213">if</span>&nbsp;<span class="ident" id="8419216">err</span>&nbsp;<span class="op" id="8419220">!=</span>&nbsp;<span class="ident" id="8419223">nil</span>&nbsp;<span class="op" id="8419227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8419232">t</span><span class="op" id="8419233">.</span><span class="ident" id="8419234">Fatalf</span><span class="op" id="8419240">(</span><span class="string" id="8419241">&#34;parseNetwork&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8419266">,</span>&nbsp;<span class="ident" id="8419268">err</span><span class="op" id="8419271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8419275">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8419279">if</span>&nbsp;<span class="ident" id="8419282">net</span>&nbsp;<span class="op" id="8419286">==</span>&nbsp;<span class="string" id="8419289">&#34;ip6&#34;</span>&nbsp;<span class="op" id="8419295">&amp;&amp;</span>&nbsp;<span class="op" id="8419298">!</span><span class="ident" id="8419299">supportsIPv6</span>&nbsp;<span class="op" id="8419312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8419317">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8419328">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8419333">c</span><span class="op" id="8419334">,</span>&nbsp;<span class="ident" id="8419336">err</span>&nbsp;<span class="op" id="8419340">:=</span>&nbsp;<span class="ident" id="8419343">Dial</span><span class="op" id="8419347">(</span><span class="ident" id="8419348">tt</span><span class="op" id="8419350">.</span><span class="ident" id="8419351">net</span><span class="op" id="8419354">,</span>&nbsp;<span class="ident" id="8419356">tt</span><span class="op" id="8419358">.</span><span class="ident" id="8419359">raddr</span><span class="op" id="8419364">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8419368">if</span>&nbsp;<span class="ident" id="8419371">err</span>&nbsp;<span class="op" id="8419375">!=</span>&nbsp;<span class="ident" id="8419378">nil</span>&nbsp;<span class="op" id="8419382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8419387">t</span><span class="op" id="8419388">.</span><span class="ident" id="8419389">Fatalf</span><span class="op" id="8419395">(</span><span class="string" id="8419396">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8419413">,</span>&nbsp;<span class="ident" id="8419415">err</span><span class="op" id="8419418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8419422">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8419426">c</span><span class="op" id="8419427">.</span><span class="ident" id="8419428">SetDeadline</span><span class="op" id="8419439">(</span><span class="ident" id="8419440">time</span><span class="op" id="8419444">.</span><span class="ident" id="8419445">Now</span><span class="op" id="8419448">(</span><span class="op" id="8419449">)</span><span class="op" id="8419450">.</span><span class="ident" id="8419451">Add</span><span class="op" id="8419454">(</span><span class="num" id="8419455">100</span>&nbsp;<span class="op" id="8419459">*</span>&nbsp;<span class="ident" id="8419461">time</span><span class="op" id="8419465">.</span><span class="ident" id="8419466">Millisecond</span><span class="op" id="8419477">)</span><span class="op" id="8419478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8419482">defer</span>&nbsp;<span class="ident" id="8419488">c</span><span class="op" id="8419489">.</span><span class="ident" id="8419490">Close</span><span class="op" id="8419495">(</span><span class="op" id="8419496">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8419501">typ</span>&nbsp;<span class="op" id="8419505">:=</span>&nbsp;<span class="ident" id="8419508">icmpv4EchoRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8419528">if</span>&nbsp;<span class="ident" id="8419531">net</span>&nbsp;<span class="op" id="8419535">==</span>&nbsp;<span class="string" id="8419538">&#34;ip6&#34;</span>&nbsp;<span class="op" id="8419544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8419549">typ</span>&nbsp;<span class="op" id="8419553">=</span>&nbsp;<span class="ident" id="8419555">icmpv6EchoRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8419575">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8419579">xid</span><span class="op" id="8419582">,</span>&nbsp;<span class="ident" id="8419584">xseq</span>&nbsp;<span class="op" id="8419589">:=</span>&nbsp;<span class="ident" id="8419592">os</span><span class="op" id="8419594">.</span><span class="ident" id="8419595">Getpid</span><span class="op" id="8419601">(</span><span class="op" id="8419602">)</span><span class="op" id="8419603">&amp;</span><span class="num" id="8419604">0xffff</span><span class="op" id="8419610">,</span>&nbsp;<span class="ident" id="8419612">i</span><span class="op" id="8419613">+</span><span class="num" id="8419614">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8419618">wb</span><span class="op" id="8419620">,</span>&nbsp;<span class="ident" id="8419622">err</span>&nbsp;<span class="op" id="8419626">:=</span>&nbsp;<span class="op" id="8419629">(</span><span class="op" id="8419630">&amp;</span><span class="ident" id="8419631">icmpMessage</span><span class="op" id="8419642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8419647">Type</span><span class="op" id="8419651">:</span>&nbsp;<span class="ident" id="8419653">typ</span><span class="op" id="8419656">,</span>&nbsp;<span class="ident" id="8419658">Code</span><span class="op" id="8419662">:</span>&nbsp;<span class="num" id="8419664">0</span><span class="op" id="8419665">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8419670">Body</span><span class="op" id="8419674">:</span>&nbsp;<span class="op" id="8419676">&amp;</span><span class="ident" id="8419677">icmpEcho</span><span class="op" id="8419685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8419691">ID</span><span class="op" id="8419693">:</span>&nbsp;<span class="ident" id="8419695">xid</span><span class="op" id="8419698">,</span>&nbsp;<span class="ident" id="8419700">Seq</span><span class="op" id="8419703">:</span>&nbsp;<span class="ident" id="8419705">xseq</span><span class="op" id="8419709">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8419715">Data</span><span class="op" id="8419719">:</span>&nbsp;<span class="ident" id="8419721">bytes</span><span class="op" id="8419726">.</span><span class="ident" id="8419727">Repeat</span><span class="op" id="8419733">(</span><span class="op" id="8419734">[</span><span class="op" id="8419735">]</span><span class="builtintype" id="8419736">byte</span><span class="op" id="8419740">(</span><span class="string" id="8419741">&#34;Go&nbsp;Go&nbsp;Gadget&nbsp;Ping!!!&#34;</span><span class="op" id="8419763">)</span><span class="op" id="8419764">,</span>&nbsp;<span class="num" id="8419766">3</span><span class="op" id="8419767">)</span><span class="op" id="8419768">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8419773">}</span><span class="op" id="8419774">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8419778">}</span><span class="op" id="8419779">)</span><span class="op" id="8419780">.</span><span class="ident" id="8419781">Marshal</span><span class="op" id="8419788">(</span><span class="op" id="8419789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8419793">if</span>&nbsp;<span class="ident" id="8419796">err</span>&nbsp;<span class="op" id="8419800">!=</span>&nbsp;<span class="ident" id="8419803">nil</span>&nbsp;<span class="op" id="8419807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8419812">t</span><span class="op" id="8419813">.</span><span class="ident" id="8419814">Fatalf</span><span class="op" id="8419820">(</span><span class="string" id="8419821">&#34;icmpMessage.Marshal&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8419853">,</span>&nbsp;<span class="ident" id="8419855">err</span><span class="op" id="8419858">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8419862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8419866">if</span>&nbsp;<span class="ident" id="8419869">_</span><span class="op" id="8419870">,</span>&nbsp;<span class="ident" id="8419872">err</span>&nbsp;<span class="op" id="8419876">:=</span>&nbsp;<span class="ident" id="8419879">c</span><span class="op" id="8419880">.</span><span class="ident" id="8419881">Write</span><span class="op" id="8419886">(</span><span class="ident" id="8419887">wb</span><span class="op" id="8419889">)</span><span class="op" id="8419890">;</span>&nbsp;<span class="ident" id="8419892">err</span>&nbsp;<span class="op" id="8419896">!=</span>&nbsp;<span class="ident" id="8419899">nil</span>&nbsp;<span class="op" id="8419903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8419908">t</span><span class="op" id="8419909">.</span><span class="ident" id="8419910">Fatalf</span><span class="op" id="8419916">(</span><span class="string" id="8419917">&#34;Conn.Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8419940">,</span>&nbsp;<span class="ident" id="8419942">err</span><span class="op" id="8419945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8419949">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8419953">var</span>&nbsp;<span class="ident" id="8419957">m</span>&nbsp;<span class="op" id="8419959">*</span><span class="ident" id="8419960">icmpMessage</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8419974">rb</span>&nbsp;<span class="op" id="8419977">:=</span>&nbsp;<span class="builtinfunc" id="8419980">make</span><span class="op" id="8419984">(</span><span class="op" id="8419985">[</span><span class="op" id="8419986">]</span><span class="builtintype" id="8419987">byte</span><span class="op" id="8419991">,</span>&nbsp;<span class="num" id="8419993">20</span><span class="op" id="8419995">+</span><span class="builtinfunc" id="8419996">len</span><span class="op" id="8419999">(</span><span class="ident" id="8420000">wb</span><span class="op" id="8420002">)</span><span class="op" id="8420003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8420007">for</span>&nbsp;<span class="op" id="8420011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8420016">if</span>&nbsp;<span class="ident" id="8420019">_</span><span class="op" id="8420020">,</span>&nbsp;<span class="ident" id="8420022">err</span>&nbsp;<span class="op" id="8420026">:=</span>&nbsp;<span class="ident" id="8420029">c</span><span class="op" id="8420030">.</span><span class="ident" id="8420031">Read</span><span class="op" id="8420035">(</span><span class="ident" id="8420036">rb</span><span class="op" id="8420038">)</span><span class="op" id="8420039">;</span>&nbsp;<span class="ident" id="8420041">err</span>&nbsp;<span class="op" id="8420045">!=</span>&nbsp;<span class="ident" id="8420048">nil</span>&nbsp;<span class="op" id="8420052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8420058">t</span><span class="op" id="8420059">.</span><span class="ident" id="8420060">Fatalf</span><span class="op" id="8420066">(</span><span class="string" id="8420067">&#34;Conn.Read&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8420089">,</span>&nbsp;<span class="ident" id="8420091">err</span><span class="op" id="8420094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8420099">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8420104">if</span>&nbsp;<span class="ident" id="8420107">net</span>&nbsp;<span class="op" id="8420111">==</span>&nbsp;<span class="string" id="8420114">&#34;ip4&#34;</span>&nbsp;<span class="op" id="8420120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8420126">rb</span>&nbsp;<span class="op" id="8420129">=</span>&nbsp;<span class="ident" id="8420131">ipv4Payload</span><span class="op" id="8420142">(</span><span class="ident" id="8420143">rb</span><span class="op" id="8420145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8420150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8420155">if</span>&nbsp;<span class="ident" id="8420158">m</span><span class="op" id="8420159">,</span>&nbsp;<span class="ident" id="8420161">err</span>&nbsp;<span class="op" id="8420165">=</span>&nbsp;<span class="ident" id="8420167">parseICMPMessage</span><span class="op" id="8420183">(</span><span class="ident" id="8420184">rb</span><span class="op" id="8420186">)</span><span class="op" id="8420187">;</span>&nbsp;<span class="ident" id="8420189">err</span>&nbsp;<span class="op" id="8420193">!=</span>&nbsp;<span class="ident" id="8420196">nil</span>&nbsp;<span class="op" id="8420200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8420206">t</span><span class="op" id="8420207">.</span><span class="ident" id="8420208">Fatalf</span><span class="op" id="8420214">(</span><span class="string" id="8420215">&#34;parseICMPMessage&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8420244">,</span>&nbsp;<span class="ident" id="8420246">err</span><span class="op" id="8420249">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8420254">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8420259">switch</span>&nbsp;<span class="ident" id="8420266">m</span><span class="op" id="8420267">.</span><span class="ident" id="8420268">Type</span>&nbsp;<span class="op" id="8420273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8420278">case</span>&nbsp;<span class="ident" id="8420283">icmpv4EchoRequest</span><span class="op" id="8420300">,</span>&nbsp;<span class="ident" id="8420302">icmpv6EchoRequest</span><span class="op" id="8420319">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8420325">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8420337">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8420342">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8420350">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8420354">switch</span>&nbsp;<span class="ident" id="8420361">p</span>&nbsp;<span class="op" id="8420363">:=</span>&nbsp;<span class="ident" id="8420366">m</span><span class="op" id="8420367">.</span><span class="ident" id="8420368">Body</span><span class="op" id="8420372">.</span><span class="op" id="8420373">(</span><span class="keyword" id="8420374">type</span><span class="op" id="8420378">)</span>&nbsp;<span class="op" id="8420380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8420384">case</span>&nbsp;<span class="op" id="8420389">*</span><span class="ident" id="8420390">icmpEcho</span><span class="op" id="8420398">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8420403">if</span>&nbsp;<span class="ident" id="8420406">p</span><span class="op" id="8420407">.</span><span class="ident" id="8420408">ID</span>&nbsp;<span class="op" id="8420411">!=</span>&nbsp;<span class="ident" id="8420414">xid</span>&nbsp;<span class="op" id="8420418">||</span>&nbsp;<span class="ident" id="8420421">p</span><span class="op" id="8420422">.</span><span class="ident" id="8420423">Seq</span>&nbsp;<span class="op" id="8420427">!=</span>&nbsp;<span class="ident" id="8420430">xseq</span>&nbsp;<span class="op" id="8420435">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8420441">t</span><span class="op" id="8420442">.</span><span class="ident" id="8420443">Fatalf</span><span class="op" id="8420449">(</span><span class="string" id="8420450">&#34;got&nbsp;id=%v,&nbsp;seqnum=%v;&nbsp;expected&nbsp;id=%v,&nbsp;seqnum=%v&#34;</span><span class="op" id="8420499">,</span>&nbsp;<span class="ident" id="8420501">p</span><span class="op" id="8420502">.</span><span class="ident" id="8420503">ID</span><span class="op" id="8420505">,</span>&nbsp;<span class="ident" id="8420507">p</span><span class="op" id="8420508">.</span><span class="ident" id="8420509">Seq</span><span class="op" id="8420512">,</span>&nbsp;<span class="ident" id="8420514">xid</span><span class="op" id="8420517">,</span>&nbsp;<span class="ident" id="8420519">xseq</span><span class="op" id="8420523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8420528">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8420532">default</span><span class="op" id="8420539">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8420544">t</span><span class="op" id="8420545">.</span><span class="ident" id="8420546">Fatalf</span><span class="op" id="8420552">(</span><span class="string" id="8420553">&#34;got&nbsp;type=%v,&nbsp;code=%v;&nbsp;expected&nbsp;type=%v,&nbsp;code=%v&#34;</span><span class="op" id="8420602">,</span>&nbsp;<span class="ident" id="8420604">m</span><span class="op" id="8420605">.</span><span class="ident" id="8420606">Type</span><span class="op" id="8420610">,</span>&nbsp;<span class="ident" id="8420612">m</span><span class="op" id="8420613">.</span><span class="ident" id="8420614">Code</span><span class="op" id="8420618">,</span>&nbsp;<span class="ident" id="8420620">typ</span><span class="op" id="8420623">,</span>&nbsp;<span class="num" id="8420625">0</span><span class="op" id="8420626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8420630">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8420633">}</span><br>
<span class="lineno"></span><span class="op" id="8420635">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8420638">func</span>&nbsp;<span class="ident" id="8420643">TestPacketConnICMPEcho</span><span class="op" id="8420665">(</span><span class="ident" id="8420666">t</span>&nbsp;<span class="op" id="8420668">*</span><span class="ident" id="8420669">testing</span><span class="op" id="8420676">.</span><span class="ident" id="8420677">T</span><span class="op" id="8420678">)</span>&nbsp;<span class="op" id="8420680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8420683">if</span>&nbsp;<span class="ident" id="8420686">skip</span><span class="op" id="8420690">,</span>&nbsp;<span class="ident" id="8420692">skipmsg</span>&nbsp;<span class="op" id="8420700">:=</span>&nbsp;<span class="ident" id="8420703">skipRawSocketTest</span><span class="op" id="8420720">(</span><span class="ident" id="8420721">t</span><span class="op" id="8420722">)</span><span class="op" id="8420723">;</span>&nbsp;<span class="ident" id="8420725">skip</span>&nbsp;<span class="op" id="8420730">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8420734">t</span><span class="op" id="8420735">.</span><span class="ident" id="8420736">Skip</span><span class="op" id="8420740">(</span><span class="ident" id="8420741">skipmsg</span><span class="op" id="8420748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8420751">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8420755">for</span>&nbsp;<span class="ident" id="8420759">i</span><span class="op" id="8420760">,</span>&nbsp;<span class="ident" id="8420762">tt</span>&nbsp;<span class="op" id="8420765">:=</span>&nbsp;<span class="keyword" id="8420768">range</span>&nbsp;<span class="ident" id="8420774">icmpEchoTests</span>&nbsp;<span class="op" id="8420788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8420792">net</span><span class="op" id="8420795">,</span>&nbsp;<span class="ident" id="8420797">_</span><span class="op" id="8420798">,</span>&nbsp;<span class="ident" id="8420800">err</span>&nbsp;<span class="op" id="8420804">:=</span>&nbsp;<span class="ident" id="8420807">parseNetwork</span><span class="op" id="8420819">(</span><span class="ident" id="8420820">tt</span><span class="op" id="8420822">.</span><span class="ident" id="8420823">net</span><span class="op" id="8420826">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8420830">if</span>&nbsp;<span class="ident" id="8420833">err</span>&nbsp;<span class="op" id="8420837">!=</span>&nbsp;<span class="ident" id="8420840">nil</span>&nbsp;<span class="op" id="8420844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8420849">t</span><span class="op" id="8420850">.</span><span class="ident" id="8420851">Fatalf</span><span class="op" id="8420857">(</span><span class="string" id="8420858">&#34;parseNetwork&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8420883">,</span>&nbsp;<span class="ident" id="8420885">err</span><span class="op" id="8420888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8420892">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8420896">if</span>&nbsp;<span class="ident" id="8420899">net</span>&nbsp;<span class="op" id="8420903">==</span>&nbsp;<span class="string" id="8420906">&#34;ip6&#34;</span>&nbsp;<span class="op" id="8420912">&amp;&amp;</span>&nbsp;<span class="op" id="8420915">!</span><span class="ident" id="8420916">supportsIPv6</span>&nbsp;<span class="op" id="8420929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8420934">continue</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8420945">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8420950">c</span><span class="op" id="8420951">,</span>&nbsp;<span class="ident" id="8420953">err</span>&nbsp;<span class="op" id="8420957">:=</span>&nbsp;<span class="ident" id="8420960">ListenPacket</span><span class="op" id="8420972">(</span><span class="ident" id="8420973">tt</span><span class="op" id="8420975">.</span><span class="ident" id="8420976">net</span><span class="op" id="8420979">,</span>&nbsp;<span class="ident" id="8420981">tt</span><span class="op" id="8420983">.</span><span class="ident" id="8420984">laddr</span><span class="op" id="8420989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8420993">if</span>&nbsp;<span class="ident" id="8420996">err</span>&nbsp;<span class="op" id="8421000">!=</span>&nbsp;<span class="ident" id="8421003">nil</span>&nbsp;<span class="op" id="8421007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8421012">t</span><span class="op" id="8421013">.</span><span class="ident" id="8421014">Fatalf</span><span class="op" id="8421020">(</span><span class="string" id="8421021">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8421046">,</span>&nbsp;<span class="ident" id="8421048">err</span><span class="op" id="8421051">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8421055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8421059">c</span><span class="op" id="8421060">.</span><span class="ident" id="8421061">SetDeadline</span><span class="op" id="8421072">(</span><span class="ident" id="8421073">time</span><span class="op" id="8421077">.</span><span class="ident" id="8421078">Now</span><span class="op" id="8421081">(</span><span class="op" id="8421082">)</span><span class="op" id="8421083">.</span><span class="ident" id="8421084">Add</span><span class="op" id="8421087">(</span><span class="num" id="8421088">100</span>&nbsp;<span class="op" id="8421092">*</span>&nbsp;<span class="ident" id="8421094">time</span><span class="op" id="8421098">.</span><span class="ident" id="8421099">Millisecond</span><span class="op" id="8421110">)</span><span class="op" id="8421111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8421115">defer</span>&nbsp;<span class="ident" id="8421121">c</span><span class="op" id="8421122">.</span><span class="ident" id="8421123">Close</span><span class="op" id="8421128">(</span><span class="op" id="8421129">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8421134">ra</span><span class="op" id="8421136">,</span>&nbsp;<span class="ident" id="8421138">err</span>&nbsp;<span class="op" id="8421142">:=</span>&nbsp;<span class="ident" id="8421145">ResolveIPAddr</span><span class="op" id="8421158">(</span><span class="ident" id="8421159">tt</span><span class="op" id="8421161">.</span><span class="ident" id="8421162">net</span><span class="op" id="8421165">,</span>&nbsp;<span class="ident" id="8421167">tt</span><span class="op" id="8421169">.</span><span class="ident" id="8421170">raddr</span><span class="op" id="8421175">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8421179">if</span>&nbsp;<span class="ident" id="8421182">err</span>&nbsp;<span class="op" id="8421186">!=</span>&nbsp;<span class="ident" id="8421189">nil</span>&nbsp;<span class="op" id="8421193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8421198">t</span><span class="op" id="8421199">.</span><span class="ident" id="8421200">Fatalf</span><span class="op" id="8421206">(</span><span class="string" id="8421207">&#34;ResolveIPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8421233">,</span>&nbsp;<span class="ident" id="8421235">err</span><span class="op" id="8421238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8421242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8421246">typ</span>&nbsp;<span class="op" id="8421250">:=</span>&nbsp;<span class="ident" id="8421253">icmpv4EchoRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8421273">if</span>&nbsp;<span class="ident" id="8421276">net</span>&nbsp;<span class="op" id="8421280">==</span>&nbsp;<span class="string" id="8421283">&#34;ip6&#34;</span>&nbsp;<span class="op" id="8421289">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8421294">typ</span>&nbsp;<span class="op" id="8421298">=</span>&nbsp;<span class="ident" id="8421300">icmpv6EchoRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8421320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8421324">xid</span><span class="op" id="8421327">,</span>&nbsp;<span class="ident" id="8421329">xseq</span>&nbsp;<span class="op" id="8421334">:=</span>&nbsp;<span class="ident" id="8421337">os</span><span class="op" id="8421339">.</span><span class="ident" id="8421340">Getpid</span><span class="op" id="8421346">(</span><span class="op" id="8421347">)</span><span class="op" id="8421348">&amp;</span><span class="num" id="8421349">0xffff</span><span class="op" id="8421355">,</span>&nbsp;<span class="ident" id="8421357">i</span><span class="op" id="8421358">+</span><span class="num" id="8421359">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8421363">wb</span><span class="op" id="8421365">,</span>&nbsp;<span class="ident" id="8421367">err</span>&nbsp;<span class="op" id="8421371">:=</span>&nbsp;<span class="op" id="8421374">(</span><span class="op" id="8421375">&amp;</span><span class="ident" id="8421376">icmpMessage</span><span class="op" id="8421387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8421392">Type</span><span class="op" id="8421396">:</span>&nbsp;<span class="ident" id="8421398">typ</span><span class="op" id="8421401">,</span>&nbsp;<span class="ident" id="8421403">Code</span><span class="op" id="8421407">:</span>&nbsp;<span class="num" id="8421409">0</span><span class="op" id="8421410">,</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8421415">Body</span><span class="op" id="8421419">:</span>&nbsp;<span class="op" id="8421421">&amp;</span><span class="ident" id="8421422">icmpEcho</span><span class="op" id="8421430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8421436">ID</span><span class="op" id="8421438">:</span>&nbsp;<span class="ident" id="8421440">xid</span><span class="op" id="8421443">,</span>&nbsp;<span class="ident" id="8421445">Seq</span><span class="op" id="8421448">:</span>&nbsp;<span class="ident" id="8421450">xseq</span><span class="op" id="8421454">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8421460">Data</span><span class="op" id="8421464">:</span>&nbsp;<span class="ident" id="8421466">bytes</span><span class="op" id="8421471">.</span><span class="ident" id="8421472">Repeat</span><span class="op" id="8421478">(</span><span class="op" id="8421479">[</span><span class="op" id="8421480">]</span><span class="builtintype" id="8421481">byte</span><span class="op" id="8421485">(</span><span class="string" id="8421486">&#34;Go&nbsp;Go&nbsp;Gadget&nbsp;Ping!!!&#34;</span><span class="op" id="8421508">)</span><span class="op" id="8421509">,</span>&nbsp;<span class="num" id="8421511">3</span><span class="op" id="8421512">)</span><span class="op" id="8421513">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8421518">}</span><span class="op" id="8421519">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8421523">}</span><span class="op" id="8421524">)</span><span class="op" id="8421525">.</span><span class="ident" id="8421526">Marshal</span><span class="op" id="8421533">(</span><span class="op" id="8421534">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8421538">if</span>&nbsp;<span class="ident" id="8421541">err</span>&nbsp;<span class="op" id="8421545">!=</span>&nbsp;<span class="ident" id="8421548">nil</span>&nbsp;<span class="op" id="8421552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8421557">t</span><span class="op" id="8421558">.</span><span class="ident" id="8421559">Fatalf</span><span class="op" id="8421565">(</span><span class="string" id="8421566">&#34;icmpMessage.Marshal&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8421598">,</span>&nbsp;<span class="ident" id="8421600">err</span><span class="op" id="8421603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8421607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8421611">if</span>&nbsp;<span class="ident" id="8421614">_</span><span class="op" id="8421615">,</span>&nbsp;<span class="ident" id="8421617">err</span>&nbsp;<span class="op" id="8421621">:=</span>&nbsp;<span class="ident" id="8421624">c</span><span class="op" id="8421625">.</span><span class="ident" id="8421626">WriteTo</span><span class="op" id="8421633">(</span><span class="ident" id="8421634">wb</span><span class="op" id="8421636">,</span>&nbsp;<span class="ident" id="8421638">ra</span><span class="op" id="8421640">)</span><span class="op" id="8421641">;</span>&nbsp;<span class="ident" id="8421643">err</span>&nbsp;<span class="op" id="8421647">!=</span>&nbsp;<span class="ident" id="8421650">nil</span>&nbsp;<span class="op" id="8421654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8421659">t</span><span class="op" id="8421660">.</span><span class="ident" id="8421661">Fatalf</span><span class="op" id="8421667">(</span><span class="string" id="8421668">&#34;PacketConn.WriteTo&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8421699">,</span>&nbsp;<span class="ident" id="8421701">err</span><span class="op" id="8421704">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8421708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8421712">var</span>&nbsp;<span class="ident" id="8421716">m</span>&nbsp;<span class="op" id="8421718">*</span><span class="ident" id="8421719">icmpMessage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8421733">rb</span>&nbsp;<span class="op" id="8421736">:=</span>&nbsp;<span class="builtinfunc" id="8421739">make</span><span class="op" id="8421743">(</span><span class="op" id="8421744">[</span><span class="op" id="8421745">]</span><span class="builtintype" id="8421746">byte</span><span class="op" id="8421750">,</span>&nbsp;<span class="num" id="8421752">20</span><span class="op" id="8421754">+</span><span class="builtinfunc" id="8421755">len</span><span class="op" id="8421758">(</span><span class="ident" id="8421759">wb</span><span class="op" id="8421761">)</span><span class="op" id="8421762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8421766">for</span>&nbsp;<span class="op" id="8421770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8421775">if</span>&nbsp;<span class="ident" id="8421778">_</span><span class="op" id="8421779">,</span>&nbsp;<span class="ident" id="8421781">_</span><span class="op" id="8421782">,</span>&nbsp;<span class="ident" id="8421784">err</span>&nbsp;<span class="op" id="8421788">:=</span>&nbsp;<span class="ident" id="8421791">c</span><span class="op" id="8421792">.</span><span class="ident" id="8421793">ReadFrom</span><span class="op" id="8421801">(</span><span class="ident" id="8421802">rb</span><span class="op" id="8421804">)</span><span class="op" id="8421805">;</span>&nbsp;<span class="ident" id="8421807">err</span>&nbsp;<span class="op" id="8421811">!=</span>&nbsp;<span class="ident" id="8421814">nil</span>&nbsp;<span class="op" id="8421818">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8421824">t</span><span class="op" id="8421825">.</span><span class="ident" id="8421826">Fatalf</span><span class="op" id="8421832">(</span><span class="string" id="8421833">&#34;PacketConn.ReadFrom&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8421865">,</span>&nbsp;<span class="ident" id="8421867">err</span><span class="op" id="8421870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8421875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8421880">//&nbsp;See&nbsp;BUG&nbsp;section.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8421903">//if&nbsp;net&nbsp;==&nbsp;&#34;ip4&#34;&nbsp;{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8421926">//&nbsp;&nbsp;&nbsp;&nbsprb&nbsp;=&nbsp;ipv4Payload(rb)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8421953">//}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8421960">if</span>&nbsp;<span class="ident" id="8421963">m</span><span class="op" id="8421964">,</span>&nbsp;<span class="ident" id="8421966">err</span>&nbsp;<span class="op" id="8421970">=</span>&nbsp;<span class="ident" id="8421972">parseICMPMessage</span><span class="op" id="8421988">(</span><span class="ident" id="8421989">rb</span><span class="op" id="8421991">)</span><span class="op" id="8421992">;</span>&nbsp;<span class="ident" id="8421994">err</span>&nbsp;<span class="op" id="8421998">!=</span>&nbsp;<span class="ident" id="8422001">nil</span>&nbsp;<span class="op" id="8422005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8422011">t</span><span class="op" id="8422012">.</span><span class="ident" id="8422013">Fatalf</span><span class="op" id="8422019">(</span><span class="string" id="8422020">&#34;parseICMPMessage&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8422049">,</span>&nbsp;<span class="ident" id="8422051">err</span><span class="op" id="8422054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8422059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8422064">switch</span>&nbsp;<span class="ident" id="8422071">m</span><span class="op" id="8422072">.</span><span class="ident" id="8422073">Type</span>&nbsp;<span class="op" id="8422078">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8422083">case</span>&nbsp;<span class="ident" id="8422088">icmpv4EchoRequest</span><span class="op" id="8422105">,</span>&nbsp;<span class="ident" id="8422107">icmpv6EchoRequest</span><span class="op" id="8422124">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8422130">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8422142">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8422147">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8422155">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8422159">switch</span>&nbsp;<span class="ident" id="8422166">p</span>&nbsp;<span class="op" id="8422168">:=</span>&nbsp;<span class="ident" id="8422171">m</span><span class="op" id="8422172">.</span><span class="ident" id="8422173">Body</span><span class="op" id="8422177">.</span><span class="op" id="8422178">(</span><span class="keyword" id="8422179">type</span><span class="op" id="8422183">)</span>&nbsp;<span class="op" id="8422185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8422189">case</span>&nbsp;<span class="op" id="8422194">*</span><span class="ident" id="8422195">icmpEcho</span><span class="op" id="8422203">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8422208">if</span>&nbsp;<span class="ident" id="8422211">p</span><span class="op" id="8422212">.</span><span class="ident" id="8422213">ID</span>&nbsp;<span class="op" id="8422216">!=</span>&nbsp;<span class="ident" id="8422219">xid</span>&nbsp;<span class="op" id="8422223">||</span>&nbsp;<span class="ident" id="8422226">p</span><span class="op" id="8422227">.</span><span class="ident" id="8422228">Seq</span>&nbsp;<span class="op" id="8422232">!=</span>&nbsp;<span class="ident" id="8422235">xseq</span>&nbsp;<span class="op" id="8422240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8422246">t</span><span class="op" id="8422247">.</span><span class="ident" id="8422248">Fatalf</span><span class="op" id="8422254">(</span><span class="string" id="8422255">&#34;got&nbsp;id=%v,&nbsp;seqnum=%v;&nbsp;expected&nbsp;id=%v,&nbsp;seqnum=%v&#34;</span><span class="op" id="8422304">,</span>&nbsp;<span class="ident" id="8422306">p</span><span class="op" id="8422307">.</span><span class="ident" id="8422308">ID</span><span class="op" id="8422310">,</span>&nbsp;<span class="ident" id="8422312">p</span><span class="op" id="8422313">.</span><span class="ident" id="8422314">Seq</span><span class="op" id="8422317">,</span>&nbsp;<span class="ident" id="8422319">xid</span><span class="op" id="8422322">,</span>&nbsp;<span class="ident" id="8422324">xseq</span><span class="op" id="8422328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8422333">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8422337">default</span><span class="op" id="8422344">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8422349">t</span><span class="op" id="8422350">.</span><span class="ident" id="8422351">Fatalf</span><span class="op" id="8422357">(</span><span class="string" id="8422358">&#34;got&nbsp;type=%v,&nbsp;code=%v;&nbsp;expected&nbsp;type=%v,&nbsp;code=%v&#34;</span><span class="op" id="8422407">,</span>&nbsp;<span class="ident" id="8422409">m</span><span class="op" id="8422410">.</span><span class="ident" id="8422411">Type</span><span class="op" id="8422415">,</span>&nbsp;<span class="ident" id="8422417">m</span><span class="op" id="8422418">.</span><span class="ident" id="8422419">Code</span><span class="op" id="8422423">,</span>&nbsp;<span class="ident" id="8422425">typ</span><span class="op" id="8422428">,</span>&nbsp;<span class="num" id="8422430">0</span><span class="op" id="8422431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8422435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8422438">}</span><br>
<span class="lineno"></span><span class="op" id="8422440">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="keyword" id="8422443">func</span>&nbsp;<span class="ident" id="8422448">ipv4Payload</span><span class="op" id="8422459">(</span><span class="ident" id="8422460">b</span>&nbsp;<span class="op" id="8422462">[</span><span class="op" id="8422463">]</span><span class="builtintype" id="8422464">byte</span><span class="op" id="8422468">)</span>&nbsp;<span class="op" id="8422470">[</span><span class="op" id="8422471">]</span><span class="builtintype" id="8422472">byte</span>&nbsp;<span class="op" id="8422477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8422480">if</span>&nbsp;<span class="builtinfunc" id="8422483">len</span><span class="op" id="8422486">(</span><span class="ident" id="8422487">b</span><span class="op" id="8422488">)</span>&nbsp;<span class="op" id="8422490">&lt;</span>&nbsp;<span class="num" id="8422492">20</span>&nbsp;<span class="op" id="8422495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8422499">return</span>&nbsp;<span class="ident" id="8422506">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8422509">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8422512">hdrlen</span>&nbsp;<span class="op" id="8422519">:=</span>&nbsp;<span class="builtintype" id="8422522">int</span><span class="op" id="8422525">(</span><span class="ident" id="8422526">b</span><span class="op" id="8422527">[</span><span class="num" id="8422528">0</span><span class="op" id="8422529">]</span><span class="op" id="8422530">&amp;</span><span class="num" id="8422531">0x0f</span><span class="op" id="8422535">)</span>&nbsp;<span class="op" id="8422537">&lt;&lt;</span>&nbsp;<span class="num" id="8422540">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8422543">return</span>&nbsp;<span class="ident" id="8422550">b</span><span class="op" id="8422551">[</span><span class="ident" id="8422552">hdrlen</span><span class="op" id="8422558">:</span><span class="op" id="8422559">]</span><br>
<span class="lineno"></span><span class="op" id="8422561">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8422564">var</span>&nbsp;<span class="ident" id="8422568">ipConnLocalNameTests</span>&nbsp;<span class="op" id="8422589">=</span>&nbsp;<span class="op" id="8422591">[</span><span class="op" id="8422592">]</span><span class="keyword" id="8422593">struct</span>&nbsp;<span class="op" id="8422600">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8422603">net</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8422609">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8422617">laddr</span>&nbsp;<span class="op" id="8422623">*</span><span class="ident" id="8422624">IPAddr</span><br>
<span class="lineno"></span><span class="op" id="8422631">}</span><span class="op" id="8422632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8422635">{</span><span class="string" id="8422636">&#34;ip4:icmp&#34;</span><span class="op" id="8422646">,</span>&nbsp;<span class="op" id="8422648">&amp;</span><span class="ident" id="8422649">IPAddr</span><span class="op" id="8422655">{</span><span class="ident" id="8422656">IP</span><span class="op" id="8422658">:</span>&nbsp;<span class="ident" id="8422660">IPv4</span><span class="op" id="8422664">(</span><span class="num" id="8422665">127</span><span class="op" id="8422668">,</span>&nbsp;<span class="num" id="8422670">0</span><span class="op" id="8422671">,</span>&nbsp;<span class="num" id="8422673">0</span><span class="op" id="8422674">,</span>&nbsp;<span class="num" id="8422676">1</span><span class="op" id="8422677">)</span><span class="op" id="8422678">}</span><span class="op" id="8422679">}</span><span class="op" id="8422680">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8422683">{</span><span class="string" id="8422684">&#34;ip4:icmp&#34;</span><span class="op" id="8422694">,</span>&nbsp;<span class="op" id="8422696">&amp;</span><span class="ident" id="8422697">IPAddr</span><span class="op" id="8422703">{</span><span class="op" id="8422704">}</span><span class="op" id="8422705">}</span><span class="op" id="8422706">,</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8422709">{</span><span class="string" id="8422710">&#34;ip4:icmp&#34;</span><span class="op" id="8422720">,</span>&nbsp;<span class="ident" id="8422722">nil</span><span class="op" id="8422725">}</span><span class="op" id="8422726">,</span><br>
<span class="lineno"></span><span class="op" id="8422728">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8422731">func</span>&nbsp;<span class="ident" id="8422736">TestIPConnLocalName</span><span class="op" id="8422755">(</span><span class="ident" id="8422756">t</span>&nbsp;<span class="op" id="8422758">*</span><span class="ident" id="8422759">testing</span><span class="op" id="8422766">.</span><span class="ident" id="8422767">T</span><span class="op" id="8422768">)</span>&nbsp;<span class="op" id="8422770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8422773">switch</span>&nbsp;<span class="ident" id="8422780">runtime</span><span class="op" id="8422787">.</span><span class="ident" id="8422788">GOOS</span>&nbsp;<span class="op" id="8422793">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8422796">case</span>&nbsp;<span class="string" id="8422801">&#34;nacl&#34;</span><span class="op" id="8422807">,</span>&nbsp;<span class="string" id="8422809">&#34;plan9&#34;</span><span class="op" id="8422816">,</span>&nbsp;<span class="string" id="8422818">&#34;windows&#34;</span><span class="op" id="8422827">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8422831">t</span><span class="op" id="8422832">.</span><span class="ident" id="8422833">Skipf</span><span class="op" id="8422838">(</span><span class="string" id="8422839">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8422860">,</span>&nbsp;<span class="ident" id="8422862">runtime</span><span class="op" id="8422869">.</span><span class="ident" id="8422870">GOOS</span><span class="op" id="8422874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8422877">default</span><span class="op" id="8422884">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8422888">if</span>&nbsp;<span class="ident" id="8422891">os</span><span class="op" id="8422893">.</span><span class="ident" id="8422894">Getuid</span><span class="op" id="8422900">(</span><span class="op" id="8422901">)</span>&nbsp;<span class="op" id="8422903">!=</span>&nbsp;<span class="num" id="8422906">0</span>&nbsp;<span class="op" id="8422908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8422913">t</span><span class="op" id="8422914">.</span><span class="ident" id="8422915">Skip</span><span class="op" id="8422919">(</span><span class="string" id="8422920">&#34;skipping&nbsp;test;&nbsp;must&nbsp;be&nbsp;root&#34;</span><span class="op" id="8422949">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8422953">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8422956">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8422960">for</span>&nbsp;<span class="ident" id="8422964">_</span><span class="op" id="8422965">,</span>&nbsp;<span class="ident" id="8422967">tt</span>&nbsp;<span class="op" id="8422970">:=</span>&nbsp;<span class="keyword" id="8422973">range</span>&nbsp;<span class="ident" id="8422979">ipConnLocalNameTests</span>&nbsp;<span class="op" id="8423000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8423004">c</span><span class="op" id="8423005">,</span>&nbsp;<span class="ident" id="8423007">err</span>&nbsp;<span class="op" id="8423011">:=</span>&nbsp;<span class="ident" id="8423014">ListenIP</span><span class="op" id="8423022">(</span><span class="ident" id="8423023">tt</span><span class="op" id="8423025">.</span><span class="ident" id="8423026">net</span><span class="op" id="8423029">,</span>&nbsp;<span class="ident" id="8423031">tt</span><span class="op" id="8423033">.</span><span class="ident" id="8423034">laddr</span><span class="op" id="8423039">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8423043">if</span>&nbsp;<span class="ident" id="8423046">err</span>&nbsp;<span class="op" id="8423050">!=</span>&nbsp;<span class="ident" id="8423053">nil</span>&nbsp;<span class="op" id="8423057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8423062">t</span><span class="op" id="8423063">.</span><span class="ident" id="8423064">Fatalf</span><span class="op" id="8423070">(</span><span class="string" id="8423071">&#34;ListenIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8423092">,</span>&nbsp;<span class="ident" id="8423094">err</span><span class="op" id="8423097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8423101">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8423105">defer</span>&nbsp;<span class="ident" id="8423111">c</span><span class="op" id="8423112">.</span><span class="ident" id="8423113">Close</span><span class="op" id="8423118">(</span><span class="op" id="8423119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8423123">if</span>&nbsp;<span class="ident" id="8423126">la</span>&nbsp;<span class="op" id="8423129">:=</span>&nbsp;<span class="ident" id="8423132">c</span><span class="op" id="8423133">.</span><span class="ident" id="8423134">LocalAddr</span><span class="op" id="8423143">(</span><span class="op" id="8423144">)</span><span class="op" id="8423145">;</span>&nbsp;<span class="ident" id="8423147">la</span>&nbsp;<span class="op" id="8423150">==</span>&nbsp;<span class="ident" id="8423153">nil</span>&nbsp;<span class="op" id="8423157">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8423162">t</span><span class="op" id="8423163">.</span><span class="ident" id="8423164">Fatal</span><span class="op" id="8423169">(</span><span class="string" id="8423170">&#34;IPConn.LocalAddr&nbsp;failed&#34;</span><span class="op" id="8423195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8423199">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8423202">}</span><br>
<span class="lineno"></span><span class="op" id="8423204">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span><span class="keyword" id="8423207">func</span>&nbsp;<span class="ident" id="8423212">TestIPConnRemoteName</span><span class="op" id="8423232">(</span><span class="ident" id="8423233">t</span>&nbsp;<span class="op" id="8423235">*</span><span class="ident" id="8423236">testing</span><span class="op" id="8423243">.</span><span class="ident" id="8423244">T</span><span class="op" id="8423245">)</span>&nbsp;<span class="op" id="8423247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8423250">switch</span>&nbsp;<span class="ident" id="8423257">runtime</span><span class="op" id="8423264">.</span><span class="ident" id="8423265">GOOS</span>&nbsp;<span class="op" id="8423270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8423273">case</span>&nbsp;<span class="string" id="8423278">&#34;plan9&#34;</span><span class="op" id="8423285">,</span>&nbsp;<span class="string" id="8423287">&#34;windows&#34;</span><span class="op" id="8423296">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8423300">t</span><span class="op" id="8423301">.</span><span class="ident" id="8423302">Skipf</span><span class="op" id="8423307">(</span><span class="string" id="8423308">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8423329">,</span>&nbsp;<span class="ident" id="8423331">runtime</span><span class="op" id="8423338">.</span><span class="ident" id="8423339">GOOS</span><span class="op" id="8423343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8423346">default</span><span class="op" id="8423353">:</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8423357">if</span>&nbsp;<span class="ident" id="8423360">os</span><span class="op" id="8423362">.</span><span class="ident" id="8423363">Getuid</span><span class="op" id="8423369">(</span><span class="op" id="8423370">)</span>&nbsp;<span class="op" id="8423372">!=</span>&nbsp;<span class="num" id="8423375">0</span>&nbsp;<span class="op" id="8423377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8423382">t</span><span class="op" id="8423383">.</span><span class="ident" id="8423384">Skip</span><span class="op" id="8423388">(</span><span class="string" id="8423389">&#34;skipping&nbsp;test;&nbsp;must&nbsp;be&nbsp;root&#34;</span><span class="op" id="8423418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8423422">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8423425">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8423429">raddr</span>&nbsp;<span class="op" id="8423435">:=</span>&nbsp;<span class="op" id="8423438">&amp;</span><span class="ident" id="8423439">IPAddr</span><span class="op" id="8423445">{</span><span class="ident" id="8423446">IP</span><span class="op" id="8423448">:</span>&nbsp;<span class="ident" id="8423450">IPv4</span><span class="op" id="8423454">(</span><span class="num" id="8423455">127</span><span class="op" id="8423458">,</span>&nbsp;<span class="num" id="8423460">0</span><span class="op" id="8423461">,</span>&nbsp;<span class="num" id="8423463">0</span><span class="op" id="8423464">,</span>&nbsp;<span class="num" id="8423466">1</span><span class="op" id="8423467">)</span><span class="op" id="8423468">.</span><span class="ident" id="8423469">To4</span><span class="op" id="8423472">(</span><span class="op" id="8423473">)</span><span class="op" id="8423474">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8423477">c</span><span class="op" id="8423478">,</span>&nbsp;<span class="ident" id="8423480">err</span>&nbsp;<span class="op" id="8423484">:=</span>&nbsp;<span class="ident" id="8423487">DialIP</span><span class="op" id="8423493">(</span><span class="string" id="8423494">&#34;ip:tcp&#34;</span><span class="op" id="8423502">,</span>&nbsp;<span class="op" id="8423504">&amp;</span><span class="ident" id="8423505">IPAddr</span><span class="op" id="8423511">{</span><span class="ident" id="8423512">IP</span><span class="op" id="8423514">:</span>&nbsp;<span class="ident" id="8423516">IPv4</span><span class="op" id="8423520">(</span><span class="num" id="8423521">127</span><span class="op" id="8423524">,</span>&nbsp;<span class="num" id="8423526">0</span><span class="op" id="8423527">,</span>&nbsp;<span class="num" id="8423529">0</span><span class="op" id="8423530">,</span>&nbsp;<span class="num" id="8423532">1</span><span class="op" id="8423533">)</span><span class="op" id="8423534">}</span><span class="op" id="8423535">,</span>&nbsp;<span class="ident" id="8423537">raddr</span><span class="op" id="8423542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8423545">if</span>&nbsp;<span class="ident" id="8423548">err</span>&nbsp;<span class="op" id="8423552">!=</span>&nbsp;<span class="ident" id="8423555">nil</span>&nbsp;<span class="op" id="8423559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8423563">t</span><span class="op" id="8423564">.</span><span class="ident" id="8423565">Fatalf</span><span class="op" id="8423571">(</span><span class="string" id="8423572">&#34;DialIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8423591">,</span>&nbsp;<span class="ident" id="8423593">err</span><span class="op" id="8423596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8423599">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8423602">defer</span>&nbsp;<span class="ident" id="8423608">c</span><span class="op" id="8423609">.</span><span class="ident" id="8423610">Close</span><span class="op" id="8423615">(</span><span class="op" id="8423616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8423619">if</span>&nbsp;<span class="op" id="8423622">!</span><span class="ident" id="8423623">reflect</span><span class="op" id="8423630">.</span><span class="ident" id="8423631">DeepEqual</span><span class="op" id="8423640">(</span><span class="ident" id="8423641">raddr</span><span class="op" id="8423646">,</span>&nbsp;<span class="ident" id="8423648">c</span><span class="op" id="8423649">.</span><span class="ident" id="8423650">RemoteAddr</span><span class="op" id="8423660">(</span><span class="op" id="8423661">)</span><span class="op" id="8423662">)</span>&nbsp;<span class="op" id="8423664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8423668">t</span><span class="op" id="8423669">.</span><span class="ident" id="8423670">Fatalf</span><span class="op" id="8423676">(</span><span class="string" id="8423677">&#34;got&nbsp;%#v,&nbsp;expected&nbsp;%#v&#34;</span><span class="op" id="8423700">,</span>&nbsp;<span class="ident" id="8423702">c</span><span class="op" id="8423703">.</span><span class="ident" id="8423704">RemoteAddr</span><span class="op" id="8423714">(</span><span class="op" id="8423715">)</span><span class="op" id="8423716">,</span>&nbsp;<span class="ident" id="8423718">raddr</span><span class="op" id="8423723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8423726">}</span><br>
<span class="lineno"></span><span class="op" id="8423728">}</span>
</div>
</body>
</html>
