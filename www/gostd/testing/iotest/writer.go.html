<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6217589">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6217644">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6217698">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6217749">package</span>&nbsp;<span class="ident" id="6217757">iotest</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6217765">import</span>&nbsp;<span class="string" id="6217772">&#34;io&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6217778">//&nbsp;TruncateWriter&nbsp;returns&nbsp;a&nbsp;Writer&nbsp;that&nbsp;writes&nbsp;to&nbsp;w</span><br>
<span class="lineno">10</span><span class="comment" id="6217830">//&nbsp;but&nbsp;stops&nbsp;silently&nbsp;after&nbsp;n&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="6217867">func</span>&nbsp;<span class="ident" id="6217872">TruncateWriter</span><span class="op" id="6217886">(</span><span class="ident" id="6217887">w</span>&nbsp;<span class="ident" id="6217889">io</span><span class="op" id="6217891">.</span><span class="ident" id="6217892">Writer</span><span class="op" id="6217898">,</span>&nbsp;<span class="ident" id="6217900">n</span>&nbsp;<span class="ident" id="6217902">int64</span><span class="op" id="6217907">)</span>&nbsp;<span class="ident" id="6217909">io</span><span class="op" id="6217911">.</span><span class="ident" id="6217912">Writer</span>&nbsp;<span class="op" id="6217919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6217922">return</span>&nbsp;<span class="op" id="6217929">&amp;</span><span class="ident" id="6217930">truncateWriter</span><span class="op" id="6217944">{</span><span class="ident" id="6217945">w</span><span class="op" id="6217946">,</span>&nbsp;<span class="ident" id="6217948">n</span><span class="op" id="6217949">}</span><br>
<span class="lineno"></span><span class="op" id="6217951">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="6217954">type</span>&nbsp;<span class="ident" id="6217959">truncateWriter</span>&nbsp;<span class="keyword" id="6217974">struct</span>&nbsp;<span class="op" id="6217981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6217984">w</span>&nbsp;<span class="ident" id="6217986">io</span><span class="op" id="6217988">.</span><span class="ident" id="6217989">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6217997">n</span>&nbsp;<span class="ident" id="6217999">int64</span><br>
<span class="lineno"></span><span class="op" id="6218005">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="6218008">func</span>&nbsp;<span class="op" id="6218013">(</span><span class="ident" id="6218014">t</span>&nbsp;<span class="op" id="6218016">*</span><span class="ident" id="6218017">truncateWriter</span><span class="op" id="6218031">)</span>&nbsp;<span class="ident" id="6218033">Write</span><span class="op" id="6218038">(</span><span class="ident" id="6218039">p</span>&nbsp;<span class="op" id="6218041">[</span><span class="op" id="6218042">]</span><span class="builtintype" id="6218043">byte</span><span class="op" id="6218047">)</span>&nbsp;<span class="op" id="6218049">(</span><span class="ident" id="6218050">n</span>&nbsp;<span class="builtintype" id="6218052">int</span><span class="op" id="6218055">,</span>&nbsp;<span class="ident" id="6218057">err</span>&nbsp;<span class="builtintype" id="6218061">error</span><span class="op" id="6218066">)</span>&nbsp;<span class="op" id="6218068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6218071">if</span>&nbsp;<span class="ident" id="6218074">t</span><span class="op" id="6218075">.</span><span class="ident" id="6218076">n</span>&nbsp;<span class="op" id="6218078">&lt;=</span>&nbsp;<span class="num" id="6218081">0</span>&nbsp;<span class="op" id="6218083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6218087">return</span>&nbsp;<span class="builtinfunc" id="6218094">len</span><span class="op" id="6218097">(</span><span class="ident" id="6218098">p</span><span class="op" id="6218099">)</span><span class="op" id="6218100">,</span>&nbsp;<span class="ident" id="6218102">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6218107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6218110">//&nbsp;real&nbsp;write</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6218125">n</span>&nbsp;<span class="op" id="6218127">=</span>&nbsp;<span class="builtinfunc" id="6218129">len</span><span class="op" id="6218132">(</span><span class="ident" id="6218133">p</span><span class="op" id="6218134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6218137">if</span>&nbsp;<span class="ident" id="6218140">int64</span><span class="op" id="6218145">(</span><span class="ident" id="6218146">n</span><span class="op" id="6218147">)</span>&nbsp;<span class="op" id="6218149">&gt;</span>&nbsp;<span class="ident" id="6218151">t</span><span class="op" id="6218152">.</span><span class="ident" id="6218153">n</span>&nbsp;<span class="op" id="6218155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6218159">n</span>&nbsp;<span class="op" id="6218161">=</span>&nbsp;<span class="builtintype" id="6218163">int</span><span class="op" id="6218166">(</span><span class="ident" id="6218167">t</span><span class="op" id="6218168">.</span><span class="ident" id="6218169">n</span><span class="op" id="6218170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6218173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6218176">n</span><span class="op" id="6218177">,</span>&nbsp;<span class="ident" id="6218179">err</span>&nbsp;<span class="op" id="6218183">=</span>&nbsp;<span class="ident" id="6218185">t</span><span class="op" id="6218186">.</span><span class="ident" id="6218187">w</span><span class="op" id="6218188">.</span><span class="ident" id="6218189">Write</span><span class="op" id="6218194">(</span><span class="ident" id="6218195">p</span><span class="op" id="6218196">[</span><span class="num" id="6218197">0</span><span class="op" id="6218198">:</span><span class="ident" id="6218199">n</span><span class="op" id="6218200">]</span><span class="op" id="6218201">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6218204">t</span><span class="op" id="6218205">.</span><span class="ident" id="6218206">n</span>&nbsp;<span class="op" id="6218208">-=</span>&nbsp;<span class="ident" id="6218211">int64</span><span class="op" id="6218216">(</span><span class="ident" id="6218217">n</span><span class="op" id="6218218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6218221">if</span>&nbsp;<span class="ident" id="6218224">err</span>&nbsp;<span class="op" id="6218228">==</span>&nbsp;<span class="ident" id="6218231">nil</span>&nbsp;<span class="op" id="6218235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6218239">n</span>&nbsp;<span class="op" id="6218241">=</span>&nbsp;<span class="builtinfunc" id="6218243">len</span><span class="op" id="6218246">(</span><span class="ident" id="6218247">p</span><span class="op" id="6218248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6218251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6218254">return</span><br>
<span class="lineno">35</span><span class="op" id="6218261">}</span>
</div>
</body>
</html>
