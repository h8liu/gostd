<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2029982">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2030037">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2030091">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2030142">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris&nbsp;windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2030220">package</span>&nbsp;<span class="ident" id="2030228">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2030237">import</span>&nbsp;<span class="string" id="2030244">&#34;unsafe&#34;</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="2030254">//&nbsp;Integrated&nbsp;network&nbsp;poller&nbsp;(platform-independent&nbsp;part).</span><br>
<span class="lineno"></span><span class="comment" id="2030312">//&nbsp;A&nbsp;particular&nbsp;implementation&nbsp;(epoll/kqueue)&nbsp;must&nbsp;define&nbsp;the&nbsp;following&nbsp;functions:</span><br>
<span class="lineno"></span><span class="comment" id="2030395">//&nbsp;func&nbsp;netpollinit()&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;to&nbsp;initialize&nbsp;the&nbsp;poller</span><br>
<span class="lineno"></span><span class="comment" id="2030447">//&nbsp;func&nbsp;netpollopen(fd&nbsp;uintptr,&nbsp;pd&nbsp;*pollDesc)&nbsp;int32&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;to&nbsp;arm&nbsp;edge-triggered&nbsp;notifications</span><br>
<span class="lineno">15</span><span class="comment" id="2030538">//&nbsp;and&nbsp;associate&nbsp;fd&nbsp;with&nbsp;pd.</span><br>
<span class="lineno"></span><span class="comment" id="2030567">//&nbsp;An&nbsp;implementation&nbsp;must&nbsp;call&nbsp;the&nbsp;following&nbsp;function&nbsp;to&nbsp;denote&nbsp;that&nbsp;the&nbsp;pd&nbsp;is&nbsp;ready.</span><br>
<span class="lineno"></span><span class="comment" id="2030653">//&nbsp;func&nbsp;netpollready(gpp&nbsp;**g,&nbsp;pd&nbsp;*pollDesc,&nbsp;mode&nbsp;int32)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2030710">//&nbsp;pollDesc&nbsp;contains&nbsp;2&nbsp;binary&nbsp;semaphores,&nbsp;rg&nbsp;and&nbsp;wg,&nbsp;to&nbsp;park&nbsp;reader&nbsp;and&nbsp;writer</span><br>
<span class="lineno">20</span><span class="comment" id="2030789">//&nbsp;goroutines&nbsp;respectively.&nbsp;The&nbsp;semaphore&nbsp;can&nbsp;be&nbsp;in&nbsp;the&nbsp;following&nbsp;states:</span><br>
<span class="lineno"></span><span class="comment" id="2030863">//&nbsp;pdReady&nbsp;-&nbsp;io&nbsp;readiness&nbsp;notification&nbsp;is&nbsp;pending;</span><br>
<span class="lineno"></span><span class="comment" id="2030914">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;goroutine&nbsp;consumes&nbsp;the&nbsp;notification&nbsp;by&nbsp;changing&nbsp;the&nbsp;state&nbsp;to&nbsp;nil.</span><br>
<span class="lineno"></span><span class="comment" id="2030995">//&nbsp;pdWait&nbsp;-&nbsp;a&nbsp;goroutine&nbsp;prepares&nbsp;to&nbsp;park&nbsp;on&nbsp;the&nbsp;semaphore,&nbsp;but&nbsp;not&nbsp;yet&nbsp;parked;</span><br>
<span class="lineno"></span><span class="comment" id="2031074">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;goroutine&nbsp;commits&nbsp;to&nbsp;park&nbsp;by&nbsp;changing&nbsp;the&nbsp;state&nbsp;to&nbsp;G&nbsp;pointer,</span><br>
<span class="lineno">25</span><span class="comment" id="2031152">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or,&nbsp;alternatively,&nbsp;concurrent&nbsp;io&nbsp;notification&nbsp;changes&nbsp;the&nbsp;state&nbsp;to&nbsp;READY,</span><br>
<span class="lineno"></span><span class="comment" id="2031238">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or,&nbsp;alternatively,&nbsp;concurrent&nbsp;timeout/close&nbsp;changes&nbsp;the&nbsp;state&nbsp;to&nbsp;nil.</span><br>
<span class="lineno"></span><span class="comment" id="2031320">//&nbsp;G&nbsp;pointer&nbsp;-&nbsp;the&nbsp;goroutine&nbsp;is&nbsp;blocked&nbsp;on&nbsp;the&nbsp;semaphore;</span><br>
<span class="lineno"></span><span class="comment" id="2031378">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;io&nbsp;notification&nbsp;or&nbsp;timeout/close&nbsp;changes&nbsp;the&nbsp;state&nbsp;to&nbsp;READY&nbsp;or&nbsp;nil&nbsp;respectively</span><br>
<span class="lineno"></span><span class="comment" id="2031473">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;unparks&nbsp;the&nbsp;goroutine.</span><br>
<span class="lineno">30</span><span class="comment" id="2031515">//&nbsp;nil&nbsp;-&nbsp;nothing&nbsp;of&nbsp;the&nbsp;above.</span><br>
<span class="lineno"></span><span class="keyword" id="2031546">const</span>&nbsp;<span class="op" id="2031552">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2031555">pdReady</span>&nbsp;<span class="builtintype" id="2031563">uintptr</span>&nbsp;<span class="op" id="2031571">=</span>&nbsp;<span class="num" id="2031573">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2031576">pdWait</span>&nbsp;&nbsp;<span class="builtintype" id="2031584">uintptr</span>&nbsp;<span class="op" id="2031592">=</span>&nbsp;<span class="num" id="2031594">2</span><br>
<span class="lineno"></span><span class="op" id="2031596">)</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="2031599">const</span>&nbsp;<span class="ident" id="2031605">pollBlockSize</span>&nbsp;<span class="op" id="2031619">=</span>&nbsp;<span class="num" id="2031621">4</span>&nbsp;<span class="op" id="2031623">*</span>&nbsp;<span class="num" id="2031625">1024</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2031631">//&nbsp;Network&nbsp;poller&nbsp;descriptor.</span><br>
<span class="lineno"></span><span class="keyword" id="2031661">type</span>&nbsp;<span class="ident" id="2031666">pollDesc</span>&nbsp;<span class="keyword" id="2031675">struct</span>&nbsp;<span class="op" id="2031682">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2031685">link</span>&nbsp;<span class="op" id="2031690">*</span><span class="ident" id="2031691"><a href="/runtime/netpoll.go.html#2031666">pollDesc</a></span>&nbsp;<span class="comment" id="2031700">//&nbsp;in&nbsp;pollcache,&nbsp;protected&nbsp;by&nbsp;pollcache.lock</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2031747">//&nbsp;The&nbsp;lock&nbsp;protects&nbsp;pollOpen,&nbsp;pollSetDeadline,&nbsp;pollUnblock&nbsp;and&nbsp;deadlineimpl&nbsp;operations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2031837">//&nbsp;This&nbsp;fully&nbsp;covers&nbsp;seq,&nbsp;rt&nbsp;and&nbsp;wt&nbsp;variables.&nbsp;fd&nbsp;is&nbsp;constant&nbsp;throughout&nbsp;the&nbsp;PollDesc&nbsp;lifetime.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2031934">//&nbsp;pollReset,&nbsp;pollWait,&nbsp;pollWaitCanceled&nbsp;and&nbsp;runtimeÂ·netpollready&nbsp;(IO&nbsp;readiness&nbsp;notification)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2032030">//&nbsp;proceed&nbsp;w/o&nbsp;taking&nbsp;the&nbsp;lock.&nbsp;So&nbsp;closing,&nbsp;rg,&nbsp;rd,&nbsp;wg&nbsp;and&nbsp;wd&nbsp;are&nbsp;manipulated</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2032109">//&nbsp;in&nbsp;a&nbsp;lock-free&nbsp;way&nbsp;by&nbsp;all&nbsp;operations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2032151">//&nbsp;NOTE(dvyukov):&nbsp;the&nbsp;following&nbsp;code&nbsp;uses&nbsp;uintptr&nbsp;to&nbsp;store&nbsp;*g&nbsp;(rg/wg),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2032223">//&nbsp;that&nbsp;will&nbsp;blow&nbsp;up&nbsp;when&nbsp;GC&nbsp;starts&nbsp;moving&nbsp;objects.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2032276">lock</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2032284"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2179310">mutex</a></span>&nbsp;<span class="comment" id="2032290">//&nbsp;protectes&nbsp;the&nbsp;following&nbsp;fields</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2032325">fd</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2032333">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2032342">closing</span>&nbsp;<span class="builtintype" id="2032350">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2032356">seq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2032364">uintptr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2032379">//&nbsp;protects&nbsp;from&nbsp;stale&nbsp;timers&nbsp;and&nbsp;ready&nbsp;notifications</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2032434">rg</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2032442">uintptr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2032457">//&nbsp;pdReady,&nbsp;pdWait,&nbsp;G&nbsp;waiting&nbsp;for&nbsp;read&nbsp;or&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2032504">rt</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2032512"><a href="/runtime/time.go.html#2150325">timer</a></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2032527">//&nbsp;read&nbsp;deadline&nbsp;timer&nbsp;(set&nbsp;if&nbsp;rt.f&nbsp;!=&nbsp;nil)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2032572">rd</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2032580">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2032595">//&nbsp;read&nbsp;deadline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2032613">wg</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2032621">uintptr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2032636">//&nbsp;pdReady,&nbsp;pdWait,&nbsp;G&nbsp;waiting&nbsp;for&nbsp;write&nbsp;or&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2032684">wt</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2032692"><a href="/runtime/time.go.html#2150325">timer</a></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2032707">//&nbsp;write&nbsp;deadline&nbsp;timer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2032732">wd</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2032740">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2032755">//&nbsp;write&nbsp;deadline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2032774">user</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2032782"><a href="/runtime/netpoll.go.html#2030244">unsafe</a></span><span class="op" id="2032788">.</span><span class="ident" id="2032789">Pointer</span>&nbsp;<span class="comment" id="2032797">//&nbsp;user&nbsp;settable&nbsp;cookie</span><br>
<span class="lineno">60</span><span class="op" id="2032821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2032824">type</span>&nbsp;<span class="ident" id="2032829">pollCache</span>&nbsp;<span class="keyword" id="2032839">struct</span>&nbsp;<span class="op" id="2032846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2032849">lock</span>&nbsp;&nbsp;<span class="ident" id="2032855"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2179310">mutex</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2032862">first</span>&nbsp;<span class="op" id="2032868">*</span><span class="ident" id="2032869"><a href="/runtime/netpoll.go.html#2031666">pollDesc</a></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2032879">//&nbsp;PollDesc&nbsp;objects&nbsp;must&nbsp;be&nbsp;type-stable,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2032921">//&nbsp;because&nbsp;we&nbsp;can&nbsp;get&nbsp;ready&nbsp;notification&nbsp;from&nbsp;epoll/kqueue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2032981">//&nbsp;after&nbsp;the&nbsp;descriptor&nbsp;is&nbsp;closed/reused.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2033024">//&nbsp;Stale&nbsp;notifications&nbsp;are&nbsp;detected&nbsp;using&nbsp;seq&nbsp;variable,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2033081">//&nbsp;seq&nbsp;is&nbsp;incremented&nbsp;when&nbsp;deadlines&nbsp;are&nbsp;changed&nbsp;or&nbsp;descriptor&nbsp;is&nbsp;reused.</span><br>
<span class="lineno">70</span><span class="op" id="2033155">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2033158">var</span>&nbsp;<span class="ident" id="2033162">pollcache</span>&nbsp;<span class="ident" id="2033172"><a href="/runtime/netpoll.go.html#2032829">pollCache</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2033183">func</span>&nbsp;<span class="ident" id="2033188">netpollServerInit</span><span class="op" id="2033205">(</span><span class="op" id="2033206">)</span>&nbsp;<span class="op" id="2033208">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2033211"><a href="/runtime/stubs.go.html#2134137">onM</a></span><span class="op" id="2033214">(</span><span class="ident" id="2033215"><a href="/runtime/netpoll_epoll.go.html#2042209">netpollinit</a></span><span class="op" id="2033226">)</span><br>
<span class="lineno"></span><span class="op" id="2033228">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2033231">func</span>&nbsp;<span class="ident" id="2033236">netpollOpen</span><span class="op" id="2033247">(</span><span class="ident" id="2033248">fd</span>&nbsp;<span class="builtintype" id="2033251">uintptr</span><span class="op" id="2033258">)</span>&nbsp;<span class="op" id="2033260">(</span><span class="op" id="2033261">*</span><span class="ident" id="2033262"><a href="/runtime/netpoll.go.html#2031666">pollDesc</a></span><span class="op" id="2033270">,</span>&nbsp;<span class="builtintype" id="2033272">int</span><span class="op" id="2033275">)</span>&nbsp;<span class="op" id="2033277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2033280">pd</span>&nbsp;<span class="op" id="2033283">:=</span>&nbsp;<span class="ident" id="2033286"><a href="/runtime/netpoll.go.html#2033162">pollcache</a></span><span class="op" id="2033295">.</span><span class="ident" id="2033296">alloc</span><span class="op" id="2033301">(</span><span class="op" id="2033302">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2033305"><a href="/runtime/lock_futex.go.html#1978439">lock</a></span><span class="op" id="2033309">(</span><span class="op" id="2033310">&amp;</span><span class="ident" id="2033311"><a href="/runtime/netpoll.go.html#2033280">pd</a></span><span class="op" id="2033313">.</span><span class="ident" id="2033314">lock</span><span class="op" id="2033318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2033321">if</span>&nbsp;<span class="ident" id="2033324"><a href="/runtime/netpoll.go.html#2033280">pd</a></span><span class="op" id="2033326">.</span><span class="ident" id="2033327">wg</span>&nbsp;<span class="op" id="2033330">!=</span>&nbsp;<span class="num" id="2033333">0</span>&nbsp;<span class="op" id="2033335">&amp;&amp;</span>&nbsp;<span class="ident" id="2033338"><a href="/runtime/netpoll.go.html#2033280">pd</a></span><span class="op" id="2033340">.</span><span class="ident" id="2033341">wg</span>&nbsp;<span class="op" id="2033344">!=</span>&nbsp;<span class="ident" id="2033347"><a href="/runtime/netpoll.go.html#2031555">pdReady</a></span>&nbsp;<span class="op" id="2033355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2033359"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="2033366">(</span><span class="string" id="2033367">&#34;netpollOpen:&nbsp;blocked&nbsp;write&nbsp;on&nbsp;free&nbsp;descriptor&#34;</span><span class="op" id="2033414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2033417">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2033420">if</span>&nbsp;<span class="ident" id="2033423"><a href="/runtime/netpoll.go.html#2033280">pd</a></span><span class="op" id="2033425">.</span><span class="ident" id="2033426">rg</span>&nbsp;<span class="op" id="2033429">!=</span>&nbsp;<span class="num" id="2033432">0</span>&nbsp;<span class="op" id="2033434">&amp;&amp;</span>&nbsp;<span class="ident" id="2033437"><a href="/runtime/netpoll.go.html#2033280">pd</a></span><span class="op" id="2033439">.</span><span class="ident" id="2033440">rg</span>&nbsp;<span class="op" id="2033443">!=</span>&nbsp;<span class="ident" id="2033446"><a href="/runtime/netpoll.go.html#2031555">pdReady</a></span>&nbsp;<span class="op" id="2033454">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2033458"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="2033465">(</span><span class="string" id="2033466">&#34;netpollOpen:&nbsp;blocked&nbsp;read&nbsp;on&nbsp;free&nbsp;descriptor&#34;</span><span class="op" id="2033512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2033515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2033518"><a href="/runtime/netpoll.go.html#2033280">pd</a></span><span class="op" id="2033520">.</span><span class="ident" id="2033521">fd</span>&nbsp;<span class="op" id="2033524">=</span>&nbsp;<span class="ident" id="2033526"><a href="/runtime/netpoll.go.html#2033248">fd</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2033530"><a href="/runtime/netpoll.go.html#2033280">pd</a></span><span class="op" id="2033532">.</span><span class="ident" id="2033533">closing</span>&nbsp;<span class="op" id="2033541">=</span>&nbsp;<span class="builtintype" id="2033543">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2033550"><a href="/runtime/netpoll.go.html#2033280">pd</a></span><span class="op" id="2033552">.</span><span class="ident" id="2033553">seq</span><span class="op" id="2033556">++</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2033560"><a href="/runtime/netpoll.go.html#2033280">pd</a></span><span class="op" id="2033562">.</span><span class="ident" id="2033563">rg</span>&nbsp;<span class="op" id="2033566">=</span>&nbsp;<span class="num" id="2033568">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2033571"><a href="/runtime/netpoll.go.html#2033280">pd</a></span><span class="op" id="2033573">.</span><span class="ident" id="2033574">rd</span>&nbsp;<span class="op" id="2033577">=</span>&nbsp;<span class="num" id="2033579">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2033582"><a href="/runtime/netpoll.go.html#2033280">pd</a></span><span class="op" id="2033584">.</span><span class="ident" id="2033585">wg</span>&nbsp;<span class="op" id="2033588">=</span>&nbsp;<span class="num" id="2033590">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2033593"><a href="/runtime/netpoll.go.html#2033280">pd</a></span><span class="op" id="2033595">.</span><span class="ident" id="2033596">wd</span>&nbsp;<span class="op" id="2033599">=</span>&nbsp;<span class="num" id="2033601">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2033604"><a href="/runtime/lock_futex.go.html#1979731">unlock</a></span><span class="op" id="2033610">(</span><span class="op" id="2033611">&amp;</span><span class="ident" id="2033612"><a href="/runtime/netpoll.go.html#2033280">pd</a></span><span class="op" id="2033614">.</span><span class="ident" id="2033615">lock</span><span class="op" id="2033619">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2033623">var</span>&nbsp;<span class="ident" id="2033627">errno</span>&nbsp;<span class="builtintype" id="2033633">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2033640"><a href="/runtime/stubs.go.html#2134137">onM</a></span><span class="op" id="2033643">(</span><span class="keyword" id="2033644">func</span><span class="op" id="2033648">(</span><span class="op" id="2033649">)</span>&nbsp;<span class="op" id="2033651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2033655"><a href="/runtime/netpoll.go.html#2033627">errno</a></span>&nbsp;<span class="op" id="2033661">=</span>&nbsp;<span class="ident" id="2033663"><a href="/runtime/netpoll_epoll.go.html#2042491">netpollopen</a></span><span class="op" id="2033674">(</span><span class="ident" id="2033675"><a href="/runtime/netpoll.go.html#2033248">fd</a></span><span class="op" id="2033677">,</span>&nbsp;<span class="ident" id="2033679"><a href="/runtime/netpoll.go.html#2033280">pd</a></span><span class="op" id="2033681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2033684">}</span><span class="op" id="2033685">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2033688">return</span>&nbsp;<span class="ident" id="2033695"><a href="/runtime/netpoll.go.html#2033280">pd</a></span><span class="op" id="2033697">,</span>&nbsp;<span class="builtintype" id="2033699">int</span><span class="op" id="2033702">(</span><span class="ident" id="2033703"><a href="/runtime/netpoll.go.html#2033627">errno</a></span><span class="op" id="2033708">)</span><br>
<span class="lineno"></span><span class="op" id="2033710">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2033713">func</span>&nbsp;<span class="ident" id="2033718">netpollClose</span><span class="op" id="2033730">(</span><span class="ident" id="2033731">pd</span>&nbsp;<span class="op" id="2033734">*</span><span class="ident" id="2033735"><a href="/runtime/netpoll.go.html#2031666">pollDesc</a></span><span class="op" id="2033743">)</span>&nbsp;<span class="op" id="2033745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2033748">if</span>&nbsp;<span class="op" id="2033751">!</span><span class="ident" id="2033752"><a href="/runtime/netpoll.go.html#2033731">pd</a></span><span class="op" id="2033754">.</span><span class="ident" id="2033755">closing</span>&nbsp;<span class="op" id="2033763">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2033767"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="2033774">(</span><span class="string" id="2033775">&#34;netpollClose:&nbsp;close&nbsp;w/o&nbsp;unblock&#34;</span><span class="op" id="2033808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2033811">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2033814">if</span>&nbsp;<span class="ident" id="2033817"><a href="/runtime/netpoll.go.html#2033731">pd</a></span><span class="op" id="2033819">.</span><span class="ident" id="2033820">wg</span>&nbsp;<span class="op" id="2033823">!=</span>&nbsp;<span class="num" id="2033826">0</span>&nbsp;<span class="op" id="2033828">&amp;&amp;</span>&nbsp;<span class="ident" id="2033831"><a href="/runtime/netpoll.go.html#2033731">pd</a></span><span class="op" id="2033833">.</span><span class="ident" id="2033834">wg</span>&nbsp;<span class="op" id="2033837">!=</span>&nbsp;<span class="ident" id="2033840"><a href="/runtime/netpoll.go.html#2031555">pdReady</a></span>&nbsp;<span class="op" id="2033848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2033852"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="2033859">(</span><span class="string" id="2033860">&#34;netpollClose:&nbsp;blocked&nbsp;write&nbsp;on&nbsp;closing&nbsp;descriptor&#34;</span><span class="op" id="2033911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2033914">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2033917">if</span>&nbsp;<span class="ident" id="2033920"><a href="/runtime/netpoll.go.html#2033731">pd</a></span><span class="op" id="2033922">.</span><span class="ident" id="2033923">rg</span>&nbsp;<span class="op" id="2033926">!=</span>&nbsp;<span class="num" id="2033929">0</span>&nbsp;<span class="op" id="2033931">&amp;&amp;</span>&nbsp;<span class="ident" id="2033934"><a href="/runtime/netpoll.go.html#2033731">pd</a></span><span class="op" id="2033936">.</span><span class="ident" id="2033937">rg</span>&nbsp;<span class="op" id="2033940">!=</span>&nbsp;<span class="ident" id="2033943"><a href="/runtime/netpoll.go.html#2031555">pdReady</a></span>&nbsp;<span class="op" id="2033951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2033955"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="2033962">(</span><span class="string" id="2033963">&#34;netpollClose:&nbsp;blocked&nbsp;read&nbsp;on&nbsp;closing&nbsp;descriptor&#34;</span><span class="op" id="2034013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2034016">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2034019"><a href="/runtime/stubs.go.html#2134137">onM</a></span><span class="op" id="2034022">(</span><span class="keyword" id="2034023">func</span><span class="op" id="2034027">(</span><span class="op" id="2034028">)</span>&nbsp;<span class="op" id="2034030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2034034"><a href="/runtime/netpoll_epoll.go.html#2042725">netpollclose</a></span><span class="op" id="2034046">(</span><span class="builtintype" id="2034047">uintptr</span><span class="op" id="2034054">(</span><span class="ident" id="2034055"><a href="/runtime/netpoll.go.html#2033731">pd</a></span><span class="op" id="2034057">.</span><span class="ident" id="2034058">fd</span><span class="op" id="2034060">)</span><span class="op" id="2034061">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2034064">}</span><span class="op" id="2034065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2034068"><a href="/runtime/netpoll.go.html#2033162">pollcache</a></span><span class="op" id="2034077">.</span><span class="ident" id="2034078">free</span><span class="op" id="2034082">(</span><span class="ident" id="2034083"><a href="/runtime/netpoll.go.html#2033731">pd</a></span><span class="op" id="2034085">)</span><br>
<span class="lineno"></span><span class="op" id="2034087">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2034090">func</span>&nbsp;<span class="op" id="2034095">(</span><span class="ident" id="2034096">c</span>&nbsp;<span class="op" id="2034098">*</span><span class="ident" id="2034099"><a href="/runtime/netpoll.go.html#2032829">pollCache</a></span><span class="op" id="2034108">)</span>&nbsp;<span class="ident" id="2034110">free</span><span class="op" id="2034114">(</span><span class="ident" id="2034115">pd</span>&nbsp;<span class="op" id="2034118">*</span><span class="ident" id="2034119"><a href="/runtime/netpoll.go.html#2031666">pollDesc</a></span><span class="op" id="2034127">)</span>&nbsp;<span class="op" id="2034129">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2034132"><a href="/runtime/lock_futex.go.html#1978439">lock</a></span><span class="op" id="2034136">(</span><span class="op" id="2034137">&amp;</span><span class="ident" id="2034138"><a href="/runtime/netpoll.go.html#2034096">c</a></span><span class="op" id="2034139">.</span><span class="ident" id="2034140">lock</span><span class="op" id="2034144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2034147"><a href="/runtime/netpoll.go.html#2034115">pd</a></span><span class="op" id="2034149">.</span><span class="ident" id="2034150">link</span>&nbsp;<span class="op" id="2034155">=</span>&nbsp;<span class="ident" id="2034157"><a href="/runtime/netpoll.go.html#2034096">c</a></span><span class="op" id="2034158">.</span><span class="ident" id="2034159">first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2034166"><a href="/runtime/netpoll.go.html#2034096">c</a></span><span class="op" id="2034167">.</span><span class="ident" id="2034168">first</span>&nbsp;<span class="op" id="2034174">=</span>&nbsp;<span class="ident" id="2034176"><a href="/runtime/netpoll.go.html#2034115">pd</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2034180"><a href="/runtime/lock_futex.go.html#1979731">unlock</a></span><span class="op" id="2034186">(</span><span class="op" id="2034187">&amp;</span><span class="ident" id="2034188"><a href="/runtime/netpoll.go.html#2034096">c</a></span><span class="op" id="2034189">.</span><span class="ident" id="2034190">lock</span><span class="op" id="2034194">)</span><br>
<span class="lineno"></span><span class="op" id="2034196">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="2034199">func</span>&nbsp;<span class="ident" id="2034204">netpollReset</span><span class="op" id="2034216">(</span><span class="ident" id="2034217">pd</span>&nbsp;<span class="op" id="2034220">*</span><span class="ident" id="2034221"><a href="/runtime/netpoll.go.html#2031666">pollDesc</a></span><span class="op" id="2034229">,</span>&nbsp;<span class="ident" id="2034231">mode</span>&nbsp;<span class="builtintype" id="2034236">int</span><span class="op" id="2034239">)</span>&nbsp;<span class="builtintype" id="2034241">int</span>&nbsp;<span class="op" id="2034245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2034248">err</span>&nbsp;<span class="op" id="2034252">:=</span>&nbsp;<span class="ident" id="2034255"><a href="/runtime/netpoll.go.html#2037972">netpollcheckerr</a></span><span class="op" id="2034270">(</span><span class="ident" id="2034271"><a href="/runtime/netpoll.go.html#2034217">pd</a></span><span class="op" id="2034273">,</span>&nbsp;<span class="builtintype" id="2034275">int32</span><span class="op" id="2034280">(</span><span class="ident" id="2034281"><a href="/runtime/netpoll.go.html#2034231">mode</a></span><span class="op" id="2034285">)</span><span class="op" id="2034286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2034289">if</span>&nbsp;<span class="ident" id="2034292"><a href="/runtime/netpoll.go.html#2034248">err</a></span>&nbsp;<span class="op" id="2034296">!=</span>&nbsp;<span class="num" id="2034299">0</span>&nbsp;<span class="op" id="2034301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2034305">return</span>&nbsp;<span class="ident" id="2034312"><a href="/runtime/netpoll.go.html#2034248">err</a></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2034317">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2034320">if</span>&nbsp;<span class="ident" id="2034323"><a href="/runtime/netpoll.go.html#2034231">mode</a></span>&nbsp;<span class="op" id="2034328">==</span>&nbsp;<span class="string" id="2034331">&#39;r&#39;</span>&nbsp;<span class="op" id="2034335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2034339"><a href="/runtime/netpoll.go.html#2034217">pd</a></span><span class="op" id="2034341">.</span><span class="ident" id="2034342">rg</span>&nbsp;<span class="op" id="2034345">=</span>&nbsp;<span class="num" id="2034347">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2034350">}</span>&nbsp;<span class="keyword" id="2034352">else</span>&nbsp;<span class="keyword" id="2034357">if</span>&nbsp;<span class="ident" id="2034360"><a href="/runtime/netpoll.go.html#2034231">mode</a></span>&nbsp;<span class="op" id="2034365">==</span>&nbsp;<span class="string" id="2034368">&#39;w&#39;</span>&nbsp;<span class="op" id="2034372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2034376"><a href="/runtime/netpoll.go.html#2034217">pd</a></span><span class="op" id="2034378">.</span><span class="ident" id="2034379">wg</span>&nbsp;<span class="op" id="2034382">=</span>&nbsp;<span class="num" id="2034384">0</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2034387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2034390">return</span>&nbsp;<span class="num" id="2034397">0</span><br>
<span class="lineno"></span><span class="op" id="2034399">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2034402">func</span>&nbsp;<span class="ident" id="2034407">netpollWait</span><span class="op" id="2034418">(</span><span class="ident" id="2034419">pd</span>&nbsp;<span class="op" id="2034422">*</span><span class="ident" id="2034423"><a href="/runtime/netpoll.go.html#2031666">pollDesc</a></span><span class="op" id="2034431">,</span>&nbsp;<span class="ident" id="2034433">mode</span>&nbsp;<span class="builtintype" id="2034438">int</span><span class="op" id="2034441">)</span>&nbsp;<span class="builtintype" id="2034443">int</span>&nbsp;<span class="op" id="2034447">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2034450">err</span>&nbsp;<span class="op" id="2034454">:=</span>&nbsp;<span class="ident" id="2034457"><a href="/runtime/netpoll.go.html#2037972">netpollcheckerr</a></span><span class="op" id="2034472">(</span><span class="ident" id="2034473"><a href="/runtime/netpoll.go.html#2034419">pd</a></span><span class="op" id="2034475">,</span>&nbsp;<span class="builtintype" id="2034477">int32</span><span class="op" id="2034482">(</span><span class="ident" id="2034483"><a href="/runtime/netpoll.go.html#2034433">mode</a></span><span class="op" id="2034487">)</span><span class="op" id="2034488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2034491">if</span>&nbsp;<span class="ident" id="2034494"><a href="/runtime/netpoll.go.html#2034450">err</a></span>&nbsp;<span class="op" id="2034498">!=</span>&nbsp;<span class="num" id="2034501">0</span>&nbsp;<span class="op" id="2034503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2034507">return</span>&nbsp;<span class="ident" id="2034514"><a href="/runtime/netpoll.go.html#2034450">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2034519">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2034522">//&nbsp;As&nbsp;for&nbsp;now&nbsp;only&nbsp;Solaris&nbsp;uses&nbsp;level-triggered&nbsp;IO.</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2034575">if</span>&nbsp;<span class="ident" id="2034578"><a href="/runtime/extern.go.html#1926775">GOOS</a></span>&nbsp;<span class="op" id="2034583">==</span>&nbsp;<span class="string" id="2034586">&#34;solaris&#34;</span>&nbsp;<span class="op" id="2034596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2034600"><a href="/runtime/stubs.go.html#2134137">onM</a></span><span class="op" id="2034603">(</span><span class="keyword" id="2034604">func</span><span class="op" id="2034608">(</span><span class="op" id="2034609">)</span>&nbsp;<span class="op" id="2034611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2034616"><a href="/runtime/netpoll_epoll.go.html#2042841">netpollarm</a></span><span class="op" id="2034626">(</span><span class="ident" id="2034627"><a href="/runtime/netpoll.go.html#2034419">pd</a></span><span class="op" id="2034629">,</span>&nbsp;<span class="ident" id="2034631"><a href="/runtime/netpoll.go.html#2034433">mode</a></span><span class="op" id="2034635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2034639">}</span><span class="op" id="2034640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2034643">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2034646">for</span>&nbsp;<span class="op" id="2034650">!</span><span class="ident" id="2034651"><a href="/runtime/netpoll.go.html#2038425">netpollblock</a></span><span class="op" id="2034663">(</span><span class="ident" id="2034664"><a href="/runtime/netpoll.go.html#2034419">pd</a></span><span class="op" id="2034666">,</span>&nbsp;<span class="builtintype" id="2034668">int32</span><span class="op" id="2034673">(</span><span class="ident" id="2034674"><a href="/runtime/netpoll.go.html#2034433">mode</a></span><span class="op" id="2034678">)</span><span class="op" id="2034679">,</span>&nbsp;<span class="builtintype" id="2034681">false</span><span class="op" id="2034686">)</span>&nbsp;<span class="op" id="2034688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2034692"><a href="/runtime/netpoll.go.html#2034450">err</a></span>&nbsp;<span class="op" id="2034696">=</span>&nbsp;<span class="ident" id="2034698"><a href="/runtime/netpoll.go.html#2037972">netpollcheckerr</a></span><span class="op" id="2034713">(</span><span class="ident" id="2034714"><a href="/runtime/netpoll.go.html#2034419">pd</a></span><span class="op" id="2034716">,</span>&nbsp;<span class="builtintype" id="2034718">int32</span><span class="op" id="2034723">(</span><span class="ident" id="2034724"><a href="/runtime/netpoll.go.html#2034433">mode</a></span><span class="op" id="2034728">)</span><span class="op" id="2034729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2034733">if</span>&nbsp;<span class="ident" id="2034736"><a href="/runtime/netpoll.go.html#2034450">err</a></span>&nbsp;<span class="op" id="2034740">!=</span>&nbsp;<span class="num" id="2034743">0</span>&nbsp;<span class="op" id="2034745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2034750">return</span>&nbsp;<span class="ident" id="2034757"><a href="/runtime/netpoll.go.html#2034450">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2034763">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2034767">//&nbsp;Can&nbsp;happen&nbsp;if&nbsp;timeout&nbsp;has&nbsp;fired&nbsp;and&nbsp;unblocked&nbsp;us,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2034822">//&nbsp;but&nbsp;before&nbsp;we&nbsp;had&nbsp;a&nbsp;chance&nbsp;to&nbsp;run,&nbsp;timeout&nbsp;has&nbsp;been&nbsp;reset.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2034886">//&nbsp;Pretend&nbsp;it&nbsp;has&nbsp;not&nbsp;happened&nbsp;and&nbsp;retry.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2034929">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2034932">return</span>&nbsp;<span class="num" id="2034939">0</span><br>
<span class="lineno">160</span><span class="op" id="2034941">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2034944">func</span>&nbsp;<span class="ident" id="2034949">netpollWaitCanceled</span><span class="op" id="2034968">(</span><span class="ident" id="2034969">pd</span>&nbsp;<span class="op" id="2034972">*</span><span class="ident" id="2034973"><a href="/runtime/netpoll.go.html#2031666">pollDesc</a></span><span class="op" id="2034981">,</span>&nbsp;<span class="ident" id="2034983">mode</span>&nbsp;<span class="builtintype" id="2034988">int</span><span class="op" id="2034991">)</span>&nbsp;<span class="op" id="2034993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2034996">//&nbsp;This&nbsp;function&nbsp;is&nbsp;used&nbsp;only&nbsp;on&nbsp;windows&nbsp;after&nbsp;a&nbsp;failed&nbsp;attempt&nbsp;to&nbsp;cancel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2035071">//&nbsp;a&nbsp;pending&nbsp;async&nbsp;IO&nbsp;operation.&nbsp;Wait&nbsp;for&nbsp;ioready,&nbsp;ignore&nbsp;closing&nbsp;or&nbsp;timeouts.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2035151">for</span>&nbsp;<span class="op" id="2035155">!</span><span class="ident" id="2035156"><a href="/runtime/netpoll.go.html#2038425">netpollblock</a></span><span class="op" id="2035168">(</span><span class="ident" id="2035169"><a href="/runtime/netpoll.go.html#2034969">pd</a></span><span class="op" id="2035171">,</span>&nbsp;<span class="builtintype" id="2035173">int32</span><span class="op" id="2035178">(</span><span class="ident" id="2035179"><a href="/runtime/netpoll.go.html#2034983">mode</a></span><span class="op" id="2035183">)</span><span class="op" id="2035184">,</span>&nbsp;<span class="builtintype" id="2035186">true</span><span class="op" id="2035190">)</span>&nbsp;<span class="op" id="2035192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2035195">}</span><br>
<span class="lineno"></span><span class="op" id="2035197">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2035200">func</span>&nbsp;<span class="ident" id="2035205">netpollSetDeadline</span><span class="op" id="2035223">(</span><span class="ident" id="2035224">pd</span>&nbsp;<span class="op" id="2035227">*</span><span class="ident" id="2035228"><a href="/runtime/netpoll.go.html#2031666">pollDesc</a></span><span class="op" id="2035236">,</span>&nbsp;<span class="ident" id="2035238">d</span>&nbsp;<span class="ident" id="2035240">int64</span><span class="op" id="2035245">,</span>&nbsp;<span class="ident" id="2035247">mode</span>&nbsp;<span class="builtintype" id="2035252">int</span><span class="op" id="2035255">)</span>&nbsp;<span class="op" id="2035257">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2035260"><a href="/runtime/lock_futex.go.html#1978439">lock</a></span><span class="op" id="2035264">(</span><span class="op" id="2035265">&amp;</span><span class="ident" id="2035266"><a href="/runtime/netpoll.go.html#2035224">pd</a></span><span class="op" id="2035268">.</span><span class="ident" id="2035269">lock</span><span class="op" id="2035273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2035276">if</span>&nbsp;<span class="ident" id="2035279"><a href="/runtime/netpoll.go.html#2035224">pd</a></span><span class="op" id="2035281">.</span><span class="ident" id="2035282">closing</span>&nbsp;<span class="op" id="2035290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2035294"><a href="/runtime/lock_futex.go.html#1979731">unlock</a></span><span class="op" id="2035300">(</span><span class="op" id="2035301">&amp;</span><span class="ident" id="2035302"><a href="/runtime/netpoll.go.html#2035224">pd</a></span><span class="op" id="2035304">.</span><span class="ident" id="2035305">lock</span><span class="op" id="2035309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2035313">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2035321">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2035324"><a href="/runtime/netpoll.go.html#2035224">pd</a></span><span class="op" id="2035326">.</span><span class="ident" id="2035327">seq</span><span class="op" id="2035330">++</span>&nbsp;<span class="comment" id="2035333">//&nbsp;invalidate&nbsp;current&nbsp;timers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2035363">//&nbsp;Reset&nbsp;current&nbsp;timers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2035389">if</span>&nbsp;<span class="ident" id="2035392"><a href="/runtime/netpoll.go.html#2035224">pd</a></span><span class="op" id="2035394">.</span><span class="ident" id="2035395">rt</span><span class="op" id="2035397">.</span><span class="ident" id="2035398">f</span>&nbsp;<span class="op" id="2035400">!=</span>&nbsp;<span class="ident" id="2035403">nil</span>&nbsp;<span class="op" id="2035407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2035411"><a href="/runtime/time.go.html#2152666">deltimer</a></span><span class="op" id="2035419">(</span><span class="op" id="2035420">&amp;</span><span class="ident" id="2035421"><a href="/runtime/netpoll.go.html#2035224">pd</a></span><span class="op" id="2035423">.</span><span class="ident" id="2035424">rt</span><span class="op" id="2035426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2035430"><a href="/runtime/netpoll.go.html#2035224">pd</a></span><span class="op" id="2035432">.</span><span class="ident" id="2035433">rt</span><span class="op" id="2035435">.</span><span class="ident" id="2035436">f</span>&nbsp;<span class="op" id="2035438">=</span>&nbsp;<span class="ident" id="2035440">nil</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2035445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2035448">if</span>&nbsp;<span class="ident" id="2035451"><a href="/runtime/netpoll.go.html#2035224">pd</a></span><span class="op" id="2035453">.</span><span class="ident" id="2035454">wt</span><span class="op" id="2035456">.</span><span class="ident" id="2035457">f</span>&nbsp;<span class="op" id="2035459">!=</span>&nbsp;<span class="ident" id="2035462">nil</span>&nbsp;<span class="op" id="2035466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2035470"><a href="/runtime/time.go.html#2152666">deltimer</a></span><span class="op" id="2035478">(</span><span class="op" id="2035479">&amp;</span><span class="ident" id="2035480"><a href="/runtime/netpoll.go.html#2035224">pd</a></span><span class="op" id="2035482">.</span><span class="ident" id="2035483">wt</span><span class="op" id="2035485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2035489"><a href="/runtime/netpoll.go.html#2035224">pd</a></span><span class="op" id="2035491">.</span><span class="ident" id="2035492">wt</span><span class="op" id="2035494">.</span><span class="ident" id="2035495">f</span>&nbsp;<span class="op" id="2035497">=</span>&nbsp;<span class="ident" id="2035499">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2035504">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2035507">//&nbsp;Setup&nbsp;new&nbsp;timers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2035529">if</span>&nbsp;<span class="ident" id="2035532"><a href="/runtime/netpoll.go.html#2035238">d</a></span>&nbsp;<span class="op" id="2035534">!=</span>&nbsp;<span class="num" id="2035537">0</span>&nbsp;<span class="op" id="2035539">&amp;&amp;</span>&nbsp;<span class="ident" id="2035542"><a href="/runtime/netpoll.go.html#2035238">d</a></span>&nbsp;<span class="op" id="2035544">&lt;=</span>&nbsp;<span class="ident" id="2035547"><a href="/runtime/stubs.go.html#2137038">nanotime</a></span><span class="op" id="2035555">(</span><span class="op" id="2035556">)</span>&nbsp;<span class="op" id="2035558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2035562"><a href="/runtime/netpoll.go.html#2035238">d</a></span>&nbsp;<span class="op" id="2035564">=</span>&nbsp;<span class="op" id="2035566">-</span><span class="num" id="2035567">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2035570">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2035573">if</span>&nbsp;<span class="ident" id="2035576"><a href="/runtime/netpoll.go.html#2035247">mode</a></span>&nbsp;<span class="op" id="2035581">==</span>&nbsp;<span class="string" id="2035584">&#39;r&#39;</span>&nbsp;<span class="op" id="2035588">||</span>&nbsp;<span class="ident" id="2035591"><a href="/runtime/netpoll.go.html#2035247">mode</a></span>&nbsp;<span class="op" id="2035596">==</span>&nbsp;<span class="string" id="2035599">&#39;r&#39;</span><span class="op" id="2035602">+</span><span class="string" id="2035603">&#39;w&#39;</span>&nbsp;<span class="op" id="2035607">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2035611"><a href="/runtime/netpoll.go.html#2035224">pd</a></span><span class="op" id="2035613">.</span><span class="ident" id="2035614">rd</span>&nbsp;<span class="op" id="2035617">=</span>&nbsp;<span class="ident" id="2035619"><a href="/runtime/netpoll.go.html#2035238">d</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2035622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2035625">if</span>&nbsp;<span class="ident" id="2035628"><a href="/runtime/netpoll.go.html#2035247">mode</a></span>&nbsp;<span class="op" id="2035633">==</span>&nbsp;<span class="string" id="2035636">&#39;w&#39;</span>&nbsp;<span class="op" id="2035640">||</span>&nbsp;<span class="ident" id="2035643"><a href="/runtime/netpoll.go.html#2035247">mode</a></span>&nbsp;<span class="op" id="2035648">==</span>&nbsp;<span class="string" id="2035651">&#39;r&#39;</span><span class="op" id="2035654">+</span><span class="string" id="2035655">&#39;w&#39;</span>&nbsp;<span class="op" id="2035659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2035663"><a href="/runtime/netpoll.go.html#2035224">pd</a></span><span class="op" id="2035665">.</span><span class="ident" id="2035666">wd</span>&nbsp;<span class="op" id="2035669">=</span>&nbsp;<span class="ident" id="2035671"><a href="/runtime/netpoll.go.html#2035238">d</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2035674">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2035677">if</span>&nbsp;<span class="ident" id="2035680"><a href="/runtime/netpoll.go.html#2035224">pd</a></span><span class="op" id="2035682">.</span><span class="ident" id="2035683">rd</span>&nbsp;<span class="op" id="2035686">&gt;</span>&nbsp;<span class="num" id="2035688">0</span>&nbsp;<span class="op" id="2035690">&amp;&amp;</span>&nbsp;<span class="ident" id="2035693"><a href="/runtime/netpoll.go.html#2035224">pd</a></span><span class="op" id="2035695">.</span><span class="ident" id="2035696">rd</span>&nbsp;<span class="op" id="2035699">==</span>&nbsp;<span class="ident" id="2035702"><a href="/runtime/netpoll.go.html#2035224">pd</a></span><span class="op" id="2035704">.</span><span class="ident" id="2035705">wd</span>&nbsp;<span class="op" id="2035708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2035712"><a href="/runtime/netpoll.go.html#2035224">pd</a></span><span class="op" id="2035714">.</span><span class="ident" id="2035715">rt</span><span class="op" id="2035717">.</span><span class="ident" id="2035718">f</span>&nbsp;<span class="op" id="2035720">=</span>&nbsp;<span class="ident" id="2035722"><a href="/runtime/netpoll.go.html#2040805">netpollDeadline</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2035740"><a href="/runtime/netpoll.go.html#2035224">pd</a></span><span class="op" id="2035742">.</span><span class="ident" id="2035743">rt</span><span class="op" id="2035745">.</span><span class="ident" id="2035746">when</span>&nbsp;<span class="op" id="2035751">=</span>&nbsp;<span class="ident" id="2035753"><a href="/runtime/netpoll.go.html#2035224">pd</a></span><span class="op" id="2035755">.</span><span class="ident" id="2035756">rd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2035761">//&nbsp;Copy&nbsp;current&nbsp;seq&nbsp;into&nbsp;the&nbsp;timer&nbsp;arg.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2035803">//&nbsp;Timer&nbsp;func&nbsp;will&nbsp;check&nbsp;the&nbsp;seq&nbsp;against&nbsp;current&nbsp;descriptor&nbsp;seq,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2035870">//&nbsp;if&nbsp;they&nbsp;differ&nbsp;the&nbsp;descriptor&nbsp;was&nbsp;reused&nbsp;or&nbsp;timers&nbsp;were&nbsp;reset.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2035938"><a href="/runtime/netpoll.go.html#2035224">pd</a></span><span class="op" id="2035940">.</span><span class="ident" id="2035941">rt</span><span class="op" id="2035943">.</span><span class="ident" id="2035944">arg</span>&nbsp;<span class="op" id="2035948">=</span>&nbsp;<span class="ident" id="2035950"><a href="/runtime/netpoll.go.html#2035224">pd</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2035955"><a href="/runtime/netpoll.go.html#2035224">pd</a></span><span class="op" id="2035957">.</span><span class="ident" id="2035958">rt</span><span class="op" id="2035960">.</span><span class="ident" id="2035961">seq</span>&nbsp;<span class="op" id="2035965">=</span>&nbsp;<span class="ident" id="2035967"><a href="/runtime/netpoll.go.html#2035224">pd</a></span><span class="op" id="2035969">.</span><span class="ident" id="2035970">seq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2035976"><a href="/runtime/time.go.html#2151740">addtimer</a></span><span class="op" id="2035984">(</span><span class="op" id="2035985">&amp;</span><span class="ident" id="2035986"><a href="/runtime/netpoll.go.html#2035224">pd</a></span><span class="op" id="2035988">.</span><span class="ident" id="2035989">rt</span><span class="op" id="2035991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2035994">}</span>&nbsp;<span class="keyword" id="2035996">else</span>&nbsp;<span class="op" id="2036001">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2036005">if</span>&nbsp;<span class="ident" id="2036008"><a href="/runtime/netpoll.go.html#2035224">pd</a></span><span class="op" id="2036010">.</span><span class="ident" id="2036011">rd</span>&nbsp;<span class="op" id="2036014">&gt;</span>&nbsp;<span class="num" id="2036016">0</span>&nbsp;<span class="op" id="2036018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2036023"><a href="/runtime/netpoll.go.html#2035224">pd</a></span><span class="op" id="2036025">.</span><span class="ident" id="2036026">rt</span><span class="op" id="2036028">.</span><span class="ident" id="2036029">f</span>&nbsp;<span class="op" id="2036031">=</span>&nbsp;<span class="ident" id="2036033"><a href="/runtime/netpoll.go.html#2040916">netpollReadDeadline</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2036056"><a href="/runtime/netpoll.go.html#2035224">pd</a></span><span class="op" id="2036058">.</span><span class="ident" id="2036059">rt</span><span class="op" id="2036061">.</span><span class="ident" id="2036062">when</span>&nbsp;<span class="op" id="2036067">=</span>&nbsp;<span class="ident" id="2036069"><a href="/runtime/netpoll.go.html#2035224">pd</a></span><span class="op" id="2036071">.</span><span class="ident" id="2036072">rd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2036078"><a href="/runtime/netpoll.go.html#2035224">pd</a></span><span class="op" id="2036080">.</span><span class="ident" id="2036081">rt</span><span class="op" id="2036083">.</span><span class="ident" id="2036084">arg</span>&nbsp;<span class="op" id="2036088">=</span>&nbsp;<span class="ident" id="2036090"><a href="/runtime/netpoll.go.html#2035224">pd</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2036096"><a href="/runtime/netpoll.go.html#2035224">pd</a></span><span class="op" id="2036098">.</span><span class="ident" id="2036099">rt</span><span class="op" id="2036101">.</span><span class="ident" id="2036102">seq</span>&nbsp;<span class="op" id="2036106">=</span>&nbsp;<span class="ident" id="2036108"><a href="/runtime/netpoll.go.html#2035224">pd</a></span><span class="op" id="2036110">.</span><span class="ident" id="2036111">seq</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2036118"><a href="/runtime/time.go.html#2151740">addtimer</a></span><span class="op" id="2036126">(</span><span class="op" id="2036127">&amp;</span><span class="ident" id="2036128"><a href="/runtime/netpoll.go.html#2035224">pd</a></span><span class="op" id="2036130">.</span><span class="ident" id="2036131">rt</span><span class="op" id="2036133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2036137">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2036141">if</span>&nbsp;<span class="ident" id="2036144"><a href="/runtime/netpoll.go.html#2035224">pd</a></span><span class="op" id="2036146">.</span><span class="ident" id="2036147">wd</span>&nbsp;<span class="op" id="2036150">&gt;</span>&nbsp;<span class="num" id="2036152">0</span>&nbsp;<span class="op" id="2036154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2036159"><a href="/runtime/netpoll.go.html#2035224">pd</a></span><span class="op" id="2036161">.</span><span class="ident" id="2036162">wt</span><span class="op" id="2036164">.</span><span class="ident" id="2036165">f</span>&nbsp;<span class="op" id="2036167">=</span>&nbsp;<span class="ident" id="2036169"><a href="/runtime/netpoll.go.html#2041032">netpollWriteDeadline</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2036193"><a href="/runtime/netpoll.go.html#2035224">pd</a></span><span class="op" id="2036195">.</span><span class="ident" id="2036196">wt</span><span class="op" id="2036198">.</span><span class="ident" id="2036199">when</span>&nbsp;<span class="op" id="2036204">=</span>&nbsp;<span class="ident" id="2036206"><a href="/runtime/netpoll.go.html#2035224">pd</a></span><span class="op" id="2036208">.</span><span class="ident" id="2036209">wd</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2036215"><a href="/runtime/netpoll.go.html#2035224">pd</a></span><span class="op" id="2036217">.</span><span class="ident" id="2036218">wt</span><span class="op" id="2036220">.</span><span class="ident" id="2036221">arg</span>&nbsp;<span class="op" id="2036225">=</span>&nbsp;<span class="ident" id="2036227"><a href="/runtime/netpoll.go.html#2035224">pd</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2036233"><a href="/runtime/netpoll.go.html#2035224">pd</a></span><span class="op" id="2036235">.</span><span class="ident" id="2036236">wt</span><span class="op" id="2036238">.</span><span class="ident" id="2036239">seq</span>&nbsp;<span class="op" id="2036243">=</span>&nbsp;<span class="ident" id="2036245"><a href="/runtime/netpoll.go.html#2035224">pd</a></span><span class="op" id="2036247">.</span><span class="ident" id="2036248">seq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2036255"><a href="/runtime/time.go.html#2151740">addtimer</a></span><span class="op" id="2036263">(</span><span class="op" id="2036264">&amp;</span><span class="ident" id="2036265"><a href="/runtime/netpoll.go.html#2035224">pd</a></span><span class="op" id="2036267">.</span><span class="ident" id="2036268">wt</span><span class="op" id="2036270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2036274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2036277">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2036280">//&nbsp;If&nbsp;we&nbsp;set&nbsp;the&nbsp;new&nbsp;deadline&nbsp;in&nbsp;the&nbsp;past,&nbsp;unblock&nbsp;currently&nbsp;pending&nbsp;IO&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2036361">var</span>&nbsp;<span class="ident" id="2036365">rg</span><span class="op" id="2036367">,</span>&nbsp;<span class="ident" id="2036369">wg</span>&nbsp;<span class="op" id="2036372">*</span><span class="ident" id="2036373"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2180373">g</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2036376"><a href="/runtime/atomic.go.html#1874833">atomicstorep</a></span><span class="op" id="2036388">(</span><span class="ident" id="2036389"><a href="/runtime/netpoll.go.html#2030244">unsafe</a></span><span class="op" id="2036395">.</span><span class="ident" id="2036396">Pointer</span><span class="op" id="2036403">(</span><span class="op" id="2036404">&amp;</span><span class="ident" id="2036405"><a href="/runtime/netpoll.go.html#2036369">wg</a></span><span class="op" id="2036407">)</span><span class="op" id="2036408">,</span>&nbsp;<span class="ident" id="2036410">nil</span><span class="op" id="2036413">)</span>&nbsp;<span class="comment" id="2036415">//&nbsp;full&nbsp;memory&nbsp;barrier&nbsp;between&nbsp;stores&nbsp;to&nbsp;rd/wd&nbsp;and&nbsp;load&nbsp;of&nbsp;rg/wg&nbsp;in&nbsp;netpollunblock</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2036499">if</span>&nbsp;<span class="ident" id="2036502"><a href="/runtime/netpoll.go.html#2035224">pd</a></span><span class="op" id="2036504">.</span><span class="ident" id="2036505">rd</span>&nbsp;<span class="op" id="2036508">&lt;</span>&nbsp;<span class="num" id="2036510">0</span>&nbsp;<span class="op" id="2036512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2036516"><a href="/runtime/netpoll.go.html#2036365">rg</a></span>&nbsp;<span class="op" id="2036519">=</span>&nbsp;<span class="ident" id="2036521"><a href="/runtime/netpoll.go.html#2039312">netpollunblock</a></span><span class="op" id="2036535">(</span><span class="ident" id="2036536"><a href="/runtime/netpoll.go.html#2035224">pd</a></span><span class="op" id="2036538">,</span>&nbsp;<span class="string" id="2036540">&#39;r&#39;</span><span class="op" id="2036543">,</span>&nbsp;<span class="builtintype" id="2036545">false</span><span class="op" id="2036550">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2036553">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2036556">if</span>&nbsp;<span class="ident" id="2036559"><a href="/runtime/netpoll.go.html#2035224">pd</a></span><span class="op" id="2036561">.</span><span class="ident" id="2036562">wd</span>&nbsp;<span class="op" id="2036565">&lt;</span>&nbsp;<span class="num" id="2036567">0</span>&nbsp;<span class="op" id="2036569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2036573"><a href="/runtime/netpoll.go.html#2036369">wg</a></span>&nbsp;<span class="op" id="2036576">=</span>&nbsp;<span class="ident" id="2036578"><a href="/runtime/netpoll.go.html#2039312">netpollunblock</a></span><span class="op" id="2036592">(</span><span class="ident" id="2036593"><a href="/runtime/netpoll.go.html#2035224">pd</a></span><span class="op" id="2036595">,</span>&nbsp;<span class="string" id="2036597">&#39;w&#39;</span><span class="op" id="2036600">,</span>&nbsp;<span class="builtintype" id="2036602">false</span><span class="op" id="2036607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2036610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2036613"><a href="/runtime/lock_futex.go.html#1979731">unlock</a></span><span class="op" id="2036619">(</span><span class="op" id="2036620">&amp;</span><span class="ident" id="2036621"><a href="/runtime/netpoll.go.html#2035224">pd</a></span><span class="op" id="2036623">.</span><span class="ident" id="2036624">lock</span><span class="op" id="2036628">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2036631">if</span>&nbsp;<span class="ident" id="2036634"><a href="/runtime/netpoll.go.html#2036365">rg</a></span>&nbsp;<span class="op" id="2036637">!=</span>&nbsp;<span class="ident" id="2036640">nil</span>&nbsp;<span class="op" id="2036644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2036648"><a href="/runtime/proc.go.html#2067021">goready</a></span><span class="op" id="2036655">(</span><span class="ident" id="2036656"><a href="/runtime/netpoll.go.html#2036365">rg</a></span><span class="op" id="2036658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2036661">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2036664">if</span>&nbsp;<span class="ident" id="2036667"><a href="/runtime/netpoll.go.html#2036369">wg</a></span>&nbsp;<span class="op" id="2036670">!=</span>&nbsp;<span class="ident" id="2036673">nil</span>&nbsp;<span class="op" id="2036677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2036681"><a href="/runtime/proc.go.html#2067021">goready</a></span><span class="op" id="2036688">(</span><span class="ident" id="2036689"><a href="/runtime/netpoll.go.html#2036369">wg</a></span><span class="op" id="2036691">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2036694">}</span><br>
<span class="lineno"></span><span class="op" id="2036696">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2036699">func</span>&nbsp;<span class="ident" id="2036704">netpollUnblock</span><span class="op" id="2036718">(</span><span class="ident" id="2036719">pd</span>&nbsp;<span class="op" id="2036722">*</span><span class="ident" id="2036723"><a href="/runtime/netpoll.go.html#2031666">pollDesc</a></span><span class="op" id="2036731">)</span>&nbsp;<span class="op" id="2036733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2036736"><a href="/runtime/lock_futex.go.html#1978439">lock</a></span><span class="op" id="2036740">(</span><span class="op" id="2036741">&amp;</span><span class="ident" id="2036742"><a href="/runtime/netpoll.go.html#2036719">pd</a></span><span class="op" id="2036744">.</span><span class="ident" id="2036745">lock</span><span class="op" id="2036749">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2036752">if</span>&nbsp;<span class="ident" id="2036755"><a href="/runtime/netpoll.go.html#2036719">pd</a></span><span class="op" id="2036757">.</span><span class="ident" id="2036758">closing</span>&nbsp;<span class="op" id="2036766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2036770"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="2036777">(</span><span class="string" id="2036778">&#34;netpollUnblock:&nbsp;already&nbsp;closing&#34;</span><span class="op" id="2036811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2036814">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2036817"><a href="/runtime/netpoll.go.html#2036719">pd</a></span><span class="op" id="2036819">.</span><span class="ident" id="2036820">closing</span>&nbsp;<span class="op" id="2036828">=</span>&nbsp;<span class="builtintype" id="2036830">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2036836"><a href="/runtime/netpoll.go.html#2036719">pd</a></span><span class="op" id="2036838">.</span><span class="ident" id="2036839">seq</span><span class="op" id="2036842">++</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2036846">var</span>&nbsp;<span class="ident" id="2036850">rg</span><span class="op" id="2036852">,</span>&nbsp;<span class="ident" id="2036854">wg</span>&nbsp;<span class="op" id="2036857">*</span><span class="ident" id="2036858"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2180373">g</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2036861"><a href="/runtime/atomic.go.html#1874833">atomicstorep</a></span><span class="op" id="2036873">(</span><span class="ident" id="2036874"><a href="/runtime/netpoll.go.html#2030244">unsafe</a></span><span class="op" id="2036880">.</span><span class="ident" id="2036881">Pointer</span><span class="op" id="2036888">(</span><span class="op" id="2036889">&amp;</span><span class="ident" id="2036890"><a href="/runtime/netpoll.go.html#2036850">rg</a></span><span class="op" id="2036892">)</span><span class="op" id="2036893">,</span>&nbsp;<span class="ident" id="2036895">nil</span><span class="op" id="2036898">)</span>&nbsp;<span class="comment" id="2036900">//&nbsp;full&nbsp;memory&nbsp;barrier&nbsp;between&nbsp;store&nbsp;to&nbsp;closing&nbsp;and&nbsp;read&nbsp;of&nbsp;rg/wg&nbsp;in&nbsp;netpollunblock</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2036985"><a href="/runtime/netpoll.go.html#2036850">rg</a></span>&nbsp;<span class="op" id="2036988">=</span>&nbsp;<span class="ident" id="2036990"><a href="/runtime/netpoll.go.html#2039312">netpollunblock</a></span><span class="op" id="2037004">(</span><span class="ident" id="2037005"><a href="/runtime/netpoll.go.html#2036719">pd</a></span><span class="op" id="2037007">,</span>&nbsp;<span class="string" id="2037009">&#39;r&#39;</span><span class="op" id="2037012">,</span>&nbsp;<span class="builtintype" id="2037014">false</span><span class="op" id="2037019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2037022"><a href="/runtime/netpoll.go.html#2036854">wg</a></span>&nbsp;<span class="op" id="2037025">=</span>&nbsp;<span class="ident" id="2037027"><a href="/runtime/netpoll.go.html#2039312">netpollunblock</a></span><span class="op" id="2037041">(</span><span class="ident" id="2037042"><a href="/runtime/netpoll.go.html#2036719">pd</a></span><span class="op" id="2037044">,</span>&nbsp;<span class="string" id="2037046">&#39;w&#39;</span><span class="op" id="2037049">,</span>&nbsp;<span class="builtintype" id="2037051">false</span><span class="op" id="2037056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2037059">if</span>&nbsp;<span class="ident" id="2037062"><a href="/runtime/netpoll.go.html#2036719">pd</a></span><span class="op" id="2037064">.</span><span class="ident" id="2037065">rt</span><span class="op" id="2037067">.</span><span class="ident" id="2037068">f</span>&nbsp;<span class="op" id="2037070">!=</span>&nbsp;<span class="ident" id="2037073">nil</span>&nbsp;<span class="op" id="2037077">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2037081"><a href="/runtime/time.go.html#2152666">deltimer</a></span><span class="op" id="2037089">(</span><span class="op" id="2037090">&amp;</span><span class="ident" id="2037091"><a href="/runtime/netpoll.go.html#2036719">pd</a></span><span class="op" id="2037093">.</span><span class="ident" id="2037094">rt</span><span class="op" id="2037096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2037100"><a href="/runtime/netpoll.go.html#2036719">pd</a></span><span class="op" id="2037102">.</span><span class="ident" id="2037103">rt</span><span class="op" id="2037105">.</span><span class="ident" id="2037106">f</span>&nbsp;<span class="op" id="2037108">=</span>&nbsp;<span class="ident" id="2037110">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2037115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2037118">if</span>&nbsp;<span class="ident" id="2037121"><a href="/runtime/netpoll.go.html#2036719">pd</a></span><span class="op" id="2037123">.</span><span class="ident" id="2037124">wt</span><span class="op" id="2037126">.</span><span class="ident" id="2037127">f</span>&nbsp;<span class="op" id="2037129">!=</span>&nbsp;<span class="ident" id="2037132">nil</span>&nbsp;<span class="op" id="2037136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2037140"><a href="/runtime/time.go.html#2152666">deltimer</a></span><span class="op" id="2037148">(</span><span class="op" id="2037149">&amp;</span><span class="ident" id="2037150"><a href="/runtime/netpoll.go.html#2036719">pd</a></span><span class="op" id="2037152">.</span><span class="ident" id="2037153">wt</span><span class="op" id="2037155">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2037159"><a href="/runtime/netpoll.go.html#2036719">pd</a></span><span class="op" id="2037161">.</span><span class="ident" id="2037162">wt</span><span class="op" id="2037164">.</span><span class="ident" id="2037165">f</span>&nbsp;<span class="op" id="2037167">=</span>&nbsp;<span class="ident" id="2037169">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2037174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2037177"><a href="/runtime/lock_futex.go.html#1979731">unlock</a></span><span class="op" id="2037183">(</span><span class="op" id="2037184">&amp;</span><span class="ident" id="2037185"><a href="/runtime/netpoll.go.html#2036719">pd</a></span><span class="op" id="2037187">.</span><span class="ident" id="2037188">lock</span><span class="op" id="2037192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2037195">if</span>&nbsp;<span class="ident" id="2037198"><a href="/runtime/netpoll.go.html#2036850">rg</a></span>&nbsp;<span class="op" id="2037201">!=</span>&nbsp;<span class="ident" id="2037204">nil</span>&nbsp;<span class="op" id="2037208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2037212"><a href="/runtime/proc.go.html#2067021">goready</a></span><span class="op" id="2037219">(</span><span class="ident" id="2037220"><a href="/runtime/netpoll.go.html#2036850">rg</a></span><span class="op" id="2037222">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2037225">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2037228">if</span>&nbsp;<span class="ident" id="2037231"><a href="/runtime/netpoll.go.html#2036854">wg</a></span>&nbsp;<span class="op" id="2037234">!=</span>&nbsp;<span class="ident" id="2037237">nil</span>&nbsp;<span class="op" id="2037241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2037245"><a href="/runtime/proc.go.html#2067021">goready</a></span><span class="op" id="2037252">(</span><span class="ident" id="2037253"><a href="/runtime/netpoll.go.html#2036854">wg</a></span><span class="op" id="2037255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2037258">}</span><br>
<span class="lineno"></span><span class="op" id="2037260">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span><span class="keyword" id="2037263">func</span>&nbsp;<span class="ident" id="2037268">netpollfd</span><span class="op" id="2037277">(</span><span class="ident" id="2037278">pd</span>&nbsp;<span class="op" id="2037281">*</span><span class="ident" id="2037282"><a href="/runtime/netpoll.go.html#2031666">pollDesc</a></span><span class="op" id="2037290">)</span>&nbsp;<span class="builtintype" id="2037292">uintptr</span>&nbsp;<span class="op" id="2037300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2037303">return</span>&nbsp;<span class="ident" id="2037310"><a href="/runtime/netpoll.go.html#2037278">pd</a></span><span class="op" id="2037312">.</span><span class="ident" id="2037313">fd</span><br>
<span class="lineno"></span><span class="op" id="2037316">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="keyword" id="2037319">func</span>&nbsp;<span class="ident" id="2037324">netpolluser</span><span class="op" id="2037335">(</span><span class="ident" id="2037336">pd</span>&nbsp;<span class="op" id="2037339">*</span><span class="ident" id="2037340"><a href="/runtime/netpoll.go.html#2031666">pollDesc</a></span><span class="op" id="2037348">)</span>&nbsp;<span class="op" id="2037350">*</span><span class="ident" id="2037351"><a href="/runtime/netpoll.go.html#2030244">unsafe</a></span><span class="op" id="2037357">.</span><span class="ident" id="2037358">Pointer</span>&nbsp;<span class="op" id="2037366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2037369">return</span>&nbsp;<span class="op" id="2037376">&amp;</span><span class="ident" id="2037377"><a href="/runtime/netpoll.go.html#2037336">pd</a></span><span class="op" id="2037379">.</span><span class="ident" id="2037380">user</span><br>
<span class="lineno"></span><span class="op" id="2037385">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2037388">func</span>&nbsp;<span class="ident" id="2037393">netpollclosing</span><span class="op" id="2037407">(</span><span class="ident" id="2037408">pd</span>&nbsp;<span class="op" id="2037411">*</span><span class="ident" id="2037412"><a href="/runtime/netpoll.go.html#2031666">pollDesc</a></span><span class="op" id="2037420">)</span>&nbsp;<span class="builtintype" id="2037422">bool</span>&nbsp;<span class="op" id="2037427">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2037430">return</span>&nbsp;<span class="ident" id="2037437"><a href="/runtime/netpoll.go.html#2037408">pd</a></span><span class="op" id="2037439">.</span><span class="ident" id="2037440">closing</span><br>
<span class="lineno"></span><span class="op" id="2037448">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2037451">func</span>&nbsp;<span class="ident" id="2037456">netpolllock</span><span class="op" id="2037467">(</span><span class="ident" id="2037468">pd</span>&nbsp;<span class="op" id="2037471">*</span><span class="ident" id="2037472"><a href="/runtime/netpoll.go.html#2031666">pollDesc</a></span><span class="op" id="2037480">)</span>&nbsp;<span class="op" id="2037482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2037485"><a href="/runtime/lock_futex.go.html#1978439">lock</a></span><span class="op" id="2037489">(</span><span class="op" id="2037490">&amp;</span><span class="ident" id="2037491"><a href="/runtime/netpoll.go.html#2037468">pd</a></span><span class="op" id="2037493">.</span><span class="ident" id="2037494">lock</span><span class="op" id="2037498">)</span><br>
<span class="lineno">280</span><span class="op" id="2037500">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2037503">func</span>&nbsp;<span class="ident" id="2037508">netpollunlock</span><span class="op" id="2037521">(</span><span class="ident" id="2037522">pd</span>&nbsp;<span class="op" id="2037525">*</span><span class="ident" id="2037526"><a href="/runtime/netpoll.go.html#2031666">pollDesc</a></span><span class="op" id="2037534">)</span>&nbsp;<span class="op" id="2037536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2037539"><a href="/runtime/lock_futex.go.html#1979731">unlock</a></span><span class="op" id="2037545">(</span><span class="op" id="2037546">&amp;</span><span class="ident" id="2037547"><a href="/runtime/netpoll.go.html#2037522">pd</a></span><span class="op" id="2037549">.</span><span class="ident" id="2037550">lock</span><span class="op" id="2037554">)</span><br>
<span class="lineno"></span><span class="op" id="2037556">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="comment" id="2037559">//&nbsp;make&nbsp;pd&nbsp;ready,&nbsp;newly&nbsp;runnable&nbsp;goroutines&nbsp;(if&nbsp;any)&nbsp;are&nbsp;returned&nbsp;in&nbsp;rg/wg</span><br>
<span class="lineno"></span><span class="keyword" id="2037634">func</span>&nbsp;<span class="ident" id="2037639">netpollready</span><span class="op" id="2037651">(</span><span class="ident" id="2037652">gpp</span>&nbsp;<span class="op" id="2037656">*</span><span class="op" id="2037657">*</span><span class="ident" id="2037658"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2180373">g</a></span><span class="op" id="2037659">,</span>&nbsp;<span class="ident" id="2037661">pd</span>&nbsp;<span class="op" id="2037664">*</span><span class="ident" id="2037665"><a href="/runtime/netpoll.go.html#2031666">pollDesc</a></span><span class="op" id="2037673">,</span>&nbsp;<span class="ident" id="2037675">mode</span>&nbsp;<span class="builtintype" id="2037680">int32</span><span class="op" id="2037685">)</span>&nbsp;<span class="op" id="2037687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2037690">var</span>&nbsp;<span class="ident" id="2037694">rg</span><span class="op" id="2037696">,</span>&nbsp;<span class="ident" id="2037698">wg</span>&nbsp;<span class="op" id="2037701">*</span><span class="ident" id="2037702"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2180373">g</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2037705">if</span>&nbsp;<span class="ident" id="2037708"><a href="/runtime/netpoll.go.html#2037675">mode</a></span>&nbsp;<span class="op" id="2037713">==</span>&nbsp;<span class="string" id="2037716">&#39;r&#39;</span>&nbsp;<span class="op" id="2037720">||</span>&nbsp;<span class="ident" id="2037723"><a href="/runtime/netpoll.go.html#2037675">mode</a></span>&nbsp;<span class="op" id="2037728">==</span>&nbsp;<span class="string" id="2037731">&#39;r&#39;</span><span class="op" id="2037734">+</span><span class="string" id="2037735">&#39;w&#39;</span>&nbsp;<span class="op" id="2037739">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2037743"><a href="/runtime/netpoll.go.html#2037694">rg</a></span>&nbsp;<span class="op" id="2037746">=</span>&nbsp;<span class="ident" id="2037748"><a href="/runtime/netpoll.go.html#2039312">netpollunblock</a></span><span class="op" id="2037762">(</span><span class="ident" id="2037763"><a href="/runtime/netpoll.go.html#2037661">pd</a></span><span class="op" id="2037765">,</span>&nbsp;<span class="string" id="2037767">&#39;r&#39;</span><span class="op" id="2037770">,</span>&nbsp;<span class="builtintype" id="2037772">true</span><span class="op" id="2037776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2037779">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2037782">if</span>&nbsp;<span class="ident" id="2037785"><a href="/runtime/netpoll.go.html#2037675">mode</a></span>&nbsp;<span class="op" id="2037790">==</span>&nbsp;<span class="string" id="2037793">&#39;w&#39;</span>&nbsp;<span class="op" id="2037797">||</span>&nbsp;<span class="ident" id="2037800"><a href="/runtime/netpoll.go.html#2037675">mode</a></span>&nbsp;<span class="op" id="2037805">==</span>&nbsp;<span class="string" id="2037808">&#39;r&#39;</span><span class="op" id="2037811">+</span><span class="string" id="2037812">&#39;w&#39;</span>&nbsp;<span class="op" id="2037816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2037820"><a href="/runtime/netpoll.go.html#2037698">wg</a></span>&nbsp;<span class="op" id="2037823">=</span>&nbsp;<span class="ident" id="2037825"><a href="/runtime/netpoll.go.html#2039312">netpollunblock</a></span><span class="op" id="2037839">(</span><span class="ident" id="2037840"><a href="/runtime/netpoll.go.html#2037661">pd</a></span><span class="op" id="2037842">,</span>&nbsp;<span class="string" id="2037844">&#39;w&#39;</span><span class="op" id="2037847">,</span>&nbsp;<span class="builtintype" id="2037849">true</span><span class="op" id="2037853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2037856">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2037859">if</span>&nbsp;<span class="ident" id="2037862"><a href="/runtime/netpoll.go.html#2037694">rg</a></span>&nbsp;<span class="op" id="2037865">!=</span>&nbsp;<span class="ident" id="2037868">nil</span>&nbsp;<span class="op" id="2037872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2037876"><a href="/runtime/netpoll.go.html#2037694">rg</a></span><span class="op" id="2037878">.</span><span class="ident" id="2037879">schedlink</span>&nbsp;<span class="op" id="2037889">=</span>&nbsp;<span class="op" id="2037891">*</span><span class="ident" id="2037892"><a href="/runtime/netpoll.go.html#2037652">gpp</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2037898">*</span><span class="ident" id="2037899"><a href="/runtime/netpoll.go.html#2037652">gpp</a></span>&nbsp;<span class="op" id="2037903">=</span>&nbsp;<span class="ident" id="2037905"><a href="/runtime/netpoll.go.html#2037694">rg</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2037909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2037912">if</span>&nbsp;<span class="ident" id="2037915"><a href="/runtime/netpoll.go.html#2037698">wg</a></span>&nbsp;<span class="op" id="2037918">!=</span>&nbsp;<span class="ident" id="2037921">nil</span>&nbsp;<span class="op" id="2037925">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2037929"><a href="/runtime/netpoll.go.html#2037698">wg</a></span><span class="op" id="2037931">.</span><span class="ident" id="2037932">schedlink</span>&nbsp;<span class="op" id="2037942">=</span>&nbsp;<span class="op" id="2037944">*</span><span class="ident" id="2037945"><a href="/runtime/netpoll.go.html#2037652">gpp</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2037951">*</span><span class="ident" id="2037952"><a href="/runtime/netpoll.go.html#2037652">gpp</a></span>&nbsp;<span class="op" id="2037956">=</span>&nbsp;<span class="ident" id="2037958"><a href="/runtime/netpoll.go.html#2037698">wg</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2037962">}</span><br>
<span class="lineno"></span><span class="op" id="2037964">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span><span class="keyword" id="2037967">func</span>&nbsp;<span class="ident" id="2037972">netpollcheckerr</span><span class="op" id="2037987">(</span><span class="ident" id="2037988">pd</span>&nbsp;<span class="op" id="2037991">*</span><span class="ident" id="2037992"><a href="/runtime/netpoll.go.html#2031666">pollDesc</a></span><span class="op" id="2038000">,</span>&nbsp;<span class="ident" id="2038002">mode</span>&nbsp;<span class="builtintype" id="2038007">int32</span><span class="op" id="2038012">)</span>&nbsp;<span class="builtintype" id="2038014">int</span>&nbsp;<span class="op" id="2038018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2038021">if</span>&nbsp;<span class="ident" id="2038024"><a href="/runtime/netpoll.go.html#2037988">pd</a></span><span class="op" id="2038026">.</span><span class="ident" id="2038027">closing</span>&nbsp;<span class="op" id="2038035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2038039">return</span>&nbsp;<span class="num" id="2038046">1</span>&nbsp;<span class="comment" id="2038048">//&nbsp;errClosing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2038063">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2038066">if</span>&nbsp;<span class="op" id="2038069">(</span><span class="ident" id="2038070"><a href="/runtime/netpoll.go.html#2038002">mode</a></span>&nbsp;<span class="op" id="2038075">==</span>&nbsp;<span class="string" id="2038078">&#39;r&#39;</span>&nbsp;<span class="op" id="2038082">&amp;&amp;</span>&nbsp;<span class="ident" id="2038085"><a href="/runtime/netpoll.go.html#2037988">pd</a></span><span class="op" id="2038087">.</span><span class="ident" id="2038088">rd</span>&nbsp;<span class="op" id="2038091">&lt;</span>&nbsp;<span class="num" id="2038093">0</span><span class="op" id="2038094">)</span>&nbsp;<span class="op" id="2038096">||</span>&nbsp;<span class="op" id="2038099">(</span><span class="ident" id="2038100"><a href="/runtime/netpoll.go.html#2038002">mode</a></span>&nbsp;<span class="op" id="2038105">==</span>&nbsp;<span class="string" id="2038108">&#39;w&#39;</span>&nbsp;<span class="op" id="2038112">&amp;&amp;</span>&nbsp;<span class="ident" id="2038115"><a href="/runtime/netpoll.go.html#2037988">pd</a></span><span class="op" id="2038117">.</span><span class="ident" id="2038118">wd</span>&nbsp;<span class="op" id="2038121">&lt;</span>&nbsp;<span class="num" id="2038123">0</span><span class="op" id="2038124">)</span>&nbsp;<span class="op" id="2038126">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2038130">return</span>&nbsp;<span class="num" id="2038137">2</span>&nbsp;<span class="comment" id="2038139">//&nbsp;errTimeout</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2038154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2038157">return</span>&nbsp;<span class="num" id="2038164">0</span><br>
<span class="lineno"></span><span class="op" id="2038166">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="keyword" id="2038169">func</span>&nbsp;<span class="ident" id="2038174">netpollblockcommit</span><span class="op" id="2038192">(</span><span class="ident" id="2038193">gp</span>&nbsp;<span class="op" id="2038196">*</span><span class="ident" id="2038197"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2180373">g</a></span><span class="op" id="2038198">,</span>&nbsp;<span class="ident" id="2038200">gpp</span>&nbsp;<span class="ident" id="2038204"><a href="/runtime/netpoll.go.html#2030244">unsafe</a></span><span class="op" id="2038210">.</span><span class="ident" id="2038211">Pointer</span><span class="op" id="2038218">)</span>&nbsp;<span class="builtintype" id="2038220">bool</span>&nbsp;<span class="op" id="2038225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2038228">return</span>&nbsp;<span class="ident" id="2038235"><a href="/runtime/stubs.go.html#2137981">casuintptr</a></span><span class="op" id="2038245">(</span><span class="op" id="2038246">(</span><span class="op" id="2038247">*</span><span class="builtintype" id="2038248">uintptr</span><span class="op" id="2038255">)</span><span class="op" id="2038256">(</span><span class="ident" id="2038257"><a href="/runtime/netpoll.go.html#2038200">gpp</a></span><span class="op" id="2038260">)</span><span class="op" id="2038261">,</span>&nbsp;<span class="ident" id="2038263"><a href="/runtime/netpoll.go.html#2031576">pdWait</a></span><span class="op" id="2038269">,</span>&nbsp;<span class="builtintype" id="2038271">uintptr</span><span class="op" id="2038278">(</span><span class="ident" id="2038279"><a href="/runtime/netpoll.go.html#2030244">unsafe</a></span><span class="op" id="2038285">.</span><span class="ident" id="2038286">Pointer</span><span class="op" id="2038293">(</span><span class="ident" id="2038294"><a href="/runtime/netpoll.go.html#2038193">gp</a></span><span class="op" id="2038296">)</span><span class="op" id="2038297">)</span><span class="op" id="2038298">)</span><br>
<span class="lineno"></span><span class="op" id="2038300">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2038303">//&nbsp;returns&nbsp;true&nbsp;if&nbsp;IO&nbsp;is&nbsp;ready,&nbsp;or&nbsp;false&nbsp;if&nbsp;timedout&nbsp;or&nbsp;closed</span><br>
<span class="lineno">320</span><span class="comment" id="2038366">//&nbsp;waitio&nbsp;-&nbsp;wait&nbsp;only&nbsp;for&nbsp;completed&nbsp;IO,&nbsp;ignore&nbsp;errors</span><br>
<span class="lineno"></span><span class="keyword" id="2038420">func</span>&nbsp;<span class="ident" id="2038425">netpollblock</span><span class="op" id="2038437">(</span><span class="ident" id="2038438">pd</span>&nbsp;<span class="op" id="2038441">*</span><span class="ident" id="2038442"><a href="/runtime/netpoll.go.html#2031666">pollDesc</a></span><span class="op" id="2038450">,</span>&nbsp;<span class="ident" id="2038452">mode</span>&nbsp;<span class="builtintype" id="2038457">int32</span><span class="op" id="2038462">,</span>&nbsp;<span class="ident" id="2038464">waitio</span>&nbsp;<span class="builtintype" id="2038471">bool</span><span class="op" id="2038475">)</span>&nbsp;<span class="builtintype" id="2038477">bool</span>&nbsp;<span class="op" id="2038482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2038485">gpp</span>&nbsp;<span class="op" id="2038489">:=</span>&nbsp;<span class="op" id="2038492">&amp;</span><span class="ident" id="2038493"><a href="/runtime/netpoll.go.html#2038438">pd</a></span><span class="op" id="2038495">.</span><span class="ident" id="2038496">rg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2038500">if</span>&nbsp;<span class="ident" id="2038503"><a href="/runtime/netpoll.go.html#2038452">mode</a></span>&nbsp;<span class="op" id="2038508">==</span>&nbsp;<span class="string" id="2038511">&#39;w&#39;</span>&nbsp;<span class="op" id="2038515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2038519"><a href="/runtime/netpoll.go.html#2038485">gpp</a></span>&nbsp;<span class="op" id="2038523">=</span>&nbsp;<span class="op" id="2038525">&amp;</span><span class="ident" id="2038526"><a href="/runtime/netpoll.go.html#2038438">pd</a></span><span class="op" id="2038528">.</span><span class="ident" id="2038529">wg</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2038533">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2038537">//&nbsp;set&nbsp;the&nbsp;gpp&nbsp;semaphore&nbsp;to&nbsp;WAIT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2038571">for</span>&nbsp;<span class="op" id="2038575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2038579">old</span>&nbsp;<span class="op" id="2038583">:=</span>&nbsp;<span class="op" id="2038586">*</span><span class="ident" id="2038587"><a href="/runtime/netpoll.go.html#2038485">gpp</a></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2038593">if</span>&nbsp;<span class="ident" id="2038596"><a href="/runtime/netpoll.go.html#2038579">old</a></span>&nbsp;<span class="op" id="2038600">==</span>&nbsp;<span class="ident" id="2038603"><a href="/runtime/netpoll.go.html#2031555">pdReady</a></span>&nbsp;<span class="op" id="2038611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2038616">*</span><span class="ident" id="2038617"><a href="/runtime/netpoll.go.html#2038485">gpp</a></span>&nbsp;<span class="op" id="2038621">=</span>&nbsp;<span class="num" id="2038623">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2038628">return</span>&nbsp;<span class="builtintype" id="2038635">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2038642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2038646">if</span>&nbsp;<span class="ident" id="2038649"><a href="/runtime/netpoll.go.html#2038579">old</a></span>&nbsp;<span class="op" id="2038653">!=</span>&nbsp;<span class="num" id="2038656">0</span>&nbsp;<span class="op" id="2038658">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2038663"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="2038670">(</span><span class="string" id="2038671">&#34;netpollblock:&nbsp;double&nbsp;wait&#34;</span><span class="op" id="2038698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2038702">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2038706">if</span>&nbsp;<span class="ident" id="2038709"><a href="/runtime/stubs.go.html#2137981">casuintptr</a></span><span class="op" id="2038719">(</span><span class="ident" id="2038720"><a href="/runtime/netpoll.go.html#2038485">gpp</a></span><span class="op" id="2038723">,</span>&nbsp;<span class="num" id="2038725">0</span><span class="op" id="2038726">,</span>&nbsp;<span class="ident" id="2038728"><a href="/runtime/netpoll.go.html#2031576">pdWait</a></span><span class="op" id="2038734">)</span>&nbsp;<span class="op" id="2038736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2038741">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2038749">}</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2038752">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2038756">//&nbsp;need&nbsp;to&nbsp;recheck&nbsp;error&nbsp;states&nbsp;after&nbsp;setting&nbsp;gpp&nbsp;to&nbsp;WAIT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2038815">//&nbsp;this&nbsp;is&nbsp;necessary&nbsp;because&nbsp;runtime_pollUnblock/runtime_pollSetDeadline/deadlineimpl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2038902">//&nbsp;do&nbsp;the&nbsp;opposite:&nbsp;store&nbsp;to&nbsp;closing/rd/wd,&nbsp;membarrier,&nbsp;load&nbsp;of&nbsp;rg/wg</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2038973">if</span>&nbsp;<span class="ident" id="2038976"><a href="/runtime/netpoll.go.html#2038464">waitio</a></span>&nbsp;<span class="op" id="2038983">||</span>&nbsp;<span class="ident" id="2038986"><a href="/runtime/netpoll.go.html#2037972">netpollcheckerr</a></span><span class="op" id="2039001">(</span><span class="ident" id="2039002"><a href="/runtime/netpoll.go.html#2038438">pd</a></span><span class="op" id="2039004">,</span>&nbsp;<span class="ident" id="2039006"><a href="/runtime/netpoll.go.html#2038452">mode</a></span><span class="op" id="2039010">)</span>&nbsp;<span class="op" id="2039012">==</span>&nbsp;<span class="num" id="2039015">0</span>&nbsp;<span class="op" id="2039017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2039021">f</span>&nbsp;<span class="op" id="2039023">:=</span>&nbsp;<span class="ident" id="2039026"><a href="/runtime/netpoll.go.html#2038174">netpollblockcommit</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2039047"><a href="/runtime/proc.go.html#2066373">gopark</a></span><span class="op" id="2039053">(</span><span class="op" id="2039054">*</span><span class="op" id="2039055">*</span><span class="op" id="2039056">(</span><span class="op" id="2039057">*</span><span class="op" id="2039058">*</span><span class="ident" id="2039059"><a href="/runtime/netpoll.go.html#2030244">unsafe</a></span><span class="op" id="2039065">.</span><span class="ident" id="2039066">Pointer</span><span class="op" id="2039073">)</span><span class="op" id="2039074">(</span><span class="ident" id="2039075"><a href="/runtime/netpoll.go.html#2030244">unsafe</a></span><span class="op" id="2039081">.</span><span class="ident" id="2039082">Pointer</span><span class="op" id="2039089">(</span><span class="op" id="2039090">&amp;</span><span class="ident" id="2039091"><a href="/runtime/netpoll.go.html#2039021">f</a></span><span class="op" id="2039092">)</span><span class="op" id="2039093">)</span><span class="op" id="2039094">,</span>&nbsp;<span class="ident" id="2039096"><a href="/runtime/netpoll.go.html#2030244">unsafe</a></span><span class="op" id="2039102">.</span><span class="ident" id="2039103">Pointer</span><span class="op" id="2039110">(</span><span class="ident" id="2039111"><a href="/runtime/netpoll.go.html#2038485">gpp</a></span><span class="op" id="2039114">)</span><span class="op" id="2039115">,</span>&nbsp;<span class="string" id="2039117">&#34;IO&nbsp;wait&#34;</span><span class="op" id="2039126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2039129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2039132">//&nbsp;be&nbsp;careful&nbsp;to&nbsp;not&nbsp;lose&nbsp;concurrent&nbsp;READY&nbsp;notification</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2039189">old</span>&nbsp;<span class="op" id="2039193">:=</span>&nbsp;<span class="ident" id="2039196"><a href="/runtime/atomic.go.html#1874365">xchguintptr</a></span><span class="op" id="2039207">(</span><span class="ident" id="2039208"><a href="/runtime/netpoll.go.html#2038485">gpp</a></span><span class="op" id="2039211">,</span>&nbsp;<span class="num" id="2039213">0</span><span class="op" id="2039214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2039217">if</span>&nbsp;<span class="ident" id="2039220"><a href="/runtime/netpoll.go.html#2039189">old</a></span>&nbsp;<span class="op" id="2039224">&gt;</span>&nbsp;<span class="ident" id="2039226"><a href="/runtime/netpoll.go.html#2031576">pdWait</a></span>&nbsp;<span class="op" id="2039233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2039237"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="2039244">(</span><span class="string" id="2039245">&#34;netpollblock:&nbsp;corrupted&nbsp;state&#34;</span><span class="op" id="2039276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2039279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2039282">return</span>&nbsp;<span class="ident" id="2039289"><a href="/runtime/netpoll.go.html#2039189">old</a></span>&nbsp;<span class="op" id="2039293">==</span>&nbsp;<span class="ident" id="2039296"><a href="/runtime/netpoll.go.html#2031555">pdReady</a></span><br>
<span class="lineno">355</span><span class="op" id="2039304">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2039307">func</span>&nbsp;<span class="ident" id="2039312">netpollunblock</span><span class="op" id="2039326">(</span><span class="ident" id="2039327">pd</span>&nbsp;<span class="op" id="2039330">*</span><span class="ident" id="2039331"><a href="/runtime/netpoll.go.html#2031666">pollDesc</a></span><span class="op" id="2039339">,</span>&nbsp;<span class="ident" id="2039341">mode</span>&nbsp;<span class="builtintype" id="2039346">int32</span><span class="op" id="2039351">,</span>&nbsp;<span class="ident" id="2039353">ioready</span>&nbsp;<span class="builtintype" id="2039361">bool</span><span class="op" id="2039365">)</span>&nbsp;<span class="op" id="2039367">*</span><span class="ident" id="2039368"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2180373">g</a></span>&nbsp;<span class="op" id="2039370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2039373">gpp</span>&nbsp;<span class="op" id="2039377">:=</span>&nbsp;<span class="op" id="2039380">&amp;</span><span class="ident" id="2039381"><a href="/runtime/netpoll.go.html#2039327">pd</a></span><span class="op" id="2039383">.</span><span class="ident" id="2039384">rg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2039388">if</span>&nbsp;<span class="ident" id="2039391"><a href="/runtime/netpoll.go.html#2039341">mode</a></span>&nbsp;<span class="op" id="2039396">==</span>&nbsp;<span class="string" id="2039399">&#39;w&#39;</span>&nbsp;<span class="op" id="2039403">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2039407"><a href="/runtime/netpoll.go.html#2039373">gpp</a></span>&nbsp;<span class="op" id="2039411">=</span>&nbsp;<span class="op" id="2039413">&amp;</span><span class="ident" id="2039414"><a href="/runtime/netpoll.go.html#2039327">pd</a></span><span class="op" id="2039416">.</span><span class="ident" id="2039417">wg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2039421">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2039425">for</span>&nbsp;<span class="op" id="2039429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2039433">old</span>&nbsp;<span class="op" id="2039437">:=</span>&nbsp;<span class="op" id="2039440">*</span><span class="ident" id="2039441"><a href="/runtime/netpoll.go.html#2039373">gpp</a></span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2039447">if</span>&nbsp;<span class="ident" id="2039450"><a href="/runtime/netpoll.go.html#2039433">old</a></span>&nbsp;<span class="op" id="2039454">==</span>&nbsp;<span class="ident" id="2039457"><a href="/runtime/netpoll.go.html#2031555">pdReady</a></span>&nbsp;<span class="op" id="2039465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2039470">return</span>&nbsp;<span class="ident" id="2039477">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2039483">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2039487">if</span>&nbsp;<span class="ident" id="2039490"><a href="/runtime/netpoll.go.html#2039433">old</a></span>&nbsp;<span class="op" id="2039494">==</span>&nbsp;<span class="num" id="2039497">0</span>&nbsp;<span class="op" id="2039499">&amp;&amp;</span>&nbsp;<span class="op" id="2039502">!</span><span class="ident" id="2039503"><a href="/runtime/netpoll.go.html#2039353">ioready</a></span>&nbsp;<span class="op" id="2039511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2039516">//&nbsp;Only&nbsp;set&nbsp;READY&nbsp;for&nbsp;ioready.&nbsp;runtime_pollWait</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2039567">//&nbsp;will&nbsp;check&nbsp;for&nbsp;timeout/cancel&nbsp;before&nbsp;waiting.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2039619">return</span>&nbsp;<span class="ident" id="2039626">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2039632">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2039636">var</span>&nbsp;<span class="builtinfunc" id="2039640">new</span>&nbsp;<span class="builtintype" id="2039644">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2039654">if</span>&nbsp;<span class="ident" id="2039657"><a href="/runtime/netpoll.go.html#2039353">ioready</a></span>&nbsp;<span class="op" id="2039665">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2039670"><a href="/runtime/netpoll.go.html#2039640">new</a></span>&nbsp;<span class="op" id="2039674">=</span>&nbsp;<span class="ident" id="2039676"><a href="/runtime/netpoll.go.html#2031555">pdReady</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2039686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2039690">if</span>&nbsp;<span class="ident" id="2039693"><a href="/runtime/stubs.go.html#2137981">casuintptr</a></span><span class="op" id="2039703">(</span><span class="ident" id="2039704"><a href="/runtime/netpoll.go.html#2039373">gpp</a></span><span class="op" id="2039707">,</span>&nbsp;<span class="ident" id="2039709"><a href="/runtime/netpoll.go.html#2039433">old</a></span><span class="op" id="2039712">,</span>&nbsp;<span class="builtinfunc" id="2039714"><a href="/runtime/netpoll.go.html#2039640">new</a></span><span class="op" id="2039717">)</span>&nbsp;<span class="op" id="2039719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2039724">if</span>&nbsp;<span class="ident" id="2039727"><a href="/runtime/netpoll.go.html#2039433">old</a></span>&nbsp;<span class="op" id="2039731">==</span>&nbsp;<span class="ident" id="2039734"><a href="/runtime/netpoll.go.html#2031555">pdReady</a></span>&nbsp;<span class="op" id="2039742">||</span>&nbsp;<span class="ident" id="2039745"><a href="/runtime/netpoll.go.html#2039433">old</a></span>&nbsp;<span class="op" id="2039749">==</span>&nbsp;<span class="ident" id="2039752"><a href="/runtime/netpoll.go.html#2031576">pdWait</a></span>&nbsp;<span class="op" id="2039759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2039765"><a href="/runtime/netpoll.go.html#2039433">old</a></span>&nbsp;<span class="op" id="2039769">=</span>&nbsp;<span class="num" id="2039771">0</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2039776">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2039781">return</span>&nbsp;<span class="op" id="2039788">(</span><span class="op" id="2039789">*</span><span class="ident" id="2039790"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2180373">g</a></span><span class="op" id="2039791">)</span><span class="op" id="2039792">(</span><span class="ident" id="2039793"><a href="/runtime/netpoll.go.html#2030244">unsafe</a></span><span class="op" id="2039799">.</span><span class="ident" id="2039800">Pointer</span><span class="op" id="2039807">(</span><span class="ident" id="2039808"><a href="/runtime/netpoll.go.html#2039433">old</a></span><span class="op" id="2039811">)</span><span class="op" id="2039812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2039816">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2039819">}</span><br>
<span class="lineno"></span><span class="op" id="2039821">}</span><br>
<span class="lineno">385</span><br>
<span class="lineno"></span><span class="keyword" id="2039824">func</span>&nbsp;<span class="ident" id="2039829">netpolldeadlineimpl</span><span class="op" id="2039848">(</span><span class="ident" id="2039849">pd</span>&nbsp;<span class="op" id="2039852">*</span><span class="ident" id="2039853"><a href="/runtime/netpoll.go.html#2031666">pollDesc</a></span><span class="op" id="2039861">,</span>&nbsp;<span class="ident" id="2039863">seq</span>&nbsp;<span class="builtintype" id="2039867">uintptr</span><span class="op" id="2039874">,</span>&nbsp;<span class="ident" id="2039876">read</span><span class="op" id="2039880">,</span>&nbsp;<span class="ident" id="2039882">write</span>&nbsp;<span class="builtintype" id="2039888">bool</span><span class="op" id="2039892">)</span>&nbsp;<span class="op" id="2039894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2039897"><a href="/runtime/lock_futex.go.html#1978439">lock</a></span><span class="op" id="2039901">(</span><span class="op" id="2039902">&amp;</span><span class="ident" id="2039903"><a href="/runtime/netpoll.go.html#2039849">pd</a></span><span class="op" id="2039905">.</span><span class="ident" id="2039906">lock</span><span class="op" id="2039910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2039913">//&nbsp;Seq&nbsp;arg&nbsp;is&nbsp;seq&nbsp;when&nbsp;the&nbsp;timer&nbsp;was&nbsp;set.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2039956">//&nbsp;If&nbsp;it&#39;s&nbsp;stale,&nbsp;ignore&nbsp;the&nbsp;timer&nbsp;event.</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2039999">if</span>&nbsp;<span class="ident" id="2040002"><a href="/runtime/netpoll.go.html#2039863">seq</a></span>&nbsp;<span class="op" id="2040006">!=</span>&nbsp;<span class="ident" id="2040009"><a href="/runtime/netpoll.go.html#2039849">pd</a></span><span class="op" id="2040011">.</span><span class="ident" id="2040012">seq</span>&nbsp;<span class="op" id="2040016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2040020">//&nbsp;The&nbsp;descriptor&nbsp;was&nbsp;reused&nbsp;or&nbsp;timers&nbsp;were&nbsp;reset.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2040073"><a href="/runtime/lock_futex.go.html#1979731">unlock</a></span><span class="op" id="2040079">(</span><span class="op" id="2040080">&amp;</span><span class="ident" id="2040081"><a href="/runtime/netpoll.go.html#2039849">pd</a></span><span class="op" id="2040083">.</span><span class="ident" id="2040084">lock</span><span class="op" id="2040088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2040092">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2040100">}</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2040103">var</span>&nbsp;<span class="ident" id="2040107">rg</span>&nbsp;<span class="op" id="2040110">*</span><span class="ident" id="2040111"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2180373">g</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2040114">if</span>&nbsp;<span class="ident" id="2040117"><a href="/runtime/netpoll.go.html#2039876">read</a></span>&nbsp;<span class="op" id="2040122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2040126">if</span>&nbsp;<span class="ident" id="2040129"><a href="/runtime/netpoll.go.html#2039849">pd</a></span><span class="op" id="2040131">.</span><span class="ident" id="2040132">rd</span>&nbsp;<span class="op" id="2040135">&lt;=</span>&nbsp;<span class="num" id="2040138">0</span>&nbsp;<span class="op" id="2040140">||</span>&nbsp;<span class="ident" id="2040143"><a href="/runtime/netpoll.go.html#2039849">pd</a></span><span class="op" id="2040145">.</span><span class="ident" id="2040146">rt</span><span class="op" id="2040148">.</span><span class="ident" id="2040149">f</span>&nbsp;<span class="op" id="2040151">==</span>&nbsp;<span class="ident" id="2040154">nil</span>&nbsp;<span class="op" id="2040158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2040163"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="2040170">(</span><span class="string" id="2040171">&#34;netpolldeadlineimpl:&nbsp;inconsistent&nbsp;read&nbsp;deadline&#34;</span><span class="op" id="2040220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2040224">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2040228"><a href="/runtime/netpoll.go.html#2039849">pd</a></span><span class="op" id="2040230">.</span><span class="ident" id="2040231">rd</span>&nbsp;<span class="op" id="2040234">=</span>&nbsp;<span class="op" id="2040236">-</span><span class="num" id="2040237">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2040241"><a href="/runtime/atomic.go.html#1874833">atomicstorep</a></span><span class="op" id="2040253">(</span><span class="ident" id="2040254"><a href="/runtime/netpoll.go.html#2030244">unsafe</a></span><span class="op" id="2040260">.</span><span class="ident" id="2040261">Pointer</span><span class="op" id="2040268">(</span><span class="op" id="2040269">&amp;</span><span class="ident" id="2040270"><a href="/runtime/netpoll.go.html#2039849">pd</a></span><span class="op" id="2040272">.</span><span class="ident" id="2040273">rt</span><span class="op" id="2040275">.</span><span class="ident" id="2040276">f</span><span class="op" id="2040277">)</span><span class="op" id="2040278">,</span>&nbsp;<span class="ident" id="2040280">nil</span><span class="op" id="2040283">)</span>&nbsp;<span class="comment" id="2040285">//&nbsp;full&nbsp;memory&nbsp;barrier&nbsp;between&nbsp;store&nbsp;to&nbsp;rd&nbsp;and&nbsp;load&nbsp;of&nbsp;rg&nbsp;in&nbsp;netpollunblock</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2040363"><a href="/runtime/netpoll.go.html#2040107">rg</a></span>&nbsp;<span class="op" id="2040366">=</span>&nbsp;<span class="ident" id="2040368"><a href="/runtime/netpoll.go.html#2039312">netpollunblock</a></span><span class="op" id="2040382">(</span><span class="ident" id="2040383"><a href="/runtime/netpoll.go.html#2039849">pd</a></span><span class="op" id="2040385">,</span>&nbsp;<span class="string" id="2040387">&#39;r&#39;</span><span class="op" id="2040390">,</span>&nbsp;<span class="builtintype" id="2040392">false</span><span class="op" id="2040397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2040400">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2040403">var</span>&nbsp;<span class="ident" id="2040407">wg</span>&nbsp;<span class="op" id="2040410">*</span><span class="ident" id="2040411"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2180373">g</a></span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2040414">if</span>&nbsp;<span class="ident" id="2040417"><a href="/runtime/netpoll.go.html#2039882">write</a></span>&nbsp;<span class="op" id="2040423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2040427">if</span>&nbsp;<span class="ident" id="2040430"><a href="/runtime/netpoll.go.html#2039849">pd</a></span><span class="op" id="2040432">.</span><span class="ident" id="2040433">wd</span>&nbsp;<span class="op" id="2040436">&lt;=</span>&nbsp;<span class="num" id="2040439">0</span>&nbsp;<span class="op" id="2040441">||</span>&nbsp;<span class="ident" id="2040444"><a href="/runtime/netpoll.go.html#2039849">pd</a></span><span class="op" id="2040446">.</span><span class="ident" id="2040447">wt</span><span class="op" id="2040449">.</span><span class="ident" id="2040450">f</span>&nbsp;<span class="op" id="2040452">==</span>&nbsp;<span class="ident" id="2040455">nil</span>&nbsp;<span class="op" id="2040459">&amp;&amp;</span>&nbsp;<span class="op" id="2040462">!</span><span class="ident" id="2040463"><a href="/runtime/netpoll.go.html#2039876">read</a></span>&nbsp;<span class="op" id="2040468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2040473"><a href="/runtime/panic.go.html#2057429">gothrow</a></span><span class="op" id="2040480">(</span><span class="string" id="2040481">&#34;netpolldeadlineimpl:&nbsp;inconsistent&nbsp;write&nbsp;deadline&#34;</span><span class="op" id="2040531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2040535">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2040539"><a href="/runtime/netpoll.go.html#2039849">pd</a></span><span class="op" id="2040541">.</span><span class="ident" id="2040542">wd</span>&nbsp;<span class="op" id="2040545">=</span>&nbsp;<span class="op" id="2040547">-</span><span class="num" id="2040548">1</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2040552"><a href="/runtime/atomic.go.html#1874833">atomicstorep</a></span><span class="op" id="2040564">(</span><span class="ident" id="2040565"><a href="/runtime/netpoll.go.html#2030244">unsafe</a></span><span class="op" id="2040571">.</span><span class="ident" id="2040572">Pointer</span><span class="op" id="2040579">(</span><span class="op" id="2040580">&amp;</span><span class="ident" id="2040581"><a href="/runtime/netpoll.go.html#2039849">pd</a></span><span class="op" id="2040583">.</span><span class="ident" id="2040584">wt</span><span class="op" id="2040586">.</span><span class="ident" id="2040587">f</span><span class="op" id="2040588">)</span><span class="op" id="2040589">,</span>&nbsp;<span class="ident" id="2040591">nil</span><span class="op" id="2040594">)</span>&nbsp;<span class="comment" id="2040596">//&nbsp;full&nbsp;memory&nbsp;barrier&nbsp;between&nbsp;store&nbsp;to&nbsp;wd&nbsp;and&nbsp;load&nbsp;of&nbsp;wg&nbsp;in&nbsp;netpollunblock</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2040674"><a href="/runtime/netpoll.go.html#2040407">wg</a></span>&nbsp;<span class="op" id="2040677">=</span>&nbsp;<span class="ident" id="2040679"><a href="/runtime/netpoll.go.html#2039312">netpollunblock</a></span><span class="op" id="2040693">(</span><span class="ident" id="2040694"><a href="/runtime/netpoll.go.html#2039849">pd</a></span><span class="op" id="2040696">,</span>&nbsp;<span class="string" id="2040698">&#39;w&#39;</span><span class="op" id="2040701">,</span>&nbsp;<span class="builtintype" id="2040703">false</span><span class="op" id="2040708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2040711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2040714"><a href="/runtime/lock_futex.go.html#1979731">unlock</a></span><span class="op" id="2040720">(</span><span class="op" id="2040721">&amp;</span><span class="ident" id="2040722"><a href="/runtime/netpoll.go.html#2039849">pd</a></span><span class="op" id="2040724">.</span><span class="ident" id="2040725">lock</span><span class="op" id="2040729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2040732">if</span>&nbsp;<span class="ident" id="2040735"><a href="/runtime/netpoll.go.html#2040107">rg</a></span>&nbsp;<span class="op" id="2040738">!=</span>&nbsp;<span class="ident" id="2040741">nil</span>&nbsp;<span class="op" id="2040745">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2040749"><a href="/runtime/proc.go.html#2067021">goready</a></span><span class="op" id="2040756">(</span><span class="ident" id="2040757"><a href="/runtime/netpoll.go.html#2040107">rg</a></span><span class="op" id="2040759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2040762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2040765">if</span>&nbsp;<span class="ident" id="2040768"><a href="/runtime/netpoll.go.html#2040407">wg</a></span>&nbsp;<span class="op" id="2040771">!=</span>&nbsp;<span class="ident" id="2040774">nil</span>&nbsp;<span class="op" id="2040778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2040782"><a href="/runtime/proc.go.html#2067021">goready</a></span><span class="op" id="2040789">(</span><span class="ident" id="2040790"><a href="/runtime/netpoll.go.html#2040407">wg</a></span><span class="op" id="2040792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2040795">}</span><br>
<span class="lineno">420</span><span class="op" id="2040797">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2040800">func</span>&nbsp;<span class="ident" id="2040805">netpollDeadline</span><span class="op" id="2040820">(</span><span class="ident" id="2040821">arg</span>&nbsp;<span class="keyword" id="2040825">interface</span><span class="op" id="2040834">{</span><span class="op" id="2040835">}</span><span class="op" id="2040836">,</span>&nbsp;<span class="ident" id="2040838">seq</span>&nbsp;<span class="builtintype" id="2040842">uintptr</span><span class="op" id="2040849">)</span>&nbsp;<span class="op" id="2040851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2040854"><a href="/runtime/netpoll.go.html#2039829">netpolldeadlineimpl</a></span><span class="op" id="2040873">(</span><span class="ident" id="2040874"><a href="/runtime/netpoll.go.html#2040821">arg</a></span><span class="op" id="2040877">.</span><span class="op" id="2040878">(</span><span class="op" id="2040879">*</span><span class="ident" id="2040880"><a href="/runtime/netpoll.go.html#2031666">pollDesc</a></span><span class="op" id="2040888">)</span><span class="op" id="2040889">,</span>&nbsp;<span class="ident" id="2040891"><a href="/runtime/netpoll.go.html#2040838">seq</a></span><span class="op" id="2040894">,</span>&nbsp;<span class="builtintype" id="2040896">true</span><span class="op" id="2040900">,</span>&nbsp;<span class="builtintype" id="2040902">true</span><span class="op" id="2040906">)</span><br>
<span class="lineno"></span><span class="op" id="2040908">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span><span class="keyword" id="2040911">func</span>&nbsp;<span class="ident" id="2040916">netpollReadDeadline</span><span class="op" id="2040935">(</span><span class="ident" id="2040936">arg</span>&nbsp;<span class="keyword" id="2040940">interface</span><span class="op" id="2040949">{</span><span class="op" id="2040950">}</span><span class="op" id="2040951">,</span>&nbsp;<span class="ident" id="2040953">seq</span>&nbsp;<span class="builtintype" id="2040957">uintptr</span><span class="op" id="2040964">)</span>&nbsp;<span class="op" id="2040966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2040969"><a href="/runtime/netpoll.go.html#2039829">netpolldeadlineimpl</a></span><span class="op" id="2040988">(</span><span class="ident" id="2040989"><a href="/runtime/netpoll.go.html#2040936">arg</a></span><span class="op" id="2040992">.</span><span class="op" id="2040993">(</span><span class="op" id="2040994">*</span><span class="ident" id="2040995"><a href="/runtime/netpoll.go.html#2031666">pollDesc</a></span><span class="op" id="2041003">)</span><span class="op" id="2041004">,</span>&nbsp;<span class="ident" id="2041006"><a href="/runtime/netpoll.go.html#2040953">seq</a></span><span class="op" id="2041009">,</span>&nbsp;<span class="builtintype" id="2041011">true</span><span class="op" id="2041015">,</span>&nbsp;<span class="builtintype" id="2041017">false</span><span class="op" id="2041022">)</span><br>
<span class="lineno"></span><span class="op" id="2041024">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span><span class="keyword" id="2041027">func</span>&nbsp;<span class="ident" id="2041032">netpollWriteDeadline</span><span class="op" id="2041052">(</span><span class="ident" id="2041053">arg</span>&nbsp;<span class="keyword" id="2041057">interface</span><span class="op" id="2041066">{</span><span class="op" id="2041067">}</span><span class="op" id="2041068">,</span>&nbsp;<span class="ident" id="2041070">seq</span>&nbsp;<span class="builtintype" id="2041074">uintptr</span><span class="op" id="2041081">)</span>&nbsp;<span class="op" id="2041083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2041086"><a href="/runtime/netpoll.go.html#2039829">netpolldeadlineimpl</a></span><span class="op" id="2041105">(</span><span class="ident" id="2041106"><a href="/runtime/netpoll.go.html#2041053">arg</a></span><span class="op" id="2041109">.</span><span class="op" id="2041110">(</span><span class="op" id="2041111">*</span><span class="ident" id="2041112"><a href="/runtime/netpoll.go.html#2031666">pollDesc</a></span><span class="op" id="2041120">)</span><span class="op" id="2041121">,</span>&nbsp;<span class="ident" id="2041123"><a href="/runtime/netpoll.go.html#2041070">seq</a></span><span class="op" id="2041126">,</span>&nbsp;<span class="builtintype" id="2041128">false</span><span class="op" id="2041133">,</span>&nbsp;<span class="builtintype" id="2041135">true</span><span class="op" id="2041139">)</span><br>
<span class="lineno"></span><span class="op" id="2041141">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2041144">func</span>&nbsp;<span class="op" id="2041149">(</span><span class="ident" id="2041150">c</span>&nbsp;<span class="op" id="2041152">*</span><span class="ident" id="2041153"><a href="/runtime/netpoll.go.html#2032829">pollCache</a></span><span class="op" id="2041162">)</span>&nbsp;<span class="ident" id="2041164">alloc</span><span class="op" id="2041169">(</span><span class="op" id="2041170">)</span>&nbsp;<span class="op" id="2041172">*</span><span class="ident" id="2041173"><a href="/runtime/netpoll.go.html#2031666">pollDesc</a></span>&nbsp;<span class="op" id="2041182">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2041185"><a href="/runtime/lock_futex.go.html#1978439">lock</a></span><span class="op" id="2041189">(</span><span class="op" id="2041190">&amp;</span><span class="ident" id="2041191"><a href="/runtime/netpoll.go.html#2041150">c</a></span><span class="op" id="2041192">.</span><span class="ident" id="2041193">lock</span><span class="op" id="2041197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2041200">if</span>&nbsp;<span class="ident" id="2041203"><a href="/runtime/netpoll.go.html#2041150">c</a></span><span class="op" id="2041204">.</span><span class="ident" id="2041205">first</span>&nbsp;<span class="op" id="2041211">==</span>&nbsp;<span class="ident" id="2041214">nil</span>&nbsp;<span class="op" id="2041218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2041222">const</span>&nbsp;<span class="ident" id="2041228">pdSize</span>&nbsp;<span class="op" id="2041235">=</span>&nbsp;<span class="ident" id="2041237"><a href="/runtime/netpoll.go.html#2030244">unsafe</a></span><span class="op" id="2041243">.</span><span class="ident" id="2041244">Sizeof</span><span class="op" id="2041250">(</span><span class="ident" id="2041251"><a href="/runtime/netpoll.go.html#2031666">pollDesc</a></span><span class="op" id="2041259">{</span><span class="op" id="2041260">}</span><span class="op" id="2041261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2041265">n</span>&nbsp;<span class="op" id="2041267">:=</span>&nbsp;<span class="ident" id="2041270"><a href="/runtime/netpoll.go.html#2031605">pollBlockSize</a></span>&nbsp;<span class="op" id="2041284">/</span>&nbsp;<span class="ident" id="2041286"><a href="/runtime/netpoll.go.html#2041228">pdSize</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2041295">if</span>&nbsp;<span class="ident" id="2041298"><a href="/runtime/netpoll.go.html#2041265">n</a></span>&nbsp;<span class="op" id="2041300">==</span>&nbsp;<span class="num" id="2041303">0</span>&nbsp;<span class="op" id="2041305">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2041310"><a href="/runtime/netpoll.go.html#2041265">n</a></span>&nbsp;<span class="op" id="2041312">=</span>&nbsp;<span class="num" id="2041314">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2041318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2041322">//&nbsp;Must&nbsp;be&nbsp;in&nbsp;non-GC&nbsp;memory&nbsp;because&nbsp;can&nbsp;be&nbsp;referenced</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2041378">//&nbsp;only&nbsp;from&nbsp;epoll/kqueue&nbsp;internals.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2041417">mem</span>&nbsp;<span class="op" id="2041421">:=</span>&nbsp;<span class="ident" id="2041424"><a href="/runtime/malloc.go.html#2005184">persistentalloc</a></span><span class="op" id="2041439">(</span><span class="ident" id="2041440"><a href="/runtime/netpoll.go.html#2041265">n</a></span><span class="op" id="2041441">*</span><span class="ident" id="2041442"><a href="/runtime/netpoll.go.html#2041228">pdSize</a></span><span class="op" id="2041448">,</span>&nbsp;<span class="num" id="2041450">0</span><span class="op" id="2041451">,</span>&nbsp;<span class="op" id="2041453">&amp;</span><span class="ident" id="2041454"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2186172">memstats</a></span><span class="op" id="2041462">.</span><span class="ident" id="2041463">other_sys</span><span class="op" id="2041472">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2041476">for</span>&nbsp;<span class="ident" id="2041480">i</span>&nbsp;<span class="op" id="2041482">:=</span>&nbsp;<span class="builtintype" id="2041485">uintptr</span><span class="op" id="2041492">(</span><span class="num" id="2041493">0</span><span class="op" id="2041494">)</span><span class="op" id="2041495">;</span>&nbsp;<span class="ident" id="2041497"><a href="/runtime/netpoll.go.html#2041480">i</a></span>&nbsp;<span class="op" id="2041499">&lt;</span>&nbsp;<span class="ident" id="2041501"><a href="/runtime/netpoll.go.html#2041265">n</a></span><span class="op" id="2041502">;</span>&nbsp;<span class="ident" id="2041504"><a href="/runtime/netpoll.go.html#2041480">i</a></span><span class="op" id="2041505">++</span>&nbsp;<span class="op" id="2041508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2041513">pd</span>&nbsp;<span class="op" id="2041516">:=</span>&nbsp;<span class="op" id="2041519">(</span><span class="op" id="2041520">*</span><span class="ident" id="2041521"><a href="/runtime/netpoll.go.html#2031666">pollDesc</a></span><span class="op" id="2041529">)</span><span class="op" id="2041530">(</span><span class="ident" id="2041531"><a href="/runtime/stubs.go.html#2131745">add</a></span><span class="op" id="2041534">(</span><span class="ident" id="2041535"><a href="/runtime/netpoll.go.html#2041417">mem</a></span><span class="op" id="2041538">,</span>&nbsp;<span class="ident" id="2041540"><a href="/runtime/netpoll.go.html#2041480">i</a></span><span class="op" id="2041541">*</span><span class="ident" id="2041542"><a href="/runtime/netpoll.go.html#2041228">pdSize</a></span><span class="op" id="2041548">)</span><span class="op" id="2041549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2041554"><a href="/runtime/netpoll.go.html#2041513">pd</a></span><span class="op" id="2041556">.</span><span class="ident" id="2041557">link</span>&nbsp;<span class="op" id="2041562">=</span>&nbsp;<span class="ident" id="2041564"><a href="/runtime/netpoll.go.html#2041150">c</a></span><span class="op" id="2041565">.</span><span class="ident" id="2041566">first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2041575"><a href="/runtime/netpoll.go.html#2041150">c</a></span><span class="op" id="2041576">.</span><span class="ident" id="2041577">first</span>&nbsp;<span class="op" id="2041583">=</span>&nbsp;<span class="ident" id="2041585"><a href="/runtime/netpoll.go.html#2041513">pd</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2041590">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2041593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2041596">pd</span>&nbsp;<span class="op" id="2041599">:=</span>&nbsp;<span class="ident" id="2041602"><a href="/runtime/netpoll.go.html#2041150">c</a></span><span class="op" id="2041603">.</span><span class="ident" id="2041604">first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2041611"><a href="/runtime/netpoll.go.html#2041150">c</a></span><span class="op" id="2041612">.</span><span class="ident" id="2041613">first</span>&nbsp;<span class="op" id="2041619">=</span>&nbsp;<span class="ident" id="2041621"><a href="/runtime/netpoll.go.html#2041596">pd</a></span><span class="op" id="2041623">.</span><span class="ident" id="2041624">link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2041630"><a href="/runtime/lock_futex.go.html#1979731">unlock</a></span><span class="op" id="2041636">(</span><span class="op" id="2041637">&amp;</span><span class="ident" id="2041638"><a href="/runtime/netpoll.go.html#2041150">c</a></span><span class="op" id="2041639">.</span><span class="ident" id="2041640">lock</span><span class="op" id="2041644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2041647">return</span>&nbsp;<span class="ident" id="2041654"><a href="/runtime/netpoll.go.html#2041596">pd</a></span><br>
<span class="lineno">455</span><span class="op" id="2041657">}</span>
</div>
</body>
</html>
