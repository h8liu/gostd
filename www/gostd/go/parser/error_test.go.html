<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="8393986">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8394041">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8394095">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="8394146">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;a&nbsp;parser&nbsp;test&nbsp;harness.&nbsp;The&nbsp;files&nbsp;in&nbsp;the&nbsp;testdata</span><br>
<span class="lineno"></span><span class="comment" id="8394219">//&nbsp;directory&nbsp;are&nbsp;parsed&nbsp;and&nbsp;the&nbsp;errors&nbsp;reported&nbsp;are&nbsp;compared&nbsp;against&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="8394292">//&nbsp;error&nbsp;messages&nbsp;expected&nbsp;in&nbsp;the&nbsp;test&nbsp;files.&nbsp;The&nbsp;test&nbsp;files&nbsp;must&nbsp;end&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="8394365">//&nbsp;.src&nbsp;rather&nbsp;than&nbsp;.go&nbsp;so&nbsp;that&nbsp;they&nbsp;are&nbsp;not&nbsp;disturbed&nbsp;by&nbsp;gofmt&nbsp;runs.</span><br>
<span class="lineno"></span><span class="comment" id="8394435">//</span><br>
<span class="lineno">10</span><span class="comment" id="8394438">//&nbsp;Expected&nbsp;errors&nbsp;are&nbsp;indicated&nbsp;in&nbsp;the&nbsp;test&nbsp;files&nbsp;by&nbsp;putting&nbsp;a&nbsp;comment</span><br>
<span class="lineno"></span><span class="comment" id="8394510">//&nbsp;of&nbsp;the&nbsp;form&nbsp;/*&nbsp;ERROR&nbsp;&#34;rx&#34;&nbsp;*/&nbsp;immediately&nbsp;following&nbsp;an&nbsp;offending&nbsp;token.</span><br>
<span class="lineno"></span><span class="comment" id="8394584">//&nbsp;The&nbsp;harness&nbsp;will&nbsp;verify&nbsp;that&nbsp;an&nbsp;error&nbsp;matching&nbsp;the&nbsp;regular&nbsp;expression</span><br>
<span class="lineno"></span><span class="comment" id="8394657">//&nbsp;rx&nbsp;is&nbsp;reported&nbsp;at&nbsp;that&nbsp;source&nbsp;position.</span><br>
<span class="lineno"></span><span class="comment" id="8394700">//</span><br>
<span class="lineno">15</span><span class="comment" id="8394703">//&nbsp;For&nbsp;instance,&nbsp;the&nbsp;following&nbsp;test&nbsp;file&nbsp;indicates&nbsp;that&nbsp;a&nbsp;&#34;not&nbsp;declared&#34;</span><br>
<span class="lineno"></span><span class="comment" id="8394776">//&nbsp;error&nbsp;should&nbsp;be&nbsp;reported&nbsp;for&nbsp;the&nbsp;undeclared&nbsp;variable&nbsp;x:</span><br>
<span class="lineno"></span><span class="comment" id="8394835">//</span><br>
<span class="lineno"></span><span class="comment" id="8394838">//&nbsp;&nbsp;&nbsp;&nbsppackage&nbsp;p</span><br>
<span class="lineno"></span><span class="comment" id="8394851">//&nbsp;&nbsp;&nbsp;&nbspfunc&nbsp;f()&nbsp;{</span><br>
<span class="lineno">20</span><span class="comment" id="8394865">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp_&nbsp;=&nbsp;x&nbsp;/*&nbsp;ERROR&nbsp;&#34;not&nbsp;declared&#34;&nbsp;*/&nbsp;+&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="8394906">//&nbsp;&nbsp;&nbsp;&nbsp}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8394912">package</span>&nbsp;<span class="ident" id="8394920">parser</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="8394928">import</span>&nbsp;<span class="op" id="8394935">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8394938">&#34;go/scanner&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8394952">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8394964">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8394977">&#34;path/filepath&#34;</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8394994">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8395004">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8395015">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8395025">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="keyword" id="8395028">const</span>&nbsp;<span class="ident" id="8395034">testdata</span>&nbsp;<span class="op" id="8395043">=</span>&nbsp;<span class="string" id="8395045">&#34;testdata&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8395057">var</span>&nbsp;<span class="ident" id="8395061">fsetErrs</span>&nbsp;<span class="op" id="8395070">=</span>&nbsp;<span class="ident" id="8395072">token</span><span class="op" id="8395077">.</span><span class="ident" id="8395078">NewFileSet</span><span class="op" id="8395088">(</span><span class="op" id="8395089">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8395092">//&nbsp;getFile&nbsp;assumes&nbsp;that&nbsp;each&nbsp;filename&nbsp;occurs&nbsp;at&nbsp;most&nbsp;once</span><br>
<span class="lineno">40</span><span class="keyword" id="8395150">func</span>&nbsp;<span class="ident" id="8395155">getFile</span><span class="op" id="8395162">(</span><span class="ident" id="8395163">filename</span>&nbsp;<span class="builtintype" id="8395172">string</span><span class="op" id="8395178">)</span>&nbsp;<span class="op" id="8395180">(</span><span class="ident" id="8395181">file</span>&nbsp;<span class="op" id="8395186">*</span><span class="ident" id="8395187">token</span><span class="op" id="8395192">.</span><span class="ident" id="8395193">File</span><span class="op" id="8395197">)</span>&nbsp;<span class="op" id="8395199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8395202">fsetErrs</span><span class="op" id="8395210">.</span><span class="ident" id="8395211">Iterate</span><span class="op" id="8395218">(</span><span class="keyword" id="8395219">func</span><span class="op" id="8395223">(</span><span class="ident" id="8395224">f</span>&nbsp;<span class="op" id="8395226">*</span><span class="ident" id="8395227">token</span><span class="op" id="8395232">.</span><span class="ident" id="8395233">File</span><span class="op" id="8395237">)</span>&nbsp;<span class="builtintype" id="8395239">bool</span>&nbsp;<span class="op" id="8395244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8395248">if</span>&nbsp;<span class="ident" id="8395251">f</span><span class="op" id="8395252">.</span><span class="ident" id="8395253">Name</span><span class="op" id="8395257">(</span><span class="op" id="8395258">)</span>&nbsp;<span class="op" id="8395260">==</span>&nbsp;<span class="ident" id="8395263">filename</span>&nbsp;<span class="op" id="8395272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8395277">if</span>&nbsp;<span class="ident" id="8395280">file</span>&nbsp;<span class="op" id="8395285">!=</span>&nbsp;<span class="ident" id="8395288">nil</span>&nbsp;<span class="op" id="8395292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8395298">panic</span><span class="op" id="8395303">(</span><span class="ident" id="8395304">filename</span>&nbsp;<span class="op" id="8395313">+</span>&nbsp;<span class="string" id="8395315">&#34;&nbsp;used&nbsp;multiple&nbsp;times&#34;</span><span class="op" id="8395337">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8395342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8395347">file</span>&nbsp;<span class="op" id="8395352">=</span>&nbsp;<span class="ident" id="8395354">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8395358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8395362">return</span>&nbsp;<span class="builtintype" id="8395369">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8395375">}</span><span class="op" id="8395376">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8395379">return</span>&nbsp;<span class="ident" id="8395386">file</span><br>
<span class="lineno"></span><span class="op" id="8395391">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8395394">func</span>&nbsp;<span class="ident" id="8395399">getPos</span><span class="op" id="8395405">(</span><span class="ident" id="8395406">filename</span>&nbsp;<span class="builtintype" id="8395415">string</span><span class="op" id="8395421">,</span>&nbsp;<span class="ident" id="8395423">offset</span>&nbsp;<span class="builtintype" id="8395430">int</span><span class="op" id="8395433">)</span>&nbsp;<span class="ident" id="8395435">token</span><span class="op" id="8395440">.</span><span class="ident" id="8395441">Pos</span>&nbsp;<span class="op" id="8395445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8395448">if</span>&nbsp;<span class="ident" id="8395451">f</span>&nbsp;<span class="op" id="8395453">:=</span>&nbsp;<span class="ident" id="8395456">getFile</span><span class="op" id="8395463">(</span><span class="ident" id="8395464">filename</span><span class="op" id="8395472">)</span><span class="op" id="8395473">;</span>&nbsp;<span class="ident" id="8395475">f</span>&nbsp;<span class="op" id="8395477">!=</span>&nbsp;<span class="ident" id="8395480">nil</span>&nbsp;<span class="op" id="8395484">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8395488">return</span>&nbsp;<span class="ident" id="8395495">f</span><span class="op" id="8395496">.</span><span class="ident" id="8395497">Pos</span><span class="op" id="8395500">(</span><span class="ident" id="8395501">offset</span><span class="op" id="8395507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8395510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8395513">return</span>&nbsp;<span class="ident" id="8395520">token</span><span class="op" id="8395525">.</span><span class="ident" id="8395526">NoPos</span><br>
<span class="lineno"></span><span class="op" id="8395532">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="8395535">//&nbsp;ERROR&nbsp;comments&nbsp;must&nbsp;be&nbsp;of&nbsp;the&nbsp;form&nbsp;/*&nbsp;ERROR&nbsp;&#34;rx&#34;&nbsp;*/&nbsp;and&nbsp;rx&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="8395600">//&nbsp;a&nbsp;regular&nbsp;expression&nbsp;that&nbsp;matches&nbsp;the&nbsp;expected&nbsp;error&nbsp;message.</span><br>
<span class="lineno"></span><span class="comment" id="8395665">//&nbsp;The&nbsp;special&nbsp;form&nbsp;/*&nbsp;ERROR&nbsp;HERE&nbsp;&#34;rx&#34;&nbsp;*/&nbsp;must&nbsp;be&nbsp;used&nbsp;for&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="8395730">//&nbsp;messages&nbsp;that&nbsp;appear&nbsp;immediately&nbsp;after&nbsp;a&nbsp;token,&nbsp;rather&nbsp;than&nbsp;at</span><br>
<span class="lineno"></span><span class="comment" id="8395796">//&nbsp;a&nbsp;token&#39;s&nbsp;position.</span><br>
<span class="lineno">65</span><span class="comment" id="8395819">//</span><br>
<span class="lineno"></span><span class="keyword" id="8395822">var</span>&nbsp;<span class="ident" id="8395826">errRx</span>&nbsp;<span class="op" id="8395832">=</span>&nbsp;<span class="ident" id="8395834">regexp</span><span class="op" id="8395840">.</span><span class="ident" id="8395841">MustCompile</span><span class="op" id="8395852">(</span><span class="string" id="8395853">`^/\*&nbsp;*ERROR&nbsp;*(HERE)?&nbsp;*&#34;([^&#34;]*)&#34;&nbsp;*\*/$`</span><span class="op" id="8395892">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8395895">//&nbsp;expectedErrors&nbsp;collects&nbsp;the&nbsp;regular&nbsp;expressions&nbsp;of&nbsp;ERROR&nbsp;comments&nbsp;found</span><br>
<span class="lineno"></span><span class="comment" id="8395970">//&nbsp;in&nbsp;files&nbsp;and&nbsp;returns&nbsp;them&nbsp;as&nbsp;a&nbsp;map&nbsp;of&nbsp;error&nbsp;positions&nbsp;to&nbsp;error&nbsp;messages.</span><br>
<span class="lineno">70</span><span class="comment" id="8396046">//</span><br>
<span class="lineno"></span><span class="keyword" id="8396049">func</span>&nbsp;<span class="ident" id="8396054">expectedErrors</span><span class="op" id="8396068">(</span><span class="ident" id="8396069">t</span>&nbsp;<span class="op" id="8396071">*</span><span class="ident" id="8396072">testing</span><span class="op" id="8396079">.</span><span class="ident" id="8396080">T</span><span class="op" id="8396081">,</span>&nbsp;<span class="ident" id="8396083">filename</span>&nbsp;<span class="builtintype" id="8396092">string</span><span class="op" id="8396098">,</span>&nbsp;<span class="ident" id="8396100">src</span>&nbsp;<span class="op" id="8396104">[</span><span class="op" id="8396105">]</span><span class="builtintype" id="8396106">byte</span><span class="op" id="8396110">)</span>&nbsp;<span class="keyword" id="8396112">map</span><span class="op" id="8396115">[</span><span class="ident" id="8396116">token</span><span class="op" id="8396121">.</span><span class="ident" id="8396122">Pos</span><span class="op" id="8396125">]</span><span class="builtintype" id="8396126">string</span>&nbsp;<span class="op" id="8396133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8396136">errors</span>&nbsp;<span class="op" id="8396143">:=</span>&nbsp;<span class="builtinfunc" id="8396146">make</span><span class="op" id="8396150">(</span><span class="keyword" id="8396151">map</span><span class="op" id="8396154">[</span><span class="ident" id="8396155">token</span><span class="op" id="8396160">.</span><span class="ident" id="8396161">Pos</span><span class="op" id="8396164">]</span><span class="builtintype" id="8396165">string</span><span class="op" id="8396171">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8396175">var</span>&nbsp;<span class="ident" id="8396179">s</span>&nbsp;<span class="ident" id="8396181">scanner</span><span class="op" id="8396188">.</span><span class="ident" id="8396189">Scanner</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8396198">//&nbsp;file&nbsp;was&nbsp;parsed&nbsp;already&nbsp;-&nbsp;do&nbsp;not&nbsp;add&nbsp;it&nbsp;again&nbsp;to&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8396260">//&nbsp;set&nbsp;otherwise&nbsp;the&nbsp;position&nbsp;information&nbsp;returned&nbsp;here&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8396322">//&nbsp;not&nbsp;match&nbsp;the&nbsp;position&nbsp;information&nbsp;collected&nbsp;by&nbsp;the&nbsp;parser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8396385">s</span><span class="op" id="8396386">.</span><span class="ident" id="8396387">Init</span><span class="op" id="8396391">(</span><span class="ident" id="8396392">getFile</span><span class="op" id="8396399">(</span><span class="ident" id="8396400">filename</span><span class="op" id="8396408">)</span><span class="op" id="8396409">,</span>&nbsp;<span class="ident" id="8396411">src</span><span class="op" id="8396414">,</span>&nbsp;<span class="ident" id="8396416">nil</span><span class="op" id="8396419">,</span>&nbsp;<span class="ident" id="8396421">scanner</span><span class="op" id="8396428">.</span><span class="ident" id="8396429">ScanComments</span><span class="op" id="8396441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8396444">var</span>&nbsp;<span class="ident" id="8396448">prev</span>&nbsp;<span class="ident" id="8396453">token</span><span class="op" id="8396458">.</span><span class="ident" id="8396459">Pos</span>&nbsp;<span class="comment" id="8396463">//&nbsp;position&nbsp;of&nbsp;last&nbsp;non-comment,&nbsp;non-semicolon&nbsp;token</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8396517">var</span>&nbsp;<span class="ident" id="8396521">here</span>&nbsp;<span class="ident" id="8396526">token</span><span class="op" id="8396531">.</span><span class="ident" id="8396532">Pos</span>&nbsp;<span class="comment" id="8396536">//&nbsp;position&nbsp;immediately&nbsp;after&nbsp;the&nbsp;token&nbsp;at&nbsp;position&nbsp;prev</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8396595">for</span>&nbsp;<span class="op" id="8396599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8396603">pos</span><span class="op" id="8396606">,</span>&nbsp;<span class="ident" id="8396608">tok</span><span class="op" id="8396611">,</span>&nbsp;<span class="ident" id="8396613">lit</span>&nbsp;<span class="op" id="8396617">:=</span>&nbsp;<span class="ident" id="8396620">s</span><span class="op" id="8396621">.</span><span class="ident" id="8396622">Scan</span><span class="op" id="8396626">(</span><span class="op" id="8396627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8396631">switch</span>&nbsp;<span class="ident" id="8396638">tok</span>&nbsp;<span class="op" id="8396642">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8396646">case</span>&nbsp;<span class="ident" id="8396651">token</span><span class="op" id="8396656">.</span><span class="ident" id="8396657">EOF</span><span class="op" id="8396660">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8396665">return</span>&nbsp;<span class="ident" id="8396672">errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8396681">case</span>&nbsp;<span class="ident" id="8396686">token</span><span class="op" id="8396691">.</span><span class="ident" id="8396692">COMMENT</span><span class="op" id="8396699">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8396704">s</span>&nbsp;<span class="op" id="8396706">:=</span>&nbsp;<span class="ident" id="8396709">errRx</span><span class="op" id="8396714">.</span><span class="ident" id="8396715">FindStringSubmatch</span><span class="op" id="8396733">(</span><span class="ident" id="8396734">lit</span><span class="op" id="8396737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8396742">if</span>&nbsp;<span class="builtinfunc" id="8396745">len</span><span class="op" id="8396748">(</span><span class="ident" id="8396749">s</span><span class="op" id="8396750">)</span>&nbsp;<span class="op" id="8396752">==</span>&nbsp;<span class="num" id="8396755">3</span>&nbsp;<span class="op" id="8396757">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8396763">pos</span>&nbsp;<span class="op" id="8396767">:=</span>&nbsp;<span class="ident" id="8396770">prev</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8396779">if</span>&nbsp;<span class="ident" id="8396782">s</span><span class="op" id="8396783">[</span><span class="num" id="8396784">1</span><span class="op" id="8396785">]</span>&nbsp;<span class="op" id="8396787">==</span>&nbsp;<span class="string" id="8396790">&#34;HERE&#34;</span>&nbsp;<span class="op" id="8396797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8396804">pos</span>&nbsp;<span class="op" id="8396808">=</span>&nbsp;<span class="ident" id="8396810">here</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8396819">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8396825">errors</span><span class="op" id="8396831">[</span><span class="ident" id="8396832">pos</span><span class="op" id="8396835">]</span>&nbsp;<span class="op" id="8396837">=</span>&nbsp;<span class="builtintype" id="8396839">string</span><span class="op" id="8396845">(</span><span class="ident" id="8396846">s</span><span class="op" id="8396847">[</span><span class="num" id="8396848">2</span><span class="op" id="8396849">]</span><span class="op" id="8396850">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8396855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8396859">default</span><span class="op" id="8396866">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8396871">prev</span>&nbsp;<span class="op" id="8396876">=</span>&nbsp;<span class="ident" id="8396878">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8396885">var</span>&nbsp;<span class="ident" id="8396889">l</span>&nbsp;<span class="builtintype" id="8396891">int</span>&nbsp;<span class="comment" id="8396895">//&nbsp;token&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8396914">if</span>&nbsp;<span class="ident" id="8396917">tok</span><span class="op" id="8396920">.</span><span class="ident" id="8396921">IsLiteral</span><span class="op" id="8396930">(</span><span class="op" id="8396931">)</span>&nbsp;<span class="op" id="8396933">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8396939">l</span>&nbsp;<span class="op" id="8396941">=</span>&nbsp;<span class="builtinfunc" id="8396943">len</span><span class="op" id="8396946">(</span><span class="ident" id="8396947">lit</span><span class="op" id="8396950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8396955">}</span>&nbsp;<span class="keyword" id="8396957">else</span>&nbsp;<span class="op" id="8396962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8396968">l</span>&nbsp;<span class="op" id="8396970">=</span>&nbsp;<span class="builtinfunc" id="8396972">len</span><span class="op" id="8396975">(</span><span class="ident" id="8396976">tok</span><span class="op" id="8396979">.</span><span class="ident" id="8396980">String</span><span class="op" id="8396986">(</span><span class="op" id="8396987">)</span><span class="op" id="8396988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8396993">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8396998">here</span>&nbsp;<span class="op" id="8397003">=</span>&nbsp;<span class="ident" id="8397005">prev</span>&nbsp;<span class="op" id="8397010">+</span>&nbsp;<span class="ident" id="8397012">token</span><span class="op" id="8397017">.</span><span class="ident" id="8397018">Pos</span><span class="op" id="8397021">(</span><span class="ident" id="8397022">l</span><span class="op" id="8397023">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8397027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8397030">}</span><br>
<span class="lineno"></span><span class="op" id="8397032">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8397035">//&nbsp;compareErrors&nbsp;compares&nbsp;the&nbsp;map&nbsp;of&nbsp;expected&nbsp;error&nbsp;messages&nbsp;with&nbsp;the&nbsp;list</span><br>
<span class="lineno">110</span><span class="comment" id="8397110">//&nbsp;of&nbsp;found&nbsp;errors&nbsp;and&nbsp;reports&nbsp;discrepancies.</span><br>
<span class="lineno"></span><span class="comment" id="8397156">//</span><br>
<span class="lineno"></span><span class="keyword" id="8397159">func</span>&nbsp;<span class="ident" id="8397164">compareErrors</span><span class="op" id="8397177">(</span><span class="ident" id="8397178">t</span>&nbsp;<span class="op" id="8397180">*</span><span class="ident" id="8397181">testing</span><span class="op" id="8397188">.</span><span class="ident" id="8397189">T</span><span class="op" id="8397190">,</span>&nbsp;<span class="ident" id="8397192">expected</span>&nbsp;<span class="keyword" id="8397201">map</span><span class="op" id="8397204">[</span><span class="ident" id="8397205">token</span><span class="op" id="8397210">.</span><span class="ident" id="8397211">Pos</span><span class="op" id="8397214">]</span><span class="builtintype" id="8397215">string</span><span class="op" id="8397221">,</span>&nbsp;<span class="ident" id="8397223">found</span>&nbsp;<span class="ident" id="8397229">scanner</span><span class="op" id="8397236">.</span><span class="ident" id="8397237">ErrorList</span><span class="op" id="8397246">)</span>&nbsp;<span class="op" id="8397248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8397251">for</span>&nbsp;<span class="ident" id="8397255">_</span><span class="op" id="8397256">,</span>&nbsp;<span class="builtintype" id="8397258">error</span>&nbsp;<span class="op" id="8397264">:=</span>&nbsp;<span class="keyword" id="8397267">range</span>&nbsp;<span class="ident" id="8397273">found</span>&nbsp;<span class="op" id="8397279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8397283">//&nbsp;error.Pos&nbsp;is&nbsp;a&nbsp;token.Position,&nbsp;but&nbsp;we&nbsp;want</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8397331">//&nbsp;a&nbsp;token.Pos&nbsp;so&nbsp;we&nbsp;can&nbsp;do&nbsp;a&nbsp;map&nbsp;lookup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8397374">pos</span>&nbsp;<span class="op" id="8397378">:=</span>&nbsp;<span class="ident" id="8397381">getPos</span><span class="op" id="8397387">(</span><span class="builtintype" id="8397388">error</span><span class="op" id="8397393">.</span><span class="ident" id="8397394">Pos</span><span class="op" id="8397397">.</span><span class="ident" id="8397398">Filename</span><span class="op" id="8397406">,</span>&nbsp;<span class="builtintype" id="8397408">error</span><span class="op" id="8397413">.</span><span class="ident" id="8397414">Pos</span><span class="op" id="8397417">.</span><span class="ident" id="8397418">Offset</span><span class="op" id="8397424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8397428">if</span>&nbsp;<span class="ident" id="8397431">msg</span><span class="op" id="8397434">,</span>&nbsp;<span class="ident" id="8397436">found</span>&nbsp;<span class="op" id="8397442">:=</span>&nbsp;<span class="ident" id="8397445">expected</span><span class="op" id="8397453">[</span><span class="ident" id="8397454">pos</span><span class="op" id="8397457">]</span><span class="op" id="8397458">;</span>&nbsp;<span class="ident" id="8397460">found</span>&nbsp;<span class="op" id="8397466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8397471">//&nbsp;we&nbsp;expect&nbsp;a&nbsp;message&nbsp;at&nbsp;pos;&nbsp;check&nbsp;if&nbsp;it&nbsp;matches</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8397525">rx</span><span class="op" id="8397527">,</span>&nbsp;<span class="ident" id="8397529">err</span>&nbsp;<span class="op" id="8397533">:=</span>&nbsp;<span class="ident" id="8397536">regexp</span><span class="op" id="8397542">.</span><span class="ident" id="8397543">Compile</span><span class="op" id="8397550">(</span><span class="ident" id="8397551">msg</span><span class="op" id="8397554">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8397559">if</span>&nbsp;<span class="ident" id="8397562">err</span>&nbsp;<span class="op" id="8397566">!=</span>&nbsp;<span class="ident" id="8397569">nil</span>&nbsp;<span class="op" id="8397573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8397579">t</span><span class="op" id="8397580">.</span><span class="ident" id="8397581">Errorf</span><span class="op" id="8397587">(</span><span class="string" id="8397588">&#34;%s:&nbsp;%v&#34;</span><span class="op" id="8397596">,</span>&nbsp;<span class="builtintype" id="8397598">error</span><span class="op" id="8397603">.</span><span class="ident" id="8397604">Pos</span><span class="op" id="8397607">,</span>&nbsp;<span class="ident" id="8397609">err</span><span class="op" id="8397612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8397618">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8397630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8397635">if</span>&nbsp;<span class="ident" id="8397638">match</span>&nbsp;<span class="op" id="8397644">:=</span>&nbsp;<span class="ident" id="8397647">rx</span><span class="op" id="8397649">.</span><span class="ident" id="8397650">MatchString</span><span class="op" id="8397661">(</span><span class="builtintype" id="8397662">error</span><span class="op" id="8397667">.</span><span class="ident" id="8397668">Msg</span><span class="op" id="8397671">)</span><span class="op" id="8397672">;</span>&nbsp;<span class="op" id="8397674">!</span><span class="ident" id="8397675">match</span>&nbsp;<span class="op" id="8397681">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8397687">t</span><span class="op" id="8397688">.</span><span class="ident" id="8397689">Errorf</span><span class="op" id="8397695">(</span><span class="string" id="8397696">&#34;%s:&nbsp;%q&nbsp;does&nbsp;not&nbsp;match&nbsp;%q&#34;</span><span class="op" id="8397722">,</span>&nbsp;<span class="builtintype" id="8397724">error</span><span class="op" id="8397729">.</span><span class="ident" id="8397730">Pos</span><span class="op" id="8397733">,</span>&nbsp;<span class="builtintype" id="8397735">error</span><span class="op" id="8397740">.</span><span class="ident" id="8397741">Msg</span><span class="op" id="8397744">,</span>&nbsp;<span class="ident" id="8397746">msg</span><span class="op" id="8397749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8397755">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8397767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8397772">//&nbsp;we&nbsp;have&nbsp;a&nbsp;match&nbsp;-&nbsp;eliminate&nbsp;this&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8397817">delete</span><span class="op" id="8397823">(</span><span class="ident" id="8397824">expected</span><span class="op" id="8397832">,</span>&nbsp;<span class="ident" id="8397834">pos</span><span class="op" id="8397837">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8397841">}</span>&nbsp;<span class="keyword" id="8397843">else</span>&nbsp;<span class="op" id="8397848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8397853">//&nbsp;To&nbsp;keep&nbsp;in&nbsp;mind&nbsp;when&nbsp;analyzing&nbsp;failed&nbsp;test&nbsp;output:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8397910">//&nbsp;If&nbsp;the&nbsp;same&nbsp;error&nbsp;position&nbsp;occurs&nbsp;multiple&nbsp;times&nbsp;in&nbsp;errors,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8397976">//&nbsp;this&nbsp;message&nbsp;will&nbsp;be&nbsp;triggered&nbsp;(because&nbsp;the&nbsp;first&nbsp;error&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8398041">//&nbsp;the&nbsp;position&nbsp;removes&nbsp;this&nbsp;position&nbsp;from&nbsp;the&nbsp;expected&nbsp;errors).</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8398109">t</span><span class="op" id="8398110">.</span><span class="ident" id="8398111">Errorf</span><span class="op" id="8398117">(</span><span class="string" id="8398118">&#34;%s:&nbsp;unexpected&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="8398144">,</span>&nbsp;<span class="builtintype" id="8398146">error</span><span class="op" id="8398151">.</span><span class="ident" id="8398152">Pos</span><span class="op" id="8398155">,</span>&nbsp;<span class="builtintype" id="8398157">error</span><span class="op" id="8398162">.</span><span class="ident" id="8398163">Msg</span><span class="op" id="8398166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8398170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8398173">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8398177">//&nbsp;there&nbsp;should&nbsp;be&nbsp;no&nbsp;expected&nbsp;errors&nbsp;left</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8398221">if</span>&nbsp;<span class="builtinfunc" id="8398224">len</span><span class="op" id="8398227">(</span><span class="ident" id="8398228">expected</span><span class="op" id="8398236">)</span>&nbsp;<span class="op" id="8398238">&gt;</span>&nbsp;<span class="num" id="8398240">0</span>&nbsp;<span class="op" id="8398242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8398246">t</span><span class="op" id="8398247">.</span><span class="ident" id="8398248">Errorf</span><span class="op" id="8398254">(</span><span class="string" id="8398255">&#34;%d&nbsp;errors&nbsp;not&nbsp;reported:&#34;</span><span class="op" id="8398280">,</span>&nbsp;<span class="builtinfunc" id="8398282">len</span><span class="op" id="8398285">(</span><span class="ident" id="8398286">expected</span><span class="op" id="8398294">)</span><span class="op" id="8398295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8398299">for</span>&nbsp;<span class="ident" id="8398303">pos</span><span class="op" id="8398306">,</span>&nbsp;<span class="ident" id="8398308">msg</span>&nbsp;<span class="op" id="8398312">:=</span>&nbsp;<span class="keyword" id="8398315">range</span>&nbsp;<span class="ident" id="8398321">expected</span>&nbsp;<span class="op" id="8398330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8398335">t</span><span class="op" id="8398336">.</span><span class="ident" id="8398337">Errorf</span><span class="op" id="8398343">(</span><span class="string" id="8398344">&#34;%s:&nbsp;%s\n&#34;</span><span class="op" id="8398354">,</span>&nbsp;<span class="ident" id="8398356">fsetErrs</span><span class="op" id="8398364">.</span><span class="ident" id="8398365">Position</span><span class="op" id="8398373">(</span><span class="ident" id="8398374">pos</span><span class="op" id="8398377">)</span><span class="op" id="8398378">,</span>&nbsp;<span class="ident" id="8398380">msg</span><span class="op" id="8398383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8398387">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8398390">}</span><br>
<span class="lineno"></span><span class="op" id="8398392">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8398395">func</span>&nbsp;<span class="ident" id="8398400">checkErrors</span><span class="op" id="8398411">(</span><span class="ident" id="8398412">t</span>&nbsp;<span class="op" id="8398414">*</span><span class="ident" id="8398415">testing</span><span class="op" id="8398422">.</span><span class="ident" id="8398423">T</span><span class="op" id="8398424">,</span>&nbsp;<span class="ident" id="8398426">filename</span>&nbsp;<span class="builtintype" id="8398435">string</span><span class="op" id="8398441">,</span>&nbsp;<span class="ident" id="8398443">input</span>&nbsp;<span class="keyword" id="8398449">interface</span><span class="op" id="8398458">{</span><span class="op" id="8398459">}</span><span class="op" id="8398460">)</span>&nbsp;<span class="op" id="8398462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8398465">src</span><span class="op" id="8398468">,</span>&nbsp;<span class="ident" id="8398470">err</span>&nbsp;<span class="op" id="8398474">:=</span>&nbsp;<span class="ident" id="8398477">readSource</span><span class="op" id="8398487">(</span><span class="ident" id="8398488">filename</span><span class="op" id="8398496">,</span>&nbsp;<span class="ident" id="8398498">input</span><span class="op" id="8398503">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8398506">if</span>&nbsp;<span class="ident" id="8398509">err</span>&nbsp;<span class="op" id="8398513">!=</span>&nbsp;<span class="ident" id="8398516">nil</span>&nbsp;<span class="op" id="8398520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8398524">t</span><span class="op" id="8398525">.</span><span class="ident" id="8398526">Error</span><span class="op" id="8398531">(</span><span class="ident" id="8398532">err</span><span class="op" id="8398535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8398539">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8398547">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8398551">_</span><span class="op" id="8398552">,</span>&nbsp;<span class="ident" id="8398554">err</span>&nbsp;<span class="op" id="8398558">=</span>&nbsp;<span class="ident" id="8398560">ParseFile</span><span class="op" id="8398569">(</span><span class="ident" id="8398570">fsetErrs</span><span class="op" id="8398578">,</span>&nbsp;<span class="ident" id="8398580">filename</span><span class="op" id="8398588">,</span>&nbsp;<span class="ident" id="8398590">src</span><span class="op" id="8398593">,</span>&nbsp;<span class="ident" id="8398595">DeclarationErrors</span><span class="op" id="8398612">|</span><span class="ident" id="8398613">AllErrors</span><span class="op" id="8398622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8398625">found</span><span class="op" id="8398630">,</span>&nbsp;<span class="ident" id="8398632">ok</span>&nbsp;<span class="op" id="8398635">:=</span>&nbsp;<span class="ident" id="8398638">err</span><span class="op" id="8398641">.</span><span class="op" id="8398642">(</span><span class="ident" id="8398643">scanner</span><span class="op" id="8398650">.</span><span class="ident" id="8398651">ErrorList</span><span class="op" id="8398660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8398663">if</span>&nbsp;<span class="ident" id="8398666">err</span>&nbsp;<span class="op" id="8398670">!=</span>&nbsp;<span class="ident" id="8398673">nil</span>&nbsp;<span class="op" id="8398677">&amp;&amp;</span>&nbsp;<span class="op" id="8398680">!</span><span class="ident" id="8398681">ok</span>&nbsp;<span class="op" id="8398684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8398688">t</span><span class="op" id="8398689">.</span><span class="ident" id="8398690">Error</span><span class="op" id="8398695">(</span><span class="ident" id="8398696">err</span><span class="op" id="8398699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8398703">return</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8398711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8398714">found</span><span class="op" id="8398719">.</span><span class="ident" id="8398720">RemoveMultiples</span><span class="op" id="8398735">(</span><span class="op" id="8398736">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8398740">//&nbsp;we&nbsp;are&nbsp;expecting&nbsp;the&nbsp;following&nbsp;errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8398782">//&nbsp;(collect&nbsp;these&nbsp;after&nbsp;parsing&nbsp;a&nbsp;file&nbsp;so&nbsp;that&nbsp;it&nbsp;is&nbsp;found&nbsp;in&nbsp;the&nbsp;file&nbsp;set)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8398859">expected</span>&nbsp;<span class="op" id="8398868">:=</span>&nbsp;<span class="ident" id="8398871">expectedErrors</span><span class="op" id="8398885">(</span><span class="ident" id="8398886">t</span><span class="op" id="8398887">,</span>&nbsp;<span class="ident" id="8398889">filename</span><span class="op" id="8398897">,</span>&nbsp;<span class="ident" id="8398899">src</span><span class="op" id="8398902">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8398906">//&nbsp;verify&nbsp;errors&nbsp;returned&nbsp;by&nbsp;the&nbsp;parser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8398947">compareErrors</span><span class="op" id="8398960">(</span><span class="ident" id="8398961">t</span><span class="op" id="8398962">,</span>&nbsp;<span class="ident" id="8398964">expected</span><span class="op" id="8398972">,</span>&nbsp;<span class="ident" id="8398974">found</span><span class="op" id="8398979">)</span><br>
<span class="lineno"></span><span class="op" id="8398981">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="8398984">func</span>&nbsp;<span class="ident" id="8398989">TestErrors</span><span class="op" id="8398999">(</span><span class="ident" id="8399000">t</span>&nbsp;<span class="op" id="8399002">*</span><span class="ident" id="8399003">testing</span><span class="op" id="8399010">.</span><span class="ident" id="8399011">T</span><span class="op" id="8399012">)</span>&nbsp;<span class="op" id="8399014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8399017">list</span><span class="op" id="8399021">,</span>&nbsp;<span class="ident" id="8399023">err</span>&nbsp;<span class="op" id="8399027">:=</span>&nbsp;<span class="ident" id="8399030">ioutil</span><span class="op" id="8399036">.</span><span class="ident" id="8399037">ReadDir</span><span class="op" id="8399044">(</span><span class="ident" id="8399045">testdata</span><span class="op" id="8399053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8399056">if</span>&nbsp;<span class="ident" id="8399059">err</span>&nbsp;<span class="op" id="8399063">!=</span>&nbsp;<span class="ident" id="8399066">nil</span>&nbsp;<span class="op" id="8399070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8399074">t</span><span class="op" id="8399075">.</span><span class="ident" id="8399076">Fatal</span><span class="op" id="8399081">(</span><span class="ident" id="8399082">err</span><span class="op" id="8399085">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8399088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8399091">for</span>&nbsp;<span class="ident" id="8399095">_</span><span class="op" id="8399096">,</span>&nbsp;<span class="ident" id="8399098">fi</span>&nbsp;<span class="op" id="8399101">:=</span>&nbsp;<span class="keyword" id="8399104">range</span>&nbsp;<span class="ident" id="8399110">list</span>&nbsp;<span class="op" id="8399115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8399119">name</span>&nbsp;<span class="op" id="8399124">:=</span>&nbsp;<span class="ident" id="8399127">fi</span><span class="op" id="8399129">.</span><span class="ident" id="8399130">Name</span><span class="op" id="8399134">(</span><span class="op" id="8399135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8399139">if</span>&nbsp;<span class="op" id="8399142">!</span><span class="ident" id="8399143">fi</span><span class="op" id="8399145">.</span><span class="ident" id="8399146">IsDir</span><span class="op" id="8399151">(</span><span class="op" id="8399152">)</span>&nbsp;<span class="op" id="8399154">&amp;&amp;</span>&nbsp;<span class="op" id="8399157">!</span><span class="ident" id="8399158">strings</span><span class="op" id="8399165">.</span><span class="ident" id="8399166">HasPrefix</span><span class="op" id="8399175">(</span><span class="ident" id="8399176">name</span><span class="op" id="8399180">,</span>&nbsp;<span class="string" id="8399182">&#34;.&#34;</span><span class="op" id="8399185">)</span>&nbsp;<span class="op" id="8399187">&amp;&amp;</span>&nbsp;<span class="ident" id="8399190">strings</span><span class="op" id="8399197">.</span><span class="ident" id="8399198">HasSuffix</span><span class="op" id="8399207">(</span><span class="ident" id="8399208">name</span><span class="op" id="8399212">,</span>&nbsp;<span class="string" id="8399214">&#34;.src&#34;</span><span class="op" id="8399220">)</span>&nbsp;<span class="op" id="8399222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8399227">checkErrors</span><span class="op" id="8399238">(</span><span class="ident" id="8399239">t</span><span class="op" id="8399240">,</span>&nbsp;<span class="ident" id="8399242">filepath</span><span class="op" id="8399250">.</span><span class="ident" id="8399251">Join</span><span class="op" id="8399255">(</span><span class="ident" id="8399256">testdata</span><span class="op" id="8399264">,</span>&nbsp;<span class="ident" id="8399266">name</span><span class="op" id="8399270">)</span><span class="op" id="8399271">,</span>&nbsp;<span class="ident" id="8399273">nil</span><span class="op" id="8399276">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8399280">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8399283">}</span><br>
<span class="lineno"></span><span class="op" id="8399285">}</span>
</div>
</body>
</html>
