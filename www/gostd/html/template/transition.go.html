<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>html/template</h2>
<ul>
<li><a href="/gostd/html/template/attr.go.html">attr.go</a></li>
<li><a href="/gostd/html/template/clone_test.go.html">clone_test.go</a></li>
<li><a href="/gostd/html/template/content.go.html">content.go</a></li>
<li><a href="/gostd/html/template/content_test.go.html">content_test.go</a></li>
<li><a href="/gostd/html/template/context.go.html">context.go</a></li>
<li><a href="/gostd/html/template/css.go.html">css.go</a></li>
<li><a href="/gostd/html/template/css_test.go.html">css_test.go</a></li>
<li><a href="/gostd/html/template/doc.go.html">doc.go</a></li>
<li><a href="/gostd/html/template/error.go.html">error.go</a></li>
<li><a href="/gostd/html/template/escape.go.html">escape.go</a></li>
<li><a href="/gostd/html/template/escape_test.go.html">escape_test.go</a></li>
<li><a href="/gostd/html/template/html.go.html">html.go</a></li>
<li><a href="/gostd/html/template/html_test.go.html">html_test.go</a></li>
<li><a href="/gostd/html/template/js.go.html">js.go</a></li>
<li><a href="/gostd/html/template/js_test.go.html">js_test.go</a></li>
<li><a href="/gostd/html/template/template.go.html">template.go</a></li>
<li><a href="/gostd/html/template/transition.go.html">transition.go</a></li>
<li><a href="/gostd/html/template/url.go.html">url.go</a></li>
<li><a href="/gostd/html/template/url_test.go.html">url_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2885278">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2885333">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2885387">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2885438">package</span>&nbsp;<span class="ident" id="2885446">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2885456">import</span>&nbsp;<span class="op" id="2885463">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2885466">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2885475">&#34;strings&#34;</span><br>
<span class="lineno">10</span><span class="op" id="2885485">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2885488">//&nbsp;transitionFunc&nbsp;is&nbsp;the&nbsp;array&nbsp;of&nbsp;context&nbsp;transition&nbsp;functions&nbsp;for&nbsp;text&nbsp;nodes.</span><br>
<span class="lineno"></span><span class="comment" id="2885567">//&nbsp;A&nbsp;transition&nbsp;function&nbsp;takes&nbsp;a&nbsp;context&nbsp;and&nbsp;template&nbsp;text&nbsp;input,&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="2885645">//&nbsp;the&nbsp;updated&nbsp;context&nbsp;and&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;consumed&nbsp;from&nbsp;the&nbsp;front&nbsp;of&nbsp;the</span><br>
<span class="lineno">15</span><span class="comment" id="2885723">//&nbsp;input.</span><br>
<span class="lineno"></span><span class="keyword" id="2885733">var</span>&nbsp;<span class="ident" id="2885737">transitionFunc</span>&nbsp;<span class="op" id="2885752">=</span>&nbsp;<span class="op" id="2885754">[</span><span class="op" id="2885755">...</span><span class="op" id="2885758">]</span><span class="keyword" id="2885759">func</span><span class="op" id="2885763">(</span><span class="ident" id="2885764">context</span><span class="op" id="2885771">,</span>&nbsp;<span class="op" id="2885773">[</span><span class="op" id="2885774">]</span><span class="builtintype" id="2885775">byte</span><span class="op" id="2885779">)</span>&nbsp;<span class="op" id="2885781">(</span><span class="ident" id="2885782">context</span><span class="op" id="2885789">,</span>&nbsp;<span class="builtintype" id="2885791">int</span><span class="op" id="2885794">)</span><span class="op" id="2885795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2885798">stateText</span><span class="op" id="2885807">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2885816">tText</span><span class="op" id="2885821">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2885824">stateTag</span><span class="op" id="2885832">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2885842">tTag</span><span class="op" id="2885846">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2885849">stateAttrName</span><span class="op" id="2885862">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2885867">tAttrName</span><span class="op" id="2885876">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2885879">stateAfterName</span><span class="op" id="2885893">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="2885897">tAfterName</span><span class="op" id="2885907">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2885910">stateBeforeValue</span><span class="op" id="2885926">:</span>&nbsp;<span class="ident" id="2885928">tBeforeValue</span><span class="op" id="2885940">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2885943">stateHTMLCmt</span><span class="op" id="2885955">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2885961">tHTMLCmt</span><span class="op" id="2885969">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2885972">stateRCDATA</span><span class="op" id="2885983">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2885990">tSpecialTagEnd</span><span class="op" id="2886004">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2886007">stateAttr</span><span class="op" id="2886016">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2886025">tAttr</span><span class="op" id="2886030">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2886033">stateURL</span><span class="op" id="2886041">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2886051">tURL</span><span class="op" id="2886055">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2886058">stateJS</span><span class="op" id="2886065">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2886076">tJS</span><span class="op" id="2886079">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2886082">stateJSDqStr</span><span class="op" id="2886094">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2886100">tJSDelimited</span><span class="op" id="2886112">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2886115">stateJSSqStr</span><span class="op" id="2886127">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2886133">tJSDelimited</span><span class="op" id="2886145">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2886148">stateJSRegexp</span><span class="op" id="2886161">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2886166">tJSDelimited</span><span class="op" id="2886178">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2886181">stateJSBlockCmt</span><span class="op" id="2886196">:</span>&nbsp;&nbsp;<span class="ident" id="2886199">tBlockCmt</span><span class="op" id="2886208">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2886211">stateJSLineCmt</span><span class="op" id="2886225">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="2886229">tLineCmt</span><span class="op" id="2886237">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2886240">stateCSS</span><span class="op" id="2886248">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2886258">tCSS</span><span class="op" id="2886262">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2886265">stateCSSDqStr</span><span class="op" id="2886278">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2886283">tCSSStr</span><span class="op" id="2886290">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2886293">stateCSSSqStr</span><span class="op" id="2886306">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2886311">tCSSStr</span><span class="op" id="2886318">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2886321">stateCSSDqURL</span><span class="op" id="2886334">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2886339">tCSSStr</span><span class="op" id="2886346">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2886349">stateCSSSqURL</span><span class="op" id="2886362">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2886367">tCSSStr</span><span class="op" id="2886374">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2886377">stateCSSURL</span><span class="op" id="2886388">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2886395">tCSSStr</span><span class="op" id="2886402">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2886405">stateCSSBlockCmt</span><span class="op" id="2886421">:</span>&nbsp;<span class="ident" id="2886423">tBlockCmt</span><span class="op" id="2886432">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2886435">stateCSSLineCmt</span><span class="op" id="2886450">:</span>&nbsp;&nbsp;<span class="ident" id="2886453">tLineCmt</span><span class="op" id="2886461">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2886464">stateError</span><span class="op" id="2886474">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2886482">tError</span><span class="op" id="2886488">,</span><br>
<span class="lineno"></span><span class="op" id="2886490">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2886493">var</span>&nbsp;<span class="ident" id="2886497">commentStart</span>&nbsp;<span class="op" id="2886510">=</span>&nbsp;<span class="op" id="2886512">[</span><span class="op" id="2886513">]</span><span class="builtintype" id="2886514">byte</span><span class="op" id="2886518">(</span><span class="string" id="2886519">&#34;&lt;!--&#34;</span><span class="op" id="2886525">)</span><br>
<span class="lineno"></span><span class="keyword" id="2886527">var</span>&nbsp;<span class="ident" id="2886531">commentEnd</span>&nbsp;<span class="op" id="2886542">=</span>&nbsp;<span class="op" id="2886544">[</span><span class="op" id="2886545">]</span><span class="builtintype" id="2886546">byte</span><span class="op" id="2886550">(</span><span class="string" id="2886551">&#34;--&gt;&#34;</span><span class="op" id="2886556">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="2886559">//&nbsp;tText&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;text&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="2886623">func</span>&nbsp;<span class="ident" id="2886628">tText</span><span class="op" id="2886633">(</span><span class="ident" id="2886634">c</span>&nbsp;<span class="ident" id="2886636">context</span><span class="op" id="2886643">,</span>&nbsp;<span class="ident" id="2886645">s</span>&nbsp;<span class="op" id="2886647">[</span><span class="op" id="2886648">]</span><span class="builtintype" id="2886649">byte</span><span class="op" id="2886653">)</span>&nbsp;<span class="op" id="2886655">(</span><span class="ident" id="2886656">context</span><span class="op" id="2886663">,</span>&nbsp;<span class="builtintype" id="2886665">int</span><span class="op" id="2886668">)</span>&nbsp;<span class="op" id="2886670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2886673">k</span>&nbsp;<span class="op" id="2886675">:=</span>&nbsp;<span class="num" id="2886678">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2886681">for</span>&nbsp;<span class="op" id="2886685">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2886689">i</span>&nbsp;<span class="op" id="2886691">:=</span>&nbsp;<span class="ident" id="2886694">k</span>&nbsp;<span class="op" id="2886696">+</span>&nbsp;<span class="ident" id="2886698">bytes</span><span class="op" id="2886703">.</span><span class="ident" id="2886704">IndexByte</span><span class="op" id="2886713">(</span><span class="ident" id="2886714">s</span><span class="op" id="2886715">[</span><span class="ident" id="2886716">k</span><span class="op" id="2886717">:</span><span class="op" id="2886718">]</span><span class="op" id="2886719">,</span>&nbsp;<span class="string" id="2886721">&#39;&lt;&#39;</span><span class="op" id="2886724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2886728">if</span>&nbsp;<span class="ident" id="2886731">i</span>&nbsp;<span class="op" id="2886733">&lt;</span>&nbsp;<span class="ident" id="2886735">k</span>&nbsp;<span class="op" id="2886737">||</span>&nbsp;<span class="ident" id="2886740">i</span><span class="op" id="2886741">+</span><span class="num" id="2886742">1</span>&nbsp;<span class="op" id="2886744">==</span>&nbsp;<span class="builtinfunc" id="2886747">len</span><span class="op" id="2886750">(</span><span class="ident" id="2886751">s</span><span class="op" id="2886752">)</span>&nbsp;<span class="op" id="2886754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2886759">return</span>&nbsp;<span class="ident" id="2886766">c</span><span class="op" id="2886767">,</span>&nbsp;<span class="builtinfunc" id="2886769">len</span><span class="op" id="2886772">(</span><span class="ident" id="2886773">s</span><span class="op" id="2886774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2886778">}</span>&nbsp;<span class="keyword" id="2886780">else</span>&nbsp;<span class="keyword" id="2886785">if</span>&nbsp;<span class="ident" id="2886788">i</span><span class="op" id="2886789">+</span><span class="num" id="2886790">4</span>&nbsp;<span class="op" id="2886792">&lt;=</span>&nbsp;<span class="builtinfunc" id="2886795">len</span><span class="op" id="2886798">(</span><span class="ident" id="2886799">s</span><span class="op" id="2886800">)</span>&nbsp;<span class="op" id="2886802">&amp;&amp;</span>&nbsp;<span class="ident" id="2886805">bytes</span><span class="op" id="2886810">.</span><span class="ident" id="2886811">Equal</span><span class="op" id="2886816">(</span><span class="ident" id="2886817">commentStart</span><span class="op" id="2886829">,</span>&nbsp;<span class="ident" id="2886831">s</span><span class="op" id="2886832">[</span><span class="ident" id="2886833">i</span><span class="op" id="2886834">:</span><span class="ident" id="2886835">i</span><span class="op" id="2886836">+</span><span class="num" id="2886837">4</span><span class="op" id="2886838">]</span><span class="op" id="2886839">)</span>&nbsp;<span class="op" id="2886841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2886846">return</span>&nbsp;<span class="ident" id="2886853">context</span><span class="op" id="2886860">{</span><span class="ident" id="2886861">state</span><span class="op" id="2886866">:</span>&nbsp;<span class="ident" id="2886868">stateHTMLCmt</span><span class="op" id="2886880">}</span><span class="op" id="2886881">,</span>&nbsp;<span class="ident" id="2886883">i</span>&nbsp;<span class="op" id="2886885">+</span>&nbsp;<span class="num" id="2886887">4</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2886891">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2886895">i</span><span class="op" id="2886896">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2886901">end</span>&nbsp;<span class="op" id="2886905">:=</span>&nbsp;<span class="builtintype" id="2886908">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2886916">if</span>&nbsp;<span class="ident" id="2886919">s</span><span class="op" id="2886920">[</span><span class="ident" id="2886921">i</span><span class="op" id="2886922">]</span>&nbsp;<span class="op" id="2886924">==</span>&nbsp;<span class="string" id="2886927">&#39;/&#39;</span>&nbsp;<span class="op" id="2886931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2886936">if</span>&nbsp;<span class="ident" id="2886939">i</span><span class="op" id="2886940">+</span><span class="num" id="2886941">1</span>&nbsp;<span class="op" id="2886943">==</span>&nbsp;<span class="builtinfunc" id="2886946">len</span><span class="op" id="2886949">(</span><span class="ident" id="2886950">s</span><span class="op" id="2886951">)</span>&nbsp;<span class="op" id="2886953">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2886959">return</span>&nbsp;<span class="ident" id="2886966">c</span><span class="op" id="2886967">,</span>&nbsp;<span class="builtinfunc" id="2886969">len</span><span class="op" id="2886972">(</span><span class="ident" id="2886973">s</span><span class="op" id="2886974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2886979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2886984">end</span><span class="op" id="2886987">,</span>&nbsp;<span class="ident" id="2886989">i</span>&nbsp;<span class="op" id="2886991">=</span>&nbsp;<span class="builtintype" id="2886993">true</span><span class="op" id="2886997">,</span>&nbsp;<span class="ident" id="2886999">i</span><span class="op" id="2887000">+</span><span class="num" id="2887001">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2887005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2887009">j</span><span class="op" id="2887010">,</span>&nbsp;<span class="ident" id="2887012">e</span>&nbsp;<span class="op" id="2887014">:=</span>&nbsp;<span class="ident" id="2887017">eatTagName</span><span class="op" id="2887027">(</span><span class="ident" id="2887028">s</span><span class="op" id="2887029">,</span>&nbsp;<span class="ident" id="2887031">i</span><span class="op" id="2887032">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2887036">if</span>&nbsp;<span class="ident" id="2887039">j</span>&nbsp;<span class="op" id="2887041">!=</span>&nbsp;<span class="ident" id="2887044">i</span>&nbsp;<span class="op" id="2887046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2887051">if</span>&nbsp;<span class="ident" id="2887054">end</span>&nbsp;<span class="op" id="2887058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2887064">e</span>&nbsp;<span class="op" id="2887066">=</span>&nbsp;<span class="ident" id="2887068">elementNone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2887083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2887088">//&nbsp;We&#39;ve&nbsp;found&nbsp;an&nbsp;HTML&nbsp;tag.</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2887119">return</span>&nbsp;<span class="ident" id="2887126">context</span><span class="op" id="2887133">{</span><span class="ident" id="2887134">state</span><span class="op" id="2887139">:</span>&nbsp;<span class="ident" id="2887141">stateTag</span><span class="op" id="2887149">,</span>&nbsp;<span class="ident" id="2887151">element</span><span class="op" id="2887158">:</span>&nbsp;<span class="ident" id="2887160">e</span><span class="op" id="2887161">}</span><span class="op" id="2887162">,</span>&nbsp;<span class="ident" id="2887164">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2887168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2887172">k</span>&nbsp;<span class="op" id="2887174">=</span>&nbsp;<span class="ident" id="2887176">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2887179">}</span><br>
<span class="lineno"></span><span class="op" id="2887181">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="keyword" id="2887184">var</span>&nbsp;<span class="ident" id="2887188">elementContentType</span>&nbsp;<span class="op" id="2887207">=</span>&nbsp;<span class="op" id="2887209">[</span><span class="op" id="2887210">...</span><span class="op" id="2887213">]</span><span class="ident" id="2887214">state</span><span class="op" id="2887219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2887222">elementNone</span><span class="op" id="2887233">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2887239">stateText</span><span class="op" id="2887248">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2887251">elementScript</span><span class="op" id="2887264">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="2887268">stateJS</span><span class="op" id="2887275">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2887278">elementStyle</span><span class="op" id="2887290">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2887295">stateCSS</span><span class="op" id="2887303">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2887306">elementTextarea</span><span class="op" id="2887321">:</span>&nbsp;<span class="ident" id="2887323">stateRCDATA</span><span class="op" id="2887334">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2887337">elementTitle</span><span class="op" id="2887349">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2887354">stateRCDATA</span><span class="op" id="2887365">,</span><br>
<span class="lineno"></span><span class="op" id="2887367">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2887370">//&nbsp;tTag&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;tag&nbsp;state.</span><br>
<span class="lineno">85</span><span class="keyword" id="2887432">func</span>&nbsp;<span class="ident" id="2887437">tTag</span><span class="op" id="2887441">(</span><span class="ident" id="2887442">c</span>&nbsp;<span class="ident" id="2887444">context</span><span class="op" id="2887451">,</span>&nbsp;<span class="ident" id="2887453">s</span>&nbsp;<span class="op" id="2887455">[</span><span class="op" id="2887456">]</span><span class="builtintype" id="2887457">byte</span><span class="op" id="2887461">)</span>&nbsp;<span class="op" id="2887463">(</span><span class="ident" id="2887464">context</span><span class="op" id="2887471">,</span>&nbsp;<span class="builtintype" id="2887473">int</span><span class="op" id="2887476">)</span>&nbsp;<span class="op" id="2887478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2887481">//&nbsp;Find&nbsp;the&nbsp;attribute&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2887510">i</span>&nbsp;<span class="op" id="2887512">:=</span>&nbsp;<span class="ident" id="2887515">eatWhiteSpace</span><span class="op" id="2887528">(</span><span class="ident" id="2887529">s</span><span class="op" id="2887530">,</span>&nbsp;<span class="num" id="2887532">0</span><span class="op" id="2887533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2887536">if</span>&nbsp;<span class="ident" id="2887539">i</span>&nbsp;<span class="op" id="2887541">==</span>&nbsp;<span class="builtinfunc" id="2887544">len</span><span class="op" id="2887547">(</span><span class="ident" id="2887548">s</span><span class="op" id="2887549">)</span>&nbsp;<span class="op" id="2887551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2887555">return</span>&nbsp;<span class="ident" id="2887562">c</span><span class="op" id="2887563">,</span>&nbsp;<span class="builtinfunc" id="2887565">len</span><span class="op" id="2887568">(</span><span class="ident" id="2887569">s</span><span class="op" id="2887570">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2887573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2887576">if</span>&nbsp;<span class="ident" id="2887579">s</span><span class="op" id="2887580">[</span><span class="ident" id="2887581">i</span><span class="op" id="2887582">]</span>&nbsp;<span class="op" id="2887584">==</span>&nbsp;<span class="string" id="2887587">&#39;&gt;&#39;</span>&nbsp;<span class="op" id="2887591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2887595">return</span>&nbsp;<span class="ident" id="2887602">context</span><span class="op" id="2887609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2887614">state</span><span class="op" id="2887619">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="2887623">elementContentType</span><span class="op" id="2887641">[</span><span class="ident" id="2887642">c</span><span class="op" id="2887643">.</span><span class="ident" id="2887644">element</span><span class="op" id="2887651">]</span><span class="op" id="2887652">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2887657">element</span><span class="op" id="2887664">:</span>&nbsp;<span class="ident" id="2887666">c</span><span class="op" id="2887667">.</span><span class="ident" id="2887668">element</span><span class="op" id="2887675">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2887679">}</span><span class="op" id="2887680">,</span>&nbsp;<span class="ident" id="2887682">i</span>&nbsp;<span class="op" id="2887684">+</span>&nbsp;<span class="num" id="2887686">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2887689">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2887692">j</span><span class="op" id="2887693">,</span>&nbsp;<span class="ident" id="2887695">err</span>&nbsp;<span class="op" id="2887699">:=</span>&nbsp;<span class="ident" id="2887702">eatAttrName</span><span class="op" id="2887713">(</span><span class="ident" id="2887714">s</span><span class="op" id="2887715">,</span>&nbsp;<span class="ident" id="2887717">i</span><span class="op" id="2887718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2887721">if</span>&nbsp;<span class="ident" id="2887724">err</span>&nbsp;<span class="op" id="2887728">!=</span>&nbsp;<span class="ident" id="2887731">nil</span>&nbsp;<span class="op" id="2887735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2887739">return</span>&nbsp;<span class="ident" id="2887746">context</span><span class="op" id="2887753">{</span><span class="ident" id="2887754">state</span><span class="op" id="2887759">:</span>&nbsp;<span class="ident" id="2887761">stateError</span><span class="op" id="2887771">,</span>&nbsp;<span class="ident" id="2887773">err</span><span class="op" id="2887776">:</span>&nbsp;<span class="ident" id="2887778">err</span><span class="op" id="2887781">}</span><span class="op" id="2887782">,</span>&nbsp;<span class="builtinfunc" id="2887784">len</span><span class="op" id="2887787">(</span><span class="ident" id="2887788">s</span><span class="op" id="2887789">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2887792">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2887795">state</span><span class="op" id="2887800">,</span>&nbsp;<span class="ident" id="2887802">attr</span>&nbsp;<span class="op" id="2887807">:=</span>&nbsp;<span class="ident" id="2887810">stateTag</span><span class="op" id="2887818">,</span>&nbsp;<span class="ident" id="2887820">attrNone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2887830">if</span>&nbsp;<span class="ident" id="2887833">i</span>&nbsp;<span class="op" id="2887835">==</span>&nbsp;<span class="ident" id="2887838">j</span>&nbsp;<span class="op" id="2887840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2887844">return</span>&nbsp;<span class="ident" id="2887851">context</span><span class="op" id="2887858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2887863">state</span><span class="op" id="2887868">:</span>&nbsp;<span class="ident" id="2887870">stateError</span><span class="op" id="2887880">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2887885">err</span><span class="op" id="2887888">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="2887892">errorf</span><span class="op" id="2887898">(</span><span class="ident" id="2887899">ErrBadHTML</span><span class="op" id="2887909">,</span>&nbsp;<span class="ident" id="2887911">nil</span><span class="op" id="2887914">,</span>&nbsp;<span class="num" id="2887916">0</span><span class="op" id="2887917">,</span>&nbsp;<span class="string" id="2887919">&#34;expected&nbsp;space,&nbsp;attr&nbsp;name,&nbsp;or&nbsp;end&nbsp;of&nbsp;tag,&nbsp;but&nbsp;got&nbsp;%q&#34;</span><span class="op" id="2887973">,</span>&nbsp;<span class="ident" id="2887975">s</span><span class="op" id="2887976">[</span><span class="ident" id="2887977">i</span><span class="op" id="2887978">:</span><span class="op" id="2887979">]</span><span class="op" id="2887980">)</span><span class="op" id="2887981">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2887985">}</span><span class="op" id="2887986">,</span>&nbsp;<span class="builtinfunc" id="2887988">len</span><span class="op" id="2887991">(</span><span class="ident" id="2887992">s</span><span class="op" id="2887993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2887996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2887999">switch</span>&nbsp;<span class="ident" id="2888006">attrType</span><span class="op" id="2888014">(</span><span class="builtintype" id="2888015">string</span><span class="op" id="2888021">(</span><span class="ident" id="2888022">s</span><span class="op" id="2888023">[</span><span class="ident" id="2888024">i</span><span class="op" id="2888025">:</span><span class="ident" id="2888026">j</span><span class="op" id="2888027">]</span><span class="op" id="2888028">)</span><span class="op" id="2888029">)</span>&nbsp;<span class="op" id="2888031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2888034">case</span>&nbsp;<span class="ident" id="2888039">contentTypeURL</span><span class="op" id="2888053">:</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2888057">attr</span>&nbsp;<span class="op" id="2888062">=</span>&nbsp;<span class="ident" id="2888064">attrURL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2888073">case</span>&nbsp;<span class="ident" id="2888078">contentTypeCSS</span><span class="op" id="2888092">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2888096">attr</span>&nbsp;<span class="op" id="2888101">=</span>&nbsp;<span class="ident" id="2888103">attrStyle</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2888114">case</span>&nbsp;<span class="ident" id="2888119">contentTypeJS</span><span class="op" id="2888132">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2888136">attr</span>&nbsp;<span class="op" id="2888141">=</span>&nbsp;<span class="ident" id="2888143">attrScript</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2888155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2888158">if</span>&nbsp;<span class="ident" id="2888161">j</span>&nbsp;<span class="op" id="2888163">==</span>&nbsp;<span class="builtinfunc" id="2888166">len</span><span class="op" id="2888169">(</span><span class="ident" id="2888170">s</span><span class="op" id="2888171">)</span>&nbsp;<span class="op" id="2888173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2888177">state</span>&nbsp;<span class="op" id="2888183">=</span>&nbsp;<span class="ident" id="2888185">stateAttrName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2888200">}</span>&nbsp;<span class="keyword" id="2888202">else</span>&nbsp;<span class="op" id="2888207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2888211">state</span>&nbsp;<span class="op" id="2888217">=</span>&nbsp;<span class="ident" id="2888219">stateAfterName</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2888235">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2888238">return</span>&nbsp;<span class="ident" id="2888245">context</span><span class="op" id="2888252">{</span><span class="ident" id="2888253">state</span><span class="op" id="2888258">:</span>&nbsp;<span class="ident" id="2888260">state</span><span class="op" id="2888265">,</span>&nbsp;<span class="ident" id="2888267">element</span><span class="op" id="2888274">:</span>&nbsp;<span class="ident" id="2888276">c</span><span class="op" id="2888277">.</span><span class="ident" id="2888278">element</span><span class="op" id="2888285">,</span>&nbsp;<span class="ident" id="2888287">attr</span><span class="op" id="2888291">:</span>&nbsp;<span class="ident" id="2888293">attr</span><span class="op" id="2888297">}</span><span class="op" id="2888298">,</span>&nbsp;<span class="ident" id="2888300">j</span><br>
<span class="lineno"></span><span class="op" id="2888302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2888305">//&nbsp;tAttrName&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;stateAttrName.</span><br>
<span class="lineno">125</span><span class="keyword" id="2888372">func</span>&nbsp;<span class="ident" id="2888377">tAttrName</span><span class="op" id="2888386">(</span><span class="ident" id="2888387">c</span>&nbsp;<span class="ident" id="2888389">context</span><span class="op" id="2888396">,</span>&nbsp;<span class="ident" id="2888398">s</span>&nbsp;<span class="op" id="2888400">[</span><span class="op" id="2888401">]</span><span class="builtintype" id="2888402">byte</span><span class="op" id="2888406">)</span>&nbsp;<span class="op" id="2888408">(</span><span class="ident" id="2888409">context</span><span class="op" id="2888416">,</span>&nbsp;<span class="builtintype" id="2888418">int</span><span class="op" id="2888421">)</span>&nbsp;<span class="op" id="2888423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2888426">i</span><span class="op" id="2888427">,</span>&nbsp;<span class="ident" id="2888429">err</span>&nbsp;<span class="op" id="2888433">:=</span>&nbsp;<span class="ident" id="2888436">eatAttrName</span><span class="op" id="2888447">(</span><span class="ident" id="2888448">s</span><span class="op" id="2888449">,</span>&nbsp;<span class="num" id="2888451">0</span><span class="op" id="2888452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2888455">if</span>&nbsp;<span class="ident" id="2888458">err</span>&nbsp;<span class="op" id="2888462">!=</span>&nbsp;<span class="ident" id="2888465">nil</span>&nbsp;<span class="op" id="2888469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2888473">return</span>&nbsp;<span class="ident" id="2888480">context</span><span class="op" id="2888487">{</span><span class="ident" id="2888488">state</span><span class="op" id="2888493">:</span>&nbsp;<span class="ident" id="2888495">stateError</span><span class="op" id="2888505">,</span>&nbsp;<span class="ident" id="2888507">err</span><span class="op" id="2888510">:</span>&nbsp;<span class="ident" id="2888512">err</span><span class="op" id="2888515">}</span><span class="op" id="2888516">,</span>&nbsp;<span class="builtinfunc" id="2888518">len</span><span class="op" id="2888521">(</span><span class="ident" id="2888522">s</span><span class="op" id="2888523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2888526">}</span>&nbsp;<span class="keyword" id="2888528">else</span>&nbsp;<span class="keyword" id="2888533">if</span>&nbsp;<span class="ident" id="2888536">i</span>&nbsp;<span class="op" id="2888538">!=</span>&nbsp;<span class="builtinfunc" id="2888541">len</span><span class="op" id="2888544">(</span><span class="ident" id="2888545">s</span><span class="op" id="2888546">)</span>&nbsp;<span class="op" id="2888548">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2888552">c</span><span class="op" id="2888553">.</span><span class="ident" id="2888554">state</span>&nbsp;<span class="op" id="2888560">=</span>&nbsp;<span class="ident" id="2888562">stateAfterName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2888578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2888581">return</span>&nbsp;<span class="ident" id="2888588">c</span><span class="op" id="2888589">,</span>&nbsp;<span class="ident" id="2888591">i</span><br>
<span class="lineno"></span><span class="op" id="2888593">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="comment" id="2888596">//&nbsp;tAfterName&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;stateAfterName.</span><br>
<span class="lineno"></span><span class="keyword" id="2888665">func</span>&nbsp;<span class="ident" id="2888670">tAfterName</span><span class="op" id="2888680">(</span><span class="ident" id="2888681">c</span>&nbsp;<span class="ident" id="2888683">context</span><span class="op" id="2888690">,</span>&nbsp;<span class="ident" id="2888692">s</span>&nbsp;<span class="op" id="2888694">[</span><span class="op" id="2888695">]</span><span class="builtintype" id="2888696">byte</span><span class="op" id="2888700">)</span>&nbsp;<span class="op" id="2888702">(</span><span class="ident" id="2888703">context</span><span class="op" id="2888710">,</span>&nbsp;<span class="builtintype" id="2888712">int</span><span class="op" id="2888715">)</span>&nbsp;<span class="op" id="2888717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2888720">//&nbsp;Look&nbsp;for&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2888757">i</span>&nbsp;<span class="op" id="2888759">:=</span>&nbsp;<span class="ident" id="2888762">eatWhiteSpace</span><span class="op" id="2888775">(</span><span class="ident" id="2888776">s</span><span class="op" id="2888777">,</span>&nbsp;<span class="num" id="2888779">0</span><span class="op" id="2888780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2888783">if</span>&nbsp;<span class="ident" id="2888786">i</span>&nbsp;<span class="op" id="2888788">==</span>&nbsp;<span class="builtinfunc" id="2888791">len</span><span class="op" id="2888794">(</span><span class="ident" id="2888795">s</span><span class="op" id="2888796">)</span>&nbsp;<span class="op" id="2888798">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2888802">return</span>&nbsp;<span class="ident" id="2888809">c</span><span class="op" id="2888810">,</span>&nbsp;<span class="builtinfunc" id="2888812">len</span><span class="op" id="2888815">(</span><span class="ident" id="2888816">s</span><span class="op" id="2888817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2888820">}</span>&nbsp;<span class="keyword" id="2888822">else</span>&nbsp;<span class="keyword" id="2888827">if</span>&nbsp;<span class="ident" id="2888830">s</span><span class="op" id="2888831">[</span><span class="ident" id="2888832">i</span><span class="op" id="2888833">]</span>&nbsp;<span class="op" id="2888835">!=</span>&nbsp;<span class="string" id="2888838">&#39;=&#39;</span>&nbsp;<span class="op" id="2888842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2888846">//&nbsp;Occurs&nbsp;due&nbsp;to&nbsp;tag&nbsp;ending&nbsp;&#39;&gt;&#39;,&nbsp;and&nbsp;valueless&nbsp;attribute.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2888906">c</span><span class="op" id="2888907">.</span><span class="ident" id="2888908">state</span>&nbsp;<span class="op" id="2888914">=</span>&nbsp;<span class="ident" id="2888916">stateTag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2888927">return</span>&nbsp;<span class="ident" id="2888934">c</span><span class="op" id="2888935">,</span>&nbsp;<span class="ident" id="2888937">i</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2888940">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2888943">c</span><span class="op" id="2888944">.</span><span class="ident" id="2888945">state</span>&nbsp;<span class="op" id="2888951">=</span>&nbsp;<span class="ident" id="2888953">stateBeforeValue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2888971">//&nbsp;Consume&nbsp;the&nbsp;&#34;=&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2888992">return</span>&nbsp;<span class="ident" id="2888999">c</span><span class="op" id="2889000">,</span>&nbsp;<span class="ident" id="2889002">i</span>&nbsp;<span class="op" id="2889004">+</span>&nbsp;<span class="num" id="2889006">1</span><br>
<span class="lineno"></span><span class="op" id="2889008">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="keyword" id="2889011">var</span>&nbsp;<span class="ident" id="2889015">attrStartStates</span>&nbsp;<span class="op" id="2889031">=</span>&nbsp;<span class="op" id="2889033">[</span><span class="op" id="2889034">...</span><span class="op" id="2889037">]</span><span class="ident" id="2889038">state</span><span class="op" id="2889043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2889046">attrNone</span><span class="op" id="2889054">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="2889058">stateAttr</span><span class="op" id="2889067">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2889070">attrScript</span><span class="op" id="2889080">:</span>&nbsp;<span class="ident" id="2889082">stateJS</span><span class="op" id="2889089">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2889092">attrStyle</span><span class="op" id="2889101">:</span>&nbsp;&nbsp;<span class="ident" id="2889104">stateCSS</span><span class="op" id="2889112">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2889115">attrURL</span><span class="op" id="2889122">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2889127">stateURL</span><span class="op" id="2889135">,</span><br>
<span class="lineno"></span><span class="op" id="2889137">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2889140">//&nbsp;tBeforeValue&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;stateBeforeValue.</span><br>
<span class="lineno"></span><span class="keyword" id="2889213">func</span>&nbsp;<span class="ident" id="2889218">tBeforeValue</span><span class="op" id="2889230">(</span><span class="ident" id="2889231">c</span>&nbsp;<span class="ident" id="2889233">context</span><span class="op" id="2889240">,</span>&nbsp;<span class="ident" id="2889242">s</span>&nbsp;<span class="op" id="2889244">[</span><span class="op" id="2889245">]</span><span class="builtintype" id="2889246">byte</span><span class="op" id="2889250">)</span>&nbsp;<span class="op" id="2889252">(</span><span class="ident" id="2889253">context</span><span class="op" id="2889260">,</span>&nbsp;<span class="builtintype" id="2889262">int</span><span class="op" id="2889265">)</span>&nbsp;<span class="op" id="2889267">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2889270">i</span>&nbsp;<span class="op" id="2889272">:=</span>&nbsp;<span class="ident" id="2889275">eatWhiteSpace</span><span class="op" id="2889288">(</span><span class="ident" id="2889289">s</span><span class="op" id="2889290">,</span>&nbsp;<span class="num" id="2889292">0</span><span class="op" id="2889293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2889296">if</span>&nbsp;<span class="ident" id="2889299">i</span>&nbsp;<span class="op" id="2889301">==</span>&nbsp;<span class="builtinfunc" id="2889304">len</span><span class="op" id="2889307">(</span><span class="ident" id="2889308">s</span><span class="op" id="2889309">)</span>&nbsp;<span class="op" id="2889311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2889315">return</span>&nbsp;<span class="ident" id="2889322">c</span><span class="op" id="2889323">,</span>&nbsp;<span class="builtinfunc" id="2889325">len</span><span class="op" id="2889328">(</span><span class="ident" id="2889329">s</span><span class="op" id="2889330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2889333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2889336">//&nbsp;Find&nbsp;the&nbsp;attribute&nbsp;delimiter.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2889370">delim</span>&nbsp;<span class="op" id="2889376">:=</span>&nbsp;<span class="ident" id="2889379">delimSpaceOrTagEnd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2889399">switch</span>&nbsp;<span class="ident" id="2889406">s</span><span class="op" id="2889407">[</span><span class="ident" id="2889408">i</span><span class="op" id="2889409">]</span>&nbsp;<span class="op" id="2889411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2889414">case</span>&nbsp;<span class="string" id="2889419">&#39;\&#39;&#39;</span><span class="op" id="2889423">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2889427">delim</span><span class="op" id="2889432">,</span>&nbsp;<span class="ident" id="2889434">i</span>&nbsp;<span class="op" id="2889436">=</span>&nbsp;<span class="ident" id="2889438">delimSingleQuote</span><span class="op" id="2889454">,</span>&nbsp;<span class="ident" id="2889456">i</span><span class="op" id="2889457">+</span><span class="num" id="2889458">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2889461">case</span>&nbsp;<span class="string" id="2889466">&#39;&#34;&#39;</span><span class="op" id="2889469">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2889473">delim</span><span class="op" id="2889478">,</span>&nbsp;<span class="ident" id="2889480">i</span>&nbsp;<span class="op" id="2889482">=</span>&nbsp;<span class="ident" id="2889484">delimDoubleQuote</span><span class="op" id="2889500">,</span>&nbsp;<span class="ident" id="2889502">i</span><span class="op" id="2889503">+</span><span class="num" id="2889504">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2889507">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2889510">c</span><span class="op" id="2889511">.</span><span class="ident" id="2889512">state</span><span class="op" id="2889517">,</span>&nbsp;<span class="ident" id="2889519">c</span><span class="op" id="2889520">.</span><span class="ident" id="2889521">delim</span><span class="op" id="2889526">,</span>&nbsp;<span class="ident" id="2889528">c</span><span class="op" id="2889529">.</span><span class="ident" id="2889530">attr</span>&nbsp;<span class="op" id="2889535">=</span>&nbsp;<span class="ident" id="2889537">attrStartStates</span><span class="op" id="2889552">[</span><span class="ident" id="2889553">c</span><span class="op" id="2889554">.</span><span class="ident" id="2889555">attr</span><span class="op" id="2889559">]</span><span class="op" id="2889560">,</span>&nbsp;<span class="ident" id="2889562">delim</span><span class="op" id="2889567">,</span>&nbsp;<span class="ident" id="2889569">attrNone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2889579">return</span>&nbsp;<span class="ident" id="2889586">c</span><span class="op" id="2889587">,</span>&nbsp;<span class="ident" id="2889589">i</span><br>
<span class="lineno"></span><span class="op" id="2889591">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="comment" id="2889594">//&nbsp;tHTMLCmt&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;stateHTMLCmt.</span><br>
<span class="lineno"></span><span class="keyword" id="2889659">func</span>&nbsp;<span class="ident" id="2889664">tHTMLCmt</span><span class="op" id="2889672">(</span><span class="ident" id="2889673">c</span>&nbsp;<span class="ident" id="2889675">context</span><span class="op" id="2889682">,</span>&nbsp;<span class="ident" id="2889684">s</span>&nbsp;<span class="op" id="2889686">[</span><span class="op" id="2889687">]</span><span class="builtintype" id="2889688">byte</span><span class="op" id="2889692">)</span>&nbsp;<span class="op" id="2889694">(</span><span class="ident" id="2889695">context</span><span class="op" id="2889702">,</span>&nbsp;<span class="builtintype" id="2889704">int</span><span class="op" id="2889707">)</span>&nbsp;<span class="op" id="2889709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2889712">if</span>&nbsp;<span class="ident" id="2889715">i</span>&nbsp;<span class="op" id="2889717">:=</span>&nbsp;<span class="ident" id="2889720">bytes</span><span class="op" id="2889725">.</span><span class="ident" id="2889726">Index</span><span class="op" id="2889731">(</span><span class="ident" id="2889732">s</span><span class="op" id="2889733">,</span>&nbsp;<span class="ident" id="2889735">commentEnd</span><span class="op" id="2889745">)</span><span class="op" id="2889746">;</span>&nbsp;<span class="ident" id="2889748">i</span>&nbsp;<span class="op" id="2889750">!=</span>&nbsp;<span class="op" id="2889753">-</span><span class="num" id="2889754">1</span>&nbsp;<span class="op" id="2889756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2889760">return</span>&nbsp;<span class="ident" id="2889767">context</span><span class="op" id="2889774">{</span><span class="op" id="2889775">}</span><span class="op" id="2889776">,</span>&nbsp;<span class="ident" id="2889778">i</span>&nbsp;<span class="op" id="2889780">+</span>&nbsp;<span class="num" id="2889782">3</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2889785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2889788">return</span>&nbsp;<span class="ident" id="2889795">c</span><span class="op" id="2889796">,</span>&nbsp;<span class="builtinfunc" id="2889798">len</span><span class="op" id="2889801">(</span><span class="ident" id="2889802">s</span><span class="op" id="2889803">)</span><br>
<span class="lineno"></span><span class="op" id="2889805">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2889808">//&nbsp;specialTagEndMarkers&nbsp;maps&nbsp;element&nbsp;types&nbsp;to&nbsp;the&nbsp;character&nbsp;sequence&nbsp;that</span><br>
<span class="lineno">185</span><span class="comment" id="2889882">//&nbsp;case-insensitively&nbsp;signals&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;special&nbsp;tag&nbsp;body.</span><br>
<span class="lineno"></span><span class="keyword" id="2889945">var</span>&nbsp;<span class="ident" id="2889949">specialTagEndMarkers</span>&nbsp;<span class="op" id="2889970">=</span>&nbsp;<span class="op" id="2889972">[</span><span class="op" id="2889973">...</span><span class="op" id="2889976">]</span><span class="builtintype" id="2889977">string</span><span class="op" id="2889983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2889986">elementScript</span><span class="op" id="2889999">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="2890003">&#34;&lt;/script&#34;</span><span class="op" id="2890013">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2890016">elementStyle</span><span class="op" id="2890028">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2890033">&#34;&lt;/style&#34;</span><span class="op" id="2890042">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2890045">elementTextarea</span><span class="op" id="2890060">:</span>&nbsp;<span class="string" id="2890062">&#34;&lt;/textarea&#34;</span><span class="op" id="2890074">,</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2890077">elementTitle</span><span class="op" id="2890089">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2890094">&#34;&lt;/title&#34;</span><span class="op" id="2890103">,</span><br>
<span class="lineno"></span><span class="op" id="2890105">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2890108">//&nbsp;tSpecialTagEnd&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;raw&nbsp;text&nbsp;and&nbsp;RCDATA</span><br>
<span class="lineno"></span><span class="comment" id="2890185">//&nbsp;element&nbsp;states.</span><br>
<span class="lineno">195</span><span class="keyword" id="2890204">func</span>&nbsp;<span class="ident" id="2890209">tSpecialTagEnd</span><span class="op" id="2890223">(</span><span class="ident" id="2890224">c</span>&nbsp;<span class="ident" id="2890226">context</span><span class="op" id="2890233">,</span>&nbsp;<span class="ident" id="2890235">s</span>&nbsp;<span class="op" id="2890237">[</span><span class="op" id="2890238">]</span><span class="builtintype" id="2890239">byte</span><span class="op" id="2890243">)</span>&nbsp;<span class="op" id="2890245">(</span><span class="ident" id="2890246">context</span><span class="op" id="2890253">,</span>&nbsp;<span class="builtintype" id="2890255">int</span><span class="op" id="2890258">)</span>&nbsp;<span class="op" id="2890260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2890263">if</span>&nbsp;<span class="ident" id="2890266">c</span><span class="op" id="2890267">.</span><span class="ident" id="2890268">element</span>&nbsp;<span class="op" id="2890276">!=</span>&nbsp;<span class="ident" id="2890279">elementNone</span>&nbsp;<span class="op" id="2890291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2890295">if</span>&nbsp;<span class="ident" id="2890298">i</span>&nbsp;<span class="op" id="2890300">:=</span>&nbsp;<span class="ident" id="2890303">strings</span><span class="op" id="2890310">.</span><span class="ident" id="2890311">Index</span><span class="op" id="2890316">(</span><span class="ident" id="2890317">strings</span><span class="op" id="2890324">.</span><span class="ident" id="2890325">ToLower</span><span class="op" id="2890332">(</span><span class="builtintype" id="2890333">string</span><span class="op" id="2890339">(</span><span class="ident" id="2890340">s</span><span class="op" id="2890341">)</span><span class="op" id="2890342">)</span><span class="op" id="2890343">,</span>&nbsp;<span class="ident" id="2890345">specialTagEndMarkers</span><span class="op" id="2890365">[</span><span class="ident" id="2890366">c</span><span class="op" id="2890367">.</span><span class="ident" id="2890368">element</span><span class="op" id="2890375">]</span><span class="op" id="2890376">)</span><span class="op" id="2890377">;</span>&nbsp;<span class="ident" id="2890379">i</span>&nbsp;<span class="op" id="2890381">!=</span>&nbsp;<span class="op" id="2890384">-</span><span class="num" id="2890385">1</span>&nbsp;<span class="op" id="2890387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2890392">return</span>&nbsp;<span class="ident" id="2890399">context</span><span class="op" id="2890406">{</span><span class="op" id="2890407">}</span><span class="op" id="2890408">,</span>&nbsp;<span class="ident" id="2890410">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2890414">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2890417">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2890420">return</span>&nbsp;<span class="ident" id="2890427">c</span><span class="op" id="2890428">,</span>&nbsp;<span class="builtinfunc" id="2890430">len</span><span class="op" id="2890433">(</span><span class="ident" id="2890434">s</span><span class="op" id="2890435">)</span><br>
<span class="lineno"></span><span class="op" id="2890437">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2890440">//&nbsp;tAttr&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;attribute&nbsp;state.</span><br>
<span class="lineno">205</span><span class="keyword" id="2890509">func</span>&nbsp;<span class="ident" id="2890514">tAttr</span><span class="op" id="2890519">(</span><span class="ident" id="2890520">c</span>&nbsp;<span class="ident" id="2890522">context</span><span class="op" id="2890529">,</span>&nbsp;<span class="ident" id="2890531">s</span>&nbsp;<span class="op" id="2890533">[</span><span class="op" id="2890534">]</span><span class="builtintype" id="2890535">byte</span><span class="op" id="2890539">)</span>&nbsp;<span class="op" id="2890541">(</span><span class="ident" id="2890542">context</span><span class="op" id="2890549">,</span>&nbsp;<span class="builtintype" id="2890551">int</span><span class="op" id="2890554">)</span>&nbsp;<span class="op" id="2890556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2890559">return</span>&nbsp;<span class="ident" id="2890566">c</span><span class="op" id="2890567">,</span>&nbsp;<span class="builtinfunc" id="2890569">len</span><span class="op" id="2890572">(</span><span class="ident" id="2890573">s</span><span class="op" id="2890574">)</span><br>
<span class="lineno"></span><span class="op" id="2890576">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2890579">//&nbsp;tURL&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;URL&nbsp;state.</span><br>
<span class="lineno">210</span><span class="keyword" id="2890641">func</span>&nbsp;<span class="ident" id="2890646">tURL</span><span class="op" id="2890650">(</span><span class="ident" id="2890651">c</span>&nbsp;<span class="ident" id="2890653">context</span><span class="op" id="2890660">,</span>&nbsp;<span class="ident" id="2890662">s</span>&nbsp;<span class="op" id="2890664">[</span><span class="op" id="2890665">]</span><span class="builtintype" id="2890666">byte</span><span class="op" id="2890670">)</span>&nbsp;<span class="op" id="2890672">(</span><span class="ident" id="2890673">context</span><span class="op" id="2890680">,</span>&nbsp;<span class="builtintype" id="2890682">int</span><span class="op" id="2890685">)</span>&nbsp;<span class="op" id="2890687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2890690">if</span>&nbsp;<span class="ident" id="2890693">bytes</span><span class="op" id="2890698">.</span><span class="ident" id="2890699">IndexAny</span><span class="op" id="2890707">(</span><span class="ident" id="2890708">s</span><span class="op" id="2890709">,</span>&nbsp;<span class="string" id="2890711">&#34;#?&#34;</span><span class="op" id="2890715">)</span>&nbsp;<span class="op" id="2890717">&gt;=</span>&nbsp;<span class="num" id="2890720">0</span>&nbsp;<span class="op" id="2890722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2890726">c</span><span class="op" id="2890727">.</span><span class="ident" id="2890728">urlPart</span>&nbsp;<span class="op" id="2890736">=</span>&nbsp;<span class="ident" id="2890738">urlPartQueryOrFrag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2890758">}</span>&nbsp;<span class="keyword" id="2890760">else</span>&nbsp;<span class="keyword" id="2890765">if</span>&nbsp;<span class="builtinfunc" id="2890768">len</span><span class="op" id="2890771">(</span><span class="ident" id="2890772">s</span><span class="op" id="2890773">)</span>&nbsp;<span class="op" id="2890775">!=</span>&nbsp;<span class="ident" id="2890778">eatWhiteSpace</span><span class="op" id="2890791">(</span><span class="ident" id="2890792">s</span><span class="op" id="2890793">,</span>&nbsp;<span class="num" id="2890795">0</span><span class="op" id="2890796">)</span>&nbsp;<span class="op" id="2890798">&amp;&amp;</span>&nbsp;<span class="ident" id="2890801">c</span><span class="op" id="2890802">.</span><span class="ident" id="2890803">urlPart</span>&nbsp;<span class="op" id="2890811">==</span>&nbsp;<span class="ident" id="2890814">urlPartNone</span>&nbsp;<span class="op" id="2890826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2890830">//&nbsp;HTML5&nbsp;uses&nbsp;&#34;Valid&nbsp;URL&nbsp;potentially&nbsp;surrounded&nbsp;by&nbsp;spaces&#34;&nbsp;for</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2890895">//&nbsp;attrs:&nbsp;http://www.w3.org/TR/html5/index.html#attributes-1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2890958">c</span><span class="op" id="2890959">.</span><span class="ident" id="2890960">urlPart</span>&nbsp;<span class="op" id="2890968">=</span>&nbsp;<span class="ident" id="2890970">urlPartPreQuery</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2890987">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2890990">return</span>&nbsp;<span class="ident" id="2890997">c</span><span class="op" id="2890998">,</span>&nbsp;<span class="builtinfunc" id="2891000">len</span><span class="op" id="2891003">(</span><span class="ident" id="2891004">s</span><span class="op" id="2891005">)</span><br>
<span class="lineno"></span><span class="op" id="2891007">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="2891010">//&nbsp;tJS&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;JS&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="2891070">func</span>&nbsp;<span class="ident" id="2891075">tJS</span><span class="op" id="2891078">(</span><span class="ident" id="2891079">c</span>&nbsp;<span class="ident" id="2891081">context</span><span class="op" id="2891088">,</span>&nbsp;<span class="ident" id="2891090">s</span>&nbsp;<span class="op" id="2891092">[</span><span class="op" id="2891093">]</span><span class="builtintype" id="2891094">byte</span><span class="op" id="2891098">)</span>&nbsp;<span class="op" id="2891100">(</span><span class="ident" id="2891101">context</span><span class="op" id="2891108">,</span>&nbsp;<span class="builtintype" id="2891110">int</span><span class="op" id="2891113">)</span>&nbsp;<span class="op" id="2891115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2891118">i</span>&nbsp;<span class="op" id="2891120">:=</span>&nbsp;<span class="ident" id="2891123">bytes</span><span class="op" id="2891128">.</span><span class="ident" id="2891129">IndexAny</span><span class="op" id="2891137">(</span><span class="ident" id="2891138">s</span><span class="op" id="2891139">,</span>&nbsp;<span class="string" id="2891141">`&#34;&#39;/`</span><span class="op" id="2891146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2891149">if</span>&nbsp;<span class="ident" id="2891152">i</span>&nbsp;<span class="op" id="2891154">==</span>&nbsp;<span class="op" id="2891157">-</span><span class="num" id="2891158">1</span>&nbsp;<span class="op" id="2891160">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2891164">//&nbsp;Entire&nbsp;input&nbsp;is&nbsp;non&nbsp;string,&nbsp;comment,&nbsp;regexp&nbsp;tokens.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2891221">c</span><span class="op" id="2891222">.</span><span class="ident" id="2891223">jsCtx</span>&nbsp;<span class="op" id="2891229">=</span>&nbsp;<span class="ident" id="2891231">nextJSCtx</span><span class="op" id="2891240">(</span><span class="ident" id="2891241">s</span><span class="op" id="2891242">,</span>&nbsp;<span class="ident" id="2891244">c</span><span class="op" id="2891245">.</span><span class="ident" id="2891246">jsCtx</span><span class="op" id="2891251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2891255">return</span>&nbsp;<span class="ident" id="2891262">c</span><span class="op" id="2891263">,</span>&nbsp;<span class="builtinfunc" id="2891265">len</span><span class="op" id="2891268">(</span><span class="ident" id="2891269">s</span><span class="op" id="2891270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2891273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2891276">c</span><span class="op" id="2891277">.</span><span class="ident" id="2891278">jsCtx</span>&nbsp;<span class="op" id="2891284">=</span>&nbsp;<span class="ident" id="2891286">nextJSCtx</span><span class="op" id="2891295">(</span><span class="ident" id="2891296">s</span><span class="op" id="2891297">[</span><span class="op" id="2891298">:</span><span class="ident" id="2891299">i</span><span class="op" id="2891300">]</span><span class="op" id="2891301">,</span>&nbsp;<span class="ident" id="2891303">c</span><span class="op" id="2891304">.</span><span class="ident" id="2891305">jsCtx</span><span class="op" id="2891310">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2891313">switch</span>&nbsp;<span class="ident" id="2891320">s</span><span class="op" id="2891321">[</span><span class="ident" id="2891322">i</span><span class="op" id="2891323">]</span>&nbsp;<span class="op" id="2891325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2891328">case</span>&nbsp;<span class="string" id="2891333">&#39;&#34;&#39;</span><span class="op" id="2891336">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2891340">c</span><span class="op" id="2891341">.</span><span class="ident" id="2891342">state</span><span class="op" id="2891347">,</span>&nbsp;<span class="ident" id="2891349">c</span><span class="op" id="2891350">.</span><span class="ident" id="2891351">jsCtx</span>&nbsp;<span class="op" id="2891357">=</span>&nbsp;<span class="ident" id="2891359">stateJSDqStr</span><span class="op" id="2891371">,</span>&nbsp;<span class="ident" id="2891373">jsCtxRegexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2891386">case</span>&nbsp;<span class="string" id="2891391">&#39;\&#39;&#39;</span><span class="op" id="2891395">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2891399">c</span><span class="op" id="2891400">.</span><span class="ident" id="2891401">state</span><span class="op" id="2891406">,</span>&nbsp;<span class="ident" id="2891408">c</span><span class="op" id="2891409">.</span><span class="ident" id="2891410">jsCtx</span>&nbsp;<span class="op" id="2891416">=</span>&nbsp;<span class="ident" id="2891418">stateJSSqStr</span><span class="op" id="2891430">,</span>&nbsp;<span class="ident" id="2891432">jsCtxRegexp</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2891445">case</span>&nbsp;<span class="string" id="2891450">&#39;/&#39;</span><span class="op" id="2891453">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2891457">switch</span>&nbsp;<span class="op" id="2891464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2891468">case</span>&nbsp;<span class="ident" id="2891473">i</span><span class="op" id="2891474">+</span><span class="num" id="2891475">1</span>&nbsp;<span class="op" id="2891477">&lt;</span>&nbsp;<span class="builtinfunc" id="2891479">len</span><span class="op" id="2891482">(</span><span class="ident" id="2891483">s</span><span class="op" id="2891484">)</span>&nbsp;<span class="op" id="2891486">&amp;&amp;</span>&nbsp;<span class="ident" id="2891489">s</span><span class="op" id="2891490">[</span><span class="ident" id="2891491">i</span><span class="op" id="2891492">+</span><span class="num" id="2891493">1</span><span class="op" id="2891494">]</span>&nbsp;<span class="op" id="2891496">==</span>&nbsp;<span class="string" id="2891499">&#39;/&#39;</span><span class="op" id="2891502">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2891507">c</span><span class="op" id="2891508">.</span><span class="ident" id="2891509">state</span><span class="op" id="2891514">,</span>&nbsp;<span class="ident" id="2891516">i</span>&nbsp;<span class="op" id="2891518">=</span>&nbsp;<span class="ident" id="2891520">stateJSLineCmt</span><span class="op" id="2891534">,</span>&nbsp;<span class="ident" id="2891536">i</span><span class="op" id="2891537">+</span><span class="num" id="2891538">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2891542">case</span>&nbsp;<span class="ident" id="2891547">i</span><span class="op" id="2891548">+</span><span class="num" id="2891549">1</span>&nbsp;<span class="op" id="2891551">&lt;</span>&nbsp;<span class="builtinfunc" id="2891553">len</span><span class="op" id="2891556">(</span><span class="ident" id="2891557">s</span><span class="op" id="2891558">)</span>&nbsp;<span class="op" id="2891560">&amp;&amp;</span>&nbsp;<span class="ident" id="2891563">s</span><span class="op" id="2891564">[</span><span class="ident" id="2891565">i</span><span class="op" id="2891566">+</span><span class="num" id="2891567">1</span><span class="op" id="2891568">]</span>&nbsp;<span class="op" id="2891570">==</span>&nbsp;<span class="string" id="2891573">&#39;*&#39;</span><span class="op" id="2891576">:</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2891581">c</span><span class="op" id="2891582">.</span><span class="ident" id="2891583">state</span><span class="op" id="2891588">,</span>&nbsp;<span class="ident" id="2891590">i</span>&nbsp;<span class="op" id="2891592">=</span>&nbsp;<span class="ident" id="2891594">stateJSBlockCmt</span><span class="op" id="2891609">,</span>&nbsp;<span class="ident" id="2891611">i</span><span class="op" id="2891612">+</span><span class="num" id="2891613">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2891617">case</span>&nbsp;<span class="ident" id="2891622">c</span><span class="op" id="2891623">.</span><span class="ident" id="2891624">jsCtx</span>&nbsp;<span class="op" id="2891630">==</span>&nbsp;<span class="ident" id="2891633">jsCtxRegexp</span><span class="op" id="2891644">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2891649">c</span><span class="op" id="2891650">.</span><span class="ident" id="2891651">state</span>&nbsp;<span class="op" id="2891657">=</span>&nbsp;<span class="ident" id="2891659">stateJSRegexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2891675">case</span>&nbsp;<span class="ident" id="2891680">c</span><span class="op" id="2891681">.</span><span class="ident" id="2891682">jsCtx</span>&nbsp;<span class="op" id="2891688">==</span>&nbsp;<span class="ident" id="2891691">jsCtxDivOp</span><span class="op" id="2891701">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2891706">c</span><span class="op" id="2891707">.</span><span class="ident" id="2891708">jsCtx</span>&nbsp;<span class="op" id="2891714">=</span>&nbsp;<span class="ident" id="2891716">jsCtxRegexp</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2891730">default</span><span class="op" id="2891737">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2891742">return</span>&nbsp;<span class="ident" id="2891749">context</span><span class="op" id="2891756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2891762">state</span><span class="op" id="2891767">:</span>&nbsp;<span class="ident" id="2891769">stateError</span><span class="op" id="2891779">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2891785">err</span><span class="op" id="2891788">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="2891792">errorf</span><span class="op" id="2891798">(</span><span class="ident" id="2891799">ErrSlashAmbig</span><span class="op" id="2891812">,</span>&nbsp;<span class="ident" id="2891814">nil</span><span class="op" id="2891817">,</span>&nbsp;<span class="num" id="2891819">0</span><span class="op" id="2891820">,</span>&nbsp;<span class="string" id="2891822">&#34;&#39;/&#39;&nbsp;could&nbsp;start&nbsp;a&nbsp;division&nbsp;or&nbsp;regexp:&nbsp;%.32q&#34;</span><span class="op" id="2891867">,</span>&nbsp;<span class="ident" id="2891869">s</span><span class="op" id="2891870">[</span><span class="ident" id="2891871">i</span><span class="op" id="2891872">:</span><span class="op" id="2891873">]</span><span class="op" id="2891874">)</span><span class="op" id="2891875">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2891880">}</span><span class="op" id="2891881">,</span>&nbsp;<span class="builtinfunc" id="2891883">len</span><span class="op" id="2891886">(</span><span class="ident" id="2891887">s</span><span class="op" id="2891888">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2891892">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2891895">default</span><span class="op" id="2891902">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2891906">panic</span><span class="op" id="2891911">(</span><span class="string" id="2891912">&#34;unreachable&#34;</span><span class="op" id="2891925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2891928">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2891931">return</span>&nbsp;<span class="ident" id="2891938">c</span><span class="op" id="2891939">,</span>&nbsp;<span class="ident" id="2891941">i</span>&nbsp;<span class="op" id="2891943">+</span>&nbsp;<span class="num" id="2891945">1</span><br>
<span class="lineno">255</span><span class="op" id="2891947">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2891950">//&nbsp;tJSDelimited&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;JS&nbsp;string&nbsp;and&nbsp;regexp</span><br>
<span class="lineno"></span><span class="comment" id="2892030">//&nbsp;states.</span><br>
<span class="lineno"></span><span class="keyword" id="2892041">func</span>&nbsp;<span class="ident" id="2892046">tJSDelimited</span><span class="op" id="2892058">(</span><span class="ident" id="2892059">c</span>&nbsp;<span class="ident" id="2892061">context</span><span class="op" id="2892068">,</span>&nbsp;<span class="ident" id="2892070">s</span>&nbsp;<span class="op" id="2892072">[</span><span class="op" id="2892073">]</span><span class="builtintype" id="2892074">byte</span><span class="op" id="2892078">)</span>&nbsp;<span class="op" id="2892080">(</span><span class="ident" id="2892081">context</span><span class="op" id="2892088">,</span>&nbsp;<span class="builtintype" id="2892090">int</span><span class="op" id="2892093">)</span>&nbsp;<span class="op" id="2892095">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2892098">specials</span>&nbsp;<span class="op" id="2892107">:=</span>&nbsp;<span class="string" id="2892110">`\&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2892116">switch</span>&nbsp;<span class="ident" id="2892123">c</span><span class="op" id="2892124">.</span><span class="ident" id="2892125">state</span>&nbsp;<span class="op" id="2892131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2892134">case</span>&nbsp;<span class="ident" id="2892139">stateJSSqStr</span><span class="op" id="2892151">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2892155">specials</span>&nbsp;<span class="op" id="2892164">=</span>&nbsp;<span class="string" id="2892166">`\&#39;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2892172">case</span>&nbsp;<span class="ident" id="2892177">stateJSRegexp</span><span class="op" id="2892190">:</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2892194">specials</span>&nbsp;<span class="op" id="2892203">=</span>&nbsp;<span class="string" id="2892205">`\/[]`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2892213">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2892217">k</span><span class="op" id="2892218">,</span>&nbsp;<span class="ident" id="2892220">inCharset</span>&nbsp;<span class="op" id="2892230">:=</span>&nbsp;<span class="num" id="2892233">0</span><span class="op" id="2892234">,</span>&nbsp;<span class="builtintype" id="2892236">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2892243">for</span>&nbsp;<span class="op" id="2892247">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2892251">i</span>&nbsp;<span class="op" id="2892253">:=</span>&nbsp;<span class="ident" id="2892256">k</span>&nbsp;<span class="op" id="2892258">+</span>&nbsp;<span class="ident" id="2892260">bytes</span><span class="op" id="2892265">.</span><span class="ident" id="2892266">IndexAny</span><span class="op" id="2892274">(</span><span class="ident" id="2892275">s</span><span class="op" id="2892276">[</span><span class="ident" id="2892277">k</span><span class="op" id="2892278">:</span><span class="op" id="2892279">]</span><span class="op" id="2892280">,</span>&nbsp;<span class="ident" id="2892282">specials</span><span class="op" id="2892290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2892294">if</span>&nbsp;<span class="ident" id="2892297">i</span>&nbsp;<span class="op" id="2892299">&lt;</span>&nbsp;<span class="ident" id="2892301">k</span>&nbsp;<span class="op" id="2892303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2892308">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2892316">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2892320">switch</span>&nbsp;<span class="ident" id="2892327">s</span><span class="op" id="2892328">[</span><span class="ident" id="2892329">i</span><span class="op" id="2892330">]</span>&nbsp;<span class="op" id="2892332">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2892336">case</span>&nbsp;<span class="string" id="2892341">&#39;\\&#39;</span><span class="op" id="2892345">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2892350">i</span><span class="op" id="2892351">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2892357">if</span>&nbsp;<span class="ident" id="2892360">i</span>&nbsp;<span class="op" id="2892362">==</span>&nbsp;<span class="builtinfunc" id="2892365">len</span><span class="op" id="2892368">(</span><span class="ident" id="2892369">s</span><span class="op" id="2892370">)</span>&nbsp;<span class="op" id="2892372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2892378">return</span>&nbsp;<span class="ident" id="2892385">context</span><span class="op" id="2892392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2892399">state</span><span class="op" id="2892404">:</span>&nbsp;<span class="ident" id="2892406">stateError</span><span class="op" id="2892416">,</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2892423">err</span><span class="op" id="2892426">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="2892430">errorf</span><span class="op" id="2892436">(</span><span class="ident" id="2892437">ErrPartialEscape</span><span class="op" id="2892453">,</span>&nbsp;<span class="ident" id="2892455">nil</span><span class="op" id="2892458">,</span>&nbsp;<span class="num" id="2892460">0</span><span class="op" id="2892461">,</span>&nbsp;<span class="string" id="2892463">&#34;unfinished&nbsp;escape&nbsp;sequence&nbsp;in&nbsp;JS&nbsp;string:&nbsp;%q&#34;</span><span class="op" id="2892508">,</span>&nbsp;<span class="ident" id="2892510">s</span><span class="op" id="2892511">)</span><span class="op" id="2892512">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2892518">}</span><span class="op" id="2892519">,</span>&nbsp;<span class="builtinfunc" id="2892521">len</span><span class="op" id="2892524">(</span><span class="ident" id="2892525">s</span><span class="op" id="2892526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2892531">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2892535">case</span>&nbsp;<span class="string" id="2892540">&#39;[&#39;</span><span class="op" id="2892543">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2892548">inCharset</span>&nbsp;<span class="op" id="2892558">=</span>&nbsp;<span class="builtintype" id="2892560">true</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2892567">case</span>&nbsp;<span class="string" id="2892572">&#39;]&#39;</span><span class="op" id="2892575">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2892580">inCharset</span>&nbsp;<span class="op" id="2892590">=</span>&nbsp;<span class="builtintype" id="2892592">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2892600">default</span><span class="op" id="2892607">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2892612">//&nbsp;end&nbsp;delimiter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2892632">if</span>&nbsp;<span class="op" id="2892635">!</span><span class="ident" id="2892636">inCharset</span>&nbsp;<span class="op" id="2892646">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2892652">c</span><span class="op" id="2892653">.</span><span class="ident" id="2892654">state</span><span class="op" id="2892659">,</span>&nbsp;<span class="ident" id="2892661">c</span><span class="op" id="2892662">.</span><span class="ident" id="2892663">jsCtx</span>&nbsp;<span class="op" id="2892669">=</span>&nbsp;<span class="ident" id="2892671">stateJS</span><span class="op" id="2892678">,</span>&nbsp;<span class="ident" id="2892680">jsCtxDivOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2892695">return</span>&nbsp;<span class="ident" id="2892702">c</span><span class="op" id="2892703">,</span>&nbsp;<span class="ident" id="2892705">i</span>&nbsp;<span class="op" id="2892707">+</span>&nbsp;<span class="num" id="2892709">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2892714">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2892718">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2892722">k</span>&nbsp;<span class="op" id="2892724">=</span>&nbsp;<span class="ident" id="2892726">i</span>&nbsp;<span class="op" id="2892728">+</span>&nbsp;<span class="num" id="2892730">1</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2892733">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2892737">if</span>&nbsp;<span class="ident" id="2892740">inCharset</span>&nbsp;<span class="op" id="2892750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2892754">//&nbsp;This&nbsp;can&nbsp;be&nbsp;fixed&nbsp;by&nbsp;making&nbsp;context&nbsp;richer&nbsp;if&nbsp;interpolation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2892819">//&nbsp;into&nbsp;charsets&nbsp;is&nbsp;desired.</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2892850">return</span>&nbsp;<span class="ident" id="2892857">context</span><span class="op" id="2892864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2892869">state</span><span class="op" id="2892874">:</span>&nbsp;<span class="ident" id="2892876">stateError</span><span class="op" id="2892886">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2892891">err</span><span class="op" id="2892894">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="2892898">errorf</span><span class="op" id="2892904">(</span><span class="ident" id="2892905">ErrPartialCharset</span><span class="op" id="2892922">,</span>&nbsp;<span class="ident" id="2892924">nil</span><span class="op" id="2892927">,</span>&nbsp;<span class="num" id="2892929">0</span><span class="op" id="2892930">,</span>&nbsp;<span class="string" id="2892932">&#34;unfinished&nbsp;JS&nbsp;regexp&nbsp;charset:&nbsp;%q&#34;</span><span class="op" id="2892966">,</span>&nbsp;<span class="ident" id="2892968">s</span><span class="op" id="2892969">)</span><span class="op" id="2892970">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2892974">}</span><span class="op" id="2892975">,</span>&nbsp;<span class="builtinfunc" id="2892977">len</span><span class="op" id="2892980">(</span><span class="ident" id="2892981">s</span><span class="op" id="2892982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2892985">}</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2892989">return</span>&nbsp;<span class="ident" id="2892996">c</span><span class="op" id="2892997">,</span>&nbsp;<span class="builtinfunc" id="2892999">len</span><span class="op" id="2893002">(</span><span class="ident" id="2893003">s</span><span class="op" id="2893004">)</span><br>
<span class="lineno"></span><span class="op" id="2893006">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2893009">var</span>&nbsp;<span class="ident" id="2893013">blockCommentEnd</span>&nbsp;<span class="op" id="2893029">=</span>&nbsp;<span class="op" id="2893031">[</span><span class="op" id="2893032">]</span><span class="builtintype" id="2893033">byte</span><span class="op" id="2893037">(</span><span class="string" id="2893038">&#34;*/&#34;</span><span class="op" id="2893042">)</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span><span class="comment" id="2893045">//&nbsp;tBlockCmt&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;/*comment*/&nbsp;states.</span><br>
<span class="lineno"></span><span class="keyword" id="2893117">func</span>&nbsp;<span class="ident" id="2893122">tBlockCmt</span><span class="op" id="2893131">(</span><span class="ident" id="2893132">c</span>&nbsp;<span class="ident" id="2893134">context</span><span class="op" id="2893141">,</span>&nbsp;<span class="ident" id="2893143">s</span>&nbsp;<span class="op" id="2893145">[</span><span class="op" id="2893146">]</span><span class="builtintype" id="2893147">byte</span><span class="op" id="2893151">)</span>&nbsp;<span class="op" id="2893153">(</span><span class="ident" id="2893154">context</span><span class="op" id="2893161">,</span>&nbsp;<span class="builtintype" id="2893163">int</span><span class="op" id="2893166">)</span>&nbsp;<span class="op" id="2893168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2893171">i</span>&nbsp;<span class="op" id="2893173">:=</span>&nbsp;<span class="ident" id="2893176">bytes</span><span class="op" id="2893181">.</span><span class="ident" id="2893182">Index</span><span class="op" id="2893187">(</span><span class="ident" id="2893188">s</span><span class="op" id="2893189">,</span>&nbsp;<span class="ident" id="2893191">blockCommentEnd</span><span class="op" id="2893206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2893209">if</span>&nbsp;<span class="ident" id="2893212">i</span>&nbsp;<span class="op" id="2893214">==</span>&nbsp;<span class="op" id="2893217">-</span><span class="num" id="2893218">1</span>&nbsp;<span class="op" id="2893220">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2893224">return</span>&nbsp;<span class="ident" id="2893231">c</span><span class="op" id="2893232">,</span>&nbsp;<span class="builtinfunc" id="2893234">len</span><span class="op" id="2893237">(</span><span class="ident" id="2893238">s</span><span class="op" id="2893239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2893242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2893245">switch</span>&nbsp;<span class="ident" id="2893252">c</span><span class="op" id="2893253">.</span><span class="ident" id="2893254">state</span>&nbsp;<span class="op" id="2893260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2893263">case</span>&nbsp;<span class="ident" id="2893268">stateJSBlockCmt</span><span class="op" id="2893283">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2893287">c</span><span class="op" id="2893288">.</span><span class="ident" id="2893289">state</span>&nbsp;<span class="op" id="2893295">=</span>&nbsp;<span class="ident" id="2893297">stateJS</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2893306">case</span>&nbsp;<span class="ident" id="2893311">stateCSSBlockCmt</span><span class="op" id="2893327">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2893331">c</span><span class="op" id="2893332">.</span><span class="ident" id="2893333">state</span>&nbsp;<span class="op" id="2893339">=</span>&nbsp;<span class="ident" id="2893341">stateCSS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2893351">default</span><span class="op" id="2893358">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2893362">panic</span><span class="op" id="2893367">(</span><span class="ident" id="2893368">c</span><span class="op" id="2893369">.</span><span class="ident" id="2893370">state</span><span class="op" id="2893375">.</span><span class="ident" id="2893376">String</span><span class="op" id="2893382">(</span><span class="op" id="2893383">)</span><span class="op" id="2893384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2893387">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2893390">return</span>&nbsp;<span class="ident" id="2893397">c</span><span class="op" id="2893398">,</span>&nbsp;<span class="ident" id="2893400">i</span>&nbsp;<span class="op" id="2893402">+</span>&nbsp;<span class="num" id="2893404">2</span><br>
<span class="lineno"></span><span class="op" id="2893406">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2893409">//&nbsp;tLineCmt&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;//comment&nbsp;states.</span><br>
<span class="lineno"></span><span class="keyword" id="2893478">func</span>&nbsp;<span class="ident" id="2893483">tLineCmt</span><span class="op" id="2893491">(</span><span class="ident" id="2893492">c</span>&nbsp;<span class="ident" id="2893494">context</span><span class="op" id="2893501">,</span>&nbsp;<span class="ident" id="2893503">s</span>&nbsp;<span class="op" id="2893505">[</span><span class="op" id="2893506">]</span><span class="builtintype" id="2893507">byte</span><span class="op" id="2893511">)</span>&nbsp;<span class="op" id="2893513">(</span><span class="ident" id="2893514">context</span><span class="op" id="2893521">,</span>&nbsp;<span class="builtintype" id="2893523">int</span><span class="op" id="2893526">)</span>&nbsp;<span class="op" id="2893528">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2893531">var</span>&nbsp;<span class="ident" id="2893535">lineTerminators</span>&nbsp;<span class="builtintype" id="2893551">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2893559">var</span>&nbsp;<span class="ident" id="2893563">endState</span>&nbsp;<span class="ident" id="2893572">state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2893579">switch</span>&nbsp;<span class="ident" id="2893586">c</span><span class="op" id="2893587">.</span><span class="ident" id="2893588">state</span>&nbsp;<span class="op" id="2893594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2893597">case</span>&nbsp;<span class="ident" id="2893602">stateJSLineCmt</span><span class="op" id="2893616">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2893620">lineTerminators</span><span class="op" id="2893635">,</span>&nbsp;<span class="ident" id="2893637">endState</span>&nbsp;<span class="op" id="2893646">=</span>&nbsp;<span class="string" id="2893648">&#34;\n\r\u2028\u2029&#34;</span><span class="op" id="2893666">,</span>&nbsp;<span class="ident" id="2893668">stateJS</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2893677">case</span>&nbsp;<span class="ident" id="2893682">stateCSSLineCmt</span><span class="op" id="2893697">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2893701">lineTerminators</span><span class="op" id="2893716">,</span>&nbsp;<span class="ident" id="2893718">endState</span>&nbsp;<span class="op" id="2893727">=</span>&nbsp;<span class="string" id="2893729">&#34;\n\f\r&#34;</span><span class="op" id="2893737">,</span>&nbsp;<span class="ident" id="2893739">stateCSS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2893750">//&nbsp;Line&nbsp;comments&nbsp;are&nbsp;not&nbsp;part&nbsp;of&nbsp;any&nbsp;published&nbsp;CSS&nbsp;standard&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2893816">//&nbsp;are&nbsp;supported&nbsp;by&nbsp;the&nbsp;4&nbsp;major&nbsp;browsers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2893860">//&nbsp;This&nbsp;defines&nbsp;line&nbsp;comments&nbsp;as</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2893895">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LINECOMMENT&nbsp;::=&nbsp;&#34;//&#34;&nbsp;[^\n\f\d]*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2893936">//&nbsp;since&nbsp;http://www.w3.org/TR/css3-syntax/#SUBTOK-nl&nbsp;defines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2893999">//&nbsp;newlines:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2894014">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nl&nbsp;::=&nbsp;#xA&nbsp;|&nbsp;#xD&nbsp;#xA&nbsp;|&nbsp;#xD&nbsp;|&nbsp;#xC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2894055">default</span><span class="op" id="2894062">:</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2894066">panic</span><span class="op" id="2894071">(</span><span class="ident" id="2894072">c</span><span class="op" id="2894073">.</span><span class="ident" id="2894074">state</span><span class="op" id="2894079">.</span><span class="ident" id="2894080">String</span><span class="op" id="2894086">(</span><span class="op" id="2894087">)</span><span class="op" id="2894088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2894091">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2894095">i</span>&nbsp;<span class="op" id="2894097">:=</span>&nbsp;<span class="ident" id="2894100">bytes</span><span class="op" id="2894105">.</span><span class="ident" id="2894106">IndexAny</span><span class="op" id="2894114">(</span><span class="ident" id="2894115">s</span><span class="op" id="2894116">,</span>&nbsp;<span class="ident" id="2894118">lineTerminators</span><span class="op" id="2894133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2894136">if</span>&nbsp;<span class="ident" id="2894139">i</span>&nbsp;<span class="op" id="2894141">==</span>&nbsp;<span class="op" id="2894144">-</span><span class="num" id="2894145">1</span>&nbsp;<span class="op" id="2894147">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2894151">return</span>&nbsp;<span class="ident" id="2894158">c</span><span class="op" id="2894159">,</span>&nbsp;<span class="builtinfunc" id="2894161">len</span><span class="op" id="2894164">(</span><span class="ident" id="2894165">s</span><span class="op" id="2894166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2894169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2894172">c</span><span class="op" id="2894173">.</span><span class="ident" id="2894174">state</span>&nbsp;<span class="op" id="2894180">=</span>&nbsp;<span class="ident" id="2894182">endState</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2894192">//&nbsp;Per&nbsp;section&nbsp;7.4&nbsp;of&nbsp;EcmaScript&nbsp;5&nbsp;:&nbsp;http://es5.github.com/#x7.4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2894258">//&nbsp;&#34;However,&nbsp;the&nbsp;LineTerminator&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;line&nbsp;is&nbsp;not</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2894321">//&nbsp;considered&nbsp;to&nbsp;be&nbsp;part&nbsp;of&nbsp;the&nbsp;single-line&nbsp;comment;&nbsp;it&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2894381">//&nbsp;recognized&nbsp;separately&nbsp;by&nbsp;the&nbsp;lexical&nbsp;grammar&nbsp;and&nbsp;becomes&nbsp;part</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2894447">//&nbsp;of&nbsp;the&nbsp;stream&nbsp;of&nbsp;input&nbsp;elements&nbsp;for&nbsp;the&nbsp;syntactic&nbsp;grammar.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2894511">return</span>&nbsp;<span class="ident" id="2894518">c</span><span class="op" id="2894519">,</span>&nbsp;<span class="ident" id="2894521">i</span><br>
<span class="lineno"></span><span class="op" id="2894523">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span><span class="comment" id="2894526">//&nbsp;tCSS&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;CSS&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="2894588">func</span>&nbsp;<span class="ident" id="2894593">tCSS</span><span class="op" id="2894597">(</span><span class="ident" id="2894598">c</span>&nbsp;<span class="ident" id="2894600">context</span><span class="op" id="2894607">,</span>&nbsp;<span class="ident" id="2894609">s</span>&nbsp;<span class="op" id="2894611">[</span><span class="op" id="2894612">]</span><span class="builtintype" id="2894613">byte</span><span class="op" id="2894617">)</span>&nbsp;<span class="op" id="2894619">(</span><span class="ident" id="2894620">context</span><span class="op" id="2894627">,</span>&nbsp;<span class="builtintype" id="2894629">int</span><span class="op" id="2894632">)</span>&nbsp;<span class="op" id="2894634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2894637">//&nbsp;CSS&nbsp;quoted&nbsp;strings&nbsp;are&nbsp;almost&nbsp;never&nbsp;used&nbsp;except&nbsp;for:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2894694">//&nbsp;(1)&nbsp;URLs&nbsp;as&nbsp;in&nbsp;background:&nbsp;&#34;/foo.png&#34;</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2894736">//&nbsp;(2)&nbsp;Multiword&nbsp;font-names&nbsp;as&nbsp;in&nbsp;font-family:&nbsp;&#34;Times&nbsp;New&nbsp;Roman&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2894802">//&nbsp;(3)&nbsp;List&nbsp;separators&nbsp;in&nbsp;content&nbsp;values&nbsp;as&nbsp;in&nbsp;inline-lists:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2894864">//&nbsp;&nbsp;&nbsp;&nbsp;&lt;style&gt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2894879">//&nbsp;&nbsp;&nbsp;&nbsp;ul.inlineList&nbsp;{&nbsp;list-style:&nbsp;none;&nbsp;padding:0&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2894932">//&nbsp;&nbsp;&nbsp;&nbsp;ul.inlineList&nbsp;&gt;&nbsp;li&nbsp;{&nbsp;display:&nbsp;inline&nbsp;}</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2894978">//&nbsp;&nbsp;&nbsp;&nbsp;ul.inlineList&nbsp;&gt;&nbsp;li:before&nbsp;{&nbsp;content:&nbsp;&#34;,&nbsp;&#34;&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2895029">//&nbsp;&nbsp;&nbsp;&nbsp;ul.inlineList&nbsp;&gt;&nbsp;li:first-child:before&nbsp;{&nbsp;content:&nbsp;&#34;&#34;&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2895090">//&nbsp;&nbsp;&nbsp;&nbsp;&lt;/style&gt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2895106">//&nbsp;&nbsp;&nbsp;&nbsp;&lt;ul&nbsp;class=inlineList&gt;&lt;li&gt;One&lt;li&gt;Two&lt;li&gt;Three&lt;/ul&gt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2895163">//&nbsp;(4)&nbsp;Attribute&nbsp;value&nbsp;selectors&nbsp;as&nbsp;in&nbsp;a[href=&#34;http://example.com/&#34;]</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2895233">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2895237">//&nbsp;We&nbsp;conservatively&nbsp;treat&nbsp;all&nbsp;strings&nbsp;as&nbsp;URLs,&nbsp;but&nbsp;make&nbsp;some</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2895300">//&nbsp;allowances&nbsp;to&nbsp;avoid&nbsp;confusion.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2895335">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2895339">//&nbsp;In&nbsp;(1),&nbsp;our&nbsp;conservative&nbsp;assumption&nbsp;is&nbsp;justified.</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2895393">//&nbsp;In&nbsp;(2),&nbsp;valid&nbsp;font&nbsp;names&nbsp;do&nbsp;not&nbsp;contain&nbsp;&#39;:&#39;,&nbsp;&#39;?&#39;,&nbsp;or&nbsp;&#39;#&#39;,&nbsp;so&nbsp;our</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2895462">//&nbsp;conservative&nbsp;assumption&nbsp;is&nbsp;fine&nbsp;since&nbsp;we&nbsp;will&nbsp;never&nbsp;transition&nbsp;past</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2895534">//&nbsp;urlPartPreQuery.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2895555">//&nbsp;In&nbsp;(3),&nbsp;our&nbsp;protocol&nbsp;heuristic&nbsp;should&nbsp;not&nbsp;be&nbsp;tripped,&nbsp;and&nbsp;there</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2895623">//&nbsp;should&nbsp;not&nbsp;be&nbsp;non-space&nbsp;content&nbsp;after&nbsp;a&nbsp;&#39;?&#39;&nbsp;or&nbsp;&#39;#&#39;,&nbsp;so&nbsp;as&nbsp;long&nbsp;as</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2895693">//&nbsp;we&nbsp;only&nbsp;%-encode&nbsp;RFC&nbsp;3986&nbsp;reserved&nbsp;characters&nbsp;we&nbsp;are&nbsp;ok.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2895754">//&nbsp;In&nbsp;(4),&nbsp;we&nbsp;should&nbsp;URL&nbsp;escape&nbsp;for&nbsp;URL&nbsp;attributes,&nbsp;and&nbsp;for&nbsp;others&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2895825">//&nbsp;have&nbsp;the&nbsp;attribute&nbsp;name&nbsp;available&nbsp;if&nbsp;our&nbsp;conservative&nbsp;assumption</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2895894">//&nbsp;proves&nbsp;problematic&nbsp;for&nbsp;real&nbsp;code.</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2895933">k</span>&nbsp;<span class="op" id="2895935">:=</span>&nbsp;<span class="num" id="2895938">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2895941">for</span>&nbsp;<span class="op" id="2895945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2895949">i</span>&nbsp;<span class="op" id="2895951">:=</span>&nbsp;<span class="ident" id="2895954">k</span>&nbsp;<span class="op" id="2895956">+</span>&nbsp;<span class="ident" id="2895958">bytes</span><span class="op" id="2895963">.</span><span class="ident" id="2895964">IndexAny</span><span class="op" id="2895972">(</span><span class="ident" id="2895973">s</span><span class="op" id="2895974">[</span><span class="ident" id="2895975">k</span><span class="op" id="2895976">:</span><span class="op" id="2895977">]</span><span class="op" id="2895978">,</span>&nbsp;<span class="string" id="2895980">`(&#34;&#39;/`</span><span class="op" id="2895986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2895990">if</span>&nbsp;<span class="ident" id="2895993">i</span>&nbsp;<span class="op" id="2895995">&lt;</span>&nbsp;<span class="ident" id="2895997">k</span>&nbsp;<span class="op" id="2895999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2896004">return</span>&nbsp;<span class="ident" id="2896011">c</span><span class="op" id="2896012">,</span>&nbsp;<span class="builtinfunc" id="2896014">len</span><span class="op" id="2896017">(</span><span class="ident" id="2896018">s</span><span class="op" id="2896019">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2896023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2896027">switch</span>&nbsp;<span class="ident" id="2896034">s</span><span class="op" id="2896035">[</span><span class="ident" id="2896036">i</span><span class="op" id="2896037">]</span>&nbsp;<span class="op" id="2896039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2896043">case</span>&nbsp;<span class="string" id="2896048">&#39;(&#39;</span><span class="op" id="2896051">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2896056">//&nbsp;Look&nbsp;for&nbsp;url&nbsp;to&nbsp;the&nbsp;left.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2896088">p</span>&nbsp;<span class="op" id="2896090">:=</span>&nbsp;<span class="ident" id="2896093">bytes</span><span class="op" id="2896098">.</span><span class="ident" id="2896099">TrimRight</span><span class="op" id="2896108">(</span><span class="ident" id="2896109">s</span><span class="op" id="2896110">[</span><span class="op" id="2896111">:</span><span class="ident" id="2896112">i</span><span class="op" id="2896113">]</span><span class="op" id="2896114">,</span>&nbsp;<span class="string" id="2896116">&#34;\t\n\f\r&nbsp;&#34;</span><span class="op" id="2896127">)</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2896132">if</span>&nbsp;<span class="ident" id="2896135">endsWithCSSKeyword</span><span class="op" id="2896153">(</span><span class="ident" id="2896154">p</span><span class="op" id="2896155">,</span>&nbsp;<span class="string" id="2896157">&#34;url&#34;</span><span class="op" id="2896162">)</span>&nbsp;<span class="op" id="2896164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2896170">j</span>&nbsp;<span class="op" id="2896172">:=</span>&nbsp;<span class="builtinfunc" id="2896175">len</span><span class="op" id="2896178">(</span><span class="ident" id="2896179">s</span><span class="op" id="2896180">)</span>&nbsp;<span class="op" id="2896182">-</span>&nbsp;<span class="builtinfunc" id="2896184">len</span><span class="op" id="2896187">(</span><span class="ident" id="2896188">bytes</span><span class="op" id="2896193">.</span><span class="ident" id="2896194">TrimLeft</span><span class="op" id="2896202">(</span><span class="ident" id="2896203">s</span><span class="op" id="2896204">[</span><span class="ident" id="2896205">i</span><span class="op" id="2896206">+</span><span class="num" id="2896207">1</span><span class="op" id="2896208">:</span><span class="op" id="2896209">]</span><span class="op" id="2896210">,</span>&nbsp;<span class="string" id="2896212">&#34;\t\n\f\r&nbsp;&#34;</span><span class="op" id="2896223">)</span><span class="op" id="2896224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2896230">switch</span>&nbsp;<span class="op" id="2896237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2896243">case</span>&nbsp;<span class="ident" id="2896248">j</span>&nbsp;<span class="op" id="2896250">!=</span>&nbsp;<span class="builtinfunc" id="2896253">len</span><span class="op" id="2896256">(</span><span class="ident" id="2896257">s</span><span class="op" id="2896258">)</span>&nbsp;<span class="op" id="2896260">&amp;&amp;</span>&nbsp;<span class="ident" id="2896263">s</span><span class="op" id="2896264">[</span><span class="ident" id="2896265">j</span><span class="op" id="2896266">]</span>&nbsp;<span class="op" id="2896268">==</span>&nbsp;<span class="string" id="2896271">&#39;&#34;&#39;</span><span class="op" id="2896274">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2896281">c</span><span class="op" id="2896282">.</span><span class="ident" id="2896283">state</span><span class="op" id="2896288">,</span>&nbsp;<span class="ident" id="2896290">j</span>&nbsp;<span class="op" id="2896292">=</span>&nbsp;<span class="ident" id="2896294">stateCSSDqURL</span><span class="op" id="2896307">,</span>&nbsp;<span class="ident" id="2896309">j</span><span class="op" id="2896310">+</span><span class="num" id="2896311">1</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2896317">case</span>&nbsp;<span class="ident" id="2896322">j</span>&nbsp;<span class="op" id="2896324">!=</span>&nbsp;<span class="builtinfunc" id="2896327">len</span><span class="op" id="2896330">(</span><span class="ident" id="2896331">s</span><span class="op" id="2896332">)</span>&nbsp;<span class="op" id="2896334">&amp;&amp;</span>&nbsp;<span class="ident" id="2896337">s</span><span class="op" id="2896338">[</span><span class="ident" id="2896339">j</span><span class="op" id="2896340">]</span>&nbsp;<span class="op" id="2896342">==</span>&nbsp;<span class="string" id="2896345">&#39;\&#39;&#39;</span><span class="op" id="2896349">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2896356">c</span><span class="op" id="2896357">.</span><span class="ident" id="2896358">state</span><span class="op" id="2896363">,</span>&nbsp;<span class="ident" id="2896365">j</span>&nbsp;<span class="op" id="2896367">=</span>&nbsp;<span class="ident" id="2896369">stateCSSSqURL</span><span class="op" id="2896382">,</span>&nbsp;<span class="ident" id="2896384">j</span><span class="op" id="2896385">+</span><span class="num" id="2896386">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2896392">default</span><span class="op" id="2896399">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2896406">c</span><span class="op" id="2896407">.</span><span class="ident" id="2896408">state</span>&nbsp;<span class="op" id="2896414">=</span>&nbsp;<span class="ident" id="2896416">stateCSSURL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2896432">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2896438">return</span>&nbsp;<span class="ident" id="2896445">c</span><span class="op" id="2896446">,</span>&nbsp;<span class="ident" id="2896448">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2896453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2896457">case</span>&nbsp;<span class="string" id="2896462">&#39;/&#39;</span><span class="op" id="2896465">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2896470">if</span>&nbsp;<span class="ident" id="2896473">i</span><span class="op" id="2896474">+</span><span class="num" id="2896475">1</span>&nbsp;<span class="op" id="2896477">&lt;</span>&nbsp;<span class="builtinfunc" id="2896479">len</span><span class="op" id="2896482">(</span><span class="ident" id="2896483">s</span><span class="op" id="2896484">)</span>&nbsp;<span class="op" id="2896486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2896492">switch</span>&nbsp;<span class="ident" id="2896499">s</span><span class="op" id="2896500">[</span><span class="ident" id="2896501">i</span><span class="op" id="2896502">+</span><span class="num" id="2896503">1</span><span class="op" id="2896504">]</span>&nbsp;<span class="op" id="2896506">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2896512">case</span>&nbsp;<span class="string" id="2896517">&#39;/&#39;</span><span class="op" id="2896520">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2896527">c</span><span class="op" id="2896528">.</span><span class="ident" id="2896529">state</span>&nbsp;<span class="op" id="2896535">=</span>&nbsp;<span class="ident" id="2896537">stateCSSLineCmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2896558">return</span>&nbsp;<span class="ident" id="2896565">c</span><span class="op" id="2896566">,</span>&nbsp;<span class="ident" id="2896568">i</span>&nbsp;<span class="op" id="2896570">+</span>&nbsp;<span class="num" id="2896572">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2896578">case</span>&nbsp;<span class="string" id="2896583">&#39;*&#39;</span><span class="op" id="2896586">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2896593">c</span><span class="op" id="2896594">.</span><span class="ident" id="2896595">state</span>&nbsp;<span class="op" id="2896601">=</span>&nbsp;<span class="ident" id="2896603">stateCSSBlockCmt</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2896625">return</span>&nbsp;<span class="ident" id="2896632">c</span><span class="op" id="2896633">,</span>&nbsp;<span class="ident" id="2896635">i</span>&nbsp;<span class="op" id="2896637">+</span>&nbsp;<span class="num" id="2896639">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2896645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2896650">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2896654">case</span>&nbsp;<span class="string" id="2896659">&#39;&#34;&#39;</span><span class="op" id="2896662">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2896667">c</span><span class="op" id="2896668">.</span><span class="ident" id="2896669">state</span>&nbsp;<span class="op" id="2896675">=</span>&nbsp;<span class="ident" id="2896677">stateCSSDqStr</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2896694">return</span>&nbsp;<span class="ident" id="2896701">c</span><span class="op" id="2896702">,</span>&nbsp;<span class="ident" id="2896704">i</span>&nbsp;<span class="op" id="2896706">+</span>&nbsp;<span class="num" id="2896708">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2896712">case</span>&nbsp;<span class="string" id="2896717">&#39;\&#39;&#39;</span><span class="op" id="2896721">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2896726">c</span><span class="op" id="2896727">.</span><span class="ident" id="2896728">state</span>&nbsp;<span class="op" id="2896734">=</span>&nbsp;<span class="ident" id="2896736">stateCSSSqStr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2896753">return</span>&nbsp;<span class="ident" id="2896760">c</span><span class="op" id="2896761">,</span>&nbsp;<span class="ident" id="2896763">i</span>&nbsp;<span class="op" id="2896765">+</span>&nbsp;<span class="num" id="2896767">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2896771">}</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2896775">k</span>&nbsp;<span class="op" id="2896777">=</span>&nbsp;<span class="ident" id="2896779">i</span>&nbsp;<span class="op" id="2896781">+</span>&nbsp;<span class="num" id="2896783">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2896786">}</span><br>
<span class="lineno"></span><span class="op" id="2896788">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2896791">//&nbsp;tCSSStr&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;CSS&nbsp;string&nbsp;and&nbsp;URL&nbsp;states.</span><br>
<span class="lineno">435</span><span class="keyword" id="2896872">func</span>&nbsp;<span class="ident" id="2896877">tCSSStr</span><span class="op" id="2896884">(</span><span class="ident" id="2896885">c</span>&nbsp;<span class="ident" id="2896887">context</span><span class="op" id="2896894">,</span>&nbsp;<span class="ident" id="2896896">s</span>&nbsp;<span class="op" id="2896898">[</span><span class="op" id="2896899">]</span><span class="builtintype" id="2896900">byte</span><span class="op" id="2896904">)</span>&nbsp;<span class="op" id="2896906">(</span><span class="ident" id="2896907">context</span><span class="op" id="2896914">,</span>&nbsp;<span class="builtintype" id="2896916">int</span><span class="op" id="2896919">)</span>&nbsp;<span class="op" id="2896921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2896924">var</span>&nbsp;<span class="ident" id="2896928">endAndEsc</span>&nbsp;<span class="builtintype" id="2896938">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2896946">switch</span>&nbsp;<span class="ident" id="2896953">c</span><span class="op" id="2896954">.</span><span class="ident" id="2896955">state</span>&nbsp;<span class="op" id="2896961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2896964">case</span>&nbsp;<span class="ident" id="2896969">stateCSSDqStr</span><span class="op" id="2896982">,</span>&nbsp;<span class="ident" id="2896984">stateCSSDqURL</span><span class="op" id="2896997">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2897001">endAndEsc</span>&nbsp;<span class="op" id="2897011">=</span>&nbsp;<span class="string" id="2897013">`\&#34;`</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2897019">case</span>&nbsp;<span class="ident" id="2897024">stateCSSSqStr</span><span class="op" id="2897037">,</span>&nbsp;<span class="ident" id="2897039">stateCSSSqURL</span><span class="op" id="2897052">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2897056">endAndEsc</span>&nbsp;<span class="op" id="2897066">=</span>&nbsp;<span class="string" id="2897068">`\&#39;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2897074">case</span>&nbsp;<span class="ident" id="2897079">stateCSSURL</span><span class="op" id="2897090">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2897094">//&nbsp;Unquoted&nbsp;URLs&nbsp;end&nbsp;with&nbsp;a&nbsp;newline&nbsp;or&nbsp;close&nbsp;parenthesis.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2897154">//&nbsp;The&nbsp;below&nbsp;includes&nbsp;the&nbsp;wc&nbsp;(whitespace&nbsp;character)&nbsp;and&nbsp;nl.</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2897216">endAndEsc</span>&nbsp;<span class="op" id="2897226">=</span>&nbsp;<span class="string" id="2897228">&#34;\\\t\n\f\r&nbsp;)&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2897244">default</span><span class="op" id="2897251">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2897255">panic</span><span class="op" id="2897260">(</span><span class="ident" id="2897261">c</span><span class="op" id="2897262">.</span><span class="ident" id="2897263">state</span><span class="op" id="2897268">.</span><span class="ident" id="2897269">String</span><span class="op" id="2897275">(</span><span class="op" id="2897276">)</span><span class="op" id="2897277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2897280">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2897284">k</span>&nbsp;<span class="op" id="2897286">:=</span>&nbsp;<span class="num" id="2897289">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2897292">for</span>&nbsp;<span class="op" id="2897296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2897300">i</span>&nbsp;<span class="op" id="2897302">:=</span>&nbsp;<span class="ident" id="2897305">k</span>&nbsp;<span class="op" id="2897307">+</span>&nbsp;<span class="ident" id="2897309">bytes</span><span class="op" id="2897314">.</span><span class="ident" id="2897315">IndexAny</span><span class="op" id="2897323">(</span><span class="ident" id="2897324">s</span><span class="op" id="2897325">[</span><span class="ident" id="2897326">k</span><span class="op" id="2897327">:</span><span class="op" id="2897328">]</span><span class="op" id="2897329">,</span>&nbsp;<span class="ident" id="2897331">endAndEsc</span><span class="op" id="2897340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2897344">if</span>&nbsp;<span class="ident" id="2897347">i</span>&nbsp;<span class="op" id="2897349">&lt;</span>&nbsp;<span class="ident" id="2897351">k</span>&nbsp;<span class="op" id="2897353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2897358">c</span><span class="op" id="2897359">,</span>&nbsp;<span class="ident" id="2897361">nread</span>&nbsp;<span class="op" id="2897367">:=</span>&nbsp;<span class="ident" id="2897370">tURL</span><span class="op" id="2897374">(</span><span class="ident" id="2897375">c</span><span class="op" id="2897376">,</span>&nbsp;<span class="ident" id="2897378">decodeCSS</span><span class="op" id="2897387">(</span><span class="ident" id="2897388">s</span><span class="op" id="2897389">[</span><span class="ident" id="2897390">k</span><span class="op" id="2897391">:</span><span class="op" id="2897392">]</span><span class="op" id="2897393">)</span><span class="op" id="2897394">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2897399">return</span>&nbsp;<span class="ident" id="2897406">c</span><span class="op" id="2897407">,</span>&nbsp;<span class="ident" id="2897409">k</span>&nbsp;<span class="op" id="2897411">+</span>&nbsp;<span class="ident" id="2897413">nread</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2897421">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2897425">if</span>&nbsp;<span class="ident" id="2897428">s</span><span class="op" id="2897429">[</span><span class="ident" id="2897430">i</span><span class="op" id="2897431">]</span>&nbsp;<span class="op" id="2897433">==</span>&nbsp;<span class="string" id="2897436">&#39;\\&#39;</span>&nbsp;<span class="op" id="2897441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2897446">i</span><span class="op" id="2897447">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2897453">if</span>&nbsp;<span class="ident" id="2897456">i</span>&nbsp;<span class="op" id="2897458">==</span>&nbsp;<span class="builtinfunc" id="2897461">len</span><span class="op" id="2897464">(</span><span class="ident" id="2897465">s</span><span class="op" id="2897466">)</span>&nbsp;<span class="op" id="2897468">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2897474">return</span>&nbsp;<span class="ident" id="2897481">context</span><span class="op" id="2897488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2897495">state</span><span class="op" id="2897500">:</span>&nbsp;<span class="ident" id="2897502">stateError</span><span class="op" id="2897512">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2897519">err</span><span class="op" id="2897522">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="2897526">errorf</span><span class="op" id="2897532">(</span><span class="ident" id="2897533">ErrPartialEscape</span><span class="op" id="2897549">,</span>&nbsp;<span class="ident" id="2897551">nil</span><span class="op" id="2897554">,</span>&nbsp;<span class="num" id="2897556">0</span><span class="op" id="2897557">,</span>&nbsp;<span class="string" id="2897559">&#34;unfinished&nbsp;escape&nbsp;sequence&nbsp;in&nbsp;CSS&nbsp;string:&nbsp;%q&#34;</span><span class="op" id="2897605">,</span>&nbsp;<span class="ident" id="2897607">s</span><span class="op" id="2897608">)</span><span class="op" id="2897609">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2897615">}</span><span class="op" id="2897616">,</span>&nbsp;<span class="builtinfunc" id="2897618">len</span><span class="op" id="2897621">(</span><span class="ident" id="2897622">s</span><span class="op" id="2897623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2897628">}</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2897632">}</span>&nbsp;<span class="keyword" id="2897634">else</span>&nbsp;<span class="op" id="2897639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2897644">c</span><span class="op" id="2897645">.</span><span class="ident" id="2897646">state</span>&nbsp;<span class="op" id="2897652">=</span>&nbsp;<span class="ident" id="2897654">stateCSS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2897666">return</span>&nbsp;<span class="ident" id="2897673">c</span><span class="op" id="2897674">,</span>&nbsp;<span class="ident" id="2897676">i</span>&nbsp;<span class="op" id="2897678">+</span>&nbsp;<span class="num" id="2897680">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2897684">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2897688">c</span><span class="op" id="2897689">,</span>&nbsp;<span class="ident" id="2897691">_</span>&nbsp;<span class="op" id="2897693">=</span>&nbsp;<span class="ident" id="2897695">tURL</span><span class="op" id="2897699">(</span><span class="ident" id="2897700">c</span><span class="op" id="2897701">,</span>&nbsp;<span class="ident" id="2897703">decodeCSS</span><span class="op" id="2897712">(</span><span class="ident" id="2897713">s</span><span class="op" id="2897714">[</span><span class="op" id="2897715">:</span><span class="ident" id="2897716">i</span><span class="op" id="2897717">+</span><span class="num" id="2897718">1</span><span class="op" id="2897719">]</span><span class="op" id="2897720">)</span><span class="op" id="2897721">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2897725">k</span>&nbsp;<span class="op" id="2897727">=</span>&nbsp;<span class="ident" id="2897729">i</span>&nbsp;<span class="op" id="2897731">+</span>&nbsp;<span class="num" id="2897733">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2897736">}</span><br>
<span class="lineno"></span><span class="op" id="2897738">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2897741">//&nbsp;tError&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;error&nbsp;state.</span><br>
<span class="lineno">475</span><span class="keyword" id="2897807">func</span>&nbsp;<span class="ident" id="2897812">tError</span><span class="op" id="2897818">(</span><span class="ident" id="2897819">c</span>&nbsp;<span class="ident" id="2897821">context</span><span class="op" id="2897828">,</span>&nbsp;<span class="ident" id="2897830">s</span>&nbsp;<span class="op" id="2897832">[</span><span class="op" id="2897833">]</span><span class="builtintype" id="2897834">byte</span><span class="op" id="2897838">)</span>&nbsp;<span class="op" id="2897840">(</span><span class="ident" id="2897841">context</span><span class="op" id="2897848">,</span>&nbsp;<span class="builtintype" id="2897850">int</span><span class="op" id="2897853">)</span>&nbsp;<span class="op" id="2897855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2897858">return</span>&nbsp;<span class="ident" id="2897865">c</span><span class="op" id="2897866">,</span>&nbsp;<span class="builtinfunc" id="2897868">len</span><span class="op" id="2897871">(</span><span class="ident" id="2897872">s</span><span class="op" id="2897873">)</span><br>
<span class="lineno"></span><span class="op" id="2897875">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2897878">//&nbsp;eatAttrName&nbsp;returns&nbsp;the&nbsp;largest&nbsp;j&nbsp;such&nbsp;that&nbsp;s[i:j]&nbsp;is&nbsp;an&nbsp;attribute&nbsp;name.</span><br>
<span class="lineno">480</span><span class="comment" id="2897954">//&nbsp;It&nbsp;returns&nbsp;an&nbsp;error&nbsp;if&nbsp;s[i:]&nbsp;does&nbsp;not&nbsp;look&nbsp;like&nbsp;it&nbsp;begins&nbsp;with&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="2898023">//&nbsp;attribute&nbsp;name,&nbsp;such&nbsp;as&nbsp;encountering&nbsp;a&nbsp;quote&nbsp;mark&nbsp;without&nbsp;a&nbsp;preceding</span><br>
<span class="lineno"></span><span class="comment" id="2898096">//&nbsp;equals&nbsp;sign.</span><br>
<span class="lineno"></span><span class="keyword" id="2898112">func</span>&nbsp;<span class="ident" id="2898117">eatAttrName</span><span class="op" id="2898128">(</span><span class="ident" id="2898129">s</span>&nbsp;<span class="op" id="2898131">[</span><span class="op" id="2898132">]</span><span class="builtintype" id="2898133">byte</span><span class="op" id="2898137">,</span>&nbsp;<span class="ident" id="2898139">i</span>&nbsp;<span class="builtintype" id="2898141">int</span><span class="op" id="2898144">)</span>&nbsp;<span class="op" id="2898146">(</span><span class="builtintype" id="2898147">int</span><span class="op" id="2898150">,</span>&nbsp;<span class="op" id="2898152">*</span><span class="ident" id="2898153">Error</span><span class="op" id="2898158">)</span>&nbsp;<span class="op" id="2898160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2898163">for</span>&nbsp;<span class="ident" id="2898167">j</span>&nbsp;<span class="op" id="2898169">:=</span>&nbsp;<span class="ident" id="2898172">i</span><span class="op" id="2898173">;</span>&nbsp;<span class="ident" id="2898175">j</span>&nbsp;<span class="op" id="2898177">&lt;</span>&nbsp;<span class="builtinfunc" id="2898179">len</span><span class="op" id="2898182">(</span><span class="ident" id="2898183">s</span><span class="op" id="2898184">)</span><span class="op" id="2898185">;</span>&nbsp;<span class="ident" id="2898187">j</span><span class="op" id="2898188">++</span>&nbsp;<span class="op" id="2898191">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2898195">switch</span>&nbsp;<span class="ident" id="2898202">s</span><span class="op" id="2898203">[</span><span class="ident" id="2898204">j</span><span class="op" id="2898205">]</span>&nbsp;<span class="op" id="2898207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2898211">case</span>&nbsp;<span class="string" id="2898216">&#39;&nbsp;&#39;</span><span class="op" id="2898219">,</span>&nbsp;<span class="string" id="2898221">&#39;\t&#39;</span><span class="op" id="2898225">,</span>&nbsp;<span class="string" id="2898227">&#39;\n&#39;</span><span class="op" id="2898231">,</span>&nbsp;<span class="string" id="2898233">&#39;\f&#39;</span><span class="op" id="2898237">,</span>&nbsp;<span class="string" id="2898239">&#39;\r&#39;</span><span class="op" id="2898243">,</span>&nbsp;<span class="string" id="2898245">&#39;=&#39;</span><span class="op" id="2898248">,</span>&nbsp;<span class="string" id="2898250">&#39;&gt;&#39;</span><span class="op" id="2898253">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2898258">return</span>&nbsp;<span class="ident" id="2898265">j</span><span class="op" id="2898266">,</span>&nbsp;<span class="ident" id="2898268">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2898274">case</span>&nbsp;<span class="string" id="2898279">&#39;\&#39;&#39;</span><span class="op" id="2898283">,</span>&nbsp;<span class="string" id="2898285">&#39;&#34;&#39;</span><span class="op" id="2898288">,</span>&nbsp;<span class="string" id="2898290">&#39;&lt;&#39;</span><span class="op" id="2898293">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2898298">//&nbsp;These&nbsp;result&nbsp;in&nbsp;a&nbsp;parse&nbsp;warning&nbsp;in&nbsp;HTML5&nbsp;and&nbsp;are</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2898353">//&nbsp;indicative&nbsp;of&nbsp;serious&nbsp;problems&nbsp;if&nbsp;seen&nbsp;in&nbsp;an&nbsp;attr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2898409">//&nbsp;name&nbsp;in&nbsp;a&nbsp;template.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2898435">return</span>&nbsp;<span class="op" id="2898442">-</span><span class="num" id="2898443">1</span><span class="op" id="2898444">,</span>&nbsp;<span class="ident" id="2898446">errorf</span><span class="op" id="2898452">(</span><span class="ident" id="2898453">ErrBadHTML</span><span class="op" id="2898463">,</span>&nbsp;<span class="ident" id="2898465">nil</span><span class="op" id="2898468">,</span>&nbsp;<span class="num" id="2898470">0</span><span class="op" id="2898471">,</span>&nbsp;<span class="string" id="2898473">&#34;%q&nbsp;in&nbsp;attribute&nbsp;name:&nbsp;%.32q&#34;</span><span class="op" id="2898502">,</span>&nbsp;<span class="ident" id="2898504">s</span><span class="op" id="2898505">[</span><span class="ident" id="2898506">j</span><span class="op" id="2898507">:</span><span class="ident" id="2898508">j</span><span class="op" id="2898509">+</span><span class="num" id="2898510">1</span><span class="op" id="2898511">]</span><span class="op" id="2898512">,</span>&nbsp;<span class="ident" id="2898514">s</span><span class="op" id="2898515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2898519">default</span><span class="op" id="2898526">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2898531">//&nbsp;No-op.</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2898543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2898546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2898549">return</span>&nbsp;<span class="builtinfunc" id="2898556">len</span><span class="op" id="2898559">(</span><span class="ident" id="2898560">s</span><span class="op" id="2898561">)</span><span class="op" id="2898562">,</span>&nbsp;<span class="ident" id="2898564">nil</span><br>
<span class="lineno"></span><span class="op" id="2898568">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">500</span><span class="keyword" id="2898571">var</span>&nbsp;<span class="ident" id="2898575">elementNameMap</span>&nbsp;<span class="op" id="2898590">=</span>&nbsp;<span class="keyword" id="2898592">map</span><span class="op" id="2898595">[</span><span class="builtintype" id="2898596">string</span><span class="op" id="2898602">]</span><span class="ident" id="2898603">element</span><span class="op" id="2898610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2898613">&#34;script&#34;</span><span class="op" id="2898621">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="2898625">elementScript</span><span class="op" id="2898638">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2898641">&#34;style&#34;</span><span class="op" id="2898648">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2898653">elementStyle</span><span class="op" id="2898665">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2898668">&#34;textarea&#34;</span><span class="op" id="2898678">:</span>&nbsp;<span class="ident" id="2898680">elementTextarea</span><span class="op" id="2898695">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2898698">&#34;title&#34;</span><span class="op" id="2898705">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2898710">elementTitle</span><span class="op" id="2898722">,</span><br>
<span class="lineno">505</span><span class="op" id="2898724">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2898727">//&nbsp;asciiAlpha&nbsp;reports&nbsp;whether&nbsp;c&nbsp;is&nbsp;an&nbsp;ASCII&nbsp;letter.</span><br>
<span class="lineno"></span><span class="keyword" id="2898779">func</span>&nbsp;<span class="ident" id="2898784">asciiAlpha</span><span class="op" id="2898794">(</span><span class="ident" id="2898795">c</span>&nbsp;<span class="builtintype" id="2898797">byte</span><span class="op" id="2898801">)</span>&nbsp;<span class="builtintype" id="2898803">bool</span>&nbsp;<span class="op" id="2898808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2898811">return</span>&nbsp;<span class="string" id="2898818">&#39;A&#39;</span>&nbsp;<span class="op" id="2898822">&lt;=</span>&nbsp;<span class="ident" id="2898825">c</span>&nbsp;<span class="op" id="2898827">&amp;&amp;</span>&nbsp;<span class="ident" id="2898830">c</span>&nbsp;<span class="op" id="2898832">&lt;=</span>&nbsp;<span class="string" id="2898835">&#39;Z&#39;</span>&nbsp;<span class="op" id="2898839">||</span>&nbsp;<span class="string" id="2898842">&#39;a&#39;</span>&nbsp;<span class="op" id="2898846">&lt;=</span>&nbsp;<span class="ident" id="2898849">c</span>&nbsp;<span class="op" id="2898851">&amp;&amp;</span>&nbsp;<span class="ident" id="2898854">c</span>&nbsp;<span class="op" id="2898856">&lt;=</span>&nbsp;<span class="string" id="2898859">&#39;z&#39;</span><br>
<span class="lineno">510</span><span class="op" id="2898863">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2898866">//&nbsp;asciiAlphaNum&nbsp;reports&nbsp;whether&nbsp;c&nbsp;is&nbsp;an&nbsp;ASCII&nbsp;letter&nbsp;or&nbsp;digit.</span><br>
<span class="lineno"></span><span class="keyword" id="2898930">func</span>&nbsp;<span class="ident" id="2898935">asciiAlphaNum</span><span class="op" id="2898948">(</span><span class="ident" id="2898949">c</span>&nbsp;<span class="builtintype" id="2898951">byte</span><span class="op" id="2898955">)</span>&nbsp;<span class="builtintype" id="2898957">bool</span>&nbsp;<span class="op" id="2898962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2898965">return</span>&nbsp;<span class="ident" id="2898972">asciiAlpha</span><span class="op" id="2898982">(</span><span class="ident" id="2898983">c</span><span class="op" id="2898984">)</span>&nbsp;<span class="op" id="2898986">||</span>&nbsp;<span class="string" id="2898989">&#39;0&#39;</span>&nbsp;<span class="op" id="2898993">&lt;=</span>&nbsp;<span class="ident" id="2898996">c</span>&nbsp;<span class="op" id="2898998">&amp;&amp;</span>&nbsp;<span class="ident" id="2899001">c</span>&nbsp;<span class="op" id="2899003">&lt;=</span>&nbsp;<span class="string" id="2899006">&#39;9&#39;</span><br>
<span class="lineno">515</span><span class="op" id="2899010">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2899013">//&nbsp;eatTagName&nbsp;returns&nbsp;the&nbsp;largest&nbsp;j&nbsp;such&nbsp;that&nbsp;s[i:j]&nbsp;is&nbsp;a&nbsp;tag&nbsp;name&nbsp;and&nbsp;the&nbsp;tag&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="2899098">func</span>&nbsp;<span class="ident" id="2899103">eatTagName</span><span class="op" id="2899113">(</span><span class="ident" id="2899114">s</span>&nbsp;<span class="op" id="2899116">[</span><span class="op" id="2899117">]</span><span class="builtintype" id="2899118">byte</span><span class="op" id="2899122">,</span>&nbsp;<span class="ident" id="2899124">i</span>&nbsp;<span class="builtintype" id="2899126">int</span><span class="op" id="2899129">)</span>&nbsp;<span class="op" id="2899131">(</span><span class="builtintype" id="2899132">int</span><span class="op" id="2899135">,</span>&nbsp;<span class="ident" id="2899137">element</span><span class="op" id="2899144">)</span>&nbsp;<span class="op" id="2899146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2899149">if</span>&nbsp;<span class="ident" id="2899152">i</span>&nbsp;<span class="op" id="2899154">==</span>&nbsp;<span class="builtinfunc" id="2899157">len</span><span class="op" id="2899160">(</span><span class="ident" id="2899161">s</span><span class="op" id="2899162">)</span>&nbsp;<span class="op" id="2899164">||</span>&nbsp;<span class="op" id="2899167">!</span><span class="ident" id="2899168">asciiAlpha</span><span class="op" id="2899178">(</span><span class="ident" id="2899179">s</span><span class="op" id="2899180">[</span><span class="ident" id="2899181">i</span><span class="op" id="2899182">]</span><span class="op" id="2899183">)</span>&nbsp;<span class="op" id="2899185">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2899189">return</span>&nbsp;<span class="ident" id="2899196">i</span><span class="op" id="2899197">,</span>&nbsp;<span class="ident" id="2899199">elementNone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2899212">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2899215">j</span>&nbsp;<span class="op" id="2899217">:=</span>&nbsp;<span class="ident" id="2899220">i</span>&nbsp;<span class="op" id="2899222">+</span>&nbsp;<span class="num" id="2899224">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2899227">for</span>&nbsp;<span class="ident" id="2899231">j</span>&nbsp;<span class="op" id="2899233">&lt;</span>&nbsp;<span class="builtinfunc" id="2899235">len</span><span class="op" id="2899238">(</span><span class="ident" id="2899239">s</span><span class="op" id="2899240">)</span>&nbsp;<span class="op" id="2899242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2899246">x</span>&nbsp;<span class="op" id="2899248">:=</span>&nbsp;<span class="ident" id="2899251">s</span><span class="op" id="2899252">[</span><span class="ident" id="2899253">j</span><span class="op" id="2899254">]</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2899258">if</span>&nbsp;<span class="ident" id="2899261">asciiAlphaNum</span><span class="op" id="2899274">(</span><span class="ident" id="2899275">x</span><span class="op" id="2899276">)</span>&nbsp;<span class="op" id="2899278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2899283">j</span><span class="op" id="2899284">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2899290">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2899301">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2899305">//&nbsp;Allow&nbsp;&#34;x-y&#34;&nbsp;or&nbsp;&#34;x:y&#34;&nbsp;but&nbsp;not&nbsp;&#34;x-&#34;,&nbsp;&#34;-y&#34;,&nbsp;or&nbsp;&#34;x--y&#34;.</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2899362">if</span>&nbsp;<span class="op" id="2899365">(</span><span class="ident" id="2899366">x</span>&nbsp;<span class="op" id="2899368">==</span>&nbsp;<span class="string" id="2899371">&#39;:&#39;</span>&nbsp;<span class="op" id="2899375">||</span>&nbsp;<span class="ident" id="2899378">x</span>&nbsp;<span class="op" id="2899380">==</span>&nbsp;<span class="string" id="2899383">&#39;-&#39;</span><span class="op" id="2899386">)</span>&nbsp;<span class="op" id="2899388">&amp;&amp;</span>&nbsp;<span class="ident" id="2899391">j</span><span class="op" id="2899392">+</span><span class="num" id="2899393">1</span>&nbsp;<span class="op" id="2899395">&lt;</span>&nbsp;<span class="builtinfunc" id="2899397">len</span><span class="op" id="2899400">(</span><span class="ident" id="2899401">s</span><span class="op" id="2899402">)</span>&nbsp;<span class="op" id="2899404">&amp;&amp;</span>&nbsp;<span class="ident" id="2899407">asciiAlphaNum</span><span class="op" id="2899420">(</span><span class="ident" id="2899421">s</span><span class="op" id="2899422">[</span><span class="ident" id="2899423">j</span><span class="op" id="2899424">+</span><span class="num" id="2899425">1</span><span class="op" id="2899426">]</span><span class="op" id="2899427">)</span>&nbsp;<span class="op" id="2899429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2899434">j</span>&nbsp;<span class="op" id="2899436">+=</span>&nbsp;<span class="num" id="2899439">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2899444">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2899455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2899459">break</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2899466">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2899469">return</span>&nbsp;<span class="ident" id="2899476">j</span><span class="op" id="2899477">,</span>&nbsp;<span class="ident" id="2899479">elementNameMap</span><span class="op" id="2899493">[</span><span class="ident" id="2899494">strings</span><span class="op" id="2899501">.</span><span class="ident" id="2899502">ToLower</span><span class="op" id="2899509">(</span><span class="builtintype" id="2899510">string</span><span class="op" id="2899516">(</span><span class="ident" id="2899517">s</span><span class="op" id="2899518">[</span><span class="ident" id="2899519">i</span><span class="op" id="2899520">:</span><span class="ident" id="2899521">j</span><span class="op" id="2899522">]</span><span class="op" id="2899523">)</span><span class="op" id="2899524">)</span><span class="op" id="2899525">]</span><br>
<span class="lineno"></span><span class="op" id="2899527">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2899530">//&nbsp;eatWhiteSpace&nbsp;returns&nbsp;the&nbsp;largest&nbsp;j&nbsp;such&nbsp;that&nbsp;s[i:j]&nbsp;is&nbsp;white&nbsp;space.</span><br>
<span class="lineno">540</span><span class="keyword" id="2899602">func</span>&nbsp;<span class="ident" id="2899607">eatWhiteSpace</span><span class="op" id="2899620">(</span><span class="ident" id="2899621">s</span>&nbsp;<span class="op" id="2899623">[</span><span class="op" id="2899624">]</span><span class="builtintype" id="2899625">byte</span><span class="op" id="2899629">,</span>&nbsp;<span class="ident" id="2899631">i</span>&nbsp;<span class="builtintype" id="2899633">int</span><span class="op" id="2899636">)</span>&nbsp;<span class="builtintype" id="2899638">int</span>&nbsp;<span class="op" id="2899642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2899645">for</span>&nbsp;<span class="ident" id="2899649">j</span>&nbsp;<span class="op" id="2899651">:=</span>&nbsp;<span class="ident" id="2899654">i</span><span class="op" id="2899655">;</span>&nbsp;<span class="ident" id="2899657">j</span>&nbsp;<span class="op" id="2899659">&lt;</span>&nbsp;<span class="builtinfunc" id="2899661">len</span><span class="op" id="2899664">(</span><span class="ident" id="2899665">s</span><span class="op" id="2899666">)</span><span class="op" id="2899667">;</span>&nbsp;<span class="ident" id="2899669">j</span><span class="op" id="2899670">++</span>&nbsp;<span class="op" id="2899673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2899677">switch</span>&nbsp;<span class="ident" id="2899684">s</span><span class="op" id="2899685">[</span><span class="ident" id="2899686">j</span><span class="op" id="2899687">]</span>&nbsp;<span class="op" id="2899689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2899693">case</span>&nbsp;<span class="string" id="2899698">&#39;&nbsp;&#39;</span><span class="op" id="2899701">,</span>&nbsp;<span class="string" id="2899703">&#39;\t&#39;</span><span class="op" id="2899707">,</span>&nbsp;<span class="string" id="2899709">&#39;\n&#39;</span><span class="op" id="2899713">,</span>&nbsp;<span class="string" id="2899715">&#39;\f&#39;</span><span class="op" id="2899719">,</span>&nbsp;<span class="string" id="2899721">&#39;\r&#39;</span><span class="op" id="2899725">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2899730">//&nbsp;No-op.</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2899742">default</span><span class="op" id="2899749">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2899754">return</span>&nbsp;<span class="ident" id="2899761">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2899765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2899768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2899771">return</span>&nbsp;<span class="builtinfunc" id="2899778">len</span><span class="op" id="2899781">(</span><span class="ident" id="2899782">s</span><span class="op" id="2899783">)</span><br>
<span class="lineno">550</span><span class="op" id="2899785">}</span>
</div>
</body>
</html>
