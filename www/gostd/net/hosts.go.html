<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html" class="current">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3272875">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3272930">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3272984">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3273035">//&nbsp;Read&nbsp;static&nbsp;host/IP&nbsp;entries&nbsp;from&nbsp;/etc/hosts.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3273084">package</span>&nbsp;<span class="ident" id="3273092">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3273097">import</span>&nbsp;<span class="op" id="3273104">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3273107">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3273115">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3273122">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3273125">const</span>&nbsp;<span class="ident" id="3273131">cacheMaxAge</span>&nbsp;<span class="op" id="3273143">=</span>&nbsp;<span class="num" id="3273145">5</span>&nbsp;<span class="op" id="3273147">*</span>&nbsp;<span class="ident" id="3273149"><a href="/gostd/net/hosts.go.html#3273115">time</a></span><span class="op" id="3273153">.</span><span class="ident" id="3273154"><a href="/gostd/time/time.go.html#2734905">Minute</a></span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="3273162">//&nbsp;hostsPath&nbsp;points&nbsp;to&nbsp;the&nbsp;file&nbsp;with&nbsp;static&nbsp;IP/address&nbsp;entries.</span><br>
<span class="lineno"></span><span class="keyword" id="3273226">var</span>&nbsp;<span class="ident" id="3273230">hostsPath</span>&nbsp;<span class="op" id="3273240">=</span>&nbsp;<span class="string" id="3273242">&#34;/etc/hosts&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3273256">//&nbsp;Simple&nbsp;cache.</span><br>
<span class="lineno">20</span><span class="keyword" id="3273273">var</span>&nbsp;<span class="ident" id="3273277">hosts</span>&nbsp;<span class="keyword" id="3273283">struct</span>&nbsp;<span class="op" id="3273290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3273293"><a href="/gostd/net/hosts.go.html#3273107">sync</a></span><span class="op" id="3273297">.</span><span class="ident" id="3273298"><a href="/gostd/sync/mutex.go.html#1443974">Mutex</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3273305">byName</span>&nbsp;<span class="keyword" id="3273312">map</span><span class="op" id="3273315">[</span><span class="builtintype" id="3273316">string</span><span class="op" id="3273322">]</span><span class="op" id="3273323">[</span><span class="op" id="3273324">]</span><span class="builtintype" id="3273325">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3273333">byAddr</span>&nbsp;<span class="keyword" id="3273340">map</span><span class="op" id="3273343">[</span><span class="builtintype" id="3273344">string</span><span class="op" id="3273350">]</span><span class="op" id="3273351">[</span><span class="op" id="3273352">]</span><span class="builtintype" id="3273353">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3273361">expire</span>&nbsp;<span class="ident" id="3273368"><a href="/gostd/net/hosts.go.html#3273115">time</a></span><span class="op" id="3273372">.</span><span class="ident" id="3273373"><a href="/gostd/time/time.go.html#2722087">Time</a></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3273379">path</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3273386">string</span><br>
<span class="lineno"></span><span class="op" id="3273393">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3273396">func</span>&nbsp;<span class="ident" id="3273401">readHosts</span><span class="op" id="3273410">(</span><span class="op" id="3273411">)</span>&nbsp;<span class="op" id="3273413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3273416">now</span>&nbsp;<span class="op" id="3273420">:=</span>&nbsp;<span class="ident" id="3273423"><a href="/gostd/net/hosts.go.html#3273115">time</a></span><span class="op" id="3273427">.</span><span class="ident" id="3273428"><a href="/gostd/time/time.go.html#2743088">Now</a></span><span class="op" id="3273431">(</span><span class="op" id="3273432">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3273435">hp</span>&nbsp;<span class="op" id="3273438">:=</span>&nbsp;<span class="ident" id="3273441"><a href="/gostd/net/hosts.go.html#3273230">hostsPath</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3273452">if</span>&nbsp;<span class="builtinfunc" id="3273455">len</span><span class="op" id="3273458">(</span><span class="ident" id="3273459"><a href="/gostd/net/hosts.go.html#3273277">hosts</a></span><span class="op" id="3273464">.</span><span class="ident" id="3273465"><a href="/gostd/net/hosts.go.html#3273305">byName</a></span><span class="op" id="3273471">)</span>&nbsp;<span class="op" id="3273473">==</span>&nbsp;<span class="num" id="3273476">0</span>&nbsp;<span class="op" id="3273478">||</span>&nbsp;<span class="ident" id="3273481"><a href="/gostd/net/hosts.go.html#3273416">now</a></span><span class="op" id="3273484">.</span><span class="ident" id="3273485"><a href="/gostd/time/time.go.html#2722668">After</a></span><span class="op" id="3273490">(</span><span class="ident" id="3273491"><a href="/gostd/net/hosts.go.html#3273277">hosts</a></span><span class="op" id="3273496">.</span><span class="ident" id="3273497"><a href="/gostd/net/hosts.go.html#3273361">expire</a></span><span class="op" id="3273503">)</span>&nbsp;<span class="op" id="3273505">||</span>&nbsp;<span class="ident" id="3273508"><a href="/gostd/net/hosts.go.html#3273277">hosts</a></span><span class="op" id="3273513">.</span><span class="ident" id="3273514"><a href="/gostd/net/hosts.go.html#3273379">path</a></span>&nbsp;<span class="op" id="3273519">!=</span>&nbsp;<span class="ident" id="3273522"><a href="/gostd/net/hosts.go.html#3273435">hp</a></span>&nbsp;<span class="op" id="3273525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3273529">hs</span>&nbsp;<span class="op" id="3273532">:=</span>&nbsp;<span class="builtinfunc" id="3273535">make</span><span class="op" id="3273539">(</span><span class="keyword" id="3273540">map</span><span class="op" id="3273543">[</span><span class="builtintype" id="3273544">string</span><span class="op" id="3273550">]</span><span class="op" id="3273551">[</span><span class="op" id="3273552">]</span><span class="builtintype" id="3273553">string</span><span class="op" id="3273559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3273563">is</span>&nbsp;<span class="op" id="3273566">:=</span>&nbsp;<span class="builtinfunc" id="3273569">make</span><span class="op" id="3273573">(</span><span class="keyword" id="3273574">map</span><span class="op" id="3273577">[</span><span class="builtintype" id="3273578">string</span><span class="op" id="3273584">]</span><span class="op" id="3273585">[</span><span class="op" id="3273586">]</span><span class="builtintype" id="3273587">string</span><span class="op" id="3273593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3273597">var</span>&nbsp;<span class="ident" id="3273601">file</span>&nbsp;<span class="op" id="3273606">*</span><span class="ident" id="3273607"><a href="/gostd/net/parse.go.html#3344988">file</a></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3273614">if</span>&nbsp;<span class="ident" id="3273617"><a href="/gostd/net/hosts.go.html#3273601">file</a></span><span class="op" id="3273621">,</span>&nbsp;<span class="ident" id="3273623">_</span>&nbsp;<span class="op" id="3273625">=</span>&nbsp;<span class="ident" id="3273627"><a href="/gostd/net/parse.go.html#3345879">open</a></span><span class="op" id="3273631">(</span><span class="ident" id="3273632"><a href="/gostd/net/hosts.go.html#3273435">hp</a></span><span class="op" id="3273634">)</span><span class="op" id="3273635">;</span>&nbsp;<span class="ident" id="3273637"><a href="/gostd/net/hosts.go.html#3273601">file</a></span>&nbsp;<span class="op" id="3273642">==</span>&nbsp;<span class="builtintype" id="3273645">nil</span>&nbsp;<span class="op" id="3273649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3273654">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3273663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3273667">for</span>&nbsp;<span class="ident" id="3273671">line</span><span class="op" id="3273675">,</span>&nbsp;<span class="ident" id="3273677">ok</span>&nbsp;<span class="op" id="3273680">:=</span>&nbsp;<span class="ident" id="3273683"><a href="/gostd/net/hosts.go.html#3273601">file</a></span><span class="op" id="3273687">.</span><span class="ident" id="3273688"><a href="/gostd/net/parse.go.html#3345520">readLine</a></span><span class="op" id="3273696">(</span><span class="op" id="3273697">)</span><span class="op" id="3273698">;</span>&nbsp;<span class="ident" id="3273700"><a href="/gostd/net/hosts.go.html#3273677">ok</a></span><span class="op" id="3273702">;</span>&nbsp;<span class="ident" id="3273704"><a href="/gostd/net/hosts.go.html#3273671">line</a></span><span class="op" id="3273708">,</span>&nbsp;<span class="ident" id="3273710"><a href="/gostd/net/hosts.go.html#3273677">ok</a></span>&nbsp;<span class="op" id="3273713">=</span>&nbsp;<span class="ident" id="3273715"><a href="/gostd/net/hosts.go.html#3273601">file</a></span><span class="op" id="3273719">.</span><span class="ident" id="3273720"><a href="/gostd/net/parse.go.html#3345520">readLine</a></span><span class="op" id="3273728">(</span><span class="op" id="3273729">)</span>&nbsp;<span class="op" id="3273731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3273736">if</span>&nbsp;<span class="ident" id="3273739">i</span>&nbsp;<span class="op" id="3273741">:=</span>&nbsp;<span class="ident" id="3273744"><a href="/gostd/net/parse.go.html#3346051">byteIndex</a></span><span class="op" id="3273753">(</span><span class="ident" id="3273754"><a href="/gostd/net/hosts.go.html#3273671">line</a></span><span class="op" id="3273758">,</span>&nbsp;<span class="string" id="3273760">&#39;#&#39;</span><span class="op" id="3273763">)</span><span class="op" id="3273764">;</span>&nbsp;<span class="ident" id="3273766"><a href="/gostd/net/hosts.go.html#3273739">i</a></span>&nbsp;<span class="op" id="3273768">&gt;=</span>&nbsp;<span class="num" id="3273771">0</span>&nbsp;<span class="op" id="3273773">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3273779">//&nbsp;Discard&nbsp;comments.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3273804"><a href="/gostd/net/hosts.go.html#3273671">line</a></span>&nbsp;<span class="op" id="3273809">=</span>&nbsp;<span class="ident" id="3273811"><a href="/gostd/net/hosts.go.html#3273671">line</a></span><span class="op" id="3273815">[</span><span class="num" id="3273816">0</span><span class="op" id="3273817">:</span><span class="ident" id="3273818"><a href="/gostd/net/hosts.go.html#3273739">i</a></span><span class="op" id="3273819">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3273824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3273829">f</span>&nbsp;<span class="op" id="3273831">:=</span>&nbsp;<span class="ident" id="3273834"><a href="/gostd/net/parse.go.html#3346715">getFields</a></span><span class="op" id="3273843">(</span><span class="ident" id="3273844"><a href="/gostd/net/hosts.go.html#3273671">line</a></span><span class="op" id="3273848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3273853">if</span>&nbsp;<span class="builtinfunc" id="3273856">len</span><span class="op" id="3273859">(</span><span class="ident" id="3273860"><a href="/gostd/net/hosts.go.html#3273829">f</a></span><span class="op" id="3273861">)</span>&nbsp;<span class="op" id="3273863">&lt;</span>&nbsp;<span class="num" id="3273865">2</span>&nbsp;<span class="op" id="3273867">||</span>&nbsp;<span class="ident" id="3273870"><a href="/gostd/net/ip.go.html#3299857">ParseIP</a></span><span class="op" id="3273877">(</span><span class="ident" id="3273878"><a href="/gostd/net/hosts.go.html#3273829">f</a></span><span class="op" id="3273879">[</span><span class="num" id="3273880">0</span><span class="op" id="3273881">]</span><span class="op" id="3273882">)</span>&nbsp;<span class="op" id="3273884">==</span>&nbsp;<span class="builtintype" id="3273887">nil</span>&nbsp;<span class="op" id="3273891">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3273897">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3273909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3273914">for</span>&nbsp;<span class="ident" id="3273918">i</span>&nbsp;<span class="op" id="3273920">:=</span>&nbsp;<span class="num" id="3273923">1</span><span class="op" id="3273924">;</span>&nbsp;<span class="ident" id="3273926"><a href="/gostd/net/hosts.go.html#3273918">i</a></span>&nbsp;<span class="op" id="3273928">&lt;</span>&nbsp;<span class="builtinfunc" id="3273930">len</span><span class="op" id="3273933">(</span><span class="ident" id="3273934"><a href="/gostd/net/hosts.go.html#3273829">f</a></span><span class="op" id="3273935">)</span><span class="op" id="3273936">;</span>&nbsp;<span class="ident" id="3273938"><a href="/gostd/net/hosts.go.html#3273918">i</a></span><span class="op" id="3273939">++</span>&nbsp;<span class="op" id="3273942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3273948">h</span>&nbsp;<span class="op" id="3273950">:=</span>&nbsp;<span class="ident" id="3273953"><a href="/gostd/net/hosts.go.html#3273829">f</a></span><span class="op" id="3273954">[</span><span class="ident" id="3273955"><a href="/gostd/net/hosts.go.html#3273918">i</a></span><span class="op" id="3273956">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3273962"><a href="/gostd/net/hosts.go.html#3273529">hs</a></span><span class="op" id="3273964">[</span><span class="ident" id="3273965"><a href="/gostd/net/hosts.go.html#3273948">h</a></span><span class="op" id="3273966">]</span>&nbsp;<span class="op" id="3273968">=</span>&nbsp;<span class="builtinfunc" id="3273970">append</span><span class="op" id="3273976">(</span><span class="ident" id="3273977"><a href="/gostd/net/hosts.go.html#3273529">hs</a></span><span class="op" id="3273979">[</span><span class="ident" id="3273980"><a href="/gostd/net/hosts.go.html#3273948">h</a></span><span class="op" id="3273981">]</span><span class="op" id="3273982">,</span>&nbsp;<span class="ident" id="3273984"><a href="/gostd/net/hosts.go.html#3273829">f</a></span><span class="op" id="3273985">[</span><span class="num" id="3273986">0</span><span class="op" id="3273987">]</span><span class="op" id="3273988">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3273994"><a href="/gostd/net/hosts.go.html#3273563">is</a></span><span class="op" id="3273996">[</span><span class="ident" id="3273997"><a href="/gostd/net/hosts.go.html#3273829">f</a></span><span class="op" id="3273998">[</span><span class="num" id="3273999">0</span><span class="op" id="3274000">]</span><span class="op" id="3274001">]</span>&nbsp;<span class="op" id="3274003">=</span>&nbsp;<span class="builtinfunc" id="3274005">append</span><span class="op" id="3274011">(</span><span class="ident" id="3274012"><a href="/gostd/net/hosts.go.html#3273563">is</a></span><span class="op" id="3274014">[</span><span class="ident" id="3274015"><a href="/gostd/net/hosts.go.html#3273829">f</a></span><span class="op" id="3274016">[</span><span class="num" id="3274017">0</span><span class="op" id="3274018">]</span><span class="op" id="3274019">]</span><span class="op" id="3274020">,</span>&nbsp;<span class="ident" id="3274022"><a href="/gostd/net/hosts.go.html#3273948">h</a></span><span class="op" id="3274023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3274028">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3274032">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3274036">//&nbsp;Update&nbsp;the&nbsp;data&nbsp;cache.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3274064"><a href="/gostd/net/hosts.go.html#3273277">hosts</a></span><span class="op" id="3274069">.</span><span class="ident" id="3274070"><a href="/gostd/net/hosts.go.html#3273361">expire</a></span>&nbsp;<span class="op" id="3274077">=</span>&nbsp;<span class="ident" id="3274079"><a href="/gostd/net/hosts.go.html#3273416">now</a></span><span class="op" id="3274082">.</span><span class="ident" id="3274083"><a href="/gostd/time/time.go.html#2738615">Add</a></span><span class="op" id="3274086">(</span><span class="ident" id="3274087"><a href="/gostd/net/hosts.go.html#3273131">cacheMaxAge</a></span><span class="op" id="3274098">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3274102"><a href="/gostd/net/hosts.go.html#3273277">hosts</a></span><span class="op" id="3274107">.</span><span class="ident" id="3274108"><a href="/gostd/net/hosts.go.html#3273379">path</a></span>&nbsp;<span class="op" id="3274113">=</span>&nbsp;<span class="ident" id="3274115"><a href="/gostd/net/hosts.go.html#3273435">hp</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3274120"><a href="/gostd/net/hosts.go.html#3273277">hosts</a></span><span class="op" id="3274125">.</span><span class="ident" id="3274126"><a href="/gostd/net/hosts.go.html#3273305">byName</a></span>&nbsp;<span class="op" id="3274133">=</span>&nbsp;<span class="ident" id="3274135"><a href="/gostd/net/hosts.go.html#3273529">hs</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3274140"><a href="/gostd/net/hosts.go.html#3273277">hosts</a></span><span class="op" id="3274145">.</span><span class="ident" id="3274146"><a href="/gostd/net/hosts.go.html#3273333">byAddr</a></span>&nbsp;<span class="op" id="3274153">=</span>&nbsp;<span class="ident" id="3274155"><a href="/gostd/net/hosts.go.html#3273563">is</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3274160"><a href="/gostd/net/hosts.go.html#3273601">file</a></span><span class="op" id="3274164">.</span><span class="builtinfunc" id="3274165"><a href="/gostd/net/parse.go.html#3345062">close</a></span><span class="op" id="3274170">(</span><span class="op" id="3274171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3274174">}</span><br>
<span class="lineno">60</span><span class="op" id="3274176">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3274179">//&nbsp;lookupStaticHost&nbsp;looks&nbsp;up&nbsp;the&nbsp;addresses&nbsp;for&nbsp;the&nbsp;given&nbsp;host&nbsp;from&nbsp;/etc/hosts.</span><br>
<span class="lineno"></span><span class="keyword" id="3274258">func</span>&nbsp;<span class="ident" id="3274263">lookupStaticHost</span><span class="op" id="3274279">(</span><span class="ident" id="3274280">host</span>&nbsp;<span class="builtintype" id="3274285">string</span><span class="op" id="3274291">)</span>&nbsp;<span class="op" id="3274293">[</span><span class="op" id="3274294">]</span><span class="builtintype" id="3274295">string</span>&nbsp;<span class="op" id="3274302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3274305"><a href="/gostd/net/hosts.go.html#3273277">hosts</a></span><span class="op" id="3274310">.</span><span class="ident" id="3274311"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="3274315">(</span><span class="op" id="3274316">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3274319">defer</span>&nbsp;<span class="ident" id="3274325"><a href="/gostd/net/hosts.go.html#3273277">hosts</a></span><span class="op" id="3274330">.</span><span class="ident" id="3274331"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="3274337">(</span><span class="op" id="3274338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3274341"><a href="/gostd/net/hosts.go.html#3273401">readHosts</a></span><span class="op" id="3274350">(</span><span class="op" id="3274351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3274354">if</span>&nbsp;<span class="builtinfunc" id="3274357">len</span><span class="op" id="3274360">(</span><span class="ident" id="3274361"><a href="/gostd/net/hosts.go.html#3273277">hosts</a></span><span class="op" id="3274366">.</span><span class="ident" id="3274367"><a href="/gostd/net/hosts.go.html#3273305">byName</a></span><span class="op" id="3274373">)</span>&nbsp;<span class="op" id="3274375">!=</span>&nbsp;<span class="num" id="3274378">0</span>&nbsp;<span class="op" id="3274380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3274384">if</span>&nbsp;<span class="ident" id="3274387">ips</span><span class="op" id="3274390">,</span>&nbsp;<span class="ident" id="3274392">ok</span>&nbsp;<span class="op" id="3274395">:=</span>&nbsp;<span class="ident" id="3274398"><a href="/gostd/net/hosts.go.html#3273277">hosts</a></span><span class="op" id="3274403">.</span><span class="ident" id="3274404"><a href="/gostd/net/hosts.go.html#3273305">byName</a></span><span class="op" id="3274410">[</span><span class="ident" id="3274411"><a href="/gostd/net/hosts.go.html#3274280">host</a></span><span class="op" id="3274415">]</span><span class="op" id="3274416">;</span>&nbsp;<span class="ident" id="3274418"><a href="/gostd/net/hosts.go.html#3274392">ok</a></span>&nbsp;<span class="op" id="3274421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3274426">return</span>&nbsp;<span class="ident" id="3274433"><a href="/gostd/net/hosts.go.html#3274387">ips</a></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3274439">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3274442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3274445">return</span>&nbsp;<span class="builtintype" id="3274452">nil</span><br>
<span class="lineno"></span><span class="op" id="3274456">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="comment" id="3274459">//&nbsp;lookupStaticAddr&nbsp;looks&nbsp;up&nbsp;the&nbsp;hosts&nbsp;for&nbsp;the&nbsp;given&nbsp;address&nbsp;from&nbsp;/etc/hosts.</span><br>
<span class="lineno"></span><span class="keyword" id="3274537">func</span>&nbsp;<span class="ident" id="3274542">lookupStaticAddr</span><span class="op" id="3274558">(</span><span class="ident" id="3274559">addr</span>&nbsp;<span class="builtintype" id="3274564">string</span><span class="op" id="3274570">)</span>&nbsp;<span class="op" id="3274572">[</span><span class="op" id="3274573">]</span><span class="builtintype" id="3274574">string</span>&nbsp;<span class="op" id="3274581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3274584"><a href="/gostd/net/hosts.go.html#3273277">hosts</a></span><span class="op" id="3274589">.</span><span class="ident" id="3274590"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="3274594">(</span><span class="op" id="3274595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3274598">defer</span>&nbsp;<span class="ident" id="3274604"><a href="/gostd/net/hosts.go.html#3273277">hosts</a></span><span class="op" id="3274609">.</span><span class="ident" id="3274610"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="3274616">(</span><span class="op" id="3274617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3274620"><a href="/gostd/net/hosts.go.html#3273401">readHosts</a></span><span class="op" id="3274629">(</span><span class="op" id="3274630">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3274633">if</span>&nbsp;<span class="builtinfunc" id="3274636">len</span><span class="op" id="3274639">(</span><span class="ident" id="3274640"><a href="/gostd/net/hosts.go.html#3273277">hosts</a></span><span class="op" id="3274645">.</span><span class="ident" id="3274646"><a href="/gostd/net/hosts.go.html#3273333">byAddr</a></span><span class="op" id="3274652">)</span>&nbsp;<span class="op" id="3274654">!=</span>&nbsp;<span class="num" id="3274657">0</span>&nbsp;<span class="op" id="3274659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3274663">if</span>&nbsp;<span class="ident" id="3274666">hosts</span><span class="op" id="3274671">,</span>&nbsp;<span class="ident" id="3274673">ok</span>&nbsp;<span class="op" id="3274676">:=</span>&nbsp;<span class="ident" id="3274679"><a href="/gostd/net/hosts.go.html#3273277">hosts</a></span><span class="op" id="3274684">.</span><span class="ident" id="3274685"><a href="/gostd/net/hosts.go.html#3273333">byAddr</a></span><span class="op" id="3274691">[</span><span class="ident" id="3274692"><a href="/gostd/net/hosts.go.html#3274559">addr</a></span><span class="op" id="3274696">]</span><span class="op" id="3274697">;</span>&nbsp;<span class="ident" id="3274699"><a href="/gostd/net/hosts.go.html#3274673">ok</a></span>&nbsp;<span class="op" id="3274702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3274707">return</span>&nbsp;<span class="ident" id="3274714"><a href="/gostd/net/hosts.go.html#3274666">hosts</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3274722">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3274725">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3274728">return</span>&nbsp;<span class="builtintype" id="3274735">nil</span><br>
<span class="lineno"></span><span class="op" id="3274739">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
