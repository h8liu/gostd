<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/subtle</h2>
<ul>
<li><a href="/gostd/crypto/subtle/constant_time.go.html">constant_time.go</a></li>
<li><a href="/gostd/crypto/subtle/constant_time_test.go.html" class="current">constant_time_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8316219">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8316274">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8316328">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8316379">package</span>&nbsp;<span class="ident" id="8316387">subtle</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8316395">import</span>&nbsp;<span class="op" id="8316402">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8316405">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8316416">&#34;testing/quick&#34;</span><br>
<span class="lineno">10</span><span class="op" id="8316432">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8316435">type</span>&nbsp;<span class="ident" id="8316440">TestConstantTimeCompareStruct</span>&nbsp;<span class="keyword" id="8316470">struct</span>&nbsp;<span class="op" id="8316477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8316480">a</span><span class="op" id="8316481">,</span>&nbsp;<span class="ident" id="8316483">b</span>&nbsp;<span class="op" id="8316485">[</span><span class="op" id="8316486">]</span><span class="builtintype" id="8316487">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8316493">out</span>&nbsp;&nbsp;<span class="builtintype" id="8316498">int</span><br>
<span class="lineno">15</span><span class="op" id="8316502">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8316505">var</span>&nbsp;<span class="ident" id="8316509">testConstantTimeCompareData</span>&nbsp;<span class="op" id="8316537">=</span>&nbsp;<span class="op" id="8316539">[</span><span class="op" id="8316540">]</span><span class="ident" id="8316541">TestConstantTimeCompareStruct</span><span class="op" id="8316570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8316573">{</span><span class="op" id="8316574">[</span><span class="op" id="8316575">]</span><span class="builtintype" id="8316576">byte</span><span class="op" id="8316580">{</span><span class="op" id="8316581">}</span><span class="op" id="8316582">,</span>&nbsp;<span class="op" id="8316584">[</span><span class="op" id="8316585">]</span><span class="builtintype" id="8316586">byte</span><span class="op" id="8316590">{</span><span class="op" id="8316591">}</span><span class="op" id="8316592">,</span>&nbsp;<span class="num" id="8316594">1</span><span class="op" id="8316595">}</span><span class="op" id="8316596">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8316599">{</span><span class="op" id="8316600">[</span><span class="op" id="8316601">]</span><span class="builtintype" id="8316602">byte</span><span class="op" id="8316606">{</span><span class="num" id="8316607">0x11</span><span class="op" id="8316611">}</span><span class="op" id="8316612">,</span>&nbsp;<span class="op" id="8316614">[</span><span class="op" id="8316615">]</span><span class="builtintype" id="8316616">byte</span><span class="op" id="8316620">{</span><span class="num" id="8316621">0x11</span><span class="op" id="8316625">}</span><span class="op" id="8316626">,</span>&nbsp;<span class="num" id="8316628">1</span><span class="op" id="8316629">}</span><span class="op" id="8316630">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8316633">{</span><span class="op" id="8316634">[</span><span class="op" id="8316635">]</span><span class="builtintype" id="8316636">byte</span><span class="op" id="8316640">{</span><span class="num" id="8316641">0x12</span><span class="op" id="8316645">}</span><span class="op" id="8316646">,</span>&nbsp;<span class="op" id="8316648">[</span><span class="op" id="8316649">]</span><span class="builtintype" id="8316650">byte</span><span class="op" id="8316654">{</span><span class="num" id="8316655">0x11</span><span class="op" id="8316659">}</span><span class="op" id="8316660">,</span>&nbsp;<span class="num" id="8316662">0</span><span class="op" id="8316663">}</span><span class="op" id="8316664">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8316667">{</span><span class="op" id="8316668">[</span><span class="op" id="8316669">]</span><span class="builtintype" id="8316670">byte</span><span class="op" id="8316674">{</span><span class="num" id="8316675">0x11</span><span class="op" id="8316679">}</span><span class="op" id="8316680">,</span>&nbsp;<span class="op" id="8316682">[</span><span class="op" id="8316683">]</span><span class="builtintype" id="8316684">byte</span><span class="op" id="8316688">{</span><span class="num" id="8316689">0x11</span><span class="op" id="8316693">,</span>&nbsp;<span class="num" id="8316695">0x12</span><span class="op" id="8316699">}</span><span class="op" id="8316700">,</span>&nbsp;<span class="num" id="8316702">0</span><span class="op" id="8316703">}</span><span class="op" id="8316704">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8316707">{</span><span class="op" id="8316708">[</span><span class="op" id="8316709">]</span><span class="builtintype" id="8316710">byte</span><span class="op" id="8316714">{</span><span class="num" id="8316715">0x11</span><span class="op" id="8316719">,</span>&nbsp;<span class="num" id="8316721">0x12</span><span class="op" id="8316725">}</span><span class="op" id="8316726">,</span>&nbsp;<span class="op" id="8316728">[</span><span class="op" id="8316729">]</span><span class="builtintype" id="8316730">byte</span><span class="op" id="8316734">{</span><span class="num" id="8316735">0x11</span><span class="op" id="8316739">}</span><span class="op" id="8316740">,</span>&nbsp;<span class="num" id="8316742">0</span><span class="op" id="8316743">}</span><span class="op" id="8316744">,</span><br>
<span class="lineno"></span><span class="op" id="8316746">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="8316749">func</span>&nbsp;<span class="ident" id="8316754">TestConstantTimeCompare</span><span class="op" id="8316777">(</span><span class="ident" id="8316778">t</span>&nbsp;<span class="op" id="8316780">*</span><span class="ident" id="8316781">testing</span><span class="op" id="8316788">.</span><span class="ident" id="8316789">T</span><span class="op" id="8316790">)</span>&nbsp;<span class="op" id="8316792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8316795">for</span>&nbsp;<span class="ident" id="8316799">i</span><span class="op" id="8316800">,</span>&nbsp;<span class="ident" id="8316802">test</span>&nbsp;<span class="op" id="8316807">:=</span>&nbsp;<span class="keyword" id="8316810">range</span>&nbsp;<span class="ident" id="8316816">testConstantTimeCompareData</span>&nbsp;<span class="op" id="8316844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8316848">if</span>&nbsp;<span class="ident" id="8316851">r</span>&nbsp;<span class="op" id="8316853">:=</span>&nbsp;<span class="ident" id="8316856">ConstantTimeCompare</span><span class="op" id="8316875">(</span><span class="ident" id="8316876">test</span><span class="op" id="8316880">.</span><span class="ident" id="8316881">a</span><span class="op" id="8316882">,</span>&nbsp;<span class="ident" id="8316884">test</span><span class="op" id="8316888">.</span><span class="ident" id="8316889">b</span><span class="op" id="8316890">)</span><span class="op" id="8316891">;</span>&nbsp;<span class="ident" id="8316893">r</span>&nbsp;<span class="op" id="8316895">!=</span>&nbsp;<span class="ident" id="8316898">test</span><span class="op" id="8316902">.</span><span class="ident" id="8316903">out</span>&nbsp;<span class="op" id="8316907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8316912">t</span><span class="op" id="8316913">.</span><span class="ident" id="8316914">Errorf</span><span class="op" id="8316920">(</span><span class="string" id="8316921">&#34;#%d&nbsp;bad&nbsp;result&nbsp;(got&nbsp;%x,&nbsp;want&nbsp;%x)&#34;</span><span class="op" id="8316955">,</span>&nbsp;<span class="ident" id="8316957">i</span><span class="op" id="8316958">,</span>&nbsp;<span class="ident" id="8316960">r</span><span class="op" id="8316961">,</span>&nbsp;<span class="ident" id="8316963">test</span><span class="op" id="8316967">.</span><span class="ident" id="8316968">out</span><span class="op" id="8316971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8316975">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8316978">}</span><br>
<span class="lineno"></span><span class="op" id="8316980">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8316983">type</span>&nbsp;<span class="ident" id="8316988">TestConstantTimeByteEqStruct</span>&nbsp;<span class="keyword" id="8317017">struct</span>&nbsp;<span class="op" id="8317024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8317027">a</span><span class="op" id="8317028">,</span>&nbsp;<span class="ident" id="8317030">b</span>&nbsp;<span class="builtintype" id="8317032">uint8</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8317039">out</span>&nbsp;&nbsp;<span class="builtintype" id="8317044">int</span><br>
<span class="lineno"></span><span class="op" id="8317048">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8317051">var</span>&nbsp;<span class="ident" id="8317055">testConstandTimeByteEqData</span>&nbsp;<span class="op" id="8317082">=</span>&nbsp;<span class="op" id="8317084">[</span><span class="op" id="8317085">]</span><span class="ident" id="8317086">TestConstantTimeByteEqStruct</span><span class="op" id="8317114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8317117">{</span><span class="num" id="8317118">0</span><span class="op" id="8317119">,</span>&nbsp;<span class="num" id="8317121">0</span><span class="op" id="8317122">,</span>&nbsp;<span class="num" id="8317124">1</span><span class="op" id="8317125">}</span><span class="op" id="8317126">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8317129">{</span><span class="num" id="8317130">0</span><span class="op" id="8317131">,</span>&nbsp;<span class="num" id="8317133">1</span><span class="op" id="8317134">,</span>&nbsp;<span class="num" id="8317136">0</span><span class="op" id="8317137">}</span><span class="op" id="8317138">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8317141">{</span><span class="num" id="8317142">1</span><span class="op" id="8317143">,</span>&nbsp;<span class="num" id="8317145">0</span><span class="op" id="8317146">,</span>&nbsp;<span class="num" id="8317148">0</span><span class="op" id="8317149">}</span><span class="op" id="8317150">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8317153">{</span><span class="num" id="8317154">0xff</span><span class="op" id="8317158">,</span>&nbsp;<span class="num" id="8317160">0xff</span><span class="op" id="8317164">,</span>&nbsp;<span class="num" id="8317166">1</span><span class="op" id="8317167">}</span><span class="op" id="8317168">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8317171">{</span><span class="num" id="8317172">0xff</span><span class="op" id="8317176">,</span>&nbsp;<span class="num" id="8317178">0xfe</span><span class="op" id="8317182">,</span>&nbsp;<span class="num" id="8317184">0</span><span class="op" id="8317185">}</span><span class="op" id="8317186">,</span><br>
<span class="lineno"></span><span class="op" id="8317188">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="8317191">func</span>&nbsp;<span class="ident" id="8317196">byteEq</span><span class="op" id="8317202">(</span><span class="ident" id="8317203">a</span><span class="op" id="8317204">,</span>&nbsp;<span class="ident" id="8317206">b</span>&nbsp;<span class="builtintype" id="8317208">uint8</span><span class="op" id="8317213">)</span>&nbsp;<span class="builtintype" id="8317215">int</span>&nbsp;<span class="op" id="8317219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8317222">if</span>&nbsp;<span class="ident" id="8317225">a</span>&nbsp;<span class="op" id="8317227">==</span>&nbsp;<span class="ident" id="8317230">b</span>&nbsp;<span class="op" id="8317232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8317236">return</span>&nbsp;<span class="num" id="8317243">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8317246">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8317249">return</span>&nbsp;<span class="num" id="8317256">0</span><br>
<span class="lineno"></span><span class="op" id="8317258">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8317261">func</span>&nbsp;<span class="ident" id="8317266">TestConstantTimeByteEq</span><span class="op" id="8317288">(</span><span class="ident" id="8317289">t</span>&nbsp;<span class="op" id="8317291">*</span><span class="ident" id="8317292">testing</span><span class="op" id="8317299">.</span><span class="ident" id="8317300">T</span><span class="op" id="8317301">)</span>&nbsp;<span class="op" id="8317303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8317306">for</span>&nbsp;<span class="ident" id="8317310">i</span><span class="op" id="8317311">,</span>&nbsp;<span class="ident" id="8317313">test</span>&nbsp;<span class="op" id="8317318">:=</span>&nbsp;<span class="keyword" id="8317321">range</span>&nbsp;<span class="ident" id="8317327">testConstandTimeByteEqData</span>&nbsp;<span class="op" id="8317354">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8317358">if</span>&nbsp;<span class="ident" id="8317361">r</span>&nbsp;<span class="op" id="8317363">:=</span>&nbsp;<span class="ident" id="8317366">ConstantTimeByteEq</span><span class="op" id="8317384">(</span><span class="ident" id="8317385">test</span><span class="op" id="8317389">.</span><span class="ident" id="8317390">a</span><span class="op" id="8317391">,</span>&nbsp;<span class="ident" id="8317393">test</span><span class="op" id="8317397">.</span><span class="ident" id="8317398">b</span><span class="op" id="8317399">)</span><span class="op" id="8317400">;</span>&nbsp;<span class="ident" id="8317402">r</span>&nbsp;<span class="op" id="8317404">!=</span>&nbsp;<span class="ident" id="8317407">test</span><span class="op" id="8317411">.</span><span class="ident" id="8317412">out</span>&nbsp;<span class="op" id="8317416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8317421">t</span><span class="op" id="8317422">.</span><span class="ident" id="8317423">Errorf</span><span class="op" id="8317429">(</span><span class="string" id="8317430">&#34;#%d&nbsp;bad&nbsp;result&nbsp;(got&nbsp;%x,&nbsp;want&nbsp;%x)&#34;</span><span class="op" id="8317464">,</span>&nbsp;<span class="ident" id="8317466">i</span><span class="op" id="8317467">,</span>&nbsp;<span class="ident" id="8317469">r</span><span class="op" id="8317470">,</span>&nbsp;<span class="ident" id="8317472">test</span><span class="op" id="8317476">.</span><span class="ident" id="8317477">out</span><span class="op" id="8317480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8317484">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8317487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8317490">err</span>&nbsp;<span class="op" id="8317494">:=</span>&nbsp;<span class="ident" id="8317497">quick</span><span class="op" id="8317502">.</span><span class="ident" id="8317503">CheckEqual</span><span class="op" id="8317513">(</span><span class="ident" id="8317514">ConstantTimeByteEq</span><span class="op" id="8317532">,</span>&nbsp;<span class="ident" id="8317534">byteEq</span><span class="op" id="8317540">,</span>&nbsp;<span class="ident" id="8317542">nil</span><span class="op" id="8317545">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8317548">if</span>&nbsp;<span class="ident" id="8317551">err</span>&nbsp;<span class="op" id="8317555">!=</span>&nbsp;<span class="ident" id="8317558">nil</span>&nbsp;<span class="op" id="8317562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8317566">t</span><span class="op" id="8317567">.</span><span class="ident" id="8317568">Error</span><span class="op" id="8317573">(</span><span class="ident" id="8317574">err</span><span class="op" id="8317577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8317580">}</span><br>
<span class="lineno"></span><span class="op" id="8317582">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="keyword" id="8317585">func</span>&nbsp;<span class="ident" id="8317590">eq</span><span class="op" id="8317592">(</span><span class="ident" id="8317593">a</span><span class="op" id="8317594">,</span>&nbsp;<span class="ident" id="8317596">b</span>&nbsp;<span class="builtintype" id="8317598">int32</span><span class="op" id="8317603">)</span>&nbsp;<span class="builtintype" id="8317605">int</span>&nbsp;<span class="op" id="8317609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8317612">if</span>&nbsp;<span class="ident" id="8317615">a</span>&nbsp;<span class="op" id="8317617">==</span>&nbsp;<span class="ident" id="8317620">b</span>&nbsp;<span class="op" id="8317622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8317626">return</span>&nbsp;<span class="num" id="8317633">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8317636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8317639">return</span>&nbsp;<span class="num" id="8317646">0</span><br>
<span class="lineno">70</span><span class="op" id="8317648">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8317651">func</span>&nbsp;<span class="ident" id="8317656">TestConstantTimeEq</span><span class="op" id="8317674">(</span><span class="ident" id="8317675">t</span>&nbsp;<span class="op" id="8317677">*</span><span class="ident" id="8317678">testing</span><span class="op" id="8317685">.</span><span class="ident" id="8317686">T</span><span class="op" id="8317687">)</span>&nbsp;<span class="op" id="8317689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8317692">err</span>&nbsp;<span class="op" id="8317696">:=</span>&nbsp;<span class="ident" id="8317699">quick</span><span class="op" id="8317704">.</span><span class="ident" id="8317705">CheckEqual</span><span class="op" id="8317715">(</span><span class="ident" id="8317716">ConstantTimeEq</span><span class="op" id="8317730">,</span>&nbsp;<span class="ident" id="8317732">eq</span><span class="op" id="8317734">,</span>&nbsp;<span class="ident" id="8317736">nil</span><span class="op" id="8317739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8317742">if</span>&nbsp;<span class="ident" id="8317745">err</span>&nbsp;<span class="op" id="8317749">!=</span>&nbsp;<span class="ident" id="8317752">nil</span>&nbsp;<span class="op" id="8317756">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8317760">t</span><span class="op" id="8317761">.</span><span class="ident" id="8317762">Error</span><span class="op" id="8317767">(</span><span class="ident" id="8317768">err</span><span class="op" id="8317771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8317774">}</span><br>
<span class="lineno"></span><span class="op" id="8317776">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8317779">func</span>&nbsp;<span class="ident" id="8317784">makeCopy</span><span class="op" id="8317792">(</span><span class="ident" id="8317793">v</span>&nbsp;<span class="builtintype" id="8317795">int</span><span class="op" id="8317798">,</span>&nbsp;<span class="ident" id="8317800">x</span><span class="op" id="8317801">,</span>&nbsp;<span class="ident" id="8317803">y</span>&nbsp;<span class="op" id="8317805">[</span><span class="op" id="8317806">]</span><span class="builtintype" id="8317807">byte</span><span class="op" id="8317811">)</span>&nbsp;<span class="op" id="8317813">[</span><span class="op" id="8317814">]</span><span class="builtintype" id="8317815">byte</span>&nbsp;<span class="op" id="8317820">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8317823">if</span>&nbsp;<span class="builtinfunc" id="8317826">len</span><span class="op" id="8317829">(</span><span class="ident" id="8317830">x</span><span class="op" id="8317831">)</span>&nbsp;<span class="op" id="8317833">&gt;</span>&nbsp;<span class="builtinfunc" id="8317835">len</span><span class="op" id="8317838">(</span><span class="ident" id="8317839">y</span><span class="op" id="8317840">)</span>&nbsp;<span class="op" id="8317842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8317846">x</span>&nbsp;<span class="op" id="8317848">=</span>&nbsp;<span class="ident" id="8317850">x</span><span class="op" id="8317851">[</span><span class="num" id="8317852">0</span><span class="op" id="8317853">:</span><span class="builtinfunc" id="8317854">len</span><span class="op" id="8317857">(</span><span class="ident" id="8317858">y</span><span class="op" id="8317859">)</span><span class="op" id="8317860">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8317863">}</span>&nbsp;<span class="keyword" id="8317865">else</span>&nbsp;<span class="op" id="8317870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8317874">y</span>&nbsp;<span class="op" id="8317876">=</span>&nbsp;<span class="ident" id="8317878">y</span><span class="op" id="8317879">[</span><span class="num" id="8317880">0</span><span class="op" id="8317881">:</span><span class="builtinfunc" id="8317882">len</span><span class="op" id="8317885">(</span><span class="ident" id="8317886">x</span><span class="op" id="8317887">)</span><span class="op" id="8317888">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8317891">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8317894">if</span>&nbsp;<span class="ident" id="8317897">v</span>&nbsp;<span class="op" id="8317899">==</span>&nbsp;<span class="num" id="8317902">1</span>&nbsp;<span class="op" id="8317904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8317908">copy</span><span class="op" id="8317912">(</span><span class="ident" id="8317913">x</span><span class="op" id="8317914">,</span>&nbsp;<span class="ident" id="8317916">y</span><span class="op" id="8317917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8317920">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8317923">return</span>&nbsp;<span class="ident" id="8317930">x</span><br>
<span class="lineno"></span><span class="op" id="8317932">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="8317935">func</span>&nbsp;<span class="ident" id="8317940">constantTimeCopyWrapper</span><span class="op" id="8317963">(</span><span class="ident" id="8317964">v</span>&nbsp;<span class="builtintype" id="8317966">int</span><span class="op" id="8317969">,</span>&nbsp;<span class="ident" id="8317971">x</span><span class="op" id="8317972">,</span>&nbsp;<span class="ident" id="8317974">y</span>&nbsp;<span class="op" id="8317976">[</span><span class="op" id="8317977">]</span><span class="builtintype" id="8317978">byte</span><span class="op" id="8317982">)</span>&nbsp;<span class="op" id="8317984">[</span><span class="op" id="8317985">]</span><span class="builtintype" id="8317986">byte</span>&nbsp;<span class="op" id="8317991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8317994">if</span>&nbsp;<span class="builtinfunc" id="8317997">len</span><span class="op" id="8318000">(</span><span class="ident" id="8318001">x</span><span class="op" id="8318002">)</span>&nbsp;<span class="op" id="8318004">&gt;</span>&nbsp;<span class="builtinfunc" id="8318006">len</span><span class="op" id="8318009">(</span><span class="ident" id="8318010">y</span><span class="op" id="8318011">)</span>&nbsp;<span class="op" id="8318013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8318017">x</span>&nbsp;<span class="op" id="8318019">=</span>&nbsp;<span class="ident" id="8318021">x</span><span class="op" id="8318022">[</span><span class="num" id="8318023">0</span><span class="op" id="8318024">:</span><span class="builtinfunc" id="8318025">len</span><span class="op" id="8318028">(</span><span class="ident" id="8318029">y</span><span class="op" id="8318030">)</span><span class="op" id="8318031">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8318034">}</span>&nbsp;<span class="keyword" id="8318036">else</span>&nbsp;<span class="op" id="8318041">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8318045">y</span>&nbsp;<span class="op" id="8318047">=</span>&nbsp;<span class="ident" id="8318049">y</span><span class="op" id="8318050">[</span><span class="num" id="8318051">0</span><span class="op" id="8318052">:</span><span class="builtinfunc" id="8318053">len</span><span class="op" id="8318056">(</span><span class="ident" id="8318057">x</span><span class="op" id="8318058">)</span><span class="op" id="8318059">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8318062">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8318065">v</span>&nbsp;<span class="op" id="8318067">&amp;=</span>&nbsp;<span class="num" id="8318070">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8318073">ConstantTimeCopy</span><span class="op" id="8318089">(</span><span class="ident" id="8318090">v</span><span class="op" id="8318091">,</span>&nbsp;<span class="ident" id="8318093">x</span><span class="op" id="8318094">,</span>&nbsp;<span class="ident" id="8318096">y</span><span class="op" id="8318097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8318100">return</span>&nbsp;<span class="ident" id="8318107">x</span><br>
<span class="lineno">100</span><span class="op" id="8318109">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8318112">func</span>&nbsp;<span class="ident" id="8318117">TestConstantTimeCopy</span><span class="op" id="8318137">(</span><span class="ident" id="8318138">t</span>&nbsp;<span class="op" id="8318140">*</span><span class="ident" id="8318141">testing</span><span class="op" id="8318148">.</span><span class="ident" id="8318149">T</span><span class="op" id="8318150">)</span>&nbsp;<span class="op" id="8318152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8318155">err</span>&nbsp;<span class="op" id="8318159">:=</span>&nbsp;<span class="ident" id="8318162">quick</span><span class="op" id="8318167">.</span><span class="ident" id="8318168">CheckEqual</span><span class="op" id="8318178">(</span><span class="ident" id="8318179">constantTimeCopyWrapper</span><span class="op" id="8318202">,</span>&nbsp;<span class="ident" id="8318204">makeCopy</span><span class="op" id="8318212">,</span>&nbsp;<span class="ident" id="8318214">nil</span><span class="op" id="8318217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8318220">if</span>&nbsp;<span class="ident" id="8318223">err</span>&nbsp;<span class="op" id="8318227">!=</span>&nbsp;<span class="ident" id="8318230">nil</span>&nbsp;<span class="op" id="8318234">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8318238">t</span><span class="op" id="8318239">.</span><span class="ident" id="8318240">Error</span><span class="op" id="8318245">(</span><span class="ident" id="8318246">err</span><span class="op" id="8318249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8318252">}</span><br>
<span class="lineno"></span><span class="op" id="8318254">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8318257">var</span>&nbsp;<span class="ident" id="8318261">lessOrEqTests</span>&nbsp;<span class="op" id="8318275">=</span>&nbsp;<span class="op" id="8318277">[</span><span class="op" id="8318278">]</span><span class="keyword" id="8318279">struct</span>&nbsp;<span class="op" id="8318286">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8318289">x</span><span class="op" id="8318290">,</span>&nbsp;<span class="ident" id="8318292">y</span><span class="op" id="8318293">,</span>&nbsp;<span class="ident" id="8318295">result</span>&nbsp;<span class="builtintype" id="8318302">int</span><br>
<span class="lineno"></span><span class="op" id="8318306">}</span><span class="op" id="8318307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8318310">{</span><span class="num" id="8318311">0</span><span class="op" id="8318312">,</span>&nbsp;<span class="num" id="8318314">0</span><span class="op" id="8318315">,</span>&nbsp;<span class="num" id="8318317">1</span><span class="op" id="8318318">}</span><span class="op" id="8318319">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8318322">{</span><span class="num" id="8318323">1</span><span class="op" id="8318324">,</span>&nbsp;<span class="num" id="8318326">0</span><span class="op" id="8318327">,</span>&nbsp;<span class="num" id="8318329">0</span><span class="op" id="8318330">}</span><span class="op" id="8318331">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8318334">{</span><span class="num" id="8318335">0</span><span class="op" id="8318336">,</span>&nbsp;<span class="num" id="8318338">1</span><span class="op" id="8318339">,</span>&nbsp;<span class="num" id="8318341">1</span><span class="op" id="8318342">}</span><span class="op" id="8318343">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8318346">{</span><span class="num" id="8318347">10</span><span class="op" id="8318349">,</span>&nbsp;<span class="num" id="8318351">20</span><span class="op" id="8318353">,</span>&nbsp;<span class="num" id="8318355">1</span><span class="op" id="8318356">}</span><span class="op" id="8318357">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8318360">{</span><span class="num" id="8318361">20</span><span class="op" id="8318363">,</span>&nbsp;<span class="num" id="8318365">10</span><span class="op" id="8318367">,</span>&nbsp;<span class="num" id="8318369">0</span><span class="op" id="8318370">}</span><span class="op" id="8318371">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8318374">{</span><span class="num" id="8318375">10</span><span class="op" id="8318377">,</span>&nbsp;<span class="num" id="8318379">10</span><span class="op" id="8318381">,</span>&nbsp;<span class="num" id="8318383">1</span><span class="op" id="8318384">}</span><span class="op" id="8318385">,</span><br>
<span class="lineno"></span><span class="op" id="8318387">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="8318390">func</span>&nbsp;<span class="ident" id="8318395">TestConstantTimeLessOrEq</span><span class="op" id="8318419">(</span><span class="ident" id="8318420">t</span>&nbsp;<span class="op" id="8318422">*</span><span class="ident" id="8318423">testing</span><span class="op" id="8318430">.</span><span class="ident" id="8318431">T</span><span class="op" id="8318432">)</span>&nbsp;<span class="op" id="8318434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8318437">for</span>&nbsp;<span class="ident" id="8318441">i</span><span class="op" id="8318442">,</span>&nbsp;<span class="ident" id="8318444">test</span>&nbsp;<span class="op" id="8318449">:=</span>&nbsp;<span class="keyword" id="8318452">range</span>&nbsp;<span class="ident" id="8318458">lessOrEqTests</span>&nbsp;<span class="op" id="8318472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8318476">result</span>&nbsp;<span class="op" id="8318483">:=</span>&nbsp;<span class="ident" id="8318486">ConstantTimeLessOrEq</span><span class="op" id="8318506">(</span><span class="ident" id="8318507">test</span><span class="op" id="8318511">.</span><span class="ident" id="8318512">x</span><span class="op" id="8318513">,</span>&nbsp;<span class="ident" id="8318515">test</span><span class="op" id="8318519">.</span><span class="ident" id="8318520">y</span><span class="op" id="8318521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8318525">if</span>&nbsp;<span class="ident" id="8318528">result</span>&nbsp;<span class="op" id="8318535">!=</span>&nbsp;<span class="ident" id="8318538">test</span><span class="op" id="8318542">.</span><span class="ident" id="8318543">result</span>&nbsp;<span class="op" id="8318550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8318555">t</span><span class="op" id="8318556">.</span><span class="ident" id="8318557">Errorf</span><span class="op" id="8318563">(</span><span class="string" id="8318564">&#34;#%d:&nbsp;%d&nbsp;&lt;=&nbsp;%d&nbsp;gave&nbsp;%d,&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="8318600">,</span>&nbsp;<span class="ident" id="8318602">i</span><span class="op" id="8318603">,</span>&nbsp;<span class="ident" id="8318605">test</span><span class="op" id="8318609">.</span><span class="ident" id="8318610">x</span><span class="op" id="8318611">,</span>&nbsp;<span class="ident" id="8318613">test</span><span class="op" id="8318617">.</span><span class="ident" id="8318618">y</span><span class="op" id="8318619">,</span>&nbsp;<span class="ident" id="8318621">result</span><span class="op" id="8318627">,</span>&nbsp;<span class="ident" id="8318629">test</span><span class="op" id="8318633">.</span><span class="ident" id="8318634">result</span><span class="op" id="8318640">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8318644">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8318647">}</span><br>
<span class="lineno"></span><span class="op" id="8318649">}</span>
</div>
</body>
</html>
