<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/json</h2>
<ul>
<li><a href="/gostd/encoding/json/bench_test.go.html">bench_test.go</a></li>
<li><a href="/gostd/encoding/json/decode.go.html">decode.go</a></li>
<li><a href="/gostd/encoding/json/decode_test.go.html">decode_test.go</a></li>
<li><a href="/gostd/encoding/json/encode.go.html">encode.go</a></li>
<li><a href="/gostd/encoding/json/encode_test.go.html" class="current">encode_test.go</a></li>
<li><a href="/gostd/encoding/json/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/json/fold.go.html">fold.go</a></li>
<li><a href="/gostd/encoding/json/fold_test.go.html">fold_test.go</a></li>
<li><a href="/gostd/encoding/json/indent.go.html">indent.go</a></li>
<li><a href="/gostd/encoding/json/scanner.go.html">scanner.go</a></li>
<li><a href="/gostd/encoding/json/scanner_test.go.html">scanner_test.go</a></li>
<li><a href="/gostd/encoding/json/stream.go.html">stream.go</a></li>
<li><a href="/gostd/encoding/json/stream_test.go.html">stream_test.go</a></li>
<li><a href="/gostd/encoding/json/tagkey_test.go.html">tagkey_test.go</a></li>
<li><a href="/gostd/encoding/json/tags.go.html">tags.go</a></li>
<li><a href="/gostd/encoding/json/tags_test.go.html">tags_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6926027">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6926082">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6926136">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6926187">package</span>&nbsp;<span class="ident" id="6926195">json</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6926201">import</span>&nbsp;<span class="op" id="6926208">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6926211">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6926220">&#34;math&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6926228">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6926239">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6926250">&#34;unicode&#34;</span><br>
<span class="lineno"></span><span class="op" id="6926260">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="6926263">type</span>&nbsp;<span class="ident" id="6926268">Optionals</span>&nbsp;<span class="keyword" id="6926278">struct</span>&nbsp;<span class="op" id="6926285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6926288">Sr</span>&nbsp;<span class="builtintype" id="6926291">string</span>&nbsp;<span class="string" id="6926298">`json:&#34;sr&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6926311">So</span>&nbsp;<span class="builtintype" id="6926314">string</span>&nbsp;<span class="string" id="6926321">`json:&#34;so,omitempty&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6926344">Sw</span>&nbsp;<span class="builtintype" id="6926347">string</span>&nbsp;<span class="string" id="6926354">`json:&#34;-&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6926367">Ir</span>&nbsp;<span class="builtintype" id="6926370">int</span>&nbsp;<span class="string" id="6926374">`json:&#34;omitempty&#34;`</span>&nbsp;<span class="comment" id="6926393">//&nbsp;actually&nbsp;named&nbsp;omitempty,&nbsp;not&nbsp;an&nbsp;option</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6926437">Io</span>&nbsp;<span class="builtintype" id="6926440">int</span>&nbsp;<span class="string" id="6926444">`json:&#34;io,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6926468">Slr</span>&nbsp;<span class="op" id="6926472">[</span><span class="op" id="6926473">]</span><span class="builtintype" id="6926474">string</span>&nbsp;<span class="string" id="6926481">`json:&#34;slr,random&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6926502">Slo</span>&nbsp;<span class="op" id="6926506">[</span><span class="op" id="6926507">]</span><span class="builtintype" id="6926508">string</span>&nbsp;<span class="string" id="6926515">`json:&#34;slo,omitempty&#34;`</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6926540">Mr</span>&nbsp;<span class="keyword" id="6926543">map</span><span class="op" id="6926546">[</span><span class="builtintype" id="6926547">string</span><span class="op" id="6926553">]</span><span class="keyword" id="6926554">interface</span><span class="op" id="6926563">{</span><span class="op" id="6926564">}</span>&nbsp;<span class="string" id="6926566">`json:&#34;mr&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6926579">Mo</span>&nbsp;<span class="keyword" id="6926582">map</span><span class="op" id="6926585">[</span><span class="builtintype" id="6926586">string</span><span class="op" id="6926592">]</span><span class="keyword" id="6926593">interface</span><span class="op" id="6926602">{</span><span class="op" id="6926603">}</span>&nbsp;<span class="string" id="6926605">`json:&#34;,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6926627">Fr</span>&nbsp;<span class="builtintype" id="6926630">float64</span>&nbsp;<span class="string" id="6926638">`json:&#34;fr&#34;`</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6926651">Fo</span>&nbsp;<span class="builtintype" id="6926654">float64</span>&nbsp;<span class="string" id="6926662">`json:&#34;fo,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6926686">Br</span>&nbsp;<span class="builtintype" id="6926689">bool</span>&nbsp;<span class="string" id="6926694">`json:&#34;br&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6926707">Bo</span>&nbsp;<span class="builtintype" id="6926710">bool</span>&nbsp;<span class="string" id="6926715">`json:&#34;bo,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6926739">Ur</span>&nbsp;<span class="builtintype" id="6926742">uint</span>&nbsp;<span class="string" id="6926747">`json:&#34;ur&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6926760">Uo</span>&nbsp;<span class="builtintype" id="6926763">uint</span>&nbsp;<span class="string" id="6926768">`json:&#34;uo,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6926792">Str</span>&nbsp;<span class="keyword" id="6926796">struct</span><span class="op" id="6926802">{</span><span class="op" id="6926803">}</span>&nbsp;<span class="string" id="6926805">`json:&#34;str&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6926819">Sto</span>&nbsp;<span class="keyword" id="6926823">struct</span><span class="op" id="6926829">{</span><span class="op" id="6926830">}</span>&nbsp;<span class="string" id="6926832">`json:&#34;sto,omitempty&#34;`</span><br>
<span class="lineno">40</span><span class="op" id="6926855">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6926858">var</span>&nbsp;<span class="ident" id="6926862">optionalsExpected</span>&nbsp;<span class="op" id="6926880">=</span>&nbsp;<span class="string" id="6926882">`{<br>
<span class="lineno"></span>&nbsp;&#34;sr&#34;:&nbsp;&#34;&#34;,<br>
<span class="lineno"></span>&nbsp;&#34;omitempty&#34;:&nbsp;0,<br>
<span class="lineno">45</span>&nbsp;&#34;slr&#34;:&nbsp;null,<br>
<span class="lineno"></span>&nbsp;&#34;mr&#34;:&nbsp;{},<br>
<span class="lineno"></span>&nbsp;&#34;fr&#34;:&nbsp;0,<br>
<span class="lineno"></span>&nbsp;&#34;br&#34;:&nbsp;false,<br>
<span class="lineno"></span>&nbsp;&#34;ur&#34;:&nbsp;0,<br>
<span class="lineno">50</span>&nbsp;&#34;str&#34;:&nbsp;{},<br>
<span class="lineno"></span>&nbsp;&#34;sto&#34;:&nbsp;{}<br>
<span class="lineno"></span>}`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6926999">func</span>&nbsp;<span class="ident" id="6927004">TestOmitEmpty</span><span class="op" id="6927017">(</span><span class="ident" id="6927018">t</span>&nbsp;<span class="op" id="6927020">*</span><span class="ident" id="6927021">testing</span><span class="op" id="6927028">.</span><span class="ident" id="6927029">T</span><span class="op" id="6927030">)</span>&nbsp;<span class="op" id="6927032">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6927035">var</span>&nbsp;<span class="ident" id="6927039">o</span>&nbsp;<span class="ident" id="6927041">Optionals</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6927052">o</span><span class="op" id="6927053">.</span><span class="ident" id="6927054">Sw</span>&nbsp;<span class="op" id="6927057">=</span>&nbsp;<span class="string" id="6927059">&#34;something&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6927072">o</span><span class="op" id="6927073">.</span><span class="ident" id="6927074">Mr</span>&nbsp;<span class="op" id="6927077">=</span>&nbsp;<span class="keyword" id="6927079">map</span><span class="op" id="6927082">[</span><span class="builtintype" id="6927083">string</span><span class="op" id="6927089">]</span><span class="keyword" id="6927090">interface</span><span class="op" id="6927099">{</span><span class="op" id="6927100">}</span><span class="op" id="6927101">{</span><span class="op" id="6927102">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6927105">o</span><span class="op" id="6927106">.</span><span class="ident" id="6927107">Mo</span>&nbsp;<span class="op" id="6927110">=</span>&nbsp;<span class="keyword" id="6927112">map</span><span class="op" id="6927115">[</span><span class="builtintype" id="6927116">string</span><span class="op" id="6927122">]</span><span class="keyword" id="6927123">interface</span><span class="op" id="6927132">{</span><span class="op" id="6927133">}</span><span class="op" id="6927134">{</span><span class="op" id="6927135">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6927139">got</span><span class="op" id="6927142">,</span>&nbsp;<span class="ident" id="6927144">err</span>&nbsp;<span class="op" id="6927148">:=</span>&nbsp;<span class="ident" id="6927151">MarshalIndent</span><span class="op" id="6927164">(</span><span class="op" id="6927165">&amp;</span><span class="ident" id="6927166">o</span><span class="op" id="6927167">,</span>&nbsp;<span class="string" id="6927169">&#34;&#34;</span><span class="op" id="6927171">,</span>&nbsp;<span class="string" id="6927173">&#34;&nbsp;&#34;</span><span class="op" id="6927176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6927179">if</span>&nbsp;<span class="ident" id="6927182">err</span>&nbsp;<span class="op" id="6927186">!=</span>&nbsp;<span class="builtintype" id="6927189">nil</span>&nbsp;<span class="op" id="6927193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6927197">t</span><span class="op" id="6927198">.</span><span class="ident" id="6927199">Fatal</span><span class="op" id="6927204">(</span><span class="ident" id="6927205">err</span><span class="op" id="6927208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6927211">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6927214">if</span>&nbsp;<span class="ident" id="6927217">got</span>&nbsp;<span class="op" id="6927221">:=</span>&nbsp;<span class="builtintype" id="6927224">string</span><span class="op" id="6927230">(</span><span class="ident" id="6927231">got</span><span class="op" id="6927234">)</span><span class="op" id="6927235">;</span>&nbsp;<span class="ident" id="6927237">got</span>&nbsp;<span class="op" id="6927241">!=</span>&nbsp;<span class="ident" id="6927244">optionalsExpected</span>&nbsp;<span class="op" id="6927262">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6927266">t</span><span class="op" id="6927267">.</span><span class="ident" id="6927268">Errorf</span><span class="op" id="6927274">(</span><span class="string" id="6927275">&#34;&nbsp;got:&nbsp;%s\nwant:&nbsp;%s\n&#34;</span><span class="op" id="6927297">,</span>&nbsp;<span class="ident" id="6927299">got</span><span class="op" id="6927302">,</span>&nbsp;<span class="ident" id="6927304">optionalsExpected</span><span class="op" id="6927321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6927324">}</span><br>
<span class="lineno"></span><span class="op" id="6927326">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6927329">type</span>&nbsp;<span class="ident" id="6927334">StringTag</span>&nbsp;<span class="keyword" id="6927344">struct</span>&nbsp;<span class="op" id="6927351">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6927354">BoolStr</span>&nbsp;<span class="builtintype" id="6927362">bool</span>&nbsp;&nbsp;&nbsp;<span class="string" id="6927369">`json:&#34;,string&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6927387">IntStr</span>&nbsp;&nbsp;<span class="ident" id="6927395">int64</span>&nbsp;&nbsp;<span class="string" id="6927402">`json:&#34;,string&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6927420">StrStr</span>&nbsp;&nbsp;<span class="builtintype" id="6927428">string</span>&nbsp;<span class="string" id="6927435">`json:&#34;,string&#34;`</span><br>
<span class="lineno"></span><span class="op" id="6927452">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="6927455">var</span>&nbsp;<span class="ident" id="6927459">stringTagExpected</span>&nbsp;<span class="op" id="6927477">=</span>&nbsp;<span class="string" id="6927479">`{<br>
<span class="lineno"></span>&nbsp;&#34;BoolStr&#34;:&nbsp;&#34;true&#34;,<br>
<span class="lineno"></span>&nbsp;&#34;IntStr&#34;:&nbsp;&#34;42&#34;,<br>
<span class="lineno"></span>&nbsp;&#34;StrStr&#34;:&nbsp;&#34;\&#34;xzbit\&#34;&#34;<br>
<span class="lineno"></span>}`</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="keyword" id="6927546">func</span>&nbsp;<span class="ident" id="6927551">TestStringTag</span><span class="op" id="6927564">(</span><span class="ident" id="6927565">t</span>&nbsp;<span class="op" id="6927567">*</span><span class="ident" id="6927568">testing</span><span class="op" id="6927575">.</span><span class="ident" id="6927576">T</span><span class="op" id="6927577">)</span>&nbsp;<span class="op" id="6927579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6927582">var</span>&nbsp;<span class="ident" id="6927586">s</span>&nbsp;<span class="ident" id="6927588">StringTag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6927599">s</span><span class="op" id="6927600">.</span><span class="ident" id="6927601">BoolStr</span>&nbsp;<span class="op" id="6927609">=</span>&nbsp;<span class="builtintype" id="6927611">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6927617">s</span><span class="op" id="6927618">.</span><span class="ident" id="6927619">IntStr</span>&nbsp;<span class="op" id="6927626">=</span>&nbsp;<span class="num" id="6927628">42</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6927632">s</span><span class="op" id="6927633">.</span><span class="ident" id="6927634">StrStr</span>&nbsp;<span class="op" id="6927641">=</span>&nbsp;<span class="string" id="6927643">&#34;xzbit&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6927652">got</span><span class="op" id="6927655">,</span>&nbsp;<span class="ident" id="6927657">err</span>&nbsp;<span class="op" id="6927661">:=</span>&nbsp;<span class="ident" id="6927664">MarshalIndent</span><span class="op" id="6927677">(</span><span class="op" id="6927678">&amp;</span><span class="ident" id="6927679">s</span><span class="op" id="6927680">,</span>&nbsp;<span class="string" id="6927682">&#34;&#34;</span><span class="op" id="6927684">,</span>&nbsp;<span class="string" id="6927686">&#34;&nbsp;&#34;</span><span class="op" id="6927689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6927692">if</span>&nbsp;<span class="ident" id="6927695">err</span>&nbsp;<span class="op" id="6927699">!=</span>&nbsp;<span class="builtintype" id="6927702">nil</span>&nbsp;<span class="op" id="6927706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6927710">t</span><span class="op" id="6927711">.</span><span class="ident" id="6927712">Fatal</span><span class="op" id="6927717">(</span><span class="ident" id="6927718">err</span><span class="op" id="6927721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6927724">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6927727">if</span>&nbsp;<span class="ident" id="6927730">got</span>&nbsp;<span class="op" id="6927734">:=</span>&nbsp;<span class="builtintype" id="6927737">string</span><span class="op" id="6927743">(</span><span class="ident" id="6927744">got</span><span class="op" id="6927747">)</span><span class="op" id="6927748">;</span>&nbsp;<span class="ident" id="6927750">got</span>&nbsp;<span class="op" id="6927754">!=</span>&nbsp;<span class="ident" id="6927757">stringTagExpected</span>&nbsp;<span class="op" id="6927775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6927779">t</span><span class="op" id="6927780">.</span><span class="ident" id="6927781">Fatalf</span><span class="op" id="6927787">(</span><span class="string" id="6927788">&#34;&nbsp;got:&nbsp;%s\nwant:&nbsp;%s\n&#34;</span><span class="op" id="6927810">,</span>&nbsp;<span class="ident" id="6927812">got</span><span class="op" id="6927815">,</span>&nbsp;<span class="ident" id="6927817">stringTagExpected</span><span class="op" id="6927834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6927837">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6927841">//&nbsp;Verify&nbsp;that&nbsp;it&nbsp;round-trips.</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6927873">var</span>&nbsp;<span class="ident" id="6927877">s2</span>&nbsp;<span class="ident" id="6927880">StringTag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6927891">err</span>&nbsp;<span class="op" id="6927895">=</span>&nbsp;<span class="ident" id="6927897">NewDecoder</span><span class="op" id="6927907">(</span><span class="ident" id="6927908">bytes</span><span class="op" id="6927913">.</span><span class="ident" id="6927914">NewReader</span><span class="op" id="6927923">(</span><span class="ident" id="6927924">got</span><span class="op" id="6927927">)</span><span class="op" id="6927928">)</span><span class="op" id="6927929">.</span><span class="ident" id="6927930">Decode</span><span class="op" id="6927936">(</span><span class="op" id="6927937">&amp;</span><span class="ident" id="6927938">s2</span><span class="op" id="6927940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6927943">if</span>&nbsp;<span class="ident" id="6927946">err</span>&nbsp;<span class="op" id="6927950">!=</span>&nbsp;<span class="builtintype" id="6927953">nil</span>&nbsp;<span class="op" id="6927957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6927961">t</span><span class="op" id="6927962">.</span><span class="ident" id="6927963">Fatalf</span><span class="op" id="6927969">(</span><span class="string" id="6927970">&#34;Decode:&nbsp;%v&#34;</span><span class="op" id="6927982">,</span>&nbsp;<span class="ident" id="6927984">err</span><span class="op" id="6927987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6927990">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6927993">if</span>&nbsp;<span class="op" id="6927996">!</span><span class="ident" id="6927997">reflect</span><span class="op" id="6928004">.</span><span class="ident" id="6928005">DeepEqual</span><span class="op" id="6928014">(</span><span class="ident" id="6928015">s</span><span class="op" id="6928016">,</span>&nbsp;<span class="ident" id="6928018">s2</span><span class="op" id="6928020">)</span>&nbsp;<span class="op" id="6928022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6928026">t</span><span class="op" id="6928027">.</span><span class="ident" id="6928028">Fatalf</span><span class="op" id="6928034">(</span><span class="string" id="6928035">&#34;decode&nbsp;didn&#39;t&nbsp;match.\nsource:&nbsp;%#v\nEncoded&nbsp;as:\n%s\ndecode:&nbsp;%#v&#34;</span><span class="op" id="6928100">,</span>&nbsp;<span class="ident" id="6928102">s</span><span class="op" id="6928103">,</span>&nbsp;<span class="builtintype" id="6928105">string</span><span class="op" id="6928111">(</span><span class="ident" id="6928112">got</span><span class="op" id="6928115">)</span><span class="op" id="6928116">,</span>&nbsp;<span class="ident" id="6928118">s2</span><span class="op" id="6928120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6928123">}</span><br>
<span class="lineno"></span><span class="op" id="6928125">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="6928128">//&nbsp;byte&nbsp;slices&nbsp;are&nbsp;special&nbsp;even&nbsp;if&nbsp;they&#39;re&nbsp;renamed&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="6928186">type</span>&nbsp;<span class="ident" id="6928191">renamedByte</span>&nbsp;<span class="builtintype" id="6928203">byte</span><br>
<span class="lineno"></span><span class="keyword" id="6928208">type</span>&nbsp;<span class="ident" id="6928213">renamedByteSlice</span>&nbsp;<span class="op" id="6928230">[</span><span class="op" id="6928231">]</span><span class="builtintype" id="6928232">byte</span><br>
<span class="lineno"></span><span class="keyword" id="6928237">type</span>&nbsp;<span class="ident" id="6928242">renamedRenamedByteSlice</span>&nbsp;<span class="op" id="6928266">[</span><span class="op" id="6928267">]</span><span class="ident" id="6928268">renamedByte</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="6928281">func</span>&nbsp;<span class="ident" id="6928286">TestEncodeRenamedByteSlice</span><span class="op" id="6928312">(</span><span class="ident" id="6928313">t</span>&nbsp;<span class="op" id="6928315">*</span><span class="ident" id="6928316">testing</span><span class="op" id="6928323">.</span><span class="ident" id="6928324">T</span><span class="op" id="6928325">)</span>&nbsp;<span class="op" id="6928327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6928330">s</span>&nbsp;<span class="op" id="6928332">:=</span>&nbsp;<span class="ident" id="6928335">renamedByteSlice</span><span class="op" id="6928351">(</span><span class="string" id="6928352">&#34;abc&#34;</span><span class="op" id="6928357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6928360">result</span><span class="op" id="6928366">,</span>&nbsp;<span class="ident" id="6928368">err</span>&nbsp;<span class="op" id="6928372">:=</span>&nbsp;<span class="ident" id="6928375">Marshal</span><span class="op" id="6928382">(</span><span class="ident" id="6928383">s</span><span class="op" id="6928384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6928387">if</span>&nbsp;<span class="ident" id="6928390">err</span>&nbsp;<span class="op" id="6928394">!=</span>&nbsp;<span class="builtintype" id="6928397">nil</span>&nbsp;<span class="op" id="6928401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6928405">t</span><span class="op" id="6928406">.</span><span class="ident" id="6928407">Fatal</span><span class="op" id="6928412">(</span><span class="ident" id="6928413">err</span><span class="op" id="6928416">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6928419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6928422">expect</span>&nbsp;<span class="op" id="6928429">:=</span>&nbsp;<span class="string" id="6928432">`&#34;YWJj&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6928442">if</span>&nbsp;<span class="builtintype" id="6928445">string</span><span class="op" id="6928451">(</span><span class="ident" id="6928452">result</span><span class="op" id="6928458">)</span>&nbsp;<span class="op" id="6928460">!=</span>&nbsp;<span class="ident" id="6928463">expect</span>&nbsp;<span class="op" id="6928470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6928474">t</span><span class="op" id="6928475">.</span><span class="ident" id="6928476">Errorf</span><span class="op" id="6928482">(</span><span class="string" id="6928483">&#34;&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="6928500">,</span>&nbsp;<span class="ident" id="6928502">result</span><span class="op" id="6928508">,</span>&nbsp;<span class="ident" id="6928510">expect</span><span class="op" id="6928516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6928519">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6928522">r</span>&nbsp;<span class="op" id="6928524">:=</span>&nbsp;<span class="ident" id="6928527">renamedRenamedByteSlice</span><span class="op" id="6928550">(</span><span class="string" id="6928551">&#34;abc&#34;</span><span class="op" id="6928556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6928559">result</span><span class="op" id="6928565">,</span>&nbsp;<span class="ident" id="6928567">err</span>&nbsp;<span class="op" id="6928571">=</span>&nbsp;<span class="ident" id="6928573">Marshal</span><span class="op" id="6928580">(</span><span class="ident" id="6928581">r</span><span class="op" id="6928582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6928585">if</span>&nbsp;<span class="ident" id="6928588">err</span>&nbsp;<span class="op" id="6928592">!=</span>&nbsp;<span class="builtintype" id="6928595">nil</span>&nbsp;<span class="op" id="6928599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6928603">t</span><span class="op" id="6928604">.</span><span class="ident" id="6928605">Fatal</span><span class="op" id="6928610">(</span><span class="ident" id="6928611">err</span><span class="op" id="6928614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6928617">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6928620">if</span>&nbsp;<span class="builtintype" id="6928623">string</span><span class="op" id="6928629">(</span><span class="ident" id="6928630">result</span><span class="op" id="6928636">)</span>&nbsp;<span class="op" id="6928638">!=</span>&nbsp;<span class="ident" id="6928641">expect</span>&nbsp;<span class="op" id="6928648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6928652">t</span><span class="op" id="6928653">.</span><span class="ident" id="6928654">Errorf</span><span class="op" id="6928660">(</span><span class="string" id="6928661">&#34;&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="6928678">,</span>&nbsp;<span class="ident" id="6928680">result</span><span class="op" id="6928686">,</span>&nbsp;<span class="ident" id="6928688">expect</span><span class="op" id="6928694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6928697">}</span><br>
<span class="lineno"></span><span class="op" id="6928699">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="6928702">var</span>&nbsp;<span class="ident" id="6928706">unsupportedValues</span>&nbsp;<span class="op" id="6928724">=</span>&nbsp;<span class="op" id="6928726">[</span><span class="op" id="6928727">]</span><span class="keyword" id="6928728">interface</span><span class="op" id="6928737">{</span><span class="op" id="6928738">}</span><span class="op" id="6928739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6928742">math</span><span class="op" id="6928746">.</span><span class="ident" id="6928747">NaN</span><span class="op" id="6928750">(</span><span class="op" id="6928751">)</span><span class="op" id="6928752">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6928755">math</span><span class="op" id="6928759">.</span><span class="ident" id="6928760">Inf</span><span class="op" id="6928763">(</span><span class="op" id="6928764">-</span><span class="num" id="6928765">1</span><span class="op" id="6928766">)</span><span class="op" id="6928767">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6928770">math</span><span class="op" id="6928774">.</span><span class="ident" id="6928775">Inf</span><span class="op" id="6928778">(</span><span class="num" id="6928779">1</span><span class="op" id="6928780">)</span><span class="op" id="6928781">,</span><br>
<span class="lineno"></span><span class="op" id="6928783">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="keyword" id="6928786">func</span>&nbsp;<span class="ident" id="6928791">TestUnsupportedValues</span><span class="op" id="6928812">(</span><span class="ident" id="6928813">t</span>&nbsp;<span class="op" id="6928815">*</span><span class="ident" id="6928816">testing</span><span class="op" id="6928823">.</span><span class="ident" id="6928824">T</span><span class="op" id="6928825">)</span>&nbsp;<span class="op" id="6928827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6928830">for</span>&nbsp;<span class="ident" id="6928834">_</span><span class="op" id="6928835">,</span>&nbsp;<span class="ident" id="6928837">v</span>&nbsp;<span class="op" id="6928839">:=</span>&nbsp;<span class="keyword" id="6928842">range</span>&nbsp;<span class="ident" id="6928848">unsupportedValues</span>&nbsp;<span class="op" id="6928866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6928870">if</span>&nbsp;<span class="ident" id="6928873">_</span><span class="op" id="6928874">,</span>&nbsp;<span class="ident" id="6928876">err</span>&nbsp;<span class="op" id="6928880">:=</span>&nbsp;<span class="ident" id="6928883">Marshal</span><span class="op" id="6928890">(</span><span class="ident" id="6928891">v</span><span class="op" id="6928892">)</span><span class="op" id="6928893">;</span>&nbsp;<span class="ident" id="6928895">err</span>&nbsp;<span class="op" id="6928899">!=</span>&nbsp;<span class="builtintype" id="6928902">nil</span>&nbsp;<span class="op" id="6928906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6928911">if</span>&nbsp;<span class="ident" id="6928914">_</span><span class="op" id="6928915">,</span>&nbsp;<span class="ident" id="6928917">ok</span>&nbsp;<span class="op" id="6928920">:=</span>&nbsp;<span class="ident" id="6928923">err</span><span class="op" id="6928926">.</span><span class="op" id="6928927">(</span><span class="op" id="6928928">*</span><span class="ident" id="6928929">UnsupportedValueError</span><span class="op" id="6928950">)</span><span class="op" id="6928951">;</span>&nbsp;<span class="op" id="6928953">!</span><span class="ident" id="6928954">ok</span>&nbsp;<span class="op" id="6928957">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6928963">t</span><span class="op" id="6928964">.</span><span class="ident" id="6928965">Errorf</span><span class="op" id="6928971">(</span><span class="string" id="6928972">&#34;for&nbsp;%v,&nbsp;got&nbsp;%T&nbsp;want&nbsp;UnsupportedValueError&#34;</span><span class="op" id="6929015">,</span>&nbsp;<span class="ident" id="6929017">v</span><span class="op" id="6929018">,</span>&nbsp;<span class="ident" id="6929020">err</span><span class="op" id="6929023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6929028">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6929032">}</span>&nbsp;<span class="keyword" id="6929034">else</span>&nbsp;<span class="op" id="6929039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6929044">t</span><span class="op" id="6929045">.</span><span class="ident" id="6929046">Errorf</span><span class="op" id="6929052">(</span><span class="string" id="6929053">&#34;for&nbsp;%v,&nbsp;expected&nbsp;error&#34;</span><span class="op" id="6929077">,</span>&nbsp;<span class="ident" id="6929079">v</span><span class="op" id="6929080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6929084">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6929087">}</span><br>
<span class="lineno"></span><span class="op" id="6929089">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6929092">//&nbsp;Ref&nbsp;has&nbsp;Marshaler&nbsp;and&nbsp;Unmarshaler&nbsp;methods&nbsp;with&nbsp;pointer&nbsp;receiver.</span><br>
<span class="lineno"></span><span class="keyword" id="6929160">type</span>&nbsp;<span class="ident" id="6929165">Ref</span>&nbsp;<span class="builtintype" id="6929169">int</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="keyword" id="6929174">func</span>&nbsp;<span class="op" id="6929179">(</span><span class="op" id="6929180">*</span><span class="ident" id="6929181">Ref</span><span class="op" id="6929184">)</span>&nbsp;<span class="ident" id="6929186">MarshalJSON</span><span class="op" id="6929197">(</span><span class="op" id="6929198">)</span>&nbsp;<span class="op" id="6929200">(</span><span class="op" id="6929201">[</span><span class="op" id="6929202">]</span><span class="builtintype" id="6929203">byte</span><span class="op" id="6929207">,</span>&nbsp;<span class="builtintype" id="6929209">error</span><span class="op" id="6929214">)</span>&nbsp;<span class="op" id="6929216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6929219">return</span>&nbsp;<span class="op" id="6929226">[</span><span class="op" id="6929227">]</span><span class="builtintype" id="6929228">byte</span><span class="op" id="6929232">(</span><span class="string" id="6929233">`&#34;ref&#34;`</span><span class="op" id="6929240">)</span><span class="op" id="6929241">,</span>&nbsp;<span class="builtintype" id="6929243">nil</span><br>
<span class="lineno"></span><span class="op" id="6929247">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="keyword" id="6929250">func</span>&nbsp;<span class="op" id="6929255">(</span><span class="ident" id="6929256">r</span>&nbsp;<span class="op" id="6929258">*</span><span class="ident" id="6929259">Ref</span><span class="op" id="6929262">)</span>&nbsp;<span class="ident" id="6929264">UnmarshalJSON</span><span class="op" id="6929277">(</span><span class="op" id="6929278">[</span><span class="op" id="6929279">]</span><span class="builtintype" id="6929280">byte</span><span class="op" id="6929284">)</span>&nbsp;<span class="builtintype" id="6929286">error</span>&nbsp;<span class="op" id="6929292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6929295">*</span><span class="ident" id="6929296">r</span>&nbsp;<span class="op" id="6929298">=</span>&nbsp;<span class="num" id="6929300">12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6929304">return</span>&nbsp;<span class="builtintype" id="6929311">nil</span><br>
<span class="lineno"></span><span class="op" id="6929315">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="6929318">//&nbsp;Val&nbsp;has&nbsp;Marshaler&nbsp;methods&nbsp;with&nbsp;value&nbsp;receiver.</span><br>
<span class="lineno"></span><span class="keyword" id="6929368">type</span>&nbsp;<span class="ident" id="6929373">Val</span>&nbsp;<span class="builtintype" id="6929377">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6929382">func</span>&nbsp;<span class="op" id="6929387">(</span><span class="ident" id="6929388">Val</span><span class="op" id="6929391">)</span>&nbsp;<span class="ident" id="6929393">MarshalJSON</span><span class="op" id="6929404">(</span><span class="op" id="6929405">)</span>&nbsp;<span class="op" id="6929407">(</span><span class="op" id="6929408">[</span><span class="op" id="6929409">]</span><span class="builtintype" id="6929410">byte</span><span class="op" id="6929414">,</span>&nbsp;<span class="builtintype" id="6929416">error</span><span class="op" id="6929421">)</span>&nbsp;<span class="op" id="6929423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6929426">return</span>&nbsp;<span class="op" id="6929433">[</span><span class="op" id="6929434">]</span><span class="builtintype" id="6929435">byte</span><span class="op" id="6929439">(</span><span class="string" id="6929440">`&#34;val&#34;`</span><span class="op" id="6929447">)</span><span class="op" id="6929448">,</span>&nbsp;<span class="builtintype" id="6929450">nil</span><br>
<span class="lineno">165</span><span class="op" id="6929454">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6929457">//&nbsp;RefText&nbsp;has&nbsp;Marshaler&nbsp;and&nbsp;Unmarshaler&nbsp;methods&nbsp;with&nbsp;pointer&nbsp;receiver.</span><br>
<span class="lineno"></span><span class="keyword" id="6929529">type</span>&nbsp;<span class="ident" id="6929534">RefText</span>&nbsp;<span class="builtintype" id="6929542">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="6929547">func</span>&nbsp;<span class="op" id="6929552">(</span><span class="op" id="6929553">*</span><span class="ident" id="6929554">RefText</span><span class="op" id="6929561">)</span>&nbsp;<span class="ident" id="6929563">MarshalText</span><span class="op" id="6929574">(</span><span class="op" id="6929575">)</span>&nbsp;<span class="op" id="6929577">(</span><span class="op" id="6929578">[</span><span class="op" id="6929579">]</span><span class="builtintype" id="6929580">byte</span><span class="op" id="6929584">,</span>&nbsp;<span class="builtintype" id="6929586">error</span><span class="op" id="6929591">)</span>&nbsp;<span class="op" id="6929593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6929596">return</span>&nbsp;<span class="op" id="6929603">[</span><span class="op" id="6929604">]</span><span class="builtintype" id="6929605">byte</span><span class="op" id="6929609">(</span><span class="string" id="6929610">`&#34;ref&#34;`</span><span class="op" id="6929617">)</span><span class="op" id="6929618">,</span>&nbsp;<span class="builtintype" id="6929620">nil</span><br>
<span class="lineno"></span><span class="op" id="6929624">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6929627">func</span>&nbsp;<span class="op" id="6929632">(</span><span class="ident" id="6929633">r</span>&nbsp;<span class="op" id="6929635">*</span><span class="ident" id="6929636">RefText</span><span class="op" id="6929643">)</span>&nbsp;<span class="ident" id="6929645">UnmarshalText</span><span class="op" id="6929658">(</span><span class="op" id="6929659">[</span><span class="op" id="6929660">]</span><span class="builtintype" id="6929661">byte</span><span class="op" id="6929665">)</span>&nbsp;<span class="builtintype" id="6929667">error</span>&nbsp;<span class="op" id="6929673">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6929676">*</span><span class="ident" id="6929677">r</span>&nbsp;<span class="op" id="6929679">=</span>&nbsp;<span class="num" id="6929681">13</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6929685">return</span>&nbsp;<span class="builtintype" id="6929692">nil</span><br>
<span class="lineno"></span><span class="op" id="6929696">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6929699">//&nbsp;ValText&nbsp;has&nbsp;Marshaler&nbsp;methods&nbsp;with&nbsp;value&nbsp;receiver.</span><br>
<span class="lineno">180</span><span class="keyword" id="6929753">type</span>&nbsp;<span class="ident" id="6929758">ValText</span>&nbsp;<span class="builtintype" id="6929766">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6929771">func</span>&nbsp;<span class="op" id="6929776">(</span><span class="ident" id="6929777">ValText</span><span class="op" id="6929784">)</span>&nbsp;<span class="ident" id="6929786">MarshalText</span><span class="op" id="6929797">(</span><span class="op" id="6929798">)</span>&nbsp;<span class="op" id="6929800">(</span><span class="op" id="6929801">[</span><span class="op" id="6929802">]</span><span class="builtintype" id="6929803">byte</span><span class="op" id="6929807">,</span>&nbsp;<span class="builtintype" id="6929809">error</span><span class="op" id="6929814">)</span>&nbsp;<span class="op" id="6929816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6929819">return</span>&nbsp;<span class="op" id="6929826">[</span><span class="op" id="6929827">]</span><span class="builtintype" id="6929828">byte</span><span class="op" id="6929832">(</span><span class="string" id="6929833">`&#34;val&#34;`</span><span class="op" id="6929840">)</span><span class="op" id="6929841">,</span>&nbsp;<span class="builtintype" id="6929843">nil</span><br>
<span class="lineno"></span><span class="op" id="6929847">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span><span class="keyword" id="6929850">func</span>&nbsp;<span class="ident" id="6929855">TestRefValMarshal</span><span class="op" id="6929872">(</span><span class="ident" id="6929873">t</span>&nbsp;<span class="op" id="6929875">*</span><span class="ident" id="6929876">testing</span><span class="op" id="6929883">.</span><span class="ident" id="6929884">T</span><span class="op" id="6929885">)</span>&nbsp;<span class="op" id="6929887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6929890">var</span>&nbsp;<span class="ident" id="6929894">s</span>&nbsp;<span class="op" id="6929896">=</span>&nbsp;<span class="keyword" id="6929898">struct</span>&nbsp;<span class="op" id="6929905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6929909">R0</span>&nbsp;<span class="ident" id="6929912">Ref</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6929918">R1</span>&nbsp;<span class="op" id="6929921">*</span><span class="ident" id="6929922">Ref</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6929928">R2</span>&nbsp;<span class="ident" id="6929931">RefText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6929941">R3</span>&nbsp;<span class="op" id="6929944">*</span><span class="ident" id="6929945">RefText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6929955">V0</span>&nbsp;<span class="ident" id="6929958">Val</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6929964">V1</span>&nbsp;<span class="op" id="6929967">*</span><span class="ident" id="6929968">Val</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6929974">V2</span>&nbsp;<span class="ident" id="6929977">ValText</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6929987">V3</span>&nbsp;<span class="op" id="6929990">*</span><span class="ident" id="6929991">ValText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6930000">}</span><span class="op" id="6930001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6930005">R0</span><span class="op" id="6930007">:</span>&nbsp;<span class="num" id="6930009">12</span><span class="op" id="6930011">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6930015">R1</span><span class="op" id="6930017">:</span>&nbsp;<span class="builtinfunc" id="6930019">new</span><span class="op" id="6930022">(</span><span class="ident" id="6930023">Ref</span><span class="op" id="6930026">)</span><span class="op" id="6930027">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6930031">R2</span><span class="op" id="6930033">:</span>&nbsp;<span class="num" id="6930035">14</span><span class="op" id="6930037">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6930041">R3</span><span class="op" id="6930043">:</span>&nbsp;<span class="builtinfunc" id="6930045">new</span><span class="op" id="6930048">(</span><span class="ident" id="6930049">RefText</span><span class="op" id="6930056">)</span><span class="op" id="6930057">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6930061">V0</span><span class="op" id="6930063">:</span>&nbsp;<span class="num" id="6930065">13</span><span class="op" id="6930067">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6930071">V1</span><span class="op" id="6930073">:</span>&nbsp;<span class="builtinfunc" id="6930075">new</span><span class="op" id="6930078">(</span><span class="ident" id="6930079">Val</span><span class="op" id="6930082">)</span><span class="op" id="6930083">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6930087">V2</span><span class="op" id="6930089">:</span>&nbsp;<span class="num" id="6930091">15</span><span class="op" id="6930093">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6930097">V3</span><span class="op" id="6930099">:</span>&nbsp;<span class="builtinfunc" id="6930101">new</span><span class="op" id="6930104">(</span><span class="ident" id="6930105">ValText</span><span class="op" id="6930112">)</span><span class="op" id="6930113">,</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6930116">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6930119">const</span>&nbsp;<span class="ident" id="6930125">want</span>&nbsp;<span class="op" id="6930130">=</span>&nbsp;<span class="string" id="6930132">`{&#34;R0&#34;:&#34;ref&#34;,&#34;R1&#34;:&#34;ref&#34;,&#34;R2&#34;:&#34;\&#34;ref\&#34;&#34;,&#34;R3&#34;:&#34;\&#34;ref\&#34;&#34;,&#34;V0&#34;:&#34;val&#34;,&#34;V1&#34;:&#34;val&#34;,&#34;V2&#34;:&#34;\&#34;val\&#34;&#34;,&#34;V3&#34;:&#34;\&#34;val\&#34;&#34;}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6930241">b</span><span class="op" id="6930242">,</span>&nbsp;<span class="ident" id="6930244">err</span>&nbsp;<span class="op" id="6930248">:=</span>&nbsp;<span class="ident" id="6930251">Marshal</span><span class="op" id="6930258">(</span><span class="op" id="6930259">&amp;</span><span class="ident" id="6930260">s</span><span class="op" id="6930261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6930264">if</span>&nbsp;<span class="ident" id="6930267">err</span>&nbsp;<span class="op" id="6930271">!=</span>&nbsp;<span class="builtintype" id="6930274">nil</span>&nbsp;<span class="op" id="6930278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6930282">t</span><span class="op" id="6930283">.</span><span class="ident" id="6930284">Fatalf</span><span class="op" id="6930290">(</span><span class="string" id="6930291">&#34;Marshal:&nbsp;%v&#34;</span><span class="op" id="6930304">,</span>&nbsp;<span class="ident" id="6930306">err</span><span class="op" id="6930309">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6930312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6930315">if</span>&nbsp;<span class="ident" id="6930318">got</span>&nbsp;<span class="op" id="6930322">:=</span>&nbsp;<span class="builtintype" id="6930325">string</span><span class="op" id="6930331">(</span><span class="ident" id="6930332">b</span><span class="op" id="6930333">)</span><span class="op" id="6930334">;</span>&nbsp;<span class="ident" id="6930336">got</span>&nbsp;<span class="op" id="6930340">!=</span>&nbsp;<span class="ident" id="6930343">want</span>&nbsp;<span class="op" id="6930348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6930352">t</span><span class="op" id="6930353">.</span><span class="ident" id="6930354">Errorf</span><span class="op" id="6930360">(</span><span class="string" id="6930361">&#34;got&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6930378">,</span>&nbsp;<span class="ident" id="6930380">got</span><span class="op" id="6930383">,</span>&nbsp;<span class="ident" id="6930385">want</span><span class="op" id="6930389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6930392">}</span><br>
<span class="lineno"></span><span class="op" id="6930394">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span><span class="comment" id="6930397">//&nbsp;C&nbsp;implements&nbsp;Marshaler&nbsp;and&nbsp;returns&nbsp;unescaped&nbsp;JSON.</span><br>
<span class="lineno"></span><span class="keyword" id="6930451">type</span>&nbsp;<span class="ident" id="6930456">C</span>&nbsp;<span class="builtintype" id="6930458">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6930463">func</span>&nbsp;<span class="op" id="6930468">(</span><span class="ident" id="6930469">C</span><span class="op" id="6930470">)</span>&nbsp;<span class="ident" id="6930472">MarshalJSON</span><span class="op" id="6930483">(</span><span class="op" id="6930484">)</span>&nbsp;<span class="op" id="6930486">(</span><span class="op" id="6930487">[</span><span class="op" id="6930488">]</span><span class="builtintype" id="6930489">byte</span><span class="op" id="6930493">,</span>&nbsp;<span class="builtintype" id="6930495">error</span><span class="op" id="6930500">)</span>&nbsp;<span class="op" id="6930502">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6930505">return</span>&nbsp;<span class="op" id="6930512">[</span><span class="op" id="6930513">]</span><span class="builtintype" id="6930514">byte</span><span class="op" id="6930518">(</span><span class="string" id="6930519">`&#34;&lt;&amp;&gt;&#34;`</span><span class="op" id="6930526">)</span><span class="op" id="6930527">,</span>&nbsp;<span class="builtintype" id="6930529">nil</span><br>
<span class="lineno"></span><span class="op" id="6930533">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6930536">//&nbsp;CText&nbsp;implements&nbsp;Marshaler&nbsp;and&nbsp;returns&nbsp;unescaped&nbsp;text.</span><br>
<span class="lineno"></span><span class="keyword" id="6930594">type</span>&nbsp;<span class="ident" id="6930599">CText</span>&nbsp;<span class="builtintype" id="6930605">int</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="keyword" id="6930610">func</span>&nbsp;<span class="op" id="6930615">(</span><span class="ident" id="6930616">CText</span><span class="op" id="6930621">)</span>&nbsp;<span class="ident" id="6930623">MarshalText</span><span class="op" id="6930634">(</span><span class="op" id="6930635">)</span>&nbsp;<span class="op" id="6930637">(</span><span class="op" id="6930638">[</span><span class="op" id="6930639">]</span><span class="builtintype" id="6930640">byte</span><span class="op" id="6930644">,</span>&nbsp;<span class="builtintype" id="6930646">error</span><span class="op" id="6930651">)</span>&nbsp;<span class="op" id="6930653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6930656">return</span>&nbsp;<span class="op" id="6930663">[</span><span class="op" id="6930664">]</span><span class="builtintype" id="6930665">byte</span><span class="op" id="6930669">(</span><span class="string" id="6930670">`&#34;&lt;&amp;&gt;&#34;`</span><span class="op" id="6930677">)</span><span class="op" id="6930678">,</span>&nbsp;<span class="builtintype" id="6930680">nil</span><br>
<span class="lineno"></span><span class="op" id="6930684">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="6930687">func</span>&nbsp;<span class="ident" id="6930692">TestMarshalerEscaping</span><span class="op" id="6930713">(</span><span class="ident" id="6930714">t</span>&nbsp;<span class="op" id="6930716">*</span><span class="ident" id="6930717">testing</span><span class="op" id="6930724">.</span><span class="ident" id="6930725">T</span><span class="op" id="6930726">)</span>&nbsp;<span class="op" id="6930728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6930731">var</span>&nbsp;<span class="ident" id="6930735">c</span>&nbsp;<span class="ident" id="6930737">C</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6930740">want</span>&nbsp;<span class="op" id="6930745">:=</span>&nbsp;<span class="string" id="6930748">`&#34;\u003c\u0026\u003e&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6930772">b</span><span class="op" id="6930773">,</span>&nbsp;<span class="ident" id="6930775">err</span>&nbsp;<span class="op" id="6930779">:=</span>&nbsp;<span class="ident" id="6930782">Marshal</span><span class="op" id="6930789">(</span><span class="ident" id="6930790">c</span><span class="op" id="6930791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6930794">if</span>&nbsp;<span class="ident" id="6930797">err</span>&nbsp;<span class="op" id="6930801">!=</span>&nbsp;<span class="builtintype" id="6930804">nil</span>&nbsp;<span class="op" id="6930808">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6930812">t</span><span class="op" id="6930813">.</span><span class="ident" id="6930814">Fatalf</span><span class="op" id="6930820">(</span><span class="string" id="6930821">&#34;Marshal(c):&nbsp;%v&#34;</span><span class="op" id="6930837">,</span>&nbsp;<span class="ident" id="6930839">err</span><span class="op" id="6930842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6930845">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6930848">if</span>&nbsp;<span class="ident" id="6930851">got</span>&nbsp;<span class="op" id="6930855">:=</span>&nbsp;<span class="builtintype" id="6930858">string</span><span class="op" id="6930864">(</span><span class="ident" id="6930865">b</span><span class="op" id="6930866">)</span><span class="op" id="6930867">;</span>&nbsp;<span class="ident" id="6930869">got</span>&nbsp;<span class="op" id="6930873">!=</span>&nbsp;<span class="ident" id="6930876">want</span>&nbsp;<span class="op" id="6930881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6930885">t</span><span class="op" id="6930886">.</span><span class="ident" id="6930887">Errorf</span><span class="op" id="6930893">(</span><span class="string" id="6930894">&#34;Marshal(c)&nbsp;=&nbsp;%#q,&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="6930922">,</span>&nbsp;<span class="ident" id="6930924">got</span><span class="op" id="6930927">,</span>&nbsp;<span class="ident" id="6930929">want</span><span class="op" id="6930933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6930936">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6930940">var</span>&nbsp;<span class="ident" id="6930944">ct</span>&nbsp;<span class="ident" id="6930947">CText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6930954">want</span>&nbsp;<span class="op" id="6930959">=</span>&nbsp;<span class="string" id="6930961">`&#34;\&#34;\u003c\u0026\u003e\&#34;&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6930989">b</span><span class="op" id="6930990">,</span>&nbsp;<span class="ident" id="6930992">err</span>&nbsp;<span class="op" id="6930996">=</span>&nbsp;<span class="ident" id="6930998">Marshal</span><span class="op" id="6931005">(</span><span class="ident" id="6931006">ct</span><span class="op" id="6931008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6931011">if</span>&nbsp;<span class="ident" id="6931014">err</span>&nbsp;<span class="op" id="6931018">!=</span>&nbsp;<span class="builtintype" id="6931021">nil</span>&nbsp;<span class="op" id="6931025">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6931029">t</span><span class="op" id="6931030">.</span><span class="ident" id="6931031">Fatalf</span><span class="op" id="6931037">(</span><span class="string" id="6931038">&#34;Marshal(ct):&nbsp;%v&#34;</span><span class="op" id="6931055">,</span>&nbsp;<span class="ident" id="6931057">err</span><span class="op" id="6931060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6931063">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6931066">if</span>&nbsp;<span class="ident" id="6931069">got</span>&nbsp;<span class="op" id="6931073">:=</span>&nbsp;<span class="builtintype" id="6931076">string</span><span class="op" id="6931082">(</span><span class="ident" id="6931083">b</span><span class="op" id="6931084">)</span><span class="op" id="6931085">;</span>&nbsp;<span class="ident" id="6931087">got</span>&nbsp;<span class="op" id="6931091">!=</span>&nbsp;<span class="ident" id="6931094">want</span>&nbsp;<span class="op" id="6931099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6931103">t</span><span class="op" id="6931104">.</span><span class="ident" id="6931105">Errorf</span><span class="op" id="6931111">(</span><span class="string" id="6931112">&#34;Marshal(ct)&nbsp;=&nbsp;%#q,&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="6931141">,</span>&nbsp;<span class="ident" id="6931143">got</span><span class="op" id="6931146">,</span>&nbsp;<span class="ident" id="6931148">want</span><span class="op" id="6931152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6931155">}</span><br>
<span class="lineno">250</span><span class="op" id="6931157">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6931160">type</span>&nbsp;<span class="ident" id="6931165">IntType</span>&nbsp;<span class="builtintype" id="6931173">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6931178">type</span>&nbsp;<span class="ident" id="6931183">MyStruct</span>&nbsp;<span class="keyword" id="6931192">struct</span>&nbsp;<span class="op" id="6931199">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6931202">IntType</span><br>
<span class="lineno"></span><span class="op" id="6931210">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6931213">func</span>&nbsp;<span class="ident" id="6931218">TestAnonymousNonstruct</span><span class="op" id="6931240">(</span><span class="ident" id="6931241">t</span>&nbsp;<span class="op" id="6931243">*</span><span class="ident" id="6931244">testing</span><span class="op" id="6931251">.</span><span class="ident" id="6931252">T</span><span class="op" id="6931253">)</span>&nbsp;<span class="op" id="6931255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6931258">var</span>&nbsp;<span class="ident" id="6931262">i</span>&nbsp;<span class="ident" id="6931264">IntType</span>&nbsp;<span class="op" id="6931272">=</span>&nbsp;<span class="num" id="6931274">11</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6931278">a</span>&nbsp;<span class="op" id="6931280">:=</span>&nbsp;<span class="ident" id="6931283">MyStruct</span><span class="op" id="6931291">{</span><span class="ident" id="6931292">i</span><span class="op" id="6931293">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6931296">const</span>&nbsp;<span class="ident" id="6931302">want</span>&nbsp;<span class="op" id="6931307">=</span>&nbsp;<span class="string" id="6931309">`{&#34;IntType&#34;:11}`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6931328">b</span><span class="op" id="6931329">,</span>&nbsp;<span class="ident" id="6931331">err</span>&nbsp;<span class="op" id="6931335">:=</span>&nbsp;<span class="ident" id="6931338">Marshal</span><span class="op" id="6931345">(</span><span class="ident" id="6931346">a</span><span class="op" id="6931347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6931350">if</span>&nbsp;<span class="ident" id="6931353">err</span>&nbsp;<span class="op" id="6931357">!=</span>&nbsp;<span class="builtintype" id="6931360">nil</span>&nbsp;<span class="op" id="6931364">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6931368">t</span><span class="op" id="6931369">.</span><span class="ident" id="6931370">Fatalf</span><span class="op" id="6931376">(</span><span class="string" id="6931377">&#34;Marshal:&nbsp;%v&#34;</span><span class="op" id="6931390">,</span>&nbsp;<span class="ident" id="6931392">err</span><span class="op" id="6931395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6931398">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6931401">if</span>&nbsp;<span class="ident" id="6931404">got</span>&nbsp;<span class="op" id="6931408">:=</span>&nbsp;<span class="builtintype" id="6931411">string</span><span class="op" id="6931417">(</span><span class="ident" id="6931418">b</span><span class="op" id="6931419">)</span><span class="op" id="6931420">;</span>&nbsp;<span class="ident" id="6931422">got</span>&nbsp;<span class="op" id="6931426">!=</span>&nbsp;<span class="ident" id="6931429">want</span>&nbsp;<span class="op" id="6931434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6931438">t</span><span class="op" id="6931439">.</span><span class="ident" id="6931440">Errorf</span><span class="op" id="6931446">(</span><span class="string" id="6931447">&#34;got&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6931464">,</span>&nbsp;<span class="ident" id="6931466">got</span><span class="op" id="6931469">,</span>&nbsp;<span class="ident" id="6931471">want</span><span class="op" id="6931475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6931478">}</span><br>
<span class="lineno">270</span><span class="op" id="6931480">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6931483">type</span>&nbsp;<span class="ident" id="6931488">BugA</span>&nbsp;<span class="keyword" id="6931493">struct</span>&nbsp;<span class="op" id="6931500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6931503">S</span>&nbsp;<span class="builtintype" id="6931505">string</span><br>
<span class="lineno"></span><span class="op" id="6931512">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="keyword" id="6931515">type</span>&nbsp;<span class="ident" id="6931520">BugB</span>&nbsp;<span class="keyword" id="6931525">struct</span>&nbsp;<span class="op" id="6931532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6931535">BugA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6931541">S</span>&nbsp;<span class="builtintype" id="6931543">string</span><br>
<span class="lineno"></span><span class="op" id="6931550">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="keyword" id="6931553">type</span>&nbsp;<span class="ident" id="6931558">BugC</span>&nbsp;<span class="keyword" id="6931563">struct</span>&nbsp;<span class="op" id="6931570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6931573">S</span>&nbsp;<span class="builtintype" id="6931575">string</span><br>
<span class="lineno"></span><span class="op" id="6931582">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="comment" id="6931585">//&nbsp;Legal&nbsp;Go:&nbsp;We&nbsp;never&nbsp;use&nbsp;the&nbsp;repeated&nbsp;embedded&nbsp;field&nbsp;(S).</span><br>
<span class="lineno"></span><span class="keyword" id="6931644">type</span>&nbsp;<span class="ident" id="6931649">BugX</span>&nbsp;<span class="keyword" id="6931654">struct</span>&nbsp;<span class="op" id="6931661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6931664">A</span>&nbsp;<span class="builtintype" id="6931666">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6931671">BugA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6931677">BugB</span><br>
<span class="lineno">290</span><span class="op" id="6931682">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6931685">//&nbsp;Issue&nbsp;5245.</span><br>
<span class="lineno"></span><span class="keyword" id="6931700">func</span>&nbsp;<span class="ident" id="6931705">TestEmbeddedBug</span><span class="op" id="6931720">(</span><span class="ident" id="6931721">t</span>&nbsp;<span class="op" id="6931723">*</span><span class="ident" id="6931724">testing</span><span class="op" id="6931731">.</span><span class="ident" id="6931732">T</span><span class="op" id="6931733">)</span>&nbsp;<span class="op" id="6931735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6931738">v</span>&nbsp;<span class="op" id="6931740">:=</span>&nbsp;<span class="ident" id="6931743">BugB</span><span class="op" id="6931747">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6931751">BugA</span><span class="op" id="6931755">{</span><span class="string" id="6931756">&#34;A&#34;</span><span class="op" id="6931759">}</span><span class="op" id="6931760">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6931764">&#34;B&#34;</span><span class="op" id="6931767">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6931770">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6931773">b</span><span class="op" id="6931774">,</span>&nbsp;<span class="ident" id="6931776">err</span>&nbsp;<span class="op" id="6931780">:=</span>&nbsp;<span class="ident" id="6931783">Marshal</span><span class="op" id="6931790">(</span><span class="ident" id="6931791">v</span><span class="op" id="6931792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6931795">if</span>&nbsp;<span class="ident" id="6931798">err</span>&nbsp;<span class="op" id="6931802">!=</span>&nbsp;<span class="builtintype" id="6931805">nil</span>&nbsp;<span class="op" id="6931809">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6931813">t</span><span class="op" id="6931814">.</span><span class="ident" id="6931815">Fatal</span><span class="op" id="6931820">(</span><span class="string" id="6931821">&#34;Marshal:&#34;</span><span class="op" id="6931831">,</span>&nbsp;<span class="ident" id="6931833">err</span><span class="op" id="6931836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6931839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6931842">want</span>&nbsp;<span class="op" id="6931847">:=</span>&nbsp;<span class="string" id="6931850">`{&#34;S&#34;:&#34;B&#34;}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6931863">got</span>&nbsp;<span class="op" id="6931867">:=</span>&nbsp;<span class="builtintype" id="6931870">string</span><span class="op" id="6931876">(</span><span class="ident" id="6931877">b</span><span class="op" id="6931878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6931881">if</span>&nbsp;<span class="ident" id="6931884">got</span>&nbsp;<span class="op" id="6931888">!=</span>&nbsp;<span class="ident" id="6931891">want</span>&nbsp;<span class="op" id="6931896">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6931900">t</span><span class="op" id="6931901">.</span><span class="ident" id="6931902">Fatalf</span><span class="op" id="6931908">(</span><span class="string" id="6931909">&#34;Marshal:&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="6931934">,</span>&nbsp;<span class="ident" id="6931936">got</span><span class="op" id="6931939">,</span>&nbsp;<span class="ident" id="6931941">want</span><span class="op" id="6931945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6931948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6931951">//&nbsp;Now&nbsp;check&nbsp;that&nbsp;the&nbsp;duplicate&nbsp;field,&nbsp;S,&nbsp;does&nbsp;not&nbsp;appear.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6932011">x</span>&nbsp;<span class="op" id="6932013">:=</span>&nbsp;<span class="ident" id="6932016">BugX</span><span class="op" id="6932020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6932024">A</span><span class="op" id="6932025">:</span>&nbsp;<span class="num" id="6932027">23</span><span class="op" id="6932029">,</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6932032">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6932035">b</span><span class="op" id="6932036">,</span>&nbsp;<span class="ident" id="6932038">err</span>&nbsp;<span class="op" id="6932042">=</span>&nbsp;<span class="ident" id="6932044">Marshal</span><span class="op" id="6932051">(</span><span class="ident" id="6932052">x</span><span class="op" id="6932053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6932056">if</span>&nbsp;<span class="ident" id="6932059">err</span>&nbsp;<span class="op" id="6932063">!=</span>&nbsp;<span class="builtintype" id="6932066">nil</span>&nbsp;<span class="op" id="6932070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6932074">t</span><span class="op" id="6932075">.</span><span class="ident" id="6932076">Fatal</span><span class="op" id="6932081">(</span><span class="string" id="6932082">&#34;Marshal:&#34;</span><span class="op" id="6932092">,</span>&nbsp;<span class="ident" id="6932094">err</span><span class="op" id="6932097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6932100">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6932103">want</span>&nbsp;<span class="op" id="6932108">=</span>&nbsp;<span class="string" id="6932110">`{&#34;A&#34;:23}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6932122">got</span>&nbsp;<span class="op" id="6932126">=</span>&nbsp;<span class="builtintype" id="6932128">string</span><span class="op" id="6932134">(</span><span class="ident" id="6932135">b</span><span class="op" id="6932136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6932139">if</span>&nbsp;<span class="ident" id="6932142">got</span>&nbsp;<span class="op" id="6932146">!=</span>&nbsp;<span class="ident" id="6932149">want</span>&nbsp;<span class="op" id="6932154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6932158">t</span><span class="op" id="6932159">.</span><span class="ident" id="6932160">Fatalf</span><span class="op" id="6932166">(</span><span class="string" id="6932167">&#34;Marshal:&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="6932192">,</span>&nbsp;<span class="ident" id="6932194">got</span><span class="op" id="6932197">,</span>&nbsp;<span class="ident" id="6932199">want</span><span class="op" id="6932203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6932206">}</span><br>
<span class="lineno">320</span><span class="op" id="6932208">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6932211">type</span>&nbsp;<span class="ident" id="6932216">BugD</span>&nbsp;<span class="keyword" id="6932221">struct</span>&nbsp;<span class="op" id="6932228">{</span>&nbsp;<span class="comment" id="6932230">//&nbsp;Same&nbsp;as&nbsp;BugA&nbsp;after&nbsp;tagging.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6932262">XXX</span>&nbsp;<span class="builtintype" id="6932266">string</span>&nbsp;<span class="string" id="6932273">`json:&#34;S&#34;`</span><br>
<span class="lineno"></span><span class="op" id="6932284">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="comment" id="6932287">//&nbsp;BugD&#39;s&nbsp;tagged&nbsp;S&nbsp;field&nbsp;should&nbsp;dominate&nbsp;BugA&#39;s.</span><br>
<span class="lineno"></span><span class="keyword" id="6932336">type</span>&nbsp;<span class="ident" id="6932341">BugY</span>&nbsp;<span class="keyword" id="6932346">struct</span>&nbsp;<span class="op" id="6932353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6932356">BugA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6932362">BugD</span><br>
<span class="lineno">330</span><span class="op" id="6932367">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6932370">//&nbsp;Test&nbsp;that&nbsp;a&nbsp;field&nbsp;with&nbsp;a&nbsp;tag&nbsp;dominates&nbsp;untagged&nbsp;fields.</span><br>
<span class="lineno"></span><span class="keyword" id="6932429">func</span>&nbsp;<span class="ident" id="6932434">TestTaggedFieldDominates</span><span class="op" id="6932458">(</span><span class="ident" id="6932459">t</span>&nbsp;<span class="op" id="6932461">*</span><span class="ident" id="6932462">testing</span><span class="op" id="6932469">.</span><span class="ident" id="6932470">T</span><span class="op" id="6932471">)</span>&nbsp;<span class="op" id="6932473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6932476">v</span>&nbsp;<span class="op" id="6932478">:=</span>&nbsp;<span class="ident" id="6932481">BugY</span><span class="op" id="6932485">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6932489">BugA</span><span class="op" id="6932493">{</span><span class="string" id="6932494">&#34;BugA&#34;</span><span class="op" id="6932500">}</span><span class="op" id="6932501">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6932505">BugD</span><span class="op" id="6932509">{</span><span class="string" id="6932510">&#34;BugD&#34;</span><span class="op" id="6932516">}</span><span class="op" id="6932517">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6932520">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6932523">b</span><span class="op" id="6932524">,</span>&nbsp;<span class="ident" id="6932526">err</span>&nbsp;<span class="op" id="6932530">:=</span>&nbsp;<span class="ident" id="6932533">Marshal</span><span class="op" id="6932540">(</span><span class="ident" id="6932541">v</span><span class="op" id="6932542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6932545">if</span>&nbsp;<span class="ident" id="6932548">err</span>&nbsp;<span class="op" id="6932552">!=</span>&nbsp;<span class="builtintype" id="6932555">nil</span>&nbsp;<span class="op" id="6932559">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6932563">t</span><span class="op" id="6932564">.</span><span class="ident" id="6932565">Fatal</span><span class="op" id="6932570">(</span><span class="string" id="6932571">&#34;Marshal:&#34;</span><span class="op" id="6932581">,</span>&nbsp;<span class="ident" id="6932583">err</span><span class="op" id="6932586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6932589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6932592">want</span>&nbsp;<span class="op" id="6932597">:=</span>&nbsp;<span class="string" id="6932600">`{&#34;S&#34;:&#34;BugD&#34;}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6932616">got</span>&nbsp;<span class="op" id="6932620">:=</span>&nbsp;<span class="builtintype" id="6932623">string</span><span class="op" id="6932629">(</span><span class="ident" id="6932630">b</span><span class="op" id="6932631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6932634">if</span>&nbsp;<span class="ident" id="6932637">got</span>&nbsp;<span class="op" id="6932641">!=</span>&nbsp;<span class="ident" id="6932644">want</span>&nbsp;<span class="op" id="6932649">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6932653">t</span><span class="op" id="6932654">.</span><span class="ident" id="6932655">Fatalf</span><span class="op" id="6932661">(</span><span class="string" id="6932662">&#34;Marshal:&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="6932687">,</span>&nbsp;<span class="ident" id="6932689">got</span><span class="op" id="6932692">,</span>&nbsp;<span class="ident" id="6932694">want</span><span class="op" id="6932698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6932701">}</span><br>
<span class="lineno"></span><span class="op" id="6932703">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6932706">//&nbsp;There&nbsp;are&nbsp;no&nbsp;tags&nbsp;here,&nbsp;so&nbsp;S&nbsp;should&nbsp;not&nbsp;appear.</span><br>
<span class="lineno">350</span><span class="keyword" id="6932757">type</span>&nbsp;<span class="ident" id="6932762">BugZ</span>&nbsp;<span class="keyword" id="6932767">struct</span>&nbsp;<span class="op" id="6932774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6932777">BugA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6932783">BugC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6932789">BugY</span>&nbsp;<span class="comment" id="6932794">//&nbsp;Contains&nbsp;a&nbsp;tagged&nbsp;S&nbsp;field&nbsp;through&nbsp;BugD;&nbsp;should&nbsp;not&nbsp;dominate.</span><br>
<span class="lineno"></span><span class="op" id="6932858">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span><span class="keyword" id="6932861">func</span>&nbsp;<span class="ident" id="6932866">TestDuplicatedFieldDisappears</span><span class="op" id="6932895">(</span><span class="ident" id="6932896">t</span>&nbsp;<span class="op" id="6932898">*</span><span class="ident" id="6932899">testing</span><span class="op" id="6932906">.</span><span class="ident" id="6932907">T</span><span class="op" id="6932908">)</span>&nbsp;<span class="op" id="6932910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6932913">v</span>&nbsp;<span class="op" id="6932915">:=</span>&nbsp;<span class="ident" id="6932918">BugZ</span><span class="op" id="6932922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6932926">BugA</span><span class="op" id="6932930">{</span><span class="string" id="6932931">&#34;BugA&#34;</span><span class="op" id="6932937">}</span><span class="op" id="6932938">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6932942">BugC</span><span class="op" id="6932946">{</span><span class="string" id="6932947">&#34;BugC&#34;</span><span class="op" id="6932953">}</span><span class="op" id="6932954">,</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6932958">BugY</span><span class="op" id="6932962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6932967">BugA</span><span class="op" id="6932971">{</span><span class="string" id="6932972">&#34;nested&nbsp;BugA&#34;</span><span class="op" id="6932985">}</span><span class="op" id="6932986">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6932991">BugD</span><span class="op" id="6932995">{</span><span class="string" id="6932996">&#34;nested&nbsp;BugD&#34;</span><span class="op" id="6933009">}</span><span class="op" id="6933010">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6933014">}</span><span class="op" id="6933015">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6933018">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6933021">b</span><span class="op" id="6933022">,</span>&nbsp;<span class="ident" id="6933024">err</span>&nbsp;<span class="op" id="6933028">:=</span>&nbsp;<span class="ident" id="6933031">Marshal</span><span class="op" id="6933038">(</span><span class="ident" id="6933039">v</span><span class="op" id="6933040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6933043">if</span>&nbsp;<span class="ident" id="6933046">err</span>&nbsp;<span class="op" id="6933050">!=</span>&nbsp;<span class="builtintype" id="6933053">nil</span>&nbsp;<span class="op" id="6933057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6933061">t</span><span class="op" id="6933062">.</span><span class="ident" id="6933063">Fatal</span><span class="op" id="6933068">(</span><span class="string" id="6933069">&#34;Marshal:&#34;</span><span class="op" id="6933079">,</span>&nbsp;<span class="ident" id="6933081">err</span><span class="op" id="6933084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6933087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6933090">want</span>&nbsp;<span class="op" id="6933095">:=</span>&nbsp;<span class="string" id="6933098">`{}`</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6933104">got</span>&nbsp;<span class="op" id="6933108">:=</span>&nbsp;<span class="builtintype" id="6933111">string</span><span class="op" id="6933117">(</span><span class="ident" id="6933118">b</span><span class="op" id="6933119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6933122">if</span>&nbsp;<span class="ident" id="6933125">got</span>&nbsp;<span class="op" id="6933129">!=</span>&nbsp;<span class="ident" id="6933132">want</span>&nbsp;<span class="op" id="6933137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6933141">t</span><span class="op" id="6933142">.</span><span class="ident" id="6933143">Fatalf</span><span class="op" id="6933149">(</span><span class="string" id="6933150">&#34;Marshal:&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="6933175">,</span>&nbsp;<span class="ident" id="6933177">got</span><span class="op" id="6933180">,</span>&nbsp;<span class="ident" id="6933182">want</span><span class="op" id="6933186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6933189">}</span><br>
<span class="lineno"></span><span class="op" id="6933191">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span><span class="keyword" id="6933194">func</span>&nbsp;<span class="ident" id="6933199">TestStringBytes</span><span class="op" id="6933214">(</span><span class="ident" id="6933215">t</span>&nbsp;<span class="op" id="6933217">*</span><span class="ident" id="6933218">testing</span><span class="op" id="6933225">.</span><span class="ident" id="6933226">T</span><span class="op" id="6933227">)</span>&nbsp;<span class="op" id="6933229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6933232">//&nbsp;Test&nbsp;that&nbsp;encodeState.stringBytes&nbsp;and&nbsp;encodeState.string&nbsp;use&nbsp;the&nbsp;same&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6933316">es</span>&nbsp;<span class="op" id="6933319">:=</span>&nbsp;<span class="op" id="6933322">&amp;</span><span class="ident" id="6933323">encodeState</span><span class="op" id="6933334">{</span><span class="op" id="6933335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6933338">var</span>&nbsp;<span class="ident" id="6933342">r</span>&nbsp;<span class="op" id="6933344">[</span><span class="op" id="6933345">]</span><span class="builtintype" id="6933346">rune</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6933352">for</span>&nbsp;<span class="ident" id="6933356">i</span>&nbsp;<span class="op" id="6933358">:=</span>&nbsp;<span class="string" id="6933361">&#39;\u0000&#39;</span><span class="op" id="6933369">;</span>&nbsp;<span class="ident" id="6933371">i</span>&nbsp;<span class="op" id="6933373">&lt;=</span>&nbsp;<span class="ident" id="6933376">unicode</span><span class="op" id="6933383">.</span><span class="ident" id="6933384">MaxRune</span><span class="op" id="6933391">;</span>&nbsp;<span class="ident" id="6933393">i</span><span class="op" id="6933394">++</span>&nbsp;<span class="op" id="6933397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6933401">r</span>&nbsp;<span class="op" id="6933403">=</span>&nbsp;<span class="builtinfunc" id="6933405">append</span><span class="op" id="6933411">(</span><span class="ident" id="6933412">r</span><span class="op" id="6933413">,</span>&nbsp;<span class="ident" id="6933415">i</span><span class="op" id="6933416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6933419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6933422">s</span>&nbsp;<span class="op" id="6933424">:=</span>&nbsp;<span class="builtintype" id="6933427">string</span><span class="op" id="6933433">(</span><span class="ident" id="6933434">r</span><span class="op" id="6933435">)</span>&nbsp;<span class="op" id="6933437">+</span>&nbsp;<span class="string" id="6933439">&#34;\xff\xff\xffhello&#34;</span>&nbsp;<span class="comment" id="6933459">//&nbsp;some&nbsp;invalid&nbsp;UTF-8&nbsp;too</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6933486">_</span><span class="op" id="6933487">,</span>&nbsp;<span class="ident" id="6933489">err</span>&nbsp;<span class="op" id="6933493">:=</span>&nbsp;<span class="ident" id="6933496">es</span><span class="op" id="6933498">.</span><span class="builtintype" id="6933499">string</span><span class="op" id="6933505">(</span><span class="ident" id="6933506">s</span><span class="op" id="6933507">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6933510">if</span>&nbsp;<span class="ident" id="6933513">err</span>&nbsp;<span class="op" id="6933517">!=</span>&nbsp;<span class="builtintype" id="6933520">nil</span>&nbsp;<span class="op" id="6933524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6933528">t</span><span class="op" id="6933529">.</span><span class="ident" id="6933530">Fatal</span><span class="op" id="6933535">(</span><span class="ident" id="6933536">err</span><span class="op" id="6933539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6933542">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6933546">esBytes</span>&nbsp;<span class="op" id="6933554">:=</span>&nbsp;<span class="op" id="6933557">&amp;</span><span class="ident" id="6933558">encodeState</span><span class="op" id="6933569">{</span><span class="op" id="6933570">}</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6933573">_</span><span class="op" id="6933574">,</span>&nbsp;<span class="ident" id="6933576">err</span>&nbsp;<span class="op" id="6933580">=</span>&nbsp;<span class="ident" id="6933582">esBytes</span><span class="op" id="6933589">.</span><span class="ident" id="6933590">stringBytes</span><span class="op" id="6933601">(</span><span class="op" id="6933602">[</span><span class="op" id="6933603">]</span><span class="builtintype" id="6933604">byte</span><span class="op" id="6933608">(</span><span class="ident" id="6933609">s</span><span class="op" id="6933610">)</span><span class="op" id="6933611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6933614">if</span>&nbsp;<span class="ident" id="6933617">err</span>&nbsp;<span class="op" id="6933621">!=</span>&nbsp;<span class="builtintype" id="6933624">nil</span>&nbsp;<span class="op" id="6933628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6933632">t</span><span class="op" id="6933633">.</span><span class="ident" id="6933634">Fatal</span><span class="op" id="6933639">(</span><span class="ident" id="6933640">err</span><span class="op" id="6933643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6933646">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6933650">enc</span>&nbsp;<span class="op" id="6933654">:=</span>&nbsp;<span class="ident" id="6933657">es</span><span class="op" id="6933659">.</span><span class="ident" id="6933660">Buffer</span><span class="op" id="6933666">.</span><span class="ident" id="6933667">String</span><span class="op" id="6933673">(</span><span class="op" id="6933674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6933677">encBytes</span>&nbsp;<span class="op" id="6933686">:=</span>&nbsp;<span class="ident" id="6933689">esBytes</span><span class="op" id="6933696">.</span><span class="ident" id="6933697">Buffer</span><span class="op" id="6933703">.</span><span class="ident" id="6933704">String</span><span class="op" id="6933710">(</span><span class="op" id="6933711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6933714">if</span>&nbsp;<span class="ident" id="6933717">enc</span>&nbsp;<span class="op" id="6933721">!=</span>&nbsp;<span class="ident" id="6933724">encBytes</span>&nbsp;<span class="op" id="6933733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6933737">i</span>&nbsp;<span class="op" id="6933739">:=</span>&nbsp;<span class="num" id="6933742">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6933746">for</span>&nbsp;<span class="ident" id="6933750">i</span>&nbsp;<span class="op" id="6933752">&lt;</span>&nbsp;<span class="builtinfunc" id="6933754">len</span><span class="op" id="6933757">(</span><span class="ident" id="6933758">enc</span><span class="op" id="6933761">)</span>&nbsp;<span class="op" id="6933763">&amp;&amp;</span>&nbsp;<span class="ident" id="6933766">i</span>&nbsp;<span class="op" id="6933768">&lt;</span>&nbsp;<span class="builtinfunc" id="6933770">len</span><span class="op" id="6933773">(</span><span class="ident" id="6933774">encBytes</span><span class="op" id="6933782">)</span>&nbsp;<span class="op" id="6933784">&amp;&amp;</span>&nbsp;<span class="ident" id="6933787">enc</span><span class="op" id="6933790">[</span><span class="ident" id="6933791">i</span><span class="op" id="6933792">]</span>&nbsp;<span class="op" id="6933794">==</span>&nbsp;<span class="ident" id="6933797">encBytes</span><span class="op" id="6933805">[</span><span class="ident" id="6933806">i</span><span class="op" id="6933807">]</span>&nbsp;<span class="op" id="6933809">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6933814">i</span><span class="op" id="6933815">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6933820">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6933824">enc</span>&nbsp;<span class="op" id="6933828">=</span>&nbsp;<span class="ident" id="6933830">enc</span><span class="op" id="6933833">[</span><span class="ident" id="6933834">i</span><span class="op" id="6933835">:</span><span class="op" id="6933836">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6933840">encBytes</span>&nbsp;<span class="op" id="6933849">=</span>&nbsp;<span class="ident" id="6933851">encBytes</span><span class="op" id="6933859">[</span><span class="ident" id="6933860">i</span><span class="op" id="6933861">:</span><span class="op" id="6933862">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6933866">i</span>&nbsp;<span class="op" id="6933868">=</span>&nbsp;<span class="num" id="6933870">0</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6933874">for</span>&nbsp;<span class="ident" id="6933878">i</span>&nbsp;<span class="op" id="6933880">&lt;</span>&nbsp;<span class="builtinfunc" id="6933882">len</span><span class="op" id="6933885">(</span><span class="ident" id="6933886">enc</span><span class="op" id="6933889">)</span>&nbsp;<span class="op" id="6933891">&amp;&amp;</span>&nbsp;<span class="ident" id="6933894">i</span>&nbsp;<span class="op" id="6933896">&lt;</span>&nbsp;<span class="builtinfunc" id="6933898">len</span><span class="op" id="6933901">(</span><span class="ident" id="6933902">encBytes</span><span class="op" id="6933910">)</span>&nbsp;<span class="op" id="6933912">&amp;&amp;</span>&nbsp;<span class="ident" id="6933915">enc</span><span class="op" id="6933918">[</span><span class="builtinfunc" id="6933919">len</span><span class="op" id="6933922">(</span><span class="ident" id="6933923">enc</span><span class="op" id="6933926">)</span><span class="op" id="6933927">-</span><span class="ident" id="6933928">i</span><span class="op" id="6933929">-</span><span class="num" id="6933930">1</span><span class="op" id="6933931">]</span>&nbsp;<span class="op" id="6933933">==</span>&nbsp;<span class="ident" id="6933936">encBytes</span><span class="op" id="6933944">[</span><span class="builtinfunc" id="6933945">len</span><span class="op" id="6933948">(</span><span class="ident" id="6933949">encBytes</span><span class="op" id="6933957">)</span><span class="op" id="6933958">-</span><span class="ident" id="6933959">i</span><span class="op" id="6933960">-</span><span class="num" id="6933961">1</span><span class="op" id="6933962">]</span>&nbsp;<span class="op" id="6933964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6933969">i</span><span class="op" id="6933970">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6933975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6933979">enc</span>&nbsp;<span class="op" id="6933983">=</span>&nbsp;<span class="ident" id="6933985">enc</span><span class="op" id="6933988">[</span><span class="op" id="6933989">:</span><span class="builtinfunc" id="6933990">len</span><span class="op" id="6933993">(</span><span class="ident" id="6933994">enc</span><span class="op" id="6933997">)</span><span class="op" id="6933998">-</span><span class="ident" id="6933999">i</span><span class="op" id="6934000">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6934004">encBytes</span>&nbsp;<span class="op" id="6934013">=</span>&nbsp;<span class="ident" id="6934015">encBytes</span><span class="op" id="6934023">[</span><span class="op" id="6934024">:</span><span class="builtinfunc" id="6934025">len</span><span class="op" id="6934028">(</span><span class="ident" id="6934029">encBytes</span><span class="op" id="6934037">)</span><span class="op" id="6934038">-</span><span class="ident" id="6934039">i</span><span class="op" id="6934040">]</span><br>
<span class="lineno">410</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6934045">if</span>&nbsp;<span class="builtinfunc" id="6934048">len</span><span class="op" id="6934051">(</span><span class="ident" id="6934052">enc</span><span class="op" id="6934055">)</span>&nbsp;<span class="op" id="6934057">&gt;</span>&nbsp;<span class="num" id="6934059">20</span>&nbsp;<span class="op" id="6934062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6934067">enc</span>&nbsp;<span class="op" id="6934071">=</span>&nbsp;<span class="ident" id="6934073">enc</span><span class="op" id="6934076">[</span><span class="op" id="6934077">:</span><span class="num" id="6934078">20</span><span class="op" id="6934080">]</span>&nbsp;<span class="op" id="6934082">+</span>&nbsp;<span class="string" id="6934084">&#34;...&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6934092">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6934096">if</span>&nbsp;<span class="builtinfunc" id="6934099">len</span><span class="op" id="6934102">(</span><span class="ident" id="6934103">encBytes</span><span class="op" id="6934111">)</span>&nbsp;<span class="op" id="6934113">&gt;</span>&nbsp;<span class="num" id="6934115">20</span>&nbsp;<span class="op" id="6934118">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6934123">encBytes</span>&nbsp;<span class="op" id="6934132">=</span>&nbsp;<span class="ident" id="6934134">encBytes</span><span class="op" id="6934142">[</span><span class="op" id="6934143">:</span><span class="num" id="6934144">20</span><span class="op" id="6934146">]</span>&nbsp;<span class="op" id="6934148">+</span>&nbsp;<span class="string" id="6934150">&#34;...&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6934158">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6934163">t</span><span class="op" id="6934164">.</span><span class="ident" id="6934165">Errorf</span><span class="op" id="6934171">(</span><span class="string" id="6934172">&#34;encodings&nbsp;differ&nbsp;at&nbsp;%#q&nbsp;vs&nbsp;%#q&#34;</span><span class="op" id="6934204">,</span>&nbsp;<span class="ident" id="6934206">enc</span><span class="op" id="6934209">,</span>&nbsp;<span class="ident" id="6934211">encBytes</span><span class="op" id="6934219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6934222">}</span><br>
<span class="lineno">420</span><span class="op" id="6934224">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6934227">func</span>&nbsp;<span class="ident" id="6934232">TestIssue6458</span><span class="op" id="6934245">(</span><span class="ident" id="6934246">t</span>&nbsp;<span class="op" id="6934248">*</span><span class="ident" id="6934249">testing</span><span class="op" id="6934256">.</span><span class="ident" id="6934257">T</span><span class="op" id="6934258">)</span>&nbsp;<span class="op" id="6934260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6934263">type</span>&nbsp;<span class="ident" id="6934268">Foo</span>&nbsp;<span class="keyword" id="6934272">struct</span>&nbsp;<span class="op" id="6934279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6934283">M</span>&nbsp;<span class="ident" id="6934285">RawMessage</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6934297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6934300">x</span>&nbsp;<span class="op" id="6934302">:=</span>&nbsp;<span class="ident" id="6934305">Foo</span><span class="op" id="6934308">{</span><span class="ident" id="6934309">RawMessage</span><span class="op" id="6934319">(</span><span class="string" id="6934320">`&#34;foo&#34;`</span><span class="op" id="6934327">)</span><span class="op" id="6934328">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6934332">b</span><span class="op" id="6934333">,</span>&nbsp;<span class="ident" id="6934335">err</span>&nbsp;<span class="op" id="6934339">:=</span>&nbsp;<span class="ident" id="6934342">Marshal</span><span class="op" id="6934349">(</span><span class="op" id="6934350">&amp;</span><span class="ident" id="6934351">x</span><span class="op" id="6934352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6934355">if</span>&nbsp;<span class="ident" id="6934358">err</span>&nbsp;<span class="op" id="6934362">!=</span>&nbsp;<span class="builtintype" id="6934365">nil</span>&nbsp;<span class="op" id="6934369">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6934373">t</span><span class="op" id="6934374">.</span><span class="ident" id="6934375">Fatal</span><span class="op" id="6934380">(</span><span class="ident" id="6934381">err</span><span class="op" id="6934384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6934387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6934390">if</span>&nbsp;<span class="ident" id="6934393">want</span>&nbsp;<span class="op" id="6934398">:=</span>&nbsp;<span class="string" id="6934401">`{&#34;M&#34;:&#34;foo&#34;}`</span><span class="op" id="6934414">;</span>&nbsp;<span class="builtintype" id="6934416">string</span><span class="op" id="6934422">(</span><span class="ident" id="6934423">b</span><span class="op" id="6934424">)</span>&nbsp;<span class="op" id="6934426">!=</span>&nbsp;<span class="ident" id="6934429">want</span>&nbsp;<span class="op" id="6934434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6934438">t</span><span class="op" id="6934439">.</span><span class="ident" id="6934440">Errorf</span><span class="op" id="6934446">(</span><span class="string" id="6934447">&#34;Marshal(&amp;x)&nbsp;=&nbsp;%#q;&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="6934476">,</span>&nbsp;<span class="ident" id="6934478">b</span><span class="op" id="6934479">,</span>&nbsp;<span class="ident" id="6934481">want</span><span class="op" id="6934485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6934488">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6934492">b</span><span class="op" id="6934493">,</span>&nbsp;<span class="ident" id="6934495">err</span>&nbsp;<span class="op" id="6934499">=</span>&nbsp;<span class="ident" id="6934501">Marshal</span><span class="op" id="6934508">(</span><span class="ident" id="6934509">x</span><span class="op" id="6934510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6934513">if</span>&nbsp;<span class="ident" id="6934516">err</span>&nbsp;<span class="op" id="6934520">!=</span>&nbsp;<span class="builtintype" id="6934523">nil</span>&nbsp;<span class="op" id="6934527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6934531">t</span><span class="op" id="6934532">.</span><span class="ident" id="6934533">Fatal</span><span class="op" id="6934538">(</span><span class="ident" id="6934539">err</span><span class="op" id="6934542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6934545">}</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6934549">if</span>&nbsp;<span class="ident" id="6934552">want</span>&nbsp;<span class="op" id="6934557">:=</span>&nbsp;<span class="string" id="6934560">`{&#34;M&#34;:&#34;ImZvbyI=&#34;}`</span><span class="op" id="6934578">;</span>&nbsp;<span class="builtintype" id="6934580">string</span><span class="op" id="6934586">(</span><span class="ident" id="6934587">b</span><span class="op" id="6934588">)</span>&nbsp;<span class="op" id="6934590">!=</span>&nbsp;<span class="ident" id="6934593">want</span>&nbsp;<span class="op" id="6934598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6934602">t</span><span class="op" id="6934603">.</span><span class="ident" id="6934604">Errorf</span><span class="op" id="6934610">(</span><span class="string" id="6934611">&#34;Marshal(x)&nbsp;=&nbsp;%#q;&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="6934639">,</span>&nbsp;<span class="ident" id="6934641">b</span><span class="op" id="6934642">,</span>&nbsp;<span class="ident" id="6934644">want</span><span class="op" id="6934648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6934651">}</span><br>
<span class="lineno"></span><span class="op" id="6934653">}</span><br>
<span class="lineno">445</span><br>
<span class="lineno"></span><span class="keyword" id="6934656">func</span>&nbsp;<span class="ident" id="6934661">TestHTMLEscape</span><span class="op" id="6934675">(</span><span class="ident" id="6934676">t</span>&nbsp;<span class="op" id="6934678">*</span><span class="ident" id="6934679">testing</span><span class="op" id="6934686">.</span><span class="ident" id="6934687">T</span><span class="op" id="6934688">)</span>&nbsp;<span class="op" id="6934690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6934693">var</span>&nbsp;<span class="ident" id="6934697">b</span><span class="op" id="6934698">,</span>&nbsp;<span class="ident" id="6934700">want</span>&nbsp;<span class="ident" id="6934705">bytes</span><span class="op" id="6934710">.</span><span class="ident" id="6934711">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6934719">m</span>&nbsp;<span class="op" id="6934721">:=</span>&nbsp;<span class="string" id="6934724">`{&#34;M&#34;:&#34;&lt;html&gt;foo&nbsp;&amp;`</span>&nbsp;<span class="op" id="6934744">+</span>&nbsp;<span class="string" id="6934746">&#34;\xe2\x80\xa8&nbsp;\xe2\x80\xa9&#34;</span>&nbsp;<span class="op" id="6934774">+</span>&nbsp;<span class="string" id="6934776">`&lt;/html&gt;&#34;}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6934789">want</span><span class="op" id="6934793">.</span><span class="ident" id="6934794">Write</span><span class="op" id="6934799">(</span><span class="op" id="6934800">[</span><span class="op" id="6934801">]</span><span class="builtintype" id="6934802">byte</span><span class="op" id="6934806">(</span><span class="string" id="6934807">`{&#34;M&#34;:&#34;\u003chtml\u003efoo&nbsp;\u0026\u2028&nbsp;\u2029\u003c/html\u003e&#34;}`</span><span class="op" id="6934873">)</span><span class="op" id="6934874">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6934877">HTMLEscape</span><span class="op" id="6934887">(</span><span class="op" id="6934888">&amp;</span><span class="ident" id="6934889">b</span><span class="op" id="6934890">,</span>&nbsp;<span class="op" id="6934892">[</span><span class="op" id="6934893">]</span><span class="builtintype" id="6934894">byte</span><span class="op" id="6934898">(</span><span class="ident" id="6934899">m</span><span class="op" id="6934900">)</span><span class="op" id="6934901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6934904">if</span>&nbsp;<span class="op" id="6934907">!</span><span class="ident" id="6934908">bytes</span><span class="op" id="6934913">.</span><span class="ident" id="6934914">Equal</span><span class="op" id="6934919">(</span><span class="ident" id="6934920">b</span><span class="op" id="6934921">.</span><span class="ident" id="6934922">Bytes</span><span class="op" id="6934927">(</span><span class="op" id="6934928">)</span><span class="op" id="6934929">,</span>&nbsp;<span class="ident" id="6934931">want</span><span class="op" id="6934935">.</span><span class="ident" id="6934936">Bytes</span><span class="op" id="6934941">(</span><span class="op" id="6934942">)</span><span class="op" id="6934943">)</span>&nbsp;<span class="op" id="6934945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6934949">t</span><span class="op" id="6934950">.</span><span class="ident" id="6934951">Errorf</span><span class="op" id="6934957">(</span><span class="string" id="6934958">&#34;HTMLEscape(&amp;b,&nbsp;[]byte(m))&nbsp;=&nbsp;%s;&nbsp;want&nbsp;%s&#34;</span><span class="op" id="6934999">,</span>&nbsp;<span class="ident" id="6935001">b</span><span class="op" id="6935002">.</span><span class="ident" id="6935003">Bytes</span><span class="op" id="6935008">(</span><span class="op" id="6935009">)</span><span class="op" id="6935010">,</span>&nbsp;<span class="ident" id="6935012">want</span><span class="op" id="6935016">.</span><span class="ident" id="6935017">Bytes</span><span class="op" id="6935022">(</span><span class="op" id="6935023">)</span><span class="op" id="6935024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6935027">}</span><br>
<span class="lineno"></span><span class="op" id="6935029">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="comment" id="6935032">//&nbsp;golang.org/issue/8582</span><br>
<span class="lineno"></span><span class="keyword" id="6935057">func</span>&nbsp;<span class="ident" id="6935062">TestEncodePointerString</span><span class="op" id="6935085">(</span><span class="ident" id="6935086">t</span>&nbsp;<span class="op" id="6935088">*</span><span class="ident" id="6935089">testing</span><span class="op" id="6935096">.</span><span class="ident" id="6935097">T</span><span class="op" id="6935098">)</span>&nbsp;<span class="op" id="6935100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6935103">type</span>&nbsp;<span class="ident" id="6935108">stringPointer</span>&nbsp;<span class="keyword" id="6935122">struct</span>&nbsp;<span class="op" id="6935129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6935133">N</span>&nbsp;<span class="op" id="6935135">*</span><span class="ident" id="6935136">int64</span>&nbsp;<span class="string" id="6935142">`json:&#34;n,string&#34;`</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6935161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6935164">var</span>&nbsp;<span class="ident" id="6935168">n</span>&nbsp;<span class="ident" id="6935170">int64</span>&nbsp;<span class="op" id="6935176">=</span>&nbsp;<span class="num" id="6935178">42</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6935182">b</span><span class="op" id="6935183">,</span>&nbsp;<span class="ident" id="6935185">err</span>&nbsp;<span class="op" id="6935189">:=</span>&nbsp;<span class="ident" id="6935192">Marshal</span><span class="op" id="6935199">(</span><span class="ident" id="6935200">stringPointer</span><span class="op" id="6935213">{</span><span class="ident" id="6935214">N</span><span class="op" id="6935215">:</span>&nbsp;<span class="op" id="6935217">&amp;</span><span class="ident" id="6935218">n</span><span class="op" id="6935219">}</span><span class="op" id="6935220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6935223">if</span>&nbsp;<span class="ident" id="6935226">err</span>&nbsp;<span class="op" id="6935230">!=</span>&nbsp;<span class="builtintype" id="6935233">nil</span>&nbsp;<span class="op" id="6935237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6935241">t</span><span class="op" id="6935242">.</span><span class="ident" id="6935243">Fatalf</span><span class="op" id="6935249">(</span><span class="string" id="6935250">&#34;Marshal:&nbsp;%v&#34;</span><span class="op" id="6935263">,</span>&nbsp;<span class="ident" id="6935265">err</span><span class="op" id="6935268">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6935271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6935274">if</span>&nbsp;<span class="ident" id="6935277">got</span><span class="op" id="6935280">,</span>&nbsp;<span class="ident" id="6935282">want</span>&nbsp;<span class="op" id="6935287">:=</span>&nbsp;<span class="builtintype" id="6935290">string</span><span class="op" id="6935296">(</span><span class="ident" id="6935297">b</span><span class="op" id="6935298">)</span><span class="op" id="6935299">,</span>&nbsp;<span class="string" id="6935301">`{&#34;n&#34;:&#34;42&#34;}`</span><span class="op" id="6935313">;</span>&nbsp;<span class="ident" id="6935315">got</span>&nbsp;<span class="op" id="6935319">!=</span>&nbsp;<span class="ident" id="6935322">want</span>&nbsp;<span class="op" id="6935327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6935331">t</span><span class="op" id="6935332">.</span><span class="ident" id="6935333">Errorf</span><span class="op" id="6935339">(</span><span class="string" id="6935340">&#34;Marshal&nbsp;=&nbsp;%s,&nbsp;want&nbsp;%s&#34;</span><span class="op" id="6935363">,</span>&nbsp;<span class="ident" id="6935365">got</span><span class="op" id="6935368">,</span>&nbsp;<span class="ident" id="6935370">want</span><span class="op" id="6935374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6935377">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6935380">var</span>&nbsp;<span class="ident" id="6935384">back</span>&nbsp;<span class="ident" id="6935389">stringPointer</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6935404">err</span>&nbsp;<span class="op" id="6935408">=</span>&nbsp;<span class="ident" id="6935410">Unmarshal</span><span class="op" id="6935419">(</span><span class="ident" id="6935420">b</span><span class="op" id="6935421">,</span>&nbsp;<span class="op" id="6935423">&amp;</span><span class="ident" id="6935424">back</span><span class="op" id="6935428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6935431">if</span>&nbsp;<span class="ident" id="6935434">err</span>&nbsp;<span class="op" id="6935438">!=</span>&nbsp;<span class="builtintype" id="6935441">nil</span>&nbsp;<span class="op" id="6935445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6935449">t</span><span class="op" id="6935450">.</span><span class="ident" id="6935451">Fatalf</span><span class="op" id="6935457">(</span><span class="string" id="6935458">&#34;Unmarshal:&nbsp;%v&#34;</span><span class="op" id="6935473">,</span>&nbsp;<span class="ident" id="6935475">err</span><span class="op" id="6935478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6935481">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6935484">if</span>&nbsp;<span class="ident" id="6935487">back</span><span class="op" id="6935491">.</span><span class="ident" id="6935492">N</span>&nbsp;<span class="op" id="6935494">==</span>&nbsp;<span class="builtintype" id="6935497">nil</span>&nbsp;<span class="op" id="6935501">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6935505">t</span><span class="op" id="6935506">.</span><span class="ident" id="6935507">Fatalf</span><span class="op" id="6935513">(</span><span class="string" id="6935514">&#34;Unmarshalled&nbsp;nil&nbsp;N&nbsp;field&#34;</span><span class="op" id="6935540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6935543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6935546">if</span>&nbsp;<span class="op" id="6935549">*</span><span class="ident" id="6935550">back</span><span class="op" id="6935554">.</span><span class="ident" id="6935555">N</span>&nbsp;<span class="op" id="6935557">!=</span>&nbsp;<span class="num" id="6935560">42</span>&nbsp;<span class="op" id="6935563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6935567">t</span><span class="op" id="6935568">.</span><span class="ident" id="6935569">Fatalf</span><span class="op" id="6935575">(</span><span class="string" id="6935576">&#34;*N&nbsp;=&nbsp;%d;&nbsp;want&nbsp;42&#34;</span><span class="op" id="6935594">,</span>&nbsp;<span class="op" id="6935596">*</span><span class="ident" id="6935597">back</span><span class="op" id="6935601">.</span><span class="ident" id="6935602">N</span><span class="op" id="6935603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6935606">}</span><br>
<span class="lineno">480</span><span class="op" id="6935608">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6935611">var</span>&nbsp;<span class="ident" id="6935615">encodeStringTests</span>&nbsp;<span class="op" id="6935633">=</span>&nbsp;<span class="op" id="6935635">[</span><span class="op" id="6935636">]</span><span class="keyword" id="6935637">struct</span>&nbsp;<span class="op" id="6935644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6935647">in</span>&nbsp;&nbsp;<span class="builtintype" id="6935651">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6935659">out</span>&nbsp;<span class="builtintype" id="6935663">string</span><br>
<span class="lineno">485</span><span class="op" id="6935670">}</span><span class="op" id="6935671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6935674">{</span><span class="string" id="6935675">&#34;\x00&#34;</span><span class="op" id="6935681">,</span>&nbsp;<span class="string" id="6935683">`&#34;\u0000&#34;`</span><span class="op" id="6935693">}</span><span class="op" id="6935694">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6935697">{</span><span class="string" id="6935698">&#34;\x01&#34;</span><span class="op" id="6935704">,</span>&nbsp;<span class="string" id="6935706">`&#34;\u0001&#34;`</span><span class="op" id="6935716">}</span><span class="op" id="6935717">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6935720">{</span><span class="string" id="6935721">&#34;\x02&#34;</span><span class="op" id="6935727">,</span>&nbsp;<span class="string" id="6935729">`&#34;\u0002&#34;`</span><span class="op" id="6935739">}</span><span class="op" id="6935740">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6935743">{</span><span class="string" id="6935744">&#34;\x03&#34;</span><span class="op" id="6935750">,</span>&nbsp;<span class="string" id="6935752">`&#34;\u0003&#34;`</span><span class="op" id="6935762">}</span><span class="op" id="6935763">,</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6935766">{</span><span class="string" id="6935767">&#34;\x04&#34;</span><span class="op" id="6935773">,</span>&nbsp;<span class="string" id="6935775">`&#34;\u0004&#34;`</span><span class="op" id="6935785">}</span><span class="op" id="6935786">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6935789">{</span><span class="string" id="6935790">&#34;\x05&#34;</span><span class="op" id="6935796">,</span>&nbsp;<span class="string" id="6935798">`&#34;\u0005&#34;`</span><span class="op" id="6935808">}</span><span class="op" id="6935809">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6935812">{</span><span class="string" id="6935813">&#34;\x06&#34;</span><span class="op" id="6935819">,</span>&nbsp;<span class="string" id="6935821">`&#34;\u0006&#34;`</span><span class="op" id="6935831">}</span><span class="op" id="6935832">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6935835">{</span><span class="string" id="6935836">&#34;\x07&#34;</span><span class="op" id="6935842">,</span>&nbsp;<span class="string" id="6935844">`&#34;\u0007&#34;`</span><span class="op" id="6935854">}</span><span class="op" id="6935855">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6935858">{</span><span class="string" id="6935859">&#34;\x08&#34;</span><span class="op" id="6935865">,</span>&nbsp;<span class="string" id="6935867">`&#34;\u0008&#34;`</span><span class="op" id="6935877">}</span><span class="op" id="6935878">,</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6935881">{</span><span class="string" id="6935882">&#34;\x09&#34;</span><span class="op" id="6935888">,</span>&nbsp;<span class="string" id="6935890">`&#34;\t&#34;`</span><span class="op" id="6935896">}</span><span class="op" id="6935897">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6935900">{</span><span class="string" id="6935901">&#34;\x0a&#34;</span><span class="op" id="6935907">,</span>&nbsp;<span class="string" id="6935909">`&#34;\n&#34;`</span><span class="op" id="6935915">}</span><span class="op" id="6935916">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6935919">{</span><span class="string" id="6935920">&#34;\x0b&#34;</span><span class="op" id="6935926">,</span>&nbsp;<span class="string" id="6935928">`&#34;\u000b&#34;`</span><span class="op" id="6935938">}</span><span class="op" id="6935939">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6935942">{</span><span class="string" id="6935943">&#34;\x0c&#34;</span><span class="op" id="6935949">,</span>&nbsp;<span class="string" id="6935951">`&#34;\u000c&#34;`</span><span class="op" id="6935961">}</span><span class="op" id="6935962">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6935965">{</span><span class="string" id="6935966">&#34;\x0d&#34;</span><span class="op" id="6935972">,</span>&nbsp;<span class="string" id="6935974">`&#34;\r&#34;`</span><span class="op" id="6935980">}</span><span class="op" id="6935981">,</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6935984">{</span><span class="string" id="6935985">&#34;\x0e&#34;</span><span class="op" id="6935991">,</span>&nbsp;<span class="string" id="6935993">`&#34;\u000e&#34;`</span><span class="op" id="6936003">}</span><span class="op" id="6936004">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6936007">{</span><span class="string" id="6936008">&#34;\x0f&#34;</span><span class="op" id="6936014">,</span>&nbsp;<span class="string" id="6936016">`&#34;\u000f&#34;`</span><span class="op" id="6936026">}</span><span class="op" id="6936027">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6936030">{</span><span class="string" id="6936031">&#34;\x10&#34;</span><span class="op" id="6936037">,</span>&nbsp;<span class="string" id="6936039">`&#34;\u0010&#34;`</span><span class="op" id="6936049">}</span><span class="op" id="6936050">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6936053">{</span><span class="string" id="6936054">&#34;\x11&#34;</span><span class="op" id="6936060">,</span>&nbsp;<span class="string" id="6936062">`&#34;\u0011&#34;`</span><span class="op" id="6936072">}</span><span class="op" id="6936073">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6936076">{</span><span class="string" id="6936077">&#34;\x12&#34;</span><span class="op" id="6936083">,</span>&nbsp;<span class="string" id="6936085">`&#34;\u0012&#34;`</span><span class="op" id="6936095">}</span><span class="op" id="6936096">,</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6936099">{</span><span class="string" id="6936100">&#34;\x13&#34;</span><span class="op" id="6936106">,</span>&nbsp;<span class="string" id="6936108">`&#34;\u0013&#34;`</span><span class="op" id="6936118">}</span><span class="op" id="6936119">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6936122">{</span><span class="string" id="6936123">&#34;\x14&#34;</span><span class="op" id="6936129">,</span>&nbsp;<span class="string" id="6936131">`&#34;\u0014&#34;`</span><span class="op" id="6936141">}</span><span class="op" id="6936142">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6936145">{</span><span class="string" id="6936146">&#34;\x15&#34;</span><span class="op" id="6936152">,</span>&nbsp;<span class="string" id="6936154">`&#34;\u0015&#34;`</span><span class="op" id="6936164">}</span><span class="op" id="6936165">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6936168">{</span><span class="string" id="6936169">&#34;\x16&#34;</span><span class="op" id="6936175">,</span>&nbsp;<span class="string" id="6936177">`&#34;\u0016&#34;`</span><span class="op" id="6936187">}</span><span class="op" id="6936188">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6936191">{</span><span class="string" id="6936192">&#34;\x17&#34;</span><span class="op" id="6936198">,</span>&nbsp;<span class="string" id="6936200">`&#34;\u0017&#34;`</span><span class="op" id="6936210">}</span><span class="op" id="6936211">,</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6936214">{</span><span class="string" id="6936215">&#34;\x18&#34;</span><span class="op" id="6936221">,</span>&nbsp;<span class="string" id="6936223">`&#34;\u0018&#34;`</span><span class="op" id="6936233">}</span><span class="op" id="6936234">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6936237">{</span><span class="string" id="6936238">&#34;\x19&#34;</span><span class="op" id="6936244">,</span>&nbsp;<span class="string" id="6936246">`&#34;\u0019&#34;`</span><span class="op" id="6936256">}</span><span class="op" id="6936257">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6936260">{</span><span class="string" id="6936261">&#34;\x1a&#34;</span><span class="op" id="6936267">,</span>&nbsp;<span class="string" id="6936269">`&#34;\u001a&#34;`</span><span class="op" id="6936279">}</span><span class="op" id="6936280">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6936283">{</span><span class="string" id="6936284">&#34;\x1b&#34;</span><span class="op" id="6936290">,</span>&nbsp;<span class="string" id="6936292">`&#34;\u001b&#34;`</span><span class="op" id="6936302">}</span><span class="op" id="6936303">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6936306">{</span><span class="string" id="6936307">&#34;\x1c&#34;</span><span class="op" id="6936313">,</span>&nbsp;<span class="string" id="6936315">`&#34;\u001c&#34;`</span><span class="op" id="6936325">}</span><span class="op" id="6936326">,</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6936329">{</span><span class="string" id="6936330">&#34;\x1d&#34;</span><span class="op" id="6936336">,</span>&nbsp;<span class="string" id="6936338">`&#34;\u001d&#34;`</span><span class="op" id="6936348">}</span><span class="op" id="6936349">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6936352">{</span><span class="string" id="6936353">&#34;\x1e&#34;</span><span class="op" id="6936359">,</span>&nbsp;<span class="string" id="6936361">`&#34;\u001e&#34;`</span><span class="op" id="6936371">}</span><span class="op" id="6936372">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6936375">{</span><span class="string" id="6936376">&#34;\x1f&#34;</span><span class="op" id="6936382">,</span>&nbsp;<span class="string" id="6936384">`&#34;\u001f&#34;`</span><span class="op" id="6936394">}</span><span class="op" id="6936395">,</span><br>
<span class="lineno"></span><span class="op" id="6936397">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">520</span><span class="keyword" id="6936400">func</span>&nbsp;<span class="ident" id="6936405">TestEncodeString</span><span class="op" id="6936421">(</span><span class="ident" id="6936422">t</span>&nbsp;<span class="op" id="6936424">*</span><span class="ident" id="6936425">testing</span><span class="op" id="6936432">.</span><span class="ident" id="6936433">T</span><span class="op" id="6936434">)</span>&nbsp;<span class="op" id="6936436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6936439">for</span>&nbsp;<span class="ident" id="6936443">_</span><span class="op" id="6936444">,</span>&nbsp;<span class="ident" id="6936446">tt</span>&nbsp;<span class="op" id="6936449">:=</span>&nbsp;<span class="keyword" id="6936452">range</span>&nbsp;<span class="ident" id="6936458">encodeStringTests</span>&nbsp;<span class="op" id="6936476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6936480">b</span><span class="op" id="6936481">,</span>&nbsp;<span class="ident" id="6936483">err</span>&nbsp;<span class="op" id="6936487">:=</span>&nbsp;<span class="ident" id="6936490">Marshal</span><span class="op" id="6936497">(</span><span class="ident" id="6936498">tt</span><span class="op" id="6936500">.</span><span class="ident" id="6936501">in</span><span class="op" id="6936503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6936507">if</span>&nbsp;<span class="ident" id="6936510">err</span>&nbsp;<span class="op" id="6936514">!=</span>&nbsp;<span class="builtintype" id="6936517">nil</span>&nbsp;<span class="op" id="6936521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6936526">t</span><span class="op" id="6936527">.</span><span class="ident" id="6936528">Errorf</span><span class="op" id="6936534">(</span><span class="string" id="6936535">&#34;Marshal(%q):&nbsp;%v&#34;</span><span class="op" id="6936552">,</span>&nbsp;<span class="ident" id="6936554">tt</span><span class="op" id="6936556">.</span><span class="ident" id="6936557">in</span><span class="op" id="6936559">,</span>&nbsp;<span class="ident" id="6936561">err</span><span class="op" id="6936564">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6936569">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6936580">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6936584">out</span>&nbsp;<span class="op" id="6936588">:=</span>&nbsp;<span class="builtintype" id="6936591">string</span><span class="op" id="6936597">(</span><span class="ident" id="6936598">b</span><span class="op" id="6936599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6936603">if</span>&nbsp;<span class="ident" id="6936606">out</span>&nbsp;<span class="op" id="6936610">!=</span>&nbsp;<span class="ident" id="6936613">tt</span><span class="op" id="6936615">.</span><span class="ident" id="6936616">out</span>&nbsp;<span class="op" id="6936620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6936625">t</span><span class="op" id="6936626">.</span><span class="ident" id="6936627">Errorf</span><span class="op" id="6936633">(</span><span class="string" id="6936634">&#34;Marshal(%q)&nbsp;=&nbsp;%#q,&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="6936663">,</span>&nbsp;<span class="ident" id="6936665">tt</span><span class="op" id="6936667">.</span><span class="ident" id="6936668">in</span><span class="op" id="6936670">,</span>&nbsp;<span class="ident" id="6936672">out</span><span class="op" id="6936675">,</span>&nbsp;<span class="ident" id="6936677">tt</span><span class="op" id="6936679">.</span><span class="ident" id="6936680">out</span><span class="op" id="6936683">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6936687">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6936690">}</span><br>
<span class="lineno"></span><span class="op" id="6936692">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
