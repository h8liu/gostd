<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/gif</h2>
<ul>
<li><a href="/gostd/image/gif/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/gif/reader_test.go.html" class="current">reader_test.go</a></li>
<li><a href="/gostd/image/gif/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/gif/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8449199">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8449254">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8449308">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8449359">package</span>&nbsp;<span class="ident" id="8449367">gif</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8449372">import</span>&nbsp;<span class="op" id="8449379">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8449382">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8449391">&#34;compress/lzw&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8449407">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8449416">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8449431">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8449442">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8449452">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="8449455">//&nbsp;header,&nbsp;palette&nbsp;and&nbsp;trailer&nbsp;are&nbsp;parts&nbsp;of&nbsp;a&nbsp;valid&nbsp;2x1&nbsp;GIF&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="8449522">const</span>&nbsp;<span class="op" id="8449528">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8449531">headerStr</span>&nbsp;<span class="op" id="8449541">=</span>&nbsp;<span class="string" id="8449543">&#34;GIF89a&#34;</span>&nbsp;<span class="op" id="8449552">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8449556">&#34;\x02\x00\x01\x00&#34;</span>&nbsp;<span class="op" id="8449575">+</span>&nbsp;<span class="comment" id="8449577">//&nbsp;width=2,&nbsp;height=1</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8449600">&#34;\x80\x00\x00&#34;</span>&nbsp;<span class="comment" id="8449615">//&nbsp;headerFields=(a&nbsp;color&nbsp;map&nbsp;of&nbsp;2&nbsp;pixels),&nbsp;backgroundIndex,&nbsp;aspect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8449683">paletteStr</span>&nbsp;<span class="op" id="8449694">=</span>&nbsp;<span class="string" id="8449696">&#34;\x10\x20\x30\x40\x50\x60&#34;</span>&nbsp;<span class="comment" id="8449723">//&nbsp;the&nbsp;color&nbsp;map,&nbsp;also&nbsp;known&nbsp;as&nbsp;a&nbsp;palette</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8449766">trailerStr</span>&nbsp;<span class="op" id="8449777">=</span>&nbsp;<span class="string" id="8449779">&#34;\x3b&#34;</span><br>
<span class="lineno"></span><span class="op" id="8449786">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="8449789">//&nbsp;lzwEncode&nbsp;returns&nbsp;an&nbsp;LZW&nbsp;encoding&nbsp;(with&nbsp;2-bit&nbsp;literals)&nbsp;of&nbsp;n&nbsp;zeroes.</span><br>
<span class="lineno"></span><span class="keyword" id="8449861">func</span>&nbsp;<span class="ident" id="8449866">lzwEncode</span><span class="op" id="8449875">(</span><span class="ident" id="8449876">n</span>&nbsp;<span class="builtintype" id="8449878">int</span><span class="op" id="8449881">)</span>&nbsp;<span class="op" id="8449883">[</span><span class="op" id="8449884">]</span><span class="builtintype" id="8449885">byte</span>&nbsp;<span class="op" id="8449890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8449893">b</span>&nbsp;<span class="op" id="8449895">:=</span>&nbsp;<span class="op" id="8449898">&amp;</span><span class="ident" id="8449899">bytes</span><span class="op" id="8449904">.</span><span class="ident" id="8449905">Buffer</span><span class="op" id="8449911">{</span><span class="op" id="8449912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8449915">w</span>&nbsp;<span class="op" id="8449917">:=</span>&nbsp;<span class="ident" id="8449920">lzw</span><span class="op" id="8449923">.</span><span class="ident" id="8449924">NewWriter</span><span class="op" id="8449933">(</span><span class="ident" id="8449934">b</span><span class="op" id="8449935">,</span>&nbsp;<span class="ident" id="8449937">lzw</span><span class="op" id="8449940">.</span><span class="ident" id="8449941">LSB</span><span class="op" id="8449944">,</span>&nbsp;<span class="num" id="8449946">2</span><span class="op" id="8449947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8449950">w</span><span class="op" id="8449951">.</span><span class="ident" id="8449952">Write</span><span class="op" id="8449957">(</span><span class="builtinfunc" id="8449958">make</span><span class="op" id="8449962">(</span><span class="op" id="8449963">[</span><span class="op" id="8449964">]</span><span class="builtintype" id="8449965">byte</span><span class="op" id="8449969">,</span>&nbsp;<span class="ident" id="8449971">n</span><span class="op" id="8449972">)</span><span class="op" id="8449973">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8449976">w</span><span class="op" id="8449977">.</span><span class="ident" id="8449978">Close</span><span class="op" id="8449983">(</span><span class="op" id="8449984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8449987">return</span>&nbsp;<span class="ident" id="8449994">b</span><span class="op" id="8449995">.</span><span class="ident" id="8449996">Bytes</span><span class="op" id="8450001">(</span><span class="op" id="8450002">)</span><br>
<span class="lineno"></span><span class="op" id="8450004">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8450007">func</span>&nbsp;<span class="ident" id="8450012">TestDecode</span><span class="op" id="8450022">(</span><span class="ident" id="8450023">t</span>&nbsp;<span class="op" id="8450025">*</span><span class="ident" id="8450026">testing</span><span class="op" id="8450033">.</span><span class="ident" id="8450034">T</span><span class="op" id="8450035">)</span>&nbsp;<span class="op" id="8450037">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8450040">testCases</span>&nbsp;<span class="op" id="8450050">:=</span>&nbsp;<span class="op" id="8450053">[</span><span class="op" id="8450054">]</span><span class="keyword" id="8450055">struct</span>&nbsp;<span class="op" id="8450062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8450066">nPix</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8450074">int</span>&nbsp;&nbsp;<span class="comment" id="8450079">//&nbsp;The&nbsp;number&nbsp;of&nbsp;pixels&nbsp;in&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8450124">extra</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8450132">bool</span>&nbsp;<span class="comment" id="8450137">//&nbsp;Whether&nbsp;to&nbsp;write&nbsp;an&nbsp;extra&nbsp;block&nbsp;after&nbsp;the&nbsp;LZW-encoded&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8450202">wantErr</span>&nbsp;<span class="builtintype" id="8450210">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8450217">}</span><span class="op" id="8450218">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8450222">{</span><span class="num" id="8450223">0</span><span class="op" id="8450224">,</span>&nbsp;<span class="builtintype" id="8450226">false</span><span class="op" id="8450231">,</span>&nbsp;<span class="ident" id="8450233">errNotEnough</span><span class="op" id="8450245">}</span><span class="op" id="8450246">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8450250">{</span><span class="num" id="8450251">1</span><span class="op" id="8450252">,</span>&nbsp;<span class="builtintype" id="8450254">false</span><span class="op" id="8450259">,</span>&nbsp;<span class="ident" id="8450261">errNotEnough</span><span class="op" id="8450273">}</span><span class="op" id="8450274">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8450278">{</span><span class="num" id="8450279">2</span><span class="op" id="8450280">,</span>&nbsp;<span class="builtintype" id="8450282">false</span><span class="op" id="8450287">,</span>&nbsp;<span class="builtintype" id="8450289">nil</span><span class="op" id="8450292">}</span><span class="op" id="8450293">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8450297">{</span><span class="num" id="8450298">2</span><span class="op" id="8450299">,</span>&nbsp;<span class="builtintype" id="8450301">true</span><span class="op" id="8450305">,</span>&nbsp;<span class="ident" id="8450307">errTooMuch</span><span class="op" id="8450317">}</span><span class="op" id="8450318">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8450322">{</span><span class="num" id="8450323">3</span><span class="op" id="8450324">,</span>&nbsp;<span class="builtintype" id="8450326">false</span><span class="op" id="8450331">,</span>&nbsp;<span class="ident" id="8450333">errTooMuch</span><span class="op" id="8450343">}</span><span class="op" id="8450344">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8450347">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8450350">for</span>&nbsp;<span class="ident" id="8450354">_</span><span class="op" id="8450355">,</span>&nbsp;<span class="ident" id="8450357">tc</span>&nbsp;<span class="op" id="8450360">:=</span>&nbsp;<span class="keyword" id="8450363">range</span>&nbsp;<span class="ident" id="8450369">testCases</span>&nbsp;<span class="op" id="8450379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8450383">b</span>&nbsp;<span class="op" id="8450385">:=</span>&nbsp;<span class="op" id="8450388">&amp;</span><span class="ident" id="8450389">bytes</span><span class="op" id="8450394">.</span><span class="ident" id="8450395">Buffer</span><span class="op" id="8450401">{</span><span class="op" id="8450402">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8450406">b</span><span class="op" id="8450407">.</span><span class="ident" id="8450408">WriteString</span><span class="op" id="8450419">(</span><span class="ident" id="8450420">headerStr</span><span class="op" id="8450429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8450433">b</span><span class="op" id="8450434">.</span><span class="ident" id="8450435">WriteString</span><span class="op" id="8450446">(</span><span class="ident" id="8450447">paletteStr</span><span class="op" id="8450457">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8450461">//&nbsp;Write&nbsp;an&nbsp;image&nbsp;with&nbsp;bounds&nbsp;2x1&nbsp;but&nbsp;tc.nPix&nbsp;pixels.&nbsp;If&nbsp;tc.nPix&nbsp;!=&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8450533">//&nbsp;then&nbsp;this&nbsp;should&nbsp;result&nbsp;in&nbsp;an&nbsp;invalid&nbsp;GIF&nbsp;image.&nbsp;First,&nbsp;write&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8450602">//&nbsp;magic&nbsp;0x2c&nbsp;(image&nbsp;descriptor)&nbsp;byte,&nbsp;bounds=(0,0)-(2,1),&nbsp;a&nbsp;flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8450671">//&nbsp;byte,&nbsp;and&nbsp;2-bit&nbsp;LZW&nbsp;literals.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8450706">b</span><span class="op" id="8450707">.</span><span class="ident" id="8450708">WriteString</span><span class="op" id="8450719">(</span><span class="string" id="8450720">&#34;\x2c\x00\x00\x00\x00\x02\x00\x01\x00\x00\x02&#34;</span><span class="op" id="8450766">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8450770">if</span>&nbsp;<span class="ident" id="8450773">tc</span><span class="op" id="8450775">.</span><span class="ident" id="8450776">nPix</span>&nbsp;<span class="op" id="8450781">&gt;</span>&nbsp;<span class="num" id="8450783">0</span>&nbsp;<span class="op" id="8450785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8450790">enc</span>&nbsp;<span class="op" id="8450794">:=</span>&nbsp;<span class="ident" id="8450797">lzwEncode</span><span class="op" id="8450806">(</span><span class="ident" id="8450807">tc</span><span class="op" id="8450809">.</span><span class="ident" id="8450810">nPix</span><span class="op" id="8450814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8450819">if</span>&nbsp;<span class="builtinfunc" id="8450822">len</span><span class="op" id="8450825">(</span><span class="ident" id="8450826">enc</span><span class="op" id="8450829">)</span>&nbsp;<span class="op" id="8450831">&gt;</span>&nbsp;<span class="num" id="8450833">0xff</span>&nbsp;<span class="op" id="8450838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8450844">t</span><span class="op" id="8450845">.</span><span class="ident" id="8450846">Errorf</span><span class="op" id="8450852">(</span><span class="string" id="8450853">&#34;nPix=%d,&nbsp;extra=%t:&nbsp;compressed&nbsp;length&nbsp;%d&nbsp;is&nbsp;too&nbsp;large&#34;</span><span class="op" id="8450907">,</span>&nbsp;<span class="ident" id="8450909">tc</span><span class="op" id="8450911">.</span><span class="ident" id="8450912">nPix</span><span class="op" id="8450916">,</span>&nbsp;<span class="ident" id="8450918">tc</span><span class="op" id="8450920">.</span><span class="ident" id="8450921">extra</span><span class="op" id="8450926">,</span>&nbsp;<span class="builtinfunc" id="8450928">len</span><span class="op" id="8450931">(</span><span class="ident" id="8450932">enc</span><span class="op" id="8450935">)</span><span class="op" id="8450936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8450942">continue</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8450954">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8450959">b</span><span class="op" id="8450960">.</span><span class="ident" id="8450961">WriteByte</span><span class="op" id="8450970">(</span><span class="builtintype" id="8450971">byte</span><span class="op" id="8450975">(</span><span class="builtinfunc" id="8450976">len</span><span class="op" id="8450979">(</span><span class="ident" id="8450980">enc</span><span class="op" id="8450983">)</span><span class="op" id="8450984">)</span><span class="op" id="8450985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8450990">b</span><span class="op" id="8450991">.</span><span class="ident" id="8450992">Write</span><span class="op" id="8450997">(</span><span class="ident" id="8450998">enc</span><span class="op" id="8451001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8451005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8451009">if</span>&nbsp;<span class="ident" id="8451012">tc</span><span class="op" id="8451014">.</span><span class="ident" id="8451015">extra</span>&nbsp;<span class="op" id="8451021">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8451026">b</span><span class="op" id="8451027">.</span><span class="ident" id="8451028">WriteString</span><span class="op" id="8451039">(</span><span class="string" id="8451040">&#34;\x01\x02&#34;</span><span class="op" id="8451050">)</span>&nbsp;<span class="comment" id="8451052">//&nbsp;A&nbsp;1-byte&nbsp;payload&nbsp;with&nbsp;an&nbsp;0x02&nbsp;byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8451093">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8451097">b</span><span class="op" id="8451098">.</span><span class="ident" id="8451099">WriteByte</span><span class="op" id="8451108">(</span><span class="num" id="8451109">0x00</span><span class="op" id="8451113">)</span>&nbsp;<span class="comment" id="8451115">//&nbsp;An&nbsp;empty&nbsp;block&nbsp;signifies&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8451172">b</span><span class="op" id="8451173">.</span><span class="ident" id="8451174">WriteString</span><span class="op" id="8451185">(</span><span class="ident" id="8451186">trailerStr</span><span class="op" id="8451196">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8451201">got</span><span class="op" id="8451204">,</span>&nbsp;<span class="ident" id="8451206">err</span>&nbsp;<span class="op" id="8451210">:=</span>&nbsp;<span class="ident" id="8451213">Decode</span><span class="op" id="8451219">(</span><span class="ident" id="8451220">b</span><span class="op" id="8451221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8451225">if</span>&nbsp;<span class="ident" id="8451228">err</span>&nbsp;<span class="op" id="8451232">!=</span>&nbsp;<span class="ident" id="8451235">tc</span><span class="op" id="8451237">.</span><span class="ident" id="8451238">wantErr</span>&nbsp;<span class="op" id="8451246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8451251">t</span><span class="op" id="8451252">.</span><span class="ident" id="8451253">Errorf</span><span class="op" id="8451259">(</span><span class="string" id="8451260">&#34;nPix=%d,&nbsp;extra=%t\ngot&nbsp;&nbsp;%v\nwant&nbsp;%v&#34;</span><span class="op" id="8451297">,</span>&nbsp;<span class="ident" id="8451299">tc</span><span class="op" id="8451301">.</span><span class="ident" id="8451302">nPix</span><span class="op" id="8451306">,</span>&nbsp;<span class="ident" id="8451308">tc</span><span class="op" id="8451310">.</span><span class="ident" id="8451311">extra</span><span class="op" id="8451316">,</span>&nbsp;<span class="ident" id="8451318">err</span><span class="op" id="8451321">,</span>&nbsp;<span class="ident" id="8451323">tc</span><span class="op" id="8451325">.</span><span class="ident" id="8451326">wantErr</span><span class="op" id="8451333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8451337">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8451342">if</span>&nbsp;<span class="ident" id="8451345">tc</span><span class="op" id="8451347">.</span><span class="ident" id="8451348">wantErr</span>&nbsp;<span class="op" id="8451356">!=</span>&nbsp;<span class="builtintype" id="8451359">nil</span>&nbsp;<span class="op" id="8451363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8451368">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8451379">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8451383">want</span>&nbsp;<span class="op" id="8451388">:=</span>&nbsp;<span class="op" id="8451391">&amp;</span><span class="ident" id="8451392">image</span><span class="op" id="8451397">.</span><span class="ident" id="8451398">Paletted</span><span class="op" id="8451406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8451411">Pix</span><span class="op" id="8451414">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8451419">[</span><span class="op" id="8451420">]</span><span class="builtintype" id="8451421">uint8</span><span class="op" id="8451426">{</span><span class="num" id="8451427">0</span><span class="op" id="8451428">,</span>&nbsp;<span class="num" id="8451430">0</span><span class="op" id="8451431">}</span><span class="op" id="8451432">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8451437">Stride</span><span class="op" id="8451443">:</span>&nbsp;<span class="num" id="8451445">2</span><span class="op" id="8451446">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8451451">Rect</span><span class="op" id="8451455">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="8451459">image</span><span class="op" id="8451464">.</span><span class="ident" id="8451465">Rect</span><span class="op" id="8451469">(</span><span class="num" id="8451470">0</span><span class="op" id="8451471">,</span>&nbsp;<span class="num" id="8451473">0</span><span class="op" id="8451474">,</span>&nbsp;<span class="num" id="8451476">2</span><span class="op" id="8451477">,</span>&nbsp;<span class="num" id="8451479">1</span><span class="op" id="8451480">)</span><span class="op" id="8451481">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8451486">Palette</span><span class="op" id="8451493">:</span>&nbsp;<span class="ident" id="8451495">color</span><span class="op" id="8451500">.</span><span class="ident" id="8451501">Palette</span><span class="op" id="8451508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8451514">color</span><span class="op" id="8451519">.</span><span class="ident" id="8451520">RGBA</span><span class="op" id="8451524">{</span><span class="num" id="8451525">0x10</span><span class="op" id="8451529">,</span>&nbsp;<span class="num" id="8451531">0x20</span><span class="op" id="8451535">,</span>&nbsp;<span class="num" id="8451537">0x30</span><span class="op" id="8451541">,</span>&nbsp;<span class="num" id="8451543">0xff</span><span class="op" id="8451547">}</span><span class="op" id="8451548">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8451554">color</span><span class="op" id="8451559">.</span><span class="ident" id="8451560">RGBA</span><span class="op" id="8451564">{</span><span class="num" id="8451565">0x40</span><span class="op" id="8451569">,</span>&nbsp;<span class="num" id="8451571">0x50</span><span class="op" id="8451575">,</span>&nbsp;<span class="num" id="8451577">0x60</span><span class="op" id="8451581">,</span>&nbsp;<span class="num" id="8451583">0xff</span><span class="op" id="8451587">}</span><span class="op" id="8451588">,</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8451593">}</span><span class="op" id="8451594">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8451598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8451602">if</span>&nbsp;<span class="op" id="8451605">!</span><span class="ident" id="8451606">reflect</span><span class="op" id="8451613">.</span><span class="ident" id="8451614">DeepEqual</span><span class="op" id="8451623">(</span><span class="ident" id="8451624">got</span><span class="op" id="8451627">,</span>&nbsp;<span class="ident" id="8451629">want</span><span class="op" id="8451633">)</span>&nbsp;<span class="op" id="8451635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8451640">t</span><span class="op" id="8451641">.</span><span class="ident" id="8451642">Errorf</span><span class="op" id="8451648">(</span><span class="string" id="8451649">&#34;nPix=%d,&nbsp;extra=%t\ngot&nbsp;&nbsp;%v\nwant&nbsp;%v&#34;</span><span class="op" id="8451686">,</span>&nbsp;<span class="ident" id="8451688">tc</span><span class="op" id="8451690">.</span><span class="ident" id="8451691">nPix</span><span class="op" id="8451695">,</span>&nbsp;<span class="ident" id="8451697">tc</span><span class="op" id="8451699">.</span><span class="ident" id="8451700">extra</span><span class="op" id="8451705">,</span>&nbsp;<span class="ident" id="8451707">got</span><span class="op" id="8451710">,</span>&nbsp;<span class="ident" id="8451712">want</span><span class="op" id="8451716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8451720">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8451723">}</span><br>
<span class="lineno"></span><span class="op" id="8451725">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8451728">func</span>&nbsp;<span class="ident" id="8451733">TestTransparentIndex</span><span class="op" id="8451753">(</span><span class="ident" id="8451754">t</span>&nbsp;<span class="op" id="8451756">*</span><span class="ident" id="8451757">testing</span><span class="op" id="8451764">.</span><span class="ident" id="8451765">T</span><span class="op" id="8451766">)</span>&nbsp;<span class="op" id="8451768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8451771">b</span>&nbsp;<span class="op" id="8451773">:=</span>&nbsp;<span class="op" id="8451776">&amp;</span><span class="ident" id="8451777">bytes</span><span class="op" id="8451782">.</span><span class="ident" id="8451783">Buffer</span><span class="op" id="8451789">{</span><span class="op" id="8451790">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8451793">b</span><span class="op" id="8451794">.</span><span class="ident" id="8451795">WriteString</span><span class="op" id="8451806">(</span><span class="ident" id="8451807">headerStr</span><span class="op" id="8451816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8451819">b</span><span class="op" id="8451820">.</span><span class="ident" id="8451821">WriteString</span><span class="op" id="8451832">(</span><span class="ident" id="8451833">paletteStr</span><span class="op" id="8451843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8451846">for</span>&nbsp;<span class="ident" id="8451850">transparentIndex</span>&nbsp;<span class="op" id="8451867">:=</span>&nbsp;<span class="num" id="8451870">0</span><span class="op" id="8451871">;</span>&nbsp;<span class="ident" id="8451873">transparentIndex</span>&nbsp;<span class="op" id="8451890">&lt;</span>&nbsp;<span class="num" id="8451892">3</span><span class="op" id="8451893">;</span>&nbsp;<span class="ident" id="8451895">transparentIndex</span><span class="op" id="8451911">++</span>&nbsp;<span class="op" id="8451914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8451918">if</span>&nbsp;<span class="ident" id="8451921">transparentIndex</span>&nbsp;<span class="op" id="8451938">&lt;</span>&nbsp;<span class="num" id="8451940">2</span>&nbsp;<span class="op" id="8451942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8451947">//&nbsp;Write&nbsp;the&nbsp;graphic&nbsp;control&nbsp;for&nbsp;the&nbsp;transparent&nbsp;index.</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8452006">b</span><span class="op" id="8452007">.</span><span class="ident" id="8452008">WriteString</span><span class="op" id="8452019">(</span><span class="string" id="8452020">&#34;\x21\xf9\x00\x01\x00\x00&#34;</span><span class="op" id="8452046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8452051">b</span><span class="op" id="8452052">.</span><span class="ident" id="8452053">WriteByte</span><span class="op" id="8452062">(</span><span class="builtintype" id="8452063">byte</span><span class="op" id="8452067">(</span><span class="ident" id="8452068">transparentIndex</span><span class="op" id="8452084">)</span><span class="op" id="8452085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8452090">b</span><span class="op" id="8452091">.</span><span class="ident" id="8452092">WriteByte</span><span class="op" id="8452101">(</span><span class="num" id="8452102">0</span><span class="op" id="8452103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8452107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8452111">//&nbsp;Write&nbsp;an&nbsp;image&nbsp;with&nbsp;bounds&nbsp;2x1,&nbsp;as&nbsp;per&nbsp;TestDecode.</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8452167">b</span><span class="op" id="8452168">.</span><span class="ident" id="8452169">WriteString</span><span class="op" id="8452180">(</span><span class="string" id="8452181">&#34;\x2c\x00\x00\x00\x00\x02\x00\x01\x00\x00\x02&#34;</span><span class="op" id="8452227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8452231">enc</span>&nbsp;<span class="op" id="8452235">:=</span>&nbsp;<span class="ident" id="8452238">lzwEncode</span><span class="op" id="8452247">(</span><span class="num" id="8452248">2</span><span class="op" id="8452249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8452253">if</span>&nbsp;<span class="builtinfunc" id="8452256">len</span><span class="op" id="8452259">(</span><span class="ident" id="8452260">enc</span><span class="op" id="8452263">)</span>&nbsp;<span class="op" id="8452265">&gt;</span>&nbsp;<span class="num" id="8452267">0xff</span>&nbsp;<span class="op" id="8452272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8452277">t</span><span class="op" id="8452278">.</span><span class="ident" id="8452279">Fatalf</span><span class="op" id="8452285">(</span><span class="string" id="8452286">&#34;compressed&nbsp;length&nbsp;%d&nbsp;is&nbsp;too&nbsp;large&#34;</span><span class="op" id="8452321">,</span>&nbsp;<span class="builtinfunc" id="8452323">len</span><span class="op" id="8452326">(</span><span class="ident" id="8452327">enc</span><span class="op" id="8452330">)</span><span class="op" id="8452331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8452335">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8452339">b</span><span class="op" id="8452340">.</span><span class="ident" id="8452341">WriteByte</span><span class="op" id="8452350">(</span><span class="builtintype" id="8452351">byte</span><span class="op" id="8452355">(</span><span class="builtinfunc" id="8452356">len</span><span class="op" id="8452359">(</span><span class="ident" id="8452360">enc</span><span class="op" id="8452363">)</span><span class="op" id="8452364">)</span><span class="op" id="8452365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8452369">b</span><span class="op" id="8452370">.</span><span class="ident" id="8452371">Write</span><span class="op" id="8452376">(</span><span class="ident" id="8452377">enc</span><span class="op" id="8452380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8452384">b</span><span class="op" id="8452385">.</span><span class="ident" id="8452386">WriteByte</span><span class="op" id="8452395">(</span><span class="num" id="8452396">0x00</span><span class="op" id="8452400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8452403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8452406">b</span><span class="op" id="8452407">.</span><span class="ident" id="8452408">WriteString</span><span class="op" id="8452419">(</span><span class="ident" id="8452420">trailerStr</span><span class="op" id="8452430">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8452434">g</span><span class="op" id="8452435">,</span>&nbsp;<span class="ident" id="8452437">err</span>&nbsp;<span class="op" id="8452441">:=</span>&nbsp;<span class="ident" id="8452444">DecodeAll</span><span class="op" id="8452453">(</span><span class="ident" id="8452454">b</span><span class="op" id="8452455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8452458">if</span>&nbsp;<span class="ident" id="8452461">err</span>&nbsp;<span class="op" id="8452465">!=</span>&nbsp;<span class="builtintype" id="8452468">nil</span>&nbsp;<span class="op" id="8452472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8452476">t</span><span class="op" id="8452477">.</span><span class="ident" id="8452478">Fatalf</span><span class="op" id="8452484">(</span><span class="string" id="8452485">&#34;DecodeAll:&nbsp;%v&#34;</span><span class="op" id="8452500">,</span>&nbsp;<span class="ident" id="8452502">err</span><span class="op" id="8452505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8452508">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8452511">c0</span>&nbsp;<span class="op" id="8452514">:=</span>&nbsp;<span class="ident" id="8452517">color</span><span class="op" id="8452522">.</span><span class="ident" id="8452523">RGBA</span><span class="op" id="8452527">{</span><span class="ident" id="8452528">paletteStr</span><span class="op" id="8452538">[</span><span class="num" id="8452539">0</span><span class="op" id="8452540">]</span><span class="op" id="8452541">,</span>&nbsp;<span class="ident" id="8452543">paletteStr</span><span class="op" id="8452553">[</span><span class="num" id="8452554">1</span><span class="op" id="8452555">]</span><span class="op" id="8452556">,</span>&nbsp;<span class="ident" id="8452558">paletteStr</span><span class="op" id="8452568">[</span><span class="num" id="8452569">2</span><span class="op" id="8452570">]</span><span class="op" id="8452571">,</span>&nbsp;<span class="num" id="8452573">0xff</span><span class="op" id="8452577">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8452580">c1</span>&nbsp;<span class="op" id="8452583">:=</span>&nbsp;<span class="ident" id="8452586">color</span><span class="op" id="8452591">.</span><span class="ident" id="8452592">RGBA</span><span class="op" id="8452596">{</span><span class="ident" id="8452597">paletteStr</span><span class="op" id="8452607">[</span><span class="num" id="8452608">3</span><span class="op" id="8452609">]</span><span class="op" id="8452610">,</span>&nbsp;<span class="ident" id="8452612">paletteStr</span><span class="op" id="8452622">[</span><span class="num" id="8452623">4</span><span class="op" id="8452624">]</span><span class="op" id="8452625">,</span>&nbsp;<span class="ident" id="8452627">paletteStr</span><span class="op" id="8452637">[</span><span class="num" id="8452638">5</span><span class="op" id="8452639">]</span><span class="op" id="8452640">,</span>&nbsp;<span class="num" id="8452642">0xff</span><span class="op" id="8452646">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8452649">cz</span>&nbsp;<span class="op" id="8452652">:=</span>&nbsp;<span class="ident" id="8452655">color</span><span class="op" id="8452660">.</span><span class="ident" id="8452661">RGBA</span><span class="op" id="8452665">{</span><span class="op" id="8452666">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8452669">wants</span>&nbsp;<span class="op" id="8452675">:=</span>&nbsp;<span class="op" id="8452678">[</span><span class="op" id="8452679">]</span><span class="ident" id="8452680">color</span><span class="op" id="8452685">.</span><span class="ident" id="8452686">Palette</span><span class="op" id="8452693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8452697">{</span><span class="ident" id="8452698">cz</span><span class="op" id="8452700">,</span>&nbsp;<span class="ident" id="8452702">c1</span><span class="op" id="8452704">}</span><span class="op" id="8452705">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8452709">{</span><span class="ident" id="8452710">c0</span><span class="op" id="8452712">,</span>&nbsp;<span class="ident" id="8452714">cz</span><span class="op" id="8452716">}</span><span class="op" id="8452717">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8452721">{</span><span class="ident" id="8452722">c0</span><span class="op" id="8452724">,</span>&nbsp;<span class="ident" id="8452726">c1</span><span class="op" id="8452728">}</span><span class="op" id="8452729">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8452732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8452735">if</span>&nbsp;<span class="builtinfunc" id="8452738">len</span><span class="op" id="8452741">(</span><span class="ident" id="8452742">g</span><span class="op" id="8452743">.</span><span class="ident" id="8452744">Image</span><span class="op" id="8452749">)</span>&nbsp;<span class="op" id="8452751">!=</span>&nbsp;<span class="builtinfunc" id="8452754">len</span><span class="op" id="8452757">(</span><span class="ident" id="8452758">wants</span><span class="op" id="8452763">)</span>&nbsp;<span class="op" id="8452765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8452769">t</span><span class="op" id="8452770">.</span><span class="ident" id="8452771">Fatalf</span><span class="op" id="8452777">(</span><span class="string" id="8452778">&#34;got&nbsp;%d&nbsp;images,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8452802">,</span>&nbsp;<span class="builtinfunc" id="8452804">len</span><span class="op" id="8452807">(</span><span class="ident" id="8452808">g</span><span class="op" id="8452809">.</span><span class="ident" id="8452810">Image</span><span class="op" id="8452815">)</span><span class="op" id="8452816">,</span>&nbsp;<span class="builtinfunc" id="8452818">len</span><span class="op" id="8452821">(</span><span class="ident" id="8452822">wants</span><span class="op" id="8452827">)</span><span class="op" id="8452828">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8452831">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8452834">for</span>&nbsp;<span class="ident" id="8452838">i</span><span class="op" id="8452839">,</span>&nbsp;<span class="ident" id="8452841">want</span>&nbsp;<span class="op" id="8452846">:=</span>&nbsp;<span class="keyword" id="8452849">range</span>&nbsp;<span class="ident" id="8452855">wants</span>&nbsp;<span class="op" id="8452861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8452865">got</span>&nbsp;<span class="op" id="8452869">:=</span>&nbsp;<span class="ident" id="8452872">g</span><span class="op" id="8452873">.</span><span class="ident" id="8452874">Image</span><span class="op" id="8452879">[</span><span class="ident" id="8452880">i</span><span class="op" id="8452881">]</span><span class="op" id="8452882">.</span><span class="ident" id="8452883">Palette</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8452893">if</span>&nbsp;<span class="op" id="8452896">!</span><span class="ident" id="8452897">reflect</span><span class="op" id="8452904">.</span><span class="ident" id="8452905">DeepEqual</span><span class="op" id="8452914">(</span><span class="ident" id="8452915">got</span><span class="op" id="8452918">,</span>&nbsp;<span class="ident" id="8452920">want</span><span class="op" id="8452924">)</span>&nbsp;<span class="op" id="8452926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8452931">t</span><span class="op" id="8452932">.</span><span class="ident" id="8452933">Errorf</span><span class="op" id="8452939">(</span><span class="string" id="8452940">&#34;palette&nbsp;#%d:\ngot&nbsp;&nbsp;%v\nwant&nbsp;%v&#34;</span><span class="op" id="8452972">,</span>&nbsp;<span class="ident" id="8452974">i</span><span class="op" id="8452975">,</span>&nbsp;<span class="ident" id="8452977">got</span><span class="op" id="8452980">,</span>&nbsp;<span class="ident" id="8452982">want</span><span class="op" id="8452986">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8452990">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8452993">}</span><br>
<span class="lineno"></span><span class="op" id="8452995">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8452998">//&nbsp;testGIF&nbsp;is&nbsp;a&nbsp;simple&nbsp;GIF&nbsp;that&nbsp;we&nbsp;can&nbsp;modify&nbsp;to&nbsp;test&nbsp;different&nbsp;scenarios.</span><br>
<span class="lineno">140</span><span class="keyword" id="8453073">var</span>&nbsp;<span class="ident" id="8453077">testGIF</span>&nbsp;<span class="op" id="8453085">=</span>&nbsp;<span class="op" id="8453087">[</span><span class="op" id="8453088">]</span><span class="builtintype" id="8453089">byte</span><span class="op" id="8453093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8453096">&#39;G&#39;</span><span class="op" id="8453099">,</span>&nbsp;<span class="string" id="8453101">&#39;I&#39;</span><span class="op" id="8453104">,</span>&nbsp;<span class="string" id="8453106">&#39;F&#39;</span><span class="op" id="8453109">,</span>&nbsp;<span class="string" id="8453111">&#39;8&#39;</span><span class="op" id="8453114">,</span>&nbsp;<span class="string" id="8453116">&#39;9&#39;</span><span class="op" id="8453119">,</span>&nbsp;<span class="string" id="8453121">&#39;a&#39;</span><span class="op" id="8453124">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8453127">1</span><span class="op" id="8453128">,</span>&nbsp;<span class="num" id="8453130">0</span><span class="op" id="8453131">,</span>&nbsp;<span class="num" id="8453133">1</span><span class="op" id="8453134">,</span>&nbsp;<span class="num" id="8453136">0</span><span class="op" id="8453137">,</span>&nbsp;<span class="comment" id="8453139">//&nbsp;w=1,&nbsp;h=1&nbsp;(6)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8453156">128</span><span class="op" id="8453159">,</span>&nbsp;<span class="num" id="8453161">0</span><span class="op" id="8453162">,</span>&nbsp;<span class="num" id="8453164">0</span><span class="op" id="8453165">,</span>&nbsp;<span class="comment" id="8453167">//&nbsp;headerFields,&nbsp;bg,&nbsp;aspect&nbsp;(10)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8453201">0</span><span class="op" id="8453202">,</span>&nbsp;<span class="num" id="8453204">0</span><span class="op" id="8453205">,</span>&nbsp;<span class="num" id="8453207">0</span><span class="op" id="8453208">,</span>&nbsp;<span class="num" id="8453210">1</span><span class="op" id="8453211">,</span>&nbsp;<span class="num" id="8453213">1</span><span class="op" id="8453214">,</span>&nbsp;<span class="num" id="8453216">1</span><span class="op" id="8453217">,</span>&nbsp;<span class="comment" id="8453219">//&nbsp;color&nbsp;map&nbsp;and&nbsp;graphics&nbsp;control&nbsp;(13)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8453259">0x21</span><span class="op" id="8453263">,</span>&nbsp;<span class="num" id="8453265">0xf9</span><span class="op" id="8453269">,</span>&nbsp;<span class="num" id="8453271">0x04</span><span class="op" id="8453275">,</span>&nbsp;<span class="num" id="8453277">0x00</span><span class="op" id="8453281">,</span>&nbsp;<span class="num" id="8453283">0x00</span><span class="op" id="8453287">,</span>&nbsp;<span class="num" id="8453289">0x00</span><span class="op" id="8453293">,</span>&nbsp;<span class="num" id="8453295">0xff</span><span class="op" id="8453299">,</span>&nbsp;<span class="num" id="8453301">0x00</span><span class="op" id="8453305">,</span>&nbsp;<span class="comment" id="8453307">//&nbsp;(19)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8453316">//&nbsp;frame&nbsp;1&nbsp;(0,0&nbsp;-&nbsp;1,1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8453340">0x2c</span><span class="op" id="8453344">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8453347">0x00</span><span class="op" id="8453351">,</span>&nbsp;<span class="num" id="8453353">0x00</span><span class="op" id="8453357">,</span>&nbsp;<span class="num" id="8453359">0x00</span><span class="op" id="8453363">,</span>&nbsp;<span class="num" id="8453365">0x00</span><span class="op" id="8453369">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8453372">0x01</span><span class="op" id="8453376">,</span>&nbsp;<span class="num" id="8453378">0x00</span><span class="op" id="8453382">,</span>&nbsp;<span class="num" id="8453384">0x01</span><span class="op" id="8453388">,</span>&nbsp;<span class="num" id="8453390">0x00</span><span class="op" id="8453394">,</span>&nbsp;<span class="comment" id="8453396">//&nbsp;(32)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8453405">0x00</span><span class="op" id="8453409">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8453412">0x02</span><span class="op" id="8453416">,</span>&nbsp;<span class="num" id="8453418">0x02</span><span class="op" id="8453422">,</span>&nbsp;<span class="num" id="8453424">0x4c</span><span class="op" id="8453428">,</span>&nbsp;<span class="num" id="8453430">0x01</span><span class="op" id="8453434">,</span>&nbsp;<span class="num" id="8453436">0x00</span><span class="op" id="8453440">,</span>&nbsp;<span class="comment" id="8453442">//&nbsp;lzw&nbsp;pixels</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8453457">//&nbsp;trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8453469">0x3b</span><span class="op" id="8453473">,</span><br>
<span class="lineno"></span><span class="op" id="8453475">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="keyword" id="8453478">func</span>&nbsp;<span class="ident" id="8453483">try</span><span class="op" id="8453486">(</span><span class="ident" id="8453487">t</span>&nbsp;<span class="op" id="8453489">*</span><span class="ident" id="8453490">testing</span><span class="op" id="8453497">.</span><span class="ident" id="8453498">T</span><span class="op" id="8453499">,</span>&nbsp;<span class="ident" id="8453501">b</span>&nbsp;<span class="op" id="8453503">[</span><span class="op" id="8453504">]</span><span class="builtintype" id="8453505">byte</span><span class="op" id="8453509">,</span>&nbsp;<span class="ident" id="8453511">want</span>&nbsp;<span class="builtintype" id="8453516">string</span><span class="op" id="8453522">)</span>&nbsp;<span class="op" id="8453524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8453527">_</span><span class="op" id="8453528">,</span>&nbsp;<span class="ident" id="8453530">err</span>&nbsp;<span class="op" id="8453534">:=</span>&nbsp;<span class="ident" id="8453537">DecodeAll</span><span class="op" id="8453546">(</span><span class="ident" id="8453547">bytes</span><span class="op" id="8453552">.</span><span class="ident" id="8453553">NewReader</span><span class="op" id="8453562">(</span><span class="ident" id="8453563">b</span><span class="op" id="8453564">)</span><span class="op" id="8453565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8453568">var</span>&nbsp;<span class="ident" id="8453572">got</span>&nbsp;<span class="builtintype" id="8453576">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8453584">if</span>&nbsp;<span class="ident" id="8453587">err</span>&nbsp;<span class="op" id="8453591">!=</span>&nbsp;<span class="builtintype" id="8453594">nil</span>&nbsp;<span class="op" id="8453598">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8453602">got</span>&nbsp;<span class="op" id="8453606">=</span>&nbsp;<span class="ident" id="8453608">err</span><span class="op" id="8453611">.</span><span class="ident" id="8453612">Error</span><span class="op" id="8453617">(</span><span class="op" id="8453618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8453621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8453624">if</span>&nbsp;<span class="ident" id="8453627">got</span>&nbsp;<span class="op" id="8453631">!=</span>&nbsp;<span class="ident" id="8453634">want</span>&nbsp;<span class="op" id="8453639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8453643">t</span><span class="op" id="8453644">.</span><span class="ident" id="8453645">Fatalf</span><span class="op" id="8453651">(</span><span class="string" id="8453652">&#34;got&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="8453669">,</span>&nbsp;<span class="ident" id="8453671">got</span><span class="op" id="8453674">,</span>&nbsp;<span class="ident" id="8453676">want</span><span class="op" id="8453680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8453683">}</span><br>
<span class="lineno">165</span><span class="op" id="8453685">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8453688">func</span>&nbsp;<span class="ident" id="8453693">TestBounds</span><span class="op" id="8453703">(</span><span class="ident" id="8453704">t</span>&nbsp;<span class="op" id="8453706">*</span><span class="ident" id="8453707">testing</span><span class="op" id="8453714">.</span><span class="ident" id="8453715">T</span><span class="op" id="8453716">)</span>&nbsp;<span class="op" id="8453718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8453721">//&nbsp;Make&nbsp;a&nbsp;local&nbsp;copy&nbsp;of&nbsp;testGIF.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8453755">gif</span>&nbsp;<span class="op" id="8453759">:=</span>&nbsp;<span class="builtinfunc" id="8453762">make</span><span class="op" id="8453766">(</span><span class="op" id="8453767">[</span><span class="op" id="8453768">]</span><span class="builtintype" id="8453769">byte</span><span class="op" id="8453773">,</span>&nbsp;<span class="builtinfunc" id="8453775">len</span><span class="op" id="8453778">(</span><span class="ident" id="8453779">testGIF</span><span class="op" id="8453786">)</span><span class="op" id="8453787">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="8453790">copy</span><span class="op" id="8453794">(</span><span class="ident" id="8453795">gif</span><span class="op" id="8453798">,</span>&nbsp;<span class="ident" id="8453800">testGIF</span><span class="op" id="8453807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8453810">//&nbsp;Make&nbsp;the&nbsp;bounds&nbsp;too&nbsp;big,&nbsp;just&nbsp;by&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8453852">gif</span><span class="op" id="8453855">[</span><span class="num" id="8453856">32</span><span class="op" id="8453858">]</span>&nbsp;<span class="op" id="8453860">=</span>&nbsp;<span class="num" id="8453862">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8453865">want</span>&nbsp;<span class="op" id="8453870">:=</span>&nbsp;<span class="string" id="8453873">&#34;gif:&nbsp;frame&nbsp;bounds&nbsp;larger&nbsp;than&nbsp;image&nbsp;bounds&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8453919">try</span><span class="op" id="8453922">(</span><span class="ident" id="8453923">t</span><span class="op" id="8453924">,</span>&nbsp;<span class="ident" id="8453926">gif</span><span class="op" id="8453929">,</span>&nbsp;<span class="ident" id="8453931">want</span><span class="op" id="8453935">)</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8453939">//&nbsp;Make&nbsp;the&nbsp;bounds&nbsp;too&nbsp;small;&nbsp;does&nbsp;not&nbsp;trigger&nbsp;bounds</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8453994">//&nbsp;check,&nbsp;but&nbsp;now&nbsp;there&#39;s&nbsp;too&nbsp;much&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8454036">gif</span><span class="op" id="8454039">[</span><span class="num" id="8454040">32</span><span class="op" id="8454042">]</span>&nbsp;<span class="op" id="8454044">=</span>&nbsp;<span class="num" id="8454046">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8454049">want</span>&nbsp;<span class="op" id="8454054">=</span>&nbsp;<span class="string" id="8454056">&#34;gif:&nbsp;too&nbsp;much&nbsp;image&nbsp;data&#34;</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8454084">try</span><span class="op" id="8454087">(</span><span class="ident" id="8454088">t</span><span class="op" id="8454089">,</span>&nbsp;<span class="ident" id="8454091">gif</span><span class="op" id="8454094">,</span>&nbsp;<span class="ident" id="8454096">want</span><span class="op" id="8454100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8454103">gif</span><span class="op" id="8454106">[</span><span class="num" id="8454107">32</span><span class="op" id="8454109">]</span>&nbsp;<span class="op" id="8454111">=</span>&nbsp;<span class="num" id="8454113">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8454117">//&nbsp;Make&nbsp;the&nbsp;bounds&nbsp;really&nbsp;big,&nbsp;expect&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8454166">want</span>&nbsp;<span class="op" id="8454171">=</span>&nbsp;<span class="string" id="8454173">&#34;gif:&nbsp;frame&nbsp;bounds&nbsp;larger&nbsp;than&nbsp;image&nbsp;bounds&#34;</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8454219">for</span>&nbsp;<span class="ident" id="8454223">i</span>&nbsp;<span class="op" id="8454225">:=</span>&nbsp;<span class="num" id="8454228">0</span><span class="op" id="8454229">;</span>&nbsp;<span class="ident" id="8454231">i</span>&nbsp;<span class="op" id="8454233">&lt;</span>&nbsp;<span class="num" id="8454235">4</span><span class="op" id="8454236">;</span>&nbsp;<span class="ident" id="8454238">i</span><span class="op" id="8454239">++</span>&nbsp;<span class="op" id="8454242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8454246">gif</span><span class="op" id="8454249">[</span><span class="num" id="8454250">32</span><span class="op" id="8454252">+</span><span class="ident" id="8454253">i</span><span class="op" id="8454254">]</span>&nbsp;<span class="op" id="8454256">=</span>&nbsp;<span class="num" id="8454258">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8454264">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8454267">try</span><span class="op" id="8454270">(</span><span class="ident" id="8454271">t</span><span class="op" id="8454272">,</span>&nbsp;<span class="ident" id="8454274">gif</span><span class="op" id="8454277">,</span>&nbsp;<span class="ident" id="8454279">want</span><span class="op" id="8454283">)</span><br>
<span class="lineno"></span><span class="op" id="8454285">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="keyword" id="8454288">func</span>&nbsp;<span class="ident" id="8454293">TestNoPalette</span><span class="op" id="8454306">(</span><span class="ident" id="8454307">t</span>&nbsp;<span class="op" id="8454309">*</span><span class="ident" id="8454310">testing</span><span class="op" id="8454317">.</span><span class="ident" id="8454318">T</span><span class="op" id="8454319">)</span>&nbsp;<span class="op" id="8454321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8454324">b</span>&nbsp;<span class="op" id="8454326">:=</span>&nbsp;<span class="op" id="8454329">&amp;</span><span class="ident" id="8454330">bytes</span><span class="op" id="8454335">.</span><span class="ident" id="8454336">Buffer</span><span class="op" id="8454342">{</span><span class="op" id="8454343">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8454347">//&nbsp;Manufacture&nbsp;a&nbsp;GIF&nbsp;with&nbsp;no&nbsp;palette,&nbsp;so&nbsp;any&nbsp;pixel&nbsp;at&nbsp;all</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8454406">//&nbsp;will&nbsp;be&nbsp;invalid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8454427">b</span><span class="op" id="8454428">.</span><span class="ident" id="8454429">WriteString</span><span class="op" id="8454440">(</span><span class="ident" id="8454441">headerStr</span><span class="op" id="8454450">[</span><span class="op" id="8454451">:</span><span class="builtinfunc" id="8454452">len</span><span class="op" id="8454455">(</span><span class="ident" id="8454456">headerStr</span><span class="op" id="8454465">)</span><span class="op" id="8454466">-</span><span class="num" id="8454467">3</span><span class="op" id="8454468">]</span><span class="op" id="8454469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8454472">b</span><span class="op" id="8454473">.</span><span class="ident" id="8454474">WriteString</span><span class="op" id="8454485">(</span><span class="string" id="8454486">&#34;\x00\x00\x00&#34;</span><span class="op" id="8454500">)</span>&nbsp;<span class="comment" id="8454502">//&nbsp;No&nbsp;global&nbsp;palette.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8454526">//&nbsp;Image&nbsp;descriptor:&nbsp;2x1,&nbsp;no&nbsp;local&nbsp;palette.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8454571">b</span><span class="op" id="8454572">.</span><span class="ident" id="8454573">WriteString</span><span class="op" id="8454584">(</span><span class="string" id="8454585">&#34;\x2c\x00\x00\x00\x00\x02\x00\x01\x00\x00\x02&#34;</span><span class="op" id="8454631">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8454635">//&nbsp;Encode&nbsp;the&nbsp;pixels:&nbsp;neither&nbsp;is&nbsp;in&nbsp;range,&nbsp;because&nbsp;there&nbsp;is&nbsp;no&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8454708">pix</span>&nbsp;<span class="op" id="8454712">:=</span>&nbsp;<span class="op" id="8454715">[</span><span class="op" id="8454716">]</span><span class="builtintype" id="8454717">byte</span><span class="op" id="8454721">{</span><span class="num" id="8454722">0</span><span class="op" id="8454723">,</span>&nbsp;<span class="num" id="8454725">128</span><span class="op" id="8454728">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8454731">enc</span>&nbsp;<span class="op" id="8454735">:=</span>&nbsp;<span class="op" id="8454738">&amp;</span><span class="ident" id="8454739">bytes</span><span class="op" id="8454744">.</span><span class="ident" id="8454745">Buffer</span><span class="op" id="8454751">{</span><span class="op" id="8454752">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8454755">w</span>&nbsp;<span class="op" id="8454757">:=</span>&nbsp;<span class="ident" id="8454760">lzw</span><span class="op" id="8454763">.</span><span class="ident" id="8454764">NewWriter</span><span class="op" id="8454773">(</span><span class="ident" id="8454774">enc</span><span class="op" id="8454777">,</span>&nbsp;<span class="ident" id="8454779">lzw</span><span class="op" id="8454782">.</span><span class="ident" id="8454783">LSB</span><span class="op" id="8454786">,</span>&nbsp;<span class="num" id="8454788">2</span><span class="op" id="8454789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8454792">w</span><span class="op" id="8454793">.</span><span class="ident" id="8454794">Write</span><span class="op" id="8454799">(</span><span class="ident" id="8454800">pix</span><span class="op" id="8454803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8454806">w</span><span class="op" id="8454807">.</span><span class="ident" id="8454808">Close</span><span class="op" id="8454813">(</span><span class="op" id="8454814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8454817">b</span><span class="op" id="8454818">.</span><span class="ident" id="8454819">WriteByte</span><span class="op" id="8454828">(</span><span class="builtintype" id="8454829">byte</span><span class="op" id="8454833">(</span><span class="builtinfunc" id="8454834">len</span><span class="op" id="8454837">(</span><span class="ident" id="8454838">enc</span><span class="op" id="8454841">.</span><span class="ident" id="8454842">Bytes</span><span class="op" id="8454847">(</span><span class="op" id="8454848">)</span><span class="op" id="8454849">)</span><span class="op" id="8454850">)</span><span class="op" id="8454851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8454854">b</span><span class="op" id="8454855">.</span><span class="ident" id="8454856">Write</span><span class="op" id="8454861">(</span><span class="ident" id="8454862">enc</span><span class="op" id="8454865">.</span><span class="ident" id="8454866">Bytes</span><span class="op" id="8454871">(</span><span class="op" id="8454872">)</span><span class="op" id="8454873">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8454876">b</span><span class="op" id="8454877">.</span><span class="ident" id="8454878">WriteByte</span><span class="op" id="8454887">(</span><span class="num" id="8454888">0x00</span><span class="op" id="8454892">)</span>&nbsp;<span class="comment" id="8454894">//&nbsp;An&nbsp;empty&nbsp;block&nbsp;signifies&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8454951">b</span><span class="op" id="8454952">.</span><span class="ident" id="8454953">WriteString</span><span class="op" id="8454964">(</span><span class="ident" id="8454965">trailerStr</span><span class="op" id="8454975">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8454979">try</span><span class="op" id="8454982">(</span><span class="ident" id="8454983">t</span><span class="op" id="8454984">,</span>&nbsp;<span class="ident" id="8454986">b</span><span class="op" id="8454987">.</span><span class="ident" id="8454988">Bytes</span><span class="op" id="8454993">(</span><span class="op" id="8454994">)</span><span class="op" id="8454995">,</span>&nbsp;<span class="string" id="8454997">&#34;gif:&nbsp;invalid&nbsp;pixel&nbsp;value&#34;</span><span class="op" id="8455023">)</span><br>
<span class="lineno">215</span><span class="op" id="8455025">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8455028">func</span>&nbsp;<span class="ident" id="8455033">TestPixelOutsidePaletteRange</span><span class="op" id="8455061">(</span><span class="ident" id="8455062">t</span>&nbsp;<span class="op" id="8455064">*</span><span class="ident" id="8455065">testing</span><span class="op" id="8455072">.</span><span class="ident" id="8455073">T</span><span class="op" id="8455074">)</span>&nbsp;<span class="op" id="8455076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8455079">for</span>&nbsp;<span class="ident" id="8455083">_</span><span class="op" id="8455084">,</span>&nbsp;<span class="ident" id="8455086">pval</span>&nbsp;<span class="op" id="8455091">:=</span>&nbsp;<span class="keyword" id="8455094">range</span>&nbsp;<span class="op" id="8455100">[</span><span class="op" id="8455101">]</span><span class="builtintype" id="8455102">byte</span><span class="op" id="8455106">{</span><span class="num" id="8455107">0</span><span class="op" id="8455108">,</span>&nbsp;<span class="num" id="8455110">1</span><span class="op" id="8455111">,</span>&nbsp;<span class="num" id="8455113">2</span><span class="op" id="8455114">,</span>&nbsp;<span class="num" id="8455116">3</span><span class="op" id="8455117">,</span>&nbsp;<span class="num" id="8455119">255</span><span class="op" id="8455122">}</span>&nbsp;<span class="op" id="8455124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8455128">b</span>&nbsp;<span class="op" id="8455130">:=</span>&nbsp;<span class="op" id="8455133">&amp;</span><span class="ident" id="8455134">bytes</span><span class="op" id="8455139">.</span><span class="ident" id="8455140">Buffer</span><span class="op" id="8455146">{</span><span class="op" id="8455147">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8455152">//&nbsp;Manufacture&nbsp;a&nbsp;GIF&nbsp;with&nbsp;a&nbsp;2&nbsp;color&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8455199">b</span><span class="op" id="8455200">.</span><span class="ident" id="8455201">WriteString</span><span class="op" id="8455212">(</span><span class="ident" id="8455213">headerStr</span><span class="op" id="8455222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8455226">b</span><span class="op" id="8455227">.</span><span class="ident" id="8455228">WriteString</span><span class="op" id="8455239">(</span><span class="ident" id="8455240">paletteStr</span><span class="op" id="8455250">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8455255">//&nbsp;Image&nbsp;descriptor:&nbsp;2x1,&nbsp;no&nbsp;local&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8455301">b</span><span class="op" id="8455302">.</span><span class="ident" id="8455303">WriteString</span><span class="op" id="8455314">(</span><span class="string" id="8455315">&#34;\x2c\x00\x00\x00\x00\x02\x00\x01\x00\x00\x02&#34;</span><span class="op" id="8455361">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8455366">//&nbsp;Encode&nbsp;the&nbsp;pixels;&nbsp;some&nbsp;pvals&nbsp;trigger&nbsp;the&nbsp;expected&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8455429">pix</span>&nbsp;<span class="op" id="8455433">:=</span>&nbsp;<span class="op" id="8455436">[</span><span class="op" id="8455437">]</span><span class="builtintype" id="8455438">byte</span><span class="op" id="8455442">{</span><span class="ident" id="8455443">pval</span><span class="op" id="8455447">,</span>&nbsp;<span class="ident" id="8455449">pval</span><span class="op" id="8455453">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8455457">enc</span>&nbsp;<span class="op" id="8455461">:=</span>&nbsp;<span class="op" id="8455464">&amp;</span><span class="ident" id="8455465">bytes</span><span class="op" id="8455470">.</span><span class="ident" id="8455471">Buffer</span><span class="op" id="8455477">{</span><span class="op" id="8455478">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8455482">w</span>&nbsp;<span class="op" id="8455484">:=</span>&nbsp;<span class="ident" id="8455487">lzw</span><span class="op" id="8455490">.</span><span class="ident" id="8455491">NewWriter</span><span class="op" id="8455500">(</span><span class="ident" id="8455501">enc</span><span class="op" id="8455504">,</span>&nbsp;<span class="ident" id="8455506">lzw</span><span class="op" id="8455509">.</span><span class="ident" id="8455510">LSB</span><span class="op" id="8455513">,</span>&nbsp;<span class="num" id="8455515">2</span><span class="op" id="8455516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8455520">w</span><span class="op" id="8455521">.</span><span class="ident" id="8455522">Write</span><span class="op" id="8455527">(</span><span class="ident" id="8455528">pix</span><span class="op" id="8455531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8455535">w</span><span class="op" id="8455536">.</span><span class="ident" id="8455537">Close</span><span class="op" id="8455542">(</span><span class="op" id="8455543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8455547">b</span><span class="op" id="8455548">.</span><span class="ident" id="8455549">WriteByte</span><span class="op" id="8455558">(</span><span class="builtintype" id="8455559">byte</span><span class="op" id="8455563">(</span><span class="builtinfunc" id="8455564">len</span><span class="op" id="8455567">(</span><span class="ident" id="8455568">enc</span><span class="op" id="8455571">.</span><span class="ident" id="8455572">Bytes</span><span class="op" id="8455577">(</span><span class="op" id="8455578">)</span><span class="op" id="8455579">)</span><span class="op" id="8455580">)</span><span class="op" id="8455581">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8455585">b</span><span class="op" id="8455586">.</span><span class="ident" id="8455587">Write</span><span class="op" id="8455592">(</span><span class="ident" id="8455593">enc</span><span class="op" id="8455596">.</span><span class="ident" id="8455597">Bytes</span><span class="op" id="8455602">(</span><span class="op" id="8455603">)</span><span class="op" id="8455604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8455608">b</span><span class="op" id="8455609">.</span><span class="ident" id="8455610">WriteByte</span><span class="op" id="8455619">(</span><span class="num" id="8455620">0x00</span><span class="op" id="8455624">)</span>&nbsp;<span class="comment" id="8455626">//&nbsp;An&nbsp;empty&nbsp;block&nbsp;signifies&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8455684">b</span><span class="op" id="8455685">.</span><span class="ident" id="8455686">WriteString</span><span class="op" id="8455697">(</span><span class="ident" id="8455698">trailerStr</span><span class="op" id="8455708">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8455713">//&nbsp;No&nbsp;error&nbsp;expected,&nbsp;unless&nbsp;the&nbsp;pixels&nbsp;are&nbsp;beyond&nbsp;the&nbsp;2&nbsp;color&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8455787">want</span>&nbsp;<span class="op" id="8455792">:=</span>&nbsp;<span class="string" id="8455795">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8455800">if</span>&nbsp;<span class="ident" id="8455803">pval</span>&nbsp;<span class="op" id="8455808">&gt;=</span>&nbsp;<span class="num" id="8455811">2</span>&nbsp;<span class="op" id="8455813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8455818">want</span>&nbsp;<span class="op" id="8455823">=</span>&nbsp;<span class="string" id="8455825">&#34;gif:&nbsp;invalid&nbsp;pixel&nbsp;value&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8455854">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8455858">try</span><span class="op" id="8455861">(</span><span class="ident" id="8455862">t</span><span class="op" id="8455863">,</span>&nbsp;<span class="ident" id="8455865">b</span><span class="op" id="8455866">.</span><span class="ident" id="8455867">Bytes</span><span class="op" id="8455872">(</span><span class="op" id="8455873">)</span><span class="op" id="8455874">,</span>&nbsp;<span class="ident" id="8455876">want</span><span class="op" id="8455880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8455883">}</span><br>
<span class="lineno"></span><span class="op" id="8455885">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
