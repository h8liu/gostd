<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/rpc</h2>
<ul>
<li><a href="/gostd/net/rpc/client.go.html">client.go</a></li>
<li><a href="/gostd/net/rpc/client_test.go.html">client_test.go</a></li>
<li><a href="/gostd/net/rpc/debug.go.html">debug.go</a></li>
<li><a href="/gostd/net/rpc/server.go.html">server.go</a></li>
<li><a href="/gostd/net/rpc/server_test.go.html">server_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5133141">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5133196">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5133250">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5133301">package</span>&nbsp;<span class="ident" id="5133309">rpc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5133314">import</span>&nbsp;<span class="op" id="5133321">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5133324">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5133333">&#34;encoding/gob&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5133349">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5133359">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5133365">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5133372">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5133379">&#34;net/http&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5133391">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="5133398">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5133401">//&nbsp;ServerError&nbsp;represents&nbsp;an&nbsp;error&nbsp;that&nbsp;has&nbsp;been&nbsp;returned&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="5133464">//&nbsp;the&nbsp;remote&nbsp;side&nbsp;of&nbsp;the&nbsp;RPC&nbsp;connection.</span><br>
<span class="lineno">20</span><span class="keyword" id="5133506">type</span>&nbsp;<span class="ident" id="5133511">ServerError</span>&nbsp;<span class="builtintype" id="5133523">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5133531">func</span>&nbsp;<span class="op" id="5133536">(</span><span class="ident" id="5133537">e</span>&nbsp;<span class="ident" id="5133539">ServerError</span><span class="op" id="5133550">)</span>&nbsp;<span class="ident" id="5133552">Error</span><span class="op" id="5133557">(</span><span class="op" id="5133558">)</span>&nbsp;<span class="builtintype" id="5133560">string</span>&nbsp;<span class="op" id="5133567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5133570">return</span>&nbsp;<span class="builtintype" id="5133577">string</span><span class="op" id="5133583">(</span><span class="ident" id="5133584">e</span><span class="op" id="5133585">)</span><br>
<span class="lineno"></span><span class="op" id="5133587">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="5133590">var</span>&nbsp;<span class="ident" id="5133594">ErrShutdown</span>&nbsp;<span class="op" id="5133606">=</span>&nbsp;<span class="ident" id="5133608">errors</span><span class="op" id="5133614">.</span><span class="ident" id="5133615">New</span><span class="op" id="5133618">(</span><span class="string" id="5133619">&#34;connection&nbsp;is&nbsp;shut&nbsp;down&#34;</span><span class="op" id="5133644">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5133647">//&nbsp;Call&nbsp;represents&nbsp;an&nbsp;active&nbsp;RPC.</span><br>
<span class="lineno"></span><span class="keyword" id="5133681">type</span>&nbsp;<span class="ident" id="5133686">Call</span>&nbsp;<span class="keyword" id="5133691">struct</span>&nbsp;<span class="op" id="5133698">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5133701">ServiceMethod</span>&nbsp;<span class="builtintype" id="5133715">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5133727">//&nbsp;The&nbsp;name&nbsp;of&nbsp;the&nbsp;service&nbsp;and&nbsp;method&nbsp;to&nbsp;call.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5133775">Args</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5133789">interface</span><span class="op" id="5133798">{</span><span class="op" id="5133799">}</span>&nbsp;<span class="comment" id="5133801">//&nbsp;The&nbsp;argument&nbsp;to&nbsp;the&nbsp;function&nbsp;(*struct).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5133845">Reply</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5133859">interface</span><span class="op" id="5133868">{</span><span class="op" id="5133869">}</span>&nbsp;<span class="comment" id="5133871">//&nbsp;The&nbsp;reply&nbsp;from&nbsp;the&nbsp;function&nbsp;(*struct).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5133914">Error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5133928">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5133940">//&nbsp;After&nbsp;completion,&nbsp;the&nbsp;error&nbsp;status.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5133980">Done</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5133994">chan</span>&nbsp;<span class="op" id="5133999">*</span><span class="ident" id="5134000">Call</span>&nbsp;&nbsp;<span class="comment" id="5134006">//&nbsp;Strobes&nbsp;when&nbsp;call&nbsp;is&nbsp;complete.</span><br>
<span class="lineno">35</span><span class="op" id="5134040">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5134043">//&nbsp;Client&nbsp;represents&nbsp;an&nbsp;RPC&nbsp;Client.</span><br>
<span class="lineno"></span><span class="comment" id="5134079">//&nbsp;There&nbsp;may&nbsp;be&nbsp;multiple&nbsp;outstanding&nbsp;Calls&nbsp;associated</span><br>
<span class="lineno"></span><span class="comment" id="5134133">//&nbsp;with&nbsp;a&nbsp;single&nbsp;Client,&nbsp;and&nbsp;a&nbsp;Client&nbsp;may&nbsp;be&nbsp;used&nbsp;by</span><br>
<span class="lineno">40</span><span class="comment" id="5134186">//&nbsp;multiple&nbsp;goroutines&nbsp;simultaneously.</span><br>
<span class="lineno"></span><span class="keyword" id="5134225">type</span>&nbsp;<span class="ident" id="5134230">Client</span>&nbsp;<span class="keyword" id="5134237">struct</span>&nbsp;<span class="op" id="5134244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5134247">codec</span>&nbsp;<span class="ident" id="5134253">ClientCodec</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5134267">reqMutex</span>&nbsp;<span class="ident" id="5134276">sync</span><span class="op" id="5134280">.</span><span class="ident" id="5134281">Mutex</span>&nbsp;<span class="comment" id="5134287">//&nbsp;protects&nbsp;following</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5134310">request</span>&nbsp;&nbsp;<span class="ident" id="5134319">Request</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5134329">mutex</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5134338">sync</span><span class="op" id="5134342">.</span><span class="ident" id="5134343">Mutex</span>&nbsp;<span class="comment" id="5134349">//&nbsp;protects&nbsp;following</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5134372">seq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5134381">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5134389">pending</span>&nbsp;&nbsp;<span class="keyword" id="5134398">map</span><span class="op" id="5134401">[</span><span class="ident" id="5134402">uint64</span><span class="op" id="5134408">]</span><span class="op" id="5134409">*</span><span class="ident" id="5134410">Call</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5134416">closing</span>&nbsp;&nbsp;<span class="builtintype" id="5134425">bool</span>&nbsp;<span class="comment" id="5134430">//&nbsp;user&nbsp;has&nbsp;called&nbsp;Close</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5134456">shutdown</span>&nbsp;<span class="builtintype" id="5134465">bool</span>&nbsp;<span class="comment" id="5134470">//&nbsp;server&nbsp;has&nbsp;told&nbsp;us&nbsp;to&nbsp;stop</span><br>
<span class="lineno"></span><span class="op" id="5134500">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5134503">//&nbsp;A&nbsp;ClientCodec&nbsp;implements&nbsp;writing&nbsp;of&nbsp;RPC&nbsp;requests&nbsp;and</span><br>
<span class="lineno">55</span><span class="comment" id="5134559">//&nbsp;reading&nbsp;of&nbsp;RPC&nbsp;responses&nbsp;for&nbsp;the&nbsp;client&nbsp;side&nbsp;of&nbsp;an&nbsp;RPC&nbsp;session.</span><br>
<span class="lineno"></span><span class="comment" id="5134626">//&nbsp;The&nbsp;client&nbsp;calls&nbsp;WriteRequest&nbsp;to&nbsp;write&nbsp;a&nbsp;request&nbsp;to&nbsp;the&nbsp;connection</span><br>
<span class="lineno"></span><span class="comment" id="5134696">//&nbsp;and&nbsp;calls&nbsp;ReadResponseHeader&nbsp;and&nbsp;ReadResponseBody&nbsp;in&nbsp;pairs</span><br>
<span class="lineno"></span><span class="comment" id="5134758">//&nbsp;to&nbsp;read&nbsp;responses.&nbsp;&nbsp;The&nbsp;client&nbsp;calls&nbsp;Close&nbsp;when&nbsp;finished&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5134827">//&nbsp;connection.&nbsp;ReadResponseBody&nbsp;may&nbsp;be&nbsp;called&nbsp;with&nbsp;a&nbsp;nil</span><br>
<span class="lineno">60</span><span class="comment" id="5134884">//&nbsp;argument&nbsp;to&nbsp;force&nbsp;the&nbsp;body&nbsp;of&nbsp;the&nbsp;response&nbsp;to&nbsp;be&nbsp;read&nbsp;and&nbsp;then</span><br>
<span class="lineno"></span><span class="comment" id="5134950">//&nbsp;discarded.</span><br>
<span class="lineno"></span><span class="keyword" id="5134964">type</span>&nbsp;<span class="ident" id="5134969">ClientCodec</span>&nbsp;<span class="keyword" id="5134981">interface</span>&nbsp;<span class="op" id="5134991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5134994">//&nbsp;WriteRequest&nbsp;must&nbsp;be&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5135067">WriteRequest</span><span class="op" id="5135079">(</span><span class="op" id="5135080">*</span><span class="ident" id="5135081">Request</span><span class="op" id="5135088">,</span>&nbsp;<span class="keyword" id="5135090">interface</span><span class="op" id="5135099">{</span><span class="op" id="5135100">}</span><span class="op" id="5135101">)</span>&nbsp;<span class="builtintype" id="5135103">error</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5135110">ReadResponseHeader</span><span class="op" id="5135128">(</span><span class="op" id="5135129">*</span><span class="ident" id="5135130">Response</span><span class="op" id="5135138">)</span>&nbsp;<span class="builtintype" id="5135140">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5135147">ReadResponseBody</span><span class="op" id="5135163">(</span><span class="keyword" id="5135164">interface</span><span class="op" id="5135173">{</span><span class="op" id="5135174">}</span><span class="op" id="5135175">)</span>&nbsp;<span class="builtintype" id="5135177">error</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5135185">Close</span><span class="op" id="5135190">(</span><span class="op" id="5135191">)</span>&nbsp;<span class="builtintype" id="5135193">error</span><br>
<span class="lineno"></span><span class="op" id="5135199">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="5135202">func</span>&nbsp;<span class="op" id="5135207">(</span><span class="ident" id="5135208">client</span>&nbsp;<span class="op" id="5135215">*</span><span class="ident" id="5135216">Client</span><span class="op" id="5135222">)</span>&nbsp;<span class="ident" id="5135224">send</span><span class="op" id="5135228">(</span><span class="ident" id="5135229">call</span>&nbsp;<span class="op" id="5135234">*</span><span class="ident" id="5135235">Call</span><span class="op" id="5135239">)</span>&nbsp;<span class="op" id="5135241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5135244">client</span><span class="op" id="5135250">.</span><span class="ident" id="5135251">reqMutex</span><span class="op" id="5135259">.</span><span class="ident" id="5135260">Lock</span><span class="op" id="5135264">(</span><span class="op" id="5135265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5135268">defer</span>&nbsp;<span class="ident" id="5135274">client</span><span class="op" id="5135280">.</span><span class="ident" id="5135281">reqMutex</span><span class="op" id="5135289">.</span><span class="ident" id="5135290">Unlock</span><span class="op" id="5135296">(</span><span class="op" id="5135297">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5135301">//&nbsp;Register&nbsp;this&nbsp;call.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5135325">client</span><span class="op" id="5135331">.</span><span class="ident" id="5135332">mutex</span><span class="op" id="5135337">.</span><span class="ident" id="5135338">Lock</span><span class="op" id="5135342">(</span><span class="op" id="5135343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5135346">if</span>&nbsp;<span class="ident" id="5135349">client</span><span class="op" id="5135355">.</span><span class="ident" id="5135356">shutdown</span>&nbsp;<span class="op" id="5135365">||</span>&nbsp;<span class="ident" id="5135368">client</span><span class="op" id="5135374">.</span><span class="ident" id="5135375">closing</span>&nbsp;<span class="op" id="5135383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5135387">call</span><span class="op" id="5135391">.</span><span class="ident" id="5135392">Error</span>&nbsp;<span class="op" id="5135398">=</span>&nbsp;<span class="ident" id="5135400">ErrShutdown</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5135414">client</span><span class="op" id="5135420">.</span><span class="ident" id="5135421">mutex</span><span class="op" id="5135426">.</span><span class="ident" id="5135427">Unlock</span><span class="op" id="5135433">(</span><span class="op" id="5135434">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5135438">call</span><span class="op" id="5135442">.</span><span class="ident" id="5135443">done</span><span class="op" id="5135447">(</span><span class="op" id="5135448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5135452">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5135460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5135463">seq</span>&nbsp;<span class="op" id="5135467">:=</span>&nbsp;<span class="ident" id="5135470">client</span><span class="op" id="5135476">.</span><span class="ident" id="5135477">seq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5135482">client</span><span class="op" id="5135488">.</span><span class="ident" id="5135489">seq</span><span class="op" id="5135492">++</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5135496">client</span><span class="op" id="5135502">.</span><span class="ident" id="5135503">pending</span><span class="op" id="5135510">[</span><span class="ident" id="5135511">seq</span><span class="op" id="5135514">]</span>&nbsp;<span class="op" id="5135516">=</span>&nbsp;<span class="ident" id="5135518">call</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5135524">client</span><span class="op" id="5135530">.</span><span class="ident" id="5135531">mutex</span><span class="op" id="5135536">.</span><span class="ident" id="5135537">Unlock</span><span class="op" id="5135543">(</span><span class="op" id="5135544">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5135548">//&nbsp;Encode&nbsp;and&nbsp;send&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5135581">client</span><span class="op" id="5135587">.</span><span class="ident" id="5135588">request</span><span class="op" id="5135595">.</span><span class="ident" id="5135596">Seq</span>&nbsp;<span class="op" id="5135600">=</span>&nbsp;<span class="ident" id="5135602">seq</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5135607">client</span><span class="op" id="5135613">.</span><span class="ident" id="5135614">request</span><span class="op" id="5135621">.</span><span class="ident" id="5135622">ServiceMethod</span>&nbsp;<span class="op" id="5135636">=</span>&nbsp;<span class="ident" id="5135638">call</span><span class="op" id="5135642">.</span><span class="ident" id="5135643">ServiceMethod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5135658">err</span>&nbsp;<span class="op" id="5135662">:=</span>&nbsp;<span class="ident" id="5135665">client</span><span class="op" id="5135671">.</span><span class="ident" id="5135672">codec</span><span class="op" id="5135677">.</span><span class="ident" id="5135678">WriteRequest</span><span class="op" id="5135690">(</span><span class="op" id="5135691">&amp;</span><span class="ident" id="5135692">client</span><span class="op" id="5135698">.</span><span class="ident" id="5135699">request</span><span class="op" id="5135706">,</span>&nbsp;<span class="ident" id="5135708">call</span><span class="op" id="5135712">.</span><span class="ident" id="5135713">Args</span><span class="op" id="5135717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5135720">if</span>&nbsp;<span class="ident" id="5135723">err</span>&nbsp;<span class="op" id="5135727">!=</span>&nbsp;<span class="ident" id="5135730">nil</span>&nbsp;<span class="op" id="5135734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5135738">client</span><span class="op" id="5135744">.</span><span class="ident" id="5135745">mutex</span><span class="op" id="5135750">.</span><span class="ident" id="5135751">Lock</span><span class="op" id="5135755">(</span><span class="op" id="5135756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5135760">call</span>&nbsp;<span class="op" id="5135765">=</span>&nbsp;<span class="ident" id="5135767">client</span><span class="op" id="5135773">.</span><span class="ident" id="5135774">pending</span><span class="op" id="5135781">[</span><span class="ident" id="5135782">seq</span><span class="op" id="5135785">]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5135789">delete</span><span class="op" id="5135795">(</span><span class="ident" id="5135796">client</span><span class="op" id="5135802">.</span><span class="ident" id="5135803">pending</span><span class="op" id="5135810">,</span>&nbsp;<span class="ident" id="5135812">seq</span><span class="op" id="5135815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5135819">client</span><span class="op" id="5135825">.</span><span class="ident" id="5135826">mutex</span><span class="op" id="5135831">.</span><span class="ident" id="5135832">Unlock</span><span class="op" id="5135838">(</span><span class="op" id="5135839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5135843">if</span>&nbsp;<span class="ident" id="5135846">call</span>&nbsp;<span class="op" id="5135851">!=</span>&nbsp;<span class="ident" id="5135854">nil</span>&nbsp;<span class="op" id="5135858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5135863">call</span><span class="op" id="5135867">.</span><span class="ident" id="5135868">Error</span>&nbsp;<span class="op" id="5135874">=</span>&nbsp;<span class="ident" id="5135876">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5135883">call</span><span class="op" id="5135887">.</span><span class="ident" id="5135888">done</span><span class="op" id="5135892">(</span><span class="op" id="5135893">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5135897">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5135900">}</span><br>
<span class="lineno"></span><span class="op" id="5135902">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5135905">func</span>&nbsp;<span class="op" id="5135910">(</span><span class="ident" id="5135911">client</span>&nbsp;<span class="op" id="5135918">*</span><span class="ident" id="5135919">Client</span><span class="op" id="5135925">)</span>&nbsp;<span class="ident" id="5135927">input</span><span class="op" id="5135932">(</span><span class="op" id="5135933">)</span>&nbsp;<span class="op" id="5135935">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5135938">var</span>&nbsp;<span class="ident" id="5135942">err</span>&nbsp;<span class="builtintype" id="5135946">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5135953">var</span>&nbsp;<span class="ident" id="5135957">response</span>&nbsp;<span class="ident" id="5135966">Response</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5135976">for</span>&nbsp;<span class="ident" id="5135980">err</span>&nbsp;<span class="op" id="5135984">==</span>&nbsp;<span class="ident" id="5135987">nil</span>&nbsp;<span class="op" id="5135991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5135995">response</span>&nbsp;<span class="op" id="5136004">=</span>&nbsp;<span class="ident" id="5136006">Response</span><span class="op" id="5136014">{</span><span class="op" id="5136015">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5136019">err</span>&nbsp;<span class="op" id="5136023">=</span>&nbsp;<span class="ident" id="5136025">client</span><span class="op" id="5136031">.</span><span class="ident" id="5136032">codec</span><span class="op" id="5136037">.</span><span class="ident" id="5136038">ReadResponseHeader</span><span class="op" id="5136056">(</span><span class="op" id="5136057">&amp;</span><span class="ident" id="5136058">response</span><span class="op" id="5136066">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5136070">if</span>&nbsp;<span class="ident" id="5136073">err</span>&nbsp;<span class="op" id="5136077">!=</span>&nbsp;<span class="ident" id="5136080">nil</span>&nbsp;<span class="op" id="5136084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5136089">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5136097">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5136101">seq</span>&nbsp;<span class="op" id="5136105">:=</span>&nbsp;<span class="ident" id="5136108">response</span><span class="op" id="5136116">.</span><span class="ident" id="5136117">Seq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5136123">client</span><span class="op" id="5136129">.</span><span class="ident" id="5136130">mutex</span><span class="op" id="5136135">.</span><span class="ident" id="5136136">Lock</span><span class="op" id="5136140">(</span><span class="op" id="5136141">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5136145">call</span>&nbsp;<span class="op" id="5136150">:=</span>&nbsp;<span class="ident" id="5136153">client</span><span class="op" id="5136159">.</span><span class="ident" id="5136160">pending</span><span class="op" id="5136167">[</span><span class="ident" id="5136168">seq</span><span class="op" id="5136171">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5136175">delete</span><span class="op" id="5136181">(</span><span class="ident" id="5136182">client</span><span class="op" id="5136188">.</span><span class="ident" id="5136189">pending</span><span class="op" id="5136196">,</span>&nbsp;<span class="ident" id="5136198">seq</span><span class="op" id="5136201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5136205">client</span><span class="op" id="5136211">.</span><span class="ident" id="5136212">mutex</span><span class="op" id="5136217">.</span><span class="ident" id="5136218">Unlock</span><span class="op" id="5136224">(</span><span class="op" id="5136225">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5136230">switch</span>&nbsp;<span class="op" id="5136237">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5136241">case</span>&nbsp;<span class="ident" id="5136246">call</span>&nbsp;<span class="op" id="5136251">==</span>&nbsp;<span class="ident" id="5136254">nil</span><span class="op" id="5136257">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5136262">//&nbsp;We&#39;ve&nbsp;got&nbsp;no&nbsp;pending&nbsp;call.&nbsp;That&nbsp;usually&nbsp;means&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5136319">//&nbsp;WriteRequest&nbsp;partially&nbsp;failed,&nbsp;and&nbsp;call&nbsp;was&nbsp;already</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5136377">//&nbsp;removed;&nbsp;response&nbsp;is&nbsp;a&nbsp;server&nbsp;telling&nbsp;us&nbsp;about&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5136433">//&nbsp;error&nbsp;reading&nbsp;request&nbsp;body.&nbsp;We&nbsp;should&nbsp;still&nbsp;attempt</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5136491">//&nbsp;to&nbsp;read&nbsp;error&nbsp;body,&nbsp;but&nbsp;there&#39;s&nbsp;no&nbsp;one&nbsp;to&nbsp;give&nbsp;it&nbsp;to.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5136551">err</span>&nbsp;<span class="op" id="5136555">=</span>&nbsp;<span class="ident" id="5136557">client</span><span class="op" id="5136563">.</span><span class="ident" id="5136564">codec</span><span class="op" id="5136569">.</span><span class="ident" id="5136570">ReadResponseBody</span><span class="op" id="5136586">(</span><span class="ident" id="5136587">nil</span><span class="op" id="5136590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5136595">if</span>&nbsp;<span class="ident" id="5136598">err</span>&nbsp;<span class="op" id="5136602">!=</span>&nbsp;<span class="ident" id="5136605">nil</span>&nbsp;<span class="op" id="5136609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5136615">err</span>&nbsp;<span class="op" id="5136619">=</span>&nbsp;<span class="ident" id="5136621">errors</span><span class="op" id="5136627">.</span><span class="ident" id="5136628">New</span><span class="op" id="5136631">(</span><span class="string" id="5136632">&#34;reading&nbsp;error&nbsp;body:&nbsp;&#34;</span>&nbsp;<span class="op" id="5136655">+</span>&nbsp;<span class="ident" id="5136657">err</span><span class="op" id="5136660">.</span><span class="ident" id="5136661">Error</span><span class="op" id="5136666">(</span><span class="op" id="5136667">)</span><span class="op" id="5136668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5136673">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5136677">case</span>&nbsp;<span class="ident" id="5136682">response</span><span class="op" id="5136690">.</span><span class="ident" id="5136691">Error</span>&nbsp;<span class="op" id="5136697">!=</span>&nbsp;<span class="string" id="5136700">&#34;&#34;</span><span class="op" id="5136702">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5136707">//&nbsp;We&#39;ve&nbsp;got&nbsp;an&nbsp;error&nbsp;response.&nbsp;Give&nbsp;this&nbsp;to&nbsp;the&nbsp;request;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5136768">//&nbsp;any&nbsp;subsequent&nbsp;requests&nbsp;will&nbsp;get&nbsp;the&nbsp;ReadResponseBody</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5136828">//&nbsp;error&nbsp;if&nbsp;there&nbsp;is&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5136857">call</span><span class="op" id="5136861">.</span><span class="ident" id="5136862">Error</span>&nbsp;<span class="op" id="5136868">=</span>&nbsp;<span class="ident" id="5136870">ServerError</span><span class="op" id="5136881">(</span><span class="ident" id="5136882">response</span><span class="op" id="5136890">.</span><span class="ident" id="5136891">Error</span><span class="op" id="5136896">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5136901">err</span>&nbsp;<span class="op" id="5136905">=</span>&nbsp;<span class="ident" id="5136907">client</span><span class="op" id="5136913">.</span><span class="ident" id="5136914">codec</span><span class="op" id="5136919">.</span><span class="ident" id="5136920">ReadResponseBody</span><span class="op" id="5136936">(</span><span class="ident" id="5136937">nil</span><span class="op" id="5136940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5136945">if</span>&nbsp;<span class="ident" id="5136948">err</span>&nbsp;<span class="op" id="5136952">!=</span>&nbsp;<span class="ident" id="5136955">nil</span>&nbsp;<span class="op" id="5136959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5136965">err</span>&nbsp;<span class="op" id="5136969">=</span>&nbsp;<span class="ident" id="5136971">errors</span><span class="op" id="5136977">.</span><span class="ident" id="5136978">New</span><span class="op" id="5136981">(</span><span class="string" id="5136982">&#34;reading&nbsp;error&nbsp;body:&nbsp;&#34;</span>&nbsp;<span class="op" id="5137005">+</span>&nbsp;<span class="ident" id="5137007">err</span><span class="op" id="5137010">.</span><span class="ident" id="5137011">Error</span><span class="op" id="5137016">(</span><span class="op" id="5137017">)</span><span class="op" id="5137018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5137023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5137028">call</span><span class="op" id="5137032">.</span><span class="ident" id="5137033">done</span><span class="op" id="5137037">(</span><span class="op" id="5137038">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5137042">default</span><span class="op" id="5137049">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5137054">err</span>&nbsp;<span class="op" id="5137058">=</span>&nbsp;<span class="ident" id="5137060">client</span><span class="op" id="5137066">.</span><span class="ident" id="5137067">codec</span><span class="op" id="5137072">.</span><span class="ident" id="5137073">ReadResponseBody</span><span class="op" id="5137089">(</span><span class="ident" id="5137090">call</span><span class="op" id="5137094">.</span><span class="ident" id="5137095">Reply</span><span class="op" id="5137100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5137105">if</span>&nbsp;<span class="ident" id="5137108">err</span>&nbsp;<span class="op" id="5137112">!=</span>&nbsp;<span class="ident" id="5137115">nil</span>&nbsp;<span class="op" id="5137119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5137125">call</span><span class="op" id="5137129">.</span><span class="ident" id="5137130">Error</span>&nbsp;<span class="op" id="5137136">=</span>&nbsp;<span class="ident" id="5137138">errors</span><span class="op" id="5137144">.</span><span class="ident" id="5137145">New</span><span class="op" id="5137148">(</span><span class="string" id="5137149">&#34;reading&nbsp;body&nbsp;&#34;</span>&nbsp;<span class="op" id="5137165">+</span>&nbsp;<span class="ident" id="5137167">err</span><span class="op" id="5137170">.</span><span class="ident" id="5137171">Error</span><span class="op" id="5137176">(</span><span class="op" id="5137177">)</span><span class="op" id="5137178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5137183">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5137188">call</span><span class="op" id="5137192">.</span><span class="ident" id="5137193">done</span><span class="op" id="5137197">(</span><span class="op" id="5137198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5137202">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5137205">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5137208">//&nbsp;Terminate&nbsp;pending&nbsp;calls.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5137237">client</span><span class="op" id="5137243">.</span><span class="ident" id="5137244">reqMutex</span><span class="op" id="5137252">.</span><span class="ident" id="5137253">Lock</span><span class="op" id="5137257">(</span><span class="op" id="5137258">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5137261">client</span><span class="op" id="5137267">.</span><span class="ident" id="5137268">mutex</span><span class="op" id="5137273">.</span><span class="ident" id="5137274">Lock</span><span class="op" id="5137278">(</span><span class="op" id="5137279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5137282">client</span><span class="op" id="5137288">.</span><span class="ident" id="5137289">shutdown</span>&nbsp;<span class="op" id="5137298">=</span>&nbsp;<span class="builtintype" id="5137300">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5137306">closing</span>&nbsp;<span class="op" id="5137314">:=</span>&nbsp;<span class="ident" id="5137317">client</span><span class="op" id="5137323">.</span><span class="ident" id="5137324">closing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5137333">if</span>&nbsp;<span class="ident" id="5137336">err</span>&nbsp;<span class="op" id="5137340">==</span>&nbsp;<span class="ident" id="5137343">io</span><span class="op" id="5137345">.</span><span class="ident" id="5137346">EOF</span>&nbsp;<span class="op" id="5137350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5137354">if</span>&nbsp;<span class="ident" id="5137357">closing</span>&nbsp;<span class="op" id="5137365">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5137370">err</span>&nbsp;<span class="op" id="5137374">=</span>&nbsp;<span class="ident" id="5137376">ErrShutdown</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5137390">}</span>&nbsp;<span class="keyword" id="5137392">else</span>&nbsp;<span class="op" id="5137397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5137402">err</span>&nbsp;<span class="op" id="5137406">=</span>&nbsp;<span class="ident" id="5137408">io</span><span class="op" id="5137410">.</span><span class="ident" id="5137411">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5137430">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5137433">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5137436">for</span>&nbsp;<span class="ident" id="5137440">_</span><span class="op" id="5137441">,</span>&nbsp;<span class="ident" id="5137443">call</span>&nbsp;<span class="op" id="5137448">:=</span>&nbsp;<span class="keyword" id="5137451">range</span>&nbsp;<span class="ident" id="5137457">client</span><span class="op" id="5137463">.</span><span class="ident" id="5137464">pending</span>&nbsp;<span class="op" id="5137472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5137476">call</span><span class="op" id="5137480">.</span><span class="ident" id="5137481">Error</span>&nbsp;<span class="op" id="5137487">=</span>&nbsp;<span class="ident" id="5137489">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5137495">call</span><span class="op" id="5137499">.</span><span class="ident" id="5137500">done</span><span class="op" id="5137504">(</span><span class="op" id="5137505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5137508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5137511">client</span><span class="op" id="5137517">.</span><span class="ident" id="5137518">mutex</span><span class="op" id="5137523">.</span><span class="ident" id="5137524">Unlock</span><span class="op" id="5137530">(</span><span class="op" id="5137531">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5137534">client</span><span class="op" id="5137540">.</span><span class="ident" id="5137541">reqMutex</span><span class="op" id="5137549">.</span><span class="ident" id="5137550">Unlock</span><span class="op" id="5137556">(</span><span class="op" id="5137557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5137560">if</span>&nbsp;<span class="ident" id="5137563">debugLog</span>&nbsp;<span class="op" id="5137572">&amp;&amp;</span>&nbsp;<span class="ident" id="5137575">err</span>&nbsp;<span class="op" id="5137579">!=</span>&nbsp;<span class="ident" id="5137582">io</span><span class="op" id="5137584">.</span><span class="ident" id="5137585">EOF</span>&nbsp;<span class="op" id="5137589">&amp;&amp;</span>&nbsp;<span class="op" id="5137592">!</span><span class="ident" id="5137593">closing</span>&nbsp;<span class="op" id="5137601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5137605">log</span><span class="op" id="5137608">.</span><span class="ident" id="5137609">Println</span><span class="op" id="5137616">(</span><span class="string" id="5137617">&#34;rpc:&nbsp;client&nbsp;protocol&nbsp;error:&#34;</span><span class="op" id="5137646">,</span>&nbsp;<span class="ident" id="5137648">err</span><span class="op" id="5137651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5137654">}</span><br>
<span class="lineno"></span><span class="op" id="5137656">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="5137659">func</span>&nbsp;<span class="op" id="5137664">(</span><span class="ident" id="5137665">call</span>&nbsp;<span class="op" id="5137670">*</span><span class="ident" id="5137671">Call</span><span class="op" id="5137675">)</span>&nbsp;<span class="ident" id="5137677">done</span><span class="op" id="5137681">(</span><span class="op" id="5137682">)</span>&nbsp;<span class="op" id="5137684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5137687">select</span>&nbsp;<span class="op" id="5137694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5137697">case</span>&nbsp;<span class="ident" id="5137702">call</span><span class="op" id="5137706">.</span><span class="ident" id="5137707">Done</span>&nbsp;<span class="op" id="5137712">&lt;-</span>&nbsp;<span class="ident" id="5137715">call</span><span class="op" id="5137719">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5137723">//&nbsp;ok</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5137730">default</span><span class="op" id="5137737">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5137741">//&nbsp;We&nbsp;don&#39;t&nbsp;want&nbsp;to&nbsp;block&nbsp;here.&nbsp;&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;make</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5137818">//&nbsp;sure&nbsp;the&nbsp;channel&nbsp;has&nbsp;enough&nbsp;buffer&nbsp;space.&nbsp;See&nbsp;comment&nbsp;in&nbsp;Go().</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5137886">if</span>&nbsp;<span class="ident" id="5137889">debugLog</span>&nbsp;<span class="op" id="5137898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5137903">log</span><span class="op" id="5137906">.</span><span class="ident" id="5137907">Println</span><span class="op" id="5137914">(</span><span class="string" id="5137915">&#34;rpc:&nbsp;discarding&nbsp;Call&nbsp;reply&nbsp;due&nbsp;to&nbsp;insufficient&nbsp;Done&nbsp;chan&nbsp;capacity&#34;</span><span class="op" id="5137982">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5137986">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5137989">}</span><br>
<span class="lineno"></span><span class="op" id="5137991">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5137994">//&nbsp;NewClient&nbsp;returns&nbsp;a&nbsp;new&nbsp;Client&nbsp;to&nbsp;handle&nbsp;requests&nbsp;to&nbsp;the</span><br>
<span class="lineno">185</span><span class="comment" id="5138054">//&nbsp;set&nbsp;of&nbsp;services&nbsp;at&nbsp;the&nbsp;other&nbsp;end&nbsp;of&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="5138109">//&nbsp;It&nbsp;adds&nbsp;a&nbsp;buffer&nbsp;to&nbsp;the&nbsp;write&nbsp;side&nbsp;of&nbsp;the&nbsp;connection&nbsp;so</span><br>
<span class="lineno"></span><span class="comment" id="5138168">//&nbsp;the&nbsp;header&nbsp;and&nbsp;payload&nbsp;are&nbsp;sent&nbsp;as&nbsp;a&nbsp;unit.</span><br>
<span class="lineno"></span><span class="keyword" id="5138214">func</span>&nbsp;<span class="ident" id="5138219">NewClient</span><span class="op" id="5138228">(</span><span class="ident" id="5138229">conn</span>&nbsp;<span class="ident" id="5138234">io</span><span class="op" id="5138236">.</span><span class="ident" id="5138237">ReadWriteCloser</span><span class="op" id="5138252">)</span>&nbsp;<span class="op" id="5138254">*</span><span class="ident" id="5138255">Client</span>&nbsp;<span class="op" id="5138262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5138265">encBuf</span>&nbsp;<span class="op" id="5138272">:=</span>&nbsp;<span class="ident" id="5138275">bufio</span><span class="op" id="5138280">.</span><span class="ident" id="5138281">NewWriter</span><span class="op" id="5138290">(</span><span class="ident" id="5138291">conn</span><span class="op" id="5138295">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5138298">client</span>&nbsp;<span class="op" id="5138305">:=</span>&nbsp;<span class="op" id="5138308">&amp;</span><span class="ident" id="5138309">gobClientCodec</span><span class="op" id="5138323">{</span><span class="ident" id="5138324">conn</span><span class="op" id="5138328">,</span>&nbsp;<span class="ident" id="5138330">gob</span><span class="op" id="5138333">.</span><span class="ident" id="5138334">NewDecoder</span><span class="op" id="5138344">(</span><span class="ident" id="5138345">conn</span><span class="op" id="5138349">)</span><span class="op" id="5138350">,</span>&nbsp;<span class="ident" id="5138352">gob</span><span class="op" id="5138355">.</span><span class="ident" id="5138356">NewEncoder</span><span class="op" id="5138366">(</span><span class="ident" id="5138367">encBuf</span><span class="op" id="5138373">)</span><span class="op" id="5138374">,</span>&nbsp;<span class="ident" id="5138376">encBuf</span><span class="op" id="5138382">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5138385">return</span>&nbsp;<span class="ident" id="5138392">NewClientWithCodec</span><span class="op" id="5138410">(</span><span class="ident" id="5138411">client</span><span class="op" id="5138417">)</span><br>
<span class="lineno"></span><span class="op" id="5138419">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5138422">//&nbsp;NewClientWithCodec&nbsp;is&nbsp;like&nbsp;NewClient&nbsp;but&nbsp;uses&nbsp;the&nbsp;specified</span><br>
<span class="lineno">195</span><span class="comment" id="5138485">//&nbsp;codec&nbsp;to&nbsp;encode&nbsp;requests&nbsp;and&nbsp;decode&nbsp;responses.</span><br>
<span class="lineno"></span><span class="keyword" id="5138535">func</span>&nbsp;<span class="ident" id="5138540">NewClientWithCodec</span><span class="op" id="5138558">(</span><span class="ident" id="5138559">codec</span>&nbsp;<span class="ident" id="5138565">ClientCodec</span><span class="op" id="5138576">)</span>&nbsp;<span class="op" id="5138578">*</span><span class="ident" id="5138579">Client</span>&nbsp;<span class="op" id="5138586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5138589">client</span>&nbsp;<span class="op" id="5138596">:=</span>&nbsp;<span class="op" id="5138599">&amp;</span><span class="ident" id="5138600">Client</span><span class="op" id="5138606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5138610">codec</span><span class="op" id="5138615">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5138619">codec</span><span class="op" id="5138624">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5138628">pending</span><span class="op" id="5138635">:</span>&nbsp;<span class="builtinfunc" id="5138637">make</span><span class="op" id="5138641">(</span><span class="keyword" id="5138642">map</span><span class="op" id="5138645">[</span><span class="ident" id="5138646">uint64</span><span class="op" id="5138652">]</span><span class="op" id="5138653">*</span><span class="ident" id="5138654">Call</span><span class="op" id="5138658">)</span><span class="op" id="5138659">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5138662">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5138665">go</span>&nbsp;<span class="ident" id="5138668">client</span><span class="op" id="5138674">.</span><span class="ident" id="5138675">input</span><span class="op" id="5138680">(</span><span class="op" id="5138681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5138684">return</span>&nbsp;<span class="ident" id="5138691">client</span><br>
<span class="lineno"></span><span class="op" id="5138698">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="keyword" id="5138701">type</span>&nbsp;<span class="ident" id="5138706">gobClientCodec</span>&nbsp;<span class="keyword" id="5138721">struct</span>&nbsp;<span class="op" id="5138728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5138731">rwc</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5138738">io</span><span class="op" id="5138740">.</span><span class="ident" id="5138741">ReadWriteCloser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5138758">dec</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5138765">*</span><span class="ident" id="5138766">gob</span><span class="op" id="5138769">.</span><span class="ident" id="5138770">Decoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5138779">enc</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5138786">*</span><span class="ident" id="5138787">gob</span><span class="op" id="5138790">.</span><span class="ident" id="5138791">Encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5138800">encBuf</span>&nbsp;<span class="op" id="5138807">*</span><span class="ident" id="5138808">bufio</span><span class="op" id="5138813">.</span><span class="ident" id="5138814">Writer</span><br>
<span class="lineno">210</span><span class="op" id="5138821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5138824">func</span>&nbsp;<span class="op" id="5138829">(</span><span class="ident" id="5138830">c</span>&nbsp;<span class="op" id="5138832">*</span><span class="ident" id="5138833">gobClientCodec</span><span class="op" id="5138847">)</span>&nbsp;<span class="ident" id="5138849">WriteRequest</span><span class="op" id="5138861">(</span><span class="ident" id="5138862">r</span>&nbsp;<span class="op" id="5138864">*</span><span class="ident" id="5138865">Request</span><span class="op" id="5138872">,</span>&nbsp;<span class="ident" id="5138874">body</span>&nbsp;<span class="keyword" id="5138879">interface</span><span class="op" id="5138888">{</span><span class="op" id="5138889">}</span><span class="op" id="5138890">)</span>&nbsp;<span class="op" id="5138892">(</span><span class="ident" id="5138893">err</span>&nbsp;<span class="builtintype" id="5138897">error</span><span class="op" id="5138902">)</span>&nbsp;<span class="op" id="5138904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5138907">if</span>&nbsp;<span class="ident" id="5138910">err</span>&nbsp;<span class="op" id="5138914">=</span>&nbsp;<span class="ident" id="5138916">c</span><span class="op" id="5138917">.</span><span class="ident" id="5138918">enc</span><span class="op" id="5138921">.</span><span class="ident" id="5138922">Encode</span><span class="op" id="5138928">(</span><span class="ident" id="5138929">r</span><span class="op" id="5138930">)</span><span class="op" id="5138931">;</span>&nbsp;<span class="ident" id="5138933">err</span>&nbsp;<span class="op" id="5138937">!=</span>&nbsp;<span class="ident" id="5138940">nil</span>&nbsp;<span class="op" id="5138944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5138948">return</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5138956">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5138959">if</span>&nbsp;<span class="ident" id="5138962">err</span>&nbsp;<span class="op" id="5138966">=</span>&nbsp;<span class="ident" id="5138968">c</span><span class="op" id="5138969">.</span><span class="ident" id="5138970">enc</span><span class="op" id="5138973">.</span><span class="ident" id="5138974">Encode</span><span class="op" id="5138980">(</span><span class="ident" id="5138981">body</span><span class="op" id="5138985">)</span><span class="op" id="5138986">;</span>&nbsp;<span class="ident" id="5138988">err</span>&nbsp;<span class="op" id="5138992">!=</span>&nbsp;<span class="ident" id="5138995">nil</span>&nbsp;<span class="op" id="5138999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5139003">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5139011">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5139014">return</span>&nbsp;<span class="ident" id="5139021">c</span><span class="op" id="5139022">.</span><span class="ident" id="5139023">encBuf</span><span class="op" id="5139029">.</span><span class="ident" id="5139030">Flush</span><span class="op" id="5139035">(</span><span class="op" id="5139036">)</span><br>
<span class="lineno">220</span><span class="op" id="5139038">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5139041">func</span>&nbsp;<span class="op" id="5139046">(</span><span class="ident" id="5139047">c</span>&nbsp;<span class="op" id="5139049">*</span><span class="ident" id="5139050">gobClientCodec</span><span class="op" id="5139064">)</span>&nbsp;<span class="ident" id="5139066">ReadResponseHeader</span><span class="op" id="5139084">(</span><span class="ident" id="5139085">r</span>&nbsp;<span class="op" id="5139087">*</span><span class="ident" id="5139088">Response</span><span class="op" id="5139096">)</span>&nbsp;<span class="builtintype" id="5139098">error</span>&nbsp;<span class="op" id="5139104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5139107">return</span>&nbsp;<span class="ident" id="5139114">c</span><span class="op" id="5139115">.</span><span class="ident" id="5139116">dec</span><span class="op" id="5139119">.</span><span class="ident" id="5139120">Decode</span><span class="op" id="5139126">(</span><span class="ident" id="5139127">r</span><span class="op" id="5139128">)</span><br>
<span class="lineno"></span><span class="op" id="5139130">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="keyword" id="5139133">func</span>&nbsp;<span class="op" id="5139138">(</span><span class="ident" id="5139139">c</span>&nbsp;<span class="op" id="5139141">*</span><span class="ident" id="5139142">gobClientCodec</span><span class="op" id="5139156">)</span>&nbsp;<span class="ident" id="5139158">ReadResponseBody</span><span class="op" id="5139174">(</span><span class="ident" id="5139175">body</span>&nbsp;<span class="keyword" id="5139180">interface</span><span class="op" id="5139189">{</span><span class="op" id="5139190">}</span><span class="op" id="5139191">)</span>&nbsp;<span class="builtintype" id="5139193">error</span>&nbsp;<span class="op" id="5139199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5139202">return</span>&nbsp;<span class="ident" id="5139209">c</span><span class="op" id="5139210">.</span><span class="ident" id="5139211">dec</span><span class="op" id="5139214">.</span><span class="ident" id="5139215">Decode</span><span class="op" id="5139221">(</span><span class="ident" id="5139222">body</span><span class="op" id="5139226">)</span><br>
<span class="lineno"></span><span class="op" id="5139228">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="5139231">func</span>&nbsp;<span class="op" id="5139236">(</span><span class="ident" id="5139237">c</span>&nbsp;<span class="op" id="5139239">*</span><span class="ident" id="5139240">gobClientCodec</span><span class="op" id="5139254">)</span>&nbsp;<span class="ident" id="5139256">Close</span><span class="op" id="5139261">(</span><span class="op" id="5139262">)</span>&nbsp;<span class="builtintype" id="5139264">error</span>&nbsp;<span class="op" id="5139270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5139273">return</span>&nbsp;<span class="ident" id="5139280">c</span><span class="op" id="5139281">.</span><span class="ident" id="5139282">rwc</span><span class="op" id="5139285">.</span><span class="ident" id="5139286">Close</span><span class="op" id="5139291">(</span><span class="op" id="5139292">)</span><br>
<span class="lineno"></span><span class="op" id="5139294">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5139297">//&nbsp;DialHTTP&nbsp;connects&nbsp;to&nbsp;an&nbsp;HTTP&nbsp;RPC&nbsp;server&nbsp;at&nbsp;the&nbsp;specified&nbsp;network&nbsp;address</span><br>
<span class="lineno">235</span><span class="comment" id="5139373">//&nbsp;listening&nbsp;on&nbsp;the&nbsp;default&nbsp;HTTP&nbsp;RPC&nbsp;path.</span><br>
<span class="lineno"></span><span class="keyword" id="5139416">func</span>&nbsp;<span class="ident" id="5139421">DialHTTP</span><span class="op" id="5139429">(</span><span class="ident" id="5139430">network</span><span class="op" id="5139437">,</span>&nbsp;<span class="ident" id="5139439">address</span>&nbsp;<span class="builtintype" id="5139447">string</span><span class="op" id="5139453">)</span>&nbsp;<span class="op" id="5139455">(</span><span class="op" id="5139456">*</span><span class="ident" id="5139457">Client</span><span class="op" id="5139463">,</span>&nbsp;<span class="builtintype" id="5139465">error</span><span class="op" id="5139470">)</span>&nbsp;<span class="op" id="5139472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5139475">return</span>&nbsp;<span class="ident" id="5139482">DialHTTPPath</span><span class="op" id="5139494">(</span><span class="ident" id="5139495">network</span><span class="op" id="5139502">,</span>&nbsp;<span class="ident" id="5139504">address</span><span class="op" id="5139511">,</span>&nbsp;<span class="ident" id="5139513">DefaultRPCPath</span><span class="op" id="5139527">)</span><br>
<span class="lineno"></span><span class="op" id="5139529">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="comment" id="5139532">//&nbsp;DialHTTPPath&nbsp;connects&nbsp;to&nbsp;an&nbsp;HTTP&nbsp;RPC&nbsp;server</span><br>
<span class="lineno"></span><span class="comment" id="5139579">//&nbsp;at&nbsp;the&nbsp;specified&nbsp;network&nbsp;address&nbsp;and&nbsp;path.</span><br>
<span class="lineno"></span><span class="keyword" id="5139625">func</span>&nbsp;<span class="ident" id="5139630">DialHTTPPath</span><span class="op" id="5139642">(</span><span class="ident" id="5139643">network</span><span class="op" id="5139650">,</span>&nbsp;<span class="ident" id="5139652">address</span><span class="op" id="5139659">,</span>&nbsp;<span class="ident" id="5139661">path</span>&nbsp;<span class="builtintype" id="5139666">string</span><span class="op" id="5139672">)</span>&nbsp;<span class="op" id="5139674">(</span><span class="op" id="5139675">*</span><span class="ident" id="5139676">Client</span><span class="op" id="5139682">,</span>&nbsp;<span class="builtintype" id="5139684">error</span><span class="op" id="5139689">)</span>&nbsp;<span class="op" id="5139691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5139694">var</span>&nbsp;<span class="ident" id="5139698">err</span>&nbsp;<span class="builtintype" id="5139702">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5139709">conn</span><span class="op" id="5139713">,</span>&nbsp;<span class="ident" id="5139715">err</span>&nbsp;<span class="op" id="5139719">:=</span>&nbsp;<span class="ident" id="5139722">net</span><span class="op" id="5139725">.</span><span class="ident" id="5139726">Dial</span><span class="op" id="5139730">(</span><span class="ident" id="5139731">network</span><span class="op" id="5139738">,</span>&nbsp;<span class="ident" id="5139740">address</span><span class="op" id="5139747">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5139750">if</span>&nbsp;<span class="ident" id="5139753">err</span>&nbsp;<span class="op" id="5139757">!=</span>&nbsp;<span class="ident" id="5139760">nil</span>&nbsp;<span class="op" id="5139764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5139768">return</span>&nbsp;<span class="ident" id="5139775">nil</span><span class="op" id="5139778">,</span>&nbsp;<span class="ident" id="5139780">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5139785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5139788">io</span><span class="op" id="5139790">.</span><span class="ident" id="5139791">WriteString</span><span class="op" id="5139802">(</span><span class="ident" id="5139803">conn</span><span class="op" id="5139807">,</span>&nbsp;<span class="string" id="5139809">&#34;CONNECT&nbsp;&#34;</span><span class="op" id="5139819">+</span><span class="ident" id="5139820">path</span><span class="op" id="5139824">+</span><span class="string" id="5139825">&#34;&nbsp;HTTP/1.0\n\n&#34;</span><span class="op" id="5139840">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5139844">//&nbsp;Require&nbsp;successful&nbsp;HTTP&nbsp;response</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5139881">//&nbsp;before&nbsp;switching&nbsp;to&nbsp;RPC&nbsp;protocol.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5139919">resp</span><span class="op" id="5139923">,</span>&nbsp;<span class="ident" id="5139925">err</span>&nbsp;<span class="op" id="5139929">:=</span>&nbsp;<span class="ident" id="5139932">http</span><span class="op" id="5139936">.</span><span class="ident" id="5139937">ReadResponse</span><span class="op" id="5139949">(</span><span class="ident" id="5139950">bufio</span><span class="op" id="5139955">.</span><span class="ident" id="5139956">NewReader</span><span class="op" id="5139965">(</span><span class="ident" id="5139966">conn</span><span class="op" id="5139970">)</span><span class="op" id="5139971">,</span>&nbsp;<span class="op" id="5139973">&amp;</span><span class="ident" id="5139974">http</span><span class="op" id="5139978">.</span><span class="ident" id="5139979">Request</span><span class="op" id="5139986">{</span><span class="ident" id="5139987">Method</span><span class="op" id="5139993">:</span>&nbsp;<span class="string" id="5139995">&#34;CONNECT&#34;</span><span class="op" id="5140004">}</span><span class="op" id="5140005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5140008">if</span>&nbsp;<span class="ident" id="5140011">err</span>&nbsp;<span class="op" id="5140015">==</span>&nbsp;<span class="ident" id="5140018">nil</span>&nbsp;<span class="op" id="5140022">&amp;&amp;</span>&nbsp;<span class="ident" id="5140025">resp</span><span class="op" id="5140029">.</span><span class="ident" id="5140030">Status</span>&nbsp;<span class="op" id="5140037">==</span>&nbsp;<span class="ident" id="5140040">connected</span>&nbsp;<span class="op" id="5140050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5140054">return</span>&nbsp;<span class="ident" id="5140061">NewClient</span><span class="op" id="5140070">(</span><span class="ident" id="5140071">conn</span><span class="op" id="5140075">)</span><span class="op" id="5140076">,</span>&nbsp;<span class="ident" id="5140078">nil</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5140083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5140086">if</span>&nbsp;<span class="ident" id="5140089">err</span>&nbsp;<span class="op" id="5140093">==</span>&nbsp;<span class="ident" id="5140096">nil</span>&nbsp;<span class="op" id="5140100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5140104">err</span>&nbsp;<span class="op" id="5140108">=</span>&nbsp;<span class="ident" id="5140110">errors</span><span class="op" id="5140116">.</span><span class="ident" id="5140117">New</span><span class="op" id="5140120">(</span><span class="string" id="5140121">&#34;unexpected&nbsp;HTTP&nbsp;response:&nbsp;&#34;</span>&nbsp;<span class="op" id="5140150">+</span>&nbsp;<span class="ident" id="5140152">resp</span><span class="op" id="5140156">.</span><span class="ident" id="5140157">Status</span><span class="op" id="5140163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5140166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5140169">conn</span><span class="op" id="5140173">.</span><span class="ident" id="5140174">Close</span><span class="op" id="5140179">(</span><span class="op" id="5140180">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5140183">return</span>&nbsp;<span class="ident" id="5140190">nil</span><span class="op" id="5140193">,</span>&nbsp;<span class="op" id="5140195">&amp;</span><span class="ident" id="5140196">net</span><span class="op" id="5140199">.</span><span class="ident" id="5140200">OpError</span><span class="op" id="5140207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5140211">Op</span><span class="op" id="5140213">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="5140217">&#34;dial-http&#34;</span><span class="op" id="5140228">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5140232">Net</span><span class="op" id="5140235">:</span>&nbsp;&nbsp;<span class="ident" id="5140238">network</span>&nbsp;<span class="op" id="5140246">+</span>&nbsp;<span class="string" id="5140248">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="5140252">+</span>&nbsp;<span class="ident" id="5140254">address</span><span class="op" id="5140261">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5140265">Addr</span><span class="op" id="5140269">:</span>&nbsp;<span class="ident" id="5140271">nil</span><span class="op" id="5140274">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5140278">Err</span><span class="op" id="5140281">:</span>&nbsp;&nbsp;<span class="ident" id="5140284">err</span><span class="op" id="5140287">,</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5140290">}</span><br>
<span class="lineno"></span><span class="op" id="5140292">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5140295">//&nbsp;Dial&nbsp;connects&nbsp;to&nbsp;an&nbsp;RPC&nbsp;server&nbsp;at&nbsp;the&nbsp;specified&nbsp;network&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="5140363">func</span>&nbsp;<span class="ident" id="5140368">Dial</span><span class="op" id="5140372">(</span><span class="ident" id="5140373">network</span><span class="op" id="5140380">,</span>&nbsp;<span class="ident" id="5140382">address</span>&nbsp;<span class="builtintype" id="5140390">string</span><span class="op" id="5140396">)</span>&nbsp;<span class="op" id="5140398">(</span><span class="op" id="5140399">*</span><span class="ident" id="5140400">Client</span><span class="op" id="5140406">,</span>&nbsp;<span class="builtintype" id="5140408">error</span><span class="op" id="5140413">)</span>&nbsp;<span class="op" id="5140415">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5140418">conn</span><span class="op" id="5140422">,</span>&nbsp;<span class="ident" id="5140424">err</span>&nbsp;<span class="op" id="5140428">:=</span>&nbsp;<span class="ident" id="5140431">net</span><span class="op" id="5140434">.</span><span class="ident" id="5140435">Dial</span><span class="op" id="5140439">(</span><span class="ident" id="5140440">network</span><span class="op" id="5140447">,</span>&nbsp;<span class="ident" id="5140449">address</span><span class="op" id="5140456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5140459">if</span>&nbsp;<span class="ident" id="5140462">err</span>&nbsp;<span class="op" id="5140466">!=</span>&nbsp;<span class="ident" id="5140469">nil</span>&nbsp;<span class="op" id="5140473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5140477">return</span>&nbsp;<span class="ident" id="5140484">nil</span><span class="op" id="5140487">,</span>&nbsp;<span class="ident" id="5140489">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5140494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5140497">return</span>&nbsp;<span class="ident" id="5140504">NewClient</span><span class="op" id="5140513">(</span><span class="ident" id="5140514">conn</span><span class="op" id="5140518">)</span><span class="op" id="5140519">,</span>&nbsp;<span class="ident" id="5140521">nil</span><br>
<span class="lineno">275</span><span class="op" id="5140525">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5140528">func</span>&nbsp;<span class="op" id="5140533">(</span><span class="ident" id="5140534">client</span>&nbsp;<span class="op" id="5140541">*</span><span class="ident" id="5140542">Client</span><span class="op" id="5140548">)</span>&nbsp;<span class="ident" id="5140550">Close</span><span class="op" id="5140555">(</span><span class="op" id="5140556">)</span>&nbsp;<span class="builtintype" id="5140558">error</span>&nbsp;<span class="op" id="5140564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5140567">client</span><span class="op" id="5140573">.</span><span class="ident" id="5140574">mutex</span><span class="op" id="5140579">.</span><span class="ident" id="5140580">Lock</span><span class="op" id="5140584">(</span><span class="op" id="5140585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5140588">if</span>&nbsp;<span class="ident" id="5140591">client</span><span class="op" id="5140597">.</span><span class="ident" id="5140598">closing</span>&nbsp;<span class="op" id="5140606">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5140610">client</span><span class="op" id="5140616">.</span><span class="ident" id="5140617">mutex</span><span class="op" id="5140622">.</span><span class="ident" id="5140623">Unlock</span><span class="op" id="5140629">(</span><span class="op" id="5140630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5140634">return</span>&nbsp;<span class="ident" id="5140641">ErrShutdown</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5140654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5140657">client</span><span class="op" id="5140663">.</span><span class="ident" id="5140664">closing</span>&nbsp;<span class="op" id="5140672">=</span>&nbsp;<span class="builtintype" id="5140674">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5140680">client</span><span class="op" id="5140686">.</span><span class="ident" id="5140687">mutex</span><span class="op" id="5140692">.</span><span class="ident" id="5140693">Unlock</span><span class="op" id="5140699">(</span><span class="op" id="5140700">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5140703">return</span>&nbsp;<span class="ident" id="5140710">client</span><span class="op" id="5140716">.</span><span class="ident" id="5140717">codec</span><span class="op" id="5140722">.</span><span class="ident" id="5140723">Close</span><span class="op" id="5140728">(</span><span class="op" id="5140729">)</span><br>
<span class="lineno"></span><span class="op" id="5140731">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5140734">//&nbsp;Go&nbsp;invokes&nbsp;the&nbsp;function&nbsp;asynchronously.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;Call&nbsp;structure&nbsp;representing</span><br>
<span class="lineno"></span><span class="comment" id="5140821">//&nbsp;the&nbsp;invocation.&nbsp;&nbsp;The&nbsp;done&nbsp;channel&nbsp;will&nbsp;signal&nbsp;when&nbsp;the&nbsp;call&nbsp;is&nbsp;complete&nbsp;by&nbsp;returning</span><br>
<span class="lineno">290</span><span class="comment" id="5140909">//&nbsp;the&nbsp;same&nbsp;Call&nbsp;object.&nbsp;&nbsp;If&nbsp;done&nbsp;is&nbsp;nil,&nbsp;Go&nbsp;will&nbsp;allocate&nbsp;a&nbsp;new&nbsp;channel.</span><br>
<span class="lineno"></span><span class="comment" id="5140983">//&nbsp;If&nbsp;non-nil,&nbsp;done&nbsp;must&nbsp;be&nbsp;buffered&nbsp;or&nbsp;Go&nbsp;will&nbsp;deliberately&nbsp;crash.</span><br>
<span class="lineno"></span><span class="keyword" id="5141051">func</span>&nbsp;<span class="op" id="5141056">(</span><span class="ident" id="5141057">client</span>&nbsp;<span class="op" id="5141064">*</span><span class="ident" id="5141065">Client</span><span class="op" id="5141071">)</span>&nbsp;<span class="ident" id="5141073">Go</span><span class="op" id="5141075">(</span><span class="ident" id="5141076">serviceMethod</span>&nbsp;<span class="builtintype" id="5141090">string</span><span class="op" id="5141096">,</span>&nbsp;<span class="ident" id="5141098">args</span>&nbsp;<span class="keyword" id="5141103">interface</span><span class="op" id="5141112">{</span><span class="op" id="5141113">}</span><span class="op" id="5141114">,</span>&nbsp;<span class="ident" id="5141116">reply</span>&nbsp;<span class="keyword" id="5141122">interface</span><span class="op" id="5141131">{</span><span class="op" id="5141132">}</span><span class="op" id="5141133">,</span>&nbsp;<span class="ident" id="5141135">done</span>&nbsp;<span class="keyword" id="5141140">chan</span>&nbsp;<span class="op" id="5141145">*</span><span class="ident" id="5141146">Call</span><span class="op" id="5141150">)</span>&nbsp;<span class="op" id="5141152">*</span><span class="ident" id="5141153">Call</span>&nbsp;<span class="op" id="5141158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5141161">call</span>&nbsp;<span class="op" id="5141166">:=</span>&nbsp;<span class="builtinfunc" id="5141169">new</span><span class="op" id="5141172">(</span><span class="ident" id="5141173">Call</span><span class="op" id="5141177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5141180">call</span><span class="op" id="5141184">.</span><span class="ident" id="5141185">ServiceMethod</span>&nbsp;<span class="op" id="5141199">=</span>&nbsp;<span class="ident" id="5141201">serviceMethod</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5141216">call</span><span class="op" id="5141220">.</span><span class="ident" id="5141221">Args</span>&nbsp;<span class="op" id="5141226">=</span>&nbsp;<span class="ident" id="5141228">args</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5141234">call</span><span class="op" id="5141238">.</span><span class="ident" id="5141239">Reply</span>&nbsp;<span class="op" id="5141245">=</span>&nbsp;<span class="ident" id="5141247">reply</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5141254">if</span>&nbsp;<span class="ident" id="5141257">done</span>&nbsp;<span class="op" id="5141262">==</span>&nbsp;<span class="ident" id="5141265">nil</span>&nbsp;<span class="op" id="5141269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5141273">done</span>&nbsp;<span class="op" id="5141278">=</span>&nbsp;<span class="builtinfunc" id="5141280">make</span><span class="op" id="5141284">(</span><span class="keyword" id="5141285">chan</span>&nbsp;<span class="op" id="5141290">*</span><span class="ident" id="5141291">Call</span><span class="op" id="5141295">,</span>&nbsp;<span class="num" id="5141297">10</span><span class="op" id="5141299">)</span>&nbsp;<span class="comment" id="5141301">//&nbsp;buffered.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5141315">}</span>&nbsp;<span class="keyword" id="5141317">else</span>&nbsp;<span class="op" id="5141322">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5141326">//&nbsp;If&nbsp;caller&nbsp;passes&nbsp;done&nbsp;!=&nbsp;nil,&nbsp;it&nbsp;must&nbsp;arrange&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5141382">//&nbsp;done&nbsp;has&nbsp;enough&nbsp;buffer&nbsp;for&nbsp;the&nbsp;number&nbsp;of&nbsp;simultaneous</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5141441">//&nbsp;RPCs&nbsp;that&nbsp;will&nbsp;be&nbsp;using&nbsp;that&nbsp;channel.&nbsp;&nbsp;If&nbsp;the&nbsp;channel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5141500">//&nbsp;is&nbsp;totally&nbsp;unbuffered,&nbsp;it&#39;s&nbsp;best&nbsp;not&nbsp;to&nbsp;run&nbsp;at&nbsp;all.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5141557">if</span>&nbsp;<span class="builtinfunc" id="5141560">cap</span><span class="op" id="5141563">(</span><span class="ident" id="5141564">done</span><span class="op" id="5141568">)</span>&nbsp;<span class="op" id="5141570">==</span>&nbsp;<span class="num" id="5141573">0</span>&nbsp;<span class="op" id="5141575">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5141580">log</span><span class="op" id="5141583">.</span><span class="ident" id="5141584">Panic</span><span class="op" id="5141589">(</span><span class="string" id="5141590">&#34;rpc:&nbsp;done&nbsp;channel&nbsp;is&nbsp;unbuffered&#34;</span><span class="op" id="5141623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5141627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5141630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5141633">call</span><span class="op" id="5141637">.</span><span class="ident" id="5141638">Done</span>&nbsp;<span class="op" id="5141643">=</span>&nbsp;<span class="ident" id="5141645">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5141651">client</span><span class="op" id="5141657">.</span><span class="ident" id="5141658">send</span><span class="op" id="5141662">(</span><span class="ident" id="5141663">call</span><span class="op" id="5141667">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5141670">return</span>&nbsp;<span class="ident" id="5141677">call</span><br>
<span class="lineno"></span><span class="op" id="5141682">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5141685">//&nbsp;Call&nbsp;invokes&nbsp;the&nbsp;named&nbsp;function,&nbsp;waits&nbsp;for&nbsp;it&nbsp;to&nbsp;complete,&nbsp;and&nbsp;returns&nbsp;its&nbsp;error&nbsp;status.</span><br>
<span class="lineno"></span><span class="keyword" id="5141777">func</span>&nbsp;<span class="op" id="5141782">(</span><span class="ident" id="5141783">client</span>&nbsp;<span class="op" id="5141790">*</span><span class="ident" id="5141791">Client</span><span class="op" id="5141797">)</span>&nbsp;<span class="ident" id="5141799">Call</span><span class="op" id="5141803">(</span><span class="ident" id="5141804">serviceMethod</span>&nbsp;<span class="builtintype" id="5141818">string</span><span class="op" id="5141824">,</span>&nbsp;<span class="ident" id="5141826">args</span>&nbsp;<span class="keyword" id="5141831">interface</span><span class="op" id="5141840">{</span><span class="op" id="5141841">}</span><span class="op" id="5141842">,</span>&nbsp;<span class="ident" id="5141844">reply</span>&nbsp;<span class="keyword" id="5141850">interface</span><span class="op" id="5141859">{</span><span class="op" id="5141860">}</span><span class="op" id="5141861">)</span>&nbsp;<span class="builtintype" id="5141863">error</span>&nbsp;<span class="op" id="5141869">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5141872">call</span>&nbsp;<span class="op" id="5141877">:=</span>&nbsp;<span class="op" id="5141880">&lt;-</span><span class="ident" id="5141882">client</span><span class="op" id="5141888">.</span><span class="ident" id="5141889">Go</span><span class="op" id="5141891">(</span><span class="ident" id="5141892">serviceMethod</span><span class="op" id="5141905">,</span>&nbsp;<span class="ident" id="5141907">args</span><span class="op" id="5141911">,</span>&nbsp;<span class="ident" id="5141913">reply</span><span class="op" id="5141918">,</span>&nbsp;<span class="builtinfunc" id="5141920">make</span><span class="op" id="5141924">(</span><span class="keyword" id="5141925">chan</span>&nbsp;<span class="op" id="5141930">*</span><span class="ident" id="5141931">Call</span><span class="op" id="5141935">,</span>&nbsp;<span class="num" id="5141937">1</span><span class="op" id="5141938">)</span><span class="op" id="5141939">)</span><span class="op" id="5141940">.</span><span class="ident" id="5141941">Done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5141947">return</span>&nbsp;<span class="ident" id="5141954">call</span><span class="op" id="5141958">.</span><span class="ident" id="5141959">Error</span><br>
<span class="lineno"></span><span class="op" id="5141965">}</span>
</div>
</body>
</html>
