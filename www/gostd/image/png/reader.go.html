<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/png</h2>
<ul>
<li><a href="/gostd/image/png/paeth.go.html">paeth.go</a></li>
<li><a href="/gostd/image/png/paeth_test.go.html">paeth_test.go</a></li>
<li><a href="/gostd/image/png/reader.go.html" class="current">reader.go</a></li>
<li><a href="/gostd/image/png/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/png/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/png/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5556655">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5556710">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5556764">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5556815">//&nbsp;Package&nbsp;png&nbsp;implements&nbsp;a&nbsp;PNG&nbsp;image&nbsp;decoder&nbsp;and&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="comment" id="5556874">//</span><br>
<span class="lineno"></span><span class="comment" id="5556877">//&nbsp;The&nbsp;PNG&nbsp;specification&nbsp;is&nbsp;at&nbsp;http://www.w3.org/TR/PNG/.</span><br>
<span class="lineno"></span><span class="keyword" id="5556935">package</span>&nbsp;<span class="ident" id="5556943">png</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="5556948">import</span>&nbsp;<span class="op" id="5556955">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5556958">&#34;compress/zlib&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5556975">&#34;encoding/binary&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5556994">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5557001">&#34;hash&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5557009">&#34;hash/crc32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5557023">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5557032">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5557047">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="5557052">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="5557055">//&nbsp;Color&nbsp;type,&nbsp;as&nbsp;per&nbsp;the&nbsp;PNG&nbsp;spec.</span><br>
<span class="lineno"></span><span class="keyword" id="5557091">const</span>&nbsp;<span class="op" id="5557097">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5557100">ctGrayscale</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5557117">=</span>&nbsp;<span class="num" id="5557119">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5557122">ctTrueColor</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5557139">=</span>&nbsp;<span class="num" id="5557141">2</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5557144">ctPaletted</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5557161">=</span>&nbsp;<span class="num" id="5557163">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5557166">ctGrayscaleAlpha</span>&nbsp;<span class="op" id="5557183">=</span>&nbsp;<span class="num" id="5557185">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5557188">ctTrueColorAlpha</span>&nbsp;<span class="op" id="5557205">=</span>&nbsp;<span class="num" id="5557207">6</span><br>
<span class="lineno"></span><span class="op" id="5557209">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="5557212">//&nbsp;A&nbsp;cb&nbsp;is&nbsp;a&nbsp;combination&nbsp;of&nbsp;color&nbsp;type&nbsp;and&nbsp;bit&nbsp;depth.</span><br>
<span class="lineno"></span><span class="keyword" id="5557266">const</span>&nbsp;<span class="op" id="5557272">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5557275">cbInvalid</span>&nbsp;<span class="op" id="5557285">=</span>&nbsp;<span class="ident" id="5557287">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5557293">cbG1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5557299">cbG2</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5557305">cbG4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5557311">cbG8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5557317">cbGA8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5557324">cbTC8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5557331">cbP1</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5557337">cbP2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5557343">cbP4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5557349">cbP8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5557355">cbTCA8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5557363">cbG16</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5557370">cbGA16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5557378">cbTC16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5557386">cbTCA16</span><br>
<span class="lineno"></span><span class="op" id="5557394">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="5557397">//&nbsp;Filter&nbsp;type,&nbsp;as&nbsp;per&nbsp;the&nbsp;PNG&nbsp;spec.</span><br>
<span class="lineno"></span><span class="keyword" id="5557434">const</span>&nbsp;<span class="op" id="5557440">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5557443">ftNone</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5557453">=</span>&nbsp;<span class="num" id="5557455">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5557458">ftSub</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5557468">=</span>&nbsp;<span class="num" id="5557470">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5557473">ftUp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5557483">=</span>&nbsp;<span class="num" id="5557485">2</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5557488">ftAverage</span>&nbsp;<span class="op" id="5557498">=</span>&nbsp;<span class="num" id="5557500">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5557503">ftPaeth</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5557513">=</span>&nbsp;<span class="num" id="5557515">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5557518">nFilter</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5557528">=</span>&nbsp;<span class="num" id="5557530">5</span><br>
<span class="lineno"></span><span class="op" id="5557532">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="5557535">//&nbsp;Interlace&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="5557554">const</span>&nbsp;<span class="op" id="5557560">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5557563">itNone</span>&nbsp;&nbsp;<span class="op" id="5557571">=</span>&nbsp;<span class="num" id="5557573">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5557576">itAdam7</span>&nbsp;<span class="op" id="5557584">=</span>&nbsp;<span class="num" id="5557586">1</span><br>
<span class="lineno"></span><span class="op" id="5557588">)</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="comment" id="5557591">//&nbsp;interlaceScan&nbsp;defines&nbsp;the&nbsp;placement&nbsp;and&nbsp;size&nbsp;of&nbsp;a&nbsp;pass&nbsp;for&nbsp;Adam7&nbsp;interlacing.</span><br>
<span class="lineno"></span><span class="keyword" id="5557672">type</span>&nbsp;<span class="ident" id="5557677">interlaceScan</span>&nbsp;<span class="keyword" id="5557691">struct</span>&nbsp;<span class="op" id="5557698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5557701">xFactor</span><span class="op" id="5557708">,</span>&nbsp;<span class="ident" id="5557710">yFactor</span><span class="op" id="5557717">,</span>&nbsp;<span class="ident" id="5557719">xOffset</span><span class="op" id="5557726">,</span>&nbsp;<span class="ident" id="5557728">yOffset</span>&nbsp;<span class="builtintype" id="5557736">int</span><br>
<span class="lineno"></span><span class="op" id="5557740">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="5557743">//&nbsp;interlacing&nbsp;defines&nbsp;Adam7&nbsp;interlacing,&nbsp;with&nbsp;7&nbsp;passes&nbsp;of&nbsp;reduced&nbsp;images.</span><br>
<span class="lineno"></span><span class="comment" id="5557818">//&nbsp;See&nbsp;http://www.w3.org/TR/PNG/#8Interlace</span><br>
<span class="lineno"></span><span class="keyword" id="5557862">var</span>&nbsp;<span class="ident" id="5557866">interlacing</span>&nbsp;<span class="op" id="5557878">=</span>&nbsp;<span class="op" id="5557880">[</span><span class="op" id="5557881">]</span><span class="ident" id="5557882">interlaceScan</span><span class="op" id="5557895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5557898">{</span><span class="num" id="5557899">8</span><span class="op" id="5557900">,</span>&nbsp;<span class="num" id="5557902">8</span><span class="op" id="5557903">,</span>&nbsp;<span class="num" id="5557905">0</span><span class="op" id="5557906">,</span>&nbsp;<span class="num" id="5557908">0</span><span class="op" id="5557909">}</span><span class="op" id="5557910">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5557913">{</span><span class="num" id="5557914">8</span><span class="op" id="5557915">,</span>&nbsp;<span class="num" id="5557917">8</span><span class="op" id="5557918">,</span>&nbsp;<span class="num" id="5557920">4</span><span class="op" id="5557921">,</span>&nbsp;<span class="num" id="5557923">0</span><span class="op" id="5557924">}</span><span class="op" id="5557925">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5557928">{</span><span class="num" id="5557929">4</span><span class="op" id="5557930">,</span>&nbsp;<span class="num" id="5557932">8</span><span class="op" id="5557933">,</span>&nbsp;<span class="num" id="5557935">0</span><span class="op" id="5557936">,</span>&nbsp;<span class="num" id="5557938">4</span><span class="op" id="5557939">}</span><span class="op" id="5557940">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5557943">{</span><span class="num" id="5557944">4</span><span class="op" id="5557945">,</span>&nbsp;<span class="num" id="5557947">4</span><span class="op" id="5557948">,</span>&nbsp;<span class="num" id="5557950">2</span><span class="op" id="5557951">,</span>&nbsp;<span class="num" id="5557953">0</span><span class="op" id="5557954">}</span><span class="op" id="5557955">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5557958">{</span><span class="num" id="5557959">2</span><span class="op" id="5557960">,</span>&nbsp;<span class="num" id="5557962">4</span><span class="op" id="5557963">,</span>&nbsp;<span class="num" id="5557965">0</span><span class="op" id="5557966">,</span>&nbsp;<span class="num" id="5557968">2</span><span class="op" id="5557969">}</span><span class="op" id="5557970">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5557973">{</span><span class="num" id="5557974">2</span><span class="op" id="5557975">,</span>&nbsp;<span class="num" id="5557977">2</span><span class="op" id="5557978">,</span>&nbsp;<span class="num" id="5557980">1</span><span class="op" id="5557981">,</span>&nbsp;<span class="num" id="5557983">0</span><span class="op" id="5557984">}</span><span class="op" id="5557985">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5557988">{</span><span class="num" id="5557989">1</span><span class="op" id="5557990">,</span>&nbsp;<span class="num" id="5557992">2</span><span class="op" id="5557993">,</span>&nbsp;<span class="num" id="5557995">0</span><span class="op" id="5557996">,</span>&nbsp;<span class="num" id="5557998">1</span><span class="op" id="5557999">}</span><span class="op" id="5558000">,</span><br>
<span class="lineno"></span><span class="op" id="5558002">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5558005">//&nbsp;Decoding&nbsp;stage.</span><br>
<span class="lineno"></span><span class="comment" id="5558024">//&nbsp;The&nbsp;PNG&nbsp;specification&nbsp;says&nbsp;that&nbsp;the&nbsp;IHDR,&nbsp;PLTE&nbsp;(if&nbsp;present),&nbsp;IDAT&nbsp;and&nbsp;IEND</span><br>
<span class="lineno">85</span><span class="comment" id="5558102">//&nbsp;chunks&nbsp;must&nbsp;appear&nbsp;in&nbsp;that&nbsp;order.&nbsp;There&nbsp;may&nbsp;be&nbsp;multiple&nbsp;IDAT&nbsp;chunks,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5558178">//&nbsp;IDAT&nbsp;chunks&nbsp;must&nbsp;be&nbsp;sequential&nbsp;(i.e.&nbsp;they&nbsp;may&nbsp;not&nbsp;have&nbsp;any&nbsp;other&nbsp;chunks</span><br>
<span class="lineno"></span><span class="comment" id="5558253">//&nbsp;between&nbsp;them).</span><br>
<span class="lineno"></span><span class="comment" id="5558271">//&nbsp;http://www.w3.org/TR/PNG/#5ChunkOrdering</span><br>
<span class="lineno"></span><span class="keyword" id="5558315">const</span>&nbsp;<span class="op" id="5558321">(</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5558324">dsStart</span>&nbsp;<span class="op" id="5558332">=</span>&nbsp;<span class="ident" id="5558334">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5558340">dsSeenIHDR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5558352">dsSeenPLTE</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5558364">dsSeenIDAT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5558376">dsSeenIEND</span><br>
<span class="lineno">95</span><span class="op" id="5558387">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5558390">const</span>&nbsp;<span class="ident" id="5558396">pngHeader</span>&nbsp;<span class="op" id="5558406">=</span>&nbsp;<span class="string" id="5558408">&#34;\x89PNG\r\n\x1a\n&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5558429">type</span>&nbsp;<span class="ident" id="5558434">decoder</span>&nbsp;<span class="keyword" id="5558442">struct</span>&nbsp;<span class="op" id="5558449">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5558452">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5558466">io</span><span class="op" id="5558468">.</span><span class="ident" id="5558469">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5558477">img</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5558491">image</span><span class="op" id="5558496">.</span><span class="ident" id="5558497">Image</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5558504">crc</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5558518">hash</span><span class="op" id="5558522">.</span><span class="ident" id="5558523">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5558531">width</span><span class="op" id="5558536">,</span>&nbsp;<span class="ident" id="5558538">height</span>&nbsp;<span class="builtintype" id="5558545">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5558550">depth</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5558564">int</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5558569">palette</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5558583">color</span><span class="op" id="5558588">.</span><span class="ident" id="5558589">Palette</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5558598">cb</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5558612">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5558617">stage</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5558631">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5558636">idatLength</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5558650">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5558658">tmp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5558672">[</span><span class="num" id="5558673">3</span>&nbsp;<span class="op" id="5558675">*</span>&nbsp;<span class="num" id="5558677">256</span><span class="op" id="5558680">]</span><span class="builtintype" id="5558681">byte</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5558687">interlace</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5558701">int</span><br>
<span class="lineno"></span><span class="op" id="5558705">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5558708">//&nbsp;A&nbsp;FormatError&nbsp;reports&nbsp;that&nbsp;the&nbsp;input&nbsp;is&nbsp;not&nbsp;a&nbsp;valid&nbsp;PNG.</span><br>
<span class="lineno"></span><span class="keyword" id="5558768">type</span>&nbsp;<span class="ident" id="5558773">FormatError</span>&nbsp;<span class="builtintype" id="5558785">string</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="keyword" id="5558793">func</span>&nbsp;<span class="op" id="5558798">(</span><span class="ident" id="5558799">e</span>&nbsp;<span class="ident" id="5558801">FormatError</span><span class="op" id="5558812">)</span>&nbsp;<span class="ident" id="5558814">Error</span><span class="op" id="5558819">(</span><span class="op" id="5558820">)</span>&nbsp;<span class="builtintype" id="5558822">string</span>&nbsp;<span class="op" id="5558829">{</span>&nbsp;<span class="keyword" id="5558831">return</span>&nbsp;<span class="string" id="5558838">&#34;png:&nbsp;invalid&nbsp;format:&nbsp;&#34;</span>&nbsp;<span class="op" id="5558862">+</span>&nbsp;<span class="builtintype" id="5558864">string</span><span class="op" id="5558870">(</span><span class="ident" id="5558871">e</span><span class="op" id="5558872">)</span>&nbsp;<span class="op" id="5558874">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5558877">var</span>&nbsp;<span class="ident" id="5558881">chunkOrderError</span>&nbsp;<span class="op" id="5558897">=</span>&nbsp;<span class="ident" id="5558899">FormatError</span><span class="op" id="5558910">(</span><span class="string" id="5558911">&#34;chunk&nbsp;out&nbsp;of&nbsp;order&#34;</span><span class="op" id="5558931">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="comment" id="5558934">//&nbsp;An&nbsp;UnsupportedError&nbsp;reports&nbsp;that&nbsp;the&nbsp;input&nbsp;uses&nbsp;a&nbsp;valid&nbsp;but&nbsp;unimplemented&nbsp;PNG&nbsp;feature.</span><br>
<span class="lineno"></span><span class="keyword" id="5559024">type</span>&nbsp;<span class="ident" id="5559029">UnsupportedError</span>&nbsp;<span class="builtintype" id="5559046">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5559054">func</span>&nbsp;<span class="op" id="5559059">(</span><span class="ident" id="5559060">e</span>&nbsp;<span class="ident" id="5559062">UnsupportedError</span><span class="op" id="5559078">)</span>&nbsp;<span class="ident" id="5559080">Error</span><span class="op" id="5559085">(</span><span class="op" id="5559086">)</span>&nbsp;<span class="builtintype" id="5559088">string</span>&nbsp;<span class="op" id="5559095">{</span>&nbsp;<span class="keyword" id="5559097">return</span>&nbsp;<span class="string" id="5559104">&#34;png:&nbsp;unsupported&nbsp;feature:&nbsp;&#34;</span>&nbsp;<span class="op" id="5559133">+</span>&nbsp;<span class="builtintype" id="5559135">string</span><span class="op" id="5559141">(</span><span class="ident" id="5559142">e</span><span class="op" id="5559143">)</span>&nbsp;<span class="op" id="5559145">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="5559148">func</span>&nbsp;<span class="ident" id="5559153">min</span><span class="op" id="5559156">(</span><span class="ident" id="5559157">a</span><span class="op" id="5559158">,</span>&nbsp;<span class="ident" id="5559160">b</span>&nbsp;<span class="builtintype" id="5559162">int</span><span class="op" id="5559165">)</span>&nbsp;<span class="builtintype" id="5559167">int</span>&nbsp;<span class="op" id="5559171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5559174">if</span>&nbsp;<span class="ident" id="5559177">a</span>&nbsp;<span class="op" id="5559179">&lt;</span>&nbsp;<span class="ident" id="5559181">b</span>&nbsp;<span class="op" id="5559183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5559187">return</span>&nbsp;<span class="ident" id="5559194">a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5559197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5559200">return</span>&nbsp;<span class="ident" id="5559207">b</span><br>
<span class="lineno">130</span><span class="op" id="5559209">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5559212">func</span>&nbsp;<span class="op" id="5559217">(</span><span class="ident" id="5559218">d</span>&nbsp;<span class="op" id="5559220">*</span><span class="ident" id="5559221">decoder</span><span class="op" id="5559228">)</span>&nbsp;<span class="ident" id="5559230">parseIHDR</span><span class="op" id="5559239">(</span><span class="ident" id="5559240">length</span>&nbsp;<span class="builtintype" id="5559247">uint32</span><span class="op" id="5559253">)</span>&nbsp;<span class="builtintype" id="5559255">error</span>&nbsp;<span class="op" id="5559261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5559264">if</span>&nbsp;<span class="ident" id="5559267">length</span>&nbsp;<span class="op" id="5559274">!=</span>&nbsp;<span class="num" id="5559277">13</span>&nbsp;<span class="op" id="5559280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5559284">return</span>&nbsp;<span class="ident" id="5559291">FormatError</span><span class="op" id="5559302">(</span><span class="string" id="5559303">&#34;bad&nbsp;IHDR&nbsp;length&#34;</span><span class="op" id="5559320">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5559323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5559326">if</span>&nbsp;<span class="ident" id="5559329">_</span><span class="op" id="5559330">,</span>&nbsp;<span class="ident" id="5559332">err</span>&nbsp;<span class="op" id="5559336">:=</span>&nbsp;<span class="ident" id="5559339">io</span><span class="op" id="5559341">.</span><span class="ident" id="5559342">ReadFull</span><span class="op" id="5559350">(</span><span class="ident" id="5559351">d</span><span class="op" id="5559352">.</span><span class="ident" id="5559353">r</span><span class="op" id="5559354">,</span>&nbsp;<span class="ident" id="5559356">d</span><span class="op" id="5559357">.</span><span class="ident" id="5559358">tmp</span><span class="op" id="5559361">[</span><span class="op" id="5559362">:</span><span class="num" id="5559363">13</span><span class="op" id="5559365">]</span><span class="op" id="5559366">)</span><span class="op" id="5559367">;</span>&nbsp;<span class="ident" id="5559369">err</span>&nbsp;<span class="op" id="5559373">!=</span>&nbsp;<span class="ident" id="5559376">nil</span>&nbsp;<span class="op" id="5559380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5559384">return</span>&nbsp;<span class="ident" id="5559391">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5559396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5559399">d</span><span class="op" id="5559400">.</span><span class="ident" id="5559401">crc</span><span class="op" id="5559404">.</span><span class="ident" id="5559405">Write</span><span class="op" id="5559410">(</span><span class="ident" id="5559411">d</span><span class="op" id="5559412">.</span><span class="ident" id="5559413">tmp</span><span class="op" id="5559416">[</span><span class="op" id="5559417">:</span><span class="num" id="5559418">13</span><span class="op" id="5559420">]</span><span class="op" id="5559421">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5559424">if</span>&nbsp;<span class="ident" id="5559427">d</span><span class="op" id="5559428">.</span><span class="ident" id="5559429">tmp</span><span class="op" id="5559432">[</span><span class="num" id="5559433">10</span><span class="op" id="5559435">]</span>&nbsp;<span class="op" id="5559437">!=</span>&nbsp;<span class="num" id="5559440">0</span>&nbsp;<span class="op" id="5559442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5559446">return</span>&nbsp;<span class="ident" id="5559453">UnsupportedError</span><span class="op" id="5559469">(</span><span class="string" id="5559470">&#34;compression&nbsp;method&#34;</span><span class="op" id="5559490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5559493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5559496">if</span>&nbsp;<span class="ident" id="5559499">d</span><span class="op" id="5559500">.</span><span class="ident" id="5559501">tmp</span><span class="op" id="5559504">[</span><span class="num" id="5559505">11</span><span class="op" id="5559507">]</span>&nbsp;<span class="op" id="5559509">!=</span>&nbsp;<span class="num" id="5559512">0</span>&nbsp;<span class="op" id="5559514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5559518">return</span>&nbsp;<span class="ident" id="5559525">UnsupportedError</span><span class="op" id="5559541">(</span><span class="string" id="5559542">&#34;filter&nbsp;method&#34;</span><span class="op" id="5559557">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5559560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5559563">if</span>&nbsp;<span class="ident" id="5559566">d</span><span class="op" id="5559567">.</span><span class="ident" id="5559568">tmp</span><span class="op" id="5559571">[</span><span class="num" id="5559572">12</span><span class="op" id="5559574">]</span>&nbsp;<span class="op" id="5559576">!=</span>&nbsp;<span class="ident" id="5559579">itNone</span>&nbsp;<span class="op" id="5559586">&amp;&amp;</span>&nbsp;<span class="ident" id="5559589">d</span><span class="op" id="5559590">.</span><span class="ident" id="5559591">tmp</span><span class="op" id="5559594">[</span><span class="num" id="5559595">12</span><span class="op" id="5559597">]</span>&nbsp;<span class="op" id="5559599">!=</span>&nbsp;<span class="ident" id="5559602">itAdam7</span>&nbsp;<span class="op" id="5559610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5559614">return</span>&nbsp;<span class="ident" id="5559621">FormatError</span><span class="op" id="5559632">(</span><span class="string" id="5559633">&#34;invalid&nbsp;interlace&nbsp;method&#34;</span><span class="op" id="5559659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5559662">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5559665">d</span><span class="op" id="5559666">.</span><span class="ident" id="5559667">interlace</span>&nbsp;<span class="op" id="5559677">=</span>&nbsp;<span class="builtintype" id="5559679">int</span><span class="op" id="5559682">(</span><span class="ident" id="5559683">d</span><span class="op" id="5559684">.</span><span class="ident" id="5559685">tmp</span><span class="op" id="5559688">[</span><span class="num" id="5559689">12</span><span class="op" id="5559691">]</span><span class="op" id="5559692">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5559695">w</span>&nbsp;<span class="op" id="5559697">:=</span>&nbsp;<span class="builtintype" id="5559700">int32</span><span class="op" id="5559705">(</span><span class="ident" id="5559706">binary</span><span class="op" id="5559712">.</span><span class="ident" id="5559713">BigEndian</span><span class="op" id="5559722">.</span><span class="ident" id="5559723">Uint32</span><span class="op" id="5559729">(</span><span class="ident" id="5559730">d</span><span class="op" id="5559731">.</span><span class="ident" id="5559732">tmp</span><span class="op" id="5559735">[</span><span class="num" id="5559736">0</span><span class="op" id="5559737">:</span><span class="num" id="5559738">4</span><span class="op" id="5559739">]</span><span class="op" id="5559740">)</span><span class="op" id="5559741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5559744">h</span>&nbsp;<span class="op" id="5559746">:=</span>&nbsp;<span class="builtintype" id="5559749">int32</span><span class="op" id="5559754">(</span><span class="ident" id="5559755">binary</span><span class="op" id="5559761">.</span><span class="ident" id="5559762">BigEndian</span><span class="op" id="5559771">.</span><span class="ident" id="5559772">Uint32</span><span class="op" id="5559778">(</span><span class="ident" id="5559779">d</span><span class="op" id="5559780">.</span><span class="ident" id="5559781">tmp</span><span class="op" id="5559784">[</span><span class="num" id="5559785">4</span><span class="op" id="5559786">:</span><span class="num" id="5559787">8</span><span class="op" id="5559788">]</span><span class="op" id="5559789">)</span><span class="op" id="5559790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5559793">if</span>&nbsp;<span class="ident" id="5559796">w</span>&nbsp;<span class="op" id="5559798">&lt;</span>&nbsp;<span class="num" id="5559800">0</span>&nbsp;<span class="op" id="5559802">||</span>&nbsp;<span class="ident" id="5559805">h</span>&nbsp;<span class="op" id="5559807">&lt;</span>&nbsp;<span class="num" id="5559809">0</span>&nbsp;<span class="op" id="5559811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5559815">return</span>&nbsp;<span class="ident" id="5559822">FormatError</span><span class="op" id="5559833">(</span><span class="string" id="5559834">&#34;negative&nbsp;dimension&#34;</span><span class="op" id="5559854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5559857">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5559860">nPixels</span>&nbsp;<span class="op" id="5559868">:=</span>&nbsp;<span class="ident" id="5559871">int64</span><span class="op" id="5559876">(</span><span class="ident" id="5559877">w</span><span class="op" id="5559878">)</span>&nbsp;<span class="op" id="5559880">*</span>&nbsp;<span class="ident" id="5559882">int64</span><span class="op" id="5559887">(</span><span class="ident" id="5559888">h</span><span class="op" id="5559889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5559892">if</span>&nbsp;<span class="ident" id="5559895">nPixels</span>&nbsp;<span class="op" id="5559903">!=</span>&nbsp;<span class="ident" id="5559906">int64</span><span class="op" id="5559911">(</span><span class="builtintype" id="5559912">int</span><span class="op" id="5559915">(</span><span class="ident" id="5559916">nPixels</span><span class="op" id="5559923">)</span><span class="op" id="5559924">)</span>&nbsp;<span class="op" id="5559926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5559930">return</span>&nbsp;<span class="ident" id="5559937">UnsupportedError</span><span class="op" id="5559953">(</span><span class="string" id="5559954">&#34;dimension&nbsp;overflow&#34;</span><span class="op" id="5559974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5559977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5559980">d</span><span class="op" id="5559981">.</span><span class="ident" id="5559982">cb</span>&nbsp;<span class="op" id="5559985">=</span>&nbsp;<span class="ident" id="5559987">cbInvalid</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5559998">d</span><span class="op" id="5559999">.</span><span class="ident" id="5560000">depth</span>&nbsp;<span class="op" id="5560006">=</span>&nbsp;<span class="builtintype" id="5560008">int</span><span class="op" id="5560011">(</span><span class="ident" id="5560012">d</span><span class="op" id="5560013">.</span><span class="ident" id="5560014">tmp</span><span class="op" id="5560017">[</span><span class="num" id="5560018">8</span><span class="op" id="5560019">]</span><span class="op" id="5560020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5560023">switch</span>&nbsp;<span class="ident" id="5560030">d</span><span class="op" id="5560031">.</span><span class="ident" id="5560032">depth</span>&nbsp;<span class="op" id="5560038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5560041">case</span>&nbsp;<span class="num" id="5560046">1</span><span class="op" id="5560047">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5560051">switch</span>&nbsp;<span class="ident" id="5560058">d</span><span class="op" id="5560059">.</span><span class="ident" id="5560060">tmp</span><span class="op" id="5560063">[</span><span class="num" id="5560064">9</span><span class="op" id="5560065">]</span>&nbsp;<span class="op" id="5560067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5560071">case</span>&nbsp;<span class="ident" id="5560076">ctGrayscale</span><span class="op" id="5560087">:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5560092">d</span><span class="op" id="5560093">.</span><span class="ident" id="5560094">cb</span>&nbsp;<span class="op" id="5560097">=</span>&nbsp;<span class="ident" id="5560099">cbG1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5560106">case</span>&nbsp;<span class="ident" id="5560111">ctPaletted</span><span class="op" id="5560121">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5560126">d</span><span class="op" id="5560127">.</span><span class="ident" id="5560128">cb</span>&nbsp;<span class="op" id="5560131">=</span>&nbsp;<span class="ident" id="5560133">cbP1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5560140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5560143">case</span>&nbsp;<span class="num" id="5560148">2</span><span class="op" id="5560149">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5560153">switch</span>&nbsp;<span class="ident" id="5560160">d</span><span class="op" id="5560161">.</span><span class="ident" id="5560162">tmp</span><span class="op" id="5560165">[</span><span class="num" id="5560166">9</span><span class="op" id="5560167">]</span>&nbsp;<span class="op" id="5560169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5560173">case</span>&nbsp;<span class="ident" id="5560178">ctGrayscale</span><span class="op" id="5560189">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5560194">d</span><span class="op" id="5560195">.</span><span class="ident" id="5560196">cb</span>&nbsp;<span class="op" id="5560199">=</span>&nbsp;<span class="ident" id="5560201">cbG2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5560208">case</span>&nbsp;<span class="ident" id="5560213">ctPaletted</span><span class="op" id="5560223">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5560228">d</span><span class="op" id="5560229">.</span><span class="ident" id="5560230">cb</span>&nbsp;<span class="op" id="5560233">=</span>&nbsp;<span class="ident" id="5560235">cbP2</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5560242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5560245">case</span>&nbsp;<span class="num" id="5560250">4</span><span class="op" id="5560251">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5560255">switch</span>&nbsp;<span class="ident" id="5560262">d</span><span class="op" id="5560263">.</span><span class="ident" id="5560264">tmp</span><span class="op" id="5560267">[</span><span class="num" id="5560268">9</span><span class="op" id="5560269">]</span>&nbsp;<span class="op" id="5560271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5560275">case</span>&nbsp;<span class="ident" id="5560280">ctGrayscale</span><span class="op" id="5560291">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5560296">d</span><span class="op" id="5560297">.</span><span class="ident" id="5560298">cb</span>&nbsp;<span class="op" id="5560301">=</span>&nbsp;<span class="ident" id="5560303">cbG4</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5560310">case</span>&nbsp;<span class="ident" id="5560315">ctPaletted</span><span class="op" id="5560325">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5560330">d</span><span class="op" id="5560331">.</span><span class="ident" id="5560332">cb</span>&nbsp;<span class="op" id="5560335">=</span>&nbsp;<span class="ident" id="5560337">cbP4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5560344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5560347">case</span>&nbsp;<span class="num" id="5560352">8</span><span class="op" id="5560353">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5560357">switch</span>&nbsp;<span class="ident" id="5560364">d</span><span class="op" id="5560365">.</span><span class="ident" id="5560366">tmp</span><span class="op" id="5560369">[</span><span class="num" id="5560370">9</span><span class="op" id="5560371">]</span>&nbsp;<span class="op" id="5560373">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5560377">case</span>&nbsp;<span class="ident" id="5560382">ctGrayscale</span><span class="op" id="5560393">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5560398">d</span><span class="op" id="5560399">.</span><span class="ident" id="5560400">cb</span>&nbsp;<span class="op" id="5560403">=</span>&nbsp;<span class="ident" id="5560405">cbG8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5560412">case</span>&nbsp;<span class="ident" id="5560417">ctTrueColor</span><span class="op" id="5560428">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5560433">d</span><span class="op" id="5560434">.</span><span class="ident" id="5560435">cb</span>&nbsp;<span class="op" id="5560438">=</span>&nbsp;<span class="ident" id="5560440">cbTC8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5560448">case</span>&nbsp;<span class="ident" id="5560453">ctPaletted</span><span class="op" id="5560463">:</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5560468">d</span><span class="op" id="5560469">.</span><span class="ident" id="5560470">cb</span>&nbsp;<span class="op" id="5560473">=</span>&nbsp;<span class="ident" id="5560475">cbP8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5560482">case</span>&nbsp;<span class="ident" id="5560487">ctGrayscaleAlpha</span><span class="op" id="5560503">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5560508">d</span><span class="op" id="5560509">.</span><span class="ident" id="5560510">cb</span>&nbsp;<span class="op" id="5560513">=</span>&nbsp;<span class="ident" id="5560515">cbGA8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5560523">case</span>&nbsp;<span class="ident" id="5560528">ctTrueColorAlpha</span><span class="op" id="5560544">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5560549">d</span><span class="op" id="5560550">.</span><span class="ident" id="5560551">cb</span>&nbsp;<span class="op" id="5560554">=</span>&nbsp;<span class="ident" id="5560556">cbTCA8</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5560565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5560568">case</span>&nbsp;<span class="num" id="5560573">16</span><span class="op" id="5560575">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5560579">switch</span>&nbsp;<span class="ident" id="5560586">d</span><span class="op" id="5560587">.</span><span class="ident" id="5560588">tmp</span><span class="op" id="5560591">[</span><span class="num" id="5560592">9</span><span class="op" id="5560593">]</span>&nbsp;<span class="op" id="5560595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5560599">case</span>&nbsp;<span class="ident" id="5560604">ctGrayscale</span><span class="op" id="5560615">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5560620">d</span><span class="op" id="5560621">.</span><span class="ident" id="5560622">cb</span>&nbsp;<span class="op" id="5560625">=</span>&nbsp;<span class="ident" id="5560627">cbG16</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5560635">case</span>&nbsp;<span class="ident" id="5560640">ctTrueColor</span><span class="op" id="5560651">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5560656">d</span><span class="op" id="5560657">.</span><span class="ident" id="5560658">cb</span>&nbsp;<span class="op" id="5560661">=</span>&nbsp;<span class="ident" id="5560663">cbTC16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5560672">case</span>&nbsp;<span class="ident" id="5560677">ctGrayscaleAlpha</span><span class="op" id="5560693">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5560698">d</span><span class="op" id="5560699">.</span><span class="ident" id="5560700">cb</span>&nbsp;<span class="op" id="5560703">=</span>&nbsp;<span class="ident" id="5560705">cbGA16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5560714">case</span>&nbsp;<span class="ident" id="5560719">ctTrueColorAlpha</span><span class="op" id="5560735">:</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5560740">d</span><span class="op" id="5560741">.</span><span class="ident" id="5560742">cb</span>&nbsp;<span class="op" id="5560745">=</span>&nbsp;<span class="ident" id="5560747">cbTCA16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5560757">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5560760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5560763">if</span>&nbsp;<span class="ident" id="5560766">d</span><span class="op" id="5560767">.</span><span class="ident" id="5560768">cb</span>&nbsp;<span class="op" id="5560771">==</span>&nbsp;<span class="ident" id="5560774">cbInvalid</span>&nbsp;<span class="op" id="5560784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5560788">return</span>&nbsp;<span class="ident" id="5560795">UnsupportedError</span><span class="op" id="5560811">(</span><span class="ident" id="5560812">fmt</span><span class="op" id="5560815">.</span><span class="ident" id="5560816">Sprintf</span><span class="op" id="5560823">(</span><span class="string" id="5560824">&#34;bit&nbsp;depth&nbsp;%d,&nbsp;color&nbsp;type&nbsp;%d&#34;</span><span class="op" id="5560853">,</span>&nbsp;<span class="ident" id="5560855">d</span><span class="op" id="5560856">.</span><span class="ident" id="5560857">tmp</span><span class="op" id="5560860">[</span><span class="num" id="5560861">8</span><span class="op" id="5560862">]</span><span class="op" id="5560863">,</span>&nbsp;<span class="ident" id="5560865">d</span><span class="op" id="5560866">.</span><span class="ident" id="5560867">tmp</span><span class="op" id="5560870">[</span><span class="num" id="5560871">9</span><span class="op" id="5560872">]</span><span class="op" id="5560873">)</span><span class="op" id="5560874">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5560877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5560880">d</span><span class="op" id="5560881">.</span><span class="ident" id="5560882">width</span><span class="op" id="5560887">,</span>&nbsp;<span class="ident" id="5560889">d</span><span class="op" id="5560890">.</span><span class="ident" id="5560891">height</span>&nbsp;<span class="op" id="5560898">=</span>&nbsp;<span class="builtintype" id="5560900">int</span><span class="op" id="5560903">(</span><span class="ident" id="5560904">w</span><span class="op" id="5560905">)</span><span class="op" id="5560906">,</span>&nbsp;<span class="builtintype" id="5560908">int</span><span class="op" id="5560911">(</span><span class="ident" id="5560912">h</span><span class="op" id="5560913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5560916">return</span>&nbsp;<span class="ident" id="5560923">d</span><span class="op" id="5560924">.</span><span class="ident" id="5560925">verifyChecksum</span><span class="op" id="5560939">(</span><span class="op" id="5560940">)</span><br>
<span class="lineno"></span><span class="op" id="5560942">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="5560945">func</span>&nbsp;<span class="op" id="5560950">(</span><span class="ident" id="5560951">d</span>&nbsp;<span class="op" id="5560953">*</span><span class="ident" id="5560954">decoder</span><span class="op" id="5560961">)</span>&nbsp;<span class="ident" id="5560963">parsePLTE</span><span class="op" id="5560972">(</span><span class="ident" id="5560973">length</span>&nbsp;<span class="builtintype" id="5560980">uint32</span><span class="op" id="5560986">)</span>&nbsp;<span class="builtintype" id="5560988">error</span>&nbsp;<span class="op" id="5560994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5560997">np</span>&nbsp;<span class="op" id="5561000">:=</span>&nbsp;<span class="builtintype" id="5561003">int</span><span class="op" id="5561006">(</span><span class="ident" id="5561007">length</span>&nbsp;<span class="op" id="5561014">/</span>&nbsp;<span class="num" id="5561016">3</span><span class="op" id="5561017">)</span>&nbsp;<span class="comment" id="5561019">//&nbsp;The&nbsp;number&nbsp;of&nbsp;palette&nbsp;entries.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5561054">if</span>&nbsp;<span class="ident" id="5561057">length</span><span class="op" id="5561063">%</span><span class="num" id="5561064">3</span>&nbsp;<span class="op" id="5561066">!=</span>&nbsp;<span class="num" id="5561069">0</span>&nbsp;<span class="op" id="5561071">||</span>&nbsp;<span class="ident" id="5561074">np</span>&nbsp;<span class="op" id="5561077">&lt;=</span>&nbsp;<span class="num" id="5561080">0</span>&nbsp;<span class="op" id="5561082">||</span>&nbsp;<span class="ident" id="5561085">np</span>&nbsp;<span class="op" id="5561088">&gt;</span>&nbsp;<span class="num" id="5561090">256</span>&nbsp;<span class="op" id="5561094">||</span>&nbsp;<span class="ident" id="5561097">np</span>&nbsp;<span class="op" id="5561100">&gt;</span>&nbsp;<span class="num" id="5561102">1</span><span class="op" id="5561103">&lt;&lt;</span><span class="builtintype" id="5561105">uint</span><span class="op" id="5561109">(</span><span class="ident" id="5561110">d</span><span class="op" id="5561111">.</span><span class="ident" id="5561112">depth</span><span class="op" id="5561117">)</span>&nbsp;<span class="op" id="5561119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5561123">return</span>&nbsp;<span class="ident" id="5561130">FormatError</span><span class="op" id="5561141">(</span><span class="string" id="5561142">&#34;bad&nbsp;PLTE&nbsp;length&#34;</span><span class="op" id="5561159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5561162">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5561165">n</span><span class="op" id="5561166">,</span>&nbsp;<span class="ident" id="5561168">err</span>&nbsp;<span class="op" id="5561172">:=</span>&nbsp;<span class="ident" id="5561175">io</span><span class="op" id="5561177">.</span><span class="ident" id="5561178">ReadFull</span><span class="op" id="5561186">(</span><span class="ident" id="5561187">d</span><span class="op" id="5561188">.</span><span class="ident" id="5561189">r</span><span class="op" id="5561190">,</span>&nbsp;<span class="ident" id="5561192">d</span><span class="op" id="5561193">.</span><span class="ident" id="5561194">tmp</span><span class="op" id="5561197">[</span><span class="op" id="5561198">:</span><span class="num" id="5561199">3</span><span class="op" id="5561200">*</span><span class="ident" id="5561201">np</span><span class="op" id="5561203">]</span><span class="op" id="5561204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5561207">if</span>&nbsp;<span class="ident" id="5561210">err</span>&nbsp;<span class="op" id="5561214">!=</span>&nbsp;<span class="ident" id="5561217">nil</span>&nbsp;<span class="op" id="5561221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5561225">return</span>&nbsp;<span class="ident" id="5561232">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5561237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5561240">d</span><span class="op" id="5561241">.</span><span class="ident" id="5561242">crc</span><span class="op" id="5561245">.</span><span class="ident" id="5561246">Write</span><span class="op" id="5561251">(</span><span class="ident" id="5561252">d</span><span class="op" id="5561253">.</span><span class="ident" id="5561254">tmp</span><span class="op" id="5561257">[</span><span class="op" id="5561258">:</span><span class="ident" id="5561259">n</span><span class="op" id="5561260">]</span><span class="op" id="5561261">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5561264">switch</span>&nbsp;<span class="ident" id="5561271">d</span><span class="op" id="5561272">.</span><span class="ident" id="5561273">cb</span>&nbsp;<span class="op" id="5561276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5561279">case</span>&nbsp;<span class="ident" id="5561284">cbP1</span><span class="op" id="5561288">,</span>&nbsp;<span class="ident" id="5561290">cbP2</span><span class="op" id="5561294">,</span>&nbsp;<span class="ident" id="5561296">cbP4</span><span class="op" id="5561300">,</span>&nbsp;<span class="ident" id="5561302">cbP8</span><span class="op" id="5561306">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5561310">d</span><span class="op" id="5561311">.</span><span class="ident" id="5561312">palette</span>&nbsp;<span class="op" id="5561320">=</span>&nbsp;<span class="builtinfunc" id="5561322">make</span><span class="op" id="5561326">(</span><span class="ident" id="5561327">color</span><span class="op" id="5561332">.</span><span class="ident" id="5561333">Palette</span><span class="op" id="5561340">,</span>&nbsp;<span class="num" id="5561342">256</span><span class="op" id="5561345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5561349">for</span>&nbsp;<span class="ident" id="5561353">i</span>&nbsp;<span class="op" id="5561355">:=</span>&nbsp;<span class="num" id="5561358">0</span><span class="op" id="5561359">;</span>&nbsp;<span class="ident" id="5561361">i</span>&nbsp;<span class="op" id="5561363">&lt;</span>&nbsp;<span class="ident" id="5561365">np</span><span class="op" id="5561367">;</span>&nbsp;<span class="ident" id="5561369">i</span><span class="op" id="5561370">++</span>&nbsp;<span class="op" id="5561373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5561378">d</span><span class="op" id="5561379">.</span><span class="ident" id="5561380">palette</span><span class="op" id="5561387">[</span><span class="ident" id="5561388">i</span><span class="op" id="5561389">]</span>&nbsp;<span class="op" id="5561391">=</span>&nbsp;<span class="ident" id="5561393">color</span><span class="op" id="5561398">.</span><span class="ident" id="5561399">RGBA</span><span class="op" id="5561403">{</span><span class="ident" id="5561404">d</span><span class="op" id="5561405">.</span><span class="ident" id="5561406">tmp</span><span class="op" id="5561409">[</span><span class="num" id="5561410">3</span><span class="op" id="5561411">*</span><span class="ident" id="5561412">i</span><span class="op" id="5561413">+</span><span class="num" id="5561414">0</span><span class="op" id="5561415">]</span><span class="op" id="5561416">,</span>&nbsp;<span class="ident" id="5561418">d</span><span class="op" id="5561419">.</span><span class="ident" id="5561420">tmp</span><span class="op" id="5561423">[</span><span class="num" id="5561424">3</span><span class="op" id="5561425">*</span><span class="ident" id="5561426">i</span><span class="op" id="5561427">+</span><span class="num" id="5561428">1</span><span class="op" id="5561429">]</span><span class="op" id="5561430">,</span>&nbsp;<span class="ident" id="5561432">d</span><span class="op" id="5561433">.</span><span class="ident" id="5561434">tmp</span><span class="op" id="5561437">[</span><span class="num" id="5561438">3</span><span class="op" id="5561439">*</span><span class="ident" id="5561440">i</span><span class="op" id="5561441">+</span><span class="num" id="5561442">2</span><span class="op" id="5561443">]</span><span class="op" id="5561444">,</span>&nbsp;<span class="num" id="5561446">0xff</span><span class="op" id="5561450">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5561454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5561458">for</span>&nbsp;<span class="ident" id="5561462">i</span>&nbsp;<span class="op" id="5561464">:=</span>&nbsp;<span class="ident" id="5561467">np</span><span class="op" id="5561469">;</span>&nbsp;<span class="ident" id="5561471">i</span>&nbsp;<span class="op" id="5561473">&lt;</span>&nbsp;<span class="num" id="5561475">256</span><span class="op" id="5561478">;</span>&nbsp;<span class="ident" id="5561480">i</span><span class="op" id="5561481">++</span>&nbsp;<span class="op" id="5561484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5561489">//&nbsp;Initialize&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;palette&nbsp;to&nbsp;opaque&nbsp;black.&nbsp;The&nbsp;spec&nbsp;(section</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5561565">//&nbsp;11.2.3)&nbsp;says&nbsp;that&nbsp;&#34;any&nbsp;out-of-range&nbsp;pixel&nbsp;value&nbsp;found&nbsp;in&nbsp;the&nbsp;image&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5561643">//&nbsp;is&nbsp;an&nbsp;error&#34;,&nbsp;but&nbsp;some&nbsp;real-world&nbsp;PNG&nbsp;files&nbsp;have&nbsp;out-of-range&nbsp;pixel</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5561717">//&nbsp;values.&nbsp;We&nbsp;fall&nbsp;back&nbsp;to&nbsp;opaque&nbsp;black,&nbsp;the&nbsp;same&nbsp;as&nbsp;libpng&nbsp;1.5.13;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5561788">//&nbsp;ImageMagick&nbsp;6.5.7&nbsp;returns&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5561830">d</span><span class="op" id="5561831">.</span><span class="ident" id="5561832">palette</span><span class="op" id="5561839">[</span><span class="ident" id="5561840">i</span><span class="op" id="5561841">]</span>&nbsp;<span class="op" id="5561843">=</span>&nbsp;<span class="ident" id="5561845">color</span><span class="op" id="5561850">.</span><span class="ident" id="5561851">RGBA</span><span class="op" id="5561855">{</span><span class="num" id="5561856">0x00</span><span class="op" id="5561860">,</span>&nbsp;<span class="num" id="5561862">0x00</span><span class="op" id="5561866">,</span>&nbsp;<span class="num" id="5561868">0x00</span><span class="op" id="5561872">,</span>&nbsp;<span class="num" id="5561874">0xff</span><span class="op" id="5561878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5561882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5561886">d</span><span class="op" id="5561887">.</span><span class="ident" id="5561888">palette</span>&nbsp;<span class="op" id="5561896">=</span>&nbsp;<span class="ident" id="5561898">d</span><span class="op" id="5561899">.</span><span class="ident" id="5561900">palette</span><span class="op" id="5561907">[</span><span class="op" id="5561908">:</span><span class="ident" id="5561909">np</span><span class="op" id="5561911">]</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5561914">case</span>&nbsp;<span class="ident" id="5561919">cbTC8</span><span class="op" id="5561924">,</span>&nbsp;<span class="ident" id="5561926">cbTCA8</span><span class="op" id="5561932">,</span>&nbsp;<span class="ident" id="5561934">cbTC16</span><span class="op" id="5561940">,</span>&nbsp;<span class="ident" id="5561942">cbTCA16</span><span class="op" id="5561949">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5561953">//&nbsp;As&nbsp;per&nbsp;the&nbsp;PNG&nbsp;spec,&nbsp;a&nbsp;PLTE&nbsp;chunk&nbsp;is&nbsp;optional&nbsp;(and&nbsp;for&nbsp;practical&nbsp;purposes,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5562033">//&nbsp;ignorable)&nbsp;for&nbsp;the&nbsp;ctTrueColor&nbsp;and&nbsp;ctTrueColorAlpha&nbsp;color&nbsp;types&nbsp;(section&nbsp;4.1.2).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5562118">default</span><span class="op" id="5562125">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5562129">return</span>&nbsp;<span class="ident" id="5562136">FormatError</span><span class="op" id="5562147">(</span><span class="string" id="5562148">&#34;PLTE,&nbsp;color&nbsp;type&nbsp;mismatch&#34;</span><span class="op" id="5562175">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5562178">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5562181">return</span>&nbsp;<span class="ident" id="5562188">d</span><span class="op" id="5562189">.</span><span class="ident" id="5562190">verifyChecksum</span><span class="op" id="5562204">(</span><span class="op" id="5562205">)</span><br>
<span class="lineno"></span><span class="op" id="5562207">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5562210">func</span>&nbsp;<span class="op" id="5562215">(</span><span class="ident" id="5562216">d</span>&nbsp;<span class="op" id="5562218">*</span><span class="ident" id="5562219">decoder</span><span class="op" id="5562226">)</span>&nbsp;<span class="ident" id="5562228">parsetRNS</span><span class="op" id="5562237">(</span><span class="ident" id="5562238">length</span>&nbsp;<span class="builtintype" id="5562245">uint32</span><span class="op" id="5562251">)</span>&nbsp;<span class="builtintype" id="5562253">error</span>&nbsp;<span class="op" id="5562259">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5562262">if</span>&nbsp;<span class="ident" id="5562265">length</span>&nbsp;<span class="op" id="5562272">&gt;</span>&nbsp;<span class="num" id="5562274">256</span>&nbsp;<span class="op" id="5562278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5562282">return</span>&nbsp;<span class="ident" id="5562289">FormatError</span><span class="op" id="5562300">(</span><span class="string" id="5562301">&#34;bad&nbsp;tRNS&nbsp;length&#34;</span><span class="op" id="5562318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5562321">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5562324">n</span><span class="op" id="5562325">,</span>&nbsp;<span class="ident" id="5562327">err</span>&nbsp;<span class="op" id="5562331">:=</span>&nbsp;<span class="ident" id="5562334">io</span><span class="op" id="5562336">.</span><span class="ident" id="5562337">ReadFull</span><span class="op" id="5562345">(</span><span class="ident" id="5562346">d</span><span class="op" id="5562347">.</span><span class="ident" id="5562348">r</span><span class="op" id="5562349">,</span>&nbsp;<span class="ident" id="5562351">d</span><span class="op" id="5562352">.</span><span class="ident" id="5562353">tmp</span><span class="op" id="5562356">[</span><span class="op" id="5562357">:</span><span class="ident" id="5562358">length</span><span class="op" id="5562364">]</span><span class="op" id="5562365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5562368">if</span>&nbsp;<span class="ident" id="5562371">err</span>&nbsp;<span class="op" id="5562375">!=</span>&nbsp;<span class="ident" id="5562378">nil</span>&nbsp;<span class="op" id="5562382">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5562386">return</span>&nbsp;<span class="ident" id="5562393">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5562398">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5562401">d</span><span class="op" id="5562402">.</span><span class="ident" id="5562403">crc</span><span class="op" id="5562406">.</span><span class="ident" id="5562407">Write</span><span class="op" id="5562412">(</span><span class="ident" id="5562413">d</span><span class="op" id="5562414">.</span><span class="ident" id="5562415">tmp</span><span class="op" id="5562418">[</span><span class="op" id="5562419">:</span><span class="ident" id="5562420">n</span><span class="op" id="5562421">]</span><span class="op" id="5562422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5562425">switch</span>&nbsp;<span class="ident" id="5562432">d</span><span class="op" id="5562433">.</span><span class="ident" id="5562434">cb</span>&nbsp;<span class="op" id="5562437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5562440">case</span>&nbsp;<span class="ident" id="5562445">cbG8</span><span class="op" id="5562449">,</span>&nbsp;<span class="ident" id="5562451">cbG16</span><span class="op" id="5562456">:</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5562460">return</span>&nbsp;<span class="ident" id="5562467">UnsupportedError</span><span class="op" id="5562483">(</span><span class="string" id="5562484">&#34;grayscale&nbsp;transparency&#34;</span><span class="op" id="5562508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5562511">case</span>&nbsp;<span class="ident" id="5562516">cbTC8</span><span class="op" id="5562521">,</span>&nbsp;<span class="ident" id="5562523">cbTC16</span><span class="op" id="5562529">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5562533">return</span>&nbsp;<span class="ident" id="5562540">UnsupportedError</span><span class="op" id="5562556">(</span><span class="string" id="5562557">&#34;truecolor&nbsp;transparency&#34;</span><span class="op" id="5562581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5562584">case</span>&nbsp;<span class="ident" id="5562589">cbP1</span><span class="op" id="5562593">,</span>&nbsp;<span class="ident" id="5562595">cbP2</span><span class="op" id="5562599">,</span>&nbsp;<span class="ident" id="5562601">cbP4</span><span class="op" id="5562605">,</span>&nbsp;<span class="ident" id="5562607">cbP8</span><span class="op" id="5562611">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5562615">if</span>&nbsp;<span class="builtinfunc" id="5562618">len</span><span class="op" id="5562621">(</span><span class="ident" id="5562622">d</span><span class="op" id="5562623">.</span><span class="ident" id="5562624">palette</span><span class="op" id="5562631">)</span>&nbsp;<span class="op" id="5562633">&lt;</span>&nbsp;<span class="ident" id="5562635">n</span>&nbsp;<span class="op" id="5562637">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5562642">d</span><span class="op" id="5562643">.</span><span class="ident" id="5562644">palette</span>&nbsp;<span class="op" id="5562652">=</span>&nbsp;<span class="ident" id="5562654">d</span><span class="op" id="5562655">.</span><span class="ident" id="5562656">palette</span><span class="op" id="5562663">[</span><span class="op" id="5562664">:</span><span class="ident" id="5562665">n</span><span class="op" id="5562666">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5562670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5562674">for</span>&nbsp;<span class="ident" id="5562678">i</span>&nbsp;<span class="op" id="5562680">:=</span>&nbsp;<span class="num" id="5562683">0</span><span class="op" id="5562684">;</span>&nbsp;<span class="ident" id="5562686">i</span>&nbsp;<span class="op" id="5562688">&lt;</span>&nbsp;<span class="ident" id="5562690">n</span><span class="op" id="5562691">;</span>&nbsp;<span class="ident" id="5562693">i</span><span class="op" id="5562694">++</span>&nbsp;<span class="op" id="5562697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5562702">rgba</span>&nbsp;<span class="op" id="5562707">:=</span>&nbsp;<span class="ident" id="5562710">d</span><span class="op" id="5562711">.</span><span class="ident" id="5562712">palette</span><span class="op" id="5562719">[</span><span class="ident" id="5562720">i</span><span class="op" id="5562721">]</span><span class="op" id="5562722">.</span><span class="op" id="5562723">(</span><span class="ident" id="5562724">color</span><span class="op" id="5562729">.</span><span class="ident" id="5562730">RGBA</span><span class="op" id="5562734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5562739">d</span><span class="op" id="5562740">.</span><span class="ident" id="5562741">palette</span><span class="op" id="5562748">[</span><span class="ident" id="5562749">i</span><span class="op" id="5562750">]</span>&nbsp;<span class="op" id="5562752">=</span>&nbsp;<span class="ident" id="5562754">color</span><span class="op" id="5562759">.</span><span class="ident" id="5562760">NRGBA</span><span class="op" id="5562765">{</span><span class="ident" id="5562766">rgba</span><span class="op" id="5562770">.</span><span class="ident" id="5562771">R</span><span class="op" id="5562772">,</span>&nbsp;<span class="ident" id="5562774">rgba</span><span class="op" id="5562778">.</span><span class="ident" id="5562779">G</span><span class="op" id="5562780">,</span>&nbsp;<span class="ident" id="5562782">rgba</span><span class="op" id="5562786">.</span><span class="ident" id="5562787">B</span><span class="op" id="5562788">,</span>&nbsp;<span class="ident" id="5562790">d</span><span class="op" id="5562791">.</span><span class="ident" id="5562792">tmp</span><span class="op" id="5562795">[</span><span class="ident" id="5562796">i</span><span class="op" id="5562797">]</span><span class="op" id="5562798">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5562802">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5562805">case</span>&nbsp;<span class="ident" id="5562810">cbGA8</span><span class="op" id="5562815">,</span>&nbsp;<span class="ident" id="5562817">cbGA16</span><span class="op" id="5562823">,</span>&nbsp;<span class="ident" id="5562825">cbTCA8</span><span class="op" id="5562831">,</span>&nbsp;<span class="ident" id="5562833">cbTCA16</span><span class="op" id="5562840">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5562844">return</span>&nbsp;<span class="ident" id="5562851">FormatError</span><span class="op" id="5562862">(</span><span class="string" id="5562863">&#34;tRNS,&nbsp;color&nbsp;type&nbsp;mismatch&#34;</span><span class="op" id="5562890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5562893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5562896">return</span>&nbsp;<span class="ident" id="5562903">d</span><span class="op" id="5562904">.</span><span class="ident" id="5562905">verifyChecksum</span><span class="op" id="5562919">(</span><span class="op" id="5562920">)</span><br>
<span class="lineno">275</span><span class="op" id="5562922">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5562925">//&nbsp;Read&nbsp;presents&nbsp;one&nbsp;or&nbsp;more&nbsp;IDAT&nbsp;chunks&nbsp;as&nbsp;one&nbsp;continuous&nbsp;stream&nbsp;(minus&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5563002">//&nbsp;intermediate&nbsp;chunk&nbsp;headers&nbsp;and&nbsp;footers).&nbsp;If&nbsp;the&nbsp;PNG&nbsp;data&nbsp;looked&nbsp;like:</span><br>
<span class="lineno"></span><span class="comment" id="5563075">//&nbsp;&nbsp;&nbsp;...&nbsp;len0&nbsp;IDAT&nbsp;xxx&nbsp;crc0&nbsp;len1&nbsp;IDAT&nbsp;yy&nbsp;crc1&nbsp;len2&nbsp;IEND&nbsp;crc2</span><br>
<span class="lineno">280</span><span class="comment" id="5563136">//&nbsp;then&nbsp;this&nbsp;reader&nbsp;presents&nbsp;xxxyy.&nbsp;For&nbsp;well-formed&nbsp;PNG&nbsp;data,&nbsp;the&nbsp;decoder&nbsp;state</span><br>
<span class="lineno"></span><span class="comment" id="5563216">//&nbsp;immediately&nbsp;before&nbsp;the&nbsp;first&nbsp;Read&nbsp;call&nbsp;is&nbsp;that&nbsp;d.r&nbsp;is&nbsp;positioned&nbsp;between&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5563296">//&nbsp;first&nbsp;IDAT&nbsp;and&nbsp;xxx,&nbsp;and&nbsp;the&nbsp;decoder&nbsp;state&nbsp;immediately&nbsp;after&nbsp;the&nbsp;last&nbsp;Read</span><br>
<span class="lineno"></span><span class="comment" id="5563373">//&nbsp;call&nbsp;is&nbsp;that&nbsp;d.r&nbsp;is&nbsp;positioned&nbsp;between&nbsp;yy&nbsp;and&nbsp;crc1.</span><br>
<span class="lineno"></span><span class="keyword" id="5563428">func</span>&nbsp;<span class="op" id="5563433">(</span><span class="ident" id="5563434">d</span>&nbsp;<span class="op" id="5563436">*</span><span class="ident" id="5563437">decoder</span><span class="op" id="5563444">)</span>&nbsp;<span class="ident" id="5563446">Read</span><span class="op" id="5563450">(</span><span class="ident" id="5563451">p</span>&nbsp;<span class="op" id="5563453">[</span><span class="op" id="5563454">]</span><span class="builtintype" id="5563455">byte</span><span class="op" id="5563459">)</span>&nbsp;<span class="op" id="5563461">(</span><span class="builtintype" id="5563462">int</span><span class="op" id="5563465">,</span>&nbsp;<span class="builtintype" id="5563467">error</span><span class="op" id="5563472">)</span>&nbsp;<span class="op" id="5563474">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5563477">if</span>&nbsp;<span class="builtinfunc" id="5563480">len</span><span class="op" id="5563483">(</span><span class="ident" id="5563484">p</span><span class="op" id="5563485">)</span>&nbsp;<span class="op" id="5563487">==</span>&nbsp;<span class="num" id="5563490">0</span>&nbsp;<span class="op" id="5563492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5563496">return</span>&nbsp;<span class="num" id="5563503">0</span><span class="op" id="5563504">,</span>&nbsp;<span class="ident" id="5563506">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5563511">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5563514">for</span>&nbsp;<span class="ident" id="5563518">d</span><span class="op" id="5563519">.</span><span class="ident" id="5563520">idatLength</span>&nbsp;<span class="op" id="5563531">==</span>&nbsp;<span class="num" id="5563534">0</span>&nbsp;<span class="op" id="5563536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5563540">//&nbsp;We&nbsp;have&nbsp;exhausted&nbsp;an&nbsp;IDAT&nbsp;chunk.&nbsp;Verify&nbsp;the&nbsp;checksum&nbsp;of&nbsp;that&nbsp;chunk.</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5563613">if</span>&nbsp;<span class="ident" id="5563616">err</span>&nbsp;<span class="op" id="5563620">:=</span>&nbsp;<span class="ident" id="5563623">d</span><span class="op" id="5563624">.</span><span class="ident" id="5563625">verifyChecksum</span><span class="op" id="5563639">(</span><span class="op" id="5563640">)</span><span class="op" id="5563641">;</span>&nbsp;<span class="ident" id="5563643">err</span>&nbsp;<span class="op" id="5563647">!=</span>&nbsp;<span class="ident" id="5563650">nil</span>&nbsp;<span class="op" id="5563654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5563659">return</span>&nbsp;<span class="num" id="5563666">0</span><span class="op" id="5563667">,</span>&nbsp;<span class="ident" id="5563669">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5563675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5563679">//&nbsp;Read&nbsp;the&nbsp;length&nbsp;and&nbsp;chunk&nbsp;type&nbsp;of&nbsp;the&nbsp;next&nbsp;chunk,&nbsp;and&nbsp;check&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5563749">//&nbsp;it&nbsp;is&nbsp;an&nbsp;IDAT&nbsp;chunk.</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5563775">if</span>&nbsp;<span class="ident" id="5563778">_</span><span class="op" id="5563779">,</span>&nbsp;<span class="ident" id="5563781">err</span>&nbsp;<span class="op" id="5563785">:=</span>&nbsp;<span class="ident" id="5563788">io</span><span class="op" id="5563790">.</span><span class="ident" id="5563791">ReadFull</span><span class="op" id="5563799">(</span><span class="ident" id="5563800">d</span><span class="op" id="5563801">.</span><span class="ident" id="5563802">r</span><span class="op" id="5563803">,</span>&nbsp;<span class="ident" id="5563805">d</span><span class="op" id="5563806">.</span><span class="ident" id="5563807">tmp</span><span class="op" id="5563810">[</span><span class="op" id="5563811">:</span><span class="num" id="5563812">8</span><span class="op" id="5563813">]</span><span class="op" id="5563814">)</span><span class="op" id="5563815">;</span>&nbsp;<span class="ident" id="5563817">err</span>&nbsp;<span class="op" id="5563821">!=</span>&nbsp;<span class="ident" id="5563824">nil</span>&nbsp;<span class="op" id="5563828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5563833">return</span>&nbsp;<span class="num" id="5563840">0</span><span class="op" id="5563841">,</span>&nbsp;<span class="ident" id="5563843">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5563849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5563853">d</span><span class="op" id="5563854">.</span><span class="ident" id="5563855">idatLength</span>&nbsp;<span class="op" id="5563866">=</span>&nbsp;<span class="ident" id="5563868">binary</span><span class="op" id="5563874">.</span><span class="ident" id="5563875">BigEndian</span><span class="op" id="5563884">.</span><span class="ident" id="5563885">Uint32</span><span class="op" id="5563891">(</span><span class="ident" id="5563892">d</span><span class="op" id="5563893">.</span><span class="ident" id="5563894">tmp</span><span class="op" id="5563897">[</span><span class="op" id="5563898">:</span><span class="num" id="5563899">4</span><span class="op" id="5563900">]</span><span class="op" id="5563901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5563905">if</span>&nbsp;<span class="builtintype" id="5563908">string</span><span class="op" id="5563914">(</span><span class="ident" id="5563915">d</span><span class="op" id="5563916">.</span><span class="ident" id="5563917">tmp</span><span class="op" id="5563920">[</span><span class="num" id="5563921">4</span><span class="op" id="5563922">:</span><span class="num" id="5563923">8</span><span class="op" id="5563924">]</span><span class="op" id="5563925">)</span>&nbsp;<span class="op" id="5563927">!=</span>&nbsp;<span class="string" id="5563930">&#34;IDAT&#34;</span>&nbsp;<span class="op" id="5563937">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5563942">return</span>&nbsp;<span class="num" id="5563949">0</span><span class="op" id="5563950">,</span>&nbsp;<span class="ident" id="5563952">FormatError</span><span class="op" id="5563963">(</span><span class="string" id="5563964">&#34;not&nbsp;enough&nbsp;pixel&nbsp;data&#34;</span><span class="op" id="5563987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5563991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5563995">d</span><span class="op" id="5563996">.</span><span class="ident" id="5563997">crc</span><span class="op" id="5564000">.</span><span class="ident" id="5564001">Reset</span><span class="op" id="5564006">(</span><span class="op" id="5564007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5564011">d</span><span class="op" id="5564012">.</span><span class="ident" id="5564013">crc</span><span class="op" id="5564016">.</span><span class="ident" id="5564017">Write</span><span class="op" id="5564022">(</span><span class="ident" id="5564023">d</span><span class="op" id="5564024">.</span><span class="ident" id="5564025">tmp</span><span class="op" id="5564028">[</span><span class="num" id="5564029">4</span><span class="op" id="5564030">:</span><span class="num" id="5564031">8</span><span class="op" id="5564032">]</span><span class="op" id="5564033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5564036">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5564039">if</span>&nbsp;<span class="builtintype" id="5564042">int</span><span class="op" id="5564045">(</span><span class="ident" id="5564046">d</span><span class="op" id="5564047">.</span><span class="ident" id="5564048">idatLength</span><span class="op" id="5564058">)</span>&nbsp;<span class="op" id="5564060">&lt;</span>&nbsp;<span class="num" id="5564062">0</span>&nbsp;<span class="op" id="5564064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5564068">return</span>&nbsp;<span class="num" id="5564075">0</span><span class="op" id="5564076">,</span>&nbsp;<span class="ident" id="5564078">UnsupportedError</span><span class="op" id="5564094">(</span><span class="string" id="5564095">&#34;IDAT&nbsp;chunk&nbsp;length&nbsp;overflow&#34;</span><span class="op" id="5564123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5564126">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5564129">n</span><span class="op" id="5564130">,</span>&nbsp;<span class="ident" id="5564132">err</span>&nbsp;<span class="op" id="5564136">:=</span>&nbsp;<span class="ident" id="5564139">d</span><span class="op" id="5564140">.</span><span class="ident" id="5564141">r</span><span class="op" id="5564142">.</span><span class="ident" id="5564143">Read</span><span class="op" id="5564147">(</span><span class="ident" id="5564148">p</span><span class="op" id="5564149">[</span><span class="op" id="5564150">:</span><span class="ident" id="5564151">min</span><span class="op" id="5564154">(</span><span class="builtinfunc" id="5564155">len</span><span class="op" id="5564158">(</span><span class="ident" id="5564159">p</span><span class="op" id="5564160">)</span><span class="op" id="5564161">,</span>&nbsp;<span class="builtintype" id="5564163">int</span><span class="op" id="5564166">(</span><span class="ident" id="5564167">d</span><span class="op" id="5564168">.</span><span class="ident" id="5564169">idatLength</span><span class="op" id="5564179">)</span><span class="op" id="5564180">)</span><span class="op" id="5564181">]</span><span class="op" id="5564182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5564185">d</span><span class="op" id="5564186">.</span><span class="ident" id="5564187">crc</span><span class="op" id="5564190">.</span><span class="ident" id="5564191">Write</span><span class="op" id="5564196">(</span><span class="ident" id="5564197">p</span><span class="op" id="5564198">[</span><span class="op" id="5564199">:</span><span class="ident" id="5564200">n</span><span class="op" id="5564201">]</span><span class="op" id="5564202">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5564205">d</span><span class="op" id="5564206">.</span><span class="ident" id="5564207">idatLength</span>&nbsp;<span class="op" id="5564218">-=</span>&nbsp;<span class="builtintype" id="5564221">uint32</span><span class="op" id="5564227">(</span><span class="ident" id="5564228">n</span><span class="op" id="5564229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5564232">return</span>&nbsp;<span class="ident" id="5564239">n</span><span class="op" id="5564240">,</span>&nbsp;<span class="ident" id="5564242">err</span><br>
<span class="lineno"></span><span class="op" id="5564246">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5564249">//&nbsp;decode&nbsp;decodes&nbsp;the&nbsp;IDAT&nbsp;data&nbsp;into&nbsp;an&nbsp;image.</span><br>
<span class="lineno">315</span><span class="keyword" id="5564296">func</span>&nbsp;<span class="op" id="5564301">(</span><span class="ident" id="5564302">d</span>&nbsp;<span class="op" id="5564304">*</span><span class="ident" id="5564305">decoder</span><span class="op" id="5564312">)</span>&nbsp;<span class="ident" id="5564314">decode</span><span class="op" id="5564320">(</span><span class="op" id="5564321">)</span>&nbsp;<span class="op" id="5564323">(</span><span class="ident" id="5564324">image</span><span class="op" id="5564329">.</span><span class="ident" id="5564330">Image</span><span class="op" id="5564335">,</span>&nbsp;<span class="builtintype" id="5564337">error</span><span class="op" id="5564342">)</span>&nbsp;<span class="op" id="5564344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5564347">r</span><span class="op" id="5564348">,</span>&nbsp;<span class="ident" id="5564350">err</span>&nbsp;<span class="op" id="5564354">:=</span>&nbsp;<span class="ident" id="5564357">zlib</span><span class="op" id="5564361">.</span><span class="ident" id="5564362">NewReader</span><span class="op" id="5564371">(</span><span class="ident" id="5564372">d</span><span class="op" id="5564373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5564376">if</span>&nbsp;<span class="ident" id="5564379">err</span>&nbsp;<span class="op" id="5564383">!=</span>&nbsp;<span class="ident" id="5564386">nil</span>&nbsp;<span class="op" id="5564390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5564394">return</span>&nbsp;<span class="ident" id="5564401">nil</span><span class="op" id="5564404">,</span>&nbsp;<span class="ident" id="5564406">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5564411">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5564414">defer</span>&nbsp;<span class="ident" id="5564420">r</span><span class="op" id="5564421">.</span><span class="ident" id="5564422">Close</span><span class="op" id="5564427">(</span><span class="op" id="5564428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5564431">var</span>&nbsp;<span class="ident" id="5564435">img</span>&nbsp;<span class="ident" id="5564439">image</span><span class="op" id="5564444">.</span><span class="ident" id="5564445">Image</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5564452">if</span>&nbsp;<span class="ident" id="5564455">d</span><span class="op" id="5564456">.</span><span class="ident" id="5564457">interlace</span>&nbsp;<span class="op" id="5564467">==</span>&nbsp;<span class="ident" id="5564470">itNone</span>&nbsp;<span class="op" id="5564477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5564481">img</span><span class="op" id="5564484">,</span>&nbsp;<span class="ident" id="5564486">err</span>&nbsp;<span class="op" id="5564490">=</span>&nbsp;<span class="ident" id="5564492">d</span><span class="op" id="5564493">.</span><span class="ident" id="5564494">readImagePass</span><span class="op" id="5564507">(</span><span class="ident" id="5564508">r</span><span class="op" id="5564509">,</span>&nbsp;<span class="num" id="5564511">0</span><span class="op" id="5564512">,</span>&nbsp;<span class="builtintype" id="5564514">false</span><span class="op" id="5564519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5564522">}</span>&nbsp;<span class="keyword" id="5564524">else</span>&nbsp;<span class="keyword" id="5564529">if</span>&nbsp;<span class="ident" id="5564532">d</span><span class="op" id="5564533">.</span><span class="ident" id="5564534">interlace</span>&nbsp;<span class="op" id="5564544">==</span>&nbsp;<span class="ident" id="5564547">itAdam7</span>&nbsp;<span class="op" id="5564555">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5564559">//&nbsp;Allocate&nbsp;a&nbsp;blank&nbsp;image&nbsp;of&nbsp;the&nbsp;full&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5564605">img</span><span class="op" id="5564608">,</span>&nbsp;<span class="ident" id="5564610">err</span>&nbsp;<span class="op" id="5564614">=</span>&nbsp;<span class="ident" id="5564616">d</span><span class="op" id="5564617">.</span><span class="ident" id="5564618">readImagePass</span><span class="op" id="5564631">(</span><span class="ident" id="5564632">nil</span><span class="op" id="5564635">,</span>&nbsp;<span class="num" id="5564637">0</span><span class="op" id="5564638">,</span>&nbsp;<span class="builtintype" id="5564640">true</span><span class="op" id="5564644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5564648">for</span>&nbsp;<span class="ident" id="5564652">pass</span>&nbsp;<span class="op" id="5564657">:=</span>&nbsp;<span class="num" id="5564660">0</span><span class="op" id="5564661">;</span>&nbsp;<span class="ident" id="5564663">pass</span>&nbsp;<span class="op" id="5564668">&lt;</span>&nbsp;<span class="num" id="5564670">7</span><span class="op" id="5564671">;</span>&nbsp;<span class="ident" id="5564673">pass</span><span class="op" id="5564677">++</span>&nbsp;<span class="op" id="5564680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5564685">imagePass</span><span class="op" id="5564694">,</span>&nbsp;<span class="ident" id="5564696">err</span>&nbsp;<span class="op" id="5564700">:=</span>&nbsp;<span class="ident" id="5564703">d</span><span class="op" id="5564704">.</span><span class="ident" id="5564705">readImagePass</span><span class="op" id="5564718">(</span><span class="ident" id="5564719">r</span><span class="op" id="5564720">,</span>&nbsp;<span class="ident" id="5564722">pass</span><span class="op" id="5564726">,</span>&nbsp;<span class="builtintype" id="5564728">false</span><span class="op" id="5564733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5564738">if</span>&nbsp;<span class="ident" id="5564741">err</span>&nbsp;<span class="op" id="5564745">!=</span>&nbsp;<span class="ident" id="5564748">nil</span>&nbsp;<span class="op" id="5564752">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5564758">return</span>&nbsp;<span class="ident" id="5564765">nil</span><span class="op" id="5564768">,</span>&nbsp;<span class="ident" id="5564770">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5564777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5564782">d</span><span class="op" id="5564783">.</span><span class="ident" id="5564784">mergePassInto</span><span class="op" id="5564797">(</span><span class="ident" id="5564798">img</span><span class="op" id="5564801">,</span>&nbsp;<span class="ident" id="5564803">imagePass</span><span class="op" id="5564812">,</span>&nbsp;<span class="ident" id="5564814">pass</span><span class="op" id="5564818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5564822">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5564825">}</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5564829">//&nbsp;Check&nbsp;for&nbsp;EOF,&nbsp;to&nbsp;verify&nbsp;the&nbsp;zlib&nbsp;checksum.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5564877">n</span>&nbsp;<span class="op" id="5564879">:=</span>&nbsp;<span class="num" id="5564882">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5564885">for</span>&nbsp;<span class="ident" id="5564889">i</span>&nbsp;<span class="op" id="5564891">:=</span>&nbsp;<span class="num" id="5564894">0</span><span class="op" id="5564895">;</span>&nbsp;<span class="ident" id="5564897">n</span>&nbsp;<span class="op" id="5564899">==</span>&nbsp;<span class="num" id="5564902">0</span>&nbsp;<span class="op" id="5564904">&amp;&amp;</span>&nbsp;<span class="ident" id="5564907">err</span>&nbsp;<span class="op" id="5564911">==</span>&nbsp;<span class="ident" id="5564914">nil</span><span class="op" id="5564917">;</span>&nbsp;<span class="ident" id="5564919">i</span><span class="op" id="5564920">++</span>&nbsp;<span class="op" id="5564923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5564927">if</span>&nbsp;<span class="ident" id="5564930">i</span>&nbsp;<span class="op" id="5564932">==</span>&nbsp;<span class="num" id="5564935">100</span>&nbsp;<span class="op" id="5564939">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5564944">return</span>&nbsp;<span class="ident" id="5564951">nil</span><span class="op" id="5564954">,</span>&nbsp;<span class="ident" id="5564956">io</span><span class="op" id="5564958">.</span><span class="ident" id="5564959">ErrNoProgress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5564975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5564979">n</span><span class="op" id="5564980">,</span>&nbsp;<span class="ident" id="5564982">err</span>&nbsp;<span class="op" id="5564986">=</span>&nbsp;<span class="ident" id="5564988">r</span><span class="op" id="5564989">.</span><span class="ident" id="5564990">Read</span><span class="op" id="5564994">(</span><span class="ident" id="5564995">d</span><span class="op" id="5564996">.</span><span class="ident" id="5564997">tmp</span><span class="op" id="5565000">[</span><span class="op" id="5565001">:</span><span class="num" id="5565002">1</span><span class="op" id="5565003">]</span><span class="op" id="5565004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5565007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5565010">if</span>&nbsp;<span class="ident" id="5565013">err</span>&nbsp;<span class="op" id="5565017">!=</span>&nbsp;<span class="ident" id="5565020">nil</span>&nbsp;<span class="op" id="5565024">&amp;&amp;</span>&nbsp;<span class="ident" id="5565027">err</span>&nbsp;<span class="op" id="5565031">!=</span>&nbsp;<span class="ident" id="5565034">io</span><span class="op" id="5565036">.</span><span class="ident" id="5565037">EOF</span>&nbsp;<span class="op" id="5565041">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5565045">return</span>&nbsp;<span class="ident" id="5565052">nil</span><span class="op" id="5565055">,</span>&nbsp;<span class="ident" id="5565057">FormatError</span><span class="op" id="5565068">(</span><span class="ident" id="5565069">err</span><span class="op" id="5565072">.</span><span class="ident" id="5565073">Error</span><span class="op" id="5565078">(</span><span class="op" id="5565079">)</span><span class="op" id="5565080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5565083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5565086">if</span>&nbsp;<span class="ident" id="5565089">n</span>&nbsp;<span class="op" id="5565091">!=</span>&nbsp;<span class="num" id="5565094">0</span>&nbsp;<span class="op" id="5565096">||</span>&nbsp;<span class="ident" id="5565099">d</span><span class="op" id="5565100">.</span><span class="ident" id="5565101">idatLength</span>&nbsp;<span class="op" id="5565112">!=</span>&nbsp;<span class="num" id="5565115">0</span>&nbsp;<span class="op" id="5565117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5565121">return</span>&nbsp;<span class="ident" id="5565128">nil</span><span class="op" id="5565131">,</span>&nbsp;<span class="ident" id="5565133">FormatError</span><span class="op" id="5565144">(</span><span class="string" id="5565145">&#34;too&nbsp;much&nbsp;pixel&nbsp;data&#34;</span><span class="op" id="5565166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5565169">}</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5565173">return</span>&nbsp;<span class="ident" id="5565180">img</span><span class="op" id="5565183">,</span>&nbsp;<span class="ident" id="5565185">nil</span><br>
<span class="lineno"></span><span class="op" id="5565189">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5565192">//&nbsp;readImagePass&nbsp;reads&nbsp;a&nbsp;single&nbsp;image&nbsp;pass,&nbsp;sized&nbsp;according&nbsp;to&nbsp;the&nbsp;pass&nbsp;number.</span><br>
<span class="lineno">355</span><span class="keyword" id="5565272">func</span>&nbsp;<span class="op" id="5565277">(</span><span class="ident" id="5565278">d</span>&nbsp;<span class="op" id="5565280">*</span><span class="ident" id="5565281">decoder</span><span class="op" id="5565288">)</span>&nbsp;<span class="ident" id="5565290">readImagePass</span><span class="op" id="5565303">(</span><span class="ident" id="5565304">r</span>&nbsp;<span class="ident" id="5565306">io</span><span class="op" id="5565308">.</span><span class="ident" id="5565309">Reader</span><span class="op" id="5565315">,</span>&nbsp;<span class="ident" id="5565317">pass</span>&nbsp;<span class="builtintype" id="5565322">int</span><span class="op" id="5565325">,</span>&nbsp;<span class="ident" id="5565327">allocateOnly</span>&nbsp;<span class="builtintype" id="5565340">bool</span><span class="op" id="5565344">)</span>&nbsp;<span class="op" id="5565346">(</span><span class="ident" id="5565347">image</span><span class="op" id="5565352">.</span><span class="ident" id="5565353">Image</span><span class="op" id="5565358">,</span>&nbsp;<span class="builtintype" id="5565360">error</span><span class="op" id="5565365">)</span>&nbsp;<span class="op" id="5565367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5565370">var</span>&nbsp;<span class="ident" id="5565374">bitsPerPixel</span>&nbsp;<span class="builtintype" id="5565387">int</span>&nbsp;<span class="op" id="5565391">=</span>&nbsp;<span class="num" id="5565393">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5565396">pixOffset</span>&nbsp;<span class="op" id="5565406">:=</span>&nbsp;<span class="num" id="5565409">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5565412">var</span>&nbsp;<span class="op" id="5565416">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5565420">gray</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5565429">*</span><span class="ident" id="5565430">image</span><span class="op" id="5565435">.</span><span class="ident" id="5565436">Gray</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5565443">rgba</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5565452">*</span><span class="ident" id="5565453">image</span><span class="op" id="5565458">.</span><span class="ident" id="5565459">RGBA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5565466">paletted</span>&nbsp;<span class="op" id="5565475">*</span><span class="ident" id="5565476">image</span><span class="op" id="5565481">.</span><span class="ident" id="5565482">Paletted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5565493">nrgba</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5565502">*</span><span class="ident" id="5565503">image</span><span class="op" id="5565508">.</span><span class="ident" id="5565509">NRGBA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5565517">gray16</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5565526">*</span><span class="ident" id="5565527">image</span><span class="op" id="5565532">.</span><span class="ident" id="5565533">Gray16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5565542">rgba64</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5565551">*</span><span class="ident" id="5565552">image</span><span class="op" id="5565557">.</span><span class="ident" id="5565558">RGBA64</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5565567">nrgba64</span>&nbsp;&nbsp;<span class="op" id="5565576">*</span><span class="ident" id="5565577">image</span><span class="op" id="5565582">.</span><span class="ident" id="5565583">NRGBA64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5565593">img</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5565602">image</span><span class="op" id="5565607">.</span><span class="ident" id="5565608">Image</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5565615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5565618">width</span><span class="op" id="5565623">,</span>&nbsp;<span class="ident" id="5565625">height</span>&nbsp;<span class="op" id="5565632">:=</span>&nbsp;<span class="ident" id="5565635">d</span><span class="op" id="5565636">.</span><span class="ident" id="5565637">width</span><span class="op" id="5565642">,</span>&nbsp;<span class="ident" id="5565644">d</span><span class="op" id="5565645">.</span><span class="ident" id="5565646">height</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5565654">if</span>&nbsp;<span class="ident" id="5565657">d</span><span class="op" id="5565658">.</span><span class="ident" id="5565659">interlace</span>&nbsp;<span class="op" id="5565669">==</span>&nbsp;<span class="ident" id="5565672">itAdam7</span>&nbsp;<span class="op" id="5565680">&amp;&amp;</span>&nbsp;<span class="op" id="5565683">!</span><span class="ident" id="5565684">allocateOnly</span>&nbsp;<span class="op" id="5565697">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5565701">p</span>&nbsp;<span class="op" id="5565703">:=</span>&nbsp;<span class="ident" id="5565706">interlacing</span><span class="op" id="5565717">[</span><span class="ident" id="5565718">pass</span><span class="op" id="5565722">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5565726">//&nbsp;Add&nbsp;the&nbsp;multiplication&nbsp;factor&nbsp;and&nbsp;subtract&nbsp;one,&nbsp;effectively&nbsp;rounding&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5565804">width</span>&nbsp;<span class="op" id="5565810">=</span>&nbsp;<span class="op" id="5565812">(</span><span class="ident" id="5565813">width</span>&nbsp;<span class="op" id="5565819">-</span>&nbsp;<span class="ident" id="5565821">p</span><span class="op" id="5565822">.</span><span class="ident" id="5565823">xOffset</span>&nbsp;<span class="op" id="5565831">+</span>&nbsp;<span class="ident" id="5565833">p</span><span class="op" id="5565834">.</span><span class="ident" id="5565835">xFactor</span>&nbsp;<span class="op" id="5565843">-</span>&nbsp;<span class="num" id="5565845">1</span><span class="op" id="5565846">)</span>&nbsp;<span class="op" id="5565848">/</span>&nbsp;<span class="ident" id="5565850">p</span><span class="op" id="5565851">.</span><span class="ident" id="5565852">xFactor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5565862">height</span>&nbsp;<span class="op" id="5565869">=</span>&nbsp;<span class="op" id="5565871">(</span><span class="ident" id="5565872">height</span>&nbsp;<span class="op" id="5565879">-</span>&nbsp;<span class="ident" id="5565881">p</span><span class="op" id="5565882">.</span><span class="ident" id="5565883">yOffset</span>&nbsp;<span class="op" id="5565891">+</span>&nbsp;<span class="ident" id="5565893">p</span><span class="op" id="5565894">.</span><span class="ident" id="5565895">yFactor</span>&nbsp;<span class="op" id="5565903">-</span>&nbsp;<span class="num" id="5565905">1</span><span class="op" id="5565906">)</span>&nbsp;<span class="op" id="5565908">/</span>&nbsp;<span class="ident" id="5565910">p</span><span class="op" id="5565911">.</span><span class="ident" id="5565912">yFactor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5565921">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5565924">switch</span>&nbsp;<span class="ident" id="5565931">d</span><span class="op" id="5565932">.</span><span class="ident" id="5565933">cb</span>&nbsp;<span class="op" id="5565936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5565939">case</span>&nbsp;<span class="ident" id="5565944">cbG1</span><span class="op" id="5565948">,</span>&nbsp;<span class="ident" id="5565950">cbG2</span><span class="op" id="5565954">,</span>&nbsp;<span class="ident" id="5565956">cbG4</span><span class="op" id="5565960">,</span>&nbsp;<span class="ident" id="5565962">cbG8</span><span class="op" id="5565966">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5565970">bitsPerPixel</span>&nbsp;<span class="op" id="5565983">=</span>&nbsp;<span class="ident" id="5565985">d</span><span class="op" id="5565986">.</span><span class="ident" id="5565987">depth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5565995">gray</span>&nbsp;<span class="op" id="5566000">=</span>&nbsp;<span class="ident" id="5566002">image</span><span class="op" id="5566007">.</span><span class="ident" id="5566008">NewGray</span><span class="op" id="5566015">(</span><span class="ident" id="5566016">image</span><span class="op" id="5566021">.</span><span class="ident" id="5566022">Rect</span><span class="op" id="5566026">(</span><span class="num" id="5566027">0</span><span class="op" id="5566028">,</span>&nbsp;<span class="num" id="5566030">0</span><span class="op" id="5566031">,</span>&nbsp;<span class="ident" id="5566033">width</span><span class="op" id="5566038">,</span>&nbsp;<span class="ident" id="5566040">height</span><span class="op" id="5566046">)</span><span class="op" id="5566047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5566051">img</span>&nbsp;<span class="op" id="5566055">=</span>&nbsp;<span class="ident" id="5566057">gray</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5566063">case</span>&nbsp;<span class="ident" id="5566068">cbGA8</span><span class="op" id="5566073">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5566077">bitsPerPixel</span>&nbsp;<span class="op" id="5566090">=</span>&nbsp;<span class="num" id="5566092">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5566097">nrgba</span>&nbsp;<span class="op" id="5566103">=</span>&nbsp;<span class="ident" id="5566105">image</span><span class="op" id="5566110">.</span><span class="ident" id="5566111">NewNRGBA</span><span class="op" id="5566119">(</span><span class="ident" id="5566120">image</span><span class="op" id="5566125">.</span><span class="ident" id="5566126">Rect</span><span class="op" id="5566130">(</span><span class="num" id="5566131">0</span><span class="op" id="5566132">,</span>&nbsp;<span class="num" id="5566134">0</span><span class="op" id="5566135">,</span>&nbsp;<span class="ident" id="5566137">width</span><span class="op" id="5566142">,</span>&nbsp;<span class="ident" id="5566144">height</span><span class="op" id="5566150">)</span><span class="op" id="5566151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5566155">img</span>&nbsp;<span class="op" id="5566159">=</span>&nbsp;<span class="ident" id="5566161">nrgba</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5566168">case</span>&nbsp;<span class="ident" id="5566173">cbTC8</span><span class="op" id="5566178">:</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5566182">bitsPerPixel</span>&nbsp;<span class="op" id="5566195">=</span>&nbsp;<span class="num" id="5566197">24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5566202">rgba</span>&nbsp;<span class="op" id="5566207">=</span>&nbsp;<span class="ident" id="5566209">image</span><span class="op" id="5566214">.</span><span class="ident" id="5566215">NewRGBA</span><span class="op" id="5566222">(</span><span class="ident" id="5566223">image</span><span class="op" id="5566228">.</span><span class="ident" id="5566229">Rect</span><span class="op" id="5566233">(</span><span class="num" id="5566234">0</span><span class="op" id="5566235">,</span>&nbsp;<span class="num" id="5566237">0</span><span class="op" id="5566238">,</span>&nbsp;<span class="ident" id="5566240">width</span><span class="op" id="5566245">,</span>&nbsp;<span class="ident" id="5566247">height</span><span class="op" id="5566253">)</span><span class="op" id="5566254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5566258">img</span>&nbsp;<span class="op" id="5566262">=</span>&nbsp;<span class="ident" id="5566264">rgba</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5566270">case</span>&nbsp;<span class="ident" id="5566275">cbP1</span><span class="op" id="5566279">,</span>&nbsp;<span class="ident" id="5566281">cbP2</span><span class="op" id="5566285">,</span>&nbsp;<span class="ident" id="5566287">cbP4</span><span class="op" id="5566291">,</span>&nbsp;<span class="ident" id="5566293">cbP8</span><span class="op" id="5566297">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5566301">bitsPerPixel</span>&nbsp;<span class="op" id="5566314">=</span>&nbsp;<span class="ident" id="5566316">d</span><span class="op" id="5566317">.</span><span class="ident" id="5566318">depth</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5566326">paletted</span>&nbsp;<span class="op" id="5566335">=</span>&nbsp;<span class="ident" id="5566337">image</span><span class="op" id="5566342">.</span><span class="ident" id="5566343">NewPaletted</span><span class="op" id="5566354">(</span><span class="ident" id="5566355">image</span><span class="op" id="5566360">.</span><span class="ident" id="5566361">Rect</span><span class="op" id="5566365">(</span><span class="num" id="5566366">0</span><span class="op" id="5566367">,</span>&nbsp;<span class="num" id="5566369">0</span><span class="op" id="5566370">,</span>&nbsp;<span class="ident" id="5566372">width</span><span class="op" id="5566377">,</span>&nbsp;<span class="ident" id="5566379">height</span><span class="op" id="5566385">)</span><span class="op" id="5566386">,</span>&nbsp;<span class="ident" id="5566388">d</span><span class="op" id="5566389">.</span><span class="ident" id="5566390">palette</span><span class="op" id="5566397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5566401">img</span>&nbsp;<span class="op" id="5566405">=</span>&nbsp;<span class="ident" id="5566407">paletted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5566417">case</span>&nbsp;<span class="ident" id="5566422">cbTCA8</span><span class="op" id="5566428">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5566432">bitsPerPixel</span>&nbsp;<span class="op" id="5566445">=</span>&nbsp;<span class="num" id="5566447">32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5566452">nrgba</span>&nbsp;<span class="op" id="5566458">=</span>&nbsp;<span class="ident" id="5566460">image</span><span class="op" id="5566465">.</span><span class="ident" id="5566466">NewNRGBA</span><span class="op" id="5566474">(</span><span class="ident" id="5566475">image</span><span class="op" id="5566480">.</span><span class="ident" id="5566481">Rect</span><span class="op" id="5566485">(</span><span class="num" id="5566486">0</span><span class="op" id="5566487">,</span>&nbsp;<span class="num" id="5566489">0</span><span class="op" id="5566490">,</span>&nbsp;<span class="ident" id="5566492">width</span><span class="op" id="5566497">,</span>&nbsp;<span class="ident" id="5566499">height</span><span class="op" id="5566505">)</span><span class="op" id="5566506">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5566510">img</span>&nbsp;<span class="op" id="5566514">=</span>&nbsp;<span class="ident" id="5566516">nrgba</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5566523">case</span>&nbsp;<span class="ident" id="5566528">cbG16</span><span class="op" id="5566533">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5566537">bitsPerPixel</span>&nbsp;<span class="op" id="5566550">=</span>&nbsp;<span class="num" id="5566552">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5566557">gray16</span>&nbsp;<span class="op" id="5566564">=</span>&nbsp;<span class="ident" id="5566566">image</span><span class="op" id="5566571">.</span><span class="ident" id="5566572">NewGray16</span><span class="op" id="5566581">(</span><span class="ident" id="5566582">image</span><span class="op" id="5566587">.</span><span class="ident" id="5566588">Rect</span><span class="op" id="5566592">(</span><span class="num" id="5566593">0</span><span class="op" id="5566594">,</span>&nbsp;<span class="num" id="5566596">0</span><span class="op" id="5566597">,</span>&nbsp;<span class="ident" id="5566599">width</span><span class="op" id="5566604">,</span>&nbsp;<span class="ident" id="5566606">height</span><span class="op" id="5566612">)</span><span class="op" id="5566613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5566617">img</span>&nbsp;<span class="op" id="5566621">=</span>&nbsp;<span class="ident" id="5566623">gray16</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5566631">case</span>&nbsp;<span class="ident" id="5566636">cbGA16</span><span class="op" id="5566642">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5566646">bitsPerPixel</span>&nbsp;<span class="op" id="5566659">=</span>&nbsp;<span class="num" id="5566661">32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5566666">nrgba64</span>&nbsp;<span class="op" id="5566674">=</span>&nbsp;<span class="ident" id="5566676">image</span><span class="op" id="5566681">.</span><span class="ident" id="5566682">NewNRGBA64</span><span class="op" id="5566692">(</span><span class="ident" id="5566693">image</span><span class="op" id="5566698">.</span><span class="ident" id="5566699">Rect</span><span class="op" id="5566703">(</span><span class="num" id="5566704">0</span><span class="op" id="5566705">,</span>&nbsp;<span class="num" id="5566707">0</span><span class="op" id="5566708">,</span>&nbsp;<span class="ident" id="5566710">width</span><span class="op" id="5566715">,</span>&nbsp;<span class="ident" id="5566717">height</span><span class="op" id="5566723">)</span><span class="op" id="5566724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5566728">img</span>&nbsp;<span class="op" id="5566732">=</span>&nbsp;<span class="ident" id="5566734">nrgba64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5566743">case</span>&nbsp;<span class="ident" id="5566748">cbTC16</span><span class="op" id="5566754">:</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5566758">bitsPerPixel</span>&nbsp;<span class="op" id="5566771">=</span>&nbsp;<span class="num" id="5566773">48</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5566778">rgba64</span>&nbsp;<span class="op" id="5566785">=</span>&nbsp;<span class="ident" id="5566787">image</span><span class="op" id="5566792">.</span><span class="ident" id="5566793">NewRGBA64</span><span class="op" id="5566802">(</span><span class="ident" id="5566803">image</span><span class="op" id="5566808">.</span><span class="ident" id="5566809">Rect</span><span class="op" id="5566813">(</span><span class="num" id="5566814">0</span><span class="op" id="5566815">,</span>&nbsp;<span class="num" id="5566817">0</span><span class="op" id="5566818">,</span>&nbsp;<span class="ident" id="5566820">width</span><span class="op" id="5566825">,</span>&nbsp;<span class="ident" id="5566827">height</span><span class="op" id="5566833">)</span><span class="op" id="5566834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5566838">img</span>&nbsp;<span class="op" id="5566842">=</span>&nbsp;<span class="ident" id="5566844">rgba64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5566852">case</span>&nbsp;<span class="ident" id="5566857">cbTCA16</span><span class="op" id="5566864">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5566868">bitsPerPixel</span>&nbsp;<span class="op" id="5566881">=</span>&nbsp;<span class="num" id="5566883">64</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5566888">nrgba64</span>&nbsp;<span class="op" id="5566896">=</span>&nbsp;<span class="ident" id="5566898">image</span><span class="op" id="5566903">.</span><span class="ident" id="5566904">NewNRGBA64</span><span class="op" id="5566914">(</span><span class="ident" id="5566915">image</span><span class="op" id="5566920">.</span><span class="ident" id="5566921">Rect</span><span class="op" id="5566925">(</span><span class="num" id="5566926">0</span><span class="op" id="5566927">,</span>&nbsp;<span class="num" id="5566929">0</span><span class="op" id="5566930">,</span>&nbsp;<span class="ident" id="5566932">width</span><span class="op" id="5566937">,</span>&nbsp;<span class="ident" id="5566939">height</span><span class="op" id="5566945">)</span><span class="op" id="5566946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5566950">img</span>&nbsp;<span class="op" id="5566954">=</span>&nbsp;<span class="ident" id="5566956">nrgba64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5566965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5566968">if</span>&nbsp;<span class="ident" id="5566971">allocateOnly</span>&nbsp;<span class="op" id="5566984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5566988">return</span>&nbsp;<span class="ident" id="5566995">img</span><span class="op" id="5566998">,</span>&nbsp;<span class="ident" id="5567000">nil</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5567005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5567008">bytesPerPixel</span>&nbsp;<span class="op" id="5567022">:=</span>&nbsp;<span class="op" id="5567025">(</span><span class="ident" id="5567026">bitsPerPixel</span>&nbsp;<span class="op" id="5567039">+</span>&nbsp;<span class="num" id="5567041">7</span><span class="op" id="5567042">)</span>&nbsp;<span class="op" id="5567044">/</span>&nbsp;<span class="num" id="5567046">8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5567050">//&nbsp;The&nbsp;+1&nbsp;is&nbsp;for&nbsp;the&nbsp;per-row&nbsp;filter&nbsp;type,&nbsp;which&nbsp;is&nbsp;at&nbsp;cr[0].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5567112">rowSize</span>&nbsp;<span class="op" id="5567120">:=</span>&nbsp;<span class="num" id="5567123">1</span>&nbsp;<span class="op" id="5567125">+</span>&nbsp;<span class="op" id="5567127">(</span><span class="ident" id="5567128">bitsPerPixel</span><span class="op" id="5567140">*</span><span class="ident" id="5567141">width</span><span class="op" id="5567146">+</span><span class="num" id="5567147">7</span><span class="op" id="5567148">)</span><span class="op" id="5567149">/</span><span class="num" id="5567150">8</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5567153">//&nbsp;cr&nbsp;and&nbsp;pr&nbsp;are&nbsp;the&nbsp;bytes&nbsp;for&nbsp;the&nbsp;current&nbsp;and&nbsp;previous&nbsp;row.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5567215">cr</span>&nbsp;<span class="op" id="5567218">:=</span>&nbsp;<span class="builtinfunc" id="5567221">make</span><span class="op" id="5567225">(</span><span class="op" id="5567226">[</span><span class="op" id="5567227">]</span><span class="builtintype" id="5567228">uint8</span><span class="op" id="5567233">,</span>&nbsp;<span class="ident" id="5567235">rowSize</span><span class="op" id="5567242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5567245">pr</span>&nbsp;<span class="op" id="5567248">:=</span>&nbsp;<span class="builtinfunc" id="5567251">make</span><span class="op" id="5567255">(</span><span class="op" id="5567256">[</span><span class="op" id="5567257">]</span><span class="builtintype" id="5567258">uint8</span><span class="op" id="5567263">,</span>&nbsp;<span class="ident" id="5567265">rowSize</span><span class="op" id="5567272">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5567276">for</span>&nbsp;<span class="ident" id="5567280">y</span>&nbsp;<span class="op" id="5567282">:=</span>&nbsp;<span class="num" id="5567285">0</span><span class="op" id="5567286">;</span>&nbsp;<span class="ident" id="5567288">y</span>&nbsp;<span class="op" id="5567290">&lt;</span>&nbsp;<span class="ident" id="5567292">height</span><span class="op" id="5567298">;</span>&nbsp;<span class="ident" id="5567300">y</span><span class="op" id="5567301">++</span>&nbsp;<span class="op" id="5567304">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5567308">//&nbsp;Read&nbsp;the&nbsp;decompressed&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5567342">_</span><span class="op" id="5567343">,</span>&nbsp;<span class="ident" id="5567345">err</span>&nbsp;<span class="op" id="5567349">:=</span>&nbsp;<span class="ident" id="5567352">io</span><span class="op" id="5567354">.</span><span class="ident" id="5567355">ReadFull</span><span class="op" id="5567363">(</span><span class="ident" id="5567364">r</span><span class="op" id="5567365">,</span>&nbsp;<span class="ident" id="5567367">cr</span><span class="op" id="5567369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5567373">if</span>&nbsp;<span class="ident" id="5567376">err</span>&nbsp;<span class="op" id="5567380">!=</span>&nbsp;<span class="ident" id="5567383">nil</span>&nbsp;<span class="op" id="5567387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5567392">return</span>&nbsp;<span class="ident" id="5567399">nil</span><span class="op" id="5567402">,</span>&nbsp;<span class="ident" id="5567404">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5567410">}</span><br>
<span class="lineno">430</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5567415">//&nbsp;Apply&nbsp;the&nbsp;filter.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5567438">cdat</span>&nbsp;<span class="op" id="5567443">:=</span>&nbsp;<span class="ident" id="5567446">cr</span><span class="op" id="5567448">[</span><span class="num" id="5567449">1</span><span class="op" id="5567450">:</span><span class="op" id="5567451">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5567455">pdat</span>&nbsp;<span class="op" id="5567460">:=</span>&nbsp;<span class="ident" id="5567463">pr</span><span class="op" id="5567465">[</span><span class="num" id="5567466">1</span><span class="op" id="5567467">:</span><span class="op" id="5567468">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5567472">switch</span>&nbsp;<span class="ident" id="5567479">cr</span><span class="op" id="5567481">[</span><span class="num" id="5567482">0</span><span class="op" id="5567483">]</span>&nbsp;<span class="op" id="5567485">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5567489">case</span>&nbsp;<span class="ident" id="5567494">ftNone</span><span class="op" id="5567500">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5567505">//&nbsp;No-op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5567517">case</span>&nbsp;<span class="ident" id="5567522">ftSub</span><span class="op" id="5567527">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5567532">for</span>&nbsp;<span class="ident" id="5567536">i</span>&nbsp;<span class="op" id="5567538">:=</span>&nbsp;<span class="ident" id="5567541">bytesPerPixel</span><span class="op" id="5567554">;</span>&nbsp;<span class="ident" id="5567556">i</span>&nbsp;<span class="op" id="5567558">&lt;</span>&nbsp;<span class="builtinfunc" id="5567560">len</span><span class="op" id="5567563">(</span><span class="ident" id="5567564">cdat</span><span class="op" id="5567568">)</span><span class="op" id="5567569">;</span>&nbsp;<span class="ident" id="5567571">i</span><span class="op" id="5567572">++</span>&nbsp;<span class="op" id="5567575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5567581">cdat</span><span class="op" id="5567585">[</span><span class="ident" id="5567586">i</span><span class="op" id="5567587">]</span>&nbsp;<span class="op" id="5567589">+=</span>&nbsp;<span class="ident" id="5567592">cdat</span><span class="op" id="5567596">[</span><span class="ident" id="5567597">i</span><span class="op" id="5567598">-</span><span class="ident" id="5567599">bytesPerPixel</span><span class="op" id="5567612">]</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5567617">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5567621">case</span>&nbsp;<span class="ident" id="5567626">ftUp</span><span class="op" id="5567630">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5567635">for</span>&nbsp;<span class="ident" id="5567639">i</span><span class="op" id="5567640">,</span>&nbsp;<span class="ident" id="5567642">p</span>&nbsp;<span class="op" id="5567644">:=</span>&nbsp;<span class="keyword" id="5567647">range</span>&nbsp;<span class="ident" id="5567653">pdat</span>&nbsp;<span class="op" id="5567658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5567664">cdat</span><span class="op" id="5567668">[</span><span class="ident" id="5567669">i</span><span class="op" id="5567670">]</span>&nbsp;<span class="op" id="5567672">+=</span>&nbsp;<span class="ident" id="5567675">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5567680">}</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5567684">case</span>&nbsp;<span class="ident" id="5567689">ftAverage</span><span class="op" id="5567698">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5567703">for</span>&nbsp;<span class="ident" id="5567707">i</span>&nbsp;<span class="op" id="5567709">:=</span>&nbsp;<span class="num" id="5567712">0</span><span class="op" id="5567713">;</span>&nbsp;<span class="ident" id="5567715">i</span>&nbsp;<span class="op" id="5567717">&lt;</span>&nbsp;<span class="ident" id="5567719">bytesPerPixel</span><span class="op" id="5567732">;</span>&nbsp;<span class="ident" id="5567734">i</span><span class="op" id="5567735">++</span>&nbsp;<span class="op" id="5567738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5567744">cdat</span><span class="op" id="5567748">[</span><span class="ident" id="5567749">i</span><span class="op" id="5567750">]</span>&nbsp;<span class="op" id="5567752">+=</span>&nbsp;<span class="ident" id="5567755">pdat</span><span class="op" id="5567759">[</span><span class="ident" id="5567760">i</span><span class="op" id="5567761">]</span>&nbsp;<span class="op" id="5567763">/</span>&nbsp;<span class="num" id="5567765">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5567770">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5567775">for</span>&nbsp;<span class="ident" id="5567779">i</span>&nbsp;<span class="op" id="5567781">:=</span>&nbsp;<span class="ident" id="5567784">bytesPerPixel</span><span class="op" id="5567797">;</span>&nbsp;<span class="ident" id="5567799">i</span>&nbsp;<span class="op" id="5567801">&lt;</span>&nbsp;<span class="builtinfunc" id="5567803">len</span><span class="op" id="5567806">(</span><span class="ident" id="5567807">cdat</span><span class="op" id="5567811">)</span><span class="op" id="5567812">;</span>&nbsp;<span class="ident" id="5567814">i</span><span class="op" id="5567815">++</span>&nbsp;<span class="op" id="5567818">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5567824">cdat</span><span class="op" id="5567828">[</span><span class="ident" id="5567829">i</span><span class="op" id="5567830">]</span>&nbsp;<span class="op" id="5567832">+=</span>&nbsp;<span class="builtintype" id="5567835">uint8</span><span class="op" id="5567840">(</span><span class="op" id="5567841">(</span><span class="builtintype" id="5567842">int</span><span class="op" id="5567845">(</span><span class="ident" id="5567846">cdat</span><span class="op" id="5567850">[</span><span class="ident" id="5567851">i</span><span class="op" id="5567852">-</span><span class="ident" id="5567853">bytesPerPixel</span><span class="op" id="5567866">]</span><span class="op" id="5567867">)</span>&nbsp;<span class="op" id="5567869">+</span>&nbsp;<span class="builtintype" id="5567871">int</span><span class="op" id="5567874">(</span><span class="ident" id="5567875">pdat</span><span class="op" id="5567879">[</span><span class="ident" id="5567880">i</span><span class="op" id="5567881">]</span><span class="op" id="5567882">)</span><span class="op" id="5567883">)</span>&nbsp;<span class="op" id="5567885">/</span>&nbsp;<span class="num" id="5567887">2</span><span class="op" id="5567888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5567893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5567897">case</span>&nbsp;<span class="ident" id="5567902">ftPaeth</span><span class="op" id="5567909">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5567914">filterPaeth</span><span class="op" id="5567925">(</span><span class="ident" id="5567926">cdat</span><span class="op" id="5567930">,</span>&nbsp;<span class="ident" id="5567932">pdat</span><span class="op" id="5567936">,</span>&nbsp;<span class="ident" id="5567938">bytesPerPixel</span><span class="op" id="5567951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5567955">default</span><span class="op" id="5567962">:</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5567967">return</span>&nbsp;<span class="ident" id="5567974">nil</span><span class="op" id="5567977">,</span>&nbsp;<span class="ident" id="5567979">FormatError</span><span class="op" id="5567990">(</span><span class="string" id="5567991">&#34;bad&nbsp;filter&nbsp;type&#34;</span><span class="op" id="5568008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5568012">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5568017">//&nbsp;Convert&nbsp;from&nbsp;bytes&nbsp;to&nbsp;colors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5568052">switch</span>&nbsp;<span class="ident" id="5568059">d</span><span class="op" id="5568060">.</span><span class="ident" id="5568061">cb</span>&nbsp;<span class="op" id="5568064">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5568068">case</span>&nbsp;<span class="ident" id="5568073">cbG1</span><span class="op" id="5568077">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5568082">for</span>&nbsp;<span class="ident" id="5568086">x</span>&nbsp;<span class="op" id="5568088">:=</span>&nbsp;<span class="num" id="5568091">0</span><span class="op" id="5568092">;</span>&nbsp;<span class="ident" id="5568094">x</span>&nbsp;<span class="op" id="5568096">&lt;</span>&nbsp;<span class="ident" id="5568098">width</span><span class="op" id="5568103">;</span>&nbsp;<span class="ident" id="5568105">x</span>&nbsp;<span class="op" id="5568107">+=</span>&nbsp;<span class="num" id="5568110">8</span>&nbsp;<span class="op" id="5568112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5568118">b</span>&nbsp;<span class="op" id="5568120">:=</span>&nbsp;<span class="ident" id="5568123">cdat</span><span class="op" id="5568127">[</span><span class="ident" id="5568128">x</span><span class="op" id="5568129">/</span><span class="num" id="5568130">8</span><span class="op" id="5568131">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5568137">for</span>&nbsp;<span class="ident" id="5568141">x2</span>&nbsp;<span class="op" id="5568144">:=</span>&nbsp;<span class="num" id="5568147">0</span><span class="op" id="5568148">;</span>&nbsp;<span class="ident" id="5568150">x2</span>&nbsp;<span class="op" id="5568153">&lt;</span>&nbsp;<span class="num" id="5568155">8</span>&nbsp;<span class="op" id="5568157">&amp;&amp;</span>&nbsp;<span class="ident" id="5568160">x</span><span class="op" id="5568161">+</span><span class="ident" id="5568162">x2</span>&nbsp;<span class="op" id="5568165">&lt;</span>&nbsp;<span class="ident" id="5568167">width</span><span class="op" id="5568172">;</span>&nbsp;<span class="ident" id="5568174">x2</span><span class="op" id="5568176">++</span>&nbsp;<span class="op" id="5568179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5568186">gray</span><span class="op" id="5568190">.</span><span class="ident" id="5568191">SetGray</span><span class="op" id="5568198">(</span><span class="ident" id="5568199">x</span><span class="op" id="5568200">+</span><span class="ident" id="5568201">x2</span><span class="op" id="5568203">,</span>&nbsp;<span class="ident" id="5568205">y</span><span class="op" id="5568206">,</span>&nbsp;<span class="ident" id="5568208">color</span><span class="op" id="5568213">.</span><span class="ident" id="5568214">Gray</span><span class="op" id="5568218">{</span><span class="op" id="5568219">(</span><span class="ident" id="5568220">b</span>&nbsp;<span class="op" id="5568222">&gt;&gt;</span>&nbsp;<span class="num" id="5568225">7</span><span class="op" id="5568226">)</span>&nbsp;<span class="op" id="5568228">*</span>&nbsp;<span class="num" id="5568230">0xff</span><span class="op" id="5568234">}</span><span class="op" id="5568235">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5568242">b</span>&nbsp;<span class="op" id="5568244">&lt;&lt;=</span>&nbsp;<span class="num" id="5568248">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5568254">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5568259">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5568263">case</span>&nbsp;<span class="ident" id="5568268">cbG2</span><span class="op" id="5568272">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5568277">for</span>&nbsp;<span class="ident" id="5568281">x</span>&nbsp;<span class="op" id="5568283">:=</span>&nbsp;<span class="num" id="5568286">0</span><span class="op" id="5568287">;</span>&nbsp;<span class="ident" id="5568289">x</span>&nbsp;<span class="op" id="5568291">&lt;</span>&nbsp;<span class="ident" id="5568293">width</span><span class="op" id="5568298">;</span>&nbsp;<span class="ident" id="5568300">x</span>&nbsp;<span class="op" id="5568302">+=</span>&nbsp;<span class="num" id="5568305">4</span>&nbsp;<span class="op" id="5568307">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5568313">b</span>&nbsp;<span class="op" id="5568315">:=</span>&nbsp;<span class="ident" id="5568318">cdat</span><span class="op" id="5568322">[</span><span class="ident" id="5568323">x</span><span class="op" id="5568324">/</span><span class="num" id="5568325">4</span><span class="op" id="5568326">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5568332">for</span>&nbsp;<span class="ident" id="5568336">x2</span>&nbsp;<span class="op" id="5568339">:=</span>&nbsp;<span class="num" id="5568342">0</span><span class="op" id="5568343">;</span>&nbsp;<span class="ident" id="5568345">x2</span>&nbsp;<span class="op" id="5568348">&lt;</span>&nbsp;<span class="num" id="5568350">4</span>&nbsp;<span class="op" id="5568352">&amp;&amp;</span>&nbsp;<span class="ident" id="5568355">x</span><span class="op" id="5568356">+</span><span class="ident" id="5568357">x2</span>&nbsp;<span class="op" id="5568360">&lt;</span>&nbsp;<span class="ident" id="5568362">width</span><span class="op" id="5568367">;</span>&nbsp;<span class="ident" id="5568369">x2</span><span class="op" id="5568371">++</span>&nbsp;<span class="op" id="5568374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5568381">gray</span><span class="op" id="5568385">.</span><span class="ident" id="5568386">SetGray</span><span class="op" id="5568393">(</span><span class="ident" id="5568394">x</span><span class="op" id="5568395">+</span><span class="ident" id="5568396">x2</span><span class="op" id="5568398">,</span>&nbsp;<span class="ident" id="5568400">y</span><span class="op" id="5568401">,</span>&nbsp;<span class="ident" id="5568403">color</span><span class="op" id="5568408">.</span><span class="ident" id="5568409">Gray</span><span class="op" id="5568413">{</span><span class="op" id="5568414">(</span><span class="ident" id="5568415">b</span>&nbsp;<span class="op" id="5568417">&gt;&gt;</span>&nbsp;<span class="num" id="5568420">6</span><span class="op" id="5568421">)</span>&nbsp;<span class="op" id="5568423">*</span>&nbsp;<span class="num" id="5568425">0x55</span><span class="op" id="5568429">}</span><span class="op" id="5568430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5568437">b</span>&nbsp;<span class="op" id="5568439">&lt;&lt;=</span>&nbsp;<span class="num" id="5568443">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5568449">}</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5568454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5568458">case</span>&nbsp;<span class="ident" id="5568463">cbG4</span><span class="op" id="5568467">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5568472">for</span>&nbsp;<span class="ident" id="5568476">x</span>&nbsp;<span class="op" id="5568478">:=</span>&nbsp;<span class="num" id="5568481">0</span><span class="op" id="5568482">;</span>&nbsp;<span class="ident" id="5568484">x</span>&nbsp;<span class="op" id="5568486">&lt;</span>&nbsp;<span class="ident" id="5568488">width</span><span class="op" id="5568493">;</span>&nbsp;<span class="ident" id="5568495">x</span>&nbsp;<span class="op" id="5568497">+=</span>&nbsp;<span class="num" id="5568500">2</span>&nbsp;<span class="op" id="5568502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5568508">b</span>&nbsp;<span class="op" id="5568510">:=</span>&nbsp;<span class="ident" id="5568513">cdat</span><span class="op" id="5568517">[</span><span class="ident" id="5568518">x</span><span class="op" id="5568519">/</span><span class="num" id="5568520">2</span><span class="op" id="5568521">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5568527">for</span>&nbsp;<span class="ident" id="5568531">x2</span>&nbsp;<span class="op" id="5568534">:=</span>&nbsp;<span class="num" id="5568537">0</span><span class="op" id="5568538">;</span>&nbsp;<span class="ident" id="5568540">x2</span>&nbsp;<span class="op" id="5568543">&lt;</span>&nbsp;<span class="num" id="5568545">2</span>&nbsp;<span class="op" id="5568547">&amp;&amp;</span>&nbsp;<span class="ident" id="5568550">x</span><span class="op" id="5568551">+</span><span class="ident" id="5568552">x2</span>&nbsp;<span class="op" id="5568555">&lt;</span>&nbsp;<span class="ident" id="5568557">width</span><span class="op" id="5568562">;</span>&nbsp;<span class="ident" id="5568564">x2</span><span class="op" id="5568566">++</span>&nbsp;<span class="op" id="5568569">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5568576">gray</span><span class="op" id="5568580">.</span><span class="ident" id="5568581">SetGray</span><span class="op" id="5568588">(</span><span class="ident" id="5568589">x</span><span class="op" id="5568590">+</span><span class="ident" id="5568591">x2</span><span class="op" id="5568593">,</span>&nbsp;<span class="ident" id="5568595">y</span><span class="op" id="5568596">,</span>&nbsp;<span class="ident" id="5568598">color</span><span class="op" id="5568603">.</span><span class="ident" id="5568604">Gray</span><span class="op" id="5568608">{</span><span class="op" id="5568609">(</span><span class="ident" id="5568610">b</span>&nbsp;<span class="op" id="5568612">&gt;&gt;</span>&nbsp;<span class="num" id="5568615">4</span><span class="op" id="5568616">)</span>&nbsp;<span class="op" id="5568618">*</span>&nbsp;<span class="num" id="5568620">0x11</span><span class="op" id="5568624">}</span><span class="op" id="5568625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5568632">b</span>&nbsp;<span class="op" id="5568634">&lt;&lt;=</span>&nbsp;<span class="num" id="5568638">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5568644">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5568649">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5568653">case</span>&nbsp;<span class="ident" id="5568658">cbG8</span><span class="op" id="5568662">:</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5568667">copy</span><span class="op" id="5568671">(</span><span class="ident" id="5568672">gray</span><span class="op" id="5568676">.</span><span class="ident" id="5568677">Pix</span><span class="op" id="5568680">[</span><span class="ident" id="5568681">pixOffset</span><span class="op" id="5568690">:</span><span class="op" id="5568691">]</span><span class="op" id="5568692">,</span>&nbsp;<span class="ident" id="5568694">cdat</span><span class="op" id="5568698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5568703">pixOffset</span>&nbsp;<span class="op" id="5568713">+=</span>&nbsp;<span class="ident" id="5568716">gray</span><span class="op" id="5568720">.</span><span class="ident" id="5568721">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5568730">case</span>&nbsp;<span class="ident" id="5568735">cbGA8</span><span class="op" id="5568740">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5568745">for</span>&nbsp;<span class="ident" id="5568749">x</span>&nbsp;<span class="op" id="5568751">:=</span>&nbsp;<span class="num" id="5568754">0</span><span class="op" id="5568755">;</span>&nbsp;<span class="ident" id="5568757">x</span>&nbsp;<span class="op" id="5568759">&lt;</span>&nbsp;<span class="ident" id="5568761">width</span><span class="op" id="5568766">;</span>&nbsp;<span class="ident" id="5568768">x</span><span class="op" id="5568769">++</span>&nbsp;<span class="op" id="5568772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5568778">ycol</span>&nbsp;<span class="op" id="5568783">:=</span>&nbsp;<span class="ident" id="5568786">cdat</span><span class="op" id="5568790">[</span><span class="num" id="5568791">2</span><span class="op" id="5568792">*</span><span class="ident" id="5568793">x</span><span class="op" id="5568794">+</span><span class="num" id="5568795">0</span><span class="op" id="5568796">]</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5568802">nrgba</span><span class="op" id="5568807">.</span><span class="ident" id="5568808">SetNRGBA</span><span class="op" id="5568816">(</span><span class="ident" id="5568817">x</span><span class="op" id="5568818">,</span>&nbsp;<span class="ident" id="5568820">y</span><span class="op" id="5568821">,</span>&nbsp;<span class="ident" id="5568823">color</span><span class="op" id="5568828">.</span><span class="ident" id="5568829">NRGBA</span><span class="op" id="5568834">{</span><span class="ident" id="5568835">ycol</span><span class="op" id="5568839">,</span>&nbsp;<span class="ident" id="5568841">ycol</span><span class="op" id="5568845">,</span>&nbsp;<span class="ident" id="5568847">ycol</span><span class="op" id="5568851">,</span>&nbsp;<span class="ident" id="5568853">cdat</span><span class="op" id="5568857">[</span><span class="num" id="5568858">2</span><span class="op" id="5568859">*</span><span class="ident" id="5568860">x</span><span class="op" id="5568861">+</span><span class="num" id="5568862">1</span><span class="op" id="5568863">]</span><span class="op" id="5568864">}</span><span class="op" id="5568865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5568870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5568874">case</span>&nbsp;<span class="ident" id="5568879">cbTC8</span><span class="op" id="5568884">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5568889">pix</span><span class="op" id="5568892">,</span>&nbsp;<span class="ident" id="5568894">i</span><span class="op" id="5568895">,</span>&nbsp;<span class="ident" id="5568897">j</span>&nbsp;<span class="op" id="5568899">:=</span>&nbsp;<span class="ident" id="5568902">rgba</span><span class="op" id="5568906">.</span><span class="ident" id="5568907">Pix</span><span class="op" id="5568910">,</span>&nbsp;<span class="ident" id="5568912">pixOffset</span><span class="op" id="5568921">,</span>&nbsp;<span class="num" id="5568923">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5568928">for</span>&nbsp;<span class="ident" id="5568932">x</span>&nbsp;<span class="op" id="5568934">:=</span>&nbsp;<span class="num" id="5568937">0</span><span class="op" id="5568938">;</span>&nbsp;<span class="ident" id="5568940">x</span>&nbsp;<span class="op" id="5568942">&lt;</span>&nbsp;<span class="ident" id="5568944">width</span><span class="op" id="5568949">;</span>&nbsp;<span class="ident" id="5568951">x</span><span class="op" id="5568952">++</span>&nbsp;<span class="op" id="5568955">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5568961">pix</span><span class="op" id="5568964">[</span><span class="ident" id="5568965">i</span><span class="op" id="5568966">+</span><span class="num" id="5568967">0</span><span class="op" id="5568968">]</span>&nbsp;<span class="op" id="5568970">=</span>&nbsp;<span class="ident" id="5568972">cdat</span><span class="op" id="5568976">[</span><span class="ident" id="5568977">j</span><span class="op" id="5568978">+</span><span class="num" id="5568979">0</span><span class="op" id="5568980">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5568986">pix</span><span class="op" id="5568989">[</span><span class="ident" id="5568990">i</span><span class="op" id="5568991">+</span><span class="num" id="5568992">1</span><span class="op" id="5568993">]</span>&nbsp;<span class="op" id="5568995">=</span>&nbsp;<span class="ident" id="5568997">cdat</span><span class="op" id="5569001">[</span><span class="ident" id="5569002">j</span><span class="op" id="5569003">+</span><span class="num" id="5569004">1</span><span class="op" id="5569005">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5569011">pix</span><span class="op" id="5569014">[</span><span class="ident" id="5569015">i</span><span class="op" id="5569016">+</span><span class="num" id="5569017">2</span><span class="op" id="5569018">]</span>&nbsp;<span class="op" id="5569020">=</span>&nbsp;<span class="ident" id="5569022">cdat</span><span class="op" id="5569026">[</span><span class="ident" id="5569027">j</span><span class="op" id="5569028">+</span><span class="num" id="5569029">2</span><span class="op" id="5569030">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5569036">pix</span><span class="op" id="5569039">[</span><span class="ident" id="5569040">i</span><span class="op" id="5569041">+</span><span class="num" id="5569042">3</span><span class="op" id="5569043">]</span>&nbsp;<span class="op" id="5569045">=</span>&nbsp;<span class="num" id="5569047">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5569056">i</span>&nbsp;<span class="op" id="5569058">+=</span>&nbsp;<span class="num" id="5569061">4</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5569067">j</span>&nbsp;<span class="op" id="5569069">+=</span>&nbsp;<span class="num" id="5569072">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5569077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5569082">pixOffset</span>&nbsp;<span class="op" id="5569092">+=</span>&nbsp;<span class="ident" id="5569095">rgba</span><span class="op" id="5569099">.</span><span class="ident" id="5569100">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5569109">case</span>&nbsp;<span class="ident" id="5569114">cbP1</span><span class="op" id="5569118">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5569123">for</span>&nbsp;<span class="ident" id="5569127">x</span>&nbsp;<span class="op" id="5569129">:=</span>&nbsp;<span class="num" id="5569132">0</span><span class="op" id="5569133">;</span>&nbsp;<span class="ident" id="5569135">x</span>&nbsp;<span class="op" id="5569137">&lt;</span>&nbsp;<span class="ident" id="5569139">width</span><span class="op" id="5569144">;</span>&nbsp;<span class="ident" id="5569146">x</span>&nbsp;<span class="op" id="5569148">+=</span>&nbsp;<span class="num" id="5569151">8</span>&nbsp;<span class="op" id="5569153">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5569159">b</span>&nbsp;<span class="op" id="5569161">:=</span>&nbsp;<span class="ident" id="5569164">cdat</span><span class="op" id="5569168">[</span><span class="ident" id="5569169">x</span><span class="op" id="5569170">/</span><span class="num" id="5569171">8</span><span class="op" id="5569172">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5569178">for</span>&nbsp;<span class="ident" id="5569182">x2</span>&nbsp;<span class="op" id="5569185">:=</span>&nbsp;<span class="num" id="5569188">0</span><span class="op" id="5569189">;</span>&nbsp;<span class="ident" id="5569191">x2</span>&nbsp;<span class="op" id="5569194">&lt;</span>&nbsp;<span class="num" id="5569196">8</span>&nbsp;<span class="op" id="5569198">&amp;&amp;</span>&nbsp;<span class="ident" id="5569201">x</span><span class="op" id="5569202">+</span><span class="ident" id="5569203">x2</span>&nbsp;<span class="op" id="5569206">&lt;</span>&nbsp;<span class="ident" id="5569208">width</span><span class="op" id="5569213">;</span>&nbsp;<span class="ident" id="5569215">x2</span><span class="op" id="5569217">++</span>&nbsp;<span class="op" id="5569220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5569227">idx</span>&nbsp;<span class="op" id="5569231">:=</span>&nbsp;<span class="ident" id="5569234">b</span>&nbsp;<span class="op" id="5569236">&gt;&gt;</span>&nbsp;<span class="num" id="5569239">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5569246">if</span>&nbsp;<span class="builtinfunc" id="5569249">len</span><span class="op" id="5569252">(</span><span class="ident" id="5569253">paletted</span><span class="op" id="5569261">.</span><span class="ident" id="5569262">Palette</span><span class="op" id="5569269">)</span>&nbsp;<span class="op" id="5569271">&lt;=</span>&nbsp;<span class="builtintype" id="5569274">int</span><span class="op" id="5569277">(</span><span class="ident" id="5569278">idx</span><span class="op" id="5569281">)</span>&nbsp;<span class="op" id="5569283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5569291">paletted</span><span class="op" id="5569299">.</span><span class="ident" id="5569300">Palette</span>&nbsp;<span class="op" id="5569308">=</span>&nbsp;<span class="ident" id="5569310">paletted</span><span class="op" id="5569318">.</span><span class="ident" id="5569319">Palette</span><span class="op" id="5569326">[</span><span class="op" id="5569327">:</span><span class="builtintype" id="5569328">int</span><span class="op" id="5569331">(</span><span class="ident" id="5569332">idx</span><span class="op" id="5569335">)</span><span class="op" id="5569336">+</span><span class="num" id="5569337">1</span><span class="op" id="5569338">]</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5569345">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5569352">paletted</span><span class="op" id="5569360">.</span><span class="ident" id="5569361">SetColorIndex</span><span class="op" id="5569374">(</span><span class="ident" id="5569375">x</span><span class="op" id="5569376">+</span><span class="ident" id="5569377">x2</span><span class="op" id="5569379">,</span>&nbsp;<span class="ident" id="5569381">y</span><span class="op" id="5569382">,</span>&nbsp;<span class="ident" id="5569384">idx</span><span class="op" id="5569387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5569394">b</span>&nbsp;<span class="op" id="5569396">&lt;&lt;=</span>&nbsp;<span class="num" id="5569400">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5569406">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5569411">}</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5569415">case</span>&nbsp;<span class="ident" id="5569420">cbP2</span><span class="op" id="5569424">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5569429">for</span>&nbsp;<span class="ident" id="5569433">x</span>&nbsp;<span class="op" id="5569435">:=</span>&nbsp;<span class="num" id="5569438">0</span><span class="op" id="5569439">;</span>&nbsp;<span class="ident" id="5569441">x</span>&nbsp;<span class="op" id="5569443">&lt;</span>&nbsp;<span class="ident" id="5569445">width</span><span class="op" id="5569450">;</span>&nbsp;<span class="ident" id="5569452">x</span>&nbsp;<span class="op" id="5569454">+=</span>&nbsp;<span class="num" id="5569457">4</span>&nbsp;<span class="op" id="5569459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5569465">b</span>&nbsp;<span class="op" id="5569467">:=</span>&nbsp;<span class="ident" id="5569470">cdat</span><span class="op" id="5569474">[</span><span class="ident" id="5569475">x</span><span class="op" id="5569476">/</span><span class="num" id="5569477">4</span><span class="op" id="5569478">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5569484">for</span>&nbsp;<span class="ident" id="5569488">x2</span>&nbsp;<span class="op" id="5569491">:=</span>&nbsp;<span class="num" id="5569494">0</span><span class="op" id="5569495">;</span>&nbsp;<span class="ident" id="5569497">x2</span>&nbsp;<span class="op" id="5569500">&lt;</span>&nbsp;<span class="num" id="5569502">4</span>&nbsp;<span class="op" id="5569504">&amp;&amp;</span>&nbsp;<span class="ident" id="5569507">x</span><span class="op" id="5569508">+</span><span class="ident" id="5569509">x2</span>&nbsp;<span class="op" id="5569512">&lt;</span>&nbsp;<span class="ident" id="5569514">width</span><span class="op" id="5569519">;</span>&nbsp;<span class="ident" id="5569521">x2</span><span class="op" id="5569523">++</span>&nbsp;<span class="op" id="5569526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5569533">idx</span>&nbsp;<span class="op" id="5569537">:=</span>&nbsp;<span class="ident" id="5569540">b</span>&nbsp;<span class="op" id="5569542">&gt;&gt;</span>&nbsp;<span class="num" id="5569545">6</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5569552">if</span>&nbsp;<span class="builtinfunc" id="5569555">len</span><span class="op" id="5569558">(</span><span class="ident" id="5569559">paletted</span><span class="op" id="5569567">.</span><span class="ident" id="5569568">Palette</span><span class="op" id="5569575">)</span>&nbsp;<span class="op" id="5569577">&lt;=</span>&nbsp;<span class="builtintype" id="5569580">int</span><span class="op" id="5569583">(</span><span class="ident" id="5569584">idx</span><span class="op" id="5569587">)</span>&nbsp;<span class="op" id="5569589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5569597">paletted</span><span class="op" id="5569605">.</span><span class="ident" id="5569606">Palette</span>&nbsp;<span class="op" id="5569614">=</span>&nbsp;<span class="ident" id="5569616">paletted</span><span class="op" id="5569624">.</span><span class="ident" id="5569625">Palette</span><span class="op" id="5569632">[</span><span class="op" id="5569633">:</span><span class="builtintype" id="5569634">int</span><span class="op" id="5569637">(</span><span class="ident" id="5569638">idx</span><span class="op" id="5569641">)</span><span class="op" id="5569642">+</span><span class="num" id="5569643">1</span><span class="op" id="5569644">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5569651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5569658">paletted</span><span class="op" id="5569666">.</span><span class="ident" id="5569667">SetColorIndex</span><span class="op" id="5569680">(</span><span class="ident" id="5569681">x</span><span class="op" id="5569682">+</span><span class="ident" id="5569683">x2</span><span class="op" id="5569685">,</span>&nbsp;<span class="ident" id="5569687">y</span><span class="op" id="5569688">,</span>&nbsp;<span class="ident" id="5569690">idx</span><span class="op" id="5569693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5569700">b</span>&nbsp;<span class="op" id="5569702">&lt;&lt;=</span>&nbsp;<span class="num" id="5569706">2</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5569712">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5569717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5569721">case</span>&nbsp;<span class="ident" id="5569726">cbP4</span><span class="op" id="5569730">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5569735">for</span>&nbsp;<span class="ident" id="5569739">x</span>&nbsp;<span class="op" id="5569741">:=</span>&nbsp;<span class="num" id="5569744">0</span><span class="op" id="5569745">;</span>&nbsp;<span class="ident" id="5569747">x</span>&nbsp;<span class="op" id="5569749">&lt;</span>&nbsp;<span class="ident" id="5569751">width</span><span class="op" id="5569756">;</span>&nbsp;<span class="ident" id="5569758">x</span>&nbsp;<span class="op" id="5569760">+=</span>&nbsp;<span class="num" id="5569763">2</span>&nbsp;<span class="op" id="5569765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5569771">b</span>&nbsp;<span class="op" id="5569773">:=</span>&nbsp;<span class="ident" id="5569776">cdat</span><span class="op" id="5569780">[</span><span class="ident" id="5569781">x</span><span class="op" id="5569782">/</span><span class="num" id="5569783">2</span><span class="op" id="5569784">]</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5569790">for</span>&nbsp;<span class="ident" id="5569794">x2</span>&nbsp;<span class="op" id="5569797">:=</span>&nbsp;<span class="num" id="5569800">0</span><span class="op" id="5569801">;</span>&nbsp;<span class="ident" id="5569803">x2</span>&nbsp;<span class="op" id="5569806">&lt;</span>&nbsp;<span class="num" id="5569808">2</span>&nbsp;<span class="op" id="5569810">&amp;&amp;</span>&nbsp;<span class="ident" id="5569813">x</span><span class="op" id="5569814">+</span><span class="ident" id="5569815">x2</span>&nbsp;<span class="op" id="5569818">&lt;</span>&nbsp;<span class="ident" id="5569820">width</span><span class="op" id="5569825">;</span>&nbsp;<span class="ident" id="5569827">x2</span><span class="op" id="5569829">++</span>&nbsp;<span class="op" id="5569832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5569839">idx</span>&nbsp;<span class="op" id="5569843">:=</span>&nbsp;<span class="ident" id="5569846">b</span>&nbsp;<span class="op" id="5569848">&gt;&gt;</span>&nbsp;<span class="num" id="5569851">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5569858">if</span>&nbsp;<span class="builtinfunc" id="5569861">len</span><span class="op" id="5569864">(</span><span class="ident" id="5569865">paletted</span><span class="op" id="5569873">.</span><span class="ident" id="5569874">Palette</span><span class="op" id="5569881">)</span>&nbsp;<span class="op" id="5569883">&lt;=</span>&nbsp;<span class="builtintype" id="5569886">int</span><span class="op" id="5569889">(</span><span class="ident" id="5569890">idx</span><span class="op" id="5569893">)</span>&nbsp;<span class="op" id="5569895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5569903">paletted</span><span class="op" id="5569911">.</span><span class="ident" id="5569912">Palette</span>&nbsp;<span class="op" id="5569920">=</span>&nbsp;<span class="ident" id="5569922">paletted</span><span class="op" id="5569930">.</span><span class="ident" id="5569931">Palette</span><span class="op" id="5569938">[</span><span class="op" id="5569939">:</span><span class="builtintype" id="5569940">int</span><span class="op" id="5569943">(</span><span class="ident" id="5569944">idx</span><span class="op" id="5569947">)</span><span class="op" id="5569948">+</span><span class="num" id="5569949">1</span><span class="op" id="5569950">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5569957">}</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5569964">paletted</span><span class="op" id="5569972">.</span><span class="ident" id="5569973">SetColorIndex</span><span class="op" id="5569986">(</span><span class="ident" id="5569987">x</span><span class="op" id="5569988">+</span><span class="ident" id="5569989">x2</span><span class="op" id="5569991">,</span>&nbsp;<span class="ident" id="5569993">y</span><span class="op" id="5569994">,</span>&nbsp;<span class="ident" id="5569996">idx</span><span class="op" id="5569999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5570006">b</span>&nbsp;<span class="op" id="5570008">&lt;&lt;=</span>&nbsp;<span class="num" id="5570012">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5570018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5570023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5570027">case</span>&nbsp;<span class="ident" id="5570032">cbP8</span><span class="op" id="5570036">:</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5570041">if</span>&nbsp;<span class="builtinfunc" id="5570044">len</span><span class="op" id="5570047">(</span><span class="ident" id="5570048">paletted</span><span class="op" id="5570056">.</span><span class="ident" id="5570057">Palette</span><span class="op" id="5570064">)</span>&nbsp;<span class="op" id="5570066">!=</span>&nbsp;<span class="num" id="5570069">255</span>&nbsp;<span class="op" id="5570073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5570079">for</span>&nbsp;<span class="ident" id="5570083">x</span>&nbsp;<span class="op" id="5570085">:=</span>&nbsp;<span class="num" id="5570088">0</span><span class="op" id="5570089">;</span>&nbsp;<span class="ident" id="5570091">x</span>&nbsp;<span class="op" id="5570093">&lt;</span>&nbsp;<span class="ident" id="5570095">width</span><span class="op" id="5570100">;</span>&nbsp;<span class="ident" id="5570102">x</span><span class="op" id="5570103">++</span>&nbsp;<span class="op" id="5570106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5570113">if</span>&nbsp;<span class="builtinfunc" id="5570116">len</span><span class="op" id="5570119">(</span><span class="ident" id="5570120">paletted</span><span class="op" id="5570128">.</span><span class="ident" id="5570129">Palette</span><span class="op" id="5570136">)</span>&nbsp;<span class="op" id="5570138">&lt;=</span>&nbsp;<span class="builtintype" id="5570141">int</span><span class="op" id="5570144">(</span><span class="ident" id="5570145">cdat</span><span class="op" id="5570149">[</span><span class="ident" id="5570150">x</span><span class="op" id="5570151">]</span><span class="op" id="5570152">)</span>&nbsp;<span class="op" id="5570154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5570162">paletted</span><span class="op" id="5570170">.</span><span class="ident" id="5570171">Palette</span>&nbsp;<span class="op" id="5570179">=</span>&nbsp;<span class="ident" id="5570181">paletted</span><span class="op" id="5570189">.</span><span class="ident" id="5570190">Palette</span><span class="op" id="5570197">[</span><span class="op" id="5570198">:</span><span class="builtintype" id="5570199">int</span><span class="op" id="5570202">(</span><span class="ident" id="5570203">cdat</span><span class="op" id="5570207">[</span><span class="ident" id="5570208">x</span><span class="op" id="5570209">]</span><span class="op" id="5570210">)</span><span class="op" id="5570211">+</span><span class="num" id="5570212">1</span><span class="op" id="5570213">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5570220">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5570226">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5570231">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5570236">copy</span><span class="op" id="5570240">(</span><span class="ident" id="5570241">paletted</span><span class="op" id="5570249">.</span><span class="ident" id="5570250">Pix</span><span class="op" id="5570253">[</span><span class="ident" id="5570254">pixOffset</span><span class="op" id="5570263">:</span><span class="op" id="5570264">]</span><span class="op" id="5570265">,</span>&nbsp;<span class="ident" id="5570267">cdat</span><span class="op" id="5570271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5570276">pixOffset</span>&nbsp;<span class="op" id="5570286">+=</span>&nbsp;<span class="ident" id="5570289">paletted</span><span class="op" id="5570297">.</span><span class="ident" id="5570298">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5570307">case</span>&nbsp;<span class="ident" id="5570312">cbTCA8</span><span class="op" id="5570318">:</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5570323">copy</span><span class="op" id="5570327">(</span><span class="ident" id="5570328">nrgba</span><span class="op" id="5570333">.</span><span class="ident" id="5570334">Pix</span><span class="op" id="5570337">[</span><span class="ident" id="5570338">pixOffset</span><span class="op" id="5570347">:</span><span class="op" id="5570348">]</span><span class="op" id="5570349">,</span>&nbsp;<span class="ident" id="5570351">cdat</span><span class="op" id="5570355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5570360">pixOffset</span>&nbsp;<span class="op" id="5570370">+=</span>&nbsp;<span class="ident" id="5570373">nrgba</span><span class="op" id="5570378">.</span><span class="ident" id="5570379">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5570388">case</span>&nbsp;<span class="ident" id="5570393">cbG16</span><span class="op" id="5570398">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5570403">for</span>&nbsp;<span class="ident" id="5570407">x</span>&nbsp;<span class="op" id="5570409">:=</span>&nbsp;<span class="num" id="5570412">0</span><span class="op" id="5570413">;</span>&nbsp;<span class="ident" id="5570415">x</span>&nbsp;<span class="op" id="5570417">&lt;</span>&nbsp;<span class="ident" id="5570419">width</span><span class="op" id="5570424">;</span>&nbsp;<span class="ident" id="5570426">x</span><span class="op" id="5570427">++</span>&nbsp;<span class="op" id="5570430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5570436">ycol</span>&nbsp;<span class="op" id="5570441">:=</span>&nbsp;<span class="builtintype" id="5570444">uint16</span><span class="op" id="5570450">(</span><span class="ident" id="5570451">cdat</span><span class="op" id="5570455">[</span><span class="num" id="5570456">2</span><span class="op" id="5570457">*</span><span class="ident" id="5570458">x</span><span class="op" id="5570459">+</span><span class="num" id="5570460">0</span><span class="op" id="5570461">]</span><span class="op" id="5570462">)</span><span class="op" id="5570463">&lt;&lt;</span><span class="num" id="5570465">8</span>&nbsp;<span class="op" id="5570467">|</span>&nbsp;<span class="builtintype" id="5570469">uint16</span><span class="op" id="5570475">(</span><span class="ident" id="5570476">cdat</span><span class="op" id="5570480">[</span><span class="num" id="5570481">2</span><span class="op" id="5570482">*</span><span class="ident" id="5570483">x</span><span class="op" id="5570484">+</span><span class="num" id="5570485">1</span><span class="op" id="5570486">]</span><span class="op" id="5570487">)</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5570493">gray16</span><span class="op" id="5570499">.</span><span class="ident" id="5570500">SetGray16</span><span class="op" id="5570509">(</span><span class="ident" id="5570510">x</span><span class="op" id="5570511">,</span>&nbsp;<span class="ident" id="5570513">y</span><span class="op" id="5570514">,</span>&nbsp;<span class="ident" id="5570516">color</span><span class="op" id="5570521">.</span><span class="ident" id="5570522">Gray16</span><span class="op" id="5570528">{</span><span class="ident" id="5570529">ycol</span><span class="op" id="5570533">}</span><span class="op" id="5570534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5570539">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5570543">case</span>&nbsp;<span class="ident" id="5570548">cbGA16</span><span class="op" id="5570554">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5570559">for</span>&nbsp;<span class="ident" id="5570563">x</span>&nbsp;<span class="op" id="5570565">:=</span>&nbsp;<span class="num" id="5570568">0</span><span class="op" id="5570569">;</span>&nbsp;<span class="ident" id="5570571">x</span>&nbsp;<span class="op" id="5570573">&lt;</span>&nbsp;<span class="ident" id="5570575">width</span><span class="op" id="5570580">;</span>&nbsp;<span class="ident" id="5570582">x</span><span class="op" id="5570583">++</span>&nbsp;<span class="op" id="5570586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5570592">ycol</span>&nbsp;<span class="op" id="5570597">:=</span>&nbsp;<span class="builtintype" id="5570600">uint16</span><span class="op" id="5570606">(</span><span class="ident" id="5570607">cdat</span><span class="op" id="5570611">[</span><span class="num" id="5570612">4</span><span class="op" id="5570613">*</span><span class="ident" id="5570614">x</span><span class="op" id="5570615">+</span><span class="num" id="5570616">0</span><span class="op" id="5570617">]</span><span class="op" id="5570618">)</span><span class="op" id="5570619">&lt;&lt;</span><span class="num" id="5570621">8</span>&nbsp;<span class="op" id="5570623">|</span>&nbsp;<span class="builtintype" id="5570625">uint16</span><span class="op" id="5570631">(</span><span class="ident" id="5570632">cdat</span><span class="op" id="5570636">[</span><span class="num" id="5570637">4</span><span class="op" id="5570638">*</span><span class="ident" id="5570639">x</span><span class="op" id="5570640">+</span><span class="num" id="5570641">1</span><span class="op" id="5570642">]</span><span class="op" id="5570643">)</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5570649">acol</span>&nbsp;<span class="op" id="5570654">:=</span>&nbsp;<span class="builtintype" id="5570657">uint16</span><span class="op" id="5570663">(</span><span class="ident" id="5570664">cdat</span><span class="op" id="5570668">[</span><span class="num" id="5570669">4</span><span class="op" id="5570670">*</span><span class="ident" id="5570671">x</span><span class="op" id="5570672">+</span><span class="num" id="5570673">2</span><span class="op" id="5570674">]</span><span class="op" id="5570675">)</span><span class="op" id="5570676">&lt;&lt;</span><span class="num" id="5570678">8</span>&nbsp;<span class="op" id="5570680">|</span>&nbsp;<span class="builtintype" id="5570682">uint16</span><span class="op" id="5570688">(</span><span class="ident" id="5570689">cdat</span><span class="op" id="5570693">[</span><span class="num" id="5570694">4</span><span class="op" id="5570695">*</span><span class="ident" id="5570696">x</span><span class="op" id="5570697">+</span><span class="num" id="5570698">3</span><span class="op" id="5570699">]</span><span class="op" id="5570700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5570706">nrgba64</span><span class="op" id="5570713">.</span><span class="ident" id="5570714">SetNRGBA64</span><span class="op" id="5570724">(</span><span class="ident" id="5570725">x</span><span class="op" id="5570726">,</span>&nbsp;<span class="ident" id="5570728">y</span><span class="op" id="5570729">,</span>&nbsp;<span class="ident" id="5570731">color</span><span class="op" id="5570736">.</span><span class="ident" id="5570737">NRGBA64</span><span class="op" id="5570744">{</span><span class="ident" id="5570745">ycol</span><span class="op" id="5570749">,</span>&nbsp;<span class="ident" id="5570751">ycol</span><span class="op" id="5570755">,</span>&nbsp;<span class="ident" id="5570757">ycol</span><span class="op" id="5570761">,</span>&nbsp;<span class="ident" id="5570763">acol</span><span class="op" id="5570767">}</span><span class="op" id="5570768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5570773">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5570777">case</span>&nbsp;<span class="ident" id="5570782">cbTC16</span><span class="op" id="5570788">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5570793">for</span>&nbsp;<span class="ident" id="5570797">x</span>&nbsp;<span class="op" id="5570799">:=</span>&nbsp;<span class="num" id="5570802">0</span><span class="op" id="5570803">;</span>&nbsp;<span class="ident" id="5570805">x</span>&nbsp;<span class="op" id="5570807">&lt;</span>&nbsp;<span class="ident" id="5570809">width</span><span class="op" id="5570814">;</span>&nbsp;<span class="ident" id="5570816">x</span><span class="op" id="5570817">++</span>&nbsp;<span class="op" id="5570820">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5570826">rcol</span>&nbsp;<span class="op" id="5570831">:=</span>&nbsp;<span class="builtintype" id="5570834">uint16</span><span class="op" id="5570840">(</span><span class="ident" id="5570841">cdat</span><span class="op" id="5570845">[</span><span class="num" id="5570846">6</span><span class="op" id="5570847">*</span><span class="ident" id="5570848">x</span><span class="op" id="5570849">+</span><span class="num" id="5570850">0</span><span class="op" id="5570851">]</span><span class="op" id="5570852">)</span><span class="op" id="5570853">&lt;&lt;</span><span class="num" id="5570855">8</span>&nbsp;<span class="op" id="5570857">|</span>&nbsp;<span class="builtintype" id="5570859">uint16</span><span class="op" id="5570865">(</span><span class="ident" id="5570866">cdat</span><span class="op" id="5570870">[</span><span class="num" id="5570871">6</span><span class="op" id="5570872">*</span><span class="ident" id="5570873">x</span><span class="op" id="5570874">+</span><span class="num" id="5570875">1</span><span class="op" id="5570876">]</span><span class="op" id="5570877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5570883">gcol</span>&nbsp;<span class="op" id="5570888">:=</span>&nbsp;<span class="builtintype" id="5570891">uint16</span><span class="op" id="5570897">(</span><span class="ident" id="5570898">cdat</span><span class="op" id="5570902">[</span><span class="num" id="5570903">6</span><span class="op" id="5570904">*</span><span class="ident" id="5570905">x</span><span class="op" id="5570906">+</span><span class="num" id="5570907">2</span><span class="op" id="5570908">]</span><span class="op" id="5570909">)</span><span class="op" id="5570910">&lt;&lt;</span><span class="num" id="5570912">8</span>&nbsp;<span class="op" id="5570914">|</span>&nbsp;<span class="builtintype" id="5570916">uint16</span><span class="op" id="5570922">(</span><span class="ident" id="5570923">cdat</span><span class="op" id="5570927">[</span><span class="num" id="5570928">6</span><span class="op" id="5570929">*</span><span class="ident" id="5570930">x</span><span class="op" id="5570931">+</span><span class="num" id="5570932">3</span><span class="op" id="5570933">]</span><span class="op" id="5570934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5570940">bcol</span>&nbsp;<span class="op" id="5570945">:=</span>&nbsp;<span class="builtintype" id="5570948">uint16</span><span class="op" id="5570954">(</span><span class="ident" id="5570955">cdat</span><span class="op" id="5570959">[</span><span class="num" id="5570960">6</span><span class="op" id="5570961">*</span><span class="ident" id="5570962">x</span><span class="op" id="5570963">+</span><span class="num" id="5570964">4</span><span class="op" id="5570965">]</span><span class="op" id="5570966">)</span><span class="op" id="5570967">&lt;&lt;</span><span class="num" id="5570969">8</span>&nbsp;<span class="op" id="5570971">|</span>&nbsp;<span class="builtintype" id="5570973">uint16</span><span class="op" id="5570979">(</span><span class="ident" id="5570980">cdat</span><span class="op" id="5570984">[</span><span class="num" id="5570985">6</span><span class="op" id="5570986">*</span><span class="ident" id="5570987">x</span><span class="op" id="5570988">+</span><span class="num" id="5570989">5</span><span class="op" id="5570990">]</span><span class="op" id="5570991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5570997">rgba64</span><span class="op" id="5571003">.</span><span class="ident" id="5571004">SetRGBA64</span><span class="op" id="5571013">(</span><span class="ident" id="5571014">x</span><span class="op" id="5571015">,</span>&nbsp;<span class="ident" id="5571017">y</span><span class="op" id="5571018">,</span>&nbsp;<span class="ident" id="5571020">color</span><span class="op" id="5571025">.</span><span class="ident" id="5571026">RGBA64</span><span class="op" id="5571032">{</span><span class="ident" id="5571033">rcol</span><span class="op" id="5571037">,</span>&nbsp;<span class="ident" id="5571039">gcol</span><span class="op" id="5571043">,</span>&nbsp;<span class="ident" id="5571045">bcol</span><span class="op" id="5571049">,</span>&nbsp;<span class="num" id="5571051">0xffff</span><span class="op" id="5571057">}</span><span class="op" id="5571058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5571063">}</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5571067">case</span>&nbsp;<span class="ident" id="5571072">cbTCA16</span><span class="op" id="5571079">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5571084">for</span>&nbsp;<span class="ident" id="5571088">x</span>&nbsp;<span class="op" id="5571090">:=</span>&nbsp;<span class="num" id="5571093">0</span><span class="op" id="5571094">;</span>&nbsp;<span class="ident" id="5571096">x</span>&nbsp;<span class="op" id="5571098">&lt;</span>&nbsp;<span class="ident" id="5571100">width</span><span class="op" id="5571105">;</span>&nbsp;<span class="ident" id="5571107">x</span><span class="op" id="5571108">++</span>&nbsp;<span class="op" id="5571111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5571117">rcol</span>&nbsp;<span class="op" id="5571122">:=</span>&nbsp;<span class="builtintype" id="5571125">uint16</span><span class="op" id="5571131">(</span><span class="ident" id="5571132">cdat</span><span class="op" id="5571136">[</span><span class="num" id="5571137">8</span><span class="op" id="5571138">*</span><span class="ident" id="5571139">x</span><span class="op" id="5571140">+</span><span class="num" id="5571141">0</span><span class="op" id="5571142">]</span><span class="op" id="5571143">)</span><span class="op" id="5571144">&lt;&lt;</span><span class="num" id="5571146">8</span>&nbsp;<span class="op" id="5571148">|</span>&nbsp;<span class="builtintype" id="5571150">uint16</span><span class="op" id="5571156">(</span><span class="ident" id="5571157">cdat</span><span class="op" id="5571161">[</span><span class="num" id="5571162">8</span><span class="op" id="5571163">*</span><span class="ident" id="5571164">x</span><span class="op" id="5571165">+</span><span class="num" id="5571166">1</span><span class="op" id="5571167">]</span><span class="op" id="5571168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5571174">gcol</span>&nbsp;<span class="op" id="5571179">:=</span>&nbsp;<span class="builtintype" id="5571182">uint16</span><span class="op" id="5571188">(</span><span class="ident" id="5571189">cdat</span><span class="op" id="5571193">[</span><span class="num" id="5571194">8</span><span class="op" id="5571195">*</span><span class="ident" id="5571196">x</span><span class="op" id="5571197">+</span><span class="num" id="5571198">2</span><span class="op" id="5571199">]</span><span class="op" id="5571200">)</span><span class="op" id="5571201">&lt;&lt;</span><span class="num" id="5571203">8</span>&nbsp;<span class="op" id="5571205">|</span>&nbsp;<span class="builtintype" id="5571207">uint16</span><span class="op" id="5571213">(</span><span class="ident" id="5571214">cdat</span><span class="op" id="5571218">[</span><span class="num" id="5571219">8</span><span class="op" id="5571220">*</span><span class="ident" id="5571221">x</span><span class="op" id="5571222">+</span><span class="num" id="5571223">3</span><span class="op" id="5571224">]</span><span class="op" id="5571225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5571231">bcol</span>&nbsp;<span class="op" id="5571236">:=</span>&nbsp;<span class="builtintype" id="5571239">uint16</span><span class="op" id="5571245">(</span><span class="ident" id="5571246">cdat</span><span class="op" id="5571250">[</span><span class="num" id="5571251">8</span><span class="op" id="5571252">*</span><span class="ident" id="5571253">x</span><span class="op" id="5571254">+</span><span class="num" id="5571255">4</span><span class="op" id="5571256">]</span><span class="op" id="5571257">)</span><span class="op" id="5571258">&lt;&lt;</span><span class="num" id="5571260">8</span>&nbsp;<span class="op" id="5571262">|</span>&nbsp;<span class="builtintype" id="5571264">uint16</span><span class="op" id="5571270">(</span><span class="ident" id="5571271">cdat</span><span class="op" id="5571275">[</span><span class="num" id="5571276">8</span><span class="op" id="5571277">*</span><span class="ident" id="5571278">x</span><span class="op" id="5571279">+</span><span class="num" id="5571280">5</span><span class="op" id="5571281">]</span><span class="op" id="5571282">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5571288">acol</span>&nbsp;<span class="op" id="5571293">:=</span>&nbsp;<span class="builtintype" id="5571296">uint16</span><span class="op" id="5571302">(</span><span class="ident" id="5571303">cdat</span><span class="op" id="5571307">[</span><span class="num" id="5571308">8</span><span class="op" id="5571309">*</span><span class="ident" id="5571310">x</span><span class="op" id="5571311">+</span><span class="num" id="5571312">6</span><span class="op" id="5571313">]</span><span class="op" id="5571314">)</span><span class="op" id="5571315">&lt;&lt;</span><span class="num" id="5571317">8</span>&nbsp;<span class="op" id="5571319">|</span>&nbsp;<span class="builtintype" id="5571321">uint16</span><span class="op" id="5571327">(</span><span class="ident" id="5571328">cdat</span><span class="op" id="5571332">[</span><span class="num" id="5571333">8</span><span class="op" id="5571334">*</span><span class="ident" id="5571335">x</span><span class="op" id="5571336">+</span><span class="num" id="5571337">7</span><span class="op" id="5571338">]</span><span class="op" id="5571339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5571345">nrgba64</span><span class="op" id="5571352">.</span><span class="ident" id="5571353">SetNRGBA64</span><span class="op" id="5571363">(</span><span class="ident" id="5571364">x</span><span class="op" id="5571365">,</span>&nbsp;<span class="ident" id="5571367">y</span><span class="op" id="5571368">,</span>&nbsp;<span class="ident" id="5571370">color</span><span class="op" id="5571375">.</span><span class="ident" id="5571376">NRGBA64</span><span class="op" id="5571383">{</span><span class="ident" id="5571384">rcol</span><span class="op" id="5571388">,</span>&nbsp;<span class="ident" id="5571390">gcol</span><span class="op" id="5571394">,</span>&nbsp;<span class="ident" id="5571396">bcol</span><span class="op" id="5571400">,</span>&nbsp;<span class="ident" id="5571402">acol</span><span class="op" id="5571406">}</span><span class="op" id="5571407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5571412">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5571416">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5571421">//&nbsp;The&nbsp;current&nbsp;row&nbsp;for&nbsp;y&nbsp;is&nbsp;the&nbsp;previous&nbsp;row&nbsp;for&nbsp;y+1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5571477">pr</span><span class="op" id="5571479">,</span>&nbsp;<span class="ident" id="5571481">cr</span>&nbsp;<span class="op" id="5571484">=</span>&nbsp;<span class="ident" id="5571486">cr</span><span class="op" id="5571488">,</span>&nbsp;<span class="ident" id="5571490">pr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5571494">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5571498">return</span>&nbsp;<span class="ident" id="5571505">img</span><span class="op" id="5571508">,</span>&nbsp;<span class="ident" id="5571510">nil</span><br>
<span class="lineno">585</span><span class="op" id="5571514">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5571517">//&nbsp;mergePassInto&nbsp;merges&nbsp;a&nbsp;single&nbsp;pass&nbsp;into&nbsp;a&nbsp;full&nbsp;sized&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5571580">func</span>&nbsp;<span class="op" id="5571585">(</span><span class="ident" id="5571586">d</span>&nbsp;<span class="op" id="5571588">*</span><span class="ident" id="5571589">decoder</span><span class="op" id="5571596">)</span>&nbsp;<span class="ident" id="5571598">mergePassInto</span><span class="op" id="5571611">(</span><span class="ident" id="5571612">dst</span>&nbsp;<span class="ident" id="5571616">image</span><span class="op" id="5571621">.</span><span class="ident" id="5571622">Image</span><span class="op" id="5571627">,</span>&nbsp;<span class="ident" id="5571629">src</span>&nbsp;<span class="ident" id="5571633">image</span><span class="op" id="5571638">.</span><span class="ident" id="5571639">Image</span><span class="op" id="5571644">,</span>&nbsp;<span class="ident" id="5571646">pass</span>&nbsp;<span class="builtintype" id="5571651">int</span><span class="op" id="5571654">)</span>&nbsp;<span class="op" id="5571656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5571659">p</span>&nbsp;<span class="op" id="5571661">:=</span>&nbsp;<span class="ident" id="5571664">interlacing</span><span class="op" id="5571675">[</span><span class="ident" id="5571676">pass</span><span class="op" id="5571680">]</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5571683">var</span>&nbsp;<span class="op" id="5571687">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5571691">srcPix</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5571705">[</span><span class="op" id="5571706">]</span><span class="builtintype" id="5571707">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5571715">dstPix</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5571729">[</span><span class="op" id="5571730">]</span><span class="builtintype" id="5571731">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5571739">stride</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5571753">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5571759">rect</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5571773">image</span><span class="op" id="5571778">.</span><span class="ident" id="5571779">Rectangle</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5571791">bytesPerPixel</span>&nbsp;<span class="builtintype" id="5571805">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5571810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5571813">switch</span>&nbsp;<span class="ident" id="5571820">target</span>&nbsp;<span class="op" id="5571827">:=</span>&nbsp;<span class="ident" id="5571830">dst</span><span class="op" id="5571833">.</span><span class="op" id="5571834">(</span><span class="keyword" id="5571835">type</span><span class="op" id="5571839">)</span>&nbsp;<span class="op" id="5571841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5571844">case</span>&nbsp;<span class="op" id="5571849">*</span><span class="ident" id="5571850">image</span><span class="op" id="5571855">.</span><span class="ident" id="5571856">Alpha</span><span class="op" id="5571861">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5571865">srcPix</span>&nbsp;<span class="op" id="5571872">=</span>&nbsp;<span class="ident" id="5571874">src</span><span class="op" id="5571877">.</span><span class="op" id="5571878">(</span><span class="op" id="5571879">*</span><span class="ident" id="5571880">image</span><span class="op" id="5571885">.</span><span class="ident" id="5571886">Alpha</span><span class="op" id="5571891">)</span><span class="op" id="5571892">.</span><span class="ident" id="5571893">Pix</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5571899">dstPix</span><span class="op" id="5571905">,</span>&nbsp;<span class="ident" id="5571907">stride</span><span class="op" id="5571913">,</span>&nbsp;<span class="ident" id="5571915">rect</span>&nbsp;<span class="op" id="5571920">=</span>&nbsp;<span class="ident" id="5571922">target</span><span class="op" id="5571928">.</span><span class="ident" id="5571929">Pix</span><span class="op" id="5571932">,</span>&nbsp;<span class="ident" id="5571934">target</span><span class="op" id="5571940">.</span><span class="ident" id="5571941">Stride</span><span class="op" id="5571947">,</span>&nbsp;<span class="ident" id="5571949">target</span><span class="op" id="5571955">.</span><span class="ident" id="5571956">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5571963">bytesPerPixel</span>&nbsp;<span class="op" id="5571977">=</span>&nbsp;<span class="num" id="5571979">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5571982">case</span>&nbsp;<span class="op" id="5571987">*</span><span class="ident" id="5571988">image</span><span class="op" id="5571993">.</span><span class="ident" id="5571994">Alpha16</span><span class="op" id="5572001">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5572005">srcPix</span>&nbsp;<span class="op" id="5572012">=</span>&nbsp;<span class="ident" id="5572014">src</span><span class="op" id="5572017">.</span><span class="op" id="5572018">(</span><span class="op" id="5572019">*</span><span class="ident" id="5572020">image</span><span class="op" id="5572025">.</span><span class="ident" id="5572026">Alpha16</span><span class="op" id="5572033">)</span><span class="op" id="5572034">.</span><span class="ident" id="5572035">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5572041">dstPix</span><span class="op" id="5572047">,</span>&nbsp;<span class="ident" id="5572049">stride</span><span class="op" id="5572055">,</span>&nbsp;<span class="ident" id="5572057">rect</span>&nbsp;<span class="op" id="5572062">=</span>&nbsp;<span class="ident" id="5572064">target</span><span class="op" id="5572070">.</span><span class="ident" id="5572071">Pix</span><span class="op" id="5572074">,</span>&nbsp;<span class="ident" id="5572076">target</span><span class="op" id="5572082">.</span><span class="ident" id="5572083">Stride</span><span class="op" id="5572089">,</span>&nbsp;<span class="ident" id="5572091">target</span><span class="op" id="5572097">.</span><span class="ident" id="5572098">Rect</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5572105">bytesPerPixel</span>&nbsp;<span class="op" id="5572119">=</span>&nbsp;<span class="num" id="5572121">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5572124">case</span>&nbsp;<span class="op" id="5572129">*</span><span class="ident" id="5572130">image</span><span class="op" id="5572135">.</span><span class="ident" id="5572136">Gray</span><span class="op" id="5572140">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5572144">srcPix</span>&nbsp;<span class="op" id="5572151">=</span>&nbsp;<span class="ident" id="5572153">src</span><span class="op" id="5572156">.</span><span class="op" id="5572157">(</span><span class="op" id="5572158">*</span><span class="ident" id="5572159">image</span><span class="op" id="5572164">.</span><span class="ident" id="5572165">Gray</span><span class="op" id="5572169">)</span><span class="op" id="5572170">.</span><span class="ident" id="5572171">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5572177">dstPix</span><span class="op" id="5572183">,</span>&nbsp;<span class="ident" id="5572185">stride</span><span class="op" id="5572191">,</span>&nbsp;<span class="ident" id="5572193">rect</span>&nbsp;<span class="op" id="5572198">=</span>&nbsp;<span class="ident" id="5572200">target</span><span class="op" id="5572206">.</span><span class="ident" id="5572207">Pix</span><span class="op" id="5572210">,</span>&nbsp;<span class="ident" id="5572212">target</span><span class="op" id="5572218">.</span><span class="ident" id="5572219">Stride</span><span class="op" id="5572225">,</span>&nbsp;<span class="ident" id="5572227">target</span><span class="op" id="5572233">.</span><span class="ident" id="5572234">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5572241">bytesPerPixel</span>&nbsp;<span class="op" id="5572255">=</span>&nbsp;<span class="num" id="5572257">1</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5572260">case</span>&nbsp;<span class="op" id="5572265">*</span><span class="ident" id="5572266">image</span><span class="op" id="5572271">.</span><span class="ident" id="5572272">Gray16</span><span class="op" id="5572278">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5572282">srcPix</span>&nbsp;<span class="op" id="5572289">=</span>&nbsp;<span class="ident" id="5572291">src</span><span class="op" id="5572294">.</span><span class="op" id="5572295">(</span><span class="op" id="5572296">*</span><span class="ident" id="5572297">image</span><span class="op" id="5572302">.</span><span class="ident" id="5572303">Gray16</span><span class="op" id="5572309">)</span><span class="op" id="5572310">.</span><span class="ident" id="5572311">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5572317">dstPix</span><span class="op" id="5572323">,</span>&nbsp;<span class="ident" id="5572325">stride</span><span class="op" id="5572331">,</span>&nbsp;<span class="ident" id="5572333">rect</span>&nbsp;<span class="op" id="5572338">=</span>&nbsp;<span class="ident" id="5572340">target</span><span class="op" id="5572346">.</span><span class="ident" id="5572347">Pix</span><span class="op" id="5572350">,</span>&nbsp;<span class="ident" id="5572352">target</span><span class="op" id="5572358">.</span><span class="ident" id="5572359">Stride</span><span class="op" id="5572365">,</span>&nbsp;<span class="ident" id="5572367">target</span><span class="op" id="5572373">.</span><span class="ident" id="5572374">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5572381">bytesPerPixel</span>&nbsp;<span class="op" id="5572395">=</span>&nbsp;<span class="num" id="5572397">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5572400">case</span>&nbsp;<span class="op" id="5572405">*</span><span class="ident" id="5572406">image</span><span class="op" id="5572411">.</span><span class="ident" id="5572412">NRGBA</span><span class="op" id="5572417">:</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5572421">srcPix</span>&nbsp;<span class="op" id="5572428">=</span>&nbsp;<span class="ident" id="5572430">src</span><span class="op" id="5572433">.</span><span class="op" id="5572434">(</span><span class="op" id="5572435">*</span><span class="ident" id="5572436">image</span><span class="op" id="5572441">.</span><span class="ident" id="5572442">NRGBA</span><span class="op" id="5572447">)</span><span class="op" id="5572448">.</span><span class="ident" id="5572449">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5572455">dstPix</span><span class="op" id="5572461">,</span>&nbsp;<span class="ident" id="5572463">stride</span><span class="op" id="5572469">,</span>&nbsp;<span class="ident" id="5572471">rect</span>&nbsp;<span class="op" id="5572476">=</span>&nbsp;<span class="ident" id="5572478">target</span><span class="op" id="5572484">.</span><span class="ident" id="5572485">Pix</span><span class="op" id="5572488">,</span>&nbsp;<span class="ident" id="5572490">target</span><span class="op" id="5572496">.</span><span class="ident" id="5572497">Stride</span><span class="op" id="5572503">,</span>&nbsp;<span class="ident" id="5572505">target</span><span class="op" id="5572511">.</span><span class="ident" id="5572512">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5572519">bytesPerPixel</span>&nbsp;<span class="op" id="5572533">=</span>&nbsp;<span class="num" id="5572535">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5572538">case</span>&nbsp;<span class="op" id="5572543">*</span><span class="ident" id="5572544">image</span><span class="op" id="5572549">.</span><span class="ident" id="5572550">NRGBA64</span><span class="op" id="5572557">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5572561">srcPix</span>&nbsp;<span class="op" id="5572568">=</span>&nbsp;<span class="ident" id="5572570">src</span><span class="op" id="5572573">.</span><span class="op" id="5572574">(</span><span class="op" id="5572575">*</span><span class="ident" id="5572576">image</span><span class="op" id="5572581">.</span><span class="ident" id="5572582">NRGBA64</span><span class="op" id="5572589">)</span><span class="op" id="5572590">.</span><span class="ident" id="5572591">Pix</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5572597">dstPix</span><span class="op" id="5572603">,</span>&nbsp;<span class="ident" id="5572605">stride</span><span class="op" id="5572611">,</span>&nbsp;<span class="ident" id="5572613">rect</span>&nbsp;<span class="op" id="5572618">=</span>&nbsp;<span class="ident" id="5572620">target</span><span class="op" id="5572626">.</span><span class="ident" id="5572627">Pix</span><span class="op" id="5572630">,</span>&nbsp;<span class="ident" id="5572632">target</span><span class="op" id="5572638">.</span><span class="ident" id="5572639">Stride</span><span class="op" id="5572645">,</span>&nbsp;<span class="ident" id="5572647">target</span><span class="op" id="5572653">.</span><span class="ident" id="5572654">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5572661">bytesPerPixel</span>&nbsp;<span class="op" id="5572675">=</span>&nbsp;<span class="num" id="5572677">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5572680">case</span>&nbsp;<span class="op" id="5572685">*</span><span class="ident" id="5572686">image</span><span class="op" id="5572691">.</span><span class="ident" id="5572692">Paletted</span><span class="op" id="5572700">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5572704">srcPix</span>&nbsp;<span class="op" id="5572711">=</span>&nbsp;<span class="ident" id="5572713">src</span><span class="op" id="5572716">.</span><span class="op" id="5572717">(</span><span class="op" id="5572718">*</span><span class="ident" id="5572719">image</span><span class="op" id="5572724">.</span><span class="ident" id="5572725">Paletted</span><span class="op" id="5572733">)</span><span class="op" id="5572734">.</span><span class="ident" id="5572735">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5572741">dstPix</span><span class="op" id="5572747">,</span>&nbsp;<span class="ident" id="5572749">stride</span><span class="op" id="5572755">,</span>&nbsp;<span class="ident" id="5572757">rect</span>&nbsp;<span class="op" id="5572762">=</span>&nbsp;<span class="ident" id="5572764">target</span><span class="op" id="5572770">.</span><span class="ident" id="5572771">Pix</span><span class="op" id="5572774">,</span>&nbsp;<span class="ident" id="5572776">target</span><span class="op" id="5572782">.</span><span class="ident" id="5572783">Stride</span><span class="op" id="5572789">,</span>&nbsp;<span class="ident" id="5572791">target</span><span class="op" id="5572797">.</span><span class="ident" id="5572798">Rect</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5572805">bytesPerPixel</span>&nbsp;<span class="op" id="5572819">=</span>&nbsp;<span class="num" id="5572821">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5572824">case</span>&nbsp;<span class="op" id="5572829">*</span><span class="ident" id="5572830">image</span><span class="op" id="5572835">.</span><span class="ident" id="5572836">RGBA</span><span class="op" id="5572840">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5572844">srcPix</span>&nbsp;<span class="op" id="5572851">=</span>&nbsp;<span class="ident" id="5572853">src</span><span class="op" id="5572856">.</span><span class="op" id="5572857">(</span><span class="op" id="5572858">*</span><span class="ident" id="5572859">image</span><span class="op" id="5572864">.</span><span class="ident" id="5572865">RGBA</span><span class="op" id="5572869">)</span><span class="op" id="5572870">.</span><span class="ident" id="5572871">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5572877">dstPix</span><span class="op" id="5572883">,</span>&nbsp;<span class="ident" id="5572885">stride</span><span class="op" id="5572891">,</span>&nbsp;<span class="ident" id="5572893">rect</span>&nbsp;<span class="op" id="5572898">=</span>&nbsp;<span class="ident" id="5572900">target</span><span class="op" id="5572906">.</span><span class="ident" id="5572907">Pix</span><span class="op" id="5572910">,</span>&nbsp;<span class="ident" id="5572912">target</span><span class="op" id="5572918">.</span><span class="ident" id="5572919">Stride</span><span class="op" id="5572925">,</span>&nbsp;<span class="ident" id="5572927">target</span><span class="op" id="5572933">.</span><span class="ident" id="5572934">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5572941">bytesPerPixel</span>&nbsp;<span class="op" id="5572955">=</span>&nbsp;<span class="num" id="5572957">4</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5572960">case</span>&nbsp;<span class="op" id="5572965">*</span><span class="ident" id="5572966">image</span><span class="op" id="5572971">.</span><span class="ident" id="5572972">RGBA64</span><span class="op" id="5572978">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5572982">srcPix</span>&nbsp;<span class="op" id="5572989">=</span>&nbsp;<span class="ident" id="5572991">src</span><span class="op" id="5572994">.</span><span class="op" id="5572995">(</span><span class="op" id="5572996">*</span><span class="ident" id="5572997">image</span><span class="op" id="5573002">.</span><span class="ident" id="5573003">RGBA64</span><span class="op" id="5573009">)</span><span class="op" id="5573010">.</span><span class="ident" id="5573011">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5573017">dstPix</span><span class="op" id="5573023">,</span>&nbsp;<span class="ident" id="5573025">stride</span><span class="op" id="5573031">,</span>&nbsp;<span class="ident" id="5573033">rect</span>&nbsp;<span class="op" id="5573038">=</span>&nbsp;<span class="ident" id="5573040">target</span><span class="op" id="5573046">.</span><span class="ident" id="5573047">Pix</span><span class="op" id="5573050">,</span>&nbsp;<span class="ident" id="5573052">target</span><span class="op" id="5573058">.</span><span class="ident" id="5573059">Stride</span><span class="op" id="5573065">,</span>&nbsp;<span class="ident" id="5573067">target</span><span class="op" id="5573073">.</span><span class="ident" id="5573074">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5573081">bytesPerPixel</span>&nbsp;<span class="op" id="5573095">=</span>&nbsp;<span class="num" id="5573097">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5573100">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5573103">s</span><span class="op" id="5573104">,</span>&nbsp;<span class="ident" id="5573106">bounds</span>&nbsp;<span class="op" id="5573113">:=</span>&nbsp;<span class="num" id="5573116">0</span><span class="op" id="5573117">,</span>&nbsp;<span class="ident" id="5573119">src</span><span class="op" id="5573122">.</span><span class="ident" id="5573123">Bounds</span><span class="op" id="5573129">(</span><span class="op" id="5573130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5573133">for</span>&nbsp;<span class="ident" id="5573137">y</span>&nbsp;<span class="op" id="5573139">:=</span>&nbsp;<span class="ident" id="5573142">bounds</span><span class="op" id="5573148">.</span><span class="ident" id="5573149">Min</span><span class="op" id="5573152">.</span><span class="ident" id="5573153">Y</span><span class="op" id="5573154">;</span>&nbsp;<span class="ident" id="5573156">y</span>&nbsp;<span class="op" id="5573158">&lt;</span>&nbsp;<span class="ident" id="5573160">bounds</span><span class="op" id="5573166">.</span><span class="ident" id="5573167">Max</span><span class="op" id="5573170">.</span><span class="ident" id="5573171">Y</span><span class="op" id="5573172">;</span>&nbsp;<span class="ident" id="5573174">y</span><span class="op" id="5573175">++</span>&nbsp;<span class="op" id="5573178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5573182">dBase</span>&nbsp;<span class="op" id="5573188">:=</span>&nbsp;<span class="op" id="5573191">(</span><span class="ident" id="5573192">y</span><span class="op" id="5573193">*</span><span class="ident" id="5573194">p</span><span class="op" id="5573195">.</span><span class="ident" id="5573196">yFactor</span><span class="op" id="5573203">+</span><span class="ident" id="5573204">p</span><span class="op" id="5573205">.</span><span class="ident" id="5573206">yOffset</span><span class="op" id="5573213">-</span><span class="ident" id="5573214">rect</span><span class="op" id="5573218">.</span><span class="ident" id="5573219">Min</span><span class="op" id="5573222">.</span><span class="ident" id="5573223">Y</span><span class="op" id="5573224">)</span><span class="op" id="5573225">*</span><span class="ident" id="5573226">stride</span>&nbsp;<span class="op" id="5573233">+</span>&nbsp;<span class="op" id="5573235">(</span><span class="ident" id="5573236">p</span><span class="op" id="5573237">.</span><span class="ident" id="5573238">xOffset</span><span class="op" id="5573245">-</span><span class="ident" id="5573246">rect</span><span class="op" id="5573250">.</span><span class="ident" id="5573251">Min</span><span class="op" id="5573254">.</span><span class="ident" id="5573255">X</span><span class="op" id="5573256">)</span><span class="op" id="5573257">*</span><span class="ident" id="5573258">bytesPerPixel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5573274">for</span>&nbsp;<span class="ident" id="5573278">x</span>&nbsp;<span class="op" id="5573280">:=</span>&nbsp;<span class="ident" id="5573283">bounds</span><span class="op" id="5573289">.</span><span class="ident" id="5573290">Min</span><span class="op" id="5573293">.</span><span class="ident" id="5573294">X</span><span class="op" id="5573295">;</span>&nbsp;<span class="ident" id="5573297">x</span>&nbsp;<span class="op" id="5573299">&lt;</span>&nbsp;<span class="ident" id="5573301">bounds</span><span class="op" id="5573307">.</span><span class="ident" id="5573308">Max</span><span class="op" id="5573311">.</span><span class="ident" id="5573312">X</span><span class="op" id="5573313">;</span>&nbsp;<span class="ident" id="5573315">x</span><span class="op" id="5573316">++</span>&nbsp;<span class="op" id="5573319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5573324">d</span>&nbsp;<span class="op" id="5573326">:=</span>&nbsp;<span class="ident" id="5573329">dBase</span>&nbsp;<span class="op" id="5573335">+</span>&nbsp;<span class="ident" id="5573337">x</span><span class="op" id="5573338">*</span><span class="ident" id="5573339">p</span><span class="op" id="5573340">.</span><span class="ident" id="5573341">xFactor</span><span class="op" id="5573348">*</span><span class="ident" id="5573349">bytesPerPixel</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5573366">copy</span><span class="op" id="5573370">(</span><span class="ident" id="5573371">dstPix</span><span class="op" id="5573377">[</span><span class="ident" id="5573378">d</span><span class="op" id="5573379">:</span><span class="op" id="5573380">]</span><span class="op" id="5573381">,</span>&nbsp;<span class="ident" id="5573383">srcPix</span><span class="op" id="5573389">[</span><span class="ident" id="5573390">s</span><span class="op" id="5573391">:</span><span class="ident" id="5573392">s</span><span class="op" id="5573393">+</span><span class="ident" id="5573394">bytesPerPixel</span><span class="op" id="5573407">]</span><span class="op" id="5573408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5573413">s</span>&nbsp;<span class="op" id="5573415">+=</span>&nbsp;<span class="ident" id="5573418">bytesPerPixel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5573434">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5573437">}</span><br>
<span class="lineno"></span><span class="op" id="5573439">}</span><br>
<span class="lineno">645</span><br>
<span class="lineno"></span><span class="keyword" id="5573442">func</span>&nbsp;<span class="op" id="5573447">(</span><span class="ident" id="5573448">d</span>&nbsp;<span class="op" id="5573450">*</span><span class="ident" id="5573451">decoder</span><span class="op" id="5573458">)</span>&nbsp;<span class="ident" id="5573460">parseIDAT</span><span class="op" id="5573469">(</span><span class="ident" id="5573470">length</span>&nbsp;<span class="builtintype" id="5573477">uint32</span><span class="op" id="5573483">)</span>&nbsp;<span class="op" id="5573485">(</span><span class="ident" id="5573486">err</span>&nbsp;<span class="builtintype" id="5573490">error</span><span class="op" id="5573495">)</span>&nbsp;<span class="op" id="5573497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5573500">d</span><span class="op" id="5573501">.</span><span class="ident" id="5573502">idatLength</span>&nbsp;<span class="op" id="5573513">=</span>&nbsp;<span class="ident" id="5573515">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5573523">d</span><span class="op" id="5573524">.</span><span class="ident" id="5573525">img</span><span class="op" id="5573528">,</span>&nbsp;<span class="ident" id="5573530">err</span>&nbsp;<span class="op" id="5573534">=</span>&nbsp;<span class="ident" id="5573536">d</span><span class="op" id="5573537">.</span><span class="ident" id="5573538">decode</span><span class="op" id="5573544">(</span><span class="op" id="5573545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5573548">if</span>&nbsp;<span class="ident" id="5573551">err</span>&nbsp;<span class="op" id="5573555">!=</span>&nbsp;<span class="ident" id="5573558">nil</span>&nbsp;<span class="op" id="5573562">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5573566">return</span>&nbsp;<span class="ident" id="5573573">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5573578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5573581">return</span>&nbsp;<span class="ident" id="5573588">d</span><span class="op" id="5573589">.</span><span class="ident" id="5573590">verifyChecksum</span><span class="op" id="5573604">(</span><span class="op" id="5573605">)</span><br>
<span class="lineno"></span><span class="op" id="5573607">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">655</span><span class="keyword" id="5573610">func</span>&nbsp;<span class="op" id="5573615">(</span><span class="ident" id="5573616">d</span>&nbsp;<span class="op" id="5573618">*</span><span class="ident" id="5573619">decoder</span><span class="op" id="5573626">)</span>&nbsp;<span class="ident" id="5573628">parseIEND</span><span class="op" id="5573637">(</span><span class="ident" id="5573638">length</span>&nbsp;<span class="builtintype" id="5573645">uint32</span><span class="op" id="5573651">)</span>&nbsp;<span class="builtintype" id="5573653">error</span>&nbsp;<span class="op" id="5573659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5573662">if</span>&nbsp;<span class="ident" id="5573665">length</span>&nbsp;<span class="op" id="5573672">!=</span>&nbsp;<span class="num" id="5573675">0</span>&nbsp;<span class="op" id="5573677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5573681">return</span>&nbsp;<span class="ident" id="5573688">FormatError</span><span class="op" id="5573699">(</span><span class="string" id="5573700">&#34;bad&nbsp;IEND&nbsp;length&#34;</span><span class="op" id="5573717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5573720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5573723">return</span>&nbsp;<span class="ident" id="5573730">d</span><span class="op" id="5573731">.</span><span class="ident" id="5573732">verifyChecksum</span><span class="op" id="5573746">(</span><span class="op" id="5573747">)</span><br>
<span class="lineno">660</span><span class="op" id="5573749">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5573752">func</span>&nbsp;<span class="op" id="5573757">(</span><span class="ident" id="5573758">d</span>&nbsp;<span class="op" id="5573760">*</span><span class="ident" id="5573761">decoder</span><span class="op" id="5573768">)</span>&nbsp;<span class="ident" id="5573770">parseChunk</span><span class="op" id="5573780">(</span><span class="op" id="5573781">)</span>&nbsp;<span class="builtintype" id="5573783">error</span>&nbsp;<span class="op" id="5573789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5573792">//&nbsp;Read&nbsp;the&nbsp;length&nbsp;and&nbsp;chunk&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5573828">n</span><span class="op" id="5573829">,</span>&nbsp;<span class="ident" id="5573831">err</span>&nbsp;<span class="op" id="5573835">:=</span>&nbsp;<span class="ident" id="5573838">io</span><span class="op" id="5573840">.</span><span class="ident" id="5573841">ReadFull</span><span class="op" id="5573849">(</span><span class="ident" id="5573850">d</span><span class="op" id="5573851">.</span><span class="ident" id="5573852">r</span><span class="op" id="5573853">,</span>&nbsp;<span class="ident" id="5573855">d</span><span class="op" id="5573856">.</span><span class="ident" id="5573857">tmp</span><span class="op" id="5573860">[</span><span class="op" id="5573861">:</span><span class="num" id="5573862">8</span><span class="op" id="5573863">]</span><span class="op" id="5573864">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5573867">if</span>&nbsp;<span class="ident" id="5573870">err</span>&nbsp;<span class="op" id="5573874">!=</span>&nbsp;<span class="ident" id="5573877">nil</span>&nbsp;<span class="op" id="5573881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5573885">return</span>&nbsp;<span class="ident" id="5573892">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5573897">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5573900">length</span>&nbsp;<span class="op" id="5573907">:=</span>&nbsp;<span class="ident" id="5573910">binary</span><span class="op" id="5573916">.</span><span class="ident" id="5573917">BigEndian</span><span class="op" id="5573926">.</span><span class="ident" id="5573927">Uint32</span><span class="op" id="5573933">(</span><span class="ident" id="5573934">d</span><span class="op" id="5573935">.</span><span class="ident" id="5573936">tmp</span><span class="op" id="5573939">[</span><span class="op" id="5573940">:</span><span class="num" id="5573941">4</span><span class="op" id="5573942">]</span><span class="op" id="5573943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5573946">d</span><span class="op" id="5573947">.</span><span class="ident" id="5573948">crc</span><span class="op" id="5573951">.</span><span class="ident" id="5573952">Reset</span><span class="op" id="5573957">(</span><span class="op" id="5573958">)</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5573961">d</span><span class="op" id="5573962">.</span><span class="ident" id="5573963">crc</span><span class="op" id="5573966">.</span><span class="ident" id="5573967">Write</span><span class="op" id="5573972">(</span><span class="ident" id="5573973">d</span><span class="op" id="5573974">.</span><span class="ident" id="5573975">tmp</span><span class="op" id="5573978">[</span><span class="num" id="5573979">4</span><span class="op" id="5573980">:</span><span class="num" id="5573981">8</span><span class="op" id="5573982">]</span><span class="op" id="5573983">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5573987">//&nbsp;Read&nbsp;the&nbsp;chunk&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5574012">switch</span>&nbsp;<span class="builtintype" id="5574019">string</span><span class="op" id="5574025">(</span><span class="ident" id="5574026">d</span><span class="op" id="5574027">.</span><span class="ident" id="5574028">tmp</span><span class="op" id="5574031">[</span><span class="num" id="5574032">4</span><span class="op" id="5574033">:</span><span class="num" id="5574034">8</span><span class="op" id="5574035">]</span><span class="op" id="5574036">)</span>&nbsp;<span class="op" id="5574038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5574041">case</span>&nbsp;<span class="string" id="5574046">&#34;IHDR&#34;</span><span class="op" id="5574052">:</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5574056">if</span>&nbsp;<span class="ident" id="5574059">d</span><span class="op" id="5574060">.</span><span class="ident" id="5574061">stage</span>&nbsp;<span class="op" id="5574067">!=</span>&nbsp;<span class="ident" id="5574070">dsStart</span>&nbsp;<span class="op" id="5574078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5574083">return</span>&nbsp;<span class="ident" id="5574090">chunkOrderError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5574108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5574112">d</span><span class="op" id="5574113">.</span><span class="ident" id="5574114">stage</span>&nbsp;<span class="op" id="5574120">=</span>&nbsp;<span class="ident" id="5574122">dsSeenIHDR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5574135">return</span>&nbsp;<span class="ident" id="5574142">d</span><span class="op" id="5574143">.</span><span class="ident" id="5574144">parseIHDR</span><span class="op" id="5574153">(</span><span class="ident" id="5574154">length</span><span class="op" id="5574160">)</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5574163">case</span>&nbsp;<span class="string" id="5574168">&#34;PLTE&#34;</span><span class="op" id="5574174">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5574178">if</span>&nbsp;<span class="ident" id="5574181">d</span><span class="op" id="5574182">.</span><span class="ident" id="5574183">stage</span>&nbsp;<span class="op" id="5574189">!=</span>&nbsp;<span class="ident" id="5574192">dsSeenIHDR</span>&nbsp;<span class="op" id="5574203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5574208">return</span>&nbsp;<span class="ident" id="5574215">chunkOrderError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5574233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5574237">d</span><span class="op" id="5574238">.</span><span class="ident" id="5574239">stage</span>&nbsp;<span class="op" id="5574245">=</span>&nbsp;<span class="ident" id="5574247">dsSeenPLTE</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5574260">return</span>&nbsp;<span class="ident" id="5574267">d</span><span class="op" id="5574268">.</span><span class="ident" id="5574269">parsePLTE</span><span class="op" id="5574278">(</span><span class="ident" id="5574279">length</span><span class="op" id="5574285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5574288">case</span>&nbsp;<span class="string" id="5574293">&#34;tRNS&#34;</span><span class="op" id="5574299">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5574303">if</span>&nbsp;<span class="ident" id="5574306">d</span><span class="op" id="5574307">.</span><span class="ident" id="5574308">stage</span>&nbsp;<span class="op" id="5574314">!=</span>&nbsp;<span class="ident" id="5574317">dsSeenPLTE</span>&nbsp;<span class="op" id="5574328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5574333">return</span>&nbsp;<span class="ident" id="5574340">chunkOrderError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5574358">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5574362">return</span>&nbsp;<span class="ident" id="5574369">d</span><span class="op" id="5574370">.</span><span class="ident" id="5574371">parsetRNS</span><span class="op" id="5574380">(</span><span class="ident" id="5574381">length</span><span class="op" id="5574387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5574390">case</span>&nbsp;<span class="string" id="5574395">&#34;IDAT&#34;</span><span class="op" id="5574401">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5574405">if</span>&nbsp;<span class="ident" id="5574408">d</span><span class="op" id="5574409">.</span><span class="ident" id="5574410">stage</span>&nbsp;<span class="op" id="5574416">&lt;</span>&nbsp;<span class="ident" id="5574418">dsSeenIHDR</span>&nbsp;<span class="op" id="5574429">||</span>&nbsp;<span class="ident" id="5574432">d</span><span class="op" id="5574433">.</span><span class="ident" id="5574434">stage</span>&nbsp;<span class="op" id="5574440">&gt;</span>&nbsp;<span class="ident" id="5574442">dsSeenIDAT</span>&nbsp;<span class="op" id="5574453">||</span>&nbsp;<span class="op" id="5574456">(</span><span class="ident" id="5574457">d</span><span class="op" id="5574458">.</span><span class="ident" id="5574459">cb</span>&nbsp;<span class="op" id="5574462">==</span>&nbsp;<span class="ident" id="5574465">cbP8</span>&nbsp;<span class="op" id="5574470">&amp;&amp;</span>&nbsp;<span class="ident" id="5574473">d</span><span class="op" id="5574474">.</span><span class="ident" id="5574475">stage</span>&nbsp;<span class="op" id="5574481">==</span>&nbsp;<span class="ident" id="5574484">dsSeenIHDR</span><span class="op" id="5574494">)</span>&nbsp;<span class="op" id="5574496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5574501">return</span>&nbsp;<span class="ident" id="5574508">chunkOrderError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5574526">}</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5574530">d</span><span class="op" id="5574531">.</span><span class="ident" id="5574532">stage</span>&nbsp;<span class="op" id="5574538">=</span>&nbsp;<span class="ident" id="5574540">dsSeenIDAT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5574553">return</span>&nbsp;<span class="ident" id="5574560">d</span><span class="op" id="5574561">.</span><span class="ident" id="5574562">parseIDAT</span><span class="op" id="5574571">(</span><span class="ident" id="5574572">length</span><span class="op" id="5574578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5574581">case</span>&nbsp;<span class="string" id="5574586">&#34;IEND&#34;</span><span class="op" id="5574592">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5574596">if</span>&nbsp;<span class="ident" id="5574599">d</span><span class="op" id="5574600">.</span><span class="ident" id="5574601">stage</span>&nbsp;<span class="op" id="5574607">!=</span>&nbsp;<span class="ident" id="5574610">dsSeenIDAT</span>&nbsp;<span class="op" id="5574621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5574626">return</span>&nbsp;<span class="ident" id="5574633">chunkOrderError</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5574651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5574655">d</span><span class="op" id="5574656">.</span><span class="ident" id="5574657">stage</span>&nbsp;<span class="op" id="5574663">=</span>&nbsp;<span class="ident" id="5574665">dsSeenIEND</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5574678">return</span>&nbsp;<span class="ident" id="5574685">d</span><span class="op" id="5574686">.</span><span class="ident" id="5574687">parseIEND</span><span class="op" id="5574696">(</span><span class="ident" id="5574697">length</span><span class="op" id="5574703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5574706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5574709">//&nbsp;Ignore&nbsp;this&nbsp;chunk&nbsp;(of&nbsp;a&nbsp;known&nbsp;length).</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5574752">var</span>&nbsp;<span class="ident" id="5574756">ignored</span>&nbsp;<span class="op" id="5574764">[</span><span class="num" id="5574765">4096</span><span class="op" id="5574769">]</span><span class="builtintype" id="5574770">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5574776">for</span>&nbsp;<span class="ident" id="5574780">length</span>&nbsp;<span class="op" id="5574787">&gt;</span>&nbsp;<span class="num" id="5574789">0</span>&nbsp;<span class="op" id="5574791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5574795">n</span><span class="op" id="5574796">,</span>&nbsp;<span class="ident" id="5574798">err</span>&nbsp;<span class="op" id="5574802">=</span>&nbsp;<span class="ident" id="5574804">io</span><span class="op" id="5574806">.</span><span class="ident" id="5574807">ReadFull</span><span class="op" id="5574815">(</span><span class="ident" id="5574816">d</span><span class="op" id="5574817">.</span><span class="ident" id="5574818">r</span><span class="op" id="5574819">,</span>&nbsp;<span class="ident" id="5574821">ignored</span><span class="op" id="5574828">[</span><span class="op" id="5574829">:</span><span class="ident" id="5574830">min</span><span class="op" id="5574833">(</span><span class="builtinfunc" id="5574834">len</span><span class="op" id="5574837">(</span><span class="ident" id="5574838">ignored</span><span class="op" id="5574845">)</span><span class="op" id="5574846">,</span>&nbsp;<span class="builtintype" id="5574848">int</span><span class="op" id="5574851">(</span><span class="ident" id="5574852">length</span><span class="op" id="5574858">)</span><span class="op" id="5574859">)</span><span class="op" id="5574860">]</span><span class="op" id="5574861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5574865">if</span>&nbsp;<span class="ident" id="5574868">err</span>&nbsp;<span class="op" id="5574872">!=</span>&nbsp;<span class="ident" id="5574875">nil</span>&nbsp;<span class="op" id="5574879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5574884">return</span>&nbsp;<span class="ident" id="5574891">err</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5574897">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5574901">d</span><span class="op" id="5574902">.</span><span class="ident" id="5574903">crc</span><span class="op" id="5574906">.</span><span class="ident" id="5574907">Write</span><span class="op" id="5574912">(</span><span class="ident" id="5574913">ignored</span><span class="op" id="5574920">[</span><span class="op" id="5574921">:</span><span class="ident" id="5574922">n</span><span class="op" id="5574923">]</span><span class="op" id="5574924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5574928">length</span>&nbsp;<span class="op" id="5574935">-=</span>&nbsp;<span class="builtintype" id="5574938">uint32</span><span class="op" id="5574944">(</span><span class="ident" id="5574945">n</span><span class="op" id="5574946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5574949">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5574952">return</span>&nbsp;<span class="ident" id="5574959">d</span><span class="op" id="5574960">.</span><span class="ident" id="5574961">verifyChecksum</span><span class="op" id="5574975">(</span><span class="op" id="5574976">)</span><br>
<span class="lineno">715</span><span class="op" id="5574978">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5574981">func</span>&nbsp;<span class="op" id="5574986">(</span><span class="ident" id="5574987">d</span>&nbsp;<span class="op" id="5574989">*</span><span class="ident" id="5574990">decoder</span><span class="op" id="5574997">)</span>&nbsp;<span class="ident" id="5574999">verifyChecksum</span><span class="op" id="5575013">(</span><span class="op" id="5575014">)</span>&nbsp;<span class="builtintype" id="5575016">error</span>&nbsp;<span class="op" id="5575022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5575025">if</span>&nbsp;<span class="ident" id="5575028">_</span><span class="op" id="5575029">,</span>&nbsp;<span class="ident" id="5575031">err</span>&nbsp;<span class="op" id="5575035">:=</span>&nbsp;<span class="ident" id="5575038">io</span><span class="op" id="5575040">.</span><span class="ident" id="5575041">ReadFull</span><span class="op" id="5575049">(</span><span class="ident" id="5575050">d</span><span class="op" id="5575051">.</span><span class="ident" id="5575052">r</span><span class="op" id="5575053">,</span>&nbsp;<span class="ident" id="5575055">d</span><span class="op" id="5575056">.</span><span class="ident" id="5575057">tmp</span><span class="op" id="5575060">[</span><span class="op" id="5575061">:</span><span class="num" id="5575062">4</span><span class="op" id="5575063">]</span><span class="op" id="5575064">)</span><span class="op" id="5575065">;</span>&nbsp;<span class="ident" id="5575067">err</span>&nbsp;<span class="op" id="5575071">!=</span>&nbsp;<span class="ident" id="5575074">nil</span>&nbsp;<span class="op" id="5575078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5575082">return</span>&nbsp;<span class="ident" id="5575089">err</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5575094">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5575097">if</span>&nbsp;<span class="ident" id="5575100">binary</span><span class="op" id="5575106">.</span><span class="ident" id="5575107">BigEndian</span><span class="op" id="5575116">.</span><span class="ident" id="5575117">Uint32</span><span class="op" id="5575123">(</span><span class="ident" id="5575124">d</span><span class="op" id="5575125">.</span><span class="ident" id="5575126">tmp</span><span class="op" id="5575129">[</span><span class="op" id="5575130">:</span><span class="num" id="5575131">4</span><span class="op" id="5575132">]</span><span class="op" id="5575133">)</span>&nbsp;<span class="op" id="5575135">!=</span>&nbsp;<span class="ident" id="5575138">d</span><span class="op" id="5575139">.</span><span class="ident" id="5575140">crc</span><span class="op" id="5575143">.</span><span class="ident" id="5575144">Sum32</span><span class="op" id="5575149">(</span><span class="op" id="5575150">)</span>&nbsp;<span class="op" id="5575152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5575156">return</span>&nbsp;<span class="ident" id="5575163">FormatError</span><span class="op" id="5575174">(</span><span class="string" id="5575175">&#34;invalid&nbsp;checksum&#34;</span><span class="op" id="5575193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5575196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5575199">return</span>&nbsp;<span class="ident" id="5575206">nil</span><br>
<span class="lineno">725</span><span class="op" id="5575210">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5575213">func</span>&nbsp;<span class="op" id="5575218">(</span><span class="ident" id="5575219">d</span>&nbsp;<span class="op" id="5575221">*</span><span class="ident" id="5575222">decoder</span><span class="op" id="5575229">)</span>&nbsp;<span class="ident" id="5575231">checkHeader</span><span class="op" id="5575242">(</span><span class="op" id="5575243">)</span>&nbsp;<span class="builtintype" id="5575245">error</span>&nbsp;<span class="op" id="5575251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5575254">_</span><span class="op" id="5575255">,</span>&nbsp;<span class="ident" id="5575257">err</span>&nbsp;<span class="op" id="5575261">:=</span>&nbsp;<span class="ident" id="5575264">io</span><span class="op" id="5575266">.</span><span class="ident" id="5575267">ReadFull</span><span class="op" id="5575275">(</span><span class="ident" id="5575276">d</span><span class="op" id="5575277">.</span><span class="ident" id="5575278">r</span><span class="op" id="5575279">,</span>&nbsp;<span class="ident" id="5575281">d</span><span class="op" id="5575282">.</span><span class="ident" id="5575283">tmp</span><span class="op" id="5575286">[</span><span class="op" id="5575287">:</span><span class="builtinfunc" id="5575288">len</span><span class="op" id="5575291">(</span><span class="ident" id="5575292">pngHeader</span><span class="op" id="5575301">)</span><span class="op" id="5575302">]</span><span class="op" id="5575303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5575306">if</span>&nbsp;<span class="ident" id="5575309">err</span>&nbsp;<span class="op" id="5575313">!=</span>&nbsp;<span class="ident" id="5575316">nil</span>&nbsp;<span class="op" id="5575320">{</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5575324">return</span>&nbsp;<span class="ident" id="5575331">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5575336">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5575339">if</span>&nbsp;<span class="builtintype" id="5575342">string</span><span class="op" id="5575348">(</span><span class="ident" id="5575349">d</span><span class="op" id="5575350">.</span><span class="ident" id="5575351">tmp</span><span class="op" id="5575354">[</span><span class="op" id="5575355">:</span><span class="builtinfunc" id="5575356">len</span><span class="op" id="5575359">(</span><span class="ident" id="5575360">pngHeader</span><span class="op" id="5575369">)</span><span class="op" id="5575370">]</span><span class="op" id="5575371">)</span>&nbsp;<span class="op" id="5575373">!=</span>&nbsp;<span class="ident" id="5575376">pngHeader</span>&nbsp;<span class="op" id="5575386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5575390">return</span>&nbsp;<span class="ident" id="5575397">FormatError</span><span class="op" id="5575408">(</span><span class="string" id="5575409">&#34;not&nbsp;a&nbsp;PNG&nbsp;file&#34;</span><span class="op" id="5575425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5575428">}</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5575431">return</span>&nbsp;<span class="ident" id="5575438">nil</span><br>
<span class="lineno"></span><span class="op" id="5575442">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5575445">//&nbsp;Decode&nbsp;reads&nbsp;a&nbsp;PNG&nbsp;image&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;it&nbsp;as&nbsp;an&nbsp;image.Image.</span><br>
<span class="lineno"></span><span class="comment" id="5575514">//&nbsp;The&nbsp;type&nbsp;of&nbsp;Image&nbsp;returned&nbsp;depends&nbsp;on&nbsp;the&nbsp;PNG&nbsp;contents.</span><br>
<span class="lineno">740</span><span class="keyword" id="5575573">func</span>&nbsp;<span class="ident" id="5575578">Decode</span><span class="op" id="5575584">(</span><span class="ident" id="5575585">r</span>&nbsp;<span class="ident" id="5575587">io</span><span class="op" id="5575589">.</span><span class="ident" id="5575590">Reader</span><span class="op" id="5575596">)</span>&nbsp;<span class="op" id="5575598">(</span><span class="ident" id="5575599">image</span><span class="op" id="5575604">.</span><span class="ident" id="5575605">Image</span><span class="op" id="5575610">,</span>&nbsp;<span class="builtintype" id="5575612">error</span><span class="op" id="5575617">)</span>&nbsp;<span class="op" id="5575619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5575622">d</span>&nbsp;<span class="op" id="5575624">:=</span>&nbsp;<span class="op" id="5575627">&amp;</span><span class="ident" id="5575628">decoder</span><span class="op" id="5575635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5575639">r</span><span class="op" id="5575640">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5575644">r</span><span class="op" id="5575645">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5575649">crc</span><span class="op" id="5575652">:</span>&nbsp;<span class="ident" id="5575654">crc32</span><span class="op" id="5575659">.</span><span class="ident" id="5575660">NewIEEE</span><span class="op" id="5575667">(</span><span class="op" id="5575668">)</span><span class="op" id="5575669">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5575672">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5575675">if</span>&nbsp;<span class="ident" id="5575678">err</span>&nbsp;<span class="op" id="5575682">:=</span>&nbsp;<span class="ident" id="5575685">d</span><span class="op" id="5575686">.</span><span class="ident" id="5575687">checkHeader</span><span class="op" id="5575698">(</span><span class="op" id="5575699">)</span><span class="op" id="5575700">;</span>&nbsp;<span class="ident" id="5575702">err</span>&nbsp;<span class="op" id="5575706">!=</span>&nbsp;<span class="ident" id="5575709">nil</span>&nbsp;<span class="op" id="5575713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5575717">if</span>&nbsp;<span class="ident" id="5575720">err</span>&nbsp;<span class="op" id="5575724">==</span>&nbsp;<span class="ident" id="5575727">io</span><span class="op" id="5575729">.</span><span class="ident" id="5575730">EOF</span>&nbsp;<span class="op" id="5575734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5575739">err</span>&nbsp;<span class="op" id="5575743">=</span>&nbsp;<span class="ident" id="5575745">io</span><span class="op" id="5575747">.</span><span class="ident" id="5575748">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5575767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5575771">return</span>&nbsp;<span class="ident" id="5575778">nil</span><span class="op" id="5575781">,</span>&nbsp;<span class="ident" id="5575783">err</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5575788">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5575791">for</span>&nbsp;<span class="ident" id="5575795">d</span><span class="op" id="5575796">.</span><span class="ident" id="5575797">stage</span>&nbsp;<span class="op" id="5575803">!=</span>&nbsp;<span class="ident" id="5575806">dsSeenIEND</span>&nbsp;<span class="op" id="5575817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5575821">if</span>&nbsp;<span class="ident" id="5575824">err</span>&nbsp;<span class="op" id="5575828">:=</span>&nbsp;<span class="ident" id="5575831">d</span><span class="op" id="5575832">.</span><span class="ident" id="5575833">parseChunk</span><span class="op" id="5575843">(</span><span class="op" id="5575844">)</span><span class="op" id="5575845">;</span>&nbsp;<span class="ident" id="5575847">err</span>&nbsp;<span class="op" id="5575851">!=</span>&nbsp;<span class="ident" id="5575854">nil</span>&nbsp;<span class="op" id="5575858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5575863">if</span>&nbsp;<span class="ident" id="5575866">err</span>&nbsp;<span class="op" id="5575870">==</span>&nbsp;<span class="ident" id="5575873">io</span><span class="op" id="5575875">.</span><span class="ident" id="5575876">EOF</span>&nbsp;<span class="op" id="5575880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5575886">err</span>&nbsp;<span class="op" id="5575890">=</span>&nbsp;<span class="ident" id="5575892">io</span><span class="op" id="5575894">.</span><span class="ident" id="5575895">ErrUnexpectedEOF</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5575915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5575920">return</span>&nbsp;<span class="ident" id="5575927">nil</span><span class="op" id="5575930">,</span>&nbsp;<span class="ident" id="5575932">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5575938">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5575941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5575944">return</span>&nbsp;<span class="ident" id="5575951">d</span><span class="op" id="5575952">.</span><span class="ident" id="5575953">img</span><span class="op" id="5575956">,</span>&nbsp;<span class="ident" id="5575958">nil</span><br>
<span class="lineno">760</span><span class="op" id="5575962">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5575965">//&nbsp;DecodeConfig&nbsp;returns&nbsp;the&nbsp;color&nbsp;model&nbsp;and&nbsp;dimensions&nbsp;of&nbsp;a&nbsp;PNG&nbsp;image&nbsp;without</span><br>
<span class="lineno"></span><span class="comment" id="5576043">//&nbsp;decoding&nbsp;the&nbsp;entire&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5576073">func</span>&nbsp;<span class="ident" id="5576078">DecodeConfig</span><span class="op" id="5576090">(</span><span class="ident" id="5576091">r</span>&nbsp;<span class="ident" id="5576093">io</span><span class="op" id="5576095">.</span><span class="ident" id="5576096">Reader</span><span class="op" id="5576102">)</span>&nbsp;<span class="op" id="5576104">(</span><span class="ident" id="5576105">image</span><span class="op" id="5576110">.</span><span class="ident" id="5576111">Config</span><span class="op" id="5576117">,</span>&nbsp;<span class="builtintype" id="5576119">error</span><span class="op" id="5576124">)</span>&nbsp;<span class="op" id="5576126">{</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5576129">d</span>&nbsp;<span class="op" id="5576131">:=</span>&nbsp;<span class="op" id="5576134">&amp;</span><span class="ident" id="5576135">decoder</span><span class="op" id="5576142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5576146">r</span><span class="op" id="5576147">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5576151">r</span><span class="op" id="5576152">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5576156">crc</span><span class="op" id="5576159">:</span>&nbsp;<span class="ident" id="5576161">crc32</span><span class="op" id="5576166">.</span><span class="ident" id="5576167">NewIEEE</span><span class="op" id="5576174">(</span><span class="op" id="5576175">)</span><span class="op" id="5576176">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5576179">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5576182">if</span>&nbsp;<span class="ident" id="5576185">err</span>&nbsp;<span class="op" id="5576189">:=</span>&nbsp;<span class="ident" id="5576192">d</span><span class="op" id="5576193">.</span><span class="ident" id="5576194">checkHeader</span><span class="op" id="5576205">(</span><span class="op" id="5576206">)</span><span class="op" id="5576207">;</span>&nbsp;<span class="ident" id="5576209">err</span>&nbsp;<span class="op" id="5576213">!=</span>&nbsp;<span class="ident" id="5576216">nil</span>&nbsp;<span class="op" id="5576220">{</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5576224">if</span>&nbsp;<span class="ident" id="5576227">err</span>&nbsp;<span class="op" id="5576231">==</span>&nbsp;<span class="ident" id="5576234">io</span><span class="op" id="5576236">.</span><span class="ident" id="5576237">EOF</span>&nbsp;<span class="op" id="5576241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5576246">err</span>&nbsp;<span class="op" id="5576250">=</span>&nbsp;<span class="ident" id="5576252">io</span><span class="op" id="5576254">.</span><span class="ident" id="5576255">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5576274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5576278">return</span>&nbsp;<span class="ident" id="5576285">image</span><span class="op" id="5576290">.</span><span class="ident" id="5576291">Config</span><span class="op" id="5576297">{</span><span class="op" id="5576298">}</span><span class="op" id="5576299">,</span>&nbsp;<span class="ident" id="5576301">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5576306">}</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5576309">for</span>&nbsp;<span class="op" id="5576313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5576317">if</span>&nbsp;<span class="ident" id="5576320">err</span>&nbsp;<span class="op" id="5576324">:=</span>&nbsp;<span class="ident" id="5576327">d</span><span class="op" id="5576328">.</span><span class="ident" id="5576329">parseChunk</span><span class="op" id="5576339">(</span><span class="op" id="5576340">)</span><span class="op" id="5576341">;</span>&nbsp;<span class="ident" id="5576343">err</span>&nbsp;<span class="op" id="5576347">!=</span>&nbsp;<span class="ident" id="5576350">nil</span>&nbsp;<span class="op" id="5576354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5576359">if</span>&nbsp;<span class="ident" id="5576362">err</span>&nbsp;<span class="op" id="5576366">==</span>&nbsp;<span class="ident" id="5576369">io</span><span class="op" id="5576371">.</span><span class="ident" id="5576372">EOF</span>&nbsp;<span class="op" id="5576376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5576382">err</span>&nbsp;<span class="op" id="5576386">=</span>&nbsp;<span class="ident" id="5576388">io</span><span class="op" id="5576390">.</span><span class="ident" id="5576391">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5576411">}</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5576416">return</span>&nbsp;<span class="ident" id="5576423">image</span><span class="op" id="5576428">.</span><span class="ident" id="5576429">Config</span><span class="op" id="5576435">{</span><span class="op" id="5576436">}</span><span class="op" id="5576437">,</span>&nbsp;<span class="ident" id="5576439">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5576445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5576449">paletted</span>&nbsp;<span class="op" id="5576458">:=</span>&nbsp;<span class="ident" id="5576461">d</span><span class="op" id="5576462">.</span><span class="ident" id="5576463">cb</span>&nbsp;<span class="op" id="5576466">==</span>&nbsp;<span class="ident" id="5576469">cbP8</span>&nbsp;<span class="op" id="5576474">||</span>&nbsp;<span class="ident" id="5576477">d</span><span class="op" id="5576478">.</span><span class="ident" id="5576479">cb</span>&nbsp;<span class="op" id="5576482">==</span>&nbsp;<span class="ident" id="5576485">cbP4</span>&nbsp;<span class="op" id="5576490">||</span>&nbsp;<span class="ident" id="5576493">d</span><span class="op" id="5576494">.</span><span class="ident" id="5576495">cb</span>&nbsp;<span class="op" id="5576498">==</span>&nbsp;<span class="ident" id="5576501">cbP2</span>&nbsp;<span class="op" id="5576506">||</span>&nbsp;<span class="ident" id="5576509">d</span><span class="op" id="5576510">.</span><span class="ident" id="5576511">cb</span>&nbsp;<span class="op" id="5576514">==</span>&nbsp;<span class="ident" id="5576517">cbP1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5576524">if</span>&nbsp;<span class="ident" id="5576527">d</span><span class="op" id="5576528">.</span><span class="ident" id="5576529">stage</span>&nbsp;<span class="op" id="5576535">==</span>&nbsp;<span class="ident" id="5576538">dsSeenIHDR</span>&nbsp;<span class="op" id="5576549">&amp;&amp;</span>&nbsp;<span class="op" id="5576552">!</span><span class="ident" id="5576553">paletted</span>&nbsp;<span class="op" id="5576562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5576567">break</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5576575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5576579">if</span>&nbsp;<span class="ident" id="5576582">d</span><span class="op" id="5576583">.</span><span class="ident" id="5576584">stage</span>&nbsp;<span class="op" id="5576590">==</span>&nbsp;<span class="ident" id="5576593">dsSeenPLTE</span>&nbsp;<span class="op" id="5576604">&amp;&amp;</span>&nbsp;<span class="ident" id="5576607">paletted</span>&nbsp;<span class="op" id="5576616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5576621">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5576629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5576632">}</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5576635">var</span>&nbsp;<span class="ident" id="5576639">cm</span>&nbsp;<span class="ident" id="5576642">color</span><span class="op" id="5576647">.</span><span class="ident" id="5576648">Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5576655">switch</span>&nbsp;<span class="ident" id="5576662">d</span><span class="op" id="5576663">.</span><span class="ident" id="5576664">cb</span>&nbsp;<span class="op" id="5576667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5576670">case</span>&nbsp;<span class="ident" id="5576675">cbG1</span><span class="op" id="5576679">,</span>&nbsp;<span class="ident" id="5576681">cbG2</span><span class="op" id="5576685">,</span>&nbsp;<span class="ident" id="5576687">cbG4</span><span class="op" id="5576691">,</span>&nbsp;<span class="ident" id="5576693">cbG8</span><span class="op" id="5576697">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5576701">cm</span>&nbsp;<span class="op" id="5576704">=</span>&nbsp;<span class="ident" id="5576706">color</span><span class="op" id="5576711">.</span><span class="ident" id="5576712">GrayModel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5576723">case</span>&nbsp;<span class="ident" id="5576728">cbGA8</span><span class="op" id="5576733">:</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5576737">cm</span>&nbsp;<span class="op" id="5576740">=</span>&nbsp;<span class="ident" id="5576742">color</span><span class="op" id="5576747">.</span><span class="ident" id="5576748">NRGBAModel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5576760">case</span>&nbsp;<span class="ident" id="5576765">cbTC8</span><span class="op" id="5576770">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5576774">cm</span>&nbsp;<span class="op" id="5576777">=</span>&nbsp;<span class="ident" id="5576779">color</span><span class="op" id="5576784">.</span><span class="ident" id="5576785">RGBAModel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5576796">case</span>&nbsp;<span class="ident" id="5576801">cbP1</span><span class="op" id="5576805">,</span>&nbsp;<span class="ident" id="5576807">cbP2</span><span class="op" id="5576811">,</span>&nbsp;<span class="ident" id="5576813">cbP4</span><span class="op" id="5576817">,</span>&nbsp;<span class="ident" id="5576819">cbP8</span><span class="op" id="5576823">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5576827">cm</span>&nbsp;<span class="op" id="5576830">=</span>&nbsp;<span class="ident" id="5576832">d</span><span class="op" id="5576833">.</span><span class="ident" id="5576834">palette</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5576843">case</span>&nbsp;<span class="ident" id="5576848">cbTCA8</span><span class="op" id="5576854">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5576858">cm</span>&nbsp;<span class="op" id="5576861">=</span>&nbsp;<span class="ident" id="5576863">color</span><span class="op" id="5576868">.</span><span class="ident" id="5576869">NRGBAModel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5576881">case</span>&nbsp;<span class="ident" id="5576886">cbG16</span><span class="op" id="5576891">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5576895">cm</span>&nbsp;<span class="op" id="5576898">=</span>&nbsp;<span class="ident" id="5576900">color</span><span class="op" id="5576905">.</span><span class="ident" id="5576906">Gray16Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5576919">case</span>&nbsp;<span class="ident" id="5576924">cbGA16</span><span class="op" id="5576930">:</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5576934">cm</span>&nbsp;<span class="op" id="5576937">=</span>&nbsp;<span class="ident" id="5576939">color</span><span class="op" id="5576944">.</span><span class="ident" id="5576945">NRGBA64Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5576959">case</span>&nbsp;<span class="ident" id="5576964">cbTC16</span><span class="op" id="5576970">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5576974">cm</span>&nbsp;<span class="op" id="5576977">=</span>&nbsp;<span class="ident" id="5576979">color</span><span class="op" id="5576984">.</span><span class="ident" id="5576985">RGBA64Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5576998">case</span>&nbsp;<span class="ident" id="5577003">cbTCA16</span><span class="op" id="5577010">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5577014">cm</span>&nbsp;<span class="op" id="5577017">=</span>&nbsp;<span class="ident" id="5577019">color</span><span class="op" id="5577024">.</span><span class="ident" id="5577025">NRGBA64Model</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5577039">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5577042">return</span>&nbsp;<span class="ident" id="5577049">image</span><span class="op" id="5577054">.</span><span class="ident" id="5577055">Config</span><span class="op" id="5577061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5577065">ColorModel</span><span class="op" id="5577075">:</span>&nbsp;<span class="ident" id="5577077">cm</span><span class="op" id="5577079">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5577083">Width</span><span class="op" id="5577088">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5577095">d</span><span class="op" id="5577096">.</span><span class="ident" id="5577097">width</span><span class="op" id="5577102">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5577106">Height</span><span class="op" id="5577112">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5577118">d</span><span class="op" id="5577119">.</span><span class="ident" id="5577120">height</span><span class="op" id="5577126">,</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5577129">}</span><span class="op" id="5577130">,</span>&nbsp;<span class="ident" id="5577132">nil</span><br>
<span class="lineno"></span><span class="op" id="5577136">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5577139">func</span>&nbsp;<span class="ident" id="5577144">init</span><span class="op" id="5577148">(</span><span class="op" id="5577149">)</span>&nbsp;<span class="op" id="5577151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5577154">image</span><span class="op" id="5577159">.</span><span class="ident" id="5577160">RegisterFormat</span><span class="op" id="5577174">(</span><span class="string" id="5577175">&#34;png&#34;</span><span class="op" id="5577180">,</span>&nbsp;<span class="ident" id="5577182">pngHeader</span><span class="op" id="5577191">,</span>&nbsp;<span class="ident" id="5577193">Decode</span><span class="op" id="5577199">,</span>&nbsp;<span class="ident" id="5577201">DecodeConfig</span><span class="op" id="5577213">)</span><br>
<span class="lineno">820</span><span class="op" id="5577215">}</span>
</div>
</body>
</html>
