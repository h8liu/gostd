<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4815285">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4815341">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4815395">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4815446">//&nbsp;Package&nbsp;pprof&nbsp;serves&nbsp;via&nbsp;its&nbsp;HTTP&nbsp;server&nbsp;runtime&nbsp;profiling&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="4815513">//&nbsp;in&nbsp;the&nbsp;format&nbsp;expected&nbsp;by&nbsp;the&nbsp;pprof&nbsp;visualization&nbsp;tool.</span><br>
<span class="lineno"></span><span class="comment" id="4815572">//&nbsp;For&nbsp;more&nbsp;information&nbsp;about&nbsp;pprof,&nbsp;see</span><br>
<span class="lineno"></span><span class="comment" id="4815613">//&nbsp;http://code.google.com/p/google-perftools/.</span><br>
<span class="lineno"></span><span class="comment" id="4815660">//</span><br>
<span class="lineno">10</span><span class="comment" id="4815663">//&nbsp;The&nbsp;package&nbsp;is&nbsp;typically&nbsp;only&nbsp;imported&nbsp;for&nbsp;the&nbsp;side&nbsp;effect&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4815728">//&nbsp;registering&nbsp;its&nbsp;HTTP&nbsp;handlers.</span><br>
<span class="lineno"></span><span class="comment" id="4815762">//&nbsp;The&nbsp;handled&nbsp;paths&nbsp;all&nbsp;begin&nbsp;with&nbsp;/debug/pprof/.</span><br>
<span class="lineno"></span><span class="comment" id="4815813">//</span><br>
<span class="lineno"></span><span class="comment" id="4815816">//&nbsp;To&nbsp;use&nbsp;pprof,&nbsp;link&nbsp;this&nbsp;package&nbsp;into&nbsp;your&nbsp;program:</span><br>
<span class="lineno">15</span><span class="comment" id="4815870">//&nbsp;&nbsp;&nbsp;&nbspimport&nbsp;_&nbsp;&#34;net/http/pprof&#34;</span><br>
<span class="lineno"></span><span class="comment" id="4815899">//</span><br>
<span class="lineno"></span><span class="comment" id="4815902">//&nbsp;If&nbsp;your&nbsp;application&nbsp;is&nbsp;not&nbsp;already&nbsp;running&nbsp;an&nbsp;http&nbsp;server,&nbsp;you</span><br>
<span class="lineno"></span><span class="comment" id="4815968">//&nbsp;need&nbsp;to&nbsp;start&nbsp;one.&nbsp;&nbsp;Add&nbsp;&#34;net/http&#34;&nbsp;and&nbsp;&#34;log&#34;&nbsp;to&nbsp;your&nbsp;imports&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4816036">//&nbsp;the&nbsp;following&nbsp;code&nbsp;to&nbsp;your&nbsp;main&nbsp;function:</span><br>
<span class="lineno">20</span><span class="comment" id="4816081">//</span><br>
<span class="lineno"></span><span class="comment" id="4816084">//&nbsp;&nbsp;&nbsp;&nbsp;&nbspgo&nbsp;func()&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="4816100">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsplog.Println(http.ListenAndServe(&#34;localhost:6060&#34;,&nbsp;nil))</span><br>
<span class="lineno"></span><span class="comment" id="4816161">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp}()</span><br>
<span class="lineno"></span><span class="comment" id="4816169">//</span><br>
<span class="lineno">25</span><span class="comment" id="4816172">//&nbsp;Then&nbsp;use&nbsp;the&nbsp;pprof&nbsp;tool&nbsp;to&nbsp;look&nbsp;at&nbsp;the&nbsp;heap&nbsp;profile:</span><br>
<span class="lineno"></span><span class="comment" id="4816228">//</span><br>
<span class="lineno"></span><span class="comment" id="4816231">//&nbsp;&nbsp;&nbsp;&nbspgo&nbsp;tool&nbsp;pprof&nbsp;http://localhost:6060/debug/pprof/heap</span><br>
<span class="lineno"></span><span class="comment" id="4816287">//</span><br>
<span class="lineno"></span><span class="comment" id="4816290">//&nbsp;Or&nbsp;to&nbsp;look&nbsp;at&nbsp;a&nbsp;30-second&nbsp;CPU&nbsp;profile:</span><br>
<span class="lineno">30</span><span class="comment" id="4816332">//</span><br>
<span class="lineno"></span><span class="comment" id="4816335">//&nbsp;&nbsp;&nbsp;&nbspgo&nbsp;tool&nbsp;pprof&nbsp;http://localhost:6060/debug/pprof/profile</span><br>
<span class="lineno"></span><span class="comment" id="4816394">//</span><br>
<span class="lineno"></span><span class="comment" id="4816397">//&nbsp;Or&nbsp;to&nbsp;look&nbsp;at&nbsp;the&nbsp;goroutine&nbsp;blocking&nbsp;profile:</span><br>
<span class="lineno"></span><span class="comment" id="4816446">//</span><br>
<span class="lineno">35</span><span class="comment" id="4816449">//&nbsp;&nbsp;&nbsp;&nbspgo&nbsp;tool&nbsp;pprof&nbsp;http://localhost:6060/debug/pprof/block</span><br>
<span class="lineno"></span><span class="comment" id="4816506">//</span><br>
<span class="lineno"></span><span class="comment" id="4816509">//&nbsp;To&nbsp;view&nbsp;all&nbsp;available&nbsp;profiles,&nbsp;open&nbsp;http://localhost:6060/debug/pprof/</span><br>
<span class="lineno"></span><span class="comment" id="4816584">//&nbsp;in&nbsp;your&nbsp;browser.</span><br>
<span class="lineno"></span><span class="comment" id="4816604">//</span><br>
<span class="lineno">40</span><span class="comment" id="4816607">//&nbsp;For&nbsp;a&nbsp;study&nbsp;of&nbsp;the&nbsp;facility&nbsp;in&nbsp;action,&nbsp;visit</span><br>
<span class="lineno"></span><span class="comment" id="4816655">//</span><br>
<span class="lineno"></span><span class="comment" id="4816658">//&nbsp;&nbsp;&nbsp;&nbsphttp://blog.golang.org/2011/06/profiling-go-programs.html</span><br>
<span class="lineno"></span><span class="comment" id="4816719">//</span><br>
<span class="lineno"></span><span class="keyword" id="4816722">package</span>&nbsp;<span class="ident" id="4816730">pprof</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="4816737">import</span>&nbsp;<span class="op" id="4816744">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4816747">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4816756">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4816765">&#34;fmt&#34;</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4816772">&#34;html/template&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4816789">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4816795">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4816802">&#34;net/http&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4816814">&#34;os&#34;</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4816820">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4816831">&#34;runtime/pprof&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4816848">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4816859">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4816870">&#34;time&#34;</span><br>
<span class="lineno">60</span><span class="op" id="4816877">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4816880">func</span>&nbsp;<span class="ident" id="4816885">init</span><span class="op" id="4816889">(</span><span class="op" id="4816890">)</span>&nbsp;<span class="op" id="4816892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4816895">http</span><span class="op" id="4816899">.</span><span class="ident" id="4816900">Handle</span><span class="op" id="4816906">(</span><span class="string" id="4816907">&#34;/debug/pprof/&#34;</span><span class="op" id="4816922">,</span>&nbsp;<span class="ident" id="4816924">http</span><span class="op" id="4816928">.</span><span class="ident" id="4816929">HandlerFunc</span><span class="op" id="4816940">(</span><span class="ident" id="4816941">Index</span><span class="op" id="4816946">)</span><span class="op" id="4816947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4816950">http</span><span class="op" id="4816954">.</span><span class="ident" id="4816955">Handle</span><span class="op" id="4816961">(</span><span class="string" id="4816962">&#34;/debug/pprof/cmdline&#34;</span><span class="op" id="4816984">,</span>&nbsp;<span class="ident" id="4816986">http</span><span class="op" id="4816990">.</span><span class="ident" id="4816991">HandlerFunc</span><span class="op" id="4817002">(</span><span class="ident" id="4817003">Cmdline</span><span class="op" id="4817010">)</span><span class="op" id="4817011">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4817014">http</span><span class="op" id="4817018">.</span><span class="ident" id="4817019">Handle</span><span class="op" id="4817025">(</span><span class="string" id="4817026">&#34;/debug/pprof/profile&#34;</span><span class="op" id="4817048">,</span>&nbsp;<span class="ident" id="4817050">http</span><span class="op" id="4817054">.</span><span class="ident" id="4817055">HandlerFunc</span><span class="op" id="4817066">(</span><span class="ident" id="4817067">Profile</span><span class="op" id="4817074">)</span><span class="op" id="4817075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4817078">http</span><span class="op" id="4817082">.</span><span class="ident" id="4817083">Handle</span><span class="op" id="4817089">(</span><span class="string" id="4817090">&#34;/debug/pprof/symbol&#34;</span><span class="op" id="4817111">,</span>&nbsp;<span class="ident" id="4817113">http</span><span class="op" id="4817117">.</span><span class="ident" id="4817118">HandlerFunc</span><span class="op" id="4817129">(</span><span class="ident" id="4817130">Symbol</span><span class="op" id="4817136">)</span><span class="op" id="4817137">)</span><br>
<span class="lineno"></span><span class="op" id="4817139">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4817142">//&nbsp;Cmdline&nbsp;responds&nbsp;with&nbsp;the&nbsp;running&nbsp;program&#39;s</span><br>
<span class="lineno">70</span><span class="comment" id="4817189">//&nbsp;command&nbsp;line,&nbsp;with&nbsp;arguments&nbsp;separated&nbsp;by&nbsp;NUL&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="comment" id="4817245">//&nbsp;The&nbsp;package&nbsp;initialization&nbsp;registers&nbsp;it&nbsp;as&nbsp;/debug/pprof/cmdline.</span><br>
<span class="lineno"></span><span class="keyword" id="4817313">func</span>&nbsp;<span class="ident" id="4817318">Cmdline</span><span class="op" id="4817325">(</span><span class="ident" id="4817326">w</span>&nbsp;<span class="ident" id="4817328">http</span><span class="op" id="4817332">.</span><span class="ident" id="4817333">ResponseWriter</span><span class="op" id="4817347">,</span>&nbsp;<span class="ident" id="4817349">r</span>&nbsp;<span class="op" id="4817351">*</span><span class="ident" id="4817352">http</span><span class="op" id="4817356">.</span><span class="ident" id="4817357">Request</span><span class="op" id="4817364">)</span>&nbsp;<span class="op" id="4817366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4817369">w</span><span class="op" id="4817370">.</span><span class="ident" id="4817371">Header</span><span class="op" id="4817377">(</span><span class="op" id="4817378">)</span><span class="op" id="4817379">.</span><span class="ident" id="4817380">Set</span><span class="op" id="4817383">(</span><span class="string" id="4817384">&#34;Content-Type&#34;</span><span class="op" id="4817398">,</span>&nbsp;<span class="string" id="4817400">&#34;text/plain;&nbsp;charset=utf-8&#34;</span><span class="op" id="4817427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4817430">fmt</span><span class="op" id="4817433">.</span><span class="ident" id="4817434">Fprintf</span><span class="op" id="4817441">(</span><span class="ident" id="4817442">w</span><span class="op" id="4817443">,</span>&nbsp;<span class="ident" id="4817445">strings</span><span class="op" id="4817452">.</span><span class="ident" id="4817453">Join</span><span class="op" id="4817457">(</span><span class="ident" id="4817458">os</span><span class="op" id="4817460">.</span><span class="ident" id="4817461">Args</span><span class="op" id="4817465">,</span>&nbsp;<span class="string" id="4817467">&#34;\x00&#34;</span><span class="op" id="4817473">)</span><span class="op" id="4817474">)</span><br>
<span class="lineno">75</span><span class="op" id="4817476">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4817479">//&nbsp;Profile&nbsp;responds&nbsp;with&nbsp;the&nbsp;pprof-formatted&nbsp;cpu&nbsp;profile.</span><br>
<span class="lineno"></span><span class="comment" id="4817537">//&nbsp;The&nbsp;package&nbsp;initialization&nbsp;registers&nbsp;it&nbsp;as&nbsp;/debug/pprof/profile.</span><br>
<span class="lineno"></span><span class="keyword" id="4817605">func</span>&nbsp;<span class="ident" id="4817610">Profile</span><span class="op" id="4817617">(</span><span class="ident" id="4817618">w</span>&nbsp;<span class="ident" id="4817620">http</span><span class="op" id="4817624">.</span><span class="ident" id="4817625">ResponseWriter</span><span class="op" id="4817639">,</span>&nbsp;<span class="ident" id="4817641">r</span>&nbsp;<span class="op" id="4817643">*</span><span class="ident" id="4817644">http</span><span class="op" id="4817648">.</span><span class="ident" id="4817649">Request</span><span class="op" id="4817656">)</span>&nbsp;<span class="op" id="4817658">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4817661">sec</span><span class="op" id="4817664">,</span>&nbsp;<span class="ident" id="4817666">_</span>&nbsp;<span class="op" id="4817668">:=</span>&nbsp;<span class="ident" id="4817671">strconv</span><span class="op" id="4817678">.</span><span class="ident" id="4817679">ParseInt</span><span class="op" id="4817687">(</span><span class="ident" id="4817688">r</span><span class="op" id="4817689">.</span><span class="ident" id="4817690">FormValue</span><span class="op" id="4817699">(</span><span class="string" id="4817700">&#34;seconds&#34;</span><span class="op" id="4817709">)</span><span class="op" id="4817710">,</span>&nbsp;<span class="num" id="4817712">10</span><span class="op" id="4817714">,</span>&nbsp;<span class="num" id="4817716">64</span><span class="op" id="4817718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4817721">if</span>&nbsp;<span class="ident" id="4817724">sec</span>&nbsp;<span class="op" id="4817728">==</span>&nbsp;<span class="num" id="4817731">0</span>&nbsp;<span class="op" id="4817733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4817737">sec</span>&nbsp;<span class="op" id="4817741">=</span>&nbsp;<span class="num" id="4817743">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4817747">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4817751">//&nbsp;Set&nbsp;Content&nbsp;Type&nbsp;assuming&nbsp;StartCPUProfile&nbsp;will&nbsp;work,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4817808">//&nbsp;because&nbsp;if&nbsp;it&nbsp;does&nbsp;it&nbsp;starts&nbsp;writing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4817850">w</span><span class="op" id="4817851">.</span><span class="ident" id="4817852">Header</span><span class="op" id="4817858">(</span><span class="op" id="4817859">)</span><span class="op" id="4817860">.</span><span class="ident" id="4817861">Set</span><span class="op" id="4817864">(</span><span class="string" id="4817865">&#34;Content-Type&#34;</span><span class="op" id="4817879">,</span>&nbsp;<span class="string" id="4817881">&#34;application/octet-stream&#34;</span><span class="op" id="4817907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4817910">if</span>&nbsp;<span class="ident" id="4817913">err</span>&nbsp;<span class="op" id="4817917">:=</span>&nbsp;<span class="ident" id="4817920">pprof</span><span class="op" id="4817925">.</span><span class="ident" id="4817926">StartCPUProfile</span><span class="op" id="4817941">(</span><span class="ident" id="4817942">w</span><span class="op" id="4817943">)</span><span class="op" id="4817944">;</span>&nbsp;<span class="ident" id="4817946">err</span>&nbsp;<span class="op" id="4817950">!=</span>&nbsp;<span class="ident" id="4817953">nil</span>&nbsp;<span class="op" id="4817957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4817961">//&nbsp;StartCPUProfile&nbsp;failed,&nbsp;so&nbsp;no&nbsp;writes&nbsp;yet.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4818008">//&nbsp;Can&nbsp;change&nbsp;header&nbsp;back&nbsp;to&nbsp;text&nbsp;content</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4818052">//&nbsp;and&nbsp;send&nbsp;error&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4818078">w</span><span class="op" id="4818079">.</span><span class="ident" id="4818080">Header</span><span class="op" id="4818086">(</span><span class="op" id="4818087">)</span><span class="op" id="4818088">.</span><span class="ident" id="4818089">Set</span><span class="op" id="4818092">(</span><span class="string" id="4818093">&#34;Content-Type&#34;</span><span class="op" id="4818107">,</span>&nbsp;<span class="string" id="4818109">&#34;text/plain;&nbsp;charset=utf-8&#34;</span><span class="op" id="4818136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4818140">w</span><span class="op" id="4818141">.</span><span class="ident" id="4818142">WriteHeader</span><span class="op" id="4818153">(</span><span class="ident" id="4818154">http</span><span class="op" id="4818158">.</span><span class="ident" id="4818159">StatusInternalServerError</span><span class="op" id="4818184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4818188">fmt</span><span class="op" id="4818191">.</span><span class="ident" id="4818192">Fprintf</span><span class="op" id="4818199">(</span><span class="ident" id="4818200">w</span><span class="op" id="4818201">,</span>&nbsp;<span class="string" id="4818203">&#34;Could&nbsp;not&nbsp;enable&nbsp;CPU&nbsp;profiling:&nbsp;%s\n&#34;</span><span class="op" id="4818241">,</span>&nbsp;<span class="ident" id="4818243">err</span><span class="op" id="4818246">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4818250">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4818258">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4818261">time</span><span class="op" id="4818265">.</span><span class="ident" id="4818266">Sleep</span><span class="op" id="4818271">(</span><span class="ident" id="4818272">time</span><span class="op" id="4818276">.</span><span class="ident" id="4818277">Duration</span><span class="op" id="4818285">(</span><span class="ident" id="4818286">sec</span><span class="op" id="4818289">)</span>&nbsp;<span class="op" id="4818291">*</span>&nbsp;<span class="ident" id="4818293">time</span><span class="op" id="4818297">.</span><span class="ident" id="4818298">Second</span><span class="op" id="4818304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4818307">pprof</span><span class="op" id="4818312">.</span><span class="ident" id="4818313">StopCPUProfile</span><span class="op" id="4818327">(</span><span class="op" id="4818328">)</span><br>
<span class="lineno"></span><span class="op" id="4818330">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="comment" id="4818333">//&nbsp;Symbol&nbsp;looks&nbsp;up&nbsp;the&nbsp;program&nbsp;counters&nbsp;listed&nbsp;in&nbsp;the&nbsp;request,</span><br>
<span class="lineno"></span><span class="comment" id="4818396">//&nbsp;responding&nbsp;with&nbsp;a&nbsp;table&nbsp;mapping&nbsp;program&nbsp;counters&nbsp;to&nbsp;function&nbsp;names.</span><br>
<span class="lineno"></span><span class="comment" id="4818467">//&nbsp;The&nbsp;package&nbsp;initialization&nbsp;registers&nbsp;it&nbsp;as&nbsp;/debug/pprof/symbol.</span><br>
<span class="lineno"></span><span class="keyword" id="4818534">func</span>&nbsp;<span class="ident" id="4818539">Symbol</span><span class="op" id="4818545">(</span><span class="ident" id="4818546">w</span>&nbsp;<span class="ident" id="4818548">http</span><span class="op" id="4818552">.</span><span class="ident" id="4818553">ResponseWriter</span><span class="op" id="4818567">,</span>&nbsp;<span class="ident" id="4818569">r</span>&nbsp;<span class="op" id="4818571">*</span><span class="ident" id="4818572">http</span><span class="op" id="4818576">.</span><span class="ident" id="4818577">Request</span><span class="op" id="4818584">)</span>&nbsp;<span class="op" id="4818586">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4818589">w</span><span class="op" id="4818590">.</span><span class="ident" id="4818591">Header</span><span class="op" id="4818597">(</span><span class="op" id="4818598">)</span><span class="op" id="4818599">.</span><span class="ident" id="4818600">Set</span><span class="op" id="4818603">(</span><span class="string" id="4818604">&#34;Content-Type&#34;</span><span class="op" id="4818618">,</span>&nbsp;<span class="string" id="4818620">&#34;text/plain;&nbsp;charset=utf-8&#34;</span><span class="op" id="4818647">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4818651">//&nbsp;We&nbsp;have&nbsp;to&nbsp;read&nbsp;the&nbsp;whole&nbsp;POST&nbsp;body&nbsp;before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4818698">//&nbsp;writing&nbsp;any&nbsp;output.&nbsp;&nbsp;Buffer&nbsp;the&nbsp;output&nbsp;here.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4818747">var</span>&nbsp;<span class="ident" id="4818751">buf</span>&nbsp;<span class="ident" id="4818755">bytes</span><span class="op" id="4818760">.</span><span class="ident" id="4818761">Buffer</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4818770">//&nbsp;We&nbsp;don&#39;t&nbsp;know&nbsp;how&nbsp;many&nbsp;symbols&nbsp;we&nbsp;have,&nbsp;but&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4818821">//&nbsp;do&nbsp;have&nbsp;symbol&nbsp;information.&nbsp;&nbsp;Pprof&nbsp;only&nbsp;cares&nbsp;whether</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4818879">//&nbsp;this&nbsp;number&nbsp;is&nbsp;0&nbsp;(no&nbsp;symbols&nbsp;available)&nbsp;or&nbsp;&gt;&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4818931">fmt</span><span class="op" id="4818934">.</span><span class="ident" id="4818935">Fprintf</span><span class="op" id="4818942">(</span><span class="op" id="4818943">&amp;</span><span class="ident" id="4818944">buf</span><span class="op" id="4818947">,</span>&nbsp;<span class="string" id="4818949">&#34;num_symbols:&nbsp;1\n&#34;</span><span class="op" id="4818967">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4818971">var</span>&nbsp;<span class="ident" id="4818975">b</span>&nbsp;<span class="op" id="4818977">*</span><span class="ident" id="4818978">bufio</span><span class="op" id="4818983">.</span><span class="ident" id="4818984">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4818992">if</span>&nbsp;<span class="ident" id="4818995">r</span><span class="op" id="4818996">.</span><span class="ident" id="4818997">Method</span>&nbsp;<span class="op" id="4819004">==</span>&nbsp;<span class="string" id="4819007">&#34;POST&#34;</span>&nbsp;<span class="op" id="4819014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4819018">b</span>&nbsp;<span class="op" id="4819020">=</span>&nbsp;<span class="ident" id="4819022">bufio</span><span class="op" id="4819027">.</span><span class="ident" id="4819028">NewReader</span><span class="op" id="4819037">(</span><span class="ident" id="4819038">r</span><span class="op" id="4819039">.</span><span class="ident" id="4819040">Body</span><span class="op" id="4819044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4819047">}</span>&nbsp;<span class="keyword" id="4819049">else</span>&nbsp;<span class="op" id="4819054">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4819058">b</span>&nbsp;<span class="op" id="4819060">=</span>&nbsp;<span class="ident" id="4819062">bufio</span><span class="op" id="4819067">.</span><span class="ident" id="4819068">NewReader</span><span class="op" id="4819077">(</span><span class="ident" id="4819078">strings</span><span class="op" id="4819085">.</span><span class="ident" id="4819086">NewReader</span><span class="op" id="4819095">(</span><span class="ident" id="4819096">r</span><span class="op" id="4819097">.</span><span class="ident" id="4819098">URL</span><span class="op" id="4819101">.</span><span class="ident" id="4819102">RawQuery</span><span class="op" id="4819110">)</span><span class="op" id="4819111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4819114">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4819118">for</span>&nbsp;<span class="op" id="4819122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4819126">word</span><span class="op" id="4819130">,</span>&nbsp;<span class="ident" id="4819132">err</span>&nbsp;<span class="op" id="4819136">:=</span>&nbsp;<span class="ident" id="4819139">b</span><span class="op" id="4819140">.</span><span class="ident" id="4819141">ReadSlice</span><span class="op" id="4819150">(</span><span class="string" id="4819151">&#39;+&#39;</span><span class="op" id="4819154">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4819158">if</span>&nbsp;<span class="ident" id="4819161">err</span>&nbsp;<span class="op" id="4819165">==</span>&nbsp;<span class="ident" id="4819168">nil</span>&nbsp;<span class="op" id="4819172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4819177">word</span>&nbsp;<span class="op" id="4819182">=</span>&nbsp;<span class="ident" id="4819184">word</span><span class="op" id="4819188">[</span><span class="num" id="4819189">0</span>&nbsp;<span class="op" id="4819191">:</span>&nbsp;<span class="builtinfunc" id="4819193">len</span><span class="op" id="4819196">(</span><span class="ident" id="4819197">word</span><span class="op" id="4819201">)</span><span class="op" id="4819202">-</span><span class="num" id="4819203">1</span><span class="op" id="4819204">]</span>&nbsp;<span class="comment" id="4819206">//&nbsp;trim&nbsp;+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4819218">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4819222">pc</span><span class="op" id="4819224">,</span>&nbsp;<span class="ident" id="4819226">_</span>&nbsp;<span class="op" id="4819228">:=</span>&nbsp;<span class="ident" id="4819231">strconv</span><span class="op" id="4819238">.</span><span class="ident" id="4819239">ParseUint</span><span class="op" id="4819248">(</span><span class="builtintype" id="4819249">string</span><span class="op" id="4819255">(</span><span class="ident" id="4819256">word</span><span class="op" id="4819260">)</span><span class="op" id="4819261">,</span>&nbsp;<span class="num" id="4819263">0</span><span class="op" id="4819264">,</span>&nbsp;<span class="num" id="4819266">64</span><span class="op" id="4819268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4819272">if</span>&nbsp;<span class="ident" id="4819275">pc</span>&nbsp;<span class="op" id="4819278">!=</span>&nbsp;<span class="num" id="4819281">0</span>&nbsp;<span class="op" id="4819283">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4819288">f</span>&nbsp;<span class="op" id="4819290">:=</span>&nbsp;<span class="ident" id="4819293">runtime</span><span class="op" id="4819300">.</span><span class="ident" id="4819301">FuncForPC</span><span class="op" id="4819310">(</span><span class="builtintype" id="4819311">uintptr</span><span class="op" id="4819318">(</span><span class="ident" id="4819319">pc</span><span class="op" id="4819321">)</span><span class="op" id="4819322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4819327">if</span>&nbsp;<span class="ident" id="4819330">f</span>&nbsp;<span class="op" id="4819332">!=</span>&nbsp;<span class="ident" id="4819335">nil</span>&nbsp;<span class="op" id="4819339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4819345">fmt</span><span class="op" id="4819348">.</span><span class="ident" id="4819349">Fprintf</span><span class="op" id="4819356">(</span><span class="op" id="4819357">&amp;</span><span class="ident" id="4819358">buf</span><span class="op" id="4819361">,</span>&nbsp;<span class="string" id="4819363">&#34;%#x&nbsp;%s\n&#34;</span><span class="op" id="4819373">,</span>&nbsp;<span class="ident" id="4819375">pc</span><span class="op" id="4819377">,</span>&nbsp;<span class="ident" id="4819379">f</span><span class="op" id="4819380">.</span><span class="ident" id="4819381">Name</span><span class="op" id="4819385">(</span><span class="op" id="4819386">)</span><span class="op" id="4819387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4819392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4819396">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4819401">//&nbsp;Wait&nbsp;until&nbsp;here&nbsp;to&nbsp;check&nbsp;for&nbsp;err;&nbsp;the&nbsp;last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4819449">//&nbsp;symbol&nbsp;will&nbsp;have&nbsp;an&nbsp;err&nbsp;because&nbsp;it&nbsp;doesn&#39;t&nbsp;end&nbsp;in&nbsp;+.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4819507">if</span>&nbsp;<span class="ident" id="4819510">err</span>&nbsp;<span class="op" id="4819514">!=</span>&nbsp;<span class="ident" id="4819517">nil</span>&nbsp;<span class="op" id="4819521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4819526">if</span>&nbsp;<span class="ident" id="4819529">err</span>&nbsp;<span class="op" id="4819533">!=</span>&nbsp;<span class="ident" id="4819536">io</span><span class="op" id="4819538">.</span><span class="ident" id="4819539">EOF</span>&nbsp;<span class="op" id="4819543">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4819549">fmt</span><span class="op" id="4819552">.</span><span class="ident" id="4819553">Fprintf</span><span class="op" id="4819560">(</span><span class="op" id="4819561">&amp;</span><span class="ident" id="4819562">buf</span><span class="op" id="4819565">,</span>&nbsp;<span class="string" id="4819567">&#34;reading&nbsp;request:&nbsp;%v\n&#34;</span><span class="op" id="4819590">,</span>&nbsp;<span class="ident" id="4819592">err</span><span class="op" id="4819595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4819600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4819605">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4819613">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4819616">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4819620">w</span><span class="op" id="4819621">.</span><span class="ident" id="4819622">Write</span><span class="op" id="4819627">(</span><span class="ident" id="4819628">buf</span><span class="op" id="4819631">.</span><span class="ident" id="4819632">Bytes</span><span class="op" id="4819637">(</span><span class="op" id="4819638">)</span><span class="op" id="4819639">)</span><br>
<span class="lineno"></span><span class="op" id="4819641">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4819644">//&nbsp;Handler&nbsp;returns&nbsp;an&nbsp;HTTP&nbsp;handler&nbsp;that&nbsp;serves&nbsp;the&nbsp;named&nbsp;profile.</span><br>
<span class="lineno">150</span><span class="keyword" id="4819710">func</span>&nbsp;<span class="ident" id="4819715">Handler</span><span class="op" id="4819722">(</span><span class="ident" id="4819723">name</span>&nbsp;<span class="builtintype" id="4819728">string</span><span class="op" id="4819734">)</span>&nbsp;<span class="ident" id="4819736">http</span><span class="op" id="4819740">.</span><span class="ident" id="4819741">Handler</span>&nbsp;<span class="op" id="4819749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4819752">return</span>&nbsp;<span class="ident" id="4819759">handler</span><span class="op" id="4819766">(</span><span class="ident" id="4819767">name</span><span class="op" id="4819771">)</span><br>
<span class="lineno"></span><span class="op" id="4819773">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4819776">type</span>&nbsp;<span class="ident" id="4819781">handler</span>&nbsp;<span class="builtintype" id="4819789">string</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="keyword" id="4819797">func</span>&nbsp;<span class="op" id="4819802">(</span><span class="ident" id="4819803">name</span>&nbsp;<span class="ident" id="4819808">handler</span><span class="op" id="4819815">)</span>&nbsp;<span class="ident" id="4819817">ServeHTTP</span><span class="op" id="4819826">(</span><span class="ident" id="4819827">w</span>&nbsp;<span class="ident" id="4819829">http</span><span class="op" id="4819833">.</span><span class="ident" id="4819834">ResponseWriter</span><span class="op" id="4819848">,</span>&nbsp;<span class="ident" id="4819850">r</span>&nbsp;<span class="op" id="4819852">*</span><span class="ident" id="4819853">http</span><span class="op" id="4819857">.</span><span class="ident" id="4819858">Request</span><span class="op" id="4819865">)</span>&nbsp;<span class="op" id="4819867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4819870">w</span><span class="op" id="4819871">.</span><span class="ident" id="4819872">Header</span><span class="op" id="4819878">(</span><span class="op" id="4819879">)</span><span class="op" id="4819880">.</span><span class="ident" id="4819881">Set</span><span class="op" id="4819884">(</span><span class="string" id="4819885">&#34;Content-Type&#34;</span><span class="op" id="4819899">,</span>&nbsp;<span class="string" id="4819901">&#34;text/plain;&nbsp;charset=utf-8&#34;</span><span class="op" id="4819928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4819931">debug</span><span class="op" id="4819936">,</span>&nbsp;<span class="ident" id="4819938">_</span>&nbsp;<span class="op" id="4819940">:=</span>&nbsp;<span class="ident" id="4819943">strconv</span><span class="op" id="4819950">.</span><span class="ident" id="4819951">Atoi</span><span class="op" id="4819955">(</span><span class="ident" id="4819956">r</span><span class="op" id="4819957">.</span><span class="ident" id="4819958">FormValue</span><span class="op" id="4819967">(</span><span class="string" id="4819968">&#34;debug&#34;</span><span class="op" id="4819975">)</span><span class="op" id="4819976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4819979">p</span>&nbsp;<span class="op" id="4819981">:=</span>&nbsp;<span class="ident" id="4819984">pprof</span><span class="op" id="4819989">.</span><span class="ident" id="4819990">Lookup</span><span class="op" id="4819996">(</span><span class="builtintype" id="4819997">string</span><span class="op" id="4820003">(</span><span class="ident" id="4820004">name</span><span class="op" id="4820008">)</span><span class="op" id="4820009">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4820012">if</span>&nbsp;<span class="ident" id="4820015">p</span>&nbsp;<span class="op" id="4820017">==</span>&nbsp;<span class="ident" id="4820020">nil</span>&nbsp;<span class="op" id="4820024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4820028">w</span><span class="op" id="4820029">.</span><span class="ident" id="4820030">WriteHeader</span><span class="op" id="4820041">(</span><span class="num" id="4820042">404</span><span class="op" id="4820045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4820049">fmt</span><span class="op" id="4820052">.</span><span class="ident" id="4820053">Fprintf</span><span class="op" id="4820060">(</span><span class="ident" id="4820061">w</span><span class="op" id="4820062">,</span>&nbsp;<span class="string" id="4820064">&#34;Unknown&nbsp;profile:&nbsp;%s\n&#34;</span><span class="op" id="4820087">,</span>&nbsp;<span class="ident" id="4820089">name</span><span class="op" id="4820093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4820097">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4820105">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4820108">gc</span><span class="op" id="4820110">,</span>&nbsp;<span class="ident" id="4820112">_</span>&nbsp;<span class="op" id="4820114">:=</span>&nbsp;<span class="ident" id="4820117">strconv</span><span class="op" id="4820124">.</span><span class="ident" id="4820125">Atoi</span><span class="op" id="4820129">(</span><span class="ident" id="4820130">r</span><span class="op" id="4820131">.</span><span class="ident" id="4820132">FormValue</span><span class="op" id="4820141">(</span><span class="string" id="4820142">&#34;gc&#34;</span><span class="op" id="4820146">)</span><span class="op" id="4820147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4820150">if</span>&nbsp;<span class="ident" id="4820153">name</span>&nbsp;<span class="op" id="4820158">==</span>&nbsp;<span class="string" id="4820161">&#34;heap&#34;</span>&nbsp;<span class="op" id="4820168">&amp;&amp;</span>&nbsp;<span class="ident" id="4820171">gc</span>&nbsp;<span class="op" id="4820174">&gt;</span>&nbsp;<span class="num" id="4820176">0</span>&nbsp;<span class="op" id="4820178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4820182">runtime</span><span class="op" id="4820189">.</span><span class="ident" id="4820190">GC</span><span class="op" id="4820192">(</span><span class="op" id="4820193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4820196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4820199">p</span><span class="op" id="4820200">.</span><span class="ident" id="4820201">WriteTo</span><span class="op" id="4820208">(</span><span class="ident" id="4820209">w</span><span class="op" id="4820210">,</span>&nbsp;<span class="ident" id="4820212">debug</span><span class="op" id="4820217">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4820220">return</span><br>
<span class="lineno"></span><span class="op" id="4820227">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4820230">//&nbsp;Index&nbsp;responds&nbsp;with&nbsp;the&nbsp;pprof-formatted&nbsp;profile&nbsp;named&nbsp;by&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span><span class="comment" id="4820303">//&nbsp;For&nbsp;example,&nbsp;&#34;/debug/pprof/heap&#34;&nbsp;serves&nbsp;the&nbsp;&#34;heap&#34;&nbsp;profile.</span><br>
<span class="lineno">175</span><span class="comment" id="4820366">//&nbsp;Index&nbsp;responds&nbsp;to&nbsp;a&nbsp;request&nbsp;for&nbsp;&#34;/debug/pprof/&#34;&nbsp;with&nbsp;an&nbsp;HTML&nbsp;page</span><br>
<span class="lineno"></span><span class="comment" id="4820435">//&nbsp;listing&nbsp;the&nbsp;available&nbsp;profiles.</span><br>
<span class="lineno"></span><span class="keyword" id="4820470">func</span>&nbsp;<span class="ident" id="4820475">Index</span><span class="op" id="4820480">(</span><span class="ident" id="4820481">w</span>&nbsp;<span class="ident" id="4820483">http</span><span class="op" id="4820487">.</span><span class="ident" id="4820488">ResponseWriter</span><span class="op" id="4820502">,</span>&nbsp;<span class="ident" id="4820504">r</span>&nbsp;<span class="op" id="4820506">*</span><span class="ident" id="4820507">http</span><span class="op" id="4820511">.</span><span class="ident" id="4820512">Request</span><span class="op" id="4820519">)</span>&nbsp;<span class="op" id="4820521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4820524">if</span>&nbsp;<span class="ident" id="4820527">strings</span><span class="op" id="4820534">.</span><span class="ident" id="4820535">HasPrefix</span><span class="op" id="4820544">(</span><span class="ident" id="4820545">r</span><span class="op" id="4820546">.</span><span class="ident" id="4820547">URL</span><span class="op" id="4820550">.</span><span class="ident" id="4820551">Path</span><span class="op" id="4820555">,</span>&nbsp;<span class="string" id="4820557">&#34;/debug/pprof/&#34;</span><span class="op" id="4820572">)</span>&nbsp;<span class="op" id="4820574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4820578">name</span>&nbsp;<span class="op" id="4820583">:=</span>&nbsp;<span class="ident" id="4820586">strings</span><span class="op" id="4820593">.</span><span class="ident" id="4820594">TrimPrefix</span><span class="op" id="4820604">(</span><span class="ident" id="4820605">r</span><span class="op" id="4820606">.</span><span class="ident" id="4820607">URL</span><span class="op" id="4820610">.</span><span class="ident" id="4820611">Path</span><span class="op" id="4820615">,</span>&nbsp;<span class="string" id="4820617">&#34;/debug/pprof/&#34;</span><span class="op" id="4820632">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4820636">if</span>&nbsp;<span class="ident" id="4820639">name</span>&nbsp;<span class="op" id="4820644">!=</span>&nbsp;<span class="string" id="4820647">&#34;&#34;</span>&nbsp;<span class="op" id="4820650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4820655">handler</span><span class="op" id="4820662">(</span><span class="ident" id="4820663">name</span><span class="op" id="4820667">)</span><span class="op" id="4820668">.</span><span class="ident" id="4820669">ServeHTTP</span><span class="op" id="4820678">(</span><span class="ident" id="4820679">w</span><span class="op" id="4820680">,</span>&nbsp;<span class="ident" id="4820682">r</span><span class="op" id="4820683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4820688">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4820697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4820700">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4820704">profiles</span>&nbsp;<span class="op" id="4820713">:=</span>&nbsp;<span class="ident" id="4820716">pprof</span><span class="op" id="4820721">.</span><span class="ident" id="4820722">Profiles</span><span class="op" id="4820730">(</span><span class="op" id="4820731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4820734">if</span>&nbsp;<span class="ident" id="4820737">err</span>&nbsp;<span class="op" id="4820741">:=</span>&nbsp;<span class="ident" id="4820744">indexTmpl</span><span class="op" id="4820753">.</span><span class="ident" id="4820754">Execute</span><span class="op" id="4820761">(</span><span class="ident" id="4820762">w</span><span class="op" id="4820763">,</span>&nbsp;<span class="ident" id="4820765">profiles</span><span class="op" id="4820773">)</span><span class="op" id="4820774">;</span>&nbsp;<span class="ident" id="4820776">err</span>&nbsp;<span class="op" id="4820780">!=</span>&nbsp;<span class="ident" id="4820783">nil</span>&nbsp;<span class="op" id="4820787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4820791">log</span><span class="op" id="4820794">.</span><span class="ident" id="4820795">Print</span><span class="op" id="4820800">(</span><span class="ident" id="4820801">err</span><span class="op" id="4820804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4820807">}</span><br>
<span class="lineno">190</span><span class="op" id="4820809">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4820812">var</span>&nbsp;<span class="ident" id="4820816">indexTmpl</span>&nbsp;<span class="op" id="4820826">=</span>&nbsp;<span class="ident" id="4820828">template</span><span class="op" id="4820836">.</span><span class="ident" id="4820837">Must</span><span class="op" id="4820841">(</span><span class="ident" id="4820842">template</span><span class="op" id="4820850">.</span><span class="ident" id="4820851">New</span><span class="op" id="4820854">(</span><span class="string" id="4820855">&#34;index&#34;</span><span class="op" id="4820862">)</span><span class="op" id="4820863">.</span><span class="ident" id="4820864">Parse</span><span class="op" id="4820869">(</span><span class="string" id="4820870">`&lt;html&gt;<br>
<span class="lineno"></span>&lt;head&gt;<br>
<span class="lineno"></span>&lt;title&gt;/debug/pprof/&lt;/title&gt;<br>
<span class="lineno">195</span>&lt;/head&gt;<br>
<span class="lineno"></span>/debug/pprof/&lt;br&gt;<br>
<span class="lineno"></span>&lt;br&gt;<br>
<span class="lineno"></span>&lt;body&gt;<br>
<span class="lineno"></span>profiles:&lt;br&gt;<br>
<span class="lineno">200</span>&lt;table&gt;<br>
<span class="lineno"></span>{{range&nbsp;.}}<br>
<span class="lineno"></span>&lt;tr&gt;&lt;td&nbsp;align=right&gt;{{.Count}}&lt;td&gt;&lt;a&nbsp;href=&#34;/debug/pprof/{{.Name}}?debug=1&#34;&gt;{{.Name}}&lt;/a&gt;<br>
<span class="lineno"></span>{{end}}<br>
<span class="lineno"></span>&lt;/table&gt;<br>
<span class="lineno">205</span>&lt;br&gt;<br>
<span class="lineno"></span>&lt;a&nbsp;href=&#34;/debug/pprof/goroutine?debug=2&#34;&gt;full&nbsp;goroutine&nbsp;stack&nbsp;dump&lt;/a&gt;&lt;br&gt;<br>
<span class="lineno"></span>&lt;/body&gt;<br>
<span class="lineno"></span>&lt;/html&gt;<br>
<span class="lineno"></span>`</span><span class="op" id="4821189">)</span><span class="op" id="4821190">)</span>
</div>
</body>
</html>
