<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/zlib</h2>
<ul>
<li><a href="/gostd/compress/zlib/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/compress/zlib/reader.go.html">reader.go</a></li>
<li><a href="/gostd/compress/zlib/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/zlib/writer.go.html">writer.go</a></li>
<li><a href="/gostd/compress/zlib/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4591559">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4591614">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4591668">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4591719">package</span>&nbsp;<span class="ident" id="4591727">zlib</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4591733">import</span>&nbsp;<span class="op" id="4591740">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4591743">&#34;compress/flate&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4591761">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4591768">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4591776">&#34;hash/adler32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4591792">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="4591797">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="4591800">//&nbsp;These&nbsp;constants&nbsp;are&nbsp;copied&nbsp;from&nbsp;the&nbsp;flate&nbsp;package,&nbsp;so&nbsp;that&nbsp;code&nbsp;that&nbsp;imports</span><br>
<span class="lineno"></span><span class="comment" id="4591880">//&nbsp;&#34;compress/zlib&#34;&nbsp;does&nbsp;not&nbsp;also&nbsp;have&nbsp;to&nbsp;import&nbsp;&#34;compress/flate&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="4591946">const</span>&nbsp;<span class="op" id="4591952">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4591955">NoCompression</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4591974">=</span>&nbsp;<span class="ident" id="4591976">flate</span><span class="op" id="4591981">.</span><span class="ident" id="4591982">NoCompression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4591997">BestSpeed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4592016">=</span>&nbsp;<span class="ident" id="4592018">flate</span><span class="op" id="4592023">.</span><span class="ident" id="4592024">BestSpeed</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4592035">BestCompression</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4592054">=</span>&nbsp;<span class="ident" id="4592056">flate</span><span class="op" id="4592061">.</span><span class="ident" id="4592062">BestCompression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4592079">DefaultCompression</span>&nbsp;<span class="op" id="4592098">=</span>&nbsp;<span class="ident" id="4592100">flate</span><span class="op" id="4592105">.</span><span class="ident" id="4592106">DefaultCompression</span><br>
<span class="lineno"></span><span class="op" id="4592125">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4592128">//&nbsp;A&nbsp;Writer&nbsp;takes&nbsp;data&nbsp;written&nbsp;to&nbsp;it&nbsp;and&nbsp;writes&nbsp;the&nbsp;compressed</span><br>
<span class="lineno">25</span><span class="comment" id="4592191">//&nbsp;form&nbsp;of&nbsp;that&nbsp;data&nbsp;to&nbsp;an&nbsp;underlying&nbsp;writer&nbsp;(see&nbsp;NewWriter).</span><br>
<span class="lineno"></span><span class="keyword" id="4592253">type</span>&nbsp;<span class="ident" id="4592258">Writer</span>&nbsp;<span class="keyword" id="4592265">struct</span>&nbsp;<span class="op" id="4592272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4592275">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4592287">io</span><span class="op" id="4592289">.</span><span class="ident" id="4592290">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4592298">level</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4592310">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4592315">dict</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4592327">[</span><span class="op" id="4592328">]</span><span class="builtintype" id="4592329">byte</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4592335">compressor</span>&nbsp;&nbsp;<span class="op" id="4592347">*</span><span class="ident" id="4592348">flate</span><span class="op" id="4592353">.</span><span class="ident" id="4592354">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4592362">digest</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4592374">hash</span><span class="op" id="4592378">.</span><span class="ident" id="4592379">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4592387">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4592399">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4592406">scratch</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4592418">[</span><span class="num" id="4592419">4</span><span class="op" id="4592420">]</span><span class="builtintype" id="4592421">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4592427">wroteHeader</span>&nbsp;<span class="builtintype" id="4592439">bool</span><br>
<span class="lineno">35</span><span class="op" id="4592444">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4592447">//&nbsp;NewWriter&nbsp;creates&nbsp;a&nbsp;new&nbsp;Writer.</span><br>
<span class="lineno"></span><span class="comment" id="4592482">//&nbsp;Writes&nbsp;to&nbsp;the&nbsp;returned&nbsp;Writer&nbsp;are&nbsp;compressed&nbsp;and&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="4592548">//</span><br>
<span class="lineno">40</span><span class="comment" id="4592551">//&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;call&nbsp;Close&nbsp;on&nbsp;the&nbsp;WriteCloser&nbsp;when&nbsp;done.</span><br>
<span class="lineno"></span><span class="comment" id="4592632">//&nbsp;Writes&nbsp;may&nbsp;be&nbsp;buffered&nbsp;and&nbsp;not&nbsp;flushed&nbsp;until&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="4592687">func</span>&nbsp;<span class="ident" id="4592692">NewWriter</span><span class="op" id="4592701">(</span><span class="ident" id="4592702">w</span>&nbsp;<span class="ident" id="4592704">io</span><span class="op" id="4592706">.</span><span class="ident" id="4592707">Writer</span><span class="op" id="4592713">)</span>&nbsp;<span class="op" id="4592715">*</span><span class="ident" id="4592716">Writer</span>&nbsp;<span class="op" id="4592723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4592726">z</span><span class="op" id="4592727">,</span>&nbsp;<span class="ident" id="4592729">_</span>&nbsp;<span class="op" id="4592731">:=</span>&nbsp;<span class="ident" id="4592734">NewWriterLevelDict</span><span class="op" id="4592752">(</span><span class="ident" id="4592753">w</span><span class="op" id="4592754">,</span>&nbsp;<span class="ident" id="4592756">DefaultCompression</span><span class="op" id="4592774">,</span>&nbsp;<span class="ident" id="4592776">nil</span><span class="op" id="4592779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4592782">return</span>&nbsp;<span class="ident" id="4592789">z</span><br>
<span class="lineno">45</span><span class="op" id="4592791">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4592794">//&nbsp;NewWriterLevel&nbsp;is&nbsp;like&nbsp;NewWriter&nbsp;but&nbsp;specifies&nbsp;the&nbsp;compression&nbsp;level&nbsp;instead</span><br>
<span class="lineno"></span><span class="comment" id="4592874">//&nbsp;of&nbsp;assuming&nbsp;DefaultCompression.</span><br>
<span class="lineno"></span><span class="comment" id="4592909">//</span><br>
<span class="lineno">50</span><span class="comment" id="4592912">//&nbsp;The&nbsp;compression&nbsp;level&nbsp;can&nbsp;be&nbsp;DefaultCompression,&nbsp;NoCompression,&nbsp;or&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="4592986">//&nbsp;integer&nbsp;value&nbsp;between&nbsp;BestSpeed&nbsp;and&nbsp;BestCompression&nbsp;inclusive.&nbsp;The&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="4593062">//&nbsp;returned&nbsp;will&nbsp;be&nbsp;nil&nbsp;if&nbsp;the&nbsp;level&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="4593109">func</span>&nbsp;<span class="ident" id="4593114">NewWriterLevel</span><span class="op" id="4593128">(</span><span class="ident" id="4593129">w</span>&nbsp;<span class="ident" id="4593131">io</span><span class="op" id="4593133">.</span><span class="ident" id="4593134">Writer</span><span class="op" id="4593140">,</span>&nbsp;<span class="ident" id="4593142">level</span>&nbsp;<span class="builtintype" id="4593148">int</span><span class="op" id="4593151">)</span>&nbsp;<span class="op" id="4593153">(</span><span class="op" id="4593154">*</span><span class="ident" id="4593155">Writer</span><span class="op" id="4593161">,</span>&nbsp;<span class="builtintype" id="4593163">error</span><span class="op" id="4593168">)</span>&nbsp;<span class="op" id="4593170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4593173">return</span>&nbsp;<span class="ident" id="4593180">NewWriterLevelDict</span><span class="op" id="4593198">(</span><span class="ident" id="4593199">w</span><span class="op" id="4593200">,</span>&nbsp;<span class="ident" id="4593202">level</span><span class="op" id="4593207">,</span>&nbsp;<span class="ident" id="4593209">nil</span><span class="op" id="4593212">)</span><br>
<span class="lineno">55</span><span class="op" id="4593214">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4593217">//&nbsp;NewWriterLevelDict&nbsp;is&nbsp;like&nbsp;NewWriterLevel&nbsp;but&nbsp;specifies&nbsp;a&nbsp;dictionary&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4593292">//&nbsp;compress&nbsp;with.</span><br>
<span class="lineno"></span><span class="comment" id="4593310">//</span><br>
<span class="lineno">60</span><span class="comment" id="4593313">//&nbsp;The&nbsp;dictionary&nbsp;may&nbsp;be&nbsp;nil.&nbsp;If&nbsp;not,&nbsp;its&nbsp;contents&nbsp;should&nbsp;not&nbsp;be&nbsp;modified&nbsp;until</span><br>
<span class="lineno"></span><span class="comment" id="4593393">//&nbsp;the&nbsp;Writer&nbsp;is&nbsp;closed.</span><br>
<span class="lineno"></span><span class="keyword" id="4593418">func</span>&nbsp;<span class="ident" id="4593423">NewWriterLevelDict</span><span class="op" id="4593441">(</span><span class="ident" id="4593442">w</span>&nbsp;<span class="ident" id="4593444">io</span><span class="op" id="4593446">.</span><span class="ident" id="4593447">Writer</span><span class="op" id="4593453">,</span>&nbsp;<span class="ident" id="4593455">level</span>&nbsp;<span class="builtintype" id="4593461">int</span><span class="op" id="4593464">,</span>&nbsp;<span class="ident" id="4593466">dict</span>&nbsp;<span class="op" id="4593471">[</span><span class="op" id="4593472">]</span><span class="builtintype" id="4593473">byte</span><span class="op" id="4593477">)</span>&nbsp;<span class="op" id="4593479">(</span><span class="op" id="4593480">*</span><span class="ident" id="4593481">Writer</span><span class="op" id="4593487">,</span>&nbsp;<span class="builtintype" id="4593489">error</span><span class="op" id="4593494">)</span>&nbsp;<span class="op" id="4593496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4593499">if</span>&nbsp;<span class="ident" id="4593502">level</span>&nbsp;<span class="op" id="4593508">&lt;</span>&nbsp;<span class="ident" id="4593510">DefaultCompression</span>&nbsp;<span class="op" id="4593529">||</span>&nbsp;<span class="ident" id="4593532">level</span>&nbsp;<span class="op" id="4593538">&gt;</span>&nbsp;<span class="ident" id="4593540">BestCompression</span>&nbsp;<span class="op" id="4593556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4593560">return</span>&nbsp;<span class="ident" id="4593567">nil</span><span class="op" id="4593570">,</span>&nbsp;<span class="ident" id="4593572">fmt</span><span class="op" id="4593575">.</span><span class="ident" id="4593576">Errorf</span><span class="op" id="4593582">(</span><span class="string" id="4593583">&#34;zlib:&nbsp;invalid&nbsp;compression&nbsp;level:&nbsp;%d&#34;</span><span class="op" id="4593620">,</span>&nbsp;<span class="ident" id="4593622">level</span><span class="op" id="4593627">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4593630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4593633">return</span>&nbsp;<span class="op" id="4593640">&amp;</span><span class="ident" id="4593641">Writer</span><span class="op" id="4593647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4593651">w</span><span class="op" id="4593652">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4593658">w</span><span class="op" id="4593659">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4593663">level</span><span class="op" id="4593668">:</span>&nbsp;<span class="ident" id="4593670">level</span><span class="op" id="4593675">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4593679">dict</span><span class="op" id="4593683">:</span>&nbsp;&nbsp;<span class="ident" id="4593686">dict</span><span class="op" id="4593690">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4593693">}</span><span class="op" id="4593694">,</span>&nbsp;<span class="ident" id="4593696">nil</span><br>
<span class="lineno"></span><span class="op" id="4593700">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4593703">//&nbsp;Reset&nbsp;clears&nbsp;the&nbsp;state&nbsp;of&nbsp;the&nbsp;Writer&nbsp;z&nbsp;such&nbsp;that&nbsp;it&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="4593779">//&nbsp;initial&nbsp;state&nbsp;from&nbsp;NewWriterLevel&nbsp;or&nbsp;NewWriterLevelDict,&nbsp;but&nbsp;instead&nbsp;writing</span><br>
<span class="lineno">75</span><span class="comment" id="4593859">//&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="4593868">func</span>&nbsp;<span class="op" id="4593873">(</span><span class="ident" id="4593874">z</span>&nbsp;<span class="op" id="4593876">*</span><span class="ident" id="4593877">Writer</span><span class="op" id="4593883">)</span>&nbsp;<span class="ident" id="4593885">Reset</span><span class="op" id="4593890">(</span><span class="ident" id="4593891">w</span>&nbsp;<span class="ident" id="4593893">io</span><span class="op" id="4593895">.</span><span class="ident" id="4593896">Writer</span><span class="op" id="4593902">)</span>&nbsp;<span class="op" id="4593904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4593907">z</span><span class="op" id="4593908">.</span><span class="ident" id="4593909">w</span>&nbsp;<span class="op" id="4593911">=</span>&nbsp;<span class="ident" id="4593913">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4593916">//&nbsp;z.level&nbsp;and&nbsp;z.dict&nbsp;left&nbsp;unchanged.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4593955">if</span>&nbsp;<span class="ident" id="4593958">z</span><span class="op" id="4593959">.</span><span class="ident" id="4593960">compressor</span>&nbsp;<span class="op" id="4593971">!=</span>&nbsp;<span class="ident" id="4593974">nil</span>&nbsp;<span class="op" id="4593978">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4593982">z</span><span class="op" id="4593983">.</span><span class="ident" id="4593984">compressor</span><span class="op" id="4593994">.</span><span class="ident" id="4593995">Reset</span><span class="op" id="4594000">(</span><span class="ident" id="4594001">w</span><span class="op" id="4594002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4594005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4594008">if</span>&nbsp;<span class="ident" id="4594011">z</span><span class="op" id="4594012">.</span><span class="ident" id="4594013">digest</span>&nbsp;<span class="op" id="4594020">!=</span>&nbsp;<span class="ident" id="4594023">nil</span>&nbsp;<span class="op" id="4594027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4594031">z</span><span class="op" id="4594032">.</span><span class="ident" id="4594033">digest</span><span class="op" id="4594039">.</span><span class="ident" id="4594040">Reset</span><span class="op" id="4594045">(</span><span class="op" id="4594046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4594049">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4594052">z</span><span class="op" id="4594053">.</span><span class="ident" id="4594054">err</span>&nbsp;<span class="op" id="4594058">=</span>&nbsp;<span class="ident" id="4594060">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4594065">z</span><span class="op" id="4594066">.</span><span class="ident" id="4594067">scratch</span>&nbsp;<span class="op" id="4594075">=</span>&nbsp;<span class="op" id="4594077">[</span><span class="num" id="4594078">4</span><span class="op" id="4594079">]</span><span class="builtintype" id="4594080">byte</span><span class="op" id="4594084">{</span><span class="op" id="4594085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4594088">z</span><span class="op" id="4594089">.</span><span class="ident" id="4594090">wroteHeader</span>&nbsp;<span class="op" id="4594102">=</span>&nbsp;<span class="builtintype" id="4594104">false</span><br>
<span class="lineno"></span><span class="op" id="4594110">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="4594113">//&nbsp;writeHeader&nbsp;writes&nbsp;the&nbsp;ZLIB&nbsp;header.</span><br>
<span class="lineno"></span><span class="keyword" id="4594152">func</span>&nbsp;<span class="op" id="4594157">(</span><span class="ident" id="4594158">z</span>&nbsp;<span class="op" id="4594160">*</span><span class="ident" id="4594161">Writer</span><span class="op" id="4594167">)</span>&nbsp;<span class="ident" id="4594169">writeHeader</span><span class="op" id="4594180">(</span><span class="op" id="4594181">)</span>&nbsp;<span class="op" id="4594183">(</span><span class="ident" id="4594184">err</span>&nbsp;<span class="builtintype" id="4594188">error</span><span class="op" id="4594193">)</span>&nbsp;<span class="op" id="4594195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4594198">z</span><span class="op" id="4594199">.</span><span class="ident" id="4594200">wroteHeader</span>&nbsp;<span class="op" id="4594212">=</span>&nbsp;<span class="builtintype" id="4594214">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4594220">//&nbsp;ZLIB&nbsp;has&nbsp;a&nbsp;two-byte&nbsp;header&nbsp;(as&nbsp;documented&nbsp;in&nbsp;RFC&nbsp;1950).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4594280">//&nbsp;The&nbsp;first&nbsp;four&nbsp;bits&nbsp;is&nbsp;the&nbsp;CINFO&nbsp;(compression&nbsp;info),&nbsp;which&nbsp;is&nbsp;7&nbsp;for&nbsp;the&nbsp;default&nbsp;deflate&nbsp;window&nbsp;size.</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4594385">//&nbsp;The&nbsp;next&nbsp;four&nbsp;bits&nbsp;is&nbsp;the&nbsp;CM&nbsp;(compression&nbsp;method),&nbsp;which&nbsp;is&nbsp;8&nbsp;for&nbsp;deflate.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4594464">z</span><span class="op" id="4594465">.</span><span class="ident" id="4594466">scratch</span><span class="op" id="4594473">[</span><span class="num" id="4594474">0</span><span class="op" id="4594475">]</span>&nbsp;<span class="op" id="4594477">=</span>&nbsp;<span class="num" id="4594479">0x78</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4594485">//&nbsp;The&nbsp;next&nbsp;two&nbsp;bits&nbsp;is&nbsp;the&nbsp;FLEVEL&nbsp;(compression&nbsp;level).&nbsp;The&nbsp;four&nbsp;values&nbsp;are:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4594563">//&nbsp;0=fastest,&nbsp;1=fast,&nbsp;2=default,&nbsp;3=best.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4594605">//&nbsp;The&nbsp;next&nbsp;bit,&nbsp;FDICT,&nbsp;is&nbsp;set&nbsp;if&nbsp;a&nbsp;dictionary&nbsp;is&nbsp;given.</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4594663">//&nbsp;The&nbsp;final&nbsp;five&nbsp;FCHECK&nbsp;bits&nbsp;form&nbsp;a&nbsp;mod-31&nbsp;checksum.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4594718">switch</span>&nbsp;<span class="ident" id="4594725">z</span><span class="op" id="4594726">.</span><span class="ident" id="4594727">level</span>&nbsp;<span class="op" id="4594733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4594736">case</span>&nbsp;<span class="num" id="4594741">0</span><span class="op" id="4594742">,</span>&nbsp;<span class="num" id="4594744">1</span><span class="op" id="4594745">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4594749">z</span><span class="op" id="4594750">.</span><span class="ident" id="4594751">scratch</span><span class="op" id="4594758">[</span><span class="num" id="4594759">1</span><span class="op" id="4594760">]</span>&nbsp;<span class="op" id="4594762">=</span>&nbsp;<span class="num" id="4594764">0</span>&nbsp;<span class="op" id="4594766">&lt;&lt;</span>&nbsp;<span class="num" id="4594769">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4594772">case</span>&nbsp;<span class="num" id="4594777">2</span><span class="op" id="4594778">,</span>&nbsp;<span class="num" id="4594780">3</span><span class="op" id="4594781">,</span>&nbsp;<span class="num" id="4594783">4</span><span class="op" id="4594784">,</span>&nbsp;<span class="num" id="4594786">5</span><span class="op" id="4594787">:</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4594791">z</span><span class="op" id="4594792">.</span><span class="ident" id="4594793">scratch</span><span class="op" id="4594800">[</span><span class="num" id="4594801">1</span><span class="op" id="4594802">]</span>&nbsp;<span class="op" id="4594804">=</span>&nbsp;<span class="num" id="4594806">1</span>&nbsp;<span class="op" id="4594808">&lt;&lt;</span>&nbsp;<span class="num" id="4594811">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4594814">case</span>&nbsp;<span class="num" id="4594819">6</span><span class="op" id="4594820">,</span>&nbsp;<span class="op" id="4594822">-</span><span class="num" id="4594823">1</span><span class="op" id="4594824">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4594828">z</span><span class="op" id="4594829">.</span><span class="ident" id="4594830">scratch</span><span class="op" id="4594837">[</span><span class="num" id="4594838">1</span><span class="op" id="4594839">]</span>&nbsp;<span class="op" id="4594841">=</span>&nbsp;<span class="num" id="4594843">2</span>&nbsp;<span class="op" id="4594845">&lt;&lt;</span>&nbsp;<span class="num" id="4594848">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4594851">case</span>&nbsp;<span class="num" id="4594856">7</span><span class="op" id="4594857">,</span>&nbsp;<span class="num" id="4594859">8</span><span class="op" id="4594860">,</span>&nbsp;<span class="num" id="4594862">9</span><span class="op" id="4594863">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4594867">z</span><span class="op" id="4594868">.</span><span class="ident" id="4594869">scratch</span><span class="op" id="4594876">[</span><span class="num" id="4594877">1</span><span class="op" id="4594878">]</span>&nbsp;<span class="op" id="4594880">=</span>&nbsp;<span class="num" id="4594882">3</span>&nbsp;<span class="op" id="4594884">&lt;&lt;</span>&nbsp;<span class="num" id="4594887">6</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4594890">default</span><span class="op" id="4594897">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4594901">panic</span><span class="op" id="4594906">(</span><span class="string" id="4594907">&#34;unreachable&#34;</span><span class="op" id="4594920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4594923">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4594926">if</span>&nbsp;<span class="ident" id="4594929">z</span><span class="op" id="4594930">.</span><span class="ident" id="4594931">dict</span>&nbsp;<span class="op" id="4594936">!=</span>&nbsp;<span class="ident" id="4594939">nil</span>&nbsp;<span class="op" id="4594943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4594947">z</span><span class="op" id="4594948">.</span><span class="ident" id="4594949">scratch</span><span class="op" id="4594956">[</span><span class="num" id="4594957">1</span><span class="op" id="4594958">]</span>&nbsp;<span class="op" id="4594960">|=</span>&nbsp;<span class="num" id="4594963">1</span>&nbsp;<span class="op" id="4594965">&lt;&lt;</span>&nbsp;<span class="num" id="4594968">5</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4594971">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4594974">z</span><span class="op" id="4594975">.</span><span class="ident" id="4594976">scratch</span><span class="op" id="4594983">[</span><span class="num" id="4594984">1</span><span class="op" id="4594985">]</span>&nbsp;<span class="op" id="4594987">+=</span>&nbsp;<span class="builtintype" id="4594990">uint8</span><span class="op" id="4594995">(</span><span class="num" id="4594996">31</span>&nbsp;<span class="op" id="4594999">-</span>&nbsp;<span class="op" id="4595001">(</span><span class="builtintype" id="4595002">uint16</span><span class="op" id="4595008">(</span><span class="ident" id="4595009">z</span><span class="op" id="4595010">.</span><span class="ident" id="4595011">scratch</span><span class="op" id="4595018">[</span><span class="num" id="4595019">0</span><span class="op" id="4595020">]</span><span class="op" id="4595021">)</span><span class="op" id="4595022">&lt;&lt;</span><span class="num" id="4595024">8</span><span class="op" id="4595025">+</span><span class="builtintype" id="4595026">uint16</span><span class="op" id="4595032">(</span><span class="ident" id="4595033">z</span><span class="op" id="4595034">.</span><span class="ident" id="4595035">scratch</span><span class="op" id="4595042">[</span><span class="num" id="4595043">1</span><span class="op" id="4595044">]</span><span class="op" id="4595045">)</span><span class="op" id="4595046">)</span><span class="op" id="4595047">%</span><span class="num" id="4595048">31</span><span class="op" id="4595050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4595053">if</span>&nbsp;<span class="ident" id="4595056">_</span><span class="op" id="4595057">,</span>&nbsp;<span class="ident" id="4595059">err</span>&nbsp;<span class="op" id="4595063">=</span>&nbsp;<span class="ident" id="4595065">z</span><span class="op" id="4595066">.</span><span class="ident" id="4595067">w</span><span class="op" id="4595068">.</span><span class="ident" id="4595069">Write</span><span class="op" id="4595074">(</span><span class="ident" id="4595075">z</span><span class="op" id="4595076">.</span><span class="ident" id="4595077">scratch</span><span class="op" id="4595084">[</span><span class="num" id="4595085">0</span><span class="op" id="4595086">:</span><span class="num" id="4595087">2</span><span class="op" id="4595088">]</span><span class="op" id="4595089">)</span><span class="op" id="4595090">;</span>&nbsp;<span class="ident" id="4595092">err</span>&nbsp;<span class="op" id="4595096">!=</span>&nbsp;<span class="ident" id="4595099">nil</span>&nbsp;<span class="op" id="4595103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4595107">return</span>&nbsp;<span class="ident" id="4595114">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4595119">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4595122">if</span>&nbsp;<span class="ident" id="4595125">z</span><span class="op" id="4595126">.</span><span class="ident" id="4595127">dict</span>&nbsp;<span class="op" id="4595132">!=</span>&nbsp;<span class="ident" id="4595135">nil</span>&nbsp;<span class="op" id="4595139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4595143">//&nbsp;The&nbsp;next&nbsp;four&nbsp;bytes&nbsp;are&nbsp;the&nbsp;Adler-32&nbsp;checksum&nbsp;of&nbsp;the&nbsp;dictionary.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4595213">checksum</span>&nbsp;<span class="op" id="4595222">:=</span>&nbsp;<span class="ident" id="4595225">adler32</span><span class="op" id="4595232">.</span><span class="ident" id="4595233">Checksum</span><span class="op" id="4595241">(</span><span class="ident" id="4595242">z</span><span class="op" id="4595243">.</span><span class="ident" id="4595244">dict</span><span class="op" id="4595248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4595252">z</span><span class="op" id="4595253">.</span><span class="ident" id="4595254">scratch</span><span class="op" id="4595261">[</span><span class="num" id="4595262">0</span><span class="op" id="4595263">]</span>&nbsp;<span class="op" id="4595265">=</span>&nbsp;<span class="builtintype" id="4595267">uint8</span><span class="op" id="4595272">(</span><span class="ident" id="4595273">checksum</span>&nbsp;<span class="op" id="4595282">&gt;&gt;</span>&nbsp;<span class="num" id="4595285">24</span><span class="op" id="4595287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4595291">z</span><span class="op" id="4595292">.</span><span class="ident" id="4595293">scratch</span><span class="op" id="4595300">[</span><span class="num" id="4595301">1</span><span class="op" id="4595302">]</span>&nbsp;<span class="op" id="4595304">=</span>&nbsp;<span class="builtintype" id="4595306">uint8</span><span class="op" id="4595311">(</span><span class="ident" id="4595312">checksum</span>&nbsp;<span class="op" id="4595321">&gt;&gt;</span>&nbsp;<span class="num" id="4595324">16</span><span class="op" id="4595326">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4595330">z</span><span class="op" id="4595331">.</span><span class="ident" id="4595332">scratch</span><span class="op" id="4595339">[</span><span class="num" id="4595340">2</span><span class="op" id="4595341">]</span>&nbsp;<span class="op" id="4595343">=</span>&nbsp;<span class="builtintype" id="4595345">uint8</span><span class="op" id="4595350">(</span><span class="ident" id="4595351">checksum</span>&nbsp;<span class="op" id="4595360">&gt;&gt;</span>&nbsp;<span class="num" id="4595363">8</span><span class="op" id="4595364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4595368">z</span><span class="op" id="4595369">.</span><span class="ident" id="4595370">scratch</span><span class="op" id="4595377">[</span><span class="num" id="4595378">3</span><span class="op" id="4595379">]</span>&nbsp;<span class="op" id="4595381">=</span>&nbsp;<span class="builtintype" id="4595383">uint8</span><span class="op" id="4595388">(</span><span class="ident" id="4595389">checksum</span>&nbsp;<span class="op" id="4595398">&gt;&gt;</span>&nbsp;<span class="num" id="4595401">0</span><span class="op" id="4595402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4595406">if</span>&nbsp;<span class="ident" id="4595409">_</span><span class="op" id="4595410">,</span>&nbsp;<span class="ident" id="4595412">err</span>&nbsp;<span class="op" id="4595416">=</span>&nbsp;<span class="ident" id="4595418">z</span><span class="op" id="4595419">.</span><span class="ident" id="4595420">w</span><span class="op" id="4595421">.</span><span class="ident" id="4595422">Write</span><span class="op" id="4595427">(</span><span class="ident" id="4595428">z</span><span class="op" id="4595429">.</span><span class="ident" id="4595430">scratch</span><span class="op" id="4595437">[</span><span class="num" id="4595438">0</span><span class="op" id="4595439">:</span><span class="num" id="4595440">4</span><span class="op" id="4595441">]</span><span class="op" id="4595442">)</span><span class="op" id="4595443">;</span>&nbsp;<span class="ident" id="4595445">err</span>&nbsp;<span class="op" id="4595449">!=</span>&nbsp;<span class="ident" id="4595452">nil</span>&nbsp;<span class="op" id="4595456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4595461">return</span>&nbsp;<span class="ident" id="4595468">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4595474">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4595477">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4595480">if</span>&nbsp;<span class="ident" id="4595483">z</span><span class="op" id="4595484">.</span><span class="ident" id="4595485">compressor</span>&nbsp;<span class="op" id="4595496">==</span>&nbsp;<span class="ident" id="4595499">nil</span>&nbsp;<span class="op" id="4595503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4595507">//&nbsp;Initialize&nbsp;deflater&nbsp;unless&nbsp;the&nbsp;Writer&nbsp;is&nbsp;being&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4595566">//&nbsp;after&nbsp;a&nbsp;Reset&nbsp;call.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4595591">z</span><span class="op" id="4595592">.</span><span class="ident" id="4595593">compressor</span><span class="op" id="4595603">,</span>&nbsp;<span class="ident" id="4595605">err</span>&nbsp;<span class="op" id="4595609">=</span>&nbsp;<span class="ident" id="4595611">flate</span><span class="op" id="4595616">.</span><span class="ident" id="4595617">NewWriterDict</span><span class="op" id="4595630">(</span><span class="ident" id="4595631">z</span><span class="op" id="4595632">.</span><span class="ident" id="4595633">w</span><span class="op" id="4595634">,</span>&nbsp;<span class="ident" id="4595636">z</span><span class="op" id="4595637">.</span><span class="ident" id="4595638">level</span><span class="op" id="4595643">,</span>&nbsp;<span class="ident" id="4595645">z</span><span class="op" id="4595646">.</span><span class="ident" id="4595647">dict</span><span class="op" id="4595651">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4595655">if</span>&nbsp;<span class="ident" id="4595658">err</span>&nbsp;<span class="op" id="4595662">!=</span>&nbsp;<span class="ident" id="4595665">nil</span>&nbsp;<span class="op" id="4595669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4595674">return</span>&nbsp;<span class="ident" id="4595681">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4595687">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4595691">z</span><span class="op" id="4595692">.</span><span class="ident" id="4595693">digest</span>&nbsp;<span class="op" id="4595700">=</span>&nbsp;<span class="ident" id="4595702">adler32</span><span class="op" id="4595709">.</span><span class="ident" id="4595710">New</span><span class="op" id="4595713">(</span><span class="op" id="4595714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4595717">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4595720">return</span>&nbsp;<span class="ident" id="4595727">nil</span><br>
<span class="lineno"></span><span class="op" id="4595731">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4595734">//&nbsp;Write&nbsp;writes&nbsp;a&nbsp;compressed&nbsp;form&nbsp;of&nbsp;p&nbsp;to&nbsp;the&nbsp;underlying&nbsp;io.Writer.&nbsp;The</span><br>
<span class="lineno"></span><span class="comment" id="4595806">//&nbsp;compressed&nbsp;bytes&nbsp;are&nbsp;not&nbsp;necessarily&nbsp;flushed&nbsp;until&nbsp;the&nbsp;Writer&nbsp;is&nbsp;closed&nbsp;or</span><br>
<span class="lineno">145</span><span class="comment" id="4595884">//&nbsp;explicitly&nbsp;flushed.</span><br>
<span class="lineno"></span><span class="keyword" id="4595907">func</span>&nbsp;<span class="op" id="4595912">(</span><span class="ident" id="4595913">z</span>&nbsp;<span class="op" id="4595915">*</span><span class="ident" id="4595916">Writer</span><span class="op" id="4595922">)</span>&nbsp;<span class="ident" id="4595924">Write</span><span class="op" id="4595929">(</span><span class="ident" id="4595930">p</span>&nbsp;<span class="op" id="4595932">[</span><span class="op" id="4595933">]</span><span class="builtintype" id="4595934">byte</span><span class="op" id="4595938">)</span>&nbsp;<span class="op" id="4595940">(</span><span class="ident" id="4595941">n</span>&nbsp;<span class="builtintype" id="4595943">int</span><span class="op" id="4595946">,</span>&nbsp;<span class="ident" id="4595948">err</span>&nbsp;<span class="builtintype" id="4595952">error</span><span class="op" id="4595957">)</span>&nbsp;<span class="op" id="4595959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4595962">if</span>&nbsp;<span class="op" id="4595965">!</span><span class="ident" id="4595966">z</span><span class="op" id="4595967">.</span><span class="ident" id="4595968">wroteHeader</span>&nbsp;<span class="op" id="4595980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4595984">z</span><span class="op" id="4595985">.</span><span class="ident" id="4595986">err</span>&nbsp;<span class="op" id="4595990">=</span>&nbsp;<span class="ident" id="4595992">z</span><span class="op" id="4595993">.</span><span class="ident" id="4595994">writeHeader</span><span class="op" id="4596005">(</span><span class="op" id="4596006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4596009">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4596012">if</span>&nbsp;<span class="ident" id="4596015">z</span><span class="op" id="4596016">.</span><span class="ident" id="4596017">err</span>&nbsp;<span class="op" id="4596021">!=</span>&nbsp;<span class="ident" id="4596024">nil</span>&nbsp;<span class="op" id="4596028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4596032">return</span>&nbsp;<span class="num" id="4596039">0</span><span class="op" id="4596040">,</span>&nbsp;<span class="ident" id="4596042">z</span><span class="op" id="4596043">.</span><span class="ident" id="4596044">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4596049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4596052">if</span>&nbsp;<span class="builtinfunc" id="4596055">len</span><span class="op" id="4596058">(</span><span class="ident" id="4596059">p</span><span class="op" id="4596060">)</span>&nbsp;<span class="op" id="4596062">==</span>&nbsp;<span class="num" id="4596065">0</span>&nbsp;<span class="op" id="4596067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4596071">return</span>&nbsp;<span class="num" id="4596078">0</span><span class="op" id="4596079">,</span>&nbsp;<span class="ident" id="4596081">nil</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4596086">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4596089">n</span><span class="op" id="4596090">,</span>&nbsp;<span class="ident" id="4596092">err</span>&nbsp;<span class="op" id="4596096">=</span>&nbsp;<span class="ident" id="4596098">z</span><span class="op" id="4596099">.</span><span class="ident" id="4596100">compressor</span><span class="op" id="4596110">.</span><span class="ident" id="4596111">Write</span><span class="op" id="4596116">(</span><span class="ident" id="4596117">p</span><span class="op" id="4596118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4596121">if</span>&nbsp;<span class="ident" id="4596124">err</span>&nbsp;<span class="op" id="4596128">!=</span>&nbsp;<span class="ident" id="4596131">nil</span>&nbsp;<span class="op" id="4596135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4596139">z</span><span class="op" id="4596140">.</span><span class="ident" id="4596141">err</span>&nbsp;<span class="op" id="4596145">=</span>&nbsp;<span class="ident" id="4596147">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4596153">return</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4596161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4596164">z</span><span class="op" id="4596165">.</span><span class="ident" id="4596166">digest</span><span class="op" id="4596172">.</span><span class="ident" id="4596173">Write</span><span class="op" id="4596178">(</span><span class="ident" id="4596179">p</span><span class="op" id="4596180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4596183">return</span><br>
<span class="lineno"></span><span class="op" id="4596190">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="4596193">//&nbsp;Flush&nbsp;flushes&nbsp;the&nbsp;Writer&nbsp;to&nbsp;its&nbsp;underlying&nbsp;io.Writer.</span><br>
<span class="lineno"></span><span class="keyword" id="4596250">func</span>&nbsp;<span class="op" id="4596255">(</span><span class="ident" id="4596256">z</span>&nbsp;<span class="op" id="4596258">*</span><span class="ident" id="4596259">Writer</span><span class="op" id="4596265">)</span>&nbsp;<span class="ident" id="4596267">Flush</span><span class="op" id="4596272">(</span><span class="op" id="4596273">)</span>&nbsp;<span class="builtintype" id="4596275">error</span>&nbsp;<span class="op" id="4596281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4596284">if</span>&nbsp;<span class="op" id="4596287">!</span><span class="ident" id="4596288">z</span><span class="op" id="4596289">.</span><span class="ident" id="4596290">wroteHeader</span>&nbsp;<span class="op" id="4596302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4596306">z</span><span class="op" id="4596307">.</span><span class="ident" id="4596308">err</span>&nbsp;<span class="op" id="4596312">=</span>&nbsp;<span class="ident" id="4596314">z</span><span class="op" id="4596315">.</span><span class="ident" id="4596316">writeHeader</span><span class="op" id="4596327">(</span><span class="op" id="4596328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4596331">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4596334">if</span>&nbsp;<span class="ident" id="4596337">z</span><span class="op" id="4596338">.</span><span class="ident" id="4596339">err</span>&nbsp;<span class="op" id="4596343">!=</span>&nbsp;<span class="ident" id="4596346">nil</span>&nbsp;<span class="op" id="4596350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4596354">return</span>&nbsp;<span class="ident" id="4596361">z</span><span class="op" id="4596362">.</span><span class="ident" id="4596363">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4596368">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4596371">z</span><span class="op" id="4596372">.</span><span class="ident" id="4596373">err</span>&nbsp;<span class="op" id="4596377">=</span>&nbsp;<span class="ident" id="4596379">z</span><span class="op" id="4596380">.</span><span class="ident" id="4596381">compressor</span><span class="op" id="4596391">.</span><span class="ident" id="4596392">Flush</span><span class="op" id="4596397">(</span><span class="op" id="4596398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4596401">return</span>&nbsp;<span class="ident" id="4596408">z</span><span class="op" id="4596409">.</span><span class="ident" id="4596410">err</span><br>
<span class="lineno">175</span><span class="op" id="4596414">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4596417">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;Writer,&nbsp;flushing&nbsp;any&nbsp;unwritten&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying</span><br>
<span class="lineno"></span><span class="comment" id="4596491">//&nbsp;io.Writer,&nbsp;but&nbsp;does&nbsp;not&nbsp;close&nbsp;the&nbsp;underlying&nbsp;io.Writer.</span><br>
<span class="lineno"></span><span class="keyword" id="4596550">func</span>&nbsp;<span class="op" id="4596555">(</span><span class="ident" id="4596556">z</span>&nbsp;<span class="op" id="4596558">*</span><span class="ident" id="4596559">Writer</span><span class="op" id="4596565">)</span>&nbsp;<span class="ident" id="4596567">Close</span><span class="op" id="4596572">(</span><span class="op" id="4596573">)</span>&nbsp;<span class="builtintype" id="4596575">error</span>&nbsp;<span class="op" id="4596581">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4596584">if</span>&nbsp;<span class="op" id="4596587">!</span><span class="ident" id="4596588">z</span><span class="op" id="4596589">.</span><span class="ident" id="4596590">wroteHeader</span>&nbsp;<span class="op" id="4596602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4596606">z</span><span class="op" id="4596607">.</span><span class="ident" id="4596608">err</span>&nbsp;<span class="op" id="4596612">=</span>&nbsp;<span class="ident" id="4596614">z</span><span class="op" id="4596615">.</span><span class="ident" id="4596616">writeHeader</span><span class="op" id="4596627">(</span><span class="op" id="4596628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4596631">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4596634">if</span>&nbsp;<span class="ident" id="4596637">z</span><span class="op" id="4596638">.</span><span class="ident" id="4596639">err</span>&nbsp;<span class="op" id="4596643">!=</span>&nbsp;<span class="ident" id="4596646">nil</span>&nbsp;<span class="op" id="4596650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4596654">return</span>&nbsp;<span class="ident" id="4596661">z</span><span class="op" id="4596662">.</span><span class="ident" id="4596663">err</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4596668">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4596671">z</span><span class="op" id="4596672">.</span><span class="ident" id="4596673">err</span>&nbsp;<span class="op" id="4596677">=</span>&nbsp;<span class="ident" id="4596679">z</span><span class="op" id="4596680">.</span><span class="ident" id="4596681">compressor</span><span class="op" id="4596691">.</span><span class="ident" id="4596692">Close</span><span class="op" id="4596697">(</span><span class="op" id="4596698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4596701">if</span>&nbsp;<span class="ident" id="4596704">z</span><span class="op" id="4596705">.</span><span class="ident" id="4596706">err</span>&nbsp;<span class="op" id="4596710">!=</span>&nbsp;<span class="ident" id="4596713">nil</span>&nbsp;<span class="op" id="4596717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4596721">return</span>&nbsp;<span class="ident" id="4596728">z</span><span class="op" id="4596729">.</span><span class="ident" id="4596730">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4596735">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4596738">checksum</span>&nbsp;<span class="op" id="4596747">:=</span>&nbsp;<span class="ident" id="4596750">z</span><span class="op" id="4596751">.</span><span class="ident" id="4596752">digest</span><span class="op" id="4596758">.</span><span class="ident" id="4596759">Sum32</span><span class="op" id="4596764">(</span><span class="op" id="4596765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4596768">//&nbsp;ZLIB&nbsp;(RFC&nbsp;1950)&nbsp;is&nbsp;big-endian,&nbsp;unlike&nbsp;GZIP&nbsp;(RFC&nbsp;1952).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4596827">z</span><span class="op" id="4596828">.</span><span class="ident" id="4596829">scratch</span><span class="op" id="4596836">[</span><span class="num" id="4596837">0</span><span class="op" id="4596838">]</span>&nbsp;<span class="op" id="4596840">=</span>&nbsp;<span class="builtintype" id="4596842">uint8</span><span class="op" id="4596847">(</span><span class="ident" id="4596848">checksum</span>&nbsp;<span class="op" id="4596857">&gt;&gt;</span>&nbsp;<span class="num" id="4596860">24</span><span class="op" id="4596862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4596865">z</span><span class="op" id="4596866">.</span><span class="ident" id="4596867">scratch</span><span class="op" id="4596874">[</span><span class="num" id="4596875">1</span><span class="op" id="4596876">]</span>&nbsp;<span class="op" id="4596878">=</span>&nbsp;<span class="builtintype" id="4596880">uint8</span><span class="op" id="4596885">(</span><span class="ident" id="4596886">checksum</span>&nbsp;<span class="op" id="4596895">&gt;&gt;</span>&nbsp;<span class="num" id="4596898">16</span><span class="op" id="4596900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4596903">z</span><span class="op" id="4596904">.</span><span class="ident" id="4596905">scratch</span><span class="op" id="4596912">[</span><span class="num" id="4596913">2</span><span class="op" id="4596914">]</span>&nbsp;<span class="op" id="4596916">=</span>&nbsp;<span class="builtintype" id="4596918">uint8</span><span class="op" id="4596923">(</span><span class="ident" id="4596924">checksum</span>&nbsp;<span class="op" id="4596933">&gt;&gt;</span>&nbsp;<span class="num" id="4596936">8</span><span class="op" id="4596937">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4596940">z</span><span class="op" id="4596941">.</span><span class="ident" id="4596942">scratch</span><span class="op" id="4596949">[</span><span class="num" id="4596950">3</span><span class="op" id="4596951">]</span>&nbsp;<span class="op" id="4596953">=</span>&nbsp;<span class="builtintype" id="4596955">uint8</span><span class="op" id="4596960">(</span><span class="ident" id="4596961">checksum</span>&nbsp;<span class="op" id="4596970">&gt;&gt;</span>&nbsp;<span class="num" id="4596973">0</span><span class="op" id="4596974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4596977">_</span><span class="op" id="4596978">,</span>&nbsp;<span class="ident" id="4596980">z</span><span class="op" id="4596981">.</span><span class="ident" id="4596982">err</span>&nbsp;<span class="op" id="4596986">=</span>&nbsp;<span class="ident" id="4596988">z</span><span class="op" id="4596989">.</span><span class="ident" id="4596990">w</span><span class="op" id="4596991">.</span><span class="ident" id="4596992">Write</span><span class="op" id="4596997">(</span><span class="ident" id="4596998">z</span><span class="op" id="4596999">.</span><span class="ident" id="4597000">scratch</span><span class="op" id="4597007">[</span><span class="num" id="4597008">0</span><span class="op" id="4597009">:</span><span class="num" id="4597010">4</span><span class="op" id="4597011">]</span><span class="op" id="4597012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4597015">return</span>&nbsp;<span class="ident" id="4597022">z</span><span class="op" id="4597023">.</span><span class="ident" id="4597024">err</span><br>
<span class="lineno"></span><span class="op" id="4597028">}</span>
</div>
</body>
</html>
