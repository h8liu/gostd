<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4735457">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4735513">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4735567">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4735618">//&nbsp;Package&nbsp;json&nbsp;implements&nbsp;encoding&nbsp;and&nbsp;decoding&nbsp;of&nbsp;JSON&nbsp;objects&nbsp;as&nbsp;defined&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="4735697">//&nbsp;RFC&nbsp;4627.&nbsp;The&nbsp;mapping&nbsp;between&nbsp;JSON&nbsp;objects&nbsp;and&nbsp;Go&nbsp;values&nbsp;is&nbsp;described</span><br>
<span class="lineno"></span><span class="comment" id="4735770">//&nbsp;in&nbsp;the&nbsp;documentation&nbsp;for&nbsp;the&nbsp;Marshal&nbsp;and&nbsp;Unmarshal&nbsp;functions.</span><br>
<span class="lineno"></span><span class="comment" id="4735835">//</span><br>
<span class="lineno"></span><span class="comment" id="4735838">//&nbsp;See&nbsp;&#34;JSON&nbsp;and&nbsp;Go&#34;&nbsp;for&nbsp;an&nbsp;introduction&nbsp;to&nbsp;this&nbsp;package:</span><br>
<span class="lineno">10</span><span class="comment" id="4735896">//&nbsp;http://golang.org/doc/articles/json_and_go.html</span><br>
<span class="lineno"></span><span class="keyword" id="4735947">package</span>&nbsp;<span class="ident" id="4735955">json</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4735961">import</span>&nbsp;<span class="op" id="4735968">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4735971">&#34;bytes&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4735980">&#34;encoding&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4735992">&#34;encoding/base64&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4736011">&#34;math&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4736019">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4736030">&#34;runtime&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4736041">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4736049">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4736060">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4736071">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4736079">&#34;unicode&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4736090">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="4736105">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4736108">//&nbsp;Marshal&nbsp;returns&nbsp;the&nbsp;JSON&nbsp;encoding&nbsp;of&nbsp;v.</span><br>
<span class="lineno"></span><span class="comment" id="4736151">//</span><br>
<span class="lineno">30</span><span class="comment" id="4736154">//&nbsp;Marshal&nbsp;traverses&nbsp;the&nbsp;value&nbsp;v&nbsp;recursively.</span><br>
<span class="lineno"></span><span class="comment" id="4736200">//&nbsp;If&nbsp;an&nbsp;encountered&nbsp;value&nbsp;implements&nbsp;the&nbsp;Marshaler&nbsp;interface</span><br>
<span class="lineno"></span><span class="comment" id="4736262">//&nbsp;and&nbsp;is&nbsp;not&nbsp;a&nbsp;nil&nbsp;pointer,&nbsp;Marshal&nbsp;calls&nbsp;its&nbsp;MarshalJSON&nbsp;method</span><br>
<span class="lineno"></span><span class="comment" id="4736328">//&nbsp;to&nbsp;produce&nbsp;JSON.&nbsp;&nbsp;The&nbsp;nil&nbsp;pointer&nbsp;exception&nbsp;is&nbsp;not&nbsp;strictly&nbsp;necessary</span><br>
<span class="lineno"></span><span class="comment" id="4736401">//&nbsp;but&nbsp;mimics&nbsp;a&nbsp;similar,&nbsp;necessary&nbsp;exception&nbsp;in&nbsp;the&nbsp;behavior&nbsp;of</span><br>
<span class="lineno">35</span><span class="comment" id="4736465">//&nbsp;UnmarshalJSON.</span><br>
<span class="lineno"></span><span class="comment" id="4736483">//</span><br>
<span class="lineno"></span><span class="comment" id="4736486">//&nbsp;Otherwise,&nbsp;Marshal&nbsp;uses&nbsp;the&nbsp;following&nbsp;type-dependent&nbsp;default&nbsp;encodings:</span><br>
<span class="lineno"></span><span class="comment" id="4736561">//</span><br>
<span class="lineno"></span><span class="comment" id="4736564">//&nbsp;Boolean&nbsp;values&nbsp;encode&nbsp;as&nbsp;JSON&nbsp;booleans.</span><br>
<span class="lineno">40</span><span class="comment" id="4736607">//</span><br>
<span class="lineno"></span><span class="comment" id="4736610">//&nbsp;Floating&nbsp;point,&nbsp;integer,&nbsp;and&nbsp;Number&nbsp;values&nbsp;encode&nbsp;as&nbsp;JSON&nbsp;numbers.</span><br>
<span class="lineno"></span><span class="comment" id="4736680">//</span><br>
<span class="lineno"></span><span class="comment" id="4736683">//&nbsp;String&nbsp;values&nbsp;encode&nbsp;as&nbsp;JSON&nbsp;strings&nbsp;coerced&nbsp;to&nbsp;valid&nbsp;UTF-8,</span><br>
<span class="lineno"></span><span class="comment" id="4736747">//&nbsp;replacing&nbsp;invalid&nbsp;bytes&nbsp;with&nbsp;the&nbsp;Unicode&nbsp;replacement&nbsp;rune.</span><br>
<span class="lineno">45</span><span class="comment" id="4736809">//&nbsp;The&nbsp;angle&nbsp;brackets&nbsp;&#34;&lt;&#34;&nbsp;and&nbsp;&#34;&gt;&#34;&nbsp;are&nbsp;escaped&nbsp;to&nbsp;&#34;\u003c&#34;&nbsp;and&nbsp;&#34;\u003e&#34;</span><br>
<span class="lineno"></span><span class="comment" id="4736880">//&nbsp;to&nbsp;keep&nbsp;some&nbsp;browsers&nbsp;from&nbsp;misinterpreting&nbsp;JSON&nbsp;output&nbsp;as&nbsp;HTML.</span><br>
<span class="lineno"></span><span class="comment" id="4736947">//&nbsp;Ampersand&nbsp;&#34;&amp;&#34;&nbsp;is&nbsp;also&nbsp;escaped&nbsp;to&nbsp;&#34;\u0026&#34;&nbsp;for&nbsp;the&nbsp;same&nbsp;reason.</span><br>
<span class="lineno"></span><span class="comment" id="4737013">//</span><br>
<span class="lineno"></span><span class="comment" id="4737016">//&nbsp;Array&nbsp;and&nbsp;slice&nbsp;values&nbsp;encode&nbsp;as&nbsp;JSON&nbsp;arrays,&nbsp;except&nbsp;that</span><br>
<span class="lineno">50</span><span class="comment" id="4737077">//&nbsp;[]byte&nbsp;encodes&nbsp;as&nbsp;a&nbsp;base64-encoded&nbsp;string,&nbsp;and&nbsp;a&nbsp;nil&nbsp;slice</span><br>
<span class="lineno"></span><span class="comment" id="4737139">//&nbsp;encodes&nbsp;as&nbsp;the&nbsp;null&nbsp;JSON&nbsp;object.</span><br>
<span class="lineno"></span><span class="comment" id="4737175">//</span><br>
<span class="lineno"></span><span class="comment" id="4737178">//&nbsp;Struct&nbsp;values&nbsp;encode&nbsp;as&nbsp;JSON&nbsp;objects.&nbsp;Each&nbsp;exported&nbsp;struct&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="4737246">//&nbsp;becomes&nbsp;a&nbsp;member&nbsp;of&nbsp;the&nbsp;object&nbsp;unless</span><br>
<span class="lineno">55</span><span class="comment" id="4737287">//&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;field&#39;s&nbsp;tag&nbsp;is&nbsp;&#34;-&#34;,&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="4737321">//&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;field&nbsp;is&nbsp;empty&nbsp;and&nbsp;its&nbsp;tag&nbsp;specifies&nbsp;the&nbsp;&#34;omitempty&#34;&nbsp;option.</span><br>
<span class="lineno"></span><span class="comment" id="4737393">//&nbsp;The&nbsp;empty&nbsp;values&nbsp;are&nbsp;false,&nbsp;0,&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="4737431">//&nbsp;nil&nbsp;pointer&nbsp;or&nbsp;interface&nbsp;value,&nbsp;and&nbsp;any&nbsp;array,&nbsp;slice,&nbsp;map,&nbsp;or&nbsp;string&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4737506">//&nbsp;length&nbsp;zero.&nbsp;The&nbsp;object&#39;s&nbsp;default&nbsp;key&nbsp;string&nbsp;is&nbsp;the&nbsp;struct&nbsp;field&nbsp;name</span><br>
<span class="lineno">60</span><span class="comment" id="4737579">//&nbsp;but&nbsp;can&nbsp;be&nbsp;specified&nbsp;in&nbsp;the&nbsp;struct&nbsp;field&#39;s&nbsp;tag&nbsp;value.&nbsp;The&nbsp;&#34;json&#34;&nbsp;key&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="4737654">//&nbsp;the&nbsp;struct&nbsp;field&#39;s&nbsp;tag&nbsp;value&nbsp;is&nbsp;the&nbsp;key&nbsp;name,&nbsp;followed&nbsp;by&nbsp;an&nbsp;optional&nbsp;comma</span><br>
<span class="lineno"></span><span class="comment" id="4737733">//&nbsp;and&nbsp;options.&nbsp;Examples:</span><br>
<span class="lineno"></span><span class="comment" id="4737759">//</span><br>
<span class="lineno"></span><span class="comment" id="4737762">//&nbsp;&nbsp;&nbsp;//&nbsp;Field&nbsp;is&nbsp;ignored&nbsp;by&nbsp;this&nbsp;package.</span><br>
<span class="lineno">65</span><span class="comment" id="4737804">//&nbsp;&nbsp;&nbsp;Field&nbsp;int&nbsp;`json:&#34;-&#34;`</span><br>
<span class="lineno"></span><span class="comment" id="4737830">//</span><br>
<span class="lineno"></span><span class="comment" id="4737833">//&nbsp;&nbsp;&nbsp;//&nbsp;Field&nbsp;appears&nbsp;in&nbsp;JSON&nbsp;as&nbsp;key&nbsp;&#34;myName&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="4737880">//&nbsp;&nbsp;&nbsp;Field&nbsp;int&nbsp;`json:&#34;myName&#34;`</span><br>
<span class="lineno"></span><span class="comment" id="4737911">//</span><br>
<span class="lineno">70</span><span class="comment" id="4737914">//&nbsp;&nbsp;&nbsp;//&nbsp;Field&nbsp;appears&nbsp;in&nbsp;JSON&nbsp;as&nbsp;key&nbsp;&#34;myName&#34;&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4737964">//&nbsp;&nbsp;&nbsp;//&nbsp;the&nbsp;field&nbsp;is&nbsp;omitted&nbsp;from&nbsp;the&nbsp;object&nbsp;if&nbsp;its&nbsp;value&nbsp;is&nbsp;empty,</span><br>
<span class="lineno"></span><span class="comment" id="4738032">//&nbsp;&nbsp;&nbsp;//&nbsp;as&nbsp;defined&nbsp;above.</span><br>
<span class="lineno"></span><span class="comment" id="4738058">//&nbsp;&nbsp;&nbsp;Field&nbsp;int&nbsp;`json:&#34;myName,omitempty&#34;`</span><br>
<span class="lineno"></span><span class="comment" id="4738099">//</span><br>
<span class="lineno">75</span><span class="comment" id="4738102">//&nbsp;&nbsp;&nbsp;//&nbsp;Field&nbsp;appears&nbsp;in&nbsp;JSON&nbsp;as&nbsp;key&nbsp;&#34;Field&#34;&nbsp;(the&nbsp;default),&nbsp;but</span><br>
<span class="lineno"></span><span class="comment" id="4738166">//&nbsp;&nbsp;&nbsp;//&nbsp;the&nbsp;field&nbsp;is&nbsp;skipped&nbsp;if&nbsp;empty.</span><br>
<span class="lineno"></span><span class="comment" id="4738205">//&nbsp;&nbsp;&nbsp;//&nbsp;Note&nbsp;the&nbsp;leading&nbsp;comma.</span><br>
<span class="lineno"></span><span class="comment" id="4738237">//&nbsp;&nbsp;&nbsp;Field&nbsp;int&nbsp;`json:&#34;,omitempty&#34;`</span><br>
<span class="lineno"></span><span class="comment" id="4738272">//</span><br>
<span class="lineno">80</span><span class="comment" id="4738275">//&nbsp;The&nbsp;&#34;string&#34;&nbsp;option&nbsp;signals&nbsp;that&nbsp;a&nbsp;field&nbsp;is&nbsp;stored&nbsp;as&nbsp;JSON&nbsp;inside&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4738346">//&nbsp;JSON-encoded&nbsp;string.&nbsp;It&nbsp;applies&nbsp;only&nbsp;to&nbsp;fields&nbsp;of&nbsp;string,&nbsp;floating&nbsp;point,</span><br>
<span class="lineno"></span><span class="comment" id="4738423">//&nbsp;or&nbsp;integer&nbsp;types.&nbsp;This&nbsp;extra&nbsp;level&nbsp;of&nbsp;encoding&nbsp;is&nbsp;sometimes&nbsp;used&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="4738496">//&nbsp;communicating&nbsp;with&nbsp;JavaScript&nbsp;programs:</span><br>
<span class="lineno"></span><span class="comment" id="4738539">//</span><br>
<span class="lineno">85</span><span class="comment" id="4738542">//&nbsp;&nbsp;&nbsp;&nbsp;Int64String&nbsp;int64&nbsp;`json:&#34;,string&#34;`</span><br>
<span class="lineno"></span><span class="comment" id="4738583">//</span><br>
<span class="lineno"></span><span class="comment" id="4738586">//&nbsp;The&nbsp;key&nbsp;name&nbsp;will&nbsp;be&nbsp;used&nbsp;if&nbsp;it&#39;s&nbsp;a&nbsp;non-empty&nbsp;string&nbsp;consisting&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4738656">//&nbsp;only&nbsp;Unicode&nbsp;letters,&nbsp;digits,&nbsp;dollar&nbsp;signs,&nbsp;percent&nbsp;signs,&nbsp;hyphens,</span><br>
<span class="lineno"></span><span class="comment" id="4738727">//&nbsp;underscores&nbsp;and&nbsp;slashes.</span><br>
<span class="lineno">90</span><span class="comment" id="4738755">//</span><br>
<span class="lineno"></span><span class="comment" id="4738758">//&nbsp;Anonymous&nbsp;struct&nbsp;fields&nbsp;are&nbsp;usually&nbsp;marshaled&nbsp;as&nbsp;if&nbsp;their&nbsp;inner&nbsp;exported&nbsp;fields</span><br>
<span class="lineno"></span><span class="comment" id="4738841">//&nbsp;were&nbsp;fields&nbsp;in&nbsp;the&nbsp;outer&nbsp;struct,&nbsp;subject&nbsp;to&nbsp;the&nbsp;usual&nbsp;Go&nbsp;visibility&nbsp;rules&nbsp;amended</span><br>
<span class="lineno"></span><span class="comment" id="4738926">//&nbsp;as&nbsp;described&nbsp;in&nbsp;the&nbsp;next&nbsp;paragraph.</span><br>
<span class="lineno"></span><span class="comment" id="4738965">//&nbsp;An&nbsp;anonymous&nbsp;struct&nbsp;field&nbsp;with&nbsp;a&nbsp;name&nbsp;given&nbsp;in&nbsp;its&nbsp;JSON&nbsp;tag&nbsp;is&nbsp;treated&nbsp;as</span><br>
<span class="lineno">95</span><span class="comment" id="4739042">//&nbsp;having&nbsp;that&nbsp;name,&nbsp;rather&nbsp;than&nbsp;being&nbsp;anonymous.</span><br>
<span class="lineno"></span><span class="comment" id="4739092">//&nbsp;An&nbsp;anonymous&nbsp;struct&nbsp;field&nbsp;of&nbsp;interface&nbsp;type&nbsp;is&nbsp;treated&nbsp;the&nbsp;same&nbsp;as&nbsp;having</span><br>
<span class="lineno"></span><span class="comment" id="4739169">//&nbsp;that&nbsp;type&nbsp;as&nbsp;its&nbsp;name,&nbsp;rather&nbsp;than&nbsp;being&nbsp;anonymous.</span><br>
<span class="lineno"></span><span class="comment" id="4739224">//</span><br>
<span class="lineno"></span><span class="comment" id="4739227">//&nbsp;The&nbsp;Go&nbsp;visibility&nbsp;rules&nbsp;for&nbsp;struct&nbsp;fields&nbsp;are&nbsp;amended&nbsp;for&nbsp;JSON&nbsp;when</span><br>
<span class="lineno">100</span><span class="comment" id="4739298">//&nbsp;deciding&nbsp;which&nbsp;field&nbsp;to&nbsp;marshal&nbsp;or&nbsp;unmarshal.&nbsp;If&nbsp;there&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="4739360">//&nbsp;multiple&nbsp;fields&nbsp;at&nbsp;the&nbsp;same&nbsp;level,&nbsp;and&nbsp;that&nbsp;level&nbsp;is&nbsp;the&nbsp;least</span><br>
<span class="lineno"></span><span class="comment" id="4739426">//&nbsp;nested&nbsp;(and&nbsp;would&nbsp;therefore&nbsp;be&nbsp;the&nbsp;nesting&nbsp;level&nbsp;selected&nbsp;by&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4739494">//&nbsp;usual&nbsp;Go&nbsp;rules),&nbsp;the&nbsp;following&nbsp;extra&nbsp;rules&nbsp;apply:</span><br>
<span class="lineno"></span><span class="comment" id="4739547">//</span><br>
<span class="lineno">105</span><span class="comment" id="4739550">//&nbsp;1)&nbsp;Of&nbsp;those&nbsp;fields,&nbsp;if&nbsp;any&nbsp;are&nbsp;JSON-tagged,&nbsp;only&nbsp;tagged&nbsp;fields&nbsp;are&nbsp;considered,</span><br>
<span class="lineno"></span><span class="comment" id="4739632">//&nbsp;even&nbsp;if&nbsp;there&nbsp;are&nbsp;multiple&nbsp;untagged&nbsp;fields&nbsp;that&nbsp;would&nbsp;otherwise&nbsp;conflict.</span><br>
<span class="lineno"></span><span class="comment" id="4739709">//&nbsp;2)&nbsp;If&nbsp;there&nbsp;is&nbsp;exactly&nbsp;one&nbsp;field&nbsp;(tagged&nbsp;or&nbsp;not&nbsp;according&nbsp;to&nbsp;the&nbsp;first&nbsp;rule),&nbsp;that&nbsp;is&nbsp;selected.</span><br>
<span class="lineno"></span><span class="comment" id="4739808">//&nbsp;3)&nbsp;Otherwise&nbsp;there&nbsp;are&nbsp;multiple&nbsp;fields,&nbsp;and&nbsp;all&nbsp;are&nbsp;ignored;&nbsp;no&nbsp;error&nbsp;occurs.</span><br>
<span class="lineno"></span><span class="comment" id="4739889">//</span><br>
<span class="lineno">110</span><span class="comment" id="4739892">//&nbsp;Handling&nbsp;of&nbsp;anonymous&nbsp;struct&nbsp;fields&nbsp;is&nbsp;new&nbsp;in&nbsp;Go&nbsp;1.1.</span><br>
<span class="lineno"></span><span class="comment" id="4739949">//&nbsp;Prior&nbsp;to&nbsp;Go&nbsp;1.1,&nbsp;anonymous&nbsp;struct&nbsp;fields&nbsp;were&nbsp;ignored.&nbsp;To&nbsp;force&nbsp;ignoring&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4740028">//&nbsp;an&nbsp;anonymous&nbsp;struct&nbsp;field&nbsp;in&nbsp;both&nbsp;current&nbsp;and&nbsp;earlier&nbsp;versions,&nbsp;give&nbsp;the&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="4740110">//&nbsp;a&nbsp;JSON&nbsp;tag&nbsp;of&nbsp;&#34;-&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="4740132">//</span><br>
<span class="lineno">115</span><span class="comment" id="4740135">//&nbsp;Map&nbsp;values&nbsp;encode&nbsp;as&nbsp;JSON&nbsp;objects.</span><br>
<span class="lineno"></span><span class="comment" id="4740173">//&nbsp;The&nbsp;map&#39;s&nbsp;key&nbsp;type&nbsp;must&nbsp;be&nbsp;string;&nbsp;the&nbsp;object&nbsp;keys&nbsp;are&nbsp;used&nbsp;directly</span><br>
<span class="lineno"></span><span class="comment" id="4740245">//&nbsp;as&nbsp;map&nbsp;keys.</span><br>
<span class="lineno"></span><span class="comment" id="4740261">//</span><br>
<span class="lineno"></span><span class="comment" id="4740264">//&nbsp;Pointer&nbsp;values&nbsp;encode&nbsp;as&nbsp;the&nbsp;value&nbsp;pointed&nbsp;to.</span><br>
<span class="lineno">120</span><span class="comment" id="4740314">//&nbsp;A&nbsp;nil&nbsp;pointer&nbsp;encodes&nbsp;as&nbsp;the&nbsp;null&nbsp;JSON&nbsp;object.</span><br>
<span class="lineno"></span><span class="comment" id="4740364">//</span><br>
<span class="lineno"></span><span class="comment" id="4740367">//&nbsp;Interface&nbsp;values&nbsp;encode&nbsp;as&nbsp;the&nbsp;value&nbsp;contained&nbsp;in&nbsp;the&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="4740435">//&nbsp;A&nbsp;nil&nbsp;interface&nbsp;value&nbsp;encodes&nbsp;as&nbsp;the&nbsp;null&nbsp;JSON&nbsp;object.</span><br>
<span class="lineno"></span><span class="comment" id="4740493">//</span><br>
<span class="lineno">125</span><span class="comment" id="4740496">//&nbsp;Channel,&nbsp;complex,&nbsp;and&nbsp;function&nbsp;values&nbsp;cannot&nbsp;be&nbsp;encoded&nbsp;in&nbsp;JSON.</span><br>
<span class="lineno"></span><span class="comment" id="4740564">//&nbsp;Attempting&nbsp;to&nbsp;encode&nbsp;such&nbsp;a&nbsp;value&nbsp;causes&nbsp;Marshal&nbsp;to&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="4740626">//&nbsp;an&nbsp;UnsupportedTypeError.</span><br>
<span class="lineno"></span><span class="comment" id="4740654">//</span><br>
<span class="lineno"></span><span class="comment" id="4740657">//&nbsp;JSON&nbsp;cannot&nbsp;represent&nbsp;cyclic&nbsp;data&nbsp;structures&nbsp;and&nbsp;Marshal&nbsp;does&nbsp;not</span><br>
<span class="lineno">130</span><span class="comment" id="4740726">//&nbsp;handle&nbsp;them.&nbsp;&nbsp;Passing&nbsp;cyclic&nbsp;structures&nbsp;to&nbsp;Marshal&nbsp;will&nbsp;result&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="4740795">//&nbsp;an&nbsp;infinite&nbsp;recursion.</span><br>
<span class="lineno"></span><span class="comment" id="4740821">//</span><br>
<span class="lineno"></span><span class="keyword" id="4740824">func</span>&nbsp;<span class="ident" id="4740829">Marshal</span><span class="op" id="4740836">(</span><span class="ident" id="4740837">v</span>&nbsp;<span class="keyword" id="4740839">interface</span><span class="op" id="4740848">{</span><span class="op" id="4740849">}</span><span class="op" id="4740850">)</span>&nbsp;<span class="op" id="4740852">(</span><span class="op" id="4740853">[</span><span class="op" id="4740854">]</span><span class="builtintype" id="4740855">byte</span><span class="op" id="4740859">,</span>&nbsp;<span class="builtintype" id="4740861">error</span><span class="op" id="4740866">)</span>&nbsp;<span class="op" id="4740868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4740871">e</span>&nbsp;<span class="op" id="4740873">:=</span>&nbsp;<span class="op" id="4740876">&amp;</span><span class="ident" id="4740877">encodeState</span><span class="op" id="4740888">{</span><span class="op" id="4740889">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4740892">err</span>&nbsp;<span class="op" id="4740896">:=</span>&nbsp;<span class="ident" id="4740899">e</span><span class="op" id="4740900">.</span><span class="ident" id="4740901">marshal</span><span class="op" id="4740908">(</span><span class="ident" id="4740909">v</span><span class="op" id="4740910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4740913">if</span>&nbsp;<span class="ident" id="4740916">err</span>&nbsp;<span class="op" id="4740920">!=</span>&nbsp;<span class="ident" id="4740923">nil</span>&nbsp;<span class="op" id="4740927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4740931">return</span>&nbsp;<span class="ident" id="4740938">nil</span><span class="op" id="4740941">,</span>&nbsp;<span class="ident" id="4740943">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4740948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4740951">return</span>&nbsp;<span class="ident" id="4740958">e</span><span class="op" id="4740959">.</span><span class="ident" id="4740960">Bytes</span><span class="op" id="4740965">(</span><span class="op" id="4740966">)</span><span class="op" id="4740967">,</span>&nbsp;<span class="ident" id="4740969">nil</span><br>
<span class="lineno">140</span><span class="op" id="4740973">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4740976">//&nbsp;MarshalIndent&nbsp;is&nbsp;like&nbsp;Marshal&nbsp;but&nbsp;applies&nbsp;Indent&nbsp;to&nbsp;format&nbsp;the&nbsp;output.</span><br>
<span class="lineno"></span><span class="keyword" id="4741050">func</span>&nbsp;<span class="ident" id="4741055">MarshalIndent</span><span class="op" id="4741068">(</span><span class="ident" id="4741069">v</span>&nbsp;<span class="keyword" id="4741071">interface</span><span class="op" id="4741080">{</span><span class="op" id="4741081">}</span><span class="op" id="4741082">,</span>&nbsp;<span class="ident" id="4741084">prefix</span><span class="op" id="4741090">,</span>&nbsp;<span class="ident" id="4741092">indent</span>&nbsp;<span class="builtintype" id="4741099">string</span><span class="op" id="4741105">)</span>&nbsp;<span class="op" id="4741107">(</span><span class="op" id="4741108">[</span><span class="op" id="4741109">]</span><span class="builtintype" id="4741110">byte</span><span class="op" id="4741114">,</span>&nbsp;<span class="builtintype" id="4741116">error</span><span class="op" id="4741121">)</span>&nbsp;<span class="op" id="4741123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4741126">b</span><span class="op" id="4741127">,</span>&nbsp;<span class="ident" id="4741129">err</span>&nbsp;<span class="op" id="4741133">:=</span>&nbsp;<span class="ident" id="4741136">Marshal</span><span class="op" id="4741143">(</span><span class="ident" id="4741144">v</span><span class="op" id="4741145">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4741148">if</span>&nbsp;<span class="ident" id="4741151">err</span>&nbsp;<span class="op" id="4741155">!=</span>&nbsp;<span class="ident" id="4741158">nil</span>&nbsp;<span class="op" id="4741162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4741166">return</span>&nbsp;<span class="ident" id="4741173">nil</span><span class="op" id="4741176">,</span>&nbsp;<span class="ident" id="4741178">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4741183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4741186">var</span>&nbsp;<span class="ident" id="4741190">buf</span>&nbsp;<span class="ident" id="4741194">bytes</span><span class="op" id="4741199">.</span><span class="ident" id="4741200">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4741208">err</span>&nbsp;<span class="op" id="4741212">=</span>&nbsp;<span class="ident" id="4741214">Indent</span><span class="op" id="4741220">(</span><span class="op" id="4741221">&amp;</span><span class="ident" id="4741222">buf</span><span class="op" id="4741225">,</span>&nbsp;<span class="ident" id="4741227">b</span><span class="op" id="4741228">,</span>&nbsp;<span class="ident" id="4741230">prefix</span><span class="op" id="4741236">,</span>&nbsp;<span class="ident" id="4741238">indent</span><span class="op" id="4741244">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4741247">if</span>&nbsp;<span class="ident" id="4741250">err</span>&nbsp;<span class="op" id="4741254">!=</span>&nbsp;<span class="ident" id="4741257">nil</span>&nbsp;<span class="op" id="4741261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4741265">return</span>&nbsp;<span class="ident" id="4741272">nil</span><span class="op" id="4741275">,</span>&nbsp;<span class="ident" id="4741277">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4741282">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4741285">return</span>&nbsp;<span class="ident" id="4741292">buf</span><span class="op" id="4741295">.</span><span class="ident" id="4741296">Bytes</span><span class="op" id="4741301">(</span><span class="op" id="4741302">)</span><span class="op" id="4741303">,</span>&nbsp;<span class="ident" id="4741305">nil</span><br>
<span class="lineno"></span><span class="op" id="4741309">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="comment" id="4741312">//&nbsp;HTMLEscape&nbsp;appends&nbsp;to&nbsp;dst&nbsp;the&nbsp;JSON-encoded&nbsp;src&nbsp;with&nbsp;&lt;,&nbsp;&gt;,&nbsp;&amp;,&nbsp;U+2028&nbsp;and&nbsp;U+2029</span><br>
<span class="lineno"></span><span class="comment" id="4741394">//&nbsp;characters&nbsp;inside&nbsp;string&nbsp;literals&nbsp;changed&nbsp;to&nbsp;\u003c,&nbsp;\u003e,&nbsp;\u0026,&nbsp;\u2028,&nbsp;\u2029</span><br>
<span class="lineno"></span><span class="comment" id="4741481">//&nbsp;so&nbsp;that&nbsp;the&nbsp;JSON&nbsp;will&nbsp;be&nbsp;safe&nbsp;to&nbsp;embed&nbsp;inside&nbsp;HTML&nbsp;&lt;script&gt;&nbsp;tags.</span><br>
<span class="lineno"></span><span class="comment" id="4741550">//&nbsp;For&nbsp;historical&nbsp;reasons,&nbsp;web&nbsp;browsers&nbsp;don&#39;t&nbsp;honor&nbsp;standard&nbsp;HTML</span><br>
<span class="lineno">160</span><span class="comment" id="4741616">//&nbsp;escaping&nbsp;within&nbsp;&lt;script&gt;&nbsp;tags,&nbsp;so&nbsp;an&nbsp;alternative&nbsp;JSON&nbsp;encoding&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="4741687">//&nbsp;be&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="4741699">func</span>&nbsp;<span class="ident" id="4741704">HTMLEscape</span><span class="op" id="4741714">(</span><span class="ident" id="4741715">dst</span>&nbsp;<span class="op" id="4741719">*</span><span class="ident" id="4741720">bytes</span><span class="op" id="4741725">.</span><span class="ident" id="4741726">Buffer</span><span class="op" id="4741732">,</span>&nbsp;<span class="ident" id="4741734">src</span>&nbsp;<span class="op" id="4741738">[</span><span class="op" id="4741739">]</span><span class="builtintype" id="4741740">byte</span><span class="op" id="4741744">)</span>&nbsp;<span class="op" id="4741746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4741749">//&nbsp;The&nbsp;characters&nbsp;can&nbsp;only&nbsp;appear&nbsp;in&nbsp;string&nbsp;literals,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4741804">//&nbsp;so&nbsp;just&nbsp;scan&nbsp;the&nbsp;string&nbsp;one&nbsp;byte&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4741852">start</span>&nbsp;<span class="op" id="4741858">:=</span>&nbsp;<span class="num" id="4741861">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4741864">for</span>&nbsp;<span class="ident" id="4741868">i</span><span class="op" id="4741869">,</span>&nbsp;<span class="ident" id="4741871">c</span>&nbsp;<span class="op" id="4741873">:=</span>&nbsp;<span class="keyword" id="4741876">range</span>&nbsp;<span class="ident" id="4741882">src</span>&nbsp;<span class="op" id="4741886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4741890">if</span>&nbsp;<span class="ident" id="4741893">c</span>&nbsp;<span class="op" id="4741895">==</span>&nbsp;<span class="string" id="4741898">&#39;&lt;&#39;</span>&nbsp;<span class="op" id="4741902">||</span>&nbsp;<span class="ident" id="4741905">c</span>&nbsp;<span class="op" id="4741907">==</span>&nbsp;<span class="string" id="4741910">&#39;&gt;&#39;</span>&nbsp;<span class="op" id="4741914">||</span>&nbsp;<span class="ident" id="4741917">c</span>&nbsp;<span class="op" id="4741919">==</span>&nbsp;<span class="string" id="4741922">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="4741926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4741931">if</span>&nbsp;<span class="ident" id="4741934">start</span>&nbsp;<span class="op" id="4741940">&lt;</span>&nbsp;<span class="ident" id="4741942">i</span>&nbsp;<span class="op" id="4741944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4741950">dst</span><span class="op" id="4741953">.</span><span class="ident" id="4741954">Write</span><span class="op" id="4741959">(</span><span class="ident" id="4741960">src</span><span class="op" id="4741963">[</span><span class="ident" id="4741964">start</span><span class="op" id="4741969">:</span><span class="ident" id="4741970">i</span><span class="op" id="4741971">]</span><span class="op" id="4741972">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4741977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4741982">dst</span><span class="op" id="4741985">.</span><span class="ident" id="4741986">WriteString</span><span class="op" id="4741997">(</span><span class="string" id="4741998">`\u00`</span><span class="op" id="4742004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4742009">dst</span><span class="op" id="4742012">.</span><span class="ident" id="4742013">WriteByte</span><span class="op" id="4742022">(</span><span class="ident" id="4742023">hex</span><span class="op" id="4742026">[</span><span class="ident" id="4742027">c</span><span class="op" id="4742028">&gt;&gt;</span><span class="num" id="4742030">4</span><span class="op" id="4742031">]</span><span class="op" id="4742032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4742037">dst</span><span class="op" id="4742040">.</span><span class="ident" id="4742041">WriteByte</span><span class="op" id="4742050">(</span><span class="ident" id="4742051">hex</span><span class="op" id="4742054">[</span><span class="ident" id="4742055">c</span><span class="op" id="4742056">&amp;</span><span class="num" id="4742057">0xF</span><span class="op" id="4742060">]</span><span class="op" id="4742061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4742066">start</span>&nbsp;<span class="op" id="4742072">=</span>&nbsp;<span class="ident" id="4742074">i</span>&nbsp;<span class="op" id="4742076">+</span>&nbsp;<span class="num" id="4742078">1</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4742082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4742086">//&nbsp;Convert&nbsp;U+2028&nbsp;and&nbsp;U+2029&nbsp;(E2&nbsp;80&nbsp;A8&nbsp;and&nbsp;E2&nbsp;80&nbsp;A9).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4742142">if</span>&nbsp;<span class="ident" id="4742145">c</span>&nbsp;<span class="op" id="4742147">==</span>&nbsp;<span class="num" id="4742150">0xE2</span>&nbsp;<span class="op" id="4742155">&amp;&amp;</span>&nbsp;<span class="ident" id="4742158">i</span><span class="op" id="4742159">+</span><span class="num" id="4742160">2</span>&nbsp;<span class="op" id="4742162">&lt;</span>&nbsp;<span class="builtinfunc" id="4742164">len</span><span class="op" id="4742167">(</span><span class="ident" id="4742168">src</span><span class="op" id="4742171">)</span>&nbsp;<span class="op" id="4742173">&amp;&amp;</span>&nbsp;<span class="ident" id="4742176">src</span><span class="op" id="4742179">[</span><span class="ident" id="4742180">i</span><span class="op" id="4742181">+</span><span class="num" id="4742182">1</span><span class="op" id="4742183">]</span>&nbsp;<span class="op" id="4742185">==</span>&nbsp;<span class="num" id="4742188">0x80</span>&nbsp;<span class="op" id="4742193">&amp;&amp;</span>&nbsp;<span class="ident" id="4742196">src</span><span class="op" id="4742199">[</span><span class="ident" id="4742200">i</span><span class="op" id="4742201">+</span><span class="num" id="4742202">2</span><span class="op" id="4742203">]</span><span class="op" id="4742204">&amp;^</span><span class="num" id="4742206">1</span>&nbsp;<span class="op" id="4742208">==</span>&nbsp;<span class="num" id="4742211">0xA8</span>&nbsp;<span class="op" id="4742216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4742221">if</span>&nbsp;<span class="ident" id="4742224">start</span>&nbsp;<span class="op" id="4742230">&lt;</span>&nbsp;<span class="ident" id="4742232">i</span>&nbsp;<span class="op" id="4742234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4742240">dst</span><span class="op" id="4742243">.</span><span class="ident" id="4742244">Write</span><span class="op" id="4742249">(</span><span class="ident" id="4742250">src</span><span class="op" id="4742253">[</span><span class="ident" id="4742254">start</span><span class="op" id="4742259">:</span><span class="ident" id="4742260">i</span><span class="op" id="4742261">]</span><span class="op" id="4742262">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4742267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4742272">dst</span><span class="op" id="4742275">.</span><span class="ident" id="4742276">WriteString</span><span class="op" id="4742287">(</span><span class="string" id="4742288">`\u202`</span><span class="op" id="4742295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4742300">dst</span><span class="op" id="4742303">.</span><span class="ident" id="4742304">WriteByte</span><span class="op" id="4742313">(</span><span class="ident" id="4742314">hex</span><span class="op" id="4742317">[</span><span class="ident" id="4742318">src</span><span class="op" id="4742321">[</span><span class="ident" id="4742322">i</span><span class="op" id="4742323">+</span><span class="num" id="4742324">2</span><span class="op" id="4742325">]</span><span class="op" id="4742326">&amp;</span><span class="num" id="4742327">0xF</span><span class="op" id="4742330">]</span><span class="op" id="4742331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4742336">start</span>&nbsp;<span class="op" id="4742342">=</span>&nbsp;<span class="ident" id="4742344">i</span>&nbsp;<span class="op" id="4742346">+</span>&nbsp;<span class="num" id="4742348">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4742352">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4742355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4742358">if</span>&nbsp;<span class="ident" id="4742361">start</span>&nbsp;<span class="op" id="4742367">&lt;</span>&nbsp;<span class="builtinfunc" id="4742369">len</span><span class="op" id="4742372">(</span><span class="ident" id="4742373">src</span><span class="op" id="4742376">)</span>&nbsp;<span class="op" id="4742378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4742382">dst</span><span class="op" id="4742385">.</span><span class="ident" id="4742386">Write</span><span class="op" id="4742391">(</span><span class="ident" id="4742392">src</span><span class="op" id="4742395">[</span><span class="ident" id="4742396">start</span><span class="op" id="4742401">:</span><span class="op" id="4742402">]</span><span class="op" id="4742403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4742406">}</span><br>
<span class="lineno"></span><span class="op" id="4742408">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="comment" id="4742411">//&nbsp;Marshaler&nbsp;is&nbsp;the&nbsp;interface&nbsp;implemented&nbsp;by&nbsp;objects&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4742469">//&nbsp;can&nbsp;marshal&nbsp;themselves&nbsp;into&nbsp;valid&nbsp;JSON.</span><br>
<span class="lineno"></span><span class="keyword" id="4742512">type</span>&nbsp;<span class="ident" id="4742517">Marshaler</span>&nbsp;<span class="keyword" id="4742527">interface</span>&nbsp;<span class="op" id="4742537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4742540">MarshalJSON</span><span class="op" id="4742551">(</span><span class="op" id="4742552">)</span>&nbsp;<span class="op" id="4742554">(</span><span class="op" id="4742555">[</span><span class="op" id="4742556">]</span><span class="builtintype" id="4742557">byte</span><span class="op" id="4742561">,</span>&nbsp;<span class="builtintype" id="4742563">error</span><span class="op" id="4742568">)</span><br>
<span class="lineno">195</span><span class="op" id="4742570">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4742573">//&nbsp;An&nbsp;UnsupportedTypeError&nbsp;is&nbsp;returned&nbsp;by&nbsp;Marshal&nbsp;when&nbsp;attempting</span><br>
<span class="lineno"></span><span class="comment" id="4742639">//&nbsp;to&nbsp;encode&nbsp;an&nbsp;unsupported&nbsp;value&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="4742679">type</span>&nbsp;<span class="ident" id="4742684">UnsupportedTypeError</span>&nbsp;<span class="keyword" id="4742705">struct</span>&nbsp;<span class="op" id="4742712">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4742715">Type</span>&nbsp;<span class="ident" id="4742720">reflect</span><span class="op" id="4742727">.</span><span class="ident" id="4742728">Type</span><br>
<span class="lineno"></span><span class="op" id="4742733">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4742736">func</span>&nbsp;<span class="op" id="4742741">(</span><span class="ident" id="4742742">e</span>&nbsp;<span class="op" id="4742744">*</span><span class="ident" id="4742745">UnsupportedTypeError</span><span class="op" id="4742765">)</span>&nbsp;<span class="ident" id="4742767">Error</span><span class="op" id="4742772">(</span><span class="op" id="4742773">)</span>&nbsp;<span class="builtintype" id="4742775">string</span>&nbsp;<span class="op" id="4742782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4742785">return</span>&nbsp;<span class="string" id="4742792">&#34;json:&nbsp;unsupported&nbsp;type:&nbsp;&#34;</span>&nbsp;<span class="op" id="4742819">+</span>&nbsp;<span class="ident" id="4742821">e</span><span class="op" id="4742822">.</span><span class="ident" id="4742823">Type</span><span class="op" id="4742827">.</span><span class="ident" id="4742828">String</span><span class="op" id="4742834">(</span><span class="op" id="4742835">)</span><br>
<span class="lineno">205</span><span class="op" id="4742837">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4742840">type</span>&nbsp;<span class="ident" id="4742845">UnsupportedValueError</span>&nbsp;<span class="keyword" id="4742867">struct</span>&nbsp;<span class="op" id="4742874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4742877">Value</span>&nbsp;<span class="ident" id="4742883">reflect</span><span class="op" id="4742890">.</span><span class="ident" id="4742891">Value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4742898">Str</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4742904">string</span><br>
<span class="lineno">210</span><span class="op" id="4742911">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4742914">func</span>&nbsp;<span class="op" id="4742919">(</span><span class="ident" id="4742920">e</span>&nbsp;<span class="op" id="4742922">*</span><span class="ident" id="4742923">UnsupportedValueError</span><span class="op" id="4742944">)</span>&nbsp;<span class="ident" id="4742946">Error</span><span class="op" id="4742951">(</span><span class="op" id="4742952">)</span>&nbsp;<span class="builtintype" id="4742954">string</span>&nbsp;<span class="op" id="4742961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4742964">return</span>&nbsp;<span class="string" id="4742971">&#34;json:&nbsp;unsupported&nbsp;value:&nbsp;&#34;</span>&nbsp;<span class="op" id="4742999">+</span>&nbsp;<span class="ident" id="4743001">e</span><span class="op" id="4743002">.</span><span class="ident" id="4743003">Str</span><br>
<span class="lineno"></span><span class="op" id="4743007">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span><span class="comment" id="4743010">//&nbsp;Before&nbsp;Go&nbsp;1.2,&nbsp;an&nbsp;InvalidUTF8Error&nbsp;was&nbsp;returned&nbsp;by&nbsp;Marshal&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="4743077">//&nbsp;attempting&nbsp;to&nbsp;encode&nbsp;a&nbsp;string&nbsp;value&nbsp;with&nbsp;invalid&nbsp;UTF-8&nbsp;sequences.</span><br>
<span class="lineno"></span><span class="comment" id="4743146">//&nbsp;As&nbsp;of&nbsp;Go&nbsp;1.2,&nbsp;Marshal&nbsp;instead&nbsp;coerces&nbsp;the&nbsp;string&nbsp;to&nbsp;valid&nbsp;UTF-8&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="4743216">//&nbsp;replacing&nbsp;invalid&nbsp;bytes&nbsp;with&nbsp;the&nbsp;Unicode&nbsp;replacement&nbsp;rune&nbsp;U+FFFD.</span><br>
<span class="lineno">220</span><span class="comment" id="4743285">//&nbsp;This&nbsp;error&nbsp;is&nbsp;no&nbsp;longer&nbsp;generated&nbsp;but&nbsp;is&nbsp;kept&nbsp;for&nbsp;backwards&nbsp;compatibility</span><br>
<span class="lineno"></span><span class="comment" id="4743362">//&nbsp;with&nbsp;programs&nbsp;that&nbsp;might&nbsp;mention&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="4743402">type</span>&nbsp;<span class="ident" id="4743407">InvalidUTF8Error</span>&nbsp;<span class="keyword" id="4743424">struct</span>&nbsp;<span class="op" id="4743431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4743434">S</span>&nbsp;<span class="builtintype" id="4743436">string</span>&nbsp;<span class="comment" id="4743443">//&nbsp;the&nbsp;whole&nbsp;string&nbsp;value&nbsp;that&nbsp;caused&nbsp;the&nbsp;error</span><br>
<span class="lineno"></span><span class="op" id="4743491">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="keyword" id="4743494">func</span>&nbsp;<span class="op" id="4743499">(</span><span class="ident" id="4743500">e</span>&nbsp;<span class="op" id="4743502">*</span><span class="ident" id="4743503">InvalidUTF8Error</span><span class="op" id="4743519">)</span>&nbsp;<span class="ident" id="4743521">Error</span><span class="op" id="4743526">(</span><span class="op" id="4743527">)</span>&nbsp;<span class="builtintype" id="4743529">string</span>&nbsp;<span class="op" id="4743536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4743539">return</span>&nbsp;<span class="string" id="4743546">&#34;json:&nbsp;invalid&nbsp;UTF-8&nbsp;in&nbsp;string:&nbsp;&#34;</span>&nbsp;<span class="op" id="4743580">+</span>&nbsp;<span class="ident" id="4743582">strconv</span><span class="op" id="4743589">.</span><span class="ident" id="4743590">Quote</span><span class="op" id="4743595">(</span><span class="ident" id="4743596">e</span><span class="op" id="4743597">.</span><span class="ident" id="4743598">S</span><span class="op" id="4743599">)</span><br>
<span class="lineno"></span><span class="op" id="4743601">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="4743604">type</span>&nbsp;<span class="ident" id="4743609">MarshalerError</span>&nbsp;<span class="keyword" id="4743624">struct</span>&nbsp;<span class="op" id="4743631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4743634">Type</span>&nbsp;<span class="ident" id="4743639">reflect</span><span class="op" id="4743646">.</span><span class="ident" id="4743647">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4743653">Err</span>&nbsp;&nbsp;<span class="builtintype" id="4743658">error</span><br>
<span class="lineno"></span><span class="op" id="4743664">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="keyword" id="4743667">func</span>&nbsp;<span class="op" id="4743672">(</span><span class="ident" id="4743673">e</span>&nbsp;<span class="op" id="4743675">*</span><span class="ident" id="4743676">MarshalerError</span><span class="op" id="4743690">)</span>&nbsp;<span class="ident" id="4743692">Error</span><span class="op" id="4743697">(</span><span class="op" id="4743698">)</span>&nbsp;<span class="builtintype" id="4743700">string</span>&nbsp;<span class="op" id="4743707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4743710">return</span>&nbsp;<span class="string" id="4743717">&#34;json:&nbsp;error&nbsp;calling&nbsp;MarshalJSON&nbsp;for&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="4743761">+</span>&nbsp;<span class="ident" id="4743763">e</span><span class="op" id="4743764">.</span><span class="ident" id="4743765">Type</span><span class="op" id="4743769">.</span><span class="ident" id="4743770">String</span><span class="op" id="4743776">(</span><span class="op" id="4743777">)</span>&nbsp;<span class="op" id="4743779">+</span>&nbsp;<span class="string" id="4743781">&#34;:&nbsp;&#34;</span>&nbsp;<span class="op" id="4743786">+</span>&nbsp;<span class="ident" id="4743788">e</span><span class="op" id="4743789">.</span><span class="ident" id="4743790">Err</span><span class="op" id="4743793">.</span><span class="ident" id="4743794">Error</span><span class="op" id="4743799">(</span><span class="op" id="4743800">)</span><br>
<span class="lineno"></span><span class="op" id="4743802">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4743805">var</span>&nbsp;<span class="ident" id="4743809">hex</span>&nbsp;<span class="op" id="4743813">=</span>&nbsp;<span class="string" id="4743815">&#34;0123456789abcdef&#34;</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="comment" id="4743835">//&nbsp;An&nbsp;encodeState&nbsp;encodes&nbsp;JSON&nbsp;into&nbsp;a&nbsp;bytes.Buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="4743887">type</span>&nbsp;<span class="ident" id="4743892">encodeState</span>&nbsp;<span class="keyword" id="4743904">struct</span>&nbsp;<span class="op" id="4743911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4743914">bytes</span><span class="op" id="4743919">.</span><span class="ident" id="4743920">Buffer</span>&nbsp;<span class="comment" id="4743927">//&nbsp;accumulated&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4743950">scratch</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4743963">[</span><span class="num" id="4743964">64</span><span class="op" id="4743966">]</span><span class="builtintype" id="4743967">byte</span><br>
<span class="lineno">245</span><span class="op" id="4743972">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4743975">var</span>&nbsp;<span class="ident" id="4743979">encodeStatePool</span>&nbsp;<span class="ident" id="4743995">sync</span><span class="op" id="4743999">.</span><span class="ident" id="4744000">Pool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4744006">func</span>&nbsp;<span class="ident" id="4744011">newEncodeState</span><span class="op" id="4744025">(</span><span class="op" id="4744026">)</span>&nbsp;<span class="op" id="4744028">*</span><span class="ident" id="4744029">encodeState</span>&nbsp;<span class="op" id="4744041">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4744044">if</span>&nbsp;<span class="ident" id="4744047">v</span>&nbsp;<span class="op" id="4744049">:=</span>&nbsp;<span class="ident" id="4744052">encodeStatePool</span><span class="op" id="4744067">.</span><span class="ident" id="4744068">Get</span><span class="op" id="4744071">(</span><span class="op" id="4744072">)</span><span class="op" id="4744073">;</span>&nbsp;<span class="ident" id="4744075">v</span>&nbsp;<span class="op" id="4744077">!=</span>&nbsp;<span class="ident" id="4744080">nil</span>&nbsp;<span class="op" id="4744084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4744088">e</span>&nbsp;<span class="op" id="4744090">:=</span>&nbsp;<span class="ident" id="4744093">v</span><span class="op" id="4744094">.</span><span class="op" id="4744095">(</span><span class="op" id="4744096">*</span><span class="ident" id="4744097">encodeState</span><span class="op" id="4744108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4744112">e</span><span class="op" id="4744113">.</span><span class="ident" id="4744114">Reset</span><span class="op" id="4744119">(</span><span class="op" id="4744120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4744124">return</span>&nbsp;<span class="ident" id="4744131">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4744134">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4744137">return</span>&nbsp;<span class="builtinfunc" id="4744144">new</span><span class="op" id="4744147">(</span><span class="ident" id="4744148">encodeState</span><span class="op" id="4744159">)</span><br>
<span class="lineno"></span><span class="op" id="4744161">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4744164">func</span>&nbsp;<span class="op" id="4744169">(</span><span class="ident" id="4744170">e</span>&nbsp;<span class="op" id="4744172">*</span><span class="ident" id="4744173">encodeState</span><span class="op" id="4744184">)</span>&nbsp;<span class="ident" id="4744186">marshal</span><span class="op" id="4744193">(</span><span class="ident" id="4744194">v</span>&nbsp;<span class="keyword" id="4744196">interface</span><span class="op" id="4744205">{</span><span class="op" id="4744206">}</span><span class="op" id="4744207">)</span>&nbsp;<span class="op" id="4744209">(</span><span class="ident" id="4744210">err</span>&nbsp;<span class="builtintype" id="4744214">error</span><span class="op" id="4744219">)</span>&nbsp;<span class="op" id="4744221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4744224">defer</span>&nbsp;<span class="keyword" id="4744230">func</span><span class="op" id="4744234">(</span><span class="op" id="4744235">)</span>&nbsp;<span class="op" id="4744237">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4744241">if</span>&nbsp;<span class="ident" id="4744244">r</span>&nbsp;<span class="op" id="4744246">:=</span>&nbsp;<span class="builtinfunc" id="4744249">recover</span><span class="op" id="4744256">(</span><span class="op" id="4744257">)</span><span class="op" id="4744258">;</span>&nbsp;<span class="ident" id="4744260">r</span>&nbsp;<span class="op" id="4744262">!=</span>&nbsp;<span class="ident" id="4744265">nil</span>&nbsp;<span class="op" id="4744269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4744274">if</span>&nbsp;<span class="ident" id="4744277">_</span><span class="op" id="4744278">,</span>&nbsp;<span class="ident" id="4744280">ok</span>&nbsp;<span class="op" id="4744283">:=</span>&nbsp;<span class="ident" id="4744286">r</span><span class="op" id="4744287">.</span><span class="op" id="4744288">(</span><span class="ident" id="4744289">runtime</span><span class="op" id="4744296">.</span><span class="ident" id="4744297">Error</span><span class="op" id="4744302">)</span><span class="op" id="4744303">;</span>&nbsp;<span class="ident" id="4744305">ok</span>&nbsp;<span class="op" id="4744308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4744314">panic</span><span class="op" id="4744319">(</span><span class="ident" id="4744320">r</span><span class="op" id="4744321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4744326">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4744331">if</span>&nbsp;<span class="ident" id="4744334">s</span><span class="op" id="4744335">,</span>&nbsp;<span class="ident" id="4744337">ok</span>&nbsp;<span class="op" id="4744340">:=</span>&nbsp;<span class="ident" id="4744343">r</span><span class="op" id="4744344">.</span><span class="op" id="4744345">(</span><span class="builtintype" id="4744346">string</span><span class="op" id="4744352">)</span><span class="op" id="4744353">;</span>&nbsp;<span class="ident" id="4744355">ok</span>&nbsp;<span class="op" id="4744358">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4744364">panic</span><span class="op" id="4744369">(</span><span class="ident" id="4744370">s</span><span class="op" id="4744371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4744376">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4744381">err</span>&nbsp;<span class="op" id="4744385">=</span>&nbsp;<span class="ident" id="4744387">r</span><span class="op" id="4744388">.</span><span class="op" id="4744389">(</span><span class="builtintype" id="4744390">error</span><span class="op" id="4744395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4744399">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4744402">}</span><span class="op" id="4744403">(</span><span class="op" id="4744404">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4744407">e</span><span class="op" id="4744408">.</span><span class="ident" id="4744409">reflectValue</span><span class="op" id="4744421">(</span><span class="ident" id="4744422">reflect</span><span class="op" id="4744429">.</span><span class="ident" id="4744430">ValueOf</span><span class="op" id="4744437">(</span><span class="ident" id="4744438">v</span><span class="op" id="4744439">)</span><span class="op" id="4744440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4744443">return</span>&nbsp;<span class="ident" id="4744450">nil</span><br>
<span class="lineno"></span><span class="op" id="4744454">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4744457">func</span>&nbsp;<span class="op" id="4744462">(</span><span class="ident" id="4744463">e</span>&nbsp;<span class="op" id="4744465">*</span><span class="ident" id="4744466">encodeState</span><span class="op" id="4744477">)</span>&nbsp;<span class="builtintype" id="4744479">error</span><span class="op" id="4744484">(</span><span class="ident" id="4744485">err</span>&nbsp;<span class="builtintype" id="4744489">error</span><span class="op" id="4744494">)</span>&nbsp;<span class="op" id="4744496">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4744499">panic</span><span class="op" id="4744504">(</span><span class="ident" id="4744505">err</span><span class="op" id="4744508">)</span><br>
<span class="lineno"></span><span class="op" id="4744510">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4744513">var</span>&nbsp;<span class="ident" id="4744517">byteSliceType</span>&nbsp;<span class="op" id="4744531">=</span>&nbsp;<span class="ident" id="4744533">reflect</span><span class="op" id="4744540">.</span><span class="ident" id="4744541">TypeOf</span><span class="op" id="4744547">(</span><span class="op" id="4744548">[</span><span class="op" id="4744549">]</span><span class="builtintype" id="4744550">byte</span><span class="op" id="4744554">(</span><span class="ident" id="4744555">nil</span><span class="op" id="4744558">)</span><span class="op" id="4744559">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span><span class="keyword" id="4744562">func</span>&nbsp;<span class="ident" id="4744567">isEmptyValue</span><span class="op" id="4744579">(</span><span class="ident" id="4744580">v</span>&nbsp;<span class="ident" id="4744582">reflect</span><span class="op" id="4744589">.</span><span class="ident" id="4744590">Value</span><span class="op" id="4744595">)</span>&nbsp;<span class="builtintype" id="4744597">bool</span>&nbsp;<span class="op" id="4744602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4744605">switch</span>&nbsp;<span class="ident" id="4744612">v</span><span class="op" id="4744613">.</span><span class="ident" id="4744614">Kind</span><span class="op" id="4744618">(</span><span class="op" id="4744619">)</span>&nbsp;<span class="op" id="4744621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4744624">case</span>&nbsp;<span class="ident" id="4744629">reflect</span><span class="op" id="4744636">.</span><span class="ident" id="4744637">Array</span><span class="op" id="4744642">,</span>&nbsp;<span class="ident" id="4744644">reflect</span><span class="op" id="4744651">.</span><span class="ident" id="4744652">Map</span><span class="op" id="4744655">,</span>&nbsp;<span class="ident" id="4744657">reflect</span><span class="op" id="4744664">.</span><span class="ident" id="4744665">Slice</span><span class="op" id="4744670">,</span>&nbsp;<span class="ident" id="4744672">reflect</span><span class="op" id="4744679">.</span><span class="ident" id="4744680">String</span><span class="op" id="4744686">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4744690">return</span>&nbsp;<span class="ident" id="4744697">v</span><span class="op" id="4744698">.</span><span class="ident" id="4744699">Len</span><span class="op" id="4744702">(</span><span class="op" id="4744703">)</span>&nbsp;<span class="op" id="4744705">==</span>&nbsp;<span class="num" id="4744708">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4744711">case</span>&nbsp;<span class="ident" id="4744716">reflect</span><span class="op" id="4744723">.</span><span class="ident" id="4744724">Bool</span><span class="op" id="4744728">:</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4744732">return</span>&nbsp;<span class="op" id="4744739">!</span><span class="ident" id="4744740">v</span><span class="op" id="4744741">.</span><span class="ident" id="4744742">Bool</span><span class="op" id="4744746">(</span><span class="op" id="4744747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4744750">case</span>&nbsp;<span class="ident" id="4744755">reflect</span><span class="op" id="4744762">.</span><span class="ident" id="4744763">Int</span><span class="op" id="4744766">,</span>&nbsp;<span class="ident" id="4744768">reflect</span><span class="op" id="4744775">.</span><span class="ident" id="4744776">Int8</span><span class="op" id="4744780">,</span>&nbsp;<span class="ident" id="4744782">reflect</span><span class="op" id="4744789">.</span><span class="ident" id="4744790">Int16</span><span class="op" id="4744795">,</span>&nbsp;<span class="ident" id="4744797">reflect</span><span class="op" id="4744804">.</span><span class="ident" id="4744805">Int32</span><span class="op" id="4744810">,</span>&nbsp;<span class="ident" id="4744812">reflect</span><span class="op" id="4744819">.</span><span class="ident" id="4744820">Int64</span><span class="op" id="4744825">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4744829">return</span>&nbsp;<span class="ident" id="4744836">v</span><span class="op" id="4744837">.</span><span class="ident" id="4744838">Int</span><span class="op" id="4744841">(</span><span class="op" id="4744842">)</span>&nbsp;<span class="op" id="4744844">==</span>&nbsp;<span class="num" id="4744847">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4744850">case</span>&nbsp;<span class="ident" id="4744855">reflect</span><span class="op" id="4744862">.</span><span class="ident" id="4744863">Uint</span><span class="op" id="4744867">,</span>&nbsp;<span class="ident" id="4744869">reflect</span><span class="op" id="4744876">.</span><span class="ident" id="4744877">Uint8</span><span class="op" id="4744882">,</span>&nbsp;<span class="ident" id="4744884">reflect</span><span class="op" id="4744891">.</span><span class="ident" id="4744892">Uint16</span><span class="op" id="4744898">,</span>&nbsp;<span class="ident" id="4744900">reflect</span><span class="op" id="4744907">.</span><span class="ident" id="4744908">Uint32</span><span class="op" id="4744914">,</span>&nbsp;<span class="ident" id="4744916">reflect</span><span class="op" id="4744923">.</span><span class="ident" id="4744924">Uint64</span><span class="op" id="4744930">,</span>&nbsp;<span class="ident" id="4744932">reflect</span><span class="op" id="4744939">.</span><span class="ident" id="4744940">Uintptr</span><span class="op" id="4744947">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4744951">return</span>&nbsp;<span class="ident" id="4744958">v</span><span class="op" id="4744959">.</span><span class="ident" id="4744960">Uint</span><span class="op" id="4744964">(</span><span class="op" id="4744965">)</span>&nbsp;<span class="op" id="4744967">==</span>&nbsp;<span class="num" id="4744970">0</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4744973">case</span>&nbsp;<span class="ident" id="4744978">reflect</span><span class="op" id="4744985">.</span><span class="ident" id="4744986">Float32</span><span class="op" id="4744993">,</span>&nbsp;<span class="ident" id="4744995">reflect</span><span class="op" id="4745002">.</span><span class="ident" id="4745003">Float64</span><span class="op" id="4745010">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4745014">return</span>&nbsp;<span class="ident" id="4745021">v</span><span class="op" id="4745022">.</span><span class="ident" id="4745023">Float</span><span class="op" id="4745028">(</span><span class="op" id="4745029">)</span>&nbsp;<span class="op" id="4745031">==</span>&nbsp;<span class="num" id="4745034">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4745037">case</span>&nbsp;<span class="ident" id="4745042">reflect</span><span class="op" id="4745049">.</span><span class="ident" id="4745050">Interface</span><span class="op" id="4745059">,</span>&nbsp;<span class="ident" id="4745061">reflect</span><span class="op" id="4745068">.</span><span class="ident" id="4745069">Ptr</span><span class="op" id="4745072">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4745076">return</span>&nbsp;<span class="ident" id="4745083">v</span><span class="op" id="4745084">.</span><span class="ident" id="4745085">IsNil</span><span class="op" id="4745090">(</span><span class="op" id="4745091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4745094">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4745097">return</span>&nbsp;<span class="ident" id="4745104">false</span><br>
<span class="lineno"></span><span class="op" id="4745110">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4745113">func</span>&nbsp;<span class="op" id="4745118">(</span><span class="ident" id="4745119">e</span>&nbsp;<span class="op" id="4745121">*</span><span class="ident" id="4745122">encodeState</span><span class="op" id="4745133">)</span>&nbsp;<span class="ident" id="4745135">reflectValue</span><span class="op" id="4745147">(</span><span class="ident" id="4745148">v</span>&nbsp;<span class="ident" id="4745150">reflect</span><span class="op" id="4745157">.</span><span class="ident" id="4745158">Value</span><span class="op" id="4745163">)</span>&nbsp;<span class="op" id="4745165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4745168">valueEncoder</span><span class="op" id="4745180">(</span><span class="ident" id="4745181">v</span><span class="op" id="4745182">)</span><span class="op" id="4745183">(</span><span class="ident" id="4745184">e</span><span class="op" id="4745185">,</span>&nbsp;<span class="ident" id="4745187">v</span><span class="op" id="4745188">,</span>&nbsp;<span class="ident" id="4745190">false</span><span class="op" id="4745195">)</span><br>
<span class="lineno">300</span><span class="op" id="4745197">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4745200">type</span>&nbsp;<span class="ident" id="4745205">encoderFunc</span>&nbsp;<span class="keyword" id="4745217">func</span><span class="op" id="4745221">(</span><span class="ident" id="4745222">e</span>&nbsp;<span class="op" id="4745224">*</span><span class="ident" id="4745225">encodeState</span><span class="op" id="4745236">,</span>&nbsp;<span class="ident" id="4745238">v</span>&nbsp;<span class="ident" id="4745240">reflect</span><span class="op" id="4745247">.</span><span class="ident" id="4745248">Value</span><span class="op" id="4745253">,</span>&nbsp;<span class="ident" id="4745255">quoted</span>&nbsp;<span class="builtintype" id="4745262">bool</span><span class="op" id="4745266">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4745269">var</span>&nbsp;<span class="ident" id="4745273">encoderCache</span>&nbsp;<span class="keyword" id="4745286">struct</span>&nbsp;<span class="op" id="4745293">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4745296">sync</span><span class="op" id="4745300">.</span><span class="ident" id="4745301">RWMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4745310">m</span>&nbsp;<span class="keyword" id="4745312">map</span><span class="op" id="4745315">[</span><span class="ident" id="4745316">reflect</span><span class="op" id="4745323">.</span><span class="ident" id="4745324">Type</span><span class="op" id="4745328">]</span><span class="ident" id="4745329">encoderFunc</span><br>
<span class="lineno"></span><span class="op" id="4745341">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4745344">func</span>&nbsp;<span class="ident" id="4745349">valueEncoder</span><span class="op" id="4745361">(</span><span class="ident" id="4745362">v</span>&nbsp;<span class="ident" id="4745364">reflect</span><span class="op" id="4745371">.</span><span class="ident" id="4745372">Value</span><span class="op" id="4745377">)</span>&nbsp;<span class="ident" id="4745379">encoderFunc</span>&nbsp;<span class="op" id="4745391">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4745394">if</span>&nbsp;<span class="op" id="4745397">!</span><span class="ident" id="4745398">v</span><span class="op" id="4745399">.</span><span class="ident" id="4745400">IsValid</span><span class="op" id="4745407">(</span><span class="op" id="4745408">)</span>&nbsp;<span class="op" id="4745410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4745414">return</span>&nbsp;<span class="ident" id="4745421">invalidValueEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4745442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4745445">return</span>&nbsp;<span class="ident" id="4745452">typeEncoder</span><span class="op" id="4745463">(</span><span class="ident" id="4745464">v</span><span class="op" id="4745465">.</span><span class="ident" id="4745466">Type</span><span class="op" id="4745470">(</span><span class="op" id="4745471">)</span><span class="op" id="4745472">)</span><br>
<span class="lineno"></span><span class="op" id="4745474">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span><span class="keyword" id="4745477">func</span>&nbsp;<span class="ident" id="4745482">typeEncoder</span><span class="op" id="4745493">(</span><span class="ident" id="4745494">t</span>&nbsp;<span class="ident" id="4745496">reflect</span><span class="op" id="4745503">.</span><span class="ident" id="4745504">Type</span><span class="op" id="4745508">)</span>&nbsp;<span class="ident" id="4745510">encoderFunc</span>&nbsp;<span class="op" id="4745522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4745525">encoderCache</span><span class="op" id="4745537">.</span><span class="ident" id="4745538">RLock</span><span class="op" id="4745543">(</span><span class="op" id="4745544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4745547">f</span>&nbsp;<span class="op" id="4745549">:=</span>&nbsp;<span class="ident" id="4745552">encoderCache</span><span class="op" id="4745564">.</span><span class="ident" id="4745565">m</span><span class="op" id="4745566">[</span><span class="ident" id="4745567">t</span><span class="op" id="4745568">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4745571">encoderCache</span><span class="op" id="4745583">.</span><span class="ident" id="4745584">RUnlock</span><span class="op" id="4745591">(</span><span class="op" id="4745592">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4745595">if</span>&nbsp;<span class="ident" id="4745598">f</span>&nbsp;<span class="op" id="4745600">!=</span>&nbsp;<span class="ident" id="4745603">nil</span>&nbsp;<span class="op" id="4745607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4745611">return</span>&nbsp;<span class="ident" id="4745618">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4745621">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4745625">//&nbsp;To&nbsp;deal&nbsp;with&nbsp;recursive&nbsp;types,&nbsp;populate&nbsp;the&nbsp;map&nbsp;with&nbsp;an</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4745684">//&nbsp;indirect&nbsp;func&nbsp;before&nbsp;we&nbsp;build&nbsp;it.&nbsp;This&nbsp;type&nbsp;waits&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4745745">//&nbsp;real&nbsp;func&nbsp;(f)&nbsp;to&nbsp;be&nbsp;ready&nbsp;and&nbsp;then&nbsp;calls&nbsp;it.&nbsp;&nbsp;This&nbsp;indirect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4745809">//&nbsp;func&nbsp;is&nbsp;only&nbsp;used&nbsp;for&nbsp;recursive&nbsp;types.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4745852">encoderCache</span><span class="op" id="4745864">.</span><span class="ident" id="4745865">Lock</span><span class="op" id="4745869">(</span><span class="op" id="4745870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4745873">if</span>&nbsp;<span class="ident" id="4745876">encoderCache</span><span class="op" id="4745888">.</span><span class="ident" id="4745889">m</span>&nbsp;<span class="op" id="4745891">==</span>&nbsp;<span class="ident" id="4745894">nil</span>&nbsp;<span class="op" id="4745898">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4745902">encoderCache</span><span class="op" id="4745914">.</span><span class="ident" id="4745915">m</span>&nbsp;<span class="op" id="4745917">=</span>&nbsp;<span class="builtinfunc" id="4745919">make</span><span class="op" id="4745923">(</span><span class="keyword" id="4745924">map</span><span class="op" id="4745927">[</span><span class="ident" id="4745928">reflect</span><span class="op" id="4745935">.</span><span class="ident" id="4745936">Type</span><span class="op" id="4745940">]</span><span class="ident" id="4745941">encoderFunc</span><span class="op" id="4745952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4745955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4745958">var</span>&nbsp;<span class="ident" id="4745962">wg</span>&nbsp;<span class="ident" id="4745965">sync</span><span class="op" id="4745969">.</span><span class="ident" id="4745970">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4745981">wg</span><span class="op" id="4745983">.</span><span class="ident" id="4745984">Add</span><span class="op" id="4745987">(</span><span class="num" id="4745988">1</span><span class="op" id="4745989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4745992">encoderCache</span><span class="op" id="4746004">.</span><span class="ident" id="4746005">m</span><span class="op" id="4746006">[</span><span class="ident" id="4746007">t</span><span class="op" id="4746008">]</span>&nbsp;<span class="op" id="4746010">=</span>&nbsp;<span class="keyword" id="4746012">func</span><span class="op" id="4746016">(</span><span class="ident" id="4746017">e</span>&nbsp;<span class="op" id="4746019">*</span><span class="ident" id="4746020">encodeState</span><span class="op" id="4746031">,</span>&nbsp;<span class="ident" id="4746033">v</span>&nbsp;<span class="ident" id="4746035">reflect</span><span class="op" id="4746042">.</span><span class="ident" id="4746043">Value</span><span class="op" id="4746048">,</span>&nbsp;<span class="ident" id="4746050">quoted</span>&nbsp;<span class="builtintype" id="4746057">bool</span><span class="op" id="4746061">)</span>&nbsp;<span class="op" id="4746063">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4746067">wg</span><span class="op" id="4746069">.</span><span class="ident" id="4746070">Wait</span><span class="op" id="4746074">(</span><span class="op" id="4746075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4746079">f</span><span class="op" id="4746080">(</span><span class="ident" id="4746081">e</span><span class="op" id="4746082">,</span>&nbsp;<span class="ident" id="4746084">v</span><span class="op" id="4746085">,</span>&nbsp;<span class="ident" id="4746087">quoted</span><span class="op" id="4746093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4746096">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4746099">encoderCache</span><span class="op" id="4746111">.</span><span class="ident" id="4746112">Unlock</span><span class="op" id="4746118">(</span><span class="op" id="4746119">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4746123">//&nbsp;Compute&nbsp;fields&nbsp;without&nbsp;lock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4746156">//&nbsp;Might&nbsp;duplicate&nbsp;effort&nbsp;but&nbsp;won&#39;t&nbsp;hold&nbsp;other&nbsp;computations&nbsp;back.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4746223">f</span>&nbsp;<span class="op" id="4746225">=</span>&nbsp;<span class="ident" id="4746227">newTypeEncoder</span><span class="op" id="4746241">(</span><span class="ident" id="4746242">t</span><span class="op" id="4746243">,</span>&nbsp;<span class="ident" id="4746245">true</span><span class="op" id="4746249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4746252">wg</span><span class="op" id="4746254">.</span><span class="ident" id="4746255">Done</span><span class="op" id="4746259">(</span><span class="op" id="4746260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4746263">encoderCache</span><span class="op" id="4746275">.</span><span class="ident" id="4746276">Lock</span><span class="op" id="4746280">(</span><span class="op" id="4746281">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4746284">encoderCache</span><span class="op" id="4746296">.</span><span class="ident" id="4746297">m</span><span class="op" id="4746298">[</span><span class="ident" id="4746299">t</span><span class="op" id="4746300">]</span>&nbsp;<span class="op" id="4746302">=</span>&nbsp;<span class="ident" id="4746304">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4746307">encoderCache</span><span class="op" id="4746319">.</span><span class="ident" id="4746320">Unlock</span><span class="op" id="4746326">(</span><span class="op" id="4746327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4746330">return</span>&nbsp;<span class="ident" id="4746337">f</span><br>
<span class="lineno"></span><span class="op" id="4746339">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span><span class="keyword" id="4746342">var</span>&nbsp;<span class="op" id="4746346">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4746349">marshalerType</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4746367">=</span>&nbsp;<span class="ident" id="4746369">reflect</span><span class="op" id="4746376">.</span><span class="ident" id="4746377">TypeOf</span><span class="op" id="4746383">(</span><span class="builtinfunc" id="4746384">new</span><span class="op" id="4746387">(</span><span class="ident" id="4746388">Marshaler</span><span class="op" id="4746397">)</span><span class="op" id="4746398">)</span><span class="op" id="4746399">.</span><span class="ident" id="4746400">Elem</span><span class="op" id="4746404">(</span><span class="op" id="4746405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4746408">textMarshalerType</span>&nbsp;<span class="op" id="4746426">=</span>&nbsp;<span class="ident" id="4746428">reflect</span><span class="op" id="4746435">.</span><span class="ident" id="4746436">TypeOf</span><span class="op" id="4746442">(</span><span class="builtinfunc" id="4746443">new</span><span class="op" id="4746446">(</span><span class="ident" id="4746447">encoding</span><span class="op" id="4746455">.</span><span class="ident" id="4746456">TextMarshaler</span><span class="op" id="4746469">)</span><span class="op" id="4746470">)</span><span class="op" id="4746471">.</span><span class="ident" id="4746472">Elem</span><span class="op" id="4746476">(</span><span class="op" id="4746477">)</span><br>
<span class="lineno"></span><span class="op" id="4746479">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="comment" id="4746482">//&nbsp;newTypeEncoder&nbsp;constructs&nbsp;an&nbsp;encoderFunc&nbsp;for&nbsp;a&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="4746538">//&nbsp;The&nbsp;returned&nbsp;encoder&nbsp;only&nbsp;checks&nbsp;CanAddr&nbsp;when&nbsp;allowAddr&nbsp;is&nbsp;true.</span><br>
<span class="lineno"></span><span class="keyword" id="4746606">func</span>&nbsp;<span class="ident" id="4746611">newTypeEncoder</span><span class="op" id="4746625">(</span><span class="ident" id="4746626">t</span>&nbsp;<span class="ident" id="4746628">reflect</span><span class="op" id="4746635">.</span><span class="ident" id="4746636">Type</span><span class="op" id="4746640">,</span>&nbsp;<span class="ident" id="4746642">allowAddr</span>&nbsp;<span class="builtintype" id="4746652">bool</span><span class="op" id="4746656">)</span>&nbsp;<span class="ident" id="4746658">encoderFunc</span>&nbsp;<span class="op" id="4746670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4746673">if</span>&nbsp;<span class="ident" id="4746676">t</span><span class="op" id="4746677">.</span><span class="ident" id="4746678">Implements</span><span class="op" id="4746688">(</span><span class="ident" id="4746689">marshalerType</span><span class="op" id="4746702">)</span>&nbsp;<span class="op" id="4746704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4746708">return</span>&nbsp;<span class="ident" id="4746715">marshalerEncoder</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4746733">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4746736">if</span>&nbsp;<span class="ident" id="4746739">t</span><span class="op" id="4746740">.</span><span class="ident" id="4746741">Kind</span><span class="op" id="4746745">(</span><span class="op" id="4746746">)</span>&nbsp;<span class="op" id="4746748">!=</span>&nbsp;<span class="ident" id="4746751">reflect</span><span class="op" id="4746758">.</span><span class="ident" id="4746759">Ptr</span>&nbsp;<span class="op" id="4746763">&amp;&amp;</span>&nbsp;<span class="ident" id="4746766">allowAddr</span>&nbsp;<span class="op" id="4746776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4746780">if</span>&nbsp;<span class="ident" id="4746783">reflect</span><span class="op" id="4746790">.</span><span class="ident" id="4746791">PtrTo</span><span class="op" id="4746796">(</span><span class="ident" id="4746797">t</span><span class="op" id="4746798">)</span><span class="op" id="4746799">.</span><span class="ident" id="4746800">Implements</span><span class="op" id="4746810">(</span><span class="ident" id="4746811">marshalerType</span><span class="op" id="4746824">)</span>&nbsp;<span class="op" id="4746826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4746831">return</span>&nbsp;<span class="ident" id="4746838">newCondAddrEncoder</span><span class="op" id="4746856">(</span><span class="ident" id="4746857">addrMarshalerEncoder</span><span class="op" id="4746877">,</span>&nbsp;<span class="ident" id="4746879">newTypeEncoder</span><span class="op" id="4746893">(</span><span class="ident" id="4746894">t</span><span class="op" id="4746895">,</span>&nbsp;<span class="ident" id="4746897">false</span><span class="op" id="4746902">)</span><span class="op" id="4746903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4746907">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4746910">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4746914">if</span>&nbsp;<span class="ident" id="4746917">t</span><span class="op" id="4746918">.</span><span class="ident" id="4746919">Implements</span><span class="op" id="4746929">(</span><span class="ident" id="4746930">textMarshalerType</span><span class="op" id="4746947">)</span>&nbsp;<span class="op" id="4746949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4746953">return</span>&nbsp;<span class="ident" id="4746960">textMarshalerEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4746982">}</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4746985">if</span>&nbsp;<span class="ident" id="4746988">t</span><span class="op" id="4746989">.</span><span class="ident" id="4746990">Kind</span><span class="op" id="4746994">(</span><span class="op" id="4746995">)</span>&nbsp;<span class="op" id="4746997">!=</span>&nbsp;<span class="ident" id="4747000">reflect</span><span class="op" id="4747007">.</span><span class="ident" id="4747008">Ptr</span>&nbsp;<span class="op" id="4747012">&amp;&amp;</span>&nbsp;<span class="ident" id="4747015">allowAddr</span>&nbsp;<span class="op" id="4747025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4747029">if</span>&nbsp;<span class="ident" id="4747032">reflect</span><span class="op" id="4747039">.</span><span class="ident" id="4747040">PtrTo</span><span class="op" id="4747045">(</span><span class="ident" id="4747046">t</span><span class="op" id="4747047">)</span><span class="op" id="4747048">.</span><span class="ident" id="4747049">Implements</span><span class="op" id="4747059">(</span><span class="ident" id="4747060">textMarshalerType</span><span class="op" id="4747077">)</span>&nbsp;<span class="op" id="4747079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4747084">return</span>&nbsp;<span class="ident" id="4747091">newCondAddrEncoder</span><span class="op" id="4747109">(</span><span class="ident" id="4747110">addrTextMarshalerEncoder</span><span class="op" id="4747134">,</span>&nbsp;<span class="ident" id="4747136">newTypeEncoder</span><span class="op" id="4747150">(</span><span class="ident" id="4747151">t</span><span class="op" id="4747152">,</span>&nbsp;<span class="ident" id="4747154">false</span><span class="op" id="4747159">)</span><span class="op" id="4747160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4747164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4747167">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4747171">switch</span>&nbsp;<span class="ident" id="4747178">t</span><span class="op" id="4747179">.</span><span class="ident" id="4747180">Kind</span><span class="op" id="4747184">(</span><span class="op" id="4747185">)</span>&nbsp;<span class="op" id="4747187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4747190">case</span>&nbsp;<span class="ident" id="4747195">reflect</span><span class="op" id="4747202">.</span><span class="ident" id="4747203">Bool</span><span class="op" id="4747207">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4747211">return</span>&nbsp;<span class="ident" id="4747218">boolEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4747231">case</span>&nbsp;<span class="ident" id="4747236">reflect</span><span class="op" id="4747243">.</span><span class="ident" id="4747244">Int</span><span class="op" id="4747247">,</span>&nbsp;<span class="ident" id="4747249">reflect</span><span class="op" id="4747256">.</span><span class="ident" id="4747257">Int8</span><span class="op" id="4747261">,</span>&nbsp;<span class="ident" id="4747263">reflect</span><span class="op" id="4747270">.</span><span class="ident" id="4747271">Int16</span><span class="op" id="4747276">,</span>&nbsp;<span class="ident" id="4747278">reflect</span><span class="op" id="4747285">.</span><span class="ident" id="4747286">Int32</span><span class="op" id="4747291">,</span>&nbsp;<span class="ident" id="4747293">reflect</span><span class="op" id="4747300">.</span><span class="ident" id="4747301">Int64</span><span class="op" id="4747306">:</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4747310">return</span>&nbsp;<span class="ident" id="4747317">intEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4747329">case</span>&nbsp;<span class="ident" id="4747334">reflect</span><span class="op" id="4747341">.</span><span class="ident" id="4747342">Uint</span><span class="op" id="4747346">,</span>&nbsp;<span class="ident" id="4747348">reflect</span><span class="op" id="4747355">.</span><span class="ident" id="4747356">Uint8</span><span class="op" id="4747361">,</span>&nbsp;<span class="ident" id="4747363">reflect</span><span class="op" id="4747370">.</span><span class="ident" id="4747371">Uint16</span><span class="op" id="4747377">,</span>&nbsp;<span class="ident" id="4747379">reflect</span><span class="op" id="4747386">.</span><span class="ident" id="4747387">Uint32</span><span class="op" id="4747393">,</span>&nbsp;<span class="ident" id="4747395">reflect</span><span class="op" id="4747402">.</span><span class="ident" id="4747403">Uint64</span><span class="op" id="4747409">,</span>&nbsp;<span class="ident" id="4747411">reflect</span><span class="op" id="4747418">.</span><span class="ident" id="4747419">Uintptr</span><span class="op" id="4747426">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4747430">return</span>&nbsp;<span class="ident" id="4747437">uintEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4747450">case</span>&nbsp;<span class="ident" id="4747455">reflect</span><span class="op" id="4747462">.</span><span class="ident" id="4747463">Float32</span><span class="op" id="4747470">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4747474">return</span>&nbsp;<span class="ident" id="4747481">float32Encoder</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4747497">case</span>&nbsp;<span class="ident" id="4747502">reflect</span><span class="op" id="4747509">.</span><span class="ident" id="4747510">Float64</span><span class="op" id="4747517">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4747521">return</span>&nbsp;<span class="ident" id="4747528">float64Encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4747544">case</span>&nbsp;<span class="ident" id="4747549">reflect</span><span class="op" id="4747556">.</span><span class="ident" id="4747557">String</span><span class="op" id="4747563">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4747567">return</span>&nbsp;<span class="ident" id="4747574">stringEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4747589">case</span>&nbsp;<span class="ident" id="4747594">reflect</span><span class="op" id="4747601">.</span><span class="ident" id="4747602">Interface</span><span class="op" id="4747611">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4747615">return</span>&nbsp;<span class="ident" id="4747622">interfaceEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4747640">case</span>&nbsp;<span class="ident" id="4747645">reflect</span><span class="op" id="4747652">.</span><span class="ident" id="4747653">Struct</span><span class="op" id="4747659">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4747663">return</span>&nbsp;<span class="ident" id="4747670">newStructEncoder</span><span class="op" id="4747686">(</span><span class="ident" id="4747687">t</span><span class="op" id="4747688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4747691">case</span>&nbsp;<span class="ident" id="4747696">reflect</span><span class="op" id="4747703">.</span><span class="ident" id="4747704">Map</span><span class="op" id="4747707">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4747711">return</span>&nbsp;<span class="ident" id="4747718">newMapEncoder</span><span class="op" id="4747731">(</span><span class="ident" id="4747732">t</span><span class="op" id="4747733">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4747736">case</span>&nbsp;<span class="ident" id="4747741">reflect</span><span class="op" id="4747748">.</span><span class="ident" id="4747749">Slice</span><span class="op" id="4747754">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4747758">return</span>&nbsp;<span class="ident" id="4747765">newSliceEncoder</span><span class="op" id="4747780">(</span><span class="ident" id="4747781">t</span><span class="op" id="4747782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4747785">case</span>&nbsp;<span class="ident" id="4747790">reflect</span><span class="op" id="4747797">.</span><span class="ident" id="4747798">Array</span><span class="op" id="4747803">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4747807">return</span>&nbsp;<span class="ident" id="4747814">newArrayEncoder</span><span class="op" id="4747829">(</span><span class="ident" id="4747830">t</span><span class="op" id="4747831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4747834">case</span>&nbsp;<span class="ident" id="4747839">reflect</span><span class="op" id="4747846">.</span><span class="ident" id="4747847">Ptr</span><span class="op" id="4747850">:</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4747854">return</span>&nbsp;<span class="ident" id="4747861">newPtrEncoder</span><span class="op" id="4747874">(</span><span class="ident" id="4747875">t</span><span class="op" id="4747876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4747879">default</span><span class="op" id="4747886">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4747890">return</span>&nbsp;<span class="ident" id="4747897">unsupportedTypeEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4747921">}</span><br>
<span class="lineno"></span><span class="op" id="4747923">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="keyword" id="4747926">func</span>&nbsp;<span class="ident" id="4747931">invalidValueEncoder</span><span class="op" id="4747950">(</span><span class="ident" id="4747951">e</span>&nbsp;<span class="op" id="4747953">*</span><span class="ident" id="4747954">encodeState</span><span class="op" id="4747965">,</span>&nbsp;<span class="ident" id="4747967">v</span>&nbsp;<span class="ident" id="4747969">reflect</span><span class="op" id="4747976">.</span><span class="ident" id="4747977">Value</span><span class="op" id="4747982">,</span>&nbsp;<span class="ident" id="4747984">quoted</span>&nbsp;<span class="builtintype" id="4747991">bool</span><span class="op" id="4747995">)</span>&nbsp;<span class="op" id="4747997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4748000">e</span><span class="op" id="4748001">.</span><span class="ident" id="4748002">WriteString</span><span class="op" id="4748013">(</span><span class="string" id="4748014">&#34;null&#34;</span><span class="op" id="4748020">)</span><br>
<span class="lineno"></span><span class="op" id="4748022">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span><span class="keyword" id="4748025">func</span>&nbsp;<span class="ident" id="4748030">marshalerEncoder</span><span class="op" id="4748046">(</span><span class="ident" id="4748047">e</span>&nbsp;<span class="op" id="4748049">*</span><span class="ident" id="4748050">encodeState</span><span class="op" id="4748061">,</span>&nbsp;<span class="ident" id="4748063">v</span>&nbsp;<span class="ident" id="4748065">reflect</span><span class="op" id="4748072">.</span><span class="ident" id="4748073">Value</span><span class="op" id="4748078">,</span>&nbsp;<span class="ident" id="4748080">quoted</span>&nbsp;<span class="builtintype" id="4748087">bool</span><span class="op" id="4748091">)</span>&nbsp;<span class="op" id="4748093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4748096">if</span>&nbsp;<span class="ident" id="4748099">v</span><span class="op" id="4748100">.</span><span class="ident" id="4748101">Kind</span><span class="op" id="4748105">(</span><span class="op" id="4748106">)</span>&nbsp;<span class="op" id="4748108">==</span>&nbsp;<span class="ident" id="4748111">reflect</span><span class="op" id="4748118">.</span><span class="ident" id="4748119">Ptr</span>&nbsp;<span class="op" id="4748123">&amp;&amp;</span>&nbsp;<span class="ident" id="4748126">v</span><span class="op" id="4748127">.</span><span class="ident" id="4748128">IsNil</span><span class="op" id="4748133">(</span><span class="op" id="4748134">)</span>&nbsp;<span class="op" id="4748136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4748140">e</span><span class="op" id="4748141">.</span><span class="ident" id="4748142">WriteString</span><span class="op" id="4748153">(</span><span class="string" id="4748154">&#34;null&#34;</span><span class="op" id="4748160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4748164">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4748172">}</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4748175">m</span>&nbsp;<span class="op" id="4748177">:=</span>&nbsp;<span class="ident" id="4748180">v</span><span class="op" id="4748181">.</span><span class="ident" id="4748182">Interface</span><span class="op" id="4748191">(</span><span class="op" id="4748192">)</span><span class="op" id="4748193">.</span><span class="op" id="4748194">(</span><span class="ident" id="4748195">Marshaler</span><span class="op" id="4748204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4748207">b</span><span class="op" id="4748208">,</span>&nbsp;<span class="ident" id="4748210">err</span>&nbsp;<span class="op" id="4748214">:=</span>&nbsp;<span class="ident" id="4748217">m</span><span class="op" id="4748218">.</span><span class="ident" id="4748219">MarshalJSON</span><span class="op" id="4748230">(</span><span class="op" id="4748231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4748234">if</span>&nbsp;<span class="ident" id="4748237">err</span>&nbsp;<span class="op" id="4748241">==</span>&nbsp;<span class="ident" id="4748244">nil</span>&nbsp;<span class="op" id="4748248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4748252">//&nbsp;copy&nbsp;JSON&nbsp;into&nbsp;buffer,&nbsp;checking&nbsp;validity.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4748299">err</span>&nbsp;<span class="op" id="4748303">=</span>&nbsp;<span class="ident" id="4748305">compact</span><span class="op" id="4748312">(</span><span class="op" id="4748313">&amp;</span><span class="ident" id="4748314">e</span><span class="op" id="4748315">.</span><span class="ident" id="4748316">Buffer</span><span class="op" id="4748322">,</span>&nbsp;<span class="ident" id="4748324">b</span><span class="op" id="4748325">,</span>&nbsp;<span class="ident" id="4748327">true</span><span class="op" id="4748331">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4748334">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4748337">if</span>&nbsp;<span class="ident" id="4748340">err</span>&nbsp;<span class="op" id="4748344">!=</span>&nbsp;<span class="ident" id="4748347">nil</span>&nbsp;<span class="op" id="4748351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4748355">e</span><span class="op" id="4748356">.</span><span class="builtintype" id="4748357">error</span><span class="op" id="4748362">(</span><span class="op" id="4748363">&amp;</span><span class="ident" id="4748364">MarshalerError</span><span class="op" id="4748378">{</span><span class="ident" id="4748379">v</span><span class="op" id="4748380">.</span><span class="ident" id="4748381">Type</span><span class="op" id="4748385">(</span><span class="op" id="4748386">)</span><span class="op" id="4748387">,</span>&nbsp;<span class="ident" id="4748389">err</span><span class="op" id="4748392">}</span><span class="op" id="4748393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4748396">}</span><br>
<span class="lineno"></span><span class="op" id="4748398">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span><span class="keyword" id="4748401">func</span>&nbsp;<span class="ident" id="4748406">addrMarshalerEncoder</span><span class="op" id="4748426">(</span><span class="ident" id="4748427">e</span>&nbsp;<span class="op" id="4748429">*</span><span class="ident" id="4748430">encodeState</span><span class="op" id="4748441">,</span>&nbsp;<span class="ident" id="4748443">v</span>&nbsp;<span class="ident" id="4748445">reflect</span><span class="op" id="4748452">.</span><span class="ident" id="4748453">Value</span><span class="op" id="4748458">,</span>&nbsp;<span class="ident" id="4748460">quoted</span>&nbsp;<span class="builtintype" id="4748467">bool</span><span class="op" id="4748471">)</span>&nbsp;<span class="op" id="4748473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4748476">va</span>&nbsp;<span class="op" id="4748479">:=</span>&nbsp;<span class="ident" id="4748482">v</span><span class="op" id="4748483">.</span><span class="ident" id="4748484">Addr</span><span class="op" id="4748488">(</span><span class="op" id="4748489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4748492">if</span>&nbsp;<span class="ident" id="4748495">va</span><span class="op" id="4748497">.</span><span class="ident" id="4748498">IsNil</span><span class="op" id="4748503">(</span><span class="op" id="4748504">)</span>&nbsp;<span class="op" id="4748506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4748510">e</span><span class="op" id="4748511">.</span><span class="ident" id="4748512">WriteString</span><span class="op" id="4748523">(</span><span class="string" id="4748524">&#34;null&#34;</span><span class="op" id="4748530">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4748534">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4748542">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4748545">m</span>&nbsp;<span class="op" id="4748547">:=</span>&nbsp;<span class="ident" id="4748550">va</span><span class="op" id="4748552">.</span><span class="ident" id="4748553">Interface</span><span class="op" id="4748562">(</span><span class="op" id="4748563">)</span><span class="op" id="4748564">.</span><span class="op" id="4748565">(</span><span class="ident" id="4748566">Marshaler</span><span class="op" id="4748575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4748578">b</span><span class="op" id="4748579">,</span>&nbsp;<span class="ident" id="4748581">err</span>&nbsp;<span class="op" id="4748585">:=</span>&nbsp;<span class="ident" id="4748588">m</span><span class="op" id="4748589">.</span><span class="ident" id="4748590">MarshalJSON</span><span class="op" id="4748601">(</span><span class="op" id="4748602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4748605">if</span>&nbsp;<span class="ident" id="4748608">err</span>&nbsp;<span class="op" id="4748612">==</span>&nbsp;<span class="ident" id="4748615">nil</span>&nbsp;<span class="op" id="4748619">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4748623">//&nbsp;copy&nbsp;JSON&nbsp;into&nbsp;buffer,&nbsp;checking&nbsp;validity.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4748670">err</span>&nbsp;<span class="op" id="4748674">=</span>&nbsp;<span class="ident" id="4748676">compact</span><span class="op" id="4748683">(</span><span class="op" id="4748684">&amp;</span><span class="ident" id="4748685">e</span><span class="op" id="4748686">.</span><span class="ident" id="4748687">Buffer</span><span class="op" id="4748693">,</span>&nbsp;<span class="ident" id="4748695">b</span><span class="op" id="4748696">,</span>&nbsp;<span class="ident" id="4748698">true</span><span class="op" id="4748702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4748705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4748708">if</span>&nbsp;<span class="ident" id="4748711">err</span>&nbsp;<span class="op" id="4748715">!=</span>&nbsp;<span class="ident" id="4748718">nil</span>&nbsp;<span class="op" id="4748722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4748726">e</span><span class="op" id="4748727">.</span><span class="builtintype" id="4748728">error</span><span class="op" id="4748733">(</span><span class="op" id="4748734">&amp;</span><span class="ident" id="4748735">MarshalerError</span><span class="op" id="4748749">{</span><span class="ident" id="4748750">v</span><span class="op" id="4748751">.</span><span class="ident" id="4748752">Type</span><span class="op" id="4748756">(</span><span class="op" id="4748757">)</span><span class="op" id="4748758">,</span>&nbsp;<span class="ident" id="4748760">err</span><span class="op" id="4748763">}</span><span class="op" id="4748764">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4748767">}</span><br>
<span class="lineno"></span><span class="op" id="4748769">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4748772">func</span>&nbsp;<span class="ident" id="4748777">textMarshalerEncoder</span><span class="op" id="4748797">(</span><span class="ident" id="4748798">e</span>&nbsp;<span class="op" id="4748800">*</span><span class="ident" id="4748801">encodeState</span><span class="op" id="4748812">,</span>&nbsp;<span class="ident" id="4748814">v</span>&nbsp;<span class="ident" id="4748816">reflect</span><span class="op" id="4748823">.</span><span class="ident" id="4748824">Value</span><span class="op" id="4748829">,</span>&nbsp;<span class="ident" id="4748831">quoted</span>&nbsp;<span class="builtintype" id="4748838">bool</span><span class="op" id="4748842">)</span>&nbsp;<span class="op" id="4748844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4748847">if</span>&nbsp;<span class="ident" id="4748850">v</span><span class="op" id="4748851">.</span><span class="ident" id="4748852">Kind</span><span class="op" id="4748856">(</span><span class="op" id="4748857">)</span>&nbsp;<span class="op" id="4748859">==</span>&nbsp;<span class="ident" id="4748862">reflect</span><span class="op" id="4748869">.</span><span class="ident" id="4748870">Ptr</span>&nbsp;<span class="op" id="4748874">&amp;&amp;</span>&nbsp;<span class="ident" id="4748877">v</span><span class="op" id="4748878">.</span><span class="ident" id="4748879">IsNil</span><span class="op" id="4748884">(</span><span class="op" id="4748885">)</span>&nbsp;<span class="op" id="4748887">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4748891">e</span><span class="op" id="4748892">.</span><span class="ident" id="4748893">WriteString</span><span class="op" id="4748904">(</span><span class="string" id="4748905">&#34;null&#34;</span><span class="op" id="4748911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4748915">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4748923">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4748926">m</span>&nbsp;<span class="op" id="4748928">:=</span>&nbsp;<span class="ident" id="4748931">v</span><span class="op" id="4748932">.</span><span class="ident" id="4748933">Interface</span><span class="op" id="4748942">(</span><span class="op" id="4748943">)</span><span class="op" id="4748944">.</span><span class="op" id="4748945">(</span><span class="ident" id="4748946">encoding</span><span class="op" id="4748954">.</span><span class="ident" id="4748955">TextMarshaler</span><span class="op" id="4748968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4748971">b</span><span class="op" id="4748972">,</span>&nbsp;<span class="ident" id="4748974">err</span>&nbsp;<span class="op" id="4748978">:=</span>&nbsp;<span class="ident" id="4748981">m</span><span class="op" id="4748982">.</span><span class="ident" id="4748983">MarshalText</span><span class="op" id="4748994">(</span><span class="op" id="4748995">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4748998">if</span>&nbsp;<span class="ident" id="4749001">err</span>&nbsp;<span class="op" id="4749005">==</span>&nbsp;<span class="ident" id="4749008">nil</span>&nbsp;<span class="op" id="4749012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4749016">_</span><span class="op" id="4749017">,</span>&nbsp;<span class="ident" id="4749019">err</span>&nbsp;<span class="op" id="4749023">=</span>&nbsp;<span class="ident" id="4749025">e</span><span class="op" id="4749026">.</span><span class="ident" id="4749027">stringBytes</span><span class="op" id="4749038">(</span><span class="ident" id="4749039">b</span><span class="op" id="4749040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4749043">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4749046">if</span>&nbsp;<span class="ident" id="4749049">err</span>&nbsp;<span class="op" id="4749053">!=</span>&nbsp;<span class="ident" id="4749056">nil</span>&nbsp;<span class="op" id="4749060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4749064">e</span><span class="op" id="4749065">.</span><span class="builtintype" id="4749066">error</span><span class="op" id="4749071">(</span><span class="op" id="4749072">&amp;</span><span class="ident" id="4749073">MarshalerError</span><span class="op" id="4749087">{</span><span class="ident" id="4749088">v</span><span class="op" id="4749089">.</span><span class="ident" id="4749090">Type</span><span class="op" id="4749094">(</span><span class="op" id="4749095">)</span><span class="op" id="4749096">,</span>&nbsp;<span class="ident" id="4749098">err</span><span class="op" id="4749101">}</span><span class="op" id="4749102">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4749105">}</span><br>
<span class="lineno"></span><span class="op" id="4749107">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4749110">func</span>&nbsp;<span class="ident" id="4749115">addrTextMarshalerEncoder</span><span class="op" id="4749139">(</span><span class="ident" id="4749140">e</span>&nbsp;<span class="op" id="4749142">*</span><span class="ident" id="4749143">encodeState</span><span class="op" id="4749154">,</span>&nbsp;<span class="ident" id="4749156">v</span>&nbsp;<span class="ident" id="4749158">reflect</span><span class="op" id="4749165">.</span><span class="ident" id="4749166">Value</span><span class="op" id="4749171">,</span>&nbsp;<span class="ident" id="4749173">quoted</span>&nbsp;<span class="builtintype" id="4749180">bool</span><span class="op" id="4749184">)</span>&nbsp;<span class="op" id="4749186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4749189">va</span>&nbsp;<span class="op" id="4749192">:=</span>&nbsp;<span class="ident" id="4749195">v</span><span class="op" id="4749196">.</span><span class="ident" id="4749197">Addr</span><span class="op" id="4749201">(</span><span class="op" id="4749202">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4749205">if</span>&nbsp;<span class="ident" id="4749208">va</span><span class="op" id="4749210">.</span><span class="ident" id="4749211">IsNil</span><span class="op" id="4749216">(</span><span class="op" id="4749217">)</span>&nbsp;<span class="op" id="4749219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4749223">e</span><span class="op" id="4749224">.</span><span class="ident" id="4749225">WriteString</span><span class="op" id="4749236">(</span><span class="string" id="4749237">&#34;null&#34;</span><span class="op" id="4749243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4749247">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4749255">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4749258">m</span>&nbsp;<span class="op" id="4749260">:=</span>&nbsp;<span class="ident" id="4749263">va</span><span class="op" id="4749265">.</span><span class="ident" id="4749266">Interface</span><span class="op" id="4749275">(</span><span class="op" id="4749276">)</span><span class="op" id="4749277">.</span><span class="op" id="4749278">(</span><span class="ident" id="4749279">encoding</span><span class="op" id="4749287">.</span><span class="ident" id="4749288">TextMarshaler</span><span class="op" id="4749301">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4749304">b</span><span class="op" id="4749305">,</span>&nbsp;<span class="ident" id="4749307">err</span>&nbsp;<span class="op" id="4749311">:=</span>&nbsp;<span class="ident" id="4749314">m</span><span class="op" id="4749315">.</span><span class="ident" id="4749316">MarshalText</span><span class="op" id="4749327">(</span><span class="op" id="4749328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4749331">if</span>&nbsp;<span class="ident" id="4749334">err</span>&nbsp;<span class="op" id="4749338">==</span>&nbsp;<span class="ident" id="4749341">nil</span>&nbsp;<span class="op" id="4749345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4749349">_</span><span class="op" id="4749350">,</span>&nbsp;<span class="ident" id="4749352">err</span>&nbsp;<span class="op" id="4749356">=</span>&nbsp;<span class="ident" id="4749358">e</span><span class="op" id="4749359">.</span><span class="ident" id="4749360">stringBytes</span><span class="op" id="4749371">(</span><span class="ident" id="4749372">b</span><span class="op" id="4749373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4749376">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4749379">if</span>&nbsp;<span class="ident" id="4749382">err</span>&nbsp;<span class="op" id="4749386">!=</span>&nbsp;<span class="ident" id="4749389">nil</span>&nbsp;<span class="op" id="4749393">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4749397">e</span><span class="op" id="4749398">.</span><span class="builtintype" id="4749399">error</span><span class="op" id="4749404">(</span><span class="op" id="4749405">&amp;</span><span class="ident" id="4749406">MarshalerError</span><span class="op" id="4749420">{</span><span class="ident" id="4749421">v</span><span class="op" id="4749422">.</span><span class="ident" id="4749423">Type</span><span class="op" id="4749427">(</span><span class="op" id="4749428">)</span><span class="op" id="4749429">,</span>&nbsp;<span class="ident" id="4749431">err</span><span class="op" id="4749434">}</span><span class="op" id="4749435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4749438">}</span><br>
<span class="lineno"></span><span class="op" id="4749440">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4749443">func</span>&nbsp;<span class="ident" id="4749448">boolEncoder</span><span class="op" id="4749459">(</span><span class="ident" id="4749460">e</span>&nbsp;<span class="op" id="4749462">*</span><span class="ident" id="4749463">encodeState</span><span class="op" id="4749474">,</span>&nbsp;<span class="ident" id="4749476">v</span>&nbsp;<span class="ident" id="4749478">reflect</span><span class="op" id="4749485">.</span><span class="ident" id="4749486">Value</span><span class="op" id="4749491">,</span>&nbsp;<span class="ident" id="4749493">quoted</span>&nbsp;<span class="builtintype" id="4749500">bool</span><span class="op" id="4749504">)</span>&nbsp;<span class="op" id="4749506">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4749509">if</span>&nbsp;<span class="ident" id="4749512">quoted</span>&nbsp;<span class="op" id="4749519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4749523">e</span><span class="op" id="4749524">.</span><span class="ident" id="4749525">WriteByte</span><span class="op" id="4749534">(</span><span class="string" id="4749535">&#39;&#34;&#39;</span><span class="op" id="4749538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4749541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4749544">if</span>&nbsp;<span class="ident" id="4749547">v</span><span class="op" id="4749548">.</span><span class="ident" id="4749549">Bool</span><span class="op" id="4749553">(</span><span class="op" id="4749554">)</span>&nbsp;<span class="op" id="4749556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4749560">e</span><span class="op" id="4749561">.</span><span class="ident" id="4749562">WriteString</span><span class="op" id="4749573">(</span><span class="string" id="4749574">&#34;true&#34;</span><span class="op" id="4749580">)</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4749583">}</span>&nbsp;<span class="keyword" id="4749585">else</span>&nbsp;<span class="op" id="4749590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4749594">e</span><span class="op" id="4749595">.</span><span class="ident" id="4749596">WriteString</span><span class="op" id="4749607">(</span><span class="string" id="4749608">&#34;false&#34;</span><span class="op" id="4749615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4749618">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4749621">if</span>&nbsp;<span class="ident" id="4749624">quoted</span>&nbsp;<span class="op" id="4749631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4749635">e</span><span class="op" id="4749636">.</span><span class="ident" id="4749637">WriteByte</span><span class="op" id="4749646">(</span><span class="string" id="4749647">&#39;&#34;&#39;</span><span class="op" id="4749650">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4749653">}</span><br>
<span class="lineno"></span><span class="op" id="4749655">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4749658">func</span>&nbsp;<span class="ident" id="4749663">intEncoder</span><span class="op" id="4749673">(</span><span class="ident" id="4749674">e</span>&nbsp;<span class="op" id="4749676">*</span><span class="ident" id="4749677">encodeState</span><span class="op" id="4749688">,</span>&nbsp;<span class="ident" id="4749690">v</span>&nbsp;<span class="ident" id="4749692">reflect</span><span class="op" id="4749699">.</span><span class="ident" id="4749700">Value</span><span class="op" id="4749705">,</span>&nbsp;<span class="ident" id="4749707">quoted</span>&nbsp;<span class="builtintype" id="4749714">bool</span><span class="op" id="4749718">)</span>&nbsp;<span class="op" id="4749720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4749723">b</span>&nbsp;<span class="op" id="4749725">:=</span>&nbsp;<span class="ident" id="4749728">strconv</span><span class="op" id="4749735">.</span><span class="ident" id="4749736">AppendInt</span><span class="op" id="4749745">(</span><span class="ident" id="4749746">e</span><span class="op" id="4749747">.</span><span class="ident" id="4749748">scratch</span><span class="op" id="4749755">[</span><span class="op" id="4749756">:</span><span class="num" id="4749757">0</span><span class="op" id="4749758">]</span><span class="op" id="4749759">,</span>&nbsp;<span class="ident" id="4749761">v</span><span class="op" id="4749762">.</span><span class="ident" id="4749763">Int</span><span class="op" id="4749766">(</span><span class="op" id="4749767">)</span><span class="op" id="4749768">,</span>&nbsp;<span class="num" id="4749770">10</span><span class="op" id="4749772">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4749775">if</span>&nbsp;<span class="ident" id="4749778">quoted</span>&nbsp;<span class="op" id="4749785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4749789">e</span><span class="op" id="4749790">.</span><span class="ident" id="4749791">WriteByte</span><span class="op" id="4749800">(</span><span class="string" id="4749801">&#39;&#34;&#39;</span><span class="op" id="4749804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4749807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4749810">e</span><span class="op" id="4749811">.</span><span class="ident" id="4749812">Write</span><span class="op" id="4749817">(</span><span class="ident" id="4749818">b</span><span class="op" id="4749819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4749822">if</span>&nbsp;<span class="ident" id="4749825">quoted</span>&nbsp;<span class="op" id="4749832">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4749836">e</span><span class="op" id="4749837">.</span><span class="ident" id="4749838">WriteByte</span><span class="op" id="4749847">(</span><span class="string" id="4749848">&#39;&#34;&#39;</span><span class="op" id="4749851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4749854">}</span><br>
<span class="lineno"></span><span class="op" id="4749856">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4749859">func</span>&nbsp;<span class="ident" id="4749864">uintEncoder</span><span class="op" id="4749875">(</span><span class="ident" id="4749876">e</span>&nbsp;<span class="op" id="4749878">*</span><span class="ident" id="4749879">encodeState</span><span class="op" id="4749890">,</span>&nbsp;<span class="ident" id="4749892">v</span>&nbsp;<span class="ident" id="4749894">reflect</span><span class="op" id="4749901">.</span><span class="ident" id="4749902">Value</span><span class="op" id="4749907">,</span>&nbsp;<span class="ident" id="4749909">quoted</span>&nbsp;<span class="builtintype" id="4749916">bool</span><span class="op" id="4749920">)</span>&nbsp;<span class="op" id="4749922">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4749925">b</span>&nbsp;<span class="op" id="4749927">:=</span>&nbsp;<span class="ident" id="4749930">strconv</span><span class="op" id="4749937">.</span><span class="ident" id="4749938">AppendUint</span><span class="op" id="4749948">(</span><span class="ident" id="4749949">e</span><span class="op" id="4749950">.</span><span class="ident" id="4749951">scratch</span><span class="op" id="4749958">[</span><span class="op" id="4749959">:</span><span class="num" id="4749960">0</span><span class="op" id="4749961">]</span><span class="op" id="4749962">,</span>&nbsp;<span class="ident" id="4749964">v</span><span class="op" id="4749965">.</span><span class="ident" id="4749966">Uint</span><span class="op" id="4749970">(</span><span class="op" id="4749971">)</span><span class="op" id="4749972">,</span>&nbsp;<span class="num" id="4749974">10</span><span class="op" id="4749976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4749979">if</span>&nbsp;<span class="ident" id="4749982">quoted</span>&nbsp;<span class="op" id="4749989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4749993">e</span><span class="op" id="4749994">.</span><span class="ident" id="4749995">WriteByte</span><span class="op" id="4750004">(</span><span class="string" id="4750005">&#39;&#34;&#39;</span><span class="op" id="4750008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4750011">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4750014">e</span><span class="op" id="4750015">.</span><span class="ident" id="4750016">Write</span><span class="op" id="4750021">(</span><span class="ident" id="4750022">b</span><span class="op" id="4750023">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4750026">if</span>&nbsp;<span class="ident" id="4750029">quoted</span>&nbsp;<span class="op" id="4750036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4750040">e</span><span class="op" id="4750041">.</span><span class="ident" id="4750042">WriteByte</span><span class="op" id="4750051">(</span><span class="string" id="4750052">&#39;&#34;&#39;</span><span class="op" id="4750055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4750058">}</span><br>
<span class="lineno"></span><span class="op" id="4750060">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">510</span><span class="keyword" id="4750063">type</span>&nbsp;<span class="ident" id="4750068">floatEncoder</span>&nbsp;<span class="builtintype" id="4750081">int</span>&nbsp;<span class="comment" id="4750085">//&nbsp;number&nbsp;of&nbsp;bits</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4750104">func</span>&nbsp;<span class="op" id="4750109">(</span><span class="ident" id="4750110">bits</span>&nbsp;<span class="ident" id="4750115">floatEncoder</span><span class="op" id="4750127">)</span>&nbsp;<span class="ident" id="4750129">encode</span><span class="op" id="4750135">(</span><span class="ident" id="4750136">e</span>&nbsp;<span class="op" id="4750138">*</span><span class="ident" id="4750139">encodeState</span><span class="op" id="4750150">,</span>&nbsp;<span class="ident" id="4750152">v</span>&nbsp;<span class="ident" id="4750154">reflect</span><span class="op" id="4750161">.</span><span class="ident" id="4750162">Value</span><span class="op" id="4750167">,</span>&nbsp;<span class="ident" id="4750169">quoted</span>&nbsp;<span class="builtintype" id="4750176">bool</span><span class="op" id="4750180">)</span>&nbsp;<span class="op" id="4750182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4750185">f</span>&nbsp;<span class="op" id="4750187">:=</span>&nbsp;<span class="ident" id="4750190">v</span><span class="op" id="4750191">.</span><span class="ident" id="4750192">Float</span><span class="op" id="4750197">(</span><span class="op" id="4750198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4750201">if</span>&nbsp;<span class="ident" id="4750204">math</span><span class="op" id="4750208">.</span><span class="ident" id="4750209">IsInf</span><span class="op" id="4750214">(</span><span class="ident" id="4750215">f</span><span class="op" id="4750216">,</span>&nbsp;<span class="num" id="4750218">0</span><span class="op" id="4750219">)</span>&nbsp;<span class="op" id="4750221">||</span>&nbsp;<span class="ident" id="4750224">math</span><span class="op" id="4750228">.</span><span class="ident" id="4750229">IsNaN</span><span class="op" id="4750234">(</span><span class="ident" id="4750235">f</span><span class="op" id="4750236">)</span>&nbsp;<span class="op" id="4750238">{</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4750242">e</span><span class="op" id="4750243">.</span><span class="builtintype" id="4750244">error</span><span class="op" id="4750249">(</span><span class="op" id="4750250">&amp;</span><span class="ident" id="4750251">UnsupportedValueError</span><span class="op" id="4750272">{</span><span class="ident" id="4750273">v</span><span class="op" id="4750274">,</span>&nbsp;<span class="ident" id="4750276">strconv</span><span class="op" id="4750283">.</span><span class="ident" id="4750284">FormatFloat</span><span class="op" id="4750295">(</span><span class="ident" id="4750296">f</span><span class="op" id="4750297">,</span>&nbsp;<span class="string" id="4750299">&#39;g&#39;</span><span class="op" id="4750302">,</span>&nbsp;<span class="op" id="4750304">-</span><span class="num" id="4750305">1</span><span class="op" id="4750306">,</span>&nbsp;<span class="builtintype" id="4750308">int</span><span class="op" id="4750311">(</span><span class="ident" id="4750312">bits</span><span class="op" id="4750316">)</span><span class="op" id="4750317">)</span><span class="op" id="4750318">}</span><span class="op" id="4750319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4750322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4750325">b</span>&nbsp;<span class="op" id="4750327">:=</span>&nbsp;<span class="ident" id="4750330">strconv</span><span class="op" id="4750337">.</span><span class="ident" id="4750338">AppendFloat</span><span class="op" id="4750349">(</span><span class="ident" id="4750350">e</span><span class="op" id="4750351">.</span><span class="ident" id="4750352">scratch</span><span class="op" id="4750359">[</span><span class="op" id="4750360">:</span><span class="num" id="4750361">0</span><span class="op" id="4750362">]</span><span class="op" id="4750363">,</span>&nbsp;<span class="ident" id="4750365">f</span><span class="op" id="4750366">,</span>&nbsp;<span class="string" id="4750368">&#39;g&#39;</span><span class="op" id="4750371">,</span>&nbsp;<span class="op" id="4750373">-</span><span class="num" id="4750374">1</span><span class="op" id="4750375">,</span>&nbsp;<span class="builtintype" id="4750377">int</span><span class="op" id="4750380">(</span><span class="ident" id="4750381">bits</span><span class="op" id="4750385">)</span><span class="op" id="4750386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4750389">if</span>&nbsp;<span class="ident" id="4750392">quoted</span>&nbsp;<span class="op" id="4750399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4750403">e</span><span class="op" id="4750404">.</span><span class="ident" id="4750405">WriteByte</span><span class="op" id="4750414">(</span><span class="string" id="4750415">&#39;&#34;&#39;</span><span class="op" id="4750418">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4750421">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4750424">e</span><span class="op" id="4750425">.</span><span class="ident" id="4750426">Write</span><span class="op" id="4750431">(</span><span class="ident" id="4750432">b</span><span class="op" id="4750433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4750436">if</span>&nbsp;<span class="ident" id="4750439">quoted</span>&nbsp;<span class="op" id="4750446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4750450">e</span><span class="op" id="4750451">.</span><span class="ident" id="4750452">WriteByte</span><span class="op" id="4750461">(</span><span class="string" id="4750462">&#39;&#34;&#39;</span><span class="op" id="4750465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4750468">}</span><br>
<span class="lineno">525</span><span class="op" id="4750470">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4750473">var</span>&nbsp;<span class="op" id="4750477">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4750480">float32Encoder</span>&nbsp;<span class="op" id="4750495">=</span>&nbsp;<span class="op" id="4750497">(</span><span class="ident" id="4750498">floatEncoder</span><span class="op" id="4750510">(</span><span class="num" id="4750511">32</span><span class="op" id="4750513">)</span><span class="op" id="4750514">)</span><span class="op" id="4750515">.</span><span class="ident" id="4750516">encode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4750524">float64Encoder</span>&nbsp;<span class="op" id="4750539">=</span>&nbsp;<span class="op" id="4750541">(</span><span class="ident" id="4750542">floatEncoder</span><span class="op" id="4750554">(</span><span class="num" id="4750555">64</span><span class="op" id="4750557">)</span><span class="op" id="4750558">)</span><span class="op" id="4750559">.</span><span class="ident" id="4750560">encode</span><br>
<span class="lineno">530</span><span class="op" id="4750567">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4750570">func</span>&nbsp;<span class="ident" id="4750575">stringEncoder</span><span class="op" id="4750588">(</span><span class="ident" id="4750589">e</span>&nbsp;<span class="op" id="4750591">*</span><span class="ident" id="4750592">encodeState</span><span class="op" id="4750603">,</span>&nbsp;<span class="ident" id="4750605">v</span>&nbsp;<span class="ident" id="4750607">reflect</span><span class="op" id="4750614">.</span><span class="ident" id="4750615">Value</span><span class="op" id="4750620">,</span>&nbsp;<span class="ident" id="4750622">quoted</span>&nbsp;<span class="builtintype" id="4750629">bool</span><span class="op" id="4750633">)</span>&nbsp;<span class="op" id="4750635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4750638">if</span>&nbsp;<span class="ident" id="4750641">v</span><span class="op" id="4750642">.</span><span class="ident" id="4750643">Type</span><span class="op" id="4750647">(</span><span class="op" id="4750648">)</span>&nbsp;<span class="op" id="4750650">==</span>&nbsp;<span class="ident" id="4750653">numberType</span>&nbsp;<span class="op" id="4750664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4750668">numStr</span>&nbsp;<span class="op" id="4750675">:=</span>&nbsp;<span class="ident" id="4750678">v</span><span class="op" id="4750679">.</span><span class="ident" id="4750680">String</span><span class="op" id="4750686">(</span><span class="op" id="4750687">)</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4750691">if</span>&nbsp;<span class="ident" id="4750694">numStr</span>&nbsp;<span class="op" id="4750701">==</span>&nbsp;<span class="string" id="4750704">&#34;&#34;</span>&nbsp;<span class="op" id="4750707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4750712">numStr</span>&nbsp;<span class="op" id="4750719">=</span>&nbsp;<span class="string" id="4750721">&#34;0&#34;</span>&nbsp;<span class="comment" id="4750725">//&nbsp;Number&#39;s&nbsp;zero-val</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4750748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4750752">e</span><span class="op" id="4750753">.</span><span class="ident" id="4750754">WriteString</span><span class="op" id="4750765">(</span><span class="ident" id="4750766">numStr</span><span class="op" id="4750772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4750776">return</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4750784">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4750787">if</span>&nbsp;<span class="ident" id="4750790">quoted</span>&nbsp;<span class="op" id="4750797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4750801">sb</span><span class="op" id="4750803">,</span>&nbsp;<span class="ident" id="4750805">err</span>&nbsp;<span class="op" id="4750809">:=</span>&nbsp;<span class="ident" id="4750812">Marshal</span><span class="op" id="4750819">(</span><span class="ident" id="4750820">v</span><span class="op" id="4750821">.</span><span class="ident" id="4750822">String</span><span class="op" id="4750828">(</span><span class="op" id="4750829">)</span><span class="op" id="4750830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4750834">if</span>&nbsp;<span class="ident" id="4750837">err</span>&nbsp;<span class="op" id="4750841">!=</span>&nbsp;<span class="ident" id="4750844">nil</span>&nbsp;<span class="op" id="4750848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4750853">e</span><span class="op" id="4750854">.</span><span class="builtintype" id="4750855">error</span><span class="op" id="4750860">(</span><span class="ident" id="4750861">err</span><span class="op" id="4750864">)</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4750868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4750872">e</span><span class="op" id="4750873">.</span><span class="builtintype" id="4750874">string</span><span class="op" id="4750880">(</span><span class="builtintype" id="4750881">string</span><span class="op" id="4750887">(</span><span class="ident" id="4750888">sb</span><span class="op" id="4750890">)</span><span class="op" id="4750891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4750894">}</span>&nbsp;<span class="keyword" id="4750896">else</span>&nbsp;<span class="op" id="4750901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4750905">e</span><span class="op" id="4750906">.</span><span class="builtintype" id="4750907">string</span><span class="op" id="4750913">(</span><span class="ident" id="4750914">v</span><span class="op" id="4750915">.</span><span class="ident" id="4750916">String</span><span class="op" id="4750922">(</span><span class="op" id="4750923">)</span><span class="op" id="4750924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4750927">}</span><br>
<span class="lineno">550</span><span class="op" id="4750929">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4750932">func</span>&nbsp;<span class="ident" id="4750937">interfaceEncoder</span><span class="op" id="4750953">(</span><span class="ident" id="4750954">e</span>&nbsp;<span class="op" id="4750956">*</span><span class="ident" id="4750957">encodeState</span><span class="op" id="4750968">,</span>&nbsp;<span class="ident" id="4750970">v</span>&nbsp;<span class="ident" id="4750972">reflect</span><span class="op" id="4750979">.</span><span class="ident" id="4750980">Value</span><span class="op" id="4750985">,</span>&nbsp;<span class="ident" id="4750987">quoted</span>&nbsp;<span class="builtintype" id="4750994">bool</span><span class="op" id="4750998">)</span>&nbsp;<span class="op" id="4751000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4751003">if</span>&nbsp;<span class="ident" id="4751006">v</span><span class="op" id="4751007">.</span><span class="ident" id="4751008">IsNil</span><span class="op" id="4751013">(</span><span class="op" id="4751014">)</span>&nbsp;<span class="op" id="4751016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4751020">e</span><span class="op" id="4751021">.</span><span class="ident" id="4751022">WriteString</span><span class="op" id="4751033">(</span><span class="string" id="4751034">&#34;null&#34;</span><span class="op" id="4751040">)</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4751044">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4751052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4751055">e</span><span class="op" id="4751056">.</span><span class="ident" id="4751057">reflectValue</span><span class="op" id="4751069">(</span><span class="ident" id="4751070">v</span><span class="op" id="4751071">.</span><span class="ident" id="4751072">Elem</span><span class="op" id="4751076">(</span><span class="op" id="4751077">)</span><span class="op" id="4751078">)</span><br>
<span class="lineno"></span><span class="op" id="4751080">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">560</span><span class="keyword" id="4751083">func</span>&nbsp;<span class="ident" id="4751088">unsupportedTypeEncoder</span><span class="op" id="4751110">(</span><span class="ident" id="4751111">e</span>&nbsp;<span class="op" id="4751113">*</span><span class="ident" id="4751114">encodeState</span><span class="op" id="4751125">,</span>&nbsp;<span class="ident" id="4751127">v</span>&nbsp;<span class="ident" id="4751129">reflect</span><span class="op" id="4751136">.</span><span class="ident" id="4751137">Value</span><span class="op" id="4751142">,</span>&nbsp;<span class="ident" id="4751144">quoted</span>&nbsp;<span class="builtintype" id="4751151">bool</span><span class="op" id="4751155">)</span>&nbsp;<span class="op" id="4751157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4751160">e</span><span class="op" id="4751161">.</span><span class="builtintype" id="4751162">error</span><span class="op" id="4751167">(</span><span class="op" id="4751168">&amp;</span><span class="ident" id="4751169">UnsupportedTypeError</span><span class="op" id="4751189">{</span><span class="ident" id="4751190">v</span><span class="op" id="4751191">.</span><span class="ident" id="4751192">Type</span><span class="op" id="4751196">(</span><span class="op" id="4751197">)</span><span class="op" id="4751198">}</span><span class="op" id="4751199">)</span><br>
<span class="lineno"></span><span class="op" id="4751201">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4751204">type</span>&nbsp;<span class="ident" id="4751209">structEncoder</span>&nbsp;<span class="keyword" id="4751223">struct</span>&nbsp;<span class="op" id="4751230">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4751233">fields</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4751243">[</span><span class="op" id="4751244">]</span><span class="ident" id="4751245">field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4751252">fieldEncs</span>&nbsp;<span class="op" id="4751262">[</span><span class="op" id="4751263">]</span><span class="ident" id="4751264">encoderFunc</span><br>
<span class="lineno"></span><span class="op" id="4751276">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4751279">func</span>&nbsp;<span class="op" id="4751284">(</span><span class="ident" id="4751285">se</span>&nbsp;<span class="op" id="4751288">*</span><span class="ident" id="4751289">structEncoder</span><span class="op" id="4751302">)</span>&nbsp;<span class="ident" id="4751304">encode</span><span class="op" id="4751310">(</span><span class="ident" id="4751311">e</span>&nbsp;<span class="op" id="4751313">*</span><span class="ident" id="4751314">encodeState</span><span class="op" id="4751325">,</span>&nbsp;<span class="ident" id="4751327">v</span>&nbsp;<span class="ident" id="4751329">reflect</span><span class="op" id="4751336">.</span><span class="ident" id="4751337">Value</span><span class="op" id="4751342">,</span>&nbsp;<span class="ident" id="4751344">quoted</span>&nbsp;<span class="builtintype" id="4751351">bool</span><span class="op" id="4751355">)</span>&nbsp;<span class="op" id="4751357">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4751360">e</span><span class="op" id="4751361">.</span><span class="ident" id="4751362">WriteByte</span><span class="op" id="4751371">(</span><span class="string" id="4751372">&#39;{&#39;</span><span class="op" id="4751375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4751378">first</span>&nbsp;<span class="op" id="4751384">:=</span>&nbsp;<span class="ident" id="4751387">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4751393">for</span>&nbsp;<span class="ident" id="4751397">i</span><span class="op" id="4751398">,</span>&nbsp;<span class="ident" id="4751400">f</span>&nbsp;<span class="op" id="4751402">:=</span>&nbsp;<span class="keyword" id="4751405">range</span>&nbsp;<span class="ident" id="4751411">se</span><span class="op" id="4751413">.</span><span class="ident" id="4751414">fields</span>&nbsp;<span class="op" id="4751421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4751425">fv</span>&nbsp;<span class="op" id="4751428">:=</span>&nbsp;<span class="ident" id="4751431">fieldByIndex</span><span class="op" id="4751443">(</span><span class="ident" id="4751444">v</span><span class="op" id="4751445">,</span>&nbsp;<span class="ident" id="4751447">f</span><span class="op" id="4751448">.</span><span class="ident" id="4751449">index</span><span class="op" id="4751454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4751458">if</span>&nbsp;<span class="op" id="4751461">!</span><span class="ident" id="4751462">fv</span><span class="op" id="4751464">.</span><span class="ident" id="4751465">IsValid</span><span class="op" id="4751472">(</span><span class="op" id="4751473">)</span>&nbsp;<span class="op" id="4751475">||</span>&nbsp;<span class="ident" id="4751478">f</span><span class="op" id="4751479">.</span><span class="ident" id="4751480">omitEmpty</span>&nbsp;<span class="op" id="4751490">&amp;&amp;</span>&nbsp;<span class="ident" id="4751493">isEmptyValue</span><span class="op" id="4751505">(</span><span class="ident" id="4751506">fv</span><span class="op" id="4751508">)</span>&nbsp;<span class="op" id="4751510">{</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4751515">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4751526">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4751530">if</span>&nbsp;<span class="ident" id="4751533">first</span>&nbsp;<span class="op" id="4751539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4751544">first</span>&nbsp;<span class="op" id="4751550">=</span>&nbsp;<span class="ident" id="4751552">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4751560">}</span>&nbsp;<span class="keyword" id="4751562">else</span>&nbsp;<span class="op" id="4751567">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4751572">e</span><span class="op" id="4751573">.</span><span class="ident" id="4751574">WriteByte</span><span class="op" id="4751583">(</span><span class="string" id="4751584">&#39;,&#39;</span><span class="op" id="4751587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4751591">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4751595">e</span><span class="op" id="4751596">.</span><span class="builtintype" id="4751597">string</span><span class="op" id="4751603">(</span><span class="ident" id="4751604">f</span><span class="op" id="4751605">.</span><span class="ident" id="4751606">name</span><span class="op" id="4751610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4751614">e</span><span class="op" id="4751615">.</span><span class="ident" id="4751616">WriteByte</span><span class="op" id="4751625">(</span><span class="string" id="4751626">&#39;:&#39;</span><span class="op" id="4751629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4751633">se</span><span class="op" id="4751635">.</span><span class="ident" id="4751636">fieldEncs</span><span class="op" id="4751645">[</span><span class="ident" id="4751646">i</span><span class="op" id="4751647">]</span><span class="op" id="4751648">(</span><span class="ident" id="4751649">e</span><span class="op" id="4751650">,</span>&nbsp;<span class="ident" id="4751652">fv</span><span class="op" id="4751654">,</span>&nbsp;<span class="ident" id="4751656">f</span><span class="op" id="4751657">.</span><span class="ident" id="4751658">quoted</span><span class="op" id="4751664">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4751667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4751670">e</span><span class="op" id="4751671">.</span><span class="ident" id="4751672">WriteByte</span><span class="op" id="4751681">(</span><span class="string" id="4751682">&#39;}&#39;</span><span class="op" id="4751685">)</span><br>
<span class="lineno"></span><span class="op" id="4751687">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4751690">func</span>&nbsp;<span class="ident" id="4751695">newStructEncoder</span><span class="op" id="4751711">(</span><span class="ident" id="4751712">t</span>&nbsp;<span class="ident" id="4751714">reflect</span><span class="op" id="4751721">.</span><span class="ident" id="4751722">Type</span><span class="op" id="4751726">)</span>&nbsp;<span class="ident" id="4751728">encoderFunc</span>&nbsp;<span class="op" id="4751740">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4751743">fields</span>&nbsp;<span class="op" id="4751750">:=</span>&nbsp;<span class="ident" id="4751753">cachedTypeFields</span><span class="op" id="4751769">(</span><span class="ident" id="4751770">t</span><span class="op" id="4751771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4751774">se</span>&nbsp;<span class="op" id="4751777">:=</span>&nbsp;<span class="op" id="4751780">&amp;</span><span class="ident" id="4751781">structEncoder</span><span class="op" id="4751794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4751798">fields</span><span class="op" id="4751804">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4751809">fields</span><span class="op" id="4751815">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4751819">fieldEncs</span><span class="op" id="4751828">:</span>&nbsp;<span class="builtinfunc" id="4751830">make</span><span class="op" id="4751834">(</span><span class="op" id="4751835">[</span><span class="op" id="4751836">]</span><span class="ident" id="4751837">encoderFunc</span><span class="op" id="4751848">,</span>&nbsp;<span class="builtinfunc" id="4751850">len</span><span class="op" id="4751853">(</span><span class="ident" id="4751854">fields</span><span class="op" id="4751860">)</span><span class="op" id="4751861">)</span><span class="op" id="4751862">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4751865">}</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4751868">for</span>&nbsp;<span class="ident" id="4751872">i</span><span class="op" id="4751873">,</span>&nbsp;<span class="ident" id="4751875">f</span>&nbsp;<span class="op" id="4751877">:=</span>&nbsp;<span class="keyword" id="4751880">range</span>&nbsp;<span class="ident" id="4751886">fields</span>&nbsp;<span class="op" id="4751893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4751897">se</span><span class="op" id="4751899">.</span><span class="ident" id="4751900">fieldEncs</span><span class="op" id="4751909">[</span><span class="ident" id="4751910">i</span><span class="op" id="4751911">]</span>&nbsp;<span class="op" id="4751913">=</span>&nbsp;<span class="ident" id="4751915">typeEncoder</span><span class="op" id="4751926">(</span><span class="ident" id="4751927">typeByIndex</span><span class="op" id="4751938">(</span><span class="ident" id="4751939">t</span><span class="op" id="4751940">,</span>&nbsp;<span class="ident" id="4751942">f</span><span class="op" id="4751943">.</span><span class="ident" id="4751944">index</span><span class="op" id="4751949">)</span><span class="op" id="4751950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4751953">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4751956">return</span>&nbsp;<span class="ident" id="4751963">se</span><span class="op" id="4751965">.</span><span class="ident" id="4751966">encode</span><br>
<span class="lineno"></span><span class="op" id="4751973">}</span><br>
<span class="lineno">600</span><br>
<span class="lineno"></span><span class="keyword" id="4751976">type</span>&nbsp;<span class="ident" id="4751981">mapEncoder</span>&nbsp;<span class="keyword" id="4751992">struct</span>&nbsp;<span class="op" id="4751999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4752002">elemEnc</span>&nbsp;<span class="ident" id="4752010">encoderFunc</span><br>
<span class="lineno"></span><span class="op" id="4752022">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">605</span><span class="keyword" id="4752025">func</span>&nbsp;<span class="op" id="4752030">(</span><span class="ident" id="4752031">me</span>&nbsp;<span class="op" id="4752034">*</span><span class="ident" id="4752035">mapEncoder</span><span class="op" id="4752045">)</span>&nbsp;<span class="ident" id="4752047">encode</span><span class="op" id="4752053">(</span><span class="ident" id="4752054">e</span>&nbsp;<span class="op" id="4752056">*</span><span class="ident" id="4752057">encodeState</span><span class="op" id="4752068">,</span>&nbsp;<span class="ident" id="4752070">v</span>&nbsp;<span class="ident" id="4752072">reflect</span><span class="op" id="4752079">.</span><span class="ident" id="4752080">Value</span><span class="op" id="4752085">,</span>&nbsp;<span class="ident" id="4752087">_</span>&nbsp;<span class="builtintype" id="4752089">bool</span><span class="op" id="4752093">)</span>&nbsp;<span class="op" id="4752095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4752098">if</span>&nbsp;<span class="ident" id="4752101">v</span><span class="op" id="4752102">.</span><span class="ident" id="4752103">IsNil</span><span class="op" id="4752108">(</span><span class="op" id="4752109">)</span>&nbsp;<span class="op" id="4752111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4752115">e</span><span class="op" id="4752116">.</span><span class="ident" id="4752117">WriteString</span><span class="op" id="4752128">(</span><span class="string" id="4752129">&#34;null&#34;</span><span class="op" id="4752135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4752139">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4752147">}</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4752150">e</span><span class="op" id="4752151">.</span><span class="ident" id="4752152">WriteByte</span><span class="op" id="4752161">(</span><span class="string" id="4752162">&#39;{&#39;</span><span class="op" id="4752165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4752168">var</span>&nbsp;<span class="ident" id="4752172">sv</span>&nbsp;<span class="ident" id="4752175">stringValues</span>&nbsp;<span class="op" id="4752188">=</span>&nbsp;<span class="ident" id="4752190">v</span><span class="op" id="4752191">.</span><span class="ident" id="4752192">MapKeys</span><span class="op" id="4752199">(</span><span class="op" id="4752200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4752203">sort</span><span class="op" id="4752207">.</span><span class="ident" id="4752208">Sort</span><span class="op" id="4752212">(</span><span class="ident" id="4752213">sv</span><span class="op" id="4752215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4752218">for</span>&nbsp;<span class="ident" id="4752222">i</span><span class="op" id="4752223">,</span>&nbsp;<span class="ident" id="4752225">k</span>&nbsp;<span class="op" id="4752227">:=</span>&nbsp;<span class="keyword" id="4752230">range</span>&nbsp;<span class="ident" id="4752236">sv</span>&nbsp;<span class="op" id="4752239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4752243">if</span>&nbsp;<span class="ident" id="4752246">i</span>&nbsp;<span class="op" id="4752248">&gt;</span>&nbsp;<span class="num" id="4752250">0</span>&nbsp;<span class="op" id="4752252">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4752257">e</span><span class="op" id="4752258">.</span><span class="ident" id="4752259">WriteByte</span><span class="op" id="4752268">(</span><span class="string" id="4752269">&#39;,&#39;</span><span class="op" id="4752272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4752276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4752280">e</span><span class="op" id="4752281">.</span><span class="builtintype" id="4752282">string</span><span class="op" id="4752288">(</span><span class="ident" id="4752289">k</span><span class="op" id="4752290">.</span><span class="ident" id="4752291">String</span><span class="op" id="4752297">(</span><span class="op" id="4752298">)</span><span class="op" id="4752299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4752303">e</span><span class="op" id="4752304">.</span><span class="ident" id="4752305">WriteByte</span><span class="op" id="4752314">(</span><span class="string" id="4752315">&#39;:&#39;</span><span class="op" id="4752318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4752322">me</span><span class="op" id="4752324">.</span><span class="ident" id="4752325">elemEnc</span><span class="op" id="4752332">(</span><span class="ident" id="4752333">e</span><span class="op" id="4752334">,</span>&nbsp;<span class="ident" id="4752336">v</span><span class="op" id="4752337">.</span><span class="ident" id="4752338">MapIndex</span><span class="op" id="4752346">(</span><span class="ident" id="4752347">k</span><span class="op" id="4752348">)</span><span class="op" id="4752349">,</span>&nbsp;<span class="ident" id="4752351">false</span><span class="op" id="4752356">)</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4752359">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4752362">e</span><span class="op" id="4752363">.</span><span class="ident" id="4752364">WriteByte</span><span class="op" id="4752373">(</span><span class="string" id="4752374">&#39;}&#39;</span><span class="op" id="4752377">)</span><br>
<span class="lineno"></span><span class="op" id="4752379">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4752382">func</span>&nbsp;<span class="ident" id="4752387">newMapEncoder</span><span class="op" id="4752400">(</span><span class="ident" id="4752401">t</span>&nbsp;<span class="ident" id="4752403">reflect</span><span class="op" id="4752410">.</span><span class="ident" id="4752411">Type</span><span class="op" id="4752415">)</span>&nbsp;<span class="ident" id="4752417">encoderFunc</span>&nbsp;<span class="op" id="4752429">{</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4752432">if</span>&nbsp;<span class="ident" id="4752435">t</span><span class="op" id="4752436">.</span><span class="ident" id="4752437">Key</span><span class="op" id="4752440">(</span><span class="op" id="4752441">)</span><span class="op" id="4752442">.</span><span class="ident" id="4752443">Kind</span><span class="op" id="4752447">(</span><span class="op" id="4752448">)</span>&nbsp;<span class="op" id="4752450">!=</span>&nbsp;<span class="ident" id="4752453">reflect</span><span class="op" id="4752460">.</span><span class="ident" id="4752461">String</span>&nbsp;<span class="op" id="4752468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4752472">return</span>&nbsp;<span class="ident" id="4752479">unsupportedTypeEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4752503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4752506">me</span>&nbsp;<span class="op" id="4752509">:=</span>&nbsp;<span class="op" id="4752512">&amp;</span><span class="ident" id="4752513">mapEncoder</span><span class="op" id="4752523">{</span><span class="ident" id="4752524">typeEncoder</span><span class="op" id="4752535">(</span><span class="ident" id="4752536">t</span><span class="op" id="4752537">.</span><span class="ident" id="4752538">Elem</span><span class="op" id="4752542">(</span><span class="op" id="4752543">)</span><span class="op" id="4752544">)</span><span class="op" id="4752545">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4752548">return</span>&nbsp;<span class="ident" id="4752555">me</span><span class="op" id="4752557">.</span><span class="ident" id="4752558">encode</span><br>
<span class="lineno">630</span><span class="op" id="4752565">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4752568">func</span>&nbsp;<span class="ident" id="4752573">encodeByteSlice</span><span class="op" id="4752588">(</span><span class="ident" id="4752589">e</span>&nbsp;<span class="op" id="4752591">*</span><span class="ident" id="4752592">encodeState</span><span class="op" id="4752603">,</span>&nbsp;<span class="ident" id="4752605">v</span>&nbsp;<span class="ident" id="4752607">reflect</span><span class="op" id="4752614">.</span><span class="ident" id="4752615">Value</span><span class="op" id="4752620">,</span>&nbsp;<span class="ident" id="4752622">_</span>&nbsp;<span class="builtintype" id="4752624">bool</span><span class="op" id="4752628">)</span>&nbsp;<span class="op" id="4752630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4752633">if</span>&nbsp;<span class="ident" id="4752636">v</span><span class="op" id="4752637">.</span><span class="ident" id="4752638">IsNil</span><span class="op" id="4752643">(</span><span class="op" id="4752644">)</span>&nbsp;<span class="op" id="4752646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4752650">e</span><span class="op" id="4752651">.</span><span class="ident" id="4752652">WriteString</span><span class="op" id="4752663">(</span><span class="string" id="4752664">&#34;null&#34;</span><span class="op" id="4752670">)</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4752674">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4752682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4752685">s</span>&nbsp;<span class="op" id="4752687">:=</span>&nbsp;<span class="ident" id="4752690">v</span><span class="op" id="4752691">.</span><span class="ident" id="4752692">Bytes</span><span class="op" id="4752697">(</span><span class="op" id="4752698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4752701">e</span><span class="op" id="4752702">.</span><span class="ident" id="4752703">WriteByte</span><span class="op" id="4752712">(</span><span class="string" id="4752713">&#39;&#34;&#39;</span><span class="op" id="4752716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4752719">if</span>&nbsp;<span class="builtinfunc" id="4752722">len</span><span class="op" id="4752725">(</span><span class="ident" id="4752726">s</span><span class="op" id="4752727">)</span>&nbsp;<span class="op" id="4752729">&lt;</span>&nbsp;<span class="num" id="4752731">1024</span>&nbsp;<span class="op" id="4752736">{</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4752740">//&nbsp;for&nbsp;small&nbsp;buffers,&nbsp;using&nbsp;Encode&nbsp;directly&nbsp;is&nbsp;much&nbsp;faster.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4752802">dst</span>&nbsp;<span class="op" id="4752806">:=</span>&nbsp;<span class="builtinfunc" id="4752809">make</span><span class="op" id="4752813">(</span><span class="op" id="4752814">[</span><span class="op" id="4752815">]</span><span class="builtintype" id="4752816">byte</span><span class="op" id="4752820">,</span>&nbsp;<span class="ident" id="4752822">base64</span><span class="op" id="4752828">.</span><span class="ident" id="4752829">StdEncoding</span><span class="op" id="4752840">.</span><span class="ident" id="4752841">EncodedLen</span><span class="op" id="4752851">(</span><span class="builtinfunc" id="4752852">len</span><span class="op" id="4752855">(</span><span class="ident" id="4752856">s</span><span class="op" id="4752857">)</span><span class="op" id="4752858">)</span><span class="op" id="4752859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4752863">base64</span><span class="op" id="4752869">.</span><span class="ident" id="4752870">StdEncoding</span><span class="op" id="4752881">.</span><span class="ident" id="4752882">Encode</span><span class="op" id="4752888">(</span><span class="ident" id="4752889">dst</span><span class="op" id="4752892">,</span>&nbsp;<span class="ident" id="4752894">s</span><span class="op" id="4752895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4752899">e</span><span class="op" id="4752900">.</span><span class="ident" id="4752901">Write</span><span class="op" id="4752906">(</span><span class="ident" id="4752907">dst</span><span class="op" id="4752910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4752913">}</span>&nbsp;<span class="keyword" id="4752915">else</span>&nbsp;<span class="op" id="4752920">{</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4752924">//&nbsp;for&nbsp;large&nbsp;buffers,&nbsp;avoid&nbsp;unnecessary&nbsp;extra&nbsp;temporary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4752982">//&nbsp;buffer&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4753001">enc</span>&nbsp;<span class="op" id="4753005">:=</span>&nbsp;<span class="ident" id="4753008">base64</span><span class="op" id="4753014">.</span><span class="ident" id="4753015">NewEncoder</span><span class="op" id="4753025">(</span><span class="ident" id="4753026">base64</span><span class="op" id="4753032">.</span><span class="ident" id="4753033">StdEncoding</span><span class="op" id="4753044">,</span>&nbsp;<span class="ident" id="4753046">e</span><span class="op" id="4753047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4753051">enc</span><span class="op" id="4753054">.</span><span class="ident" id="4753055">Write</span><span class="op" id="4753060">(</span><span class="ident" id="4753061">s</span><span class="op" id="4753062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4753066">enc</span><span class="op" id="4753069">.</span><span class="ident" id="4753070">Close</span><span class="op" id="4753075">(</span><span class="op" id="4753076">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4753079">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4753082">e</span><span class="op" id="4753083">.</span><span class="ident" id="4753084">WriteByte</span><span class="op" id="4753093">(</span><span class="string" id="4753094">&#39;&#34;&#39;</span><span class="op" id="4753097">)</span><br>
<span class="lineno"></span><span class="op" id="4753099">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4753102">//&nbsp;sliceEncoder&nbsp;just&nbsp;wraps&nbsp;an&nbsp;arrayEncoder,&nbsp;checking&nbsp;to&nbsp;make&nbsp;sure&nbsp;the&nbsp;value&nbsp;isn&#39;t&nbsp;nil.</span><br>
<span class="lineno">655</span><span class="keyword" id="4753189">type</span>&nbsp;<span class="ident" id="4753194">sliceEncoder</span>&nbsp;<span class="keyword" id="4753207">struct</span>&nbsp;<span class="op" id="4753214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4753217">arrayEnc</span>&nbsp;<span class="ident" id="4753226">encoderFunc</span><br>
<span class="lineno"></span><span class="op" id="4753238">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4753241">func</span>&nbsp;<span class="op" id="4753246">(</span><span class="ident" id="4753247">se</span>&nbsp;<span class="op" id="4753250">*</span><span class="ident" id="4753251">sliceEncoder</span><span class="op" id="4753263">)</span>&nbsp;<span class="ident" id="4753265">encode</span><span class="op" id="4753271">(</span><span class="ident" id="4753272">e</span>&nbsp;<span class="op" id="4753274">*</span><span class="ident" id="4753275">encodeState</span><span class="op" id="4753286">,</span>&nbsp;<span class="ident" id="4753288">v</span>&nbsp;<span class="ident" id="4753290">reflect</span><span class="op" id="4753297">.</span><span class="ident" id="4753298">Value</span><span class="op" id="4753303">,</span>&nbsp;<span class="ident" id="4753305">_</span>&nbsp;<span class="builtintype" id="4753307">bool</span><span class="op" id="4753311">)</span>&nbsp;<span class="op" id="4753313">{</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4753316">if</span>&nbsp;<span class="ident" id="4753319">v</span><span class="op" id="4753320">.</span><span class="ident" id="4753321">IsNil</span><span class="op" id="4753326">(</span><span class="op" id="4753327">)</span>&nbsp;<span class="op" id="4753329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4753333">e</span><span class="op" id="4753334">.</span><span class="ident" id="4753335">WriteString</span><span class="op" id="4753346">(</span><span class="string" id="4753347">&#34;null&#34;</span><span class="op" id="4753353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4753357">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4753365">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4753368">se</span><span class="op" id="4753370">.</span><span class="ident" id="4753371">arrayEnc</span><span class="op" id="4753379">(</span><span class="ident" id="4753380">e</span><span class="op" id="4753381">,</span>&nbsp;<span class="ident" id="4753383">v</span><span class="op" id="4753384">,</span>&nbsp;<span class="ident" id="4753386">false</span><span class="op" id="4753391">)</span><br>
<span class="lineno">665</span><span class="op" id="4753393">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4753396">func</span>&nbsp;<span class="ident" id="4753401">newSliceEncoder</span><span class="op" id="4753416">(</span><span class="ident" id="4753417">t</span>&nbsp;<span class="ident" id="4753419">reflect</span><span class="op" id="4753426">.</span><span class="ident" id="4753427">Type</span><span class="op" id="4753431">)</span>&nbsp;<span class="ident" id="4753433">encoderFunc</span>&nbsp;<span class="op" id="4753445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4753448">//&nbsp;Byte&nbsp;slices&nbsp;get&nbsp;special&nbsp;treatment;&nbsp;arrays&nbsp;don&#39;t.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4753501">if</span>&nbsp;<span class="ident" id="4753504">t</span><span class="op" id="4753505">.</span><span class="ident" id="4753506">Elem</span><span class="op" id="4753510">(</span><span class="op" id="4753511">)</span><span class="op" id="4753512">.</span><span class="ident" id="4753513">Kind</span><span class="op" id="4753517">(</span><span class="op" id="4753518">)</span>&nbsp;<span class="op" id="4753520">==</span>&nbsp;<span class="ident" id="4753523">reflect</span><span class="op" id="4753530">.</span><span class="ident" id="4753531">Uint8</span>&nbsp;<span class="op" id="4753537">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4753541">return</span>&nbsp;<span class="ident" id="4753548">encodeByteSlice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4753565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4753568">enc</span>&nbsp;<span class="op" id="4753572">:=</span>&nbsp;<span class="op" id="4753575">&amp;</span><span class="ident" id="4753576">sliceEncoder</span><span class="op" id="4753588">{</span><span class="ident" id="4753589">newArrayEncoder</span><span class="op" id="4753604">(</span><span class="ident" id="4753605">t</span><span class="op" id="4753606">)</span><span class="op" id="4753607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4753610">return</span>&nbsp;<span class="ident" id="4753617">enc</span><span class="op" id="4753620">.</span><span class="ident" id="4753621">encode</span><br>
<span class="lineno"></span><span class="op" id="4753628">}</span><br>
<span class="lineno">675</span><br>
<span class="lineno"></span><span class="keyword" id="4753631">type</span>&nbsp;<span class="ident" id="4753636">arrayEncoder</span>&nbsp;<span class="keyword" id="4753649">struct</span>&nbsp;<span class="op" id="4753656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4753659">elemEnc</span>&nbsp;<span class="ident" id="4753667">encoderFunc</span><br>
<span class="lineno"></span><span class="op" id="4753679">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">680</span><span class="keyword" id="4753682">func</span>&nbsp;<span class="op" id="4753687">(</span><span class="ident" id="4753688">ae</span>&nbsp;<span class="op" id="4753691">*</span><span class="ident" id="4753692">arrayEncoder</span><span class="op" id="4753704">)</span>&nbsp;<span class="ident" id="4753706">encode</span><span class="op" id="4753712">(</span><span class="ident" id="4753713">e</span>&nbsp;<span class="op" id="4753715">*</span><span class="ident" id="4753716">encodeState</span><span class="op" id="4753727">,</span>&nbsp;<span class="ident" id="4753729">v</span>&nbsp;<span class="ident" id="4753731">reflect</span><span class="op" id="4753738">.</span><span class="ident" id="4753739">Value</span><span class="op" id="4753744">,</span>&nbsp;<span class="ident" id="4753746">_</span>&nbsp;<span class="builtintype" id="4753748">bool</span><span class="op" id="4753752">)</span>&nbsp;<span class="op" id="4753754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4753757">e</span><span class="op" id="4753758">.</span><span class="ident" id="4753759">WriteByte</span><span class="op" id="4753768">(</span><span class="string" id="4753769">&#39;[&#39;</span><span class="op" id="4753772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4753775">n</span>&nbsp;<span class="op" id="4753777">:=</span>&nbsp;<span class="ident" id="4753780">v</span><span class="op" id="4753781">.</span><span class="ident" id="4753782">Len</span><span class="op" id="4753785">(</span><span class="op" id="4753786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4753789">for</span>&nbsp;<span class="ident" id="4753793">i</span>&nbsp;<span class="op" id="4753795">:=</span>&nbsp;<span class="num" id="4753798">0</span><span class="op" id="4753799">;</span>&nbsp;<span class="ident" id="4753801">i</span>&nbsp;<span class="op" id="4753803">&lt;</span>&nbsp;<span class="ident" id="4753805">n</span><span class="op" id="4753806">;</span>&nbsp;<span class="ident" id="4753808">i</span><span class="op" id="4753809">++</span>&nbsp;<span class="op" id="4753812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4753816">if</span>&nbsp;<span class="ident" id="4753819">i</span>&nbsp;<span class="op" id="4753821">&gt;</span>&nbsp;<span class="num" id="4753823">0</span>&nbsp;<span class="op" id="4753825">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4753830">e</span><span class="op" id="4753831">.</span><span class="ident" id="4753832">WriteByte</span><span class="op" id="4753841">(</span><span class="string" id="4753842">&#39;,&#39;</span><span class="op" id="4753845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4753849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4753853">ae</span><span class="op" id="4753855">.</span><span class="ident" id="4753856">elemEnc</span><span class="op" id="4753863">(</span><span class="ident" id="4753864">e</span><span class="op" id="4753865">,</span>&nbsp;<span class="ident" id="4753867">v</span><span class="op" id="4753868">.</span><span class="ident" id="4753869">Index</span><span class="op" id="4753874">(</span><span class="ident" id="4753875">i</span><span class="op" id="4753876">)</span><span class="op" id="4753877">,</span>&nbsp;<span class="ident" id="4753879">false</span><span class="op" id="4753884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4753887">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4753890">e</span><span class="op" id="4753891">.</span><span class="ident" id="4753892">WriteByte</span><span class="op" id="4753901">(</span><span class="string" id="4753902">&#39;]&#39;</span><span class="op" id="4753905">)</span><br>
<span class="lineno">690</span><span class="op" id="4753907">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4753910">func</span>&nbsp;<span class="ident" id="4753915">newArrayEncoder</span><span class="op" id="4753930">(</span><span class="ident" id="4753931">t</span>&nbsp;<span class="ident" id="4753933">reflect</span><span class="op" id="4753940">.</span><span class="ident" id="4753941">Type</span><span class="op" id="4753945">)</span>&nbsp;<span class="ident" id="4753947">encoderFunc</span>&nbsp;<span class="op" id="4753959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4753962">enc</span>&nbsp;<span class="op" id="4753966">:=</span>&nbsp;<span class="op" id="4753969">&amp;</span><span class="ident" id="4753970">arrayEncoder</span><span class="op" id="4753982">{</span><span class="ident" id="4753983">typeEncoder</span><span class="op" id="4753994">(</span><span class="ident" id="4753995">t</span><span class="op" id="4753996">.</span><span class="ident" id="4753997">Elem</span><span class="op" id="4754001">(</span><span class="op" id="4754002">)</span><span class="op" id="4754003">)</span><span class="op" id="4754004">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4754007">return</span>&nbsp;<span class="ident" id="4754014">enc</span><span class="op" id="4754017">.</span><span class="ident" id="4754018">encode</span><br>
<span class="lineno">695</span><span class="op" id="4754025">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4754028">type</span>&nbsp;<span class="ident" id="4754033">ptrEncoder</span>&nbsp;<span class="keyword" id="4754044">struct</span>&nbsp;<span class="op" id="4754051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4754054">elemEnc</span>&nbsp;<span class="ident" id="4754062">encoderFunc</span><br>
<span class="lineno"></span><span class="op" id="4754074">}</span><br>
<span class="lineno">700</span><br>
<span class="lineno"></span><span class="keyword" id="4754077">func</span>&nbsp;<span class="op" id="4754082">(</span><span class="ident" id="4754083">pe</span>&nbsp;<span class="op" id="4754086">*</span><span class="ident" id="4754087">ptrEncoder</span><span class="op" id="4754097">)</span>&nbsp;<span class="ident" id="4754099">encode</span><span class="op" id="4754105">(</span><span class="ident" id="4754106">e</span>&nbsp;<span class="op" id="4754108">*</span><span class="ident" id="4754109">encodeState</span><span class="op" id="4754120">,</span>&nbsp;<span class="ident" id="4754122">v</span>&nbsp;<span class="ident" id="4754124">reflect</span><span class="op" id="4754131">.</span><span class="ident" id="4754132">Value</span><span class="op" id="4754137">,</span>&nbsp;<span class="ident" id="4754139">quoted</span>&nbsp;<span class="builtintype" id="4754146">bool</span><span class="op" id="4754150">)</span>&nbsp;<span class="op" id="4754152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4754155">if</span>&nbsp;<span class="ident" id="4754158">v</span><span class="op" id="4754159">.</span><span class="ident" id="4754160">IsNil</span><span class="op" id="4754165">(</span><span class="op" id="4754166">)</span>&nbsp;<span class="op" id="4754168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4754172">e</span><span class="op" id="4754173">.</span><span class="ident" id="4754174">WriteString</span><span class="op" id="4754185">(</span><span class="string" id="4754186">&#34;null&#34;</span><span class="op" id="4754192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4754196">return</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4754204">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4754207">pe</span><span class="op" id="4754209">.</span><span class="ident" id="4754210">elemEnc</span><span class="op" id="4754217">(</span><span class="ident" id="4754218">e</span><span class="op" id="4754219">,</span>&nbsp;<span class="ident" id="4754221">v</span><span class="op" id="4754222">.</span><span class="ident" id="4754223">Elem</span><span class="op" id="4754227">(</span><span class="op" id="4754228">)</span><span class="op" id="4754229">,</span>&nbsp;<span class="ident" id="4754231">quoted</span><span class="op" id="4754237">)</span><br>
<span class="lineno"></span><span class="op" id="4754239">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4754242">func</span>&nbsp;<span class="ident" id="4754247">newPtrEncoder</span><span class="op" id="4754260">(</span><span class="ident" id="4754261">t</span>&nbsp;<span class="ident" id="4754263">reflect</span><span class="op" id="4754270">.</span><span class="ident" id="4754271">Type</span><span class="op" id="4754275">)</span>&nbsp;<span class="ident" id="4754277">encoderFunc</span>&nbsp;<span class="op" id="4754289">{</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4754292">enc</span>&nbsp;<span class="op" id="4754296">:=</span>&nbsp;<span class="op" id="4754299">&amp;</span><span class="ident" id="4754300">ptrEncoder</span><span class="op" id="4754310">{</span><span class="ident" id="4754311">typeEncoder</span><span class="op" id="4754322">(</span><span class="ident" id="4754323">t</span><span class="op" id="4754324">.</span><span class="ident" id="4754325">Elem</span><span class="op" id="4754329">(</span><span class="op" id="4754330">)</span><span class="op" id="4754331">)</span><span class="op" id="4754332">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4754335">return</span>&nbsp;<span class="ident" id="4754342">enc</span><span class="op" id="4754345">.</span><span class="ident" id="4754346">encode</span><br>
<span class="lineno"></span><span class="op" id="4754353">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4754356">type</span>&nbsp;<span class="ident" id="4754361">condAddrEncoder</span>&nbsp;<span class="keyword" id="4754377">struct</span>&nbsp;<span class="op" id="4754384">{</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4754387">canAddrEnc</span><span class="op" id="4754397">,</span>&nbsp;<span class="ident" id="4754399">elseEnc</span>&nbsp;<span class="ident" id="4754407">encoderFunc</span><br>
<span class="lineno"></span><span class="op" id="4754419">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4754422">func</span>&nbsp;<span class="op" id="4754427">(</span><span class="ident" id="4754428">ce</span>&nbsp;<span class="op" id="4754431">*</span><span class="ident" id="4754432">condAddrEncoder</span><span class="op" id="4754447">)</span>&nbsp;<span class="ident" id="4754449">encode</span><span class="op" id="4754455">(</span><span class="ident" id="4754456">e</span>&nbsp;<span class="op" id="4754458">*</span><span class="ident" id="4754459">encodeState</span><span class="op" id="4754470">,</span>&nbsp;<span class="ident" id="4754472">v</span>&nbsp;<span class="ident" id="4754474">reflect</span><span class="op" id="4754481">.</span><span class="ident" id="4754482">Value</span><span class="op" id="4754487">,</span>&nbsp;<span class="ident" id="4754489">quoted</span>&nbsp;<span class="builtintype" id="4754496">bool</span><span class="op" id="4754500">)</span>&nbsp;<span class="op" id="4754502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4754505">if</span>&nbsp;<span class="ident" id="4754508">v</span><span class="op" id="4754509">.</span><span class="ident" id="4754510">CanAddr</span><span class="op" id="4754517">(</span><span class="op" id="4754518">)</span>&nbsp;<span class="op" id="4754520">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4754524">ce</span><span class="op" id="4754526">.</span><span class="ident" id="4754527">canAddrEnc</span><span class="op" id="4754537">(</span><span class="ident" id="4754538">e</span><span class="op" id="4754539">,</span>&nbsp;<span class="ident" id="4754541">v</span><span class="op" id="4754542">,</span>&nbsp;<span class="ident" id="4754544">quoted</span><span class="op" id="4754550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4754553">}</span>&nbsp;<span class="keyword" id="4754555">else</span>&nbsp;<span class="op" id="4754560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4754564">ce</span><span class="op" id="4754566">.</span><span class="ident" id="4754567">elseEnc</span><span class="op" id="4754574">(</span><span class="ident" id="4754575">e</span><span class="op" id="4754576">,</span>&nbsp;<span class="ident" id="4754578">v</span><span class="op" id="4754579">,</span>&nbsp;<span class="ident" id="4754581">quoted</span><span class="op" id="4754587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4754590">}</span><br>
<span class="lineno"></span><span class="op" id="4754592">}</span><br>
<span class="lineno">725</span><br>
<span class="lineno"></span><span class="comment" id="4754595">//&nbsp;newCondAddrEncoder&nbsp;returns&nbsp;an&nbsp;encoder&nbsp;that&nbsp;checks&nbsp;whether&nbsp;its&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="4754666">//&nbsp;CanAddr&nbsp;and&nbsp;delegates&nbsp;to&nbsp;canAddrEnc&nbsp;if&nbsp;so,&nbsp;else&nbsp;to&nbsp;elseEnc.</span><br>
<span class="lineno"></span><span class="keyword" id="4754729">func</span>&nbsp;<span class="ident" id="4754734">newCondAddrEncoder</span><span class="op" id="4754752">(</span><span class="ident" id="4754753">canAddrEnc</span><span class="op" id="4754763">,</span>&nbsp;<span class="ident" id="4754765">elseEnc</span>&nbsp;<span class="ident" id="4754773">encoderFunc</span><span class="op" id="4754784">)</span>&nbsp;<span class="ident" id="4754786">encoderFunc</span>&nbsp;<span class="op" id="4754798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4754801">enc</span>&nbsp;<span class="op" id="4754805">:=</span>&nbsp;<span class="op" id="4754808">&amp;</span><span class="ident" id="4754809">condAddrEncoder</span><span class="op" id="4754824">{</span><span class="ident" id="4754825">canAddrEnc</span><span class="op" id="4754835">:</span>&nbsp;<span class="ident" id="4754837">canAddrEnc</span><span class="op" id="4754847">,</span>&nbsp;<span class="ident" id="4754849">elseEnc</span><span class="op" id="4754856">:</span>&nbsp;<span class="ident" id="4754858">elseEnc</span><span class="op" id="4754865">}</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4754868">return</span>&nbsp;<span class="ident" id="4754875">enc</span><span class="op" id="4754878">.</span><span class="ident" id="4754879">encode</span><br>
<span class="lineno"></span><span class="op" id="4754886">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4754889">func</span>&nbsp;<span class="ident" id="4754894">isValidTag</span><span class="op" id="4754904">(</span><span class="ident" id="4754905">s</span>&nbsp;<span class="builtintype" id="4754907">string</span><span class="op" id="4754913">)</span>&nbsp;<span class="builtintype" id="4754915">bool</span>&nbsp;<span class="op" id="4754920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4754923">if</span>&nbsp;<span class="ident" id="4754926">s</span>&nbsp;<span class="op" id="4754928">==</span>&nbsp;<span class="string" id="4754931">&#34;&#34;</span>&nbsp;<span class="op" id="4754934">{</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4754938">return</span>&nbsp;<span class="ident" id="4754945">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4754952">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4754955">for</span>&nbsp;<span class="ident" id="4754959">_</span><span class="op" id="4754960">,</span>&nbsp;<span class="ident" id="4754962">c</span>&nbsp;<span class="op" id="4754964">:=</span>&nbsp;<span class="keyword" id="4754967">range</span>&nbsp;<span class="ident" id="4754973">s</span>&nbsp;<span class="op" id="4754975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4754979">switch</span>&nbsp;<span class="op" id="4754986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4754990">case</span>&nbsp;<span class="ident" id="4754995">strings</span><span class="op" id="4755002">.</span><span class="ident" id="4755003">ContainsRune</span><span class="op" id="4755015">(</span><span class="string" id="4755016">&#34;!#$%&amp;()*+-./:&lt;=&gt;?@[]^_{|}~&nbsp;&#34;</span><span class="op" id="4755045">,</span>&nbsp;<span class="ident" id="4755047">c</span><span class="op" id="4755048">)</span><span class="op" id="4755049">:</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4755054">//&nbsp;Backslash&nbsp;and&nbsp;quote&nbsp;chars&nbsp;are&nbsp;reserved,&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4755104">//&nbsp;otherwise&nbsp;any&nbsp;punctuation&nbsp;chars&nbsp;are&nbsp;allowed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4755154">//&nbsp;in&nbsp;a&nbsp;tag&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4755174">default</span><span class="op" id="4755181">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4755186">if</span>&nbsp;<span class="op" id="4755189">!</span><span class="ident" id="4755190">unicode</span><span class="op" id="4755197">.</span><span class="ident" id="4755198">IsLetter</span><span class="op" id="4755206">(</span><span class="ident" id="4755207">c</span><span class="op" id="4755208">)</span>&nbsp;<span class="op" id="4755210">&amp;&amp;</span>&nbsp;<span class="op" id="4755213">!</span><span class="ident" id="4755214">unicode</span><span class="op" id="4755221">.</span><span class="ident" id="4755222">IsDigit</span><span class="op" id="4755229">(</span><span class="ident" id="4755230">c</span><span class="op" id="4755231">)</span>&nbsp;<span class="op" id="4755233">{</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4755239">return</span>&nbsp;<span class="ident" id="4755246">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4755255">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4755259">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4755262">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4755265">return</span>&nbsp;<span class="ident" id="4755272">true</span><br>
<span class="lineno">750</span><span class="op" id="4755277">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4755280">func</span>&nbsp;<span class="ident" id="4755285">fieldByIndex</span><span class="op" id="4755297">(</span><span class="ident" id="4755298">v</span>&nbsp;<span class="ident" id="4755300">reflect</span><span class="op" id="4755307">.</span><span class="ident" id="4755308">Value</span><span class="op" id="4755313">,</span>&nbsp;<span class="ident" id="4755315">index</span>&nbsp;<span class="op" id="4755321">[</span><span class="op" id="4755322">]</span><span class="builtintype" id="4755323">int</span><span class="op" id="4755326">)</span>&nbsp;<span class="ident" id="4755328">reflect</span><span class="op" id="4755335">.</span><span class="ident" id="4755336">Value</span>&nbsp;<span class="op" id="4755342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4755345">for</span>&nbsp;<span class="ident" id="4755349">_</span><span class="op" id="4755350">,</span>&nbsp;<span class="ident" id="4755352">i</span>&nbsp;<span class="op" id="4755354">:=</span>&nbsp;<span class="keyword" id="4755357">range</span>&nbsp;<span class="ident" id="4755363">index</span>&nbsp;<span class="op" id="4755369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4755373">if</span>&nbsp;<span class="ident" id="4755376">v</span><span class="op" id="4755377">.</span><span class="ident" id="4755378">Kind</span><span class="op" id="4755382">(</span><span class="op" id="4755383">)</span>&nbsp;<span class="op" id="4755385">==</span>&nbsp;<span class="ident" id="4755388">reflect</span><span class="op" id="4755395">.</span><span class="ident" id="4755396">Ptr</span>&nbsp;<span class="op" id="4755400">{</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4755405">if</span>&nbsp;<span class="ident" id="4755408">v</span><span class="op" id="4755409">.</span><span class="ident" id="4755410">IsNil</span><span class="op" id="4755415">(</span><span class="op" id="4755416">)</span>&nbsp;<span class="op" id="4755418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4755424">return</span>&nbsp;<span class="ident" id="4755431">reflect</span><span class="op" id="4755438">.</span><span class="ident" id="4755439">Value</span><span class="op" id="4755444">{</span><span class="op" id="4755445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4755450">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4755455">v</span>&nbsp;<span class="op" id="4755457">=</span>&nbsp;<span class="ident" id="4755459">v</span><span class="op" id="4755460">.</span><span class="ident" id="4755461">Elem</span><span class="op" id="4755465">(</span><span class="op" id="4755466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4755470">}</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4755474">v</span>&nbsp;<span class="op" id="4755476">=</span>&nbsp;<span class="ident" id="4755478">v</span><span class="op" id="4755479">.</span><span class="ident" id="4755480">Field</span><span class="op" id="4755485">(</span><span class="ident" id="4755486">i</span><span class="op" id="4755487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4755490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4755493">return</span>&nbsp;<span class="ident" id="4755500">v</span><br>
<span class="lineno"></span><span class="op" id="4755502">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">765</span><span class="keyword" id="4755505">func</span>&nbsp;<span class="ident" id="4755510">typeByIndex</span><span class="op" id="4755521">(</span><span class="ident" id="4755522">t</span>&nbsp;<span class="ident" id="4755524">reflect</span><span class="op" id="4755531">.</span><span class="ident" id="4755532">Type</span><span class="op" id="4755536">,</span>&nbsp;<span class="ident" id="4755538">index</span>&nbsp;<span class="op" id="4755544">[</span><span class="op" id="4755545">]</span><span class="builtintype" id="4755546">int</span><span class="op" id="4755549">)</span>&nbsp;<span class="ident" id="4755551">reflect</span><span class="op" id="4755558">.</span><span class="ident" id="4755559">Type</span>&nbsp;<span class="op" id="4755564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4755567">for</span>&nbsp;<span class="ident" id="4755571">_</span><span class="op" id="4755572">,</span>&nbsp;<span class="ident" id="4755574">i</span>&nbsp;<span class="op" id="4755576">:=</span>&nbsp;<span class="keyword" id="4755579">range</span>&nbsp;<span class="ident" id="4755585">index</span>&nbsp;<span class="op" id="4755591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4755595">if</span>&nbsp;<span class="ident" id="4755598">t</span><span class="op" id="4755599">.</span><span class="ident" id="4755600">Kind</span><span class="op" id="4755604">(</span><span class="op" id="4755605">)</span>&nbsp;<span class="op" id="4755607">==</span>&nbsp;<span class="ident" id="4755610">reflect</span><span class="op" id="4755617">.</span><span class="ident" id="4755618">Ptr</span>&nbsp;<span class="op" id="4755622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4755627">t</span>&nbsp;<span class="op" id="4755629">=</span>&nbsp;<span class="ident" id="4755631">t</span><span class="op" id="4755632">.</span><span class="ident" id="4755633">Elem</span><span class="op" id="4755637">(</span><span class="op" id="4755638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4755642">}</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4755646">t</span>&nbsp;<span class="op" id="4755648">=</span>&nbsp;<span class="ident" id="4755650">t</span><span class="op" id="4755651">.</span><span class="ident" id="4755652">Field</span><span class="op" id="4755657">(</span><span class="ident" id="4755658">i</span><span class="op" id="4755659">)</span><span class="op" id="4755660">.</span><span class="ident" id="4755661">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4755667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4755670">return</span>&nbsp;<span class="ident" id="4755677">t</span><br>
<span class="lineno"></span><span class="op" id="4755679">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">775</span><span class="comment" id="4755682">//&nbsp;stringValues&nbsp;is&nbsp;a&nbsp;slice&nbsp;of&nbsp;reflect.Value&nbsp;holding&nbsp;*reflect.StringValue.</span><br>
<span class="lineno"></span><span class="comment" id="4755756">//&nbsp;It&nbsp;implements&nbsp;the&nbsp;methods&nbsp;to&nbsp;sort&nbsp;by&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="4755804">type</span>&nbsp;<span class="ident" id="4755809">stringValues</span>&nbsp;<span class="op" id="4755822">[</span><span class="op" id="4755823">]</span><span class="ident" id="4755824">reflect</span><span class="op" id="4755831">.</span><span class="ident" id="4755832">Value</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4755839">func</span>&nbsp;<span class="op" id="4755844">(</span><span class="ident" id="4755845">sv</span>&nbsp;<span class="ident" id="4755848">stringValues</span><span class="op" id="4755860">)</span>&nbsp;<span class="ident" id="4755862">Len</span><span class="op" id="4755865">(</span><span class="op" id="4755866">)</span>&nbsp;<span class="builtintype" id="4755868">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4755882">{</span>&nbsp;<span class="keyword" id="4755884">return</span>&nbsp;<span class="builtinfunc" id="4755891">len</span><span class="op" id="4755894">(</span><span class="ident" id="4755895">sv</span><span class="op" id="4755897">)</span>&nbsp;<span class="op" id="4755899">}</span><br>
<span class="lineno">780</span><span class="keyword" id="4755901">func</span>&nbsp;<span class="op" id="4755906">(</span><span class="ident" id="4755907">sv</span>&nbsp;<span class="ident" id="4755910">stringValues</span><span class="op" id="4755922">)</span>&nbsp;<span class="ident" id="4755924">Swap</span><span class="op" id="4755928">(</span><span class="ident" id="4755929">i</span><span class="op" id="4755930">,</span>&nbsp;<span class="ident" id="4755932">j</span>&nbsp;<span class="builtintype" id="4755934">int</span><span class="op" id="4755937">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4755944">{</span>&nbsp;<span class="ident" id="4755946">sv</span><span class="op" id="4755948">[</span><span class="ident" id="4755949">i</span><span class="op" id="4755950">]</span><span class="op" id="4755951">,</span>&nbsp;<span class="ident" id="4755953">sv</span><span class="op" id="4755955">[</span><span class="ident" id="4755956">j</span><span class="op" id="4755957">]</span>&nbsp;<span class="op" id="4755959">=</span>&nbsp;<span class="ident" id="4755961">sv</span><span class="op" id="4755963">[</span><span class="ident" id="4755964">j</span><span class="op" id="4755965">]</span><span class="op" id="4755966">,</span>&nbsp;<span class="ident" id="4755968">sv</span><span class="op" id="4755970">[</span><span class="ident" id="4755971">i</span><span class="op" id="4755972">]</span>&nbsp;<span class="op" id="4755974">}</span><br>
<span class="lineno"></span><span class="keyword" id="4755976">func</span>&nbsp;<span class="op" id="4755981">(</span><span class="ident" id="4755982">sv</span>&nbsp;<span class="ident" id="4755985">stringValues</span><span class="op" id="4755997">)</span>&nbsp;<span class="ident" id="4755999">Less</span><span class="op" id="4756003">(</span><span class="ident" id="4756004">i</span><span class="op" id="4756005">,</span>&nbsp;<span class="ident" id="4756007">j</span>&nbsp;<span class="builtintype" id="4756009">int</span><span class="op" id="4756012">)</span>&nbsp;<span class="builtintype" id="4756014">bool</span>&nbsp;<span class="op" id="4756019">{</span>&nbsp;<span class="keyword" id="4756021">return</span>&nbsp;<span class="ident" id="4756028">sv</span><span class="op" id="4756030">.</span><span class="ident" id="4756031">get</span><span class="op" id="4756034">(</span><span class="ident" id="4756035">i</span><span class="op" id="4756036">)</span>&nbsp;<span class="op" id="4756038">&lt;</span>&nbsp;<span class="ident" id="4756040">sv</span><span class="op" id="4756042">.</span><span class="ident" id="4756043">get</span><span class="op" id="4756046">(</span><span class="ident" id="4756047">j</span><span class="op" id="4756048">)</span>&nbsp;<span class="op" id="4756050">}</span><br>
<span class="lineno"></span><span class="keyword" id="4756052">func</span>&nbsp;<span class="op" id="4756057">(</span><span class="ident" id="4756058">sv</span>&nbsp;<span class="ident" id="4756061">stringValues</span><span class="op" id="4756073">)</span>&nbsp;<span class="ident" id="4756075">get</span><span class="op" id="4756078">(</span><span class="ident" id="4756079">i</span>&nbsp;<span class="builtintype" id="4756081">int</span><span class="op" id="4756084">)</span>&nbsp;<span class="builtintype" id="4756086">string</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4756095">{</span>&nbsp;<span class="keyword" id="4756097">return</span>&nbsp;<span class="ident" id="4756104">sv</span><span class="op" id="4756106">[</span><span class="ident" id="4756107">i</span><span class="op" id="4756108">]</span><span class="op" id="4756109">.</span><span class="ident" id="4756110">String</span><span class="op" id="4756116">(</span><span class="op" id="4756117">)</span>&nbsp;<span class="op" id="4756119">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4756122">//&nbsp;NOTE:&nbsp;keep&nbsp;in&nbsp;sync&nbsp;with&nbsp;stringBytes&nbsp;below.</span><br>
<span class="lineno">785</span><span class="keyword" id="4756168">func</span>&nbsp;<span class="op" id="4756173">(</span><span class="ident" id="4756174">e</span>&nbsp;<span class="op" id="4756176">*</span><span class="ident" id="4756177">encodeState</span><span class="op" id="4756188">)</span>&nbsp;<span class="builtintype" id="4756190">string</span><span class="op" id="4756196">(</span><span class="ident" id="4756197">s</span>&nbsp;<span class="builtintype" id="4756199">string</span><span class="op" id="4756205">)</span>&nbsp;<span class="op" id="4756207">(</span><span class="builtintype" id="4756208">int</span><span class="op" id="4756211">,</span>&nbsp;<span class="builtintype" id="4756213">error</span><span class="op" id="4756218">)</span>&nbsp;<span class="op" id="4756220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4756223">len0</span>&nbsp;<span class="op" id="4756228">:=</span>&nbsp;<span class="ident" id="4756231">e</span><span class="op" id="4756232">.</span><span class="ident" id="4756233">Len</span><span class="op" id="4756236">(</span><span class="op" id="4756237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4756240">e</span><span class="op" id="4756241">.</span><span class="ident" id="4756242">WriteByte</span><span class="op" id="4756251">(</span><span class="string" id="4756252">&#39;&#34;&#39;</span><span class="op" id="4756255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4756258">start</span>&nbsp;<span class="op" id="4756264">:=</span>&nbsp;<span class="num" id="4756267">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4756270">for</span>&nbsp;<span class="ident" id="4756274">i</span>&nbsp;<span class="op" id="4756276">:=</span>&nbsp;<span class="num" id="4756279">0</span><span class="op" id="4756280">;</span>&nbsp;<span class="ident" id="4756282">i</span>&nbsp;<span class="op" id="4756284">&lt;</span>&nbsp;<span class="builtinfunc" id="4756286">len</span><span class="op" id="4756289">(</span><span class="ident" id="4756290">s</span><span class="op" id="4756291">)</span><span class="op" id="4756292">;</span>&nbsp;<span class="op" id="4756294">{</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4756298">if</span>&nbsp;<span class="ident" id="4756301">b</span>&nbsp;<span class="op" id="4756303">:=</span>&nbsp;<span class="ident" id="4756306">s</span><span class="op" id="4756307">[</span><span class="ident" id="4756308">i</span><span class="op" id="4756309">]</span><span class="op" id="4756310">;</span>&nbsp;<span class="ident" id="4756312">b</span>&nbsp;<span class="op" id="4756314">&lt;</span>&nbsp;<span class="ident" id="4756316">utf8</span><span class="op" id="4756320">.</span><span class="ident" id="4756321">RuneSelf</span>&nbsp;<span class="op" id="4756330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4756335">if</span>&nbsp;<span class="num" id="4756338">0x20</span>&nbsp;<span class="op" id="4756343">&lt;=</span>&nbsp;<span class="ident" id="4756346">b</span>&nbsp;<span class="op" id="4756348">&amp;&amp;</span>&nbsp;<span class="ident" id="4756351">b</span>&nbsp;<span class="op" id="4756353">!=</span>&nbsp;<span class="string" id="4756356">&#39;\\&#39;</span>&nbsp;<span class="op" id="4756361">&amp;&amp;</span>&nbsp;<span class="ident" id="4756364">b</span>&nbsp;<span class="op" id="4756366">!=</span>&nbsp;<span class="string" id="4756369">&#39;&#34;&#39;</span>&nbsp;<span class="op" id="4756373">&amp;&amp;</span>&nbsp;<span class="ident" id="4756376">b</span>&nbsp;<span class="op" id="4756378">!=</span>&nbsp;<span class="string" id="4756381">&#39;&lt;&#39;</span>&nbsp;<span class="op" id="4756385">&amp;&amp;</span>&nbsp;<span class="ident" id="4756388">b</span>&nbsp;<span class="op" id="4756390">!=</span>&nbsp;<span class="string" id="4756393">&#39;&gt;&#39;</span>&nbsp;<span class="op" id="4756397">&amp;&amp;</span>&nbsp;<span class="ident" id="4756400">b</span>&nbsp;<span class="op" id="4756402">!=</span>&nbsp;<span class="string" id="4756405">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="4756409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4756415">i</span><span class="op" id="4756416">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4756423">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4756435">}</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4756440">if</span>&nbsp;<span class="ident" id="4756443">start</span>&nbsp;<span class="op" id="4756449">&lt;</span>&nbsp;<span class="ident" id="4756451">i</span>&nbsp;<span class="op" id="4756453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4756459">e</span><span class="op" id="4756460">.</span><span class="ident" id="4756461">WriteString</span><span class="op" id="4756472">(</span><span class="ident" id="4756473">s</span><span class="op" id="4756474">[</span><span class="ident" id="4756475">start</span><span class="op" id="4756480">:</span><span class="ident" id="4756481">i</span><span class="op" id="4756482">]</span><span class="op" id="4756483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4756488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4756493">switch</span>&nbsp;<span class="ident" id="4756500">b</span>&nbsp;<span class="op" id="4756502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4756507">case</span>&nbsp;<span class="string" id="4756512">&#39;\\&#39;</span><span class="op" id="4756516">,</span>&nbsp;<span class="string" id="4756518">&#39;&#34;&#39;</span><span class="op" id="4756521">:</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4756527">e</span><span class="op" id="4756528">.</span><span class="ident" id="4756529">WriteByte</span><span class="op" id="4756538">(</span><span class="string" id="4756539">&#39;\\&#39;</span><span class="op" id="4756543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4756549">e</span><span class="op" id="4756550">.</span><span class="ident" id="4756551">WriteByte</span><span class="op" id="4756560">(</span><span class="ident" id="4756561">b</span><span class="op" id="4756562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4756567">case</span>&nbsp;<span class="string" id="4756572">&#39;\n&#39;</span><span class="op" id="4756576">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4756582">e</span><span class="op" id="4756583">.</span><span class="ident" id="4756584">WriteByte</span><span class="op" id="4756593">(</span><span class="string" id="4756594">&#39;\\&#39;</span><span class="op" id="4756598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4756604">e</span><span class="op" id="4756605">.</span><span class="ident" id="4756606">WriteByte</span><span class="op" id="4756615">(</span><span class="string" id="4756616">&#39;n&#39;</span><span class="op" id="4756619">)</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4756624">case</span>&nbsp;<span class="string" id="4756629">&#39;\r&#39;</span><span class="op" id="4756633">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4756639">e</span><span class="op" id="4756640">.</span><span class="ident" id="4756641">WriteByte</span><span class="op" id="4756650">(</span><span class="string" id="4756651">&#39;\\&#39;</span><span class="op" id="4756655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4756661">e</span><span class="op" id="4756662">.</span><span class="ident" id="4756663">WriteByte</span><span class="op" id="4756672">(</span><span class="string" id="4756673">&#39;r&#39;</span><span class="op" id="4756676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4756681">case</span>&nbsp;<span class="string" id="4756686">&#39;\t&#39;</span><span class="op" id="4756690">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4756696">e</span><span class="op" id="4756697">.</span><span class="ident" id="4756698">WriteByte</span><span class="op" id="4756707">(</span><span class="string" id="4756708">&#39;\\&#39;</span><span class="op" id="4756712">)</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4756718">e</span><span class="op" id="4756719">.</span><span class="ident" id="4756720">WriteByte</span><span class="op" id="4756729">(</span><span class="string" id="4756730">&#39;t&#39;</span><span class="op" id="4756733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4756738">default</span><span class="op" id="4756745">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4756751">//&nbsp;This&nbsp;encodes&nbsp;bytes&nbsp;&lt;&nbsp;0x20&nbsp;except&nbsp;for&nbsp;\n&nbsp;and&nbsp;\r,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4756806">//&nbsp;as&nbsp;well&nbsp;as&nbsp;&lt;,&nbsp;&gt;&nbsp;and&nbsp;&amp;.&nbsp;The&nbsp;latter&nbsp;are&nbsp;escaped&nbsp;because&nbsp;they</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4756872">//&nbsp;can&nbsp;lead&nbsp;to&nbsp;security&nbsp;holes&nbsp;when&nbsp;user-controlled&nbsp;strings</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4756935">//&nbsp;are&nbsp;rendered&nbsp;into&nbsp;JSON&nbsp;and&nbsp;served&nbsp;to&nbsp;some&nbsp;browsers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4756994">e</span><span class="op" id="4756995">.</span><span class="ident" id="4756996">WriteString</span><span class="op" id="4757007">(</span><span class="string" id="4757008">`\u00`</span><span class="op" id="4757014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4757020">e</span><span class="op" id="4757021">.</span><span class="ident" id="4757022">WriteByte</span><span class="op" id="4757031">(</span><span class="ident" id="4757032">hex</span><span class="op" id="4757035">[</span><span class="ident" id="4757036">b</span><span class="op" id="4757037">&gt;&gt;</span><span class="num" id="4757039">4</span><span class="op" id="4757040">]</span><span class="op" id="4757041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4757047">e</span><span class="op" id="4757048">.</span><span class="ident" id="4757049">WriteByte</span><span class="op" id="4757058">(</span><span class="ident" id="4757059">hex</span><span class="op" id="4757062">[</span><span class="ident" id="4757063">b</span><span class="op" id="4757064">&amp;</span><span class="num" id="4757065">0xF</span><span class="op" id="4757068">]</span><span class="op" id="4757069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4757074">}</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4757079">i</span><span class="op" id="4757080">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4757086">start</span>&nbsp;<span class="op" id="4757092">=</span>&nbsp;<span class="ident" id="4757094">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4757099">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4757110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4757114">c</span><span class="op" id="4757115">,</span>&nbsp;<span class="ident" id="4757117">size</span>&nbsp;<span class="op" id="4757122">:=</span>&nbsp;<span class="ident" id="4757125">utf8</span><span class="op" id="4757129">.</span><span class="ident" id="4757130">DecodeRuneInString</span><span class="op" id="4757148">(</span><span class="ident" id="4757149">s</span><span class="op" id="4757150">[</span><span class="ident" id="4757151">i</span><span class="op" id="4757152">:</span><span class="op" id="4757153">]</span><span class="op" id="4757154">)</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4757158">if</span>&nbsp;<span class="ident" id="4757161">c</span>&nbsp;<span class="op" id="4757163">==</span>&nbsp;<span class="ident" id="4757166">utf8</span><span class="op" id="4757170">.</span><span class="ident" id="4757171">RuneError</span>&nbsp;<span class="op" id="4757181">&amp;&amp;</span>&nbsp;<span class="ident" id="4757184">size</span>&nbsp;<span class="op" id="4757189">==</span>&nbsp;<span class="num" id="4757192">1</span>&nbsp;<span class="op" id="4757194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4757199">if</span>&nbsp;<span class="ident" id="4757202">start</span>&nbsp;<span class="op" id="4757208">&lt;</span>&nbsp;<span class="ident" id="4757210">i</span>&nbsp;<span class="op" id="4757212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4757218">e</span><span class="op" id="4757219">.</span><span class="ident" id="4757220">WriteString</span><span class="op" id="4757231">(</span><span class="ident" id="4757232">s</span><span class="op" id="4757233">[</span><span class="ident" id="4757234">start</span><span class="op" id="4757239">:</span><span class="ident" id="4757240">i</span><span class="op" id="4757241">]</span><span class="op" id="4757242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4757247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4757252">e</span><span class="op" id="4757253">.</span><span class="ident" id="4757254">WriteString</span><span class="op" id="4757265">(</span><span class="string" id="4757266">`\ufffd`</span><span class="op" id="4757274">)</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4757279">i</span>&nbsp;<span class="op" id="4757281">+=</span>&nbsp;<span class="ident" id="4757284">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4757292">start</span>&nbsp;<span class="op" id="4757298">=</span>&nbsp;<span class="ident" id="4757300">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4757305">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4757316">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4757320">//&nbsp;U+2028&nbsp;is&nbsp;LINE&nbsp;SEPARATOR.</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4757351">//&nbsp;U+2029&nbsp;is&nbsp;PARAGRAPH&nbsp;SEPARATOR.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4757387">//&nbsp;They&nbsp;are&nbsp;both&nbsp;technically&nbsp;valid&nbsp;characters&nbsp;in&nbsp;JSON&nbsp;strings,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4757452">//&nbsp;but&nbsp;don&#39;t&nbsp;work&nbsp;in&nbsp;JSONP,&nbsp;which&nbsp;has&nbsp;to&nbsp;be&nbsp;evaluated&nbsp;as&nbsp;JavaScript,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4757523">//&nbsp;and&nbsp;can&nbsp;lead&nbsp;to&nbsp;security&nbsp;holes&nbsp;there.&nbsp;It&nbsp;is&nbsp;valid&nbsp;JSON&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4757586">//&nbsp;escape&nbsp;them,&nbsp;so&nbsp;we&nbsp;do&nbsp;so&nbsp;unconditionally.</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4757633">//&nbsp;See&nbsp;http://timelessrepo.com/json-isnt-a-javascript-subset&nbsp;for&nbsp;discussion.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4757712">if</span>&nbsp;<span class="ident" id="4757715">c</span>&nbsp;<span class="op" id="4757717">==</span>&nbsp;<span class="string" id="4757720">&#39;\u2028&#39;</span>&nbsp;<span class="op" id="4757729">||</span>&nbsp;<span class="ident" id="4757732">c</span>&nbsp;<span class="op" id="4757734">==</span>&nbsp;<span class="string" id="4757737">&#39;\u2029&#39;</span>&nbsp;<span class="op" id="4757746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4757751">if</span>&nbsp;<span class="ident" id="4757754">start</span>&nbsp;<span class="op" id="4757760">&lt;</span>&nbsp;<span class="ident" id="4757762">i</span>&nbsp;<span class="op" id="4757764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4757770">e</span><span class="op" id="4757771">.</span><span class="ident" id="4757772">WriteString</span><span class="op" id="4757783">(</span><span class="ident" id="4757784">s</span><span class="op" id="4757785">[</span><span class="ident" id="4757786">start</span><span class="op" id="4757791">:</span><span class="ident" id="4757792">i</span><span class="op" id="4757793">]</span><span class="op" id="4757794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4757799">}</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4757804">e</span><span class="op" id="4757805">.</span><span class="ident" id="4757806">WriteString</span><span class="op" id="4757817">(</span><span class="string" id="4757818">`\u202`</span><span class="op" id="4757825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4757830">e</span><span class="op" id="4757831">.</span><span class="ident" id="4757832">WriteByte</span><span class="op" id="4757841">(</span><span class="ident" id="4757842">hex</span><span class="op" id="4757845">[</span><span class="ident" id="4757846">c</span><span class="op" id="4757847">&amp;</span><span class="num" id="4757848">0xF</span><span class="op" id="4757851">]</span><span class="op" id="4757852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4757857">i</span>&nbsp;<span class="op" id="4757859">+=</span>&nbsp;<span class="ident" id="4757862">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4757870">start</span>&nbsp;<span class="op" id="4757876">=</span>&nbsp;<span class="ident" id="4757878">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4757883">continue</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4757894">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4757898">i</span>&nbsp;<span class="op" id="4757900">+=</span>&nbsp;<span class="ident" id="4757903">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4757909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4757912">if</span>&nbsp;<span class="ident" id="4757915">start</span>&nbsp;<span class="op" id="4757921">&lt;</span>&nbsp;<span class="builtinfunc" id="4757923">len</span><span class="op" id="4757926">(</span><span class="ident" id="4757927">s</span><span class="op" id="4757928">)</span>&nbsp;<span class="op" id="4757930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4757934">e</span><span class="op" id="4757935">.</span><span class="ident" id="4757936">WriteString</span><span class="op" id="4757947">(</span><span class="ident" id="4757948">s</span><span class="op" id="4757949">[</span><span class="ident" id="4757950">start</span><span class="op" id="4757955">:</span><span class="op" id="4757956">]</span><span class="op" id="4757957">)</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4757960">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4757963">e</span><span class="op" id="4757964">.</span><span class="ident" id="4757965">WriteByte</span><span class="op" id="4757974">(</span><span class="string" id="4757975">&#39;&#34;&#39;</span><span class="op" id="4757978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4757981">return</span>&nbsp;<span class="ident" id="4757988">e</span><span class="op" id="4757989">.</span><span class="ident" id="4757990">Len</span><span class="op" id="4757993">(</span><span class="op" id="4757994">)</span>&nbsp;<span class="op" id="4757996">-</span>&nbsp;<span class="ident" id="4757998">len0</span><span class="op" id="4758002">,</span>&nbsp;<span class="ident" id="4758004">nil</span><br>
<span class="lineno"></span><span class="op" id="4758008">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">860</span><span class="comment" id="4758011">//&nbsp;NOTE:&nbsp;keep&nbsp;in&nbsp;sync&nbsp;with&nbsp;string&nbsp;above.</span><br>
<span class="lineno"></span><span class="keyword" id="4758052">func</span>&nbsp;<span class="op" id="4758057">(</span><span class="ident" id="4758058">e</span>&nbsp;<span class="op" id="4758060">*</span><span class="ident" id="4758061">encodeState</span><span class="op" id="4758072">)</span>&nbsp;<span class="ident" id="4758074">stringBytes</span><span class="op" id="4758085">(</span><span class="ident" id="4758086">s</span>&nbsp;<span class="op" id="4758088">[</span><span class="op" id="4758089">]</span><span class="builtintype" id="4758090">byte</span><span class="op" id="4758094">)</span>&nbsp;<span class="op" id="4758096">(</span><span class="builtintype" id="4758097">int</span><span class="op" id="4758100">,</span>&nbsp;<span class="builtintype" id="4758102">error</span><span class="op" id="4758107">)</span>&nbsp;<span class="op" id="4758109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4758112">len0</span>&nbsp;<span class="op" id="4758117">:=</span>&nbsp;<span class="ident" id="4758120">e</span><span class="op" id="4758121">.</span><span class="ident" id="4758122">Len</span><span class="op" id="4758125">(</span><span class="op" id="4758126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4758129">e</span><span class="op" id="4758130">.</span><span class="ident" id="4758131">WriteByte</span><span class="op" id="4758140">(</span><span class="string" id="4758141">&#39;&#34;&#39;</span><span class="op" id="4758144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4758147">start</span>&nbsp;<span class="op" id="4758153">:=</span>&nbsp;<span class="num" id="4758156">0</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4758159">for</span>&nbsp;<span class="ident" id="4758163">i</span>&nbsp;<span class="op" id="4758165">:=</span>&nbsp;<span class="num" id="4758168">0</span><span class="op" id="4758169">;</span>&nbsp;<span class="ident" id="4758171">i</span>&nbsp;<span class="op" id="4758173">&lt;</span>&nbsp;<span class="builtinfunc" id="4758175">len</span><span class="op" id="4758178">(</span><span class="ident" id="4758179">s</span><span class="op" id="4758180">)</span><span class="op" id="4758181">;</span>&nbsp;<span class="op" id="4758183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4758187">if</span>&nbsp;<span class="ident" id="4758190">b</span>&nbsp;<span class="op" id="4758192">:=</span>&nbsp;<span class="ident" id="4758195">s</span><span class="op" id="4758196">[</span><span class="ident" id="4758197">i</span><span class="op" id="4758198">]</span><span class="op" id="4758199">;</span>&nbsp;<span class="ident" id="4758201">b</span>&nbsp;<span class="op" id="4758203">&lt;</span>&nbsp;<span class="ident" id="4758205">utf8</span><span class="op" id="4758209">.</span><span class="ident" id="4758210">RuneSelf</span>&nbsp;<span class="op" id="4758219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4758224">if</span>&nbsp;<span class="num" id="4758227">0x20</span>&nbsp;<span class="op" id="4758232">&lt;=</span>&nbsp;<span class="ident" id="4758235">b</span>&nbsp;<span class="op" id="4758237">&amp;&amp;</span>&nbsp;<span class="ident" id="4758240">b</span>&nbsp;<span class="op" id="4758242">!=</span>&nbsp;<span class="string" id="4758245">&#39;\\&#39;</span>&nbsp;<span class="op" id="4758250">&amp;&amp;</span>&nbsp;<span class="ident" id="4758253">b</span>&nbsp;<span class="op" id="4758255">!=</span>&nbsp;<span class="string" id="4758258">&#39;&#34;&#39;</span>&nbsp;<span class="op" id="4758262">&amp;&amp;</span>&nbsp;<span class="ident" id="4758265">b</span>&nbsp;<span class="op" id="4758267">!=</span>&nbsp;<span class="string" id="4758270">&#39;&lt;&#39;</span>&nbsp;<span class="op" id="4758274">&amp;&amp;</span>&nbsp;<span class="ident" id="4758277">b</span>&nbsp;<span class="op" id="4758279">!=</span>&nbsp;<span class="string" id="4758282">&#39;&gt;&#39;</span>&nbsp;<span class="op" id="4758286">&amp;&amp;</span>&nbsp;<span class="ident" id="4758289">b</span>&nbsp;<span class="op" id="4758291">!=</span>&nbsp;<span class="string" id="4758294">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="4758298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4758304">i</span><span class="op" id="4758305">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4758312">continue</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4758324">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4758329">if</span>&nbsp;<span class="ident" id="4758332">start</span>&nbsp;<span class="op" id="4758338">&lt;</span>&nbsp;<span class="ident" id="4758340">i</span>&nbsp;<span class="op" id="4758342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4758348">e</span><span class="op" id="4758349">.</span><span class="ident" id="4758350">Write</span><span class="op" id="4758355">(</span><span class="ident" id="4758356">s</span><span class="op" id="4758357">[</span><span class="ident" id="4758358">start</span><span class="op" id="4758363">:</span><span class="ident" id="4758364">i</span><span class="op" id="4758365">]</span><span class="op" id="4758366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4758371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4758376">switch</span>&nbsp;<span class="ident" id="4758383">b</span>&nbsp;<span class="op" id="4758385">{</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4758390">case</span>&nbsp;<span class="string" id="4758395">&#39;\\&#39;</span><span class="op" id="4758399">,</span>&nbsp;<span class="string" id="4758401">&#39;&#34;&#39;</span><span class="op" id="4758404">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4758410">e</span><span class="op" id="4758411">.</span><span class="ident" id="4758412">WriteByte</span><span class="op" id="4758421">(</span><span class="string" id="4758422">&#39;\\&#39;</span><span class="op" id="4758426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4758432">e</span><span class="op" id="4758433">.</span><span class="ident" id="4758434">WriteByte</span><span class="op" id="4758443">(</span><span class="ident" id="4758444">b</span><span class="op" id="4758445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4758450">case</span>&nbsp;<span class="string" id="4758455">&#39;\n&#39;</span><span class="op" id="4758459">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4758465">e</span><span class="op" id="4758466">.</span><span class="ident" id="4758467">WriteByte</span><span class="op" id="4758476">(</span><span class="string" id="4758477">&#39;\\&#39;</span><span class="op" id="4758481">)</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4758487">e</span><span class="op" id="4758488">.</span><span class="ident" id="4758489">WriteByte</span><span class="op" id="4758498">(</span><span class="string" id="4758499">&#39;n&#39;</span><span class="op" id="4758502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4758507">case</span>&nbsp;<span class="string" id="4758512">&#39;\r&#39;</span><span class="op" id="4758516">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4758522">e</span><span class="op" id="4758523">.</span><span class="ident" id="4758524">WriteByte</span><span class="op" id="4758533">(</span><span class="string" id="4758534">&#39;\\&#39;</span><span class="op" id="4758538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4758544">e</span><span class="op" id="4758545">.</span><span class="ident" id="4758546">WriteByte</span><span class="op" id="4758555">(</span><span class="string" id="4758556">&#39;r&#39;</span><span class="op" id="4758559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4758564">case</span>&nbsp;<span class="string" id="4758569">&#39;\t&#39;</span><span class="op" id="4758573">:</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4758579">e</span><span class="op" id="4758580">.</span><span class="ident" id="4758581">WriteByte</span><span class="op" id="4758590">(</span><span class="string" id="4758591">&#39;\\&#39;</span><span class="op" id="4758595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4758601">e</span><span class="op" id="4758602">.</span><span class="ident" id="4758603">WriteByte</span><span class="op" id="4758612">(</span><span class="string" id="4758613">&#39;t&#39;</span><span class="op" id="4758616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4758621">default</span><span class="op" id="4758628">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4758634">//&nbsp;This&nbsp;encodes&nbsp;bytes&nbsp;&lt;&nbsp;0x20&nbsp;except&nbsp;for&nbsp;\n&nbsp;and&nbsp;\r,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4758689">//&nbsp;as&nbsp;well&nbsp;as&nbsp;&lt;,&nbsp;&gt;,&nbsp;and&nbsp;&amp;.&nbsp;The&nbsp;latter&nbsp;are&nbsp;escaped&nbsp;because&nbsp;they</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4758756">//&nbsp;can&nbsp;lead&nbsp;to&nbsp;security&nbsp;holes&nbsp;when&nbsp;user-controlled&nbsp;strings</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4758819">//&nbsp;are&nbsp;rendered&nbsp;into&nbsp;JSON&nbsp;and&nbsp;served&nbsp;to&nbsp;some&nbsp;browsers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4758878">e</span><span class="op" id="4758879">.</span><span class="ident" id="4758880">WriteString</span><span class="op" id="4758891">(</span><span class="string" id="4758892">`\u00`</span><span class="op" id="4758898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4758904">e</span><span class="op" id="4758905">.</span><span class="ident" id="4758906">WriteByte</span><span class="op" id="4758915">(</span><span class="ident" id="4758916">hex</span><span class="op" id="4758919">[</span><span class="ident" id="4758920">b</span><span class="op" id="4758921">&gt;&gt;</span><span class="num" id="4758923">4</span><span class="op" id="4758924">]</span><span class="op" id="4758925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4758931">e</span><span class="op" id="4758932">.</span><span class="ident" id="4758933">WriteByte</span><span class="op" id="4758942">(</span><span class="ident" id="4758943">hex</span><span class="op" id="4758946">[</span><span class="ident" id="4758947">b</span><span class="op" id="4758948">&amp;</span><span class="num" id="4758949">0xF</span><span class="op" id="4758952">]</span><span class="op" id="4758953">)</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4758958">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4758963">i</span><span class="op" id="4758964">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4758970">start</span>&nbsp;<span class="op" id="4758976">=</span>&nbsp;<span class="ident" id="4758978">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4758983">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4758994">}</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4758998">c</span><span class="op" id="4758999">,</span>&nbsp;<span class="ident" id="4759001">size</span>&nbsp;<span class="op" id="4759006">:=</span>&nbsp;<span class="ident" id="4759009">utf8</span><span class="op" id="4759013">.</span><span class="ident" id="4759014">DecodeRune</span><span class="op" id="4759024">(</span><span class="ident" id="4759025">s</span><span class="op" id="4759026">[</span><span class="ident" id="4759027">i</span><span class="op" id="4759028">:</span><span class="op" id="4759029">]</span><span class="op" id="4759030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4759034">if</span>&nbsp;<span class="ident" id="4759037">c</span>&nbsp;<span class="op" id="4759039">==</span>&nbsp;<span class="ident" id="4759042">utf8</span><span class="op" id="4759046">.</span><span class="ident" id="4759047">RuneError</span>&nbsp;<span class="op" id="4759057">&amp;&amp;</span>&nbsp;<span class="ident" id="4759060">size</span>&nbsp;<span class="op" id="4759065">==</span>&nbsp;<span class="num" id="4759068">1</span>&nbsp;<span class="op" id="4759070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4759075">if</span>&nbsp;<span class="ident" id="4759078">start</span>&nbsp;<span class="op" id="4759084">&lt;</span>&nbsp;<span class="ident" id="4759086">i</span>&nbsp;<span class="op" id="4759088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4759094">e</span><span class="op" id="4759095">.</span><span class="ident" id="4759096">Write</span><span class="op" id="4759101">(</span><span class="ident" id="4759102">s</span><span class="op" id="4759103">[</span><span class="ident" id="4759104">start</span><span class="op" id="4759109">:</span><span class="ident" id="4759110">i</span><span class="op" id="4759111">]</span><span class="op" id="4759112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4759117">}</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4759122">e</span><span class="op" id="4759123">.</span><span class="ident" id="4759124">WriteString</span><span class="op" id="4759135">(</span><span class="string" id="4759136">`\ufffd`</span><span class="op" id="4759144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4759149">i</span>&nbsp;<span class="op" id="4759151">+=</span>&nbsp;<span class="ident" id="4759154">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4759162">start</span>&nbsp;<span class="op" id="4759168">=</span>&nbsp;<span class="ident" id="4759170">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4759175">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4759186">}</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4759190">//&nbsp;U+2028&nbsp;is&nbsp;LINE&nbsp;SEPARATOR.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4759221">//&nbsp;U+2029&nbsp;is&nbsp;PARAGRAPH&nbsp;SEPARATOR.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4759257">//&nbsp;They&nbsp;are&nbsp;both&nbsp;technically&nbsp;valid&nbsp;characters&nbsp;in&nbsp;JSON&nbsp;strings,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4759322">//&nbsp;but&nbsp;don&#39;t&nbsp;work&nbsp;in&nbsp;JSONP,&nbsp;which&nbsp;has&nbsp;to&nbsp;be&nbsp;evaluated&nbsp;as&nbsp;JavaScript,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4759393">//&nbsp;and&nbsp;can&nbsp;lead&nbsp;to&nbsp;security&nbsp;holes&nbsp;there.&nbsp;It&nbsp;is&nbsp;valid&nbsp;JSON&nbsp;to</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4759456">//&nbsp;escape&nbsp;them,&nbsp;so&nbsp;we&nbsp;do&nbsp;so&nbsp;unconditionally.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4759503">//&nbsp;See&nbsp;http://timelessrepo.com/json-isnt-a-javascript-subset&nbsp;for&nbsp;discussion.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4759582">if</span>&nbsp;<span class="ident" id="4759585">c</span>&nbsp;<span class="op" id="4759587">==</span>&nbsp;<span class="string" id="4759590">&#39;\u2028&#39;</span>&nbsp;<span class="op" id="4759599">||</span>&nbsp;<span class="ident" id="4759602">c</span>&nbsp;<span class="op" id="4759604">==</span>&nbsp;<span class="string" id="4759607">&#39;\u2029&#39;</span>&nbsp;<span class="op" id="4759616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4759621">if</span>&nbsp;<span class="ident" id="4759624">start</span>&nbsp;<span class="op" id="4759630">&lt;</span>&nbsp;<span class="ident" id="4759632">i</span>&nbsp;<span class="op" id="4759634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4759640">e</span><span class="op" id="4759641">.</span><span class="ident" id="4759642">Write</span><span class="op" id="4759647">(</span><span class="ident" id="4759648">s</span><span class="op" id="4759649">[</span><span class="ident" id="4759650">start</span><span class="op" id="4759655">:</span><span class="ident" id="4759656">i</span><span class="op" id="4759657">]</span><span class="op" id="4759658">)</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4759663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4759668">e</span><span class="op" id="4759669">.</span><span class="ident" id="4759670">WriteString</span><span class="op" id="4759681">(</span><span class="string" id="4759682">`\u202`</span><span class="op" id="4759689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4759694">e</span><span class="op" id="4759695">.</span><span class="ident" id="4759696">WriteByte</span><span class="op" id="4759705">(</span><span class="ident" id="4759706">hex</span><span class="op" id="4759709">[</span><span class="ident" id="4759710">c</span><span class="op" id="4759711">&amp;</span><span class="num" id="4759712">0xF</span><span class="op" id="4759715">]</span><span class="op" id="4759716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4759721">i</span>&nbsp;<span class="op" id="4759723">+=</span>&nbsp;<span class="ident" id="4759726">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4759734">start</span>&nbsp;<span class="op" id="4759740">=</span>&nbsp;<span class="ident" id="4759742">i</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4759747">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4759758">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4759762">i</span>&nbsp;<span class="op" id="4759764">+=</span>&nbsp;<span class="ident" id="4759767">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4759773">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4759776">if</span>&nbsp;<span class="ident" id="4759779">start</span>&nbsp;<span class="op" id="4759785">&lt;</span>&nbsp;<span class="builtinfunc" id="4759787">len</span><span class="op" id="4759790">(</span><span class="ident" id="4759791">s</span><span class="op" id="4759792">)</span>&nbsp;<span class="op" id="4759794">{</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4759798">e</span><span class="op" id="4759799">.</span><span class="ident" id="4759800">Write</span><span class="op" id="4759805">(</span><span class="ident" id="4759806">s</span><span class="op" id="4759807">[</span><span class="ident" id="4759808">start</span><span class="op" id="4759813">:</span><span class="op" id="4759814">]</span><span class="op" id="4759815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4759818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4759821">e</span><span class="op" id="4759822">.</span><span class="ident" id="4759823">WriteByte</span><span class="op" id="4759832">(</span><span class="string" id="4759833">&#39;&#34;&#39;</span><span class="op" id="4759836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4759839">return</span>&nbsp;<span class="ident" id="4759846">e</span><span class="op" id="4759847">.</span><span class="ident" id="4759848">Len</span><span class="op" id="4759851">(</span><span class="op" id="4759852">)</span>&nbsp;<span class="op" id="4759854">-</span>&nbsp;<span class="ident" id="4759856">len0</span><span class="op" id="4759860">,</span>&nbsp;<span class="ident" id="4759862">nil</span><br>
<span class="lineno"></span><span class="op" id="4759866">}</span><br>
<span class="lineno">935</span><br>
<span class="lineno"></span><span class="comment" id="4759869">//&nbsp;A&nbsp;field&nbsp;represents&nbsp;a&nbsp;single&nbsp;field&nbsp;found&nbsp;in&nbsp;a&nbsp;struct.</span><br>
<span class="lineno"></span><span class="keyword" id="4759925">type</span>&nbsp;<span class="ident" id="4759930">field</span>&nbsp;<span class="keyword" id="4759936">struct</span>&nbsp;<span class="op" id="4759943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4759946">name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4759956">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4759964">nameBytes</span>&nbsp;<span class="op" id="4759974">[</span><span class="op" id="4759975">]</span><span class="builtintype" id="4759976">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4759997">//&nbsp;[]byte(name)</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4760014">equalFold</span>&nbsp;<span class="keyword" id="4760024">func</span><span class="op" id="4760028">(</span><span class="ident" id="4760029">s</span><span class="op" id="4760030">,</span>&nbsp;<span class="ident" id="4760032">t</span>&nbsp;<span class="op" id="4760034">[</span><span class="op" id="4760035">]</span><span class="builtintype" id="4760036">byte</span><span class="op" id="4760040">)</span>&nbsp;<span class="builtintype" id="4760042">bool</span>&nbsp;<span class="comment" id="4760047">//&nbsp;bytes.EqualFold&nbsp;or&nbsp;equivalent</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4760082">tag</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4760092">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4760098">index</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4760108">[</span><span class="op" id="4760109">]</span><span class="builtintype" id="4760110">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4760115">typ</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4760125">reflect</span><span class="op" id="4760132">.</span><span class="ident" id="4760133">Type</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4760139">omitEmpty</span>&nbsp;<span class="builtintype" id="4760149">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4760155">quoted</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4760165">bool</span><br>
<span class="lineno"></span><span class="op" id="4760170">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4760173">func</span>&nbsp;<span class="ident" id="4760178">fillField</span><span class="op" id="4760187">(</span><span class="ident" id="4760188">f</span>&nbsp;<span class="ident" id="4760190">field</span><span class="op" id="4760195">)</span>&nbsp;<span class="ident" id="4760197">field</span>&nbsp;<span class="op" id="4760203">{</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4760206">f</span><span class="op" id="4760207">.</span><span class="ident" id="4760208">nameBytes</span>&nbsp;<span class="op" id="4760218">=</span>&nbsp;<span class="op" id="4760220">[</span><span class="op" id="4760221">]</span><span class="builtintype" id="4760222">byte</span><span class="op" id="4760226">(</span><span class="ident" id="4760227">f</span><span class="op" id="4760228">.</span><span class="ident" id="4760229">name</span><span class="op" id="4760233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4760236">f</span><span class="op" id="4760237">.</span><span class="ident" id="4760238">equalFold</span>&nbsp;<span class="op" id="4760248">=</span>&nbsp;<span class="ident" id="4760250">foldFunc</span><span class="op" id="4760258">(</span><span class="ident" id="4760259">f</span><span class="op" id="4760260">.</span><span class="ident" id="4760261">nameBytes</span><span class="op" id="4760270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4760273">return</span>&nbsp;<span class="ident" id="4760280">f</span><br>
<span class="lineno"></span><span class="op" id="4760282">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">955</span><span class="comment" id="4760285">//&nbsp;byName&nbsp;sorts&nbsp;field&nbsp;by&nbsp;name,&nbsp;breaking&nbsp;ties&nbsp;with&nbsp;depth,</span><br>
<span class="lineno"></span><span class="comment" id="4760342">//&nbsp;then&nbsp;breaking&nbsp;ties&nbsp;with&nbsp;&#34;name&nbsp;came&nbsp;from&nbsp;json&nbsp;tag&#34;,&nbsp;then</span><br>
<span class="lineno"></span><span class="comment" id="4760401">//&nbsp;breaking&nbsp;ties&nbsp;with&nbsp;index&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="keyword" id="4760439">type</span>&nbsp;<span class="ident" id="4760444">byName</span>&nbsp;<span class="op" id="4760451">[</span><span class="op" id="4760452">]</span><span class="ident" id="4760453">field</span><br>
<span class="lineno"></span><br>
<span class="lineno">960</span><span class="keyword" id="4760460">func</span>&nbsp;<span class="op" id="4760465">(</span><span class="ident" id="4760466">x</span>&nbsp;<span class="ident" id="4760468">byName</span><span class="op" id="4760474">)</span>&nbsp;<span class="ident" id="4760476">Len</span><span class="op" id="4760479">(</span><span class="op" id="4760480">)</span>&nbsp;<span class="builtintype" id="4760482">int</span>&nbsp;<span class="op" id="4760486">{</span>&nbsp;<span class="keyword" id="4760488">return</span>&nbsp;<span class="builtinfunc" id="4760495">len</span><span class="op" id="4760498">(</span><span class="ident" id="4760499">x</span><span class="op" id="4760500">)</span>&nbsp;<span class="op" id="4760502">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4760505">func</span>&nbsp;<span class="op" id="4760510">(</span><span class="ident" id="4760511">x</span>&nbsp;<span class="ident" id="4760513">byName</span><span class="op" id="4760519">)</span>&nbsp;<span class="ident" id="4760521">Swap</span><span class="op" id="4760525">(</span><span class="ident" id="4760526">i</span><span class="op" id="4760527">,</span>&nbsp;<span class="ident" id="4760529">j</span>&nbsp;<span class="builtintype" id="4760531">int</span><span class="op" id="4760534">)</span>&nbsp;<span class="op" id="4760536">{</span>&nbsp;<span class="ident" id="4760538">x</span><span class="op" id="4760539">[</span><span class="ident" id="4760540">i</span><span class="op" id="4760541">]</span><span class="op" id="4760542">,</span>&nbsp;<span class="ident" id="4760544">x</span><span class="op" id="4760545">[</span><span class="ident" id="4760546">j</span><span class="op" id="4760547">]</span>&nbsp;<span class="op" id="4760549">=</span>&nbsp;<span class="ident" id="4760551">x</span><span class="op" id="4760552">[</span><span class="ident" id="4760553">j</span><span class="op" id="4760554">]</span><span class="op" id="4760555">,</span>&nbsp;<span class="ident" id="4760557">x</span><span class="op" id="4760558">[</span><span class="ident" id="4760559">i</span><span class="op" id="4760560">]</span>&nbsp;<span class="op" id="4760562">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4760565">func</span>&nbsp;<span class="op" id="4760570">(</span><span class="ident" id="4760571">x</span>&nbsp;<span class="ident" id="4760573">byName</span><span class="op" id="4760579">)</span>&nbsp;<span class="ident" id="4760581">Less</span><span class="op" id="4760585">(</span><span class="ident" id="4760586">i</span><span class="op" id="4760587">,</span>&nbsp;<span class="ident" id="4760589">j</span>&nbsp;<span class="builtintype" id="4760591">int</span><span class="op" id="4760594">)</span>&nbsp;<span class="builtintype" id="4760596">bool</span>&nbsp;<span class="op" id="4760601">{</span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4760604">if</span>&nbsp;<span class="ident" id="4760607">x</span><span class="op" id="4760608">[</span><span class="ident" id="4760609">i</span><span class="op" id="4760610">]</span><span class="op" id="4760611">.</span><span class="ident" id="4760612">name</span>&nbsp;<span class="op" id="4760617">!=</span>&nbsp;<span class="ident" id="4760620">x</span><span class="op" id="4760621">[</span><span class="ident" id="4760622">j</span><span class="op" id="4760623">]</span><span class="op" id="4760624">.</span><span class="ident" id="4760625">name</span>&nbsp;<span class="op" id="4760630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4760634">return</span>&nbsp;<span class="ident" id="4760641">x</span><span class="op" id="4760642">[</span><span class="ident" id="4760643">i</span><span class="op" id="4760644">]</span><span class="op" id="4760645">.</span><span class="ident" id="4760646">name</span>&nbsp;<span class="op" id="4760651">&lt;</span>&nbsp;<span class="ident" id="4760653">x</span><span class="op" id="4760654">[</span><span class="ident" id="4760655">j</span><span class="op" id="4760656">]</span><span class="op" id="4760657">.</span><span class="ident" id="4760658">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4760664">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4760667">if</span>&nbsp;<span class="builtinfunc" id="4760670">len</span><span class="op" id="4760673">(</span><span class="ident" id="4760674">x</span><span class="op" id="4760675">[</span><span class="ident" id="4760676">i</span><span class="op" id="4760677">]</span><span class="op" id="4760678">.</span><span class="ident" id="4760679">index</span><span class="op" id="4760684">)</span>&nbsp;<span class="op" id="4760686">!=</span>&nbsp;<span class="builtinfunc" id="4760689">len</span><span class="op" id="4760692">(</span><span class="ident" id="4760693">x</span><span class="op" id="4760694">[</span><span class="ident" id="4760695">j</span><span class="op" id="4760696">]</span><span class="op" id="4760697">.</span><span class="ident" id="4760698">index</span><span class="op" id="4760703">)</span>&nbsp;<span class="op" id="4760705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4760709">return</span>&nbsp;<span class="builtinfunc" id="4760716">len</span><span class="op" id="4760719">(</span><span class="ident" id="4760720">x</span><span class="op" id="4760721">[</span><span class="ident" id="4760722">i</span><span class="op" id="4760723">]</span><span class="op" id="4760724">.</span><span class="ident" id="4760725">index</span><span class="op" id="4760730">)</span>&nbsp;<span class="op" id="4760732">&lt;</span>&nbsp;<span class="builtinfunc" id="4760734">len</span><span class="op" id="4760737">(</span><span class="ident" id="4760738">x</span><span class="op" id="4760739">[</span><span class="ident" id="4760740">j</span><span class="op" id="4760741">]</span><span class="op" id="4760742">.</span><span class="ident" id="4760743">index</span><span class="op" id="4760748">)</span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4760751">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4760754">if</span>&nbsp;<span class="ident" id="4760757">x</span><span class="op" id="4760758">[</span><span class="ident" id="4760759">i</span><span class="op" id="4760760">]</span><span class="op" id="4760761">.</span><span class="ident" id="4760762">tag</span>&nbsp;<span class="op" id="4760766">!=</span>&nbsp;<span class="ident" id="4760769">x</span><span class="op" id="4760770">[</span><span class="ident" id="4760771">j</span><span class="op" id="4760772">]</span><span class="op" id="4760773">.</span><span class="ident" id="4760774">tag</span>&nbsp;<span class="op" id="4760778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4760782">return</span>&nbsp;<span class="ident" id="4760789">x</span><span class="op" id="4760790">[</span><span class="ident" id="4760791">i</span><span class="op" id="4760792">]</span><span class="op" id="4760793">.</span><span class="ident" id="4760794">tag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4760799">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4760802">return</span>&nbsp;<span class="ident" id="4760809">byIndex</span><span class="op" id="4760816">(</span><span class="ident" id="4760817">x</span><span class="op" id="4760818">)</span><span class="op" id="4760819">.</span><span class="ident" id="4760820">Less</span><span class="op" id="4760824">(</span><span class="ident" id="4760825">i</span><span class="op" id="4760826">,</span>&nbsp;<span class="ident" id="4760828">j</span><span class="op" id="4760829">)</span><br>
<span class="lineno">975</span><span class="op" id="4760831">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4760834">//&nbsp;byIndex&nbsp;sorts&nbsp;field&nbsp;by&nbsp;index&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="keyword" id="4760876">type</span>&nbsp;<span class="ident" id="4760881">byIndex</span>&nbsp;<span class="op" id="4760889">[</span><span class="op" id="4760890">]</span><span class="ident" id="4760891">field</span><br>
<span class="lineno"></span><br>
<span class="lineno">980</span><span class="keyword" id="4760898">func</span>&nbsp;<span class="op" id="4760903">(</span><span class="ident" id="4760904">x</span>&nbsp;<span class="ident" id="4760906">byIndex</span><span class="op" id="4760913">)</span>&nbsp;<span class="ident" id="4760915">Len</span><span class="op" id="4760918">(</span><span class="op" id="4760919">)</span>&nbsp;<span class="builtintype" id="4760921">int</span>&nbsp;<span class="op" id="4760925">{</span>&nbsp;<span class="keyword" id="4760927">return</span>&nbsp;<span class="builtinfunc" id="4760934">len</span><span class="op" id="4760937">(</span><span class="ident" id="4760938">x</span><span class="op" id="4760939">)</span>&nbsp;<span class="op" id="4760941">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4760944">func</span>&nbsp;<span class="op" id="4760949">(</span><span class="ident" id="4760950">x</span>&nbsp;<span class="ident" id="4760952">byIndex</span><span class="op" id="4760959">)</span>&nbsp;<span class="ident" id="4760961">Swap</span><span class="op" id="4760965">(</span><span class="ident" id="4760966">i</span><span class="op" id="4760967">,</span>&nbsp;<span class="ident" id="4760969">j</span>&nbsp;<span class="builtintype" id="4760971">int</span><span class="op" id="4760974">)</span>&nbsp;<span class="op" id="4760976">{</span>&nbsp;<span class="ident" id="4760978">x</span><span class="op" id="4760979">[</span><span class="ident" id="4760980">i</span><span class="op" id="4760981">]</span><span class="op" id="4760982">,</span>&nbsp;<span class="ident" id="4760984">x</span><span class="op" id="4760985">[</span><span class="ident" id="4760986">j</span><span class="op" id="4760987">]</span>&nbsp;<span class="op" id="4760989">=</span>&nbsp;<span class="ident" id="4760991">x</span><span class="op" id="4760992">[</span><span class="ident" id="4760993">j</span><span class="op" id="4760994">]</span><span class="op" id="4760995">,</span>&nbsp;<span class="ident" id="4760997">x</span><span class="op" id="4760998">[</span><span class="ident" id="4760999">i</span><span class="op" id="4761000">]</span>&nbsp;<span class="op" id="4761002">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4761005">func</span>&nbsp;<span class="op" id="4761010">(</span><span class="ident" id="4761011">x</span>&nbsp;<span class="ident" id="4761013">byIndex</span><span class="op" id="4761020">)</span>&nbsp;<span class="ident" id="4761022">Less</span><span class="op" id="4761026">(</span><span class="ident" id="4761027">i</span><span class="op" id="4761028">,</span>&nbsp;<span class="ident" id="4761030">j</span>&nbsp;<span class="builtintype" id="4761032">int</span><span class="op" id="4761035">)</span>&nbsp;<span class="builtintype" id="4761037">bool</span>&nbsp;<span class="op" id="4761042">{</span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4761045">for</span>&nbsp;<span class="ident" id="4761049">k</span><span class="op" id="4761050">,</span>&nbsp;<span class="ident" id="4761052">xik</span>&nbsp;<span class="op" id="4761056">:=</span>&nbsp;<span class="keyword" id="4761059">range</span>&nbsp;<span class="ident" id="4761065">x</span><span class="op" id="4761066">[</span><span class="ident" id="4761067">i</span><span class="op" id="4761068">]</span><span class="op" id="4761069">.</span><span class="ident" id="4761070">index</span>&nbsp;<span class="op" id="4761076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4761080">if</span>&nbsp;<span class="ident" id="4761083">k</span>&nbsp;<span class="op" id="4761085">&gt;=</span>&nbsp;<span class="builtinfunc" id="4761088">len</span><span class="op" id="4761091">(</span><span class="ident" id="4761092">x</span><span class="op" id="4761093">[</span><span class="ident" id="4761094">j</span><span class="op" id="4761095">]</span><span class="op" id="4761096">.</span><span class="ident" id="4761097">index</span><span class="op" id="4761102">)</span>&nbsp;<span class="op" id="4761104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4761109">return</span>&nbsp;<span class="ident" id="4761116">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4761124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4761128">if</span>&nbsp;<span class="ident" id="4761131">xik</span>&nbsp;<span class="op" id="4761135">!=</span>&nbsp;<span class="ident" id="4761138">x</span><span class="op" id="4761139">[</span><span class="ident" id="4761140">j</span><span class="op" id="4761141">]</span><span class="op" id="4761142">.</span><span class="ident" id="4761143">index</span><span class="op" id="4761148">[</span><span class="ident" id="4761149">k</span><span class="op" id="4761150">]</span>&nbsp;<span class="op" id="4761152">{</span><br>
<span class="lineno">990</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4761157">return</span>&nbsp;<span class="ident" id="4761164">xik</span>&nbsp;<span class="op" id="4761168">&lt;</span>&nbsp;<span class="ident" id="4761170">x</span><span class="op" id="4761171">[</span><span class="ident" id="4761172">j</span><span class="op" id="4761173">]</span><span class="op" id="4761174">.</span><span class="ident" id="4761175">index</span><span class="op" id="4761180">[</span><span class="ident" id="4761181">k</span><span class="op" id="4761182">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4761186">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4761189">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4761192">return</span>&nbsp;<span class="builtinfunc" id="4761199">len</span><span class="op" id="4761202">(</span><span class="ident" id="4761203">x</span><span class="op" id="4761204">[</span><span class="ident" id="4761205">i</span><span class="op" id="4761206">]</span><span class="op" id="4761207">.</span><span class="ident" id="4761208">index</span><span class="op" id="4761213">)</span>&nbsp;<span class="op" id="4761215">&lt;</span>&nbsp;<span class="builtinfunc" id="4761217">len</span><span class="op" id="4761220">(</span><span class="ident" id="4761221">x</span><span class="op" id="4761222">[</span><span class="ident" id="4761223">j</span><span class="op" id="4761224">]</span><span class="op" id="4761225">.</span><span class="ident" id="4761226">index</span><span class="op" id="4761231">)</span><br>
<span class="lineno"></span><span class="op" id="4761233">}</span><br>
<span class="lineno">995</span><br>
<span class="lineno"></span><span class="comment" id="4761236">//&nbsp;typeFields&nbsp;returns&nbsp;a&nbsp;list&nbsp;of&nbsp;fields&nbsp;that&nbsp;JSON&nbsp;should&nbsp;recognize&nbsp;for&nbsp;the&nbsp;given&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="4761322">//&nbsp;The&nbsp;algorithm&nbsp;is&nbsp;breadth-first&nbsp;search&nbsp;over&nbsp;the&nbsp;set&nbsp;of&nbsp;structs&nbsp;to&nbsp;include&nbsp;-&nbsp;the&nbsp;top&nbsp;struct</span><br>
<span class="lineno"></span><span class="comment" id="4761415">//&nbsp;and&nbsp;then&nbsp;any&nbsp;reachable&nbsp;anonymous&nbsp;structs.</span><br>
<span class="lineno"></span><span class="keyword" id="4761460">func</span>&nbsp;<span class="ident" id="4761465">typeFields</span><span class="op" id="4761475">(</span><span class="ident" id="4761476">t</span>&nbsp;<span class="ident" id="4761478">reflect</span><span class="op" id="4761485">.</span><span class="ident" id="4761486">Type</span><span class="op" id="4761490">)</span>&nbsp;<span class="op" id="4761492">[</span><span class="op" id="4761493">]</span><span class="ident" id="4761494">field</span>&nbsp;<span class="op" id="4761500">{</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4761503">//&nbsp;Anonymous&nbsp;fields&nbsp;to&nbsp;explore&nbsp;at&nbsp;the&nbsp;current&nbsp;level&nbsp;and&nbsp;the&nbsp;next.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4761570">current</span>&nbsp;<span class="op" id="4761578">:=</span>&nbsp;<span class="op" id="4761581">[</span><span class="op" id="4761582">]</span><span class="ident" id="4761583">field</span><span class="op" id="4761588">{</span><span class="op" id="4761589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4761592">next</span>&nbsp;<span class="op" id="4761597">:=</span>&nbsp;<span class="op" id="4761600">[</span><span class="op" id="4761601">]</span><span class="ident" id="4761602">field</span><span class="op" id="4761607">{</span><span class="op" id="4761608">{</span><span class="ident" id="4761609">typ</span><span class="op" id="4761612">:</span>&nbsp;<span class="ident" id="4761614">t</span><span class="op" id="4761615">}</span><span class="op" id="4761616">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4761620">//&nbsp;Count&nbsp;of&nbsp;queued&nbsp;names&nbsp;for&nbsp;current&nbsp;level&nbsp;and&nbsp;the&nbsp;next.</span><br>
<span class="lineno">1005</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4761678">count</span>&nbsp;<span class="op" id="4761684">:=</span>&nbsp;<span class="keyword" id="4761687">map</span><span class="op" id="4761690">[</span><span class="ident" id="4761691">reflect</span><span class="op" id="4761698">.</span><span class="ident" id="4761699">Type</span><span class="op" id="4761703">]</span><span class="builtintype" id="4761704">int</span><span class="op" id="4761707">{</span><span class="op" id="4761708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4761711">nextCount</span>&nbsp;<span class="op" id="4761721">:=</span>&nbsp;<span class="keyword" id="4761724">map</span><span class="op" id="4761727">[</span><span class="ident" id="4761728">reflect</span><span class="op" id="4761735">.</span><span class="ident" id="4761736">Type</span><span class="op" id="4761740">]</span><span class="builtintype" id="4761741">int</span><span class="op" id="4761744">{</span><span class="op" id="4761745">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4761749">//&nbsp;Types&nbsp;already&nbsp;visited&nbsp;at&nbsp;an&nbsp;earlier&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4761796">visited</span>&nbsp;<span class="op" id="4761804">:=</span>&nbsp;<span class="keyword" id="4761807">map</span><span class="op" id="4761810">[</span><span class="ident" id="4761811">reflect</span><span class="op" id="4761818">.</span><span class="ident" id="4761819">Type</span><span class="op" id="4761823">]</span><span class="builtintype" id="4761824">bool</span><span class="op" id="4761828">{</span><span class="op" id="4761829">}</span><br>
<span class="lineno">1010</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4761833">//&nbsp;Fields&nbsp;found.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4761851">var</span>&nbsp;<span class="ident" id="4761855">fields</span>&nbsp;<span class="op" id="4761862">[</span><span class="op" id="4761863">]</span><span class="ident" id="4761864">field</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4761872">for</span>&nbsp;<span class="builtinfunc" id="4761876">len</span><span class="op" id="4761879">(</span><span class="ident" id="4761880">next</span><span class="op" id="4761884">)</span>&nbsp;<span class="op" id="4761886">&gt;</span>&nbsp;<span class="num" id="4761888">0</span>&nbsp;<span class="op" id="4761890">{</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4761894">current</span><span class="op" id="4761901">,</span>&nbsp;<span class="ident" id="4761903">next</span>&nbsp;<span class="op" id="4761908">=</span>&nbsp;<span class="ident" id="4761910">next</span><span class="op" id="4761914">,</span>&nbsp;<span class="ident" id="4761916">current</span><span class="op" id="4761923">[</span><span class="op" id="4761924">:</span><span class="num" id="4761925">0</span><span class="op" id="4761926">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4761930">count</span><span class="op" id="4761935">,</span>&nbsp;<span class="ident" id="4761937">nextCount</span>&nbsp;<span class="op" id="4761947">=</span>&nbsp;<span class="ident" id="4761949">nextCount</span><span class="op" id="4761958">,</span>&nbsp;<span class="keyword" id="4761960">map</span><span class="op" id="4761963">[</span><span class="ident" id="4761964">reflect</span><span class="op" id="4761971">.</span><span class="ident" id="4761972">Type</span><span class="op" id="4761976">]</span><span class="builtintype" id="4761977">int</span><span class="op" id="4761980">{</span><span class="op" id="4761981">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4761986">for</span>&nbsp;<span class="ident" id="4761990">_</span><span class="op" id="4761991">,</span>&nbsp;<span class="ident" id="4761993">f</span>&nbsp;<span class="op" id="4761995">:=</span>&nbsp;<span class="keyword" id="4761998">range</span>&nbsp;<span class="ident" id="4762004">current</span>&nbsp;<span class="op" id="4762012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4762017">if</span>&nbsp;<span class="ident" id="4762020">visited</span><span class="op" id="4762027">[</span><span class="ident" id="4762028">f</span><span class="op" id="4762029">.</span><span class="ident" id="4762030">typ</span><span class="op" id="4762033">]</span>&nbsp;<span class="op" id="4762035">{</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4762041">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4762053">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4762058">visited</span><span class="op" id="4762065">[</span><span class="ident" id="4762066">f</span><span class="op" id="4762067">.</span><span class="ident" id="4762068">typ</span><span class="op" id="4762071">]</span>&nbsp;<span class="op" id="4762073">=</span>&nbsp;<span class="ident" id="4762075">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4762084">//&nbsp;Scan&nbsp;f.typ&nbsp;for&nbsp;fields&nbsp;to&nbsp;include.</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4762124">for</span>&nbsp;<span class="ident" id="4762128">i</span>&nbsp;<span class="op" id="4762130">:=</span>&nbsp;<span class="num" id="4762133">0</span><span class="op" id="4762134">;</span>&nbsp;<span class="ident" id="4762136">i</span>&nbsp;<span class="op" id="4762138">&lt;</span>&nbsp;<span class="ident" id="4762140">f</span><span class="op" id="4762141">.</span><span class="ident" id="4762142">typ</span><span class="op" id="4762145">.</span><span class="ident" id="4762146">NumField</span><span class="op" id="4762154">(</span><span class="op" id="4762155">)</span><span class="op" id="4762156">;</span>&nbsp;<span class="ident" id="4762158">i</span><span class="op" id="4762159">++</span>&nbsp;<span class="op" id="4762162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4762168">sf</span>&nbsp;<span class="op" id="4762171">:=</span>&nbsp;<span class="ident" id="4762174">f</span><span class="op" id="4762175">.</span><span class="ident" id="4762176">typ</span><span class="op" id="4762179">.</span><span class="ident" id="4762180">Field</span><span class="op" id="4762185">(</span><span class="ident" id="4762186">i</span><span class="op" id="4762187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4762193">if</span>&nbsp;<span class="ident" id="4762196">sf</span><span class="op" id="4762198">.</span><span class="ident" id="4762199">PkgPath</span>&nbsp;<span class="op" id="4762207">!=</span>&nbsp;<span class="string" id="4762210">&#34;&#34;</span>&nbsp;<span class="op" id="4762213">{</span>&nbsp;<span class="comment" id="4762215">//&nbsp;unexported</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4762234">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4762247">}</span><br>
<span class="lineno">1030</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4762253">tag</span>&nbsp;<span class="op" id="4762257">:=</span>&nbsp;<span class="ident" id="4762260">sf</span><span class="op" id="4762262">.</span><span class="ident" id="4762263">Tag</span><span class="op" id="4762266">.</span><span class="ident" id="4762267">Get</span><span class="op" id="4762270">(</span><span class="string" id="4762271">&#34;json&#34;</span><span class="op" id="4762277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4762283">if</span>&nbsp;<span class="ident" id="4762286">tag</span>&nbsp;<span class="op" id="4762290">==</span>&nbsp;<span class="string" id="4762293">&#34;-&#34;</span>&nbsp;<span class="op" id="4762297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4762304">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4762317">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4762323">name</span><span class="op" id="4762327">,</span>&nbsp;<span class="ident" id="4762329">opts</span>&nbsp;<span class="op" id="4762334">:=</span>&nbsp;<span class="ident" id="4762337">parseTag</span><span class="op" id="4762345">(</span><span class="ident" id="4762346">tag</span><span class="op" id="4762349">)</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4762355">if</span>&nbsp;<span class="op" id="4762358">!</span><span class="ident" id="4762359">isValidTag</span><span class="op" id="4762369">(</span><span class="ident" id="4762370">name</span><span class="op" id="4762374">)</span>&nbsp;<span class="op" id="4762376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4762383">name</span>&nbsp;<span class="op" id="4762388">=</span>&nbsp;<span class="string" id="4762390">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4762397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4762403">index</span>&nbsp;<span class="op" id="4762409">:=</span>&nbsp;<span class="builtinfunc" id="4762412">make</span><span class="op" id="4762416">(</span><span class="op" id="4762417">[</span><span class="op" id="4762418">]</span><span class="builtintype" id="4762419">int</span><span class="op" id="4762422">,</span>&nbsp;<span class="builtinfunc" id="4762424">len</span><span class="op" id="4762427">(</span><span class="ident" id="4762428">f</span><span class="op" id="4762429">.</span><span class="ident" id="4762430">index</span><span class="op" id="4762435">)</span><span class="op" id="4762436">+</span><span class="num" id="4762437">1</span><span class="op" id="4762438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4762444">copy</span><span class="op" id="4762448">(</span><span class="ident" id="4762449">index</span><span class="op" id="4762454">,</span>&nbsp;<span class="ident" id="4762456">f</span><span class="op" id="4762457">.</span><span class="ident" id="4762458">index</span><span class="op" id="4762463">)</span><br>
<span class="lineno">1040</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4762469">index</span><span class="op" id="4762474">[</span><span class="builtinfunc" id="4762475">len</span><span class="op" id="4762478">(</span><span class="ident" id="4762479">f</span><span class="op" id="4762480">.</span><span class="ident" id="4762481">index</span><span class="op" id="4762486">)</span><span class="op" id="4762487">]</span>&nbsp;<span class="op" id="4762489">=</span>&nbsp;<span class="ident" id="4762491">i</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4762498">ft</span>&nbsp;<span class="op" id="4762501">:=</span>&nbsp;<span class="ident" id="4762504">sf</span><span class="op" id="4762506">.</span><span class="ident" id="4762507">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4762516">if</span>&nbsp;<span class="ident" id="4762519">ft</span><span class="op" id="4762521">.</span><span class="ident" id="4762522">Name</span><span class="op" id="4762526">(</span><span class="op" id="4762527">)</span>&nbsp;<span class="op" id="4762529">==</span>&nbsp;<span class="string" id="4762532">&#34;&#34;</span>&nbsp;<span class="op" id="4762535">&amp;&amp;</span>&nbsp;<span class="ident" id="4762538">ft</span><span class="op" id="4762540">.</span><span class="ident" id="4762541">Kind</span><span class="op" id="4762545">(</span><span class="op" id="4762546">)</span>&nbsp;<span class="op" id="4762548">==</span>&nbsp;<span class="ident" id="4762551">reflect</span><span class="op" id="4762558">.</span><span class="ident" id="4762559">Ptr</span>&nbsp;<span class="op" id="4762563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4762570">//&nbsp;Follow&nbsp;pointer.</span><br>
<span class="lineno">1045</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4762594">ft</span>&nbsp;<span class="op" id="4762597">=</span>&nbsp;<span class="ident" id="4762599">ft</span><span class="op" id="4762601">.</span><span class="ident" id="4762602">Elem</span><span class="op" id="4762606">(</span><span class="op" id="4762607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4762613">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4762620">//&nbsp;Record&nbsp;found&nbsp;field&nbsp;and&nbsp;index&nbsp;sequence.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4762666">if</span>&nbsp;<span class="ident" id="4762669">name</span>&nbsp;<span class="op" id="4762674">!=</span>&nbsp;<span class="string" id="4762677">&#34;&#34;</span>&nbsp;<span class="op" id="4762680">||</span>&nbsp;<span class="op" id="4762683">!</span><span class="ident" id="4762684">sf</span><span class="op" id="4762686">.</span><span class="ident" id="4762687">Anonymous</span>&nbsp;<span class="op" id="4762697">||</span>&nbsp;<span class="ident" id="4762700">ft</span><span class="op" id="4762702">.</span><span class="ident" id="4762703">Kind</span><span class="op" id="4762707">(</span><span class="op" id="4762708">)</span>&nbsp;<span class="op" id="4762710">!=</span>&nbsp;<span class="ident" id="4762713">reflect</span><span class="op" id="4762720">.</span><span class="ident" id="4762721">Struct</span>&nbsp;<span class="op" id="4762728">{</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4762735">tagged</span>&nbsp;<span class="op" id="4762742">:=</span>&nbsp;<span class="ident" id="4762745">name</span>&nbsp;<span class="op" id="4762750">!=</span>&nbsp;<span class="string" id="4762753">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4762761">if</span>&nbsp;<span class="ident" id="4762764">name</span>&nbsp;<span class="op" id="4762769">==</span>&nbsp;<span class="string" id="4762772">&#34;&#34;</span>&nbsp;<span class="op" id="4762775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4762783">name</span>&nbsp;<span class="op" id="4762788">=</span>&nbsp;<span class="ident" id="4762790">sf</span><span class="op" id="4762792">.</span><span class="ident" id="4762793">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4762803">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4762810">fields</span>&nbsp;<span class="op" id="4762817">=</span>&nbsp;<span class="builtinfunc" id="4762819">append</span><span class="op" id="4762825">(</span><span class="ident" id="4762826">fields</span><span class="op" id="4762832">,</span>&nbsp;<span class="ident" id="4762834">fillField</span><span class="op" id="4762843">(</span><span class="ident" id="4762844">field</span><span class="op" id="4762849">{</span><br>
<span class="lineno">1055</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4762857">name</span><span class="op" id="4762861">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4762868">name</span><span class="op" id="4762872">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4762880">tag</span><span class="op" id="4762883">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4762891">tagged</span><span class="op" id="4762897">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4762905">index</span><span class="op" id="4762910">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4762916">index</span><span class="op" id="4762921">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4762929">typ</span><span class="op" id="4762932">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4762940">ft</span><span class="op" id="4762942">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4762950">omitEmpty</span><span class="op" id="4762959">:</span>&nbsp;<span class="ident" id="4762961">opts</span><span class="op" id="4762965">.</span><span class="ident" id="4762966">Contains</span><span class="op" id="4762974">(</span><span class="string" id="4762975">&#34;omitempty&#34;</span><span class="op" id="4762986">)</span><span class="op" id="4762987">,</span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4762995">quoted</span><span class="op" id="4763001">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4763006">opts</span><span class="op" id="4763010">.</span><span class="ident" id="4763011">Contains</span><span class="op" id="4763019">(</span><span class="string" id="4763020">&#34;string&#34;</span><span class="op" id="4763028">)</span><span class="op" id="4763029">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4763036">}</span><span class="op" id="4763037">)</span><span class="op" id="4763038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4763045">if</span>&nbsp;<span class="ident" id="4763048">count</span><span class="op" id="4763053">[</span><span class="ident" id="4763054">f</span><span class="op" id="4763055">.</span><span class="ident" id="4763056">typ</span><span class="op" id="4763059">]</span>&nbsp;<span class="op" id="4763061">&gt;</span>&nbsp;<span class="num" id="4763063">1</span>&nbsp;<span class="op" id="4763065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4763073">//&nbsp;If&nbsp;there&nbsp;were&nbsp;multiple&nbsp;instances,&nbsp;add&nbsp;a&nbsp;second,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4763130">//&nbsp;so&nbsp;that&nbsp;the&nbsp;annihilation&nbsp;code&nbsp;will&nbsp;see&nbsp;a&nbsp;duplicate.</span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4763191">//&nbsp;It&nbsp;only&nbsp;cares&nbsp;about&nbsp;the&nbsp;distinction&nbsp;between&nbsp;1&nbsp;or&nbsp;2,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4763252">//&nbsp;so&nbsp;don&#39;t&nbsp;bother&nbsp;generating&nbsp;any&nbsp;more&nbsp;copies.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4763305">fields</span>&nbsp;<span class="op" id="4763312">=</span>&nbsp;<span class="builtinfunc" id="4763314">append</span><span class="op" id="4763320">(</span><span class="ident" id="4763321">fields</span><span class="op" id="4763327">,</span>&nbsp;<span class="ident" id="4763329">fields</span><span class="op" id="4763335">[</span><span class="builtinfunc" id="4763336">len</span><span class="op" id="4763339">(</span><span class="ident" id="4763340">fields</span><span class="op" id="4763346">)</span><span class="op" id="4763347">-</span><span class="num" id="4763348">1</span><span class="op" id="4763349">]</span><span class="op" id="4763350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4763357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4763364">continue</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4763377">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4763384">//&nbsp;Record&nbsp;new&nbsp;anonymous&nbsp;struct&nbsp;to&nbsp;explore&nbsp;in&nbsp;next&nbsp;round.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4763445">nextCount</span><span class="op" id="4763454">[</span><span class="ident" id="4763455">ft</span><span class="op" id="4763457">]</span><span class="op" id="4763458">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4763465">if</span>&nbsp;<span class="ident" id="4763468">nextCount</span><span class="op" id="4763477">[</span><span class="ident" id="4763478">ft</span><span class="op" id="4763480">]</span>&nbsp;<span class="op" id="4763482">==</span>&nbsp;<span class="num" id="4763485">1</span>&nbsp;<span class="op" id="4763487">{</span><br>
<span class="lineno">1075</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4763494">next</span>&nbsp;<span class="op" id="4763499">=</span>&nbsp;<span class="builtinfunc" id="4763501">append</span><span class="op" id="4763507">(</span><span class="ident" id="4763508">next</span><span class="op" id="4763512">,</span>&nbsp;<span class="ident" id="4763514">fillField</span><span class="op" id="4763523">(</span><span class="ident" id="4763524">field</span><span class="op" id="4763529">{</span><span class="ident" id="4763530">name</span><span class="op" id="4763534">:</span>&nbsp;<span class="ident" id="4763536">ft</span><span class="op" id="4763538">.</span><span class="ident" id="4763539">Name</span><span class="op" id="4763543">(</span><span class="op" id="4763544">)</span><span class="op" id="4763545">,</span>&nbsp;<span class="ident" id="4763547">index</span><span class="op" id="4763552">:</span>&nbsp;<span class="ident" id="4763554">index</span><span class="op" id="4763559">,</span>&nbsp;<span class="ident" id="4763561">typ</span><span class="op" id="4763564">:</span>&nbsp;<span class="ident" id="4763566">ft</span><span class="op" id="4763568">}</span><span class="op" id="4763569">)</span><span class="op" id="4763570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4763576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4763581">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4763585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4763588">}</span><br>
<span class="lineno">1080</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4763592">sort</span><span class="op" id="4763596">.</span><span class="ident" id="4763597">Sort</span><span class="op" id="4763601">(</span><span class="ident" id="4763602">byName</span><span class="op" id="4763608">(</span><span class="ident" id="4763609">fields</span><span class="op" id="4763615">)</span><span class="op" id="4763616">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4763620">//&nbsp;Delete&nbsp;all&nbsp;fields&nbsp;that&nbsp;are&nbsp;hidden&nbsp;by&nbsp;the&nbsp;Go&nbsp;rules&nbsp;for&nbsp;embedded&nbsp;fields,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4763695">//&nbsp;except&nbsp;that&nbsp;fields&nbsp;with&nbsp;JSON&nbsp;tags&nbsp;are&nbsp;promoted.</span><br>
<span class="lineno">1085</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4763748">//&nbsp;The&nbsp;fields&nbsp;are&nbsp;sorted&nbsp;in&nbsp;primary&nbsp;order&nbsp;of&nbsp;name,&nbsp;secondary&nbsp;order</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4763816">//&nbsp;of&nbsp;field&nbsp;index&nbsp;length.&nbsp;Loop&nbsp;over&nbsp;names;&nbsp;for&nbsp;each&nbsp;name,&nbsp;delete</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4763882">//&nbsp;hidden&nbsp;fields&nbsp;by&nbsp;choosing&nbsp;the&nbsp;one&nbsp;dominant&nbsp;field&nbsp;that&nbsp;survives.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4763950">out</span>&nbsp;<span class="op" id="4763954">:=</span>&nbsp;<span class="ident" id="4763957">fields</span><span class="op" id="4763963">[</span><span class="op" id="4763964">:</span><span class="num" id="4763965">0</span><span class="op" id="4763966">]</span><br>
<span class="lineno">1090</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4763969">for</span>&nbsp;<span class="ident" id="4763973">advance</span><span class="op" id="4763980">,</span>&nbsp;<span class="ident" id="4763982">i</span>&nbsp;<span class="op" id="4763984">:=</span>&nbsp;<span class="num" id="4763987">0</span><span class="op" id="4763988">,</span>&nbsp;<span class="num" id="4763990">0</span><span class="op" id="4763991">;</span>&nbsp;<span class="ident" id="4763993">i</span>&nbsp;<span class="op" id="4763995">&lt;</span>&nbsp;<span class="builtinfunc" id="4763997">len</span><span class="op" id="4764000">(</span><span class="ident" id="4764001">fields</span><span class="op" id="4764007">)</span><span class="op" id="4764008">;</span>&nbsp;<span class="ident" id="4764010">i</span>&nbsp;<span class="op" id="4764012">+=</span>&nbsp;<span class="ident" id="4764015">advance</span>&nbsp;<span class="op" id="4764023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4764027">//&nbsp;One&nbsp;iteration&nbsp;per&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4764056">//&nbsp;Find&nbsp;the&nbsp;sequence&nbsp;of&nbsp;fields&nbsp;with&nbsp;the&nbsp;name&nbsp;of&nbsp;this&nbsp;first&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4764124">fi</span>&nbsp;<span class="op" id="4764127">:=</span>&nbsp;<span class="ident" id="4764130">fields</span><span class="op" id="4764136">[</span><span class="ident" id="4764137">i</span><span class="op" id="4764138">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4764142">name</span>&nbsp;<span class="op" id="4764147">:=</span>&nbsp;<span class="ident" id="4764150">fi</span><span class="op" id="4764152">.</span><span class="ident" id="4764153">name</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4764160">for</span>&nbsp;<span class="ident" id="4764164">advance</span>&nbsp;<span class="op" id="4764172">=</span>&nbsp;<span class="num" id="4764174">1</span><span class="op" id="4764175">;</span>&nbsp;<span class="ident" id="4764177">i</span><span class="op" id="4764178">+</span><span class="ident" id="4764179">advance</span>&nbsp;<span class="op" id="4764187">&lt;</span>&nbsp;<span class="builtinfunc" id="4764189">len</span><span class="op" id="4764192">(</span><span class="ident" id="4764193">fields</span><span class="op" id="4764199">)</span><span class="op" id="4764200">;</span>&nbsp;<span class="ident" id="4764202">advance</span><span class="op" id="4764209">++</span>&nbsp;<span class="op" id="4764212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4764217">fj</span>&nbsp;<span class="op" id="4764220">:=</span>&nbsp;<span class="ident" id="4764223">fields</span><span class="op" id="4764229">[</span><span class="ident" id="4764230">i</span><span class="op" id="4764231">+</span><span class="ident" id="4764232">advance</span><span class="op" id="4764239">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4764244">if</span>&nbsp;<span class="ident" id="4764247">fj</span><span class="op" id="4764249">.</span><span class="ident" id="4764250">name</span>&nbsp;<span class="op" id="4764255">!=</span>&nbsp;<span class="ident" id="4764258">name</span>&nbsp;<span class="op" id="4764263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4764269">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4764278">}</span><br>
<span class="lineno">1100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4764282">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4764286">if</span>&nbsp;<span class="ident" id="4764289">advance</span>&nbsp;<span class="op" id="4764297">==</span>&nbsp;<span class="num" id="4764300">1</span>&nbsp;<span class="op" id="4764302">{</span>&nbsp;<span class="comment" id="4764304">//&nbsp;Only&nbsp;one&nbsp;field&nbsp;with&nbsp;this&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4764340">out</span>&nbsp;<span class="op" id="4764344">=</span>&nbsp;<span class="builtinfunc" id="4764346">append</span><span class="op" id="4764352">(</span><span class="ident" id="4764353">out</span><span class="op" id="4764356">,</span>&nbsp;<span class="ident" id="4764358">fi</span><span class="op" id="4764360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4764365">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4764376">}</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4764380">dominant</span><span class="op" id="4764388">,</span>&nbsp;<span class="ident" id="4764390">ok</span>&nbsp;<span class="op" id="4764393">:=</span>&nbsp;<span class="ident" id="4764396">dominantField</span><span class="op" id="4764409">(</span><span class="ident" id="4764410">fields</span><span class="op" id="4764416">[</span><span class="ident" id="4764417">i</span>&nbsp;<span class="op" id="4764419">:</span>&nbsp;<span class="ident" id="4764421">i</span><span class="op" id="4764422">+</span><span class="ident" id="4764423">advance</span><span class="op" id="4764430">]</span><span class="op" id="4764431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4764435">if</span>&nbsp;<span class="ident" id="4764438">ok</span>&nbsp;<span class="op" id="4764441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4764446">out</span>&nbsp;<span class="op" id="4764450">=</span>&nbsp;<span class="builtinfunc" id="4764452">append</span><span class="op" id="4764458">(</span><span class="ident" id="4764459">out</span><span class="op" id="4764462">,</span>&nbsp;<span class="ident" id="4764464">dominant</span><span class="op" id="4764472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4764476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4764479">}</span><br>
<span class="lineno">1110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4764483">fields</span>&nbsp;<span class="op" id="4764490">=</span>&nbsp;<span class="ident" id="4764492">out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4764497">sort</span><span class="op" id="4764501">.</span><span class="ident" id="4764502">Sort</span><span class="op" id="4764506">(</span><span class="ident" id="4764507">byIndex</span><span class="op" id="4764514">(</span><span class="ident" id="4764515">fields</span><span class="op" id="4764521">)</span><span class="op" id="4764522">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4764526">return</span>&nbsp;<span class="ident" id="4764533">fields</span><br>
<span class="lineno">1115</span><span class="op" id="4764540">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4764543">//&nbsp;dominantField&nbsp;looks&nbsp;through&nbsp;the&nbsp;fields,&nbsp;all&nbsp;of&nbsp;which&nbsp;are&nbsp;known&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4764612">//&nbsp;have&nbsp;the&nbsp;same&nbsp;name,&nbsp;to&nbsp;find&nbsp;the&nbsp;single&nbsp;field&nbsp;that&nbsp;dominates&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4764679">//&nbsp;others&nbsp;using&nbsp;Go&#39;s&nbsp;embedding&nbsp;rules,&nbsp;modified&nbsp;by&nbsp;the&nbsp;presence&nbsp;of</span><br>
<span class="lineno">1120</span><span class="comment" id="4764745">//&nbsp;JSON&nbsp;tags.&nbsp;If&nbsp;there&nbsp;are&nbsp;multiple&nbsp;top-level&nbsp;fields,&nbsp;the&nbsp;boolean</span><br>
<span class="lineno"></span><span class="comment" id="4764811">//&nbsp;will&nbsp;be&nbsp;false:&nbsp;This&nbsp;condition&nbsp;is&nbsp;an&nbsp;error&nbsp;in&nbsp;Go&nbsp;and&nbsp;we&nbsp;skip&nbsp;all</span><br>
<span class="lineno"></span><span class="comment" id="4764878">//&nbsp;the&nbsp;fields.</span><br>
<span class="lineno"></span><span class="keyword" id="4764893">func</span>&nbsp;<span class="ident" id="4764898">dominantField</span><span class="op" id="4764911">(</span><span class="ident" id="4764912">fields</span>&nbsp;<span class="op" id="4764919">[</span><span class="op" id="4764920">]</span><span class="ident" id="4764921">field</span><span class="op" id="4764926">)</span>&nbsp;<span class="op" id="4764928">(</span><span class="ident" id="4764929">field</span><span class="op" id="4764934">,</span>&nbsp;<span class="builtintype" id="4764936">bool</span><span class="op" id="4764940">)</span>&nbsp;<span class="op" id="4764942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4764945">//&nbsp;The&nbsp;fields&nbsp;are&nbsp;sorted&nbsp;in&nbsp;increasing&nbsp;index-length&nbsp;order.&nbsp;The&nbsp;winner</span><br>
<span class="lineno">1125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4765016">//&nbsp;must&nbsp;therefore&nbsp;be&nbsp;one&nbsp;with&nbsp;the&nbsp;shortest&nbsp;index&nbsp;length.&nbsp;Drop&nbsp;all</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4765083">//&nbsp;longer&nbsp;entries,&nbsp;which&nbsp;is&nbsp;easy:&nbsp;just&nbsp;truncate&nbsp;the&nbsp;slice.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4765143">length</span>&nbsp;<span class="op" id="4765150">:=</span>&nbsp;<span class="builtinfunc" id="4765153">len</span><span class="op" id="4765156">(</span><span class="ident" id="4765157">fields</span><span class="op" id="4765163">[</span><span class="num" id="4765164">0</span><span class="op" id="4765165">]</span><span class="op" id="4765166">.</span><span class="ident" id="4765167">index</span><span class="op" id="4765172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4765175">tagged</span>&nbsp;<span class="op" id="4765182">:=</span>&nbsp;<span class="op" id="4765185">-</span><span class="num" id="4765186">1</span>&nbsp;<span class="comment" id="4765188">//&nbsp;Index&nbsp;of&nbsp;first&nbsp;tagged&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4765221">for</span>&nbsp;<span class="ident" id="4765225">i</span><span class="op" id="4765226">,</span>&nbsp;<span class="ident" id="4765228">f</span>&nbsp;<span class="op" id="4765230">:=</span>&nbsp;<span class="keyword" id="4765233">range</span>&nbsp;<span class="ident" id="4765239">fields</span>&nbsp;<span class="op" id="4765246">{</span><br>
<span class="lineno">1130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4765250">if</span>&nbsp;<span class="builtinfunc" id="4765253">len</span><span class="op" id="4765256">(</span><span class="ident" id="4765257">f</span><span class="op" id="4765258">.</span><span class="ident" id="4765259">index</span><span class="op" id="4765264">)</span>&nbsp;<span class="op" id="4765266">&gt;</span>&nbsp;<span class="ident" id="4765268">length</span>&nbsp;<span class="op" id="4765275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4765280">fields</span>&nbsp;<span class="op" id="4765287">=</span>&nbsp;<span class="ident" id="4765289">fields</span><span class="op" id="4765295">[</span><span class="op" id="4765296">:</span><span class="ident" id="4765297">i</span><span class="op" id="4765298">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4765303">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4765311">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4765315">if</span>&nbsp;<span class="ident" id="4765318">f</span><span class="op" id="4765319">.</span><span class="ident" id="4765320">tag</span>&nbsp;<span class="op" id="4765324">{</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4765329">if</span>&nbsp;<span class="ident" id="4765332">tagged</span>&nbsp;<span class="op" id="4765339">&gt;=</span>&nbsp;<span class="num" id="4765342">0</span>&nbsp;<span class="op" id="4765344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4765350">//&nbsp;Multiple&nbsp;tagged&nbsp;fields&nbsp;at&nbsp;the&nbsp;same&nbsp;level:&nbsp;conflict.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4765409">//&nbsp;Return&nbsp;no&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4765433">return</span>&nbsp;<span class="ident" id="4765440">field</span><span class="op" id="4765445">{</span><span class="op" id="4765446">}</span><span class="op" id="4765447">,</span>&nbsp;<span class="ident" id="4765449">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4765458">}</span><br>
<span class="lineno">1140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4765463">tagged</span>&nbsp;<span class="op" id="4765470">=</span>&nbsp;<span class="ident" id="4765472">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4765476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4765479">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4765482">if</span>&nbsp;<span class="ident" id="4765485">tagged</span>&nbsp;<span class="op" id="4765492">&gt;=</span>&nbsp;<span class="num" id="4765495">0</span>&nbsp;<span class="op" id="4765497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4765501">return</span>&nbsp;<span class="ident" id="4765508">fields</span><span class="op" id="4765514">[</span><span class="ident" id="4765515">tagged</span><span class="op" id="4765521">]</span><span class="op" id="4765522">,</span>&nbsp;<span class="ident" id="4765524">true</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4765530">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4765533">//&nbsp;All&nbsp;remaining&nbsp;fields&nbsp;have&nbsp;the&nbsp;same&nbsp;length.&nbsp;If&nbsp;there&#39;s&nbsp;more&nbsp;than&nbsp;one,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4765606">//&nbsp;we&nbsp;have&nbsp;a&nbsp;conflict&nbsp;(two&nbsp;fields&nbsp;named&nbsp;&#34;X&#34;&nbsp;at&nbsp;the&nbsp;same&nbsp;level)&nbsp;and&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4765677">//&nbsp;return&nbsp;no&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4765698">if</span>&nbsp;<span class="builtinfunc" id="4765701">len</span><span class="op" id="4765704">(</span><span class="ident" id="4765705">fields</span><span class="op" id="4765711">)</span>&nbsp;<span class="op" id="4765713">&gt;</span>&nbsp;<span class="num" id="4765715">1</span>&nbsp;<span class="op" id="4765717">{</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4765721">return</span>&nbsp;<span class="ident" id="4765728">field</span><span class="op" id="4765733">{</span><span class="op" id="4765734">}</span><span class="op" id="4765735">,</span>&nbsp;<span class="ident" id="4765737">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4765744">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4765747">return</span>&nbsp;<span class="ident" id="4765754">fields</span><span class="op" id="4765760">[</span><span class="num" id="4765761">0</span><span class="op" id="4765762">]</span><span class="op" id="4765763">,</span>&nbsp;<span class="ident" id="4765765">true</span><br>
<span class="lineno"></span><span class="op" id="4765770">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1155</span><span class="keyword" id="4765773">var</span>&nbsp;<span class="ident" id="4765777">fieldCache</span>&nbsp;<span class="keyword" id="4765788">struct</span>&nbsp;<span class="op" id="4765795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4765798">sync</span><span class="op" id="4765802">.</span><span class="ident" id="4765803">RWMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4765812">m</span>&nbsp;<span class="keyword" id="4765814">map</span><span class="op" id="4765817">[</span><span class="ident" id="4765818">reflect</span><span class="op" id="4765825">.</span><span class="ident" id="4765826">Type</span><span class="op" id="4765830">]</span><span class="op" id="4765831">[</span><span class="op" id="4765832">]</span><span class="ident" id="4765833">field</span><br>
<span class="lineno"></span><span class="op" id="4765839">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1160</span><span class="comment" id="4765842">//&nbsp;cachedTypeFields&nbsp;is&nbsp;like&nbsp;typeFields&nbsp;but&nbsp;uses&nbsp;a&nbsp;cache&nbsp;to&nbsp;avoid&nbsp;repeated&nbsp;work.</span><br>
<span class="lineno"></span><span class="keyword" id="4765922">func</span>&nbsp;<span class="ident" id="4765927">cachedTypeFields</span><span class="op" id="4765943">(</span><span class="ident" id="4765944">t</span>&nbsp;<span class="ident" id="4765946">reflect</span><span class="op" id="4765953">.</span><span class="ident" id="4765954">Type</span><span class="op" id="4765958">)</span>&nbsp;<span class="op" id="4765960">[</span><span class="op" id="4765961">]</span><span class="ident" id="4765962">field</span>&nbsp;<span class="op" id="4765968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4765971">fieldCache</span><span class="op" id="4765981">.</span><span class="ident" id="4765982">RLock</span><span class="op" id="4765987">(</span><span class="op" id="4765988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4765991">f</span>&nbsp;<span class="op" id="4765993">:=</span>&nbsp;<span class="ident" id="4765996">fieldCache</span><span class="op" id="4766006">.</span><span class="ident" id="4766007">m</span><span class="op" id="4766008">[</span><span class="ident" id="4766009">t</span><span class="op" id="4766010">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4766013">fieldCache</span><span class="op" id="4766023">.</span><span class="ident" id="4766024">RUnlock</span><span class="op" id="4766031">(</span><span class="op" id="4766032">)</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4766035">if</span>&nbsp;<span class="ident" id="4766038">f</span>&nbsp;<span class="op" id="4766040">!=</span>&nbsp;<span class="ident" id="4766043">nil</span>&nbsp;<span class="op" id="4766047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4766051">return</span>&nbsp;<span class="ident" id="4766058">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4766061">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4766065">//&nbsp;Compute&nbsp;fields&nbsp;without&nbsp;lock.</span><br>
<span class="lineno">1170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4766098">//&nbsp;Might&nbsp;duplicate&nbsp;effort&nbsp;but&nbsp;won&#39;t&nbsp;hold&nbsp;other&nbsp;computations&nbsp;back.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4766165">f</span>&nbsp;<span class="op" id="4766167">=</span>&nbsp;<span class="ident" id="4766169">typeFields</span><span class="op" id="4766179">(</span><span class="ident" id="4766180">t</span><span class="op" id="4766181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4766184">if</span>&nbsp;<span class="ident" id="4766187">f</span>&nbsp;<span class="op" id="4766189">==</span>&nbsp;<span class="ident" id="4766192">nil</span>&nbsp;<span class="op" id="4766196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4766200">f</span>&nbsp;<span class="op" id="4766202">=</span>&nbsp;<span class="op" id="4766204">[</span><span class="op" id="4766205">]</span><span class="ident" id="4766206">field</span><span class="op" id="4766211">{</span><span class="op" id="4766212">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4766215">}</span><br>
<span class="lineno">1175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4766219">fieldCache</span><span class="op" id="4766229">.</span><span class="ident" id="4766230">Lock</span><span class="op" id="4766234">(</span><span class="op" id="4766235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4766238">if</span>&nbsp;<span class="ident" id="4766241">fieldCache</span><span class="op" id="4766251">.</span><span class="ident" id="4766252">m</span>&nbsp;<span class="op" id="4766254">==</span>&nbsp;<span class="ident" id="4766257">nil</span>&nbsp;<span class="op" id="4766261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4766265">fieldCache</span><span class="op" id="4766275">.</span><span class="ident" id="4766276">m</span>&nbsp;<span class="op" id="4766278">=</span>&nbsp;<span class="keyword" id="4766280">map</span><span class="op" id="4766283">[</span><span class="ident" id="4766284">reflect</span><span class="op" id="4766291">.</span><span class="ident" id="4766292">Type</span><span class="op" id="4766296">]</span><span class="op" id="4766297">[</span><span class="op" id="4766298">]</span><span class="ident" id="4766299">field</span><span class="op" id="4766304">{</span><span class="op" id="4766305">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4766308">}</span><br>
<span class="lineno">1180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4766311">fieldCache</span><span class="op" id="4766321">.</span><span class="ident" id="4766322">m</span><span class="op" id="4766323">[</span><span class="ident" id="4766324">t</span><span class="op" id="4766325">]</span>&nbsp;<span class="op" id="4766327">=</span>&nbsp;<span class="ident" id="4766329">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4766332">fieldCache</span><span class="op" id="4766342">.</span><span class="ident" id="4766343">Unlock</span><span class="op" id="4766349">(</span><span class="op" id="4766350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4766353">return</span>&nbsp;<span class="ident" id="4766360">f</span><br>
<span class="lineno"></span><span class="op" id="4766362">}</span>
</div>
</body>
</html>
