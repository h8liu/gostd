<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="1721749">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1721804">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1721858">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1721909">package</span>&nbsp;<span class="ident" id="1721917">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1721926">//&nbsp;This&nbsp;file&nbsp;contains&nbsp;the&nbsp;implementation&nbsp;of&nbsp;Go&nbsp;channels.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1721984">import</span>&nbsp;<span class="string" id="1721991">&#34;unsafe&#34;</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1722001">const</span>&nbsp;<span class="op" id="1722007">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1722010">maxAlign</span>&nbsp;&nbsp;<span class="op" id="1722020">=</span>&nbsp;<span class="num" id="1722022">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1722025">hchanSize</span>&nbsp;<span class="op" id="1722035">=</span>&nbsp;<span class="ident" id="1722037"><a href="/runtime/chan.go.html#1721991">unsafe</a></span><span class="op" id="1722043">.</span><span class="ident" id="1722044">Sizeof</span><span class="op" id="1722050">(</span><span class="ident" id="1722051"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026588">hchan</a></span><span class="op" id="1722056">{</span><span class="op" id="1722057">}</span><span class="op" id="1722058">)</span>&nbsp;<span class="op" id="1722060">+</span>&nbsp;<span class="builtintype" id="1722062">uintptr</span><span class="op" id="1722069">(</span><span class="op" id="1722070">-</span><span class="builtintype" id="1722071">int</span><span class="op" id="1722074">(</span><span class="ident" id="1722075"><a href="/runtime/chan.go.html#1721991">unsafe</a></span><span class="op" id="1722081">.</span><span class="ident" id="1722082">Sizeof</span><span class="op" id="1722088">(</span><span class="ident" id="1722089"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026588">hchan</a></span><span class="op" id="1722094">{</span><span class="op" id="1722095">}</span><span class="op" id="1722096">)</span><span class="op" id="1722097">)</span><span class="op" id="1722098">&amp;</span><span class="op" id="1722099">(</span><span class="ident" id="1722100"><a href="/runtime/chan.go.html#1722010">maxAlign</a></span><span class="op" id="1722108">-</span><span class="num" id="1722109">1</span><span class="op" id="1722110">)</span><span class="op" id="1722111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1722114">debugChan</span>&nbsp;<span class="op" id="1722124">=</span>&nbsp;<span class="ident" id="1722126">false</span><br>
<span class="lineno">15</span><span class="op" id="1722132">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1722135">//&nbsp;TODO(khr):&nbsp;make&nbsp;hchan.buf&nbsp;an&nbsp;unsafe.Pointer,&nbsp;not&nbsp;a&nbsp;*uint8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1722197">func</span>&nbsp;<span class="ident" id="1722202">makechan</span><span class="op" id="1722210">(</span><span class="ident" id="1722211">t</span>&nbsp;<span class="op" id="1722213">*</span><span class="ident" id="1722214"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026299">chantype</a></span><span class="op" id="1722222">,</span>&nbsp;<span class="ident" id="1722224">size</span>&nbsp;<span class="ident" id="1722229">int64</span><span class="op" id="1722234">)</span>&nbsp;<span class="op" id="1722236">*</span><span class="ident" id="1722237"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026588">hchan</a></span>&nbsp;<span class="op" id="1722243">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1722246">elem</span>&nbsp;<span class="op" id="1722251">:=</span>&nbsp;<span class="ident" id="1722254"><a href="/runtime/chan.go.html#1722211">t</a></span><span class="op" id="1722255">.</span><span class="ident" id="1722256">elem</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1722263">//&nbsp;compiler&nbsp;checks&nbsp;this&nbsp;but&nbsp;be&nbsp;safe.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1722301">if</span>&nbsp;<span class="ident" id="1722304"><a href="/runtime/chan.go.html#1722246">elem</a></span><span class="op" id="1722308">.</span><span class="ident" id="1722309">size</span>&nbsp;<span class="op" id="1722314">&gt;=</span>&nbsp;<span class="num" id="1722317">1</span><span class="op" id="1722318">&lt;&lt;</span><span class="num" id="1722320">16</span>&nbsp;<span class="op" id="1722323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1722327"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1722334">(</span><span class="string" id="1722335">&#34;makechan:&nbsp;invalid&nbsp;channel&nbsp;element&nbsp;type&#34;</span><span class="op" id="1722375">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1722378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1722381">if</span>&nbsp;<span class="ident" id="1722384"><a href="/runtime/chan.go.html#1722025">hchanSize</a></span><span class="op" id="1722393">%</span><span class="ident" id="1722394"><a href="/runtime/chan.go.html#1722010">maxAlign</a></span>&nbsp;<span class="op" id="1722403">!=</span>&nbsp;<span class="num" id="1722406">0</span>&nbsp;<span class="op" id="1722408">||</span>&nbsp;<span class="ident" id="1722411"><a href="/runtime/chan.go.html#1722246">elem</a></span><span class="op" id="1722415">.</span><span class="ident" id="1722416">align</span>&nbsp;<span class="op" id="1722422">&gt;</span>&nbsp;<span class="ident" id="1722424"><a href="/runtime/chan.go.html#1722010">maxAlign</a></span>&nbsp;<span class="op" id="1722433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1722437"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1722444">(</span><span class="string" id="1722445">&#34;makechan:&nbsp;bad&nbsp;alignment&#34;</span><span class="op" id="1722470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1722473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1722476">if</span>&nbsp;<span class="ident" id="1722479"><a href="/runtime/chan.go.html#1722224">size</a></span>&nbsp;<span class="op" id="1722484">&lt;</span>&nbsp;<span class="num" id="1722486">0</span>&nbsp;<span class="op" id="1722488">||</span>&nbsp;<span class="ident" id="1722491">int64</span><span class="op" id="1722496">(</span><span class="builtintype" id="1722497">uintptr</span><span class="op" id="1722504">(</span><span class="ident" id="1722505"><a href="/runtime/chan.go.html#1722224">size</a></span><span class="op" id="1722509">)</span><span class="op" id="1722510">)</span>&nbsp;<span class="op" id="1722512">!=</span>&nbsp;<span class="ident" id="1722515"><a href="/runtime/chan.go.html#1722224">size</a></span>&nbsp;<span class="op" id="1722520">||</span>&nbsp;<span class="op" id="1722523">(</span><span class="ident" id="1722524"><a href="/runtime/chan.go.html#1722246">elem</a></span><span class="op" id="1722528">.</span><span class="ident" id="1722529">size</span>&nbsp;<span class="op" id="1722534">&gt;</span>&nbsp;<span class="num" id="1722536">0</span>&nbsp;<span class="op" id="1722538">&amp;&amp;</span>&nbsp;<span class="builtintype" id="1722541">uintptr</span><span class="op" id="1722548">(</span><span class="ident" id="1722549"><a href="/runtime/chan.go.html#1722224">size</a></span><span class="op" id="1722553">)</span>&nbsp;<span class="op" id="1722555">&gt;</span>&nbsp;<span class="op" id="1722557">(</span><span class="ident" id="1722558"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2031855">maxmem</a></span><span class="op" id="1722564">-</span><span class="ident" id="1722565"><a href="/runtime/chan.go.html#1722025">hchanSize</a></span><span class="op" id="1722574">)</span><span class="op" id="1722575">/</span><span class="builtintype" id="1722576">uintptr</span><span class="op" id="1722583">(</span><span class="ident" id="1722584"><a href="/runtime/chan.go.html#1722246">elem</a></span><span class="op" id="1722588">.</span><span class="ident" id="1722589">size</span><span class="op" id="1722593">)</span><span class="op" id="1722594">)</span>&nbsp;<span class="op" id="1722596">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1722600">panic</span><span class="op" id="1722605">(</span><span class="string" id="1722606">&#34;makechan:&nbsp;size&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1722635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1722638">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1722642">var</span>&nbsp;<span class="ident" id="1722646">c</span>&nbsp;<span class="op" id="1722648">*</span><span class="ident" id="1722649"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026588">hchan</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1722656">if</span>&nbsp;<span class="ident" id="1722659"><a href="/runtime/chan.go.html#1722246">elem</a></span><span class="op" id="1722663">.</span><span class="ident" id="1722664">kind</span><span class="op" id="1722668">&amp;</span><span class="ident" id="1722669"><a href="/runtime/typekind.go.html#2015214">kindNoPointers</a></span>&nbsp;<span class="op" id="1722684">!=</span>&nbsp;<span class="num" id="1722687">0</span>&nbsp;<span class="op" id="1722689">||</span>&nbsp;<span class="ident" id="1722692"><a href="/runtime/chan.go.html#1722224">size</a></span>&nbsp;<span class="op" id="1722697">==</span>&nbsp;<span class="num" id="1722700">0</span>&nbsp;<span class="op" id="1722702">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1722706">//&nbsp;Allocate&nbsp;memory&nbsp;in&nbsp;one&nbsp;call.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1722740">//&nbsp;Hchan&nbsp;does&nbsp;not&nbsp;contain&nbsp;pointers&nbsp;interesting&nbsp;for&nbsp;GC&nbsp;in&nbsp;this&nbsp;case:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1722810">//&nbsp;buf&nbsp;points&nbsp;into&nbsp;the&nbsp;same&nbsp;allocation,&nbsp;elemtype&nbsp;is&nbsp;persistent.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1722876">//&nbsp;SudoG&#39;s&nbsp;are&nbsp;referenced&nbsp;from&nbsp;their&nbsp;owning&nbsp;thread&nbsp;so&nbsp;they&nbsp;can&#39;t&nbsp;be&nbsp;collected.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1722957">//&nbsp;TODO(dvyukov,rlh):&nbsp;Rethink&nbsp;when&nbsp;collector&nbsp;can&nbsp;move&nbsp;allocated&nbsp;objects.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1723032"><a href="/runtime/chan.go.html#1722646">c</a></span>&nbsp;<span class="op" id="1723034">=</span>&nbsp;<span class="op" id="1723036">(</span><span class="op" id="1723037">*</span><span class="ident" id="1723038"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026588">hchan</a></span><span class="op" id="1723043">)</span><span class="op" id="1723044">(</span><span class="ident" id="1723045"><a href="/runtime/malloc.go.html#1819594">mallocgc</a></span><span class="op" id="1723053">(</span><span class="ident" id="1723054"><a href="/runtime/chan.go.html#1722025">hchanSize</a></span><span class="op" id="1723063">+</span><span class="builtintype" id="1723064">uintptr</span><span class="op" id="1723071">(</span><span class="ident" id="1723072"><a href="/runtime/chan.go.html#1722224">size</a></span><span class="op" id="1723076">)</span><span class="op" id="1723077">*</span><span class="builtintype" id="1723078">uintptr</span><span class="op" id="1723085">(</span><span class="ident" id="1723086"><a href="/runtime/chan.go.html#1722246">elem</a></span><span class="op" id="1723090">.</span><span class="ident" id="1723091">size</span><span class="op" id="1723095">)</span><span class="op" id="1723096">,</span>&nbsp;<span class="ident" id="1723098">nil</span><span class="op" id="1723101">,</span>&nbsp;<span class="ident" id="1723103"><a href="/runtime/malloc.go.html#1818822">flagNoScan</a></span><span class="op" id="1723113">)</span><span class="op" id="1723114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1723118">if</span>&nbsp;<span class="ident" id="1723121"><a href="/runtime/chan.go.html#1722224">size</a></span>&nbsp;<span class="op" id="1723126">&gt;</span>&nbsp;<span class="num" id="1723128">0</span>&nbsp;<span class="op" id="1723130">&amp;&amp;</span>&nbsp;<span class="ident" id="1723133"><a href="/runtime/chan.go.html#1722246">elem</a></span><span class="op" id="1723137">.</span><span class="ident" id="1723138">size</span>&nbsp;<span class="op" id="1723143">!=</span>&nbsp;<span class="num" id="1723146">0</span>&nbsp;<span class="op" id="1723148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1723153"><a href="/runtime/chan.go.html#1722646">c</a></span><span class="op" id="1723154">.</span><span class="ident" id="1723155">buf</span>&nbsp;<span class="op" id="1723159">=</span>&nbsp;<span class="op" id="1723161">(</span><span class="op" id="1723162">*</span><span class="builtintype" id="1723163">uint8</span><span class="op" id="1723168">)</span><span class="op" id="1723169">(</span><span class="ident" id="1723170"><a href="/runtime/stubs.go.html#1968610">add</a></span><span class="op" id="1723173">(</span><span class="ident" id="1723174"><a href="/runtime/chan.go.html#1721991">unsafe</a></span><span class="op" id="1723180">.</span><span class="ident" id="1723181">Pointer</span><span class="op" id="1723188">(</span><span class="ident" id="1723189"><a href="/runtime/chan.go.html#1722646">c</a></span><span class="op" id="1723190">)</span><span class="op" id="1723191">,</span>&nbsp;<span class="ident" id="1723193"><a href="/runtime/chan.go.html#1722025">hchanSize</a></span><span class="op" id="1723202">)</span><span class="op" id="1723203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1723207">}</span>&nbsp;<span class="keyword" id="1723209">else</span>&nbsp;<span class="op" id="1723214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1723219"><a href="/runtime/chan.go.html#1722646">c</a></span><span class="op" id="1723220">.</span><span class="ident" id="1723221">buf</span>&nbsp;<span class="op" id="1723225">=</span>&nbsp;<span class="op" id="1723227">(</span><span class="op" id="1723228">*</span><span class="builtintype" id="1723229">uint8</span><span class="op" id="1723234">)</span><span class="op" id="1723235">(</span><span class="ident" id="1723236"><a href="/runtime/chan.go.html#1721991">unsafe</a></span><span class="op" id="1723242">.</span><span class="ident" id="1723243">Pointer</span><span class="op" id="1723250">(</span><span class="ident" id="1723251"><a href="/runtime/chan.go.html#1722646">c</a></span><span class="op" id="1723252">)</span><span class="op" id="1723253">)</span>&nbsp;<span class="comment" id="1723255">//&nbsp;race&nbsp;detector&nbsp;uses&nbsp;this&nbsp;location&nbsp;for&nbsp;synchronization</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1723313">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1723316">}</span>&nbsp;<span class="keyword" id="1723318">else</span>&nbsp;<span class="op" id="1723323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1723327"><a href="/runtime/chan.go.html#1722646">c</a></span>&nbsp;<span class="op" id="1723329">=</span>&nbsp;<span class="builtinfunc" id="1723331">new</span><span class="op" id="1723334">(</span><span class="ident" id="1723335"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026588">hchan</a></span><span class="op" id="1723340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1723344"><a href="/runtime/chan.go.html#1722646">c</a></span><span class="op" id="1723345">.</span><span class="ident" id="1723346">buf</span>&nbsp;<span class="op" id="1723350">=</span>&nbsp;<span class="op" id="1723352">(</span><span class="op" id="1723353">*</span><span class="builtintype" id="1723354">uint8</span><span class="op" id="1723359">)</span><span class="op" id="1723360">(</span><span class="ident" id="1723361"><a href="/runtime/malloc.go.html#1828735">newarray</a></span><span class="op" id="1723369">(</span><span class="ident" id="1723370"><a href="/runtime/chan.go.html#1722246">elem</a></span><span class="op" id="1723374">,</span>&nbsp;<span class="builtintype" id="1723376">uintptr</span><span class="op" id="1723383">(</span><span class="ident" id="1723384"><a href="/runtime/chan.go.html#1722224">size</a></span><span class="op" id="1723388">)</span><span class="op" id="1723389">)</span><span class="op" id="1723390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1723393">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1723396"><a href="/runtime/chan.go.html#1722646">c</a></span><span class="op" id="1723397">.</span><span class="ident" id="1723398">elemsize</span>&nbsp;<span class="op" id="1723407">=</span>&nbsp;<span class="builtintype" id="1723409">uint16</span><span class="op" id="1723415">(</span><span class="ident" id="1723416"><a href="/runtime/chan.go.html#1722246">elem</a></span><span class="op" id="1723420">.</span><span class="ident" id="1723421">size</span><span class="op" id="1723425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1723428"><a href="/runtime/chan.go.html#1722646">c</a></span><span class="op" id="1723429">.</span><span class="ident" id="1723430">elemtype</span>&nbsp;<span class="op" id="1723439">=</span>&nbsp;<span class="ident" id="1723441"><a href="/runtime/chan.go.html#1722246">elem</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1723447"><a href="/runtime/chan.go.html#1722646">c</a></span><span class="op" id="1723448">.</span><span class="ident" id="1723449">dataqsiz</span>&nbsp;<span class="op" id="1723458">=</span>&nbsp;<span class="builtintype" id="1723460">uint</span><span class="op" id="1723464">(</span><span class="ident" id="1723465"><a href="/runtime/chan.go.html#1722224">size</a></span><span class="op" id="1723469">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1723473">if</span>&nbsp;<span class="ident" id="1723476"><a href="/runtime/chan.go.html#1722114">debugChan</a></span>&nbsp;<span class="op" id="1723486">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1723490">print</span><span class="op" id="1723495">(</span><span class="string" id="1723496">&#34;makechan:&nbsp;chan=&#34;</span><span class="op" id="1723513">,</span>&nbsp;<span class="ident" id="1723515"><a href="/runtime/chan.go.html#1722646">c</a></span><span class="op" id="1723516">,</span>&nbsp;<span class="string" id="1723518">&#34;;&nbsp;elemsize=&#34;</span><span class="op" id="1723531">,</span>&nbsp;<span class="ident" id="1723533"><a href="/runtime/chan.go.html#1722246">elem</a></span><span class="op" id="1723537">.</span><span class="ident" id="1723538">size</span><span class="op" id="1723542">,</span>&nbsp;<span class="string" id="1723544">&#34;;&nbsp;elemalg=&#34;</span><span class="op" id="1723556">,</span>&nbsp;<span class="ident" id="1723558"><a href="/runtime/chan.go.html#1722246">elem</a></span><span class="op" id="1723562">.</span><span class="ident" id="1723563">alg</span><span class="op" id="1723566">,</span>&nbsp;<span class="string" id="1723568">&#34;;&nbsp;dataqsiz=&#34;</span><span class="op" id="1723581">,</span>&nbsp;<span class="ident" id="1723583"><a href="/runtime/chan.go.html#1722224">size</a></span><span class="op" id="1723587">,</span>&nbsp;<span class="string" id="1723589">&#34;\n&#34;</span><span class="op" id="1723593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1723596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1723599">return</span>&nbsp;<span class="ident" id="1723606"><a href="/runtime/chan.go.html#1722646">c</a></span><br>
<span class="lineno"></span><span class="op" id="1723608">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="1723611">//&nbsp;chanbuf(c,&nbsp;i)&nbsp;is&nbsp;pointer&nbsp;to&nbsp;the&nbsp;i&#39;th&nbsp;slot&nbsp;in&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="1723671">func</span>&nbsp;<span class="ident" id="1723676">chanbuf</span><span class="op" id="1723683">(</span><span class="ident" id="1723684">c</span>&nbsp;<span class="op" id="1723686">*</span><span class="ident" id="1723687"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026588">hchan</a></span><span class="op" id="1723692">,</span>&nbsp;<span class="ident" id="1723694">i</span>&nbsp;<span class="builtintype" id="1723696">uint</span><span class="op" id="1723700">)</span>&nbsp;<span class="ident" id="1723702"><a href="/runtime/chan.go.html#1721991">unsafe</a></span><span class="op" id="1723708">.</span><span class="ident" id="1723709">Pointer</span>&nbsp;<span class="op" id="1723717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1723720">return</span>&nbsp;<span class="ident" id="1723727"><a href="/runtime/stubs.go.html#1968610">add</a></span><span class="op" id="1723730">(</span><span class="ident" id="1723731"><a href="/runtime/chan.go.html#1721991">unsafe</a></span><span class="op" id="1723737">.</span><span class="ident" id="1723738">Pointer</span><span class="op" id="1723745">(</span><span class="ident" id="1723746"><a href="/runtime/chan.go.html#1723684">c</a></span><span class="op" id="1723747">.</span><span class="ident" id="1723748">buf</span><span class="op" id="1723751">)</span><span class="op" id="1723752">,</span>&nbsp;<span class="builtintype" id="1723754">uintptr</span><span class="op" id="1723761">(</span><span class="ident" id="1723762"><a href="/runtime/chan.go.html#1723694">i</a></span><span class="op" id="1723763">)</span><span class="op" id="1723764">*</span><span class="builtintype" id="1723765">uintptr</span><span class="op" id="1723772">(</span><span class="ident" id="1723773"><a href="/runtime/chan.go.html#1723684">c</a></span><span class="op" id="1723774">.</span><span class="ident" id="1723775">elemsize</span><span class="op" id="1723783">)</span><span class="op" id="1723784">)</span><br>
<span class="lineno"></span><span class="op" id="1723786">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="1723789">//&nbsp;entry&nbsp;point&nbsp;for&nbsp;c&nbsp;&lt;-&nbsp;x&nbsp;from&nbsp;compiled&nbsp;code</span><br>
<span class="lineno"></span><span class="comment" id="1723834">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1723847">func</span>&nbsp;<span class="ident" id="1723852">chansend1</span><span class="op" id="1723861">(</span><span class="ident" id="1723862">t</span>&nbsp;<span class="op" id="1723864">*</span><span class="ident" id="1723865"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026299">chantype</a></span><span class="op" id="1723873">,</span>&nbsp;<span class="ident" id="1723875">c</span>&nbsp;<span class="op" id="1723877">*</span><span class="ident" id="1723878"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026588">hchan</a></span><span class="op" id="1723883">,</span>&nbsp;<span class="ident" id="1723885">elem</span>&nbsp;<span class="ident" id="1723890"><a href="/runtime/chan.go.html#1721991">unsafe</a></span><span class="op" id="1723896">.</span><span class="ident" id="1723897">Pointer</span><span class="op" id="1723904">)</span>&nbsp;<span class="op" id="1723906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1723909"><a href="/runtime/chan.go.html#1724311">chansend</a></span><span class="op" id="1723917">(</span><span class="ident" id="1723918"><a href="/runtime/chan.go.html#1723862">t</a></span><span class="op" id="1723919">,</span>&nbsp;<span class="ident" id="1723921"><a href="/runtime/chan.go.html#1723875">c</a></span><span class="op" id="1723922">,</span>&nbsp;<span class="ident" id="1723924"><a href="/runtime/chan.go.html#1723885">elem</a></span><span class="op" id="1723928">,</span>&nbsp;<span class="ident" id="1723930">true</span><span class="op" id="1723934">,</span>&nbsp;<span class="ident" id="1723936"><a href="/runtime/stubs.go.html#1976364">getcallerpc</a></span><span class="op" id="1723947">(</span><span class="ident" id="1723948"><a href="/runtime/chan.go.html#1721991">unsafe</a></span><span class="op" id="1723954">.</span><span class="ident" id="1723955">Pointer</span><span class="op" id="1723962">(</span><span class="op" id="1723963">&amp;</span><span class="ident" id="1723964"><a href="/runtime/chan.go.html#1723862">t</a></span><span class="op" id="1723965">)</span><span class="op" id="1723966">)</span><span class="op" id="1723967">)</span><br>
<span class="lineno"></span><span class="op" id="1723969">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="1723972">/*<br>
<span class="lineno"></span>&nbsp;*&nbsp;generic&nbsp;single&nbsp;channel&nbsp;send/recv<br>
<span class="lineno"></span>&nbsp;*&nbsp;If&nbsp;block&nbsp;is&nbsp;not&nbsp;nil,<br>
<span class="lineno"></span>&nbsp;*&nbsp;then&nbsp;the&nbsp;protocol&nbsp;will&nbsp;not<br>
<span class="lineno">75</span>&nbsp;*&nbsp;sleep&nbsp;but&nbsp;return&nbsp;if&nbsp;it&nbsp;could<br>
<span class="lineno"></span>&nbsp;*&nbsp;not&nbsp;complete.<br>
<span class="lineno"></span>&nbsp;*<br>
<span class="lineno"></span>&nbsp;*&nbsp;sleep&nbsp;can&nbsp;wake&nbsp;up&nbsp;with&nbsp;g.param&nbsp;==&nbsp;nil<br>
<span class="lineno"></span>&nbsp;*&nbsp;when&nbsp;a&nbsp;channel&nbsp;involved&nbsp;in&nbsp;the&nbsp;sleep&nbsp;has<br>
<span class="lineno">80</span>&nbsp;*&nbsp;been&nbsp;closed.&nbsp;&nbsp;it&nbsp;is&nbsp;easiest&nbsp;to&nbsp;loop&nbsp;and&nbsp;re-run<br>
<span class="lineno"></span>&nbsp;*&nbsp;the&nbsp;operation;&nbsp;we&#39;ll&nbsp;see&nbsp;that&nbsp;it&#39;s&nbsp;now&nbsp;closed.<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><span class="keyword" id="1724306">func</span>&nbsp;<span class="ident" id="1724311">chansend</span><span class="op" id="1724319">(</span><span class="ident" id="1724320">t</span>&nbsp;<span class="op" id="1724322">*</span><span class="ident" id="1724323"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026299">chantype</a></span><span class="op" id="1724331">,</span>&nbsp;<span class="ident" id="1724333">c</span>&nbsp;<span class="op" id="1724335">*</span><span class="ident" id="1724336"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026588">hchan</a></span><span class="op" id="1724341">,</span>&nbsp;<span class="ident" id="1724343">ep</span>&nbsp;<span class="ident" id="1724346"><a href="/runtime/chan.go.html#1721991">unsafe</a></span><span class="op" id="1724352">.</span><span class="ident" id="1724353">Pointer</span><span class="op" id="1724360">,</span>&nbsp;<span class="ident" id="1724362">block</span>&nbsp;<span class="builtintype" id="1724368">bool</span><span class="op" id="1724372">,</span>&nbsp;<span class="ident" id="1724374">callerpc</span>&nbsp;<span class="builtintype" id="1724383">uintptr</span><span class="op" id="1724390">)</span>&nbsp;<span class="builtintype" id="1724392">bool</span>&nbsp;<span class="op" id="1724397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1724400">if</span>&nbsp;<span class="ident" id="1724403"><a href="/runtime/race0.go.html#1906481">raceenabled</a></span>&nbsp;<span class="op" id="1724415">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1724419"><a href="/runtime/race0.go.html#1906583">raceReadObjectPC</a></span><span class="op" id="1724435">(</span><span class="ident" id="1724436"><a href="/runtime/chan.go.html#1724320">t</a></span><span class="op" id="1724437">.</span><span class="ident" id="1724438">elem</span><span class="op" id="1724442">,</span>&nbsp;<span class="ident" id="1724444"><a href="/runtime/chan.go.html#1724343">ep</a></span><span class="op" id="1724446">,</span>&nbsp;<span class="ident" id="1724448"><a href="/runtime/chan.go.html#1724374">callerpc</a></span><span class="op" id="1724456">,</span>&nbsp;<span class="ident" id="1724458"><a href="/runtime/proc.go.html#1905425">funcPC</a></span><span class="op" id="1724464">(</span><span class="ident" id="1724465"><a href="/runtime/chan.go.html#1724311">chansend</a></span><span class="op" id="1724473">)</span><span class="op" id="1724474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1724477">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1724481">if</span>&nbsp;<span class="ident" id="1724484"><a href="/runtime/chan.go.html#1724333">c</a></span>&nbsp;<span class="op" id="1724486">==</span>&nbsp;<span class="ident" id="1724489">nil</span>&nbsp;<span class="op" id="1724493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1724497">if</span>&nbsp;<span class="op" id="1724500">!</span><span class="ident" id="1724501"><a href="/runtime/chan.go.html#1724362">block</a></span>&nbsp;<span class="op" id="1724507">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1724512">return</span>&nbsp;<span class="ident" id="1724519">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1724527">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1724531"><a href="/runtime/proc.go.html#1903238">gopark</a></span><span class="op" id="1724537">(</span><span class="ident" id="1724538">nil</span><span class="op" id="1724541">,</span>&nbsp;<span class="ident" id="1724543">nil</span><span class="op" id="1724546">,</span>&nbsp;<span class="string" id="1724548">&#34;chan&nbsp;send&nbsp;(nil&nbsp;chan)&#34;</span><span class="op" id="1724570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1724574"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1724581">(</span><span class="string" id="1724582">&#34;unreachable&#34;</span><span class="op" id="1724595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1724598">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1724602">if</span>&nbsp;<span class="ident" id="1724605"><a href="/runtime/chan.go.html#1722114">debugChan</a></span>&nbsp;<span class="op" id="1724615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1724619">print</span><span class="op" id="1724624">(</span><span class="string" id="1724625">&#34;chansend:&nbsp;chan=&#34;</span><span class="op" id="1724642">,</span>&nbsp;<span class="ident" id="1724644"><a href="/runtime/chan.go.html#1724333">c</a></span><span class="op" id="1724645">,</span>&nbsp;<span class="string" id="1724647">&#34;\n&#34;</span><span class="op" id="1724651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1724654">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1724658">if</span>&nbsp;<span class="ident" id="1724661"><a href="/runtime/race0.go.html#1906481">raceenabled</a></span>&nbsp;<span class="op" id="1724673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1724677"><a href="/runtime/race0.go.html#1907159">racereadpc</a></span><span class="op" id="1724687">(</span><span class="ident" id="1724688"><a href="/runtime/chan.go.html#1721991">unsafe</a></span><span class="op" id="1724694">.</span><span class="ident" id="1724695">Pointer</span><span class="op" id="1724702">(</span><span class="ident" id="1724703"><a href="/runtime/chan.go.html#1724333">c</a></span><span class="op" id="1724704">)</span><span class="op" id="1724705">,</span>&nbsp;<span class="ident" id="1724707"><a href="/runtime/chan.go.html#1724374">callerpc</a></span><span class="op" id="1724715">,</span>&nbsp;<span class="ident" id="1724717"><a href="/runtime/proc.go.html#1905425">funcPC</a></span><span class="op" id="1724723">(</span><span class="ident" id="1724724"><a href="/runtime/chan.go.html#1724311">chansend</a></span><span class="op" id="1724732">)</span><span class="op" id="1724733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1724736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1724740">//&nbsp;Fast&nbsp;path:&nbsp;check&nbsp;for&nbsp;failed&nbsp;non-blocking&nbsp;operation&nbsp;without&nbsp;acquiring&nbsp;the&nbsp;lock.</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1724823">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1724827">//&nbsp;After&nbsp;observing&nbsp;that&nbsp;the&nbsp;channel&nbsp;is&nbsp;not&nbsp;closed,&nbsp;we&nbsp;observe&nbsp;that&nbsp;the&nbsp;channel&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1724910">//&nbsp;not&nbsp;ready&nbsp;for&nbsp;sending.&nbsp;Each&nbsp;of&nbsp;these&nbsp;observations&nbsp;is&nbsp;a&nbsp;single&nbsp;word-sized&nbsp;read</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1724992">//&nbsp;(first&nbsp;c.closed&nbsp;and&nbsp;second&nbsp;c.recvq.first&nbsp;or&nbsp;c.qcount&nbsp;depending&nbsp;on&nbsp;kind&nbsp;of&nbsp;channel).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1725080">//&nbsp;Because&nbsp;a&nbsp;closed&nbsp;channel&nbsp;cannot&nbsp;transition&nbsp;from&nbsp;&#39;ready&nbsp;for&nbsp;sending&#39;&nbsp;to</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1725155">//&nbsp;&#39;not&nbsp;ready&nbsp;for&nbsp;sending&#39;,&nbsp;even&nbsp;if&nbsp;the&nbsp;channel&nbsp;is&nbsp;closed&nbsp;between&nbsp;the&nbsp;two&nbsp;observations,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1725244">//&nbsp;they&nbsp;imply&nbsp;a&nbsp;moment&nbsp;between&nbsp;the&nbsp;two&nbsp;when&nbsp;the&nbsp;channel&nbsp;was&nbsp;both&nbsp;not&nbsp;yet&nbsp;closed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1725325">//&nbsp;and&nbsp;not&nbsp;ready&nbsp;for&nbsp;sending.&nbsp;We&nbsp;behave&nbsp;as&nbsp;if&nbsp;we&nbsp;observed&nbsp;the&nbsp;channel&nbsp;at&nbsp;that&nbsp;moment,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1725412">//&nbsp;and&nbsp;report&nbsp;that&nbsp;the&nbsp;send&nbsp;cannot&nbsp;proceed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1725457">//</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1725461">//&nbsp;It&nbsp;is&nbsp;okay&nbsp;if&nbsp;the&nbsp;reads&nbsp;are&nbsp;reordered&nbsp;here:&nbsp;if&nbsp;we&nbsp;observe&nbsp;that&nbsp;the&nbsp;channel&nbsp;is&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1725547">//&nbsp;ready&nbsp;for&nbsp;sending&nbsp;and&nbsp;then&nbsp;observe&nbsp;that&nbsp;it&nbsp;is&nbsp;not&nbsp;closed,&nbsp;that&nbsp;implies&nbsp;that&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1725631">//&nbsp;channel&nbsp;wasn&#39;t&nbsp;closed&nbsp;during&nbsp;the&nbsp;first&nbsp;observation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1725687">if</span>&nbsp;<span class="op" id="1725690">!</span><span class="ident" id="1725691"><a href="/runtime/chan.go.html#1724362">block</a></span>&nbsp;<span class="op" id="1725697">&amp;&amp;</span>&nbsp;<span class="ident" id="1725700"><a href="/runtime/chan.go.html#1724333">c</a></span><span class="op" id="1725701">.</span><span class="ident" id="1725702">closed</span>&nbsp;<span class="op" id="1725709">==</span>&nbsp;<span class="num" id="1725712">0</span>&nbsp;<span class="op" id="1725714">&amp;&amp;</span>&nbsp;<span class="op" id="1725717">(</span><span class="op" id="1725718">(</span><span class="ident" id="1725719"><a href="/runtime/chan.go.html#1724333">c</a></span><span class="op" id="1725720">.</span><span class="ident" id="1725721">dataqsiz</span>&nbsp;<span class="op" id="1725730">==</span>&nbsp;<span class="num" id="1725733">0</span>&nbsp;<span class="op" id="1725735">&amp;&amp;</span>&nbsp;<span class="ident" id="1725738"><a href="/runtime/chan.go.html#1724333">c</a></span><span class="op" id="1725739">.</span><span class="ident" id="1725740">recvq</span><span class="op" id="1725745">.</span><span class="ident" id="1725746">first</span>&nbsp;<span class="op" id="1725752">==</span>&nbsp;<span class="ident" id="1725755">nil</span><span class="op" id="1725758">)</span>&nbsp;<span class="op" id="1725760">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1725765">(</span><span class="ident" id="1725766"><a href="/runtime/chan.go.html#1724333">c</a></span><span class="op" id="1725767">.</span><span class="ident" id="1725768">dataqsiz</span>&nbsp;<span class="op" id="1725777">&gt;</span>&nbsp;<span class="num" id="1725779">0</span>&nbsp;<span class="op" id="1725781">&amp;&amp;</span>&nbsp;<span class="ident" id="1725784"><a href="/runtime/chan.go.html#1724333">c</a></span><span class="op" id="1725785">.</span><span class="ident" id="1725786">qcount</span>&nbsp;<span class="op" id="1725793">==</span>&nbsp;<span class="ident" id="1725796"><a href="/runtime/chan.go.html#1724333">c</a></span><span class="op" id="1725797">.</span><span class="ident" id="1725798">dataqsiz</span><span class="op" id="1725806">)</span><span class="op" id="1725807">)</span>&nbsp;<span class="op" id="1725809">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1725813">return</span>&nbsp;<span class="ident" id="1725820">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1725827">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1725831">var</span>&nbsp;<span class="ident" id="1725835">t0</span>&nbsp;<span class="ident" id="1725838">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1725845">if</span>&nbsp;<span class="ident" id="1725848"><a href="/runtime/mprof.go.html#1856178">blockprofilerate</a></span>&nbsp;<span class="op" id="1725865">&gt;</span>&nbsp;<span class="num" id="1725867">0</span>&nbsp;<span class="op" id="1725869">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1725873"><a href="/runtime/chan.go.html#1725835">t0</a></span>&nbsp;<span class="op" id="1725876">=</span>&nbsp;<span class="ident" id="1725878"><a href="/runtime/stubs.go.html#1974111">cputicks</a></span><span class="op" id="1725886">(</span><span class="op" id="1725887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1725890">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1725894"><a href="/runtime/lock_futex.go.html#1815304">lock</a></span><span class="op" id="1725898">(</span><span class="op" id="1725899">&amp;</span><span class="ident" id="1725900"><a href="/runtime/chan.go.html#1724333">c</a></span><span class="op" id="1725901">.</span><span class="ident" id="1725902">lock</span><span class="op" id="1725906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1725909">if</span>&nbsp;<span class="ident" id="1725912"><a href="/runtime/chan.go.html#1724333">c</a></span><span class="op" id="1725913">.</span><span class="ident" id="1725914">closed</span>&nbsp;<span class="op" id="1725921">!=</span>&nbsp;<span class="num" id="1725924">0</span>&nbsp;<span class="op" id="1725926">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1725930"><a href="/runtime/lock_futex.go.html#1816596">unlock</a></span><span class="op" id="1725936">(</span><span class="op" id="1725937">&amp;</span><span class="ident" id="1725938"><a href="/runtime/chan.go.html#1724333">c</a></span><span class="op" id="1725939">.</span><span class="ident" id="1725940">lock</span><span class="op" id="1725944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1725948">panic</span><span class="op" id="1725953">(</span><span class="string" id="1725954">&#34;send&nbsp;on&nbsp;closed&nbsp;channel&#34;</span><span class="op" id="1725978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1725981">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1725985">if</span>&nbsp;<span class="ident" id="1725988"><a href="/runtime/chan.go.html#1724333">c</a></span><span class="op" id="1725989">.</span><span class="ident" id="1725990">dataqsiz</span>&nbsp;<span class="op" id="1725999">==</span>&nbsp;<span class="num" id="1726002">0</span>&nbsp;<span class="op" id="1726004">{</span>&nbsp;<span class="comment" id="1726006">//&nbsp;synchronous&nbsp;channel</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1726031">sg</span>&nbsp;<span class="op" id="1726034">:=</span>&nbsp;<span class="ident" id="1726037"><a href="/runtime/chan.go.html#1724333">c</a></span><span class="op" id="1726038">.</span><span class="ident" id="1726039">recvq</span><span class="op" id="1726044">.</span><span class="ident" id="1726045">dequeue</span><span class="op" id="1726052">(</span><span class="op" id="1726053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1726057">if</span>&nbsp;<span class="ident" id="1726060"><a href="/runtime/chan.go.html#1726031">sg</a></span>&nbsp;<span class="op" id="1726063">!=</span>&nbsp;<span class="ident" id="1726066">nil</span>&nbsp;<span class="op" id="1726070">{</span>&nbsp;<span class="comment" id="1726072">//&nbsp;found&nbsp;a&nbsp;waiting&nbsp;receiver</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1726103">if</span>&nbsp;<span class="ident" id="1726106"><a href="/runtime/race0.go.html#1906481">raceenabled</a></span>&nbsp;<span class="op" id="1726118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1726124"><a href="/runtime/chan.go.html#1736215">racesync</a></span><span class="op" id="1726132">(</span><span class="ident" id="1726133"><a href="/runtime/chan.go.html#1724333">c</a></span><span class="op" id="1726134">,</span>&nbsp;<span class="ident" id="1726136"><a href="/runtime/chan.go.html#1726031">sg</a></span><span class="op" id="1726138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1726143">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1726148"><a href="/runtime/lock_futex.go.html#1816596">unlock</a></span><span class="op" id="1726154">(</span><span class="op" id="1726155">&amp;</span><span class="ident" id="1726156"><a href="/runtime/chan.go.html#1724333">c</a></span><span class="op" id="1726157">.</span><span class="ident" id="1726158">lock</span><span class="op" id="1726162">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1726168">recvg</span>&nbsp;<span class="op" id="1726174">:=</span>&nbsp;<span class="ident" id="1726177"><a href="/runtime/chan.go.html#1726031">sg</a></span><span class="op" id="1726179">.</span><span class="ident" id="1726180">g</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1726185">if</span>&nbsp;<span class="ident" id="1726188"><a href="/runtime/chan.go.html#1726031">sg</a></span><span class="op" id="1726190">.</span><span class="ident" id="1726191">elem</span>&nbsp;<span class="op" id="1726196">!=</span>&nbsp;<span class="ident" id="1726199">nil</span>&nbsp;<span class="op" id="1726203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1726209"><a href="/runtime/stubs.go.html#1972675">memmove</a></span><span class="op" id="1726216">(</span><span class="ident" id="1726217"><a href="/runtime/chan.go.html#1721991">unsafe</a></span><span class="op" id="1726223">.</span><span class="ident" id="1726224">Pointer</span><span class="op" id="1726231">(</span><span class="ident" id="1726232"><a href="/runtime/chan.go.html#1726031">sg</a></span><span class="op" id="1726234">.</span><span class="ident" id="1726235">elem</span><span class="op" id="1726239">)</span><span class="op" id="1726240">,</span>&nbsp;<span class="ident" id="1726242"><a href="/runtime/chan.go.html#1724343">ep</a></span><span class="op" id="1726244">,</span>&nbsp;<span class="builtintype" id="1726246">uintptr</span><span class="op" id="1726253">(</span><span class="ident" id="1726254"><a href="/runtime/chan.go.html#1724333">c</a></span><span class="op" id="1726255">.</span><span class="ident" id="1726256">elemsize</span><span class="op" id="1726264">)</span><span class="op" id="1726265">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1726271"><a href="/runtime/chan.go.html#1726031">sg</a></span><span class="op" id="1726273">.</span><span class="ident" id="1726274">elem</span>&nbsp;<span class="op" id="1726279">=</span>&nbsp;<span class="ident" id="1726281">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1726288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1726293"><a href="/runtime/chan.go.html#1726168">recvg</a></span><span class="op" id="1726298">.</span><span class="ident" id="1726299">param</span>&nbsp;<span class="op" id="1726305">=</span>&nbsp;<span class="ident" id="1726307"><a href="/runtime/chan.go.html#1721991">unsafe</a></span><span class="op" id="1726313">.</span><span class="ident" id="1726314">Pointer</span><span class="op" id="1726321">(</span><span class="ident" id="1726322"><a href="/runtime/chan.go.html#1726031">sg</a></span><span class="op" id="1726324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1726329">if</span>&nbsp;<span class="ident" id="1726332"><a href="/runtime/chan.go.html#1726031">sg</a></span><span class="op" id="1726334">.</span><span class="ident" id="1726335">releasetime</span>&nbsp;<span class="op" id="1726347">!=</span>&nbsp;<span class="num" id="1726350">0</span>&nbsp;<span class="op" id="1726352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1726358"><a href="/runtime/chan.go.html#1726031">sg</a></span><span class="op" id="1726360">.</span><span class="ident" id="1726361">releasetime</span>&nbsp;<span class="op" id="1726373">=</span>&nbsp;<span class="ident" id="1726375"><a href="/runtime/stubs.go.html#1974111">cputicks</a></span><span class="op" id="1726383">(</span><span class="op" id="1726384">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1726389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1726394"><a href="/runtime/proc.go.html#1903886">goready</a></span><span class="op" id="1726401">(</span><span class="ident" id="1726402"><a href="/runtime/chan.go.html#1726168">recvg</a></span><span class="op" id="1726407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1726412">return</span>&nbsp;<span class="ident" id="1726419">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1726426">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1726431">if</span>&nbsp;<span class="op" id="1726434">!</span><span class="ident" id="1726435"><a href="/runtime/chan.go.html#1724362">block</a></span>&nbsp;<span class="op" id="1726441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1726446"><a href="/runtime/lock_futex.go.html#1816596">unlock</a></span><span class="op" id="1726452">(</span><span class="op" id="1726453">&amp;</span><span class="ident" id="1726454"><a href="/runtime/chan.go.html#1724333">c</a></span><span class="op" id="1726455">.</span><span class="ident" id="1726456">lock</span><span class="op" id="1726460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1726465">return</span>&nbsp;<span class="ident" id="1726472">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1726480">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1726485">//&nbsp;no&nbsp;receiver&nbsp;available:&nbsp;block&nbsp;on&nbsp;this&nbsp;channel.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1726536">gp</span>&nbsp;<span class="op" id="1726539">:=</span>&nbsp;<span class="ident" id="1726542"><a href="/runtime/stubs.go.html#1968886">getg</a></span><span class="op" id="1726546">(</span><span class="op" id="1726547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1726551">mysg</span>&nbsp;<span class="op" id="1726556">:=</span>&nbsp;<span class="ident" id="1726559"><a href="/runtime/proc.go.html#1904005">acquireSudog</a></span><span class="op" id="1726571">(</span><span class="op" id="1726572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1726576"><a href="/runtime/chan.go.html#1726551">mysg</a></span><span class="op" id="1726580">.</span><span class="ident" id="1726581">releasetime</span>&nbsp;<span class="op" id="1726593">=</span>&nbsp;<span class="num" id="1726595">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1726599">if</span>&nbsp;<span class="ident" id="1726602"><a href="/runtime/chan.go.html#1725835">t0</a></span>&nbsp;<span class="op" id="1726605">!=</span>&nbsp;<span class="num" id="1726608">0</span>&nbsp;<span class="op" id="1726610">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1726615"><a href="/runtime/chan.go.html#1726551">mysg</a></span><span class="op" id="1726619">.</span><span class="ident" id="1726620">releasetime</span>&nbsp;<span class="op" id="1726632">=</span>&nbsp;<span class="op" id="1726634">-</span><span class="num" id="1726635">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1726639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1726643"><a href="/runtime/chan.go.html#1726551">mysg</a></span><span class="op" id="1726647">.</span><span class="ident" id="1726648">elem</span>&nbsp;<span class="op" id="1726653">=</span>&nbsp;<span class="ident" id="1726655"><a href="/runtime/chan.go.html#1724343">ep</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1726660"><a href="/runtime/chan.go.html#1726551">mysg</a></span><span class="op" id="1726664">.</span><span class="ident" id="1726665">waitlink</span>&nbsp;<span class="op" id="1726674">=</span>&nbsp;<span class="ident" id="1726676">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1726682"><a href="/runtime/chan.go.html#1726536">gp</a></span><span class="op" id="1726684">.</span><span class="ident" id="1726685">waiting</span>&nbsp;<span class="op" id="1726693">=</span>&nbsp;<span class="ident" id="1726695"><a href="/runtime/chan.go.html#1726551">mysg</a></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1726702"><a href="/runtime/chan.go.html#1726551">mysg</a></span><span class="op" id="1726706">.</span><span class="ident" id="1726707">g</span>&nbsp;<span class="op" id="1726709">=</span>&nbsp;<span class="ident" id="1726711"><a href="/runtime/chan.go.html#1726536">gp</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1726716"><a href="/runtime/chan.go.html#1726551">mysg</a></span><span class="op" id="1726720">.</span><span class="ident" id="1726721">selectdone</span>&nbsp;<span class="op" id="1726732">=</span>&nbsp;<span class="ident" id="1726734">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1726740"><a href="/runtime/chan.go.html#1726536">gp</a></span><span class="op" id="1726742">.</span><span class="ident" id="1726743">param</span>&nbsp;<span class="op" id="1726749">=</span>&nbsp;<span class="ident" id="1726751">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1726757"><a href="/runtime/chan.go.html#1724333">c</a></span><span class="op" id="1726758">.</span><span class="ident" id="1726759">sendq</span><span class="op" id="1726764">.</span><span class="ident" id="1726765">enqueue</span><span class="op" id="1726772">(</span><span class="ident" id="1726773"><a href="/runtime/chan.go.html#1726551">mysg</a></span><span class="op" id="1726777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1726781"><a href="/runtime/proc.go.html#1903766">goparkunlock</a></span><span class="op" id="1726793">(</span><span class="op" id="1726794">&amp;</span><span class="ident" id="1726795"><a href="/runtime/chan.go.html#1724333">c</a></span><span class="op" id="1726796">.</span><span class="ident" id="1726797">lock</span><span class="op" id="1726801">,</span>&nbsp;<span class="string" id="1726803">&#34;chan&nbsp;send&#34;</span><span class="op" id="1726814">)</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1726819">//&nbsp;someone&nbsp;woke&nbsp;us&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1726844">if</span>&nbsp;<span class="ident" id="1726847"><a href="/runtime/chan.go.html#1726551">mysg</a></span>&nbsp;<span class="op" id="1726852">!=</span>&nbsp;<span class="ident" id="1726855"><a href="/runtime/chan.go.html#1726536">gp</a></span><span class="op" id="1726857">.</span><span class="ident" id="1726858">waiting</span>&nbsp;<span class="op" id="1726866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1726871"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1726878">(</span><span class="string" id="1726879">&#34;G&nbsp;waiting&nbsp;list&nbsp;is&nbsp;corrupted!&#34;</span><span class="op" id="1726909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1726913">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1726917"><a href="/runtime/chan.go.html#1726536">gp</a></span><span class="op" id="1726919">.</span><span class="ident" id="1726920">waiting</span>&nbsp;<span class="op" id="1726928">=</span>&nbsp;<span class="ident" id="1726930">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1726936">if</span>&nbsp;<span class="ident" id="1726939"><a href="/runtime/chan.go.html#1726536">gp</a></span><span class="op" id="1726941">.</span><span class="ident" id="1726942">param</span>&nbsp;<span class="op" id="1726948">==</span>&nbsp;<span class="ident" id="1726951">nil</span>&nbsp;<span class="op" id="1726955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1726960">if</span>&nbsp;<span class="ident" id="1726963"><a href="/runtime/chan.go.html#1724333">c</a></span><span class="op" id="1726964">.</span><span class="ident" id="1726965">closed</span>&nbsp;<span class="op" id="1726972">==</span>&nbsp;<span class="num" id="1726975">0</span>&nbsp;<span class="op" id="1726977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1726983"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1726990">(</span><span class="string" id="1726991">&#34;chansend:&nbsp;spurious&nbsp;wakeup&#34;</span><span class="op" id="1727018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1727023">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1727028">panic</span><span class="op" id="1727033">(</span><span class="string" id="1727034">&#34;send&nbsp;on&nbsp;closed&nbsp;channel&#34;</span><span class="op" id="1727058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1727062">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1727066"><a href="/runtime/chan.go.html#1726536">gp</a></span><span class="op" id="1727068">.</span><span class="ident" id="1727069">param</span>&nbsp;<span class="op" id="1727075">=</span>&nbsp;<span class="ident" id="1727077">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1727083">if</span>&nbsp;<span class="ident" id="1727086"><a href="/runtime/chan.go.html#1726551">mysg</a></span><span class="op" id="1727090">.</span><span class="ident" id="1727091">releasetime</span>&nbsp;<span class="op" id="1727103">&gt;</span>&nbsp;<span class="num" id="1727105">0</span>&nbsp;<span class="op" id="1727107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1727112"><a href="/runtime/mprof.go.html#1856961">blockevent</a></span><span class="op" id="1727122">(</span><span class="ident" id="1727123">int64</span><span class="op" id="1727128">(</span><span class="ident" id="1727129"><a href="/runtime/chan.go.html#1726551">mysg</a></span><span class="op" id="1727133">.</span><span class="ident" id="1727134">releasetime</span><span class="op" id="1727145">)</span><span class="op" id="1727146">-</span><span class="ident" id="1727147"><a href="/runtime/chan.go.html#1725835">t0</a></span><span class="op" id="1727149">,</span>&nbsp;<span class="num" id="1727151">2</span><span class="op" id="1727152">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1727156">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1727160"><a href="/runtime/proc.go.html#1904735">releaseSudog</a></span><span class="op" id="1727172">(</span><span class="ident" id="1727173"><a href="/runtime/chan.go.html#1726551">mysg</a></span><span class="op" id="1727177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1727181">return</span>&nbsp;<span class="ident" id="1727188">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1727194">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1727198">//&nbsp;asynchronous&nbsp;channel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1727223">//&nbsp;wait&nbsp;for&nbsp;some&nbsp;space&nbsp;to&nbsp;write&nbsp;our&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1727265">var</span>&nbsp;<span class="ident" id="1727269">t1</span>&nbsp;<span class="ident" id="1727272">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1727279">for</span>&nbsp;<span class="ident" id="1727283"><a href="/runtime/chan.go.html#1724333">c</a></span><span class="op" id="1727284">.</span><span class="ident" id="1727285">qcount</span>&nbsp;<span class="op" id="1727292">&gt;=</span>&nbsp;<span class="ident" id="1727295"><a href="/runtime/chan.go.html#1724333">c</a></span><span class="op" id="1727296">.</span><span class="ident" id="1727297">dataqsiz</span>&nbsp;<span class="op" id="1727306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1727310">if</span>&nbsp;<span class="op" id="1727313">!</span><span class="ident" id="1727314"><a href="/runtime/chan.go.html#1724362">block</a></span>&nbsp;<span class="op" id="1727320">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1727325"><a href="/runtime/lock_futex.go.html#1816596">unlock</a></span><span class="op" id="1727331">(</span><span class="op" id="1727332">&amp;</span><span class="ident" id="1727333"><a href="/runtime/chan.go.html#1724333">c</a></span><span class="op" id="1727334">.</span><span class="ident" id="1727335">lock</span><span class="op" id="1727339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1727344">return</span>&nbsp;<span class="ident" id="1727351">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1727359">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1727363">gp</span>&nbsp;<span class="op" id="1727366">:=</span>&nbsp;<span class="ident" id="1727369"><a href="/runtime/stubs.go.html#1968886">getg</a></span><span class="op" id="1727373">(</span><span class="op" id="1727374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1727378">mysg</span>&nbsp;<span class="op" id="1727383">:=</span>&nbsp;<span class="ident" id="1727386"><a href="/runtime/proc.go.html#1904005">acquireSudog</a></span><span class="op" id="1727398">(</span><span class="op" id="1727399">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1727403"><a href="/runtime/chan.go.html#1727378">mysg</a></span><span class="op" id="1727407">.</span><span class="ident" id="1727408">releasetime</span>&nbsp;<span class="op" id="1727420">=</span>&nbsp;<span class="num" id="1727422">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1727426">if</span>&nbsp;<span class="ident" id="1727429"><a href="/runtime/chan.go.html#1725835">t0</a></span>&nbsp;<span class="op" id="1727432">!=</span>&nbsp;<span class="num" id="1727435">0</span>&nbsp;<span class="op" id="1727437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1727442"><a href="/runtime/chan.go.html#1727378">mysg</a></span><span class="op" id="1727446">.</span><span class="ident" id="1727447">releasetime</span>&nbsp;<span class="op" id="1727459">=</span>&nbsp;<span class="op" id="1727461">-</span><span class="num" id="1727462">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1727466">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1727470"><a href="/runtime/chan.go.html#1727378">mysg</a></span><span class="op" id="1727474">.</span><span class="ident" id="1727475">g</span>&nbsp;<span class="op" id="1727477">=</span>&nbsp;<span class="ident" id="1727479"><a href="/runtime/chan.go.html#1727363">gp</a></span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1727484"><a href="/runtime/chan.go.html#1727378">mysg</a></span><span class="op" id="1727488">.</span><span class="ident" id="1727489">elem</span>&nbsp;<span class="op" id="1727494">=</span>&nbsp;<span class="ident" id="1727496">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1727502"><a href="/runtime/chan.go.html#1727378">mysg</a></span><span class="op" id="1727506">.</span><span class="ident" id="1727507">selectdone</span>&nbsp;<span class="op" id="1727518">=</span>&nbsp;<span class="ident" id="1727520">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1727526"><a href="/runtime/chan.go.html#1724333">c</a></span><span class="op" id="1727527">.</span><span class="ident" id="1727528">sendq</span><span class="op" id="1727533">.</span><span class="ident" id="1727534">enqueue</span><span class="op" id="1727541">(</span><span class="ident" id="1727542"><a href="/runtime/chan.go.html#1727378">mysg</a></span><span class="op" id="1727546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1727550"><a href="/runtime/proc.go.html#1903766">goparkunlock</a></span><span class="op" id="1727562">(</span><span class="op" id="1727563">&amp;</span><span class="ident" id="1727564"><a href="/runtime/chan.go.html#1724333">c</a></span><span class="op" id="1727565">.</span><span class="ident" id="1727566">lock</span><span class="op" id="1727570">,</span>&nbsp;<span class="string" id="1727572">&#34;chan&nbsp;send&#34;</span><span class="op" id="1727583">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1727588">//&nbsp;someone&nbsp;woke&nbsp;us&nbsp;up&nbsp;-&nbsp;try&nbsp;again</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1727624">if</span>&nbsp;<span class="ident" id="1727627"><a href="/runtime/chan.go.html#1727378">mysg</a></span><span class="op" id="1727631">.</span><span class="ident" id="1727632">releasetime</span>&nbsp;<span class="op" id="1727644">&gt;</span>&nbsp;<span class="num" id="1727646">0</span>&nbsp;<span class="op" id="1727648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1727653"><a href="/runtime/chan.go.html#1727269">t1</a></span>&nbsp;<span class="op" id="1727656">=</span>&nbsp;<span class="ident" id="1727658"><a href="/runtime/chan.go.html#1727378">mysg</a></span><span class="op" id="1727662">.</span><span class="ident" id="1727663">releasetime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1727677">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1727681"><a href="/runtime/proc.go.html#1904735">releaseSudog</a></span><span class="op" id="1727693">(</span><span class="ident" id="1727694"><a href="/runtime/chan.go.html#1727378">mysg</a></span><span class="op" id="1727698">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1727702"><a href="/runtime/lock_futex.go.html#1815304">lock</a></span><span class="op" id="1727706">(</span><span class="op" id="1727707">&amp;</span><span class="ident" id="1727708"><a href="/runtime/chan.go.html#1724333">c</a></span><span class="op" id="1727709">.</span><span class="ident" id="1727710">lock</span><span class="op" id="1727714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1727718">if</span>&nbsp;<span class="ident" id="1727721"><a href="/runtime/chan.go.html#1724333">c</a></span><span class="op" id="1727722">.</span><span class="ident" id="1727723">closed</span>&nbsp;<span class="op" id="1727730">!=</span>&nbsp;<span class="num" id="1727733">0</span>&nbsp;<span class="op" id="1727735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1727740"><a href="/runtime/lock_futex.go.html#1816596">unlock</a></span><span class="op" id="1727746">(</span><span class="op" id="1727747">&amp;</span><span class="ident" id="1727748"><a href="/runtime/chan.go.html#1724333">c</a></span><span class="op" id="1727749">.</span><span class="ident" id="1727750">lock</span><span class="op" id="1727754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1727759">panic</span><span class="op" id="1727764">(</span><span class="string" id="1727765">&#34;send&nbsp;on&nbsp;closed&nbsp;channel&#34;</span><span class="op" id="1727789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1727793">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1727796">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1727800">//&nbsp;write&nbsp;our&nbsp;data&nbsp;into&nbsp;the&nbsp;channel&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1727843">if</span>&nbsp;<span class="ident" id="1727846"><a href="/runtime/race0.go.html#1906481">raceenabled</a></span>&nbsp;<span class="op" id="1727858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1727862"><a href="/runtime/race0.go.html#1907447">raceacquire</a></span><span class="op" id="1727873">(</span><span class="ident" id="1727874"><a href="/runtime/chan.go.html#1723676">chanbuf</a></span><span class="op" id="1727881">(</span><span class="ident" id="1727882"><a href="/runtime/chan.go.html#1724333">c</a></span><span class="op" id="1727883">,</span>&nbsp;<span class="ident" id="1727885"><a href="/runtime/chan.go.html#1724333">c</a></span><span class="op" id="1727886">.</span><span class="ident" id="1727887">sendx</span><span class="op" id="1727892">)</span><span class="op" id="1727893">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1727897"><a href="/runtime/race0.go.html#1907639">racerelease</a></span><span class="op" id="1727908">(</span><span class="ident" id="1727909"><a href="/runtime/chan.go.html#1723676">chanbuf</a></span><span class="op" id="1727916">(</span><span class="ident" id="1727917"><a href="/runtime/chan.go.html#1724333">c</a></span><span class="op" id="1727918">,</span>&nbsp;<span class="ident" id="1727920"><a href="/runtime/chan.go.html#1724333">c</a></span><span class="op" id="1727921">.</span><span class="ident" id="1727922">sendx</span><span class="op" id="1727927">)</span><span class="op" id="1727928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1727931">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1727934"><a href="/runtime/stubs.go.html#1972675">memmove</a></span><span class="op" id="1727941">(</span><span class="ident" id="1727942"><a href="/runtime/chan.go.html#1723676">chanbuf</a></span><span class="op" id="1727949">(</span><span class="ident" id="1727950"><a href="/runtime/chan.go.html#1724333">c</a></span><span class="op" id="1727951">,</span>&nbsp;<span class="ident" id="1727953"><a href="/runtime/chan.go.html#1724333">c</a></span><span class="op" id="1727954">.</span><span class="ident" id="1727955">sendx</span><span class="op" id="1727960">)</span><span class="op" id="1727961">,</span>&nbsp;<span class="ident" id="1727963"><a href="/runtime/chan.go.html#1724343">ep</a></span><span class="op" id="1727965">,</span>&nbsp;<span class="builtintype" id="1727967">uintptr</span><span class="op" id="1727974">(</span><span class="ident" id="1727975"><a href="/runtime/chan.go.html#1724333">c</a></span><span class="op" id="1727976">.</span><span class="ident" id="1727977">elemsize</span><span class="op" id="1727985">)</span><span class="op" id="1727986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1727989"><a href="/runtime/chan.go.html#1724333">c</a></span><span class="op" id="1727990">.</span><span class="ident" id="1727991">sendx</span><span class="op" id="1727996">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1728000">if</span>&nbsp;<span class="ident" id="1728003"><a href="/runtime/chan.go.html#1724333">c</a></span><span class="op" id="1728004">.</span><span class="ident" id="1728005">sendx</span>&nbsp;<span class="op" id="1728011">==</span>&nbsp;<span class="ident" id="1728014"><a href="/runtime/chan.go.html#1724333">c</a></span><span class="op" id="1728015">.</span><span class="ident" id="1728016">dataqsiz</span>&nbsp;<span class="op" id="1728025">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1728029"><a href="/runtime/chan.go.html#1724333">c</a></span><span class="op" id="1728030">.</span><span class="ident" id="1728031">sendx</span>&nbsp;<span class="op" id="1728037">=</span>&nbsp;<span class="num" id="1728039">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1728042">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1728045"><a href="/runtime/chan.go.html#1724333">c</a></span><span class="op" id="1728046">.</span><span class="ident" id="1728047">qcount</span><span class="op" id="1728053">++</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1728058">//&nbsp;wake&nbsp;up&nbsp;a&nbsp;waiting&nbsp;receiver</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1728089">sg</span>&nbsp;<span class="op" id="1728092">:=</span>&nbsp;<span class="ident" id="1728095"><a href="/runtime/chan.go.html#1724333">c</a></span><span class="op" id="1728096">.</span><span class="ident" id="1728097">recvq</span><span class="op" id="1728102">.</span><span class="ident" id="1728103">dequeue</span><span class="op" id="1728110">(</span><span class="op" id="1728111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1728114">if</span>&nbsp;<span class="ident" id="1728117"><a href="/runtime/chan.go.html#1728089">sg</a></span>&nbsp;<span class="op" id="1728120">!=</span>&nbsp;<span class="ident" id="1728123">nil</span>&nbsp;<span class="op" id="1728127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1728131">recvg</span>&nbsp;<span class="op" id="1728137">:=</span>&nbsp;<span class="ident" id="1728140"><a href="/runtime/chan.go.html#1728089">sg</a></span><span class="op" id="1728142">.</span><span class="ident" id="1728143">g</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1728147"><a href="/runtime/lock_futex.go.html#1816596">unlock</a></span><span class="op" id="1728153">(</span><span class="op" id="1728154">&amp;</span><span class="ident" id="1728155"><a href="/runtime/chan.go.html#1724333">c</a></span><span class="op" id="1728156">.</span><span class="ident" id="1728157">lock</span><span class="op" id="1728161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1728165">if</span>&nbsp;<span class="ident" id="1728168"><a href="/runtime/chan.go.html#1728089">sg</a></span><span class="op" id="1728170">.</span><span class="ident" id="1728171">releasetime</span>&nbsp;<span class="op" id="1728183">!=</span>&nbsp;<span class="num" id="1728186">0</span>&nbsp;<span class="op" id="1728188">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1728193"><a href="/runtime/chan.go.html#1728089">sg</a></span><span class="op" id="1728195">.</span><span class="ident" id="1728196">releasetime</span>&nbsp;<span class="op" id="1728208">=</span>&nbsp;<span class="ident" id="1728210"><a href="/runtime/stubs.go.html#1974111">cputicks</a></span><span class="op" id="1728218">(</span><span class="op" id="1728219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1728223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1728227"><a href="/runtime/proc.go.html#1903886">goready</a></span><span class="op" id="1728234">(</span><span class="ident" id="1728235"><a href="/runtime/chan.go.html#1728131">recvg</a></span><span class="op" id="1728240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1728243">}</span>&nbsp;<span class="keyword" id="1728245">else</span>&nbsp;<span class="op" id="1728250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1728254"><a href="/runtime/lock_futex.go.html#1816596">unlock</a></span><span class="op" id="1728260">(</span><span class="op" id="1728261">&amp;</span><span class="ident" id="1728262"><a href="/runtime/chan.go.html#1724333">c</a></span><span class="op" id="1728263">.</span><span class="ident" id="1728264">lock</span><span class="op" id="1728268">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1728271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1728274">if</span>&nbsp;<span class="ident" id="1728277"><a href="/runtime/chan.go.html#1727269">t1</a></span>&nbsp;<span class="op" id="1728280">&gt;</span>&nbsp;<span class="num" id="1728282">0</span>&nbsp;<span class="op" id="1728284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1728288"><a href="/runtime/mprof.go.html#1856961">blockevent</a></span><span class="op" id="1728298">(</span><span class="ident" id="1728299"><a href="/runtime/chan.go.html#1727269">t1</a></span><span class="op" id="1728301">-</span><span class="ident" id="1728302"><a href="/runtime/chan.go.html#1725835">t0</a></span><span class="op" id="1728304">,</span>&nbsp;<span class="num" id="1728306">2</span><span class="op" id="1728307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1728310">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1728313">return</span>&nbsp;<span class="ident" id="1728320">true</span><br>
<span class="lineno">255</span><span class="op" id="1728325">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1728328">func</span>&nbsp;<span class="ident" id="1728333">closechan</span><span class="op" id="1728342">(</span><span class="ident" id="1728343">c</span>&nbsp;<span class="op" id="1728345">*</span><span class="ident" id="1728346"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026588">hchan</a></span><span class="op" id="1728351">)</span>&nbsp;<span class="op" id="1728353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1728356">if</span>&nbsp;<span class="ident" id="1728359"><a href="/runtime/chan.go.html#1728343">c</a></span>&nbsp;<span class="op" id="1728361">==</span>&nbsp;<span class="ident" id="1728364">nil</span>&nbsp;<span class="op" id="1728368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1728372">panic</span><span class="op" id="1728377">(</span><span class="string" id="1728378">&#34;close&nbsp;of&nbsp;nil&nbsp;channel&#34;</span><span class="op" id="1728400">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1728403">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1728407"><a href="/runtime/lock_futex.go.html#1815304">lock</a></span><span class="op" id="1728411">(</span><span class="op" id="1728412">&amp;</span><span class="ident" id="1728413"><a href="/runtime/chan.go.html#1728343">c</a></span><span class="op" id="1728414">.</span><span class="ident" id="1728415">lock</span><span class="op" id="1728419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1728422">if</span>&nbsp;<span class="ident" id="1728425"><a href="/runtime/chan.go.html#1728343">c</a></span><span class="op" id="1728426">.</span><span class="ident" id="1728427">closed</span>&nbsp;<span class="op" id="1728434">!=</span>&nbsp;<span class="num" id="1728437">0</span>&nbsp;<span class="op" id="1728439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1728443"><a href="/runtime/lock_futex.go.html#1816596">unlock</a></span><span class="op" id="1728449">(</span><span class="op" id="1728450">&amp;</span><span class="ident" id="1728451"><a href="/runtime/chan.go.html#1728343">c</a></span><span class="op" id="1728452">.</span><span class="ident" id="1728453">lock</span><span class="op" id="1728457">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1728461">panic</span><span class="op" id="1728466">(</span><span class="string" id="1728467">&#34;close&nbsp;of&nbsp;closed&nbsp;channel&#34;</span><span class="op" id="1728492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1728495">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1728499">if</span>&nbsp;<span class="ident" id="1728502"><a href="/runtime/race0.go.html#1906481">raceenabled</a></span>&nbsp;<span class="op" id="1728514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1728518">callerpc</span>&nbsp;<span class="op" id="1728527">:=</span>&nbsp;<span class="ident" id="1728530"><a href="/runtime/stubs.go.html#1976364">getcallerpc</a></span><span class="op" id="1728541">(</span><span class="ident" id="1728542"><a href="/runtime/chan.go.html#1721991">unsafe</a></span><span class="op" id="1728548">.</span><span class="ident" id="1728549">Pointer</span><span class="op" id="1728556">(</span><span class="op" id="1728557">&amp;</span><span class="ident" id="1728558"><a href="/runtime/chan.go.html#1728343">c</a></span><span class="op" id="1728559">)</span><span class="op" id="1728560">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1728564"><a href="/runtime/race0.go.html#1907063">racewritepc</a></span><span class="op" id="1728575">(</span><span class="ident" id="1728576"><a href="/runtime/chan.go.html#1721991">unsafe</a></span><span class="op" id="1728582">.</span><span class="ident" id="1728583">Pointer</span><span class="op" id="1728590">(</span><span class="ident" id="1728591"><a href="/runtime/chan.go.html#1728343">c</a></span><span class="op" id="1728592">)</span><span class="op" id="1728593">,</span>&nbsp;<span class="ident" id="1728595"><a href="/runtime/chan.go.html#1728518">callerpc</a></span><span class="op" id="1728603">,</span>&nbsp;<span class="ident" id="1728605"><a href="/runtime/proc.go.html#1905425">funcPC</a></span><span class="op" id="1728611">(</span><span class="ident" id="1728612"><a href="/runtime/chan.go.html#1728333">closechan</a></span><span class="op" id="1728621">)</span><span class="op" id="1728622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1728626"><a href="/runtime/race0.go.html#1907639">racerelease</a></span><span class="op" id="1728637">(</span><span class="ident" id="1728638"><a href="/runtime/chan.go.html#1721991">unsafe</a></span><span class="op" id="1728644">.</span><span class="ident" id="1728645">Pointer</span><span class="op" id="1728652">(</span><span class="ident" id="1728653"><a href="/runtime/chan.go.html#1728343">c</a></span><span class="op" id="1728654">)</span><span class="op" id="1728655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1728658">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1728662"><a href="/runtime/chan.go.html#1728343">c</a></span><span class="op" id="1728663">.</span><span class="ident" id="1728664">closed</span>&nbsp;<span class="op" id="1728671">=</span>&nbsp;<span class="num" id="1728673">1</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1728677">//&nbsp;release&nbsp;all&nbsp;readers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1728701">for</span>&nbsp;<span class="op" id="1728705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1728709">sg</span>&nbsp;<span class="op" id="1728712">:=</span>&nbsp;<span class="ident" id="1728715"><a href="/runtime/chan.go.html#1728343">c</a></span><span class="op" id="1728716">.</span><span class="ident" id="1728717">recvq</span><span class="op" id="1728722">.</span><span class="ident" id="1728723">dequeue</span><span class="op" id="1728730">(</span><span class="op" id="1728731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1728735">if</span>&nbsp;<span class="ident" id="1728738"><a href="/runtime/chan.go.html#1728709">sg</a></span>&nbsp;<span class="op" id="1728741">==</span>&nbsp;<span class="ident" id="1728744">nil</span>&nbsp;<span class="op" id="1728748">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1728753">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1728761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1728765">gp</span>&nbsp;<span class="op" id="1728768">:=</span>&nbsp;<span class="ident" id="1728771"><a href="/runtime/chan.go.html#1728709">sg</a></span><span class="op" id="1728773">.</span><span class="ident" id="1728774">g</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1728778"><a href="/runtime/chan.go.html#1728709">sg</a></span><span class="op" id="1728780">.</span><span class="ident" id="1728781">elem</span>&nbsp;<span class="op" id="1728786">=</span>&nbsp;<span class="ident" id="1728788">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1728794"><a href="/runtime/chan.go.html#1728765">gp</a></span><span class="op" id="1728796">.</span><span class="ident" id="1728797">param</span>&nbsp;<span class="op" id="1728803">=</span>&nbsp;<span class="ident" id="1728805">nil</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1728811">if</span>&nbsp;<span class="ident" id="1728814"><a href="/runtime/chan.go.html#1728709">sg</a></span><span class="op" id="1728816">.</span><span class="ident" id="1728817">releasetime</span>&nbsp;<span class="op" id="1728829">!=</span>&nbsp;<span class="num" id="1728832">0</span>&nbsp;<span class="op" id="1728834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1728839"><a href="/runtime/chan.go.html#1728709">sg</a></span><span class="op" id="1728841">.</span><span class="ident" id="1728842">releasetime</span>&nbsp;<span class="op" id="1728854">=</span>&nbsp;<span class="ident" id="1728856"><a href="/runtime/stubs.go.html#1974111">cputicks</a></span><span class="op" id="1728864">(</span><span class="op" id="1728865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1728869">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1728873"><a href="/runtime/proc.go.html#1903886">goready</a></span><span class="op" id="1728880">(</span><span class="ident" id="1728881"><a href="/runtime/chan.go.html#1728765">gp</a></span><span class="op" id="1728883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1728886">}</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1728890">//&nbsp;release&nbsp;all&nbsp;writers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1728914">for</span>&nbsp;<span class="op" id="1728918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1728922">sg</span>&nbsp;<span class="op" id="1728925">:=</span>&nbsp;<span class="ident" id="1728928"><a href="/runtime/chan.go.html#1728343">c</a></span><span class="op" id="1728929">.</span><span class="ident" id="1728930">sendq</span><span class="op" id="1728935">.</span><span class="ident" id="1728936">dequeue</span><span class="op" id="1728943">(</span><span class="op" id="1728944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1728948">if</span>&nbsp;<span class="ident" id="1728951"><a href="/runtime/chan.go.html#1728922">sg</a></span>&nbsp;<span class="op" id="1728954">==</span>&nbsp;<span class="ident" id="1728957">nil</span>&nbsp;<span class="op" id="1728961">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1728966">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1728974">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1728978">gp</span>&nbsp;<span class="op" id="1728981">:=</span>&nbsp;<span class="ident" id="1728984"><a href="/runtime/chan.go.html#1728922">sg</a></span><span class="op" id="1728986">.</span><span class="ident" id="1728987">g</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1728991"><a href="/runtime/chan.go.html#1728922">sg</a></span><span class="op" id="1728993">.</span><span class="ident" id="1728994">elem</span>&nbsp;<span class="op" id="1728999">=</span>&nbsp;<span class="ident" id="1729001">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1729007"><a href="/runtime/chan.go.html#1728978">gp</a></span><span class="op" id="1729009">.</span><span class="ident" id="1729010">param</span>&nbsp;<span class="op" id="1729016">=</span>&nbsp;<span class="ident" id="1729018">nil</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1729024">if</span>&nbsp;<span class="ident" id="1729027"><a href="/runtime/chan.go.html#1728922">sg</a></span><span class="op" id="1729029">.</span><span class="ident" id="1729030">releasetime</span>&nbsp;<span class="op" id="1729042">!=</span>&nbsp;<span class="num" id="1729045">0</span>&nbsp;<span class="op" id="1729047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1729052"><a href="/runtime/chan.go.html#1728922">sg</a></span><span class="op" id="1729054">.</span><span class="ident" id="1729055">releasetime</span>&nbsp;<span class="op" id="1729067">=</span>&nbsp;<span class="ident" id="1729069"><a href="/runtime/stubs.go.html#1974111">cputicks</a></span><span class="op" id="1729077">(</span><span class="op" id="1729078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1729082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1729086"><a href="/runtime/proc.go.html#1903886">goready</a></span><span class="op" id="1729093">(</span><span class="ident" id="1729094"><a href="/runtime/chan.go.html#1728978">gp</a></span><span class="op" id="1729096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1729099">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1729102"><a href="/runtime/lock_futex.go.html#1816596">unlock</a></span><span class="op" id="1729108">(</span><span class="op" id="1729109">&amp;</span><span class="ident" id="1729110"><a href="/runtime/chan.go.html#1728343">c</a></span><span class="op" id="1729111">.</span><span class="ident" id="1729112">lock</span><span class="op" id="1729116">)</span><br>
<span class="lineno"></span><span class="op" id="1729118">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1729121">//&nbsp;entry&nbsp;points&nbsp;for&nbsp;&lt;-&nbsp;c&nbsp;from&nbsp;compiled&nbsp;code</span><br>
<span class="lineno"></span><span class="comment" id="1729165">//go:nosplit</span><br>
<span class="lineno">310</span><span class="keyword" id="1729178">func</span>&nbsp;<span class="ident" id="1729183">chanrecv1</span><span class="op" id="1729192">(</span><span class="ident" id="1729193">t</span>&nbsp;<span class="op" id="1729195">*</span><span class="ident" id="1729196"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026299">chantype</a></span><span class="op" id="1729204">,</span>&nbsp;<span class="ident" id="1729206">c</span>&nbsp;<span class="op" id="1729208">*</span><span class="ident" id="1729209"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026588">hchan</a></span><span class="op" id="1729214">,</span>&nbsp;<span class="ident" id="1729216">elem</span>&nbsp;<span class="ident" id="1729221"><a href="/runtime/chan.go.html#1721991">unsafe</a></span><span class="op" id="1729227">.</span><span class="ident" id="1729228">Pointer</span><span class="op" id="1729235">)</span>&nbsp;<span class="op" id="1729237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1729240"><a href="/runtime/chan.go.html#1729758">chanrecv</a></span><span class="op" id="1729248">(</span><span class="ident" id="1729249"><a href="/runtime/chan.go.html#1729193">t</a></span><span class="op" id="1729250">,</span>&nbsp;<span class="ident" id="1729252"><a href="/runtime/chan.go.html#1729206">c</a></span><span class="op" id="1729253">,</span>&nbsp;<span class="ident" id="1729255"><a href="/runtime/chan.go.html#1729216">elem</a></span><span class="op" id="1729259">,</span>&nbsp;<span class="ident" id="1729261">true</span><span class="op" id="1729265">)</span><br>
<span class="lineno"></span><span class="op" id="1729267">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1729270">//go:nosplit</span><br>
<span class="lineno">315</span><span class="keyword" id="1729283">func</span>&nbsp;<span class="ident" id="1729288">chanrecv2</span><span class="op" id="1729297">(</span><span class="ident" id="1729298">t</span>&nbsp;<span class="op" id="1729300">*</span><span class="ident" id="1729301"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026299">chantype</a></span><span class="op" id="1729309">,</span>&nbsp;<span class="ident" id="1729311">c</span>&nbsp;<span class="op" id="1729313">*</span><span class="ident" id="1729314"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026588">hchan</a></span><span class="op" id="1729319">,</span>&nbsp;<span class="ident" id="1729321">elem</span>&nbsp;<span class="ident" id="1729326"><a href="/runtime/chan.go.html#1721991">unsafe</a></span><span class="op" id="1729332">.</span><span class="ident" id="1729333">Pointer</span><span class="op" id="1729340">)</span>&nbsp;<span class="op" id="1729342">(</span><span class="ident" id="1729343">received</span>&nbsp;<span class="builtintype" id="1729352">bool</span><span class="op" id="1729356">)</span>&nbsp;<span class="op" id="1729358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1729361">_</span><span class="op" id="1729362">,</span>&nbsp;<span class="ident" id="1729364"><a href="/runtime/chan.go.html#1729343">received</a></span>&nbsp;<span class="op" id="1729373">=</span>&nbsp;<span class="ident" id="1729375"><a href="/runtime/chan.go.html#1729758">chanrecv</a></span><span class="op" id="1729383">(</span><span class="ident" id="1729384"><a href="/runtime/chan.go.html#1729298">t</a></span><span class="op" id="1729385">,</span>&nbsp;<span class="ident" id="1729387"><a href="/runtime/chan.go.html#1729311">c</a></span><span class="op" id="1729388">,</span>&nbsp;<span class="ident" id="1729390"><a href="/runtime/chan.go.html#1729321">elem</a></span><span class="op" id="1729394">,</span>&nbsp;<span class="ident" id="1729396">true</span><span class="op" id="1729400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1729403">return</span><br>
<span class="lineno"></span><span class="op" id="1729410">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">320</span><span class="comment" id="1729413">//&nbsp;chanrecv&nbsp;receives&nbsp;on&nbsp;channel&nbsp;c&nbsp;and&nbsp;writes&nbsp;the&nbsp;received&nbsp;data&nbsp;to&nbsp;ep.</span><br>
<span class="lineno"></span><span class="comment" id="1729483">//&nbsp;ep&nbsp;may&nbsp;be&nbsp;nil,&nbsp;in&nbsp;which&nbsp;case&nbsp;received&nbsp;data&nbsp;is&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="1729541">//&nbsp;If&nbsp;block&nbsp;==&nbsp;false&nbsp;and&nbsp;no&nbsp;elements&nbsp;are&nbsp;available,&nbsp;returns&nbsp;(false,&nbsp;false).</span><br>
<span class="lineno"></span><span class="comment" id="1729617">//&nbsp;Otherwise,&nbsp;if&nbsp;c&nbsp;is&nbsp;closed,&nbsp;zeros&nbsp;*ep&nbsp;and&nbsp;returns&nbsp;(true,&nbsp;false).</span><br>
<span class="lineno"></span><span class="comment" id="1729684">//&nbsp;Otherwise,&nbsp;fills&nbsp;in&nbsp;*ep&nbsp;with&nbsp;an&nbsp;element&nbsp;and&nbsp;returns&nbsp;(true,&nbsp;true).</span><br>
<span class="lineno">325</span><span class="keyword" id="1729753">func</span>&nbsp;<span class="ident" id="1729758">chanrecv</span><span class="op" id="1729766">(</span><span class="ident" id="1729767">t</span>&nbsp;<span class="op" id="1729769">*</span><span class="ident" id="1729770"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026299">chantype</a></span><span class="op" id="1729778">,</span>&nbsp;<span class="ident" id="1729780">c</span>&nbsp;<span class="op" id="1729782">*</span><span class="ident" id="1729783"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026588">hchan</a></span><span class="op" id="1729788">,</span>&nbsp;<span class="ident" id="1729790">ep</span>&nbsp;<span class="ident" id="1729793"><a href="/runtime/chan.go.html#1721991">unsafe</a></span><span class="op" id="1729799">.</span><span class="ident" id="1729800">Pointer</span><span class="op" id="1729807">,</span>&nbsp;<span class="ident" id="1729809">block</span>&nbsp;<span class="builtintype" id="1729815">bool</span><span class="op" id="1729819">)</span>&nbsp;<span class="op" id="1729821">(</span><span class="ident" id="1729822">selected</span><span class="op" id="1729830">,</span>&nbsp;<span class="ident" id="1729832">received</span>&nbsp;<span class="builtintype" id="1729841">bool</span><span class="op" id="1729845">)</span>&nbsp;<span class="op" id="1729847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1729850">//&nbsp;raceenabled:&nbsp;don&#39;t&nbsp;need&nbsp;to&nbsp;check&nbsp;ep,&nbsp;as&nbsp;it&nbsp;is&nbsp;always&nbsp;on&nbsp;the&nbsp;stack.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1729922">if</span>&nbsp;<span class="ident" id="1729925"><a href="/runtime/chan.go.html#1722114">debugChan</a></span>&nbsp;<span class="op" id="1729935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1729939">print</span><span class="op" id="1729944">(</span><span class="string" id="1729945">&#34;chanrecv:&nbsp;chan=&#34;</span><span class="op" id="1729962">,</span>&nbsp;<span class="ident" id="1729964"><a href="/runtime/chan.go.html#1729780">c</a></span><span class="op" id="1729965">,</span>&nbsp;<span class="string" id="1729967">&#34;\n&#34;</span><span class="op" id="1729971">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1729974">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1729978">if</span>&nbsp;<span class="ident" id="1729981"><a href="/runtime/chan.go.html#1729780">c</a></span>&nbsp;<span class="op" id="1729983">==</span>&nbsp;<span class="ident" id="1729986">nil</span>&nbsp;<span class="op" id="1729990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1729994">if</span>&nbsp;<span class="op" id="1729997">!</span><span class="ident" id="1729998"><a href="/runtime/chan.go.html#1729809">block</a></span>&nbsp;<span class="op" id="1730004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1730009">return</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1730018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1730022"><a href="/runtime/proc.go.html#1903238">gopark</a></span><span class="op" id="1730028">(</span><span class="ident" id="1730029">nil</span><span class="op" id="1730032">,</span>&nbsp;<span class="ident" id="1730034">nil</span><span class="op" id="1730037">,</span>&nbsp;<span class="string" id="1730039">&#34;chan&nbsp;receive&nbsp;(nil&nbsp;chan)&#34;</span><span class="op" id="1730064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1730068"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1730075">(</span><span class="string" id="1730076">&#34;unreachable&#34;</span><span class="op" id="1730089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1730092">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1730096">//&nbsp;Fast&nbsp;path:&nbsp;check&nbsp;for&nbsp;failed&nbsp;non-blocking&nbsp;operation&nbsp;without&nbsp;acquiring&nbsp;the&nbsp;lock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1730179">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1730183">//&nbsp;After&nbsp;observing&nbsp;that&nbsp;the&nbsp;channel&nbsp;is&nbsp;not&nbsp;ready&nbsp;for&nbsp;receiving,&nbsp;we&nbsp;observe&nbsp;that&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1730268">//&nbsp;channel&nbsp;is&nbsp;not&nbsp;closed.&nbsp;Each&nbsp;of&nbsp;these&nbsp;observations&nbsp;is&nbsp;a&nbsp;single&nbsp;word-sized&nbsp;read</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1730350">//&nbsp;(first&nbsp;c.sendq.first&nbsp;or&nbsp;c.qcount,&nbsp;and&nbsp;second&nbsp;c.closed).</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1730410">//&nbsp;Because&nbsp;a&nbsp;channel&nbsp;cannot&nbsp;be&nbsp;reopened,&nbsp;the&nbsp;later&nbsp;observation&nbsp;of&nbsp;the&nbsp;channel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1730489">//&nbsp;being&nbsp;not&nbsp;closed&nbsp;implies&nbsp;that&nbsp;it&nbsp;was&nbsp;also&nbsp;not&nbsp;closed&nbsp;at&nbsp;the&nbsp;moment&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1730567">//&nbsp;first&nbsp;observation.&nbsp;We&nbsp;behave&nbsp;as&nbsp;if&nbsp;we&nbsp;observed&nbsp;the&nbsp;channel&nbsp;at&nbsp;that&nbsp;moment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1730645">//&nbsp;and&nbsp;report&nbsp;that&nbsp;the&nbsp;receive&nbsp;cannot&nbsp;proceed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1730693">//</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1730697">//&nbsp;The&nbsp;order&nbsp;of&nbsp;operations&nbsp;is&nbsp;important&nbsp;here:&nbsp;reversing&nbsp;the&nbsp;operations&nbsp;can&nbsp;lead&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1730781">//&nbsp;incorrect&nbsp;behavior&nbsp;when&nbsp;racing&nbsp;with&nbsp;a&nbsp;close.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1730830">if</span>&nbsp;<span class="op" id="1730833">!</span><span class="ident" id="1730834"><a href="/runtime/chan.go.html#1729809">block</a></span>&nbsp;<span class="op" id="1730840">&amp;&amp;</span>&nbsp;<span class="op" id="1730843">(</span><span class="ident" id="1730844"><a href="/runtime/chan.go.html#1729780">c</a></span><span class="op" id="1730845">.</span><span class="ident" id="1730846">dataqsiz</span>&nbsp;<span class="op" id="1730855">==</span>&nbsp;<span class="num" id="1730858">0</span>&nbsp;<span class="op" id="1730860">&amp;&amp;</span>&nbsp;<span class="ident" id="1730863"><a href="/runtime/chan.go.html#1729780">c</a></span><span class="op" id="1730864">.</span><span class="ident" id="1730865">sendq</span><span class="op" id="1730870">.</span><span class="ident" id="1730871">first</span>&nbsp;<span class="op" id="1730877">==</span>&nbsp;<span class="ident" id="1730880">nil</span>&nbsp;<span class="op" id="1730884">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1730889"><a href="/runtime/chan.go.html#1729780">c</a></span><span class="op" id="1730890">.</span><span class="ident" id="1730891">dataqsiz</span>&nbsp;<span class="op" id="1730900">&gt;</span>&nbsp;<span class="num" id="1730902">0</span>&nbsp;<span class="op" id="1730904">&amp;&amp;</span>&nbsp;<span class="ident" id="1730907"><a href="/runtime/stubs.go.html#1975040">atomicloaduint</a></span><span class="op" id="1730921">(</span><span class="op" id="1730922">&amp;</span><span class="ident" id="1730923"><a href="/runtime/chan.go.html#1729780">c</a></span><span class="op" id="1730924">.</span><span class="ident" id="1730925">qcount</span><span class="op" id="1730931">)</span>&nbsp;<span class="op" id="1730933">==</span>&nbsp;<span class="num" id="1730936">0</span><span class="op" id="1730937">)</span>&nbsp;<span class="op" id="1730939">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1730944"><a href="/runtime/atomic.go.html#1711297">atomicload</a></span><span class="op" id="1730954">(</span><span class="op" id="1730955">&amp;</span><span class="ident" id="1730956"><a href="/runtime/chan.go.html#1729780">c</a></span><span class="op" id="1730957">.</span><span class="ident" id="1730958">closed</span><span class="op" id="1730964">)</span>&nbsp;<span class="op" id="1730966">==</span>&nbsp;<span class="num" id="1730969">0</span>&nbsp;<span class="op" id="1730971">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1730975">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1730983">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1730987">var</span>&nbsp;<span class="ident" id="1730991">t0</span>&nbsp;<span class="ident" id="1730994">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1731001">if</span>&nbsp;<span class="ident" id="1731004"><a href="/runtime/mprof.go.html#1856178">blockprofilerate</a></span>&nbsp;<span class="op" id="1731021">&gt;</span>&nbsp;<span class="num" id="1731023">0</span>&nbsp;<span class="op" id="1731025">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1731029"><a href="/runtime/chan.go.html#1730991">t0</a></span>&nbsp;<span class="op" id="1731032">=</span>&nbsp;<span class="ident" id="1731034"><a href="/runtime/stubs.go.html#1974111">cputicks</a></span><span class="op" id="1731042">(</span><span class="op" id="1731043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1731046">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1731050"><a href="/runtime/lock_futex.go.html#1815304">lock</a></span><span class="op" id="1731054">(</span><span class="op" id="1731055">&amp;</span><span class="ident" id="1731056"><a href="/runtime/chan.go.html#1729780">c</a></span><span class="op" id="1731057">.</span><span class="ident" id="1731058">lock</span><span class="op" id="1731062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1731065">if</span>&nbsp;<span class="ident" id="1731068"><a href="/runtime/chan.go.html#1729780">c</a></span><span class="op" id="1731069">.</span><span class="ident" id="1731070">dataqsiz</span>&nbsp;<span class="op" id="1731079">==</span>&nbsp;<span class="num" id="1731082">0</span>&nbsp;<span class="op" id="1731084">{</span>&nbsp;<span class="comment" id="1731086">//&nbsp;synchronous&nbsp;channel</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1731111">if</span>&nbsp;<span class="ident" id="1731114"><a href="/runtime/chan.go.html#1729780">c</a></span><span class="op" id="1731115">.</span><span class="ident" id="1731116">closed</span>&nbsp;<span class="op" id="1731123">!=</span>&nbsp;<span class="num" id="1731126">0</span>&nbsp;<span class="op" id="1731128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1731133">return</span>&nbsp;<span class="ident" id="1731140"><a href="/runtime/chan.go.html#1733857">recvclosed</a></span><span class="op" id="1731150">(</span><span class="ident" id="1731151"><a href="/runtime/chan.go.html#1729780">c</a></span><span class="op" id="1731152">,</span>&nbsp;<span class="ident" id="1731154"><a href="/runtime/chan.go.html#1729790">ep</a></span><span class="op" id="1731156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1731160">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1731165">sg</span>&nbsp;<span class="op" id="1731168">:=</span>&nbsp;<span class="ident" id="1731171"><a href="/runtime/chan.go.html#1729780">c</a></span><span class="op" id="1731172">.</span><span class="ident" id="1731173">sendq</span><span class="op" id="1731178">.</span><span class="ident" id="1731179">dequeue</span><span class="op" id="1731186">(</span><span class="op" id="1731187">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1731191">if</span>&nbsp;<span class="ident" id="1731194"><a href="/runtime/chan.go.html#1731165">sg</a></span>&nbsp;<span class="op" id="1731197">!=</span>&nbsp;<span class="ident" id="1731200">nil</span>&nbsp;<span class="op" id="1731204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1731209">if</span>&nbsp;<span class="ident" id="1731212"><a href="/runtime/race0.go.html#1906481">raceenabled</a></span>&nbsp;<span class="op" id="1731224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1731230"><a href="/runtime/chan.go.html#1736215">racesync</a></span><span class="op" id="1731238">(</span><span class="ident" id="1731239"><a href="/runtime/chan.go.html#1729780">c</a></span><span class="op" id="1731240">,</span>&nbsp;<span class="ident" id="1731242"><a href="/runtime/chan.go.html#1731165">sg</a></span><span class="op" id="1731244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1731249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1731254"><a href="/runtime/lock_futex.go.html#1816596">unlock</a></span><span class="op" id="1731260">(</span><span class="op" id="1731261">&amp;</span><span class="ident" id="1731262"><a href="/runtime/chan.go.html#1729780">c</a></span><span class="op" id="1731263">.</span><span class="ident" id="1731264">lock</span><span class="op" id="1731268">)</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1731274">if</span>&nbsp;<span class="ident" id="1731277"><a href="/runtime/chan.go.html#1729790">ep</a></span>&nbsp;<span class="op" id="1731280">!=</span>&nbsp;<span class="ident" id="1731283">nil</span>&nbsp;<span class="op" id="1731287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1731293"><a href="/runtime/stubs.go.html#1972675">memmove</a></span><span class="op" id="1731300">(</span><span class="ident" id="1731301"><a href="/runtime/chan.go.html#1729790">ep</a></span><span class="op" id="1731303">,</span>&nbsp;<span class="ident" id="1731305"><a href="/runtime/chan.go.html#1731165">sg</a></span><span class="op" id="1731307">.</span><span class="ident" id="1731308">elem</span><span class="op" id="1731312">,</span>&nbsp;<span class="builtintype" id="1731314">uintptr</span><span class="op" id="1731321">(</span><span class="ident" id="1731322"><a href="/runtime/chan.go.html#1729780">c</a></span><span class="op" id="1731323">.</span><span class="ident" id="1731324">elemsize</span><span class="op" id="1731332">)</span><span class="op" id="1731333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1731338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1731343"><a href="/runtime/chan.go.html#1731165">sg</a></span><span class="op" id="1731345">.</span><span class="ident" id="1731346">elem</span>&nbsp;<span class="op" id="1731351">=</span>&nbsp;<span class="ident" id="1731353">nil</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1731360">gp</span>&nbsp;<span class="op" id="1731363">:=</span>&nbsp;<span class="ident" id="1731366"><a href="/runtime/chan.go.html#1731165">sg</a></span><span class="op" id="1731368">.</span><span class="ident" id="1731369">g</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1731374"><a href="/runtime/chan.go.html#1731360">gp</a></span><span class="op" id="1731376">.</span><span class="ident" id="1731377">param</span>&nbsp;<span class="op" id="1731383">=</span>&nbsp;<span class="ident" id="1731385"><a href="/runtime/chan.go.html#1721991">unsafe</a></span><span class="op" id="1731391">.</span><span class="ident" id="1731392">Pointer</span><span class="op" id="1731399">(</span><span class="ident" id="1731400"><a href="/runtime/chan.go.html#1731165">sg</a></span><span class="op" id="1731402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1731407">if</span>&nbsp;<span class="ident" id="1731410"><a href="/runtime/chan.go.html#1731165">sg</a></span><span class="op" id="1731412">.</span><span class="ident" id="1731413">releasetime</span>&nbsp;<span class="op" id="1731425">!=</span>&nbsp;<span class="num" id="1731428">0</span>&nbsp;<span class="op" id="1731430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1731436"><a href="/runtime/chan.go.html#1731165">sg</a></span><span class="op" id="1731438">.</span><span class="ident" id="1731439">releasetime</span>&nbsp;<span class="op" id="1731451">=</span>&nbsp;<span class="ident" id="1731453"><a href="/runtime/stubs.go.html#1974111">cputicks</a></span><span class="op" id="1731461">(</span><span class="op" id="1731462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1731467">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1731472"><a href="/runtime/proc.go.html#1903886">goready</a></span><span class="op" id="1731479">(</span><span class="ident" id="1731480"><a href="/runtime/chan.go.html#1731360">gp</a></span><span class="op" id="1731482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1731487"><a href="/runtime/chan.go.html#1729822">selected</a></span>&nbsp;<span class="op" id="1731496">=</span>&nbsp;<span class="ident" id="1731498">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1731506"><a href="/runtime/chan.go.html#1729832">received</a></span>&nbsp;<span class="op" id="1731515">=</span>&nbsp;<span class="ident" id="1731517">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1731525">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1731534">}</span><br>
<span class="lineno">390</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1731539">if</span>&nbsp;<span class="op" id="1731542">!</span><span class="ident" id="1731543"><a href="/runtime/chan.go.html#1729809">block</a></span>&nbsp;<span class="op" id="1731549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1731554"><a href="/runtime/lock_futex.go.html#1816596">unlock</a></span><span class="op" id="1731560">(</span><span class="op" id="1731561">&amp;</span><span class="ident" id="1731562"><a href="/runtime/chan.go.html#1729780">c</a></span><span class="op" id="1731563">.</span><span class="ident" id="1731564">lock</span><span class="op" id="1731568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1731573">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1731582">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1731587">//&nbsp;no&nbsp;sender&nbsp;available:&nbsp;block&nbsp;on&nbsp;this&nbsp;channel.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1731636">gp</span>&nbsp;<span class="op" id="1731639">:=</span>&nbsp;<span class="ident" id="1731642"><a href="/runtime/stubs.go.html#1968886">getg</a></span><span class="op" id="1731646">(</span><span class="op" id="1731647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1731651">mysg</span>&nbsp;<span class="op" id="1731656">:=</span>&nbsp;<span class="ident" id="1731659"><a href="/runtime/proc.go.html#1904005">acquireSudog</a></span><span class="op" id="1731671">(</span><span class="op" id="1731672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1731676"><a href="/runtime/chan.go.html#1731651">mysg</a></span><span class="op" id="1731680">.</span><span class="ident" id="1731681">releasetime</span>&nbsp;<span class="op" id="1731693">=</span>&nbsp;<span class="num" id="1731695">0</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1731699">if</span>&nbsp;<span class="ident" id="1731702"><a href="/runtime/chan.go.html#1730991">t0</a></span>&nbsp;<span class="op" id="1731705">!=</span>&nbsp;<span class="num" id="1731708">0</span>&nbsp;<span class="op" id="1731710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1731715"><a href="/runtime/chan.go.html#1731651">mysg</a></span><span class="op" id="1731719">.</span><span class="ident" id="1731720">releasetime</span>&nbsp;<span class="op" id="1731732">=</span>&nbsp;<span class="op" id="1731734">-</span><span class="num" id="1731735">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1731739">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1731743"><a href="/runtime/chan.go.html#1731651">mysg</a></span><span class="op" id="1731747">.</span><span class="ident" id="1731748">elem</span>&nbsp;<span class="op" id="1731753">=</span>&nbsp;<span class="ident" id="1731755"><a href="/runtime/chan.go.html#1729790">ep</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1731760"><a href="/runtime/chan.go.html#1731651">mysg</a></span><span class="op" id="1731764">.</span><span class="ident" id="1731765">waitlink</span>&nbsp;<span class="op" id="1731774">=</span>&nbsp;<span class="ident" id="1731776">nil</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1731782"><a href="/runtime/chan.go.html#1731636">gp</a></span><span class="op" id="1731784">.</span><span class="ident" id="1731785">waiting</span>&nbsp;<span class="op" id="1731793">=</span>&nbsp;<span class="ident" id="1731795"><a href="/runtime/chan.go.html#1731651">mysg</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1731802"><a href="/runtime/chan.go.html#1731651">mysg</a></span><span class="op" id="1731806">.</span><span class="ident" id="1731807">g</span>&nbsp;<span class="op" id="1731809">=</span>&nbsp;<span class="ident" id="1731811"><a href="/runtime/chan.go.html#1731636">gp</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1731816"><a href="/runtime/chan.go.html#1731651">mysg</a></span><span class="op" id="1731820">.</span><span class="ident" id="1731821">selectdone</span>&nbsp;<span class="op" id="1731832">=</span>&nbsp;<span class="ident" id="1731834">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1731840"><a href="/runtime/chan.go.html#1731636">gp</a></span><span class="op" id="1731842">.</span><span class="ident" id="1731843">param</span>&nbsp;<span class="op" id="1731849">=</span>&nbsp;<span class="ident" id="1731851">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1731857"><a href="/runtime/chan.go.html#1729780">c</a></span><span class="op" id="1731858">.</span><span class="ident" id="1731859">recvq</span><span class="op" id="1731864">.</span><span class="ident" id="1731865">enqueue</span><span class="op" id="1731872">(</span><span class="ident" id="1731873"><a href="/runtime/chan.go.html#1731651">mysg</a></span><span class="op" id="1731877">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1731881"><a href="/runtime/proc.go.html#1903766">goparkunlock</a></span><span class="op" id="1731893">(</span><span class="op" id="1731894">&amp;</span><span class="ident" id="1731895"><a href="/runtime/chan.go.html#1729780">c</a></span><span class="op" id="1731896">.</span><span class="ident" id="1731897">lock</span><span class="op" id="1731901">,</span>&nbsp;<span class="string" id="1731903">&#34;chan&nbsp;receive&#34;</span><span class="op" id="1731917">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1731922">//&nbsp;someone&nbsp;woke&nbsp;us&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1731946">if</span>&nbsp;<span class="ident" id="1731949"><a href="/runtime/chan.go.html#1731651">mysg</a></span>&nbsp;<span class="op" id="1731954">!=</span>&nbsp;<span class="ident" id="1731957"><a href="/runtime/chan.go.html#1731636">gp</a></span><span class="op" id="1731959">.</span><span class="ident" id="1731960">waiting</span>&nbsp;<span class="op" id="1731968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1731973"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1731980">(</span><span class="string" id="1731981">&#34;G&nbsp;waiting&nbsp;list&nbsp;is&nbsp;corrupted!&#34;</span><span class="op" id="1732011">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1732015">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1732019"><a href="/runtime/chan.go.html#1731636">gp</a></span><span class="op" id="1732021">.</span><span class="ident" id="1732022">waiting</span>&nbsp;<span class="op" id="1732030">=</span>&nbsp;<span class="ident" id="1732032">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1732038">if</span>&nbsp;<span class="ident" id="1732041"><a href="/runtime/chan.go.html#1731651">mysg</a></span><span class="op" id="1732045">.</span><span class="ident" id="1732046">releasetime</span>&nbsp;<span class="op" id="1732058">&gt;</span>&nbsp;<span class="num" id="1732060">0</span>&nbsp;<span class="op" id="1732062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1732067"><a href="/runtime/mprof.go.html#1856961">blockevent</a></span><span class="op" id="1732077">(</span><span class="ident" id="1732078"><a href="/runtime/chan.go.html#1731651">mysg</a></span><span class="op" id="1732082">.</span><span class="ident" id="1732083">releasetime</span><span class="op" id="1732094">-</span><span class="ident" id="1732095"><a href="/runtime/chan.go.html#1730991">t0</a></span><span class="op" id="1732097">,</span>&nbsp;<span class="num" id="1732099">2</span><span class="op" id="1732100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1732104">}</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1732108">haveData</span>&nbsp;<span class="op" id="1732117">:=</span>&nbsp;<span class="ident" id="1732120"><a href="/runtime/chan.go.html#1731636">gp</a></span><span class="op" id="1732122">.</span><span class="ident" id="1732123">param</span>&nbsp;<span class="op" id="1732129">!=</span>&nbsp;<span class="ident" id="1732132">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1732138"><a href="/runtime/chan.go.html#1731636">gp</a></span><span class="op" id="1732140">.</span><span class="ident" id="1732141">param</span>&nbsp;<span class="op" id="1732147">=</span>&nbsp;<span class="ident" id="1732149">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1732155"><a href="/runtime/proc.go.html#1904735">releaseSudog</a></span><span class="op" id="1732167">(</span><span class="ident" id="1732168"><a href="/runtime/chan.go.html#1731651">mysg</a></span><span class="op" id="1732172">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1732177">if</span>&nbsp;<span class="ident" id="1732180"><a href="/runtime/chan.go.html#1732108">haveData</a></span>&nbsp;<span class="op" id="1732189">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1732194">//&nbsp;a&nbsp;sender&nbsp;sent&nbsp;us&nbsp;some&nbsp;data.&nbsp;It&nbsp;already&nbsp;wrote&nbsp;to&nbsp;ep.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1732252"><a href="/runtime/chan.go.html#1729822">selected</a></span>&nbsp;<span class="op" id="1732261">=</span>&nbsp;<span class="ident" id="1732263">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1732271"><a href="/runtime/chan.go.html#1729832">received</a></span>&nbsp;<span class="op" id="1732280">=</span>&nbsp;<span class="ident" id="1732282">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1732290">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1732299">}</span><br>
<span class="lineno">430</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1732304"><a href="/runtime/lock_futex.go.html#1815304">lock</a></span><span class="op" id="1732308">(</span><span class="op" id="1732309">&amp;</span><span class="ident" id="1732310"><a href="/runtime/chan.go.html#1729780">c</a></span><span class="op" id="1732311">.</span><span class="ident" id="1732312">lock</span><span class="op" id="1732316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1732320">if</span>&nbsp;<span class="ident" id="1732323"><a href="/runtime/chan.go.html#1729780">c</a></span><span class="op" id="1732324">.</span><span class="ident" id="1732325">closed</span>&nbsp;<span class="op" id="1732332">==</span>&nbsp;<span class="num" id="1732335">0</span>&nbsp;<span class="op" id="1732337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1732342"><a href="/runtime/panic.go.html#1894294">gothrow</a></span><span class="op" id="1732349">(</span><span class="string" id="1732350">&#34;chanrecv:&nbsp;spurious&nbsp;wakeup&#34;</span><span class="op" id="1732377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1732381">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1732385">return</span>&nbsp;<span class="ident" id="1732392"><a href="/runtime/chan.go.html#1733857">recvclosed</a></span><span class="op" id="1732402">(</span><span class="ident" id="1732403"><a href="/runtime/chan.go.html#1729780">c</a></span><span class="op" id="1732404">,</span>&nbsp;<span class="ident" id="1732406"><a href="/runtime/chan.go.html#1729790">ep</a></span><span class="op" id="1732408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1732411">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1732415">//&nbsp;asynchronous&nbsp;channel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1732440">//&nbsp;wait&nbsp;for&nbsp;some&nbsp;data&nbsp;to&nbsp;appear</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1732473">var</span>&nbsp;<span class="ident" id="1732477">t1</span>&nbsp;<span class="ident" id="1732480">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1732487">for</span>&nbsp;<span class="ident" id="1732491"><a href="/runtime/chan.go.html#1729780">c</a></span><span class="op" id="1732492">.</span><span class="ident" id="1732493">qcount</span>&nbsp;<span class="op" id="1732500">&lt;=</span>&nbsp;<span class="num" id="1732503">0</span>&nbsp;<span class="op" id="1732505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1732509">if</span>&nbsp;<span class="ident" id="1732512"><a href="/runtime/chan.go.html#1729780">c</a></span><span class="op" id="1732513">.</span><span class="ident" id="1732514">closed</span>&nbsp;<span class="op" id="1732521">!=</span>&nbsp;<span class="num" id="1732524">0</span>&nbsp;<span class="op" id="1732526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1732531"><a href="/runtime/chan.go.html#1729822">selected</a></span><span class="op" id="1732539">,</span>&nbsp;<span class="ident" id="1732541"><a href="/runtime/chan.go.html#1729832">received</a></span>&nbsp;<span class="op" id="1732550">=</span>&nbsp;<span class="ident" id="1732552"><a href="/runtime/chan.go.html#1733857">recvclosed</a></span><span class="op" id="1732562">(</span><span class="ident" id="1732563"><a href="/runtime/chan.go.html#1729780">c</a></span><span class="op" id="1732564">,</span>&nbsp;<span class="ident" id="1732566"><a href="/runtime/chan.go.html#1729790">ep</a></span><span class="op" id="1732568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1732573">if</span>&nbsp;<span class="ident" id="1732576"><a href="/runtime/chan.go.html#1732477">t1</a></span>&nbsp;<span class="op" id="1732579">&gt;</span>&nbsp;<span class="num" id="1732581">0</span>&nbsp;<span class="op" id="1732583">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1732589"><a href="/runtime/mprof.go.html#1856961">blockevent</a></span><span class="op" id="1732599">(</span><span class="ident" id="1732600"><a href="/runtime/chan.go.html#1732477">t1</a></span><span class="op" id="1732602">-</span><span class="ident" id="1732603"><a href="/runtime/chan.go.html#1730991">t0</a></span><span class="op" id="1732605">,</span>&nbsp;<span class="num" id="1732607">2</span><span class="op" id="1732608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1732613">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1732618">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1732627">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1732632">if</span>&nbsp;<span class="op" id="1732635">!</span><span class="ident" id="1732636"><a href="/runtime/chan.go.html#1729809">block</a></span>&nbsp;<span class="op" id="1732642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1732647"><a href="/runtime/lock_futex.go.html#1816596">unlock</a></span><span class="op" id="1732653">(</span><span class="op" id="1732654">&amp;</span><span class="ident" id="1732655"><a href="/runtime/chan.go.html#1729780">c</a></span><span class="op" id="1732656">.</span><span class="ident" id="1732657">lock</span><span class="op" id="1732661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1732666">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1732675">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1732680">//&nbsp;wait&nbsp;for&nbsp;someone&nbsp;to&nbsp;send&nbsp;an&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1732721">gp</span>&nbsp;<span class="op" id="1732724">:=</span>&nbsp;<span class="ident" id="1732727"><a href="/runtime/stubs.go.html#1968886">getg</a></span><span class="op" id="1732731">(</span><span class="op" id="1732732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1732736">mysg</span>&nbsp;<span class="op" id="1732741">:=</span>&nbsp;<span class="ident" id="1732744"><a href="/runtime/proc.go.html#1904005">acquireSudog</a></span><span class="op" id="1732756">(</span><span class="op" id="1732757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1732761"><a href="/runtime/chan.go.html#1732736">mysg</a></span><span class="op" id="1732765">.</span><span class="ident" id="1732766">releasetime</span>&nbsp;<span class="op" id="1732778">=</span>&nbsp;<span class="num" id="1732780">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1732784">if</span>&nbsp;<span class="ident" id="1732787"><a href="/runtime/chan.go.html#1730991">t0</a></span>&nbsp;<span class="op" id="1732790">!=</span>&nbsp;<span class="num" id="1732793">0</span>&nbsp;<span class="op" id="1732795">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1732800"><a href="/runtime/chan.go.html#1732736">mysg</a></span><span class="op" id="1732804">.</span><span class="ident" id="1732805">releasetime</span>&nbsp;<span class="op" id="1732817">=</span>&nbsp;<span class="op" id="1732819">-</span><span class="num" id="1732820">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1732824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1732828"><a href="/runtime/chan.go.html#1732736">mysg</a></span><span class="op" id="1732832">.</span><span class="ident" id="1732833">elem</span>&nbsp;<span class="op" id="1732838">=</span>&nbsp;<span class="ident" id="1732840">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1732846"><a href="/runtime/chan.go.html#1732736">mysg</a></span><span class="op" id="1732850">.</span><span class="ident" id="1732851">g</span>&nbsp;<span class="op" id="1732853">=</span>&nbsp;<span class="ident" id="1732855"><a href="/runtime/chan.go.html#1732721">gp</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1732860"><a href="/runtime/chan.go.html#1732736">mysg</a></span><span class="op" id="1732864">.</span><span class="ident" id="1732865">selectdone</span>&nbsp;<span class="op" id="1732876">=</span>&nbsp;<span class="ident" id="1732878">nil</span><br>
<span class="lineno">465</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1732885"><a href="/runtime/chan.go.html#1729780">c</a></span><span class="op" id="1732886">.</span><span class="ident" id="1732887">recvq</span><span class="op" id="1732892">.</span><span class="ident" id="1732893">enqueue</span><span class="op" id="1732900">(</span><span class="ident" id="1732901"><a href="/runtime/chan.go.html#1732736">mysg</a></span><span class="op" id="1732905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1732909"><a href="/runtime/proc.go.html#1903766">goparkunlock</a></span><span class="op" id="1732921">(</span><span class="op" id="1732922">&amp;</span><span class="ident" id="1732923"><a href="/runtime/chan.go.html#1729780">c</a></span><span class="op" id="1732924">.</span><span class="ident" id="1732925">lock</span><span class="op" id="1732929">,</span>&nbsp;<span class="string" id="1732931">&#34;chan&nbsp;receive&#34;</span><span class="op" id="1732945">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1732950">//&nbsp;someone&nbsp;woke&nbsp;us&nbsp;up&nbsp;-&nbsp;try&nbsp;again</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1732986">if</span>&nbsp;<span class="ident" id="1732989"><a href="/runtime/chan.go.html#1732736">mysg</a></span><span class="op" id="1732993">.</span><span class="ident" id="1732994">releasetime</span>&nbsp;<span class="op" id="1733006">&gt;</span>&nbsp;<span class="num" id="1733008">0</span>&nbsp;<span class="op" id="1733010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1733015"><a href="/runtime/chan.go.html#1732477">t1</a></span>&nbsp;<span class="op" id="1733018">=</span>&nbsp;<span class="ident" id="1733020"><a href="/runtime/chan.go.html#1732736">mysg</a></span><span class="op" id="1733024">.</span><span class="ident" id="1733025">releasetime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1733039">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1733043"><a href="/runtime/proc.go.html#1904735">releaseSudog</a></span><span class="op" id="1733055">(</span><span class="ident" id="1733056"><a href="/runtime/chan.go.html#1732736">mysg</a></span><span class="op" id="1733060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1733064"><a href="/runtime/lock_futex.go.html#1815304">lock</a></span><span class="op" id="1733068">(</span><span class="op" id="1733069">&amp;</span><span class="ident" id="1733070"><a href="/runtime/chan.go.html#1729780">c</a></span><span class="op" id="1733071">.</span><span class="ident" id="1733072">lock</span><span class="op" id="1733076">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1733079">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1733083">if</span>&nbsp;<span class="ident" id="1733086"><a href="/runtime/race0.go.html#1906481">raceenabled</a></span>&nbsp;<span class="op" id="1733098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1733102"><a href="/runtime/race0.go.html#1907447">raceacquire</a></span><span class="op" id="1733113">(</span><span class="ident" id="1733114"><a href="/runtime/chan.go.html#1723676">chanbuf</a></span><span class="op" id="1733121">(</span><span class="ident" id="1733122"><a href="/runtime/chan.go.html#1729780">c</a></span><span class="op" id="1733123">,</span>&nbsp;<span class="ident" id="1733125"><a href="/runtime/chan.go.html#1729780">c</a></span><span class="op" id="1733126">.</span><span class="ident" id="1733127">recvx</span><span class="op" id="1733132">)</span><span class="op" id="1733133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1733137"><a href="/runtime/race0.go.html#1907639">racerelease</a></span><span class="op" id="1733148">(</span><span class="ident" id="1733149"><a href="/runtime/chan.go.html#1723676">chanbuf</a></span><span class="op" id="1733156">(</span><span class="ident" id="1733157"><a href="/runtime/chan.go.html#1729780">c</a></span><span class="op" id="1733158">,</span>&nbsp;<span class="ident" id="1733160"><a href="/runtime/chan.go.html#1729780">c</a></span><span class="op" id="1733161">.</span><span class="ident" id="1733162">recvx</span><span class="op" id="1733167">)</span><span class="op" id="1733168">)</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1733171">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1733174">if</span>&nbsp;<span class="ident" id="1733177"><a href="/runtime/chan.go.html#1729790">ep</a></span>&nbsp;<span class="op" id="1733180">!=</span>&nbsp;<span class="ident" id="1733183">nil</span>&nbsp;<span class="op" id="1733187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1733191"><a href="/runtime/stubs.go.html#1972675">memmove</a></span><span class="op" id="1733198">(</span><span class="ident" id="1733199"><a href="/runtime/chan.go.html#1729790">ep</a></span><span class="op" id="1733201">,</span>&nbsp;<span class="ident" id="1733203"><a href="/runtime/chan.go.html#1723676">chanbuf</a></span><span class="op" id="1733210">(</span><span class="ident" id="1733211"><a href="/runtime/chan.go.html#1729780">c</a></span><span class="op" id="1733212">,</span>&nbsp;<span class="ident" id="1733214"><a href="/runtime/chan.go.html#1729780">c</a></span><span class="op" id="1733215">.</span><span class="ident" id="1733216">recvx</span><span class="op" id="1733221">)</span><span class="op" id="1733222">,</span>&nbsp;<span class="builtintype" id="1733224">uintptr</span><span class="op" id="1733231">(</span><span class="ident" id="1733232"><a href="/runtime/chan.go.html#1729780">c</a></span><span class="op" id="1733233">.</span><span class="ident" id="1733234">elemsize</span><span class="op" id="1733242">)</span><span class="op" id="1733243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1733246">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1733249"><a href="/runtime/stubs.go.html#1972552">memclr</a></span><span class="op" id="1733255">(</span><span class="ident" id="1733256"><a href="/runtime/chan.go.html#1723676">chanbuf</a></span><span class="op" id="1733263">(</span><span class="ident" id="1733264"><a href="/runtime/chan.go.html#1729780">c</a></span><span class="op" id="1733265">,</span>&nbsp;<span class="ident" id="1733267"><a href="/runtime/chan.go.html#1729780">c</a></span><span class="op" id="1733268">.</span><span class="ident" id="1733269">recvx</span><span class="op" id="1733274">)</span><span class="op" id="1733275">,</span>&nbsp;<span class="builtintype" id="1733277">uintptr</span><span class="op" id="1733284">(</span><span class="ident" id="1733285"><a href="/runtime/chan.go.html#1729780">c</a></span><span class="op" id="1733286">.</span><span class="ident" id="1733287">elemsize</span><span class="op" id="1733295">)</span><span class="op" id="1733296">)</span><br>
<span class="lineno">485</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1733300"><a href="/runtime/chan.go.html#1729780">c</a></span><span class="op" id="1733301">.</span><span class="ident" id="1733302">recvx</span><span class="op" id="1733307">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1733311">if</span>&nbsp;<span class="ident" id="1733314"><a href="/runtime/chan.go.html#1729780">c</a></span><span class="op" id="1733315">.</span><span class="ident" id="1733316">recvx</span>&nbsp;<span class="op" id="1733322">==</span>&nbsp;<span class="ident" id="1733325"><a href="/runtime/chan.go.html#1729780">c</a></span><span class="op" id="1733326">.</span><span class="ident" id="1733327">dataqsiz</span>&nbsp;<span class="op" id="1733336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1733340"><a href="/runtime/chan.go.html#1729780">c</a></span><span class="op" id="1733341">.</span><span class="ident" id="1733342">recvx</span>&nbsp;<span class="op" id="1733348">=</span>&nbsp;<span class="num" id="1733350">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1733353">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1733356"><a href="/runtime/chan.go.html#1729780">c</a></span><span class="op" id="1733357">.</span><span class="ident" id="1733358">qcount</span><span class="op" id="1733364">--</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1733369">//&nbsp;ping&nbsp;a&nbsp;sender&nbsp;now&nbsp;that&nbsp;there&nbsp;is&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1733411">sg</span>&nbsp;<span class="op" id="1733414">:=</span>&nbsp;<span class="ident" id="1733417"><a href="/runtime/chan.go.html#1729780">c</a></span><span class="op" id="1733418">.</span><span class="ident" id="1733419">sendq</span><span class="op" id="1733424">.</span><span class="ident" id="1733425">dequeue</span><span class="op" id="1733432">(</span><span class="op" id="1733433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1733436">if</span>&nbsp;<span class="ident" id="1733439"><a href="/runtime/chan.go.html#1733411">sg</a></span>&nbsp;<span class="op" id="1733442">!=</span>&nbsp;<span class="ident" id="1733445">nil</span>&nbsp;<span class="op" id="1733449">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1733453">gp</span>&nbsp;<span class="op" id="1733456">:=</span>&nbsp;<span class="ident" id="1733459"><a href="/runtime/chan.go.html#1733411">sg</a></span><span class="op" id="1733461">.</span><span class="ident" id="1733462">g</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1733466"><a href="/runtime/lock_futex.go.html#1816596">unlock</a></span><span class="op" id="1733472">(</span><span class="op" id="1733473">&amp;</span><span class="ident" id="1733474"><a href="/runtime/chan.go.html#1729780">c</a></span><span class="op" id="1733475">.</span><span class="ident" id="1733476">lock</span><span class="op" id="1733480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1733484">if</span>&nbsp;<span class="ident" id="1733487"><a href="/runtime/chan.go.html#1733411">sg</a></span><span class="op" id="1733489">.</span><span class="ident" id="1733490">releasetime</span>&nbsp;<span class="op" id="1733502">!=</span>&nbsp;<span class="num" id="1733505">0</span>&nbsp;<span class="op" id="1733507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1733512"><a href="/runtime/chan.go.html#1733411">sg</a></span><span class="op" id="1733514">.</span><span class="ident" id="1733515">releasetime</span>&nbsp;<span class="op" id="1733527">=</span>&nbsp;<span class="ident" id="1733529"><a href="/runtime/stubs.go.html#1974111">cputicks</a></span><span class="op" id="1733537">(</span><span class="op" id="1733538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1733542">}</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1733546"><a href="/runtime/proc.go.html#1903886">goready</a></span><span class="op" id="1733553">(</span><span class="ident" id="1733554"><a href="/runtime/chan.go.html#1733453">gp</a></span><span class="op" id="1733556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1733559">}</span>&nbsp;<span class="keyword" id="1733561">else</span>&nbsp;<span class="op" id="1733566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1733570"><a href="/runtime/lock_futex.go.html#1816596">unlock</a></span><span class="op" id="1733576">(</span><span class="op" id="1733577">&amp;</span><span class="ident" id="1733578"><a href="/runtime/chan.go.html#1729780">c</a></span><span class="op" id="1733579">.</span><span class="ident" id="1733580">lock</span><span class="op" id="1733584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1733587">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1733591">if</span>&nbsp;<span class="ident" id="1733594"><a href="/runtime/chan.go.html#1732477">t1</a></span>&nbsp;<span class="op" id="1733597">&gt;</span>&nbsp;<span class="num" id="1733599">0</span>&nbsp;<span class="op" id="1733601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1733605"><a href="/runtime/mprof.go.html#1856961">blockevent</a></span><span class="op" id="1733615">(</span><span class="ident" id="1733616"><a href="/runtime/chan.go.html#1732477">t1</a></span><span class="op" id="1733618">-</span><span class="ident" id="1733619"><a href="/runtime/chan.go.html#1730991">t0</a></span><span class="op" id="1733621">,</span>&nbsp;<span class="num" id="1733623">2</span><span class="op" id="1733624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1733627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1733630"><a href="/runtime/chan.go.html#1729822">selected</a></span>&nbsp;<span class="op" id="1733639">=</span>&nbsp;<span class="ident" id="1733641">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1733647"><a href="/runtime/chan.go.html#1729832">received</a></span>&nbsp;<span class="op" id="1733656">=</span>&nbsp;<span class="ident" id="1733658">true</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1733664">return</span><br>
<span class="lineno"></span><span class="op" id="1733671">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1733674">//&nbsp;recvclosed&nbsp;is&nbsp;a&nbsp;helper&nbsp;function&nbsp;for&nbsp;chanrecv.&nbsp;&nbsp;Handles&nbsp;cleanup</span><br>
<span class="lineno"></span><span class="comment" id="1733740">//&nbsp;when&nbsp;the&nbsp;receiver&nbsp;encounters&nbsp;a&nbsp;closed&nbsp;channel.</span><br>
<span class="lineno">515</span><span class="comment" id="1733790">//&nbsp;Caller&nbsp;must&nbsp;hold&nbsp;c.lock,&nbsp;recvclosed&nbsp;will&nbsp;release&nbsp;the&nbsp;lock.</span><br>
<span class="lineno"></span><span class="keyword" id="1733852">func</span>&nbsp;<span class="ident" id="1733857">recvclosed</span><span class="op" id="1733867">(</span><span class="ident" id="1733868">c</span>&nbsp;<span class="op" id="1733870">*</span><span class="ident" id="1733871"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026588">hchan</a></span><span class="op" id="1733876">,</span>&nbsp;<span class="ident" id="1733878">ep</span>&nbsp;<span class="ident" id="1733881"><a href="/runtime/chan.go.html#1721991">unsafe</a></span><span class="op" id="1733887">.</span><span class="ident" id="1733888">Pointer</span><span class="op" id="1733895">)</span>&nbsp;<span class="op" id="1733897">(</span><span class="ident" id="1733898">selected</span><span class="op" id="1733906">,</span>&nbsp;<span class="ident" id="1733908">recevied</span>&nbsp;<span class="builtintype" id="1733917">bool</span><span class="op" id="1733921">)</span>&nbsp;<span class="op" id="1733923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1733926">if</span>&nbsp;<span class="ident" id="1733929"><a href="/runtime/race0.go.html#1906481">raceenabled</a></span>&nbsp;<span class="op" id="1733941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1733945"><a href="/runtime/race0.go.html#1907447">raceacquire</a></span><span class="op" id="1733956">(</span><span class="ident" id="1733957"><a href="/runtime/chan.go.html#1721991">unsafe</a></span><span class="op" id="1733963">.</span><span class="ident" id="1733964">Pointer</span><span class="op" id="1733971">(</span><span class="ident" id="1733972"><a href="/runtime/chan.go.html#1733868">c</a></span><span class="op" id="1733973">)</span><span class="op" id="1733974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1733977">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1733980"><a href="/runtime/lock_futex.go.html#1816596">unlock</a></span><span class="op" id="1733986">(</span><span class="op" id="1733987">&amp;</span><span class="ident" id="1733988"><a href="/runtime/chan.go.html#1733868">c</a></span><span class="op" id="1733989">.</span><span class="ident" id="1733990">lock</span><span class="op" id="1733994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1733997">if</span>&nbsp;<span class="ident" id="1734000"><a href="/runtime/chan.go.html#1733878">ep</a></span>&nbsp;<span class="op" id="1734003">!=</span>&nbsp;<span class="ident" id="1734006">nil</span>&nbsp;<span class="op" id="1734010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1734014"><a href="/runtime/stubs.go.html#1972552">memclr</a></span><span class="op" id="1734020">(</span><span class="ident" id="1734021"><a href="/runtime/chan.go.html#1733878">ep</a></span><span class="op" id="1734023">,</span>&nbsp;<span class="builtintype" id="1734025">uintptr</span><span class="op" id="1734032">(</span><span class="ident" id="1734033"><a href="/runtime/chan.go.html#1733868">c</a></span><span class="op" id="1734034">.</span><span class="ident" id="1734035">elemsize</span><span class="op" id="1734043">)</span><span class="op" id="1734044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1734047">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1734050">return</span>&nbsp;<span class="ident" id="1734057">true</span><span class="op" id="1734061">,</span>&nbsp;<span class="ident" id="1734063">false</span><br>
<span class="lineno">525</span><span class="op" id="1734069">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1734072">//&nbsp;compiler&nbsp;implements</span><br>
<span class="lineno"></span><span class="comment" id="1734095">//</span><br>
<span class="lineno"></span><span class="comment" id="1734098">//&nbsp;&nbsp;&nbsp;&nbspselect&nbsp;{</span><br>
<span class="lineno">530</span><span class="comment" id="1734110">//&nbsp;&nbsp;&nbsp;&nbspcase&nbsp;c&nbsp;&lt;-&nbsp;v:</span><br>
<span class="lineno"></span><span class="comment" id="1734126">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp...&nbsp;foo</span><br>
<span class="lineno"></span><span class="comment" id="1734138">//&nbsp;&nbsp;&nbsp;&nbspdefault:</span><br>
<span class="lineno"></span><span class="comment" id="1734150">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp...&nbsp;bar</span><br>
<span class="lineno"></span><span class="comment" id="1734162">//&nbsp;&nbsp;&nbsp;&nbsp}</span><br>
<span class="lineno">535</span><span class="comment" id="1734167">//</span><br>
<span class="lineno"></span><span class="comment" id="1734170">//&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="1734176">//</span><br>
<span class="lineno"></span><span class="comment" id="1734179">//&nbsp;&nbsp;&nbsp;&nbspif&nbsp;selectnbsend(c,&nbsp;v)&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="1734206">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp...&nbsp;foo</span><br>
<span class="lineno">540</span><span class="comment" id="1734218">//&nbsp;&nbsp;&nbsp;&nbsp}&nbsp;else&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="1734230">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp...&nbsp;bar</span><br>
<span class="lineno"></span><span class="comment" id="1734242">//&nbsp;&nbsp;&nbsp;&nbsp}</span><br>
<span class="lineno"></span><span class="comment" id="1734247">//</span><br>
<span class="lineno"></span><span class="keyword" id="1734250">func</span>&nbsp;<span class="ident" id="1734255">selectnbsend</span><span class="op" id="1734267">(</span><span class="ident" id="1734268">t</span>&nbsp;<span class="op" id="1734270">*</span><span class="ident" id="1734271"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026299">chantype</a></span><span class="op" id="1734279">,</span>&nbsp;<span class="ident" id="1734281">c</span>&nbsp;<span class="op" id="1734283">*</span><span class="ident" id="1734284"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026588">hchan</a></span><span class="op" id="1734289">,</span>&nbsp;<span class="ident" id="1734291">elem</span>&nbsp;<span class="ident" id="1734296"><a href="/runtime/chan.go.html#1721991">unsafe</a></span><span class="op" id="1734302">.</span><span class="ident" id="1734303">Pointer</span><span class="op" id="1734310">)</span>&nbsp;<span class="op" id="1734312">(</span><span class="ident" id="1734313">selected</span>&nbsp;<span class="builtintype" id="1734322">bool</span><span class="op" id="1734326">)</span>&nbsp;<span class="op" id="1734328">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1734331">return</span>&nbsp;<span class="ident" id="1734338"><a href="/runtime/chan.go.html#1724311">chansend</a></span><span class="op" id="1734346">(</span><span class="ident" id="1734347"><a href="/runtime/chan.go.html#1734268">t</a></span><span class="op" id="1734348">,</span>&nbsp;<span class="ident" id="1734350"><a href="/runtime/chan.go.html#1734281">c</a></span><span class="op" id="1734351">,</span>&nbsp;<span class="ident" id="1734353"><a href="/runtime/chan.go.html#1734291">elem</a></span><span class="op" id="1734357">,</span>&nbsp;<span class="ident" id="1734359">false</span><span class="op" id="1734364">,</span>&nbsp;<span class="ident" id="1734366"><a href="/runtime/stubs.go.html#1976364">getcallerpc</a></span><span class="op" id="1734377">(</span><span class="ident" id="1734378"><a href="/runtime/chan.go.html#1721991">unsafe</a></span><span class="op" id="1734384">.</span><span class="ident" id="1734385">Pointer</span><span class="op" id="1734392">(</span><span class="op" id="1734393">&amp;</span><span class="ident" id="1734394"><a href="/runtime/chan.go.html#1734268">t</a></span><span class="op" id="1734395">)</span><span class="op" id="1734396">)</span><span class="op" id="1734397">)</span><br>
<span class="lineno"></span><span class="op" id="1734399">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1734402">//&nbsp;compiler&nbsp;implements</span><br>
<span class="lineno"></span><span class="comment" id="1734425">//</span><br>
<span class="lineno">550</span><span class="comment" id="1734428">//&nbsp;&nbsp;&nbsp;&nbspselect&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="1734440">//&nbsp;&nbsp;&nbsp;&nbspcase&nbsp;v&nbsp;=&nbsp;&lt;-c:</span><br>
<span class="lineno"></span><span class="comment" id="1734457">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp...&nbsp;foo</span><br>
<span class="lineno"></span><span class="comment" id="1734469">//&nbsp;&nbsp;&nbsp;&nbspdefault:</span><br>
<span class="lineno"></span><span class="comment" id="1734481">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp...&nbsp;bar</span><br>
<span class="lineno">555</span><span class="comment" id="1734493">//&nbsp;&nbsp;&nbsp;&nbsp}</span><br>
<span class="lineno"></span><span class="comment" id="1734498">//</span><br>
<span class="lineno"></span><span class="comment" id="1734501">//&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="1734507">//</span><br>
<span class="lineno"></span><span class="comment" id="1734510">//&nbsp;&nbsp;&nbsp;&nbspif&nbsp;selectnbrecv(&amp;v,&nbsp;c)&nbsp;{</span><br>
<span class="lineno">560</span><span class="comment" id="1734538">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp...&nbsp;foo</span><br>
<span class="lineno"></span><span class="comment" id="1734550">//&nbsp;&nbsp;&nbsp;&nbsp}&nbsp;else&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="1734562">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp...&nbsp;bar</span><br>
<span class="lineno"></span><span class="comment" id="1734574">//&nbsp;&nbsp;&nbsp;&nbsp}</span><br>
<span class="lineno"></span><span class="comment" id="1734579">//</span><br>
<span class="lineno">565</span><span class="keyword" id="1734582">func</span>&nbsp;<span class="ident" id="1734587">selectnbrecv</span><span class="op" id="1734599">(</span><span class="ident" id="1734600">t</span>&nbsp;<span class="op" id="1734602">*</span><span class="ident" id="1734603"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026299">chantype</a></span><span class="op" id="1734611">,</span>&nbsp;<span class="ident" id="1734613">elem</span>&nbsp;<span class="ident" id="1734618"><a href="/runtime/chan.go.html#1721991">unsafe</a></span><span class="op" id="1734624">.</span><span class="ident" id="1734625">Pointer</span><span class="op" id="1734632">,</span>&nbsp;<span class="ident" id="1734634">c</span>&nbsp;<span class="op" id="1734636">*</span><span class="ident" id="1734637"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026588">hchan</a></span><span class="op" id="1734642">)</span>&nbsp;<span class="op" id="1734644">(</span><span class="ident" id="1734645">selected</span>&nbsp;<span class="builtintype" id="1734654">bool</span><span class="op" id="1734658">)</span>&nbsp;<span class="op" id="1734660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1734663"><a href="/runtime/chan.go.html#1734645">selected</a></span><span class="op" id="1734671">,</span>&nbsp;<span class="ident" id="1734673">_</span>&nbsp;<span class="op" id="1734675">=</span>&nbsp;<span class="ident" id="1734677"><a href="/runtime/chan.go.html#1729758">chanrecv</a></span><span class="op" id="1734685">(</span><span class="ident" id="1734686"><a href="/runtime/chan.go.html#1734600">t</a></span><span class="op" id="1734687">,</span>&nbsp;<span class="ident" id="1734689"><a href="/runtime/chan.go.html#1734634">c</a></span><span class="op" id="1734690">,</span>&nbsp;<span class="ident" id="1734692"><a href="/runtime/chan.go.html#1734613">elem</a></span><span class="op" id="1734696">,</span>&nbsp;<span class="ident" id="1734698">false</span><span class="op" id="1734703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1734706">return</span><br>
<span class="lineno"></span><span class="op" id="1734713">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">570</span><span class="comment" id="1734716">//&nbsp;compiler&nbsp;implements</span><br>
<span class="lineno"></span><span class="comment" id="1734739">//</span><br>
<span class="lineno"></span><span class="comment" id="1734742">//&nbsp;&nbsp;&nbsp;&nbspselect&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="1734754">//&nbsp;&nbsp;&nbsp;&nbspcase&nbsp;v,&nbsp;ok&nbsp;=&nbsp;&lt;-c:</span><br>
<span class="lineno"></span><span class="comment" id="1734775">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp...&nbsp;foo</span><br>
<span class="lineno">575</span><span class="comment" id="1734787">//&nbsp;&nbsp;&nbsp;&nbspdefault:</span><br>
<span class="lineno"></span><span class="comment" id="1734799">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp...&nbsp;bar</span><br>
<span class="lineno"></span><span class="comment" id="1734811">//&nbsp;&nbsp;&nbsp;&nbsp}</span><br>
<span class="lineno"></span><span class="comment" id="1734816">//</span><br>
<span class="lineno"></span><span class="comment" id="1734819">//&nbsp;as</span><br>
<span class="lineno">580</span><span class="comment" id="1734825">//</span><br>
<span class="lineno"></span><span class="comment" id="1734828">//&nbsp;&nbsp;&nbsp;&nbspif&nbsp;c&nbsp;!=&nbsp;nil&nbsp;&amp;&amp;&nbsp;selectnbrecv2(&amp;v,&nbsp;&amp;ok,&nbsp;c)&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="1734874">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp...&nbsp;foo</span><br>
<span class="lineno"></span><span class="comment" id="1734886">//&nbsp;&nbsp;&nbsp;&nbsp}&nbsp;else&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="1734898">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp...&nbsp;bar</span><br>
<span class="lineno">585</span><span class="comment" id="1734910">//&nbsp;&nbsp;&nbsp;&nbsp}</span><br>
<span class="lineno"></span><span class="comment" id="1734915">//</span><br>
<span class="lineno"></span><span class="keyword" id="1734918">func</span>&nbsp;<span class="ident" id="1734923">selectnbrecv2</span><span class="op" id="1734936">(</span><span class="ident" id="1734937">t</span>&nbsp;<span class="op" id="1734939">*</span><span class="ident" id="1734940"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026299">chantype</a></span><span class="op" id="1734948">,</span>&nbsp;<span class="ident" id="1734950">elem</span>&nbsp;<span class="ident" id="1734955"><a href="/runtime/chan.go.html#1721991">unsafe</a></span><span class="op" id="1734961">.</span><span class="ident" id="1734962">Pointer</span><span class="op" id="1734969">,</span>&nbsp;<span class="ident" id="1734971">received</span>&nbsp;<span class="op" id="1734980">*</span><span class="builtintype" id="1734981">bool</span><span class="op" id="1734985">,</span>&nbsp;<span class="ident" id="1734987">c</span>&nbsp;<span class="op" id="1734989">*</span><span class="ident" id="1734990"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026588">hchan</a></span><span class="op" id="1734995">)</span>&nbsp;<span class="op" id="1734997">(</span><span class="ident" id="1734998">selected</span>&nbsp;<span class="builtintype" id="1735007">bool</span><span class="op" id="1735011">)</span>&nbsp;<span class="op" id="1735013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1735016">//&nbsp;TODO(khr):&nbsp;just&nbsp;return&nbsp;2&nbsp;values&nbsp;from&nbsp;this&nbsp;function,&nbsp;now&nbsp;that&nbsp;it&nbsp;is&nbsp;in&nbsp;Go.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1735094"><a href="/runtime/chan.go.html#1734998">selected</a></span><span class="op" id="1735102">,</span>&nbsp;<span class="op" id="1735104">*</span><span class="ident" id="1735105"><a href="/runtime/chan.go.html#1734971">received</a></span>&nbsp;<span class="op" id="1735114">=</span>&nbsp;<span class="ident" id="1735116"><a href="/runtime/chan.go.html#1729758">chanrecv</a></span><span class="op" id="1735124">(</span><span class="ident" id="1735125"><a href="/runtime/chan.go.html#1734937">t</a></span><span class="op" id="1735126">,</span>&nbsp;<span class="ident" id="1735128"><a href="/runtime/chan.go.html#1734987">c</a></span><span class="op" id="1735129">,</span>&nbsp;<span class="ident" id="1735131"><a href="/runtime/chan.go.html#1734950">elem</a></span><span class="op" id="1735135">,</span>&nbsp;<span class="ident" id="1735137">false</span><span class="op" id="1735142">)</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1735145">return</span><br>
<span class="lineno"></span><span class="op" id="1735152">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1735155">func</span>&nbsp;<span class="ident" id="1735160">reflect_chansend</span><span class="op" id="1735176">(</span><span class="ident" id="1735177">t</span>&nbsp;<span class="op" id="1735179">*</span><span class="ident" id="1735180"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026299">chantype</a></span><span class="op" id="1735188">,</span>&nbsp;<span class="ident" id="1735190">c</span>&nbsp;<span class="op" id="1735192">*</span><span class="ident" id="1735193"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026588">hchan</a></span><span class="op" id="1735198">,</span>&nbsp;<span class="ident" id="1735200">elem</span>&nbsp;<span class="ident" id="1735205"><a href="/runtime/chan.go.html#1721991">unsafe</a></span><span class="op" id="1735211">.</span><span class="ident" id="1735212">Pointer</span><span class="op" id="1735219">,</span>&nbsp;<span class="ident" id="1735221">nb</span>&nbsp;<span class="builtintype" id="1735224">bool</span><span class="op" id="1735228">)</span>&nbsp;<span class="op" id="1735230">(</span><span class="ident" id="1735231">selected</span>&nbsp;<span class="builtintype" id="1735240">bool</span><span class="op" id="1735244">)</span>&nbsp;<span class="op" id="1735246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1735249">return</span>&nbsp;<span class="ident" id="1735256"><a href="/runtime/chan.go.html#1724311">chansend</a></span><span class="op" id="1735264">(</span><span class="ident" id="1735265"><a href="/runtime/chan.go.html#1735177">t</a></span><span class="op" id="1735266">,</span>&nbsp;<span class="ident" id="1735268"><a href="/runtime/chan.go.html#1735190">c</a></span><span class="op" id="1735269">,</span>&nbsp;<span class="ident" id="1735271"><a href="/runtime/chan.go.html#1735200">elem</a></span><span class="op" id="1735275">,</span>&nbsp;<span class="op" id="1735277">!</span><span class="ident" id="1735278"><a href="/runtime/chan.go.html#1735221">nb</a></span><span class="op" id="1735280">,</span>&nbsp;<span class="ident" id="1735282"><a href="/runtime/stubs.go.html#1976364">getcallerpc</a></span><span class="op" id="1735293">(</span><span class="ident" id="1735294"><a href="/runtime/chan.go.html#1721991">unsafe</a></span><span class="op" id="1735300">.</span><span class="ident" id="1735301">Pointer</span><span class="op" id="1735308">(</span><span class="op" id="1735309">&amp;</span><span class="ident" id="1735310"><a href="/runtime/chan.go.html#1735177">t</a></span><span class="op" id="1735311">)</span><span class="op" id="1735312">)</span><span class="op" id="1735313">)</span><br>
<span class="lineno">595</span><span class="op" id="1735315">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1735318">func</span>&nbsp;<span class="ident" id="1735323">reflect_chanrecv</span><span class="op" id="1735339">(</span><span class="ident" id="1735340">t</span>&nbsp;<span class="op" id="1735342">*</span><span class="ident" id="1735343"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026299">chantype</a></span><span class="op" id="1735351">,</span>&nbsp;<span class="ident" id="1735353">c</span>&nbsp;<span class="op" id="1735355">*</span><span class="ident" id="1735356"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026588">hchan</a></span><span class="op" id="1735361">,</span>&nbsp;<span class="ident" id="1735363">nb</span>&nbsp;<span class="builtintype" id="1735366">bool</span><span class="op" id="1735370">,</span>&nbsp;<span class="ident" id="1735372">elem</span>&nbsp;<span class="ident" id="1735377"><a href="/runtime/chan.go.html#1721991">unsafe</a></span><span class="op" id="1735383">.</span><span class="ident" id="1735384">Pointer</span><span class="op" id="1735391">)</span>&nbsp;<span class="op" id="1735393">(</span><span class="ident" id="1735394">selected</span>&nbsp;<span class="builtintype" id="1735403">bool</span><span class="op" id="1735407">,</span>&nbsp;<span class="ident" id="1735409">received</span>&nbsp;<span class="builtintype" id="1735418">bool</span><span class="op" id="1735422">)</span>&nbsp;<span class="op" id="1735424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1735427">return</span>&nbsp;<span class="ident" id="1735434"><a href="/runtime/chan.go.html#1729758">chanrecv</a></span><span class="op" id="1735442">(</span><span class="ident" id="1735443"><a href="/runtime/chan.go.html#1735340">t</a></span><span class="op" id="1735444">,</span>&nbsp;<span class="ident" id="1735446"><a href="/runtime/chan.go.html#1735353">c</a></span><span class="op" id="1735447">,</span>&nbsp;<span class="ident" id="1735449"><a href="/runtime/chan.go.html#1735372">elem</a></span><span class="op" id="1735453">,</span>&nbsp;<span class="op" id="1735455">!</span><span class="ident" id="1735456"><a href="/runtime/chan.go.html#1735363">nb</a></span><span class="op" id="1735458">)</span><br>
<span class="lineno"></span><span class="op" id="1735460">}</span><br>
<span class="lineno">600</span><br>
<span class="lineno"></span><span class="keyword" id="1735463">func</span>&nbsp;<span class="ident" id="1735468">reflect_chanlen</span><span class="op" id="1735483">(</span><span class="ident" id="1735484">c</span>&nbsp;<span class="op" id="1735486">*</span><span class="ident" id="1735487"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026588">hchan</a></span><span class="op" id="1735492">)</span>&nbsp;<span class="builtintype" id="1735494">int</span>&nbsp;<span class="op" id="1735498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1735501">if</span>&nbsp;<span class="ident" id="1735504"><a href="/runtime/chan.go.html#1735484">c</a></span>&nbsp;<span class="op" id="1735506">==</span>&nbsp;<span class="ident" id="1735509">nil</span>&nbsp;<span class="op" id="1735513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1735517">return</span>&nbsp;<span class="num" id="1735524">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1735527">}</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1735530">return</span>&nbsp;<span class="builtintype" id="1735537">int</span><span class="op" id="1735540">(</span><span class="ident" id="1735541"><a href="/runtime/chan.go.html#1735484">c</a></span><span class="op" id="1735542">.</span><span class="ident" id="1735543">qcount</span><span class="op" id="1735549">)</span><br>
<span class="lineno"></span><span class="op" id="1735551">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1735554">func</span>&nbsp;<span class="ident" id="1735559">reflect_chancap</span><span class="op" id="1735574">(</span><span class="ident" id="1735575">c</span>&nbsp;<span class="op" id="1735577">*</span><span class="ident" id="1735578"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026588">hchan</a></span><span class="op" id="1735583">)</span>&nbsp;<span class="builtintype" id="1735585">int</span>&nbsp;<span class="op" id="1735589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1735592">if</span>&nbsp;<span class="ident" id="1735595"><a href="/runtime/chan.go.html#1735575">c</a></span>&nbsp;<span class="op" id="1735597">==</span>&nbsp;<span class="ident" id="1735600">nil</span>&nbsp;<span class="op" id="1735604">{</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1735608">return</span>&nbsp;<span class="num" id="1735615">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1735618">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1735621">return</span>&nbsp;<span class="builtintype" id="1735628">int</span><span class="op" id="1735631">(</span><span class="ident" id="1735632"><a href="/runtime/chan.go.html#1735575">c</a></span><span class="op" id="1735633">.</span><span class="ident" id="1735634">dataqsiz</span><span class="op" id="1735642">)</span><br>
<span class="lineno"></span><span class="op" id="1735644">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">615</span><span class="keyword" id="1735647">func</span>&nbsp;<span class="op" id="1735652">(</span><span class="ident" id="1735653">q</span>&nbsp;<span class="op" id="1735655">*</span><span class="ident" id="1735656"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026538">waitq</a></span><span class="op" id="1735661">)</span>&nbsp;<span class="ident" id="1735663">enqueue</span><span class="op" id="1735670">(</span><span class="ident" id="1735671">sgp</span>&nbsp;<span class="op" id="1735675">*</span><span class="ident" id="1735676"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2016716">sudog</a></span><span class="op" id="1735681">)</span>&nbsp;<span class="op" id="1735683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1735686"><a href="/runtime/chan.go.html#1735671">sgp</a></span><span class="op" id="1735689">.</span><span class="ident" id="1735690">next</span>&nbsp;<span class="op" id="1735695">=</span>&nbsp;<span class="ident" id="1735697">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1735702">if</span>&nbsp;<span class="ident" id="1735705"><a href="/runtime/chan.go.html#1735653">q</a></span><span class="op" id="1735706">.</span><span class="ident" id="1735707">first</span>&nbsp;<span class="op" id="1735713">==</span>&nbsp;<span class="ident" id="1735716">nil</span>&nbsp;<span class="op" id="1735720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1735724"><a href="/runtime/chan.go.html#1735653">q</a></span><span class="op" id="1735725">.</span><span class="ident" id="1735726">first</span>&nbsp;<span class="op" id="1735732">=</span>&nbsp;<span class="ident" id="1735734"><a href="/runtime/chan.go.html#1735671">sgp</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1735740"><a href="/runtime/chan.go.html#1735653">q</a></span><span class="op" id="1735741">.</span><span class="ident" id="1735742">last</span>&nbsp;<span class="op" id="1735747">=</span>&nbsp;<span class="ident" id="1735749"><a href="/runtime/chan.go.html#1735671">sgp</a></span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1735755">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1735763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1735766"><a href="/runtime/chan.go.html#1735653">q</a></span><span class="op" id="1735767">.</span><span class="ident" id="1735768">last</span><span class="op" id="1735772">.</span><span class="ident" id="1735773">next</span>&nbsp;<span class="op" id="1735778">=</span>&nbsp;<span class="ident" id="1735780"><a href="/runtime/chan.go.html#1735671">sgp</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1735785"><a href="/runtime/chan.go.html#1735653">q</a></span><span class="op" id="1735786">.</span><span class="ident" id="1735787">last</span>&nbsp;<span class="op" id="1735792">=</span>&nbsp;<span class="ident" id="1735794"><a href="/runtime/chan.go.html#1735671">sgp</a></span><br>
<span class="lineno"></span><span class="op" id="1735798">}</span><br>
<span class="lineno">625</span><br>
<span class="lineno"></span><span class="keyword" id="1735801">func</span>&nbsp;<span class="op" id="1735806">(</span><span class="ident" id="1735807">q</span>&nbsp;<span class="op" id="1735809">*</span><span class="ident" id="1735810"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026538">waitq</a></span><span class="op" id="1735815">)</span>&nbsp;<span class="ident" id="1735817">dequeue</span><span class="op" id="1735824">(</span><span class="op" id="1735825">)</span>&nbsp;<span class="op" id="1735827">*</span><span class="ident" id="1735828"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2016716">sudog</a></span>&nbsp;<span class="op" id="1735834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1735837">for</span>&nbsp;<span class="op" id="1735841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1735845">sgp</span>&nbsp;<span class="op" id="1735849">:=</span>&nbsp;<span class="ident" id="1735852"><a href="/runtime/chan.go.html#1735807">q</a></span><span class="op" id="1735853">.</span><span class="ident" id="1735854">first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1735862">if</span>&nbsp;<span class="ident" id="1735865"><a href="/runtime/chan.go.html#1735845">sgp</a></span>&nbsp;<span class="op" id="1735869">==</span>&nbsp;<span class="ident" id="1735872">nil</span>&nbsp;<span class="op" id="1735876">{</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1735881">return</span>&nbsp;<span class="ident" id="1735888">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1735894">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1735898"><a href="/runtime/chan.go.html#1735807">q</a></span><span class="op" id="1735899">.</span><span class="ident" id="1735900">first</span>&nbsp;<span class="op" id="1735906">=</span>&nbsp;<span class="ident" id="1735908"><a href="/runtime/chan.go.html#1735845">sgp</a></span><span class="op" id="1735911">.</span><span class="ident" id="1735912">next</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1735919"><a href="/runtime/chan.go.html#1735845">sgp</a></span><span class="op" id="1735922">.</span><span class="ident" id="1735923">next</span>&nbsp;<span class="op" id="1735928">=</span>&nbsp;<span class="ident" id="1735930">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1735936">if</span>&nbsp;<span class="ident" id="1735939"><a href="/runtime/chan.go.html#1735807">q</a></span><span class="op" id="1735940">.</span><span class="ident" id="1735941">last</span>&nbsp;<span class="op" id="1735946">==</span>&nbsp;<span class="ident" id="1735949"><a href="/runtime/chan.go.html#1735845">sgp</a></span>&nbsp;<span class="op" id="1735953">{</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1735958"><a href="/runtime/chan.go.html#1735807">q</a></span><span class="op" id="1735959">.</span><span class="ident" id="1735960">last</span>&nbsp;<span class="op" id="1735965">=</span>&nbsp;<span class="ident" id="1735967">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1735973">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1735978">//&nbsp;if&nbsp;sgp&nbsp;participates&nbsp;in&nbsp;a&nbsp;select&nbsp;and&nbsp;is&nbsp;already&nbsp;signaled,&nbsp;ignore&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1736050">if</span>&nbsp;<span class="ident" id="1736053"><a href="/runtime/chan.go.html#1735845">sgp</a></span><span class="op" id="1736056">.</span><span class="ident" id="1736057">selectdone</span>&nbsp;<span class="op" id="1736068">!=</span>&nbsp;<span class="ident" id="1736071">nil</span>&nbsp;<span class="op" id="1736075">{</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1736080">//&nbsp;claim&nbsp;the&nbsp;right&nbsp;to&nbsp;signal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1736112">if</span>&nbsp;<span class="op" id="1736115">*</span><span class="ident" id="1736116"><a href="/runtime/chan.go.html#1735845">sgp</a></span><span class="op" id="1736119">.</span><span class="ident" id="1736120">selectdone</span>&nbsp;<span class="op" id="1736131">!=</span>&nbsp;<span class="num" id="1736134">0</span>&nbsp;<span class="op" id="1736136">||</span>&nbsp;<span class="op" id="1736139">!</span><span class="ident" id="1736140"><a href="/runtime/stubs.go.html#1974711">cas</a></span><span class="op" id="1736143">(</span><span class="ident" id="1736144"><a href="/runtime/chan.go.html#1735845">sgp</a></span><span class="op" id="1736147">.</span><span class="ident" id="1736148">selectdone</span><span class="op" id="1736158">,</span>&nbsp;<span class="num" id="1736160">0</span><span class="op" id="1736161">,</span>&nbsp;<span class="num" id="1736163">1</span><span class="op" id="1736164">)</span>&nbsp;<span class="op" id="1736166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1736172">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1736184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1736188">}</span><br>
<span class="lineno">645</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1736193">return</span>&nbsp;<span class="ident" id="1736200"><a href="/runtime/chan.go.html#1735845">sgp</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1736205">}</span><br>
<span class="lineno"></span><span class="op" id="1736207">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">650</span><span class="keyword" id="1736210">func</span>&nbsp;<span class="ident" id="1736215">racesync</span><span class="op" id="1736223">(</span><span class="ident" id="1736224">c</span>&nbsp;<span class="op" id="1736226">*</span><span class="ident" id="1736227"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2026588">hchan</a></span><span class="op" id="1736232">,</span>&nbsp;<span class="ident" id="1736234">sg</span>&nbsp;<span class="op" id="1736237">*</span><span class="ident" id="1736238"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2016716">sudog</a></span><span class="op" id="1736243">)</span>&nbsp;<span class="op" id="1736245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1736248"><a href="/runtime/race0.go.html#1907639">racerelease</a></span><span class="op" id="1736259">(</span><span class="ident" id="1736260"><a href="/runtime/chan.go.html#1723676">chanbuf</a></span><span class="op" id="1736267">(</span><span class="ident" id="1736268"><a href="/runtime/chan.go.html#1736224">c</a></span><span class="op" id="1736269">,</span>&nbsp;<span class="num" id="1736271">0</span><span class="op" id="1736272">)</span><span class="op" id="1736273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1736276"><a href="/runtime/race0.go.html#1907543">raceacquireg</a></span><span class="op" id="1736288">(</span><span class="ident" id="1736289"><a href="/runtime/chan.go.html#1736234">sg</a></span><span class="op" id="1736291">.</span><span class="ident" id="1736292">g</span><span class="op" id="1736293">,</span>&nbsp;<span class="ident" id="1736295"><a href="/runtime/chan.go.html#1723676">chanbuf</a></span><span class="op" id="1736302">(</span><span class="ident" id="1736303"><a href="/runtime/chan.go.html#1736224">c</a></span><span class="op" id="1736304">,</span>&nbsp;<span class="num" id="1736306">0</span><span class="op" id="1736307">)</span><span class="op" id="1736308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1736311"><a href="/runtime/race0.go.html#1907735">racereleaseg</a></span><span class="op" id="1736323">(</span><span class="ident" id="1736324"><a href="/runtime/chan.go.html#1736234">sg</a></span><span class="op" id="1736326">.</span><span class="ident" id="1736327">g</span><span class="op" id="1736328">,</span>&nbsp;<span class="ident" id="1736330"><a href="/runtime/chan.go.html#1723676">chanbuf</a></span><span class="op" id="1736337">(</span><span class="ident" id="1736338"><a href="/runtime/chan.go.html#1736224">c</a></span><span class="op" id="1736339">,</span>&nbsp;<span class="num" id="1736341">0</span><span class="op" id="1736342">)</span><span class="op" id="1736343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1736346"><a href="/runtime/race0.go.html#1907447">raceacquire</a></span><span class="op" id="1736357">(</span><span class="ident" id="1736358"><a href="/runtime/chan.go.html#1723676">chanbuf</a></span><span class="op" id="1736365">(</span><span class="ident" id="1736366"><a href="/runtime/chan.go.html#1736224">c</a></span><span class="op" id="1736367">,</span>&nbsp;<span class="num" id="1736369">0</span><span class="op" id="1736370">)</span><span class="op" id="1736371">)</span><br>
<span class="lineno">655</span><span class="op" id="1736373">}</span>
</div>
</body>
</html>
