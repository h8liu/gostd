<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/rsa</h2>
<ul>
<li><a href="/gostd/crypto/rsa/pkcs1v15.go.html">pkcs1v15.go</a></li>
<li><a href="/gostd/crypto/rsa/pkcs1v15_test.go.html">pkcs1v15_test.go</a></li>
<li><a href="/gostd/crypto/rsa/pss.go.html">pss.go</a></li>
<li><a href="/gostd/crypto/rsa/pss_test.go.html">pss_test.go</a></li>
<li><a href="/gostd/crypto/rsa/rsa.go.html">rsa.go</a></li>
<li><a href="/gostd/crypto/rsa/rsa_test.go.html">rsa_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3711920">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3711975">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3712029">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3712080">//&nbsp;Package&nbsp;rsa&nbsp;implements&nbsp;RSA&nbsp;encryption&nbsp;as&nbsp;specified&nbsp;in&nbsp;PKCS#1.</span><br>
<span class="lineno"></span><span class="keyword" id="3712145">package</span>&nbsp;<span class="ident" id="3712153">rsa</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3712158">import</span>&nbsp;<span class="op" id="3712165">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3712168">&#34;crypto&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3712178">&#34;crypto/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3712193">&#34;crypto/subtle&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3712210">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3712220">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3712228">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3712234">&#34;math/big&#34;</span><br>
<span class="lineno"></span><span class="op" id="3712245">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3712248">var</span>&nbsp;<span class="ident" id="3712252">bigZero</span>&nbsp;<span class="op" id="3712260">=</span>&nbsp;<span class="ident" id="3712262">big</span><span class="op" id="3712265">.</span><span class="ident" id="3712266">NewInt</span><span class="op" id="3712272">(</span><span class="num" id="3712273">0</span><span class="op" id="3712274">)</span><br>
<span class="lineno"></span><span class="keyword" id="3712276">var</span>&nbsp;<span class="ident" id="3712280">bigOne</span>&nbsp;<span class="op" id="3712287">=</span>&nbsp;<span class="ident" id="3712289">big</span><span class="op" id="3712292">.</span><span class="ident" id="3712293">NewInt</span><span class="op" id="3712299">(</span><span class="num" id="3712300">1</span><span class="op" id="3712301">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="3712304">//&nbsp;A&nbsp;PublicKey&nbsp;represents&nbsp;the&nbsp;public&nbsp;part&nbsp;of&nbsp;an&nbsp;RSA&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="3712361">type</span>&nbsp;<span class="ident" id="3712366">PublicKey</span>&nbsp;<span class="keyword" id="3712376">struct</span>&nbsp;<span class="op" id="3712383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3712386">N</span>&nbsp;<span class="op" id="3712388">*</span><span class="ident" id="3712389">big</span><span class="op" id="3712392">.</span><span class="ident" id="3712393">Int</span>&nbsp;<span class="comment" id="3712397">//&nbsp;modulus</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3712409">E</span>&nbsp;<span class="builtintype" id="3712411">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3712420">//&nbsp;public&nbsp;exponent</span><br>
<span class="lineno">25</span><span class="op" id="3712439">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3712442">var</span>&nbsp;<span class="op" id="3712446">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3712449">errPublicModulus</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3712472">=</span>&nbsp;<span class="ident" id="3712474">errors</span><span class="op" id="3712480">.</span><span class="ident" id="3712481">New</span><span class="op" id="3712484">(</span><span class="string" id="3712485">&#34;crypto/rsa:&nbsp;missing&nbsp;public&nbsp;modulus&#34;</span><span class="op" id="3712521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3712524">errPublicExponentSmall</span>&nbsp;<span class="op" id="3712547">=</span>&nbsp;<span class="ident" id="3712549">errors</span><span class="op" id="3712555">.</span><span class="ident" id="3712556">New</span><span class="op" id="3712559">(</span><span class="string" id="3712560">&#34;crypto/rsa:&nbsp;public&nbsp;exponent&nbsp;too&nbsp;small&#34;</span><span class="op" id="3712599">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3712602">errPublicExponentLarge</span>&nbsp;<span class="op" id="3712625">=</span>&nbsp;<span class="ident" id="3712627">errors</span><span class="op" id="3712633">.</span><span class="ident" id="3712634">New</span><span class="op" id="3712637">(</span><span class="string" id="3712638">&#34;crypto/rsa:&nbsp;public&nbsp;exponent&nbsp;too&nbsp;large&#34;</span><span class="op" id="3712677">)</span><br>
<span class="lineno"></span><span class="op" id="3712679">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3712682">//&nbsp;checkPub&nbsp;sanity&nbsp;checks&nbsp;the&nbsp;public&nbsp;key&nbsp;before&nbsp;we&nbsp;use&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="3712741">//&nbsp;We&nbsp;require&nbsp;pub.E&nbsp;to&nbsp;fit&nbsp;into&nbsp;a&nbsp;32-bit&nbsp;integer&nbsp;so&nbsp;that&nbsp;we</span><br>
<span class="lineno">35</span><span class="comment" id="3712801">//&nbsp;do&nbsp;not&nbsp;have&nbsp;different&nbsp;behavior&nbsp;depending&nbsp;on&nbsp;whether</span><br>
<span class="lineno"></span><span class="comment" id="3712856">//&nbsp;int&nbsp;is&nbsp;32&nbsp;or&nbsp;64&nbsp;bits.&nbsp;See&nbsp;also</span><br>
<span class="lineno"></span><span class="comment" id="3712890">//&nbsp;http://www.imperialviolet.org/2012/03/16/rsae.html.</span><br>
<span class="lineno"></span><span class="keyword" id="3712945">func</span>&nbsp;<span class="ident" id="3712950">checkPub</span><span class="op" id="3712958">(</span><span class="ident" id="3712959">pub</span>&nbsp;<span class="op" id="3712963">*</span><span class="ident" id="3712964">PublicKey</span><span class="op" id="3712973">)</span>&nbsp;<span class="builtintype" id="3712975">error</span>&nbsp;<span class="op" id="3712981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3712984">if</span>&nbsp;<span class="ident" id="3712987">pub</span><span class="op" id="3712990">.</span><span class="ident" id="3712991">N</span>&nbsp;<span class="op" id="3712993">==</span>&nbsp;<span class="ident" id="3712996">nil</span>&nbsp;<span class="op" id="3713000">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3713004">return</span>&nbsp;<span class="ident" id="3713011">errPublicModulus</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3713029">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3713032">if</span>&nbsp;<span class="ident" id="3713035">pub</span><span class="op" id="3713038">.</span><span class="ident" id="3713039">E</span>&nbsp;<span class="op" id="3713041">&lt;</span>&nbsp;<span class="num" id="3713043">2</span>&nbsp;<span class="op" id="3713045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3713049">return</span>&nbsp;<span class="ident" id="3713056">errPublicExponentSmall</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3713080">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3713083">if</span>&nbsp;<span class="ident" id="3713086">pub</span><span class="op" id="3713089">.</span><span class="ident" id="3713090">E</span>&nbsp;<span class="op" id="3713092">&gt;</span>&nbsp;<span class="num" id="3713094">1</span><span class="op" id="3713095">&lt;&lt;</span><span class="num" id="3713097">31</span><span class="op" id="3713099">-</span><span class="num" id="3713100">1</span>&nbsp;<span class="op" id="3713102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3713106">return</span>&nbsp;<span class="ident" id="3713113">errPublicExponentLarge</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3713137">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3713140">return</span>&nbsp;<span class="ident" id="3713147">nil</span><br>
<span class="lineno"></span><span class="op" id="3713151">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="comment" id="3713154">//&nbsp;A&nbsp;PrivateKey&nbsp;represents&nbsp;an&nbsp;RSA&nbsp;key</span><br>
<span class="lineno"></span><span class="keyword" id="3713192">type</span>&nbsp;<span class="ident" id="3713197">PrivateKey</span>&nbsp;<span class="keyword" id="3713208">struct</span>&nbsp;<span class="op" id="3713215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3713218">PublicKey</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3713239">//&nbsp;public&nbsp;part.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3713256">D</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3713266">*</span><span class="ident" id="3713267">big</span><span class="op" id="3713270">.</span><span class="ident" id="3713271">Int</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="3713277">//&nbsp;private&nbsp;exponent</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3713298">Primes</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3713308">[</span><span class="op" id="3713309">]</span><span class="op" id="3713310">*</span><span class="ident" id="3713311">big</span><span class="op" id="3713314">.</span><span class="ident" id="3713315">Int</span>&nbsp;<span class="comment" id="3713319">//&nbsp;prime&nbsp;factors&nbsp;of&nbsp;N,&nbsp;has&nbsp;&gt;=&nbsp;2&nbsp;elements.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3713363">//&nbsp;Precomputed&nbsp;contains&nbsp;precomputed&nbsp;values&nbsp;that&nbsp;speed&nbsp;up&nbsp;private</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3713429">//&nbsp;operations,&nbsp;if&nbsp;available.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3713459">Precomputed</span>&nbsp;<span class="ident" id="3713471">PrecomputedValues</span><br>
<span class="lineno">60</span><span class="op" id="3713489">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3713492">//&nbsp;Public&nbsp;returns&nbsp;the&nbsp;public&nbsp;key&nbsp;corresponding&nbsp;to&nbsp;priv.</span><br>
<span class="lineno"></span><span class="keyword" id="3713548">func</span>&nbsp;<span class="op" id="3713553">(</span><span class="ident" id="3713554">priv</span>&nbsp;<span class="op" id="3713559">*</span><span class="ident" id="3713560">PrivateKey</span><span class="op" id="3713570">)</span>&nbsp;<span class="ident" id="3713572">Public</span><span class="op" id="3713578">(</span><span class="op" id="3713579">)</span>&nbsp;<span class="ident" id="3713581">crypto</span><span class="op" id="3713587">.</span><span class="ident" id="3713588">PublicKey</span>&nbsp;<span class="op" id="3713598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3713601">return</span>&nbsp;<span class="op" id="3713608">&amp;</span><span class="ident" id="3713609">priv</span><span class="op" id="3713613">.</span><span class="ident" id="3713614">PublicKey</span><br>
<span class="lineno">65</span><span class="op" id="3713624">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3713627">//&nbsp;Sign&nbsp;signs&nbsp;msg&nbsp;with&nbsp;priv,&nbsp;reading&nbsp;randomness&nbsp;from&nbsp;rand.&nbsp;If&nbsp;opts&nbsp;is&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3713699">//&nbsp;*PSSOptions&nbsp;then&nbsp;the&nbsp;PSS&nbsp;algorithm&nbsp;will&nbsp;be&nbsp;used,&nbsp;otherwise&nbsp;PKCS#1&nbsp;v1.5&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="3713778">//&nbsp;be&nbsp;used.&nbsp;This&nbsp;method&nbsp;is&nbsp;intended&nbsp;to&nbsp;support&nbsp;keys&nbsp;where&nbsp;the&nbsp;private&nbsp;part&nbsp;is</span><br>
<span class="lineno">70</span><span class="comment" id="3713856">//&nbsp;kept&nbsp;in,&nbsp;for&nbsp;example,&nbsp;a&nbsp;hardware&nbsp;module.&nbsp;Common&nbsp;uses&nbsp;should&nbsp;use&nbsp;the&nbsp;Sign*</span><br>
<span class="lineno"></span><span class="comment" id="3713933">//&nbsp;functions&nbsp;in&nbsp;this&nbsp;package.</span><br>
<span class="lineno"></span><span class="keyword" id="3713963">func</span>&nbsp;<span class="op" id="3713968">(</span><span class="ident" id="3713969">priv</span>&nbsp;<span class="op" id="3713974">*</span><span class="ident" id="3713975">PrivateKey</span><span class="op" id="3713985">)</span>&nbsp;<span class="ident" id="3713987">Sign</span><span class="op" id="3713991">(</span><span class="ident" id="3713992">rand</span>&nbsp;<span class="ident" id="3713997">io</span><span class="op" id="3713999">.</span><span class="ident" id="3714000">Reader</span><span class="op" id="3714006">,</span>&nbsp;<span class="ident" id="3714008">msg</span>&nbsp;<span class="op" id="3714012">[</span><span class="op" id="3714013">]</span><span class="builtintype" id="3714014">byte</span><span class="op" id="3714018">,</span>&nbsp;<span class="ident" id="3714020">opts</span>&nbsp;<span class="ident" id="3714025">crypto</span><span class="op" id="3714031">.</span><span class="ident" id="3714032">SignerOpts</span><span class="op" id="3714042">)</span>&nbsp;<span class="op" id="3714044">(</span><span class="op" id="3714045">[</span><span class="op" id="3714046">]</span><span class="builtintype" id="3714047">byte</span><span class="op" id="3714051">,</span>&nbsp;<span class="builtintype" id="3714053">error</span><span class="op" id="3714058">)</span>&nbsp;<span class="op" id="3714060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3714063">if</span>&nbsp;<span class="ident" id="3714066">pssOpts</span><span class="op" id="3714073">,</span>&nbsp;<span class="ident" id="3714075">ok</span>&nbsp;<span class="op" id="3714078">:=</span>&nbsp;<span class="ident" id="3714081">opts</span><span class="op" id="3714085">.</span><span class="op" id="3714086">(</span><span class="op" id="3714087">*</span><span class="ident" id="3714088">PSSOptions</span><span class="op" id="3714098">)</span><span class="op" id="3714099">;</span>&nbsp;<span class="ident" id="3714101">ok</span>&nbsp;<span class="op" id="3714104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3714108">return</span>&nbsp;<span class="ident" id="3714115">SignPSS</span><span class="op" id="3714122">(</span><span class="ident" id="3714123">rand</span><span class="op" id="3714127">,</span>&nbsp;<span class="ident" id="3714129">priv</span><span class="op" id="3714133">,</span>&nbsp;<span class="ident" id="3714135">pssOpts</span><span class="op" id="3714142">.</span><span class="ident" id="3714143">Hash</span><span class="op" id="3714147">,</span>&nbsp;<span class="ident" id="3714149">msg</span><span class="op" id="3714152">,</span>&nbsp;<span class="ident" id="3714154">pssOpts</span><span class="op" id="3714161">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3714164">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3714168">return</span>&nbsp;<span class="ident" id="3714175">SignPKCS1v15</span><span class="op" id="3714187">(</span><span class="ident" id="3714188">rand</span><span class="op" id="3714192">,</span>&nbsp;<span class="ident" id="3714194">priv</span><span class="op" id="3714198">,</span>&nbsp;<span class="ident" id="3714200">opts</span><span class="op" id="3714204">.</span><span class="ident" id="3714205">HashFunc</span><span class="op" id="3714213">(</span><span class="op" id="3714214">)</span><span class="op" id="3714215">,</span>&nbsp;<span class="ident" id="3714217">msg</span><span class="op" id="3714220">)</span><br>
<span class="lineno"></span><span class="op" id="3714222">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="3714225">type</span>&nbsp;<span class="ident" id="3714230">PrecomputedValues</span>&nbsp;<span class="keyword" id="3714248">struct</span>&nbsp;<span class="op" id="3714255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3714258">Dp</span><span class="op" id="3714260">,</span>&nbsp;<span class="ident" id="3714262">Dq</span>&nbsp;<span class="op" id="3714265">*</span><span class="ident" id="3714266">big</span><span class="op" id="3714269">.</span><span class="ident" id="3714270">Int</span>&nbsp;<span class="comment" id="3714274">//&nbsp;D&nbsp;mod&nbsp;(P-1)&nbsp;(or&nbsp;mod&nbsp;Q-1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3714303">Qinv</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3714310">*</span><span class="ident" id="3714311">big</span><span class="op" id="3714314">.</span><span class="ident" id="3714315">Int</span>&nbsp;<span class="comment" id="3714319">//&nbsp;Q^-1&nbsp;mod&nbsp;P</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3714335">//&nbsp;CRTValues&nbsp;is&nbsp;used&nbsp;for&nbsp;the&nbsp;3rd&nbsp;and&nbsp;subsequent&nbsp;primes.&nbsp;Due&nbsp;to&nbsp;a</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3714401">//&nbsp;historical&nbsp;accident,&nbsp;the&nbsp;CRT&nbsp;for&nbsp;the&nbsp;first&nbsp;two&nbsp;primes&nbsp;is&nbsp;handled</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3714470">//&nbsp;differently&nbsp;in&nbsp;PKCS#1&nbsp;and&nbsp;interoperability&nbsp;is&nbsp;sufficiently</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3714533">//&nbsp;important&nbsp;that&nbsp;we&nbsp;mirror&nbsp;this.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3714568">CRTValues</span>&nbsp;<span class="op" id="3714578">[</span><span class="op" id="3714579">]</span><span class="ident" id="3714580">CRTValue</span><br>
<span class="lineno"></span><span class="op" id="3714589">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="comment" id="3714592">//&nbsp;CRTValue&nbsp;contains&nbsp;the&nbsp;precomputed&nbsp;chinese&nbsp;remainder&nbsp;theorem&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="3714663">type</span>&nbsp;<span class="ident" id="3714668">CRTValue</span>&nbsp;<span class="keyword" id="3714677">struct</span>&nbsp;<span class="op" id="3714684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3714687">Exp</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3714693">*</span><span class="ident" id="3714694">big</span><span class="op" id="3714697">.</span><span class="ident" id="3714698">Int</span>&nbsp;<span class="comment" id="3714702">//&nbsp;D&nbsp;mod&nbsp;(prime-1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3714723">Coeff</span>&nbsp;<span class="op" id="3714729">*</span><span class="ident" id="3714730">big</span><span class="op" id="3714733">.</span><span class="ident" id="3714734">Int</span>&nbsp;<span class="comment" id="3714738">//&nbsp;R·Coeff&nbsp;≡&nbsp;1&nbsp;mod&nbsp;Prime.</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3714768">R</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3714774">*</span><span class="ident" id="3714775">big</span><span class="op" id="3714778">.</span><span class="ident" id="3714779">Int</span>&nbsp;<span class="comment" id="3714783">//&nbsp;product&nbsp;of&nbsp;primes&nbsp;prior&nbsp;to&nbsp;this&nbsp;(inc&nbsp;p&nbsp;and&nbsp;q).</span><br>
<span class="lineno"></span><span class="op" id="3714833">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3714836">//&nbsp;Validate&nbsp;performs&nbsp;basic&nbsp;sanity&nbsp;checks&nbsp;on&nbsp;the&nbsp;key.</span><br>
<span class="lineno"></span><span class="comment" id="3714889">//&nbsp;It&nbsp;returns&nbsp;nil&nbsp;if&nbsp;the&nbsp;key&nbsp;is&nbsp;valid,&nbsp;or&nbsp;else&nbsp;an&nbsp;error&nbsp;describing&nbsp;a&nbsp;problem.</span><br>
<span class="lineno">100</span><span class="keyword" id="3714967">func</span>&nbsp;<span class="op" id="3714972">(</span><span class="ident" id="3714973">priv</span>&nbsp;<span class="op" id="3714978">*</span><span class="ident" id="3714979">PrivateKey</span><span class="op" id="3714989">)</span>&nbsp;<span class="ident" id="3714991">Validate</span><span class="op" id="3714999">(</span><span class="op" id="3715000">)</span>&nbsp;<span class="builtintype" id="3715002">error</span>&nbsp;<span class="op" id="3715008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3715011">if</span>&nbsp;<span class="ident" id="3715014">err</span>&nbsp;<span class="op" id="3715018">:=</span>&nbsp;<span class="ident" id="3715021">checkPub</span><span class="op" id="3715029">(</span><span class="op" id="3715030">&amp;</span><span class="ident" id="3715031">priv</span><span class="op" id="3715035">.</span><span class="ident" id="3715036">PublicKey</span><span class="op" id="3715045">)</span><span class="op" id="3715046">;</span>&nbsp;<span class="ident" id="3715048">err</span>&nbsp;<span class="op" id="3715052">!=</span>&nbsp;<span class="ident" id="3715055">nil</span>&nbsp;<span class="op" id="3715059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3715063">return</span>&nbsp;<span class="ident" id="3715070">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3715075">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3715079">//&nbsp;Check&nbsp;that&nbsp;the&nbsp;prime&nbsp;factors&nbsp;are&nbsp;actually&nbsp;prime.&nbsp;Note&nbsp;that&nbsp;this&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3715150">//&nbsp;just&nbsp;a&nbsp;sanity&nbsp;check.&nbsp;Since&nbsp;the&nbsp;random&nbsp;witnesses&nbsp;chosen&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3715212">//&nbsp;ProbablyPrime&nbsp;are&nbsp;deterministic,&nbsp;given&nbsp;the&nbsp;candidate&nbsp;number,&nbsp;it&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3715282">//&nbsp;easy&nbsp;for&nbsp;an&nbsp;attack&nbsp;to&nbsp;generate&nbsp;composites&nbsp;that&nbsp;pass&nbsp;this&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3715349">for</span>&nbsp;<span class="ident" id="3715353">_</span><span class="op" id="3715354">,</span>&nbsp;<span class="ident" id="3715356">prime</span>&nbsp;<span class="op" id="3715362">:=</span>&nbsp;<span class="keyword" id="3715365">range</span>&nbsp;<span class="ident" id="3715371">priv</span><span class="op" id="3715375">.</span><span class="ident" id="3715376">Primes</span>&nbsp;<span class="op" id="3715383">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3715387">if</span>&nbsp;<span class="op" id="3715390">!</span><span class="ident" id="3715391">prime</span><span class="op" id="3715396">.</span><span class="ident" id="3715397">ProbablyPrime</span><span class="op" id="3715410">(</span><span class="num" id="3715411">20</span><span class="op" id="3715413">)</span>&nbsp;<span class="op" id="3715415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3715420">return</span>&nbsp;<span class="ident" id="3715427">errors</span><span class="op" id="3715433">.</span><span class="ident" id="3715434">New</span><span class="op" id="3715437">(</span><span class="string" id="3715438">&#34;crypto/rsa:&nbsp;prime&nbsp;factor&nbsp;is&nbsp;composite&#34;</span><span class="op" id="3715477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3715481">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3715484">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3715488">//&nbsp;Check&nbsp;that&nbsp;Πprimes&nbsp;==&nbsp;n.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3715518">modulus</span>&nbsp;<span class="op" id="3715526">:=</span>&nbsp;<span class="builtinfunc" id="3715529">new</span><span class="op" id="3715532">(</span><span class="ident" id="3715533">big</span><span class="op" id="3715536">.</span><span class="ident" id="3715537">Int</span><span class="op" id="3715540">)</span><span class="op" id="3715541">.</span><span class="ident" id="3715542">Set</span><span class="op" id="3715545">(</span><span class="ident" id="3715546">bigOne</span><span class="op" id="3715552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3715555">for</span>&nbsp;<span class="ident" id="3715559">_</span><span class="op" id="3715560">,</span>&nbsp;<span class="ident" id="3715562">prime</span>&nbsp;<span class="op" id="3715568">:=</span>&nbsp;<span class="keyword" id="3715571">range</span>&nbsp;<span class="ident" id="3715577">priv</span><span class="op" id="3715581">.</span><span class="ident" id="3715582">Primes</span>&nbsp;<span class="op" id="3715589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3715593">modulus</span><span class="op" id="3715600">.</span><span class="ident" id="3715601">Mul</span><span class="op" id="3715604">(</span><span class="ident" id="3715605">modulus</span><span class="op" id="3715612">,</span>&nbsp;<span class="ident" id="3715614">prime</span><span class="op" id="3715619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3715622">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3715625">if</span>&nbsp;<span class="ident" id="3715628">modulus</span><span class="op" id="3715635">.</span><span class="ident" id="3715636">Cmp</span><span class="op" id="3715639">(</span><span class="ident" id="3715640">priv</span><span class="op" id="3715644">.</span><span class="ident" id="3715645">N</span><span class="op" id="3715646">)</span>&nbsp;<span class="op" id="3715648">!=</span>&nbsp;<span class="num" id="3715651">0</span>&nbsp;<span class="op" id="3715653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3715657">return</span>&nbsp;<span class="ident" id="3715664">errors</span><span class="op" id="3715670">.</span><span class="ident" id="3715671">New</span><span class="op" id="3715674">(</span><span class="string" id="3715675">&#34;crypto/rsa:&nbsp;invalid&nbsp;modulus&#34;</span><span class="op" id="3715704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3715707">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3715711">//&nbsp;Check&nbsp;that&nbsp;de&nbsp;≡&nbsp;1&nbsp;mod&nbsp;p-1,&nbsp;for&nbsp;each&nbsp;prime.</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3715760">//&nbsp;This&nbsp;implies&nbsp;that&nbsp;e&nbsp;is&nbsp;coprime&nbsp;to&nbsp;each&nbsp;p-1&nbsp;as&nbsp;e&nbsp;has&nbsp;a&nbsp;multiplicative</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3715833">//&nbsp;inverse.&nbsp;Therefore&nbsp;e&nbsp;is&nbsp;coprime&nbsp;to&nbsp;lcm(p-1,q-1,r-1,...)&nbsp;=</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3715895">//&nbsp;exponent(ℤ/nℤ).&nbsp;It&nbsp;also&nbsp;implies&nbsp;that&nbsp;a^de&nbsp;≡&nbsp;a&nbsp;mod&nbsp;p&nbsp;as&nbsp;a^(p-1)&nbsp;≡&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3715974">//&nbsp;mod&nbsp;p.&nbsp;Thus&nbsp;a^de&nbsp;≡&nbsp;a&nbsp;mod&nbsp;n&nbsp;for&nbsp;all&nbsp;a&nbsp;coprime&nbsp;to&nbsp;n,&nbsp;as&nbsp;required.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3716044">congruence</span>&nbsp;<span class="op" id="3716055">:=</span>&nbsp;<span class="builtinfunc" id="3716058">new</span><span class="op" id="3716061">(</span><span class="ident" id="3716062">big</span><span class="op" id="3716065">.</span><span class="ident" id="3716066">Int</span><span class="op" id="3716069">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3716072">de</span>&nbsp;<span class="op" id="3716075">:=</span>&nbsp;<span class="builtinfunc" id="3716078">new</span><span class="op" id="3716081">(</span><span class="ident" id="3716082">big</span><span class="op" id="3716085">.</span><span class="ident" id="3716086">Int</span><span class="op" id="3716089">)</span><span class="op" id="3716090">.</span><span class="ident" id="3716091">SetInt64</span><span class="op" id="3716099">(</span><span class="ident" id="3716100">int64</span><span class="op" id="3716105">(</span><span class="ident" id="3716106">priv</span><span class="op" id="3716110">.</span><span class="ident" id="3716111">E</span><span class="op" id="3716112">)</span><span class="op" id="3716113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3716116">de</span><span class="op" id="3716118">.</span><span class="ident" id="3716119">Mul</span><span class="op" id="3716122">(</span><span class="ident" id="3716123">de</span><span class="op" id="3716125">,</span>&nbsp;<span class="ident" id="3716127">priv</span><span class="op" id="3716131">.</span><span class="ident" id="3716132">D</span><span class="op" id="3716133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3716136">for</span>&nbsp;<span class="ident" id="3716140">_</span><span class="op" id="3716141">,</span>&nbsp;<span class="ident" id="3716143">prime</span>&nbsp;<span class="op" id="3716149">:=</span>&nbsp;<span class="keyword" id="3716152">range</span>&nbsp;<span class="ident" id="3716158">priv</span><span class="op" id="3716162">.</span><span class="ident" id="3716163">Primes</span>&nbsp;<span class="op" id="3716170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3716174">pminus1</span>&nbsp;<span class="op" id="3716182">:=</span>&nbsp;<span class="builtinfunc" id="3716185">new</span><span class="op" id="3716188">(</span><span class="ident" id="3716189">big</span><span class="op" id="3716192">.</span><span class="ident" id="3716193">Int</span><span class="op" id="3716196">)</span><span class="op" id="3716197">.</span><span class="ident" id="3716198">Sub</span><span class="op" id="3716201">(</span><span class="ident" id="3716202">prime</span><span class="op" id="3716207">,</span>&nbsp;<span class="ident" id="3716209">bigOne</span><span class="op" id="3716215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3716219">congruence</span><span class="op" id="3716229">.</span><span class="ident" id="3716230">Mod</span><span class="op" id="3716233">(</span><span class="ident" id="3716234">de</span><span class="op" id="3716236">,</span>&nbsp;<span class="ident" id="3716238">pminus1</span><span class="op" id="3716245">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3716249">if</span>&nbsp;<span class="ident" id="3716252">congruence</span><span class="op" id="3716262">.</span><span class="ident" id="3716263">Cmp</span><span class="op" id="3716266">(</span><span class="ident" id="3716267">bigOne</span><span class="op" id="3716273">)</span>&nbsp;<span class="op" id="3716275">!=</span>&nbsp;<span class="num" id="3716278">0</span>&nbsp;<span class="op" id="3716280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3716285">return</span>&nbsp;<span class="ident" id="3716292">errors</span><span class="op" id="3716298">.</span><span class="ident" id="3716299">New</span><span class="op" id="3716302">(</span><span class="string" id="3716303">&#34;crypto/rsa:&nbsp;invalid&nbsp;exponents&#34;</span><span class="op" id="3716334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3716338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3716341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3716344">return</span>&nbsp;<span class="ident" id="3716351">nil</span><br>
<span class="lineno">140</span><span class="op" id="3716355">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3716358">//&nbsp;GenerateKey&nbsp;generates&nbsp;an&nbsp;RSA&nbsp;keypair&nbsp;of&nbsp;the&nbsp;given&nbsp;bit&nbsp;size&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3716430">//&nbsp;random&nbsp;source&nbsp;random&nbsp;(for&nbsp;example,&nbsp;crypto/rand.Reader).</span><br>
<span class="lineno"></span><span class="keyword" id="3716489">func</span>&nbsp;<span class="ident" id="3716494">GenerateKey</span><span class="op" id="3716505">(</span><span class="ident" id="3716506">random</span>&nbsp;<span class="ident" id="3716513">io</span><span class="op" id="3716515">.</span><span class="ident" id="3716516">Reader</span><span class="op" id="3716522">,</span>&nbsp;<span class="ident" id="3716524">bits</span>&nbsp;<span class="builtintype" id="3716529">int</span><span class="op" id="3716532">)</span>&nbsp;<span class="op" id="3716534">(</span><span class="ident" id="3716535">priv</span>&nbsp;<span class="op" id="3716540">*</span><span class="ident" id="3716541">PrivateKey</span><span class="op" id="3716551">,</span>&nbsp;<span class="ident" id="3716553">err</span>&nbsp;<span class="builtintype" id="3716557">error</span><span class="op" id="3716562">)</span>&nbsp;<span class="op" id="3716564">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3716567">return</span>&nbsp;<span class="ident" id="3716574">GenerateMultiPrimeKey</span><span class="op" id="3716595">(</span><span class="ident" id="3716596">random</span><span class="op" id="3716602">,</span>&nbsp;<span class="num" id="3716604">2</span><span class="op" id="3716605">,</span>&nbsp;<span class="ident" id="3716607">bits</span><span class="op" id="3716611">)</span><br>
<span class="lineno"></span><span class="op" id="3716613">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3716616">//&nbsp;GenerateMultiPrimeKey&nbsp;generates&nbsp;a&nbsp;multi-prime&nbsp;RSA&nbsp;keypair&nbsp;of&nbsp;the&nbsp;given&nbsp;bit</span><br>
<span class="lineno"></span><span class="comment" id="3716694">//&nbsp;size&nbsp;and&nbsp;the&nbsp;given&nbsp;random&nbsp;source,&nbsp;as&nbsp;suggested&nbsp;in&nbsp;[1].&nbsp;Although&nbsp;the&nbsp;public</span><br>
<span class="lineno">150</span><span class="comment" id="3716772">//&nbsp;keys&nbsp;are&nbsp;compatible&nbsp;(actually,&nbsp;indistinguishable)&nbsp;from&nbsp;the&nbsp;2-prime&nbsp;case,</span><br>
<span class="lineno"></span><span class="comment" id="3716848">//&nbsp;the&nbsp;private&nbsp;keys&nbsp;are&nbsp;not.&nbsp;Thus&nbsp;it&nbsp;may&nbsp;not&nbsp;be&nbsp;possible&nbsp;to&nbsp;export&nbsp;multi-prime</span><br>
<span class="lineno"></span><span class="comment" id="3716927">//&nbsp;private&nbsp;keys&nbsp;in&nbsp;certain&nbsp;formats&nbsp;or&nbsp;to&nbsp;subsequently&nbsp;import&nbsp;them&nbsp;into&nbsp;other</span><br>
<span class="lineno"></span><span class="comment" id="3717004">//&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="3717013">//</span><br>
<span class="lineno">155</span><span class="comment" id="3717016">//&nbsp;Table&nbsp;1&nbsp;in&nbsp;[2]&nbsp;suggests&nbsp;maximum&nbsp;numbers&nbsp;of&nbsp;primes&nbsp;for&nbsp;a&nbsp;given&nbsp;size.</span><br>
<span class="lineno"></span><span class="comment" id="3717087">//</span><br>
<span class="lineno"></span><span class="comment" id="3717090">//&nbsp;[1]&nbsp;US&nbsp;patent&nbsp;4405829&nbsp;(1972,&nbsp;expired)</span><br>
<span class="lineno"></span><span class="comment" id="3717131">//&nbsp;[2]&nbsp;http://www.cacr.math.uwaterloo.ca/techreports/2006/cacr2006-16.pdf</span><br>
<span class="lineno"></span><span class="keyword" id="3717205">func</span>&nbsp;<span class="ident" id="3717210">GenerateMultiPrimeKey</span><span class="op" id="3717231">(</span><span class="ident" id="3717232">random</span>&nbsp;<span class="ident" id="3717239">io</span><span class="op" id="3717241">.</span><span class="ident" id="3717242">Reader</span><span class="op" id="3717248">,</span>&nbsp;<span class="ident" id="3717250">nprimes</span>&nbsp;<span class="builtintype" id="3717258">int</span><span class="op" id="3717261">,</span>&nbsp;<span class="ident" id="3717263">bits</span>&nbsp;<span class="builtintype" id="3717268">int</span><span class="op" id="3717271">)</span>&nbsp;<span class="op" id="3717273">(</span><span class="ident" id="3717274">priv</span>&nbsp;<span class="op" id="3717279">*</span><span class="ident" id="3717280">PrivateKey</span><span class="op" id="3717290">,</span>&nbsp;<span class="ident" id="3717292">err</span>&nbsp;<span class="builtintype" id="3717296">error</span><span class="op" id="3717301">)</span>&nbsp;<span class="op" id="3717303">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3717306">priv</span>&nbsp;<span class="op" id="3717311">=</span>&nbsp;<span class="builtinfunc" id="3717313">new</span><span class="op" id="3717316">(</span><span class="ident" id="3717317">PrivateKey</span><span class="op" id="3717327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3717330">priv</span><span class="op" id="3717334">.</span><span class="ident" id="3717335">E</span>&nbsp;<span class="op" id="3717337">=</span>&nbsp;<span class="num" id="3717339">65537</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3717347">if</span>&nbsp;<span class="ident" id="3717350">nprimes</span>&nbsp;<span class="op" id="3717358">&lt;</span>&nbsp;<span class="num" id="3717360">2</span>&nbsp;<span class="op" id="3717362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3717366">return</span>&nbsp;<span class="ident" id="3717373">nil</span><span class="op" id="3717376">,</span>&nbsp;<span class="ident" id="3717378">errors</span><span class="op" id="3717384">.</span><span class="ident" id="3717385">New</span><span class="op" id="3717388">(</span><span class="string" id="3717389">&#34;crypto/rsa:&nbsp;GenerateMultiPrimeKey:&nbsp;nprimes&nbsp;must&nbsp;be&nbsp;&gt;=&nbsp;2&#34;</span><span class="op" id="3717446">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3717449">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3717453">primes</span>&nbsp;<span class="op" id="3717460">:=</span>&nbsp;<span class="builtinfunc" id="3717463">make</span><span class="op" id="3717467">(</span><span class="op" id="3717468">[</span><span class="op" id="3717469">]</span><span class="op" id="3717470">*</span><span class="ident" id="3717471">big</span><span class="op" id="3717474">.</span><span class="ident" id="3717475">Int</span><span class="op" id="3717478">,</span>&nbsp;<span class="ident" id="3717480">nprimes</span><span class="op" id="3717487">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="3717490">NextSetOfPrimes</span><span class="op" id="3717505">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3717508">for</span>&nbsp;<span class="op" id="3717512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3717516">todo</span>&nbsp;<span class="op" id="3717521">:=</span>&nbsp;<span class="ident" id="3717524">bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3717531">//&nbsp;crypto/rand&nbsp;should&nbsp;set&nbsp;the&nbsp;top&nbsp;two&nbsp;bits&nbsp;in&nbsp;each&nbsp;prime.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3717591">//&nbsp;Thus&nbsp;each&nbsp;prime&nbsp;has&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3717625">//&nbsp;&nbsp;&nbsp;p_i&nbsp;=&nbsp;2^bitlen(p_i)&nbsp;×&nbsp;0.11...&nbsp;(in&nbsp;base&nbsp;2).</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3717676">//&nbsp;And&nbsp;the&nbsp;product&nbsp;is:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3717701">//&nbsp;&nbsp;&nbsp;P&nbsp;=&nbsp;2^todo&nbsp;×&nbsp;α</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3717725">//&nbsp;where&nbsp;α&nbsp;is&nbsp;the&nbsp;product&nbsp;of&nbsp;nprimes&nbsp;numbers&nbsp;of&nbsp;the&nbsp;form&nbsp;0.11...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3717793">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3717798">//&nbsp;If&nbsp;α&nbsp;&lt;&nbsp;1/2&nbsp;(which&nbsp;can&nbsp;happen&nbsp;for&nbsp;nprimes&nbsp;&gt;&nbsp;2),&nbsp;we&nbsp;need&nbsp;to</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3717862">//&nbsp;shift&nbsp;todo&nbsp;to&nbsp;compensate&nbsp;for&nbsp;lost&nbsp;bits:&nbsp;the&nbsp;mean&nbsp;value&nbsp;of&nbsp;0.11...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3717933">//&nbsp;is&nbsp;7/8,&nbsp;so&nbsp;todo&nbsp;+&nbsp;shift&nbsp;-&nbsp;nprimes&nbsp;*&nbsp;log2(7/8)&nbsp;~=&nbsp;bits&nbsp;-&nbsp;1/2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3717998">//&nbsp;will&nbsp;give&nbsp;good&nbsp;results.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3718027">if</span>&nbsp;<span class="ident" id="3718030">nprimes</span>&nbsp;<span class="op" id="3718038">&gt;=</span>&nbsp;<span class="num" id="3718041">7</span>&nbsp;<span class="op" id="3718043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3718048">todo</span>&nbsp;<span class="op" id="3718053">+=</span>&nbsp;<span class="op" id="3718056">(</span><span class="ident" id="3718057">nprimes</span>&nbsp;<span class="op" id="3718065">-</span>&nbsp;<span class="num" id="3718067">2</span><span class="op" id="3718068">)</span>&nbsp;<span class="op" id="3718070">/</span>&nbsp;<span class="num" id="3718072">5</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3718076">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3718080">for</span>&nbsp;<span class="ident" id="3718084">i</span>&nbsp;<span class="op" id="3718086">:=</span>&nbsp;<span class="num" id="3718089">0</span><span class="op" id="3718090">;</span>&nbsp;<span class="ident" id="3718092">i</span>&nbsp;<span class="op" id="3718094">&lt;</span>&nbsp;<span class="ident" id="3718096">nprimes</span><span class="op" id="3718103">;</span>&nbsp;<span class="ident" id="3718105">i</span><span class="op" id="3718106">++</span>&nbsp;<span class="op" id="3718109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3718114">primes</span><span class="op" id="3718120">[</span><span class="ident" id="3718121">i</span><span class="op" id="3718122">]</span><span class="op" id="3718123">,</span>&nbsp;<span class="ident" id="3718125">err</span>&nbsp;<span class="op" id="3718129">=</span>&nbsp;<span class="ident" id="3718131">rand</span><span class="op" id="3718135">.</span><span class="ident" id="3718136">Prime</span><span class="op" id="3718141">(</span><span class="ident" id="3718142">random</span><span class="op" id="3718148">,</span>&nbsp;<span class="ident" id="3718150">todo</span><span class="op" id="3718154">/</span><span class="op" id="3718155">(</span><span class="ident" id="3718156">nprimes</span><span class="op" id="3718163">-</span><span class="ident" id="3718164">i</span><span class="op" id="3718165">)</span><span class="op" id="3718166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3718171">if</span>&nbsp;<span class="ident" id="3718174">err</span>&nbsp;<span class="op" id="3718178">!=</span>&nbsp;<span class="ident" id="3718181">nil</span>&nbsp;<span class="op" id="3718185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3718191">return</span>&nbsp;<span class="ident" id="3718198">nil</span><span class="op" id="3718201">,</span>&nbsp;<span class="ident" id="3718203">err</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3718210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3718215">todo</span>&nbsp;<span class="op" id="3718220">-=</span>&nbsp;<span class="ident" id="3718223">primes</span><span class="op" id="3718229">[</span><span class="ident" id="3718230">i</span><span class="op" id="3718231">]</span><span class="op" id="3718232">.</span><span class="ident" id="3718233">BitLen</span><span class="op" id="3718239">(</span><span class="op" id="3718240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3718244">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3718249">//&nbsp;Make&nbsp;sure&nbsp;that&nbsp;primes&nbsp;is&nbsp;pairwise&nbsp;unequal.</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3718297">for</span>&nbsp;<span class="ident" id="3718301">i</span><span class="op" id="3718302">,</span>&nbsp;<span class="ident" id="3718304">prime</span>&nbsp;<span class="op" id="3718310">:=</span>&nbsp;<span class="keyword" id="3718313">range</span>&nbsp;<span class="ident" id="3718319">primes</span>&nbsp;<span class="op" id="3718326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3718331">for</span>&nbsp;<span class="ident" id="3718335">j</span>&nbsp;<span class="op" id="3718337">:=</span>&nbsp;<span class="num" id="3718340">0</span><span class="op" id="3718341">;</span>&nbsp;<span class="ident" id="3718343">j</span>&nbsp;<span class="op" id="3718345">&lt;</span>&nbsp;<span class="ident" id="3718347">i</span><span class="op" id="3718348">;</span>&nbsp;<span class="ident" id="3718350">j</span><span class="op" id="3718351">++</span>&nbsp;<span class="op" id="3718354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3718360">if</span>&nbsp;<span class="ident" id="3718363">prime</span><span class="op" id="3718368">.</span><span class="ident" id="3718369">Cmp</span><span class="op" id="3718372">(</span><span class="ident" id="3718373">primes</span><span class="op" id="3718379">[</span><span class="ident" id="3718380">j</span><span class="op" id="3718381">]</span><span class="op" id="3718382">)</span>&nbsp;<span class="op" id="3718384">==</span>&nbsp;<span class="num" id="3718387">0</span>&nbsp;<span class="op" id="3718389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3718396">continue</span>&nbsp;<span class="ident" id="3718405">NextSetOfPrimes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3718425">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3718430">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3718434">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3718439">n</span>&nbsp;<span class="op" id="3718441">:=</span>&nbsp;<span class="builtinfunc" id="3718444">new</span><span class="op" id="3718447">(</span><span class="ident" id="3718448">big</span><span class="op" id="3718451">.</span><span class="ident" id="3718452">Int</span><span class="op" id="3718455">)</span><span class="op" id="3718456">.</span><span class="ident" id="3718457">Set</span><span class="op" id="3718460">(</span><span class="ident" id="3718461">bigOne</span><span class="op" id="3718467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3718471">totient</span>&nbsp;<span class="op" id="3718479">:=</span>&nbsp;<span class="builtinfunc" id="3718482">new</span><span class="op" id="3718485">(</span><span class="ident" id="3718486">big</span><span class="op" id="3718489">.</span><span class="ident" id="3718490">Int</span><span class="op" id="3718493">)</span><span class="op" id="3718494">.</span><span class="ident" id="3718495">Set</span><span class="op" id="3718498">(</span><span class="ident" id="3718499">bigOne</span><span class="op" id="3718505">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3718509">pminus1</span>&nbsp;<span class="op" id="3718517">:=</span>&nbsp;<span class="builtinfunc" id="3718520">new</span><span class="op" id="3718523">(</span><span class="ident" id="3718524">big</span><span class="op" id="3718527">.</span><span class="ident" id="3718528">Int</span><span class="op" id="3718531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3718535">for</span>&nbsp;<span class="ident" id="3718539">_</span><span class="op" id="3718540">,</span>&nbsp;<span class="ident" id="3718542">prime</span>&nbsp;<span class="op" id="3718548">:=</span>&nbsp;<span class="keyword" id="3718551">range</span>&nbsp;<span class="ident" id="3718557">primes</span>&nbsp;<span class="op" id="3718564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3718569">n</span><span class="op" id="3718570">.</span><span class="ident" id="3718571">Mul</span><span class="op" id="3718574">(</span><span class="ident" id="3718575">n</span><span class="op" id="3718576">,</span>&nbsp;<span class="ident" id="3718578">prime</span><span class="op" id="3718583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3718588">pminus1</span><span class="op" id="3718595">.</span><span class="ident" id="3718596">Sub</span><span class="op" id="3718599">(</span><span class="ident" id="3718600">prime</span><span class="op" id="3718605">,</span>&nbsp;<span class="ident" id="3718607">bigOne</span><span class="op" id="3718613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3718618">totient</span><span class="op" id="3718625">.</span><span class="ident" id="3718626">Mul</span><span class="op" id="3718629">(</span><span class="ident" id="3718630">totient</span><span class="op" id="3718637">,</span>&nbsp;<span class="ident" id="3718639">pminus1</span><span class="op" id="3718646">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3718650">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3718654">if</span>&nbsp;<span class="ident" id="3718657">n</span><span class="op" id="3718658">.</span><span class="ident" id="3718659">BitLen</span><span class="op" id="3718665">(</span><span class="op" id="3718666">)</span>&nbsp;<span class="op" id="3718668">!=</span>&nbsp;<span class="ident" id="3718671">bits</span>&nbsp;<span class="op" id="3718676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3718681">//&nbsp;This&nbsp;should&nbsp;never&nbsp;happen&nbsp;for&nbsp;nprimes&nbsp;==&nbsp;2&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3718737">//&nbsp;crypto/rand&nbsp;should&nbsp;set&nbsp;the&nbsp;top&nbsp;two&nbsp;bits&nbsp;in&nbsp;each&nbsp;prime.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3718798">//&nbsp;For&nbsp;nprimes&nbsp;&gt;&nbsp;2&nbsp;we&nbsp;hope&nbsp;it&nbsp;does&nbsp;not&nbsp;happen&nbsp;often.</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3718854">continue</span>&nbsp;<span class="ident" id="3718863">NextSetOfPrimes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3718881">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3718886">g</span>&nbsp;<span class="op" id="3718888">:=</span>&nbsp;<span class="builtinfunc" id="3718891">new</span><span class="op" id="3718894">(</span><span class="ident" id="3718895">big</span><span class="op" id="3718898">.</span><span class="ident" id="3718899">Int</span><span class="op" id="3718902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3718906">priv</span><span class="op" id="3718910">.</span><span class="ident" id="3718911">D</span>&nbsp;<span class="op" id="3718913">=</span>&nbsp;<span class="builtinfunc" id="3718915">new</span><span class="op" id="3718918">(</span><span class="ident" id="3718919">big</span><span class="op" id="3718922">.</span><span class="ident" id="3718923">Int</span><span class="op" id="3718926">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3718930">y</span>&nbsp;<span class="op" id="3718932">:=</span>&nbsp;<span class="builtinfunc" id="3718935">new</span><span class="op" id="3718938">(</span><span class="ident" id="3718939">big</span><span class="op" id="3718942">.</span><span class="ident" id="3718943">Int</span><span class="op" id="3718946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3718950">e</span>&nbsp;<span class="op" id="3718952">:=</span>&nbsp;<span class="ident" id="3718955">big</span><span class="op" id="3718958">.</span><span class="ident" id="3718959">NewInt</span><span class="op" id="3718965">(</span><span class="ident" id="3718966">int64</span><span class="op" id="3718971">(</span><span class="ident" id="3718972">priv</span><span class="op" id="3718976">.</span><span class="ident" id="3718977">E</span><span class="op" id="3718978">)</span><span class="op" id="3718979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3718983">g</span><span class="op" id="3718984">.</span><span class="ident" id="3718985">GCD</span><span class="op" id="3718988">(</span><span class="ident" id="3718989">priv</span><span class="op" id="3718993">.</span><span class="ident" id="3718994">D</span><span class="op" id="3718995">,</span>&nbsp;<span class="ident" id="3718997">y</span><span class="op" id="3718998">,</span>&nbsp;<span class="ident" id="3719000">e</span><span class="op" id="3719001">,</span>&nbsp;<span class="ident" id="3719003">totient</span><span class="op" id="3719010">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3719015">if</span>&nbsp;<span class="ident" id="3719018">g</span><span class="op" id="3719019">.</span><span class="ident" id="3719020">Cmp</span><span class="op" id="3719023">(</span><span class="ident" id="3719024">bigOne</span><span class="op" id="3719030">)</span>&nbsp;<span class="op" id="3719032">==</span>&nbsp;<span class="num" id="3719035">0</span>&nbsp;<span class="op" id="3719037">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3719042">if</span>&nbsp;<span class="ident" id="3719045">priv</span><span class="op" id="3719049">.</span><span class="ident" id="3719050">D</span><span class="op" id="3719051">.</span><span class="ident" id="3719052">Sign</span><span class="op" id="3719056">(</span><span class="op" id="3719057">)</span>&nbsp;<span class="op" id="3719059">&lt;</span>&nbsp;<span class="num" id="3719061">0</span>&nbsp;<span class="op" id="3719063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3719069">priv</span><span class="op" id="3719073">.</span><span class="ident" id="3719074">D</span><span class="op" id="3719075">.</span><span class="ident" id="3719076">Add</span><span class="op" id="3719079">(</span><span class="ident" id="3719080">priv</span><span class="op" id="3719084">.</span><span class="ident" id="3719085">D</span><span class="op" id="3719086">,</span>&nbsp;<span class="ident" id="3719088">totient</span><span class="op" id="3719095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3719100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3719105">priv</span><span class="op" id="3719109">.</span><span class="ident" id="3719110">Primes</span>&nbsp;<span class="op" id="3719117">=</span>&nbsp;<span class="ident" id="3719119">primes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3719129">priv</span><span class="op" id="3719133">.</span><span class="ident" id="3719134">N</span>&nbsp;<span class="op" id="3719136">=</span>&nbsp;<span class="ident" id="3719138">n</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3719144">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3719152">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3719155">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3719159">priv</span><span class="op" id="3719163">.</span><span class="ident" id="3719164">Precompute</span><span class="op" id="3719174">(</span><span class="op" id="3719175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3719178">return</span><br>
<span class="lineno"></span><span class="op" id="3719185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3719188">//&nbsp;incCounter&nbsp;increments&nbsp;a&nbsp;four&nbsp;byte,&nbsp;big-endian&nbsp;counter.</span><br>
<span class="lineno">240</span><span class="keyword" id="3719246">func</span>&nbsp;<span class="ident" id="3719251">incCounter</span><span class="op" id="3719261">(</span><span class="ident" id="3719262">c</span>&nbsp;<span class="op" id="3719264">*</span><span class="op" id="3719265">[</span><span class="num" id="3719266">4</span><span class="op" id="3719267">]</span><span class="builtintype" id="3719268">byte</span><span class="op" id="3719272">)</span>&nbsp;<span class="op" id="3719274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3719277">if</span>&nbsp;<span class="ident" id="3719280">c</span><span class="op" id="3719281">[</span><span class="num" id="3719282">3</span><span class="op" id="3719283">]</span><span class="op" id="3719284">++</span><span class="op" id="3719286">;</span>&nbsp;<span class="ident" id="3719288">c</span><span class="op" id="3719289">[</span><span class="num" id="3719290">3</span><span class="op" id="3719291">]</span>&nbsp;<span class="op" id="3719293">!=</span>&nbsp;<span class="num" id="3719296">0</span>&nbsp;<span class="op" id="3719298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3719302">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3719310">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3719313">if</span>&nbsp;<span class="ident" id="3719316">c</span><span class="op" id="3719317">[</span><span class="num" id="3719318">2</span><span class="op" id="3719319">]</span><span class="op" id="3719320">++</span><span class="op" id="3719322">;</span>&nbsp;<span class="ident" id="3719324">c</span><span class="op" id="3719325">[</span><span class="num" id="3719326">2</span><span class="op" id="3719327">]</span>&nbsp;<span class="op" id="3719329">!=</span>&nbsp;<span class="num" id="3719332">0</span>&nbsp;<span class="op" id="3719334">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3719338">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3719346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3719349">if</span>&nbsp;<span class="ident" id="3719352">c</span><span class="op" id="3719353">[</span><span class="num" id="3719354">1</span><span class="op" id="3719355">]</span><span class="op" id="3719356">++</span><span class="op" id="3719358">;</span>&nbsp;<span class="ident" id="3719360">c</span><span class="op" id="3719361">[</span><span class="num" id="3719362">1</span><span class="op" id="3719363">]</span>&nbsp;<span class="op" id="3719365">!=</span>&nbsp;<span class="num" id="3719368">0</span>&nbsp;<span class="op" id="3719370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3719374">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3719382">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3719385">c</span><span class="op" id="3719386">[</span><span class="num" id="3719387">0</span><span class="op" id="3719388">]</span><span class="op" id="3719389">++</span><br>
<span class="lineno"></span><span class="op" id="3719392">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3719395">//&nbsp;mgf1XOR&nbsp;XORs&nbsp;the&nbsp;bytes&nbsp;in&nbsp;out&nbsp;with&nbsp;a&nbsp;mask&nbsp;generated&nbsp;using&nbsp;the&nbsp;MGF1&nbsp;function</span><br>
<span class="lineno"></span><span class="comment" id="3719474">//&nbsp;specified&nbsp;in&nbsp;PKCS#1&nbsp;v2.1.</span><br>
<span class="lineno">255</span><span class="keyword" id="3719503">func</span>&nbsp;<span class="ident" id="3719508">mgf1XOR</span><span class="op" id="3719515">(</span><span class="ident" id="3719516">out</span>&nbsp;<span class="op" id="3719520">[</span><span class="op" id="3719521">]</span><span class="builtintype" id="3719522">byte</span><span class="op" id="3719526">,</span>&nbsp;<span class="ident" id="3719528">hash</span>&nbsp;<span class="ident" id="3719533">hash</span><span class="op" id="3719537">.</span><span class="ident" id="3719538">Hash</span><span class="op" id="3719542">,</span>&nbsp;<span class="ident" id="3719544">seed</span>&nbsp;<span class="op" id="3719549">[</span><span class="op" id="3719550">]</span><span class="builtintype" id="3719551">byte</span><span class="op" id="3719555">)</span>&nbsp;<span class="op" id="3719557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3719560">var</span>&nbsp;<span class="ident" id="3719564">counter</span>&nbsp;<span class="op" id="3719572">[</span><span class="num" id="3719573">4</span><span class="op" id="3719574">]</span><span class="builtintype" id="3719575">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3719581">var</span>&nbsp;<span class="ident" id="3719585">digest</span>&nbsp;<span class="op" id="3719592">[</span><span class="op" id="3719593">]</span><span class="builtintype" id="3719594">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3719601">done</span>&nbsp;<span class="op" id="3719606">:=</span>&nbsp;<span class="num" id="3719609">0</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3719612">for</span>&nbsp;<span class="ident" id="3719616">done</span>&nbsp;<span class="op" id="3719621">&lt;</span>&nbsp;<span class="builtinfunc" id="3719623">len</span><span class="op" id="3719626">(</span><span class="ident" id="3719627">out</span><span class="op" id="3719630">)</span>&nbsp;<span class="op" id="3719632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3719636">hash</span><span class="op" id="3719640">.</span><span class="ident" id="3719641">Write</span><span class="op" id="3719646">(</span><span class="ident" id="3719647">seed</span><span class="op" id="3719651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3719655">hash</span><span class="op" id="3719659">.</span><span class="ident" id="3719660">Write</span><span class="op" id="3719665">(</span><span class="ident" id="3719666">counter</span><span class="op" id="3719673">[</span><span class="num" id="3719674">0</span><span class="op" id="3719675">:</span><span class="num" id="3719676">4</span><span class="op" id="3719677">]</span><span class="op" id="3719678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3719682">digest</span>&nbsp;<span class="op" id="3719689">=</span>&nbsp;<span class="ident" id="3719691">hash</span><span class="op" id="3719695">.</span><span class="ident" id="3719696">Sum</span><span class="op" id="3719699">(</span><span class="ident" id="3719700">digest</span><span class="op" id="3719706">[</span><span class="op" id="3719707">:</span><span class="num" id="3719708">0</span><span class="op" id="3719709">]</span><span class="op" id="3719710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3719714">hash</span><span class="op" id="3719718">.</span><span class="ident" id="3719719">Reset</span><span class="op" id="3719724">(</span><span class="op" id="3719725">)</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3719730">for</span>&nbsp;<span class="ident" id="3719734">i</span>&nbsp;<span class="op" id="3719736">:=</span>&nbsp;<span class="num" id="3719739">0</span><span class="op" id="3719740">;</span>&nbsp;<span class="ident" id="3719742">i</span>&nbsp;<span class="op" id="3719744">&lt;</span>&nbsp;<span class="builtinfunc" id="3719746">len</span><span class="op" id="3719749">(</span><span class="ident" id="3719750">digest</span><span class="op" id="3719756">)</span>&nbsp;<span class="op" id="3719758">&amp;&amp;</span>&nbsp;<span class="ident" id="3719761">done</span>&nbsp;<span class="op" id="3719766">&lt;</span>&nbsp;<span class="builtinfunc" id="3719768">len</span><span class="op" id="3719771">(</span><span class="ident" id="3719772">out</span><span class="op" id="3719775">)</span><span class="op" id="3719776">;</span>&nbsp;<span class="ident" id="3719778">i</span><span class="op" id="3719779">++</span>&nbsp;<span class="op" id="3719782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3719787">out</span><span class="op" id="3719790">[</span><span class="ident" id="3719791">done</span><span class="op" id="3719795">]</span>&nbsp;<span class="op" id="3719797">^=</span>&nbsp;<span class="ident" id="3719800">digest</span><span class="op" id="3719806">[</span><span class="ident" id="3719807">i</span><span class="op" id="3719808">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3719813">done</span><span class="op" id="3719817">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3719822">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3719826">incCounter</span><span class="op" id="3719836">(</span><span class="op" id="3719837">&amp;</span><span class="ident" id="3719838">counter</span><span class="op" id="3719845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3719848">}</span><br>
<span class="lineno"></span><span class="op" id="3719850">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3719853">//&nbsp;ErrMessageTooLong&nbsp;is&nbsp;returned&nbsp;when&nbsp;attempting&nbsp;to&nbsp;encrypt&nbsp;a&nbsp;message&nbsp;which&nbsp;is</span><br>
<span class="lineno">275</span><span class="comment" id="3719932">//&nbsp;too&nbsp;large&nbsp;for&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;public&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="3719977">var</span>&nbsp;<span class="ident" id="3719981">ErrMessageTooLong</span>&nbsp;<span class="op" id="3719999">=</span>&nbsp;<span class="ident" id="3720001">errors</span><span class="op" id="3720007">.</span><span class="ident" id="3720008">New</span><span class="op" id="3720011">(</span><span class="string" id="3720012">&#34;crypto/rsa:&nbsp;message&nbsp;too&nbsp;long&nbsp;for&nbsp;RSA&nbsp;public&nbsp;key&nbsp;size&#34;</span><span class="op" id="3720066">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3720069">func</span>&nbsp;<span class="ident" id="3720074">encrypt</span><span class="op" id="3720081">(</span><span class="ident" id="3720082">c</span>&nbsp;<span class="op" id="3720084">*</span><span class="ident" id="3720085">big</span><span class="op" id="3720088">.</span><span class="ident" id="3720089">Int</span><span class="op" id="3720092">,</span>&nbsp;<span class="ident" id="3720094">pub</span>&nbsp;<span class="op" id="3720098">*</span><span class="ident" id="3720099">PublicKey</span><span class="op" id="3720108">,</span>&nbsp;<span class="ident" id="3720110">m</span>&nbsp;<span class="op" id="3720112">*</span><span class="ident" id="3720113">big</span><span class="op" id="3720116">.</span><span class="ident" id="3720117">Int</span><span class="op" id="3720120">)</span>&nbsp;<span class="op" id="3720122">*</span><span class="ident" id="3720123">big</span><span class="op" id="3720126">.</span><span class="ident" id="3720127">Int</span>&nbsp;<span class="op" id="3720131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3720134">e</span>&nbsp;<span class="op" id="3720136">:=</span>&nbsp;<span class="ident" id="3720139">big</span><span class="op" id="3720142">.</span><span class="ident" id="3720143">NewInt</span><span class="op" id="3720149">(</span><span class="ident" id="3720150">int64</span><span class="op" id="3720155">(</span><span class="ident" id="3720156">pub</span><span class="op" id="3720159">.</span><span class="ident" id="3720160">E</span><span class="op" id="3720161">)</span><span class="op" id="3720162">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3720165">c</span><span class="op" id="3720166">.</span><span class="ident" id="3720167">Exp</span><span class="op" id="3720170">(</span><span class="ident" id="3720171">m</span><span class="op" id="3720172">,</span>&nbsp;<span class="ident" id="3720174">e</span><span class="op" id="3720175">,</span>&nbsp;<span class="ident" id="3720177">pub</span><span class="op" id="3720180">.</span><span class="ident" id="3720181">N</span><span class="op" id="3720182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3720185">return</span>&nbsp;<span class="ident" id="3720192">c</span><br>
<span class="lineno"></span><span class="op" id="3720194">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3720197">//&nbsp;EncryptOAEP&nbsp;encrypts&nbsp;the&nbsp;given&nbsp;message&nbsp;with&nbsp;RSA-OAEP.</span><br>
<span class="lineno">285</span><span class="comment" id="3720254">//&nbsp;The&nbsp;message&nbsp;must&nbsp;be&nbsp;no&nbsp;longer&nbsp;than&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;public&nbsp;modulus&nbsp;less</span><br>
<span class="lineno"></span><span class="comment" id="3720330">//&nbsp;twice&nbsp;the&nbsp;hash&nbsp;length&nbsp;plus&nbsp;2.</span><br>
<span class="lineno"></span><span class="keyword" id="3720363">func</span>&nbsp;<span class="ident" id="3720368">EncryptOAEP</span><span class="op" id="3720379">(</span><span class="ident" id="3720380">hash</span>&nbsp;<span class="ident" id="3720385">hash</span><span class="op" id="3720389">.</span><span class="ident" id="3720390">Hash</span><span class="op" id="3720394">,</span>&nbsp;<span class="ident" id="3720396">random</span>&nbsp;<span class="ident" id="3720403">io</span><span class="op" id="3720405">.</span><span class="ident" id="3720406">Reader</span><span class="op" id="3720412">,</span>&nbsp;<span class="ident" id="3720414">pub</span>&nbsp;<span class="op" id="3720418">*</span><span class="ident" id="3720419">PublicKey</span><span class="op" id="3720428">,</span>&nbsp;<span class="ident" id="3720430">msg</span>&nbsp;<span class="op" id="3720434">[</span><span class="op" id="3720435">]</span><span class="builtintype" id="3720436">byte</span><span class="op" id="3720440">,</span>&nbsp;<span class="ident" id="3720442">label</span>&nbsp;<span class="op" id="3720448">[</span><span class="op" id="3720449">]</span><span class="builtintype" id="3720450">byte</span><span class="op" id="3720454">)</span>&nbsp;<span class="op" id="3720456">(</span><span class="ident" id="3720457">out</span>&nbsp;<span class="op" id="3720461">[</span><span class="op" id="3720462">]</span><span class="builtintype" id="3720463">byte</span><span class="op" id="3720467">,</span>&nbsp;<span class="ident" id="3720469">err</span>&nbsp;<span class="builtintype" id="3720473">error</span><span class="op" id="3720478">)</span>&nbsp;<span class="op" id="3720480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3720483">if</span>&nbsp;<span class="ident" id="3720486">err</span>&nbsp;<span class="op" id="3720490">:=</span>&nbsp;<span class="ident" id="3720493">checkPub</span><span class="op" id="3720501">(</span><span class="ident" id="3720502">pub</span><span class="op" id="3720505">)</span><span class="op" id="3720506">;</span>&nbsp;<span class="ident" id="3720508">err</span>&nbsp;<span class="op" id="3720512">!=</span>&nbsp;<span class="ident" id="3720515">nil</span>&nbsp;<span class="op" id="3720519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3720523">return</span>&nbsp;<span class="ident" id="3720530">nil</span><span class="op" id="3720533">,</span>&nbsp;<span class="ident" id="3720535">err</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3720540">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3720543">hash</span><span class="op" id="3720547">.</span><span class="ident" id="3720548">Reset</span><span class="op" id="3720553">(</span><span class="op" id="3720554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3720557">k</span>&nbsp;<span class="op" id="3720559">:=</span>&nbsp;<span class="op" id="3720562">(</span><span class="ident" id="3720563">pub</span><span class="op" id="3720566">.</span><span class="ident" id="3720567">N</span><span class="op" id="3720568">.</span><span class="ident" id="3720569">BitLen</span><span class="op" id="3720575">(</span><span class="op" id="3720576">)</span>&nbsp;<span class="op" id="3720578">+</span>&nbsp;<span class="num" id="3720580">7</span><span class="op" id="3720581">)</span>&nbsp;<span class="op" id="3720583">/</span>&nbsp;<span class="num" id="3720585">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3720588">if</span>&nbsp;<span class="builtinfunc" id="3720591">len</span><span class="op" id="3720594">(</span><span class="ident" id="3720595">msg</span><span class="op" id="3720598">)</span>&nbsp;<span class="op" id="3720600">&gt;</span>&nbsp;<span class="ident" id="3720602">k</span><span class="op" id="3720603">-</span><span class="num" id="3720604">2</span><span class="op" id="3720605">*</span><span class="ident" id="3720606">hash</span><span class="op" id="3720610">.</span><span class="ident" id="3720611">Size</span><span class="op" id="3720615">(</span><span class="op" id="3720616">)</span><span class="op" id="3720617">-</span><span class="num" id="3720618">2</span>&nbsp;<span class="op" id="3720620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3720624">err</span>&nbsp;<span class="op" id="3720628">=</span>&nbsp;<span class="ident" id="3720630">ErrMessageTooLong</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3720650">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3720658">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3720662">hash</span><span class="op" id="3720666">.</span><span class="ident" id="3720667">Write</span><span class="op" id="3720672">(</span><span class="ident" id="3720673">label</span><span class="op" id="3720678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3720681">lHash</span>&nbsp;<span class="op" id="3720687">:=</span>&nbsp;<span class="ident" id="3720690">hash</span><span class="op" id="3720694">.</span><span class="ident" id="3720695">Sum</span><span class="op" id="3720698">(</span><span class="ident" id="3720699">nil</span><span class="op" id="3720702">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3720705">hash</span><span class="op" id="3720709">.</span><span class="ident" id="3720710">Reset</span><span class="op" id="3720715">(</span><span class="op" id="3720716">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3720720">em</span>&nbsp;<span class="op" id="3720723">:=</span>&nbsp;<span class="builtinfunc" id="3720726">make</span><span class="op" id="3720730">(</span><span class="op" id="3720731">[</span><span class="op" id="3720732">]</span><span class="builtintype" id="3720733">byte</span><span class="op" id="3720737">,</span>&nbsp;<span class="ident" id="3720739">k</span><span class="op" id="3720740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3720743">seed</span>&nbsp;<span class="op" id="3720748">:=</span>&nbsp;<span class="ident" id="3720751">em</span><span class="op" id="3720753">[</span><span class="num" id="3720754">1</span>&nbsp;<span class="op" id="3720756">:</span>&nbsp;<span class="num" id="3720758">1</span><span class="op" id="3720759">+</span><span class="ident" id="3720760">hash</span><span class="op" id="3720764">.</span><span class="ident" id="3720765">Size</span><span class="op" id="3720769">(</span><span class="op" id="3720770">)</span><span class="op" id="3720771">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3720774">db</span>&nbsp;<span class="op" id="3720777">:=</span>&nbsp;<span class="ident" id="3720780">em</span><span class="op" id="3720782">[</span><span class="num" id="3720783">1</span><span class="op" id="3720784">+</span><span class="ident" id="3720785">hash</span><span class="op" id="3720789">.</span><span class="ident" id="3720790">Size</span><span class="op" id="3720794">(</span><span class="op" id="3720795">)</span><span class="op" id="3720796">:</span><span class="op" id="3720797">]</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3720801">copy</span><span class="op" id="3720805">(</span><span class="ident" id="3720806">db</span><span class="op" id="3720808">[</span><span class="num" id="3720809">0</span><span class="op" id="3720810">:</span><span class="ident" id="3720811">hash</span><span class="op" id="3720815">.</span><span class="ident" id="3720816">Size</span><span class="op" id="3720820">(</span><span class="op" id="3720821">)</span><span class="op" id="3720822">]</span><span class="op" id="3720823">,</span>&nbsp;<span class="ident" id="3720825">lHash</span><span class="op" id="3720830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3720833">db</span><span class="op" id="3720835">[</span><span class="builtinfunc" id="3720836">len</span><span class="op" id="3720839">(</span><span class="ident" id="3720840">db</span><span class="op" id="3720842">)</span><span class="op" id="3720843">-</span><span class="builtinfunc" id="3720844">len</span><span class="op" id="3720847">(</span><span class="ident" id="3720848">msg</span><span class="op" id="3720851">)</span><span class="op" id="3720852">-</span><span class="num" id="3720853">1</span><span class="op" id="3720854">]</span>&nbsp;<span class="op" id="3720856">=</span>&nbsp;<span class="num" id="3720858">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3720861">copy</span><span class="op" id="3720865">(</span><span class="ident" id="3720866">db</span><span class="op" id="3720868">[</span><span class="builtinfunc" id="3720869">len</span><span class="op" id="3720872">(</span><span class="ident" id="3720873">db</span><span class="op" id="3720875">)</span><span class="op" id="3720876">-</span><span class="builtinfunc" id="3720877">len</span><span class="op" id="3720880">(</span><span class="ident" id="3720881">msg</span><span class="op" id="3720884">)</span><span class="op" id="3720885">:</span><span class="op" id="3720886">]</span><span class="op" id="3720887">,</span>&nbsp;<span class="ident" id="3720889">msg</span><span class="op" id="3720892">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3720896">_</span><span class="op" id="3720897">,</span>&nbsp;<span class="ident" id="3720899">err</span>&nbsp;<span class="op" id="3720903">=</span>&nbsp;<span class="ident" id="3720905">io</span><span class="op" id="3720907">.</span><span class="ident" id="3720908">ReadFull</span><span class="op" id="3720916">(</span><span class="ident" id="3720917">random</span><span class="op" id="3720923">,</span>&nbsp;<span class="ident" id="3720925">seed</span><span class="op" id="3720929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3720932">if</span>&nbsp;<span class="ident" id="3720935">err</span>&nbsp;<span class="op" id="3720939">!=</span>&nbsp;<span class="ident" id="3720942">nil</span>&nbsp;<span class="op" id="3720946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3720950">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3720958">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3720962">mgf1XOR</span><span class="op" id="3720969">(</span><span class="ident" id="3720970">db</span><span class="op" id="3720972">,</span>&nbsp;<span class="ident" id="3720974">hash</span><span class="op" id="3720978">,</span>&nbsp;<span class="ident" id="3720980">seed</span><span class="op" id="3720984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3720987">mgf1XOR</span><span class="op" id="3720994">(</span><span class="ident" id="3720995">seed</span><span class="op" id="3720999">,</span>&nbsp;<span class="ident" id="3721001">hash</span><span class="op" id="3721005">,</span>&nbsp;<span class="ident" id="3721007">db</span><span class="op" id="3721009">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3721013">m</span>&nbsp;<span class="op" id="3721015">:=</span>&nbsp;<span class="builtinfunc" id="3721018">new</span><span class="op" id="3721021">(</span><span class="ident" id="3721022">big</span><span class="op" id="3721025">.</span><span class="ident" id="3721026">Int</span><span class="op" id="3721029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3721032">m</span><span class="op" id="3721033">.</span><span class="ident" id="3721034">SetBytes</span><span class="op" id="3721042">(</span><span class="ident" id="3721043">em</span><span class="op" id="3721045">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3721048">c</span>&nbsp;<span class="op" id="3721050">:=</span>&nbsp;<span class="ident" id="3721053">encrypt</span><span class="op" id="3721060">(</span><span class="builtinfunc" id="3721061">new</span><span class="op" id="3721064">(</span><span class="ident" id="3721065">big</span><span class="op" id="3721068">.</span><span class="ident" id="3721069">Int</span><span class="op" id="3721072">)</span><span class="op" id="3721073">,</span>&nbsp;<span class="ident" id="3721075">pub</span><span class="op" id="3721078">,</span>&nbsp;<span class="ident" id="3721080">m</span><span class="op" id="3721081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3721084">out</span>&nbsp;<span class="op" id="3721088">=</span>&nbsp;<span class="ident" id="3721090">c</span><span class="op" id="3721091">.</span><span class="ident" id="3721092">Bytes</span><span class="op" id="3721097">(</span><span class="op" id="3721098">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3721102">if</span>&nbsp;<span class="builtinfunc" id="3721105">len</span><span class="op" id="3721108">(</span><span class="ident" id="3721109">out</span><span class="op" id="3721112">)</span>&nbsp;<span class="op" id="3721114">&lt;</span>&nbsp;<span class="ident" id="3721116">k</span>&nbsp;<span class="op" id="3721118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3721122">//&nbsp;If&nbsp;the&nbsp;output&nbsp;is&nbsp;too&nbsp;small,&nbsp;we&nbsp;need&nbsp;to&nbsp;left-pad&nbsp;with&nbsp;zeros.</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3721187">t</span>&nbsp;<span class="op" id="3721189">:=</span>&nbsp;<span class="builtinfunc" id="3721192">make</span><span class="op" id="3721196">(</span><span class="op" id="3721197">[</span><span class="op" id="3721198">]</span><span class="builtintype" id="3721199">byte</span><span class="op" id="3721203">,</span>&nbsp;<span class="ident" id="3721205">k</span><span class="op" id="3721206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3721210">copy</span><span class="op" id="3721214">(</span><span class="ident" id="3721215">t</span><span class="op" id="3721216">[</span><span class="ident" id="3721217">k</span><span class="op" id="3721218">-</span><span class="builtinfunc" id="3721219">len</span><span class="op" id="3721222">(</span><span class="ident" id="3721223">out</span><span class="op" id="3721226">)</span><span class="op" id="3721227">:</span><span class="op" id="3721228">]</span><span class="op" id="3721229">,</span>&nbsp;<span class="ident" id="3721231">out</span><span class="op" id="3721234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3721238">out</span>&nbsp;<span class="op" id="3721242">=</span>&nbsp;<span class="ident" id="3721244">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3721247">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3721251">return</span><br>
<span class="lineno"></span><span class="op" id="3721258">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3721261">//&nbsp;ErrDecryption&nbsp;represents&nbsp;a&nbsp;failure&nbsp;to&nbsp;decrypt&nbsp;a&nbsp;message.</span><br>
<span class="lineno"></span><span class="comment" id="3721321">//&nbsp;It&nbsp;is&nbsp;deliberately&nbsp;vague&nbsp;to&nbsp;avoid&nbsp;adaptive&nbsp;attacks.</span><br>
<span class="lineno">335</span><span class="keyword" id="3721376">var</span>&nbsp;<span class="ident" id="3721380">ErrDecryption</span>&nbsp;<span class="op" id="3721394">=</span>&nbsp;<span class="ident" id="3721396">errors</span><span class="op" id="3721402">.</span><span class="ident" id="3721403">New</span><span class="op" id="3721406">(</span><span class="string" id="3721407">&#34;crypto/rsa:&nbsp;decryption&nbsp;error&#34;</span><span class="op" id="3721437">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3721440">//&nbsp;ErrVerification&nbsp;represents&nbsp;a&nbsp;failure&nbsp;to&nbsp;verify&nbsp;a&nbsp;signature.</span><br>
<span class="lineno"></span><span class="comment" id="3721503">//&nbsp;It&nbsp;is&nbsp;deliberately&nbsp;vague&nbsp;to&nbsp;avoid&nbsp;adaptive&nbsp;attacks.</span><br>
<span class="lineno"></span><span class="keyword" id="3721558">var</span>&nbsp;<span class="ident" id="3721562">ErrVerification</span>&nbsp;<span class="op" id="3721578">=</span>&nbsp;<span class="ident" id="3721580">errors</span><span class="op" id="3721586">.</span><span class="ident" id="3721587">New</span><span class="op" id="3721590">(</span><span class="string" id="3721591">&#34;crypto/rsa:&nbsp;verification&nbsp;error&#34;</span><span class="op" id="3721623">)</span><br>
<span class="lineno">340</span><br>
<span class="lineno"></span><span class="comment" id="3721626">//&nbsp;modInverse&nbsp;returns&nbsp;ia,&nbsp;the&nbsp;inverse&nbsp;of&nbsp;a&nbsp;in&nbsp;the&nbsp;multiplicative&nbsp;group&nbsp;of&nbsp;prime</span><br>
<span class="lineno"></span><span class="comment" id="3721706">//&nbsp;order&nbsp;n.&nbsp;It&nbsp;requires&nbsp;that&nbsp;a&nbsp;be&nbsp;a&nbsp;member&nbsp;of&nbsp;the&nbsp;group&nbsp;(i.e.&nbsp;less&nbsp;than&nbsp;n).</span><br>
<span class="lineno"></span><span class="keyword" id="3721782">func</span>&nbsp;<span class="ident" id="3721787">modInverse</span><span class="op" id="3721797">(</span><span class="ident" id="3721798">a</span><span class="op" id="3721799">,</span>&nbsp;<span class="ident" id="3721801">n</span>&nbsp;<span class="op" id="3721803">*</span><span class="ident" id="3721804">big</span><span class="op" id="3721807">.</span><span class="ident" id="3721808">Int</span><span class="op" id="3721811">)</span>&nbsp;<span class="op" id="3721813">(</span><span class="ident" id="3721814">ia</span>&nbsp;<span class="op" id="3721817">*</span><span class="ident" id="3721818">big</span><span class="op" id="3721821">.</span><span class="ident" id="3721822">Int</span><span class="op" id="3721825">,</span>&nbsp;<span class="ident" id="3721827">ok</span>&nbsp;<span class="builtintype" id="3721830">bool</span><span class="op" id="3721834">)</span>&nbsp;<span class="op" id="3721836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3721839">g</span>&nbsp;<span class="op" id="3721841">:=</span>&nbsp;<span class="builtinfunc" id="3721844">new</span><span class="op" id="3721847">(</span><span class="ident" id="3721848">big</span><span class="op" id="3721851">.</span><span class="ident" id="3721852">Int</span><span class="op" id="3721855">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3721858">x</span>&nbsp;<span class="op" id="3721860">:=</span>&nbsp;<span class="builtinfunc" id="3721863">new</span><span class="op" id="3721866">(</span><span class="ident" id="3721867">big</span><span class="op" id="3721870">.</span><span class="ident" id="3721871">Int</span><span class="op" id="3721874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3721877">y</span>&nbsp;<span class="op" id="3721879">:=</span>&nbsp;<span class="builtinfunc" id="3721882">new</span><span class="op" id="3721885">(</span><span class="ident" id="3721886">big</span><span class="op" id="3721889">.</span><span class="ident" id="3721890">Int</span><span class="op" id="3721893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3721896">g</span><span class="op" id="3721897">.</span><span class="ident" id="3721898">GCD</span><span class="op" id="3721901">(</span><span class="ident" id="3721902">x</span><span class="op" id="3721903">,</span>&nbsp;<span class="ident" id="3721905">y</span><span class="op" id="3721906">,</span>&nbsp;<span class="ident" id="3721908">a</span><span class="op" id="3721909">,</span>&nbsp;<span class="ident" id="3721911">n</span><span class="op" id="3721912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3721915">if</span>&nbsp;<span class="ident" id="3721918">g</span><span class="op" id="3721919">.</span><span class="ident" id="3721920">Cmp</span><span class="op" id="3721923">(</span><span class="ident" id="3721924">bigOne</span><span class="op" id="3721930">)</span>&nbsp;<span class="op" id="3721932">!=</span>&nbsp;<span class="num" id="3721935">0</span>&nbsp;<span class="op" id="3721937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3721941">//&nbsp;In&nbsp;this&nbsp;case,&nbsp;a&nbsp;and&nbsp;n&nbsp;aren&#39;t&nbsp;coprime&nbsp;and&nbsp;we&nbsp;cannot&nbsp;calculate</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3722007">//&nbsp;the&nbsp;inverse.&nbsp;This&nbsp;happens&nbsp;because&nbsp;the&nbsp;values&nbsp;of&nbsp;n&nbsp;are&nbsp;nearly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3722073">//&nbsp;prime&nbsp;(being&nbsp;the&nbsp;product&nbsp;of&nbsp;two&nbsp;primes)&nbsp;rather&nbsp;than&nbsp;truly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3722136">//&nbsp;prime.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3722148">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3722156">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3722160">if</span>&nbsp;<span class="ident" id="3722163">x</span><span class="op" id="3722164">.</span><span class="ident" id="3722165">Cmp</span><span class="op" id="3722168">(</span><span class="ident" id="3722169">bigOne</span><span class="op" id="3722175">)</span>&nbsp;<span class="op" id="3722177">&lt;</span>&nbsp;<span class="num" id="3722179">0</span>&nbsp;<span class="op" id="3722181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3722185">//&nbsp;0&nbsp;is&nbsp;not&nbsp;the&nbsp;multiplicative&nbsp;inverse&nbsp;of&nbsp;any&nbsp;element&nbsp;so,&nbsp;if&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3722250">//&nbsp;&lt;&nbsp;1,&nbsp;then&nbsp;x&nbsp;is&nbsp;negative.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3722280">x</span><span class="op" id="3722281">.</span><span class="ident" id="3722282">Add</span><span class="op" id="3722285">(</span><span class="ident" id="3722286">x</span><span class="op" id="3722287">,</span>&nbsp;<span class="ident" id="3722289">n</span><span class="op" id="3722290">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3722293">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3722297">return</span>&nbsp;<span class="ident" id="3722304">x</span><span class="op" id="3722305">,</span>&nbsp;<span class="builtintype" id="3722307">true</span><br>
<span class="lineno"></span><span class="op" id="3722312">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="comment" id="3722315">//&nbsp;Precompute&nbsp;performs&nbsp;some&nbsp;calculations&nbsp;that&nbsp;speed&nbsp;up&nbsp;private&nbsp;key&nbsp;operations</span><br>
<span class="lineno"></span><span class="comment" id="3722393">//&nbsp;in&nbsp;the&nbsp;future.</span><br>
<span class="lineno"></span><span class="keyword" id="3722411">func</span>&nbsp;<span class="op" id="3722416">(</span><span class="ident" id="3722417">priv</span>&nbsp;<span class="op" id="3722422">*</span><span class="ident" id="3722423">PrivateKey</span><span class="op" id="3722433">)</span>&nbsp;<span class="ident" id="3722435">Precompute</span><span class="op" id="3722445">(</span><span class="op" id="3722446">)</span>&nbsp;<span class="op" id="3722448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3722451">if</span>&nbsp;<span class="ident" id="3722454">priv</span><span class="op" id="3722458">.</span><span class="ident" id="3722459">Precomputed</span><span class="op" id="3722470">.</span><span class="ident" id="3722471">Dp</span>&nbsp;<span class="op" id="3722474">!=</span>&nbsp;<span class="ident" id="3722477">nil</span>&nbsp;<span class="op" id="3722481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3722485">return</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3722493">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3722497">priv</span><span class="op" id="3722501">.</span><span class="ident" id="3722502">Precomputed</span><span class="op" id="3722513">.</span><span class="ident" id="3722514">Dp</span>&nbsp;<span class="op" id="3722517">=</span>&nbsp;<span class="builtinfunc" id="3722519">new</span><span class="op" id="3722522">(</span><span class="ident" id="3722523">big</span><span class="op" id="3722526">.</span><span class="ident" id="3722527">Int</span><span class="op" id="3722530">)</span><span class="op" id="3722531">.</span><span class="ident" id="3722532">Sub</span><span class="op" id="3722535">(</span><span class="ident" id="3722536">priv</span><span class="op" id="3722540">.</span><span class="ident" id="3722541">Primes</span><span class="op" id="3722547">[</span><span class="num" id="3722548">0</span><span class="op" id="3722549">]</span><span class="op" id="3722550">,</span>&nbsp;<span class="ident" id="3722552">bigOne</span><span class="op" id="3722558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3722561">priv</span><span class="op" id="3722565">.</span><span class="ident" id="3722566">Precomputed</span><span class="op" id="3722577">.</span><span class="ident" id="3722578">Dp</span><span class="op" id="3722580">.</span><span class="ident" id="3722581">Mod</span><span class="op" id="3722584">(</span><span class="ident" id="3722585">priv</span><span class="op" id="3722589">.</span><span class="ident" id="3722590">D</span><span class="op" id="3722591">,</span>&nbsp;<span class="ident" id="3722593">priv</span><span class="op" id="3722597">.</span><span class="ident" id="3722598">Precomputed</span><span class="op" id="3722609">.</span><span class="ident" id="3722610">Dp</span><span class="op" id="3722612">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3722616">priv</span><span class="op" id="3722620">.</span><span class="ident" id="3722621">Precomputed</span><span class="op" id="3722632">.</span><span class="ident" id="3722633">Dq</span>&nbsp;<span class="op" id="3722636">=</span>&nbsp;<span class="builtinfunc" id="3722638">new</span><span class="op" id="3722641">(</span><span class="ident" id="3722642">big</span><span class="op" id="3722645">.</span><span class="ident" id="3722646">Int</span><span class="op" id="3722649">)</span><span class="op" id="3722650">.</span><span class="ident" id="3722651">Sub</span><span class="op" id="3722654">(</span><span class="ident" id="3722655">priv</span><span class="op" id="3722659">.</span><span class="ident" id="3722660">Primes</span><span class="op" id="3722666">[</span><span class="num" id="3722667">1</span><span class="op" id="3722668">]</span><span class="op" id="3722669">,</span>&nbsp;<span class="ident" id="3722671">bigOne</span><span class="op" id="3722677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3722680">priv</span><span class="op" id="3722684">.</span><span class="ident" id="3722685">Precomputed</span><span class="op" id="3722696">.</span><span class="ident" id="3722697">Dq</span><span class="op" id="3722699">.</span><span class="ident" id="3722700">Mod</span><span class="op" id="3722703">(</span><span class="ident" id="3722704">priv</span><span class="op" id="3722708">.</span><span class="ident" id="3722709">D</span><span class="op" id="3722710">,</span>&nbsp;<span class="ident" id="3722712">priv</span><span class="op" id="3722716">.</span><span class="ident" id="3722717">Precomputed</span><span class="op" id="3722728">.</span><span class="ident" id="3722729">Dq</span><span class="op" id="3722731">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3722735">priv</span><span class="op" id="3722739">.</span><span class="ident" id="3722740">Precomputed</span><span class="op" id="3722751">.</span><span class="ident" id="3722752">Qinv</span>&nbsp;<span class="op" id="3722757">=</span>&nbsp;<span class="builtinfunc" id="3722759">new</span><span class="op" id="3722762">(</span><span class="ident" id="3722763">big</span><span class="op" id="3722766">.</span><span class="ident" id="3722767">Int</span><span class="op" id="3722770">)</span><span class="op" id="3722771">.</span><span class="ident" id="3722772">ModInverse</span><span class="op" id="3722782">(</span><span class="ident" id="3722783">priv</span><span class="op" id="3722787">.</span><span class="ident" id="3722788">Primes</span><span class="op" id="3722794">[</span><span class="num" id="3722795">1</span><span class="op" id="3722796">]</span><span class="op" id="3722797">,</span>&nbsp;<span class="ident" id="3722799">priv</span><span class="op" id="3722803">.</span><span class="ident" id="3722804">Primes</span><span class="op" id="3722810">[</span><span class="num" id="3722811">0</span><span class="op" id="3722812">]</span><span class="op" id="3722813">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3722817">r</span>&nbsp;<span class="op" id="3722819">:=</span>&nbsp;<span class="builtinfunc" id="3722822">new</span><span class="op" id="3722825">(</span><span class="ident" id="3722826">big</span><span class="op" id="3722829">.</span><span class="ident" id="3722830">Int</span><span class="op" id="3722833">)</span><span class="op" id="3722834">.</span><span class="ident" id="3722835">Mul</span><span class="op" id="3722838">(</span><span class="ident" id="3722839">priv</span><span class="op" id="3722843">.</span><span class="ident" id="3722844">Primes</span><span class="op" id="3722850">[</span><span class="num" id="3722851">0</span><span class="op" id="3722852">]</span><span class="op" id="3722853">,</span>&nbsp;<span class="ident" id="3722855">priv</span><span class="op" id="3722859">.</span><span class="ident" id="3722860">Primes</span><span class="op" id="3722866">[</span><span class="num" id="3722867">1</span><span class="op" id="3722868">]</span><span class="op" id="3722869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3722872">priv</span><span class="op" id="3722876">.</span><span class="ident" id="3722877">Precomputed</span><span class="op" id="3722888">.</span><span class="ident" id="3722889">CRTValues</span>&nbsp;<span class="op" id="3722899">=</span>&nbsp;<span class="builtinfunc" id="3722901">make</span><span class="op" id="3722905">(</span><span class="op" id="3722906">[</span><span class="op" id="3722907">]</span><span class="ident" id="3722908">CRTValue</span><span class="op" id="3722916">,</span>&nbsp;<span class="builtinfunc" id="3722918">len</span><span class="op" id="3722921">(</span><span class="ident" id="3722922">priv</span><span class="op" id="3722926">.</span><span class="ident" id="3722927">Primes</span><span class="op" id="3722933">)</span><span class="op" id="3722934">-</span><span class="num" id="3722935">2</span><span class="op" id="3722936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3722939">for</span>&nbsp;<span class="ident" id="3722943">i</span>&nbsp;<span class="op" id="3722945">:=</span>&nbsp;<span class="num" id="3722948">2</span><span class="op" id="3722949">;</span>&nbsp;<span class="ident" id="3722951">i</span>&nbsp;<span class="op" id="3722953">&lt;</span>&nbsp;<span class="builtinfunc" id="3722955">len</span><span class="op" id="3722958">(</span><span class="ident" id="3722959">priv</span><span class="op" id="3722963">.</span><span class="ident" id="3722964">Primes</span><span class="op" id="3722970">)</span><span class="op" id="3722971">;</span>&nbsp;<span class="ident" id="3722973">i</span><span class="op" id="3722974">++</span>&nbsp;<span class="op" id="3722977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3722981">prime</span>&nbsp;<span class="op" id="3722987">:=</span>&nbsp;<span class="ident" id="3722990">priv</span><span class="op" id="3722994">.</span><span class="ident" id="3722995">Primes</span><span class="op" id="3723001">[</span><span class="ident" id="3723002">i</span><span class="op" id="3723003">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3723007">values</span>&nbsp;<span class="op" id="3723014">:=</span>&nbsp;<span class="op" id="3723017">&amp;</span><span class="ident" id="3723018">priv</span><span class="op" id="3723022">.</span><span class="ident" id="3723023">Precomputed</span><span class="op" id="3723034">.</span><span class="ident" id="3723035">CRTValues</span><span class="op" id="3723044">[</span><span class="ident" id="3723045">i</span><span class="op" id="3723046">-</span><span class="num" id="3723047">2</span><span class="op" id="3723048">]</span><br>
<span class="lineno">385</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3723053">values</span><span class="op" id="3723059">.</span><span class="ident" id="3723060">Exp</span>&nbsp;<span class="op" id="3723064">=</span>&nbsp;<span class="builtinfunc" id="3723066">new</span><span class="op" id="3723069">(</span><span class="ident" id="3723070">big</span><span class="op" id="3723073">.</span><span class="ident" id="3723074">Int</span><span class="op" id="3723077">)</span><span class="op" id="3723078">.</span><span class="ident" id="3723079">Sub</span><span class="op" id="3723082">(</span><span class="ident" id="3723083">prime</span><span class="op" id="3723088">,</span>&nbsp;<span class="ident" id="3723090">bigOne</span><span class="op" id="3723096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3723100">values</span><span class="op" id="3723106">.</span><span class="ident" id="3723107">Exp</span><span class="op" id="3723110">.</span><span class="ident" id="3723111">Mod</span><span class="op" id="3723114">(</span><span class="ident" id="3723115">priv</span><span class="op" id="3723119">.</span><span class="ident" id="3723120">D</span><span class="op" id="3723121">,</span>&nbsp;<span class="ident" id="3723123">values</span><span class="op" id="3723129">.</span><span class="ident" id="3723130">Exp</span><span class="op" id="3723133">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3723138">values</span><span class="op" id="3723144">.</span><span class="ident" id="3723145">R</span>&nbsp;<span class="op" id="3723147">=</span>&nbsp;<span class="builtinfunc" id="3723149">new</span><span class="op" id="3723152">(</span><span class="ident" id="3723153">big</span><span class="op" id="3723156">.</span><span class="ident" id="3723157">Int</span><span class="op" id="3723160">)</span><span class="op" id="3723161">.</span><span class="ident" id="3723162">Set</span><span class="op" id="3723165">(</span><span class="ident" id="3723166">r</span><span class="op" id="3723167">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3723171">values</span><span class="op" id="3723177">.</span><span class="ident" id="3723178">Coeff</span>&nbsp;<span class="op" id="3723184">=</span>&nbsp;<span class="builtinfunc" id="3723186">new</span><span class="op" id="3723189">(</span><span class="ident" id="3723190">big</span><span class="op" id="3723193">.</span><span class="ident" id="3723194">Int</span><span class="op" id="3723197">)</span><span class="op" id="3723198">.</span><span class="ident" id="3723199">ModInverse</span><span class="op" id="3723209">(</span><span class="ident" id="3723210">r</span><span class="op" id="3723211">,</span>&nbsp;<span class="ident" id="3723213">prime</span><span class="op" id="3723218">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3723223">r</span><span class="op" id="3723224">.</span><span class="ident" id="3723225">Mul</span><span class="op" id="3723228">(</span><span class="ident" id="3723229">r</span><span class="op" id="3723230">,</span>&nbsp;<span class="ident" id="3723232">prime</span><span class="op" id="3723237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3723240">}</span><br>
<span class="lineno"></span><span class="op" id="3723242">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="comment" id="3723245">//&nbsp;decrypt&nbsp;performs&nbsp;an&nbsp;RSA&nbsp;decryption,&nbsp;resulting&nbsp;in&nbsp;a&nbsp;plaintext&nbsp;integer.&nbsp;If&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3723323">//&nbsp;random&nbsp;source&nbsp;is&nbsp;given,&nbsp;RSA&nbsp;blinding&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="3723372">func</span>&nbsp;<span class="ident" id="3723377">decrypt</span><span class="op" id="3723384">(</span><span class="ident" id="3723385">random</span>&nbsp;<span class="ident" id="3723392">io</span><span class="op" id="3723394">.</span><span class="ident" id="3723395">Reader</span><span class="op" id="3723401">,</span>&nbsp;<span class="ident" id="3723403">priv</span>&nbsp;<span class="op" id="3723408">*</span><span class="ident" id="3723409">PrivateKey</span><span class="op" id="3723419">,</span>&nbsp;<span class="ident" id="3723421">c</span>&nbsp;<span class="op" id="3723423">*</span><span class="ident" id="3723424">big</span><span class="op" id="3723427">.</span><span class="ident" id="3723428">Int</span><span class="op" id="3723431">)</span>&nbsp;<span class="op" id="3723433">(</span><span class="ident" id="3723434">m</span>&nbsp;<span class="op" id="3723436">*</span><span class="ident" id="3723437">big</span><span class="op" id="3723440">.</span><span class="ident" id="3723441">Int</span><span class="op" id="3723444">,</span>&nbsp;<span class="ident" id="3723446">err</span>&nbsp;<span class="builtintype" id="3723450">error</span><span class="op" id="3723455">)</span>&nbsp;<span class="op" id="3723457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3723460">//&nbsp;TODO(agl):&nbsp;can&nbsp;we&nbsp;get&nbsp;away&nbsp;with&nbsp;reusing&nbsp;blinds?</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3723512">if</span>&nbsp;<span class="ident" id="3723515">c</span><span class="op" id="3723516">.</span><span class="ident" id="3723517">Cmp</span><span class="op" id="3723520">(</span><span class="ident" id="3723521">priv</span><span class="op" id="3723525">.</span><span class="ident" id="3723526">N</span><span class="op" id="3723527">)</span>&nbsp;<span class="op" id="3723529">&gt;</span>&nbsp;<span class="num" id="3723531">0</span>&nbsp;<span class="op" id="3723533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3723537">err</span>&nbsp;<span class="op" id="3723541">=</span>&nbsp;<span class="ident" id="3723543">ErrDecryption</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3723559">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3723567">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3723571">var</span>&nbsp;<span class="ident" id="3723575">ir</span>&nbsp;<span class="op" id="3723578">*</span><span class="ident" id="3723579">big</span><span class="op" id="3723582">.</span><span class="ident" id="3723583">Int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3723588">if</span>&nbsp;<span class="ident" id="3723591">random</span>&nbsp;<span class="op" id="3723598">!=</span>&nbsp;<span class="ident" id="3723601">nil</span>&nbsp;<span class="op" id="3723605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3723609">//&nbsp;Blinding&nbsp;enabled.&nbsp;Blinding&nbsp;involves&nbsp;multiplying&nbsp;c&nbsp;by&nbsp;r^e.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3723672">//&nbsp;Then&nbsp;the&nbsp;decryption&nbsp;operation&nbsp;performs&nbsp;(m^e&nbsp;*&nbsp;r^e)^d&nbsp;mod&nbsp;n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3723736">//&nbsp;which&nbsp;equals&nbsp;mr&nbsp;mod&nbsp;n.&nbsp;The&nbsp;factor&nbsp;of&nbsp;r&nbsp;can&nbsp;then&nbsp;be&nbsp;removed</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3723800">//&nbsp;by&nbsp;multiplying&nbsp;by&nbsp;the&nbsp;multiplicative&nbsp;inverse&nbsp;of&nbsp;r.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3723857">var</span>&nbsp;<span class="ident" id="3723861">r</span>&nbsp;<span class="op" id="3723863">*</span><span class="ident" id="3723864">big</span><span class="op" id="3723867">.</span><span class="ident" id="3723868">Int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3723875">for</span>&nbsp;<span class="op" id="3723879">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3723884">r</span><span class="op" id="3723885">,</span>&nbsp;<span class="ident" id="3723887">err</span>&nbsp;<span class="op" id="3723891">=</span>&nbsp;<span class="ident" id="3723893">rand</span><span class="op" id="3723897">.</span><span class="ident" id="3723898">Int</span><span class="op" id="3723901">(</span><span class="ident" id="3723902">random</span><span class="op" id="3723908">,</span>&nbsp;<span class="ident" id="3723910">priv</span><span class="op" id="3723914">.</span><span class="ident" id="3723915">N</span><span class="op" id="3723916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3723921">if</span>&nbsp;<span class="ident" id="3723924">err</span>&nbsp;<span class="op" id="3723928">!=</span>&nbsp;<span class="ident" id="3723931">nil</span>&nbsp;<span class="op" id="3723935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3723941">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3723951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3723956">if</span>&nbsp;<span class="ident" id="3723959">r</span><span class="op" id="3723960">.</span><span class="ident" id="3723961">Cmp</span><span class="op" id="3723964">(</span><span class="ident" id="3723965">bigZero</span><span class="op" id="3723972">)</span>&nbsp;<span class="op" id="3723974">==</span>&nbsp;<span class="num" id="3723977">0</span>&nbsp;<span class="op" id="3723979">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3723985">r</span>&nbsp;<span class="op" id="3723987">=</span>&nbsp;<span class="ident" id="3723989">bigOne</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3723999">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3724004">var</span>&nbsp;<span class="ident" id="3724008">ok</span>&nbsp;<span class="builtintype" id="3724011">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3724019">ir</span><span class="op" id="3724021">,</span>&nbsp;<span class="ident" id="3724023">ok</span>&nbsp;<span class="op" id="3724026">=</span>&nbsp;<span class="ident" id="3724028">modInverse</span><span class="op" id="3724038">(</span><span class="ident" id="3724039">r</span><span class="op" id="3724040">,</span>&nbsp;<span class="ident" id="3724042">priv</span><span class="op" id="3724046">.</span><span class="ident" id="3724047">N</span><span class="op" id="3724048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3724053">if</span>&nbsp;<span class="ident" id="3724056">ok</span>&nbsp;<span class="op" id="3724059">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3724065">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3724074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3724078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3724082">bigE</span>&nbsp;<span class="op" id="3724087">:=</span>&nbsp;<span class="ident" id="3724090">big</span><span class="op" id="3724093">.</span><span class="ident" id="3724094">NewInt</span><span class="op" id="3724100">(</span><span class="ident" id="3724101">int64</span><span class="op" id="3724106">(</span><span class="ident" id="3724107">priv</span><span class="op" id="3724111">.</span><span class="ident" id="3724112">E</span><span class="op" id="3724113">)</span><span class="op" id="3724114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3724118">rpowe</span>&nbsp;<span class="op" id="3724124">:=</span>&nbsp;<span class="builtinfunc" id="3724127">new</span><span class="op" id="3724130">(</span><span class="ident" id="3724131">big</span><span class="op" id="3724134">.</span><span class="ident" id="3724135">Int</span><span class="op" id="3724138">)</span><span class="op" id="3724139">.</span><span class="ident" id="3724140">Exp</span><span class="op" id="3724143">(</span><span class="ident" id="3724144">r</span><span class="op" id="3724145">,</span>&nbsp;<span class="ident" id="3724147">bigE</span><span class="op" id="3724151">,</span>&nbsp;<span class="ident" id="3724153">priv</span><span class="op" id="3724157">.</span><span class="ident" id="3724158">N</span><span class="op" id="3724159">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3724163">cCopy</span>&nbsp;<span class="op" id="3724169">:=</span>&nbsp;<span class="builtinfunc" id="3724172">new</span><span class="op" id="3724175">(</span><span class="ident" id="3724176">big</span><span class="op" id="3724179">.</span><span class="ident" id="3724180">Int</span><span class="op" id="3724183">)</span><span class="op" id="3724184">.</span><span class="ident" id="3724185">Set</span><span class="op" id="3724188">(</span><span class="ident" id="3724189">c</span><span class="op" id="3724190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3724194">cCopy</span><span class="op" id="3724199">.</span><span class="ident" id="3724200">Mul</span><span class="op" id="3724203">(</span><span class="ident" id="3724204">cCopy</span><span class="op" id="3724209">,</span>&nbsp;<span class="ident" id="3724211">rpowe</span><span class="op" id="3724216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3724220">cCopy</span><span class="op" id="3724225">.</span><span class="ident" id="3724226">Mod</span><span class="op" id="3724229">(</span><span class="ident" id="3724230">cCopy</span><span class="op" id="3724235">,</span>&nbsp;<span class="ident" id="3724237">priv</span><span class="op" id="3724241">.</span><span class="ident" id="3724242">N</span><span class="op" id="3724243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3724247">c</span>&nbsp;<span class="op" id="3724249">=</span>&nbsp;<span class="ident" id="3724251">cCopy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3724258">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3724262">if</span>&nbsp;<span class="ident" id="3724265">priv</span><span class="op" id="3724269">.</span><span class="ident" id="3724270">Precomputed</span><span class="op" id="3724281">.</span><span class="ident" id="3724282">Dp</span>&nbsp;<span class="op" id="3724285">==</span>&nbsp;<span class="ident" id="3724288">nil</span>&nbsp;<span class="op" id="3724292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3724296">m</span>&nbsp;<span class="op" id="3724298">=</span>&nbsp;<span class="builtinfunc" id="3724300">new</span><span class="op" id="3724303">(</span><span class="ident" id="3724304">big</span><span class="op" id="3724307">.</span><span class="ident" id="3724308">Int</span><span class="op" id="3724311">)</span><span class="op" id="3724312">.</span><span class="ident" id="3724313">Exp</span><span class="op" id="3724316">(</span><span class="ident" id="3724317">c</span><span class="op" id="3724318">,</span>&nbsp;<span class="ident" id="3724320">priv</span><span class="op" id="3724324">.</span><span class="ident" id="3724325">D</span><span class="op" id="3724326">,</span>&nbsp;<span class="ident" id="3724328">priv</span><span class="op" id="3724332">.</span><span class="ident" id="3724333">N</span><span class="op" id="3724334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3724337">}</span>&nbsp;<span class="keyword" id="3724339">else</span>&nbsp;<span class="op" id="3724344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3724348">//&nbsp;We&nbsp;have&nbsp;the&nbsp;precalculated&nbsp;values&nbsp;needed&nbsp;for&nbsp;the&nbsp;CRT.</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3724406">m</span>&nbsp;<span class="op" id="3724408">=</span>&nbsp;<span class="builtinfunc" id="3724410">new</span><span class="op" id="3724413">(</span><span class="ident" id="3724414">big</span><span class="op" id="3724417">.</span><span class="ident" id="3724418">Int</span><span class="op" id="3724421">)</span><span class="op" id="3724422">.</span><span class="ident" id="3724423">Exp</span><span class="op" id="3724426">(</span><span class="ident" id="3724427">c</span><span class="op" id="3724428">,</span>&nbsp;<span class="ident" id="3724430">priv</span><span class="op" id="3724434">.</span><span class="ident" id="3724435">Precomputed</span><span class="op" id="3724446">.</span><span class="ident" id="3724447">Dp</span><span class="op" id="3724449">,</span>&nbsp;<span class="ident" id="3724451">priv</span><span class="op" id="3724455">.</span><span class="ident" id="3724456">Primes</span><span class="op" id="3724462">[</span><span class="num" id="3724463">0</span><span class="op" id="3724464">]</span><span class="op" id="3724465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3724469">m2</span>&nbsp;<span class="op" id="3724472">:=</span>&nbsp;<span class="builtinfunc" id="3724475">new</span><span class="op" id="3724478">(</span><span class="ident" id="3724479">big</span><span class="op" id="3724482">.</span><span class="ident" id="3724483">Int</span><span class="op" id="3724486">)</span><span class="op" id="3724487">.</span><span class="ident" id="3724488">Exp</span><span class="op" id="3724491">(</span><span class="ident" id="3724492">c</span><span class="op" id="3724493">,</span>&nbsp;<span class="ident" id="3724495">priv</span><span class="op" id="3724499">.</span><span class="ident" id="3724500">Precomputed</span><span class="op" id="3724511">.</span><span class="ident" id="3724512">Dq</span><span class="op" id="3724514">,</span>&nbsp;<span class="ident" id="3724516">priv</span><span class="op" id="3724520">.</span><span class="ident" id="3724521">Primes</span><span class="op" id="3724527">[</span><span class="num" id="3724528">1</span><span class="op" id="3724529">]</span><span class="op" id="3724530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3724534">m</span><span class="op" id="3724535">.</span><span class="ident" id="3724536">Sub</span><span class="op" id="3724539">(</span><span class="ident" id="3724540">m</span><span class="op" id="3724541">,</span>&nbsp;<span class="ident" id="3724543">m2</span><span class="op" id="3724545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3724549">if</span>&nbsp;<span class="ident" id="3724552">m</span><span class="op" id="3724553">.</span><span class="ident" id="3724554">Sign</span><span class="op" id="3724558">(</span><span class="op" id="3724559">)</span>&nbsp;<span class="op" id="3724561">&lt;</span>&nbsp;<span class="num" id="3724563">0</span>&nbsp;<span class="op" id="3724565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3724570">m</span><span class="op" id="3724571">.</span><span class="ident" id="3724572">Add</span><span class="op" id="3724575">(</span><span class="ident" id="3724576">m</span><span class="op" id="3724577">,</span>&nbsp;<span class="ident" id="3724579">priv</span><span class="op" id="3724583">.</span><span class="ident" id="3724584">Primes</span><span class="op" id="3724590">[</span><span class="num" id="3724591">0</span><span class="op" id="3724592">]</span><span class="op" id="3724593">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3724597">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3724601">m</span><span class="op" id="3724602">.</span><span class="ident" id="3724603">Mul</span><span class="op" id="3724606">(</span><span class="ident" id="3724607">m</span><span class="op" id="3724608">,</span>&nbsp;<span class="ident" id="3724610">priv</span><span class="op" id="3724614">.</span><span class="ident" id="3724615">Precomputed</span><span class="op" id="3724626">.</span><span class="ident" id="3724627">Qinv</span><span class="op" id="3724631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3724635">m</span><span class="op" id="3724636">.</span><span class="ident" id="3724637">Mod</span><span class="op" id="3724640">(</span><span class="ident" id="3724641">m</span><span class="op" id="3724642">,</span>&nbsp;<span class="ident" id="3724644">priv</span><span class="op" id="3724648">.</span><span class="ident" id="3724649">Primes</span><span class="op" id="3724655">[</span><span class="num" id="3724656">0</span><span class="op" id="3724657">]</span><span class="op" id="3724658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3724662">m</span><span class="op" id="3724663">.</span><span class="ident" id="3724664">Mul</span><span class="op" id="3724667">(</span><span class="ident" id="3724668">m</span><span class="op" id="3724669">,</span>&nbsp;<span class="ident" id="3724671">priv</span><span class="op" id="3724675">.</span><span class="ident" id="3724676">Primes</span><span class="op" id="3724682">[</span><span class="num" id="3724683">1</span><span class="op" id="3724684">]</span><span class="op" id="3724685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3724689">m</span><span class="op" id="3724690">.</span><span class="ident" id="3724691">Add</span><span class="op" id="3724694">(</span><span class="ident" id="3724695">m</span><span class="op" id="3724696">,</span>&nbsp;<span class="ident" id="3724698">m2</span><span class="op" id="3724700">)</span><br>
<span class="lineno">450</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3724705">for</span>&nbsp;<span class="ident" id="3724709">i</span><span class="op" id="3724710">,</span>&nbsp;<span class="ident" id="3724712">values</span>&nbsp;<span class="op" id="3724719">:=</span>&nbsp;<span class="keyword" id="3724722">range</span>&nbsp;<span class="ident" id="3724728">priv</span><span class="op" id="3724732">.</span><span class="ident" id="3724733">Precomputed</span><span class="op" id="3724744">.</span><span class="ident" id="3724745">CRTValues</span>&nbsp;<span class="op" id="3724755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3724760">prime</span>&nbsp;<span class="op" id="3724766">:=</span>&nbsp;<span class="ident" id="3724769">priv</span><span class="op" id="3724773">.</span><span class="ident" id="3724774">Primes</span><span class="op" id="3724780">[</span><span class="num" id="3724781">2</span><span class="op" id="3724782">+</span><span class="ident" id="3724783">i</span><span class="op" id="3724784">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3724789">m2</span><span class="op" id="3724791">.</span><span class="ident" id="3724792">Exp</span><span class="op" id="3724795">(</span><span class="ident" id="3724796">c</span><span class="op" id="3724797">,</span>&nbsp;<span class="ident" id="3724799">values</span><span class="op" id="3724805">.</span><span class="ident" id="3724806">Exp</span><span class="op" id="3724809">,</span>&nbsp;<span class="ident" id="3724811">prime</span><span class="op" id="3724816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3724821">m2</span><span class="op" id="3724823">.</span><span class="ident" id="3724824">Sub</span><span class="op" id="3724827">(</span><span class="ident" id="3724828">m2</span><span class="op" id="3724830">,</span>&nbsp;<span class="ident" id="3724832">m</span><span class="op" id="3724833">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3724838">m2</span><span class="op" id="3724840">.</span><span class="ident" id="3724841">Mul</span><span class="op" id="3724844">(</span><span class="ident" id="3724845">m2</span><span class="op" id="3724847">,</span>&nbsp;<span class="ident" id="3724849">values</span><span class="op" id="3724855">.</span><span class="ident" id="3724856">Coeff</span><span class="op" id="3724861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3724866">m2</span><span class="op" id="3724868">.</span><span class="ident" id="3724869">Mod</span><span class="op" id="3724872">(</span><span class="ident" id="3724873">m2</span><span class="op" id="3724875">,</span>&nbsp;<span class="ident" id="3724877">prime</span><span class="op" id="3724882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3724887">if</span>&nbsp;<span class="ident" id="3724890">m2</span><span class="op" id="3724892">.</span><span class="ident" id="3724893">Sign</span><span class="op" id="3724897">(</span><span class="op" id="3724898">)</span>&nbsp;<span class="op" id="3724900">&lt;</span>&nbsp;<span class="num" id="3724902">0</span>&nbsp;<span class="op" id="3724904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3724910">m2</span><span class="op" id="3724912">.</span><span class="ident" id="3724913">Add</span><span class="op" id="3724916">(</span><span class="ident" id="3724917">m2</span><span class="op" id="3724919">,</span>&nbsp;<span class="ident" id="3724921">prime</span><span class="op" id="3724926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3724931">}</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3724936">m2</span><span class="op" id="3724938">.</span><span class="ident" id="3724939">Mul</span><span class="op" id="3724942">(</span><span class="ident" id="3724943">m2</span><span class="op" id="3724945">,</span>&nbsp;<span class="ident" id="3724947">values</span><span class="op" id="3724953">.</span><span class="ident" id="3724954">R</span><span class="op" id="3724955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3724960">m</span><span class="op" id="3724961">.</span><span class="ident" id="3724962">Add</span><span class="op" id="3724965">(</span><span class="ident" id="3724966">m</span><span class="op" id="3724967">,</span>&nbsp;<span class="ident" id="3724969">m2</span><span class="op" id="3724971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3724975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3724978">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3724982">if</span>&nbsp;<span class="ident" id="3724985">ir</span>&nbsp;<span class="op" id="3724988">!=</span>&nbsp;<span class="ident" id="3724991">nil</span>&nbsp;<span class="op" id="3724995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3724999">//&nbsp;Unblind.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3725013">m</span><span class="op" id="3725014">.</span><span class="ident" id="3725015">Mul</span><span class="op" id="3725018">(</span><span class="ident" id="3725019">m</span><span class="op" id="3725020">,</span>&nbsp;<span class="ident" id="3725022">ir</span><span class="op" id="3725024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3725028">m</span><span class="op" id="3725029">.</span><span class="ident" id="3725030">Mod</span><span class="op" id="3725033">(</span><span class="ident" id="3725034">m</span><span class="op" id="3725035">,</span>&nbsp;<span class="ident" id="3725037">priv</span><span class="op" id="3725041">.</span><span class="ident" id="3725042">N</span><span class="op" id="3725043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3725046">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3725050">return</span><br>
<span class="lineno"></span><span class="op" id="3725057">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3725060">//&nbsp;DecryptOAEP&nbsp;decrypts&nbsp;ciphertext&nbsp;using&nbsp;RSA-OAEP.</span><br>
<span class="lineno">475</span><span class="comment" id="3725111">//&nbsp;If&nbsp;random&nbsp;!=&nbsp;nil,&nbsp;DecryptOAEP&nbsp;uses&nbsp;RSA&nbsp;blinding&nbsp;to&nbsp;avoid&nbsp;timing&nbsp;side-channel&nbsp;attacks.</span><br>
<span class="lineno"></span><span class="keyword" id="3725200">func</span>&nbsp;<span class="ident" id="3725205">DecryptOAEP</span><span class="op" id="3725216">(</span><span class="ident" id="3725217">hash</span>&nbsp;<span class="ident" id="3725222">hash</span><span class="op" id="3725226">.</span><span class="ident" id="3725227">Hash</span><span class="op" id="3725231">,</span>&nbsp;<span class="ident" id="3725233">random</span>&nbsp;<span class="ident" id="3725240">io</span><span class="op" id="3725242">.</span><span class="ident" id="3725243">Reader</span><span class="op" id="3725249">,</span>&nbsp;<span class="ident" id="3725251">priv</span>&nbsp;<span class="op" id="3725256">*</span><span class="ident" id="3725257">PrivateKey</span><span class="op" id="3725267">,</span>&nbsp;<span class="ident" id="3725269">ciphertext</span>&nbsp;<span class="op" id="3725280">[</span><span class="op" id="3725281">]</span><span class="builtintype" id="3725282">byte</span><span class="op" id="3725286">,</span>&nbsp;<span class="ident" id="3725288">label</span>&nbsp;<span class="op" id="3725294">[</span><span class="op" id="3725295">]</span><span class="builtintype" id="3725296">byte</span><span class="op" id="3725300">)</span>&nbsp;<span class="op" id="3725302">(</span><span class="ident" id="3725303">msg</span>&nbsp;<span class="op" id="3725307">[</span><span class="op" id="3725308">]</span><span class="builtintype" id="3725309">byte</span><span class="op" id="3725313">,</span>&nbsp;<span class="ident" id="3725315">err</span>&nbsp;<span class="builtintype" id="3725319">error</span><span class="op" id="3725324">)</span>&nbsp;<span class="op" id="3725326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3725329">if</span>&nbsp;<span class="ident" id="3725332">err</span>&nbsp;<span class="op" id="3725336">:=</span>&nbsp;<span class="ident" id="3725339">checkPub</span><span class="op" id="3725347">(</span><span class="op" id="3725348">&amp;</span><span class="ident" id="3725349">priv</span><span class="op" id="3725353">.</span><span class="ident" id="3725354">PublicKey</span><span class="op" id="3725363">)</span><span class="op" id="3725364">;</span>&nbsp;<span class="ident" id="3725366">err</span>&nbsp;<span class="op" id="3725370">!=</span>&nbsp;<span class="ident" id="3725373">nil</span>&nbsp;<span class="op" id="3725377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3725381">return</span>&nbsp;<span class="ident" id="3725388">nil</span><span class="op" id="3725391">,</span>&nbsp;<span class="ident" id="3725393">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3725398">}</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3725401">k</span>&nbsp;<span class="op" id="3725403">:=</span>&nbsp;<span class="op" id="3725406">(</span><span class="ident" id="3725407">priv</span><span class="op" id="3725411">.</span><span class="ident" id="3725412">N</span><span class="op" id="3725413">.</span><span class="ident" id="3725414">BitLen</span><span class="op" id="3725420">(</span><span class="op" id="3725421">)</span>&nbsp;<span class="op" id="3725423">+</span>&nbsp;<span class="num" id="3725425">7</span><span class="op" id="3725426">)</span>&nbsp;<span class="op" id="3725428">/</span>&nbsp;<span class="num" id="3725430">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3725433">if</span>&nbsp;<span class="builtinfunc" id="3725436">len</span><span class="op" id="3725439">(</span><span class="ident" id="3725440">ciphertext</span><span class="op" id="3725450">)</span>&nbsp;<span class="op" id="3725452">&gt;</span>&nbsp;<span class="ident" id="3725454">k</span>&nbsp;<span class="op" id="3725456">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3725461">k</span>&nbsp;<span class="op" id="3725463">&lt;</span>&nbsp;<span class="ident" id="3725465">hash</span><span class="op" id="3725469">.</span><span class="ident" id="3725470">Size</span><span class="op" id="3725474">(</span><span class="op" id="3725475">)</span><span class="op" id="3725476">*</span><span class="num" id="3725477">2</span><span class="op" id="3725478">+</span><span class="num" id="3725479">2</span>&nbsp;<span class="op" id="3725481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3725485">err</span>&nbsp;<span class="op" id="3725489">=</span>&nbsp;<span class="ident" id="3725491">ErrDecryption</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3725507">return</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3725515">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3725519">c</span>&nbsp;<span class="op" id="3725521">:=</span>&nbsp;<span class="builtinfunc" id="3725524">new</span><span class="op" id="3725527">(</span><span class="ident" id="3725528">big</span><span class="op" id="3725531">.</span><span class="ident" id="3725532">Int</span><span class="op" id="3725535">)</span><span class="op" id="3725536">.</span><span class="ident" id="3725537">SetBytes</span><span class="op" id="3725545">(</span><span class="ident" id="3725546">ciphertext</span><span class="op" id="3725556">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3725560">m</span><span class="op" id="3725561">,</span>&nbsp;<span class="ident" id="3725563">err</span>&nbsp;<span class="op" id="3725567">:=</span>&nbsp;<span class="ident" id="3725570">decrypt</span><span class="op" id="3725577">(</span><span class="ident" id="3725578">random</span><span class="op" id="3725584">,</span>&nbsp;<span class="ident" id="3725586">priv</span><span class="op" id="3725590">,</span>&nbsp;<span class="ident" id="3725592">c</span><span class="op" id="3725593">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3725596">if</span>&nbsp;<span class="ident" id="3725599">err</span>&nbsp;<span class="op" id="3725603">!=</span>&nbsp;<span class="ident" id="3725606">nil</span>&nbsp;<span class="op" id="3725610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3725614">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3725622">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3725626">hash</span><span class="op" id="3725630">.</span><span class="ident" id="3725631">Write</span><span class="op" id="3725636">(</span><span class="ident" id="3725637">label</span><span class="op" id="3725642">)</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3725645">lHash</span>&nbsp;<span class="op" id="3725651">:=</span>&nbsp;<span class="ident" id="3725654">hash</span><span class="op" id="3725658">.</span><span class="ident" id="3725659">Sum</span><span class="op" id="3725662">(</span><span class="ident" id="3725663">nil</span><span class="op" id="3725666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3725669">hash</span><span class="op" id="3725673">.</span><span class="ident" id="3725674">Reset</span><span class="op" id="3725679">(</span><span class="op" id="3725680">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3725684">//&nbsp;Converting&nbsp;the&nbsp;plaintext&nbsp;number&nbsp;to&nbsp;bytes&nbsp;will&nbsp;strip&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3725744">//&nbsp;leading&nbsp;zeros&nbsp;so&nbsp;we&nbsp;may&nbsp;have&nbsp;to&nbsp;left&nbsp;pad.&nbsp;We&nbsp;do&nbsp;this&nbsp;unconditionally</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3725817">//&nbsp;to&nbsp;avoid&nbsp;leaking&nbsp;timing&nbsp;information.&nbsp;(Although&nbsp;we&nbsp;still&nbsp;probably</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3725886">//&nbsp;leak&nbsp;the&nbsp;number&nbsp;of&nbsp;leading&nbsp;zeros.&nbsp;It&#39;s&nbsp;not&nbsp;clear&nbsp;that&nbsp;we&nbsp;can&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3725954">//&nbsp;anything&nbsp;about&nbsp;this.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3725980">em</span>&nbsp;<span class="op" id="3725983">:=</span>&nbsp;<span class="ident" id="3725986">leftPad</span><span class="op" id="3725993">(</span><span class="ident" id="3725994">m</span><span class="op" id="3725995">.</span><span class="ident" id="3725996">Bytes</span><span class="op" id="3726001">(</span><span class="op" id="3726002">)</span><span class="op" id="3726003">,</span>&nbsp;<span class="ident" id="3726005">k</span><span class="op" id="3726006">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3726010">firstByteIsZero</span>&nbsp;<span class="op" id="3726026">:=</span>&nbsp;<span class="ident" id="3726029">subtle</span><span class="op" id="3726035">.</span><span class="ident" id="3726036">ConstantTimeByteEq</span><span class="op" id="3726054">(</span><span class="ident" id="3726055">em</span><span class="op" id="3726057">[</span><span class="num" id="3726058">0</span><span class="op" id="3726059">]</span><span class="op" id="3726060">,</span>&nbsp;<span class="num" id="3726062">0</span><span class="op" id="3726063">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3726067">seed</span>&nbsp;<span class="op" id="3726072">:=</span>&nbsp;<span class="ident" id="3726075">em</span><span class="op" id="3726077">[</span><span class="num" id="3726078">1</span>&nbsp;<span class="op" id="3726080">:</span>&nbsp;<span class="ident" id="3726082">hash</span><span class="op" id="3726086">.</span><span class="ident" id="3726087">Size</span><span class="op" id="3726091">(</span><span class="op" id="3726092">)</span><span class="op" id="3726093">+</span><span class="num" id="3726094">1</span><span class="op" id="3726095">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3726098">db</span>&nbsp;<span class="op" id="3726101">:=</span>&nbsp;<span class="ident" id="3726104">em</span><span class="op" id="3726106">[</span><span class="ident" id="3726107">hash</span><span class="op" id="3726111">.</span><span class="ident" id="3726112">Size</span><span class="op" id="3726116">(</span><span class="op" id="3726117">)</span><span class="op" id="3726118">+</span><span class="num" id="3726119">1</span><span class="op" id="3726120">:</span><span class="op" id="3726121">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3726125">mgf1XOR</span><span class="op" id="3726132">(</span><span class="ident" id="3726133">seed</span><span class="op" id="3726137">,</span>&nbsp;<span class="ident" id="3726139">hash</span><span class="op" id="3726143">,</span>&nbsp;<span class="ident" id="3726145">db</span><span class="op" id="3726147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3726150">mgf1XOR</span><span class="op" id="3726157">(</span><span class="ident" id="3726158">db</span><span class="op" id="3726160">,</span>&nbsp;<span class="ident" id="3726162">hash</span><span class="op" id="3726166">,</span>&nbsp;<span class="ident" id="3726168">seed</span><span class="op" id="3726172">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3726176">lHash2</span>&nbsp;<span class="op" id="3726183">:=</span>&nbsp;<span class="ident" id="3726186">db</span><span class="op" id="3726188">[</span><span class="num" id="3726189">0</span><span class="op" id="3726190">:</span><span class="ident" id="3726191">hash</span><span class="op" id="3726195">.</span><span class="ident" id="3726196">Size</span><span class="op" id="3726200">(</span><span class="op" id="3726201">)</span><span class="op" id="3726202">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3726206">//&nbsp;We&nbsp;have&nbsp;to&nbsp;validate&nbsp;the&nbsp;plaintext&nbsp;in&nbsp;constant&nbsp;time&nbsp;in&nbsp;order&nbsp;to&nbsp;avoid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3726279">//&nbsp;attacks&nbsp;like:&nbsp;J.&nbsp;Manger.&nbsp;A&nbsp;Chosen&nbsp;Ciphertext&nbsp;Attack&nbsp;on&nbsp;RSA&nbsp;Optimal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3726350">//&nbsp;Asymmetric&nbsp;Encryption&nbsp;Padding&nbsp;(OAEP)&nbsp;as&nbsp;Standardized&nbsp;in&nbsp;PKCS&nbsp;#1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3726418">//&nbsp;v2.0.&nbsp;In&nbsp;J.&nbsp;Kilian,&nbsp;editor,&nbsp;Advances&nbsp;in&nbsp;Cryptology.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3726474">lHash2Good</span>&nbsp;<span class="op" id="3726485">:=</span>&nbsp;<span class="ident" id="3726488">subtle</span><span class="op" id="3726494">.</span><span class="ident" id="3726495">ConstantTimeCompare</span><span class="op" id="3726514">(</span><span class="ident" id="3726515">lHash</span><span class="op" id="3726520">,</span>&nbsp;<span class="ident" id="3726522">lHash2</span><span class="op" id="3726528">)</span><br>
<span class="lineno">520</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3726532">//&nbsp;The&nbsp;remainder&nbsp;of&nbsp;the&nbsp;plaintext&nbsp;must&nbsp;be&nbsp;zero&nbsp;or&nbsp;more&nbsp;0x00,&nbsp;followed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3726603">//&nbsp;by&nbsp;0x01,&nbsp;followed&nbsp;by&nbsp;the&nbsp;message.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3726641">//&nbsp;&nbsp;&nbsp;lookingForIndex:&nbsp;1&nbsp;iff&nbsp;we&nbsp;are&nbsp;still&nbsp;looking&nbsp;for&nbsp;the&nbsp;0x01</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3726704">//&nbsp;&nbsp;&nbsp;index:&nbsp;the&nbsp;offset&nbsp;of&nbsp;the&nbsp;first&nbsp;0x01&nbsp;byte</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3726751">//&nbsp;&nbsp;&nbsp;invalid:&nbsp;1&nbsp;iff&nbsp;we&nbsp;saw&nbsp;a&nbsp;non-zero&nbsp;byte&nbsp;before&nbsp;the&nbsp;0x01.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3726812">var</span>&nbsp;<span class="ident" id="3726816">lookingForIndex</span><span class="op" id="3726831">,</span>&nbsp;<span class="ident" id="3726833">index</span><span class="op" id="3726838">,</span>&nbsp;<span class="ident" id="3726840">invalid</span>&nbsp;<span class="builtintype" id="3726848">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3726853">lookingForIndex</span>&nbsp;<span class="op" id="3726869">=</span>&nbsp;<span class="num" id="3726871">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3726874">rest</span>&nbsp;<span class="op" id="3726879">:=</span>&nbsp;<span class="ident" id="3726882">db</span><span class="op" id="3726884">[</span><span class="ident" id="3726885">hash</span><span class="op" id="3726889">.</span><span class="ident" id="3726890">Size</span><span class="op" id="3726894">(</span><span class="op" id="3726895">)</span><span class="op" id="3726896">:</span><span class="op" id="3726897">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3726901">for</span>&nbsp;<span class="ident" id="3726905">i</span>&nbsp;<span class="op" id="3726907">:=</span>&nbsp;<span class="num" id="3726910">0</span><span class="op" id="3726911">;</span>&nbsp;<span class="ident" id="3726913">i</span>&nbsp;<span class="op" id="3726915">&lt;</span>&nbsp;<span class="builtinfunc" id="3726917">len</span><span class="op" id="3726920">(</span><span class="ident" id="3726921">rest</span><span class="op" id="3726925">)</span><span class="op" id="3726926">;</span>&nbsp;<span class="ident" id="3726928">i</span><span class="op" id="3726929">++</span>&nbsp;<span class="op" id="3726932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3726936">equals0</span>&nbsp;<span class="op" id="3726944">:=</span>&nbsp;<span class="ident" id="3726947">subtle</span><span class="op" id="3726953">.</span><span class="ident" id="3726954">ConstantTimeByteEq</span><span class="op" id="3726972">(</span><span class="ident" id="3726973">rest</span><span class="op" id="3726977">[</span><span class="ident" id="3726978">i</span><span class="op" id="3726979">]</span><span class="op" id="3726980">,</span>&nbsp;<span class="num" id="3726982">0</span><span class="op" id="3726983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3726987">equals1</span>&nbsp;<span class="op" id="3726995">:=</span>&nbsp;<span class="ident" id="3726998">subtle</span><span class="op" id="3727004">.</span><span class="ident" id="3727005">ConstantTimeByteEq</span><span class="op" id="3727023">(</span><span class="ident" id="3727024">rest</span><span class="op" id="3727028">[</span><span class="ident" id="3727029">i</span><span class="op" id="3727030">]</span><span class="op" id="3727031">,</span>&nbsp;<span class="num" id="3727033">1</span><span class="op" id="3727034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3727038">index</span>&nbsp;<span class="op" id="3727044">=</span>&nbsp;<span class="ident" id="3727046">subtle</span><span class="op" id="3727052">.</span><span class="ident" id="3727053">ConstantTimeSelect</span><span class="op" id="3727071">(</span><span class="ident" id="3727072">lookingForIndex</span><span class="op" id="3727087">&amp;</span><span class="ident" id="3727088">equals1</span><span class="op" id="3727095">,</span>&nbsp;<span class="ident" id="3727097">i</span><span class="op" id="3727098">,</span>&nbsp;<span class="ident" id="3727100">index</span><span class="op" id="3727105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3727109">lookingForIndex</span>&nbsp;<span class="op" id="3727125">=</span>&nbsp;<span class="ident" id="3727127">subtle</span><span class="op" id="3727133">.</span><span class="ident" id="3727134">ConstantTimeSelect</span><span class="op" id="3727152">(</span><span class="ident" id="3727153">equals1</span><span class="op" id="3727160">,</span>&nbsp;<span class="num" id="3727162">0</span><span class="op" id="3727163">,</span>&nbsp;<span class="ident" id="3727165">lookingForIndex</span><span class="op" id="3727180">)</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3727184">invalid</span>&nbsp;<span class="op" id="3727192">=</span>&nbsp;<span class="ident" id="3727194">subtle</span><span class="op" id="3727200">.</span><span class="ident" id="3727201">ConstantTimeSelect</span><span class="op" id="3727219">(</span><span class="ident" id="3727220">lookingForIndex</span><span class="op" id="3727235">&amp;^</span><span class="ident" id="3727237">equals0</span><span class="op" id="3727244">,</span>&nbsp;<span class="num" id="3727246">1</span><span class="op" id="3727247">,</span>&nbsp;<span class="ident" id="3727249">invalid</span><span class="op" id="3727256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3727259">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3727263">if</span>&nbsp;<span class="ident" id="3727266">firstByteIsZero</span><span class="op" id="3727281">&amp;</span><span class="ident" id="3727282">lHash2Good</span><span class="op" id="3727292">&amp;^</span><span class="ident" id="3727294">invalid</span><span class="op" id="3727301">&amp;^</span><span class="ident" id="3727303">lookingForIndex</span>&nbsp;<span class="op" id="3727319">!=</span>&nbsp;<span class="num" id="3727322">1</span>&nbsp;<span class="op" id="3727324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3727328">err</span>&nbsp;<span class="op" id="3727332">=</span>&nbsp;<span class="ident" id="3727334">ErrDecryption</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3727350">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3727358">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3727362">msg</span>&nbsp;<span class="op" id="3727366">=</span>&nbsp;<span class="ident" id="3727368">rest</span><span class="op" id="3727372">[</span><span class="ident" id="3727373">index</span><span class="op" id="3727378">+</span><span class="num" id="3727379">1</span><span class="op" id="3727380">:</span><span class="op" id="3727381">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3727384">return</span><br>
<span class="lineno">545</span><span class="op" id="3727391">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3727394">//&nbsp;leftPad&nbsp;returns&nbsp;a&nbsp;new&nbsp;slice&nbsp;of&nbsp;length&nbsp;size.&nbsp;The&nbsp;contents&nbsp;of&nbsp;input&nbsp;are&nbsp;right</span><br>
<span class="lineno"></span><span class="comment" id="3727473">//&nbsp;aligned&nbsp;in&nbsp;the&nbsp;new&nbsp;slice.</span><br>
<span class="lineno"></span><span class="keyword" id="3727502">func</span>&nbsp;<span class="ident" id="3727507">leftPad</span><span class="op" id="3727514">(</span><span class="ident" id="3727515">input</span>&nbsp;<span class="op" id="3727521">[</span><span class="op" id="3727522">]</span><span class="builtintype" id="3727523">byte</span><span class="op" id="3727527">,</span>&nbsp;<span class="ident" id="3727529">size</span>&nbsp;<span class="builtintype" id="3727534">int</span><span class="op" id="3727537">)</span>&nbsp;<span class="op" id="3727539">(</span><span class="ident" id="3727540">out</span>&nbsp;<span class="op" id="3727544">[</span><span class="op" id="3727545">]</span><span class="builtintype" id="3727546">byte</span><span class="op" id="3727550">)</span>&nbsp;<span class="op" id="3727552">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3727555">n</span>&nbsp;<span class="op" id="3727557">:=</span>&nbsp;<span class="builtinfunc" id="3727560">len</span><span class="op" id="3727563">(</span><span class="ident" id="3727564">input</span><span class="op" id="3727569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3727572">if</span>&nbsp;<span class="ident" id="3727575">n</span>&nbsp;<span class="op" id="3727577">&gt;</span>&nbsp;<span class="ident" id="3727579">size</span>&nbsp;<span class="op" id="3727584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3727588">n</span>&nbsp;<span class="op" id="3727590">=</span>&nbsp;<span class="ident" id="3727592">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3727598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3727601">out</span>&nbsp;<span class="op" id="3727605">=</span>&nbsp;<span class="builtinfunc" id="3727607">make</span><span class="op" id="3727611">(</span><span class="op" id="3727612">[</span><span class="op" id="3727613">]</span><span class="builtintype" id="3727614">byte</span><span class="op" id="3727618">,</span>&nbsp;<span class="ident" id="3727620">size</span><span class="op" id="3727624">)</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3727627">copy</span><span class="op" id="3727631">(</span><span class="ident" id="3727632">out</span><span class="op" id="3727635">[</span><span class="builtinfunc" id="3727636">len</span><span class="op" id="3727639">(</span><span class="ident" id="3727640">out</span><span class="op" id="3727643">)</span><span class="op" id="3727644">-</span><span class="ident" id="3727645">n</span><span class="op" id="3727646">:</span><span class="op" id="3727647">]</span><span class="op" id="3727648">,</span>&nbsp;<span class="ident" id="3727650">input</span><span class="op" id="3727655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3727658">return</span><br>
<span class="lineno"></span><span class="op" id="3727665">}</span>
</div>
</body>
</html>
