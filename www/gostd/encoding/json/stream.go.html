<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/json</h2>
<ul>
<li><a href="/gostd/encoding/json/bench_test.go.html">bench_test.go</a></li>
<li><a href="/gostd/encoding/json/decode.go.html">decode.go</a></li>
<li><a href="/gostd/encoding/json/decode_test.go.html">decode_test.go</a></li>
<li><a href="/gostd/encoding/json/encode.go.html">encode.go</a></li>
<li><a href="/gostd/encoding/json/encode_test.go.html">encode_test.go</a></li>
<li><a href="/gostd/encoding/json/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/json/fold.go.html">fold.go</a></li>
<li><a href="/gostd/encoding/json/fold_test.go.html">fold_test.go</a></li>
<li><a href="/gostd/encoding/json/indent.go.html">indent.go</a></li>
<li><a href="/gostd/encoding/json/scanner.go.html">scanner.go</a></li>
<li><a href="/gostd/encoding/json/scanner_test.go.html">scanner_test.go</a></li>
<li><a href="/gostd/encoding/json/stream.go.html">stream.go</a></li>
<li><a href="/gostd/encoding/json/stream_test.go.html">stream_test.go</a></li>
<li><a href="/gostd/encoding/json/tagkey_test.go.html">tagkey_test.go</a></li>
<li><a href="/gostd/encoding/json/tags.go.html">tags.go</a></li>
<li><a href="/gostd/encoding/json/tags_test.go.html">tags_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5360130">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5360186">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5360240">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5360291">package</span>&nbsp;<span class="ident" id="5360299">json</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5360305">import</span>&nbsp;<span class="op" id="5360312">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5360315">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5360324">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5360334">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="5360339">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5360342">//&nbsp;A&nbsp;Decoder&nbsp;reads&nbsp;and&nbsp;decodes&nbsp;JSON&nbsp;objects&nbsp;from&nbsp;an&nbsp;input&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="5360408">type</span>&nbsp;<span class="ident" id="5360413">Decoder</span>&nbsp;<span class="keyword" id="5360421">struct</span>&nbsp;<span class="op" id="5360428">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5360431">r</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5360436">io</span><span class="op" id="5360438">.</span><span class="ident" id="5360439">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5360447">buf</span>&nbsp;&nbsp;<span class="op" id="5360452">[</span><span class="op" id="5360453">]</span><span class="builtintype" id="5360454">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5360460">d</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5360465">decodeState</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5360478">scan</span>&nbsp;<span class="ident" id="5360483">scanner</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5360492">err</span>&nbsp;&nbsp;<span class="builtintype" id="5360497">error</span><br>
<span class="lineno">20</span><span class="op" id="5360503">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5360506">//&nbsp;NewDecoder&nbsp;returns&nbsp;a&nbsp;new&nbsp;decoder&nbsp;that&nbsp;reads&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="5360561">//</span><br>
<span class="lineno"></span><span class="comment" id="5360564">//&nbsp;The&nbsp;decoder&nbsp;introduces&nbsp;its&nbsp;own&nbsp;buffering&nbsp;and&nbsp;may</span><br>
<span class="lineno">25</span><span class="comment" id="5360616">//&nbsp;read&nbsp;data&nbsp;from&nbsp;r&nbsp;beyond&nbsp;the&nbsp;JSON&nbsp;values&nbsp;requested.</span><br>
<span class="lineno"></span><span class="keyword" id="5360670">func</span>&nbsp;<span class="ident" id="5360675">NewDecoder</span><span class="op" id="5360685">(</span><span class="ident" id="5360686">r</span>&nbsp;<span class="ident" id="5360688">io</span><span class="op" id="5360690">.</span><span class="ident" id="5360691">Reader</span><span class="op" id="5360697">)</span>&nbsp;<span class="op" id="5360699">*</span><span class="ident" id="5360700">Decoder</span>&nbsp;<span class="op" id="5360708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5360711">return</span>&nbsp;<span class="op" id="5360718">&amp;</span><span class="ident" id="5360719">Decoder</span><span class="op" id="5360726">{</span><span class="ident" id="5360727">r</span><span class="op" id="5360728">:</span>&nbsp;<span class="ident" id="5360730">r</span><span class="op" id="5360731">}</span><br>
<span class="lineno"></span><span class="op" id="5360733">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="5360736">//&nbsp;UseNumber&nbsp;causes&nbsp;the&nbsp;Decoder&nbsp;to&nbsp;unmarshal&nbsp;a&nbsp;number&nbsp;into&nbsp;an&nbsp;interface{}&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5360815">//&nbsp;Number&nbsp;instead&nbsp;of&nbsp;as&nbsp;a&nbsp;float64.</span><br>
<span class="lineno"></span><span class="keyword" id="5360850">func</span>&nbsp;<span class="op" id="5360855">(</span><span class="ident" id="5360856">dec</span>&nbsp;<span class="op" id="5360860">*</span><span class="ident" id="5360861">Decoder</span><span class="op" id="5360868">)</span>&nbsp;<span class="ident" id="5360870">UseNumber</span><span class="op" id="5360879">(</span><span class="op" id="5360880">)</span>&nbsp;<span class="op" id="5360882">{</span>&nbsp;<span class="ident" id="5360884">dec</span><span class="op" id="5360887">.</span><span class="ident" id="5360888">d</span><span class="op" id="5360889">.</span><span class="ident" id="5360890">useNumber</span>&nbsp;<span class="op" id="5360900">=</span>&nbsp;<span class="builtintype" id="5360902">true</span>&nbsp;<span class="op" id="5360907">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5360910">//&nbsp;Decode&nbsp;reads&nbsp;the&nbsp;next&nbsp;JSON-encoded&nbsp;value&nbsp;from&nbsp;its</span><br>
<span class="lineno">35</span><span class="comment" id="5360963">//&nbsp;input&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;the&nbsp;value&nbsp;pointed&nbsp;to&nbsp;by&nbsp;v.</span><br>
<span class="lineno"></span><span class="comment" id="5361016">//</span><br>
<span class="lineno"></span><span class="comment" id="5361019">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;Unmarshal&nbsp;for&nbsp;details&nbsp;about</span><br>
<span class="lineno"></span><span class="comment" id="5361076">//&nbsp;the&nbsp;conversion&nbsp;of&nbsp;JSON&nbsp;into&nbsp;a&nbsp;Go&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="5361119">func</span>&nbsp;<span class="op" id="5361124">(</span><span class="ident" id="5361125">dec</span>&nbsp;<span class="op" id="5361129">*</span><span class="ident" id="5361130">Decoder</span><span class="op" id="5361137">)</span>&nbsp;<span class="ident" id="5361139">Decode</span><span class="op" id="5361145">(</span><span class="ident" id="5361146">v</span>&nbsp;<span class="keyword" id="5361148">interface</span><span class="op" id="5361157">{</span><span class="op" id="5361158">}</span><span class="op" id="5361159">)</span>&nbsp;<span class="builtintype" id="5361161">error</span>&nbsp;<span class="op" id="5361167">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5361170">if</span>&nbsp;<span class="ident" id="5361173">dec</span><span class="op" id="5361176">.</span><span class="ident" id="5361177">err</span>&nbsp;<span class="op" id="5361181">!=</span>&nbsp;<span class="ident" id="5361184">nil</span>&nbsp;<span class="op" id="5361188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5361192">return</span>&nbsp;<span class="ident" id="5361199">dec</span><span class="op" id="5361202">.</span><span class="ident" id="5361203">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5361208">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5361212">n</span><span class="op" id="5361213">,</span>&nbsp;<span class="ident" id="5361215">err</span>&nbsp;<span class="op" id="5361219">:=</span>&nbsp;<span class="ident" id="5361222">dec</span><span class="op" id="5361225">.</span><span class="ident" id="5361226">readValue</span><span class="op" id="5361235">(</span><span class="op" id="5361236">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5361239">if</span>&nbsp;<span class="ident" id="5361242">err</span>&nbsp;<span class="op" id="5361246">!=</span>&nbsp;<span class="ident" id="5361249">nil</span>&nbsp;<span class="op" id="5361253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5361257">return</span>&nbsp;<span class="ident" id="5361264">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5361269">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5361273">//&nbsp;Don&#39;t&nbsp;save&nbsp;err&nbsp;from&nbsp;unmarshal&nbsp;into&nbsp;dec.err:</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5361321">//&nbsp;the&nbsp;connection&nbsp;is&nbsp;still&nbsp;usable&nbsp;since&nbsp;we&nbsp;read&nbsp;a&nbsp;complete&nbsp;JSON</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5361386">//&nbsp;object&nbsp;from&nbsp;it&nbsp;before&nbsp;the&nbsp;error&nbsp;happened.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5361432">dec</span><span class="op" id="5361435">.</span><span class="ident" id="5361436">d</span><span class="op" id="5361437">.</span><span class="ident" id="5361438">init</span><span class="op" id="5361442">(</span><span class="ident" id="5361443">dec</span><span class="op" id="5361446">.</span><span class="ident" id="5361447">buf</span><span class="op" id="5361450">[</span><span class="num" id="5361451">0</span><span class="op" id="5361452">:</span><span class="ident" id="5361453">n</span><span class="op" id="5361454">]</span><span class="op" id="5361455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5361458">err</span>&nbsp;<span class="op" id="5361462">=</span>&nbsp;<span class="ident" id="5361464">dec</span><span class="op" id="5361467">.</span><span class="ident" id="5361468">d</span><span class="op" id="5361469">.</span><span class="ident" id="5361470">unmarshal</span><span class="op" id="5361479">(</span><span class="ident" id="5361480">v</span><span class="op" id="5361481">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5361485">//&nbsp;Slide&nbsp;rest&nbsp;of&nbsp;data&nbsp;down.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5361514">rest</span>&nbsp;<span class="op" id="5361519">:=</span>&nbsp;<span class="builtinfunc" id="5361522">copy</span><span class="op" id="5361526">(</span><span class="ident" id="5361527">dec</span><span class="op" id="5361530">.</span><span class="ident" id="5361531">buf</span><span class="op" id="5361534">,</span>&nbsp;<span class="ident" id="5361536">dec</span><span class="op" id="5361539">.</span><span class="ident" id="5361540">buf</span><span class="op" id="5361543">[</span><span class="ident" id="5361544">n</span><span class="op" id="5361545">:</span><span class="op" id="5361546">]</span><span class="op" id="5361547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5361550">dec</span><span class="op" id="5361553">.</span><span class="ident" id="5361554">buf</span>&nbsp;<span class="op" id="5361558">=</span>&nbsp;<span class="ident" id="5361560">dec</span><span class="op" id="5361563">.</span><span class="ident" id="5361564">buf</span><span class="op" id="5361567">[</span><span class="num" id="5361568">0</span><span class="op" id="5361569">:</span><span class="ident" id="5361570">rest</span><span class="op" id="5361574">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5361578">return</span>&nbsp;<span class="ident" id="5361585">err</span><br>
<span class="lineno">60</span><span class="op" id="5361589">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5361592">//&nbsp;Buffered&nbsp;returns&nbsp;a&nbsp;reader&nbsp;of&nbsp;the&nbsp;data&nbsp;remaining&nbsp;in&nbsp;the&nbsp;Decoder&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="5361660">//&nbsp;buffer.&nbsp;The&nbsp;reader&nbsp;is&nbsp;valid&nbsp;until&nbsp;the&nbsp;next&nbsp;call&nbsp;to&nbsp;Decode.</span><br>
<span class="lineno"></span><span class="keyword" id="5361722">func</span>&nbsp;<span class="op" id="5361727">(</span><span class="ident" id="5361728">dec</span>&nbsp;<span class="op" id="5361732">*</span><span class="ident" id="5361733">Decoder</span><span class="op" id="5361740">)</span>&nbsp;<span class="ident" id="5361742">Buffered</span><span class="op" id="5361750">(</span><span class="op" id="5361751">)</span>&nbsp;<span class="ident" id="5361753">io</span><span class="op" id="5361755">.</span><span class="ident" id="5361756">Reader</span>&nbsp;<span class="op" id="5361763">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5361766">return</span>&nbsp;<span class="ident" id="5361773">bytes</span><span class="op" id="5361778">.</span><span class="ident" id="5361779">NewReader</span><span class="op" id="5361788">(</span><span class="ident" id="5361789">dec</span><span class="op" id="5361792">.</span><span class="ident" id="5361793">buf</span><span class="op" id="5361796">)</span><br>
<span class="lineno"></span><span class="op" id="5361798">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5361801">//&nbsp;readValue&nbsp;reads&nbsp;a&nbsp;JSON&nbsp;value&nbsp;into&nbsp;dec.buf.</span><br>
<span class="lineno"></span><span class="comment" id="5361847">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno">70</span><span class="keyword" id="5361889">func</span>&nbsp;<span class="op" id="5361894">(</span><span class="ident" id="5361895">dec</span>&nbsp;<span class="op" id="5361899">*</span><span class="ident" id="5361900">Decoder</span><span class="op" id="5361907">)</span>&nbsp;<span class="ident" id="5361909">readValue</span><span class="op" id="5361918">(</span><span class="op" id="5361919">)</span>&nbsp;<span class="op" id="5361921">(</span><span class="builtintype" id="5361922">int</span><span class="op" id="5361925">,</span>&nbsp;<span class="builtintype" id="5361927">error</span><span class="op" id="5361932">)</span>&nbsp;<span class="op" id="5361934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5361937">dec</span><span class="op" id="5361940">.</span><span class="ident" id="5361941">scan</span><span class="op" id="5361945">.</span><span class="ident" id="5361946">reset</span><span class="op" id="5361951">(</span><span class="op" id="5361952">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5361956">scanp</span>&nbsp;<span class="op" id="5361962">:=</span>&nbsp;<span class="num" id="5361965">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5361968">var</span>&nbsp;<span class="ident" id="5361972">err</span>&nbsp;<span class="builtintype" id="5361976">error</span><br>
<span class="lineno">75</span><span class="ident" id="5361982">Input</span><span class="op" id="5361987">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5361990">for</span>&nbsp;<span class="op" id="5361994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5361998">//&nbsp;Look&nbsp;in&nbsp;the&nbsp;buffer&nbsp;for&nbsp;a&nbsp;new&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5362039">for</span>&nbsp;<span class="ident" id="5362043">i</span><span class="op" id="5362044">,</span>&nbsp;<span class="ident" id="5362046">c</span>&nbsp;<span class="op" id="5362048">:=</span>&nbsp;<span class="keyword" id="5362051">range</span>&nbsp;<span class="ident" id="5362057">dec</span><span class="op" id="5362060">.</span><span class="ident" id="5362061">buf</span><span class="op" id="5362064">[</span><span class="ident" id="5362065">scanp</span><span class="op" id="5362070">:</span><span class="op" id="5362071">]</span>&nbsp;<span class="op" id="5362073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5362078">dec</span><span class="op" id="5362081">.</span><span class="ident" id="5362082">scan</span><span class="op" id="5362086">.</span><span class="ident" id="5362087">bytes</span><span class="op" id="5362092">++</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5362098">v</span>&nbsp;<span class="op" id="5362100">:=</span>&nbsp;<span class="ident" id="5362103">dec</span><span class="op" id="5362106">.</span><span class="ident" id="5362107">scan</span><span class="op" id="5362111">.</span><span class="ident" id="5362112">step</span><span class="op" id="5362116">(</span><span class="op" id="5362117">&amp;</span><span class="ident" id="5362118">dec</span><span class="op" id="5362121">.</span><span class="ident" id="5362122">scan</span><span class="op" id="5362126">,</span>&nbsp;<span class="builtintype" id="5362128">int</span><span class="op" id="5362131">(</span><span class="ident" id="5362132">c</span><span class="op" id="5362133">)</span><span class="op" id="5362134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5362139">if</span>&nbsp;<span class="ident" id="5362142">v</span>&nbsp;<span class="op" id="5362144">==</span>&nbsp;<span class="ident" id="5362147">scanEnd</span>&nbsp;<span class="op" id="5362155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5362161">scanp</span>&nbsp;<span class="op" id="5362167">+=</span>&nbsp;<span class="ident" id="5362170">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5362176">break</span>&nbsp;<span class="ident" id="5362182">Input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5362191">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5362196">//&nbsp;scanEnd&nbsp;is&nbsp;delayed&nbsp;one&nbsp;byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5362231">//&nbsp;We&nbsp;might&nbsp;block&nbsp;trying&nbsp;to&nbsp;get&nbsp;that&nbsp;byte&nbsp;from&nbsp;src,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5362286">//&nbsp;so&nbsp;instead&nbsp;invent&nbsp;a&nbsp;space&nbsp;byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5362324">if</span>&nbsp;<span class="op" id="5362327">(</span><span class="ident" id="5362328">v</span>&nbsp;<span class="op" id="5362330">==</span>&nbsp;<span class="ident" id="5362333">scanEndObject</span>&nbsp;<span class="op" id="5362347">||</span>&nbsp;<span class="ident" id="5362350">v</span>&nbsp;<span class="op" id="5362352">==</span>&nbsp;<span class="ident" id="5362355">scanEndArray</span><span class="op" id="5362367">)</span>&nbsp;<span class="op" id="5362369">&amp;&amp;</span>&nbsp;<span class="ident" id="5362372">dec</span><span class="op" id="5362375">.</span><span class="ident" id="5362376">scan</span><span class="op" id="5362380">.</span><span class="ident" id="5362381">step</span><span class="op" id="5362385">(</span><span class="op" id="5362386">&amp;</span><span class="ident" id="5362387">dec</span><span class="op" id="5362390">.</span><span class="ident" id="5362391">scan</span><span class="op" id="5362395">,</span>&nbsp;<span class="string" id="5362397">&#39;&nbsp;&#39;</span><span class="op" id="5362400">)</span>&nbsp;<span class="op" id="5362402">==</span>&nbsp;<span class="ident" id="5362405">scanEnd</span>&nbsp;<span class="op" id="5362413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5362419">scanp</span>&nbsp;<span class="op" id="5362425">+=</span>&nbsp;<span class="ident" id="5362428">i</span>&nbsp;<span class="op" id="5362430">+</span>&nbsp;<span class="num" id="5362432">1</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5362438">break</span>&nbsp;<span class="ident" id="5362444">Input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5362453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5362458">if</span>&nbsp;<span class="ident" id="5362461">v</span>&nbsp;<span class="op" id="5362463">==</span>&nbsp;<span class="ident" id="5362466">scanError</span>&nbsp;<span class="op" id="5362476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5362482">dec</span><span class="op" id="5362485">.</span><span class="ident" id="5362486">err</span>&nbsp;<span class="op" id="5362490">=</span>&nbsp;<span class="ident" id="5362492">dec</span><span class="op" id="5362495">.</span><span class="ident" id="5362496">scan</span><span class="op" id="5362500">.</span><span class="ident" id="5362501">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5362509">return</span>&nbsp;<span class="num" id="5362516">0</span><span class="op" id="5362517">,</span>&nbsp;<span class="ident" id="5362519">dec</span><span class="op" id="5362522">.</span><span class="ident" id="5362523">scan</span><span class="op" id="5362527">.</span><span class="ident" id="5362528">err</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5362535">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5362539">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5362543">scanp</span>&nbsp;<span class="op" id="5362549">=</span>&nbsp;<span class="builtinfunc" id="5362551">len</span><span class="op" id="5362554">(</span><span class="ident" id="5362555">dec</span><span class="op" id="5362558">.</span><span class="ident" id="5362559">buf</span><span class="op" id="5362562">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5362567">//&nbsp;Did&nbsp;the&nbsp;last&nbsp;read&nbsp;have&nbsp;an&nbsp;error?</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5362605">//&nbsp;Delayed&nbsp;until&nbsp;now&nbsp;to&nbsp;allow&nbsp;buffer&nbsp;scan.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5362650">if</span>&nbsp;<span class="ident" id="5362653">err</span>&nbsp;<span class="op" id="5362657">!=</span>&nbsp;<span class="ident" id="5362660">nil</span>&nbsp;<span class="op" id="5362664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5362669">if</span>&nbsp;<span class="ident" id="5362672">err</span>&nbsp;<span class="op" id="5362676">==</span>&nbsp;<span class="ident" id="5362679">io</span><span class="op" id="5362681">.</span><span class="ident" id="5362682">EOF</span>&nbsp;<span class="op" id="5362686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5362692">if</span>&nbsp;<span class="ident" id="5362695">dec</span><span class="op" id="5362698">.</span><span class="ident" id="5362699">scan</span><span class="op" id="5362703">.</span><span class="ident" id="5362704">step</span><span class="op" id="5362708">(</span><span class="op" id="5362709">&amp;</span><span class="ident" id="5362710">dec</span><span class="op" id="5362713">.</span><span class="ident" id="5362714">scan</span><span class="op" id="5362718">,</span>&nbsp;<span class="string" id="5362720">&#39;&nbsp;&#39;</span><span class="op" id="5362723">)</span>&nbsp;<span class="op" id="5362725">==</span>&nbsp;<span class="ident" id="5362728">scanEnd</span>&nbsp;<span class="op" id="5362736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5362743">break</span>&nbsp;<span class="ident" id="5362749">Input</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5362759">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5362765">if</span>&nbsp;<span class="ident" id="5362768">nonSpace</span><span class="op" id="5362776">(</span><span class="ident" id="5362777">dec</span><span class="op" id="5362780">.</span><span class="ident" id="5362781">buf</span><span class="op" id="5362784">)</span>&nbsp;<span class="op" id="5362786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5362793">err</span>&nbsp;<span class="op" id="5362797">=</span>&nbsp;<span class="ident" id="5362799">io</span><span class="op" id="5362801">.</span><span class="ident" id="5362802">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5362823">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5362828">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5362833">dec</span><span class="op" id="5362836">.</span><span class="ident" id="5362837">err</span>&nbsp;<span class="op" id="5362841">=</span>&nbsp;<span class="ident" id="5362843">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5362850">return</span>&nbsp;<span class="num" id="5362857">0</span><span class="op" id="5362858">,</span>&nbsp;<span class="ident" id="5362860">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5362866">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5362871">//&nbsp;Make&nbsp;room&nbsp;to&nbsp;read&nbsp;more&nbsp;into&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5362916">const</span>&nbsp;<span class="ident" id="5362922">minRead</span>&nbsp;<span class="op" id="5362930">=</span>&nbsp;<span class="num" id="5362932">512</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5362938">if</span>&nbsp;<span class="builtinfunc" id="5362941">cap</span><span class="op" id="5362944">(</span><span class="ident" id="5362945">dec</span><span class="op" id="5362948">.</span><span class="ident" id="5362949">buf</span><span class="op" id="5362952">)</span><span class="op" id="5362953">-</span><span class="builtinfunc" id="5362954">len</span><span class="op" id="5362957">(</span><span class="ident" id="5362958">dec</span><span class="op" id="5362961">.</span><span class="ident" id="5362962">buf</span><span class="op" id="5362965">)</span>&nbsp;<span class="op" id="5362967">&lt;</span>&nbsp;<span class="ident" id="5362969">minRead</span>&nbsp;<span class="op" id="5362977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5362982">newBuf</span>&nbsp;<span class="op" id="5362989">:=</span>&nbsp;<span class="builtinfunc" id="5362992">make</span><span class="op" id="5362996">(</span><span class="op" id="5362997">[</span><span class="op" id="5362998">]</span><span class="builtintype" id="5362999">byte</span><span class="op" id="5363003">,</span>&nbsp;<span class="builtinfunc" id="5363005">len</span><span class="op" id="5363008">(</span><span class="ident" id="5363009">dec</span><span class="op" id="5363012">.</span><span class="ident" id="5363013">buf</span><span class="op" id="5363016">)</span><span class="op" id="5363017">,</span>&nbsp;<span class="num" id="5363019">2</span><span class="op" id="5363020">*</span><span class="builtinfunc" id="5363021">cap</span><span class="op" id="5363024">(</span><span class="ident" id="5363025">dec</span><span class="op" id="5363028">.</span><span class="ident" id="5363029">buf</span><span class="op" id="5363032">)</span><span class="op" id="5363033">+</span><span class="ident" id="5363034">minRead</span><span class="op" id="5363041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5363046">copy</span><span class="op" id="5363050">(</span><span class="ident" id="5363051">newBuf</span><span class="op" id="5363057">,</span>&nbsp;<span class="ident" id="5363059">dec</span><span class="op" id="5363062">.</span><span class="ident" id="5363063">buf</span><span class="op" id="5363066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5363071">dec</span><span class="op" id="5363074">.</span><span class="ident" id="5363075">buf</span>&nbsp;<span class="op" id="5363079">=</span>&nbsp;<span class="ident" id="5363081">newBuf</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5363090">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5363095">//&nbsp;Read.&nbsp;&nbsp;Delay&nbsp;error&nbsp;for&nbsp;next&nbsp;iteration&nbsp;(after&nbsp;scan).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5363152">var</span>&nbsp;<span class="ident" id="5363156">n</span>&nbsp;<span class="builtintype" id="5363158">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5363164">n</span><span class="op" id="5363165">,</span>&nbsp;<span class="ident" id="5363167">err</span>&nbsp;<span class="op" id="5363171">=</span>&nbsp;<span class="ident" id="5363173">dec</span><span class="op" id="5363176">.</span><span class="ident" id="5363177">r</span><span class="op" id="5363178">.</span><span class="ident" id="5363179">Read</span><span class="op" id="5363183">(</span><span class="ident" id="5363184">dec</span><span class="op" id="5363187">.</span><span class="ident" id="5363188">buf</span><span class="op" id="5363191">[</span><span class="builtinfunc" id="5363192">len</span><span class="op" id="5363195">(</span><span class="ident" id="5363196">dec</span><span class="op" id="5363199">.</span><span class="ident" id="5363200">buf</span><span class="op" id="5363203">)</span><span class="op" id="5363204">:</span><span class="builtinfunc" id="5363205">cap</span><span class="op" id="5363208">(</span><span class="ident" id="5363209">dec</span><span class="op" id="5363212">.</span><span class="ident" id="5363213">buf</span><span class="op" id="5363216">)</span><span class="op" id="5363217">]</span><span class="op" id="5363218">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5363222">dec</span><span class="op" id="5363225">.</span><span class="ident" id="5363226">buf</span>&nbsp;<span class="op" id="5363230">=</span>&nbsp;<span class="ident" id="5363232">dec</span><span class="op" id="5363235">.</span><span class="ident" id="5363236">buf</span><span class="op" id="5363239">[</span><span class="num" id="5363240">0</span>&nbsp;<span class="op" id="5363242">:</span>&nbsp;<span class="builtinfunc" id="5363244">len</span><span class="op" id="5363247">(</span><span class="ident" id="5363248">dec</span><span class="op" id="5363251">.</span><span class="ident" id="5363252">buf</span><span class="op" id="5363255">)</span><span class="op" id="5363256">+</span><span class="ident" id="5363257">n</span><span class="op" id="5363258">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5363261">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5363264">return</span>&nbsp;<span class="ident" id="5363271">scanp</span><span class="op" id="5363276">,</span>&nbsp;<span class="ident" id="5363278">nil</span><br>
<span class="lineno"></span><span class="op" id="5363282">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="5363285">func</span>&nbsp;<span class="ident" id="5363290">nonSpace</span><span class="op" id="5363298">(</span><span class="ident" id="5363299">b</span>&nbsp;<span class="op" id="5363301">[</span><span class="op" id="5363302">]</span><span class="builtintype" id="5363303">byte</span><span class="op" id="5363307">)</span>&nbsp;<span class="builtintype" id="5363309">bool</span>&nbsp;<span class="op" id="5363314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5363317">for</span>&nbsp;<span class="ident" id="5363321">_</span><span class="op" id="5363322">,</span>&nbsp;<span class="ident" id="5363324">c</span>&nbsp;<span class="op" id="5363326">:=</span>&nbsp;<span class="keyword" id="5363329">range</span>&nbsp;<span class="ident" id="5363335">b</span>&nbsp;<span class="op" id="5363337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5363341">if</span>&nbsp;<span class="op" id="5363344">!</span><span class="ident" id="5363345">isSpace</span><span class="op" id="5363352">(</span><span class="builtintype" id="5363353">rune</span><span class="op" id="5363357">(</span><span class="ident" id="5363358">c</span><span class="op" id="5363359">)</span><span class="op" id="5363360">)</span>&nbsp;<span class="op" id="5363362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5363367">return</span>&nbsp;<span class="builtintype" id="5363374">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5363381">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5363384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5363387">return</span>&nbsp;<span class="builtintype" id="5363394">false</span><br>
<span class="lineno"></span><span class="op" id="5363400">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5363403">//&nbsp;An&nbsp;Encoder&nbsp;writes&nbsp;JSON&nbsp;objects&nbsp;to&nbsp;an&nbsp;output&nbsp;stream.</span><br>
<span class="lineno">140</span><span class="keyword" id="5363458">type</span>&nbsp;<span class="ident" id="5363463">Encoder</span>&nbsp;<span class="keyword" id="5363471">struct</span>&nbsp;<span class="op" id="5363478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5363481">w</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5363485">io</span><span class="op" id="5363487">.</span><span class="ident" id="5363488">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5363496">err</span>&nbsp;<span class="builtintype" id="5363500">error</span><br>
<span class="lineno"></span><span class="op" id="5363506">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="comment" id="5363509">//&nbsp;NewEncoder&nbsp;returns&nbsp;a&nbsp;new&nbsp;encoder&nbsp;that&nbsp;writes&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="5363563">func</span>&nbsp;<span class="ident" id="5363568">NewEncoder</span><span class="op" id="5363578">(</span><span class="ident" id="5363579">w</span>&nbsp;<span class="ident" id="5363581">io</span><span class="op" id="5363583">.</span><span class="ident" id="5363584">Writer</span><span class="op" id="5363590">)</span>&nbsp;<span class="op" id="5363592">*</span><span class="ident" id="5363593">Encoder</span>&nbsp;<span class="op" id="5363601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5363604">return</span>&nbsp;<span class="op" id="5363611">&amp;</span><span class="ident" id="5363612">Encoder</span><span class="op" id="5363619">{</span><span class="ident" id="5363620">w</span><span class="op" id="5363621">:</span>&nbsp;<span class="ident" id="5363623">w</span><span class="op" id="5363624">}</span><br>
<span class="lineno"></span><span class="op" id="5363626">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="comment" id="5363629">//&nbsp;Encode&nbsp;writes&nbsp;the&nbsp;JSON&nbsp;encoding&nbsp;of&nbsp;v&nbsp;to&nbsp;the&nbsp;stream,</span><br>
<span class="lineno"></span><span class="comment" id="5363684">//&nbsp;followed&nbsp;by&nbsp;a&nbsp;newline&nbsp;character.</span><br>
<span class="lineno"></span><span class="comment" id="5363720">//</span><br>
<span class="lineno"></span><span class="comment" id="5363723">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;Marshal&nbsp;for&nbsp;details&nbsp;about&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5363782">//&nbsp;conversion&nbsp;of&nbsp;Go&nbsp;values&nbsp;to&nbsp;JSON.</span><br>
<span class="lineno">155</span><span class="keyword" id="5363818">func</span>&nbsp;<span class="op" id="5363823">(</span><span class="ident" id="5363824">enc</span>&nbsp;<span class="op" id="5363828">*</span><span class="ident" id="5363829">Encoder</span><span class="op" id="5363836">)</span>&nbsp;<span class="ident" id="5363838">Encode</span><span class="op" id="5363844">(</span><span class="ident" id="5363845">v</span>&nbsp;<span class="keyword" id="5363847">interface</span><span class="op" id="5363856">{</span><span class="op" id="5363857">}</span><span class="op" id="5363858">)</span>&nbsp;<span class="builtintype" id="5363860">error</span>&nbsp;<span class="op" id="5363866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5363869">if</span>&nbsp;<span class="ident" id="5363872">enc</span><span class="op" id="5363875">.</span><span class="ident" id="5363876">err</span>&nbsp;<span class="op" id="5363880">!=</span>&nbsp;<span class="ident" id="5363883">nil</span>&nbsp;<span class="op" id="5363887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5363891">return</span>&nbsp;<span class="ident" id="5363898">enc</span><span class="op" id="5363901">.</span><span class="ident" id="5363902">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5363907">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5363910">e</span>&nbsp;<span class="op" id="5363912">:=</span>&nbsp;<span class="ident" id="5363915">newEncodeState</span><span class="op" id="5363929">(</span><span class="op" id="5363930">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5363933">err</span>&nbsp;<span class="op" id="5363937">:=</span>&nbsp;<span class="ident" id="5363940">e</span><span class="op" id="5363941">.</span><span class="ident" id="5363942">marshal</span><span class="op" id="5363949">(</span><span class="ident" id="5363950">v</span><span class="op" id="5363951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5363954">if</span>&nbsp;<span class="ident" id="5363957">err</span>&nbsp;<span class="op" id="5363961">!=</span>&nbsp;<span class="ident" id="5363964">nil</span>&nbsp;<span class="op" id="5363968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5363972">return</span>&nbsp;<span class="ident" id="5363979">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5363984">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5363988">//&nbsp;Terminate&nbsp;each&nbsp;value&nbsp;with&nbsp;a&nbsp;newline.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5364029">//&nbsp;This&nbsp;makes&nbsp;the&nbsp;output&nbsp;look&nbsp;a&nbsp;little&nbsp;nicer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5364075">//&nbsp;when&nbsp;debugging,&nbsp;and&nbsp;some&nbsp;kind&nbsp;of&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5364118">//&nbsp;is&nbsp;required&nbsp;if&nbsp;the&nbsp;encoded&nbsp;value&nbsp;was&nbsp;a&nbsp;number,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5364169">//&nbsp;so&nbsp;that&nbsp;the&nbsp;reader&nbsp;knows&nbsp;there&nbsp;aren&#39;t&nbsp;more</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5364216">//&nbsp;digits&nbsp;coming.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5364235">e</span><span class="op" id="5364236">.</span><span class="ident" id="5364237">WriteByte</span><span class="op" id="5364246">(</span><span class="string" id="5364247">&#39;\n&#39;</span><span class="op" id="5364251">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5364255">if</span>&nbsp;<span class="ident" id="5364258">_</span><span class="op" id="5364259">,</span>&nbsp;<span class="ident" id="5364261">err</span>&nbsp;<span class="op" id="5364265">=</span>&nbsp;<span class="ident" id="5364267">enc</span><span class="op" id="5364270">.</span><span class="ident" id="5364271">w</span><span class="op" id="5364272">.</span><span class="ident" id="5364273">Write</span><span class="op" id="5364278">(</span><span class="ident" id="5364279">e</span><span class="op" id="5364280">.</span><span class="ident" id="5364281">Bytes</span><span class="op" id="5364286">(</span><span class="op" id="5364287">)</span><span class="op" id="5364288">)</span><span class="op" id="5364289">;</span>&nbsp;<span class="ident" id="5364291">err</span>&nbsp;<span class="op" id="5364295">!=</span>&nbsp;<span class="ident" id="5364298">nil</span>&nbsp;<span class="op" id="5364302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5364306">enc</span><span class="op" id="5364309">.</span><span class="ident" id="5364310">err</span>&nbsp;<span class="op" id="5364314">=</span>&nbsp;<span class="ident" id="5364316">err</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5364321">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5364324">encodeStatePool</span><span class="op" id="5364339">.</span><span class="ident" id="5364340">Put</span><span class="op" id="5364343">(</span><span class="ident" id="5364344">e</span><span class="op" id="5364345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5364348">return</span>&nbsp;<span class="ident" id="5364355">err</span><br>
<span class="lineno"></span><span class="op" id="5364359">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="comment" id="5364362">//&nbsp;RawMessage&nbsp;is&nbsp;a&nbsp;raw&nbsp;encoded&nbsp;JSON&nbsp;object.</span><br>
<span class="lineno"></span><span class="comment" id="5364406">//&nbsp;It&nbsp;implements&nbsp;Marshaler&nbsp;and&nbsp;Unmarshaler&nbsp;and&nbsp;can</span><br>
<span class="lineno"></span><span class="comment" id="5364457">//&nbsp;be&nbsp;used&nbsp;to&nbsp;delay&nbsp;JSON&nbsp;decoding&nbsp;or&nbsp;precompute&nbsp;a&nbsp;JSON&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="5364522">type</span>&nbsp;<span class="ident" id="5364527">RawMessage</span>&nbsp;<span class="op" id="5364538">[</span><span class="op" id="5364539">]</span><span class="builtintype" id="5364540">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="comment" id="5364546">//&nbsp;MarshalJSON&nbsp;returns&nbsp;*m&nbsp;as&nbsp;the&nbsp;JSON&nbsp;encoding&nbsp;of&nbsp;m.</span><br>
<span class="lineno"></span><span class="keyword" id="5364599">func</span>&nbsp;<span class="op" id="5364604">(</span><span class="ident" id="5364605">m</span>&nbsp;<span class="op" id="5364607">*</span><span class="ident" id="5364608">RawMessage</span><span class="op" id="5364618">)</span>&nbsp;<span class="ident" id="5364620">MarshalJSON</span><span class="op" id="5364631">(</span><span class="op" id="5364632">)</span>&nbsp;<span class="op" id="5364634">(</span><span class="op" id="5364635">[</span><span class="op" id="5364636">]</span><span class="builtintype" id="5364637">byte</span><span class="op" id="5364641">,</span>&nbsp;<span class="builtintype" id="5364643">error</span><span class="op" id="5364648">)</span>&nbsp;<span class="op" id="5364650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5364653">return</span>&nbsp;<span class="op" id="5364660">*</span><span class="ident" id="5364661">m</span><span class="op" id="5364662">,</span>&nbsp;<span class="ident" id="5364664">nil</span><br>
<span class="lineno"></span><span class="op" id="5364668">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="comment" id="5364671">//&nbsp;UnmarshalJSON&nbsp;sets&nbsp;*m&nbsp;to&nbsp;a&nbsp;copy&nbsp;of&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="5364715">func</span>&nbsp;<span class="op" id="5364720">(</span><span class="ident" id="5364721">m</span>&nbsp;<span class="op" id="5364723">*</span><span class="ident" id="5364724">RawMessage</span><span class="op" id="5364734">)</span>&nbsp;<span class="ident" id="5364736">UnmarshalJSON</span><span class="op" id="5364749">(</span><span class="ident" id="5364750">data</span>&nbsp;<span class="op" id="5364755">[</span><span class="op" id="5364756">]</span><span class="builtintype" id="5364757">byte</span><span class="op" id="5364761">)</span>&nbsp;<span class="builtintype" id="5364763">error</span>&nbsp;<span class="op" id="5364769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5364772">if</span>&nbsp;<span class="ident" id="5364775">m</span>&nbsp;<span class="op" id="5364777">==</span>&nbsp;<span class="ident" id="5364780">nil</span>&nbsp;<span class="op" id="5364784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5364788">return</span>&nbsp;<span class="ident" id="5364795">errors</span><span class="op" id="5364801">.</span><span class="ident" id="5364802">New</span><span class="op" id="5364805">(</span><span class="string" id="5364806">&#34;json.RawMessage:&nbsp;UnmarshalJSON&nbsp;on&nbsp;nil&nbsp;pointer&#34;</span><span class="op" id="5364853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5364856">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5364859">*</span><span class="ident" id="5364860">m</span>&nbsp;<span class="op" id="5364862">=</span>&nbsp;<span class="builtinfunc" id="5364864">append</span><span class="op" id="5364870">(</span><span class="op" id="5364871">(</span><span class="op" id="5364872">*</span><span class="ident" id="5364873">m</span><span class="op" id="5364874">)</span><span class="op" id="5364875">[</span><span class="num" id="5364876">0</span><span class="op" id="5364877">:</span><span class="num" id="5364878">0</span><span class="op" id="5364879">]</span><span class="op" id="5364880">,</span>&nbsp;<span class="ident" id="5364882">data</span><span class="op" id="5364886">...</span><span class="op" id="5364889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5364892">return</span>&nbsp;<span class="ident" id="5364899">nil</span><br>
<span class="lineno"></span><span class="op" id="5364903">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5364906">var</span>&nbsp;<span class="ident" id="5364910">_</span>&nbsp;<span class="ident" id="5364912">Marshaler</span>&nbsp;<span class="op" id="5364922">=</span>&nbsp;<span class="op" id="5364924">(</span><span class="op" id="5364925">*</span><span class="ident" id="5364926">RawMessage</span><span class="op" id="5364936">)</span><span class="op" id="5364937">(</span><span class="ident" id="5364938">nil</span><span class="op" id="5364941">)</span><br>
<span class="lineno">200</span><span class="keyword" id="5364943">var</span>&nbsp;<span class="ident" id="5364947">_</span>&nbsp;<span class="ident" id="5364949">Unmarshaler</span>&nbsp;<span class="op" id="5364961">=</span>&nbsp;<span class="op" id="5364963">(</span><span class="op" id="5364964">*</span><span class="ident" id="5364965">RawMessage</span><span class="op" id="5364975">)</span><span class="op" id="5364976">(</span><span class="ident" id="5364977">nil</span><span class="op" id="5364980">)</span>
</div>
</body>
</html>
