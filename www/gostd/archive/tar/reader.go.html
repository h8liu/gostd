<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/tar</h2>
<ul>
<li><a href="/gostd/archive/tar/common.go.html">common.go</a></li>
<li><a href="/gostd/archive/tar/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/tar/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/tar/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/tar/stat_atim.go.html">stat_atim.go</a></li>
<li><a href="/gostd/archive/tar/stat_unix.go.html">stat_unix.go</a></li>
<li><a href="/gostd/archive/tar/tar_test.go.html">tar_test.go</a></li>
<li><a href="/gostd/archive/tar/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/tar/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5991977">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5992032">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5992086">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5992137">package</span>&nbsp;<span class="ident" id="5992145">tar</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5992150">//&nbsp;TODO(dsymonds):</span><br>
<span class="lineno"></span><span class="comment" id="5992169">//&nbsp;&nbsp;&nbsp;-&nbsp;pax&nbsp;extensions</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="5992192">import</span>&nbsp;<span class="op" id="5992199">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5992202">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5992211">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5992221">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5992227">&#34;io/ioutil&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5992240">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5992246">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5992257">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5992268">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="5992275">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="5992278">var</span>&nbsp;<span class="op" id="5992282">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5992285">ErrHeader</span>&nbsp;<span class="op" id="5992295">=</span>&nbsp;<span class="ident" id="5992297">errors</span><span class="op" id="5992303">.</span><span class="ident" id="5992304">New</span><span class="op" id="5992307">(</span><span class="string" id="5992308">&#34;archive/tar:&nbsp;invalid&nbsp;tar&nbsp;header&#34;</span><span class="op" id="5992341">)</span><br>
<span class="lineno"></span><span class="op" id="5992343">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="5992346">const</span>&nbsp;<span class="ident" id="5992352">maxNanoSecondIntSize</span>&nbsp;<span class="op" id="5992373">=</span>&nbsp;<span class="num" id="5992375">9</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5992378">//&nbsp;A&nbsp;Reader&nbsp;provides&nbsp;sequential&nbsp;access&nbsp;to&nbsp;the&nbsp;contents&nbsp;of&nbsp;a&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="comment" id="5992451">//&nbsp;A&nbsp;tar&nbsp;archive&nbsp;consists&nbsp;of&nbsp;a&nbsp;sequence&nbsp;of&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="5992501">//&nbsp;The&nbsp;Next&nbsp;method&nbsp;advances&nbsp;to&nbsp;the&nbsp;next&nbsp;file&nbsp;in&nbsp;the&nbsp;archive&nbsp;(including&nbsp;the&nbsp;first),</span><br>
<span class="lineno">30</span><span class="comment" id="5992584">//&nbsp;and&nbsp;then&nbsp;it&nbsp;can&nbsp;be&nbsp;treated&nbsp;as&nbsp;an&nbsp;io.Reader&nbsp;to&nbsp;access&nbsp;the&nbsp;file&#39;s&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="5992657">type</span>&nbsp;<span class="ident" id="5992662">Reader</span>&nbsp;<span class="keyword" id="5992669">struct</span>&nbsp;<span class="op" id="5992676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5992679">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5992687">io</span><span class="op" id="5992689">.</span><span class="ident" id="5992690">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5992698">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5992706">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5992713">pad</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5992721">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5992737">//&nbsp;amount&nbsp;of&nbsp;padding&nbsp;(ignored)&nbsp;after&nbsp;current&nbsp;file&nbsp;entry</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5992794">curr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5992802">numBytesReader</span>&nbsp;&nbsp;<span class="comment" id="5992818">//&nbsp;reader&nbsp;for&nbsp;current&nbsp;file&nbsp;entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5992852">hdrBuff</span>&nbsp;<span class="op" id="5992860">[</span><span class="ident" id="5992861">blockSize</span><span class="op" id="5992870">]</span><span class="builtintype" id="5992871">byte</span>&nbsp;<span class="comment" id="5992876">//&nbsp;buffer&nbsp;to&nbsp;use&nbsp;in&nbsp;readHeader</span><br>
<span class="lineno"></span><span class="op" id="5992907">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5992910">//&nbsp;A&nbsp;numBytesReader&nbsp;is&nbsp;an&nbsp;io.Reader&nbsp;with&nbsp;a&nbsp;numBytes&nbsp;method,&nbsp;returning&nbsp;the&nbsp;number</span><br>
<span class="lineno">40</span><span class="comment" id="5992991">//&nbsp;of&nbsp;bytes&nbsp;remaining&nbsp;in&nbsp;the&nbsp;underlying&nbsp;encoded&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="5993045">type</span>&nbsp;<span class="ident" id="5993050">numBytesReader</span>&nbsp;<span class="keyword" id="5993065">interface</span>&nbsp;<span class="op" id="5993075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5993078">io</span><span class="op" id="5993080">.</span><span class="ident" id="5993081">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5993089">numBytes</span><span class="op" id="5993097">(</span><span class="op" id="5993098">)</span>&nbsp;<span class="ident" id="5993100">int64</span><br>
<span class="lineno"></span><span class="op" id="5993106">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="5993109">//&nbsp;A&nbsp;regFileReader&nbsp;is&nbsp;a&nbsp;numBytesReader&nbsp;for&nbsp;reading&nbsp;file&nbsp;data&nbsp;from&nbsp;a&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="5993190">type</span>&nbsp;<span class="ident" id="5993195">regFileReader</span>&nbsp;<span class="keyword" id="5993209">struct</span>&nbsp;<span class="op" id="5993216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5993219">r</span>&nbsp;&nbsp;<span class="ident" id="5993222">io</span><span class="op" id="5993224">.</span><span class="ident" id="5993225">Reader</span>&nbsp;<span class="comment" id="5993232">//&nbsp;underlying&nbsp;reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5993254">nb</span>&nbsp;<span class="ident" id="5993257">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5993267">//&nbsp;number&nbsp;of&nbsp;unread&nbsp;bytes&nbsp;for&nbsp;current&nbsp;file&nbsp;entry</span><br>
<span class="lineno">50</span><span class="op" id="5993316">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5993319">//&nbsp;A&nbsp;sparseFileReader&nbsp;is&nbsp;a&nbsp;numBytesReader&nbsp;for&nbsp;reading&nbsp;sparse&nbsp;file&nbsp;data&nbsp;from&nbsp;a&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="5993410">type</span>&nbsp;<span class="ident" id="5993415">sparseFileReader</span>&nbsp;<span class="keyword" id="5993432">struct</span>&nbsp;<span class="op" id="5993439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5993442">rfr</span>&nbsp;<span class="op" id="5993446">*</span><span class="ident" id="5993447">regFileReader</span>&nbsp;<span class="comment" id="5993461">//&nbsp;reads&nbsp;the&nbsp;sparse-encoded&nbsp;file&nbsp;data</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5993500">sp</span>&nbsp;&nbsp;<span class="op" id="5993504">[</span><span class="op" id="5993505">]</span><span class="ident" id="5993506">sparseEntry</span>&nbsp;&nbsp;<span class="comment" id="5993519">//&nbsp;the&nbsp;sparse&nbsp;map&nbsp;for&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5993551">pos</span>&nbsp;<span class="ident" id="5993555">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5993570">//&nbsp;keeps&nbsp;track&nbsp;of&nbsp;file&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5993603">tot</span>&nbsp;<span class="ident" id="5993607">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5993622">//&nbsp;total&nbsp;size&nbsp;of&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span><span class="op" id="5993648">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="5993651">//&nbsp;Keywords&nbsp;for&nbsp;GNU&nbsp;sparse&nbsp;files&nbsp;in&nbsp;a&nbsp;PAX&nbsp;extended&nbsp;header</span><br>
<span class="lineno"></span><span class="keyword" id="5993709">const</span>&nbsp;<span class="op" id="5993715">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5993718">paxGNUSparseNumBlocks</span>&nbsp;<span class="op" id="5993740">=</span>&nbsp;<span class="string" id="5993742">&#34;GNU.sparse.numblocks&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5993766">paxGNUSparseOffset</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5993788">=</span>&nbsp;<span class="string" id="5993790">&#34;GNU.sparse.offset&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5993811">paxGNUSparseNumBytes</span>&nbsp;&nbsp;<span class="op" id="5993833">=</span>&nbsp;<span class="string" id="5993835">&#34;GNU.sparse.numbytes&#34;</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5993858">paxGNUSparseMap</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5993880">=</span>&nbsp;<span class="string" id="5993882">&#34;GNU.sparse.map&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5993900">paxGNUSparseName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5993922">=</span>&nbsp;<span class="string" id="5993924">&#34;GNU.sparse.name&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5993943">paxGNUSparseMajor</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5993965">=</span>&nbsp;<span class="string" id="5993967">&#34;GNU.sparse.major&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5993987">paxGNUSparseMinor</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5994009">=</span>&nbsp;<span class="string" id="5994011">&#34;GNU.sparse.minor&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5994031">paxGNUSparseSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5994053">=</span>&nbsp;<span class="string" id="5994055">&#34;GNU.sparse.size&#34;</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5994074">paxGNUSparseRealSize</span>&nbsp;&nbsp;<span class="op" id="5994096">=</span>&nbsp;<span class="string" id="5994098">&#34;GNU.sparse.realsize&#34;</span><br>
<span class="lineno"></span><span class="op" id="5994120">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5994123">//&nbsp;Keywords&nbsp;for&nbsp;old&nbsp;GNU&nbsp;sparse&nbsp;headers</span><br>
<span class="lineno"></span><span class="keyword" id="5994162">const</span>&nbsp;<span class="op" id="5994168">(</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5994171">oldGNUSparseMainHeaderOffset</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5994214">=</span>&nbsp;<span class="num" id="5994216">386</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5994221">oldGNUSparseMainHeaderIsExtendedOffset</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5994264">=</span>&nbsp;<span class="num" id="5994266">482</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5994271">oldGNUSparseMainHeaderNumEntries</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5994314">=</span>&nbsp;<span class="num" id="5994316">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5994319">oldGNUSparseExtendedHeaderIsExtendedOffset</span>&nbsp;<span class="op" id="5994362">=</span>&nbsp;<span class="num" id="5994364">504</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5994369">oldGNUSparseExtendedHeaderNumEntries</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5994412">=</span>&nbsp;<span class="num" id="5994414">21</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5994418">oldGNUSparseOffsetSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5994461">=</span>&nbsp;<span class="num" id="5994463">12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5994467">oldGNUSparseNumBytesSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5994510">=</span>&nbsp;<span class="num" id="5994512">12</span><br>
<span class="lineno"></span><span class="op" id="5994515">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5994518">//&nbsp;NewReader&nbsp;creates&nbsp;a&nbsp;new&nbsp;Reader&nbsp;reading&nbsp;from&nbsp;r.</span><br>
<span class="lineno">85</span><span class="keyword" id="5994568">func</span>&nbsp;<span class="ident" id="5994573">NewReader</span><span class="op" id="5994582">(</span><span class="ident" id="5994583">r</span>&nbsp;<span class="ident" id="5994585">io</span><span class="op" id="5994587">.</span><span class="ident" id="5994588">Reader</span><span class="op" id="5994594">)</span>&nbsp;<span class="op" id="5994596">*</span><span class="ident" id="5994597">Reader</span>&nbsp;<span class="op" id="5994604">{</span>&nbsp;<span class="keyword" id="5994606">return</span>&nbsp;<span class="op" id="5994613">&amp;</span><span class="ident" id="5994614">Reader</span><span class="op" id="5994620">{</span><span class="ident" id="5994621">r</span><span class="op" id="5994622">:</span>&nbsp;<span class="ident" id="5994624">r</span><span class="op" id="5994625">}</span>&nbsp;<span class="op" id="5994627">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5994630">//&nbsp;Next&nbsp;advances&nbsp;to&nbsp;the&nbsp;next&nbsp;entry&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="5994685">func</span>&nbsp;<span class="op" id="5994690">(</span><span class="ident" id="5994691">tr</span>&nbsp;<span class="op" id="5994694">*</span><span class="ident" id="5994695">Reader</span><span class="op" id="5994701">)</span>&nbsp;<span class="ident" id="5994703">Next</span><span class="op" id="5994707">(</span><span class="op" id="5994708">)</span>&nbsp;<span class="op" id="5994710">(</span><span class="op" id="5994711">*</span><span class="ident" id="5994712">Header</span><span class="op" id="5994718">,</span>&nbsp;<span class="builtintype" id="5994720">error</span><span class="op" id="5994725">)</span>&nbsp;<span class="op" id="5994727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5994730">var</span>&nbsp;<span class="ident" id="5994734">hdr</span>&nbsp;<span class="op" id="5994738">*</span><span class="ident" id="5994739">Header</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5994747">if</span>&nbsp;<span class="ident" id="5994750">tr</span><span class="op" id="5994752">.</span><span class="ident" id="5994753">err</span>&nbsp;<span class="op" id="5994757">==</span>&nbsp;<span class="ident" id="5994760">nil</span>&nbsp;<span class="op" id="5994764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5994768">tr</span><span class="op" id="5994770">.</span><span class="ident" id="5994771">skipUnread</span><span class="op" id="5994781">(</span><span class="op" id="5994782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5994785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5994788">if</span>&nbsp;<span class="ident" id="5994791">tr</span><span class="op" id="5994793">.</span><span class="ident" id="5994794">err</span>&nbsp;<span class="op" id="5994798">!=</span>&nbsp;<span class="ident" id="5994801">nil</span>&nbsp;<span class="op" id="5994805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5994809">return</span>&nbsp;<span class="ident" id="5994816">hdr</span><span class="op" id="5994819">,</span>&nbsp;<span class="ident" id="5994821">tr</span><span class="op" id="5994823">.</span><span class="ident" id="5994824">err</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5994829">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5994832">hdr</span>&nbsp;<span class="op" id="5994836">=</span>&nbsp;<span class="ident" id="5994838">tr</span><span class="op" id="5994840">.</span><span class="ident" id="5994841">readHeader</span><span class="op" id="5994851">(</span><span class="op" id="5994852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5994855">if</span>&nbsp;<span class="ident" id="5994858">hdr</span>&nbsp;<span class="op" id="5994862">==</span>&nbsp;<span class="ident" id="5994865">nil</span>&nbsp;<span class="op" id="5994869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5994873">return</span>&nbsp;<span class="ident" id="5994880">hdr</span><span class="op" id="5994883">,</span>&nbsp;<span class="ident" id="5994885">tr</span><span class="op" id="5994887">.</span><span class="ident" id="5994888">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5994893">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5994896">//&nbsp;Check&nbsp;for&nbsp;PAX/GNU&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5994926">switch</span>&nbsp;<span class="ident" id="5994933">hdr</span><span class="op" id="5994936">.</span><span class="ident" id="5994937">Typeflag</span>&nbsp;<span class="op" id="5994946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5994949">case</span>&nbsp;<span class="ident" id="5994954">TypeXHeader</span><span class="op" id="5994965">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5994969">//&nbsp;&nbsp;PAX&nbsp;extended&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5994995">headers</span><span class="op" id="5995002">,</span>&nbsp;<span class="ident" id="5995004">err</span>&nbsp;<span class="op" id="5995008">:=</span>&nbsp;<span class="ident" id="5995011">parsePAX</span><span class="op" id="5995019">(</span><span class="ident" id="5995020">tr</span><span class="op" id="5995022">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5995026">if</span>&nbsp;<span class="ident" id="5995029">err</span>&nbsp;<span class="op" id="5995033">!=</span>&nbsp;<span class="ident" id="5995036">nil</span>&nbsp;<span class="op" id="5995040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5995045">return</span>&nbsp;<span class="ident" id="5995052">nil</span><span class="op" id="5995055">,</span>&nbsp;<span class="ident" id="5995057">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5995063">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5995067">//&nbsp;We&nbsp;actually&nbsp;read&nbsp;the&nbsp;whole&nbsp;file,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5995105">//&nbsp;but&nbsp;this&nbsp;skips&nbsp;alignment&nbsp;padding</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5995143">tr</span><span class="op" id="5995145">.</span><span class="ident" id="5995146">skipUnread</span><span class="op" id="5995156">(</span><span class="op" id="5995157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5995161">hdr</span>&nbsp;<span class="op" id="5995165">=</span>&nbsp;<span class="ident" id="5995167">tr</span><span class="op" id="5995169">.</span><span class="ident" id="5995170">readHeader</span><span class="op" id="5995180">(</span><span class="op" id="5995181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5995185">mergePAX</span><span class="op" id="5995193">(</span><span class="ident" id="5995194">hdr</span><span class="op" id="5995197">,</span>&nbsp;<span class="ident" id="5995199">headers</span><span class="op" id="5995206">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5995211">//&nbsp;Check&nbsp;for&nbsp;a&nbsp;PAX&nbsp;format&nbsp;sparse&nbsp;file</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5995251">sp</span><span class="op" id="5995253">,</span>&nbsp;<span class="ident" id="5995255">err</span>&nbsp;<span class="op" id="5995259">:=</span>&nbsp;<span class="ident" id="5995262">tr</span><span class="op" id="5995264">.</span><span class="ident" id="5995265">checkForGNUSparsePAXHeaders</span><span class="op" id="5995292">(</span><span class="ident" id="5995293">hdr</span><span class="op" id="5995296">,</span>&nbsp;<span class="ident" id="5995298">headers</span><span class="op" id="5995305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5995309">if</span>&nbsp;<span class="ident" id="5995312">err</span>&nbsp;<span class="op" id="5995316">!=</span>&nbsp;<span class="ident" id="5995319">nil</span>&nbsp;<span class="op" id="5995323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5995328">tr</span><span class="op" id="5995330">.</span><span class="ident" id="5995331">err</span>&nbsp;<span class="op" id="5995335">=</span>&nbsp;<span class="ident" id="5995337">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5995344">return</span>&nbsp;<span class="ident" id="5995351">nil</span><span class="op" id="5995354">,</span>&nbsp;<span class="ident" id="5995356">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5995362">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5995366">if</span>&nbsp;<span class="ident" id="5995369">sp</span>&nbsp;<span class="op" id="5995372">!=</span>&nbsp;<span class="ident" id="5995375">nil</span>&nbsp;<span class="op" id="5995379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5995384">//&nbsp;Current&nbsp;file&nbsp;is&nbsp;a&nbsp;PAX&nbsp;format&nbsp;GNU&nbsp;sparse&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5995436">//&nbsp;Set&nbsp;the&nbsp;current&nbsp;file&nbsp;reader&nbsp;to&nbsp;a&nbsp;sparse&nbsp;file&nbsp;reader.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5995495">tr</span><span class="op" id="5995497">.</span><span class="ident" id="5995498">curr</span>&nbsp;<span class="op" id="5995503">=</span>&nbsp;<span class="op" id="5995505">&amp;</span><span class="ident" id="5995506">sparseFileReader</span><span class="op" id="5995522">{</span><span class="ident" id="5995523">rfr</span><span class="op" id="5995526">:</span>&nbsp;<span class="ident" id="5995528">tr</span><span class="op" id="5995530">.</span><span class="ident" id="5995531">curr</span><span class="op" id="5995535">.</span><span class="op" id="5995536">(</span><span class="op" id="5995537">*</span><span class="ident" id="5995538">regFileReader</span><span class="op" id="5995551">)</span><span class="op" id="5995552">,</span>&nbsp;<span class="ident" id="5995554">sp</span><span class="op" id="5995556">:</span>&nbsp;<span class="ident" id="5995558">sp</span><span class="op" id="5995560">,</span>&nbsp;<span class="ident" id="5995562">tot</span><span class="op" id="5995565">:</span>&nbsp;<span class="ident" id="5995567">hdr</span><span class="op" id="5995570">.</span><span class="ident" id="5995571">Size</span><span class="op" id="5995575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5995579">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5995583">return</span>&nbsp;<span class="ident" id="5995590">hdr</span><span class="op" id="5995593">,</span>&nbsp;<span class="ident" id="5995595">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5995600">case</span>&nbsp;<span class="ident" id="5995605">TypeGNULongName</span><span class="op" id="5995620">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5995624">//&nbsp;We&nbsp;have&nbsp;a&nbsp;GNU&nbsp;long&nbsp;name&nbsp;header.&nbsp;Its&nbsp;contents&nbsp;are&nbsp;the&nbsp;real&nbsp;file&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5995698">realname</span><span class="op" id="5995706">,</span>&nbsp;<span class="ident" id="5995708">err</span>&nbsp;<span class="op" id="5995712">:=</span>&nbsp;<span class="ident" id="5995715">ioutil</span><span class="op" id="5995721">.</span><span class="ident" id="5995722">ReadAll</span><span class="op" id="5995729">(</span><span class="ident" id="5995730">tr</span><span class="op" id="5995732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5995736">if</span>&nbsp;<span class="ident" id="5995739">err</span>&nbsp;<span class="op" id="5995743">!=</span>&nbsp;<span class="ident" id="5995746">nil</span>&nbsp;<span class="op" id="5995750">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5995755">return</span>&nbsp;<span class="ident" id="5995762">nil</span><span class="op" id="5995765">,</span>&nbsp;<span class="ident" id="5995767">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5995773">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5995777">hdr</span><span class="op" id="5995780">,</span>&nbsp;<span class="ident" id="5995782">err</span>&nbsp;<span class="op" id="5995786">:=</span>&nbsp;<span class="ident" id="5995789">tr</span><span class="op" id="5995791">.</span><span class="ident" id="5995792">Next</span><span class="op" id="5995796">(</span><span class="op" id="5995797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5995801">hdr</span><span class="op" id="5995804">.</span><span class="ident" id="5995805">Name</span>&nbsp;<span class="op" id="5995810">=</span>&nbsp;<span class="ident" id="5995812">cString</span><span class="op" id="5995819">(</span><span class="ident" id="5995820">realname</span><span class="op" id="5995828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5995832">return</span>&nbsp;<span class="ident" id="5995839">hdr</span><span class="op" id="5995842">,</span>&nbsp;<span class="ident" id="5995844">err</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5995849">case</span>&nbsp;<span class="ident" id="5995854">TypeGNULongLink</span><span class="op" id="5995869">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5995873">//&nbsp;We&nbsp;have&nbsp;a&nbsp;GNU&nbsp;long&nbsp;link&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5995910">realname</span><span class="op" id="5995918">,</span>&nbsp;<span class="ident" id="5995920">err</span>&nbsp;<span class="op" id="5995924">:=</span>&nbsp;<span class="ident" id="5995927">ioutil</span><span class="op" id="5995933">.</span><span class="ident" id="5995934">ReadAll</span><span class="op" id="5995941">(</span><span class="ident" id="5995942">tr</span><span class="op" id="5995944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5995948">if</span>&nbsp;<span class="ident" id="5995951">err</span>&nbsp;<span class="op" id="5995955">!=</span>&nbsp;<span class="ident" id="5995958">nil</span>&nbsp;<span class="op" id="5995962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5995967">return</span>&nbsp;<span class="ident" id="5995974">nil</span><span class="op" id="5995977">,</span>&nbsp;<span class="ident" id="5995979">err</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5995985">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5995989">hdr</span><span class="op" id="5995992">,</span>&nbsp;<span class="ident" id="5995994">err</span>&nbsp;<span class="op" id="5995998">:=</span>&nbsp;<span class="ident" id="5996001">tr</span><span class="op" id="5996003">.</span><span class="ident" id="5996004">Next</span><span class="op" id="5996008">(</span><span class="op" id="5996009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5996013">hdr</span><span class="op" id="5996016">.</span><span class="ident" id="5996017">Linkname</span>&nbsp;<span class="op" id="5996026">=</span>&nbsp;<span class="ident" id="5996028">cString</span><span class="op" id="5996035">(</span><span class="ident" id="5996036">realname</span><span class="op" id="5996044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5996048">return</span>&nbsp;<span class="ident" id="5996055">hdr</span><span class="op" id="5996058">,</span>&nbsp;<span class="ident" id="5996060">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5996065">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5996068">return</span>&nbsp;<span class="ident" id="5996075">hdr</span><span class="op" id="5996078">,</span>&nbsp;<span class="ident" id="5996080">tr</span><span class="op" id="5996082">.</span><span class="ident" id="5996083">err</span><br>
<span class="lineno"></span><span class="op" id="5996087">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5996090">//&nbsp;checkForGNUSparsePAXHeaders&nbsp;checks&nbsp;the&nbsp;PAX&nbsp;headers&nbsp;for&nbsp;GNU&nbsp;sparse&nbsp;headers.&nbsp;If&nbsp;they&nbsp;are&nbsp;found,&nbsp;then</span><br>
<span class="lineno"></span><span class="comment" id="5996192">//&nbsp;this&nbsp;function&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;map&nbsp;and&nbsp;returns&nbsp;it.&nbsp;Unknown&nbsp;sparse&nbsp;formats&nbsp;are&nbsp;ignored,&nbsp;causing&nbsp;the&nbsp;file&nbsp;to</span><br>
<span class="lineno">150</span><span class="comment" id="5996302">//&nbsp;be&nbsp;treated&nbsp;as&nbsp;a&nbsp;regular&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="5996335">func</span>&nbsp;<span class="op" id="5996340">(</span><span class="ident" id="5996341">tr</span>&nbsp;<span class="op" id="5996344">*</span><span class="ident" id="5996345">Reader</span><span class="op" id="5996351">)</span>&nbsp;<span class="ident" id="5996353">checkForGNUSparsePAXHeaders</span><span class="op" id="5996380">(</span><span class="ident" id="5996381">hdr</span>&nbsp;<span class="op" id="5996385">*</span><span class="ident" id="5996386">Header</span><span class="op" id="5996392">,</span>&nbsp;<span class="ident" id="5996394">headers</span>&nbsp;<span class="keyword" id="5996402">map</span><span class="op" id="5996405">[</span><span class="builtintype" id="5996406">string</span><span class="op" id="5996412">]</span><span class="builtintype" id="5996413">string</span><span class="op" id="5996419">)</span>&nbsp;<span class="op" id="5996421">(</span><span class="op" id="5996422">[</span><span class="op" id="5996423">]</span><span class="ident" id="5996424">sparseEntry</span><span class="op" id="5996435">,</span>&nbsp;<span class="builtintype" id="5996437">error</span><span class="op" id="5996442">)</span>&nbsp;<span class="op" id="5996444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5996447">var</span>&nbsp;<span class="ident" id="5996451">sparseFormat</span>&nbsp;<span class="builtintype" id="5996464">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5996473">//&nbsp;Check&nbsp;for&nbsp;sparse&nbsp;format&nbsp;indicators</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5996512">major</span><span class="op" id="5996517">,</span>&nbsp;<span class="ident" id="5996519">majorOk</span>&nbsp;<span class="op" id="5996527">:=</span>&nbsp;<span class="ident" id="5996530">headers</span><span class="op" id="5996537">[</span><span class="ident" id="5996538">paxGNUSparseMajor</span><span class="op" id="5996555">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5996558">minor</span><span class="op" id="5996563">,</span>&nbsp;<span class="ident" id="5996565">minorOk</span>&nbsp;<span class="op" id="5996573">:=</span>&nbsp;<span class="ident" id="5996576">headers</span><span class="op" id="5996583">[</span><span class="ident" id="5996584">paxGNUSparseMinor</span><span class="op" id="5996601">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5996604">sparseName</span><span class="op" id="5996614">,</span>&nbsp;<span class="ident" id="5996616">sparseNameOk</span>&nbsp;<span class="op" id="5996629">:=</span>&nbsp;<span class="ident" id="5996632">headers</span><span class="op" id="5996639">[</span><span class="ident" id="5996640">paxGNUSparseName</span><span class="op" id="5996656">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5996659">_</span><span class="op" id="5996660">,</span>&nbsp;<span class="ident" id="5996662">sparseMapOk</span>&nbsp;<span class="op" id="5996674">:=</span>&nbsp;<span class="ident" id="5996677">headers</span><span class="op" id="5996684">[</span><span class="ident" id="5996685">paxGNUSparseMap</span><span class="op" id="5996700">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5996703">sparseSize</span><span class="op" id="5996713">,</span>&nbsp;<span class="ident" id="5996715">sparseSizeOk</span>&nbsp;<span class="op" id="5996728">:=</span>&nbsp;<span class="ident" id="5996731">headers</span><span class="op" id="5996738">[</span><span class="ident" id="5996739">paxGNUSparseSize</span><span class="op" id="5996755">]</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5996758">sparseRealSize</span><span class="op" id="5996772">,</span>&nbsp;<span class="ident" id="5996774">sparseRealSizeOk</span>&nbsp;<span class="op" id="5996791">:=</span>&nbsp;<span class="ident" id="5996794">headers</span><span class="op" id="5996801">[</span><span class="ident" id="5996802">paxGNUSparseRealSize</span><span class="op" id="5996822">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5996826">//&nbsp;Identify&nbsp;which,&nbsp;if&nbsp;any,&nbsp;sparse&nbsp;format&nbsp;applies&nbsp;from&nbsp;which&nbsp;PAX&nbsp;headers&nbsp;are&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5996907">if</span>&nbsp;<span class="ident" id="5996910">majorOk</span>&nbsp;<span class="op" id="5996918">&amp;&amp;</span>&nbsp;<span class="ident" id="5996921">minorOk</span>&nbsp;<span class="op" id="5996929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5996933">sparseFormat</span>&nbsp;<span class="op" id="5996946">=</span>&nbsp;<span class="ident" id="5996948">major</span>&nbsp;<span class="op" id="5996954">+</span>&nbsp;<span class="string" id="5996956">&#34;.&#34;</span>&nbsp;<span class="op" id="5996960">+</span>&nbsp;<span class="ident" id="5996962">minor</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5996969">}</span>&nbsp;<span class="keyword" id="5996971">else</span>&nbsp;<span class="keyword" id="5996976">if</span>&nbsp;<span class="ident" id="5996979">sparseNameOk</span>&nbsp;<span class="op" id="5996992">&amp;&amp;</span>&nbsp;<span class="ident" id="5996995">sparseMapOk</span>&nbsp;<span class="op" id="5997007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5997011">sparseFormat</span>&nbsp;<span class="op" id="5997024">=</span>&nbsp;<span class="string" id="5997026">&#34;0.1&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5997033">}</span>&nbsp;<span class="keyword" id="5997035">else</span>&nbsp;<span class="keyword" id="5997040">if</span>&nbsp;<span class="ident" id="5997043">sparseSizeOk</span>&nbsp;<span class="op" id="5997056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5997060">sparseFormat</span>&nbsp;<span class="op" id="5997073">=</span>&nbsp;<span class="string" id="5997075">&#34;0.0&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5997082">}</span>&nbsp;<span class="keyword" id="5997084">else</span>&nbsp;<span class="op" id="5997089">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5997093">//&nbsp;Not&nbsp;a&nbsp;PAX&nbsp;format&nbsp;GNU&nbsp;sparse&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5997132">return</span>&nbsp;<span class="ident" id="5997139">nil</span><span class="op" id="5997142">,</span>&nbsp;<span class="ident" id="5997144">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5997149">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5997153">//&nbsp;Check&nbsp;for&nbsp;unknown&nbsp;sparse&nbsp;format</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5997189">if</span>&nbsp;<span class="ident" id="5997192">sparseFormat</span>&nbsp;<span class="op" id="5997205">!=</span>&nbsp;<span class="string" id="5997208">&#34;0.0&#34;</span>&nbsp;<span class="op" id="5997214">&amp;&amp;</span>&nbsp;<span class="ident" id="5997217">sparseFormat</span>&nbsp;<span class="op" id="5997230">!=</span>&nbsp;<span class="string" id="5997233">&#34;0.1&#34;</span>&nbsp;<span class="op" id="5997239">&amp;&amp;</span>&nbsp;<span class="ident" id="5997242">sparseFormat</span>&nbsp;<span class="op" id="5997255">!=</span>&nbsp;<span class="string" id="5997258">&#34;1.0&#34;</span>&nbsp;<span class="op" id="5997264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5997268">return</span>&nbsp;<span class="ident" id="5997275">nil</span><span class="op" id="5997278">,</span>&nbsp;<span class="ident" id="5997280">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5997285">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5997289">//&nbsp;Update&nbsp;hdr&nbsp;from&nbsp;GNU&nbsp;sparse&nbsp;PAX&nbsp;headers</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5997332">if</span>&nbsp;<span class="ident" id="5997335">sparseNameOk</span>&nbsp;<span class="op" id="5997348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5997352">hdr</span><span class="op" id="5997355">.</span><span class="ident" id="5997356">Name</span>&nbsp;<span class="op" id="5997361">=</span>&nbsp;<span class="ident" id="5997363">sparseName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5997375">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5997378">if</span>&nbsp;<span class="ident" id="5997381">sparseSizeOk</span>&nbsp;<span class="op" id="5997394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5997398">realSize</span><span class="op" id="5997406">,</span>&nbsp;<span class="ident" id="5997408">err</span>&nbsp;<span class="op" id="5997412">:=</span>&nbsp;<span class="ident" id="5997415">strconv</span><span class="op" id="5997422">.</span><span class="ident" id="5997423">ParseInt</span><span class="op" id="5997431">(</span><span class="ident" id="5997432">sparseSize</span><span class="op" id="5997442">,</span>&nbsp;<span class="num" id="5997444">10</span><span class="op" id="5997446">,</span>&nbsp;<span class="num" id="5997448">0</span><span class="op" id="5997449">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5997453">if</span>&nbsp;<span class="ident" id="5997456">err</span>&nbsp;<span class="op" id="5997460">!=</span>&nbsp;<span class="ident" id="5997463">nil</span>&nbsp;<span class="op" id="5997467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5997472">return</span>&nbsp;<span class="ident" id="5997479">nil</span><span class="op" id="5997482">,</span>&nbsp;<span class="ident" id="5997484">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5997496">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5997500">hdr</span><span class="op" id="5997503">.</span><span class="ident" id="5997504">Size</span>&nbsp;<span class="op" id="5997509">=</span>&nbsp;<span class="ident" id="5997511">realSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5997521">}</span>&nbsp;<span class="keyword" id="5997523">else</span>&nbsp;<span class="keyword" id="5997528">if</span>&nbsp;<span class="ident" id="5997531">sparseRealSizeOk</span>&nbsp;<span class="op" id="5997548">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5997552">realSize</span><span class="op" id="5997560">,</span>&nbsp;<span class="ident" id="5997562">err</span>&nbsp;<span class="op" id="5997566">:=</span>&nbsp;<span class="ident" id="5997569">strconv</span><span class="op" id="5997576">.</span><span class="ident" id="5997577">ParseInt</span><span class="op" id="5997585">(</span><span class="ident" id="5997586">sparseRealSize</span><span class="op" id="5997600">,</span>&nbsp;<span class="num" id="5997602">10</span><span class="op" id="5997604">,</span>&nbsp;<span class="num" id="5997606">0</span><span class="op" id="5997607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5997611">if</span>&nbsp;<span class="ident" id="5997614">err</span>&nbsp;<span class="op" id="5997618">!=</span>&nbsp;<span class="ident" id="5997621">nil</span>&nbsp;<span class="op" id="5997625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5997630">return</span>&nbsp;<span class="ident" id="5997637">nil</span><span class="op" id="5997640">,</span>&nbsp;<span class="ident" id="5997642">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5997654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5997658">hdr</span><span class="op" id="5997661">.</span><span class="ident" id="5997662">Size</span>&nbsp;<span class="op" id="5997667">=</span>&nbsp;<span class="ident" id="5997669">realSize</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5997679">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5997683">//&nbsp;Set&nbsp;up&nbsp;the&nbsp;sparse&nbsp;map,&nbsp;according&nbsp;to&nbsp;the&nbsp;particular&nbsp;sparse&nbsp;format&nbsp;in&nbsp;use</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5997759">var</span>&nbsp;<span class="ident" id="5997763">sp</span>&nbsp;<span class="op" id="5997766">[</span><span class="op" id="5997767">]</span><span class="ident" id="5997768">sparseEntry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5997781">var</span>&nbsp;<span class="ident" id="5997785">err</span>&nbsp;<span class="builtintype" id="5997789">error</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5997796">switch</span>&nbsp;<span class="ident" id="5997803">sparseFormat</span>&nbsp;<span class="op" id="5997816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5997819">case</span>&nbsp;<span class="string" id="5997824">&#34;0.0&#34;</span><span class="op" id="5997829">,</span>&nbsp;<span class="string" id="5997831">&#34;0.1&#34;</span><span class="op" id="5997836">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5997840">sp</span><span class="op" id="5997842">,</span>&nbsp;<span class="ident" id="5997844">err</span>&nbsp;<span class="op" id="5997848">=</span>&nbsp;<span class="ident" id="5997850">readGNUSparseMap0x1</span><span class="op" id="5997869">(</span><span class="ident" id="5997870">headers</span><span class="op" id="5997877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5997880">case</span>&nbsp;<span class="string" id="5997885">&#34;1.0&#34;</span><span class="op" id="5997890">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5997894">sp</span><span class="op" id="5997896">,</span>&nbsp;<span class="ident" id="5997898">err</span>&nbsp;<span class="op" id="5997902">=</span>&nbsp;<span class="ident" id="5997904">readGNUSparseMap1x0</span><span class="op" id="5997923">(</span><span class="ident" id="5997924">tr</span><span class="op" id="5997926">.</span><span class="ident" id="5997927">curr</span><span class="op" id="5997931">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5997934">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5997937">return</span>&nbsp;<span class="ident" id="5997944">sp</span><span class="op" id="5997946">,</span>&nbsp;<span class="ident" id="5997948">err</span><br>
<span class="lineno"></span><span class="op" id="5997952">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5997955">//&nbsp;mergePAX&nbsp;merges&nbsp;well&nbsp;known&nbsp;headers&nbsp;according&nbsp;to&nbsp;PAX&nbsp;standard.</span><br>
<span class="lineno">210</span><span class="comment" id="5998020">//&nbsp;In&nbsp;general&nbsp;headers&nbsp;with&nbsp;the&nbsp;same&nbsp;name&nbsp;as&nbsp;those&nbsp;found</span><br>
<span class="lineno"></span><span class="comment" id="5998076">//&nbsp;in&nbsp;the&nbsp;header&nbsp;struct&nbsp;overwrite&nbsp;those&nbsp;found&nbsp;in&nbsp;the&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="5998136">//&nbsp;struct&nbsp;with&nbsp;higher&nbsp;precision&nbsp;or&nbsp;longer&nbsp;values.&nbsp;Esp.&nbsp;useful</span><br>
<span class="lineno"></span><span class="comment" id="5998198">//&nbsp;for&nbsp;name&nbsp;and&nbsp;linkname&nbsp;fields.</span><br>
<span class="lineno"></span><span class="keyword" id="5998231">func</span>&nbsp;<span class="ident" id="5998236">mergePAX</span><span class="op" id="5998244">(</span><span class="ident" id="5998245">hdr</span>&nbsp;<span class="op" id="5998249">*</span><span class="ident" id="5998250">Header</span><span class="op" id="5998256">,</span>&nbsp;<span class="ident" id="5998258">headers</span>&nbsp;<span class="keyword" id="5998266">map</span><span class="op" id="5998269">[</span><span class="builtintype" id="5998270">string</span><span class="op" id="5998276">]</span><span class="builtintype" id="5998277">string</span><span class="op" id="5998283">)</span>&nbsp;<span class="builtintype" id="5998285">error</span>&nbsp;<span class="op" id="5998291">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5998294">for</span>&nbsp;<span class="ident" id="5998298">k</span><span class="op" id="5998299">,</span>&nbsp;<span class="ident" id="5998301">v</span>&nbsp;<span class="op" id="5998303">:=</span>&nbsp;<span class="keyword" id="5998306">range</span>&nbsp;<span class="ident" id="5998312">headers</span>&nbsp;<span class="op" id="5998320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5998324">switch</span>&nbsp;<span class="ident" id="5998331">k</span>&nbsp;<span class="op" id="5998333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5998337">case</span>&nbsp;<span class="ident" id="5998342">paxPath</span><span class="op" id="5998349">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998354">hdr</span><span class="op" id="5998357">.</span><span class="ident" id="5998358">Name</span>&nbsp;<span class="op" id="5998363">=</span>&nbsp;<span class="ident" id="5998365">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5998369">case</span>&nbsp;<span class="ident" id="5998374">paxLinkpath</span><span class="op" id="5998385">:</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998390">hdr</span><span class="op" id="5998393">.</span><span class="ident" id="5998394">Linkname</span>&nbsp;<span class="op" id="5998403">=</span>&nbsp;<span class="ident" id="5998405">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5998409">case</span>&nbsp;<span class="ident" id="5998414">paxGname</span><span class="op" id="5998422">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998427">hdr</span><span class="op" id="5998430">.</span><span class="ident" id="5998431">Gname</span>&nbsp;<span class="op" id="5998437">=</span>&nbsp;<span class="ident" id="5998439">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5998443">case</span>&nbsp;<span class="ident" id="5998448">paxUname</span><span class="op" id="5998456">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998461">hdr</span><span class="op" id="5998464">.</span><span class="ident" id="5998465">Uname</span>&nbsp;<span class="op" id="5998471">=</span>&nbsp;<span class="ident" id="5998473">v</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5998477">case</span>&nbsp;<span class="ident" id="5998482">paxUid</span><span class="op" id="5998488">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998493">uid</span><span class="op" id="5998496">,</span>&nbsp;<span class="ident" id="5998498">err</span>&nbsp;<span class="op" id="5998502">:=</span>&nbsp;<span class="ident" id="5998505">strconv</span><span class="op" id="5998512">.</span><span class="ident" id="5998513">ParseInt</span><span class="op" id="5998521">(</span><span class="ident" id="5998522">v</span><span class="op" id="5998523">,</span>&nbsp;<span class="num" id="5998525">10</span><span class="op" id="5998527">,</span>&nbsp;<span class="num" id="5998529">0</span><span class="op" id="5998530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5998535">if</span>&nbsp;<span class="ident" id="5998538">err</span>&nbsp;<span class="op" id="5998542">!=</span>&nbsp;<span class="ident" id="5998545">nil</span>&nbsp;<span class="op" id="5998549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5998555">return</span>&nbsp;<span class="ident" id="5998562">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5998569">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998574">hdr</span><span class="op" id="5998577">.</span><span class="ident" id="5998578">Uid</span>&nbsp;<span class="op" id="5998582">=</span>&nbsp;<span class="builtintype" id="5998584">int</span><span class="op" id="5998587">(</span><span class="ident" id="5998588">uid</span><span class="op" id="5998591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5998595">case</span>&nbsp;<span class="ident" id="5998600">paxGid</span><span class="op" id="5998606">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998611">gid</span><span class="op" id="5998614">,</span>&nbsp;<span class="ident" id="5998616">err</span>&nbsp;<span class="op" id="5998620">:=</span>&nbsp;<span class="ident" id="5998623">strconv</span><span class="op" id="5998630">.</span><span class="ident" id="5998631">ParseInt</span><span class="op" id="5998639">(</span><span class="ident" id="5998640">v</span><span class="op" id="5998641">,</span>&nbsp;<span class="num" id="5998643">10</span><span class="op" id="5998645">,</span>&nbsp;<span class="num" id="5998647">0</span><span class="op" id="5998648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5998653">if</span>&nbsp;<span class="ident" id="5998656">err</span>&nbsp;<span class="op" id="5998660">!=</span>&nbsp;<span class="ident" id="5998663">nil</span>&nbsp;<span class="op" id="5998667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5998673">return</span>&nbsp;<span class="ident" id="5998680">err</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5998687">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998692">hdr</span><span class="op" id="5998695">.</span><span class="ident" id="5998696">Gid</span>&nbsp;<span class="op" id="5998700">=</span>&nbsp;<span class="builtintype" id="5998702">int</span><span class="op" id="5998705">(</span><span class="ident" id="5998706">gid</span><span class="op" id="5998709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5998713">case</span>&nbsp;<span class="ident" id="5998718">paxAtime</span><span class="op" id="5998726">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998731">t</span><span class="op" id="5998732">,</span>&nbsp;<span class="ident" id="5998734">err</span>&nbsp;<span class="op" id="5998738">:=</span>&nbsp;<span class="ident" id="5998741">parsePAXTime</span><span class="op" id="5998753">(</span><span class="ident" id="5998754">v</span><span class="op" id="5998755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5998760">if</span>&nbsp;<span class="ident" id="5998763">err</span>&nbsp;<span class="op" id="5998767">!=</span>&nbsp;<span class="ident" id="5998770">nil</span>&nbsp;<span class="op" id="5998774">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5998780">return</span>&nbsp;<span class="ident" id="5998787">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5998794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998799">hdr</span><span class="op" id="5998802">.</span><span class="ident" id="5998803">AccessTime</span>&nbsp;<span class="op" id="5998814">=</span>&nbsp;<span class="ident" id="5998816">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5998820">case</span>&nbsp;<span class="ident" id="5998825">paxMtime</span><span class="op" id="5998833">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998838">t</span><span class="op" id="5998839">,</span>&nbsp;<span class="ident" id="5998841">err</span>&nbsp;<span class="op" id="5998845">:=</span>&nbsp;<span class="ident" id="5998848">parsePAXTime</span><span class="op" id="5998860">(</span><span class="ident" id="5998861">v</span><span class="op" id="5998862">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5998867">if</span>&nbsp;<span class="ident" id="5998870">err</span>&nbsp;<span class="op" id="5998874">!=</span>&nbsp;<span class="ident" id="5998877">nil</span>&nbsp;<span class="op" id="5998881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5998887">return</span>&nbsp;<span class="ident" id="5998894">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5998901">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998906">hdr</span><span class="op" id="5998909">.</span><span class="ident" id="5998910">ModTime</span>&nbsp;<span class="op" id="5998918">=</span>&nbsp;<span class="ident" id="5998920">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5998924">case</span>&nbsp;<span class="ident" id="5998929">paxCtime</span><span class="op" id="5998937">:</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5998942">t</span><span class="op" id="5998943">,</span>&nbsp;<span class="ident" id="5998945">err</span>&nbsp;<span class="op" id="5998949">:=</span>&nbsp;<span class="ident" id="5998952">parsePAXTime</span><span class="op" id="5998964">(</span><span class="ident" id="5998965">v</span><span class="op" id="5998966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5998971">if</span>&nbsp;<span class="ident" id="5998974">err</span>&nbsp;<span class="op" id="5998978">!=</span>&nbsp;<span class="ident" id="5998981">nil</span>&nbsp;<span class="op" id="5998985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5998991">return</span>&nbsp;<span class="ident" id="5998998">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5999005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5999010">hdr</span><span class="op" id="5999013">.</span><span class="ident" id="5999014">ChangeTime</span>&nbsp;<span class="op" id="5999025">=</span>&nbsp;<span class="ident" id="5999027">t</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5999031">case</span>&nbsp;<span class="ident" id="5999036">paxSize</span><span class="op" id="5999043">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5999048">size</span><span class="op" id="5999052">,</span>&nbsp;<span class="ident" id="5999054">err</span>&nbsp;<span class="op" id="5999058">:=</span>&nbsp;<span class="ident" id="5999061">strconv</span><span class="op" id="5999068">.</span><span class="ident" id="5999069">ParseInt</span><span class="op" id="5999077">(</span><span class="ident" id="5999078">v</span><span class="op" id="5999079">,</span>&nbsp;<span class="num" id="5999081">10</span><span class="op" id="5999083">,</span>&nbsp;<span class="num" id="5999085">0</span><span class="op" id="5999086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5999091">if</span>&nbsp;<span class="ident" id="5999094">err</span>&nbsp;<span class="op" id="5999098">!=</span>&nbsp;<span class="ident" id="5999101">nil</span>&nbsp;<span class="op" id="5999105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5999111">return</span>&nbsp;<span class="ident" id="5999118">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5999125">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5999130">hdr</span><span class="op" id="5999133">.</span><span class="ident" id="5999134">Size</span>&nbsp;<span class="op" id="5999139">=</span>&nbsp;<span class="ident" id="5999141">int64</span><span class="op" id="5999146">(</span><span class="ident" id="5999147">size</span><span class="op" id="5999151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5999155">default</span><span class="op" id="5999162">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5999167">if</span>&nbsp;<span class="ident" id="5999170">strings</span><span class="op" id="5999177">.</span><span class="ident" id="5999178">HasPrefix</span><span class="op" id="5999187">(</span><span class="ident" id="5999188">k</span><span class="op" id="5999189">,</span>&nbsp;<span class="ident" id="5999191">paxXattr</span><span class="op" id="5999199">)</span>&nbsp;<span class="op" id="5999201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5999207">if</span>&nbsp;<span class="ident" id="5999210">hdr</span><span class="op" id="5999213">.</span><span class="ident" id="5999214">Xattrs</span>&nbsp;<span class="op" id="5999221">==</span>&nbsp;<span class="ident" id="5999224">nil</span>&nbsp;<span class="op" id="5999228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5999235">hdr</span><span class="op" id="5999238">.</span><span class="ident" id="5999239">Xattrs</span>&nbsp;<span class="op" id="5999246">=</span>&nbsp;<span class="builtinfunc" id="5999248">make</span><span class="op" id="5999252">(</span><span class="keyword" id="5999253">map</span><span class="op" id="5999256">[</span><span class="builtintype" id="5999257">string</span><span class="op" id="5999263">]</span><span class="builtintype" id="5999264">string</span><span class="op" id="5999270">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5999276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5999282">hdr</span><span class="op" id="5999285">.</span><span class="ident" id="5999286">Xattrs</span><span class="op" id="5999292">[</span><span class="ident" id="5999293">k</span><span class="op" id="5999294">[</span><span class="builtinfunc" id="5999295">len</span><span class="op" id="5999298">(</span><span class="ident" id="5999299">paxXattr</span><span class="op" id="5999307">)</span><span class="op" id="5999308">:</span><span class="op" id="5999309">]</span><span class="op" id="5999310">]</span>&nbsp;<span class="op" id="5999312">=</span>&nbsp;<span class="ident" id="5999314">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5999319">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5999323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5999326">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5999329">return</span>&nbsp;<span class="ident" id="5999336">nil</span><br>
<span class="lineno"></span><span class="op" id="5999340">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5999343">//&nbsp;parsePAXTime&nbsp;takes&nbsp;a&nbsp;string&nbsp;of&nbsp;the&nbsp;form&nbsp;%d.%d&nbsp;as&nbsp;described&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="5999408">//&nbsp;the&nbsp;PAX&nbsp;specification.</span><br>
<span class="lineno">275</span><span class="keyword" id="5999434">func</span>&nbsp;<span class="ident" id="5999439">parsePAXTime</span><span class="op" id="5999451">(</span><span class="ident" id="5999452">t</span>&nbsp;<span class="builtintype" id="5999454">string</span><span class="op" id="5999460">)</span>&nbsp;<span class="op" id="5999462">(</span><span class="ident" id="5999463">time</span><span class="op" id="5999467">.</span><span class="ident" id="5999468">Time</span><span class="op" id="5999472">,</span>&nbsp;<span class="builtintype" id="5999474">error</span><span class="op" id="5999479">)</span>&nbsp;<span class="op" id="5999481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5999484">buf</span>&nbsp;<span class="op" id="5999488">:=</span>&nbsp;<span class="op" id="5999491">[</span><span class="op" id="5999492">]</span><span class="builtintype" id="5999493">byte</span><span class="op" id="5999497">(</span><span class="ident" id="5999498">t</span><span class="op" id="5999499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5999502">pos</span>&nbsp;<span class="op" id="5999506">:=</span>&nbsp;<span class="ident" id="5999509">bytes</span><span class="op" id="5999514">.</span><span class="ident" id="5999515">IndexByte</span><span class="op" id="5999524">(</span><span class="ident" id="5999525">buf</span><span class="op" id="5999528">,</span>&nbsp;<span class="string" id="5999530">&#39;.&#39;</span><span class="op" id="5999533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5999536">var</span>&nbsp;<span class="ident" id="5999540">seconds</span><span class="op" id="5999547">,</span>&nbsp;<span class="ident" id="5999549">nanoseconds</span>&nbsp;<span class="ident" id="5999561">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5999568">var</span>&nbsp;<span class="ident" id="5999572">err</span>&nbsp;<span class="builtintype" id="5999576">error</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5999583">if</span>&nbsp;<span class="ident" id="5999586">pos</span>&nbsp;<span class="op" id="5999590">==</span>&nbsp;<span class="op" id="5999593">-</span><span class="num" id="5999594">1</span>&nbsp;<span class="op" id="5999596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5999600">seconds</span><span class="op" id="5999607">,</span>&nbsp;<span class="ident" id="5999609">err</span>&nbsp;<span class="op" id="5999613">=</span>&nbsp;<span class="ident" id="5999615">strconv</span><span class="op" id="5999622">.</span><span class="ident" id="5999623">ParseInt</span><span class="op" id="5999631">(</span><span class="ident" id="5999632">t</span><span class="op" id="5999633">,</span>&nbsp;<span class="num" id="5999635">10</span><span class="op" id="5999637">,</span>&nbsp;<span class="num" id="5999639">0</span><span class="op" id="5999640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5999644">if</span>&nbsp;<span class="ident" id="5999647">err</span>&nbsp;<span class="op" id="5999651">!=</span>&nbsp;<span class="ident" id="5999654">nil</span>&nbsp;<span class="op" id="5999658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5999663">return</span>&nbsp;<span class="ident" id="5999670">time</span><span class="op" id="5999674">.</span><span class="ident" id="5999675">Time</span><span class="op" id="5999679">{</span><span class="op" id="5999680">}</span><span class="op" id="5999681">,</span>&nbsp;<span class="ident" id="5999683">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5999689">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5999692">}</span>&nbsp;<span class="keyword" id="5999694">else</span>&nbsp;<span class="op" id="5999699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5999703">seconds</span><span class="op" id="5999710">,</span>&nbsp;<span class="ident" id="5999712">err</span>&nbsp;<span class="op" id="5999716">=</span>&nbsp;<span class="ident" id="5999718">strconv</span><span class="op" id="5999725">.</span><span class="ident" id="5999726">ParseInt</span><span class="op" id="5999734">(</span><span class="builtintype" id="5999735">string</span><span class="op" id="5999741">(</span><span class="ident" id="5999742">buf</span><span class="op" id="5999745">[</span><span class="op" id="5999746">:</span><span class="ident" id="5999747">pos</span><span class="op" id="5999750">]</span><span class="op" id="5999751">)</span><span class="op" id="5999752">,</span>&nbsp;<span class="num" id="5999754">10</span><span class="op" id="5999756">,</span>&nbsp;<span class="num" id="5999758">0</span><span class="op" id="5999759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5999763">if</span>&nbsp;<span class="ident" id="5999766">err</span>&nbsp;<span class="op" id="5999770">!=</span>&nbsp;<span class="ident" id="5999773">nil</span>&nbsp;<span class="op" id="5999777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5999782">return</span>&nbsp;<span class="ident" id="5999789">time</span><span class="op" id="5999793">.</span><span class="ident" id="5999794">Time</span><span class="op" id="5999798">{</span><span class="op" id="5999799">}</span><span class="op" id="5999800">,</span>&nbsp;<span class="ident" id="5999802">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5999808">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5999812">nano_buf</span>&nbsp;<span class="op" id="5999821">:=</span>&nbsp;<span class="builtintype" id="5999824">string</span><span class="op" id="5999830">(</span><span class="ident" id="5999831">buf</span><span class="op" id="5999834">[</span><span class="ident" id="5999835">pos</span><span class="op" id="5999838">+</span><span class="num" id="5999839">1</span><span class="op" id="5999840">:</span><span class="op" id="5999841">]</span><span class="op" id="5999842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5999846">//&nbsp;Pad&nbsp;as&nbsp;needed&nbsp;before&nbsp;converting&nbsp;to&nbsp;a&nbsp;decimal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5999897">//&nbsp;For&nbsp;example&nbsp;.030&nbsp;-&gt;&nbsp;.030000000&nbsp;-&gt;&nbsp;30000000&nbsp;nanoseconds</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5999957">if</span>&nbsp;<span class="builtinfunc" id="5999960">len</span><span class="op" id="5999963">(</span><span class="ident" id="5999964">nano_buf</span><span class="op" id="5999972">)</span>&nbsp;<span class="op" id="5999974">&lt;</span>&nbsp;<span class="ident" id="5999976">maxNanoSecondIntSize</span>&nbsp;<span class="op" id="5999997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6000002">//&nbsp;Right&nbsp;pad</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6000018">nano_buf</span>&nbsp;<span class="op" id="6000027">+=</span>&nbsp;<span class="ident" id="6000030">strings</span><span class="op" id="6000037">.</span><span class="ident" id="6000038">Repeat</span><span class="op" id="6000044">(</span><span class="string" id="6000045">&#34;0&#34;</span><span class="op" id="6000048">,</span>&nbsp;<span class="ident" id="6000050">maxNanoSecondIntSize</span><span class="op" id="6000070">-</span><span class="builtinfunc" id="6000071">len</span><span class="op" id="6000074">(</span><span class="ident" id="6000075">nano_buf</span><span class="op" id="6000083">)</span><span class="op" id="6000084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6000088">}</span>&nbsp;<span class="keyword" id="6000090">else</span>&nbsp;<span class="keyword" id="6000095">if</span>&nbsp;<span class="builtinfunc" id="6000098">len</span><span class="op" id="6000101">(</span><span class="ident" id="6000102">nano_buf</span><span class="op" id="6000110">)</span>&nbsp;<span class="op" id="6000112">&gt;</span>&nbsp;<span class="ident" id="6000114">maxNanoSecondIntSize</span>&nbsp;<span class="op" id="6000135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6000140">//&nbsp;Right&nbsp;truncate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6000161">nano_buf</span>&nbsp;<span class="op" id="6000170">=</span>&nbsp;<span class="ident" id="6000172">nano_buf</span><span class="op" id="6000180">[</span><span class="op" id="6000181">:</span><span class="ident" id="6000182">maxNanoSecondIntSize</span><span class="op" id="6000202">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6000206">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6000210">nanoseconds</span><span class="op" id="6000221">,</span>&nbsp;<span class="ident" id="6000223">err</span>&nbsp;<span class="op" id="6000227">=</span>&nbsp;<span class="ident" id="6000229">strconv</span><span class="op" id="6000236">.</span><span class="ident" id="6000237">ParseInt</span><span class="op" id="6000245">(</span><span class="builtintype" id="6000246">string</span><span class="op" id="6000252">(</span><span class="ident" id="6000253">nano_buf</span><span class="op" id="6000261">)</span><span class="op" id="6000262">,</span>&nbsp;<span class="num" id="6000264">10</span><span class="op" id="6000266">,</span>&nbsp;<span class="num" id="6000268">0</span><span class="op" id="6000269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6000273">if</span>&nbsp;<span class="ident" id="6000276">err</span>&nbsp;<span class="op" id="6000280">!=</span>&nbsp;<span class="ident" id="6000283">nil</span>&nbsp;<span class="op" id="6000287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6000292">return</span>&nbsp;<span class="ident" id="6000299">time</span><span class="op" id="6000303">.</span><span class="ident" id="6000304">Time</span><span class="op" id="6000308">{</span><span class="op" id="6000309">}</span><span class="op" id="6000310">,</span>&nbsp;<span class="ident" id="6000312">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6000318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6000321">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6000324">ts</span>&nbsp;<span class="op" id="6000327">:=</span>&nbsp;<span class="ident" id="6000330">time</span><span class="op" id="6000334">.</span><span class="ident" id="6000335">Unix</span><span class="op" id="6000339">(</span><span class="ident" id="6000340">seconds</span><span class="op" id="6000347">,</span>&nbsp;<span class="ident" id="6000349">nanoseconds</span><span class="op" id="6000360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6000363">return</span>&nbsp;<span class="ident" id="6000370">ts</span><span class="op" id="6000372">,</span>&nbsp;<span class="ident" id="6000374">nil</span><br>
<span class="lineno"></span><span class="op" id="6000378">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6000381">//&nbsp;parsePAX&nbsp;parses&nbsp;PAX&nbsp;headers.</span><br>
<span class="lineno">310</span><span class="comment" id="6000413">//&nbsp;If&nbsp;an&nbsp;extended&nbsp;header&nbsp;(type&nbsp;&#39;x&#39;)&nbsp;is&nbsp;invalid,&nbsp;ErrHeader&nbsp;is&nbsp;returned</span><br>
<span class="lineno"></span><span class="keyword" id="6000483">func</span>&nbsp;<span class="ident" id="6000488">parsePAX</span><span class="op" id="6000496">(</span><span class="ident" id="6000497">r</span>&nbsp;<span class="ident" id="6000499">io</span><span class="op" id="6000501">.</span><span class="ident" id="6000502">Reader</span><span class="op" id="6000508">)</span>&nbsp;<span class="op" id="6000510">(</span><span class="keyword" id="6000511">map</span><span class="op" id="6000514">[</span><span class="builtintype" id="6000515">string</span><span class="op" id="6000521">]</span><span class="builtintype" id="6000522">string</span><span class="op" id="6000528">,</span>&nbsp;<span class="builtintype" id="6000530">error</span><span class="op" id="6000535">)</span>&nbsp;<span class="op" id="6000537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6000540">buf</span><span class="op" id="6000543">,</span>&nbsp;<span class="ident" id="6000545">err</span>&nbsp;<span class="op" id="6000549">:=</span>&nbsp;<span class="ident" id="6000552">ioutil</span><span class="op" id="6000558">.</span><span class="ident" id="6000559">ReadAll</span><span class="op" id="6000566">(</span><span class="ident" id="6000567">r</span><span class="op" id="6000568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6000571">if</span>&nbsp;<span class="ident" id="6000574">err</span>&nbsp;<span class="op" id="6000578">!=</span>&nbsp;<span class="ident" id="6000581">nil</span>&nbsp;<span class="op" id="6000585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6000589">return</span>&nbsp;<span class="ident" id="6000596">nil</span><span class="op" id="6000599">,</span>&nbsp;<span class="ident" id="6000601">err</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6000606">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6000610">//&nbsp;For&nbsp;GNU&nbsp;PAX&nbsp;sparse&nbsp;format&nbsp;0.0&nbsp;support.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6000653">//&nbsp;This&nbsp;function&nbsp;transforms&nbsp;the&nbsp;sparse&nbsp;format&nbsp;0.0&nbsp;headers&nbsp;into&nbsp;sparse&nbsp;format&nbsp;0.1&nbsp;headers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6000744">var</span>&nbsp;<span class="ident" id="6000748">sparseMap</span>&nbsp;<span class="ident" id="6000758">bytes</span><span class="op" id="6000763">.</span><span class="ident" id="6000764">Buffer</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6000773">headers</span>&nbsp;<span class="op" id="6000781">:=</span>&nbsp;<span class="builtinfunc" id="6000784">make</span><span class="op" id="6000788">(</span><span class="keyword" id="6000789">map</span><span class="op" id="6000792">[</span><span class="builtintype" id="6000793">string</span><span class="op" id="6000799">]</span><span class="builtintype" id="6000800">string</span><span class="op" id="6000806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6000809">//&nbsp;Each&nbsp;record&nbsp;is&nbsp;constructed&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6000843">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;%d&nbsp;%s=%s\n&#34;,&nbsp;length,&nbsp;keyword,&nbsp;value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6000888">for</span>&nbsp;<span class="builtinfunc" id="6000892">len</span><span class="op" id="6000895">(</span><span class="ident" id="6000896">buf</span><span class="op" id="6000899">)</span>&nbsp;<span class="op" id="6000901">&gt;</span>&nbsp;<span class="num" id="6000903">0</span>&nbsp;<span class="op" id="6000905">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6000909">//&nbsp;or&nbsp;the&nbsp;header&nbsp;was&nbsp;empty&nbsp;to&nbsp;start&nbsp;with.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6000953">var</span>&nbsp;<span class="ident" id="6000957">sp</span>&nbsp;<span class="builtintype" id="6000960">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6000966">//&nbsp;The&nbsp;size&nbsp;field&nbsp;ends&nbsp;at&nbsp;the&nbsp;first&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6001011">sp</span>&nbsp;<span class="op" id="6001014">=</span>&nbsp;<span class="ident" id="6001016">bytes</span><span class="op" id="6001021">.</span><span class="ident" id="6001022">IndexByte</span><span class="op" id="6001031">(</span><span class="ident" id="6001032">buf</span><span class="op" id="6001035">,</span>&nbsp;<span class="string" id="6001037">&#39;&nbsp;&#39;</span><span class="op" id="6001040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6001044">if</span>&nbsp;<span class="ident" id="6001047">sp</span>&nbsp;<span class="op" id="6001050">==</span>&nbsp;<span class="op" id="6001053">-</span><span class="num" id="6001054">1</span>&nbsp;<span class="op" id="6001056">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6001061">return</span>&nbsp;<span class="ident" id="6001068">nil</span><span class="op" id="6001071">,</span>&nbsp;<span class="ident" id="6001073">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6001085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6001089">//&nbsp;Parse&nbsp;the&nbsp;first&nbsp;token&nbsp;as&nbsp;a&nbsp;decimal&nbsp;integer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6001138">n</span><span class="op" id="6001139">,</span>&nbsp;<span class="ident" id="6001141">err</span>&nbsp;<span class="op" id="6001145">:=</span>&nbsp;<span class="ident" id="6001148">strconv</span><span class="op" id="6001155">.</span><span class="ident" id="6001156">ParseInt</span><span class="op" id="6001164">(</span><span class="builtintype" id="6001165">string</span><span class="op" id="6001171">(</span><span class="ident" id="6001172">buf</span><span class="op" id="6001175">[</span><span class="op" id="6001176">:</span><span class="ident" id="6001177">sp</span><span class="op" id="6001179">]</span><span class="op" id="6001180">)</span><span class="op" id="6001181">,</span>&nbsp;<span class="num" id="6001183">10</span><span class="op" id="6001185">,</span>&nbsp;<span class="num" id="6001187">0</span><span class="op" id="6001188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6001192">if</span>&nbsp;<span class="ident" id="6001195">err</span>&nbsp;<span class="op" id="6001199">!=</span>&nbsp;<span class="ident" id="6001202">nil</span>&nbsp;<span class="op" id="6001206">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6001211">return</span>&nbsp;<span class="ident" id="6001218">nil</span><span class="op" id="6001221">,</span>&nbsp;<span class="ident" id="6001223">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6001235">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6001239">//&nbsp;Extract&nbsp;everything&nbsp;between&nbsp;the&nbsp;decimal&nbsp;and&nbsp;the&nbsp;n&nbsp;-1&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6001303">//&nbsp;beginning&nbsp;to&nbsp;eat&nbsp;the&nbsp;&#39;&nbsp;&#39;,&nbsp;-1&nbsp;on&nbsp;the&nbsp;end&nbsp;to&nbsp;skip&nbsp;the&nbsp;newline.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6001369">var</span>&nbsp;<span class="ident" id="6001373">record</span>&nbsp;<span class="op" id="6001380">[</span><span class="op" id="6001381">]</span><span class="builtintype" id="6001382">byte</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6001389">record</span><span class="op" id="6001395">,</span>&nbsp;<span class="ident" id="6001397">buf</span>&nbsp;<span class="op" id="6001401">=</span>&nbsp;<span class="ident" id="6001403">buf</span><span class="op" id="6001406">[</span><span class="ident" id="6001407">sp</span><span class="op" id="6001409">+</span><span class="num" id="6001410">1</span><span class="op" id="6001411">:</span><span class="ident" id="6001412">n</span><span class="op" id="6001413">-</span><span class="num" id="6001414">1</span><span class="op" id="6001415">]</span><span class="op" id="6001416">,</span>&nbsp;<span class="ident" id="6001418">buf</span><span class="op" id="6001421">[</span><span class="ident" id="6001422">n</span><span class="op" id="6001423">:</span><span class="op" id="6001424">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6001428">//&nbsp;The&nbsp;first&nbsp;equals&nbsp;is&nbsp;guaranteed&nbsp;to&nbsp;mark&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6001492">//&nbsp;Everything&nbsp;else&nbsp;is&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6001523">eq</span>&nbsp;<span class="op" id="6001526">:=</span>&nbsp;<span class="ident" id="6001529">bytes</span><span class="op" id="6001534">.</span><span class="ident" id="6001535">IndexByte</span><span class="op" id="6001544">(</span><span class="ident" id="6001545">record</span><span class="op" id="6001551">,</span>&nbsp;<span class="string" id="6001553">&#39;=&#39;</span><span class="op" id="6001556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6001560">if</span>&nbsp;<span class="ident" id="6001563">eq</span>&nbsp;<span class="op" id="6001566">==</span>&nbsp;<span class="op" id="6001569">-</span><span class="num" id="6001570">1</span>&nbsp;<span class="op" id="6001572">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6001577">return</span>&nbsp;<span class="ident" id="6001584">nil</span><span class="op" id="6001587">,</span>&nbsp;<span class="ident" id="6001589">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6001601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6001605">key</span><span class="op" id="6001608">,</span>&nbsp;<span class="ident" id="6001610">value</span>&nbsp;<span class="op" id="6001616">:=</span>&nbsp;<span class="ident" id="6001619">record</span><span class="op" id="6001625">[</span><span class="op" id="6001626">:</span><span class="ident" id="6001627">eq</span><span class="op" id="6001629">]</span><span class="op" id="6001630">,</span>&nbsp;<span class="ident" id="6001632">record</span><span class="op" id="6001638">[</span><span class="ident" id="6001639">eq</span><span class="op" id="6001641">+</span><span class="num" id="6001642">1</span><span class="op" id="6001643">:</span><span class="op" id="6001644">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6001649">keyStr</span>&nbsp;<span class="op" id="6001656">:=</span>&nbsp;<span class="builtintype" id="6001659">string</span><span class="op" id="6001665">(</span><span class="ident" id="6001666">key</span><span class="op" id="6001669">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6001673">if</span>&nbsp;<span class="ident" id="6001676">keyStr</span>&nbsp;<span class="op" id="6001683">==</span>&nbsp;<span class="ident" id="6001686">paxGNUSparseOffset</span>&nbsp;<span class="op" id="6001705">||</span>&nbsp;<span class="ident" id="6001708">keyStr</span>&nbsp;<span class="op" id="6001715">==</span>&nbsp;<span class="ident" id="6001718">paxGNUSparseNumBytes</span>&nbsp;<span class="op" id="6001739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6001744">//&nbsp;GNU&nbsp;sparse&nbsp;format&nbsp;0.0&nbsp;special&nbsp;key.&nbsp;Write&nbsp;to&nbsp;sparseMap&nbsp;instead&nbsp;of&nbsp;using&nbsp;the&nbsp;headers&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6001838">sparseMap</span><span class="op" id="6001847">.</span><span class="ident" id="6001848">Write</span><span class="op" id="6001853">(</span><span class="ident" id="6001854">value</span><span class="op" id="6001859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6001864">sparseMap</span><span class="op" id="6001873">.</span><span class="ident" id="6001874">Write</span><span class="op" id="6001879">(</span><span class="op" id="6001880">[</span><span class="op" id="6001881">]</span><span class="builtintype" id="6001882">byte</span><span class="op" id="6001886">{</span><span class="string" id="6001887">&#39;,&#39;</span><span class="op" id="6001890">}</span><span class="op" id="6001891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6001895">}</span>&nbsp;<span class="keyword" id="6001897">else</span>&nbsp;<span class="op" id="6001902">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6001907">//&nbsp;Normal&nbsp;key.&nbsp;Set&nbsp;the&nbsp;value&nbsp;in&nbsp;the&nbsp;headers&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6001959">headers</span><span class="op" id="6001966">[</span><span class="ident" id="6001967">keyStr</span><span class="op" id="6001973">]</span>&nbsp;<span class="op" id="6001975">=</span>&nbsp;<span class="builtintype" id="6001977">string</span><span class="op" id="6001983">(</span><span class="ident" id="6001984">value</span><span class="op" id="6001989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6001993">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6001996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6001999">if</span>&nbsp;<span class="ident" id="6002002">sparseMap</span><span class="op" id="6002011">.</span><span class="ident" id="6002012">Len</span><span class="op" id="6002015">(</span><span class="op" id="6002016">)</span>&nbsp;<span class="op" id="6002018">!=</span>&nbsp;<span class="num" id="6002021">0</span>&nbsp;<span class="op" id="6002023">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6002027">//&nbsp;Add&nbsp;sparse&nbsp;info&nbsp;to&nbsp;headers,&nbsp;chopping&nbsp;off&nbsp;the&nbsp;extra&nbsp;comma</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6002089">sparseMap</span><span class="op" id="6002098">.</span><span class="ident" id="6002099">Truncate</span><span class="op" id="6002107">(</span><span class="ident" id="6002108">sparseMap</span><span class="op" id="6002117">.</span><span class="ident" id="6002118">Len</span><span class="op" id="6002121">(</span><span class="op" id="6002122">)</span>&nbsp;<span class="op" id="6002124">-</span>&nbsp;<span class="num" id="6002126">1</span><span class="op" id="6002127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6002131">headers</span><span class="op" id="6002138">[</span><span class="ident" id="6002139">paxGNUSparseMap</span><span class="op" id="6002154">]</span>&nbsp;<span class="op" id="6002156">=</span>&nbsp;<span class="ident" id="6002158">sparseMap</span><span class="op" id="6002167">.</span><span class="ident" id="6002168">String</span><span class="op" id="6002174">(</span><span class="op" id="6002175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6002178">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6002181">return</span>&nbsp;<span class="ident" id="6002188">headers</span><span class="op" id="6002195">,</span>&nbsp;<span class="ident" id="6002197">nil</span><br>
<span class="lineno">365</span><span class="op" id="6002201">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6002204">//&nbsp;cString&nbsp;parses&nbsp;bytes&nbsp;as&nbsp;a&nbsp;NUL-terminated&nbsp;C-style&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="6002264">//&nbsp;If&nbsp;a&nbsp;NUL&nbsp;byte&nbsp;is&nbsp;not&nbsp;found&nbsp;then&nbsp;the&nbsp;whole&nbsp;slice&nbsp;is&nbsp;returned&nbsp;as&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="6002340">func</span>&nbsp;<span class="ident" id="6002345">cString</span><span class="op" id="6002352">(</span><span class="ident" id="6002353">b</span>&nbsp;<span class="op" id="6002355">[</span><span class="op" id="6002356">]</span><span class="builtintype" id="6002357">byte</span><span class="op" id="6002361">)</span>&nbsp;<span class="builtintype" id="6002363">string</span>&nbsp;<span class="op" id="6002370">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6002373">n</span>&nbsp;<span class="op" id="6002375">:=</span>&nbsp;<span class="num" id="6002378">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6002381">for</span>&nbsp;<span class="ident" id="6002385">n</span>&nbsp;<span class="op" id="6002387">&lt;</span>&nbsp;<span class="builtinfunc" id="6002389">len</span><span class="op" id="6002392">(</span><span class="ident" id="6002393">b</span><span class="op" id="6002394">)</span>&nbsp;<span class="op" id="6002396">&amp;&amp;</span>&nbsp;<span class="ident" id="6002399">b</span><span class="op" id="6002400">[</span><span class="ident" id="6002401">n</span><span class="op" id="6002402">]</span>&nbsp;<span class="op" id="6002404">!=</span>&nbsp;<span class="num" id="6002407">0</span>&nbsp;<span class="op" id="6002409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6002413">n</span><span class="op" id="6002414">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6002418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6002421">return</span>&nbsp;<span class="builtintype" id="6002428">string</span><span class="op" id="6002434">(</span><span class="ident" id="6002435">b</span><span class="op" id="6002436">[</span><span class="num" id="6002437">0</span><span class="op" id="6002438">:</span><span class="ident" id="6002439">n</span><span class="op" id="6002440">]</span><span class="op" id="6002441">)</span><br>
<span class="lineno">375</span><span class="op" id="6002443">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6002446">func</span>&nbsp;<span class="op" id="6002451">(</span><span class="ident" id="6002452">tr</span>&nbsp;<span class="op" id="6002455">*</span><span class="ident" id="6002456">Reader</span><span class="op" id="6002462">)</span>&nbsp;<span class="ident" id="6002464">octal</span><span class="op" id="6002469">(</span><span class="ident" id="6002470">b</span>&nbsp;<span class="op" id="6002472">[</span><span class="op" id="6002473">]</span><span class="builtintype" id="6002474">byte</span><span class="op" id="6002478">)</span>&nbsp;<span class="ident" id="6002480">int64</span>&nbsp;<span class="op" id="6002486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6002489">//&nbsp;Check&nbsp;for&nbsp;binary&nbsp;format&nbsp;first.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6002524">if</span>&nbsp;<span class="builtinfunc" id="6002527">len</span><span class="op" id="6002530">(</span><span class="ident" id="6002531">b</span><span class="op" id="6002532">)</span>&nbsp;<span class="op" id="6002534">&gt;</span>&nbsp;<span class="num" id="6002536">0</span>&nbsp;<span class="op" id="6002538">&amp;&amp;</span>&nbsp;<span class="ident" id="6002541">b</span><span class="op" id="6002542">[</span><span class="num" id="6002543">0</span><span class="op" id="6002544">]</span><span class="op" id="6002545">&amp;</span><span class="num" id="6002546">0x80</span>&nbsp;<span class="op" id="6002551">!=</span>&nbsp;<span class="num" id="6002554">0</span>&nbsp;<span class="op" id="6002556">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6002560">var</span>&nbsp;<span class="ident" id="6002564">x</span>&nbsp;<span class="ident" id="6002566">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6002574">for</span>&nbsp;<span class="ident" id="6002578">i</span><span class="op" id="6002579">,</span>&nbsp;<span class="ident" id="6002581">c</span>&nbsp;<span class="op" id="6002583">:=</span>&nbsp;<span class="keyword" id="6002586">range</span>&nbsp;<span class="ident" id="6002592">b</span>&nbsp;<span class="op" id="6002594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6002599">if</span>&nbsp;<span class="ident" id="6002602">i</span>&nbsp;<span class="op" id="6002604">==</span>&nbsp;<span class="num" id="6002607">0</span>&nbsp;<span class="op" id="6002609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6002615">c</span>&nbsp;<span class="op" id="6002617">&amp;=</span>&nbsp;<span class="num" id="6002620">0x7f</span>&nbsp;<span class="comment" id="6002625">//&nbsp;ignore&nbsp;signal&nbsp;bit&nbsp;in&nbsp;first&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6002663">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6002668">x</span>&nbsp;<span class="op" id="6002670">=</span>&nbsp;<span class="ident" id="6002672">x</span><span class="op" id="6002673">&lt;&lt;</span><span class="num" id="6002675">8</span>&nbsp;<span class="op" id="6002677">|</span>&nbsp;<span class="ident" id="6002679">int64</span><span class="op" id="6002684">(</span><span class="ident" id="6002685">c</span><span class="op" id="6002686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6002690">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6002694">return</span>&nbsp;<span class="ident" id="6002701">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6002704">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6002708">//&nbsp;Because&nbsp;unused&nbsp;fields&nbsp;are&nbsp;filled&nbsp;with&nbsp;NULs,&nbsp;we&nbsp;need</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6002764">//&nbsp;to&nbsp;skip&nbsp;leading&nbsp;NULs.&nbsp;Fields&nbsp;may&nbsp;also&nbsp;be&nbsp;padded&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6002821">//&nbsp;spaces&nbsp;or&nbsp;NULs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6002841">//&nbsp;So&nbsp;we&nbsp;remove&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;NULs&nbsp;and&nbsp;spaces&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6002898">//&nbsp;be&nbsp;sure.</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6002911">b</span>&nbsp;<span class="op" id="6002913">=</span>&nbsp;<span class="ident" id="6002915">bytes</span><span class="op" id="6002920">.</span><span class="ident" id="6002921">Trim</span><span class="op" id="6002925">(</span><span class="ident" id="6002926">b</span><span class="op" id="6002927">,</span>&nbsp;<span class="string" id="6002929">&#34;&nbsp;\x00&#34;</span><span class="op" id="6002936">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6002940">if</span>&nbsp;<span class="builtinfunc" id="6002943">len</span><span class="op" id="6002946">(</span><span class="ident" id="6002947">b</span><span class="op" id="6002948">)</span>&nbsp;<span class="op" id="6002950">==</span>&nbsp;<span class="num" id="6002953">0</span>&nbsp;<span class="op" id="6002955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6002959">return</span>&nbsp;<span class="num" id="6002966">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6002969">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6002972">x</span><span class="op" id="6002973">,</span>&nbsp;<span class="ident" id="6002975">err</span>&nbsp;<span class="op" id="6002979">:=</span>&nbsp;<span class="ident" id="6002982">strconv</span><span class="op" id="6002989">.</span><span class="ident" id="6002990">ParseUint</span><span class="op" id="6002999">(</span><span class="ident" id="6003000">cString</span><span class="op" id="6003007">(</span><span class="ident" id="6003008">b</span><span class="op" id="6003009">)</span><span class="op" id="6003010">,</span>&nbsp;<span class="num" id="6003012">8</span><span class="op" id="6003013">,</span>&nbsp;<span class="num" id="6003015">64</span><span class="op" id="6003017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6003020">if</span>&nbsp;<span class="ident" id="6003023">err</span>&nbsp;<span class="op" id="6003027">!=</span>&nbsp;<span class="ident" id="6003030">nil</span>&nbsp;<span class="op" id="6003034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6003038">tr</span><span class="op" id="6003040">.</span><span class="ident" id="6003041">err</span>&nbsp;<span class="op" id="6003045">=</span>&nbsp;<span class="ident" id="6003047">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6003052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6003055">return</span>&nbsp;<span class="ident" id="6003062">int64</span><span class="op" id="6003067">(</span><span class="ident" id="6003068">x</span><span class="op" id="6003069">)</span><br>
<span class="lineno">405</span><span class="op" id="6003071">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6003074">//&nbsp;skipUnread&nbsp;skips&nbsp;any&nbsp;unread&nbsp;bytes&nbsp;in&nbsp;the&nbsp;existing&nbsp;file&nbsp;entry,&nbsp;as&nbsp;well&nbsp;as&nbsp;any&nbsp;alignment&nbsp;padding.</span><br>
<span class="lineno"></span><span class="keyword" id="6003173">func</span>&nbsp;<span class="op" id="6003178">(</span><span class="ident" id="6003179">tr</span>&nbsp;<span class="op" id="6003182">*</span><span class="ident" id="6003183">Reader</span><span class="op" id="6003189">)</span>&nbsp;<span class="ident" id="6003191">skipUnread</span><span class="op" id="6003201">(</span><span class="op" id="6003202">)</span>&nbsp;<span class="op" id="6003204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6003207">nr</span>&nbsp;<span class="op" id="6003210">:=</span>&nbsp;<span class="ident" id="6003213">tr</span><span class="op" id="6003215">.</span><span class="ident" id="6003216">numBytes</span><span class="op" id="6003224">(</span><span class="op" id="6003225">)</span>&nbsp;<span class="op" id="6003227">+</span>&nbsp;<span class="ident" id="6003229">tr</span><span class="op" id="6003231">.</span><span class="ident" id="6003232">pad</span>&nbsp;<span class="comment" id="6003236">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;to&nbsp;skip</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6003264">tr</span><span class="op" id="6003266">.</span><span class="ident" id="6003267">curr</span><span class="op" id="6003271">,</span>&nbsp;<span class="ident" id="6003273">tr</span><span class="op" id="6003275">.</span><span class="ident" id="6003276">pad</span>&nbsp;<span class="op" id="6003280">=</span>&nbsp;<span class="ident" id="6003282">nil</span><span class="op" id="6003285">,</span>&nbsp;<span class="num" id="6003287">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6003290">if</span>&nbsp;<span class="ident" id="6003293">sr</span><span class="op" id="6003295">,</span>&nbsp;<span class="ident" id="6003297">ok</span>&nbsp;<span class="op" id="6003300">:=</span>&nbsp;<span class="ident" id="6003303">tr</span><span class="op" id="6003305">.</span><span class="ident" id="6003306">r</span><span class="op" id="6003307">.</span><span class="op" id="6003308">(</span><span class="ident" id="6003309">io</span><span class="op" id="6003311">.</span><span class="ident" id="6003312">Seeker</span><span class="op" id="6003318">)</span><span class="op" id="6003319">;</span>&nbsp;<span class="ident" id="6003321">ok</span>&nbsp;<span class="op" id="6003324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6003328">if</span>&nbsp;<span class="ident" id="6003331">_</span><span class="op" id="6003332">,</span>&nbsp;<span class="ident" id="6003334">err</span>&nbsp;<span class="op" id="6003338">:=</span>&nbsp;<span class="ident" id="6003341">sr</span><span class="op" id="6003343">.</span><span class="ident" id="6003344">Seek</span><span class="op" id="6003348">(</span><span class="ident" id="6003349">nr</span><span class="op" id="6003351">,</span>&nbsp;<span class="ident" id="6003353">os</span><span class="op" id="6003355">.</span><span class="ident" id="6003356">SEEK_CUR</span><span class="op" id="6003364">)</span><span class="op" id="6003365">;</span>&nbsp;<span class="ident" id="6003367">err</span>&nbsp;<span class="op" id="6003371">==</span>&nbsp;<span class="ident" id="6003374">nil</span>&nbsp;<span class="op" id="6003378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6003383">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6003392">}</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6003395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6003398">_</span><span class="op" id="6003399">,</span>&nbsp;<span class="ident" id="6003401">tr</span><span class="op" id="6003403">.</span><span class="ident" id="6003404">err</span>&nbsp;<span class="op" id="6003408">=</span>&nbsp;<span class="ident" id="6003410">io</span><span class="op" id="6003412">.</span><span class="ident" id="6003413">CopyN</span><span class="op" id="6003418">(</span><span class="ident" id="6003419">ioutil</span><span class="op" id="6003425">.</span><span class="ident" id="6003426">Discard</span><span class="op" id="6003433">,</span>&nbsp;<span class="ident" id="6003435">tr</span><span class="op" id="6003437">.</span><span class="ident" id="6003438">r</span><span class="op" id="6003439">,</span>&nbsp;<span class="ident" id="6003441">nr</span><span class="op" id="6003443">)</span><br>
<span class="lineno"></span><span class="op" id="6003445">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6003448">func</span>&nbsp;<span class="op" id="6003453">(</span><span class="ident" id="6003454">tr</span>&nbsp;<span class="op" id="6003457">*</span><span class="ident" id="6003458">Reader</span><span class="op" id="6003464">)</span>&nbsp;<span class="ident" id="6003466">verifyChecksum</span><span class="op" id="6003480">(</span><span class="ident" id="6003481">header</span>&nbsp;<span class="op" id="6003488">[</span><span class="op" id="6003489">]</span><span class="builtintype" id="6003490">byte</span><span class="op" id="6003494">)</span>&nbsp;<span class="builtintype" id="6003496">bool</span>&nbsp;<span class="op" id="6003501">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6003504">if</span>&nbsp;<span class="ident" id="6003507">tr</span><span class="op" id="6003509">.</span><span class="ident" id="6003510">err</span>&nbsp;<span class="op" id="6003514">!=</span>&nbsp;<span class="ident" id="6003517">nil</span>&nbsp;<span class="op" id="6003521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6003525">return</span>&nbsp;<span class="builtintype" id="6003532">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6003539">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6003543">given</span>&nbsp;<span class="op" id="6003549">:=</span>&nbsp;<span class="ident" id="6003552">tr</span><span class="op" id="6003554">.</span><span class="ident" id="6003555">octal</span><span class="op" id="6003560">(</span><span class="ident" id="6003561">header</span><span class="op" id="6003567">[</span><span class="num" id="6003568">148</span><span class="op" id="6003571">:</span><span class="num" id="6003572">156</span><span class="op" id="6003575">]</span><span class="op" id="6003576">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6003579">unsigned</span><span class="op" id="6003587">,</span>&nbsp;<span class="ident" id="6003589">signed</span>&nbsp;<span class="op" id="6003596">:=</span>&nbsp;<span class="ident" id="6003599">checksum</span><span class="op" id="6003607">(</span><span class="ident" id="6003608">header</span><span class="op" id="6003614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6003617">return</span>&nbsp;<span class="ident" id="6003624">given</span>&nbsp;<span class="op" id="6003630">==</span>&nbsp;<span class="ident" id="6003633">unsigned</span>&nbsp;<span class="op" id="6003642">||</span>&nbsp;<span class="ident" id="6003645">given</span>&nbsp;<span class="op" id="6003651">==</span>&nbsp;<span class="ident" id="6003654">signed</span><br>
<span class="lineno"></span><span class="op" id="6003661">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6003664">func</span>&nbsp;<span class="op" id="6003669">(</span><span class="ident" id="6003670">tr</span>&nbsp;<span class="op" id="6003673">*</span><span class="ident" id="6003674">Reader</span><span class="op" id="6003680">)</span>&nbsp;<span class="ident" id="6003682">readHeader</span><span class="op" id="6003692">(</span><span class="op" id="6003693">)</span>&nbsp;<span class="op" id="6003695">*</span><span class="ident" id="6003696">Header</span>&nbsp;<span class="op" id="6003703">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6003706">header</span>&nbsp;<span class="op" id="6003713">:=</span>&nbsp;<span class="ident" id="6003716">tr</span><span class="op" id="6003718">.</span><span class="ident" id="6003719">hdrBuff</span><span class="op" id="6003726">[</span><span class="op" id="6003727">:</span><span class="op" id="6003728">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6003731">copy</span><span class="op" id="6003735">(</span><span class="ident" id="6003736">header</span><span class="op" id="6003742">,</span>&nbsp;<span class="ident" id="6003744">zeroBlock</span><span class="op" id="6003753">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6003757">if</span>&nbsp;<span class="ident" id="6003760">_</span><span class="op" id="6003761">,</span>&nbsp;<span class="ident" id="6003763">tr</span><span class="op" id="6003765">.</span><span class="ident" id="6003766">err</span>&nbsp;<span class="op" id="6003770">=</span>&nbsp;<span class="ident" id="6003772">io</span><span class="op" id="6003774">.</span><span class="ident" id="6003775">ReadFull</span><span class="op" id="6003783">(</span><span class="ident" id="6003784">tr</span><span class="op" id="6003786">.</span><span class="ident" id="6003787">r</span><span class="op" id="6003788">,</span>&nbsp;<span class="ident" id="6003790">header</span><span class="op" id="6003796">)</span><span class="op" id="6003797">;</span>&nbsp;<span class="ident" id="6003799">tr</span><span class="op" id="6003801">.</span><span class="ident" id="6003802">err</span>&nbsp;<span class="op" id="6003806">!=</span>&nbsp;<span class="ident" id="6003809">nil</span>&nbsp;<span class="op" id="6003813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6003817">return</span>&nbsp;<span class="ident" id="6003824">nil</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6003829">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6003833">//&nbsp;Two&nbsp;blocks&nbsp;of&nbsp;zero&nbsp;bytes&nbsp;marks&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6003892">if</span>&nbsp;<span class="ident" id="6003895">bytes</span><span class="op" id="6003900">.</span><span class="ident" id="6003901">Equal</span><span class="op" id="6003906">(</span><span class="ident" id="6003907">header</span><span class="op" id="6003913">,</span>&nbsp;<span class="ident" id="6003915">zeroBlock</span><span class="op" id="6003924">[</span><span class="num" id="6003925">0</span><span class="op" id="6003926">:</span><span class="ident" id="6003927">blockSize</span><span class="op" id="6003936">]</span><span class="op" id="6003937">)</span>&nbsp;<span class="op" id="6003939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6003943">if</span>&nbsp;<span class="ident" id="6003946">_</span><span class="op" id="6003947">,</span>&nbsp;<span class="ident" id="6003949">tr</span><span class="op" id="6003951">.</span><span class="ident" id="6003952">err</span>&nbsp;<span class="op" id="6003956">=</span>&nbsp;<span class="ident" id="6003958">io</span><span class="op" id="6003960">.</span><span class="ident" id="6003961">ReadFull</span><span class="op" id="6003969">(</span><span class="ident" id="6003970">tr</span><span class="op" id="6003972">.</span><span class="ident" id="6003973">r</span><span class="op" id="6003974">,</span>&nbsp;<span class="ident" id="6003976">header</span><span class="op" id="6003982">)</span><span class="op" id="6003983">;</span>&nbsp;<span class="ident" id="6003985">tr</span><span class="op" id="6003987">.</span><span class="ident" id="6003988">err</span>&nbsp;<span class="op" id="6003992">!=</span>&nbsp;<span class="ident" id="6003995">nil</span>&nbsp;<span class="op" id="6003999">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6004004">return</span>&nbsp;<span class="ident" id="6004011">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6004017">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6004021">if</span>&nbsp;<span class="ident" id="6004024">bytes</span><span class="op" id="6004029">.</span><span class="ident" id="6004030">Equal</span><span class="op" id="6004035">(</span><span class="ident" id="6004036">header</span><span class="op" id="6004042">,</span>&nbsp;<span class="ident" id="6004044">zeroBlock</span><span class="op" id="6004053">[</span><span class="num" id="6004054">0</span><span class="op" id="6004055">:</span><span class="ident" id="6004056">blockSize</span><span class="op" id="6004065">]</span><span class="op" id="6004066">)</span>&nbsp;<span class="op" id="6004068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6004073">tr</span><span class="op" id="6004075">.</span><span class="ident" id="6004076">err</span>&nbsp;<span class="op" id="6004080">=</span>&nbsp;<span class="ident" id="6004082">io</span><span class="op" id="6004084">.</span><span class="ident" id="6004085">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6004091">}</span>&nbsp;<span class="keyword" id="6004093">else</span>&nbsp;<span class="op" id="6004098">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6004103">tr</span><span class="op" id="6004105">.</span><span class="ident" id="6004106">err</span>&nbsp;<span class="op" id="6004110">=</span>&nbsp;<span class="ident" id="6004112">ErrHeader</span>&nbsp;<span class="comment" id="6004122">//&nbsp;zero&nbsp;block&nbsp;and&nbsp;then&nbsp;non-zero&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6004162">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6004166">return</span>&nbsp;<span class="ident" id="6004173">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6004178">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6004182">if</span>&nbsp;<span class="op" id="6004185">!</span><span class="ident" id="6004186">tr</span><span class="op" id="6004188">.</span><span class="ident" id="6004189">verifyChecksum</span><span class="op" id="6004203">(</span><span class="ident" id="6004204">header</span><span class="op" id="6004210">)</span>&nbsp;<span class="op" id="6004212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6004216">tr</span><span class="op" id="6004218">.</span><span class="ident" id="6004219">err</span>&nbsp;<span class="op" id="6004223">=</span>&nbsp;<span class="ident" id="6004225">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6004237">return</span>&nbsp;<span class="ident" id="6004244">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6004249">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6004253">//&nbsp;Unpack</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6004264">hdr</span>&nbsp;<span class="op" id="6004268">:=</span>&nbsp;<span class="builtinfunc" id="6004271">new</span><span class="op" id="6004274">(</span><span class="ident" id="6004275">Header</span><span class="op" id="6004281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6004284">s</span>&nbsp;<span class="op" id="6004286">:=</span>&nbsp;<span class="ident" id="6004289">slicer</span><span class="op" id="6004295">(</span><span class="ident" id="6004296">header</span><span class="op" id="6004302">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6004306">hdr</span><span class="op" id="6004309">.</span><span class="ident" id="6004310">Name</span>&nbsp;<span class="op" id="6004315">=</span>&nbsp;<span class="ident" id="6004317">cString</span><span class="op" id="6004324">(</span><span class="ident" id="6004325">s</span><span class="op" id="6004326">.</span><span class="ident" id="6004327">next</span><span class="op" id="6004331">(</span><span class="num" id="6004332">100</span><span class="op" id="6004335">)</span><span class="op" id="6004336">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6004339">hdr</span><span class="op" id="6004342">.</span><span class="ident" id="6004343">Mode</span>&nbsp;<span class="op" id="6004348">=</span>&nbsp;<span class="ident" id="6004350">tr</span><span class="op" id="6004352">.</span><span class="ident" id="6004353">octal</span><span class="op" id="6004358">(</span><span class="ident" id="6004359">s</span><span class="op" id="6004360">.</span><span class="ident" id="6004361">next</span><span class="op" id="6004365">(</span><span class="num" id="6004366">8</span><span class="op" id="6004367">)</span><span class="op" id="6004368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6004371">hdr</span><span class="op" id="6004374">.</span><span class="ident" id="6004375">Uid</span>&nbsp;<span class="op" id="6004379">=</span>&nbsp;<span class="builtintype" id="6004381">int</span><span class="op" id="6004384">(</span><span class="ident" id="6004385">tr</span><span class="op" id="6004387">.</span><span class="ident" id="6004388">octal</span><span class="op" id="6004393">(</span><span class="ident" id="6004394">s</span><span class="op" id="6004395">.</span><span class="ident" id="6004396">next</span><span class="op" id="6004400">(</span><span class="num" id="6004401">8</span><span class="op" id="6004402">)</span><span class="op" id="6004403">)</span><span class="op" id="6004404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6004407">hdr</span><span class="op" id="6004410">.</span><span class="ident" id="6004411">Gid</span>&nbsp;<span class="op" id="6004415">=</span>&nbsp;<span class="builtintype" id="6004417">int</span><span class="op" id="6004420">(</span><span class="ident" id="6004421">tr</span><span class="op" id="6004423">.</span><span class="ident" id="6004424">octal</span><span class="op" id="6004429">(</span><span class="ident" id="6004430">s</span><span class="op" id="6004431">.</span><span class="ident" id="6004432">next</span><span class="op" id="6004436">(</span><span class="num" id="6004437">8</span><span class="op" id="6004438">)</span><span class="op" id="6004439">)</span><span class="op" id="6004440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6004443">hdr</span><span class="op" id="6004446">.</span><span class="ident" id="6004447">Size</span>&nbsp;<span class="op" id="6004452">=</span>&nbsp;<span class="ident" id="6004454">tr</span><span class="op" id="6004456">.</span><span class="ident" id="6004457">octal</span><span class="op" id="6004462">(</span><span class="ident" id="6004463">s</span><span class="op" id="6004464">.</span><span class="ident" id="6004465">next</span><span class="op" id="6004469">(</span><span class="num" id="6004470">12</span><span class="op" id="6004472">)</span><span class="op" id="6004473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6004476">hdr</span><span class="op" id="6004479">.</span><span class="ident" id="6004480">ModTime</span>&nbsp;<span class="op" id="6004488">=</span>&nbsp;<span class="ident" id="6004490">time</span><span class="op" id="6004494">.</span><span class="ident" id="6004495">Unix</span><span class="op" id="6004499">(</span><span class="ident" id="6004500">tr</span><span class="op" id="6004502">.</span><span class="ident" id="6004503">octal</span><span class="op" id="6004508">(</span><span class="ident" id="6004509">s</span><span class="op" id="6004510">.</span><span class="ident" id="6004511">next</span><span class="op" id="6004515">(</span><span class="num" id="6004516">12</span><span class="op" id="6004518">)</span><span class="op" id="6004519">)</span><span class="op" id="6004520">,</span>&nbsp;<span class="num" id="6004522">0</span><span class="op" id="6004523">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6004526">s</span><span class="op" id="6004527">.</span><span class="ident" id="6004528">next</span><span class="op" id="6004532">(</span><span class="num" id="6004533">8</span><span class="op" id="6004534">)</span>&nbsp;<span class="comment" id="6004536">//&nbsp;chksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6004547">hdr</span><span class="op" id="6004550">.</span><span class="ident" id="6004551">Typeflag</span>&nbsp;<span class="op" id="6004560">=</span>&nbsp;<span class="ident" id="6004562">s</span><span class="op" id="6004563">.</span><span class="ident" id="6004564">next</span><span class="op" id="6004568">(</span><span class="num" id="6004569">1</span><span class="op" id="6004570">)</span><span class="op" id="6004571">[</span><span class="num" id="6004572">0</span><span class="op" id="6004573">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6004576">hdr</span><span class="op" id="6004579">.</span><span class="ident" id="6004580">Linkname</span>&nbsp;<span class="op" id="6004589">=</span>&nbsp;<span class="ident" id="6004591">cString</span><span class="op" id="6004598">(</span><span class="ident" id="6004599">s</span><span class="op" id="6004600">.</span><span class="ident" id="6004601">next</span><span class="op" id="6004605">(</span><span class="num" id="6004606">100</span><span class="op" id="6004609">)</span><span class="op" id="6004610">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6004614">//&nbsp;The&nbsp;remainder&nbsp;of&nbsp;the&nbsp;header&nbsp;depends&nbsp;on&nbsp;the&nbsp;value&nbsp;of&nbsp;magic.</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6004677">//&nbsp;The&nbsp;original&nbsp;(v7)&nbsp;version&nbsp;of&nbsp;tar&nbsp;had&nbsp;no&nbsp;explicit&nbsp;magic&nbsp;field,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6004743">//&nbsp;so&nbsp;its&nbsp;magic&nbsp;bytes,&nbsp;like&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;block,&nbsp;are&nbsp;NULs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6004805">magic</span>&nbsp;<span class="op" id="6004811">:=</span>&nbsp;<span class="builtintype" id="6004814">string</span><span class="op" id="6004820">(</span><span class="ident" id="6004821">s</span><span class="op" id="6004822">.</span><span class="ident" id="6004823">next</span><span class="op" id="6004827">(</span><span class="num" id="6004828">8</span><span class="op" id="6004829">)</span><span class="op" id="6004830">)</span>&nbsp;<span class="comment" id="6004832">//&nbsp;contains&nbsp;version&nbsp;field&nbsp;as&nbsp;well.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6004868">var</span>&nbsp;<span class="ident" id="6004872">format</span>&nbsp;<span class="builtintype" id="6004879">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6004887">switch</span>&nbsp;<span class="op" id="6004894">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6004897">case</span>&nbsp;<span class="ident" id="6004902">magic</span><span class="op" id="6004907">[</span><span class="op" id="6004908">:</span><span class="num" id="6004909">6</span><span class="op" id="6004910">]</span>&nbsp;<span class="op" id="6004912">==</span>&nbsp;<span class="string" id="6004915">&#34;ustar\x00&#34;</span><span class="op" id="6004926">:</span>&nbsp;<span class="comment" id="6004928">//&nbsp;POSIX&nbsp;tar&nbsp;(1003.1-1988)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6004957">if</span>&nbsp;<span class="builtintype" id="6004960">string</span><span class="op" id="6004966">(</span><span class="ident" id="6004967">header</span><span class="op" id="6004973">[</span><span class="num" id="6004974">508</span><span class="op" id="6004977">:</span><span class="num" id="6004978">512</span><span class="op" id="6004981">]</span><span class="op" id="6004982">)</span>&nbsp;<span class="op" id="6004984">==</span>&nbsp;<span class="string" id="6004987">&#34;tar\x00&#34;</span>&nbsp;<span class="op" id="6004997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005002">format</span>&nbsp;<span class="op" id="6005009">=</span>&nbsp;<span class="string" id="6005011">&#34;star&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6005020">}</span>&nbsp;<span class="keyword" id="6005022">else</span>&nbsp;<span class="op" id="6005027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005032">format</span>&nbsp;<span class="op" id="6005039">=</span>&nbsp;<span class="string" id="6005041">&#34;posix&#34;</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6005051">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6005054">case</span>&nbsp;<span class="ident" id="6005059">magic</span>&nbsp;<span class="op" id="6005065">==</span>&nbsp;<span class="string" id="6005068">&#34;ustar&nbsp;&nbsp;\x00&#34;</span><span class="op" id="6005081">:</span>&nbsp;<span class="comment" id="6005083">//&nbsp;old&nbsp;GNU&nbsp;tar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005100">format</span>&nbsp;<span class="op" id="6005107">=</span>&nbsp;<span class="string" id="6005109">&#34;gnu&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6005116">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6005120">switch</span>&nbsp;<span class="ident" id="6005127">format</span>&nbsp;<span class="op" id="6005134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6005137">case</span>&nbsp;<span class="string" id="6005142">&#34;posix&#34;</span><span class="op" id="6005149">,</span>&nbsp;<span class="string" id="6005151">&#34;gnu&#34;</span><span class="op" id="6005156">,</span>&nbsp;<span class="string" id="6005158">&#34;star&#34;</span><span class="op" id="6005164">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005168">hdr</span><span class="op" id="6005171">.</span><span class="ident" id="6005172">Uname</span>&nbsp;<span class="op" id="6005178">=</span>&nbsp;<span class="ident" id="6005180">cString</span><span class="op" id="6005187">(</span><span class="ident" id="6005188">s</span><span class="op" id="6005189">.</span><span class="ident" id="6005190">next</span><span class="op" id="6005194">(</span><span class="num" id="6005195">32</span><span class="op" id="6005197">)</span><span class="op" id="6005198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005202">hdr</span><span class="op" id="6005205">.</span><span class="ident" id="6005206">Gname</span>&nbsp;<span class="op" id="6005212">=</span>&nbsp;<span class="ident" id="6005214">cString</span><span class="op" id="6005221">(</span><span class="ident" id="6005222">s</span><span class="op" id="6005223">.</span><span class="ident" id="6005224">next</span><span class="op" id="6005228">(</span><span class="num" id="6005229">32</span><span class="op" id="6005231">)</span><span class="op" id="6005232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005236">devmajor</span>&nbsp;<span class="op" id="6005245">:=</span>&nbsp;<span class="ident" id="6005248">s</span><span class="op" id="6005249">.</span><span class="ident" id="6005250">next</span><span class="op" id="6005254">(</span><span class="num" id="6005255">8</span><span class="op" id="6005256">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005260">devminor</span>&nbsp;<span class="op" id="6005269">:=</span>&nbsp;<span class="ident" id="6005272">s</span><span class="op" id="6005273">.</span><span class="ident" id="6005274">next</span><span class="op" id="6005278">(</span><span class="num" id="6005279">8</span><span class="op" id="6005280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6005284">if</span>&nbsp;<span class="ident" id="6005287">hdr</span><span class="op" id="6005290">.</span><span class="ident" id="6005291">Typeflag</span>&nbsp;<span class="op" id="6005300">==</span>&nbsp;<span class="ident" id="6005303">TypeChar</span>&nbsp;<span class="op" id="6005312">||</span>&nbsp;<span class="ident" id="6005315">hdr</span><span class="op" id="6005318">.</span><span class="ident" id="6005319">Typeflag</span>&nbsp;<span class="op" id="6005328">==</span>&nbsp;<span class="ident" id="6005331">TypeBlock</span>&nbsp;<span class="op" id="6005341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005346">hdr</span><span class="op" id="6005349">.</span><span class="ident" id="6005350">Devmajor</span>&nbsp;<span class="op" id="6005359">=</span>&nbsp;<span class="ident" id="6005361">tr</span><span class="op" id="6005363">.</span><span class="ident" id="6005364">octal</span><span class="op" id="6005369">(</span><span class="ident" id="6005370">devmajor</span><span class="op" id="6005378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005383">hdr</span><span class="op" id="6005386">.</span><span class="ident" id="6005387">Devminor</span>&nbsp;<span class="op" id="6005396">=</span>&nbsp;<span class="ident" id="6005398">tr</span><span class="op" id="6005400">.</span><span class="ident" id="6005401">octal</span><span class="op" id="6005406">(</span><span class="ident" id="6005407">devminor</span><span class="op" id="6005415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6005419">}</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6005423">var</span>&nbsp;<span class="ident" id="6005427">prefix</span>&nbsp;<span class="builtintype" id="6005434">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6005443">switch</span>&nbsp;<span class="ident" id="6005450">format</span>&nbsp;<span class="op" id="6005457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6005461">case</span>&nbsp;<span class="string" id="6005466">&#34;posix&#34;</span><span class="op" id="6005473">,</span>&nbsp;<span class="string" id="6005475">&#34;gnu&#34;</span><span class="op" id="6005480">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005485">prefix</span>&nbsp;<span class="op" id="6005492">=</span>&nbsp;<span class="ident" id="6005494">cString</span><span class="op" id="6005501">(</span><span class="ident" id="6005502">s</span><span class="op" id="6005503">.</span><span class="ident" id="6005504">next</span><span class="op" id="6005508">(</span><span class="num" id="6005509">155</span><span class="op" id="6005512">)</span><span class="op" id="6005513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6005517">case</span>&nbsp;<span class="string" id="6005522">&#34;star&#34;</span><span class="op" id="6005528">:</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005533">prefix</span>&nbsp;<span class="op" id="6005540">=</span>&nbsp;<span class="ident" id="6005542">cString</span><span class="op" id="6005549">(</span><span class="ident" id="6005550">s</span><span class="op" id="6005551">.</span><span class="ident" id="6005552">next</span><span class="op" id="6005556">(</span><span class="num" id="6005557">131</span><span class="op" id="6005560">)</span><span class="op" id="6005561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005566">hdr</span><span class="op" id="6005569">.</span><span class="ident" id="6005570">AccessTime</span>&nbsp;<span class="op" id="6005581">=</span>&nbsp;<span class="ident" id="6005583">time</span><span class="op" id="6005587">.</span><span class="ident" id="6005588">Unix</span><span class="op" id="6005592">(</span><span class="ident" id="6005593">tr</span><span class="op" id="6005595">.</span><span class="ident" id="6005596">octal</span><span class="op" id="6005601">(</span><span class="ident" id="6005602">s</span><span class="op" id="6005603">.</span><span class="ident" id="6005604">next</span><span class="op" id="6005608">(</span><span class="num" id="6005609">12</span><span class="op" id="6005611">)</span><span class="op" id="6005612">)</span><span class="op" id="6005613">,</span>&nbsp;<span class="num" id="6005615">0</span><span class="op" id="6005616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005621">hdr</span><span class="op" id="6005624">.</span><span class="ident" id="6005625">ChangeTime</span>&nbsp;<span class="op" id="6005636">=</span>&nbsp;<span class="ident" id="6005638">time</span><span class="op" id="6005642">.</span><span class="ident" id="6005643">Unix</span><span class="op" id="6005647">(</span><span class="ident" id="6005648">tr</span><span class="op" id="6005650">.</span><span class="ident" id="6005651">octal</span><span class="op" id="6005656">(</span><span class="ident" id="6005657">s</span><span class="op" id="6005658">.</span><span class="ident" id="6005659">next</span><span class="op" id="6005663">(</span><span class="num" id="6005664">12</span><span class="op" id="6005666">)</span><span class="op" id="6005667">)</span><span class="op" id="6005668">,</span>&nbsp;<span class="num" id="6005670">0</span><span class="op" id="6005671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6005675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6005679">if</span>&nbsp;<span class="builtinfunc" id="6005682">len</span><span class="op" id="6005685">(</span><span class="ident" id="6005686">prefix</span><span class="op" id="6005692">)</span>&nbsp;<span class="op" id="6005694">&gt;</span>&nbsp;<span class="num" id="6005696">0</span>&nbsp;<span class="op" id="6005698">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005703">hdr</span><span class="op" id="6005706">.</span><span class="ident" id="6005707">Name</span>&nbsp;<span class="op" id="6005712">=</span>&nbsp;<span class="ident" id="6005714">prefix</span>&nbsp;<span class="op" id="6005721">+</span>&nbsp;<span class="string" id="6005723">&#34;/&#34;</span>&nbsp;<span class="op" id="6005727">+</span>&nbsp;<span class="ident" id="6005729">hdr</span><span class="op" id="6005732">.</span><span class="ident" id="6005733">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6005740">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6005743">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6005747">if</span>&nbsp;<span class="ident" id="6005750">tr</span><span class="op" id="6005752">.</span><span class="ident" id="6005753">err</span>&nbsp;<span class="op" id="6005757">!=</span>&nbsp;<span class="ident" id="6005760">nil</span>&nbsp;<span class="op" id="6005764">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005768">tr</span><span class="op" id="6005770">.</span><span class="ident" id="6005771">err</span>&nbsp;<span class="op" id="6005775">=</span>&nbsp;<span class="ident" id="6005777">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6005789">return</span>&nbsp;<span class="ident" id="6005796">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6005801">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6005805">//&nbsp;Maximum&nbsp;value&nbsp;of&nbsp;hdr.Size&nbsp;is&nbsp;64&nbsp;GB&nbsp;(12&nbsp;octal&nbsp;digits),</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6005863">//&nbsp;so&nbsp;there&#39;s&nbsp;no&nbsp;risk&nbsp;of&nbsp;int64&nbsp;overflowing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005908">nb</span>&nbsp;<span class="op" id="6005911">:=</span>&nbsp;<span class="ident" id="6005914">int64</span><span class="op" id="6005919">(</span><span class="ident" id="6005920">hdr</span><span class="op" id="6005923">.</span><span class="ident" id="6005924">Size</span><span class="op" id="6005928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005931">tr</span><span class="op" id="6005933">.</span><span class="ident" id="6005934">pad</span>&nbsp;<span class="op" id="6005938">=</span>&nbsp;<span class="op" id="6005940">-</span><span class="ident" id="6005941">nb</span>&nbsp;<span class="op" id="6005944">&amp;</span>&nbsp;<span class="op" id="6005946">(</span><span class="ident" id="6005947">blockSize</span>&nbsp;<span class="op" id="6005957">-</span>&nbsp;<span class="num" id="6005959">1</span><span class="op" id="6005960">)</span>&nbsp;<span class="comment" id="6005962">//&nbsp;blockSize&nbsp;is&nbsp;a&nbsp;power&nbsp;of&nbsp;two</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6005995">//&nbsp;Set&nbsp;the&nbsp;current&nbsp;file&nbsp;reader.</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6006028">tr</span><span class="op" id="6006030">.</span><span class="ident" id="6006031">curr</span>&nbsp;<span class="op" id="6006036">=</span>&nbsp;<span class="op" id="6006038">&amp;</span><span class="ident" id="6006039">regFileReader</span><span class="op" id="6006052">{</span><span class="ident" id="6006053">r</span><span class="op" id="6006054">:</span>&nbsp;<span class="ident" id="6006056">tr</span><span class="op" id="6006058">.</span><span class="ident" id="6006059">r</span><span class="op" id="6006060">,</span>&nbsp;<span class="ident" id="6006062">nb</span><span class="op" id="6006064">:</span>&nbsp;<span class="ident" id="6006066">nb</span><span class="op" id="6006068">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6006072">//&nbsp;Check&nbsp;for&nbsp;old&nbsp;GNU&nbsp;sparse&nbsp;format&nbsp;entry.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6006115">if</span>&nbsp;<span class="ident" id="6006118">hdr</span><span class="op" id="6006121">.</span><span class="ident" id="6006122">Typeflag</span>&nbsp;<span class="op" id="6006131">==</span>&nbsp;<span class="ident" id="6006134">TypeGNUSparse</span>&nbsp;<span class="op" id="6006148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6006152">//&nbsp;Get&nbsp;the&nbsp;real&nbsp;size&nbsp;of&nbsp;the&nbsp;file.</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6006188">hdr</span><span class="op" id="6006191">.</span><span class="ident" id="6006192">Size</span>&nbsp;<span class="op" id="6006197">=</span>&nbsp;<span class="ident" id="6006199">tr</span><span class="op" id="6006201">.</span><span class="ident" id="6006202">octal</span><span class="op" id="6006207">(</span><span class="ident" id="6006208">header</span><span class="op" id="6006214">[</span><span class="num" id="6006215">483</span><span class="op" id="6006218">:</span><span class="num" id="6006219">495</span><span class="op" id="6006222">]</span><span class="op" id="6006223">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6006228">//&nbsp;Read&nbsp;the&nbsp;sparse&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6006254">sp</span>&nbsp;<span class="op" id="6006257">:=</span>&nbsp;<span class="ident" id="6006260">tr</span><span class="op" id="6006262">.</span><span class="ident" id="6006263">readOldGNUSparseMap</span><span class="op" id="6006282">(</span><span class="ident" id="6006283">header</span><span class="op" id="6006289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6006293">if</span>&nbsp;<span class="ident" id="6006296">tr</span><span class="op" id="6006298">.</span><span class="ident" id="6006299">err</span>&nbsp;<span class="op" id="6006303">!=</span>&nbsp;<span class="ident" id="6006306">nil</span>&nbsp;<span class="op" id="6006310">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6006315">return</span>&nbsp;<span class="ident" id="6006322">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6006328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6006332">//&nbsp;Current&nbsp;file&nbsp;is&nbsp;a&nbsp;GNU&nbsp;sparse&nbsp;file.&nbsp;Update&nbsp;the&nbsp;current&nbsp;file&nbsp;reader.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6006404">tr</span><span class="op" id="6006406">.</span><span class="ident" id="6006407">curr</span>&nbsp;<span class="op" id="6006412">=</span>&nbsp;<span class="op" id="6006414">&amp;</span><span class="ident" id="6006415">sparseFileReader</span><span class="op" id="6006431">{</span><span class="ident" id="6006432">rfr</span><span class="op" id="6006435">:</span>&nbsp;<span class="ident" id="6006437">tr</span><span class="op" id="6006439">.</span><span class="ident" id="6006440">curr</span><span class="op" id="6006444">.</span><span class="op" id="6006445">(</span><span class="op" id="6006446">*</span><span class="ident" id="6006447">regFileReader</span><span class="op" id="6006460">)</span><span class="op" id="6006461">,</span>&nbsp;<span class="ident" id="6006463">sp</span><span class="op" id="6006465">:</span>&nbsp;<span class="ident" id="6006467">sp</span><span class="op" id="6006469">,</span>&nbsp;<span class="ident" id="6006471">tot</span><span class="op" id="6006474">:</span>&nbsp;<span class="ident" id="6006476">hdr</span><span class="op" id="6006479">.</span><span class="ident" id="6006480">Size</span><span class="op" id="6006484">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6006487">}</span><br>
<span class="lineno">535</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6006491">return</span>&nbsp;<span class="ident" id="6006498">hdr</span><br>
<span class="lineno"></span><span class="op" id="6006502">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6006505">//&nbsp;A&nbsp;sparseEntry&nbsp;holds&nbsp;a&nbsp;single&nbsp;entry&nbsp;in&nbsp;a&nbsp;sparse&nbsp;file&#39;s&nbsp;sparse&nbsp;map.</span><br>
<span class="lineno">540</span><span class="comment" id="6006574">//&nbsp;A&nbsp;sparse&nbsp;entry&nbsp;indicates&nbsp;the&nbsp;offset&nbsp;and&nbsp;size&nbsp;in&nbsp;a&nbsp;sparse&nbsp;file&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="6006644">//&nbsp;block&nbsp;of&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="6006662">type</span>&nbsp;<span class="ident" id="6006667">sparseEntry</span>&nbsp;<span class="keyword" id="6006679">struct</span>&nbsp;<span class="op" id="6006686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6006689">offset</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6006698">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6006705">numBytes</span>&nbsp;<span class="ident" id="6006714">int64</span><br>
<span class="lineno">545</span><span class="op" id="6006720">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6006723">//&nbsp;readOldGNUSparseMap&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;map&nbsp;as&nbsp;stored&nbsp;in&nbsp;the&nbsp;old&nbsp;GNU&nbsp;sparse&nbsp;format.</span><br>
<span class="lineno"></span><span class="comment" id="6006807">//&nbsp;The&nbsp;sparse&nbsp;map&nbsp;is&nbsp;stored&nbsp;in&nbsp;the&nbsp;tar&nbsp;header&nbsp;if&nbsp;it&#39;s&nbsp;small&nbsp;enough.&nbsp;If&nbsp;it&#39;s&nbsp;larger&nbsp;than&nbsp;four&nbsp;entries,</span><br>
<span class="lineno"></span><span class="comment" id="6006909">//&nbsp;then&nbsp;one&nbsp;or&nbsp;more&nbsp;extension&nbsp;headers&nbsp;are&nbsp;used&nbsp;to&nbsp;store&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;sparse&nbsp;map.</span><br>
<span class="lineno">550</span><span class="keyword" id="6006993">func</span>&nbsp;<span class="op" id="6006998">(</span><span class="ident" id="6006999">tr</span>&nbsp;<span class="op" id="6007002">*</span><span class="ident" id="6007003">Reader</span><span class="op" id="6007009">)</span>&nbsp;<span class="ident" id="6007011">readOldGNUSparseMap</span><span class="op" id="6007030">(</span><span class="ident" id="6007031">header</span>&nbsp;<span class="op" id="6007038">[</span><span class="op" id="6007039">]</span><span class="builtintype" id="6007040">byte</span><span class="op" id="6007044">)</span>&nbsp;<span class="op" id="6007046">[</span><span class="op" id="6007047">]</span><span class="ident" id="6007048">sparseEntry</span>&nbsp;<span class="op" id="6007060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6007063">isExtended</span>&nbsp;<span class="op" id="6007074">:=</span>&nbsp;<span class="ident" id="6007077">header</span><span class="op" id="6007083">[</span><span class="ident" id="6007084">oldGNUSparseMainHeaderIsExtendedOffset</span><span class="op" id="6007122">]</span>&nbsp;<span class="op" id="6007124">!=</span>&nbsp;<span class="num" id="6007127">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6007130">spCap</span>&nbsp;<span class="op" id="6007136">:=</span>&nbsp;<span class="ident" id="6007139">oldGNUSparseMainHeaderNumEntries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6007173">if</span>&nbsp;<span class="ident" id="6007176">isExtended</span>&nbsp;<span class="op" id="6007187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6007191">spCap</span>&nbsp;<span class="op" id="6007197">+=</span>&nbsp;<span class="ident" id="6007200">oldGNUSparseExtendedHeaderNumEntries</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6007238">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6007241">sp</span>&nbsp;<span class="op" id="6007244">:=</span>&nbsp;<span class="builtinfunc" id="6007247">make</span><span class="op" id="6007251">(</span><span class="op" id="6007252">[</span><span class="op" id="6007253">]</span><span class="ident" id="6007254">sparseEntry</span><span class="op" id="6007265">,</span>&nbsp;<span class="num" id="6007267">0</span><span class="op" id="6007268">,</span>&nbsp;<span class="ident" id="6007270">spCap</span><span class="op" id="6007275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6007278">s</span>&nbsp;<span class="op" id="6007280">:=</span>&nbsp;<span class="ident" id="6007283">slicer</span><span class="op" id="6007289">(</span><span class="ident" id="6007290">header</span><span class="op" id="6007296">[</span><span class="ident" id="6007297">oldGNUSparseMainHeaderOffset</span><span class="op" id="6007325">:</span><span class="op" id="6007326">]</span><span class="op" id="6007327">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6007331">//&nbsp;Read&nbsp;the&nbsp;four&nbsp;entries&nbsp;from&nbsp;the&nbsp;main&nbsp;tar&nbsp;header</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6007382">for</span>&nbsp;<span class="ident" id="6007386">i</span>&nbsp;<span class="op" id="6007388">:=</span>&nbsp;<span class="num" id="6007391">0</span><span class="op" id="6007392">;</span>&nbsp;<span class="ident" id="6007394">i</span>&nbsp;<span class="op" id="6007396">&lt;</span>&nbsp;<span class="ident" id="6007398">oldGNUSparseMainHeaderNumEntries</span><span class="op" id="6007430">;</span>&nbsp;<span class="ident" id="6007432">i</span><span class="op" id="6007433">++</span>&nbsp;<span class="op" id="6007436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6007440">offset</span>&nbsp;<span class="op" id="6007447">:=</span>&nbsp;<span class="ident" id="6007450">tr</span><span class="op" id="6007452">.</span><span class="ident" id="6007453">octal</span><span class="op" id="6007458">(</span><span class="ident" id="6007459">s</span><span class="op" id="6007460">.</span><span class="ident" id="6007461">next</span><span class="op" id="6007465">(</span><span class="ident" id="6007466">oldGNUSparseOffsetSize</span><span class="op" id="6007488">)</span><span class="op" id="6007489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6007493">numBytes</span>&nbsp;<span class="op" id="6007502">:=</span>&nbsp;<span class="ident" id="6007505">tr</span><span class="op" id="6007507">.</span><span class="ident" id="6007508">octal</span><span class="op" id="6007513">(</span><span class="ident" id="6007514">s</span><span class="op" id="6007515">.</span><span class="ident" id="6007516">next</span><span class="op" id="6007520">(</span><span class="ident" id="6007521">oldGNUSparseNumBytesSize</span><span class="op" id="6007545">)</span><span class="op" id="6007546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6007550">if</span>&nbsp;<span class="ident" id="6007553">tr</span><span class="op" id="6007555">.</span><span class="ident" id="6007556">err</span>&nbsp;<span class="op" id="6007560">!=</span>&nbsp;<span class="ident" id="6007563">nil</span>&nbsp;<span class="op" id="6007567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6007572">tr</span><span class="op" id="6007574">.</span><span class="ident" id="6007575">err</span>&nbsp;<span class="op" id="6007579">=</span>&nbsp;<span class="ident" id="6007581">ErrHeader</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6007594">return</span>&nbsp;<span class="ident" id="6007601">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6007607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6007611">if</span>&nbsp;<span class="ident" id="6007614">offset</span>&nbsp;<span class="op" id="6007621">==</span>&nbsp;<span class="num" id="6007624">0</span>&nbsp;<span class="op" id="6007626">&amp;&amp;</span>&nbsp;<span class="ident" id="6007629">numBytes</span>&nbsp;<span class="op" id="6007638">==</span>&nbsp;<span class="num" id="6007641">0</span>&nbsp;<span class="op" id="6007643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6007648">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6007656">}</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6007660">sp</span>&nbsp;<span class="op" id="6007663">=</span>&nbsp;<span class="builtinfunc" id="6007665">append</span><span class="op" id="6007671">(</span><span class="ident" id="6007672">sp</span><span class="op" id="6007674">,</span>&nbsp;<span class="ident" id="6007676">sparseEntry</span><span class="op" id="6007687">{</span><span class="ident" id="6007688">offset</span><span class="op" id="6007694">:</span>&nbsp;<span class="ident" id="6007696">offset</span><span class="op" id="6007702">,</span>&nbsp;<span class="ident" id="6007704">numBytes</span><span class="op" id="6007712">:</span>&nbsp;<span class="ident" id="6007714">numBytes</span><span class="op" id="6007722">}</span><span class="op" id="6007723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6007726">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6007730">for</span>&nbsp;<span class="ident" id="6007734">isExtended</span>&nbsp;<span class="op" id="6007745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6007749">//&nbsp;There&nbsp;are&nbsp;more&nbsp;entries.&nbsp;Read&nbsp;an&nbsp;extension&nbsp;header&nbsp;and&nbsp;parse&nbsp;its&nbsp;entries.</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6007826">sparseHeader</span>&nbsp;<span class="op" id="6007839">:=</span>&nbsp;<span class="builtinfunc" id="6007842">make</span><span class="op" id="6007846">(</span><span class="op" id="6007847">[</span><span class="op" id="6007848">]</span><span class="builtintype" id="6007849">byte</span><span class="op" id="6007853">,</span>&nbsp;<span class="ident" id="6007855">blockSize</span><span class="op" id="6007864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6007868">if</span>&nbsp;<span class="ident" id="6007871">_</span><span class="op" id="6007872">,</span>&nbsp;<span class="ident" id="6007874">tr</span><span class="op" id="6007876">.</span><span class="ident" id="6007877">err</span>&nbsp;<span class="op" id="6007881">=</span>&nbsp;<span class="ident" id="6007883">io</span><span class="op" id="6007885">.</span><span class="ident" id="6007886">ReadFull</span><span class="op" id="6007894">(</span><span class="ident" id="6007895">tr</span><span class="op" id="6007897">.</span><span class="ident" id="6007898">r</span><span class="op" id="6007899">,</span>&nbsp;<span class="ident" id="6007901">sparseHeader</span><span class="op" id="6007913">)</span><span class="op" id="6007914">;</span>&nbsp;<span class="ident" id="6007916">tr</span><span class="op" id="6007918">.</span><span class="ident" id="6007919">err</span>&nbsp;<span class="op" id="6007923">!=</span>&nbsp;<span class="ident" id="6007926">nil</span>&nbsp;<span class="op" id="6007930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6007935">return</span>&nbsp;<span class="ident" id="6007942">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6007948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6007952">isExtended</span>&nbsp;<span class="op" id="6007963">=</span>&nbsp;<span class="ident" id="6007965">sparseHeader</span><span class="op" id="6007977">[</span><span class="ident" id="6007978">oldGNUSparseExtendedHeaderIsExtendedOffset</span><span class="op" id="6008020">]</span>&nbsp;<span class="op" id="6008022">!=</span>&nbsp;<span class="num" id="6008025">0</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6008029">s</span>&nbsp;<span class="op" id="6008031">=</span>&nbsp;<span class="ident" id="6008033">slicer</span><span class="op" id="6008039">(</span><span class="ident" id="6008040">sparseHeader</span><span class="op" id="6008052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6008056">for</span>&nbsp;<span class="ident" id="6008060">i</span>&nbsp;<span class="op" id="6008062">:=</span>&nbsp;<span class="num" id="6008065">0</span><span class="op" id="6008066">;</span>&nbsp;<span class="ident" id="6008068">i</span>&nbsp;<span class="op" id="6008070">&lt;</span>&nbsp;<span class="ident" id="6008072">oldGNUSparseExtendedHeaderNumEntries</span><span class="op" id="6008108">;</span>&nbsp;<span class="ident" id="6008110">i</span><span class="op" id="6008111">++</span>&nbsp;<span class="op" id="6008114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6008119">offset</span>&nbsp;<span class="op" id="6008126">:=</span>&nbsp;<span class="ident" id="6008129">tr</span><span class="op" id="6008131">.</span><span class="ident" id="6008132">octal</span><span class="op" id="6008137">(</span><span class="ident" id="6008138">s</span><span class="op" id="6008139">.</span><span class="ident" id="6008140">next</span><span class="op" id="6008144">(</span><span class="ident" id="6008145">oldGNUSparseOffsetSize</span><span class="op" id="6008167">)</span><span class="op" id="6008168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6008173">numBytes</span>&nbsp;<span class="op" id="6008182">:=</span>&nbsp;<span class="ident" id="6008185">tr</span><span class="op" id="6008187">.</span><span class="ident" id="6008188">octal</span><span class="op" id="6008193">(</span><span class="ident" id="6008194">s</span><span class="op" id="6008195">.</span><span class="ident" id="6008196">next</span><span class="op" id="6008200">(</span><span class="ident" id="6008201">oldGNUSparseNumBytesSize</span><span class="op" id="6008225">)</span><span class="op" id="6008226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6008231">if</span>&nbsp;<span class="ident" id="6008234">tr</span><span class="op" id="6008236">.</span><span class="ident" id="6008237">err</span>&nbsp;<span class="op" id="6008241">!=</span>&nbsp;<span class="ident" id="6008244">nil</span>&nbsp;<span class="op" id="6008248">{</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6008254">tr</span><span class="op" id="6008256">.</span><span class="ident" id="6008257">err</span>&nbsp;<span class="op" id="6008261">=</span>&nbsp;<span class="ident" id="6008263">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6008277">return</span>&nbsp;<span class="ident" id="6008284">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6008291">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6008296">if</span>&nbsp;<span class="ident" id="6008299">offset</span>&nbsp;<span class="op" id="6008306">==</span>&nbsp;<span class="num" id="6008309">0</span>&nbsp;<span class="op" id="6008311">&amp;&amp;</span>&nbsp;<span class="ident" id="6008314">numBytes</span>&nbsp;<span class="op" id="6008323">==</span>&nbsp;<span class="num" id="6008326">0</span>&nbsp;<span class="op" id="6008328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6008334">break</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6008343">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6008348">sp</span>&nbsp;<span class="op" id="6008351">=</span>&nbsp;<span class="builtinfunc" id="6008353">append</span><span class="op" id="6008359">(</span><span class="ident" id="6008360">sp</span><span class="op" id="6008362">,</span>&nbsp;<span class="ident" id="6008364">sparseEntry</span><span class="op" id="6008375">{</span><span class="ident" id="6008376">offset</span><span class="op" id="6008382">:</span>&nbsp;<span class="ident" id="6008384">offset</span><span class="op" id="6008390">,</span>&nbsp;<span class="ident" id="6008392">numBytes</span><span class="op" id="6008400">:</span>&nbsp;<span class="ident" id="6008402">numBytes</span><span class="op" id="6008410">}</span><span class="op" id="6008411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6008415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6008418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6008421">return</span>&nbsp;<span class="ident" id="6008428">sp</span><br>
<span class="lineno">595</span><span class="op" id="6008431">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6008434">//&nbsp;readGNUSparseMap1x0&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;map&nbsp;as&nbsp;stored&nbsp;in&nbsp;GNU&#39;s&nbsp;PAX&nbsp;sparse&nbsp;format&nbsp;version&nbsp;1.0.</span><br>
<span class="lineno"></span><span class="comment" id="6008528">//&nbsp;The&nbsp;sparse&nbsp;map&nbsp;is&nbsp;stored&nbsp;just&nbsp;before&nbsp;the&nbsp;file&nbsp;data&nbsp;and&nbsp;padded&nbsp;out&nbsp;to&nbsp;the&nbsp;nearest&nbsp;block&nbsp;boundary.</span><br>
<span class="lineno"></span><span class="keyword" id="6008628">func</span>&nbsp;<span class="ident" id="6008633">readGNUSparseMap1x0</span><span class="op" id="6008652">(</span><span class="ident" id="6008653">r</span>&nbsp;<span class="ident" id="6008655">io</span><span class="op" id="6008657">.</span><span class="ident" id="6008658">Reader</span><span class="op" id="6008664">)</span>&nbsp;<span class="op" id="6008666">(</span><span class="op" id="6008667">[</span><span class="op" id="6008668">]</span><span class="ident" id="6008669">sparseEntry</span><span class="op" id="6008680">,</span>&nbsp;<span class="builtintype" id="6008682">error</span><span class="op" id="6008687">)</span>&nbsp;<span class="op" id="6008689">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6008692">buf</span>&nbsp;<span class="op" id="6008696">:=</span>&nbsp;<span class="builtinfunc" id="6008699">make</span><span class="op" id="6008703">(</span><span class="op" id="6008704">[</span><span class="op" id="6008705">]</span><span class="builtintype" id="6008706">byte</span><span class="op" id="6008710">,</span>&nbsp;<span class="num" id="6008712">2</span><span class="op" id="6008713">*</span><span class="ident" id="6008714">blockSize</span><span class="op" id="6008723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6008726">sparseHeader</span>&nbsp;<span class="op" id="6008739">:=</span>&nbsp;<span class="ident" id="6008742">buf</span><span class="op" id="6008745">[</span><span class="op" id="6008746">:</span><span class="ident" id="6008747">blockSize</span><span class="op" id="6008756">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6008760">//&nbsp;readDecimal&nbsp;is&nbsp;a&nbsp;helper&nbsp;function&nbsp;to&nbsp;read&nbsp;a&nbsp;decimal&nbsp;integer&nbsp;from&nbsp;the&nbsp;sparse&nbsp;map</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6008843">//&nbsp;while&nbsp;making&nbsp;sure&nbsp;to&nbsp;read&nbsp;from&nbsp;the&nbsp;file&nbsp;in&nbsp;blocks&nbsp;of&nbsp;size&nbsp;blockSize</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6008915">readDecimal</span>&nbsp;<span class="op" id="6008927">:=</span>&nbsp;<span class="keyword" id="6008930">func</span><span class="op" id="6008934">(</span><span class="op" id="6008935">)</span>&nbsp;<span class="op" id="6008937">(</span><span class="ident" id="6008938">int64</span><span class="op" id="6008943">,</span>&nbsp;<span class="builtintype" id="6008945">error</span><span class="op" id="6008950">)</span>&nbsp;<span class="op" id="6008952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6008956">//&nbsp;Look&nbsp;for&nbsp;newline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6008978">nl</span>&nbsp;<span class="op" id="6008981">:=</span>&nbsp;<span class="ident" id="6008984">bytes</span><span class="op" id="6008989">.</span><span class="ident" id="6008990">IndexByte</span><span class="op" id="6008999">(</span><span class="ident" id="6009000">sparseHeader</span><span class="op" id="6009012">,</span>&nbsp;<span class="string" id="6009014">&#39;\n&#39;</span><span class="op" id="6009018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6009022">if</span>&nbsp;<span class="ident" id="6009025">nl</span>&nbsp;<span class="op" id="6009028">==</span>&nbsp;<span class="op" id="6009031">-</span><span class="num" id="6009032">1</span>&nbsp;<span class="op" id="6009034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6009039">if</span>&nbsp;<span class="builtinfunc" id="6009042">len</span><span class="op" id="6009045">(</span><span class="ident" id="6009046">sparseHeader</span><span class="op" id="6009058">)</span>&nbsp;<span class="op" id="6009060">&gt;=</span>&nbsp;<span class="ident" id="6009063">blockSize</span>&nbsp;<span class="op" id="6009073">{</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6009079">//&nbsp;This&nbsp;is&nbsp;an&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6009103">return</span>&nbsp;<span class="num" id="6009110">0</span><span class="op" id="6009111">,</span>&nbsp;<span class="ident" id="6009113">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6009126">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009131">oldLen</span>&nbsp;<span class="op" id="6009138">:=</span>&nbsp;<span class="builtinfunc" id="6009141">len</span><span class="op" id="6009144">(</span><span class="ident" id="6009145">sparseHeader</span><span class="op" id="6009157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009162">newLen</span>&nbsp;<span class="op" id="6009169">:=</span>&nbsp;<span class="ident" id="6009172">oldLen</span>&nbsp;<span class="op" id="6009179">+</span>&nbsp;<span class="ident" id="6009181">blockSize</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6009194">if</span>&nbsp;<span class="builtinfunc" id="6009197">cap</span><span class="op" id="6009200">(</span><span class="ident" id="6009201">sparseHeader</span><span class="op" id="6009213">)</span>&nbsp;<span class="op" id="6009215">&lt;</span>&nbsp;<span class="ident" id="6009217">newLen</span>&nbsp;<span class="op" id="6009224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6009230">//&nbsp;There&#39;s&nbsp;more&nbsp;header,&nbsp;but&nbsp;we&nbsp;need&nbsp;to&nbsp;make&nbsp;room&nbsp;for&nbsp;the&nbsp;next&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6009302">copy</span><span class="op" id="6009306">(</span><span class="ident" id="6009307">buf</span><span class="op" id="6009310">,</span>&nbsp;<span class="ident" id="6009312">sparseHeader</span><span class="op" id="6009324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009330">sparseHeader</span>&nbsp;<span class="op" id="6009343">=</span>&nbsp;<span class="ident" id="6009345">buf</span><span class="op" id="6009348">[</span><span class="op" id="6009349">:</span><span class="ident" id="6009350">newLen</span><span class="op" id="6009356">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6009361">}</span>&nbsp;<span class="keyword" id="6009363">else</span>&nbsp;<span class="op" id="6009368">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6009374">//&nbsp;There&#39;s&nbsp;more&nbsp;header,&nbsp;and&nbsp;we&nbsp;can&nbsp;just&nbsp;reslice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009426">sparseHeader</span>&nbsp;<span class="op" id="6009439">=</span>&nbsp;<span class="ident" id="6009441">sparseHeader</span><span class="op" id="6009453">[</span><span class="op" id="6009454">:</span><span class="ident" id="6009455">newLen</span><span class="op" id="6009461">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6009466">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6009472">//&nbsp;Now&nbsp;that&nbsp;sparseHeader&nbsp;is&nbsp;large&nbsp;enough,&nbsp;read&nbsp;next&nbsp;block</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6009533">if</span>&nbsp;<span class="ident" id="6009536">_</span><span class="op" id="6009537">,</span>&nbsp;<span class="ident" id="6009539">err</span>&nbsp;<span class="op" id="6009543">:=</span>&nbsp;<span class="ident" id="6009546">io</span><span class="op" id="6009548">.</span><span class="ident" id="6009549">ReadFull</span><span class="op" id="6009557">(</span><span class="ident" id="6009558">r</span><span class="op" id="6009559">,</span>&nbsp;<span class="ident" id="6009561">sparseHeader</span><span class="op" id="6009573">[</span><span class="ident" id="6009574">oldLen</span><span class="op" id="6009580">:</span><span class="ident" id="6009581">newLen</span><span class="op" id="6009587">]</span><span class="op" id="6009588">)</span><span class="op" id="6009589">;</span>&nbsp;<span class="ident" id="6009591">err</span>&nbsp;<span class="op" id="6009595">!=</span>&nbsp;<span class="ident" id="6009598">nil</span>&nbsp;<span class="op" id="6009602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6009608">return</span>&nbsp;<span class="num" id="6009615">0</span><span class="op" id="6009616">,</span>&nbsp;<span class="ident" id="6009618">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6009625">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6009631">//&nbsp;Look&nbsp;for&nbsp;a&nbsp;newline&nbsp;in&nbsp;the&nbsp;new&nbsp;data</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009672">nl</span>&nbsp;<span class="op" id="6009675">=</span>&nbsp;<span class="ident" id="6009677">bytes</span><span class="op" id="6009682">.</span><span class="ident" id="6009683">IndexByte</span><span class="op" id="6009692">(</span><span class="ident" id="6009693">sparseHeader</span><span class="op" id="6009705">[</span><span class="ident" id="6009706">oldLen</span><span class="op" id="6009712">:</span><span class="ident" id="6009713">newLen</span><span class="op" id="6009719">]</span><span class="op" id="6009720">,</span>&nbsp;<span class="string" id="6009722">&#39;\n&#39;</span><span class="op" id="6009726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6009731">if</span>&nbsp;<span class="ident" id="6009734">nl</span>&nbsp;<span class="op" id="6009737">==</span>&nbsp;<span class="op" id="6009740">-</span><span class="num" id="6009741">1</span>&nbsp;<span class="op" id="6009743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6009749">//&nbsp;This&nbsp;is&nbsp;an&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6009773">return</span>&nbsp;<span class="num" id="6009780">0</span><span class="op" id="6009781">,</span>&nbsp;<span class="ident" id="6009783">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6009796">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009801">nl</span>&nbsp;<span class="op" id="6009804">+=</span>&nbsp;<span class="ident" id="6009807">oldLen</span>&nbsp;<span class="comment" id="6009814">//&nbsp;We&nbsp;want&nbsp;the&nbsp;position&nbsp;from&nbsp;the&nbsp;beginning</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6009859">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6009863">//&nbsp;Now&nbsp;that&nbsp;we&#39;ve&nbsp;found&nbsp;a&nbsp;newline,&nbsp;read&nbsp;a&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009914">n</span><span class="op" id="6009915">,</span>&nbsp;<span class="ident" id="6009917">err</span>&nbsp;<span class="op" id="6009921">:=</span>&nbsp;<span class="ident" id="6009924">strconv</span><span class="op" id="6009931">.</span><span class="ident" id="6009932">ParseInt</span><span class="op" id="6009940">(</span><span class="builtintype" id="6009941">string</span><span class="op" id="6009947">(</span><span class="ident" id="6009948">sparseHeader</span><span class="op" id="6009960">[</span><span class="op" id="6009961">:</span><span class="ident" id="6009962">nl</span><span class="op" id="6009964">]</span><span class="op" id="6009965">)</span><span class="op" id="6009966">,</span>&nbsp;<span class="num" id="6009968">10</span><span class="op" id="6009970">,</span>&nbsp;<span class="num" id="6009972">0</span><span class="op" id="6009973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6009977">if</span>&nbsp;<span class="ident" id="6009980">err</span>&nbsp;<span class="op" id="6009984">!=</span>&nbsp;<span class="ident" id="6009987">nil</span>&nbsp;<span class="op" id="6009991">{</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6009996">return</span>&nbsp;<span class="num" id="6010003">0</span><span class="op" id="6010004">,</span>&nbsp;<span class="ident" id="6010006">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6010018">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6010023">//&nbsp;Update&nbsp;sparseHeader&nbsp;to&nbsp;consume&nbsp;this&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6010071">sparseHeader</span>&nbsp;<span class="op" id="6010084">=</span>&nbsp;<span class="ident" id="6010086">sparseHeader</span><span class="op" id="6010098">[</span><span class="ident" id="6010099">nl</span><span class="op" id="6010101">+</span><span class="num" id="6010102">1</span><span class="op" id="6010103">:</span><span class="op" id="6010104">]</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6010108">return</span>&nbsp;<span class="ident" id="6010115">n</span><span class="op" id="6010116">,</span>&nbsp;<span class="ident" id="6010118">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6010123">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6010127">//&nbsp;Read&nbsp;the&nbsp;first&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6010152">if</span>&nbsp;<span class="ident" id="6010155">_</span><span class="op" id="6010156">,</span>&nbsp;<span class="ident" id="6010158">err</span>&nbsp;<span class="op" id="6010162">:=</span>&nbsp;<span class="ident" id="6010165">io</span><span class="op" id="6010167">.</span><span class="ident" id="6010168">ReadFull</span><span class="op" id="6010176">(</span><span class="ident" id="6010177">r</span><span class="op" id="6010178">,</span>&nbsp;<span class="ident" id="6010180">sparseHeader</span><span class="op" id="6010192">)</span><span class="op" id="6010193">;</span>&nbsp;<span class="ident" id="6010195">err</span>&nbsp;<span class="op" id="6010199">!=</span>&nbsp;<span class="ident" id="6010202">nil</span>&nbsp;<span class="op" id="6010206">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6010210">return</span>&nbsp;<span class="ident" id="6010217">nil</span><span class="op" id="6010220">,</span>&nbsp;<span class="ident" id="6010222">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6010227">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6010231">//&nbsp;The&nbsp;first&nbsp;line&nbsp;contains&nbsp;the&nbsp;number&nbsp;of&nbsp;entries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6010281">numEntries</span><span class="op" id="6010291">,</span>&nbsp;<span class="ident" id="6010293">err</span>&nbsp;<span class="op" id="6010297">:=</span>&nbsp;<span class="ident" id="6010300">readDecimal</span><span class="op" id="6010311">(</span><span class="op" id="6010312">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6010315">if</span>&nbsp;<span class="ident" id="6010318">err</span>&nbsp;<span class="op" id="6010322">!=</span>&nbsp;<span class="ident" id="6010325">nil</span>&nbsp;<span class="op" id="6010329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6010333">return</span>&nbsp;<span class="ident" id="6010340">nil</span><span class="op" id="6010343">,</span>&nbsp;<span class="ident" id="6010345">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6010350">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6010354">//&nbsp;Read&nbsp;all&nbsp;the&nbsp;entries</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6010379">sp</span>&nbsp;<span class="op" id="6010382">:=</span>&nbsp;<span class="builtinfunc" id="6010385">make</span><span class="op" id="6010389">(</span><span class="op" id="6010390">[</span><span class="op" id="6010391">]</span><span class="ident" id="6010392">sparseEntry</span><span class="op" id="6010403">,</span>&nbsp;<span class="num" id="6010405">0</span><span class="op" id="6010406">,</span>&nbsp;<span class="ident" id="6010408">numEntries</span><span class="op" id="6010418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6010421">for</span>&nbsp;<span class="ident" id="6010425">i</span>&nbsp;<span class="op" id="6010427">:=</span>&nbsp;<span class="ident" id="6010430">int64</span><span class="op" id="6010435">(</span><span class="num" id="6010436">0</span><span class="op" id="6010437">)</span><span class="op" id="6010438">;</span>&nbsp;<span class="ident" id="6010440">i</span>&nbsp;<span class="op" id="6010442">&lt;</span>&nbsp;<span class="ident" id="6010444">numEntries</span><span class="op" id="6010454">;</span>&nbsp;<span class="ident" id="6010456">i</span><span class="op" id="6010457">++</span>&nbsp;<span class="op" id="6010460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6010464">//&nbsp;Read&nbsp;the&nbsp;offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6010485">offset</span><span class="op" id="6010491">,</span>&nbsp;<span class="ident" id="6010493">err</span>&nbsp;<span class="op" id="6010497">:=</span>&nbsp;<span class="ident" id="6010500">readDecimal</span><span class="op" id="6010511">(</span><span class="op" id="6010512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6010516">if</span>&nbsp;<span class="ident" id="6010519">err</span>&nbsp;<span class="op" id="6010523">!=</span>&nbsp;<span class="ident" id="6010526">nil</span>&nbsp;<span class="op" id="6010530">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6010535">return</span>&nbsp;<span class="ident" id="6010542">nil</span><span class="op" id="6010545">,</span>&nbsp;<span class="ident" id="6010547">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6010553">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6010557">//&nbsp;Read&nbsp;numBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6010576">numBytes</span><span class="op" id="6010584">,</span>&nbsp;<span class="ident" id="6010586">err</span>&nbsp;<span class="op" id="6010590">:=</span>&nbsp;<span class="ident" id="6010593">readDecimal</span><span class="op" id="6010604">(</span><span class="op" id="6010605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6010609">if</span>&nbsp;<span class="ident" id="6010612">err</span>&nbsp;<span class="op" id="6010616">!=</span>&nbsp;<span class="ident" id="6010619">nil</span>&nbsp;<span class="op" id="6010623">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6010628">return</span>&nbsp;<span class="ident" id="6010635">nil</span><span class="op" id="6010638">,</span>&nbsp;<span class="ident" id="6010640">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6010646">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6010651">sp</span>&nbsp;<span class="op" id="6010654">=</span>&nbsp;<span class="builtinfunc" id="6010656">append</span><span class="op" id="6010662">(</span><span class="ident" id="6010663">sp</span><span class="op" id="6010665">,</span>&nbsp;<span class="ident" id="6010667">sparseEntry</span><span class="op" id="6010678">{</span><span class="ident" id="6010679">offset</span><span class="op" id="6010685">:</span>&nbsp;<span class="ident" id="6010687">offset</span><span class="op" id="6010693">,</span>&nbsp;<span class="ident" id="6010695">numBytes</span><span class="op" id="6010703">:</span>&nbsp;<span class="ident" id="6010705">numBytes</span><span class="op" id="6010713">}</span><span class="op" id="6010714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6010717">}</span><br>
<span class="lineno">675</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6010721">return</span>&nbsp;<span class="ident" id="6010728">sp</span><span class="op" id="6010730">,</span>&nbsp;<span class="ident" id="6010732">nil</span><br>
<span class="lineno"></span><span class="op" id="6010736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6010739">//&nbsp;readGNUSparseMap0x1&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;map&nbsp;as&nbsp;stored&nbsp;in&nbsp;GNU&#39;s&nbsp;PAX&nbsp;sparse&nbsp;format&nbsp;version&nbsp;0.1.</span><br>
<span class="lineno">680</span><span class="comment" id="6010833">//&nbsp;The&nbsp;sparse&nbsp;map&nbsp;is&nbsp;stored&nbsp;in&nbsp;the&nbsp;PAX&nbsp;headers.</span><br>
<span class="lineno"></span><span class="keyword" id="6010881">func</span>&nbsp;<span class="ident" id="6010886">readGNUSparseMap0x1</span><span class="op" id="6010905">(</span><span class="ident" id="6010906">headers</span>&nbsp;<span class="keyword" id="6010914">map</span><span class="op" id="6010917">[</span><span class="builtintype" id="6010918">string</span><span class="op" id="6010924">]</span><span class="builtintype" id="6010925">string</span><span class="op" id="6010931">)</span>&nbsp;<span class="op" id="6010933">(</span><span class="op" id="6010934">[</span><span class="op" id="6010935">]</span><span class="ident" id="6010936">sparseEntry</span><span class="op" id="6010947">,</span>&nbsp;<span class="builtintype" id="6010949">error</span><span class="op" id="6010954">)</span>&nbsp;<span class="op" id="6010956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6010959">//&nbsp;Get&nbsp;number&nbsp;of&nbsp;entries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6010985">numEntriesStr</span><span class="op" id="6010998">,</span>&nbsp;<span class="ident" id="6011000">ok</span>&nbsp;<span class="op" id="6011003">:=</span>&nbsp;<span class="ident" id="6011006">headers</span><span class="op" id="6011013">[</span><span class="ident" id="6011014">paxGNUSparseNumBlocks</span><span class="op" id="6011035">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6011038">if</span>&nbsp;<span class="op" id="6011041">!</span><span class="ident" id="6011042">ok</span>&nbsp;<span class="op" id="6011045">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6011049">return</span>&nbsp;<span class="ident" id="6011056">nil</span><span class="op" id="6011059">,</span>&nbsp;<span class="ident" id="6011061">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6011072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6011075">numEntries</span><span class="op" id="6011085">,</span>&nbsp;<span class="ident" id="6011087">err</span>&nbsp;<span class="op" id="6011091">:=</span>&nbsp;<span class="ident" id="6011094">strconv</span><span class="op" id="6011101">.</span><span class="ident" id="6011102">ParseInt</span><span class="op" id="6011110">(</span><span class="ident" id="6011111">numEntriesStr</span><span class="op" id="6011124">,</span>&nbsp;<span class="num" id="6011126">10</span><span class="op" id="6011128">,</span>&nbsp;<span class="num" id="6011130">0</span><span class="op" id="6011131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6011134">if</span>&nbsp;<span class="ident" id="6011137">err</span>&nbsp;<span class="op" id="6011141">!=</span>&nbsp;<span class="ident" id="6011144">nil</span>&nbsp;<span class="op" id="6011148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6011152">return</span>&nbsp;<span class="ident" id="6011159">nil</span><span class="op" id="6011162">,</span>&nbsp;<span class="ident" id="6011164">ErrHeader</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6011175">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6011179">sparseMap</span>&nbsp;<span class="op" id="6011189">:=</span>&nbsp;<span class="ident" id="6011192">strings</span><span class="op" id="6011199">.</span><span class="ident" id="6011200">Split</span><span class="op" id="6011205">(</span><span class="ident" id="6011206">headers</span><span class="op" id="6011213">[</span><span class="ident" id="6011214">paxGNUSparseMap</span><span class="op" id="6011229">]</span><span class="op" id="6011230">,</span>&nbsp;<span class="string" id="6011232">&#34;,&#34;</span><span class="op" id="6011235">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6011239">//&nbsp;There&nbsp;should&nbsp;be&nbsp;two&nbsp;numbers&nbsp;in&nbsp;sparseMap&nbsp;for&nbsp;each&nbsp;entry</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6011299">if</span>&nbsp;<span class="ident" id="6011302">int64</span><span class="op" id="6011307">(</span><span class="builtinfunc" id="6011308">len</span><span class="op" id="6011311">(</span><span class="ident" id="6011312">sparseMap</span><span class="op" id="6011321">)</span><span class="op" id="6011322">)</span>&nbsp;<span class="op" id="6011324">!=</span>&nbsp;<span class="num" id="6011327">2</span><span class="op" id="6011328">*</span><span class="ident" id="6011329">numEntries</span>&nbsp;<span class="op" id="6011340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6011344">return</span>&nbsp;<span class="ident" id="6011351">nil</span><span class="op" id="6011354">,</span>&nbsp;<span class="ident" id="6011356">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6011367">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6011371">//&nbsp;Loop&nbsp;through&nbsp;the&nbsp;entries&nbsp;in&nbsp;the&nbsp;sparse&nbsp;map</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6011418">sp</span>&nbsp;<span class="op" id="6011421">:=</span>&nbsp;<span class="builtinfunc" id="6011424">make</span><span class="op" id="6011428">(</span><span class="op" id="6011429">[</span><span class="op" id="6011430">]</span><span class="ident" id="6011431">sparseEntry</span><span class="op" id="6011442">,</span>&nbsp;<span class="num" id="6011444">0</span><span class="op" id="6011445">,</span>&nbsp;<span class="ident" id="6011447">numEntries</span><span class="op" id="6011457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6011460">for</span>&nbsp;<span class="ident" id="6011464">i</span>&nbsp;<span class="op" id="6011466">:=</span>&nbsp;<span class="ident" id="6011469">int64</span><span class="op" id="6011474">(</span><span class="num" id="6011475">0</span><span class="op" id="6011476">)</span><span class="op" id="6011477">;</span>&nbsp;<span class="ident" id="6011479">i</span>&nbsp;<span class="op" id="6011481">&lt;</span>&nbsp;<span class="ident" id="6011483">numEntries</span><span class="op" id="6011493">;</span>&nbsp;<span class="ident" id="6011495">i</span><span class="op" id="6011496">++</span>&nbsp;<span class="op" id="6011499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6011503">offset</span><span class="op" id="6011509">,</span>&nbsp;<span class="ident" id="6011511">err</span>&nbsp;<span class="op" id="6011515">:=</span>&nbsp;<span class="ident" id="6011518">strconv</span><span class="op" id="6011525">.</span><span class="ident" id="6011526">ParseInt</span><span class="op" id="6011534">(</span><span class="ident" id="6011535">sparseMap</span><span class="op" id="6011544">[</span><span class="num" id="6011545">2</span><span class="op" id="6011546">*</span><span class="ident" id="6011547">i</span><span class="op" id="6011548">]</span><span class="op" id="6011549">,</span>&nbsp;<span class="num" id="6011551">10</span><span class="op" id="6011553">,</span>&nbsp;<span class="num" id="6011555">0</span><span class="op" id="6011556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6011560">if</span>&nbsp;<span class="ident" id="6011563">err</span>&nbsp;<span class="op" id="6011567">!=</span>&nbsp;<span class="ident" id="6011570">nil</span>&nbsp;<span class="op" id="6011574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6011579">return</span>&nbsp;<span class="ident" id="6011586">nil</span><span class="op" id="6011589">,</span>&nbsp;<span class="ident" id="6011591">ErrHeader</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6011603">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6011607">numBytes</span><span class="op" id="6011615">,</span>&nbsp;<span class="ident" id="6011617">err</span>&nbsp;<span class="op" id="6011621">:=</span>&nbsp;<span class="ident" id="6011624">strconv</span><span class="op" id="6011631">.</span><span class="ident" id="6011632">ParseInt</span><span class="op" id="6011640">(</span><span class="ident" id="6011641">sparseMap</span><span class="op" id="6011650">[</span><span class="num" id="6011651">2</span><span class="op" id="6011652">*</span><span class="ident" id="6011653">i</span><span class="op" id="6011654">+</span><span class="num" id="6011655">1</span><span class="op" id="6011656">]</span><span class="op" id="6011657">,</span>&nbsp;<span class="num" id="6011659">10</span><span class="op" id="6011661">,</span>&nbsp;<span class="num" id="6011663">0</span><span class="op" id="6011664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6011668">if</span>&nbsp;<span class="ident" id="6011671">err</span>&nbsp;<span class="op" id="6011675">!=</span>&nbsp;<span class="ident" id="6011678">nil</span>&nbsp;<span class="op" id="6011682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6011687">return</span>&nbsp;<span class="ident" id="6011694">nil</span><span class="op" id="6011697">,</span>&nbsp;<span class="ident" id="6011699">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6011711">}</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6011715">sp</span>&nbsp;<span class="op" id="6011718">=</span>&nbsp;<span class="builtinfunc" id="6011720">append</span><span class="op" id="6011726">(</span><span class="ident" id="6011727">sp</span><span class="op" id="6011729">,</span>&nbsp;<span class="ident" id="6011731">sparseEntry</span><span class="op" id="6011742">{</span><span class="ident" id="6011743">offset</span><span class="op" id="6011749">:</span>&nbsp;<span class="ident" id="6011751">offset</span><span class="op" id="6011757">,</span>&nbsp;<span class="ident" id="6011759">numBytes</span><span class="op" id="6011767">:</span>&nbsp;<span class="ident" id="6011769">numBytes</span><span class="op" id="6011777">}</span><span class="op" id="6011778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6011781">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6011785">return</span>&nbsp;<span class="ident" id="6011792">sp</span><span class="op" id="6011794">,</span>&nbsp;<span class="ident" id="6011796">nil</span><br>
<span class="lineno"></span><span class="op" id="6011800">}</span><br>
<span class="lineno">715</span><br>
<span class="lineno"></span><span class="comment" id="6011803">//&nbsp;numBytes&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;left&nbsp;to&nbsp;read&nbsp;in&nbsp;the&nbsp;current&nbsp;file&#39;s&nbsp;entry</span><br>
<span class="lineno"></span><span class="comment" id="6011884">//&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive,&nbsp;or&nbsp;0&nbsp;if&nbsp;there&nbsp;is&nbsp;no&nbsp;current&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="6011941">func</span>&nbsp;<span class="op" id="6011946">(</span><span class="ident" id="6011947">tr</span>&nbsp;<span class="op" id="6011950">*</span><span class="ident" id="6011951">Reader</span><span class="op" id="6011957">)</span>&nbsp;<span class="ident" id="6011959">numBytes</span><span class="op" id="6011967">(</span><span class="op" id="6011968">)</span>&nbsp;<span class="ident" id="6011970">int64</span>&nbsp;<span class="op" id="6011976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6011979">if</span>&nbsp;<span class="ident" id="6011982">tr</span><span class="op" id="6011984">.</span><span class="ident" id="6011985">curr</span>&nbsp;<span class="op" id="6011990">==</span>&nbsp;<span class="ident" id="6011993">nil</span>&nbsp;<span class="op" id="6011997">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6012001">//&nbsp;No&nbsp;current&nbsp;file,&nbsp;so&nbsp;no&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6012035">return</span>&nbsp;<span class="num" id="6012042">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6012045">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6012048">return</span>&nbsp;<span class="ident" id="6012055">tr</span><span class="op" id="6012057">.</span><span class="ident" id="6012058">curr</span><span class="op" id="6012062">.</span><span class="ident" id="6012063">numBytes</span><span class="op" id="6012071">(</span><span class="op" id="6012072">)</span><br>
<span class="lineno"></span><span class="op" id="6012074">}</span><br>
<span class="lineno">725</span><br>
<span class="lineno"></span><span class="comment" id="6012077">//&nbsp;Read&nbsp;reads&nbsp;from&nbsp;the&nbsp;current&nbsp;entry&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="comment" id="6012134">//&nbsp;It&nbsp;returns&nbsp;0,&nbsp;io.EOF&nbsp;when&nbsp;it&nbsp;reaches&nbsp;the&nbsp;end&nbsp;of&nbsp;that&nbsp;entry,</span><br>
<span class="lineno"></span><span class="comment" id="6012197">//&nbsp;until&nbsp;Next&nbsp;is&nbsp;called&nbsp;to&nbsp;advance&nbsp;to&nbsp;the&nbsp;next&nbsp;entry.</span><br>
<span class="lineno"></span><span class="keyword" id="6012251">func</span>&nbsp;<span class="op" id="6012256">(</span><span class="ident" id="6012257">tr</span>&nbsp;<span class="op" id="6012260">*</span><span class="ident" id="6012261">Reader</span><span class="op" id="6012267">)</span>&nbsp;<span class="ident" id="6012269">Read</span><span class="op" id="6012273">(</span><span class="ident" id="6012274">b</span>&nbsp;<span class="op" id="6012276">[</span><span class="op" id="6012277">]</span><span class="builtintype" id="6012278">byte</span><span class="op" id="6012282">)</span>&nbsp;<span class="op" id="6012284">(</span><span class="ident" id="6012285">n</span>&nbsp;<span class="builtintype" id="6012287">int</span><span class="op" id="6012290">,</span>&nbsp;<span class="ident" id="6012292">err</span>&nbsp;<span class="builtintype" id="6012296">error</span><span class="op" id="6012301">)</span>&nbsp;<span class="op" id="6012303">{</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6012306">if</span>&nbsp;<span class="ident" id="6012309">tr</span><span class="op" id="6012311">.</span><span class="ident" id="6012312">curr</span>&nbsp;<span class="op" id="6012317">==</span>&nbsp;<span class="ident" id="6012320">nil</span>&nbsp;<span class="op" id="6012324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6012328">return</span>&nbsp;<span class="num" id="6012335">0</span><span class="op" id="6012336">,</span>&nbsp;<span class="ident" id="6012338">io</span><span class="op" id="6012340">.</span><span class="ident" id="6012341">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6012346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6012349">n</span><span class="op" id="6012350">,</span>&nbsp;<span class="ident" id="6012352">err</span>&nbsp;<span class="op" id="6012356">=</span>&nbsp;<span class="ident" id="6012358">tr</span><span class="op" id="6012360">.</span><span class="ident" id="6012361">curr</span><span class="op" id="6012365">.</span><span class="ident" id="6012366">Read</span><span class="op" id="6012370">(</span><span class="ident" id="6012371">b</span><span class="op" id="6012372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6012375">if</span>&nbsp;<span class="ident" id="6012378">err</span>&nbsp;<span class="op" id="6012382">!=</span>&nbsp;<span class="ident" id="6012385">nil</span>&nbsp;<span class="op" id="6012389">&amp;&amp;</span>&nbsp;<span class="ident" id="6012392">err</span>&nbsp;<span class="op" id="6012396">!=</span>&nbsp;<span class="ident" id="6012399">io</span><span class="op" id="6012401">.</span><span class="ident" id="6012402">EOF</span>&nbsp;<span class="op" id="6012406">{</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6012410">tr</span><span class="op" id="6012412">.</span><span class="ident" id="6012413">err</span>&nbsp;<span class="op" id="6012417">=</span>&nbsp;<span class="ident" id="6012419">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6012424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6012427">return</span><br>
<span class="lineno"></span><span class="op" id="6012434">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">740</span><span class="keyword" id="6012437">func</span>&nbsp;<span class="op" id="6012442">(</span><span class="ident" id="6012443">rfr</span>&nbsp;<span class="op" id="6012447">*</span><span class="ident" id="6012448">regFileReader</span><span class="op" id="6012461">)</span>&nbsp;<span class="ident" id="6012463">Read</span><span class="op" id="6012467">(</span><span class="ident" id="6012468">b</span>&nbsp;<span class="op" id="6012470">[</span><span class="op" id="6012471">]</span><span class="builtintype" id="6012472">byte</span><span class="op" id="6012476">)</span>&nbsp;<span class="op" id="6012478">(</span><span class="ident" id="6012479">n</span>&nbsp;<span class="builtintype" id="6012481">int</span><span class="op" id="6012484">,</span>&nbsp;<span class="ident" id="6012486">err</span>&nbsp;<span class="builtintype" id="6012490">error</span><span class="op" id="6012495">)</span>&nbsp;<span class="op" id="6012497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6012500">if</span>&nbsp;<span class="ident" id="6012503">rfr</span><span class="op" id="6012506">.</span><span class="ident" id="6012507">nb</span>&nbsp;<span class="op" id="6012510">==</span>&nbsp;<span class="num" id="6012513">0</span>&nbsp;<span class="op" id="6012515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6012519">//&nbsp;file&nbsp;consumed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6012538">return</span>&nbsp;<span class="num" id="6012545">0</span><span class="op" id="6012546">,</span>&nbsp;<span class="ident" id="6012548">io</span><span class="op" id="6012550">.</span><span class="ident" id="6012551">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6012556">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6012559">if</span>&nbsp;<span class="ident" id="6012562">int64</span><span class="op" id="6012567">(</span><span class="builtinfunc" id="6012568">len</span><span class="op" id="6012571">(</span><span class="ident" id="6012572">b</span><span class="op" id="6012573">)</span><span class="op" id="6012574">)</span>&nbsp;<span class="op" id="6012576">&gt;</span>&nbsp;<span class="ident" id="6012578">rfr</span><span class="op" id="6012581">.</span><span class="ident" id="6012582">nb</span>&nbsp;<span class="op" id="6012585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6012589">b</span>&nbsp;<span class="op" id="6012591">=</span>&nbsp;<span class="ident" id="6012593">b</span><span class="op" id="6012594">[</span><span class="num" id="6012595">0</span><span class="op" id="6012596">:</span><span class="ident" id="6012597">rfr</span><span class="op" id="6012600">.</span><span class="ident" id="6012601">nb</span><span class="op" id="6012603">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6012606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6012609">n</span><span class="op" id="6012610">,</span>&nbsp;<span class="ident" id="6012612">err</span>&nbsp;<span class="op" id="6012616">=</span>&nbsp;<span class="ident" id="6012618">rfr</span><span class="op" id="6012621">.</span><span class="ident" id="6012622">r</span><span class="op" id="6012623">.</span><span class="ident" id="6012624">Read</span><span class="op" id="6012628">(</span><span class="ident" id="6012629">b</span><span class="op" id="6012630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6012633">rfr</span><span class="op" id="6012636">.</span><span class="ident" id="6012637">nb</span>&nbsp;<span class="op" id="6012640">-=</span>&nbsp;<span class="ident" id="6012643">int64</span><span class="op" id="6012648">(</span><span class="ident" id="6012649">n</span><span class="op" id="6012650">)</span><br>
<span class="lineno">750</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6012654">if</span>&nbsp;<span class="ident" id="6012657">err</span>&nbsp;<span class="op" id="6012661">==</span>&nbsp;<span class="ident" id="6012664">io</span><span class="op" id="6012666">.</span><span class="ident" id="6012667">EOF</span>&nbsp;<span class="op" id="6012671">&amp;&amp;</span>&nbsp;<span class="ident" id="6012674">rfr</span><span class="op" id="6012677">.</span><span class="ident" id="6012678">nb</span>&nbsp;<span class="op" id="6012681">&gt;</span>&nbsp;<span class="num" id="6012683">0</span>&nbsp;<span class="op" id="6012685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6012689">err</span>&nbsp;<span class="op" id="6012693">=</span>&nbsp;<span class="ident" id="6012695">io</span><span class="op" id="6012697">.</span><span class="ident" id="6012698">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6012716">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6012719">return</span><br>
<span class="lineno">755</span><span class="op" id="6012726">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6012729">//&nbsp;numBytes&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;left&nbsp;to&nbsp;read&nbsp;in&nbsp;the&nbsp;file&#39;s&nbsp;data&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="6012821">func</span>&nbsp;<span class="op" id="6012826">(</span><span class="ident" id="6012827">rfr</span>&nbsp;<span class="op" id="6012831">*</span><span class="ident" id="6012832">regFileReader</span><span class="op" id="6012845">)</span>&nbsp;<span class="ident" id="6012847">numBytes</span><span class="op" id="6012855">(</span><span class="op" id="6012856">)</span>&nbsp;<span class="ident" id="6012858">int64</span>&nbsp;<span class="op" id="6012864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6012867">return</span>&nbsp;<span class="ident" id="6012874">rfr</span><span class="op" id="6012877">.</span><span class="ident" id="6012878">nb</span><br>
<span class="lineno">760</span><span class="op" id="6012881">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6012884">//&nbsp;readHole&nbsp;reads&nbsp;a&nbsp;sparse&nbsp;file&nbsp;hole&nbsp;ending&nbsp;at&nbsp;offset&nbsp;toOffset</span><br>
<span class="lineno"></span><span class="keyword" id="6012947">func</span>&nbsp;<span class="op" id="6012952">(</span><span class="ident" id="6012953">sfr</span>&nbsp;<span class="op" id="6012957">*</span><span class="ident" id="6012958">sparseFileReader</span><span class="op" id="6012974">)</span>&nbsp;<span class="ident" id="6012976">readHole</span><span class="op" id="6012984">(</span><span class="ident" id="6012985">b</span>&nbsp;<span class="op" id="6012987">[</span><span class="op" id="6012988">]</span><span class="builtintype" id="6012989">byte</span><span class="op" id="6012993">,</span>&nbsp;<span class="ident" id="6012995">toOffset</span>&nbsp;<span class="ident" id="6013004">int64</span><span class="op" id="6013009">)</span>&nbsp;<span class="builtintype" id="6013011">int</span>&nbsp;<span class="op" id="6013015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6013018">n64</span>&nbsp;<span class="op" id="6013022">:=</span>&nbsp;<span class="ident" id="6013025">toOffset</span>&nbsp;<span class="op" id="6013034">-</span>&nbsp;<span class="ident" id="6013036">sfr</span><span class="op" id="6013039">.</span><span class="ident" id="6013040">pos</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6013045">if</span>&nbsp;<span class="ident" id="6013048">n64</span>&nbsp;<span class="op" id="6013052">&gt;</span>&nbsp;<span class="ident" id="6013054">int64</span><span class="op" id="6013059">(</span><span class="builtinfunc" id="6013060">len</span><span class="op" id="6013063">(</span><span class="ident" id="6013064">b</span><span class="op" id="6013065">)</span><span class="op" id="6013066">)</span>&nbsp;<span class="op" id="6013068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6013072">n64</span>&nbsp;<span class="op" id="6013076">=</span>&nbsp;<span class="ident" id="6013078">int64</span><span class="op" id="6013083">(</span><span class="builtinfunc" id="6013084">len</span><span class="op" id="6013087">(</span><span class="ident" id="6013088">b</span><span class="op" id="6013089">)</span><span class="op" id="6013090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6013093">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6013096">n</span>&nbsp;<span class="op" id="6013098">:=</span>&nbsp;<span class="builtintype" id="6013101">int</span><span class="op" id="6013104">(</span><span class="ident" id="6013105">n64</span><span class="op" id="6013108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6013111">for</span>&nbsp;<span class="ident" id="6013115">i</span>&nbsp;<span class="op" id="6013117">:=</span>&nbsp;<span class="num" id="6013120">0</span><span class="op" id="6013121">;</span>&nbsp;<span class="ident" id="6013123">i</span>&nbsp;<span class="op" id="6013125">&lt;</span>&nbsp;<span class="ident" id="6013127">n</span><span class="op" id="6013128">;</span>&nbsp;<span class="ident" id="6013130">i</span><span class="op" id="6013131">++</span>&nbsp;<span class="op" id="6013134">{</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6013138">b</span><span class="op" id="6013139">[</span><span class="ident" id="6013140">i</span><span class="op" id="6013141">]</span>&nbsp;<span class="op" id="6013143">=</span>&nbsp;<span class="num" id="6013145">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6013148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6013151">sfr</span><span class="op" id="6013154">.</span><span class="ident" id="6013155">pos</span>&nbsp;<span class="op" id="6013159">+=</span>&nbsp;<span class="ident" id="6013162">n64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6013167">return</span>&nbsp;<span class="ident" id="6013174">n</span><br>
<span class="lineno"></span><span class="op" id="6013176">}</span><br>
<span class="lineno">775</span><br>
<span class="lineno"></span><span class="comment" id="6013179">//&nbsp;Read&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;file&nbsp;data&nbsp;in&nbsp;expanded&nbsp;form.</span><br>
<span class="lineno"></span><span class="keyword" id="6013232">func</span>&nbsp;<span class="op" id="6013237">(</span><span class="ident" id="6013238">sfr</span>&nbsp;<span class="op" id="6013242">*</span><span class="ident" id="6013243">sparseFileReader</span><span class="op" id="6013259">)</span>&nbsp;<span class="ident" id="6013261">Read</span><span class="op" id="6013265">(</span><span class="ident" id="6013266">b</span>&nbsp;<span class="op" id="6013268">[</span><span class="op" id="6013269">]</span><span class="builtintype" id="6013270">byte</span><span class="op" id="6013274">)</span>&nbsp;<span class="op" id="6013276">(</span><span class="ident" id="6013277">n</span>&nbsp;<span class="builtintype" id="6013279">int</span><span class="op" id="6013282">,</span>&nbsp;<span class="ident" id="6013284">err</span>&nbsp;<span class="builtintype" id="6013288">error</span><span class="op" id="6013293">)</span>&nbsp;<span class="op" id="6013295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6013298">if</span>&nbsp;<span class="builtinfunc" id="6013301">len</span><span class="op" id="6013304">(</span><span class="ident" id="6013305">sfr</span><span class="op" id="6013308">.</span><span class="ident" id="6013309">sp</span><span class="op" id="6013311">)</span>&nbsp;<span class="op" id="6013313">==</span>&nbsp;<span class="num" id="6013316">0</span>&nbsp;<span class="op" id="6013318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6013322">//&nbsp;No&nbsp;more&nbsp;data&nbsp;fragments&nbsp;to&nbsp;read&nbsp;from.</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6013364">if</span>&nbsp;<span class="ident" id="6013367">sfr</span><span class="op" id="6013370">.</span><span class="ident" id="6013371">pos</span>&nbsp;<span class="op" id="6013375">&lt;</span>&nbsp;<span class="ident" id="6013377">sfr</span><span class="op" id="6013380">.</span><span class="ident" id="6013381">tot</span>&nbsp;<span class="op" id="6013385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6013390">//&nbsp;We&#39;re&nbsp;in&nbsp;the&nbsp;last&nbsp;hole</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6013419">n</span>&nbsp;<span class="op" id="6013421">=</span>&nbsp;<span class="ident" id="6013423">sfr</span><span class="op" id="6013426">.</span><span class="ident" id="6013427">readHole</span><span class="op" id="6013435">(</span><span class="ident" id="6013436">b</span><span class="op" id="6013437">,</span>&nbsp;<span class="ident" id="6013439">sfr</span><span class="op" id="6013442">.</span><span class="ident" id="6013443">tot</span><span class="op" id="6013446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6013451">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6013460">}</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6013464">//&nbsp;Otherwise,&nbsp;we&#39;re&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6013509">return</span>&nbsp;<span class="num" id="6013516">0</span><span class="op" id="6013517">,</span>&nbsp;<span class="ident" id="6013519">io</span><span class="op" id="6013521">.</span><span class="ident" id="6013522">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6013527">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6013530">if</span>&nbsp;<span class="ident" id="6013533">sfr</span><span class="op" id="6013536">.</span><span class="ident" id="6013537">pos</span>&nbsp;<span class="op" id="6013541">&lt;</span>&nbsp;<span class="ident" id="6013543">sfr</span><span class="op" id="6013546">.</span><span class="ident" id="6013547">sp</span><span class="op" id="6013549">[</span><span class="num" id="6013550">0</span><span class="op" id="6013551">]</span><span class="op" id="6013552">.</span><span class="ident" id="6013553">offset</span>&nbsp;<span class="op" id="6013560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6013564">//&nbsp;We&#39;re&nbsp;in&nbsp;a&nbsp;hole</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6013585">n</span>&nbsp;<span class="op" id="6013587">=</span>&nbsp;<span class="ident" id="6013589">sfr</span><span class="op" id="6013592">.</span><span class="ident" id="6013593">readHole</span><span class="op" id="6013601">(</span><span class="ident" id="6013602">b</span><span class="op" id="6013603">,</span>&nbsp;<span class="ident" id="6013605">sfr</span><span class="op" id="6013608">.</span><span class="ident" id="6013609">sp</span><span class="op" id="6013611">[</span><span class="num" id="6013612">0</span><span class="op" id="6013613">]</span><span class="op" id="6013614">.</span><span class="ident" id="6013615">offset</span><span class="op" id="6013621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6013625">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6013633">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6013637">//&nbsp;We&#39;re&nbsp;not&nbsp;in&nbsp;a&nbsp;hole,&nbsp;so&nbsp;we&#39;ll&nbsp;read&nbsp;from&nbsp;the&nbsp;next&nbsp;data&nbsp;fragment</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6013704">posInFragment</span>&nbsp;<span class="op" id="6013718">:=</span>&nbsp;<span class="ident" id="6013721">sfr</span><span class="op" id="6013724">.</span><span class="ident" id="6013725">pos</span>&nbsp;<span class="op" id="6013729">-</span>&nbsp;<span class="ident" id="6013731">sfr</span><span class="op" id="6013734">.</span><span class="ident" id="6013735">sp</span><span class="op" id="6013737">[</span><span class="num" id="6013738">0</span><span class="op" id="6013739">]</span><span class="op" id="6013740">.</span><span class="ident" id="6013741">offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6013749">bytesLeft</span>&nbsp;<span class="op" id="6013759">:=</span>&nbsp;<span class="ident" id="6013762">sfr</span><span class="op" id="6013765">.</span><span class="ident" id="6013766">sp</span><span class="op" id="6013768">[</span><span class="num" id="6013769">0</span><span class="op" id="6013770">]</span><span class="op" id="6013771">.</span><span class="ident" id="6013772">numBytes</span>&nbsp;<span class="op" id="6013781">-</span>&nbsp;<span class="ident" id="6013783">posInFragment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6013798">if</span>&nbsp;<span class="ident" id="6013801">int64</span><span class="op" id="6013806">(</span><span class="builtinfunc" id="6013807">len</span><span class="op" id="6013810">(</span><span class="ident" id="6013811">b</span><span class="op" id="6013812">)</span><span class="op" id="6013813">)</span>&nbsp;<span class="op" id="6013815">&gt;</span>&nbsp;<span class="ident" id="6013817">bytesLeft</span>&nbsp;<span class="op" id="6013827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6013831">b</span>&nbsp;<span class="op" id="6013833">=</span>&nbsp;<span class="ident" id="6013835">b</span><span class="op" id="6013836">[</span><span class="num" id="6013837">0</span><span class="op" id="6013838">:</span><span class="ident" id="6013839">bytesLeft</span><span class="op" id="6013848">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6013851">}</span><br>
<span class="lineno">800</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6013855">n</span><span class="op" id="6013856">,</span>&nbsp;<span class="ident" id="6013858">err</span>&nbsp;<span class="op" id="6013862">=</span>&nbsp;<span class="ident" id="6013864">sfr</span><span class="op" id="6013867">.</span><span class="ident" id="6013868">rfr</span><span class="op" id="6013871">.</span><span class="ident" id="6013872">Read</span><span class="op" id="6013876">(</span><span class="ident" id="6013877">b</span><span class="op" id="6013878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6013881">sfr</span><span class="op" id="6013884">.</span><span class="ident" id="6013885">pos</span>&nbsp;<span class="op" id="6013889">+=</span>&nbsp;<span class="ident" id="6013892">int64</span><span class="op" id="6013897">(</span><span class="ident" id="6013898">n</span><span class="op" id="6013899">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6013903">if</span>&nbsp;<span class="ident" id="6013906">int64</span><span class="op" id="6013911">(</span><span class="ident" id="6013912">n</span><span class="op" id="6013913">)</span>&nbsp;<span class="op" id="6013915">==</span>&nbsp;<span class="ident" id="6013918">bytesLeft</span>&nbsp;<span class="op" id="6013928">{</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6013932">//&nbsp;We&#39;re&nbsp;done&nbsp;with&nbsp;this&nbsp;fragment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6013967">sfr</span><span class="op" id="6013970">.</span><span class="ident" id="6013971">sp</span>&nbsp;<span class="op" id="6013974">=</span>&nbsp;<span class="ident" id="6013976">sfr</span><span class="op" id="6013979">.</span><span class="ident" id="6013980">sp</span><span class="op" id="6013982">[</span><span class="num" id="6013983">1</span><span class="op" id="6013984">:</span><span class="op" id="6013985">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6013988">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6013992">if</span>&nbsp;<span class="ident" id="6013995">err</span>&nbsp;<span class="op" id="6013999">==</span>&nbsp;<span class="ident" id="6014002">io</span><span class="op" id="6014004">.</span><span class="ident" id="6014005">EOF</span>&nbsp;<span class="op" id="6014009">&amp;&amp;</span>&nbsp;<span class="ident" id="6014012">sfr</span><span class="op" id="6014015">.</span><span class="ident" id="6014016">pos</span>&nbsp;<span class="op" id="6014020">&lt;</span>&nbsp;<span class="ident" id="6014022">sfr</span><span class="op" id="6014025">.</span><span class="ident" id="6014026">tot</span>&nbsp;<span class="op" id="6014030">{</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6014034">//&nbsp;We&nbsp;reached&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;last&nbsp;fragment&#39;s&nbsp;data,&nbsp;but&nbsp;there&#39;s&nbsp;a&nbsp;final&nbsp;hole</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6014112">err</span>&nbsp;<span class="op" id="6014116">=</span>&nbsp;<span class="ident" id="6014118">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6014123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6014126">return</span><br>
<span class="lineno"></span><span class="op" id="6014133">}</span><br>
<span class="lineno">815</span><br>
<span class="lineno"></span><span class="comment" id="6014136">//&nbsp;numBytes&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;left&nbsp;to&nbsp;read&nbsp;in&nbsp;the&nbsp;sparse&nbsp;file&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="6014210">//&nbsp;sparse-encoded&nbsp;data&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="6014253">func</span>&nbsp;<span class="op" id="6014258">(</span><span class="ident" id="6014259">sfr</span>&nbsp;<span class="op" id="6014263">*</span><span class="ident" id="6014264">sparseFileReader</span><span class="op" id="6014280">)</span>&nbsp;<span class="ident" id="6014282">numBytes</span><span class="op" id="6014290">(</span><span class="op" id="6014291">)</span>&nbsp;<span class="ident" id="6014293">int64</span>&nbsp;<span class="op" id="6014299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6014302">return</span>&nbsp;<span class="ident" id="6014309">sfr</span><span class="op" id="6014312">.</span><span class="ident" id="6014313">rfr</span><span class="op" id="6014316">.</span><span class="ident" id="6014317">nb</span><br>
<span class="lineno">820</span><span class="op" id="6014320">}</span>
</div>
</body>
</html>
