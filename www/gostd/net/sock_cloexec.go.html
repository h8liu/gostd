<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html" class="current">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4160498">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4160553">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4160607">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4160658">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;sysSocket&nbsp;and&nbsp;accept&nbsp;for&nbsp;platforms&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4160722">//&nbsp;provide&nbsp;a&nbsp;fast&nbsp;path&nbsp;for&nbsp;setting&nbsp;SetNonblock&nbsp;and&nbsp;CloseOnExec.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4160787">//&nbsp;+build&nbsp;freebsd&nbsp;linux</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="4160812">package</span>&nbsp;<span class="ident" id="4160820">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4160825">import</span>&nbsp;<span class="string" id="4160832">&#34;syscall&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4160843">//&nbsp;Wrapper&nbsp;around&nbsp;the&nbsp;socket&nbsp;system&nbsp;call&nbsp;that&nbsp;marks&nbsp;the&nbsp;returned&nbsp;file</span><br>
<span class="lineno">15</span><span class="comment" id="4160913">//&nbsp;descriptor&nbsp;as&nbsp;nonblocking&nbsp;and&nbsp;close-on-exec.</span><br>
<span class="lineno"></span><span class="keyword" id="4160961">func</span>&nbsp;<span class="ident" id="4160966">sysSocket</span><span class="op" id="4160975">(</span><span class="ident" id="4160976">family</span><span class="op" id="4160982">,</span>&nbsp;<span class="ident" id="4160984">sotype</span><span class="op" id="4160990">,</span>&nbsp;<span class="ident" id="4160992">proto</span>&nbsp;<span class="builtintype" id="4160998">int</span><span class="op" id="4161001">)</span>&nbsp;<span class="op" id="4161003">(</span><span class="builtintype" id="4161004">int</span><span class="op" id="4161007">,</span>&nbsp;<span class="builtintype" id="4161009">error</span><span class="op" id="4161014">)</span>&nbsp;<span class="op" id="4161016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4161019">s</span><span class="op" id="4161020">,</span>&nbsp;<span class="ident" id="4161022">err</span>&nbsp;<span class="op" id="4161026">:=</span>&nbsp;<span class="ident" id="4161029">syscall</span><span class="op" id="4161036">.</span><span class="ident" id="4161037">Socket</span><span class="op" id="4161043">(</span><span class="ident" id="4161044">family</span><span class="op" id="4161050">,</span>&nbsp;<span class="ident" id="4161052">sotype</span><span class="op" id="4161058">|</span><span class="ident" id="4161059">syscall</span><span class="op" id="4161066">.</span><span class="ident" id="4161067">SOCK_NONBLOCK</span><span class="op" id="4161080">|</span><span class="ident" id="4161081">syscall</span><span class="op" id="4161088">.</span><span class="ident" id="4161089">SOCK_CLOEXEC</span><span class="op" id="4161101">,</span>&nbsp;<span class="ident" id="4161103">proto</span><span class="op" id="4161108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4161111">//&nbsp;On&nbsp;Linux&nbsp;the&nbsp;SOCK_NONBLOCK&nbsp;and&nbsp;SOCK_CLOEXEC&nbsp;flags&nbsp;were</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4161170">//&nbsp;introduced&nbsp;in&nbsp;2.6.27&nbsp;kernel&nbsp;and&nbsp;on&nbsp;FreeBSD&nbsp;both&nbsp;flags&nbsp;were</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4161233">//&nbsp;introduced&nbsp;in&nbsp;10&nbsp;kernel.&nbsp;If&nbsp;we&nbsp;get&nbsp;an&nbsp;EINVAL&nbsp;error&nbsp;on&nbsp;Linux</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4161297">//&nbsp;or&nbsp;EPROTONOSUPPORT&nbsp;error&nbsp;on&nbsp;FreeBSD,&nbsp;fall&nbsp;back&nbsp;to&nbsp;using</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4161357">//&nbsp;socket&nbsp;without&nbsp;them.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4161382">if</span>&nbsp;<span class="ident" id="4161385">err</span>&nbsp;<span class="op" id="4161389">==</span>&nbsp;<span class="ident" id="4161392">nil</span>&nbsp;<span class="op" id="4161396">||</span>&nbsp;<span class="op" id="4161399">(</span><span class="ident" id="4161400">err</span>&nbsp;<span class="op" id="4161404">!=</span>&nbsp;<span class="ident" id="4161407">syscall</span><span class="op" id="4161414">.</span><span class="ident" id="4161415">EPROTONOSUPPORT</span>&nbsp;<span class="op" id="4161431">&amp;&amp;</span>&nbsp;<span class="ident" id="4161434">err</span>&nbsp;<span class="op" id="4161438">!=</span>&nbsp;<span class="ident" id="4161441">syscall</span><span class="op" id="4161448">.</span><span class="ident" id="4161449">EINVAL</span><span class="op" id="4161455">)</span>&nbsp;<span class="op" id="4161457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4161461">return</span>&nbsp;<span class="ident" id="4161468">s</span><span class="op" id="4161469">,</span>&nbsp;<span class="ident" id="4161471">err</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4161476">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4161480">//&nbsp;See&nbsp;../syscall/exec_unix.go&nbsp;for&nbsp;description&nbsp;of&nbsp;ForkLock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4161541">syscall</span><span class="op" id="4161548">.</span><span class="ident" id="4161549">ForkLock</span><span class="op" id="4161557">.</span><span class="ident" id="4161558">RLock</span><span class="op" id="4161563">(</span><span class="op" id="4161564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4161567">s</span><span class="op" id="4161568">,</span>&nbsp;<span class="ident" id="4161570">err</span>&nbsp;<span class="op" id="4161574">=</span>&nbsp;<span class="ident" id="4161576">syscall</span><span class="op" id="4161583">.</span><span class="ident" id="4161584">Socket</span><span class="op" id="4161590">(</span><span class="ident" id="4161591">family</span><span class="op" id="4161597">,</span>&nbsp;<span class="ident" id="4161599">sotype</span><span class="op" id="4161605">,</span>&nbsp;<span class="ident" id="4161607">proto</span><span class="op" id="4161612">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4161615">if</span>&nbsp;<span class="ident" id="4161618">err</span>&nbsp;<span class="op" id="4161622">==</span>&nbsp;<span class="ident" id="4161625">nil</span>&nbsp;<span class="op" id="4161629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4161633">syscall</span><span class="op" id="4161640">.</span><span class="ident" id="4161641">CloseOnExec</span><span class="op" id="4161652">(</span><span class="ident" id="4161653">s</span><span class="op" id="4161654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4161657">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4161660">syscall</span><span class="op" id="4161667">.</span><span class="ident" id="4161668">ForkLock</span><span class="op" id="4161676">.</span><span class="ident" id="4161677">RUnlock</span><span class="op" id="4161684">(</span><span class="op" id="4161685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4161688">if</span>&nbsp;<span class="ident" id="4161691">err</span>&nbsp;<span class="op" id="4161695">!=</span>&nbsp;<span class="ident" id="4161698">nil</span>&nbsp;<span class="op" id="4161702">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4161706">return</span>&nbsp;<span class="op" id="4161713">-</span><span class="num" id="4161714">1</span><span class="op" id="4161715">,</span>&nbsp;<span class="ident" id="4161717">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4161722">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4161725">if</span>&nbsp;<span class="ident" id="4161728">err</span>&nbsp;<span class="op" id="4161732">=</span>&nbsp;<span class="ident" id="4161734">syscall</span><span class="op" id="4161741">.</span><span class="ident" id="4161742">SetNonblock</span><span class="op" id="4161753">(</span><span class="ident" id="4161754">s</span><span class="op" id="4161755">,</span>&nbsp;<span class="builtintype" id="4161757">true</span><span class="op" id="4161761">)</span><span class="op" id="4161762">;</span>&nbsp;<span class="ident" id="4161764">err</span>&nbsp;<span class="op" id="4161768">!=</span>&nbsp;<span class="ident" id="4161771">nil</span>&nbsp;<span class="op" id="4161775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4161779">syscall</span><span class="op" id="4161786">.</span><span class="ident" id="4161787">Close</span><span class="op" id="4161792">(</span><span class="ident" id="4161793">s</span><span class="op" id="4161794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4161798">return</span>&nbsp;<span class="op" id="4161805">-</span><span class="num" id="4161806">1</span><span class="op" id="4161807">,</span>&nbsp;<span class="ident" id="4161809">err</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4161814">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4161817">return</span>&nbsp;<span class="ident" id="4161824">s</span><span class="op" id="4161825">,</span>&nbsp;<span class="ident" id="4161827">nil</span><br>
<span class="lineno"></span><span class="op" id="4161831">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4161834">//&nbsp;Wrapper&nbsp;around&nbsp;the&nbsp;accept&nbsp;system&nbsp;call&nbsp;that&nbsp;marks&nbsp;the&nbsp;returned&nbsp;file</span><br>
<span class="lineno">45</span><span class="comment" id="4161904">//&nbsp;descriptor&nbsp;as&nbsp;nonblocking&nbsp;and&nbsp;close-on-exec.</span><br>
<span class="lineno"></span><span class="keyword" id="4161952">func</span>&nbsp;<span class="ident" id="4161957">accept</span><span class="op" id="4161963">(</span><span class="ident" id="4161964">s</span>&nbsp;<span class="builtintype" id="4161966">int</span><span class="op" id="4161969">)</span>&nbsp;<span class="op" id="4161971">(</span><span class="builtintype" id="4161972">int</span><span class="op" id="4161975">,</span>&nbsp;<span class="ident" id="4161977">syscall</span><span class="op" id="4161984">.</span><span class="ident" id="4161985">Sockaddr</span><span class="op" id="4161993">,</span>&nbsp;<span class="builtintype" id="4161995">error</span><span class="op" id="4162000">)</span>&nbsp;<span class="op" id="4162002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4162005">ns</span><span class="op" id="4162007">,</span>&nbsp;<span class="ident" id="4162009">sa</span><span class="op" id="4162011">,</span>&nbsp;<span class="ident" id="4162013">err</span>&nbsp;<span class="op" id="4162017">:=</span>&nbsp;<span class="ident" id="4162020">syscall</span><span class="op" id="4162027">.</span><span class="ident" id="4162028">Accept4</span><span class="op" id="4162035">(</span><span class="ident" id="4162036">s</span><span class="op" id="4162037">,</span>&nbsp;<span class="ident" id="4162039">syscall</span><span class="op" id="4162046">.</span><span class="ident" id="4162047">SOCK_NONBLOCK</span><span class="op" id="4162060">|</span><span class="ident" id="4162061">syscall</span><span class="op" id="4162068">.</span><span class="ident" id="4162069">SOCK_CLOEXEC</span><span class="op" id="4162081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4162084">//&nbsp;On&nbsp;Linux&nbsp;the&nbsp;accept4&nbsp;system&nbsp;call&nbsp;was&nbsp;introduced&nbsp;in&nbsp;2.6.28</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4162146">//&nbsp;kernel&nbsp;and&nbsp;on&nbsp;FreeBSD&nbsp;it&nbsp;was&nbsp;introduced&nbsp;in&nbsp;10&nbsp;kernel.&nbsp;If&nbsp;we</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4162210">//&nbsp;get&nbsp;an&nbsp;ENOSYS&nbsp;error&nbsp;on&nbsp;both&nbsp;Linux&nbsp;and&nbsp;FreeBSD,&nbsp;or&nbsp;EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4162271">//&nbsp;error&nbsp;on&nbsp;Linux,&nbsp;fall&nbsp;back&nbsp;to&nbsp;using&nbsp;accept.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4162318">switch</span>&nbsp;<span class="ident" id="4162325">err</span>&nbsp;<span class="op" id="4162329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4162332">default</span><span class="op" id="4162339">:</span>&nbsp;<span class="comment" id="4162341">//&nbsp;nil&nbsp;and&nbsp;errors&nbsp;other&nbsp;than&nbsp;the&nbsp;ones&nbsp;listed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4162388">return</span>&nbsp;<span class="ident" id="4162395">ns</span><span class="op" id="4162397">,</span>&nbsp;<span class="ident" id="4162399">sa</span><span class="op" id="4162401">,</span>&nbsp;<span class="ident" id="4162403">err</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4162408">case</span>&nbsp;<span class="ident" id="4162413">syscall</span><span class="op" id="4162420">.</span><span class="ident" id="4162421">ENOSYS</span><span class="op" id="4162427">:</span>&nbsp;<span class="comment" id="4162429">//&nbsp;syscall&nbsp;missing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4162449">case</span>&nbsp;<span class="ident" id="4162454">syscall</span><span class="op" id="4162461">.</span><span class="ident" id="4162462">EINVAL</span><span class="op" id="4162468">:</span>&nbsp;<span class="comment" id="4162470">//&nbsp;some&nbsp;Linux&nbsp;use&nbsp;this&nbsp;instead&nbsp;of&nbsp;ENOSYS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4162512">case</span>&nbsp;<span class="ident" id="4162517">syscall</span><span class="op" id="4162524">.</span><span class="ident" id="4162525">EACCES</span><span class="op" id="4162531">:</span>&nbsp;<span class="comment" id="4162533">//&nbsp;some&nbsp;Linux&nbsp;use&nbsp;this&nbsp;instead&nbsp;of&nbsp;ENOSYS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4162575">case</span>&nbsp;<span class="ident" id="4162580">syscall</span><span class="op" id="4162587">.</span><span class="ident" id="4162588">EFAULT</span><span class="op" id="4162594">:</span>&nbsp;<span class="comment" id="4162596">//&nbsp;some&nbsp;Linux&nbsp;use&nbsp;this&nbsp;instead&nbsp;of&nbsp;ENOSYS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4162638">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4162642">//&nbsp;See&nbsp;../syscall/exec_unix.go&nbsp;for&nbsp;description&nbsp;of&nbsp;ForkLock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4162703">//&nbsp;It&nbsp;is&nbsp;probably&nbsp;okay&nbsp;to&nbsp;hold&nbsp;the&nbsp;lock&nbsp;across&nbsp;syscall.Accept</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4162766">//&nbsp;because&nbsp;we&nbsp;have&nbsp;put&nbsp;fd.sysfd&nbsp;into&nbsp;non-blocking&nbsp;mode.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4162823">//&nbsp;However,&nbsp;a&nbsp;call&nbsp;to&nbsp;the&nbsp;File&nbsp;method&nbsp;will&nbsp;put&nbsp;it&nbsp;back&nbsp;into</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4162884">//&nbsp;blocking&nbsp;mode.&nbsp;We&nbsp;can&#39;t&nbsp;take&nbsp;that&nbsp;risk,&nbsp;so&nbsp;no&nbsp;use&nbsp;of&nbsp;ForkLock&nbsp;here.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4162956">ns</span><span class="op" id="4162958">,</span>&nbsp;<span class="ident" id="4162960">sa</span><span class="op" id="4162962">,</span>&nbsp;<span class="ident" id="4162964">err</span>&nbsp;<span class="op" id="4162968">=</span>&nbsp;<span class="ident" id="4162970">syscall</span><span class="op" id="4162977">.</span><span class="ident" id="4162978">Accept</span><span class="op" id="4162984">(</span><span class="ident" id="4162985">s</span><span class="op" id="4162986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4162989">if</span>&nbsp;<span class="ident" id="4162992">err</span>&nbsp;<span class="op" id="4162996">==</span>&nbsp;<span class="ident" id="4162999">nil</span>&nbsp;<span class="op" id="4163003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4163007">syscall</span><span class="op" id="4163014">.</span><span class="ident" id="4163015">CloseOnExec</span><span class="op" id="4163026">(</span><span class="ident" id="4163027">ns</span><span class="op" id="4163029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4163032">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4163035">if</span>&nbsp;<span class="ident" id="4163038">err</span>&nbsp;<span class="op" id="4163042">!=</span>&nbsp;<span class="ident" id="4163045">nil</span>&nbsp;<span class="op" id="4163049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4163053">return</span>&nbsp;<span class="op" id="4163060">-</span><span class="num" id="4163061">1</span><span class="op" id="4163062">,</span>&nbsp;<span class="ident" id="4163064">nil</span><span class="op" id="4163067">,</span>&nbsp;<span class="ident" id="4163069">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4163074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4163077">if</span>&nbsp;<span class="ident" id="4163080">err</span>&nbsp;<span class="op" id="4163084">=</span>&nbsp;<span class="ident" id="4163086">syscall</span><span class="op" id="4163093">.</span><span class="ident" id="4163094">SetNonblock</span><span class="op" id="4163105">(</span><span class="ident" id="4163106">ns</span><span class="op" id="4163108">,</span>&nbsp;<span class="builtintype" id="4163110">true</span><span class="op" id="4163114">)</span><span class="op" id="4163115">;</span>&nbsp;<span class="ident" id="4163117">err</span>&nbsp;<span class="op" id="4163121">!=</span>&nbsp;<span class="ident" id="4163124">nil</span>&nbsp;<span class="op" id="4163128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4163132">syscall</span><span class="op" id="4163139">.</span><span class="ident" id="4163140">Close</span><span class="op" id="4163145">(</span><span class="ident" id="4163146">ns</span><span class="op" id="4163148">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4163152">return</span>&nbsp;<span class="op" id="4163159">-</span><span class="num" id="4163160">1</span><span class="op" id="4163161">,</span>&nbsp;<span class="ident" id="4163163">nil</span><span class="op" id="4163166">,</span>&nbsp;<span class="ident" id="4163168">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4163173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4163176">return</span>&nbsp;<span class="ident" id="4163183">ns</span><span class="op" id="4163185">,</span>&nbsp;<span class="ident" id="4163187">sa</span><span class="op" id="4163189">,</span>&nbsp;<span class="ident" id="4163191">nil</span><br>
<span class="lineno"></span><span class="op" id="4163195">}</span>
</div>
</body>
</html>
