<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>regexp/syntax</h2>
<ul>
<li><a href="/gostd/regexp/syntax/compile.go.html">compile.go</a></li>
<li><a href="/gostd/regexp/syntax/doc.go.html">doc.go</a></li>
<li><a href="/gostd/regexp/syntax/parse.go.html">parse.go</a></li>
<li><a href="/gostd/regexp/syntax/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/regexp/syntax/perl_groups.go.html">perl_groups.go</a></li>
<li><a href="/gostd/regexp/syntax/prog.go.html">prog.go</a></li>
<li><a href="/gostd/regexp/syntax/prog_test.go.html">prog_test.go</a></li>
<li><a href="/gostd/regexp/syntax/regexp.go.html">regexp.go</a></li>
<li><a href="/gostd/regexp/syntax/simplify.go.html" class="current">simplify.go</a></li>
<li><a href="/gostd/regexp/syntax/simplify_test.go.html">simplify_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5403681">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5403737">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5403791">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5403842">package</span>&nbsp;<span class="ident" id="5403850">syntax</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5403858">//&nbsp;Simplify&nbsp;returns&nbsp;a&nbsp;regexp&nbsp;equivalent&nbsp;to&nbsp;re&nbsp;but&nbsp;without&nbsp;counted&nbsp;repetitions</span><br>
<span class="lineno"></span><span class="comment" id="5403936">//&nbsp;and&nbsp;with&nbsp;various&nbsp;other&nbsp;simplifications,&nbsp;such&nbsp;as&nbsp;rewriting&nbsp;/(?:a+)+/&nbsp;to&nbsp;/a+/.</span><br>
<span class="lineno"></span><span class="comment" id="5404016">//&nbsp;The&nbsp;resulting&nbsp;regexp&nbsp;will&nbsp;execute&nbsp;correctly&nbsp;but&nbsp;its&nbsp;string&nbsp;representation</span><br>
<span class="lineno">10</span><span class="comment" id="5404093">//&nbsp;will&nbsp;not&nbsp;produce&nbsp;the&nbsp;same&nbsp;parse&nbsp;tree,&nbsp;because&nbsp;capturing&nbsp;parentheses</span><br>
<span class="lineno"></span><span class="comment" id="5404164">//&nbsp;may&nbsp;have&nbsp;been&nbsp;duplicated&nbsp;or&nbsp;removed.&nbsp;&nbsp;For&nbsp;example,&nbsp;the&nbsp;simplified&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="5404238">//&nbsp;for&nbsp;/(x){1,2}/&nbsp;is&nbsp;/(x)(x)?/&nbsp;but&nbsp;both&nbsp;parentheses&nbsp;capture&nbsp;as&nbsp;$1.</span><br>
<span class="lineno"></span><span class="comment" id="5404305">//&nbsp;The&nbsp;returned&nbsp;regexp&nbsp;may&nbsp;share&nbsp;structure&nbsp;with&nbsp;or&nbsp;be&nbsp;the&nbsp;original.</span><br>
<span class="lineno"></span><span class="keyword" id="5404373">func</span>&nbsp;<span class="op" id="5404378">(</span><span class="ident" id="5404379">re</span>&nbsp;<span class="op" id="5404382">*</span><span class="ident" id="5404383">Regexp</span><span class="op" id="5404389">)</span>&nbsp;<span class="ident" id="5404391">Simplify</span><span class="op" id="5404399">(</span><span class="op" id="5404400">)</span>&nbsp;<span class="op" id="5404402">*</span><span class="ident" id="5404403">Regexp</span>&nbsp;<span class="op" id="5404410">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5404413">if</span>&nbsp;<span class="ident" id="5404416">re</span>&nbsp;<span class="op" id="5404419">==</span>&nbsp;<span class="builtintype" id="5404422">nil</span>&nbsp;<span class="op" id="5404426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5404430">return</span>&nbsp;<span class="builtintype" id="5404437">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5404442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5404445">switch</span>&nbsp;<span class="ident" id="5404452">re</span><span class="op" id="5404454">.</span><span class="ident" id="5404455">Op</span>&nbsp;<span class="op" id="5404458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5404461">case</span>&nbsp;<span class="ident" id="5404466">OpCapture</span><span class="op" id="5404475">,</span>&nbsp;<span class="ident" id="5404477">OpConcat</span><span class="op" id="5404485">,</span>&nbsp;<span class="ident" id="5404487">OpAlternate</span><span class="op" id="5404498">:</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5404502">//&nbsp;Simplify&nbsp;children,&nbsp;building&nbsp;new&nbsp;Regexp&nbsp;if&nbsp;children&nbsp;change.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5404566">nre</span>&nbsp;<span class="op" id="5404570">:=</span>&nbsp;<span class="ident" id="5404573">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5404578">for</span>&nbsp;<span class="ident" id="5404582">i</span><span class="op" id="5404583">,</span>&nbsp;<span class="ident" id="5404585">sub</span>&nbsp;<span class="op" id="5404589">:=</span>&nbsp;<span class="keyword" id="5404592">range</span>&nbsp;<span class="ident" id="5404598">re</span><span class="op" id="5404600">.</span><span class="ident" id="5404601">Sub</span>&nbsp;<span class="op" id="5404605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5404610">nsub</span>&nbsp;<span class="op" id="5404615">:=</span>&nbsp;<span class="ident" id="5404618">sub</span><span class="op" id="5404621">.</span><span class="ident" id="5404622">Simplify</span><span class="op" id="5404630">(</span><span class="op" id="5404631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5404636">if</span>&nbsp;<span class="ident" id="5404639">nre</span>&nbsp;<span class="op" id="5404643">==</span>&nbsp;<span class="ident" id="5404646">re</span>&nbsp;<span class="op" id="5404649">&amp;&amp;</span>&nbsp;<span class="ident" id="5404652">nsub</span>&nbsp;<span class="op" id="5404657">!=</span>&nbsp;<span class="ident" id="5404660">sub</span>&nbsp;<span class="op" id="5404664">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5404670">//&nbsp;Start&nbsp;a&nbsp;copy.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5404691">nre</span>&nbsp;<span class="op" id="5404695">=</span>&nbsp;<span class="builtinfunc" id="5404697">new</span><span class="op" id="5404700">(</span><span class="ident" id="5404701">Regexp</span><span class="op" id="5404707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5404713">*</span><span class="ident" id="5404714">nre</span>&nbsp;<span class="op" id="5404718">=</span>&nbsp;<span class="op" id="5404720">*</span><span class="ident" id="5404721">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5404728">nre</span><span class="op" id="5404731">.</span><span class="ident" id="5404732">Rune</span>&nbsp;<span class="op" id="5404737">=</span>&nbsp;<span class="builtintype" id="5404739">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5404747">nre</span><span class="op" id="5404750">.</span><span class="ident" id="5404751">Sub</span>&nbsp;<span class="op" id="5404755">=</span>&nbsp;<span class="builtinfunc" id="5404757">append</span><span class="op" id="5404763">(</span><span class="ident" id="5404764">nre</span><span class="op" id="5404767">.</span><span class="ident" id="5404768">Sub0</span><span class="op" id="5404772">[</span><span class="op" id="5404773">:</span><span class="num" id="5404774">0</span><span class="op" id="5404775">]</span><span class="op" id="5404776">,</span>&nbsp;<span class="ident" id="5404778">re</span><span class="op" id="5404780">.</span><span class="ident" id="5404781">Sub</span><span class="op" id="5404784">[</span><span class="op" id="5404785">:</span><span class="ident" id="5404786">i</span><span class="op" id="5404787">]</span><span class="op" id="5404788">...</span><span class="op" id="5404791">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5404796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5404801">if</span>&nbsp;<span class="ident" id="5404804">nre</span>&nbsp;<span class="op" id="5404808">!=</span>&nbsp;<span class="ident" id="5404811">re</span>&nbsp;<span class="op" id="5404814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5404820">nre</span><span class="op" id="5404823">.</span><span class="ident" id="5404824">Sub</span>&nbsp;<span class="op" id="5404828">=</span>&nbsp;<span class="builtinfunc" id="5404830">append</span><span class="op" id="5404836">(</span><span class="ident" id="5404837">nre</span><span class="op" id="5404840">.</span><span class="ident" id="5404841">Sub</span><span class="op" id="5404844">,</span>&nbsp;<span class="ident" id="5404846">nsub</span><span class="op" id="5404850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5404855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5404859">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5404863">return</span>&nbsp;<span class="ident" id="5404870">nre</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5404876">case</span>&nbsp;<span class="ident" id="5404881">OpStar</span><span class="op" id="5404887">,</span>&nbsp;<span class="ident" id="5404889">OpPlus</span><span class="op" id="5404895">,</span>&nbsp;<span class="ident" id="5404897">OpQuest</span><span class="op" id="5404904">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5404908">sub</span>&nbsp;<span class="op" id="5404912">:=</span>&nbsp;<span class="ident" id="5404915">re</span><span class="op" id="5404917">.</span><span class="ident" id="5404918">Sub</span><span class="op" id="5404921">[</span><span class="num" id="5404922">0</span><span class="op" id="5404923">]</span><span class="op" id="5404924">.</span><span class="ident" id="5404925">Simplify</span><span class="op" id="5404933">(</span><span class="op" id="5404934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5404938">return</span>&nbsp;<span class="ident" id="5404945">simplify1</span><span class="op" id="5404954">(</span><span class="ident" id="5404955">re</span><span class="op" id="5404957">.</span><span class="ident" id="5404958">Op</span><span class="op" id="5404960">,</span>&nbsp;<span class="ident" id="5404962">re</span><span class="op" id="5404964">.</span><span class="ident" id="5404965">Flags</span><span class="op" id="5404970">,</span>&nbsp;<span class="ident" id="5404972">sub</span><span class="op" id="5404975">,</span>&nbsp;<span class="ident" id="5404977">re</span><span class="op" id="5404979">)</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5404983">case</span>&nbsp;<span class="ident" id="5404988">OpRepeat</span><span class="op" id="5404996">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5405000">//&nbsp;Special&nbsp;special&nbsp;case:&nbsp;x{0}&nbsp;matches&nbsp;the&nbsp;empty&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5405057">//&nbsp;and&nbsp;doesn&#39;t&nbsp;even&nbsp;need&nbsp;to&nbsp;consider&nbsp;x.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5405099">if</span>&nbsp;<span class="ident" id="5405102">re</span><span class="op" id="5405104">.</span><span class="ident" id="5405105">Min</span>&nbsp;<span class="op" id="5405109">==</span>&nbsp;<span class="num" id="5405112">0</span>&nbsp;<span class="op" id="5405114">&amp;&amp;</span>&nbsp;<span class="ident" id="5405117">re</span><span class="op" id="5405119">.</span><span class="ident" id="5405120">Max</span>&nbsp;<span class="op" id="5405124">==</span>&nbsp;<span class="num" id="5405127">0</span>&nbsp;<span class="op" id="5405129">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5405134">return</span>&nbsp;<span class="op" id="5405141">&amp;</span><span class="ident" id="5405142">Regexp</span><span class="op" id="5405148">{</span><span class="ident" id="5405149">Op</span><span class="op" id="5405151">:</span>&nbsp;<span class="ident" id="5405153">OpEmptyMatch</span><span class="op" id="5405165">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5405169">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5405174">//&nbsp;The&nbsp;fun&nbsp;begins.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5405195">sub</span>&nbsp;<span class="op" id="5405199">:=</span>&nbsp;<span class="ident" id="5405202">re</span><span class="op" id="5405204">.</span><span class="ident" id="5405205">Sub</span><span class="op" id="5405208">[</span><span class="num" id="5405209">0</span><span class="op" id="5405210">]</span><span class="op" id="5405211">.</span><span class="ident" id="5405212">Simplify</span><span class="op" id="5405220">(</span><span class="op" id="5405221">)</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5405226">//&nbsp;x{n,}&nbsp;means&nbsp;at&nbsp;least&nbsp;n&nbsp;matches&nbsp;of&nbsp;x.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5405268">if</span>&nbsp;<span class="ident" id="5405271">re</span><span class="op" id="5405273">.</span><span class="ident" id="5405274">Max</span>&nbsp;<span class="op" id="5405278">==</span>&nbsp;<span class="op" id="5405281">-</span><span class="num" id="5405282">1</span>&nbsp;<span class="op" id="5405284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5405289">//&nbsp;Special&nbsp;case:&nbsp;x{0,}&nbsp;is&nbsp;x*.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5405322">if</span>&nbsp;<span class="ident" id="5405325">re</span><span class="op" id="5405327">.</span><span class="ident" id="5405328">Min</span>&nbsp;<span class="op" id="5405332">==</span>&nbsp;<span class="num" id="5405335">0</span>&nbsp;<span class="op" id="5405337">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5405343">return</span>&nbsp;<span class="ident" id="5405350">simplify1</span><span class="op" id="5405359">(</span><span class="ident" id="5405360">OpStar</span><span class="op" id="5405366">,</span>&nbsp;<span class="ident" id="5405368">re</span><span class="op" id="5405370">.</span><span class="ident" id="5405371">Flags</span><span class="op" id="5405376">,</span>&nbsp;<span class="ident" id="5405378">sub</span><span class="op" id="5405381">,</span>&nbsp;<span class="builtintype" id="5405383">nil</span><span class="op" id="5405386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5405391">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5405397">//&nbsp;Special&nbsp;case:&nbsp;x{1,}&nbsp;is&nbsp;x+.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5405430">if</span>&nbsp;<span class="ident" id="5405433">re</span><span class="op" id="5405435">.</span><span class="ident" id="5405436">Min</span>&nbsp;<span class="op" id="5405440">==</span>&nbsp;<span class="num" id="5405443">1</span>&nbsp;<span class="op" id="5405445">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5405451">return</span>&nbsp;<span class="ident" id="5405458">simplify1</span><span class="op" id="5405467">(</span><span class="ident" id="5405468">OpPlus</span><span class="op" id="5405474">,</span>&nbsp;<span class="ident" id="5405476">re</span><span class="op" id="5405478">.</span><span class="ident" id="5405479">Flags</span><span class="op" id="5405484">,</span>&nbsp;<span class="ident" id="5405486">sub</span><span class="op" id="5405489">,</span>&nbsp;<span class="builtintype" id="5405491">nil</span><span class="op" id="5405494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5405499">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5405505">//&nbsp;General&nbsp;case:&nbsp;x{4,}&nbsp;is&nbsp;xxxx+.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5405541">nre</span>&nbsp;<span class="op" id="5405545">:=</span>&nbsp;<span class="op" id="5405548">&amp;</span><span class="ident" id="5405549">Regexp</span><span class="op" id="5405555">{</span><span class="ident" id="5405556">Op</span><span class="op" id="5405558">:</span>&nbsp;<span class="ident" id="5405560">OpConcat</span><span class="op" id="5405568">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5405573">nre</span><span class="op" id="5405576">.</span><span class="ident" id="5405577">Sub</span>&nbsp;<span class="op" id="5405581">=</span>&nbsp;<span class="ident" id="5405583">nre</span><span class="op" id="5405586">.</span><span class="ident" id="5405587">Sub0</span><span class="op" id="5405591">[</span><span class="op" id="5405592">:</span><span class="num" id="5405593">0</span><span class="op" id="5405594">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5405599">for</span>&nbsp;<span class="ident" id="5405603">i</span>&nbsp;<span class="op" id="5405605">:=</span>&nbsp;<span class="num" id="5405608">0</span><span class="op" id="5405609">;</span>&nbsp;<span class="ident" id="5405611">i</span>&nbsp;<span class="op" id="5405613">&lt;</span>&nbsp;<span class="ident" id="5405615">re</span><span class="op" id="5405617">.</span><span class="ident" id="5405618">Min</span><span class="op" id="5405621">-</span><span class="num" id="5405622">1</span><span class="op" id="5405623">;</span>&nbsp;<span class="ident" id="5405625">i</span><span class="op" id="5405626">++</span>&nbsp;<span class="op" id="5405629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5405635">nre</span><span class="op" id="5405638">.</span><span class="ident" id="5405639">Sub</span>&nbsp;<span class="op" id="5405643">=</span>&nbsp;<span class="builtinfunc" id="5405645">append</span><span class="op" id="5405651">(</span><span class="ident" id="5405652">nre</span><span class="op" id="5405655">.</span><span class="ident" id="5405656">Sub</span><span class="op" id="5405659">,</span>&nbsp;<span class="ident" id="5405661">sub</span><span class="op" id="5405664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5405669">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5405674">nre</span><span class="op" id="5405677">.</span><span class="ident" id="5405678">Sub</span>&nbsp;<span class="op" id="5405682">=</span>&nbsp;<span class="builtinfunc" id="5405684">append</span><span class="op" id="5405690">(</span><span class="ident" id="5405691">nre</span><span class="op" id="5405694">.</span><span class="ident" id="5405695">Sub</span><span class="op" id="5405698">,</span>&nbsp;<span class="ident" id="5405700">simplify1</span><span class="op" id="5405709">(</span><span class="ident" id="5405710">OpPlus</span><span class="op" id="5405716">,</span>&nbsp;<span class="ident" id="5405718">re</span><span class="op" id="5405720">.</span><span class="ident" id="5405721">Flags</span><span class="op" id="5405726">,</span>&nbsp;<span class="ident" id="5405728">sub</span><span class="op" id="5405731">,</span>&nbsp;<span class="builtintype" id="5405733">nil</span><span class="op" id="5405736">)</span><span class="op" id="5405737">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5405742">return</span>&nbsp;<span class="ident" id="5405749">nre</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5405755">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5405760">//&nbsp;Special&nbsp;case&nbsp;x{0}&nbsp;handled&nbsp;above.</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5405799">//&nbsp;Special&nbsp;case:&nbsp;x{1}&nbsp;is&nbsp;just&nbsp;x.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5405834">if</span>&nbsp;<span class="ident" id="5405837">re</span><span class="op" id="5405839">.</span><span class="ident" id="5405840">Min</span>&nbsp;<span class="op" id="5405844">==</span>&nbsp;<span class="num" id="5405847">1</span>&nbsp;<span class="op" id="5405849">&amp;&amp;</span>&nbsp;<span class="ident" id="5405852">re</span><span class="op" id="5405854">.</span><span class="ident" id="5405855">Max</span>&nbsp;<span class="op" id="5405859">==</span>&nbsp;<span class="num" id="5405862">1</span>&nbsp;<span class="op" id="5405864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5405869">return</span>&nbsp;<span class="ident" id="5405876">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5405882">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5405887">//&nbsp;General&nbsp;case:&nbsp;x{n,m}&nbsp;means&nbsp;n&nbsp;copies&nbsp;of&nbsp;x&nbsp;and&nbsp;m&nbsp;copies&nbsp;of&nbsp;x?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5405952">//&nbsp;The&nbsp;machine&nbsp;will&nbsp;do&nbsp;less&nbsp;work&nbsp;if&nbsp;we&nbsp;nest&nbsp;the&nbsp;final&nbsp;m&nbsp;copies,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5406018">//&nbsp;so&nbsp;that&nbsp;x{2,5}&nbsp;=&nbsp;xx(x(x(x)?)?)?</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5406056">//&nbsp;Build&nbsp;leading&nbsp;prefix:&nbsp;xx.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5406087">var</span>&nbsp;<span class="ident" id="5406091">prefix</span>&nbsp;<span class="op" id="5406098">*</span><span class="ident" id="5406099">Regexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5406108">if</span>&nbsp;<span class="ident" id="5406111">re</span><span class="op" id="5406113">.</span><span class="ident" id="5406114">Min</span>&nbsp;<span class="op" id="5406118">&gt;</span>&nbsp;<span class="num" id="5406120">0</span>&nbsp;<span class="op" id="5406122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5406127">prefix</span>&nbsp;<span class="op" id="5406134">=</span>&nbsp;<span class="op" id="5406136">&amp;</span><span class="ident" id="5406137">Regexp</span><span class="op" id="5406143">{</span><span class="ident" id="5406144">Op</span><span class="op" id="5406146">:</span>&nbsp;<span class="ident" id="5406148">OpConcat</span><span class="op" id="5406156">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5406161">prefix</span><span class="op" id="5406167">.</span><span class="ident" id="5406168">Sub</span>&nbsp;<span class="op" id="5406172">=</span>&nbsp;<span class="ident" id="5406174">prefix</span><span class="op" id="5406180">.</span><span class="ident" id="5406181">Sub0</span><span class="op" id="5406185">[</span><span class="op" id="5406186">:</span><span class="num" id="5406187">0</span><span class="op" id="5406188">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5406193">for</span>&nbsp;<span class="ident" id="5406197">i</span>&nbsp;<span class="op" id="5406199">:=</span>&nbsp;<span class="num" id="5406202">0</span><span class="op" id="5406203">;</span>&nbsp;<span class="ident" id="5406205">i</span>&nbsp;<span class="op" id="5406207">&lt;</span>&nbsp;<span class="ident" id="5406209">re</span><span class="op" id="5406211">.</span><span class="ident" id="5406212">Min</span><span class="op" id="5406215">;</span>&nbsp;<span class="ident" id="5406217">i</span><span class="op" id="5406218">++</span>&nbsp;<span class="op" id="5406221">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5406227">prefix</span><span class="op" id="5406233">.</span><span class="ident" id="5406234">Sub</span>&nbsp;<span class="op" id="5406238">=</span>&nbsp;<span class="builtinfunc" id="5406240">append</span><span class="op" id="5406246">(</span><span class="ident" id="5406247">prefix</span><span class="op" id="5406253">.</span><span class="ident" id="5406254">Sub</span><span class="op" id="5406257">,</span>&nbsp;<span class="ident" id="5406259">sub</span><span class="op" id="5406262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5406267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5406271">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5406276">//&nbsp;Build&nbsp;and&nbsp;attach&nbsp;suffix:&nbsp;(x(x(x)?)?)?</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5406319">if</span>&nbsp;<span class="ident" id="5406322">re</span><span class="op" id="5406324">.</span><span class="ident" id="5406325">Max</span>&nbsp;<span class="op" id="5406329">&gt;</span>&nbsp;<span class="ident" id="5406331">re</span><span class="op" id="5406333">.</span><span class="ident" id="5406334">Min</span>&nbsp;<span class="op" id="5406338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5406343">suffix</span>&nbsp;<span class="op" id="5406350">:=</span>&nbsp;<span class="ident" id="5406353">simplify1</span><span class="op" id="5406362">(</span><span class="ident" id="5406363">OpQuest</span><span class="op" id="5406370">,</span>&nbsp;<span class="ident" id="5406372">re</span><span class="op" id="5406374">.</span><span class="ident" id="5406375">Flags</span><span class="op" id="5406380">,</span>&nbsp;<span class="ident" id="5406382">sub</span><span class="op" id="5406385">,</span>&nbsp;<span class="builtintype" id="5406387">nil</span><span class="op" id="5406390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5406395">for</span>&nbsp;<span class="ident" id="5406399">i</span>&nbsp;<span class="op" id="5406401">:=</span>&nbsp;<span class="ident" id="5406404">re</span><span class="op" id="5406406">.</span><span class="ident" id="5406407">Min</span>&nbsp;<span class="op" id="5406411">+</span>&nbsp;<span class="num" id="5406413">1</span><span class="op" id="5406414">;</span>&nbsp;<span class="ident" id="5406416">i</span>&nbsp;<span class="op" id="5406418">&lt;</span>&nbsp;<span class="ident" id="5406420">re</span><span class="op" id="5406422">.</span><span class="ident" id="5406423">Max</span><span class="op" id="5406426">;</span>&nbsp;<span class="ident" id="5406428">i</span><span class="op" id="5406429">++</span>&nbsp;<span class="op" id="5406432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5406438">nre2</span>&nbsp;<span class="op" id="5406443">:=</span>&nbsp;<span class="op" id="5406446">&amp;</span><span class="ident" id="5406447">Regexp</span><span class="op" id="5406453">{</span><span class="ident" id="5406454">Op</span><span class="op" id="5406456">:</span>&nbsp;<span class="ident" id="5406458">OpConcat</span><span class="op" id="5406466">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5406472">nre2</span><span class="op" id="5406476">.</span><span class="ident" id="5406477">Sub</span>&nbsp;<span class="op" id="5406481">=</span>&nbsp;<span class="builtinfunc" id="5406483">append</span><span class="op" id="5406489">(</span><span class="ident" id="5406490">nre2</span><span class="op" id="5406494">.</span><span class="ident" id="5406495">Sub0</span><span class="op" id="5406499">[</span><span class="op" id="5406500">:</span><span class="num" id="5406501">0</span><span class="op" id="5406502">]</span><span class="op" id="5406503">,</span>&nbsp;<span class="ident" id="5406505">sub</span><span class="op" id="5406508">,</span>&nbsp;<span class="ident" id="5406510">suffix</span><span class="op" id="5406516">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5406522">suffix</span>&nbsp;<span class="op" id="5406529">=</span>&nbsp;<span class="ident" id="5406531">simplify1</span><span class="op" id="5406540">(</span><span class="ident" id="5406541">OpQuest</span><span class="op" id="5406548">,</span>&nbsp;<span class="ident" id="5406550">re</span><span class="op" id="5406552">.</span><span class="ident" id="5406553">Flags</span><span class="op" id="5406558">,</span>&nbsp;<span class="ident" id="5406560">nre2</span><span class="op" id="5406564">,</span>&nbsp;<span class="builtintype" id="5406566">nil</span><span class="op" id="5406569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5406574">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5406579">if</span>&nbsp;<span class="ident" id="5406582">prefix</span>&nbsp;<span class="op" id="5406589">==</span>&nbsp;<span class="builtintype" id="5406592">nil</span>&nbsp;<span class="op" id="5406596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5406602">return</span>&nbsp;<span class="ident" id="5406609">suffix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5406619">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5406624">prefix</span><span class="op" id="5406630">.</span><span class="ident" id="5406631">Sub</span>&nbsp;<span class="op" id="5406635">=</span>&nbsp;<span class="builtinfunc" id="5406637">append</span><span class="op" id="5406643">(</span><span class="ident" id="5406644">prefix</span><span class="op" id="5406650">.</span><span class="ident" id="5406651">Sub</span><span class="op" id="5406654">,</span>&nbsp;<span class="ident" id="5406656">suffix</span><span class="op" id="5406662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5406666">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5406670">if</span>&nbsp;<span class="ident" id="5406673">prefix</span>&nbsp;<span class="op" id="5406680">!=</span>&nbsp;<span class="builtintype" id="5406683">nil</span>&nbsp;<span class="op" id="5406687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5406692">return</span>&nbsp;<span class="ident" id="5406699">prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5406708">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5406713">//&nbsp;Some&nbsp;degenerate&nbsp;case&nbsp;like&nbsp;min&nbsp;&gt;&nbsp;max&nbsp;or&nbsp;min&nbsp;&lt;&nbsp;max&nbsp;&lt;&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5406772">//&nbsp;Handle&nbsp;as&nbsp;impossible&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5406805">return</span>&nbsp;<span class="op" id="5406812">&amp;</span><span class="ident" id="5406813">Regexp</span><span class="op" id="5406819">{</span><span class="ident" id="5406820">Op</span><span class="op" id="5406822">:</span>&nbsp;<span class="ident" id="5406824">OpNoMatch</span><span class="op" id="5406833">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5406836">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5406840">return</span>&nbsp;<span class="ident" id="5406847">re</span><br>
<span class="lineno"></span><span class="op" id="5406850">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5406853">//&nbsp;simplify1&nbsp;implements&nbsp;Simplify&nbsp;for&nbsp;the&nbsp;unary&nbsp;OpStar,</span><br>
<span class="lineno">120</span><span class="comment" id="5406908">//&nbsp;OpPlus,&nbsp;and&nbsp;OpQuest&nbsp;operators.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;simple&nbsp;regexp</span><br>
<span class="lineno"></span><span class="comment" id="5406972">//&nbsp;equivalent&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5406989">//</span><br>
<span class="lineno"></span><span class="comment" id="5406992">//&nbsp;&nbsp;&nbsp;&nbsp;Regexp{Op:&nbsp;op,&nbsp;Flags:&nbsp;flags,&nbsp;Sub:&nbsp;{sub}}</span><br>
<span class="lineno"></span><span class="comment" id="5407036">//</span><br>
<span class="lineno">125</span><span class="comment" id="5407039">//&nbsp;under&nbsp;the&nbsp;assumption&nbsp;that&nbsp;sub&nbsp;is&nbsp;already&nbsp;simple,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5407095">//&nbsp;without&nbsp;first&nbsp;allocating&nbsp;that&nbsp;structure.&nbsp;&nbsp;If&nbsp;the&nbsp;regexp</span><br>
<span class="lineno"></span><span class="comment" id="5407154">//&nbsp;to&nbsp;be&nbsp;returned&nbsp;turns&nbsp;out&nbsp;to&nbsp;be&nbsp;equivalent&nbsp;to&nbsp;re,&nbsp;simplify1</span><br>
<span class="lineno"></span><span class="comment" id="5407216">//&nbsp;returns&nbsp;re&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="5407239">//</span><br>
<span class="lineno">130</span><span class="comment" id="5407242">//&nbsp;simplify1&nbsp;is&nbsp;factored&nbsp;out&nbsp;of&nbsp;Simplify&nbsp;because&nbsp;the&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="5407310">//&nbsp;for&nbsp;other&nbsp;operators&nbsp;generates&nbsp;these&nbsp;unary&nbsp;expressions.</span><br>
<span class="lineno"></span><span class="comment" id="5407368">//&nbsp;Letting&nbsp;them&nbsp;call&nbsp;simplify1&nbsp;makes&nbsp;sure&nbsp;the&nbsp;expressions&nbsp;they</span><br>
<span class="lineno"></span><span class="comment" id="5407431">//&nbsp;generate&nbsp;are&nbsp;simple.</span><br>
<span class="lineno"></span><span class="keyword" id="5407455">func</span>&nbsp;<span class="ident" id="5407460">simplify1</span><span class="op" id="5407469">(</span><span class="ident" id="5407470">op</span>&nbsp;<span class="ident" id="5407473">Op</span><span class="op" id="5407475">,</span>&nbsp;<span class="ident" id="5407477">flags</span>&nbsp;<span class="ident" id="5407483">Flags</span><span class="op" id="5407488">,</span>&nbsp;<span class="ident" id="5407490">sub</span><span class="op" id="5407493">,</span>&nbsp;<span class="ident" id="5407495">re</span>&nbsp;<span class="op" id="5407498">*</span><span class="ident" id="5407499">Regexp</span><span class="op" id="5407505">)</span>&nbsp;<span class="op" id="5407507">*</span><span class="ident" id="5407508">Regexp</span>&nbsp;<span class="op" id="5407515">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5407518">//&nbsp;Special&nbsp;case:&nbsp;repeat&nbsp;the&nbsp;empty&nbsp;string&nbsp;as&nbsp;much&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5407571">//&nbsp;you&nbsp;want,&nbsp;but&nbsp;it&#39;s&nbsp;still&nbsp;the&nbsp;empty&nbsp;string.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5407618">if</span>&nbsp;<span class="ident" id="5407621">sub</span><span class="op" id="5407624">.</span><span class="ident" id="5407625">Op</span>&nbsp;<span class="op" id="5407628">==</span>&nbsp;<span class="ident" id="5407631">OpEmptyMatch</span>&nbsp;<span class="op" id="5407644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5407648">return</span>&nbsp;<span class="ident" id="5407655">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5407660">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5407663">//&nbsp;The&nbsp;operators&nbsp;are&nbsp;idempotent&nbsp;if&nbsp;the&nbsp;flags&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5407716">if</span>&nbsp;<span class="ident" id="5407719">op</span>&nbsp;<span class="op" id="5407722">==</span>&nbsp;<span class="ident" id="5407725">sub</span><span class="op" id="5407728">.</span><span class="ident" id="5407729">Op</span>&nbsp;<span class="op" id="5407732">&amp;&amp;</span>&nbsp;<span class="ident" id="5407735">flags</span><span class="op" id="5407740">&amp;</span><span class="ident" id="5407741">NonGreedy</span>&nbsp;<span class="op" id="5407751">==</span>&nbsp;<span class="ident" id="5407754">sub</span><span class="op" id="5407757">.</span><span class="ident" id="5407758">Flags</span><span class="op" id="5407763">&amp;</span><span class="ident" id="5407764">NonGreedy</span>&nbsp;<span class="op" id="5407774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5407778">return</span>&nbsp;<span class="ident" id="5407785">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5407790">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5407793">if</span>&nbsp;<span class="ident" id="5407796">re</span>&nbsp;<span class="op" id="5407799">!=</span>&nbsp;<span class="builtintype" id="5407802">nil</span>&nbsp;<span class="op" id="5407806">&amp;&amp;</span>&nbsp;<span class="ident" id="5407809">re</span><span class="op" id="5407811">.</span><span class="ident" id="5407812">Op</span>&nbsp;<span class="op" id="5407815">==</span>&nbsp;<span class="ident" id="5407818">op</span>&nbsp;<span class="op" id="5407821">&amp;&amp;</span>&nbsp;<span class="ident" id="5407824">re</span><span class="op" id="5407826">.</span><span class="ident" id="5407827">Flags</span><span class="op" id="5407832">&amp;</span><span class="ident" id="5407833">NonGreedy</span>&nbsp;<span class="op" id="5407843">==</span>&nbsp;<span class="ident" id="5407846">flags</span><span class="op" id="5407851">&amp;</span><span class="ident" id="5407852">NonGreedy</span>&nbsp;<span class="op" id="5407862">&amp;&amp;</span>&nbsp;<span class="ident" id="5407865">sub</span>&nbsp;<span class="op" id="5407869">==</span>&nbsp;<span class="ident" id="5407872">re</span><span class="op" id="5407874">.</span><span class="ident" id="5407875">Sub</span><span class="op" id="5407878">[</span><span class="num" id="5407879">0</span><span class="op" id="5407880">]</span>&nbsp;<span class="op" id="5407882">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5407886">return</span>&nbsp;<span class="ident" id="5407893">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5407897">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5407901">re</span>&nbsp;<span class="op" id="5407904">=</span>&nbsp;<span class="op" id="5407906">&amp;</span><span class="ident" id="5407907">Regexp</span><span class="op" id="5407913">{</span><span class="ident" id="5407914">Op</span><span class="op" id="5407916">:</span>&nbsp;<span class="ident" id="5407918">op</span><span class="op" id="5407920">,</span>&nbsp;<span class="ident" id="5407922">Flags</span><span class="op" id="5407927">:</span>&nbsp;<span class="ident" id="5407929">flags</span><span class="op" id="5407934">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5407937">re</span><span class="op" id="5407939">.</span><span class="ident" id="5407940">Sub</span>&nbsp;<span class="op" id="5407944">=</span>&nbsp;<span class="builtinfunc" id="5407946">append</span><span class="op" id="5407952">(</span><span class="ident" id="5407953">re</span><span class="op" id="5407955">.</span><span class="ident" id="5407956">Sub0</span><span class="op" id="5407960">[</span><span class="op" id="5407961">:</span><span class="num" id="5407962">0</span><span class="op" id="5407963">]</span><span class="op" id="5407964">,</span>&nbsp;<span class="ident" id="5407966">sub</span><span class="op" id="5407969">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5407972">return</span>&nbsp;<span class="ident" id="5407979">re</span><br>
<span class="lineno"></span><span class="op" id="5407982">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
