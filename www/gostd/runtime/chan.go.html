<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html" class="current">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1491782">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1491837">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1491891">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1491942">package</span>&nbsp;<span class="ident" id="1491950">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1491959">//&nbsp;This&nbsp;file&nbsp;contains&nbsp;the&nbsp;implementation&nbsp;of&nbsp;Go&nbsp;channels.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1492017">import</span>&nbsp;<span class="string" id="1492024">&#34;unsafe&#34;</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1492034">const</span>&nbsp;<span class="op" id="1492040">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1492043">maxAlign</span>&nbsp;&nbsp;<span class="op" id="1492053">=</span>&nbsp;<span class="num" id="1492055">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1492058">hchanSize</span>&nbsp;<span class="op" id="1492068">=</span>&nbsp;<span class="ident" id="1492070"><a href="/gostd/runtime/chan.go.html#1492024">unsafe</a></span><span class="op" id="1492076">.</span><span class="ident" id="1492077">Sizeof</span><span class="op" id="1492083">(</span><span class="ident" id="1492084"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796621">hchan</a></span><span class="op" id="1492089">{</span><span class="op" id="1492090">}</span><span class="op" id="1492091">)</span>&nbsp;<span class="op" id="1492093">+</span>&nbsp;<span class="builtintype" id="1492095">uintptr</span><span class="op" id="1492102">(</span><span class="op" id="1492103">-</span><span class="builtintype" id="1492104">int</span><span class="op" id="1492107">(</span><span class="ident" id="1492108"><a href="/gostd/runtime/chan.go.html#1492024">unsafe</a></span><span class="op" id="1492114">.</span><span class="ident" id="1492115">Sizeof</span><span class="op" id="1492121">(</span><span class="ident" id="1492122"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796621">hchan</a></span><span class="op" id="1492127">{</span><span class="op" id="1492128">}</span><span class="op" id="1492129">)</span><span class="op" id="1492130">)</span><span class="op" id="1492131">&amp;</span><span class="op" id="1492132">(</span><span class="ident" id="1492133"><a href="/gostd/runtime/chan.go.html#1492043">maxAlign</a></span><span class="op" id="1492141">-</span><span class="num" id="1492142">1</span><span class="op" id="1492143">)</span><span class="op" id="1492144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1492147">debugChan</span>&nbsp;<span class="op" id="1492157">=</span>&nbsp;<span class="builtintype" id="1492159">false</span><br>
<span class="lineno">15</span><span class="op" id="1492165">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1492168">//&nbsp;TODO(khr):&nbsp;make&nbsp;hchan.buf&nbsp;an&nbsp;unsafe.Pointer,&nbsp;not&nbsp;a&nbsp;*uint8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1492230">func</span>&nbsp;<span class="ident" id="1492235">makechan</span><span class="op" id="1492243">(</span><span class="ident" id="1492244">t</span>&nbsp;<span class="op" id="1492246">*</span><span class="ident" id="1492247"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796332">chantype</a></span><span class="op" id="1492255">,</span>&nbsp;<span class="ident" id="1492257">size</span>&nbsp;<span class="builtintype" id="1492262">int64</span><span class="op" id="1492267">)</span>&nbsp;<span class="op" id="1492269">*</span><span class="ident" id="1492270"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796621">hchan</a></span>&nbsp;<span class="op" id="1492276">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1492279">elem</span>&nbsp;<span class="op" id="1492284">:=</span>&nbsp;<span class="ident" id="1492287"><a href="/gostd/runtime/chan.go.html#1492244">t</a></span><span class="op" id="1492288">.</span><span class="ident" id="1492289"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796362">elem</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1492296">//&nbsp;compiler&nbsp;checks&nbsp;this&nbsp;but&nbsp;be&nbsp;safe.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1492334">if</span>&nbsp;<span class="ident" id="1492337"><a href="/gostd/runtime/chan.go.html#1492279">elem</a></span><span class="op" id="1492341">.</span><span class="ident" id="1492342"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795621">size</a></span>&nbsp;<span class="op" id="1492347">&gt;=</span>&nbsp;<span class="num" id="1492350">1</span><span class="op" id="1492351">&lt;&lt;</span><span class="num" id="1492353">16</span>&nbsp;<span class="op" id="1492356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1492360"><a href="/gostd/runtime/panic.go.html#1664327">gothrow</a></span><span class="op" id="1492367">(</span><span class="string" id="1492368">&#34;makechan:&nbsp;invalid&nbsp;channel&nbsp;element&nbsp;type&#34;</span><span class="op" id="1492408">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1492411">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1492414">if</span>&nbsp;<span class="ident" id="1492417"><a href="/gostd/runtime/chan.go.html#1492058">hchanSize</a></span><span class="op" id="1492426">%</span><span class="ident" id="1492427"><a href="/gostd/runtime/chan.go.html#1492043">maxAlign</a></span>&nbsp;<span class="op" id="1492436">!=</span>&nbsp;<span class="num" id="1492439">0</span>&nbsp;<span class="op" id="1492441">||</span>&nbsp;<span class="ident" id="1492444"><a href="/gostd/runtime/chan.go.html#1492279">elem</a></span><span class="op" id="1492448">.</span><span class="ident" id="1492449"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795663">align</a></span>&nbsp;<span class="op" id="1492455">&gt;</span>&nbsp;<span class="ident" id="1492457"><a href="/gostd/runtime/chan.go.html#1492043">maxAlign</a></span>&nbsp;<span class="op" id="1492466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1492470"><a href="/gostd/runtime/panic.go.html#1664327">gothrow</a></span><span class="op" id="1492477">(</span><span class="string" id="1492478">&#34;makechan:&nbsp;bad&nbsp;alignment&#34;</span><span class="op" id="1492503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1492506">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1492509">if</span>&nbsp;<span class="ident" id="1492512"><a href="/gostd/runtime/chan.go.html#1492257">size</a></span>&nbsp;<span class="op" id="1492517">&lt;</span>&nbsp;<span class="num" id="1492519">0</span>&nbsp;<span class="op" id="1492521">||</span>&nbsp;<span class="builtintype" id="1492524">int64</span><span class="op" id="1492529">(</span><span class="builtintype" id="1492530">uintptr</span><span class="op" id="1492537">(</span><span class="ident" id="1492538"><a href="/gostd/runtime/chan.go.html#1492257">size</a></span><span class="op" id="1492542">)</span><span class="op" id="1492543">)</span>&nbsp;<span class="op" id="1492545">!=</span>&nbsp;<span class="ident" id="1492548"><a href="/gostd/runtime/chan.go.html#1492257">size</a></span>&nbsp;<span class="op" id="1492553">||</span>&nbsp;<span class="op" id="1492556">(</span><span class="ident" id="1492557"><a href="/gostd/runtime/chan.go.html#1492279">elem</a></span><span class="op" id="1492561">.</span><span class="ident" id="1492562"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795621">size</a></span>&nbsp;<span class="op" id="1492567">&gt;</span>&nbsp;<span class="num" id="1492569">0</span>&nbsp;<span class="op" id="1492571">&amp;&amp;</span>&nbsp;<span class="builtintype" id="1492574">uintptr</span><span class="op" id="1492581">(</span><span class="ident" id="1492582"><a href="/gostd/runtime/chan.go.html#1492257">size</a></span><span class="op" id="1492586">)</span>&nbsp;<span class="op" id="1492588">&gt;</span>&nbsp;<span class="op" id="1492590">(</span><span class="ident" id="1492591"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1801888">maxmem</a></span><span class="op" id="1492597">-</span><span class="ident" id="1492598"><a href="/gostd/runtime/chan.go.html#1492058">hchanSize</a></span><span class="op" id="1492607">)</span><span class="op" id="1492608">/</span><span class="builtintype" id="1492609">uintptr</span><span class="op" id="1492616">(</span><span class="ident" id="1492617"><a href="/gostd/runtime/chan.go.html#1492279">elem</a></span><span class="op" id="1492621">.</span><span class="ident" id="1492622"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795621">size</a></span><span class="op" id="1492626">)</span><span class="op" id="1492627">)</span>&nbsp;<span class="op" id="1492629">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1492633">panic</span><span class="op" id="1492638">(</span><span class="string" id="1492639">&#34;makechan:&nbsp;size&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1492668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1492671">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1492675">var</span>&nbsp;<span class="ident" id="1492679">c</span>&nbsp;<span class="op" id="1492681">*</span><span class="ident" id="1492682"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796621">hchan</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1492689">if</span>&nbsp;<span class="ident" id="1492692"><a href="/gostd/runtime/chan.go.html#1492279">elem</a></span><span class="op" id="1492696">.</span><span class="ident" id="1492697"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795694">kind</a></span><span class="op" id="1492701">&amp;</span><span class="ident" id="1492702"><a href="/gostd/runtime/typekind.go.html#1785247">kindNoPointers</a></span>&nbsp;<span class="op" id="1492717">!=</span>&nbsp;<span class="num" id="1492720">0</span>&nbsp;<span class="op" id="1492722">||</span>&nbsp;<span class="ident" id="1492725"><a href="/gostd/runtime/chan.go.html#1492257">size</a></span>&nbsp;<span class="op" id="1492730">==</span>&nbsp;<span class="num" id="1492733">0</span>&nbsp;<span class="op" id="1492735">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1492739">//&nbsp;Allocate&nbsp;memory&nbsp;in&nbsp;one&nbsp;call.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1492773">//&nbsp;Hchan&nbsp;does&nbsp;not&nbsp;contain&nbsp;pointers&nbsp;interesting&nbsp;for&nbsp;GC&nbsp;in&nbsp;this&nbsp;case:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1492843">//&nbsp;buf&nbsp;points&nbsp;into&nbsp;the&nbsp;same&nbsp;allocation,&nbsp;elemtype&nbsp;is&nbsp;persistent.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1492909">//&nbsp;SudoG&#39;s&nbsp;are&nbsp;referenced&nbsp;from&nbsp;their&nbsp;owning&nbsp;thread&nbsp;so&nbsp;they&nbsp;can&#39;t&nbsp;be&nbsp;collected.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1492990">//&nbsp;TODO(dvyukov,rlh):&nbsp;Rethink&nbsp;when&nbsp;collector&nbsp;can&nbsp;move&nbsp;allocated&nbsp;objects.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1493065"><a href="/gostd/runtime/chan.go.html#1492679">c</a></span>&nbsp;<span class="op" id="1493067">=</span>&nbsp;<span class="op" id="1493069">(</span><span class="op" id="1493070">*</span><span class="ident" id="1493071"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796621">hchan</a></span><span class="op" id="1493076">)</span><span class="op" id="1493077">(</span><span class="ident" id="1493078"><a href="/gostd/runtime/malloc.go.html#1589627">mallocgc</a></span><span class="op" id="1493086">(</span><span class="ident" id="1493087"><a href="/gostd/runtime/chan.go.html#1492058">hchanSize</a></span><span class="op" id="1493096">+</span><span class="builtintype" id="1493097">uintptr</span><span class="op" id="1493104">(</span><span class="ident" id="1493105"><a href="/gostd/runtime/chan.go.html#1492257">size</a></span><span class="op" id="1493109">)</span><span class="op" id="1493110">*</span><span class="builtintype" id="1493111">uintptr</span><span class="op" id="1493118">(</span><span class="ident" id="1493119"><a href="/gostd/runtime/chan.go.html#1492279">elem</a></span><span class="op" id="1493123">.</span><span class="ident" id="1493124"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795621">size</a></span><span class="op" id="1493128">)</span><span class="op" id="1493129">,</span>&nbsp;<span class="builtintype" id="1493131">nil</span><span class="op" id="1493134">,</span>&nbsp;<span class="ident" id="1493136"><a href="/gostd/runtime/malloc.go.html#1588855">flagNoScan</a></span><span class="op" id="1493146">)</span><span class="op" id="1493147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1493151">if</span>&nbsp;<span class="ident" id="1493154"><a href="/gostd/runtime/chan.go.html#1492257">size</a></span>&nbsp;<span class="op" id="1493159">&gt;</span>&nbsp;<span class="num" id="1493161">0</span>&nbsp;<span class="op" id="1493163">&amp;&amp;</span>&nbsp;<span class="ident" id="1493166"><a href="/gostd/runtime/chan.go.html#1492279">elem</a></span><span class="op" id="1493170">.</span><span class="ident" id="1493171"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795621">size</a></span>&nbsp;<span class="op" id="1493176">!=</span>&nbsp;<span class="num" id="1493179">0</span>&nbsp;<span class="op" id="1493181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1493186"><a href="/gostd/runtime/chan.go.html#1492679">c</a></span><span class="op" id="1493187">.</span><span class="ident" id="1493188"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796665">buf</a></span>&nbsp;<span class="op" id="1493192">=</span>&nbsp;<span class="op" id="1493194">(</span><span class="op" id="1493195">*</span><span class="builtintype" id="1493196">uint8</span><span class="op" id="1493201">)</span><span class="op" id="1493202">(</span><span class="ident" id="1493203"><a href="/gostd/runtime/stubs.go.html#1738643">add</a></span><span class="op" id="1493206">(</span><span class="ident" id="1493207"><a href="/gostd/runtime/chan.go.html#1492024">unsafe</a></span><span class="op" id="1493213">.</span><span class="ident" id="1493214">Pointer</span><span class="op" id="1493221">(</span><span class="ident" id="1493222"><a href="/gostd/runtime/chan.go.html#1492679">c</a></span><span class="op" id="1493223">)</span><span class="op" id="1493224">,</span>&nbsp;<span class="ident" id="1493226"><a href="/gostd/runtime/chan.go.html#1492058">hchanSize</a></span><span class="op" id="1493235">)</span><span class="op" id="1493236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1493240">}</span>&nbsp;<span class="keyword" id="1493242">else</span>&nbsp;<span class="op" id="1493247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1493252"><a href="/gostd/runtime/chan.go.html#1492679">c</a></span><span class="op" id="1493253">.</span><span class="ident" id="1493254"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796665">buf</a></span>&nbsp;<span class="op" id="1493258">=</span>&nbsp;<span class="op" id="1493260">(</span><span class="op" id="1493261">*</span><span class="builtintype" id="1493262">uint8</span><span class="op" id="1493267">)</span><span class="op" id="1493268">(</span><span class="ident" id="1493269"><a href="/gostd/runtime/chan.go.html#1492024">unsafe</a></span><span class="op" id="1493275">.</span><span class="ident" id="1493276">Pointer</span><span class="op" id="1493283">(</span><span class="ident" id="1493284"><a href="/gostd/runtime/chan.go.html#1492679">c</a></span><span class="op" id="1493285">)</span><span class="op" id="1493286">)</span>&nbsp;<span class="comment" id="1493288">//&nbsp;race&nbsp;detector&nbsp;uses&nbsp;this&nbsp;location&nbsp;for&nbsp;synchronization</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1493346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1493349">}</span>&nbsp;<span class="keyword" id="1493351">else</span>&nbsp;<span class="op" id="1493356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1493360"><a href="/gostd/runtime/chan.go.html#1492679">c</a></span>&nbsp;<span class="op" id="1493362">=</span>&nbsp;<span class="builtinfunc" id="1493364">new</span><span class="op" id="1493367">(</span><span class="ident" id="1493368"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796621">hchan</a></span><span class="op" id="1493373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1493377"><a href="/gostd/runtime/chan.go.html#1492679">c</a></span><span class="op" id="1493378">.</span><span class="ident" id="1493379"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796665">buf</a></span>&nbsp;<span class="op" id="1493383">=</span>&nbsp;<span class="op" id="1493385">(</span><span class="op" id="1493386">*</span><span class="builtintype" id="1493387">uint8</span><span class="op" id="1493392">)</span><span class="op" id="1493393">(</span><span class="ident" id="1493394"><a href="/gostd/runtime/malloc.go.html#1598768">newarray</a></span><span class="op" id="1493402">(</span><span class="ident" id="1493403"><a href="/gostd/runtime/chan.go.html#1492279">elem</a></span><span class="op" id="1493407">,</span>&nbsp;<span class="builtintype" id="1493409">uintptr</span><span class="op" id="1493416">(</span><span class="ident" id="1493417"><a href="/gostd/runtime/chan.go.html#1492257">size</a></span><span class="op" id="1493421">)</span><span class="op" id="1493422">)</span><span class="op" id="1493423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1493426">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1493429"><a href="/gostd/runtime/chan.go.html#1492679">c</a></span><span class="op" id="1493430">.</span><span class="ident" id="1493431"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796676">elemsize</a></span>&nbsp;<span class="op" id="1493440">=</span>&nbsp;<span class="builtintype" id="1493442">uint16</span><span class="op" id="1493448">(</span><span class="ident" id="1493449"><a href="/gostd/runtime/chan.go.html#1492279">elem</a></span><span class="op" id="1493453">.</span><span class="ident" id="1493454"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795621">size</a></span><span class="op" id="1493458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1493461"><a href="/gostd/runtime/chan.go.html#1492679">c</a></span><span class="op" id="1493462">.</span><span class="ident" id="1493463"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796708">elemtype</a></span>&nbsp;<span class="op" id="1493472">=</span>&nbsp;<span class="ident" id="1493474"><a href="/gostd/runtime/chan.go.html#1492279">elem</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1493480"><a href="/gostd/runtime/chan.go.html#1492679">c</a></span><span class="op" id="1493481">.</span><span class="ident" id="1493482"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796650">dataqsiz</a></span>&nbsp;<span class="op" id="1493491">=</span>&nbsp;<span class="builtintype" id="1493493">uint</span><span class="op" id="1493497">(</span><span class="ident" id="1493498"><a href="/gostd/runtime/chan.go.html#1492257">size</a></span><span class="op" id="1493502">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1493506">if</span>&nbsp;<span class="ident" id="1493509"><a href="/gostd/runtime/chan.go.html#1492147">debugChan</a></span>&nbsp;<span class="op" id="1493519">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1493523">print</span><span class="op" id="1493528">(</span><span class="string" id="1493529">&#34;makechan:&nbsp;chan=&#34;</span><span class="op" id="1493546">,</span>&nbsp;<span class="ident" id="1493548"><a href="/gostd/runtime/chan.go.html#1492679">c</a></span><span class="op" id="1493549">,</span>&nbsp;<span class="string" id="1493551">&#34;;&nbsp;elemsize=&#34;</span><span class="op" id="1493564">,</span>&nbsp;<span class="ident" id="1493566"><a href="/gostd/runtime/chan.go.html#1492279">elem</a></span><span class="op" id="1493570">.</span><span class="ident" id="1493571"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795621">size</a></span><span class="op" id="1493575">,</span>&nbsp;<span class="string" id="1493577">&#34;;&nbsp;elemalg=&#34;</span><span class="op" id="1493589">,</span>&nbsp;<span class="ident" id="1493591"><a href="/gostd/runtime/chan.go.html#1492279">elem</a></span><span class="op" id="1493595">.</span><span class="ident" id="1493596"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1795706">alg</a></span><span class="op" id="1493599">,</span>&nbsp;<span class="string" id="1493601">&#34;;&nbsp;dataqsiz=&#34;</span><span class="op" id="1493614">,</span>&nbsp;<span class="ident" id="1493616"><a href="/gostd/runtime/chan.go.html#1492257">size</a></span><span class="op" id="1493620">,</span>&nbsp;<span class="string" id="1493622">&#34;\n&#34;</span><span class="op" id="1493626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1493629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1493632">return</span>&nbsp;<span class="ident" id="1493639"><a href="/gostd/runtime/chan.go.html#1492679">c</a></span><br>
<span class="lineno"></span><span class="op" id="1493641">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="1493644">//&nbsp;chanbuf(c,&nbsp;i)&nbsp;is&nbsp;pointer&nbsp;to&nbsp;the&nbsp;i&#39;th&nbsp;slot&nbsp;in&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="1493704">func</span>&nbsp;<span class="ident" id="1493709">chanbuf</span><span class="op" id="1493716">(</span><span class="ident" id="1493717">c</span>&nbsp;<span class="op" id="1493719">*</span><span class="ident" id="1493720"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796621">hchan</a></span><span class="op" id="1493725">,</span>&nbsp;<span class="ident" id="1493727">i</span>&nbsp;<span class="builtintype" id="1493729">uint</span><span class="op" id="1493733">)</span>&nbsp;<span class="ident" id="1493735"><a href="/gostd/runtime/chan.go.html#1492024">unsafe</a></span><span class="op" id="1493741">.</span><span class="ident" id="1493742">Pointer</span>&nbsp;<span class="op" id="1493750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1493753">return</span>&nbsp;<span class="ident" id="1493760"><a href="/gostd/runtime/stubs.go.html#1738643">add</a></span><span class="op" id="1493763">(</span><span class="ident" id="1493764"><a href="/gostd/runtime/chan.go.html#1492024">unsafe</a></span><span class="op" id="1493770">.</span><span class="ident" id="1493771">Pointer</span><span class="op" id="1493778">(</span><span class="ident" id="1493779"><a href="/gostd/runtime/chan.go.html#1493717">c</a></span><span class="op" id="1493780">.</span><span class="ident" id="1493781"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796665">buf</a></span><span class="op" id="1493784">)</span><span class="op" id="1493785">,</span>&nbsp;<span class="builtintype" id="1493787">uintptr</span><span class="op" id="1493794">(</span><span class="ident" id="1493795"><a href="/gostd/runtime/chan.go.html#1493727">i</a></span><span class="op" id="1493796">)</span><span class="op" id="1493797">*</span><span class="builtintype" id="1493798">uintptr</span><span class="op" id="1493805">(</span><span class="ident" id="1493806"><a href="/gostd/runtime/chan.go.html#1493717">c</a></span><span class="op" id="1493807">.</span><span class="ident" id="1493808"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796676">elemsize</a></span><span class="op" id="1493816">)</span><span class="op" id="1493817">)</span><br>
<span class="lineno"></span><span class="op" id="1493819">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="1493822">//&nbsp;entry&nbsp;point&nbsp;for&nbsp;c&nbsp;&lt;-&nbsp;x&nbsp;from&nbsp;compiled&nbsp;code</span><br>
<span class="lineno"></span><span class="comment" id="1493867">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1493880">func</span>&nbsp;<span class="ident" id="1493885">chansend1</span><span class="op" id="1493894">(</span><span class="ident" id="1493895">t</span>&nbsp;<span class="op" id="1493897">*</span><span class="ident" id="1493898"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796332">chantype</a></span><span class="op" id="1493906">,</span>&nbsp;<span class="ident" id="1493908">c</span>&nbsp;<span class="op" id="1493910">*</span><span class="ident" id="1493911"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796621">hchan</a></span><span class="op" id="1493916">,</span>&nbsp;<span class="ident" id="1493918">elem</span>&nbsp;<span class="ident" id="1493923"><a href="/gostd/runtime/chan.go.html#1492024">unsafe</a></span><span class="op" id="1493929">.</span><span class="ident" id="1493930">Pointer</span><span class="op" id="1493937">)</span>&nbsp;<span class="op" id="1493939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1493942"><a href="/gostd/runtime/chan.go.html#1494344">chansend</a></span><span class="op" id="1493950">(</span><span class="ident" id="1493951"><a href="/gostd/runtime/chan.go.html#1493895">t</a></span><span class="op" id="1493952">,</span>&nbsp;<span class="ident" id="1493954"><a href="/gostd/runtime/chan.go.html#1493908">c</a></span><span class="op" id="1493955">,</span>&nbsp;<span class="ident" id="1493957"><a href="/gostd/runtime/chan.go.html#1493918">elem</a></span><span class="op" id="1493961">,</span>&nbsp;<span class="builtintype" id="1493963">true</span><span class="op" id="1493967">,</span>&nbsp;<span class="ident" id="1493969"><a href="/gostd/runtime/stubs.go.html#1746397">getcallerpc</a></span><span class="op" id="1493980">(</span><span class="ident" id="1493981"><a href="/gostd/runtime/chan.go.html#1492024">unsafe</a></span><span class="op" id="1493987">.</span><span class="ident" id="1493988">Pointer</span><span class="op" id="1493995">(</span><span class="op" id="1493996">&amp;</span><span class="ident" id="1493997"><a href="/gostd/runtime/chan.go.html#1493895">t</a></span><span class="op" id="1493998">)</span><span class="op" id="1493999">)</span><span class="op" id="1494000">)</span><br>
<span class="lineno"></span><span class="op" id="1494002">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="1494005">/*<br>
<span class="lineno"></span>&nbsp;*&nbsp;generic&nbsp;single&nbsp;channel&nbsp;send/recv<br>
<span class="lineno"></span>&nbsp;*&nbsp;If&nbsp;block&nbsp;is&nbsp;not&nbsp;nil,<br>
<span class="lineno"></span>&nbsp;*&nbsp;then&nbsp;the&nbsp;protocol&nbsp;will&nbsp;not<br>
<span class="lineno">75</span>&nbsp;*&nbsp;sleep&nbsp;but&nbsp;return&nbsp;if&nbsp;it&nbsp;could<br>
<span class="lineno"></span>&nbsp;*&nbsp;not&nbsp;complete.<br>
<span class="lineno"></span>&nbsp;*<br>
<span class="lineno"></span>&nbsp;*&nbsp;sleep&nbsp;can&nbsp;wake&nbsp;up&nbsp;with&nbsp;g.param&nbsp;==&nbsp;nil<br>
<span class="lineno"></span>&nbsp;*&nbsp;when&nbsp;a&nbsp;channel&nbsp;involved&nbsp;in&nbsp;the&nbsp;sleep&nbsp;has<br>
<span class="lineno">80</span>&nbsp;*&nbsp;been&nbsp;closed.&nbsp;&nbsp;it&nbsp;is&nbsp;easiest&nbsp;to&nbsp;loop&nbsp;and&nbsp;re-run<br>
<span class="lineno"></span>&nbsp;*&nbsp;the&nbsp;operation;&nbsp;we&#39;ll&nbsp;see&nbsp;that&nbsp;it&#39;s&nbsp;now&nbsp;closed.<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><span class="keyword" id="1494339">func</span>&nbsp;<span class="ident" id="1494344">chansend</span><span class="op" id="1494352">(</span><span class="ident" id="1494353">t</span>&nbsp;<span class="op" id="1494355">*</span><span class="ident" id="1494356"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796332">chantype</a></span><span class="op" id="1494364">,</span>&nbsp;<span class="ident" id="1494366">c</span>&nbsp;<span class="op" id="1494368">*</span><span class="ident" id="1494369"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796621">hchan</a></span><span class="op" id="1494374">,</span>&nbsp;<span class="ident" id="1494376">ep</span>&nbsp;<span class="ident" id="1494379"><a href="/gostd/runtime/chan.go.html#1492024">unsafe</a></span><span class="op" id="1494385">.</span><span class="ident" id="1494386">Pointer</span><span class="op" id="1494393">,</span>&nbsp;<span class="ident" id="1494395">block</span>&nbsp;<span class="builtintype" id="1494401">bool</span><span class="op" id="1494405">,</span>&nbsp;<span class="ident" id="1494407">callerpc</span>&nbsp;<span class="builtintype" id="1494416">uintptr</span><span class="op" id="1494423">)</span>&nbsp;<span class="builtintype" id="1494425">bool</span>&nbsp;<span class="op" id="1494430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1494433">if</span>&nbsp;<span class="ident" id="1494436"><a href="/gostd/runtime/race0.go.html#1676514">raceenabled</a></span>&nbsp;<span class="op" id="1494448">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1494452"><a href="/gostd/runtime/race0.go.html#1676616">raceReadObjectPC</a></span><span class="op" id="1494468">(</span><span class="ident" id="1494469"><a href="/gostd/runtime/chan.go.html#1494353">t</a></span><span class="op" id="1494470">.</span><span class="ident" id="1494471"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796362">elem</a></span><span class="op" id="1494475">,</span>&nbsp;<span class="ident" id="1494477"><a href="/gostd/runtime/chan.go.html#1494376">ep</a></span><span class="op" id="1494479">,</span>&nbsp;<span class="ident" id="1494481"><a href="/gostd/runtime/chan.go.html#1494407">callerpc</a></span><span class="op" id="1494489">,</span>&nbsp;<span class="ident" id="1494491"><a href="/gostd/runtime/proc.go.html#1675458">funcPC</a></span><span class="op" id="1494497">(</span><span class="ident" id="1494498"><a href="/gostd/runtime/chan.go.html#1494344">chansend</a></span><span class="op" id="1494506">)</span><span class="op" id="1494507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1494510">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1494514">if</span>&nbsp;<span class="ident" id="1494517"><a href="/gostd/runtime/chan.go.html#1494366">c</a></span>&nbsp;<span class="op" id="1494519">==</span>&nbsp;<span class="builtintype" id="1494522">nil</span>&nbsp;<span class="op" id="1494526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1494530">if</span>&nbsp;<span class="op" id="1494533">!</span><span class="ident" id="1494534"><a href="/gostd/runtime/chan.go.html#1494395">block</a></span>&nbsp;<span class="op" id="1494540">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1494545">return</span>&nbsp;<span class="builtintype" id="1494552">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1494560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1494564"><a href="/gostd/runtime/proc.go.html#1673271">gopark</a></span><span class="op" id="1494570">(</span><span class="builtintype" id="1494571">nil</span><span class="op" id="1494574">,</span>&nbsp;<span class="builtintype" id="1494576">nil</span><span class="op" id="1494579">,</span>&nbsp;<span class="string" id="1494581">&#34;chan&nbsp;send&nbsp;(nil&nbsp;chan)&#34;</span><span class="op" id="1494603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1494607"><a href="/gostd/runtime/panic.go.html#1664327">gothrow</a></span><span class="op" id="1494614">(</span><span class="string" id="1494615">&#34;unreachable&#34;</span><span class="op" id="1494628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1494631">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1494635">if</span>&nbsp;<span class="ident" id="1494638"><a href="/gostd/runtime/chan.go.html#1492147">debugChan</a></span>&nbsp;<span class="op" id="1494648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1494652">print</span><span class="op" id="1494657">(</span><span class="string" id="1494658">&#34;chansend:&nbsp;chan=&#34;</span><span class="op" id="1494675">,</span>&nbsp;<span class="ident" id="1494677"><a href="/gostd/runtime/chan.go.html#1494366">c</a></span><span class="op" id="1494678">,</span>&nbsp;<span class="string" id="1494680">&#34;\n&#34;</span><span class="op" id="1494684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1494687">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1494691">if</span>&nbsp;<span class="ident" id="1494694"><a href="/gostd/runtime/race0.go.html#1676514">raceenabled</a></span>&nbsp;<span class="op" id="1494706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1494710"><a href="/gostd/runtime/race0.go.html#1677192">racereadpc</a></span><span class="op" id="1494720">(</span><span class="ident" id="1494721"><a href="/gostd/runtime/chan.go.html#1492024">unsafe</a></span><span class="op" id="1494727">.</span><span class="ident" id="1494728">Pointer</span><span class="op" id="1494735">(</span><span class="ident" id="1494736"><a href="/gostd/runtime/chan.go.html#1494366">c</a></span><span class="op" id="1494737">)</span><span class="op" id="1494738">,</span>&nbsp;<span class="ident" id="1494740"><a href="/gostd/runtime/chan.go.html#1494407">callerpc</a></span><span class="op" id="1494748">,</span>&nbsp;<span class="ident" id="1494750"><a href="/gostd/runtime/proc.go.html#1675458">funcPC</a></span><span class="op" id="1494756">(</span><span class="ident" id="1494757"><a href="/gostd/runtime/chan.go.html#1494344">chansend</a></span><span class="op" id="1494765">)</span><span class="op" id="1494766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1494769">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1494773">//&nbsp;Fast&nbsp;path:&nbsp;check&nbsp;for&nbsp;failed&nbsp;non-blocking&nbsp;operation&nbsp;without&nbsp;acquiring&nbsp;the&nbsp;lock.</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1494856">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1494860">//&nbsp;After&nbsp;observing&nbsp;that&nbsp;the&nbsp;channel&nbsp;is&nbsp;not&nbsp;closed,&nbsp;we&nbsp;observe&nbsp;that&nbsp;the&nbsp;channel&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1494943">//&nbsp;not&nbsp;ready&nbsp;for&nbsp;sending.&nbsp;Each&nbsp;of&nbsp;these&nbsp;observations&nbsp;is&nbsp;a&nbsp;single&nbsp;word-sized&nbsp;read</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1495025">//&nbsp;(first&nbsp;c.closed&nbsp;and&nbsp;second&nbsp;c.recvq.first&nbsp;or&nbsp;c.qcount&nbsp;depending&nbsp;on&nbsp;kind&nbsp;of&nbsp;channel).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1495113">//&nbsp;Because&nbsp;a&nbsp;closed&nbsp;channel&nbsp;cannot&nbsp;transition&nbsp;from&nbsp;&#39;ready&nbsp;for&nbsp;sending&#39;&nbsp;to</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1495188">//&nbsp;&#39;not&nbsp;ready&nbsp;for&nbsp;sending&#39;,&nbsp;even&nbsp;if&nbsp;the&nbsp;channel&nbsp;is&nbsp;closed&nbsp;between&nbsp;the&nbsp;two&nbsp;observations,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1495277">//&nbsp;they&nbsp;imply&nbsp;a&nbsp;moment&nbsp;between&nbsp;the&nbsp;two&nbsp;when&nbsp;the&nbsp;channel&nbsp;was&nbsp;both&nbsp;not&nbsp;yet&nbsp;closed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1495358">//&nbsp;and&nbsp;not&nbsp;ready&nbsp;for&nbsp;sending.&nbsp;We&nbsp;behave&nbsp;as&nbsp;if&nbsp;we&nbsp;observed&nbsp;the&nbsp;channel&nbsp;at&nbsp;that&nbsp;moment,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1495445">//&nbsp;and&nbsp;report&nbsp;that&nbsp;the&nbsp;send&nbsp;cannot&nbsp;proceed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1495490">//</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1495494">//&nbsp;It&nbsp;is&nbsp;okay&nbsp;if&nbsp;the&nbsp;reads&nbsp;are&nbsp;reordered&nbsp;here:&nbsp;if&nbsp;we&nbsp;observe&nbsp;that&nbsp;the&nbsp;channel&nbsp;is&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1495580">//&nbsp;ready&nbsp;for&nbsp;sending&nbsp;and&nbsp;then&nbsp;observe&nbsp;that&nbsp;it&nbsp;is&nbsp;not&nbsp;closed,&nbsp;that&nbsp;implies&nbsp;that&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1495664">//&nbsp;channel&nbsp;wasn&#39;t&nbsp;closed&nbsp;during&nbsp;the&nbsp;first&nbsp;observation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1495720">if</span>&nbsp;<span class="op" id="1495723">!</span><span class="ident" id="1495724"><a href="/gostd/runtime/chan.go.html#1494395">block</a></span>&nbsp;<span class="op" id="1495730">&amp;&amp;</span>&nbsp;<span class="ident" id="1495733"><a href="/gostd/runtime/chan.go.html#1494366">c</a></span><span class="op" id="1495734">.</span><span class="ident" id="1495735"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796693">closed</a></span>&nbsp;<span class="op" id="1495742">==</span>&nbsp;<span class="num" id="1495745">0</span>&nbsp;<span class="op" id="1495747">&amp;&amp;</span>&nbsp;<span class="op" id="1495750">(</span><span class="op" id="1495751">(</span><span class="ident" id="1495752"><a href="/gostd/runtime/chan.go.html#1494366">c</a></span><span class="op" id="1495753">.</span><span class="ident" id="1495754"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796650">dataqsiz</a></span>&nbsp;<span class="op" id="1495763">==</span>&nbsp;<span class="num" id="1495766">0</span>&nbsp;<span class="op" id="1495768">&amp;&amp;</span>&nbsp;<span class="ident" id="1495771"><a href="/gostd/runtime/chan.go.html#1494366">c</a></span><span class="op" id="1495772">.</span><span class="ident" id="1495773"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796749">recvq</a></span><span class="op" id="1495778">.</span><span class="ident" id="1495779"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796587">first</a></span>&nbsp;<span class="op" id="1495785">==</span>&nbsp;<span class="builtintype" id="1495788">nil</span><span class="op" id="1495791">)</span>&nbsp;<span class="op" id="1495793">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1495798">(</span><span class="ident" id="1495799"><a href="/gostd/runtime/chan.go.html#1494366">c</a></span><span class="op" id="1495800">.</span><span class="ident" id="1495801"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796650">dataqsiz</a></span>&nbsp;<span class="op" id="1495810">&gt;</span>&nbsp;<span class="num" id="1495812">0</span>&nbsp;<span class="op" id="1495814">&amp;&amp;</span>&nbsp;<span class="ident" id="1495817"><a href="/gostd/runtime/chan.go.html#1494366">c</a></span><span class="op" id="1495818">.</span><span class="ident" id="1495819"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796637">qcount</a></span>&nbsp;<span class="op" id="1495826">==</span>&nbsp;<span class="ident" id="1495829"><a href="/gostd/runtime/chan.go.html#1494366">c</a></span><span class="op" id="1495830">.</span><span class="ident" id="1495831"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796650">dataqsiz</a></span><span class="op" id="1495839">)</span><span class="op" id="1495840">)</span>&nbsp;<span class="op" id="1495842">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1495846">return</span>&nbsp;<span class="builtintype" id="1495853">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1495860">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1495864">var</span>&nbsp;<span class="ident" id="1495868">t0</span>&nbsp;<span class="builtintype" id="1495871">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1495878">if</span>&nbsp;<span class="ident" id="1495881"><a href="/gostd/runtime/mprof.go.html#1626211">blockprofilerate</a></span>&nbsp;<span class="op" id="1495898">&gt;</span>&nbsp;<span class="num" id="1495900">0</span>&nbsp;<span class="op" id="1495902">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1495906"><a href="/gostd/runtime/chan.go.html#1495868">t0</a></span>&nbsp;<span class="op" id="1495909">=</span>&nbsp;<span class="ident" id="1495911"><a href="/gostd/runtime/stubs.go.html#1744144">cputicks</a></span><span class="op" id="1495919">(</span><span class="op" id="1495920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1495923">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1495927"><a href="/gostd/runtime/lock_futex.go.html#1585337">lock</a></span><span class="op" id="1495931">(</span><span class="op" id="1495932">&amp;</span><span class="ident" id="1495933"><a href="/gostd/runtime/chan.go.html#1494366">c</a></span><span class="op" id="1495934">.</span><span class="ident" id="1495935"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796775">lock</a></span><span class="op" id="1495939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1495942">if</span>&nbsp;<span class="ident" id="1495945"><a href="/gostd/runtime/chan.go.html#1494366">c</a></span><span class="op" id="1495946">.</span><span class="ident" id="1495947"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796693">closed</a></span>&nbsp;<span class="op" id="1495954">!=</span>&nbsp;<span class="num" id="1495957">0</span>&nbsp;<span class="op" id="1495959">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1495963"><a href="/gostd/runtime/lock_futex.go.html#1586629">unlock</a></span><span class="op" id="1495969">(</span><span class="op" id="1495970">&amp;</span><span class="ident" id="1495971"><a href="/gostd/runtime/chan.go.html#1494366">c</a></span><span class="op" id="1495972">.</span><span class="ident" id="1495973"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796775">lock</a></span><span class="op" id="1495977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1495981">panic</span><span class="op" id="1495986">(</span><span class="string" id="1495987">&#34;send&nbsp;on&nbsp;closed&nbsp;channel&#34;</span><span class="op" id="1496011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1496014">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1496018">if</span>&nbsp;<span class="ident" id="1496021"><a href="/gostd/runtime/chan.go.html#1494366">c</a></span><span class="op" id="1496022">.</span><span class="ident" id="1496023"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796650">dataqsiz</a></span>&nbsp;<span class="op" id="1496032">==</span>&nbsp;<span class="num" id="1496035">0</span>&nbsp;<span class="op" id="1496037">{</span>&nbsp;<span class="comment" id="1496039">//&nbsp;synchronous&nbsp;channel</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1496064">sg</span>&nbsp;<span class="op" id="1496067">:=</span>&nbsp;<span class="ident" id="1496070"><a href="/gostd/runtime/chan.go.html#1494366">c</a></span><span class="op" id="1496071">.</span><span class="ident" id="1496072"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796749">recvq</a></span><span class="op" id="1496077">.</span><span class="ident" id="1496078"><a href="/gostd/runtime/chan.go.html#1505850">dequeue</a></span><span class="op" id="1496085">(</span><span class="op" id="1496086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1496090">if</span>&nbsp;<span class="ident" id="1496093"><a href="/gostd/runtime/chan.go.html#1496064">sg</a></span>&nbsp;<span class="op" id="1496096">!=</span>&nbsp;<span class="builtintype" id="1496099">nil</span>&nbsp;<span class="op" id="1496103">{</span>&nbsp;<span class="comment" id="1496105">//&nbsp;found&nbsp;a&nbsp;waiting&nbsp;receiver</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1496136">if</span>&nbsp;<span class="ident" id="1496139"><a href="/gostd/runtime/race0.go.html#1676514">raceenabled</a></span>&nbsp;<span class="op" id="1496151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1496157"><a href="/gostd/runtime/chan.go.html#1506248">racesync</a></span><span class="op" id="1496165">(</span><span class="ident" id="1496166"><a href="/gostd/runtime/chan.go.html#1494366">c</a></span><span class="op" id="1496167">,</span>&nbsp;<span class="ident" id="1496169"><a href="/gostd/runtime/chan.go.html#1496064">sg</a></span><span class="op" id="1496171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1496176">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1496181"><a href="/gostd/runtime/lock_futex.go.html#1586629">unlock</a></span><span class="op" id="1496187">(</span><span class="op" id="1496188">&amp;</span><span class="ident" id="1496189"><a href="/gostd/runtime/chan.go.html#1494366">c</a></span><span class="op" id="1496190">.</span><span class="ident" id="1496191"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796775">lock</a></span><span class="op" id="1496195">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1496201">recvg</span>&nbsp;<span class="op" id="1496207">:=</span>&nbsp;<span class="ident" id="1496210"><a href="/gostd/runtime/chan.go.html#1496064">sg</a></span><span class="op" id="1496212">.</span><span class="ident" id="1496213"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786765">g</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1496218">if</span>&nbsp;<span class="ident" id="1496221"><a href="/gostd/runtime/chan.go.html#1496064">sg</a></span><span class="op" id="1496223">.</span><span class="ident" id="1496224"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786817">elem</a></span>&nbsp;<span class="op" id="1496229">!=</span>&nbsp;<span class="builtintype" id="1496232">nil</span>&nbsp;<span class="op" id="1496236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1496242"><a href="/gostd/runtime/stubs.go.html#1742708">memmove</a></span><span class="op" id="1496249">(</span><span class="ident" id="1496250"><a href="/gostd/runtime/chan.go.html#1492024">unsafe</a></span><span class="op" id="1496256">.</span><span class="ident" id="1496257">Pointer</span><span class="op" id="1496264">(</span><span class="ident" id="1496265"><a href="/gostd/runtime/chan.go.html#1496064">sg</a></span><span class="op" id="1496267">.</span><span class="ident" id="1496268"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786817">elem</a></span><span class="op" id="1496272">)</span><span class="op" id="1496273">,</span>&nbsp;<span class="ident" id="1496275"><a href="/gostd/runtime/chan.go.html#1494376">ep</a></span><span class="op" id="1496277">,</span>&nbsp;<span class="builtintype" id="1496279">uintptr</span><span class="op" id="1496286">(</span><span class="ident" id="1496287"><a href="/gostd/runtime/chan.go.html#1494366">c</a></span><span class="op" id="1496288">.</span><span class="ident" id="1496289"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796676">elemsize</a></span><span class="op" id="1496297">)</span><span class="op" id="1496298">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1496304"><a href="/gostd/runtime/chan.go.html#1496064">sg</a></span><span class="op" id="1496306">.</span><span class="ident" id="1496307"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786817">elem</a></span>&nbsp;<span class="op" id="1496312">=</span>&nbsp;<span class="builtintype" id="1496314">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1496321">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1496326"><a href="/gostd/runtime/chan.go.html#1496201">recvg</a></span><span class="op" id="1496331">.</span><span class="ident" id="1496332"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787421">param</a></span>&nbsp;<span class="op" id="1496338">=</span>&nbsp;<span class="ident" id="1496340"><a href="/gostd/runtime/chan.go.html#1492024">unsafe</a></span><span class="op" id="1496346">.</span><span class="ident" id="1496347">Pointer</span><span class="op" id="1496354">(</span><span class="ident" id="1496355"><a href="/gostd/runtime/chan.go.html#1496064">sg</a></span><span class="op" id="1496357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1496362">if</span>&nbsp;<span class="ident" id="1496365"><a href="/gostd/runtime/chan.go.html#1496064">sg</a></span><span class="op" id="1496367">.</span><span class="ident" id="1496368"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786838">releasetime</a></span>&nbsp;<span class="op" id="1496380">!=</span>&nbsp;<span class="num" id="1496383">0</span>&nbsp;<span class="op" id="1496385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1496391"><a href="/gostd/runtime/chan.go.html#1496064">sg</a></span><span class="op" id="1496393">.</span><span class="ident" id="1496394"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786838">releasetime</a></span>&nbsp;<span class="op" id="1496406">=</span>&nbsp;<span class="ident" id="1496408"><a href="/gostd/runtime/stubs.go.html#1744144">cputicks</a></span><span class="op" id="1496416">(</span><span class="op" id="1496417">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1496422">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1496427"><a href="/gostd/runtime/proc.go.html#1673919">goready</a></span><span class="op" id="1496434">(</span><span class="ident" id="1496435"><a href="/gostd/runtime/chan.go.html#1496201">recvg</a></span><span class="op" id="1496440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1496445">return</span>&nbsp;<span class="builtintype" id="1496452">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1496459">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1496464">if</span>&nbsp;<span class="op" id="1496467">!</span><span class="ident" id="1496468"><a href="/gostd/runtime/chan.go.html#1494395">block</a></span>&nbsp;<span class="op" id="1496474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1496479"><a href="/gostd/runtime/lock_futex.go.html#1586629">unlock</a></span><span class="op" id="1496485">(</span><span class="op" id="1496486">&amp;</span><span class="ident" id="1496487"><a href="/gostd/runtime/chan.go.html#1494366">c</a></span><span class="op" id="1496488">.</span><span class="ident" id="1496489"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796775">lock</a></span><span class="op" id="1496493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1496498">return</span>&nbsp;<span class="builtintype" id="1496505">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1496513">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1496518">//&nbsp;no&nbsp;receiver&nbsp;available:&nbsp;block&nbsp;on&nbsp;this&nbsp;channel.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1496569">gp</span>&nbsp;<span class="op" id="1496572">:=</span>&nbsp;<span class="ident" id="1496575"><a href="/gostd/runtime/stubs.go.html#1738919">getg</a></span><span class="op" id="1496579">(</span><span class="op" id="1496580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1496584">mysg</span>&nbsp;<span class="op" id="1496589">:=</span>&nbsp;<span class="ident" id="1496592"><a href="/gostd/runtime/proc.go.html#1674038">acquireSudog</a></span><span class="op" id="1496604">(</span><span class="op" id="1496605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1496609"><a href="/gostd/runtime/chan.go.html#1496584">mysg</a></span><span class="op" id="1496613">.</span><span class="ident" id="1496614"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786838">releasetime</a></span>&nbsp;<span class="op" id="1496626">=</span>&nbsp;<span class="num" id="1496628">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1496632">if</span>&nbsp;<span class="ident" id="1496635"><a href="/gostd/runtime/chan.go.html#1495868">t0</a></span>&nbsp;<span class="op" id="1496638">!=</span>&nbsp;<span class="num" id="1496641">0</span>&nbsp;<span class="op" id="1496643">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1496648"><a href="/gostd/runtime/chan.go.html#1496584">mysg</a></span><span class="op" id="1496652">.</span><span class="ident" id="1496653"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786838">releasetime</a></span>&nbsp;<span class="op" id="1496665">=</span>&nbsp;<span class="op" id="1496667">-</span><span class="num" id="1496668">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1496672">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1496676"><a href="/gostd/runtime/chan.go.html#1496584">mysg</a></span><span class="op" id="1496680">.</span><span class="ident" id="1496681"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786817">elem</a></span>&nbsp;<span class="op" id="1496686">=</span>&nbsp;<span class="ident" id="1496688"><a href="/gostd/runtime/chan.go.html#1494376">ep</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1496693"><a href="/gostd/runtime/chan.go.html#1496584">mysg</a></span><span class="op" id="1496697">.</span><span class="ident" id="1496698"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786873">waitlink</a></span>&nbsp;<span class="op" id="1496707">=</span>&nbsp;<span class="builtintype" id="1496709">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1496715"><a href="/gostd/runtime/chan.go.html#1496569">gp</a></span><span class="op" id="1496717">.</span><span class="ident" id="1496718"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787771">waiting</a></span>&nbsp;<span class="op" id="1496726">=</span>&nbsp;<span class="ident" id="1496728"><a href="/gostd/runtime/chan.go.html#1496584">mysg</a></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1496735"><a href="/gostd/runtime/chan.go.html#1496584">mysg</a></span><span class="op" id="1496739">.</span><span class="ident" id="1496740"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786765">g</a></span>&nbsp;<span class="op" id="1496742">=</span>&nbsp;<span class="ident" id="1496744"><a href="/gostd/runtime/chan.go.html#1496569">gp</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1496749"><a href="/gostd/runtime/chan.go.html#1496584">mysg</a></span><span class="op" id="1496753">.</span><span class="ident" id="1496754"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786771">selectdone</a></span>&nbsp;<span class="op" id="1496765">=</span>&nbsp;<span class="builtintype" id="1496767">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1496773"><a href="/gostd/runtime/chan.go.html#1496569">gp</a></span><span class="op" id="1496775">.</span><span class="ident" id="1496776"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787421">param</a></span>&nbsp;<span class="op" id="1496782">=</span>&nbsp;<span class="builtintype" id="1496784">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1496790"><a href="/gostd/runtime/chan.go.html#1494366">c</a></span><span class="op" id="1496791">.</span><span class="ident" id="1496792"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796762">sendq</a></span><span class="op" id="1496797">.</span><span class="ident" id="1496798"><a href="/gostd/runtime/chan.go.html#1505696">enqueue</a></span><span class="op" id="1496805">(</span><span class="ident" id="1496806"><a href="/gostd/runtime/chan.go.html#1496584">mysg</a></span><span class="op" id="1496810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1496814"><a href="/gostd/runtime/proc.go.html#1673799">goparkunlock</a></span><span class="op" id="1496826">(</span><span class="op" id="1496827">&amp;</span><span class="ident" id="1496828"><a href="/gostd/runtime/chan.go.html#1494366">c</a></span><span class="op" id="1496829">.</span><span class="ident" id="1496830"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796775">lock</a></span><span class="op" id="1496834">,</span>&nbsp;<span class="string" id="1496836">&#34;chan&nbsp;send&#34;</span><span class="op" id="1496847">)</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1496852">//&nbsp;someone&nbsp;woke&nbsp;us&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1496877">if</span>&nbsp;<span class="ident" id="1496880"><a href="/gostd/runtime/chan.go.html#1496584">mysg</a></span>&nbsp;<span class="op" id="1496885">!=</span>&nbsp;<span class="ident" id="1496888"><a href="/gostd/runtime/chan.go.html#1496569">gp</a></span><span class="op" id="1496890">.</span><span class="ident" id="1496891"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787771">waiting</a></span>&nbsp;<span class="op" id="1496899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1496904"><a href="/gostd/runtime/panic.go.html#1664327">gothrow</a></span><span class="op" id="1496911">(</span><span class="string" id="1496912">&#34;G&nbsp;waiting&nbsp;list&nbsp;is&nbsp;corrupted!&#34;</span><span class="op" id="1496942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1496946">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1496950"><a href="/gostd/runtime/chan.go.html#1496569">gp</a></span><span class="op" id="1496952">.</span><span class="ident" id="1496953"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787771">waiting</a></span>&nbsp;<span class="op" id="1496961">=</span>&nbsp;<span class="builtintype" id="1496963">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1496969">if</span>&nbsp;<span class="ident" id="1496972"><a href="/gostd/runtime/chan.go.html#1496569">gp</a></span><span class="op" id="1496974">.</span><span class="ident" id="1496975"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787421">param</a></span>&nbsp;<span class="op" id="1496981">==</span>&nbsp;<span class="builtintype" id="1496984">nil</span>&nbsp;<span class="op" id="1496988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1496993">if</span>&nbsp;<span class="ident" id="1496996"><a href="/gostd/runtime/chan.go.html#1494366">c</a></span><span class="op" id="1496997">.</span><span class="ident" id="1496998"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796693">closed</a></span>&nbsp;<span class="op" id="1497005">==</span>&nbsp;<span class="num" id="1497008">0</span>&nbsp;<span class="op" id="1497010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1497016"><a href="/gostd/runtime/panic.go.html#1664327">gothrow</a></span><span class="op" id="1497023">(</span><span class="string" id="1497024">&#34;chansend:&nbsp;spurious&nbsp;wakeup&#34;</span><span class="op" id="1497051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1497056">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1497061">panic</span><span class="op" id="1497066">(</span><span class="string" id="1497067">&#34;send&nbsp;on&nbsp;closed&nbsp;channel&#34;</span><span class="op" id="1497091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1497095">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1497099"><a href="/gostd/runtime/chan.go.html#1496569">gp</a></span><span class="op" id="1497101">.</span><span class="ident" id="1497102"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787421">param</a></span>&nbsp;<span class="op" id="1497108">=</span>&nbsp;<span class="builtintype" id="1497110">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1497116">if</span>&nbsp;<span class="ident" id="1497119"><a href="/gostd/runtime/chan.go.html#1496584">mysg</a></span><span class="op" id="1497123">.</span><span class="ident" id="1497124"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786838">releasetime</a></span>&nbsp;<span class="op" id="1497136">&gt;</span>&nbsp;<span class="num" id="1497138">0</span>&nbsp;<span class="op" id="1497140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1497145"><a href="/gostd/runtime/mprof.go.html#1626994">blockevent</a></span><span class="op" id="1497155">(</span><span class="builtintype" id="1497156">int64</span><span class="op" id="1497161">(</span><span class="ident" id="1497162"><a href="/gostd/runtime/chan.go.html#1496584">mysg</a></span><span class="op" id="1497166">.</span><span class="ident" id="1497167"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786838">releasetime</a></span><span class="op" id="1497178">)</span><span class="op" id="1497179">-</span><span class="ident" id="1497180"><a href="/gostd/runtime/chan.go.html#1495868">t0</a></span><span class="op" id="1497182">,</span>&nbsp;<span class="num" id="1497184">2</span><span class="op" id="1497185">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1497189">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1497193"><a href="/gostd/runtime/proc.go.html#1674768">releaseSudog</a></span><span class="op" id="1497205">(</span><span class="ident" id="1497206"><a href="/gostd/runtime/chan.go.html#1496584">mysg</a></span><span class="op" id="1497210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1497214">return</span>&nbsp;<span class="builtintype" id="1497221">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1497227">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1497231">//&nbsp;asynchronous&nbsp;channel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1497256">//&nbsp;wait&nbsp;for&nbsp;some&nbsp;space&nbsp;to&nbsp;write&nbsp;our&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1497298">var</span>&nbsp;<span class="ident" id="1497302">t1</span>&nbsp;<span class="builtintype" id="1497305">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1497312">for</span>&nbsp;<span class="ident" id="1497316"><a href="/gostd/runtime/chan.go.html#1494366">c</a></span><span class="op" id="1497317">.</span><span class="ident" id="1497318"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796637">qcount</a></span>&nbsp;<span class="op" id="1497325">&gt;=</span>&nbsp;<span class="ident" id="1497328"><a href="/gostd/runtime/chan.go.html#1494366">c</a></span><span class="op" id="1497329">.</span><span class="ident" id="1497330"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796650">dataqsiz</a></span>&nbsp;<span class="op" id="1497339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1497343">if</span>&nbsp;<span class="op" id="1497346">!</span><span class="ident" id="1497347"><a href="/gostd/runtime/chan.go.html#1494395">block</a></span>&nbsp;<span class="op" id="1497353">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1497358"><a href="/gostd/runtime/lock_futex.go.html#1586629">unlock</a></span><span class="op" id="1497364">(</span><span class="op" id="1497365">&amp;</span><span class="ident" id="1497366"><a href="/gostd/runtime/chan.go.html#1494366">c</a></span><span class="op" id="1497367">.</span><span class="ident" id="1497368"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796775">lock</a></span><span class="op" id="1497372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1497377">return</span>&nbsp;<span class="builtintype" id="1497384">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1497392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1497396">gp</span>&nbsp;<span class="op" id="1497399">:=</span>&nbsp;<span class="ident" id="1497402"><a href="/gostd/runtime/stubs.go.html#1738919">getg</a></span><span class="op" id="1497406">(</span><span class="op" id="1497407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1497411">mysg</span>&nbsp;<span class="op" id="1497416">:=</span>&nbsp;<span class="ident" id="1497419"><a href="/gostd/runtime/proc.go.html#1674038">acquireSudog</a></span><span class="op" id="1497431">(</span><span class="op" id="1497432">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1497436"><a href="/gostd/runtime/chan.go.html#1497411">mysg</a></span><span class="op" id="1497440">.</span><span class="ident" id="1497441"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786838">releasetime</a></span>&nbsp;<span class="op" id="1497453">=</span>&nbsp;<span class="num" id="1497455">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1497459">if</span>&nbsp;<span class="ident" id="1497462"><a href="/gostd/runtime/chan.go.html#1495868">t0</a></span>&nbsp;<span class="op" id="1497465">!=</span>&nbsp;<span class="num" id="1497468">0</span>&nbsp;<span class="op" id="1497470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1497475"><a href="/gostd/runtime/chan.go.html#1497411">mysg</a></span><span class="op" id="1497479">.</span><span class="ident" id="1497480"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786838">releasetime</a></span>&nbsp;<span class="op" id="1497492">=</span>&nbsp;<span class="op" id="1497494">-</span><span class="num" id="1497495">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1497499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1497503"><a href="/gostd/runtime/chan.go.html#1497411">mysg</a></span><span class="op" id="1497507">.</span><span class="ident" id="1497508"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786765">g</a></span>&nbsp;<span class="op" id="1497510">=</span>&nbsp;<span class="ident" id="1497512"><a href="/gostd/runtime/chan.go.html#1497396">gp</a></span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1497517"><a href="/gostd/runtime/chan.go.html#1497411">mysg</a></span><span class="op" id="1497521">.</span><span class="ident" id="1497522"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786817">elem</a></span>&nbsp;<span class="op" id="1497527">=</span>&nbsp;<span class="builtintype" id="1497529">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1497535"><a href="/gostd/runtime/chan.go.html#1497411">mysg</a></span><span class="op" id="1497539">.</span><span class="ident" id="1497540"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786771">selectdone</a></span>&nbsp;<span class="op" id="1497551">=</span>&nbsp;<span class="builtintype" id="1497553">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1497559"><a href="/gostd/runtime/chan.go.html#1494366">c</a></span><span class="op" id="1497560">.</span><span class="ident" id="1497561"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796762">sendq</a></span><span class="op" id="1497566">.</span><span class="ident" id="1497567"><a href="/gostd/runtime/chan.go.html#1505696">enqueue</a></span><span class="op" id="1497574">(</span><span class="ident" id="1497575"><a href="/gostd/runtime/chan.go.html#1497411">mysg</a></span><span class="op" id="1497579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1497583"><a href="/gostd/runtime/proc.go.html#1673799">goparkunlock</a></span><span class="op" id="1497595">(</span><span class="op" id="1497596">&amp;</span><span class="ident" id="1497597"><a href="/gostd/runtime/chan.go.html#1494366">c</a></span><span class="op" id="1497598">.</span><span class="ident" id="1497599"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796775">lock</a></span><span class="op" id="1497603">,</span>&nbsp;<span class="string" id="1497605">&#34;chan&nbsp;send&#34;</span><span class="op" id="1497616">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1497621">//&nbsp;someone&nbsp;woke&nbsp;us&nbsp;up&nbsp;-&nbsp;try&nbsp;again</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1497657">if</span>&nbsp;<span class="ident" id="1497660"><a href="/gostd/runtime/chan.go.html#1497411">mysg</a></span><span class="op" id="1497664">.</span><span class="ident" id="1497665"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786838">releasetime</a></span>&nbsp;<span class="op" id="1497677">&gt;</span>&nbsp;<span class="num" id="1497679">0</span>&nbsp;<span class="op" id="1497681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1497686"><a href="/gostd/runtime/chan.go.html#1497302">t1</a></span>&nbsp;<span class="op" id="1497689">=</span>&nbsp;<span class="ident" id="1497691"><a href="/gostd/runtime/chan.go.html#1497411">mysg</a></span><span class="op" id="1497695">.</span><span class="ident" id="1497696"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786838">releasetime</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1497710">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1497714"><a href="/gostd/runtime/proc.go.html#1674768">releaseSudog</a></span><span class="op" id="1497726">(</span><span class="ident" id="1497727"><a href="/gostd/runtime/chan.go.html#1497411">mysg</a></span><span class="op" id="1497731">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1497735"><a href="/gostd/runtime/lock_futex.go.html#1585337">lock</a></span><span class="op" id="1497739">(</span><span class="op" id="1497740">&amp;</span><span class="ident" id="1497741"><a href="/gostd/runtime/chan.go.html#1494366">c</a></span><span class="op" id="1497742">.</span><span class="ident" id="1497743"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796775">lock</a></span><span class="op" id="1497747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1497751">if</span>&nbsp;<span class="ident" id="1497754"><a href="/gostd/runtime/chan.go.html#1494366">c</a></span><span class="op" id="1497755">.</span><span class="ident" id="1497756"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796693">closed</a></span>&nbsp;<span class="op" id="1497763">!=</span>&nbsp;<span class="num" id="1497766">0</span>&nbsp;<span class="op" id="1497768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1497773"><a href="/gostd/runtime/lock_futex.go.html#1586629">unlock</a></span><span class="op" id="1497779">(</span><span class="op" id="1497780">&amp;</span><span class="ident" id="1497781"><a href="/gostd/runtime/chan.go.html#1494366">c</a></span><span class="op" id="1497782">.</span><span class="ident" id="1497783"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796775">lock</a></span><span class="op" id="1497787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1497792">panic</span><span class="op" id="1497797">(</span><span class="string" id="1497798">&#34;send&nbsp;on&nbsp;closed&nbsp;channel&#34;</span><span class="op" id="1497822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1497826">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1497829">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1497833">//&nbsp;write&nbsp;our&nbsp;data&nbsp;into&nbsp;the&nbsp;channel&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1497876">if</span>&nbsp;<span class="ident" id="1497879"><a href="/gostd/runtime/race0.go.html#1676514">raceenabled</a></span>&nbsp;<span class="op" id="1497891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1497895"><a href="/gostd/runtime/race0.go.html#1677480">raceacquire</a></span><span class="op" id="1497906">(</span><span class="ident" id="1497907"><a href="/gostd/runtime/chan.go.html#1493709">chanbuf</a></span><span class="op" id="1497914">(</span><span class="ident" id="1497915"><a href="/gostd/runtime/chan.go.html#1494366">c</a></span><span class="op" id="1497916">,</span>&nbsp;<span class="ident" id="1497918"><a href="/gostd/runtime/chan.go.html#1494366">c</a></span><span class="op" id="1497919">.</span><span class="ident" id="1497920"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796725">sendx</a></span><span class="op" id="1497925">)</span><span class="op" id="1497926">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1497930"><a href="/gostd/runtime/race0.go.html#1677672">racerelease</a></span><span class="op" id="1497941">(</span><span class="ident" id="1497942"><a href="/gostd/runtime/chan.go.html#1493709">chanbuf</a></span><span class="op" id="1497949">(</span><span class="ident" id="1497950"><a href="/gostd/runtime/chan.go.html#1494366">c</a></span><span class="op" id="1497951">,</span>&nbsp;<span class="ident" id="1497953"><a href="/gostd/runtime/chan.go.html#1494366">c</a></span><span class="op" id="1497954">.</span><span class="ident" id="1497955"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796725">sendx</a></span><span class="op" id="1497960">)</span><span class="op" id="1497961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1497964">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1497967"><a href="/gostd/runtime/stubs.go.html#1742708">memmove</a></span><span class="op" id="1497974">(</span><span class="ident" id="1497975"><a href="/gostd/runtime/chan.go.html#1493709">chanbuf</a></span><span class="op" id="1497982">(</span><span class="ident" id="1497983"><a href="/gostd/runtime/chan.go.html#1494366">c</a></span><span class="op" id="1497984">,</span>&nbsp;<span class="ident" id="1497986"><a href="/gostd/runtime/chan.go.html#1494366">c</a></span><span class="op" id="1497987">.</span><span class="ident" id="1497988"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796725">sendx</a></span><span class="op" id="1497993">)</span><span class="op" id="1497994">,</span>&nbsp;<span class="ident" id="1497996"><a href="/gostd/runtime/chan.go.html#1494376">ep</a></span><span class="op" id="1497998">,</span>&nbsp;<span class="builtintype" id="1498000">uintptr</span><span class="op" id="1498007">(</span><span class="ident" id="1498008"><a href="/gostd/runtime/chan.go.html#1494366">c</a></span><span class="op" id="1498009">.</span><span class="ident" id="1498010"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796676">elemsize</a></span><span class="op" id="1498018">)</span><span class="op" id="1498019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1498022"><a href="/gostd/runtime/chan.go.html#1494366">c</a></span><span class="op" id="1498023">.</span><span class="ident" id="1498024"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796725">sendx</a></span><span class="op" id="1498029">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1498033">if</span>&nbsp;<span class="ident" id="1498036"><a href="/gostd/runtime/chan.go.html#1494366">c</a></span><span class="op" id="1498037">.</span><span class="ident" id="1498038"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796725">sendx</a></span>&nbsp;<span class="op" id="1498044">==</span>&nbsp;<span class="ident" id="1498047"><a href="/gostd/runtime/chan.go.html#1494366">c</a></span><span class="op" id="1498048">.</span><span class="ident" id="1498049"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796650">dataqsiz</a></span>&nbsp;<span class="op" id="1498058">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1498062"><a href="/gostd/runtime/chan.go.html#1494366">c</a></span><span class="op" id="1498063">.</span><span class="ident" id="1498064"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796725">sendx</a></span>&nbsp;<span class="op" id="1498070">=</span>&nbsp;<span class="num" id="1498072">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1498075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1498078"><a href="/gostd/runtime/chan.go.html#1494366">c</a></span><span class="op" id="1498079">.</span><span class="ident" id="1498080"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796637">qcount</a></span><span class="op" id="1498086">++</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1498091">//&nbsp;wake&nbsp;up&nbsp;a&nbsp;waiting&nbsp;receiver</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1498122">sg</span>&nbsp;<span class="op" id="1498125">:=</span>&nbsp;<span class="ident" id="1498128"><a href="/gostd/runtime/chan.go.html#1494366">c</a></span><span class="op" id="1498129">.</span><span class="ident" id="1498130"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796749">recvq</a></span><span class="op" id="1498135">.</span><span class="ident" id="1498136"><a href="/gostd/runtime/chan.go.html#1505850">dequeue</a></span><span class="op" id="1498143">(</span><span class="op" id="1498144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1498147">if</span>&nbsp;<span class="ident" id="1498150"><a href="/gostd/runtime/chan.go.html#1498122">sg</a></span>&nbsp;<span class="op" id="1498153">!=</span>&nbsp;<span class="builtintype" id="1498156">nil</span>&nbsp;<span class="op" id="1498160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1498164">recvg</span>&nbsp;<span class="op" id="1498170">:=</span>&nbsp;<span class="ident" id="1498173"><a href="/gostd/runtime/chan.go.html#1498122">sg</a></span><span class="op" id="1498175">.</span><span class="ident" id="1498176"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786765">g</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1498180"><a href="/gostd/runtime/lock_futex.go.html#1586629">unlock</a></span><span class="op" id="1498186">(</span><span class="op" id="1498187">&amp;</span><span class="ident" id="1498188"><a href="/gostd/runtime/chan.go.html#1494366">c</a></span><span class="op" id="1498189">.</span><span class="ident" id="1498190"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796775">lock</a></span><span class="op" id="1498194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1498198">if</span>&nbsp;<span class="ident" id="1498201"><a href="/gostd/runtime/chan.go.html#1498122">sg</a></span><span class="op" id="1498203">.</span><span class="ident" id="1498204"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786838">releasetime</a></span>&nbsp;<span class="op" id="1498216">!=</span>&nbsp;<span class="num" id="1498219">0</span>&nbsp;<span class="op" id="1498221">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1498226"><a href="/gostd/runtime/chan.go.html#1498122">sg</a></span><span class="op" id="1498228">.</span><span class="ident" id="1498229"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786838">releasetime</a></span>&nbsp;<span class="op" id="1498241">=</span>&nbsp;<span class="ident" id="1498243"><a href="/gostd/runtime/stubs.go.html#1744144">cputicks</a></span><span class="op" id="1498251">(</span><span class="op" id="1498252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1498256">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1498260"><a href="/gostd/runtime/proc.go.html#1673919">goready</a></span><span class="op" id="1498267">(</span><span class="ident" id="1498268"><a href="/gostd/runtime/chan.go.html#1498164">recvg</a></span><span class="op" id="1498273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1498276">}</span>&nbsp;<span class="keyword" id="1498278">else</span>&nbsp;<span class="op" id="1498283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1498287"><a href="/gostd/runtime/lock_futex.go.html#1586629">unlock</a></span><span class="op" id="1498293">(</span><span class="op" id="1498294">&amp;</span><span class="ident" id="1498295"><a href="/gostd/runtime/chan.go.html#1494366">c</a></span><span class="op" id="1498296">.</span><span class="ident" id="1498297"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796775">lock</a></span><span class="op" id="1498301">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1498304">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1498307">if</span>&nbsp;<span class="ident" id="1498310"><a href="/gostd/runtime/chan.go.html#1497302">t1</a></span>&nbsp;<span class="op" id="1498313">&gt;</span>&nbsp;<span class="num" id="1498315">0</span>&nbsp;<span class="op" id="1498317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1498321"><a href="/gostd/runtime/mprof.go.html#1626994">blockevent</a></span><span class="op" id="1498331">(</span><span class="ident" id="1498332"><a href="/gostd/runtime/chan.go.html#1497302">t1</a></span><span class="op" id="1498334">-</span><span class="ident" id="1498335"><a href="/gostd/runtime/chan.go.html#1495868">t0</a></span><span class="op" id="1498337">,</span>&nbsp;<span class="num" id="1498339">2</span><span class="op" id="1498340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1498343">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1498346">return</span>&nbsp;<span class="builtintype" id="1498353">true</span><br>
<span class="lineno">255</span><span class="op" id="1498358">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1498361">func</span>&nbsp;<span class="ident" id="1498366">closechan</span><span class="op" id="1498375">(</span><span class="ident" id="1498376">c</span>&nbsp;<span class="op" id="1498378">*</span><span class="ident" id="1498379"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796621">hchan</a></span><span class="op" id="1498384">)</span>&nbsp;<span class="op" id="1498386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1498389">if</span>&nbsp;<span class="ident" id="1498392"><a href="/gostd/runtime/chan.go.html#1498376">c</a></span>&nbsp;<span class="op" id="1498394">==</span>&nbsp;<span class="builtintype" id="1498397">nil</span>&nbsp;<span class="op" id="1498401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1498405">panic</span><span class="op" id="1498410">(</span><span class="string" id="1498411">&#34;close&nbsp;of&nbsp;nil&nbsp;channel&#34;</span><span class="op" id="1498433">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1498436">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1498440"><a href="/gostd/runtime/lock_futex.go.html#1585337">lock</a></span><span class="op" id="1498444">(</span><span class="op" id="1498445">&amp;</span><span class="ident" id="1498446"><a href="/gostd/runtime/chan.go.html#1498376">c</a></span><span class="op" id="1498447">.</span><span class="ident" id="1498448"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796775">lock</a></span><span class="op" id="1498452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1498455">if</span>&nbsp;<span class="ident" id="1498458"><a href="/gostd/runtime/chan.go.html#1498376">c</a></span><span class="op" id="1498459">.</span><span class="ident" id="1498460"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796693">closed</a></span>&nbsp;<span class="op" id="1498467">!=</span>&nbsp;<span class="num" id="1498470">0</span>&nbsp;<span class="op" id="1498472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1498476"><a href="/gostd/runtime/lock_futex.go.html#1586629">unlock</a></span><span class="op" id="1498482">(</span><span class="op" id="1498483">&amp;</span><span class="ident" id="1498484"><a href="/gostd/runtime/chan.go.html#1498376">c</a></span><span class="op" id="1498485">.</span><span class="ident" id="1498486"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796775">lock</a></span><span class="op" id="1498490">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1498494">panic</span><span class="op" id="1498499">(</span><span class="string" id="1498500">&#34;close&nbsp;of&nbsp;closed&nbsp;channel&#34;</span><span class="op" id="1498525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1498528">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1498532">if</span>&nbsp;<span class="ident" id="1498535"><a href="/gostd/runtime/race0.go.html#1676514">raceenabled</a></span>&nbsp;<span class="op" id="1498547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1498551">callerpc</span>&nbsp;<span class="op" id="1498560">:=</span>&nbsp;<span class="ident" id="1498563"><a href="/gostd/runtime/stubs.go.html#1746397">getcallerpc</a></span><span class="op" id="1498574">(</span><span class="ident" id="1498575"><a href="/gostd/runtime/chan.go.html#1492024">unsafe</a></span><span class="op" id="1498581">.</span><span class="ident" id="1498582">Pointer</span><span class="op" id="1498589">(</span><span class="op" id="1498590">&amp;</span><span class="ident" id="1498591"><a href="/gostd/runtime/chan.go.html#1498376">c</a></span><span class="op" id="1498592">)</span><span class="op" id="1498593">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1498597"><a href="/gostd/runtime/race0.go.html#1677096">racewritepc</a></span><span class="op" id="1498608">(</span><span class="ident" id="1498609"><a href="/gostd/runtime/chan.go.html#1492024">unsafe</a></span><span class="op" id="1498615">.</span><span class="ident" id="1498616">Pointer</span><span class="op" id="1498623">(</span><span class="ident" id="1498624"><a href="/gostd/runtime/chan.go.html#1498376">c</a></span><span class="op" id="1498625">)</span><span class="op" id="1498626">,</span>&nbsp;<span class="ident" id="1498628"><a href="/gostd/runtime/chan.go.html#1498551">callerpc</a></span><span class="op" id="1498636">,</span>&nbsp;<span class="ident" id="1498638"><a href="/gostd/runtime/proc.go.html#1675458">funcPC</a></span><span class="op" id="1498644">(</span><span class="ident" id="1498645"><a href="/gostd/runtime/chan.go.html#1498366">closechan</a></span><span class="op" id="1498654">)</span><span class="op" id="1498655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1498659"><a href="/gostd/runtime/race0.go.html#1677672">racerelease</a></span><span class="op" id="1498670">(</span><span class="ident" id="1498671"><a href="/gostd/runtime/chan.go.html#1492024">unsafe</a></span><span class="op" id="1498677">.</span><span class="ident" id="1498678">Pointer</span><span class="op" id="1498685">(</span><span class="ident" id="1498686"><a href="/gostd/runtime/chan.go.html#1498376">c</a></span><span class="op" id="1498687">)</span><span class="op" id="1498688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1498691">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1498695"><a href="/gostd/runtime/chan.go.html#1498376">c</a></span><span class="op" id="1498696">.</span><span class="ident" id="1498697"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796693">closed</a></span>&nbsp;<span class="op" id="1498704">=</span>&nbsp;<span class="num" id="1498706">1</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1498710">//&nbsp;release&nbsp;all&nbsp;readers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1498734">for</span>&nbsp;<span class="op" id="1498738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1498742">sg</span>&nbsp;<span class="op" id="1498745">:=</span>&nbsp;<span class="ident" id="1498748"><a href="/gostd/runtime/chan.go.html#1498376">c</a></span><span class="op" id="1498749">.</span><span class="ident" id="1498750"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796749">recvq</a></span><span class="op" id="1498755">.</span><span class="ident" id="1498756"><a href="/gostd/runtime/chan.go.html#1505850">dequeue</a></span><span class="op" id="1498763">(</span><span class="op" id="1498764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1498768">if</span>&nbsp;<span class="ident" id="1498771"><a href="/gostd/runtime/chan.go.html#1498742">sg</a></span>&nbsp;<span class="op" id="1498774">==</span>&nbsp;<span class="builtintype" id="1498777">nil</span>&nbsp;<span class="op" id="1498781">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1498786">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1498794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1498798">gp</span>&nbsp;<span class="op" id="1498801">:=</span>&nbsp;<span class="ident" id="1498804"><a href="/gostd/runtime/chan.go.html#1498742">sg</a></span><span class="op" id="1498806">.</span><span class="ident" id="1498807"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786765">g</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1498811"><a href="/gostd/runtime/chan.go.html#1498742">sg</a></span><span class="op" id="1498813">.</span><span class="ident" id="1498814"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786817">elem</a></span>&nbsp;<span class="op" id="1498819">=</span>&nbsp;<span class="builtintype" id="1498821">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1498827"><a href="/gostd/runtime/chan.go.html#1498798">gp</a></span><span class="op" id="1498829">.</span><span class="ident" id="1498830"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787421">param</a></span>&nbsp;<span class="op" id="1498836">=</span>&nbsp;<span class="builtintype" id="1498838">nil</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1498844">if</span>&nbsp;<span class="ident" id="1498847"><a href="/gostd/runtime/chan.go.html#1498742">sg</a></span><span class="op" id="1498849">.</span><span class="ident" id="1498850"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786838">releasetime</a></span>&nbsp;<span class="op" id="1498862">!=</span>&nbsp;<span class="num" id="1498865">0</span>&nbsp;<span class="op" id="1498867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1498872"><a href="/gostd/runtime/chan.go.html#1498742">sg</a></span><span class="op" id="1498874">.</span><span class="ident" id="1498875"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786838">releasetime</a></span>&nbsp;<span class="op" id="1498887">=</span>&nbsp;<span class="ident" id="1498889"><a href="/gostd/runtime/stubs.go.html#1744144">cputicks</a></span><span class="op" id="1498897">(</span><span class="op" id="1498898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1498902">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1498906"><a href="/gostd/runtime/proc.go.html#1673919">goready</a></span><span class="op" id="1498913">(</span><span class="ident" id="1498914"><a href="/gostd/runtime/chan.go.html#1498798">gp</a></span><span class="op" id="1498916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1498919">}</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1498923">//&nbsp;release&nbsp;all&nbsp;writers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1498947">for</span>&nbsp;<span class="op" id="1498951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1498955">sg</span>&nbsp;<span class="op" id="1498958">:=</span>&nbsp;<span class="ident" id="1498961"><a href="/gostd/runtime/chan.go.html#1498376">c</a></span><span class="op" id="1498962">.</span><span class="ident" id="1498963"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796762">sendq</a></span><span class="op" id="1498968">.</span><span class="ident" id="1498969"><a href="/gostd/runtime/chan.go.html#1505850">dequeue</a></span><span class="op" id="1498976">(</span><span class="op" id="1498977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1498981">if</span>&nbsp;<span class="ident" id="1498984"><a href="/gostd/runtime/chan.go.html#1498955">sg</a></span>&nbsp;<span class="op" id="1498987">==</span>&nbsp;<span class="builtintype" id="1498990">nil</span>&nbsp;<span class="op" id="1498994">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1498999">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1499007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1499011">gp</span>&nbsp;<span class="op" id="1499014">:=</span>&nbsp;<span class="ident" id="1499017"><a href="/gostd/runtime/chan.go.html#1498955">sg</a></span><span class="op" id="1499019">.</span><span class="ident" id="1499020"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786765">g</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1499024"><a href="/gostd/runtime/chan.go.html#1498955">sg</a></span><span class="op" id="1499026">.</span><span class="ident" id="1499027"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786817">elem</a></span>&nbsp;<span class="op" id="1499032">=</span>&nbsp;<span class="builtintype" id="1499034">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1499040"><a href="/gostd/runtime/chan.go.html#1499011">gp</a></span><span class="op" id="1499042">.</span><span class="ident" id="1499043"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787421">param</a></span>&nbsp;<span class="op" id="1499049">=</span>&nbsp;<span class="builtintype" id="1499051">nil</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1499057">if</span>&nbsp;<span class="ident" id="1499060"><a href="/gostd/runtime/chan.go.html#1498955">sg</a></span><span class="op" id="1499062">.</span><span class="ident" id="1499063"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786838">releasetime</a></span>&nbsp;<span class="op" id="1499075">!=</span>&nbsp;<span class="num" id="1499078">0</span>&nbsp;<span class="op" id="1499080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1499085"><a href="/gostd/runtime/chan.go.html#1498955">sg</a></span><span class="op" id="1499087">.</span><span class="ident" id="1499088"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786838">releasetime</a></span>&nbsp;<span class="op" id="1499100">=</span>&nbsp;<span class="ident" id="1499102"><a href="/gostd/runtime/stubs.go.html#1744144">cputicks</a></span><span class="op" id="1499110">(</span><span class="op" id="1499111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1499115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1499119"><a href="/gostd/runtime/proc.go.html#1673919">goready</a></span><span class="op" id="1499126">(</span><span class="ident" id="1499127"><a href="/gostd/runtime/chan.go.html#1499011">gp</a></span><span class="op" id="1499129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1499132">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1499135"><a href="/gostd/runtime/lock_futex.go.html#1586629">unlock</a></span><span class="op" id="1499141">(</span><span class="op" id="1499142">&amp;</span><span class="ident" id="1499143"><a href="/gostd/runtime/chan.go.html#1498376">c</a></span><span class="op" id="1499144">.</span><span class="ident" id="1499145"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796775">lock</a></span><span class="op" id="1499149">)</span><br>
<span class="lineno"></span><span class="op" id="1499151">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1499154">//&nbsp;entry&nbsp;points&nbsp;for&nbsp;&lt;-&nbsp;c&nbsp;from&nbsp;compiled&nbsp;code</span><br>
<span class="lineno"></span><span class="comment" id="1499198">//go:nosplit</span><br>
<span class="lineno">310</span><span class="keyword" id="1499211">func</span>&nbsp;<span class="ident" id="1499216">chanrecv1</span><span class="op" id="1499225">(</span><span class="ident" id="1499226">t</span>&nbsp;<span class="op" id="1499228">*</span><span class="ident" id="1499229"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796332">chantype</a></span><span class="op" id="1499237">,</span>&nbsp;<span class="ident" id="1499239">c</span>&nbsp;<span class="op" id="1499241">*</span><span class="ident" id="1499242"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796621">hchan</a></span><span class="op" id="1499247">,</span>&nbsp;<span class="ident" id="1499249">elem</span>&nbsp;<span class="ident" id="1499254"><a href="/gostd/runtime/chan.go.html#1492024">unsafe</a></span><span class="op" id="1499260">.</span><span class="ident" id="1499261">Pointer</span><span class="op" id="1499268">)</span>&nbsp;<span class="op" id="1499270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1499273"><a href="/gostd/runtime/chan.go.html#1499791">chanrecv</a></span><span class="op" id="1499281">(</span><span class="ident" id="1499282"><a href="/gostd/runtime/chan.go.html#1499226">t</a></span><span class="op" id="1499283">,</span>&nbsp;<span class="ident" id="1499285"><a href="/gostd/runtime/chan.go.html#1499239">c</a></span><span class="op" id="1499286">,</span>&nbsp;<span class="ident" id="1499288"><a href="/gostd/runtime/chan.go.html#1499249">elem</a></span><span class="op" id="1499292">,</span>&nbsp;<span class="builtintype" id="1499294">true</span><span class="op" id="1499298">)</span><br>
<span class="lineno"></span><span class="op" id="1499300">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1499303">//go:nosplit</span><br>
<span class="lineno">315</span><span class="keyword" id="1499316">func</span>&nbsp;<span class="ident" id="1499321">chanrecv2</span><span class="op" id="1499330">(</span><span class="ident" id="1499331">t</span>&nbsp;<span class="op" id="1499333">*</span><span class="ident" id="1499334"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796332">chantype</a></span><span class="op" id="1499342">,</span>&nbsp;<span class="ident" id="1499344">c</span>&nbsp;<span class="op" id="1499346">*</span><span class="ident" id="1499347"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796621">hchan</a></span><span class="op" id="1499352">,</span>&nbsp;<span class="ident" id="1499354">elem</span>&nbsp;<span class="ident" id="1499359"><a href="/gostd/runtime/chan.go.html#1492024">unsafe</a></span><span class="op" id="1499365">.</span><span class="ident" id="1499366">Pointer</span><span class="op" id="1499373">)</span>&nbsp;<span class="op" id="1499375">(</span><span class="ident" id="1499376">received</span>&nbsp;<span class="builtintype" id="1499385">bool</span><span class="op" id="1499389">)</span>&nbsp;<span class="op" id="1499391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1499394">_</span><span class="op" id="1499395">,</span>&nbsp;<span class="ident" id="1499397"><a href="/gostd/runtime/chan.go.html#1499376">received</a></span>&nbsp;<span class="op" id="1499406">=</span>&nbsp;<span class="ident" id="1499408"><a href="/gostd/runtime/chan.go.html#1499791">chanrecv</a></span><span class="op" id="1499416">(</span><span class="ident" id="1499417"><a href="/gostd/runtime/chan.go.html#1499331">t</a></span><span class="op" id="1499418">,</span>&nbsp;<span class="ident" id="1499420"><a href="/gostd/runtime/chan.go.html#1499344">c</a></span><span class="op" id="1499421">,</span>&nbsp;<span class="ident" id="1499423"><a href="/gostd/runtime/chan.go.html#1499354">elem</a></span><span class="op" id="1499427">,</span>&nbsp;<span class="builtintype" id="1499429">true</span><span class="op" id="1499433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1499436">return</span><br>
<span class="lineno"></span><span class="op" id="1499443">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">320</span><span class="comment" id="1499446">//&nbsp;chanrecv&nbsp;receives&nbsp;on&nbsp;channel&nbsp;c&nbsp;and&nbsp;writes&nbsp;the&nbsp;received&nbsp;data&nbsp;to&nbsp;ep.</span><br>
<span class="lineno"></span><span class="comment" id="1499516">//&nbsp;ep&nbsp;may&nbsp;be&nbsp;nil,&nbsp;in&nbsp;which&nbsp;case&nbsp;received&nbsp;data&nbsp;is&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="1499574">//&nbsp;If&nbsp;block&nbsp;==&nbsp;false&nbsp;and&nbsp;no&nbsp;elements&nbsp;are&nbsp;available,&nbsp;returns&nbsp;(false,&nbsp;false).</span><br>
<span class="lineno"></span><span class="comment" id="1499650">//&nbsp;Otherwise,&nbsp;if&nbsp;c&nbsp;is&nbsp;closed,&nbsp;zeros&nbsp;*ep&nbsp;and&nbsp;returns&nbsp;(true,&nbsp;false).</span><br>
<span class="lineno"></span><span class="comment" id="1499717">//&nbsp;Otherwise,&nbsp;fills&nbsp;in&nbsp;*ep&nbsp;with&nbsp;an&nbsp;element&nbsp;and&nbsp;returns&nbsp;(true,&nbsp;true).</span><br>
<span class="lineno">325</span><span class="keyword" id="1499786">func</span>&nbsp;<span class="ident" id="1499791">chanrecv</span><span class="op" id="1499799">(</span><span class="ident" id="1499800">t</span>&nbsp;<span class="op" id="1499802">*</span><span class="ident" id="1499803"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796332">chantype</a></span><span class="op" id="1499811">,</span>&nbsp;<span class="ident" id="1499813">c</span>&nbsp;<span class="op" id="1499815">*</span><span class="ident" id="1499816"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796621">hchan</a></span><span class="op" id="1499821">,</span>&nbsp;<span class="ident" id="1499823">ep</span>&nbsp;<span class="ident" id="1499826"><a href="/gostd/runtime/chan.go.html#1492024">unsafe</a></span><span class="op" id="1499832">.</span><span class="ident" id="1499833">Pointer</span><span class="op" id="1499840">,</span>&nbsp;<span class="ident" id="1499842">block</span>&nbsp;<span class="builtintype" id="1499848">bool</span><span class="op" id="1499852">)</span>&nbsp;<span class="op" id="1499854">(</span><span class="ident" id="1499855">selected</span><span class="op" id="1499863">,</span>&nbsp;<span class="ident" id="1499865">received</span>&nbsp;<span class="builtintype" id="1499874">bool</span><span class="op" id="1499878">)</span>&nbsp;<span class="op" id="1499880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1499883">//&nbsp;raceenabled:&nbsp;don&#39;t&nbsp;need&nbsp;to&nbsp;check&nbsp;ep,&nbsp;as&nbsp;it&nbsp;is&nbsp;always&nbsp;on&nbsp;the&nbsp;stack.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1499955">if</span>&nbsp;<span class="ident" id="1499958"><a href="/gostd/runtime/chan.go.html#1492147">debugChan</a></span>&nbsp;<span class="op" id="1499968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1499972">print</span><span class="op" id="1499977">(</span><span class="string" id="1499978">&#34;chanrecv:&nbsp;chan=&#34;</span><span class="op" id="1499995">,</span>&nbsp;<span class="ident" id="1499997"><a href="/gostd/runtime/chan.go.html#1499813">c</a></span><span class="op" id="1499998">,</span>&nbsp;<span class="string" id="1500000">&#34;\n&#34;</span><span class="op" id="1500004">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1500007">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1500011">if</span>&nbsp;<span class="ident" id="1500014"><a href="/gostd/runtime/chan.go.html#1499813">c</a></span>&nbsp;<span class="op" id="1500016">==</span>&nbsp;<span class="builtintype" id="1500019">nil</span>&nbsp;<span class="op" id="1500023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1500027">if</span>&nbsp;<span class="op" id="1500030">!</span><span class="ident" id="1500031"><a href="/gostd/runtime/chan.go.html#1499842">block</a></span>&nbsp;<span class="op" id="1500037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1500042">return</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1500051">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1500055"><a href="/gostd/runtime/proc.go.html#1673271">gopark</a></span><span class="op" id="1500061">(</span><span class="builtintype" id="1500062">nil</span><span class="op" id="1500065">,</span>&nbsp;<span class="builtintype" id="1500067">nil</span><span class="op" id="1500070">,</span>&nbsp;<span class="string" id="1500072">&#34;chan&nbsp;receive&nbsp;(nil&nbsp;chan)&#34;</span><span class="op" id="1500097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1500101"><a href="/gostd/runtime/panic.go.html#1664327">gothrow</a></span><span class="op" id="1500108">(</span><span class="string" id="1500109">&#34;unreachable&#34;</span><span class="op" id="1500122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1500125">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1500129">//&nbsp;Fast&nbsp;path:&nbsp;check&nbsp;for&nbsp;failed&nbsp;non-blocking&nbsp;operation&nbsp;without&nbsp;acquiring&nbsp;the&nbsp;lock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1500212">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1500216">//&nbsp;After&nbsp;observing&nbsp;that&nbsp;the&nbsp;channel&nbsp;is&nbsp;not&nbsp;ready&nbsp;for&nbsp;receiving,&nbsp;we&nbsp;observe&nbsp;that&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1500301">//&nbsp;channel&nbsp;is&nbsp;not&nbsp;closed.&nbsp;Each&nbsp;of&nbsp;these&nbsp;observations&nbsp;is&nbsp;a&nbsp;single&nbsp;word-sized&nbsp;read</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1500383">//&nbsp;(first&nbsp;c.sendq.first&nbsp;or&nbsp;c.qcount,&nbsp;and&nbsp;second&nbsp;c.closed).</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1500443">//&nbsp;Because&nbsp;a&nbsp;channel&nbsp;cannot&nbsp;be&nbsp;reopened,&nbsp;the&nbsp;later&nbsp;observation&nbsp;of&nbsp;the&nbsp;channel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1500522">//&nbsp;being&nbsp;not&nbsp;closed&nbsp;implies&nbsp;that&nbsp;it&nbsp;was&nbsp;also&nbsp;not&nbsp;closed&nbsp;at&nbsp;the&nbsp;moment&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1500600">//&nbsp;first&nbsp;observation.&nbsp;We&nbsp;behave&nbsp;as&nbsp;if&nbsp;we&nbsp;observed&nbsp;the&nbsp;channel&nbsp;at&nbsp;that&nbsp;moment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1500678">//&nbsp;and&nbsp;report&nbsp;that&nbsp;the&nbsp;receive&nbsp;cannot&nbsp;proceed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1500726">//</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1500730">//&nbsp;The&nbsp;order&nbsp;of&nbsp;operations&nbsp;is&nbsp;important&nbsp;here:&nbsp;reversing&nbsp;the&nbsp;operations&nbsp;can&nbsp;lead&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1500814">//&nbsp;incorrect&nbsp;behavior&nbsp;when&nbsp;racing&nbsp;with&nbsp;a&nbsp;close.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1500863">if</span>&nbsp;<span class="op" id="1500866">!</span><span class="ident" id="1500867"><a href="/gostd/runtime/chan.go.html#1499842">block</a></span>&nbsp;<span class="op" id="1500873">&amp;&amp;</span>&nbsp;<span class="op" id="1500876">(</span><span class="ident" id="1500877"><a href="/gostd/runtime/chan.go.html#1499813">c</a></span><span class="op" id="1500878">.</span><span class="ident" id="1500879"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796650">dataqsiz</a></span>&nbsp;<span class="op" id="1500888">==</span>&nbsp;<span class="num" id="1500891">0</span>&nbsp;<span class="op" id="1500893">&amp;&amp;</span>&nbsp;<span class="ident" id="1500896"><a href="/gostd/runtime/chan.go.html#1499813">c</a></span><span class="op" id="1500897">.</span><span class="ident" id="1500898"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796762">sendq</a></span><span class="op" id="1500903">.</span><span class="ident" id="1500904"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796587">first</a></span>&nbsp;<span class="op" id="1500910">==</span>&nbsp;<span class="builtintype" id="1500913">nil</span>&nbsp;<span class="op" id="1500917">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1500922"><a href="/gostd/runtime/chan.go.html#1499813">c</a></span><span class="op" id="1500923">.</span><span class="ident" id="1500924"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796650">dataqsiz</a></span>&nbsp;<span class="op" id="1500933">&gt;</span>&nbsp;<span class="num" id="1500935">0</span>&nbsp;<span class="op" id="1500937">&amp;&amp;</span>&nbsp;<span class="ident" id="1500940"><a href="/gostd/runtime/stubs.go.html#1745073">atomicloaduint</a></span><span class="op" id="1500954">(</span><span class="op" id="1500955">&amp;</span><span class="ident" id="1500956"><a href="/gostd/runtime/chan.go.html#1499813">c</a></span><span class="op" id="1500957">.</span><span class="ident" id="1500958"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796637">qcount</a></span><span class="op" id="1500964">)</span>&nbsp;<span class="op" id="1500966">==</span>&nbsp;<span class="num" id="1500969">0</span><span class="op" id="1500970">)</span>&nbsp;<span class="op" id="1500972">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1500977"><a href="/gostd/runtime/atomic.go.html#1481330">atomicload</a></span><span class="op" id="1500987">(</span><span class="op" id="1500988">&amp;</span><span class="ident" id="1500989"><a href="/gostd/runtime/chan.go.html#1499813">c</a></span><span class="op" id="1500990">.</span><span class="ident" id="1500991"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796693">closed</a></span><span class="op" id="1500997">)</span>&nbsp;<span class="op" id="1500999">==</span>&nbsp;<span class="num" id="1501002">0</span>&nbsp;<span class="op" id="1501004">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1501008">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1501016">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1501020">var</span>&nbsp;<span class="ident" id="1501024">t0</span>&nbsp;<span class="builtintype" id="1501027">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1501034">if</span>&nbsp;<span class="ident" id="1501037"><a href="/gostd/runtime/mprof.go.html#1626211">blockprofilerate</a></span>&nbsp;<span class="op" id="1501054">&gt;</span>&nbsp;<span class="num" id="1501056">0</span>&nbsp;<span class="op" id="1501058">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1501062"><a href="/gostd/runtime/chan.go.html#1501024">t0</a></span>&nbsp;<span class="op" id="1501065">=</span>&nbsp;<span class="ident" id="1501067"><a href="/gostd/runtime/stubs.go.html#1744144">cputicks</a></span><span class="op" id="1501075">(</span><span class="op" id="1501076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1501079">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1501083"><a href="/gostd/runtime/lock_futex.go.html#1585337">lock</a></span><span class="op" id="1501087">(</span><span class="op" id="1501088">&amp;</span><span class="ident" id="1501089"><a href="/gostd/runtime/chan.go.html#1499813">c</a></span><span class="op" id="1501090">.</span><span class="ident" id="1501091"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796775">lock</a></span><span class="op" id="1501095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1501098">if</span>&nbsp;<span class="ident" id="1501101"><a href="/gostd/runtime/chan.go.html#1499813">c</a></span><span class="op" id="1501102">.</span><span class="ident" id="1501103"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796650">dataqsiz</a></span>&nbsp;<span class="op" id="1501112">==</span>&nbsp;<span class="num" id="1501115">0</span>&nbsp;<span class="op" id="1501117">{</span>&nbsp;<span class="comment" id="1501119">//&nbsp;synchronous&nbsp;channel</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1501144">if</span>&nbsp;<span class="ident" id="1501147"><a href="/gostd/runtime/chan.go.html#1499813">c</a></span><span class="op" id="1501148">.</span><span class="ident" id="1501149"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796693">closed</a></span>&nbsp;<span class="op" id="1501156">!=</span>&nbsp;<span class="num" id="1501159">0</span>&nbsp;<span class="op" id="1501161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1501166">return</span>&nbsp;<span class="ident" id="1501173"><a href="/gostd/runtime/chan.go.html#1503890">recvclosed</a></span><span class="op" id="1501183">(</span><span class="ident" id="1501184"><a href="/gostd/runtime/chan.go.html#1499813">c</a></span><span class="op" id="1501185">,</span>&nbsp;<span class="ident" id="1501187"><a href="/gostd/runtime/chan.go.html#1499823">ep</a></span><span class="op" id="1501189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1501193">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1501198">sg</span>&nbsp;<span class="op" id="1501201">:=</span>&nbsp;<span class="ident" id="1501204"><a href="/gostd/runtime/chan.go.html#1499813">c</a></span><span class="op" id="1501205">.</span><span class="ident" id="1501206"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796762">sendq</a></span><span class="op" id="1501211">.</span><span class="ident" id="1501212"><a href="/gostd/runtime/chan.go.html#1505850">dequeue</a></span><span class="op" id="1501219">(</span><span class="op" id="1501220">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1501224">if</span>&nbsp;<span class="ident" id="1501227"><a href="/gostd/runtime/chan.go.html#1501198">sg</a></span>&nbsp;<span class="op" id="1501230">!=</span>&nbsp;<span class="builtintype" id="1501233">nil</span>&nbsp;<span class="op" id="1501237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1501242">if</span>&nbsp;<span class="ident" id="1501245"><a href="/gostd/runtime/race0.go.html#1676514">raceenabled</a></span>&nbsp;<span class="op" id="1501257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1501263"><a href="/gostd/runtime/chan.go.html#1506248">racesync</a></span><span class="op" id="1501271">(</span><span class="ident" id="1501272"><a href="/gostd/runtime/chan.go.html#1499813">c</a></span><span class="op" id="1501273">,</span>&nbsp;<span class="ident" id="1501275"><a href="/gostd/runtime/chan.go.html#1501198">sg</a></span><span class="op" id="1501277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1501282">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1501287"><a href="/gostd/runtime/lock_futex.go.html#1586629">unlock</a></span><span class="op" id="1501293">(</span><span class="op" id="1501294">&amp;</span><span class="ident" id="1501295"><a href="/gostd/runtime/chan.go.html#1499813">c</a></span><span class="op" id="1501296">.</span><span class="ident" id="1501297"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796775">lock</a></span><span class="op" id="1501301">)</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1501307">if</span>&nbsp;<span class="ident" id="1501310"><a href="/gostd/runtime/chan.go.html#1499823">ep</a></span>&nbsp;<span class="op" id="1501313">!=</span>&nbsp;<span class="builtintype" id="1501316">nil</span>&nbsp;<span class="op" id="1501320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1501326"><a href="/gostd/runtime/stubs.go.html#1742708">memmove</a></span><span class="op" id="1501333">(</span><span class="ident" id="1501334"><a href="/gostd/runtime/chan.go.html#1499823">ep</a></span><span class="op" id="1501336">,</span>&nbsp;<span class="ident" id="1501338"><a href="/gostd/runtime/chan.go.html#1501198">sg</a></span><span class="op" id="1501340">.</span><span class="ident" id="1501341"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786817">elem</a></span><span class="op" id="1501345">,</span>&nbsp;<span class="builtintype" id="1501347">uintptr</span><span class="op" id="1501354">(</span><span class="ident" id="1501355"><a href="/gostd/runtime/chan.go.html#1499813">c</a></span><span class="op" id="1501356">.</span><span class="ident" id="1501357"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796676">elemsize</a></span><span class="op" id="1501365">)</span><span class="op" id="1501366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1501371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1501376"><a href="/gostd/runtime/chan.go.html#1501198">sg</a></span><span class="op" id="1501378">.</span><span class="ident" id="1501379"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786817">elem</a></span>&nbsp;<span class="op" id="1501384">=</span>&nbsp;<span class="builtintype" id="1501386">nil</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1501393">gp</span>&nbsp;<span class="op" id="1501396">:=</span>&nbsp;<span class="ident" id="1501399"><a href="/gostd/runtime/chan.go.html#1501198">sg</a></span><span class="op" id="1501401">.</span><span class="ident" id="1501402"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786765">g</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1501407"><a href="/gostd/runtime/chan.go.html#1501393">gp</a></span><span class="op" id="1501409">.</span><span class="ident" id="1501410"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787421">param</a></span>&nbsp;<span class="op" id="1501416">=</span>&nbsp;<span class="ident" id="1501418"><a href="/gostd/runtime/chan.go.html#1492024">unsafe</a></span><span class="op" id="1501424">.</span><span class="ident" id="1501425">Pointer</span><span class="op" id="1501432">(</span><span class="ident" id="1501433"><a href="/gostd/runtime/chan.go.html#1501198">sg</a></span><span class="op" id="1501435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1501440">if</span>&nbsp;<span class="ident" id="1501443"><a href="/gostd/runtime/chan.go.html#1501198">sg</a></span><span class="op" id="1501445">.</span><span class="ident" id="1501446"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786838">releasetime</a></span>&nbsp;<span class="op" id="1501458">!=</span>&nbsp;<span class="num" id="1501461">0</span>&nbsp;<span class="op" id="1501463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1501469"><a href="/gostd/runtime/chan.go.html#1501198">sg</a></span><span class="op" id="1501471">.</span><span class="ident" id="1501472"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786838">releasetime</a></span>&nbsp;<span class="op" id="1501484">=</span>&nbsp;<span class="ident" id="1501486"><a href="/gostd/runtime/stubs.go.html#1744144">cputicks</a></span><span class="op" id="1501494">(</span><span class="op" id="1501495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1501500">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1501505"><a href="/gostd/runtime/proc.go.html#1673919">goready</a></span><span class="op" id="1501512">(</span><span class="ident" id="1501513"><a href="/gostd/runtime/chan.go.html#1501393">gp</a></span><span class="op" id="1501515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1501520"><a href="/gostd/runtime/chan.go.html#1499855">selected</a></span>&nbsp;<span class="op" id="1501529">=</span>&nbsp;<span class="builtintype" id="1501531">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1501539"><a href="/gostd/runtime/chan.go.html#1499865">received</a></span>&nbsp;<span class="op" id="1501548">=</span>&nbsp;<span class="builtintype" id="1501550">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1501558">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1501567">}</span><br>
<span class="lineno">390</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1501572">if</span>&nbsp;<span class="op" id="1501575">!</span><span class="ident" id="1501576"><a href="/gostd/runtime/chan.go.html#1499842">block</a></span>&nbsp;<span class="op" id="1501582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1501587"><a href="/gostd/runtime/lock_futex.go.html#1586629">unlock</a></span><span class="op" id="1501593">(</span><span class="op" id="1501594">&amp;</span><span class="ident" id="1501595"><a href="/gostd/runtime/chan.go.html#1499813">c</a></span><span class="op" id="1501596">.</span><span class="ident" id="1501597"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796775">lock</a></span><span class="op" id="1501601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1501606">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1501615">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1501620">//&nbsp;no&nbsp;sender&nbsp;available:&nbsp;block&nbsp;on&nbsp;this&nbsp;channel.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1501669">gp</span>&nbsp;<span class="op" id="1501672">:=</span>&nbsp;<span class="ident" id="1501675"><a href="/gostd/runtime/stubs.go.html#1738919">getg</a></span><span class="op" id="1501679">(</span><span class="op" id="1501680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1501684">mysg</span>&nbsp;<span class="op" id="1501689">:=</span>&nbsp;<span class="ident" id="1501692"><a href="/gostd/runtime/proc.go.html#1674038">acquireSudog</a></span><span class="op" id="1501704">(</span><span class="op" id="1501705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1501709"><a href="/gostd/runtime/chan.go.html#1501684">mysg</a></span><span class="op" id="1501713">.</span><span class="ident" id="1501714"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786838">releasetime</a></span>&nbsp;<span class="op" id="1501726">=</span>&nbsp;<span class="num" id="1501728">0</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1501732">if</span>&nbsp;<span class="ident" id="1501735"><a href="/gostd/runtime/chan.go.html#1501024">t0</a></span>&nbsp;<span class="op" id="1501738">!=</span>&nbsp;<span class="num" id="1501741">0</span>&nbsp;<span class="op" id="1501743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1501748"><a href="/gostd/runtime/chan.go.html#1501684">mysg</a></span><span class="op" id="1501752">.</span><span class="ident" id="1501753"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786838">releasetime</a></span>&nbsp;<span class="op" id="1501765">=</span>&nbsp;<span class="op" id="1501767">-</span><span class="num" id="1501768">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1501772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1501776"><a href="/gostd/runtime/chan.go.html#1501684">mysg</a></span><span class="op" id="1501780">.</span><span class="ident" id="1501781"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786817">elem</a></span>&nbsp;<span class="op" id="1501786">=</span>&nbsp;<span class="ident" id="1501788"><a href="/gostd/runtime/chan.go.html#1499823">ep</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1501793"><a href="/gostd/runtime/chan.go.html#1501684">mysg</a></span><span class="op" id="1501797">.</span><span class="ident" id="1501798"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786873">waitlink</a></span>&nbsp;<span class="op" id="1501807">=</span>&nbsp;<span class="builtintype" id="1501809">nil</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1501815"><a href="/gostd/runtime/chan.go.html#1501669">gp</a></span><span class="op" id="1501817">.</span><span class="ident" id="1501818"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787771">waiting</a></span>&nbsp;<span class="op" id="1501826">=</span>&nbsp;<span class="ident" id="1501828"><a href="/gostd/runtime/chan.go.html#1501684">mysg</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1501835"><a href="/gostd/runtime/chan.go.html#1501684">mysg</a></span><span class="op" id="1501839">.</span><span class="ident" id="1501840"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786765">g</a></span>&nbsp;<span class="op" id="1501842">=</span>&nbsp;<span class="ident" id="1501844"><a href="/gostd/runtime/chan.go.html#1501669">gp</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1501849"><a href="/gostd/runtime/chan.go.html#1501684">mysg</a></span><span class="op" id="1501853">.</span><span class="ident" id="1501854"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786771">selectdone</a></span>&nbsp;<span class="op" id="1501865">=</span>&nbsp;<span class="builtintype" id="1501867">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1501873"><a href="/gostd/runtime/chan.go.html#1501669">gp</a></span><span class="op" id="1501875">.</span><span class="ident" id="1501876"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787421">param</a></span>&nbsp;<span class="op" id="1501882">=</span>&nbsp;<span class="builtintype" id="1501884">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1501890"><a href="/gostd/runtime/chan.go.html#1499813">c</a></span><span class="op" id="1501891">.</span><span class="ident" id="1501892"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796749">recvq</a></span><span class="op" id="1501897">.</span><span class="ident" id="1501898"><a href="/gostd/runtime/chan.go.html#1505696">enqueue</a></span><span class="op" id="1501905">(</span><span class="ident" id="1501906"><a href="/gostd/runtime/chan.go.html#1501684">mysg</a></span><span class="op" id="1501910">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1501914"><a href="/gostd/runtime/proc.go.html#1673799">goparkunlock</a></span><span class="op" id="1501926">(</span><span class="op" id="1501927">&amp;</span><span class="ident" id="1501928"><a href="/gostd/runtime/chan.go.html#1499813">c</a></span><span class="op" id="1501929">.</span><span class="ident" id="1501930"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796775">lock</a></span><span class="op" id="1501934">,</span>&nbsp;<span class="string" id="1501936">&#34;chan&nbsp;receive&#34;</span><span class="op" id="1501950">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1501955">//&nbsp;someone&nbsp;woke&nbsp;us&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1501979">if</span>&nbsp;<span class="ident" id="1501982"><a href="/gostd/runtime/chan.go.html#1501684">mysg</a></span>&nbsp;<span class="op" id="1501987">!=</span>&nbsp;<span class="ident" id="1501990"><a href="/gostd/runtime/chan.go.html#1501669">gp</a></span><span class="op" id="1501992">.</span><span class="ident" id="1501993"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787771">waiting</a></span>&nbsp;<span class="op" id="1502001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1502006"><a href="/gostd/runtime/panic.go.html#1664327">gothrow</a></span><span class="op" id="1502013">(</span><span class="string" id="1502014">&#34;G&nbsp;waiting&nbsp;list&nbsp;is&nbsp;corrupted!&#34;</span><span class="op" id="1502044">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1502048">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1502052"><a href="/gostd/runtime/chan.go.html#1501669">gp</a></span><span class="op" id="1502054">.</span><span class="ident" id="1502055"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787771">waiting</a></span>&nbsp;<span class="op" id="1502063">=</span>&nbsp;<span class="builtintype" id="1502065">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1502071">if</span>&nbsp;<span class="ident" id="1502074"><a href="/gostd/runtime/chan.go.html#1501684">mysg</a></span><span class="op" id="1502078">.</span><span class="ident" id="1502079"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786838">releasetime</a></span>&nbsp;<span class="op" id="1502091">&gt;</span>&nbsp;<span class="num" id="1502093">0</span>&nbsp;<span class="op" id="1502095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1502100"><a href="/gostd/runtime/mprof.go.html#1626994">blockevent</a></span><span class="op" id="1502110">(</span><span class="ident" id="1502111"><a href="/gostd/runtime/chan.go.html#1501684">mysg</a></span><span class="op" id="1502115">.</span><span class="ident" id="1502116"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786838">releasetime</a></span><span class="op" id="1502127">-</span><span class="ident" id="1502128"><a href="/gostd/runtime/chan.go.html#1501024">t0</a></span><span class="op" id="1502130">,</span>&nbsp;<span class="num" id="1502132">2</span><span class="op" id="1502133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1502137">}</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1502141">haveData</span>&nbsp;<span class="op" id="1502150">:=</span>&nbsp;<span class="ident" id="1502153"><a href="/gostd/runtime/chan.go.html#1501669">gp</a></span><span class="op" id="1502155">.</span><span class="ident" id="1502156"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787421">param</a></span>&nbsp;<span class="op" id="1502162">!=</span>&nbsp;<span class="builtintype" id="1502165">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1502171"><a href="/gostd/runtime/chan.go.html#1501669">gp</a></span><span class="op" id="1502173">.</span><span class="ident" id="1502174"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1787421">param</a></span>&nbsp;<span class="op" id="1502180">=</span>&nbsp;<span class="builtintype" id="1502182">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1502188"><a href="/gostd/runtime/proc.go.html#1674768">releaseSudog</a></span><span class="op" id="1502200">(</span><span class="ident" id="1502201"><a href="/gostd/runtime/chan.go.html#1501684">mysg</a></span><span class="op" id="1502205">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1502210">if</span>&nbsp;<span class="ident" id="1502213"><a href="/gostd/runtime/chan.go.html#1502141">haveData</a></span>&nbsp;<span class="op" id="1502222">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1502227">//&nbsp;a&nbsp;sender&nbsp;sent&nbsp;us&nbsp;some&nbsp;data.&nbsp;It&nbsp;already&nbsp;wrote&nbsp;to&nbsp;ep.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1502285"><a href="/gostd/runtime/chan.go.html#1499855">selected</a></span>&nbsp;<span class="op" id="1502294">=</span>&nbsp;<span class="builtintype" id="1502296">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1502304"><a href="/gostd/runtime/chan.go.html#1499865">received</a></span>&nbsp;<span class="op" id="1502313">=</span>&nbsp;<span class="builtintype" id="1502315">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1502323">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1502332">}</span><br>
<span class="lineno">430</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1502337"><a href="/gostd/runtime/lock_futex.go.html#1585337">lock</a></span><span class="op" id="1502341">(</span><span class="op" id="1502342">&amp;</span><span class="ident" id="1502343"><a href="/gostd/runtime/chan.go.html#1499813">c</a></span><span class="op" id="1502344">.</span><span class="ident" id="1502345"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796775">lock</a></span><span class="op" id="1502349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1502353">if</span>&nbsp;<span class="ident" id="1502356"><a href="/gostd/runtime/chan.go.html#1499813">c</a></span><span class="op" id="1502357">.</span><span class="ident" id="1502358"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796693">closed</a></span>&nbsp;<span class="op" id="1502365">==</span>&nbsp;<span class="num" id="1502368">0</span>&nbsp;<span class="op" id="1502370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1502375"><a href="/gostd/runtime/panic.go.html#1664327">gothrow</a></span><span class="op" id="1502382">(</span><span class="string" id="1502383">&#34;chanrecv:&nbsp;spurious&nbsp;wakeup&#34;</span><span class="op" id="1502410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1502414">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1502418">return</span>&nbsp;<span class="ident" id="1502425"><a href="/gostd/runtime/chan.go.html#1503890">recvclosed</a></span><span class="op" id="1502435">(</span><span class="ident" id="1502436"><a href="/gostd/runtime/chan.go.html#1499813">c</a></span><span class="op" id="1502437">,</span>&nbsp;<span class="ident" id="1502439"><a href="/gostd/runtime/chan.go.html#1499823">ep</a></span><span class="op" id="1502441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1502444">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1502448">//&nbsp;asynchronous&nbsp;channel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1502473">//&nbsp;wait&nbsp;for&nbsp;some&nbsp;data&nbsp;to&nbsp;appear</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1502506">var</span>&nbsp;<span class="ident" id="1502510">t1</span>&nbsp;<span class="builtintype" id="1502513">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1502520">for</span>&nbsp;<span class="ident" id="1502524"><a href="/gostd/runtime/chan.go.html#1499813">c</a></span><span class="op" id="1502525">.</span><span class="ident" id="1502526"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796637">qcount</a></span>&nbsp;<span class="op" id="1502533">&lt;=</span>&nbsp;<span class="num" id="1502536">0</span>&nbsp;<span class="op" id="1502538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1502542">if</span>&nbsp;<span class="ident" id="1502545"><a href="/gostd/runtime/chan.go.html#1499813">c</a></span><span class="op" id="1502546">.</span><span class="ident" id="1502547"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796693">closed</a></span>&nbsp;<span class="op" id="1502554">!=</span>&nbsp;<span class="num" id="1502557">0</span>&nbsp;<span class="op" id="1502559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1502564"><a href="/gostd/runtime/chan.go.html#1499855">selected</a></span><span class="op" id="1502572">,</span>&nbsp;<span class="ident" id="1502574"><a href="/gostd/runtime/chan.go.html#1499865">received</a></span>&nbsp;<span class="op" id="1502583">=</span>&nbsp;<span class="ident" id="1502585"><a href="/gostd/runtime/chan.go.html#1503890">recvclosed</a></span><span class="op" id="1502595">(</span><span class="ident" id="1502596"><a href="/gostd/runtime/chan.go.html#1499813">c</a></span><span class="op" id="1502597">,</span>&nbsp;<span class="ident" id="1502599"><a href="/gostd/runtime/chan.go.html#1499823">ep</a></span><span class="op" id="1502601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1502606">if</span>&nbsp;<span class="ident" id="1502609"><a href="/gostd/runtime/chan.go.html#1502510">t1</a></span>&nbsp;<span class="op" id="1502612">&gt;</span>&nbsp;<span class="num" id="1502614">0</span>&nbsp;<span class="op" id="1502616">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1502622"><a href="/gostd/runtime/mprof.go.html#1626994">blockevent</a></span><span class="op" id="1502632">(</span><span class="ident" id="1502633"><a href="/gostd/runtime/chan.go.html#1502510">t1</a></span><span class="op" id="1502635">-</span><span class="ident" id="1502636"><a href="/gostd/runtime/chan.go.html#1501024">t0</a></span><span class="op" id="1502638">,</span>&nbsp;<span class="num" id="1502640">2</span><span class="op" id="1502641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1502646">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1502651">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1502660">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1502665">if</span>&nbsp;<span class="op" id="1502668">!</span><span class="ident" id="1502669"><a href="/gostd/runtime/chan.go.html#1499842">block</a></span>&nbsp;<span class="op" id="1502675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1502680"><a href="/gostd/runtime/lock_futex.go.html#1586629">unlock</a></span><span class="op" id="1502686">(</span><span class="op" id="1502687">&amp;</span><span class="ident" id="1502688"><a href="/gostd/runtime/chan.go.html#1499813">c</a></span><span class="op" id="1502689">.</span><span class="ident" id="1502690"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796775">lock</a></span><span class="op" id="1502694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1502699">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1502708">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1502713">//&nbsp;wait&nbsp;for&nbsp;someone&nbsp;to&nbsp;send&nbsp;an&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1502754">gp</span>&nbsp;<span class="op" id="1502757">:=</span>&nbsp;<span class="ident" id="1502760"><a href="/gostd/runtime/stubs.go.html#1738919">getg</a></span><span class="op" id="1502764">(</span><span class="op" id="1502765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1502769">mysg</span>&nbsp;<span class="op" id="1502774">:=</span>&nbsp;<span class="ident" id="1502777"><a href="/gostd/runtime/proc.go.html#1674038">acquireSudog</a></span><span class="op" id="1502789">(</span><span class="op" id="1502790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1502794"><a href="/gostd/runtime/chan.go.html#1502769">mysg</a></span><span class="op" id="1502798">.</span><span class="ident" id="1502799"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786838">releasetime</a></span>&nbsp;<span class="op" id="1502811">=</span>&nbsp;<span class="num" id="1502813">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1502817">if</span>&nbsp;<span class="ident" id="1502820"><a href="/gostd/runtime/chan.go.html#1501024">t0</a></span>&nbsp;<span class="op" id="1502823">!=</span>&nbsp;<span class="num" id="1502826">0</span>&nbsp;<span class="op" id="1502828">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1502833"><a href="/gostd/runtime/chan.go.html#1502769">mysg</a></span><span class="op" id="1502837">.</span><span class="ident" id="1502838"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786838">releasetime</a></span>&nbsp;<span class="op" id="1502850">=</span>&nbsp;<span class="op" id="1502852">-</span><span class="num" id="1502853">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1502857">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1502861"><a href="/gostd/runtime/chan.go.html#1502769">mysg</a></span><span class="op" id="1502865">.</span><span class="ident" id="1502866"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786817">elem</a></span>&nbsp;<span class="op" id="1502871">=</span>&nbsp;<span class="builtintype" id="1502873">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1502879"><a href="/gostd/runtime/chan.go.html#1502769">mysg</a></span><span class="op" id="1502883">.</span><span class="ident" id="1502884"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786765">g</a></span>&nbsp;<span class="op" id="1502886">=</span>&nbsp;<span class="ident" id="1502888"><a href="/gostd/runtime/chan.go.html#1502754">gp</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1502893"><a href="/gostd/runtime/chan.go.html#1502769">mysg</a></span><span class="op" id="1502897">.</span><span class="ident" id="1502898"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786771">selectdone</a></span>&nbsp;<span class="op" id="1502909">=</span>&nbsp;<span class="builtintype" id="1502911">nil</span><br>
<span class="lineno">465</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1502918"><a href="/gostd/runtime/chan.go.html#1499813">c</a></span><span class="op" id="1502919">.</span><span class="ident" id="1502920"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796749">recvq</a></span><span class="op" id="1502925">.</span><span class="ident" id="1502926"><a href="/gostd/runtime/chan.go.html#1505696">enqueue</a></span><span class="op" id="1502933">(</span><span class="ident" id="1502934"><a href="/gostd/runtime/chan.go.html#1502769">mysg</a></span><span class="op" id="1502938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1502942"><a href="/gostd/runtime/proc.go.html#1673799">goparkunlock</a></span><span class="op" id="1502954">(</span><span class="op" id="1502955">&amp;</span><span class="ident" id="1502956"><a href="/gostd/runtime/chan.go.html#1499813">c</a></span><span class="op" id="1502957">.</span><span class="ident" id="1502958"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796775">lock</a></span><span class="op" id="1502962">,</span>&nbsp;<span class="string" id="1502964">&#34;chan&nbsp;receive&#34;</span><span class="op" id="1502978">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1502983">//&nbsp;someone&nbsp;woke&nbsp;us&nbsp;up&nbsp;-&nbsp;try&nbsp;again</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1503019">if</span>&nbsp;<span class="ident" id="1503022"><a href="/gostd/runtime/chan.go.html#1502769">mysg</a></span><span class="op" id="1503026">.</span><span class="ident" id="1503027"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786838">releasetime</a></span>&nbsp;<span class="op" id="1503039">&gt;</span>&nbsp;<span class="num" id="1503041">0</span>&nbsp;<span class="op" id="1503043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1503048"><a href="/gostd/runtime/chan.go.html#1502510">t1</a></span>&nbsp;<span class="op" id="1503051">=</span>&nbsp;<span class="ident" id="1503053"><a href="/gostd/runtime/chan.go.html#1502769">mysg</a></span><span class="op" id="1503057">.</span><span class="ident" id="1503058"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786838">releasetime</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1503072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1503076"><a href="/gostd/runtime/proc.go.html#1674768">releaseSudog</a></span><span class="op" id="1503088">(</span><span class="ident" id="1503089"><a href="/gostd/runtime/chan.go.html#1502769">mysg</a></span><span class="op" id="1503093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1503097"><a href="/gostd/runtime/lock_futex.go.html#1585337">lock</a></span><span class="op" id="1503101">(</span><span class="op" id="1503102">&amp;</span><span class="ident" id="1503103"><a href="/gostd/runtime/chan.go.html#1499813">c</a></span><span class="op" id="1503104">.</span><span class="ident" id="1503105"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796775">lock</a></span><span class="op" id="1503109">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1503112">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1503116">if</span>&nbsp;<span class="ident" id="1503119"><a href="/gostd/runtime/race0.go.html#1676514">raceenabled</a></span>&nbsp;<span class="op" id="1503131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1503135"><a href="/gostd/runtime/race0.go.html#1677480">raceacquire</a></span><span class="op" id="1503146">(</span><span class="ident" id="1503147"><a href="/gostd/runtime/chan.go.html#1493709">chanbuf</a></span><span class="op" id="1503154">(</span><span class="ident" id="1503155"><a href="/gostd/runtime/chan.go.html#1499813">c</a></span><span class="op" id="1503156">,</span>&nbsp;<span class="ident" id="1503158"><a href="/gostd/runtime/chan.go.html#1499813">c</a></span><span class="op" id="1503159">.</span><span class="ident" id="1503160"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796737">recvx</a></span><span class="op" id="1503165">)</span><span class="op" id="1503166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1503170"><a href="/gostd/runtime/race0.go.html#1677672">racerelease</a></span><span class="op" id="1503181">(</span><span class="ident" id="1503182"><a href="/gostd/runtime/chan.go.html#1493709">chanbuf</a></span><span class="op" id="1503189">(</span><span class="ident" id="1503190"><a href="/gostd/runtime/chan.go.html#1499813">c</a></span><span class="op" id="1503191">,</span>&nbsp;<span class="ident" id="1503193"><a href="/gostd/runtime/chan.go.html#1499813">c</a></span><span class="op" id="1503194">.</span><span class="ident" id="1503195"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796737">recvx</a></span><span class="op" id="1503200">)</span><span class="op" id="1503201">)</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1503204">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1503207">if</span>&nbsp;<span class="ident" id="1503210"><a href="/gostd/runtime/chan.go.html#1499823">ep</a></span>&nbsp;<span class="op" id="1503213">!=</span>&nbsp;<span class="builtintype" id="1503216">nil</span>&nbsp;<span class="op" id="1503220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1503224"><a href="/gostd/runtime/stubs.go.html#1742708">memmove</a></span><span class="op" id="1503231">(</span><span class="ident" id="1503232"><a href="/gostd/runtime/chan.go.html#1499823">ep</a></span><span class="op" id="1503234">,</span>&nbsp;<span class="ident" id="1503236"><a href="/gostd/runtime/chan.go.html#1493709">chanbuf</a></span><span class="op" id="1503243">(</span><span class="ident" id="1503244"><a href="/gostd/runtime/chan.go.html#1499813">c</a></span><span class="op" id="1503245">,</span>&nbsp;<span class="ident" id="1503247"><a href="/gostd/runtime/chan.go.html#1499813">c</a></span><span class="op" id="1503248">.</span><span class="ident" id="1503249"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796737">recvx</a></span><span class="op" id="1503254">)</span><span class="op" id="1503255">,</span>&nbsp;<span class="builtintype" id="1503257">uintptr</span><span class="op" id="1503264">(</span><span class="ident" id="1503265"><a href="/gostd/runtime/chan.go.html#1499813">c</a></span><span class="op" id="1503266">.</span><span class="ident" id="1503267"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796676">elemsize</a></span><span class="op" id="1503275">)</span><span class="op" id="1503276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1503279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1503282"><a href="/gostd/runtime/stubs.go.html#1742585">memclr</a></span><span class="op" id="1503288">(</span><span class="ident" id="1503289"><a href="/gostd/runtime/chan.go.html#1493709">chanbuf</a></span><span class="op" id="1503296">(</span><span class="ident" id="1503297"><a href="/gostd/runtime/chan.go.html#1499813">c</a></span><span class="op" id="1503298">,</span>&nbsp;<span class="ident" id="1503300"><a href="/gostd/runtime/chan.go.html#1499813">c</a></span><span class="op" id="1503301">.</span><span class="ident" id="1503302"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796737">recvx</a></span><span class="op" id="1503307">)</span><span class="op" id="1503308">,</span>&nbsp;<span class="builtintype" id="1503310">uintptr</span><span class="op" id="1503317">(</span><span class="ident" id="1503318"><a href="/gostd/runtime/chan.go.html#1499813">c</a></span><span class="op" id="1503319">.</span><span class="ident" id="1503320"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796676">elemsize</a></span><span class="op" id="1503328">)</span><span class="op" id="1503329">)</span><br>
<span class="lineno">485</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1503333"><a href="/gostd/runtime/chan.go.html#1499813">c</a></span><span class="op" id="1503334">.</span><span class="ident" id="1503335"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796737">recvx</a></span><span class="op" id="1503340">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1503344">if</span>&nbsp;<span class="ident" id="1503347"><a href="/gostd/runtime/chan.go.html#1499813">c</a></span><span class="op" id="1503348">.</span><span class="ident" id="1503349"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796737">recvx</a></span>&nbsp;<span class="op" id="1503355">==</span>&nbsp;<span class="ident" id="1503358"><a href="/gostd/runtime/chan.go.html#1499813">c</a></span><span class="op" id="1503359">.</span><span class="ident" id="1503360"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796650">dataqsiz</a></span>&nbsp;<span class="op" id="1503369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1503373"><a href="/gostd/runtime/chan.go.html#1499813">c</a></span><span class="op" id="1503374">.</span><span class="ident" id="1503375"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796737">recvx</a></span>&nbsp;<span class="op" id="1503381">=</span>&nbsp;<span class="num" id="1503383">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1503386">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1503389"><a href="/gostd/runtime/chan.go.html#1499813">c</a></span><span class="op" id="1503390">.</span><span class="ident" id="1503391"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796637">qcount</a></span><span class="op" id="1503397">--</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1503402">//&nbsp;ping&nbsp;a&nbsp;sender&nbsp;now&nbsp;that&nbsp;there&nbsp;is&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1503444">sg</span>&nbsp;<span class="op" id="1503447">:=</span>&nbsp;<span class="ident" id="1503450"><a href="/gostd/runtime/chan.go.html#1499813">c</a></span><span class="op" id="1503451">.</span><span class="ident" id="1503452"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796762">sendq</a></span><span class="op" id="1503457">.</span><span class="ident" id="1503458"><a href="/gostd/runtime/chan.go.html#1505850">dequeue</a></span><span class="op" id="1503465">(</span><span class="op" id="1503466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1503469">if</span>&nbsp;<span class="ident" id="1503472"><a href="/gostd/runtime/chan.go.html#1503444">sg</a></span>&nbsp;<span class="op" id="1503475">!=</span>&nbsp;<span class="builtintype" id="1503478">nil</span>&nbsp;<span class="op" id="1503482">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1503486">gp</span>&nbsp;<span class="op" id="1503489">:=</span>&nbsp;<span class="ident" id="1503492"><a href="/gostd/runtime/chan.go.html#1503444">sg</a></span><span class="op" id="1503494">.</span><span class="ident" id="1503495"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786765">g</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1503499"><a href="/gostd/runtime/lock_futex.go.html#1586629">unlock</a></span><span class="op" id="1503505">(</span><span class="op" id="1503506">&amp;</span><span class="ident" id="1503507"><a href="/gostd/runtime/chan.go.html#1499813">c</a></span><span class="op" id="1503508">.</span><span class="ident" id="1503509"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796775">lock</a></span><span class="op" id="1503513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1503517">if</span>&nbsp;<span class="ident" id="1503520"><a href="/gostd/runtime/chan.go.html#1503444">sg</a></span><span class="op" id="1503522">.</span><span class="ident" id="1503523"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786838">releasetime</a></span>&nbsp;<span class="op" id="1503535">!=</span>&nbsp;<span class="num" id="1503538">0</span>&nbsp;<span class="op" id="1503540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1503545"><a href="/gostd/runtime/chan.go.html#1503444">sg</a></span><span class="op" id="1503547">.</span><span class="ident" id="1503548"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786838">releasetime</a></span>&nbsp;<span class="op" id="1503560">=</span>&nbsp;<span class="ident" id="1503562"><a href="/gostd/runtime/stubs.go.html#1744144">cputicks</a></span><span class="op" id="1503570">(</span><span class="op" id="1503571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1503575">}</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1503579"><a href="/gostd/runtime/proc.go.html#1673919">goready</a></span><span class="op" id="1503586">(</span><span class="ident" id="1503587"><a href="/gostd/runtime/chan.go.html#1503486">gp</a></span><span class="op" id="1503589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1503592">}</span>&nbsp;<span class="keyword" id="1503594">else</span>&nbsp;<span class="op" id="1503599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1503603"><a href="/gostd/runtime/lock_futex.go.html#1586629">unlock</a></span><span class="op" id="1503609">(</span><span class="op" id="1503610">&amp;</span><span class="ident" id="1503611"><a href="/gostd/runtime/chan.go.html#1499813">c</a></span><span class="op" id="1503612">.</span><span class="ident" id="1503613"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796775">lock</a></span><span class="op" id="1503617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1503620">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1503624">if</span>&nbsp;<span class="ident" id="1503627"><a href="/gostd/runtime/chan.go.html#1502510">t1</a></span>&nbsp;<span class="op" id="1503630">&gt;</span>&nbsp;<span class="num" id="1503632">0</span>&nbsp;<span class="op" id="1503634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1503638"><a href="/gostd/runtime/mprof.go.html#1626994">blockevent</a></span><span class="op" id="1503648">(</span><span class="ident" id="1503649"><a href="/gostd/runtime/chan.go.html#1502510">t1</a></span><span class="op" id="1503651">-</span><span class="ident" id="1503652"><a href="/gostd/runtime/chan.go.html#1501024">t0</a></span><span class="op" id="1503654">,</span>&nbsp;<span class="num" id="1503656">2</span><span class="op" id="1503657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1503660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1503663"><a href="/gostd/runtime/chan.go.html#1499855">selected</a></span>&nbsp;<span class="op" id="1503672">=</span>&nbsp;<span class="builtintype" id="1503674">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1503680"><a href="/gostd/runtime/chan.go.html#1499865">received</a></span>&nbsp;<span class="op" id="1503689">=</span>&nbsp;<span class="builtintype" id="1503691">true</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1503697">return</span><br>
<span class="lineno"></span><span class="op" id="1503704">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1503707">//&nbsp;recvclosed&nbsp;is&nbsp;a&nbsp;helper&nbsp;function&nbsp;for&nbsp;chanrecv.&nbsp;&nbsp;Handles&nbsp;cleanup</span><br>
<span class="lineno"></span><span class="comment" id="1503773">//&nbsp;when&nbsp;the&nbsp;receiver&nbsp;encounters&nbsp;a&nbsp;closed&nbsp;channel.</span><br>
<span class="lineno">515</span><span class="comment" id="1503823">//&nbsp;Caller&nbsp;must&nbsp;hold&nbsp;c.lock,&nbsp;recvclosed&nbsp;will&nbsp;release&nbsp;the&nbsp;lock.</span><br>
<span class="lineno"></span><span class="keyword" id="1503885">func</span>&nbsp;<span class="ident" id="1503890">recvclosed</span><span class="op" id="1503900">(</span><span class="ident" id="1503901">c</span>&nbsp;<span class="op" id="1503903">*</span><span class="ident" id="1503904"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796621">hchan</a></span><span class="op" id="1503909">,</span>&nbsp;<span class="ident" id="1503911">ep</span>&nbsp;<span class="ident" id="1503914"><a href="/gostd/runtime/chan.go.html#1492024">unsafe</a></span><span class="op" id="1503920">.</span><span class="ident" id="1503921">Pointer</span><span class="op" id="1503928">)</span>&nbsp;<span class="op" id="1503930">(</span><span class="ident" id="1503931">selected</span><span class="op" id="1503939">,</span>&nbsp;<span class="ident" id="1503941">recevied</span>&nbsp;<span class="builtintype" id="1503950">bool</span><span class="op" id="1503954">)</span>&nbsp;<span class="op" id="1503956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1503959">if</span>&nbsp;<span class="ident" id="1503962"><a href="/gostd/runtime/race0.go.html#1676514">raceenabled</a></span>&nbsp;<span class="op" id="1503974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1503978"><a href="/gostd/runtime/race0.go.html#1677480">raceacquire</a></span><span class="op" id="1503989">(</span><span class="ident" id="1503990"><a href="/gostd/runtime/chan.go.html#1492024">unsafe</a></span><span class="op" id="1503996">.</span><span class="ident" id="1503997">Pointer</span><span class="op" id="1504004">(</span><span class="ident" id="1504005"><a href="/gostd/runtime/chan.go.html#1503901">c</a></span><span class="op" id="1504006">)</span><span class="op" id="1504007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1504010">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1504013"><a href="/gostd/runtime/lock_futex.go.html#1586629">unlock</a></span><span class="op" id="1504019">(</span><span class="op" id="1504020">&amp;</span><span class="ident" id="1504021"><a href="/gostd/runtime/chan.go.html#1503901">c</a></span><span class="op" id="1504022">.</span><span class="ident" id="1504023"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796775">lock</a></span><span class="op" id="1504027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1504030">if</span>&nbsp;<span class="ident" id="1504033"><a href="/gostd/runtime/chan.go.html#1503911">ep</a></span>&nbsp;<span class="op" id="1504036">!=</span>&nbsp;<span class="builtintype" id="1504039">nil</span>&nbsp;<span class="op" id="1504043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1504047"><a href="/gostd/runtime/stubs.go.html#1742585">memclr</a></span><span class="op" id="1504053">(</span><span class="ident" id="1504054"><a href="/gostd/runtime/chan.go.html#1503911">ep</a></span><span class="op" id="1504056">,</span>&nbsp;<span class="builtintype" id="1504058">uintptr</span><span class="op" id="1504065">(</span><span class="ident" id="1504066"><a href="/gostd/runtime/chan.go.html#1503901">c</a></span><span class="op" id="1504067">.</span><span class="ident" id="1504068"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796676">elemsize</a></span><span class="op" id="1504076">)</span><span class="op" id="1504077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1504080">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1504083">return</span>&nbsp;<span class="builtintype" id="1504090">true</span><span class="op" id="1504094">,</span>&nbsp;<span class="builtintype" id="1504096">false</span><br>
<span class="lineno">525</span><span class="op" id="1504102">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1504105">//&nbsp;compiler&nbsp;implements</span><br>
<span class="lineno"></span><span class="comment" id="1504128">//</span><br>
<span class="lineno"></span><span class="comment" id="1504131">//&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;{</span><br>
<span class="lineno">530</span><span class="comment" id="1504143">//&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;c&nbsp;&lt;-&nbsp;v:</span><br>
<span class="lineno"></span><span class="comment" id="1504159">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;foo</span><br>
<span class="lineno"></span><span class="comment" id="1504171">//&nbsp;&nbsp;&nbsp;&nbsp;default:</span><br>
<span class="lineno"></span><span class="comment" id="1504183">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;bar</span><br>
<span class="lineno"></span><span class="comment" id="1504195">//&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno">535</span><span class="comment" id="1504200">//</span><br>
<span class="lineno"></span><span class="comment" id="1504203">//&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="1504209">//</span><br>
<span class="lineno"></span><span class="comment" id="1504212">//&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;selectnbsend(c,&nbsp;v)&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="1504239">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;foo</span><br>
<span class="lineno">540</span><span class="comment" id="1504251">//&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="1504263">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;bar</span><br>
<span class="lineno"></span><span class="comment" id="1504275">//&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="1504280">//</span><br>
<span class="lineno"></span><span class="keyword" id="1504283">func</span>&nbsp;<span class="ident" id="1504288">selectnbsend</span><span class="op" id="1504300">(</span><span class="ident" id="1504301">t</span>&nbsp;<span class="op" id="1504303">*</span><span class="ident" id="1504304"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796332">chantype</a></span><span class="op" id="1504312">,</span>&nbsp;<span class="ident" id="1504314">c</span>&nbsp;<span class="op" id="1504316">*</span><span class="ident" id="1504317"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796621">hchan</a></span><span class="op" id="1504322">,</span>&nbsp;<span class="ident" id="1504324">elem</span>&nbsp;<span class="ident" id="1504329"><a href="/gostd/runtime/chan.go.html#1492024">unsafe</a></span><span class="op" id="1504335">.</span><span class="ident" id="1504336">Pointer</span><span class="op" id="1504343">)</span>&nbsp;<span class="op" id="1504345">(</span><span class="ident" id="1504346">selected</span>&nbsp;<span class="builtintype" id="1504355">bool</span><span class="op" id="1504359">)</span>&nbsp;<span class="op" id="1504361">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1504364">return</span>&nbsp;<span class="ident" id="1504371"><a href="/gostd/runtime/chan.go.html#1494344">chansend</a></span><span class="op" id="1504379">(</span><span class="ident" id="1504380"><a href="/gostd/runtime/chan.go.html#1504301">t</a></span><span class="op" id="1504381">,</span>&nbsp;<span class="ident" id="1504383"><a href="/gostd/runtime/chan.go.html#1504314">c</a></span><span class="op" id="1504384">,</span>&nbsp;<span class="ident" id="1504386"><a href="/gostd/runtime/chan.go.html#1504324">elem</a></span><span class="op" id="1504390">,</span>&nbsp;<span class="builtintype" id="1504392">false</span><span class="op" id="1504397">,</span>&nbsp;<span class="ident" id="1504399"><a href="/gostd/runtime/stubs.go.html#1746397">getcallerpc</a></span><span class="op" id="1504410">(</span><span class="ident" id="1504411"><a href="/gostd/runtime/chan.go.html#1492024">unsafe</a></span><span class="op" id="1504417">.</span><span class="ident" id="1504418">Pointer</span><span class="op" id="1504425">(</span><span class="op" id="1504426">&amp;</span><span class="ident" id="1504427"><a href="/gostd/runtime/chan.go.html#1504301">t</a></span><span class="op" id="1504428">)</span><span class="op" id="1504429">)</span><span class="op" id="1504430">)</span><br>
<span class="lineno"></span><span class="op" id="1504432">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1504435">//&nbsp;compiler&nbsp;implements</span><br>
<span class="lineno"></span><span class="comment" id="1504458">//</span><br>
<span class="lineno">550</span><span class="comment" id="1504461">//&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="1504473">//&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;v&nbsp;=&nbsp;&lt;-c:</span><br>
<span class="lineno"></span><span class="comment" id="1504490">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;foo</span><br>
<span class="lineno"></span><span class="comment" id="1504502">//&nbsp;&nbsp;&nbsp;&nbsp;default:</span><br>
<span class="lineno"></span><span class="comment" id="1504514">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;bar</span><br>
<span class="lineno">555</span><span class="comment" id="1504526">//&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="1504531">//</span><br>
<span class="lineno"></span><span class="comment" id="1504534">//&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="1504540">//</span><br>
<span class="lineno"></span><span class="comment" id="1504543">//&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;selectnbrecv(&amp;v,&nbsp;c)&nbsp;{</span><br>
<span class="lineno">560</span><span class="comment" id="1504571">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;foo</span><br>
<span class="lineno"></span><span class="comment" id="1504583">//&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="1504595">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;bar</span><br>
<span class="lineno"></span><span class="comment" id="1504607">//&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="1504612">//</span><br>
<span class="lineno">565</span><span class="keyword" id="1504615">func</span>&nbsp;<span class="ident" id="1504620">selectnbrecv</span><span class="op" id="1504632">(</span><span class="ident" id="1504633">t</span>&nbsp;<span class="op" id="1504635">*</span><span class="ident" id="1504636"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796332">chantype</a></span><span class="op" id="1504644">,</span>&nbsp;<span class="ident" id="1504646">elem</span>&nbsp;<span class="ident" id="1504651"><a href="/gostd/runtime/chan.go.html#1492024">unsafe</a></span><span class="op" id="1504657">.</span><span class="ident" id="1504658">Pointer</span><span class="op" id="1504665">,</span>&nbsp;<span class="ident" id="1504667">c</span>&nbsp;<span class="op" id="1504669">*</span><span class="ident" id="1504670"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796621">hchan</a></span><span class="op" id="1504675">)</span>&nbsp;<span class="op" id="1504677">(</span><span class="ident" id="1504678">selected</span>&nbsp;<span class="builtintype" id="1504687">bool</span><span class="op" id="1504691">)</span>&nbsp;<span class="op" id="1504693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1504696"><a href="/gostd/runtime/chan.go.html#1504678">selected</a></span><span class="op" id="1504704">,</span>&nbsp;<span class="ident" id="1504706">_</span>&nbsp;<span class="op" id="1504708">=</span>&nbsp;<span class="ident" id="1504710"><a href="/gostd/runtime/chan.go.html#1499791">chanrecv</a></span><span class="op" id="1504718">(</span><span class="ident" id="1504719"><a href="/gostd/runtime/chan.go.html#1504633">t</a></span><span class="op" id="1504720">,</span>&nbsp;<span class="ident" id="1504722"><a href="/gostd/runtime/chan.go.html#1504667">c</a></span><span class="op" id="1504723">,</span>&nbsp;<span class="ident" id="1504725"><a href="/gostd/runtime/chan.go.html#1504646">elem</a></span><span class="op" id="1504729">,</span>&nbsp;<span class="builtintype" id="1504731">false</span><span class="op" id="1504736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1504739">return</span><br>
<span class="lineno"></span><span class="op" id="1504746">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">570</span><span class="comment" id="1504749">//&nbsp;compiler&nbsp;implements</span><br>
<span class="lineno"></span><span class="comment" id="1504772">//</span><br>
<span class="lineno"></span><span class="comment" id="1504775">//&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="1504787">//&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;v,&nbsp;ok&nbsp;=&nbsp;&lt;-c:</span><br>
<span class="lineno"></span><span class="comment" id="1504808">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;foo</span><br>
<span class="lineno">575</span><span class="comment" id="1504820">//&nbsp;&nbsp;&nbsp;&nbsp;default:</span><br>
<span class="lineno"></span><span class="comment" id="1504832">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;bar</span><br>
<span class="lineno"></span><span class="comment" id="1504844">//&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="1504849">//</span><br>
<span class="lineno"></span><span class="comment" id="1504852">//&nbsp;as</span><br>
<span class="lineno">580</span><span class="comment" id="1504858">//</span><br>
<span class="lineno"></span><span class="comment" id="1504861">//&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;c&nbsp;!=&nbsp;nil&nbsp;&amp;&amp;&nbsp;selectnbrecv2(&amp;v,&nbsp;&amp;ok,&nbsp;c)&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="1504907">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;foo</span><br>
<span class="lineno"></span><span class="comment" id="1504919">//&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="1504931">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;bar</span><br>
<span class="lineno">585</span><span class="comment" id="1504943">//&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="1504948">//</span><br>
<span class="lineno"></span><span class="keyword" id="1504951">func</span>&nbsp;<span class="ident" id="1504956">selectnbrecv2</span><span class="op" id="1504969">(</span><span class="ident" id="1504970">t</span>&nbsp;<span class="op" id="1504972">*</span><span class="ident" id="1504973"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796332">chantype</a></span><span class="op" id="1504981">,</span>&nbsp;<span class="ident" id="1504983">elem</span>&nbsp;<span class="ident" id="1504988"><a href="/gostd/runtime/chan.go.html#1492024">unsafe</a></span><span class="op" id="1504994">.</span><span class="ident" id="1504995">Pointer</span><span class="op" id="1505002">,</span>&nbsp;<span class="ident" id="1505004">received</span>&nbsp;<span class="op" id="1505013">*</span><span class="builtintype" id="1505014">bool</span><span class="op" id="1505018">,</span>&nbsp;<span class="ident" id="1505020">c</span>&nbsp;<span class="op" id="1505022">*</span><span class="ident" id="1505023"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796621">hchan</a></span><span class="op" id="1505028">)</span>&nbsp;<span class="op" id="1505030">(</span><span class="ident" id="1505031">selected</span>&nbsp;<span class="builtintype" id="1505040">bool</span><span class="op" id="1505044">)</span>&nbsp;<span class="op" id="1505046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1505049">//&nbsp;TODO(khr):&nbsp;just&nbsp;return&nbsp;2&nbsp;values&nbsp;from&nbsp;this&nbsp;function,&nbsp;now&nbsp;that&nbsp;it&nbsp;is&nbsp;in&nbsp;Go.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1505127"><a href="/gostd/runtime/chan.go.html#1505031">selected</a></span><span class="op" id="1505135">,</span>&nbsp;<span class="op" id="1505137">*</span><span class="ident" id="1505138"><a href="/gostd/runtime/chan.go.html#1505004">received</a></span>&nbsp;<span class="op" id="1505147">=</span>&nbsp;<span class="ident" id="1505149"><a href="/gostd/runtime/chan.go.html#1499791">chanrecv</a></span><span class="op" id="1505157">(</span><span class="ident" id="1505158"><a href="/gostd/runtime/chan.go.html#1504970">t</a></span><span class="op" id="1505159">,</span>&nbsp;<span class="ident" id="1505161"><a href="/gostd/runtime/chan.go.html#1505020">c</a></span><span class="op" id="1505162">,</span>&nbsp;<span class="ident" id="1505164"><a href="/gostd/runtime/chan.go.html#1504983">elem</a></span><span class="op" id="1505168">,</span>&nbsp;<span class="builtintype" id="1505170">false</span><span class="op" id="1505175">)</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1505178">return</span><br>
<span class="lineno"></span><span class="op" id="1505185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1505188">func</span>&nbsp;<span class="ident" id="1505193">reflect_chansend</span><span class="op" id="1505209">(</span><span class="ident" id="1505210">t</span>&nbsp;<span class="op" id="1505212">*</span><span class="ident" id="1505213"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796332">chantype</a></span><span class="op" id="1505221">,</span>&nbsp;<span class="ident" id="1505223">c</span>&nbsp;<span class="op" id="1505225">*</span><span class="ident" id="1505226"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796621">hchan</a></span><span class="op" id="1505231">,</span>&nbsp;<span class="ident" id="1505233">elem</span>&nbsp;<span class="ident" id="1505238"><a href="/gostd/runtime/chan.go.html#1492024">unsafe</a></span><span class="op" id="1505244">.</span><span class="ident" id="1505245">Pointer</span><span class="op" id="1505252">,</span>&nbsp;<span class="ident" id="1505254">nb</span>&nbsp;<span class="builtintype" id="1505257">bool</span><span class="op" id="1505261">)</span>&nbsp;<span class="op" id="1505263">(</span><span class="ident" id="1505264">selected</span>&nbsp;<span class="builtintype" id="1505273">bool</span><span class="op" id="1505277">)</span>&nbsp;<span class="op" id="1505279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1505282">return</span>&nbsp;<span class="ident" id="1505289"><a href="/gostd/runtime/chan.go.html#1494344">chansend</a></span><span class="op" id="1505297">(</span><span class="ident" id="1505298"><a href="/gostd/runtime/chan.go.html#1505210">t</a></span><span class="op" id="1505299">,</span>&nbsp;<span class="ident" id="1505301"><a href="/gostd/runtime/chan.go.html#1505223">c</a></span><span class="op" id="1505302">,</span>&nbsp;<span class="ident" id="1505304"><a href="/gostd/runtime/chan.go.html#1505233">elem</a></span><span class="op" id="1505308">,</span>&nbsp;<span class="op" id="1505310">!</span><span class="ident" id="1505311"><a href="/gostd/runtime/chan.go.html#1505254">nb</a></span><span class="op" id="1505313">,</span>&nbsp;<span class="ident" id="1505315"><a href="/gostd/runtime/stubs.go.html#1746397">getcallerpc</a></span><span class="op" id="1505326">(</span><span class="ident" id="1505327"><a href="/gostd/runtime/chan.go.html#1492024">unsafe</a></span><span class="op" id="1505333">.</span><span class="ident" id="1505334">Pointer</span><span class="op" id="1505341">(</span><span class="op" id="1505342">&amp;</span><span class="ident" id="1505343"><a href="/gostd/runtime/chan.go.html#1505210">t</a></span><span class="op" id="1505344">)</span><span class="op" id="1505345">)</span><span class="op" id="1505346">)</span><br>
<span class="lineno">595</span><span class="op" id="1505348">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1505351">func</span>&nbsp;<span class="ident" id="1505356">reflect_chanrecv</span><span class="op" id="1505372">(</span><span class="ident" id="1505373">t</span>&nbsp;<span class="op" id="1505375">*</span><span class="ident" id="1505376"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796332">chantype</a></span><span class="op" id="1505384">,</span>&nbsp;<span class="ident" id="1505386">c</span>&nbsp;<span class="op" id="1505388">*</span><span class="ident" id="1505389"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796621">hchan</a></span><span class="op" id="1505394">,</span>&nbsp;<span class="ident" id="1505396">nb</span>&nbsp;<span class="builtintype" id="1505399">bool</span><span class="op" id="1505403">,</span>&nbsp;<span class="ident" id="1505405">elem</span>&nbsp;<span class="ident" id="1505410"><a href="/gostd/runtime/chan.go.html#1492024">unsafe</a></span><span class="op" id="1505416">.</span><span class="ident" id="1505417">Pointer</span><span class="op" id="1505424">)</span>&nbsp;<span class="op" id="1505426">(</span><span class="ident" id="1505427">selected</span>&nbsp;<span class="builtintype" id="1505436">bool</span><span class="op" id="1505440">,</span>&nbsp;<span class="ident" id="1505442">received</span>&nbsp;<span class="builtintype" id="1505451">bool</span><span class="op" id="1505455">)</span>&nbsp;<span class="op" id="1505457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1505460">return</span>&nbsp;<span class="ident" id="1505467"><a href="/gostd/runtime/chan.go.html#1499791">chanrecv</a></span><span class="op" id="1505475">(</span><span class="ident" id="1505476"><a href="/gostd/runtime/chan.go.html#1505373">t</a></span><span class="op" id="1505477">,</span>&nbsp;<span class="ident" id="1505479"><a href="/gostd/runtime/chan.go.html#1505386">c</a></span><span class="op" id="1505480">,</span>&nbsp;<span class="ident" id="1505482"><a href="/gostd/runtime/chan.go.html#1505405">elem</a></span><span class="op" id="1505486">,</span>&nbsp;<span class="op" id="1505488">!</span><span class="ident" id="1505489"><a href="/gostd/runtime/chan.go.html#1505396">nb</a></span><span class="op" id="1505491">)</span><br>
<span class="lineno"></span><span class="op" id="1505493">}</span><br>
<span class="lineno">600</span><br>
<span class="lineno"></span><span class="keyword" id="1505496">func</span>&nbsp;<span class="ident" id="1505501">reflect_chanlen</span><span class="op" id="1505516">(</span><span class="ident" id="1505517">c</span>&nbsp;<span class="op" id="1505519">*</span><span class="ident" id="1505520"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796621">hchan</a></span><span class="op" id="1505525">)</span>&nbsp;<span class="builtintype" id="1505527">int</span>&nbsp;<span class="op" id="1505531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1505534">if</span>&nbsp;<span class="ident" id="1505537"><a href="/gostd/runtime/chan.go.html#1505517">c</a></span>&nbsp;<span class="op" id="1505539">==</span>&nbsp;<span class="builtintype" id="1505542">nil</span>&nbsp;<span class="op" id="1505546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1505550">return</span>&nbsp;<span class="num" id="1505557">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1505560">}</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1505563">return</span>&nbsp;<span class="builtintype" id="1505570">int</span><span class="op" id="1505573">(</span><span class="ident" id="1505574"><a href="/gostd/runtime/chan.go.html#1505517">c</a></span><span class="op" id="1505575">.</span><span class="ident" id="1505576"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796637">qcount</a></span><span class="op" id="1505582">)</span><br>
<span class="lineno"></span><span class="op" id="1505584">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1505587">func</span>&nbsp;<span class="ident" id="1505592">reflect_chancap</span><span class="op" id="1505607">(</span><span class="ident" id="1505608">c</span>&nbsp;<span class="op" id="1505610">*</span><span class="ident" id="1505611"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796621">hchan</a></span><span class="op" id="1505616">)</span>&nbsp;<span class="builtintype" id="1505618">int</span>&nbsp;<span class="op" id="1505622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1505625">if</span>&nbsp;<span class="ident" id="1505628"><a href="/gostd/runtime/chan.go.html#1505608">c</a></span>&nbsp;<span class="op" id="1505630">==</span>&nbsp;<span class="builtintype" id="1505633">nil</span>&nbsp;<span class="op" id="1505637">{</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1505641">return</span>&nbsp;<span class="num" id="1505648">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1505651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1505654">return</span>&nbsp;<span class="builtintype" id="1505661">int</span><span class="op" id="1505664">(</span><span class="ident" id="1505665"><a href="/gostd/runtime/chan.go.html#1505608">c</a></span><span class="op" id="1505666">.</span><span class="ident" id="1505667"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796650">dataqsiz</a></span><span class="op" id="1505675">)</span><br>
<span class="lineno"></span><span class="op" id="1505677">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">615</span><span class="keyword" id="1505680">func</span>&nbsp;<span class="op" id="1505685">(</span><span class="ident" id="1505686">q</span>&nbsp;<span class="op" id="1505688">*</span><span class="ident" id="1505689"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796571">waitq</a></span><span class="op" id="1505694">)</span>&nbsp;<span class="ident" id="1505696">enqueue</span><span class="op" id="1505703">(</span><span class="ident" id="1505704">sgp</span>&nbsp;<span class="op" id="1505708">*</span><span class="ident" id="1505709"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786749">sudog</a></span><span class="op" id="1505714">)</span>&nbsp;<span class="op" id="1505716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1505719"><a href="/gostd/runtime/chan.go.html#1505704">sgp</a></span><span class="op" id="1505722">.</span><span class="ident" id="1505723"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786791">next</a></span>&nbsp;<span class="op" id="1505728">=</span>&nbsp;<span class="builtintype" id="1505730">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1505735">if</span>&nbsp;<span class="ident" id="1505738"><a href="/gostd/runtime/chan.go.html#1505686">q</a></span><span class="op" id="1505739">.</span><span class="ident" id="1505740"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796587">first</a></span>&nbsp;<span class="op" id="1505746">==</span>&nbsp;<span class="builtintype" id="1505749">nil</span>&nbsp;<span class="op" id="1505753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1505757"><a href="/gostd/runtime/chan.go.html#1505686">q</a></span><span class="op" id="1505758">.</span><span class="ident" id="1505759"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796587">first</a></span>&nbsp;<span class="op" id="1505765">=</span>&nbsp;<span class="ident" id="1505767"><a href="/gostd/runtime/chan.go.html#1505704">sgp</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1505773"><a href="/gostd/runtime/chan.go.html#1505686">q</a></span><span class="op" id="1505774">.</span><span class="ident" id="1505775"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796601">last</a></span>&nbsp;<span class="op" id="1505780">=</span>&nbsp;<span class="ident" id="1505782"><a href="/gostd/runtime/chan.go.html#1505704">sgp</a></span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1505788">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1505796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1505799"><a href="/gostd/runtime/chan.go.html#1505686">q</a></span><span class="op" id="1505800">.</span><span class="ident" id="1505801"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796601">last</a></span><span class="op" id="1505805">.</span><span class="ident" id="1505806"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786791">next</a></span>&nbsp;<span class="op" id="1505811">=</span>&nbsp;<span class="ident" id="1505813"><a href="/gostd/runtime/chan.go.html#1505704">sgp</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1505818"><a href="/gostd/runtime/chan.go.html#1505686">q</a></span><span class="op" id="1505819">.</span><span class="ident" id="1505820"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796601">last</a></span>&nbsp;<span class="op" id="1505825">=</span>&nbsp;<span class="ident" id="1505827"><a href="/gostd/runtime/chan.go.html#1505704">sgp</a></span><br>
<span class="lineno"></span><span class="op" id="1505831">}</span><br>
<span class="lineno">625</span><br>
<span class="lineno"></span><span class="keyword" id="1505834">func</span>&nbsp;<span class="op" id="1505839">(</span><span class="ident" id="1505840">q</span>&nbsp;<span class="op" id="1505842">*</span><span class="ident" id="1505843"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796571">waitq</a></span><span class="op" id="1505848">)</span>&nbsp;<span class="ident" id="1505850">dequeue</span><span class="op" id="1505857">(</span><span class="op" id="1505858">)</span>&nbsp;<span class="op" id="1505860">*</span><span class="ident" id="1505861"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786749">sudog</a></span>&nbsp;<span class="op" id="1505867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1505870">for</span>&nbsp;<span class="op" id="1505874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1505878">sgp</span>&nbsp;<span class="op" id="1505882">:=</span>&nbsp;<span class="ident" id="1505885"><a href="/gostd/runtime/chan.go.html#1505840">q</a></span><span class="op" id="1505886">.</span><span class="ident" id="1505887"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796587">first</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1505895">if</span>&nbsp;<span class="ident" id="1505898"><a href="/gostd/runtime/chan.go.html#1505878">sgp</a></span>&nbsp;<span class="op" id="1505902">==</span>&nbsp;<span class="builtintype" id="1505905">nil</span>&nbsp;<span class="op" id="1505909">{</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1505914">return</span>&nbsp;<span class="builtintype" id="1505921">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1505927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1505931"><a href="/gostd/runtime/chan.go.html#1505840">q</a></span><span class="op" id="1505932">.</span><span class="ident" id="1505933"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796587">first</a></span>&nbsp;<span class="op" id="1505939">=</span>&nbsp;<span class="ident" id="1505941"><a href="/gostd/runtime/chan.go.html#1505878">sgp</a></span><span class="op" id="1505944">.</span><span class="ident" id="1505945"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786791">next</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1505952"><a href="/gostd/runtime/chan.go.html#1505878">sgp</a></span><span class="op" id="1505955">.</span><span class="ident" id="1505956"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786791">next</a></span>&nbsp;<span class="op" id="1505961">=</span>&nbsp;<span class="builtintype" id="1505963">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1505969">if</span>&nbsp;<span class="ident" id="1505972"><a href="/gostd/runtime/chan.go.html#1505840">q</a></span><span class="op" id="1505973">.</span><span class="ident" id="1505974"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796601">last</a></span>&nbsp;<span class="op" id="1505979">==</span>&nbsp;<span class="ident" id="1505982"><a href="/gostd/runtime/chan.go.html#1505878">sgp</a></span>&nbsp;<span class="op" id="1505986">{</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1505991"><a href="/gostd/runtime/chan.go.html#1505840">q</a></span><span class="op" id="1505992">.</span><span class="ident" id="1505993"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796601">last</a></span>&nbsp;<span class="op" id="1505998">=</span>&nbsp;<span class="builtintype" id="1506000">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1506006">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1506011">//&nbsp;if&nbsp;sgp&nbsp;participates&nbsp;in&nbsp;a&nbsp;select&nbsp;and&nbsp;is&nbsp;already&nbsp;signaled,&nbsp;ignore&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1506083">if</span>&nbsp;<span class="ident" id="1506086"><a href="/gostd/runtime/chan.go.html#1505878">sgp</a></span><span class="op" id="1506089">.</span><span class="ident" id="1506090"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786771">selectdone</a></span>&nbsp;<span class="op" id="1506101">!=</span>&nbsp;<span class="builtintype" id="1506104">nil</span>&nbsp;<span class="op" id="1506108">{</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1506113">//&nbsp;claim&nbsp;the&nbsp;right&nbsp;to&nbsp;signal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1506145">if</span>&nbsp;<span class="op" id="1506148">*</span><span class="ident" id="1506149"><a href="/gostd/runtime/chan.go.html#1505878">sgp</a></span><span class="op" id="1506152">.</span><span class="ident" id="1506153"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786771">selectdone</a></span>&nbsp;<span class="op" id="1506164">!=</span>&nbsp;<span class="num" id="1506167">0</span>&nbsp;<span class="op" id="1506169">||</span>&nbsp;<span class="op" id="1506172">!</span><span class="ident" id="1506173"><a href="/gostd/runtime/stubs.go.html#1744744">cas</a></span><span class="op" id="1506176">(</span><span class="ident" id="1506177"><a href="/gostd/runtime/chan.go.html#1505878">sgp</a></span><span class="op" id="1506180">.</span><span class="ident" id="1506181"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786771">selectdone</a></span><span class="op" id="1506191">,</span>&nbsp;<span class="num" id="1506193">0</span><span class="op" id="1506194">,</span>&nbsp;<span class="num" id="1506196">1</span><span class="op" id="1506197">)</span>&nbsp;<span class="op" id="1506199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1506205">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1506217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1506221">}</span><br>
<span class="lineno">645</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1506226">return</span>&nbsp;<span class="ident" id="1506233"><a href="/gostd/runtime/chan.go.html#1505878">sgp</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1506238">}</span><br>
<span class="lineno"></span><span class="op" id="1506240">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">650</span><span class="keyword" id="1506243">func</span>&nbsp;<span class="ident" id="1506248">racesync</span><span class="op" id="1506256">(</span><span class="ident" id="1506257">c</span>&nbsp;<span class="op" id="1506259">*</span><span class="ident" id="1506260"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1796621">hchan</a></span><span class="op" id="1506265">,</span>&nbsp;<span class="ident" id="1506267">sg</span>&nbsp;<span class="op" id="1506270">*</span><span class="ident" id="1506271"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786749">sudog</a></span><span class="op" id="1506276">)</span>&nbsp;<span class="op" id="1506278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1506281"><a href="/gostd/runtime/race0.go.html#1677672">racerelease</a></span><span class="op" id="1506292">(</span><span class="ident" id="1506293"><a href="/gostd/runtime/chan.go.html#1493709">chanbuf</a></span><span class="op" id="1506300">(</span><span class="ident" id="1506301"><a href="/gostd/runtime/chan.go.html#1506257">c</a></span><span class="op" id="1506302">,</span>&nbsp;<span class="num" id="1506304">0</span><span class="op" id="1506305">)</span><span class="op" id="1506306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1506309"><a href="/gostd/runtime/race0.go.html#1677576">raceacquireg</a></span><span class="op" id="1506321">(</span><span class="ident" id="1506322"><a href="/gostd/runtime/chan.go.html#1506267">sg</a></span><span class="op" id="1506324">.</span><span class="ident" id="1506325"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786765">g</a></span><span class="op" id="1506326">,</span>&nbsp;<span class="ident" id="1506328"><a href="/gostd/runtime/chan.go.html#1493709">chanbuf</a></span><span class="op" id="1506335">(</span><span class="ident" id="1506336"><a href="/gostd/runtime/chan.go.html#1506257">c</a></span><span class="op" id="1506337">,</span>&nbsp;<span class="num" id="1506339">0</span><span class="op" id="1506340">)</span><span class="op" id="1506341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1506344"><a href="/gostd/runtime/race0.go.html#1677768">racereleaseg</a></span><span class="op" id="1506356">(</span><span class="ident" id="1506357"><a href="/gostd/runtime/chan.go.html#1506267">sg</a></span><span class="op" id="1506359">.</span><span class="ident" id="1506360"><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html#1786765">g</a></span><span class="op" id="1506361">,</span>&nbsp;<span class="ident" id="1506363"><a href="/gostd/runtime/chan.go.html#1493709">chanbuf</a></span><span class="op" id="1506370">(</span><span class="ident" id="1506371"><a href="/gostd/runtime/chan.go.html#1506257">c</a></span><span class="op" id="1506372">,</span>&nbsp;<span class="num" id="1506374">0</span><span class="op" id="1506375">)</span><span class="op" id="1506376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1506379"><a href="/gostd/runtime/race0.go.html#1677480">raceacquire</a></span><span class="op" id="1506390">(</span><span class="ident" id="1506391"><a href="/gostd/runtime/chan.go.html#1493709">chanbuf</a></span><span class="op" id="1506398">(</span><span class="ident" id="1506399"><a href="/gostd/runtime/chan.go.html#1506257">c</a></span><span class="op" id="1506400">,</span>&nbsp;<span class="num" id="1506402">0</span><span class="op" id="1506403">)</span><span class="op" id="1506404">)</span><br>
<span class="lineno">655</span><span class="op" id="1506406">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
