<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/rpc</h2>
<ul>
<li><a href="/gostd/net/rpc/client.go.html">client.go</a></li>
<li><a href="/gostd/net/rpc/client_test.go.html">client_test.go</a></li>
<li><a href="/gostd/net/rpc/debug.go.html">debug.go</a></li>
<li><a href="/gostd/net/rpc/server.go.html">server.go</a></li>
<li><a href="/gostd/net/rpc/server_test.go.html" class="current">server_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7019636">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7019691">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7019745">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7019796">package</span>&nbsp;<span class="ident" id="7019804">rpc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7019809">import</span>&nbsp;<span class="op" id="7019816">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7019819">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7019829">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7019836">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7019842">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7019849">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7019856">&#34;net/http/httptest&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7019877">&#34;runtime&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7019888">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7019899">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7019907">&#34;sync/atomic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7019922">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7019933">&#34;time&#34;</span><br>
<span class="lineno">20</span><span class="op" id="7019940">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7019943">var</span>&nbsp;<span class="op" id="7019947">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7019950">newServer</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7019976">*</span><span class="ident" id="7019977">Server</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7019985">serverAddr</span><span class="op" id="7019995">,</span>&nbsp;<span class="ident" id="7019997">newServerAddr</span>&nbsp;<span class="builtintype" id="7020011">string</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7020019">httpServerAddr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7020045">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7020053">once</span><span class="op" id="7020057">,</span>&nbsp;<span class="ident" id="7020059">newOnce</span><span class="op" id="7020066">,</span>&nbsp;<span class="ident" id="7020068">httpOnce</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7020079">sync</span><span class="op" id="7020083">.</span><span class="ident" id="7020084">Once</span><br>
<span class="lineno"></span><span class="op" id="7020089">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7020092">const</span>&nbsp;<span class="op" id="7020098">(</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7020101">newHttpPath</span>&nbsp;<span class="op" id="7020113">=</span>&nbsp;<span class="string" id="7020115">&#34;/foo&#34;</span><br>
<span class="lineno"></span><span class="op" id="7020122">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7020125">type</span>&nbsp;<span class="ident" id="7020130">Args</span>&nbsp;<span class="keyword" id="7020135">struct</span>&nbsp;<span class="op" id="7020142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7020145">A</span><span class="op" id="7020146">,</span>&nbsp;<span class="ident" id="7020148">B</span>&nbsp;<span class="builtintype" id="7020150">int</span><br>
<span class="lineno">35</span><span class="op" id="7020154">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7020157">type</span>&nbsp;<span class="ident" id="7020162">Reply</span>&nbsp;<span class="keyword" id="7020168">struct</span>&nbsp;<span class="op" id="7020175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7020178">C</span>&nbsp;<span class="builtintype" id="7020180">int</span><br>
<span class="lineno"></span><span class="op" id="7020184">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="7020187">type</span>&nbsp;<span class="ident" id="7020192">Arith</span>&nbsp;<span class="builtintype" id="7020198">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7020203">//&nbsp;Some&nbsp;of&nbsp;Arith&#39;s&nbsp;methods&nbsp;have&nbsp;value&nbsp;args,&nbsp;some&nbsp;have&nbsp;pointer&nbsp;args.&nbsp;That&#39;s&nbsp;deliberate.</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="7020291">func</span>&nbsp;<span class="op" id="7020296">(</span><span class="ident" id="7020297">t</span>&nbsp;<span class="op" id="7020299">*</span><span class="ident" id="7020300">Arith</span><span class="op" id="7020305">)</span>&nbsp;<span class="ident" id="7020307">Add</span><span class="op" id="7020310">(</span><span class="ident" id="7020311">args</span>&nbsp;<span class="ident" id="7020316">Args</span><span class="op" id="7020320">,</span>&nbsp;<span class="ident" id="7020322">reply</span>&nbsp;<span class="op" id="7020328">*</span><span class="ident" id="7020329">Reply</span><span class="op" id="7020334">)</span>&nbsp;<span class="builtintype" id="7020336">error</span>&nbsp;<span class="op" id="7020342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7020345">reply</span><span class="op" id="7020350">.</span><span class="ident" id="7020351">C</span>&nbsp;<span class="op" id="7020353">=</span>&nbsp;<span class="ident" id="7020355">args</span><span class="op" id="7020359">.</span><span class="ident" id="7020360">A</span>&nbsp;<span class="op" id="7020362">+</span>&nbsp;<span class="ident" id="7020364">args</span><span class="op" id="7020368">.</span><span class="ident" id="7020369">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7020372">return</span>&nbsp;<span class="builtintype" id="7020379">nil</span><br>
<span class="lineno"></span><span class="op" id="7020383">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="keyword" id="7020386">func</span>&nbsp;<span class="op" id="7020391">(</span><span class="ident" id="7020392">t</span>&nbsp;<span class="op" id="7020394">*</span><span class="ident" id="7020395">Arith</span><span class="op" id="7020400">)</span>&nbsp;<span class="ident" id="7020402">Mul</span><span class="op" id="7020405">(</span><span class="ident" id="7020406">args</span>&nbsp;<span class="op" id="7020411">*</span><span class="ident" id="7020412">Args</span><span class="op" id="7020416">,</span>&nbsp;<span class="ident" id="7020418">reply</span>&nbsp;<span class="op" id="7020424">*</span><span class="ident" id="7020425">Reply</span><span class="op" id="7020430">)</span>&nbsp;<span class="builtintype" id="7020432">error</span>&nbsp;<span class="op" id="7020438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7020441">reply</span><span class="op" id="7020446">.</span><span class="ident" id="7020447">C</span>&nbsp;<span class="op" id="7020449">=</span>&nbsp;<span class="ident" id="7020451">args</span><span class="op" id="7020455">.</span><span class="ident" id="7020456">A</span>&nbsp;<span class="op" id="7020458">*</span>&nbsp;<span class="ident" id="7020460">args</span><span class="op" id="7020464">.</span><span class="ident" id="7020465">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7020468">return</span>&nbsp;<span class="builtintype" id="7020475">nil</span><br>
<span class="lineno"></span><span class="op" id="7020479">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="7020482">func</span>&nbsp;<span class="op" id="7020487">(</span><span class="ident" id="7020488">t</span>&nbsp;<span class="op" id="7020490">*</span><span class="ident" id="7020491">Arith</span><span class="op" id="7020496">)</span>&nbsp;<span class="ident" id="7020498">Div</span><span class="op" id="7020501">(</span><span class="ident" id="7020502">args</span>&nbsp;<span class="ident" id="7020507">Args</span><span class="op" id="7020511">,</span>&nbsp;<span class="ident" id="7020513">reply</span>&nbsp;<span class="op" id="7020519">*</span><span class="ident" id="7020520">Reply</span><span class="op" id="7020525">)</span>&nbsp;<span class="builtintype" id="7020527">error</span>&nbsp;<span class="op" id="7020533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7020536">if</span>&nbsp;<span class="ident" id="7020539">args</span><span class="op" id="7020543">.</span><span class="ident" id="7020544">B</span>&nbsp;<span class="op" id="7020546">==</span>&nbsp;<span class="num" id="7020549">0</span>&nbsp;<span class="op" id="7020551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7020555">return</span>&nbsp;<span class="ident" id="7020562">errors</span><span class="op" id="7020568">.</span><span class="ident" id="7020569">New</span><span class="op" id="7020572">(</span><span class="string" id="7020573">&#34;divide&nbsp;by&nbsp;zero&#34;</span><span class="op" id="7020589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7020592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7020595">reply</span><span class="op" id="7020600">.</span><span class="ident" id="7020601">C</span>&nbsp;<span class="op" id="7020603">=</span>&nbsp;<span class="ident" id="7020605">args</span><span class="op" id="7020609">.</span><span class="ident" id="7020610">A</span>&nbsp;<span class="op" id="7020612">/</span>&nbsp;<span class="ident" id="7020614">args</span><span class="op" id="7020618">.</span><span class="ident" id="7020619">B</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7020622">return</span>&nbsp;<span class="builtintype" id="7020629">nil</span><br>
<span class="lineno"></span><span class="op" id="7020633">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7020636">func</span>&nbsp;<span class="op" id="7020641">(</span><span class="ident" id="7020642">t</span>&nbsp;<span class="op" id="7020644">*</span><span class="ident" id="7020645">Arith</span><span class="op" id="7020650">)</span>&nbsp;<span class="ident" id="7020652">String</span><span class="op" id="7020658">(</span><span class="ident" id="7020659">args</span>&nbsp;<span class="op" id="7020664">*</span><span class="ident" id="7020665">Args</span><span class="op" id="7020669">,</span>&nbsp;<span class="ident" id="7020671">reply</span>&nbsp;<span class="op" id="7020677">*</span><span class="builtintype" id="7020678">string</span><span class="op" id="7020684">)</span>&nbsp;<span class="builtintype" id="7020686">error</span>&nbsp;<span class="op" id="7020692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7020695">*</span><span class="ident" id="7020696">reply</span>&nbsp;<span class="op" id="7020702">=</span>&nbsp;<span class="ident" id="7020704">fmt</span><span class="op" id="7020707">.</span><span class="ident" id="7020708">Sprintf</span><span class="op" id="7020715">(</span><span class="string" id="7020716">&#34;%d+%d=%d&#34;</span><span class="op" id="7020726">,</span>&nbsp;<span class="ident" id="7020728">args</span><span class="op" id="7020732">.</span><span class="ident" id="7020733">A</span><span class="op" id="7020734">,</span>&nbsp;<span class="ident" id="7020736">args</span><span class="op" id="7020740">.</span><span class="ident" id="7020741">B</span><span class="op" id="7020742">,</span>&nbsp;<span class="ident" id="7020744">args</span><span class="op" id="7020748">.</span><span class="ident" id="7020749">A</span><span class="op" id="7020750">+</span><span class="ident" id="7020751">args</span><span class="op" id="7020755">.</span><span class="ident" id="7020756">B</span><span class="op" id="7020757">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7020760">return</span>&nbsp;<span class="builtintype" id="7020767">nil</span><br>
<span class="lineno"></span><span class="op" id="7020771">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7020774">func</span>&nbsp;<span class="op" id="7020779">(</span><span class="ident" id="7020780">t</span>&nbsp;<span class="op" id="7020782">*</span><span class="ident" id="7020783">Arith</span><span class="op" id="7020788">)</span>&nbsp;<span class="ident" id="7020790">Scan</span><span class="op" id="7020794">(</span><span class="ident" id="7020795">args</span>&nbsp;<span class="builtintype" id="7020800">string</span><span class="op" id="7020806">,</span>&nbsp;<span class="ident" id="7020808">reply</span>&nbsp;<span class="op" id="7020814">*</span><span class="ident" id="7020815">Reply</span><span class="op" id="7020820">)</span>&nbsp;<span class="op" id="7020822">(</span><span class="ident" id="7020823">err</span>&nbsp;<span class="builtintype" id="7020827">error</span><span class="op" id="7020832">)</span>&nbsp;<span class="op" id="7020834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7020837">_</span><span class="op" id="7020838">,</span>&nbsp;<span class="ident" id="7020840">err</span>&nbsp;<span class="op" id="7020844">=</span>&nbsp;<span class="ident" id="7020846">fmt</span><span class="op" id="7020849">.</span><span class="ident" id="7020850">Sscan</span><span class="op" id="7020855">(</span><span class="ident" id="7020856">args</span><span class="op" id="7020860">,</span>&nbsp;<span class="op" id="7020862">&amp;</span><span class="ident" id="7020863">reply</span><span class="op" id="7020868">.</span><span class="ident" id="7020869">C</span><span class="op" id="7020870">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7020873">return</span><br>
<span class="lineno"></span><span class="op" id="7020880">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7020883">func</span>&nbsp;<span class="op" id="7020888">(</span><span class="ident" id="7020889">t</span>&nbsp;<span class="op" id="7020891">*</span><span class="ident" id="7020892">Arith</span><span class="op" id="7020897">)</span>&nbsp;<span class="ident" id="7020899">Error</span><span class="op" id="7020904">(</span><span class="ident" id="7020905">args</span>&nbsp;<span class="op" id="7020910">*</span><span class="ident" id="7020911">Args</span><span class="op" id="7020915">,</span>&nbsp;<span class="ident" id="7020917">reply</span>&nbsp;<span class="op" id="7020923">*</span><span class="ident" id="7020924">Reply</span><span class="op" id="7020929">)</span>&nbsp;<span class="builtintype" id="7020931">error</span>&nbsp;<span class="op" id="7020937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7020940">panic</span><span class="op" id="7020945">(</span><span class="string" id="7020946">&#34;ERROR&#34;</span><span class="op" id="7020953">)</span><br>
<span class="lineno">75</span><span class="op" id="7020955">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7020958">func</span>&nbsp;<span class="ident" id="7020963">listenTCP</span><span class="op" id="7020972">(</span><span class="op" id="7020973">)</span>&nbsp;<span class="op" id="7020975">(</span><span class="ident" id="7020976">net</span><span class="op" id="7020979">.</span><span class="ident" id="7020980">Listener</span><span class="op" id="7020988">,</span>&nbsp;<span class="builtintype" id="7020990">string</span><span class="op" id="7020996">)</span>&nbsp;<span class="op" id="7020998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7021001">l</span><span class="op" id="7021002">,</span>&nbsp;<span class="ident" id="7021004">e</span>&nbsp;<span class="op" id="7021006">:=</span>&nbsp;<span class="ident" id="7021009">net</span><span class="op" id="7021012">.</span><span class="ident" id="7021013">Listen</span><span class="op" id="7021019">(</span><span class="string" id="7021020">&#34;tcp&#34;</span><span class="op" id="7021025">,</span>&nbsp;<span class="string" id="7021027">&#34;127.0.0.1:0&#34;</span><span class="op" id="7021040">)</span>&nbsp;<span class="comment" id="7021042">//&nbsp;any&nbsp;available&nbsp;address</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7021068">if</span>&nbsp;<span class="ident" id="7021071">e</span>&nbsp;<span class="op" id="7021073">!=</span>&nbsp;<span class="builtintype" id="7021076">nil</span>&nbsp;<span class="op" id="7021080">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7021084">log</span><span class="op" id="7021087">.</span><span class="ident" id="7021088">Fatalf</span><span class="op" id="7021094">(</span><span class="string" id="7021095">&#34;net.Listen&nbsp;tcp&nbsp;:0:&nbsp;%v&#34;</span><span class="op" id="7021118">,</span>&nbsp;<span class="ident" id="7021120">e</span><span class="op" id="7021121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7021124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7021127">return</span>&nbsp;<span class="ident" id="7021134">l</span><span class="op" id="7021135">,</span>&nbsp;<span class="ident" id="7021137">l</span><span class="op" id="7021138">.</span><span class="ident" id="7021139">Addr</span><span class="op" id="7021143">(</span><span class="op" id="7021144">)</span><span class="op" id="7021145">.</span><span class="ident" id="7021146">String</span><span class="op" id="7021152">(</span><span class="op" id="7021153">)</span><br>
<span class="lineno"></span><span class="op" id="7021155">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="keyword" id="7021158">func</span>&nbsp;<span class="ident" id="7021163">startServer</span><span class="op" id="7021174">(</span><span class="op" id="7021175">)</span>&nbsp;<span class="op" id="7021177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7021180">Register</span><span class="op" id="7021188">(</span><span class="builtinfunc" id="7021189">new</span><span class="op" id="7021192">(</span><span class="ident" id="7021193">Arith</span><span class="op" id="7021198">)</span><span class="op" id="7021199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7021202">RegisterName</span><span class="op" id="7021214">(</span><span class="string" id="7021215">&#34;net.rpc.Arith&#34;</span><span class="op" id="7021230">,</span>&nbsp;<span class="builtinfunc" id="7021232">new</span><span class="op" id="7021235">(</span><span class="ident" id="7021236">Arith</span><span class="op" id="7021241">)</span><span class="op" id="7021242">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7021246">var</span>&nbsp;<span class="ident" id="7021250">l</span>&nbsp;<span class="ident" id="7021252">net</span><span class="op" id="7021255">.</span><span class="ident" id="7021256">Listener</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7021266">l</span><span class="op" id="7021267">,</span>&nbsp;<span class="ident" id="7021269">serverAddr</span>&nbsp;<span class="op" id="7021280">=</span>&nbsp;<span class="ident" id="7021282">listenTCP</span><span class="op" id="7021291">(</span><span class="op" id="7021292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7021295">log</span><span class="op" id="7021298">.</span><span class="ident" id="7021299">Println</span><span class="op" id="7021306">(</span><span class="string" id="7021307">&#34;Test&nbsp;RPC&nbsp;server&nbsp;listening&nbsp;on&#34;</span><span class="op" id="7021337">,</span>&nbsp;<span class="ident" id="7021339">serverAddr</span><span class="op" id="7021349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7021352">go</span>&nbsp;<span class="ident" id="7021355">Accept</span><span class="op" id="7021361">(</span><span class="ident" id="7021362">l</span><span class="op" id="7021363">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7021367">HandleHTTP</span><span class="op" id="7021377">(</span><span class="op" id="7021378">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7021381">httpOnce</span><span class="op" id="7021389">.</span><span class="ident" id="7021390">Do</span><span class="op" id="7021392">(</span><span class="ident" id="7021393">startHttpServer</span><span class="op" id="7021408">)</span><br>
<span class="lineno"></span><span class="op" id="7021410">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7021413">func</span>&nbsp;<span class="ident" id="7021418">startNewServer</span><span class="op" id="7021432">(</span><span class="op" id="7021433">)</span>&nbsp;<span class="op" id="7021435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7021438">newServer</span>&nbsp;<span class="op" id="7021448">=</span>&nbsp;<span class="ident" id="7021450">NewServer</span><span class="op" id="7021459">(</span><span class="op" id="7021460">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7021463">newServer</span><span class="op" id="7021472">.</span><span class="ident" id="7021473">Register</span><span class="op" id="7021481">(</span><span class="builtinfunc" id="7021482">new</span><span class="op" id="7021485">(</span><span class="ident" id="7021486">Arith</span><span class="op" id="7021491">)</span><span class="op" id="7021492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7021495">newServer</span><span class="op" id="7021504">.</span><span class="ident" id="7021505">RegisterName</span><span class="op" id="7021517">(</span><span class="string" id="7021518">&#34;net.rpc.Arith&#34;</span><span class="op" id="7021533">,</span>&nbsp;<span class="builtinfunc" id="7021535">new</span><span class="op" id="7021538">(</span><span class="ident" id="7021539">Arith</span><span class="op" id="7021544">)</span><span class="op" id="7021545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7021548">newServer</span><span class="op" id="7021557">.</span><span class="ident" id="7021558">RegisterName</span><span class="op" id="7021570">(</span><span class="string" id="7021571">&#34;newServer.Arith&#34;</span><span class="op" id="7021588">,</span>&nbsp;<span class="builtinfunc" id="7021590">new</span><span class="op" id="7021593">(</span><span class="ident" id="7021594">Arith</span><span class="op" id="7021599">)</span><span class="op" id="7021600">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7021604">var</span>&nbsp;<span class="ident" id="7021608">l</span>&nbsp;<span class="ident" id="7021610">net</span><span class="op" id="7021613">.</span><span class="ident" id="7021614">Listener</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7021624">l</span><span class="op" id="7021625">,</span>&nbsp;<span class="ident" id="7021627">newServerAddr</span>&nbsp;<span class="op" id="7021641">=</span>&nbsp;<span class="ident" id="7021643">listenTCP</span><span class="op" id="7021652">(</span><span class="op" id="7021653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7021656">log</span><span class="op" id="7021659">.</span><span class="ident" id="7021660">Println</span><span class="op" id="7021667">(</span><span class="string" id="7021668">&#34;NewServer&nbsp;test&nbsp;RPC&nbsp;server&nbsp;listening&nbsp;on&#34;</span><span class="op" id="7021708">,</span>&nbsp;<span class="ident" id="7021710">newServerAddr</span><span class="op" id="7021723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7021726">go</span>&nbsp;<span class="ident" id="7021729">newServer</span><span class="op" id="7021738">.</span><span class="ident" id="7021739">Accept</span><span class="op" id="7021745">(</span><span class="ident" id="7021746">l</span><span class="op" id="7021747">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7021751">newServer</span><span class="op" id="7021760">.</span><span class="ident" id="7021761">HandleHTTP</span><span class="op" id="7021771">(</span><span class="ident" id="7021772">newHttpPath</span><span class="op" id="7021783">,</span>&nbsp;<span class="string" id="7021785">&#34;/bar&#34;</span><span class="op" id="7021791">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7021794">httpOnce</span><span class="op" id="7021802">.</span><span class="ident" id="7021803">Do</span><span class="op" id="7021805">(</span><span class="ident" id="7021806">startHttpServer</span><span class="op" id="7021821">)</span><br>
<span class="lineno"></span><span class="op" id="7021823">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7021826">func</span>&nbsp;<span class="ident" id="7021831">startHttpServer</span><span class="op" id="7021846">(</span><span class="op" id="7021847">)</span>&nbsp;<span class="op" id="7021849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7021852">server</span>&nbsp;<span class="op" id="7021859">:=</span>&nbsp;<span class="ident" id="7021862">httptest</span><span class="op" id="7021870">.</span><span class="ident" id="7021871">NewServer</span><span class="op" id="7021880">(</span><span class="builtintype" id="7021881">nil</span><span class="op" id="7021884">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7021887">httpServerAddr</span>&nbsp;<span class="op" id="7021902">=</span>&nbsp;<span class="ident" id="7021904">server</span><span class="op" id="7021910">.</span><span class="ident" id="7021911">Listener</span><span class="op" id="7021919">.</span><span class="ident" id="7021920">Addr</span><span class="op" id="7021924">(</span><span class="op" id="7021925">)</span><span class="op" id="7021926">.</span><span class="ident" id="7021927">String</span><span class="op" id="7021933">(</span><span class="op" id="7021934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7021937">log</span><span class="op" id="7021940">.</span><span class="ident" id="7021941">Println</span><span class="op" id="7021948">(</span><span class="string" id="7021949">&#34;Test&nbsp;HTTP&nbsp;RPC&nbsp;server&nbsp;listening&nbsp;on&#34;</span><span class="op" id="7021984">,</span>&nbsp;<span class="ident" id="7021986">httpServerAddr</span><span class="op" id="7022000">)</span><br>
<span class="lineno"></span><span class="op" id="7022002">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7022005">func</span>&nbsp;<span class="ident" id="7022010">TestRPC</span><span class="op" id="7022017">(</span><span class="ident" id="7022018">t</span>&nbsp;<span class="op" id="7022020">*</span><span class="ident" id="7022021">testing</span><span class="op" id="7022028">.</span><span class="ident" id="7022029">T</span><span class="op" id="7022030">)</span>&nbsp;<span class="op" id="7022032">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7022035">once</span><span class="op" id="7022039">.</span><span class="ident" id="7022040">Do</span><span class="op" id="7022042">(</span><span class="ident" id="7022043">startServer</span><span class="op" id="7022054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7022057">testRPC</span><span class="op" id="7022064">(</span><span class="ident" id="7022065">t</span><span class="op" id="7022066">,</span>&nbsp;<span class="ident" id="7022068">serverAddr</span><span class="op" id="7022078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7022081">newOnce</span><span class="op" id="7022088">.</span><span class="ident" id="7022089">Do</span><span class="op" id="7022091">(</span><span class="ident" id="7022092">startNewServer</span><span class="op" id="7022106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7022109">testRPC</span><span class="op" id="7022116">(</span><span class="ident" id="7022117">t</span><span class="op" id="7022118">,</span>&nbsp;<span class="ident" id="7022120">newServerAddr</span><span class="op" id="7022133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7022136">testNewServerRPC</span><span class="op" id="7022152">(</span><span class="ident" id="7022153">t</span><span class="op" id="7022154">,</span>&nbsp;<span class="ident" id="7022156">newServerAddr</span><span class="op" id="7022169">)</span><br>
<span class="lineno">125</span><span class="op" id="7022171">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7022174">func</span>&nbsp;<span class="ident" id="7022179">testRPC</span><span class="op" id="7022186">(</span><span class="ident" id="7022187">t</span>&nbsp;<span class="op" id="7022189">*</span><span class="ident" id="7022190">testing</span><span class="op" id="7022197">.</span><span class="ident" id="7022198">T</span><span class="op" id="7022199">,</span>&nbsp;<span class="ident" id="7022201">addr</span>&nbsp;<span class="builtintype" id="7022206">string</span><span class="op" id="7022212">)</span>&nbsp;<span class="op" id="7022214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7022217">client</span><span class="op" id="7022223">,</span>&nbsp;<span class="ident" id="7022225">err</span>&nbsp;<span class="op" id="7022229">:=</span>&nbsp;<span class="ident" id="7022232">Dial</span><span class="op" id="7022236">(</span><span class="string" id="7022237">&#34;tcp&#34;</span><span class="op" id="7022242">,</span>&nbsp;<span class="ident" id="7022244">addr</span><span class="op" id="7022248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7022251">if</span>&nbsp;<span class="ident" id="7022254">err</span>&nbsp;<span class="op" id="7022258">!=</span>&nbsp;<span class="builtintype" id="7022261">nil</span>&nbsp;<span class="op" id="7022265">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7022269">t</span><span class="op" id="7022270">.</span><span class="ident" id="7022271">Fatal</span><span class="op" id="7022276">(</span><span class="string" id="7022277">&#34;dialing&#34;</span><span class="op" id="7022286">,</span>&nbsp;<span class="ident" id="7022288">err</span><span class="op" id="7022291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7022294">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7022297">defer</span>&nbsp;<span class="ident" id="7022303">client</span><span class="op" id="7022309">.</span><span class="ident" id="7022310">Close</span><span class="op" id="7022315">(</span><span class="op" id="7022316">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7022320">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7022342">args</span>&nbsp;<span class="op" id="7022347">:=</span>&nbsp;<span class="op" id="7022350">&amp;</span><span class="ident" id="7022351">Args</span><span class="op" id="7022355">{</span><span class="num" id="7022356">7</span><span class="op" id="7022357">,</span>&nbsp;<span class="num" id="7022359">8</span><span class="op" id="7022360">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7022363">reply</span>&nbsp;<span class="op" id="7022369">:=</span>&nbsp;<span class="builtinfunc" id="7022372">new</span><span class="op" id="7022375">(</span><span class="ident" id="7022376">Reply</span><span class="op" id="7022381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7022384">err</span>&nbsp;<span class="op" id="7022388">=</span>&nbsp;<span class="ident" id="7022390">client</span><span class="op" id="7022396">.</span><span class="ident" id="7022397">Call</span><span class="op" id="7022401">(</span><span class="string" id="7022402">&#34;Arith.Add&#34;</span><span class="op" id="7022413">,</span>&nbsp;<span class="ident" id="7022415">args</span><span class="op" id="7022419">,</span>&nbsp;<span class="ident" id="7022421">reply</span><span class="op" id="7022426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7022429">if</span>&nbsp;<span class="ident" id="7022432">err</span>&nbsp;<span class="op" id="7022436">!=</span>&nbsp;<span class="builtintype" id="7022439">nil</span>&nbsp;<span class="op" id="7022443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7022447">t</span><span class="op" id="7022448">.</span><span class="ident" id="7022449">Errorf</span><span class="op" id="7022455">(</span><span class="string" id="7022456">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7022498">,</span>&nbsp;<span class="ident" id="7022500">err</span><span class="op" id="7022503">.</span><span class="ident" id="7022504">Error</span><span class="op" id="7022509">(</span><span class="op" id="7022510">)</span><span class="op" id="7022511">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7022514">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7022517">if</span>&nbsp;<span class="ident" id="7022520">reply</span><span class="op" id="7022525">.</span><span class="ident" id="7022526">C</span>&nbsp;<span class="op" id="7022528">!=</span>&nbsp;<span class="ident" id="7022531">args</span><span class="op" id="7022535">.</span><span class="ident" id="7022536">A</span><span class="op" id="7022537">+</span><span class="ident" id="7022538">args</span><span class="op" id="7022542">.</span><span class="ident" id="7022543">B</span>&nbsp;<span class="op" id="7022545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7022549">t</span><span class="op" id="7022550">.</span><span class="ident" id="7022551">Errorf</span><span class="op" id="7022557">(</span><span class="string" id="7022558">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7022583">,</span>&nbsp;<span class="ident" id="7022585">reply</span><span class="op" id="7022590">.</span><span class="ident" id="7022591">C</span><span class="op" id="7022592">,</span>&nbsp;<span class="ident" id="7022594">args</span><span class="op" id="7022598">.</span><span class="ident" id="7022599">A</span><span class="op" id="7022600">+</span><span class="ident" id="7022601">args</span><span class="op" id="7022605">.</span><span class="ident" id="7022606">B</span><span class="op" id="7022607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7022610">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7022614">//&nbsp;Nonexistent&nbsp;method</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7022637">args</span>&nbsp;<span class="op" id="7022642">=</span>&nbsp;<span class="op" id="7022644">&amp;</span><span class="ident" id="7022645">Args</span><span class="op" id="7022649">{</span><span class="num" id="7022650">7</span><span class="op" id="7022651">,</span>&nbsp;<span class="num" id="7022653">0</span><span class="op" id="7022654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7022657">reply</span>&nbsp;<span class="op" id="7022663">=</span>&nbsp;<span class="builtinfunc" id="7022665">new</span><span class="op" id="7022668">(</span><span class="ident" id="7022669">Reply</span><span class="op" id="7022674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7022677">err</span>&nbsp;<span class="op" id="7022681">=</span>&nbsp;<span class="ident" id="7022683">client</span><span class="op" id="7022689">.</span><span class="ident" id="7022690">Call</span><span class="op" id="7022694">(</span><span class="string" id="7022695">&#34;Arith.BadOperation&#34;</span><span class="op" id="7022715">,</span>&nbsp;<span class="ident" id="7022717">args</span><span class="op" id="7022721">,</span>&nbsp;<span class="ident" id="7022723">reply</span><span class="op" id="7022728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7022731">//&nbsp;expect&nbsp;an&nbsp;error</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7022751">if</span>&nbsp;<span class="ident" id="7022754">err</span>&nbsp;<span class="op" id="7022758">==</span>&nbsp;<span class="builtintype" id="7022761">nil</span>&nbsp;<span class="op" id="7022765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7022769">t</span><span class="op" id="7022770">.</span><span class="ident" id="7022771">Error</span><span class="op" id="7022776">(</span><span class="string" id="7022777">&#34;BadOperation:&nbsp;expected&nbsp;error&#34;</span><span class="op" id="7022807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7022810">}</span>&nbsp;<span class="keyword" id="7022812">else</span>&nbsp;<span class="keyword" id="7022817">if</span>&nbsp;<span class="op" id="7022820">!</span><span class="ident" id="7022821">strings</span><span class="op" id="7022828">.</span><span class="ident" id="7022829">HasPrefix</span><span class="op" id="7022838">(</span><span class="ident" id="7022839">err</span><span class="op" id="7022842">.</span><span class="ident" id="7022843">Error</span><span class="op" id="7022848">(</span><span class="op" id="7022849">)</span><span class="op" id="7022850">,</span>&nbsp;<span class="string" id="7022852">&#34;rpc:&nbsp;can&#39;t&nbsp;find&nbsp;method&nbsp;&#34;</span><span class="op" id="7022877">)</span>&nbsp;<span class="op" id="7022879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7022883">t</span><span class="op" id="7022884">.</span><span class="ident" id="7022885">Errorf</span><span class="op" id="7022891">(</span><span class="string" id="7022892">&#34;BadOperation:&nbsp;expected&nbsp;can&#39;t&nbsp;find&nbsp;method&nbsp;error;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7022948">,</span>&nbsp;<span class="ident" id="7022950">err</span><span class="op" id="7022953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7022956">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7022960">//&nbsp;Unknown&nbsp;service</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7022980">args</span>&nbsp;<span class="op" id="7022985">=</span>&nbsp;<span class="op" id="7022987">&amp;</span><span class="ident" id="7022988">Args</span><span class="op" id="7022992">{</span><span class="num" id="7022993">7</span><span class="op" id="7022994">,</span>&nbsp;<span class="num" id="7022996">8</span><span class="op" id="7022997">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7023000">reply</span>&nbsp;<span class="op" id="7023006">=</span>&nbsp;<span class="builtinfunc" id="7023008">new</span><span class="op" id="7023011">(</span><span class="ident" id="7023012">Reply</span><span class="op" id="7023017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7023020">err</span>&nbsp;<span class="op" id="7023024">=</span>&nbsp;<span class="ident" id="7023026">client</span><span class="op" id="7023032">.</span><span class="ident" id="7023033">Call</span><span class="op" id="7023037">(</span><span class="string" id="7023038">&#34;Arith.Unknown&#34;</span><span class="op" id="7023053">,</span>&nbsp;<span class="ident" id="7023055">args</span><span class="op" id="7023059">,</span>&nbsp;<span class="ident" id="7023061">reply</span><span class="op" id="7023066">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7023069">if</span>&nbsp;<span class="ident" id="7023072">err</span>&nbsp;<span class="op" id="7023076">==</span>&nbsp;<span class="builtintype" id="7023079">nil</span>&nbsp;<span class="op" id="7023083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7023087">t</span><span class="op" id="7023088">.</span><span class="ident" id="7023089">Error</span><span class="op" id="7023094">(</span><span class="string" id="7023095">&#34;expected&nbsp;error&nbsp;calling&nbsp;unknown&nbsp;service&#34;</span><span class="op" id="7023135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7023138">}</span>&nbsp;<span class="keyword" id="7023140">else</span>&nbsp;<span class="keyword" id="7023145">if</span>&nbsp;<span class="ident" id="7023148">strings</span><span class="op" id="7023155">.</span><span class="ident" id="7023156">Index</span><span class="op" id="7023161">(</span><span class="ident" id="7023162">err</span><span class="op" id="7023165">.</span><span class="ident" id="7023166">Error</span><span class="op" id="7023171">(</span><span class="op" id="7023172">)</span><span class="op" id="7023173">,</span>&nbsp;<span class="string" id="7023175">&#34;method&#34;</span><span class="op" id="7023183">)</span>&nbsp;<span class="op" id="7023185">&lt;</span>&nbsp;<span class="num" id="7023187">0</span>&nbsp;<span class="op" id="7023189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7023193">t</span><span class="op" id="7023194">.</span><span class="ident" id="7023195">Error</span><span class="op" id="7023200">(</span><span class="string" id="7023201">&#34;expected&nbsp;error&nbsp;about&nbsp;method;&nbsp;got&#34;</span><span class="op" id="7023235">,</span>&nbsp;<span class="ident" id="7023237">err</span><span class="op" id="7023240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7023243">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7023247">//&nbsp;Out&nbsp;of&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7023265">args</span>&nbsp;<span class="op" id="7023270">=</span>&nbsp;<span class="op" id="7023272">&amp;</span><span class="ident" id="7023273">Args</span><span class="op" id="7023277">{</span><span class="num" id="7023278">7</span><span class="op" id="7023279">,</span>&nbsp;<span class="num" id="7023281">8</span><span class="op" id="7023282">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7023285">mulReply</span>&nbsp;<span class="op" id="7023294">:=</span>&nbsp;<span class="builtinfunc" id="7023297">new</span><span class="op" id="7023300">(</span><span class="ident" id="7023301">Reply</span><span class="op" id="7023306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7023309">mulCall</span>&nbsp;<span class="op" id="7023317">:=</span>&nbsp;<span class="ident" id="7023320">client</span><span class="op" id="7023326">.</span><span class="ident" id="7023327">Go</span><span class="op" id="7023329">(</span><span class="string" id="7023330">&#34;Arith.Mul&#34;</span><span class="op" id="7023341">,</span>&nbsp;<span class="ident" id="7023343">args</span><span class="op" id="7023347">,</span>&nbsp;<span class="ident" id="7023349">mulReply</span><span class="op" id="7023357">,</span>&nbsp;<span class="builtintype" id="7023359">nil</span><span class="op" id="7023362">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7023365">addReply</span>&nbsp;<span class="op" id="7023374">:=</span>&nbsp;<span class="builtinfunc" id="7023377">new</span><span class="op" id="7023380">(</span><span class="ident" id="7023381">Reply</span><span class="op" id="7023386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7023389">addCall</span>&nbsp;<span class="op" id="7023397">:=</span>&nbsp;<span class="ident" id="7023400">client</span><span class="op" id="7023406">.</span><span class="ident" id="7023407">Go</span><span class="op" id="7023409">(</span><span class="string" id="7023410">&#34;Arith.Add&#34;</span><span class="op" id="7023421">,</span>&nbsp;<span class="ident" id="7023423">args</span><span class="op" id="7023427">,</span>&nbsp;<span class="ident" id="7023429">addReply</span><span class="op" id="7023437">,</span>&nbsp;<span class="builtintype" id="7023439">nil</span><span class="op" id="7023442">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7023446">addCall</span>&nbsp;<span class="op" id="7023454">=</span>&nbsp;<span class="op" id="7023456">&lt;-</span><span class="ident" id="7023458">addCall</span><span class="op" id="7023465">.</span><span class="ident" id="7023466">Done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7023472">if</span>&nbsp;<span class="ident" id="7023475">addCall</span><span class="op" id="7023482">.</span><span class="ident" id="7023483">Error</span>&nbsp;<span class="op" id="7023489">!=</span>&nbsp;<span class="builtintype" id="7023492">nil</span>&nbsp;<span class="op" id="7023496">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7023500">t</span><span class="op" id="7023501">.</span><span class="ident" id="7023502">Errorf</span><span class="op" id="7023508">(</span><span class="string" id="7023509">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7023551">,</span>&nbsp;<span class="ident" id="7023553">addCall</span><span class="op" id="7023560">.</span><span class="ident" id="7023561">Error</span><span class="op" id="7023566">.</span><span class="ident" id="7023567">Error</span><span class="op" id="7023572">(</span><span class="op" id="7023573">)</span><span class="op" id="7023574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7023577">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7023580">if</span>&nbsp;<span class="ident" id="7023583">addReply</span><span class="op" id="7023591">.</span><span class="ident" id="7023592">C</span>&nbsp;<span class="op" id="7023594">!=</span>&nbsp;<span class="ident" id="7023597">args</span><span class="op" id="7023601">.</span><span class="ident" id="7023602">A</span><span class="op" id="7023603">+</span><span class="ident" id="7023604">args</span><span class="op" id="7023608">.</span><span class="ident" id="7023609">B</span>&nbsp;<span class="op" id="7023611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7023615">t</span><span class="op" id="7023616">.</span><span class="ident" id="7023617">Errorf</span><span class="op" id="7023623">(</span><span class="string" id="7023624">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7023649">,</span>&nbsp;<span class="ident" id="7023651">addReply</span><span class="op" id="7023659">.</span><span class="ident" id="7023660">C</span><span class="op" id="7023661">,</span>&nbsp;<span class="ident" id="7023663">args</span><span class="op" id="7023667">.</span><span class="ident" id="7023668">A</span><span class="op" id="7023669">+</span><span class="ident" id="7023670">args</span><span class="op" id="7023674">.</span><span class="ident" id="7023675">B</span><span class="op" id="7023676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7023679">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7023683">mulCall</span>&nbsp;<span class="op" id="7023691">=</span>&nbsp;<span class="op" id="7023693">&lt;-</span><span class="ident" id="7023695">mulCall</span><span class="op" id="7023702">.</span><span class="ident" id="7023703">Done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7023709">if</span>&nbsp;<span class="ident" id="7023712">mulCall</span><span class="op" id="7023719">.</span><span class="ident" id="7023720">Error</span>&nbsp;<span class="op" id="7023726">!=</span>&nbsp;<span class="builtintype" id="7023729">nil</span>&nbsp;<span class="op" id="7023733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7023737">t</span><span class="op" id="7023738">.</span><span class="ident" id="7023739">Errorf</span><span class="op" id="7023745">(</span><span class="string" id="7023746">&#34;Mul:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7023788">,</span>&nbsp;<span class="ident" id="7023790">mulCall</span><span class="op" id="7023797">.</span><span class="ident" id="7023798">Error</span><span class="op" id="7023803">.</span><span class="ident" id="7023804">Error</span><span class="op" id="7023809">(</span><span class="op" id="7023810">)</span><span class="op" id="7023811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7023814">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7023817">if</span>&nbsp;<span class="ident" id="7023820">mulReply</span><span class="op" id="7023828">.</span><span class="ident" id="7023829">C</span>&nbsp;<span class="op" id="7023831">!=</span>&nbsp;<span class="ident" id="7023834">args</span><span class="op" id="7023838">.</span><span class="ident" id="7023839">A</span><span class="op" id="7023840">*</span><span class="ident" id="7023841">args</span><span class="op" id="7023845">.</span><span class="ident" id="7023846">B</span>&nbsp;<span class="op" id="7023848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7023852">t</span><span class="op" id="7023853">.</span><span class="ident" id="7023854">Errorf</span><span class="op" id="7023860">(</span><span class="string" id="7023861">&#34;Mul:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7023886">,</span>&nbsp;<span class="ident" id="7023888">mulReply</span><span class="op" id="7023896">.</span><span class="ident" id="7023897">C</span><span class="op" id="7023898">,</span>&nbsp;<span class="ident" id="7023900">args</span><span class="op" id="7023904">.</span><span class="ident" id="7023905">A</span><span class="op" id="7023906">*</span><span class="ident" id="7023907">args</span><span class="op" id="7023911">.</span><span class="ident" id="7023912">B</span><span class="op" id="7023913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7023916">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7023920">//&nbsp;Error&nbsp;test</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7023935">args</span>&nbsp;<span class="op" id="7023940">=</span>&nbsp;<span class="op" id="7023942">&amp;</span><span class="ident" id="7023943">Args</span><span class="op" id="7023947">{</span><span class="num" id="7023948">7</span><span class="op" id="7023949">,</span>&nbsp;<span class="num" id="7023951">0</span><span class="op" id="7023952">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7023955">reply</span>&nbsp;<span class="op" id="7023961">=</span>&nbsp;<span class="builtinfunc" id="7023963">new</span><span class="op" id="7023966">(</span><span class="ident" id="7023967">Reply</span><span class="op" id="7023972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7023975">err</span>&nbsp;<span class="op" id="7023979">=</span>&nbsp;<span class="ident" id="7023981">client</span><span class="op" id="7023987">.</span><span class="ident" id="7023988">Call</span><span class="op" id="7023992">(</span><span class="string" id="7023993">&#34;Arith.Div&#34;</span><span class="op" id="7024004">,</span>&nbsp;<span class="ident" id="7024006">args</span><span class="op" id="7024010">,</span>&nbsp;<span class="ident" id="7024012">reply</span><span class="op" id="7024017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7024020">//&nbsp;expect&nbsp;an&nbsp;error:&nbsp;zero&nbsp;divide</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7024053">if</span>&nbsp;<span class="ident" id="7024056">err</span>&nbsp;<span class="op" id="7024060">==</span>&nbsp;<span class="builtintype" id="7024063">nil</span>&nbsp;<span class="op" id="7024067">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7024071">t</span><span class="op" id="7024072">.</span><span class="ident" id="7024073">Error</span><span class="op" id="7024078">(</span><span class="string" id="7024079">&#34;Div:&nbsp;expected&nbsp;error&#34;</span><span class="op" id="7024100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7024103">}</span>&nbsp;<span class="keyword" id="7024105">else</span>&nbsp;<span class="keyword" id="7024110">if</span>&nbsp;<span class="ident" id="7024113">err</span><span class="op" id="7024116">.</span><span class="ident" id="7024117">Error</span><span class="op" id="7024122">(</span><span class="op" id="7024123">)</span>&nbsp;<span class="op" id="7024125">!=</span>&nbsp;<span class="string" id="7024128">&#34;divide&nbsp;by&nbsp;zero&#34;</span>&nbsp;<span class="op" id="7024145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7024149">t</span><span class="op" id="7024150">.</span><span class="ident" id="7024151">Error</span><span class="op" id="7024156">(</span><span class="string" id="7024157">&#34;Div:&nbsp;expected&nbsp;divide&nbsp;by&nbsp;zero&nbsp;error;&nbsp;got&#34;</span><span class="op" id="7024198">,</span>&nbsp;<span class="ident" id="7024200">err</span><span class="op" id="7024203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7024206">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7024210">//&nbsp;Bad&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7024224">reply</span>&nbsp;<span class="op" id="7024230">=</span>&nbsp;<span class="builtinfunc" id="7024232">new</span><span class="op" id="7024235">(</span><span class="ident" id="7024236">Reply</span><span class="op" id="7024241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7024244">err</span>&nbsp;<span class="op" id="7024248">=</span>&nbsp;<span class="ident" id="7024250">client</span><span class="op" id="7024256">.</span><span class="ident" id="7024257">Call</span><span class="op" id="7024261">(</span><span class="string" id="7024262">&#34;Arith.Add&#34;</span><span class="op" id="7024273">,</span>&nbsp;<span class="ident" id="7024275">reply</span><span class="op" id="7024280">,</span>&nbsp;<span class="ident" id="7024282">reply</span><span class="op" id="7024287">)</span>&nbsp;<span class="comment" id="7024289">//&nbsp;args,&nbsp;reply&nbsp;would&nbsp;be&nbsp;the&nbsp;correct&nbsp;thing&nbsp;to&nbsp;use</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7024339">if</span>&nbsp;<span class="ident" id="7024342">err</span>&nbsp;<span class="op" id="7024346">==</span>&nbsp;<span class="builtintype" id="7024349">nil</span>&nbsp;<span class="op" id="7024353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7024357">t</span><span class="op" id="7024358">.</span><span class="ident" id="7024359">Error</span><span class="op" id="7024364">(</span><span class="string" id="7024365">&#34;expected&nbsp;error&nbsp;calling&nbsp;Arith.Add&nbsp;with&nbsp;wrong&nbsp;arg&nbsp;type&#34;</span><span class="op" id="7024419">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7024422">}</span>&nbsp;<span class="keyword" id="7024424">else</span>&nbsp;<span class="keyword" id="7024429">if</span>&nbsp;<span class="ident" id="7024432">strings</span><span class="op" id="7024439">.</span><span class="ident" id="7024440">Index</span><span class="op" id="7024445">(</span><span class="ident" id="7024446">err</span><span class="op" id="7024449">.</span><span class="ident" id="7024450">Error</span><span class="op" id="7024455">(</span><span class="op" id="7024456">)</span><span class="op" id="7024457">,</span>&nbsp;<span class="string" id="7024459">&#34;type&#34;</span><span class="op" id="7024465">)</span>&nbsp;<span class="op" id="7024467">&lt;</span>&nbsp;<span class="num" id="7024469">0</span>&nbsp;<span class="op" id="7024471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7024475">t</span><span class="op" id="7024476">.</span><span class="ident" id="7024477">Error</span><span class="op" id="7024482">(</span><span class="string" id="7024483">&#34;expected&nbsp;error&nbsp;about&nbsp;type;&nbsp;got&#34;</span><span class="op" id="7024515">,</span>&nbsp;<span class="ident" id="7024517">err</span><span class="op" id="7024520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7024523">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7024527">//&nbsp;Non-struct&nbsp;argument</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7024551">const</span>&nbsp;<span class="ident" id="7024557">Val</span>&nbsp;<span class="op" id="7024561">=</span>&nbsp;<span class="num" id="7024563">12345</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7024570">str</span>&nbsp;<span class="op" id="7024574">:=</span>&nbsp;<span class="ident" id="7024577">fmt</span><span class="op" id="7024580">.</span><span class="ident" id="7024581">Sprint</span><span class="op" id="7024587">(</span><span class="ident" id="7024588">Val</span><span class="op" id="7024591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7024594">reply</span>&nbsp;<span class="op" id="7024600">=</span>&nbsp;<span class="builtinfunc" id="7024602">new</span><span class="op" id="7024605">(</span><span class="ident" id="7024606">Reply</span><span class="op" id="7024611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7024614">err</span>&nbsp;<span class="op" id="7024618">=</span>&nbsp;<span class="ident" id="7024620">client</span><span class="op" id="7024626">.</span><span class="ident" id="7024627">Call</span><span class="op" id="7024631">(</span><span class="string" id="7024632">&#34;Arith.Scan&#34;</span><span class="op" id="7024644">,</span>&nbsp;<span class="op" id="7024646">&amp;</span><span class="ident" id="7024647">str</span><span class="op" id="7024650">,</span>&nbsp;<span class="ident" id="7024652">reply</span><span class="op" id="7024657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7024660">if</span>&nbsp;<span class="ident" id="7024663">err</span>&nbsp;<span class="op" id="7024667">!=</span>&nbsp;<span class="builtintype" id="7024670">nil</span>&nbsp;<span class="op" id="7024674">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7024678">t</span><span class="op" id="7024679">.</span><span class="ident" id="7024680">Errorf</span><span class="op" id="7024686">(</span><span class="string" id="7024687">&#34;Scan:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7024730">,</span>&nbsp;<span class="ident" id="7024732">err</span><span class="op" id="7024735">.</span><span class="ident" id="7024736">Error</span><span class="op" id="7024741">(</span><span class="op" id="7024742">)</span><span class="op" id="7024743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7024746">}</span>&nbsp;<span class="keyword" id="7024748">else</span>&nbsp;<span class="keyword" id="7024753">if</span>&nbsp;<span class="ident" id="7024756">reply</span><span class="op" id="7024761">.</span><span class="ident" id="7024762">C</span>&nbsp;<span class="op" id="7024764">!=</span>&nbsp;<span class="ident" id="7024767">Val</span>&nbsp;<span class="op" id="7024771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7024775">t</span><span class="op" id="7024776">.</span><span class="ident" id="7024777">Errorf</span><span class="op" id="7024783">(</span><span class="string" id="7024784">&#34;Scan:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7024810">,</span>&nbsp;<span class="ident" id="7024812">Val</span><span class="op" id="7024815">,</span>&nbsp;<span class="ident" id="7024817">reply</span><span class="op" id="7024822">.</span><span class="ident" id="7024823">C</span><span class="op" id="7024824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7024827">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7024831">//&nbsp;Non-struct&nbsp;reply</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7024852">args</span>&nbsp;<span class="op" id="7024857">=</span>&nbsp;<span class="op" id="7024859">&amp;</span><span class="ident" id="7024860">Args</span><span class="op" id="7024864">{</span><span class="num" id="7024865">27</span><span class="op" id="7024867">,</span>&nbsp;<span class="num" id="7024869">35</span><span class="op" id="7024871">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7024874">str</span>&nbsp;<span class="op" id="7024878">=</span>&nbsp;<span class="string" id="7024880">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7024884">err</span>&nbsp;<span class="op" id="7024888">=</span>&nbsp;<span class="ident" id="7024890">client</span><span class="op" id="7024896">.</span><span class="ident" id="7024897">Call</span><span class="op" id="7024901">(</span><span class="string" id="7024902">&#34;Arith.String&#34;</span><span class="op" id="7024916">,</span>&nbsp;<span class="ident" id="7024918">args</span><span class="op" id="7024922">,</span>&nbsp;<span class="op" id="7024924">&amp;</span><span class="ident" id="7024925">str</span><span class="op" id="7024928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7024931">if</span>&nbsp;<span class="ident" id="7024934">err</span>&nbsp;<span class="op" id="7024938">!=</span>&nbsp;<span class="builtintype" id="7024941">nil</span>&nbsp;<span class="op" id="7024945">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7024949">t</span><span class="op" id="7024950">.</span><span class="ident" id="7024951">Errorf</span><span class="op" id="7024957">(</span><span class="string" id="7024958">&#34;String:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7025003">,</span>&nbsp;<span class="ident" id="7025005">err</span><span class="op" id="7025008">.</span><span class="ident" id="7025009">Error</span><span class="op" id="7025014">(</span><span class="op" id="7025015">)</span><span class="op" id="7025016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7025019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7025022">expect</span>&nbsp;<span class="op" id="7025029">:=</span>&nbsp;<span class="ident" id="7025032">fmt</span><span class="op" id="7025035">.</span><span class="ident" id="7025036">Sprintf</span><span class="op" id="7025043">(</span><span class="string" id="7025044">&#34;%d+%d=%d&#34;</span><span class="op" id="7025054">,</span>&nbsp;<span class="ident" id="7025056">args</span><span class="op" id="7025060">.</span><span class="ident" id="7025061">A</span><span class="op" id="7025062">,</span>&nbsp;<span class="ident" id="7025064">args</span><span class="op" id="7025068">.</span><span class="ident" id="7025069">B</span><span class="op" id="7025070">,</span>&nbsp;<span class="ident" id="7025072">args</span><span class="op" id="7025076">.</span><span class="ident" id="7025077">A</span><span class="op" id="7025078">+</span><span class="ident" id="7025079">args</span><span class="op" id="7025083">.</span><span class="ident" id="7025084">B</span><span class="op" id="7025085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7025088">if</span>&nbsp;<span class="ident" id="7025091">str</span>&nbsp;<span class="op" id="7025095">!=</span>&nbsp;<span class="ident" id="7025098">expect</span>&nbsp;<span class="op" id="7025105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7025109">t</span><span class="op" id="7025110">.</span><span class="ident" id="7025111">Errorf</span><span class="op" id="7025117">(</span><span class="string" id="7025118">&#34;String:&nbsp;expected&nbsp;%s&nbsp;got&nbsp;%s&#34;</span><span class="op" id="7025146">,</span>&nbsp;<span class="ident" id="7025148">expect</span><span class="op" id="7025154">,</span>&nbsp;<span class="ident" id="7025156">str</span><span class="op" id="7025159">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7025162">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7025166">args</span>&nbsp;<span class="op" id="7025171">=</span>&nbsp;<span class="op" id="7025173">&amp;</span><span class="ident" id="7025174">Args</span><span class="op" id="7025178">{</span><span class="num" id="7025179">7</span><span class="op" id="7025180">,</span>&nbsp;<span class="num" id="7025182">8</span><span class="op" id="7025183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7025186">reply</span>&nbsp;<span class="op" id="7025192">=</span>&nbsp;<span class="builtinfunc" id="7025194">new</span><span class="op" id="7025197">(</span><span class="ident" id="7025198">Reply</span><span class="op" id="7025203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7025206">err</span>&nbsp;<span class="op" id="7025210">=</span>&nbsp;<span class="ident" id="7025212">client</span><span class="op" id="7025218">.</span><span class="ident" id="7025219">Call</span><span class="op" id="7025223">(</span><span class="string" id="7025224">&#34;Arith.Mul&#34;</span><span class="op" id="7025235">,</span>&nbsp;<span class="ident" id="7025237">args</span><span class="op" id="7025241">,</span>&nbsp;<span class="ident" id="7025243">reply</span><span class="op" id="7025248">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7025251">if</span>&nbsp;<span class="ident" id="7025254">err</span>&nbsp;<span class="op" id="7025258">!=</span>&nbsp;<span class="builtintype" id="7025261">nil</span>&nbsp;<span class="op" id="7025265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7025269">t</span><span class="op" id="7025270">.</span><span class="ident" id="7025271">Errorf</span><span class="op" id="7025277">(</span><span class="string" id="7025278">&#34;Mul:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7025320">,</span>&nbsp;<span class="ident" id="7025322">err</span><span class="op" id="7025325">.</span><span class="ident" id="7025326">Error</span><span class="op" id="7025331">(</span><span class="op" id="7025332">)</span><span class="op" id="7025333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7025336">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7025339">if</span>&nbsp;<span class="ident" id="7025342">reply</span><span class="op" id="7025347">.</span><span class="ident" id="7025348">C</span>&nbsp;<span class="op" id="7025350">!=</span>&nbsp;<span class="ident" id="7025353">args</span><span class="op" id="7025357">.</span><span class="ident" id="7025358">A</span><span class="op" id="7025359">*</span><span class="ident" id="7025360">args</span><span class="op" id="7025364">.</span><span class="ident" id="7025365">B</span>&nbsp;<span class="op" id="7025367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7025371">t</span><span class="op" id="7025372">.</span><span class="ident" id="7025373">Errorf</span><span class="op" id="7025379">(</span><span class="string" id="7025380">&#34;Mul:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7025405">,</span>&nbsp;<span class="ident" id="7025407">reply</span><span class="op" id="7025412">.</span><span class="ident" id="7025413">C</span><span class="op" id="7025414">,</span>&nbsp;<span class="ident" id="7025416">args</span><span class="op" id="7025420">.</span><span class="ident" id="7025421">A</span><span class="op" id="7025422">*</span><span class="ident" id="7025423">args</span><span class="op" id="7025427">.</span><span class="ident" id="7025428">B</span><span class="op" id="7025429">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7025432">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7025436">//&nbsp;ServiceName&nbsp;contain&nbsp;&#34;.&#34;&nbsp;character</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7025474">args</span>&nbsp;<span class="op" id="7025479">=</span>&nbsp;<span class="op" id="7025481">&amp;</span><span class="ident" id="7025482">Args</span><span class="op" id="7025486">{</span><span class="num" id="7025487">7</span><span class="op" id="7025488">,</span>&nbsp;<span class="num" id="7025490">8</span><span class="op" id="7025491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7025494">reply</span>&nbsp;<span class="op" id="7025500">=</span>&nbsp;<span class="builtinfunc" id="7025502">new</span><span class="op" id="7025505">(</span><span class="ident" id="7025506">Reply</span><span class="op" id="7025511">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7025514">err</span>&nbsp;<span class="op" id="7025518">=</span>&nbsp;<span class="ident" id="7025520">client</span><span class="op" id="7025526">.</span><span class="ident" id="7025527">Call</span><span class="op" id="7025531">(</span><span class="string" id="7025532">&#34;net.rpc.Arith.Add&#34;</span><span class="op" id="7025551">,</span>&nbsp;<span class="ident" id="7025553">args</span><span class="op" id="7025557">,</span>&nbsp;<span class="ident" id="7025559">reply</span><span class="op" id="7025564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7025567">if</span>&nbsp;<span class="ident" id="7025570">err</span>&nbsp;<span class="op" id="7025574">!=</span>&nbsp;<span class="builtintype" id="7025577">nil</span>&nbsp;<span class="op" id="7025581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7025585">t</span><span class="op" id="7025586">.</span><span class="ident" id="7025587">Errorf</span><span class="op" id="7025593">(</span><span class="string" id="7025594">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7025636">,</span>&nbsp;<span class="ident" id="7025638">err</span><span class="op" id="7025641">.</span><span class="ident" id="7025642">Error</span><span class="op" id="7025647">(</span><span class="op" id="7025648">)</span><span class="op" id="7025649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7025652">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7025655">if</span>&nbsp;<span class="ident" id="7025658">reply</span><span class="op" id="7025663">.</span><span class="ident" id="7025664">C</span>&nbsp;<span class="op" id="7025666">!=</span>&nbsp;<span class="ident" id="7025669">args</span><span class="op" id="7025673">.</span><span class="ident" id="7025674">A</span><span class="op" id="7025675">+</span><span class="ident" id="7025676">args</span><span class="op" id="7025680">.</span><span class="ident" id="7025681">B</span>&nbsp;<span class="op" id="7025683">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7025687">t</span><span class="op" id="7025688">.</span><span class="ident" id="7025689">Errorf</span><span class="op" id="7025695">(</span><span class="string" id="7025696">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7025721">,</span>&nbsp;<span class="ident" id="7025723">reply</span><span class="op" id="7025728">.</span><span class="ident" id="7025729">C</span><span class="op" id="7025730">,</span>&nbsp;<span class="ident" id="7025732">args</span><span class="op" id="7025736">.</span><span class="ident" id="7025737">A</span><span class="op" id="7025738">+</span><span class="ident" id="7025739">args</span><span class="op" id="7025743">.</span><span class="ident" id="7025744">B</span><span class="op" id="7025745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7025748">}</span><br>
<span class="lineno"></span><span class="op" id="7025750">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7025753">func</span>&nbsp;<span class="ident" id="7025758">testNewServerRPC</span><span class="op" id="7025774">(</span><span class="ident" id="7025775">t</span>&nbsp;<span class="op" id="7025777">*</span><span class="ident" id="7025778">testing</span><span class="op" id="7025785">.</span><span class="ident" id="7025786">T</span><span class="op" id="7025787">,</span>&nbsp;<span class="ident" id="7025789">addr</span>&nbsp;<span class="builtintype" id="7025794">string</span><span class="op" id="7025800">)</span>&nbsp;<span class="op" id="7025802">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7025805">client</span><span class="op" id="7025811">,</span>&nbsp;<span class="ident" id="7025813">err</span>&nbsp;<span class="op" id="7025817">:=</span>&nbsp;<span class="ident" id="7025820">Dial</span><span class="op" id="7025824">(</span><span class="string" id="7025825">&#34;tcp&#34;</span><span class="op" id="7025830">,</span>&nbsp;<span class="ident" id="7025832">addr</span><span class="op" id="7025836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7025839">if</span>&nbsp;<span class="ident" id="7025842">err</span>&nbsp;<span class="op" id="7025846">!=</span>&nbsp;<span class="builtintype" id="7025849">nil</span>&nbsp;<span class="op" id="7025853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7025857">t</span><span class="op" id="7025858">.</span><span class="ident" id="7025859">Fatal</span><span class="op" id="7025864">(</span><span class="string" id="7025865">&#34;dialing&#34;</span><span class="op" id="7025874">,</span>&nbsp;<span class="ident" id="7025876">err</span><span class="op" id="7025879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7025882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7025885">defer</span>&nbsp;<span class="ident" id="7025891">client</span><span class="op" id="7025897">.</span><span class="ident" id="7025898">Close</span><span class="op" id="7025903">(</span><span class="op" id="7025904">)</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7025908">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7025930">args</span>&nbsp;<span class="op" id="7025935">:=</span>&nbsp;<span class="op" id="7025938">&amp;</span><span class="ident" id="7025939">Args</span><span class="op" id="7025943">{</span><span class="num" id="7025944">7</span><span class="op" id="7025945">,</span>&nbsp;<span class="num" id="7025947">8</span><span class="op" id="7025948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7025951">reply</span>&nbsp;<span class="op" id="7025957">:=</span>&nbsp;<span class="builtinfunc" id="7025960">new</span><span class="op" id="7025963">(</span><span class="ident" id="7025964">Reply</span><span class="op" id="7025969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7025972">err</span>&nbsp;<span class="op" id="7025976">=</span>&nbsp;<span class="ident" id="7025978">client</span><span class="op" id="7025984">.</span><span class="ident" id="7025985">Call</span><span class="op" id="7025989">(</span><span class="string" id="7025990">&#34;newServer.Arith.Add&#34;</span><span class="op" id="7026011">,</span>&nbsp;<span class="ident" id="7026013">args</span><span class="op" id="7026017">,</span>&nbsp;<span class="ident" id="7026019">reply</span><span class="op" id="7026024">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7026027">if</span>&nbsp;<span class="ident" id="7026030">err</span>&nbsp;<span class="op" id="7026034">!=</span>&nbsp;<span class="builtintype" id="7026037">nil</span>&nbsp;<span class="op" id="7026041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7026045">t</span><span class="op" id="7026046">.</span><span class="ident" id="7026047">Errorf</span><span class="op" id="7026053">(</span><span class="string" id="7026054">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7026096">,</span>&nbsp;<span class="ident" id="7026098">err</span><span class="op" id="7026101">.</span><span class="ident" id="7026102">Error</span><span class="op" id="7026107">(</span><span class="op" id="7026108">)</span><span class="op" id="7026109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7026112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7026115">if</span>&nbsp;<span class="ident" id="7026118">reply</span><span class="op" id="7026123">.</span><span class="ident" id="7026124">C</span>&nbsp;<span class="op" id="7026126">!=</span>&nbsp;<span class="ident" id="7026129">args</span><span class="op" id="7026133">.</span><span class="ident" id="7026134">A</span><span class="op" id="7026135">+</span><span class="ident" id="7026136">args</span><span class="op" id="7026140">.</span><span class="ident" id="7026141">B</span>&nbsp;<span class="op" id="7026143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7026147">t</span><span class="op" id="7026148">.</span><span class="ident" id="7026149">Errorf</span><span class="op" id="7026155">(</span><span class="string" id="7026156">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7026181">,</span>&nbsp;<span class="ident" id="7026183">reply</span><span class="op" id="7026188">.</span><span class="ident" id="7026189">C</span><span class="op" id="7026190">,</span>&nbsp;<span class="ident" id="7026192">args</span><span class="op" id="7026196">.</span><span class="ident" id="7026197">A</span><span class="op" id="7026198">+</span><span class="ident" id="7026199">args</span><span class="op" id="7026203">.</span><span class="ident" id="7026204">B</span><span class="op" id="7026205">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7026208">}</span><br>
<span class="lineno"></span><span class="op" id="7026210">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7026213">func</span>&nbsp;<span class="ident" id="7026218">TestHTTP</span><span class="op" id="7026226">(</span><span class="ident" id="7026227">t</span>&nbsp;<span class="op" id="7026229">*</span><span class="ident" id="7026230">testing</span><span class="op" id="7026237">.</span><span class="ident" id="7026238">T</span><span class="op" id="7026239">)</span>&nbsp;<span class="op" id="7026241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7026244">once</span><span class="op" id="7026248">.</span><span class="ident" id="7026249">Do</span><span class="op" id="7026251">(</span><span class="ident" id="7026252">startServer</span><span class="op" id="7026263">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7026266">testHTTPRPC</span><span class="op" id="7026277">(</span><span class="ident" id="7026278">t</span><span class="op" id="7026279">,</span>&nbsp;<span class="string" id="7026281">&#34;&#34;</span><span class="op" id="7026283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7026286">newOnce</span><span class="op" id="7026293">.</span><span class="ident" id="7026294">Do</span><span class="op" id="7026296">(</span><span class="ident" id="7026297">startNewServer</span><span class="op" id="7026311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7026314">testHTTPRPC</span><span class="op" id="7026325">(</span><span class="ident" id="7026326">t</span><span class="op" id="7026327">,</span>&nbsp;<span class="ident" id="7026329">newHttpPath</span><span class="op" id="7026340">)</span><br>
<span class="lineno"></span><span class="op" id="7026342">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span><span class="keyword" id="7026345">func</span>&nbsp;<span class="ident" id="7026350">testHTTPRPC</span><span class="op" id="7026361">(</span><span class="ident" id="7026362">t</span>&nbsp;<span class="op" id="7026364">*</span><span class="ident" id="7026365">testing</span><span class="op" id="7026372">.</span><span class="ident" id="7026373">T</span><span class="op" id="7026374">,</span>&nbsp;<span class="ident" id="7026376">path</span>&nbsp;<span class="builtintype" id="7026381">string</span><span class="op" id="7026387">)</span>&nbsp;<span class="op" id="7026389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7026392">var</span>&nbsp;<span class="ident" id="7026396">client</span>&nbsp;<span class="op" id="7026403">*</span><span class="ident" id="7026404">Client</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7026412">var</span>&nbsp;<span class="ident" id="7026416">err</span>&nbsp;<span class="builtintype" id="7026420">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7026427">if</span>&nbsp;<span class="ident" id="7026430">path</span>&nbsp;<span class="op" id="7026435">==</span>&nbsp;<span class="string" id="7026438">&#34;&#34;</span>&nbsp;<span class="op" id="7026441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7026445">client</span><span class="op" id="7026451">,</span>&nbsp;<span class="ident" id="7026453">err</span>&nbsp;<span class="op" id="7026457">=</span>&nbsp;<span class="ident" id="7026459">DialHTTP</span><span class="op" id="7026467">(</span><span class="string" id="7026468">&#34;tcp&#34;</span><span class="op" id="7026473">,</span>&nbsp;<span class="ident" id="7026475">httpServerAddr</span><span class="op" id="7026489">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7026492">}</span>&nbsp;<span class="keyword" id="7026494">else</span>&nbsp;<span class="op" id="7026499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7026503">client</span><span class="op" id="7026509">,</span>&nbsp;<span class="ident" id="7026511">err</span>&nbsp;<span class="op" id="7026515">=</span>&nbsp;<span class="ident" id="7026517">DialHTTPPath</span><span class="op" id="7026529">(</span><span class="string" id="7026530">&#34;tcp&#34;</span><span class="op" id="7026535">,</span>&nbsp;<span class="ident" id="7026537">httpServerAddr</span><span class="op" id="7026551">,</span>&nbsp;<span class="ident" id="7026553">path</span><span class="op" id="7026557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7026560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7026563">if</span>&nbsp;<span class="ident" id="7026566">err</span>&nbsp;<span class="op" id="7026570">!=</span>&nbsp;<span class="builtintype" id="7026573">nil</span>&nbsp;<span class="op" id="7026577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7026581">t</span><span class="op" id="7026582">.</span><span class="ident" id="7026583">Fatal</span><span class="op" id="7026588">(</span><span class="string" id="7026589">&#34;dialing&#34;</span><span class="op" id="7026598">,</span>&nbsp;<span class="ident" id="7026600">err</span><span class="op" id="7026603">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7026606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7026609">defer</span>&nbsp;<span class="ident" id="7026615">client</span><span class="op" id="7026621">.</span><span class="ident" id="7026622">Close</span><span class="op" id="7026627">(</span><span class="op" id="7026628">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7026632">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7026654">args</span>&nbsp;<span class="op" id="7026659">:=</span>&nbsp;<span class="op" id="7026662">&amp;</span><span class="ident" id="7026663">Args</span><span class="op" id="7026667">{</span><span class="num" id="7026668">7</span><span class="op" id="7026669">,</span>&nbsp;<span class="num" id="7026671">8</span><span class="op" id="7026672">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7026675">reply</span>&nbsp;<span class="op" id="7026681">:=</span>&nbsp;<span class="builtinfunc" id="7026684">new</span><span class="op" id="7026687">(</span><span class="ident" id="7026688">Reply</span><span class="op" id="7026693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7026696">err</span>&nbsp;<span class="op" id="7026700">=</span>&nbsp;<span class="ident" id="7026702">client</span><span class="op" id="7026708">.</span><span class="ident" id="7026709">Call</span><span class="op" id="7026713">(</span><span class="string" id="7026714">&#34;Arith.Add&#34;</span><span class="op" id="7026725">,</span>&nbsp;<span class="ident" id="7026727">args</span><span class="op" id="7026731">,</span>&nbsp;<span class="ident" id="7026733">reply</span><span class="op" id="7026738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7026741">if</span>&nbsp;<span class="ident" id="7026744">err</span>&nbsp;<span class="op" id="7026748">!=</span>&nbsp;<span class="builtintype" id="7026751">nil</span>&nbsp;<span class="op" id="7026755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7026759">t</span><span class="op" id="7026760">.</span><span class="ident" id="7026761">Errorf</span><span class="op" id="7026767">(</span><span class="string" id="7026768">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7026810">,</span>&nbsp;<span class="ident" id="7026812">err</span><span class="op" id="7026815">.</span><span class="ident" id="7026816">Error</span><span class="op" id="7026821">(</span><span class="op" id="7026822">)</span><span class="op" id="7026823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7026826">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7026829">if</span>&nbsp;<span class="ident" id="7026832">reply</span><span class="op" id="7026837">.</span><span class="ident" id="7026838">C</span>&nbsp;<span class="op" id="7026840">!=</span>&nbsp;<span class="ident" id="7026843">args</span><span class="op" id="7026847">.</span><span class="ident" id="7026848">A</span><span class="op" id="7026849">+</span><span class="ident" id="7026850">args</span><span class="op" id="7026854">.</span><span class="ident" id="7026855">B</span>&nbsp;<span class="op" id="7026857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7026861">t</span><span class="op" id="7026862">.</span><span class="ident" id="7026863">Errorf</span><span class="op" id="7026869">(</span><span class="string" id="7026870">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7026895">,</span>&nbsp;<span class="ident" id="7026897">reply</span><span class="op" id="7026902">.</span><span class="ident" id="7026903">C</span><span class="op" id="7026904">,</span>&nbsp;<span class="ident" id="7026906">args</span><span class="op" id="7026910">.</span><span class="ident" id="7026911">A</span><span class="op" id="7026912">+</span><span class="ident" id="7026913">args</span><span class="op" id="7026917">.</span><span class="ident" id="7026918">B</span><span class="op" id="7026919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7026922">}</span><br>
<span class="lineno"></span><span class="op" id="7026924">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span><span class="comment" id="7026927">//&nbsp;CodecEmulator&nbsp;provides&nbsp;a&nbsp;client-like&nbsp;api&nbsp;and&nbsp;a&nbsp;ServerCodec&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="7027000">//&nbsp;Can&nbsp;be&nbsp;used&nbsp;to&nbsp;test&nbsp;ServeRequest.</span><br>
<span class="lineno"></span><span class="keyword" id="7027037">type</span>&nbsp;<span class="ident" id="7027042">CodecEmulator</span>&nbsp;<span class="keyword" id="7027056">struct</span>&nbsp;<span class="op" id="7027063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7027066">server</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7027080">*</span><span class="ident" id="7027081">Server</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7027089">serviceMethod</span>&nbsp;<span class="builtintype" id="7027103">string</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7027111">args</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7027125">*</span><span class="ident" id="7027126">Args</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7027132">reply</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7027146">*</span><span class="ident" id="7027147">Reply</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7027154">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7027168">error</span><br>
<span class="lineno"></span><span class="op" id="7027174">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="keyword" id="7027177">func</span>&nbsp;<span class="op" id="7027182">(</span><span class="ident" id="7027183">codec</span>&nbsp;<span class="op" id="7027189">*</span><span class="ident" id="7027190">CodecEmulator</span><span class="op" id="7027203">)</span>&nbsp;<span class="ident" id="7027205">Call</span><span class="op" id="7027209">(</span><span class="ident" id="7027210">serviceMethod</span>&nbsp;<span class="builtintype" id="7027224">string</span><span class="op" id="7027230">,</span>&nbsp;<span class="ident" id="7027232">args</span>&nbsp;<span class="op" id="7027237">*</span><span class="ident" id="7027238">Args</span><span class="op" id="7027242">,</span>&nbsp;<span class="ident" id="7027244">reply</span>&nbsp;<span class="op" id="7027250">*</span><span class="ident" id="7027251">Reply</span><span class="op" id="7027256">)</span>&nbsp;<span class="builtintype" id="7027258">error</span>&nbsp;<span class="op" id="7027264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7027267">codec</span><span class="op" id="7027272">.</span><span class="ident" id="7027273">serviceMethod</span>&nbsp;<span class="op" id="7027287">=</span>&nbsp;<span class="ident" id="7027289">serviceMethod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7027304">codec</span><span class="op" id="7027309">.</span><span class="ident" id="7027310">args</span>&nbsp;<span class="op" id="7027315">=</span>&nbsp;<span class="ident" id="7027317">args</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7027323">codec</span><span class="op" id="7027328">.</span><span class="ident" id="7027329">reply</span>&nbsp;<span class="op" id="7027335">=</span>&nbsp;<span class="ident" id="7027337">reply</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7027344">codec</span><span class="op" id="7027349">.</span><span class="ident" id="7027350">err</span>&nbsp;<span class="op" id="7027354">=</span>&nbsp;<span class="builtintype" id="7027356">nil</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7027361">var</span>&nbsp;<span class="ident" id="7027365">serverError</span>&nbsp;<span class="builtintype" id="7027377">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7027384">if</span>&nbsp;<span class="ident" id="7027387">codec</span><span class="op" id="7027392">.</span><span class="ident" id="7027393">server</span>&nbsp;<span class="op" id="7027400">==</span>&nbsp;<span class="builtintype" id="7027403">nil</span>&nbsp;<span class="op" id="7027407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7027411">serverError</span>&nbsp;<span class="op" id="7027423">=</span>&nbsp;<span class="ident" id="7027425">ServeRequest</span><span class="op" id="7027437">(</span><span class="ident" id="7027438">codec</span><span class="op" id="7027443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7027446">}</span>&nbsp;<span class="keyword" id="7027448">else</span>&nbsp;<span class="op" id="7027453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7027457">serverError</span>&nbsp;<span class="op" id="7027469">=</span>&nbsp;<span class="ident" id="7027471">codec</span><span class="op" id="7027476">.</span><span class="ident" id="7027477">server</span><span class="op" id="7027483">.</span><span class="ident" id="7027484">ServeRequest</span><span class="op" id="7027496">(</span><span class="ident" id="7027497">codec</span><span class="op" id="7027502">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7027505">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7027508">if</span>&nbsp;<span class="ident" id="7027511">codec</span><span class="op" id="7027516">.</span><span class="ident" id="7027517">err</span>&nbsp;<span class="op" id="7027521">==</span>&nbsp;<span class="builtintype" id="7027524">nil</span>&nbsp;<span class="op" id="7027528">&amp;&amp;</span>&nbsp;<span class="ident" id="7027531">serverError</span>&nbsp;<span class="op" id="7027543">!=</span>&nbsp;<span class="builtintype" id="7027546">nil</span>&nbsp;<span class="op" id="7027550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7027554">codec</span><span class="op" id="7027559">.</span><span class="ident" id="7027560">err</span>&nbsp;<span class="op" id="7027564">=</span>&nbsp;<span class="ident" id="7027566">serverError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7027579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7027582">return</span>&nbsp;<span class="ident" id="7027589">codec</span><span class="op" id="7027594">.</span><span class="ident" id="7027595">err</span><br>
<span class="lineno">330</span><span class="op" id="7027599">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7027602">func</span>&nbsp;<span class="op" id="7027607">(</span><span class="ident" id="7027608">codec</span>&nbsp;<span class="op" id="7027614">*</span><span class="ident" id="7027615">CodecEmulator</span><span class="op" id="7027628">)</span>&nbsp;<span class="ident" id="7027630">ReadRequestHeader</span><span class="op" id="7027647">(</span><span class="ident" id="7027648">req</span>&nbsp;<span class="op" id="7027652">*</span><span class="ident" id="7027653">Request</span><span class="op" id="7027660">)</span>&nbsp;<span class="builtintype" id="7027662">error</span>&nbsp;<span class="op" id="7027668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7027671">req</span><span class="op" id="7027674">.</span><span class="ident" id="7027675">ServiceMethod</span>&nbsp;<span class="op" id="7027689">=</span>&nbsp;<span class="ident" id="7027691">codec</span><span class="op" id="7027696">.</span><span class="ident" id="7027697">serviceMethod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7027712">req</span><span class="op" id="7027715">.</span><span class="ident" id="7027716">Seq</span>&nbsp;<span class="op" id="7027720">=</span>&nbsp;<span class="num" id="7027722">0</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7027725">return</span>&nbsp;<span class="builtintype" id="7027732">nil</span><br>
<span class="lineno"></span><span class="op" id="7027736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7027739">func</span>&nbsp;<span class="op" id="7027744">(</span><span class="ident" id="7027745">codec</span>&nbsp;<span class="op" id="7027751">*</span><span class="ident" id="7027752">CodecEmulator</span><span class="op" id="7027765">)</span>&nbsp;<span class="ident" id="7027767">ReadRequestBody</span><span class="op" id="7027782">(</span><span class="ident" id="7027783">argv</span>&nbsp;<span class="keyword" id="7027788">interface</span><span class="op" id="7027797">{</span><span class="op" id="7027798">}</span><span class="op" id="7027799">)</span>&nbsp;<span class="builtintype" id="7027801">error</span>&nbsp;<span class="op" id="7027807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7027810">if</span>&nbsp;<span class="ident" id="7027813">codec</span><span class="op" id="7027818">.</span><span class="ident" id="7027819">args</span>&nbsp;<span class="op" id="7027824">==</span>&nbsp;<span class="builtintype" id="7027827">nil</span>&nbsp;<span class="op" id="7027831">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7027835">return</span>&nbsp;<span class="ident" id="7027842">io</span><span class="op" id="7027844">.</span><span class="ident" id="7027845">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7027863">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7027866">*</span><span class="op" id="7027867">(</span><span class="ident" id="7027868">argv</span><span class="op" id="7027872">.</span><span class="op" id="7027873">(</span><span class="op" id="7027874">*</span><span class="ident" id="7027875">Args</span><span class="op" id="7027879">)</span><span class="op" id="7027880">)</span>&nbsp;<span class="op" id="7027882">=</span>&nbsp;<span class="op" id="7027884">*</span><span class="ident" id="7027885">codec</span><span class="op" id="7027890">.</span><span class="ident" id="7027891">args</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7027897">return</span>&nbsp;<span class="builtintype" id="7027904">nil</span><br>
<span class="lineno"></span><span class="op" id="7027908">}</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span><span class="keyword" id="7027911">func</span>&nbsp;<span class="op" id="7027916">(</span><span class="ident" id="7027917">codec</span>&nbsp;<span class="op" id="7027923">*</span><span class="ident" id="7027924">CodecEmulator</span><span class="op" id="7027937">)</span>&nbsp;<span class="ident" id="7027939">WriteResponse</span><span class="op" id="7027952">(</span><span class="ident" id="7027953">resp</span>&nbsp;<span class="op" id="7027958">*</span><span class="ident" id="7027959">Response</span><span class="op" id="7027967">,</span>&nbsp;<span class="ident" id="7027969">reply</span>&nbsp;<span class="keyword" id="7027975">interface</span><span class="op" id="7027984">{</span><span class="op" id="7027985">}</span><span class="op" id="7027986">)</span>&nbsp;<span class="builtintype" id="7027988">error</span>&nbsp;<span class="op" id="7027994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7027997">if</span>&nbsp;<span class="ident" id="7028000">resp</span><span class="op" id="7028004">.</span><span class="ident" id="7028005">Error</span>&nbsp;<span class="op" id="7028011">!=</span>&nbsp;<span class="string" id="7028014">&#34;&#34;</span>&nbsp;<span class="op" id="7028017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7028021">codec</span><span class="op" id="7028026">.</span><span class="ident" id="7028027">err</span>&nbsp;<span class="op" id="7028031">=</span>&nbsp;<span class="ident" id="7028033">errors</span><span class="op" id="7028039">.</span><span class="ident" id="7028040">New</span><span class="op" id="7028043">(</span><span class="ident" id="7028044">resp</span><span class="op" id="7028048">.</span><span class="ident" id="7028049">Error</span><span class="op" id="7028054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7028057">}</span>&nbsp;<span class="keyword" id="7028059">else</span>&nbsp;<span class="op" id="7028064">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7028068">*</span><span class="ident" id="7028069">codec</span><span class="op" id="7028074">.</span><span class="ident" id="7028075">reply</span>&nbsp;<span class="op" id="7028081">=</span>&nbsp;<span class="op" id="7028083">*</span><span class="op" id="7028084">(</span><span class="ident" id="7028085">reply</span><span class="op" id="7028090">.</span><span class="op" id="7028091">(</span><span class="op" id="7028092">*</span><span class="ident" id="7028093">Reply</span><span class="op" id="7028098">)</span><span class="op" id="7028099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7028102">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7028105">return</span>&nbsp;<span class="builtintype" id="7028112">nil</span><br>
<span class="lineno"></span><span class="op" id="7028116">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="keyword" id="7028119">func</span>&nbsp;<span class="op" id="7028124">(</span><span class="ident" id="7028125">codec</span>&nbsp;<span class="op" id="7028131">*</span><span class="ident" id="7028132">CodecEmulator</span><span class="op" id="7028145">)</span>&nbsp;<span class="ident" id="7028147">Close</span><span class="op" id="7028152">(</span><span class="op" id="7028153">)</span>&nbsp;<span class="builtintype" id="7028155">error</span>&nbsp;<span class="op" id="7028161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7028164">return</span>&nbsp;<span class="builtintype" id="7028171">nil</span><br>
<span class="lineno"></span><span class="op" id="7028175">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7028178">func</span>&nbsp;<span class="ident" id="7028183">TestServeRequest</span><span class="op" id="7028199">(</span><span class="ident" id="7028200">t</span>&nbsp;<span class="op" id="7028202">*</span><span class="ident" id="7028203">testing</span><span class="op" id="7028210">.</span><span class="ident" id="7028211">T</span><span class="op" id="7028212">)</span>&nbsp;<span class="op" id="7028214">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7028217">once</span><span class="op" id="7028221">.</span><span class="ident" id="7028222">Do</span><span class="op" id="7028224">(</span><span class="ident" id="7028225">startServer</span><span class="op" id="7028236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7028239">testServeRequest</span><span class="op" id="7028255">(</span><span class="ident" id="7028256">t</span><span class="op" id="7028257">,</span>&nbsp;<span class="builtintype" id="7028259">nil</span><span class="op" id="7028262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7028265">newOnce</span><span class="op" id="7028272">.</span><span class="ident" id="7028273">Do</span><span class="op" id="7028275">(</span><span class="ident" id="7028276">startNewServer</span><span class="op" id="7028290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7028293">testServeRequest</span><span class="op" id="7028309">(</span><span class="ident" id="7028310">t</span><span class="op" id="7028311">,</span>&nbsp;<span class="ident" id="7028313">newServer</span><span class="op" id="7028322">)</span><br>
<span class="lineno"></span><span class="op" id="7028324">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="7028327">func</span>&nbsp;<span class="ident" id="7028332">testServeRequest</span><span class="op" id="7028348">(</span><span class="ident" id="7028349">t</span>&nbsp;<span class="op" id="7028351">*</span><span class="ident" id="7028352">testing</span><span class="op" id="7028359">.</span><span class="ident" id="7028360">T</span><span class="op" id="7028361">,</span>&nbsp;<span class="ident" id="7028363">server</span>&nbsp;<span class="op" id="7028370">*</span><span class="ident" id="7028371">Server</span><span class="op" id="7028377">)</span>&nbsp;<span class="op" id="7028379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7028382">client</span>&nbsp;<span class="op" id="7028389">:=</span>&nbsp;<span class="ident" id="7028392">CodecEmulator</span><span class="op" id="7028405">{</span><span class="ident" id="7028406">server</span><span class="op" id="7028412">:</span>&nbsp;<span class="ident" id="7028414">server</span><span class="op" id="7028420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7028423">defer</span>&nbsp;<span class="ident" id="7028429">client</span><span class="op" id="7028435">.</span><span class="ident" id="7028436">Close</span><span class="op" id="7028441">(</span><span class="op" id="7028442">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7028446">args</span>&nbsp;<span class="op" id="7028451">:=</span>&nbsp;<span class="op" id="7028454">&amp;</span><span class="ident" id="7028455">Args</span><span class="op" id="7028459">{</span><span class="num" id="7028460">7</span><span class="op" id="7028461">,</span>&nbsp;<span class="num" id="7028463">8</span><span class="op" id="7028464">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7028467">reply</span>&nbsp;<span class="op" id="7028473">:=</span>&nbsp;<span class="builtinfunc" id="7028476">new</span><span class="op" id="7028479">(</span><span class="ident" id="7028480">Reply</span><span class="op" id="7028485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7028488">err</span>&nbsp;<span class="op" id="7028492">:=</span>&nbsp;<span class="ident" id="7028495">client</span><span class="op" id="7028501">.</span><span class="ident" id="7028502">Call</span><span class="op" id="7028506">(</span><span class="string" id="7028507">&#34;Arith.Add&#34;</span><span class="op" id="7028518">,</span>&nbsp;<span class="ident" id="7028520">args</span><span class="op" id="7028524">,</span>&nbsp;<span class="ident" id="7028526">reply</span><span class="op" id="7028531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7028534">if</span>&nbsp;<span class="ident" id="7028537">err</span>&nbsp;<span class="op" id="7028541">!=</span>&nbsp;<span class="builtintype" id="7028544">nil</span>&nbsp;<span class="op" id="7028548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7028552">t</span><span class="op" id="7028553">.</span><span class="ident" id="7028554">Errorf</span><span class="op" id="7028560">(</span><span class="string" id="7028561">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7028603">,</span>&nbsp;<span class="ident" id="7028605">err</span><span class="op" id="7028608">.</span><span class="ident" id="7028609">Error</span><span class="op" id="7028614">(</span><span class="op" id="7028615">)</span><span class="op" id="7028616">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7028619">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7028622">if</span>&nbsp;<span class="ident" id="7028625">reply</span><span class="op" id="7028630">.</span><span class="ident" id="7028631">C</span>&nbsp;<span class="op" id="7028633">!=</span>&nbsp;<span class="ident" id="7028636">args</span><span class="op" id="7028640">.</span><span class="ident" id="7028641">A</span><span class="op" id="7028642">+</span><span class="ident" id="7028643">args</span><span class="op" id="7028647">.</span><span class="ident" id="7028648">B</span>&nbsp;<span class="op" id="7028650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7028654">t</span><span class="op" id="7028655">.</span><span class="ident" id="7028656">Errorf</span><span class="op" id="7028662">(</span><span class="string" id="7028663">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7028688">,</span>&nbsp;<span class="ident" id="7028690">reply</span><span class="op" id="7028695">.</span><span class="ident" id="7028696">C</span><span class="op" id="7028697">,</span>&nbsp;<span class="ident" id="7028699">args</span><span class="op" id="7028703">.</span><span class="ident" id="7028704">A</span><span class="op" id="7028705">+</span><span class="ident" id="7028706">args</span><span class="op" id="7028710">.</span><span class="ident" id="7028711">B</span><span class="op" id="7028712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7028715">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7028719">err</span>&nbsp;<span class="op" id="7028723">=</span>&nbsp;<span class="ident" id="7028725">client</span><span class="op" id="7028731">.</span><span class="ident" id="7028732">Call</span><span class="op" id="7028736">(</span><span class="string" id="7028737">&#34;Arith.Add&#34;</span><span class="op" id="7028748">,</span>&nbsp;<span class="builtintype" id="7028750">nil</span><span class="op" id="7028753">,</span>&nbsp;<span class="ident" id="7028755">reply</span><span class="op" id="7028760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7028763">if</span>&nbsp;<span class="ident" id="7028766">err</span>&nbsp;<span class="op" id="7028770">==</span>&nbsp;<span class="builtintype" id="7028773">nil</span>&nbsp;<span class="op" id="7028777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7028781">t</span><span class="op" id="7028782">.</span><span class="ident" id="7028783">Errorf</span><span class="op" id="7028789">(</span><span class="string" id="7028790">&#34;expected&nbsp;error&nbsp;calling&nbsp;Arith.Add&nbsp;with&nbsp;nil&nbsp;arg&#34;</span><span class="op" id="7028837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7028840">}</span><br>
<span class="lineno"></span><span class="op" id="7028842">}</span><br>
<span class="lineno">385</span><br>
<span class="lineno"></span><span class="keyword" id="7028845">type</span>&nbsp;<span class="ident" id="7028850">ReplyNotPointer</span>&nbsp;<span class="builtintype" id="7028866">int</span><br>
<span class="lineno"></span><span class="keyword" id="7028870">type</span>&nbsp;<span class="ident" id="7028875">ArgNotPublic</span>&nbsp;<span class="builtintype" id="7028888">int</span><br>
<span class="lineno"></span><span class="keyword" id="7028892">type</span>&nbsp;<span class="ident" id="7028897">ReplyNotPublic</span>&nbsp;<span class="builtintype" id="7028912">int</span><br>
<span class="lineno"></span><span class="keyword" id="7028916">type</span>&nbsp;<span class="ident" id="7028921">NeedsPtrType</span>&nbsp;<span class="builtintype" id="7028934">int</span><br>
<span class="lineno">390</span><span class="keyword" id="7028938">type</span>&nbsp;<span class="ident" id="7028943">local</span>&nbsp;<span class="keyword" id="7028949">struct</span><span class="op" id="7028955">{</span><span class="op" id="7028956">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7028959">func</span>&nbsp;<span class="op" id="7028964">(</span><span class="ident" id="7028965">t</span>&nbsp;<span class="op" id="7028967">*</span><span class="ident" id="7028968">ReplyNotPointer</span><span class="op" id="7028983">)</span>&nbsp;<span class="ident" id="7028985">ReplyNotPointer</span><span class="op" id="7029000">(</span><span class="ident" id="7029001">args</span>&nbsp;<span class="op" id="7029006">*</span><span class="ident" id="7029007">Args</span><span class="op" id="7029011">,</span>&nbsp;<span class="ident" id="7029013">reply</span>&nbsp;<span class="ident" id="7029019">Reply</span><span class="op" id="7029024">)</span>&nbsp;<span class="builtintype" id="7029026">error</span>&nbsp;<span class="op" id="7029032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7029035">return</span>&nbsp;<span class="builtintype" id="7029042">nil</span><br>
<span class="lineno"></span><span class="op" id="7029046">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="keyword" id="7029049">func</span>&nbsp;<span class="op" id="7029054">(</span><span class="ident" id="7029055">t</span>&nbsp;<span class="op" id="7029057">*</span><span class="ident" id="7029058">ArgNotPublic</span><span class="op" id="7029070">)</span>&nbsp;<span class="ident" id="7029072">ArgNotPublic</span><span class="op" id="7029084">(</span><span class="ident" id="7029085">args</span>&nbsp;<span class="op" id="7029090">*</span><span class="ident" id="7029091">local</span><span class="op" id="7029096">,</span>&nbsp;<span class="ident" id="7029098">reply</span>&nbsp;<span class="op" id="7029104">*</span><span class="ident" id="7029105">Reply</span><span class="op" id="7029110">)</span>&nbsp;<span class="builtintype" id="7029112">error</span>&nbsp;<span class="op" id="7029118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7029121">return</span>&nbsp;<span class="builtintype" id="7029128">nil</span><br>
<span class="lineno"></span><span class="op" id="7029132">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span><span class="keyword" id="7029135">func</span>&nbsp;<span class="op" id="7029140">(</span><span class="ident" id="7029141">t</span>&nbsp;<span class="op" id="7029143">*</span><span class="ident" id="7029144">ReplyNotPublic</span><span class="op" id="7029158">)</span>&nbsp;<span class="ident" id="7029160">ReplyNotPublic</span><span class="op" id="7029174">(</span><span class="ident" id="7029175">args</span>&nbsp;<span class="op" id="7029180">*</span><span class="ident" id="7029181">Args</span><span class="op" id="7029185">,</span>&nbsp;<span class="ident" id="7029187">reply</span>&nbsp;<span class="op" id="7029193">*</span><span class="ident" id="7029194">local</span><span class="op" id="7029199">)</span>&nbsp;<span class="builtintype" id="7029201">error</span>&nbsp;<span class="op" id="7029207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7029210">return</span>&nbsp;<span class="builtintype" id="7029217">nil</span><br>
<span class="lineno"></span><span class="op" id="7029221">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7029224">func</span>&nbsp;<span class="op" id="7029229">(</span><span class="ident" id="7029230">t</span>&nbsp;<span class="op" id="7029232">*</span><span class="ident" id="7029233">NeedsPtrType</span><span class="op" id="7029245">)</span>&nbsp;<span class="ident" id="7029247">NeedsPtrType</span><span class="op" id="7029259">(</span><span class="ident" id="7029260">args</span>&nbsp;<span class="op" id="7029265">*</span><span class="ident" id="7029266">Args</span><span class="op" id="7029270">,</span>&nbsp;<span class="ident" id="7029272">reply</span>&nbsp;<span class="op" id="7029278">*</span><span class="ident" id="7029279">Reply</span><span class="op" id="7029284">)</span>&nbsp;<span class="builtintype" id="7029286">error</span>&nbsp;<span class="op" id="7029292">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7029295">return</span>&nbsp;<span class="builtintype" id="7029302">nil</span><br>
<span class="lineno"></span><span class="op" id="7029306">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7029309">//&nbsp;Check&nbsp;that&nbsp;registration&nbsp;handles&nbsp;lots&nbsp;of&nbsp;bad&nbsp;methods&nbsp;and&nbsp;a&nbsp;type&nbsp;with&nbsp;no&nbsp;suitable&nbsp;methods.</span><br>
<span class="lineno"></span><span class="keyword" id="7029401">func</span>&nbsp;<span class="ident" id="7029406">TestRegistrationError</span><span class="op" id="7029427">(</span><span class="ident" id="7029428">t</span>&nbsp;<span class="op" id="7029430">*</span><span class="ident" id="7029431">testing</span><span class="op" id="7029438">.</span><span class="ident" id="7029439">T</span><span class="op" id="7029440">)</span>&nbsp;<span class="op" id="7029442">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7029445">err</span>&nbsp;<span class="op" id="7029449">:=</span>&nbsp;<span class="ident" id="7029452">Register</span><span class="op" id="7029460">(</span><span class="builtinfunc" id="7029461">new</span><span class="op" id="7029464">(</span><span class="ident" id="7029465">ReplyNotPointer</span><span class="op" id="7029480">)</span><span class="op" id="7029481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7029484">if</span>&nbsp;<span class="ident" id="7029487">err</span>&nbsp;<span class="op" id="7029491">==</span>&nbsp;<span class="builtintype" id="7029494">nil</span>&nbsp;<span class="op" id="7029498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7029502">t</span><span class="op" id="7029503">.</span><span class="ident" id="7029504">Error</span><span class="op" id="7029509">(</span><span class="string" id="7029510">&#34;expected&nbsp;error&nbsp;registering&nbsp;ReplyNotPointer&#34;</span><span class="op" id="7029554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7029557">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7029560">err</span>&nbsp;<span class="op" id="7029564">=</span>&nbsp;<span class="ident" id="7029566">Register</span><span class="op" id="7029574">(</span><span class="builtinfunc" id="7029575">new</span><span class="op" id="7029578">(</span><span class="ident" id="7029579">ArgNotPublic</span><span class="op" id="7029591">)</span><span class="op" id="7029592">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7029595">if</span>&nbsp;<span class="ident" id="7029598">err</span>&nbsp;<span class="op" id="7029602">==</span>&nbsp;<span class="builtintype" id="7029605">nil</span>&nbsp;<span class="op" id="7029609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7029613">t</span><span class="op" id="7029614">.</span><span class="ident" id="7029615">Error</span><span class="op" id="7029620">(</span><span class="string" id="7029621">&#34;expected&nbsp;error&nbsp;registering&nbsp;ArgNotPublic&#34;</span><span class="op" id="7029662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7029665">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7029668">err</span>&nbsp;<span class="op" id="7029672">=</span>&nbsp;<span class="ident" id="7029674">Register</span><span class="op" id="7029682">(</span><span class="builtinfunc" id="7029683">new</span><span class="op" id="7029686">(</span><span class="ident" id="7029687">ReplyNotPublic</span><span class="op" id="7029701">)</span><span class="op" id="7029702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7029705">if</span>&nbsp;<span class="ident" id="7029708">err</span>&nbsp;<span class="op" id="7029712">==</span>&nbsp;<span class="builtintype" id="7029715">nil</span>&nbsp;<span class="op" id="7029719">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7029723">t</span><span class="op" id="7029724">.</span><span class="ident" id="7029725">Error</span><span class="op" id="7029730">(</span><span class="string" id="7029731">&#34;expected&nbsp;error&nbsp;registering&nbsp;ReplyNotPublic&#34;</span><span class="op" id="7029774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7029777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7029780">err</span>&nbsp;<span class="op" id="7029784">=</span>&nbsp;<span class="ident" id="7029786">Register</span><span class="op" id="7029794">(</span><span class="ident" id="7029795">NeedsPtrType</span><span class="op" id="7029807">(</span><span class="num" id="7029808">0</span><span class="op" id="7029809">)</span><span class="op" id="7029810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7029813">if</span>&nbsp;<span class="ident" id="7029816">err</span>&nbsp;<span class="op" id="7029820">==</span>&nbsp;<span class="builtintype" id="7029823">nil</span>&nbsp;<span class="op" id="7029827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7029831">t</span><span class="op" id="7029832">.</span><span class="ident" id="7029833">Error</span><span class="op" id="7029838">(</span><span class="string" id="7029839">&#34;expected&nbsp;error&nbsp;registering&nbsp;NeedsPtrType&#34;</span><span class="op" id="7029880">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7029883">}</span>&nbsp;<span class="keyword" id="7029885">else</span>&nbsp;<span class="keyword" id="7029890">if</span>&nbsp;<span class="op" id="7029893">!</span><span class="ident" id="7029894">strings</span><span class="op" id="7029901">.</span><span class="ident" id="7029902">Contains</span><span class="op" id="7029910">(</span><span class="ident" id="7029911">err</span><span class="op" id="7029914">.</span><span class="ident" id="7029915">Error</span><span class="op" id="7029920">(</span><span class="op" id="7029921">)</span><span class="op" id="7029922">,</span>&nbsp;<span class="string" id="7029924">&#34;pointer&#34;</span><span class="op" id="7029933">)</span>&nbsp;<span class="op" id="7029935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7029939">t</span><span class="op" id="7029940">.</span><span class="ident" id="7029941">Error</span><span class="op" id="7029946">(</span><span class="string" id="7029947">&#34;expected&nbsp;hint&nbsp;when&nbsp;registering&nbsp;NeedsPtrType&#34;</span><span class="op" id="7029992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7029995">}</span><br>
<span class="lineno"></span><span class="op" id="7029997">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span><span class="keyword" id="7030000">type</span>&nbsp;<span class="ident" id="7030005">WriteFailCodec</span>&nbsp;<span class="builtintype" id="7030020">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7030025">func</span>&nbsp;<span class="op" id="7030030">(</span><span class="ident" id="7030031">WriteFailCodec</span><span class="op" id="7030045">)</span>&nbsp;<span class="ident" id="7030047">WriteRequest</span><span class="op" id="7030059">(</span><span class="op" id="7030060">*</span><span class="ident" id="7030061">Request</span><span class="op" id="7030068">,</span>&nbsp;<span class="keyword" id="7030070">interface</span><span class="op" id="7030079">{</span><span class="op" id="7030080">}</span><span class="op" id="7030081">)</span>&nbsp;<span class="builtintype" id="7030083">error</span>&nbsp;<span class="op" id="7030089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7030092">//&nbsp;the&nbsp;panic&nbsp;caused&nbsp;by&nbsp;this&nbsp;error&nbsp;used&nbsp;to&nbsp;not&nbsp;unlock&nbsp;a&nbsp;lock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7030154">return</span>&nbsp;<span class="ident" id="7030161">errors</span><span class="op" id="7030167">.</span><span class="ident" id="7030168">New</span><span class="op" id="7030171">(</span><span class="string" id="7030172">&#34;fail&#34;</span><span class="op" id="7030178">)</span><br>
<span class="lineno">435</span><span class="op" id="7030180">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7030183">func</span>&nbsp;<span class="op" id="7030188">(</span><span class="ident" id="7030189">WriteFailCodec</span><span class="op" id="7030203">)</span>&nbsp;<span class="ident" id="7030205">ReadResponseHeader</span><span class="op" id="7030223">(</span><span class="op" id="7030224">*</span><span class="ident" id="7030225">Response</span><span class="op" id="7030233">)</span>&nbsp;<span class="builtintype" id="7030235">error</span>&nbsp;<span class="op" id="7030241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7030244">select</span>&nbsp;<span class="op" id="7030251">{</span><span class="op" id="7030252">}</span><br>
<span class="lineno"></span><span class="op" id="7030254">}</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span><span class="keyword" id="7030257">func</span>&nbsp;<span class="op" id="7030262">(</span><span class="ident" id="7030263">WriteFailCodec</span><span class="op" id="7030277">)</span>&nbsp;<span class="ident" id="7030279">ReadResponseBody</span><span class="op" id="7030295">(</span><span class="keyword" id="7030296">interface</span><span class="op" id="7030305">{</span><span class="op" id="7030306">}</span><span class="op" id="7030307">)</span>&nbsp;<span class="builtintype" id="7030309">error</span>&nbsp;<span class="op" id="7030315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7030318">select</span>&nbsp;<span class="op" id="7030325">{</span><span class="op" id="7030326">}</span><br>
<span class="lineno"></span><span class="op" id="7030328">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">445</span><span class="keyword" id="7030331">func</span>&nbsp;<span class="op" id="7030336">(</span><span class="ident" id="7030337">WriteFailCodec</span><span class="op" id="7030351">)</span>&nbsp;<span class="ident" id="7030353">Close</span><span class="op" id="7030358">(</span><span class="op" id="7030359">)</span>&nbsp;<span class="builtintype" id="7030361">error</span>&nbsp;<span class="op" id="7030367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7030370">return</span>&nbsp;<span class="builtintype" id="7030377">nil</span><br>
<span class="lineno"></span><span class="op" id="7030381">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7030384">func</span>&nbsp;<span class="ident" id="7030389">TestSendDeadlock</span><span class="op" id="7030405">(</span><span class="ident" id="7030406">t</span>&nbsp;<span class="op" id="7030408">*</span><span class="ident" id="7030409">testing</span><span class="op" id="7030416">.</span><span class="ident" id="7030417">T</span><span class="op" id="7030418">)</span>&nbsp;<span class="op" id="7030420">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7030423">client</span>&nbsp;<span class="op" id="7030430">:=</span>&nbsp;<span class="ident" id="7030433">NewClientWithCodec</span><span class="op" id="7030451">(</span><span class="ident" id="7030452">WriteFailCodec</span><span class="op" id="7030466">(</span><span class="num" id="7030467">0</span><span class="op" id="7030468">)</span><span class="op" id="7030469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7030472">defer</span>&nbsp;<span class="ident" id="7030478">client</span><span class="op" id="7030484">.</span><span class="ident" id="7030485">Close</span><span class="op" id="7030490">(</span><span class="op" id="7030491">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7030495">done</span>&nbsp;<span class="op" id="7030500">:=</span>&nbsp;<span class="builtinfunc" id="7030503">make</span><span class="op" id="7030507">(</span><span class="keyword" id="7030508">chan</span>&nbsp;<span class="builtintype" id="7030513">bool</span><span class="op" id="7030517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7030520">go</span>&nbsp;<span class="keyword" id="7030523">func</span><span class="op" id="7030527">(</span><span class="op" id="7030528">)</span>&nbsp;<span class="op" id="7030530">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7030534">testSendDeadlock</span><span class="op" id="7030550">(</span><span class="ident" id="7030551">client</span><span class="op" id="7030557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7030561">testSendDeadlock</span><span class="op" id="7030577">(</span><span class="ident" id="7030578">client</span><span class="op" id="7030584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7030588">done</span>&nbsp;<span class="op" id="7030593">&lt;-</span>&nbsp;<span class="builtintype" id="7030596">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7030602">}</span><span class="op" id="7030603">(</span><span class="op" id="7030604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7030607">select</span>&nbsp;<span class="op" id="7030614">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7030617">case</span>&nbsp;<span class="op" id="7030622">&lt;-</span><span class="ident" id="7030624">done</span><span class="op" id="7030628">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7030632">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7030640">case</span>&nbsp;<span class="op" id="7030645">&lt;-</span><span class="ident" id="7030647">time</span><span class="op" id="7030651">.</span><span class="ident" id="7030652">After</span><span class="op" id="7030657">(</span><span class="num" id="7030658">5</span>&nbsp;<span class="op" id="7030660">*</span>&nbsp;<span class="ident" id="7030662">time</span><span class="op" id="7030666">.</span><span class="ident" id="7030667">Second</span><span class="op" id="7030673">)</span><span class="op" id="7030674">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7030678">t</span><span class="op" id="7030679">.</span><span class="ident" id="7030680">Fatal</span><span class="op" id="7030685">(</span><span class="string" id="7030686">&#34;deadlock&#34;</span><span class="op" id="7030696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7030699">}</span><br>
<span class="lineno">465</span><span class="op" id="7030701">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7030704">func</span>&nbsp;<span class="ident" id="7030709">testSendDeadlock</span><span class="op" id="7030725">(</span><span class="ident" id="7030726">client</span>&nbsp;<span class="op" id="7030733">*</span><span class="ident" id="7030734">Client</span><span class="op" id="7030740">)</span>&nbsp;<span class="op" id="7030742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7030745">defer</span>&nbsp;<span class="keyword" id="7030751">func</span><span class="op" id="7030755">(</span><span class="op" id="7030756">)</span>&nbsp;<span class="op" id="7030758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7030762">recover</span><span class="op" id="7030769">(</span><span class="op" id="7030770">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7030773">}</span><span class="op" id="7030774">(</span><span class="op" id="7030775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7030778">args</span>&nbsp;<span class="op" id="7030783">:=</span>&nbsp;<span class="op" id="7030786">&amp;</span><span class="ident" id="7030787">Args</span><span class="op" id="7030791">{</span><span class="num" id="7030792">7</span><span class="op" id="7030793">,</span>&nbsp;<span class="num" id="7030795">8</span><span class="op" id="7030796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7030799">reply</span>&nbsp;<span class="op" id="7030805">:=</span>&nbsp;<span class="builtinfunc" id="7030808">new</span><span class="op" id="7030811">(</span><span class="ident" id="7030812">Reply</span><span class="op" id="7030817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7030820">client</span><span class="op" id="7030826">.</span><span class="ident" id="7030827">Call</span><span class="op" id="7030831">(</span><span class="string" id="7030832">&#34;Arith.Add&#34;</span><span class="op" id="7030843">,</span>&nbsp;<span class="ident" id="7030845">args</span><span class="op" id="7030849">,</span>&nbsp;<span class="ident" id="7030851">reply</span><span class="op" id="7030856">)</span><br>
<span class="lineno"></span><span class="op" id="7030858">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="keyword" id="7030861">func</span>&nbsp;<span class="ident" id="7030866">dialDirect</span><span class="op" id="7030876">(</span><span class="op" id="7030877">)</span>&nbsp;<span class="op" id="7030879">(</span><span class="op" id="7030880">*</span><span class="ident" id="7030881">Client</span><span class="op" id="7030887">,</span>&nbsp;<span class="builtintype" id="7030889">error</span><span class="op" id="7030894">)</span>&nbsp;<span class="op" id="7030896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7030899">return</span>&nbsp;<span class="ident" id="7030906">Dial</span><span class="op" id="7030910">(</span><span class="string" id="7030911">&#34;tcp&#34;</span><span class="op" id="7030916">,</span>&nbsp;<span class="ident" id="7030918">serverAddr</span><span class="op" id="7030928">)</span><br>
<span class="lineno"></span><span class="op" id="7030930">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">480</span><span class="keyword" id="7030933">func</span>&nbsp;<span class="ident" id="7030938">dialHTTP</span><span class="op" id="7030946">(</span><span class="op" id="7030947">)</span>&nbsp;<span class="op" id="7030949">(</span><span class="op" id="7030950">*</span><span class="ident" id="7030951">Client</span><span class="op" id="7030957">,</span>&nbsp;<span class="builtintype" id="7030959">error</span><span class="op" id="7030964">)</span>&nbsp;<span class="op" id="7030966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7030969">return</span>&nbsp;<span class="ident" id="7030976">DialHTTP</span><span class="op" id="7030984">(</span><span class="string" id="7030985">&#34;tcp&#34;</span><span class="op" id="7030990">,</span>&nbsp;<span class="ident" id="7030992">httpServerAddr</span><span class="op" id="7031006">)</span><br>
<span class="lineno"></span><span class="op" id="7031008">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7031011">func</span>&nbsp;<span class="ident" id="7031016">countMallocs</span><span class="op" id="7031028">(</span><span class="ident" id="7031029">dial</span>&nbsp;<span class="keyword" id="7031034">func</span><span class="op" id="7031038">(</span><span class="op" id="7031039">)</span>&nbsp;<span class="op" id="7031041">(</span><span class="op" id="7031042">*</span><span class="ident" id="7031043">Client</span><span class="op" id="7031049">,</span>&nbsp;<span class="builtintype" id="7031051">error</span><span class="op" id="7031056">)</span><span class="op" id="7031057">,</span>&nbsp;<span class="ident" id="7031059">t</span>&nbsp;<span class="op" id="7031061">*</span><span class="ident" id="7031062">testing</span><span class="op" id="7031069">.</span><span class="ident" id="7031070">T</span><span class="op" id="7031071">)</span>&nbsp;<span class="builtintype" id="7031073">float64</span>&nbsp;<span class="op" id="7031081">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7031084">once</span><span class="op" id="7031088">.</span><span class="ident" id="7031089">Do</span><span class="op" id="7031091">(</span><span class="ident" id="7031092">startServer</span><span class="op" id="7031103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7031106">client</span><span class="op" id="7031112">,</span>&nbsp;<span class="ident" id="7031114">err</span>&nbsp;<span class="op" id="7031118">:=</span>&nbsp;<span class="ident" id="7031121">dial</span><span class="op" id="7031125">(</span><span class="op" id="7031126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7031129">if</span>&nbsp;<span class="ident" id="7031132">err</span>&nbsp;<span class="op" id="7031136">!=</span>&nbsp;<span class="builtintype" id="7031139">nil</span>&nbsp;<span class="op" id="7031143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7031147">t</span><span class="op" id="7031148">.</span><span class="ident" id="7031149">Fatal</span><span class="op" id="7031154">(</span><span class="string" id="7031155">&#34;error&nbsp;dialing&#34;</span><span class="op" id="7031170">,</span>&nbsp;<span class="ident" id="7031172">err</span><span class="op" id="7031175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7031178">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7031181">defer</span>&nbsp;<span class="ident" id="7031187">client</span><span class="op" id="7031193">.</span><span class="ident" id="7031194">Close</span><span class="op" id="7031199">(</span><span class="op" id="7031200">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7031204">args</span>&nbsp;<span class="op" id="7031209">:=</span>&nbsp;<span class="op" id="7031212">&amp;</span><span class="ident" id="7031213">Args</span><span class="op" id="7031217">{</span><span class="num" id="7031218">7</span><span class="op" id="7031219">,</span>&nbsp;<span class="num" id="7031221">8</span><span class="op" id="7031222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7031225">reply</span>&nbsp;<span class="op" id="7031231">:=</span>&nbsp;<span class="builtinfunc" id="7031234">new</span><span class="op" id="7031237">(</span><span class="ident" id="7031238">Reply</span><span class="op" id="7031243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7031246">return</span>&nbsp;<span class="ident" id="7031253">testing</span><span class="op" id="7031260">.</span><span class="ident" id="7031261">AllocsPerRun</span><span class="op" id="7031273">(</span><span class="num" id="7031274">100</span><span class="op" id="7031277">,</span>&nbsp;<span class="keyword" id="7031279">func</span><span class="op" id="7031283">(</span><span class="op" id="7031284">)</span>&nbsp;<span class="op" id="7031286">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7031290">err</span>&nbsp;<span class="op" id="7031294">:=</span>&nbsp;<span class="ident" id="7031297">client</span><span class="op" id="7031303">.</span><span class="ident" id="7031304">Call</span><span class="op" id="7031308">(</span><span class="string" id="7031309">&#34;Arith.Add&#34;</span><span class="op" id="7031320">,</span>&nbsp;<span class="ident" id="7031322">args</span><span class="op" id="7031326">,</span>&nbsp;<span class="ident" id="7031328">reply</span><span class="op" id="7031333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7031337">if</span>&nbsp;<span class="ident" id="7031340">err</span>&nbsp;<span class="op" id="7031344">!=</span>&nbsp;<span class="builtintype" id="7031347">nil</span>&nbsp;<span class="op" id="7031351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7031356">t</span><span class="op" id="7031357">.</span><span class="ident" id="7031358">Errorf</span><span class="op" id="7031364">(</span><span class="string" id="7031365">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7031407">,</span>&nbsp;<span class="ident" id="7031409">err</span><span class="op" id="7031412">.</span><span class="ident" id="7031413">Error</span><span class="op" id="7031418">(</span><span class="op" id="7031419">)</span><span class="op" id="7031420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7031424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7031428">if</span>&nbsp;<span class="ident" id="7031431">reply</span><span class="op" id="7031436">.</span><span class="ident" id="7031437">C</span>&nbsp;<span class="op" id="7031439">!=</span>&nbsp;<span class="ident" id="7031442">args</span><span class="op" id="7031446">.</span><span class="ident" id="7031447">A</span><span class="op" id="7031448">+</span><span class="ident" id="7031449">args</span><span class="op" id="7031453">.</span><span class="ident" id="7031454">B</span>&nbsp;<span class="op" id="7031456">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7031461">t</span><span class="op" id="7031462">.</span><span class="ident" id="7031463">Errorf</span><span class="op" id="7031469">(</span><span class="string" id="7031470">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7031495">,</span>&nbsp;<span class="ident" id="7031497">reply</span><span class="op" id="7031502">.</span><span class="ident" id="7031503">C</span><span class="op" id="7031504">,</span>&nbsp;<span class="ident" id="7031506">args</span><span class="op" id="7031510">.</span><span class="ident" id="7031511">A</span><span class="op" id="7031512">+</span><span class="ident" id="7031513">args</span><span class="op" id="7031517">.</span><span class="ident" id="7031518">B</span><span class="op" id="7031519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7031523">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7031526">}</span><span class="op" id="7031527">)</span><br>
<span class="lineno"></span><span class="op" id="7031529">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">505</span><span class="keyword" id="7031532">func</span>&nbsp;<span class="ident" id="7031537">TestCountMallocs</span><span class="op" id="7031553">(</span><span class="ident" id="7031554">t</span>&nbsp;<span class="op" id="7031556">*</span><span class="ident" id="7031557">testing</span><span class="op" id="7031564">.</span><span class="ident" id="7031565">T</span><span class="op" id="7031566">)</span>&nbsp;<span class="op" id="7031568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7031571">if</span>&nbsp;<span class="ident" id="7031574">testing</span><span class="op" id="7031581">.</span><span class="ident" id="7031582">Short</span><span class="op" id="7031587">(</span><span class="op" id="7031588">)</span>&nbsp;<span class="op" id="7031590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7031594">t</span><span class="op" id="7031595">.</span><span class="ident" id="7031596">Skip</span><span class="op" id="7031600">(</span><span class="string" id="7031601">&#34;skipping&nbsp;malloc&nbsp;count&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="7031638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7031641">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7031644">if</span>&nbsp;<span class="ident" id="7031647">runtime</span><span class="op" id="7031654">.</span><span class="ident" id="7031655">GOMAXPROCS</span><span class="op" id="7031665">(</span><span class="num" id="7031666">0</span><span class="op" id="7031667">)</span>&nbsp;<span class="op" id="7031669">&gt;</span>&nbsp;<span class="num" id="7031671">1</span>&nbsp;<span class="op" id="7031673">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7031677">t</span><span class="op" id="7031678">.</span><span class="ident" id="7031679">Skip</span><span class="op" id="7031683">(</span><span class="string" id="7031684">&#34;skipping;&nbsp;GOMAXPROCS&gt;1&#34;</span><span class="op" id="7031708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7031711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7031714">fmt</span><span class="op" id="7031717">.</span><span class="ident" id="7031718">Printf</span><span class="op" id="7031724">(</span><span class="string" id="7031725">&#34;mallocs&nbsp;per&nbsp;rpc&nbsp;round&nbsp;trip:&nbsp;%v\n&#34;</span><span class="op" id="7031759">,</span>&nbsp;<span class="ident" id="7031761">countMallocs</span><span class="op" id="7031773">(</span><span class="ident" id="7031774">dialDirect</span><span class="op" id="7031784">,</span>&nbsp;<span class="ident" id="7031786">t</span><span class="op" id="7031787">)</span><span class="op" id="7031788">)</span><br>
<span class="lineno"></span><span class="op" id="7031790">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span><span class="keyword" id="7031793">func</span>&nbsp;<span class="ident" id="7031798">TestCountMallocsOverHTTP</span><span class="op" id="7031822">(</span><span class="ident" id="7031823">t</span>&nbsp;<span class="op" id="7031825">*</span><span class="ident" id="7031826">testing</span><span class="op" id="7031833">.</span><span class="ident" id="7031834">T</span><span class="op" id="7031835">)</span>&nbsp;<span class="op" id="7031837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7031840">if</span>&nbsp;<span class="ident" id="7031843">testing</span><span class="op" id="7031850">.</span><span class="ident" id="7031851">Short</span><span class="op" id="7031856">(</span><span class="op" id="7031857">)</span>&nbsp;<span class="op" id="7031859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7031863">t</span><span class="op" id="7031864">.</span><span class="ident" id="7031865">Skip</span><span class="op" id="7031869">(</span><span class="string" id="7031870">&#34;skipping&nbsp;malloc&nbsp;count&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="7031907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7031910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7031913">if</span>&nbsp;<span class="ident" id="7031916">runtime</span><span class="op" id="7031923">.</span><span class="ident" id="7031924">GOMAXPROCS</span><span class="op" id="7031934">(</span><span class="num" id="7031935">0</span><span class="op" id="7031936">)</span>&nbsp;<span class="op" id="7031938">&gt;</span>&nbsp;<span class="num" id="7031940">1</span>&nbsp;<span class="op" id="7031942">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7031946">t</span><span class="op" id="7031947">.</span><span class="ident" id="7031948">Skip</span><span class="op" id="7031952">(</span><span class="string" id="7031953">&#34;skipping;&nbsp;GOMAXPROCS&gt;1&#34;</span><span class="op" id="7031977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7031980">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7031983">fmt</span><span class="op" id="7031986">.</span><span class="ident" id="7031987">Printf</span><span class="op" id="7031993">(</span><span class="string" id="7031994">&#34;mallocs&nbsp;per&nbsp;HTTP&nbsp;rpc&nbsp;round&nbsp;trip:&nbsp;%v\n&#34;</span><span class="op" id="7032033">,</span>&nbsp;<span class="ident" id="7032035">countMallocs</span><span class="op" id="7032047">(</span><span class="ident" id="7032048">dialHTTP</span><span class="op" id="7032056">,</span>&nbsp;<span class="ident" id="7032058">t</span><span class="op" id="7032059">)</span><span class="op" id="7032060">)</span><br>
<span class="lineno"></span><span class="op" id="7032062">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span><span class="keyword" id="7032065">type</span>&nbsp;<span class="ident" id="7032070">writeCrasher</span>&nbsp;<span class="keyword" id="7032083">struct</span>&nbsp;<span class="op" id="7032090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7032093">done</span>&nbsp;<span class="keyword" id="7032098">chan</span>&nbsp;<span class="builtintype" id="7032103">bool</span><br>
<span class="lineno"></span><span class="op" id="7032108">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7032111">func</span>&nbsp;<span class="op" id="7032116">(</span><span class="ident" id="7032117">writeCrasher</span><span class="op" id="7032129">)</span>&nbsp;<span class="ident" id="7032131">Close</span><span class="op" id="7032136">(</span><span class="op" id="7032137">)</span>&nbsp;<span class="builtintype" id="7032139">error</span>&nbsp;<span class="op" id="7032145">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7032148">return</span>&nbsp;<span class="builtintype" id="7032155">nil</span><br>
<span class="lineno"></span><span class="op" id="7032159">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7032162">func</span>&nbsp;<span class="op" id="7032167">(</span><span class="ident" id="7032168">w</span>&nbsp;<span class="op" id="7032170">*</span><span class="ident" id="7032171">writeCrasher</span><span class="op" id="7032183">)</span>&nbsp;<span class="ident" id="7032185">Read</span><span class="op" id="7032189">(</span><span class="ident" id="7032190">p</span>&nbsp;<span class="op" id="7032192">[</span><span class="op" id="7032193">]</span><span class="builtintype" id="7032194">byte</span><span class="op" id="7032198">)</span>&nbsp;<span class="op" id="7032200">(</span><span class="builtintype" id="7032201">int</span><span class="op" id="7032204">,</span>&nbsp;<span class="builtintype" id="7032206">error</span><span class="op" id="7032211">)</span>&nbsp;<span class="op" id="7032213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7032216">&lt;-</span><span class="ident" id="7032218">w</span><span class="op" id="7032219">.</span><span class="ident" id="7032220">done</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7032226">return</span>&nbsp;<span class="num" id="7032233">0</span><span class="op" id="7032234">,</span>&nbsp;<span class="ident" id="7032236">io</span><span class="op" id="7032238">.</span><span class="ident" id="7032239">EOF</span><br>
<span class="lineno"></span><span class="op" id="7032243">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7032246">func</span>&nbsp;<span class="op" id="7032251">(</span><span class="ident" id="7032252">writeCrasher</span><span class="op" id="7032264">)</span>&nbsp;<span class="ident" id="7032266">Write</span><span class="op" id="7032271">(</span><span class="ident" id="7032272">p</span>&nbsp;<span class="op" id="7032274">[</span><span class="op" id="7032275">]</span><span class="builtintype" id="7032276">byte</span><span class="op" id="7032280">)</span>&nbsp;<span class="op" id="7032282">(</span><span class="builtintype" id="7032283">int</span><span class="op" id="7032286">,</span>&nbsp;<span class="builtintype" id="7032288">error</span><span class="op" id="7032293">)</span>&nbsp;<span class="op" id="7032295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7032298">return</span>&nbsp;<span class="num" id="7032305">0</span><span class="op" id="7032306">,</span>&nbsp;<span class="ident" id="7032308">errors</span><span class="op" id="7032314">.</span><span class="ident" id="7032315">New</span><span class="op" id="7032318">(</span><span class="string" id="7032319">&#34;fake&nbsp;write&nbsp;failure&#34;</span><span class="op" id="7032339">)</span><br>
<span class="lineno">540</span><span class="op" id="7032341">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7032344">func</span>&nbsp;<span class="ident" id="7032349">TestClientWriteError</span><span class="op" id="7032369">(</span><span class="ident" id="7032370">t</span>&nbsp;<span class="op" id="7032372">*</span><span class="ident" id="7032373">testing</span><span class="op" id="7032380">.</span><span class="ident" id="7032381">T</span><span class="op" id="7032382">)</span>&nbsp;<span class="op" id="7032384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7032387">w</span>&nbsp;<span class="op" id="7032389">:=</span>&nbsp;<span class="op" id="7032392">&amp;</span><span class="ident" id="7032393">writeCrasher</span><span class="op" id="7032405">{</span><span class="ident" id="7032406">done</span><span class="op" id="7032410">:</span>&nbsp;<span class="builtinfunc" id="7032412">make</span><span class="op" id="7032416">(</span><span class="keyword" id="7032417">chan</span>&nbsp;<span class="builtintype" id="7032422">bool</span><span class="op" id="7032426">)</span><span class="op" id="7032427">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7032430">c</span>&nbsp;<span class="op" id="7032432">:=</span>&nbsp;<span class="ident" id="7032435">NewClient</span><span class="op" id="7032444">(</span><span class="ident" id="7032445">w</span><span class="op" id="7032446">)</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7032449">defer</span>&nbsp;<span class="ident" id="7032455">c</span><span class="op" id="7032456">.</span><span class="ident" id="7032457">Close</span><span class="op" id="7032462">(</span><span class="op" id="7032463">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7032467">res</span>&nbsp;<span class="op" id="7032471">:=</span>&nbsp;<span class="builtintype" id="7032474">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7032481">err</span>&nbsp;<span class="op" id="7032485">:=</span>&nbsp;<span class="ident" id="7032488">c</span><span class="op" id="7032489">.</span><span class="ident" id="7032490">Call</span><span class="op" id="7032494">(</span><span class="string" id="7032495">&#34;foo&#34;</span><span class="op" id="7032500">,</span>&nbsp;<span class="num" id="7032502">1</span><span class="op" id="7032503">,</span>&nbsp;<span class="op" id="7032505">&amp;</span><span class="ident" id="7032506">res</span><span class="op" id="7032509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7032512">if</span>&nbsp;<span class="ident" id="7032515">err</span>&nbsp;<span class="op" id="7032519">==</span>&nbsp;<span class="builtintype" id="7032522">nil</span>&nbsp;<span class="op" id="7032526">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7032530">t</span><span class="op" id="7032531">.</span><span class="ident" id="7032532">Fatal</span><span class="op" id="7032537">(</span><span class="string" id="7032538">&#34;expected&nbsp;error&#34;</span><span class="op" id="7032554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7032557">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7032560">if</span>&nbsp;<span class="ident" id="7032563">err</span><span class="op" id="7032566">.</span><span class="ident" id="7032567">Error</span><span class="op" id="7032572">(</span><span class="op" id="7032573">)</span>&nbsp;<span class="op" id="7032575">!=</span>&nbsp;<span class="string" id="7032578">&#34;fake&nbsp;write&nbsp;failure&#34;</span>&nbsp;<span class="op" id="7032599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7032603">t</span><span class="op" id="7032604">.</span><span class="ident" id="7032605">Error</span><span class="op" id="7032610">(</span><span class="string" id="7032611">&#34;unexpected&nbsp;value&nbsp;of&nbsp;error:&#34;</span><span class="op" id="7032639">,</span>&nbsp;<span class="ident" id="7032641">err</span><span class="op" id="7032644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7032647">}</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7032650">w</span><span class="op" id="7032651">.</span><span class="ident" id="7032652">done</span>&nbsp;<span class="op" id="7032657">&lt;-</span>&nbsp;<span class="builtintype" id="7032660">true</span><br>
<span class="lineno"></span><span class="op" id="7032665">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7032668">func</span>&nbsp;<span class="ident" id="7032673">TestTCPClose</span><span class="op" id="7032685">(</span><span class="ident" id="7032686">t</span>&nbsp;<span class="op" id="7032688">*</span><span class="ident" id="7032689">testing</span><span class="op" id="7032696">.</span><span class="ident" id="7032697">T</span><span class="op" id="7032698">)</span>&nbsp;<span class="op" id="7032700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7032703">once</span><span class="op" id="7032707">.</span><span class="ident" id="7032708">Do</span><span class="op" id="7032710">(</span><span class="ident" id="7032711">startServer</span><span class="op" id="7032722">)</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7032726">client</span><span class="op" id="7032732">,</span>&nbsp;<span class="ident" id="7032734">err</span>&nbsp;<span class="op" id="7032738">:=</span>&nbsp;<span class="ident" id="7032741">dialHTTP</span><span class="op" id="7032749">(</span><span class="op" id="7032750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7032753">if</span>&nbsp;<span class="ident" id="7032756">err</span>&nbsp;<span class="op" id="7032760">!=</span>&nbsp;<span class="builtintype" id="7032763">nil</span>&nbsp;<span class="op" id="7032767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7032771">t</span><span class="op" id="7032772">.</span><span class="ident" id="7032773">Fatalf</span><span class="op" id="7032779">(</span><span class="string" id="7032780">&#34;dialing:&nbsp;%v&#34;</span><span class="op" id="7032793">,</span>&nbsp;<span class="ident" id="7032795">err</span><span class="op" id="7032798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7032801">}</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7032804">defer</span>&nbsp;<span class="ident" id="7032810">client</span><span class="op" id="7032816">.</span><span class="ident" id="7032817">Close</span><span class="op" id="7032822">(</span><span class="op" id="7032823">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7032827">args</span>&nbsp;<span class="op" id="7032832">:=</span>&nbsp;<span class="ident" id="7032835">Args</span><span class="op" id="7032839">{</span><span class="num" id="7032840">17</span><span class="op" id="7032842">,</span>&nbsp;<span class="num" id="7032844">8</span><span class="op" id="7032845">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7032848">var</span>&nbsp;<span class="ident" id="7032852">reply</span>&nbsp;<span class="ident" id="7032858">Reply</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7032865">err</span>&nbsp;<span class="op" id="7032869">=</span>&nbsp;<span class="ident" id="7032871">client</span><span class="op" id="7032877">.</span><span class="ident" id="7032878">Call</span><span class="op" id="7032882">(</span><span class="string" id="7032883">&#34;Arith.Mul&#34;</span><span class="op" id="7032894">,</span>&nbsp;<span class="ident" id="7032896">args</span><span class="op" id="7032900">,</span>&nbsp;<span class="op" id="7032902">&amp;</span><span class="ident" id="7032903">reply</span><span class="op" id="7032908">)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7032911">if</span>&nbsp;<span class="ident" id="7032914">err</span>&nbsp;<span class="op" id="7032918">!=</span>&nbsp;<span class="builtintype" id="7032921">nil</span>&nbsp;<span class="op" id="7032925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7032929">t</span><span class="op" id="7032930">.</span><span class="ident" id="7032931">Fatal</span><span class="op" id="7032936">(</span><span class="string" id="7032937">&#34;arith&nbsp;error:&#34;</span><span class="op" id="7032951">,</span>&nbsp;<span class="ident" id="7032953">err</span><span class="op" id="7032956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7032959">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7032962">t</span><span class="op" id="7032963">.</span><span class="ident" id="7032964">Logf</span><span class="op" id="7032968">(</span><span class="string" id="7032969">&#34;Arith:&nbsp;%d*%d=%d\n&#34;</span><span class="op" id="7032988">,</span>&nbsp;<span class="ident" id="7032990">args</span><span class="op" id="7032994">.</span><span class="ident" id="7032995">A</span><span class="op" id="7032996">,</span>&nbsp;<span class="ident" id="7032998">args</span><span class="op" id="7033002">.</span><span class="ident" id="7033003">B</span><span class="op" id="7033004">,</span>&nbsp;<span class="ident" id="7033006">reply</span><span class="op" id="7033011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7033014">if</span>&nbsp;<span class="ident" id="7033017">reply</span><span class="op" id="7033022">.</span><span class="ident" id="7033023">C</span>&nbsp;<span class="op" id="7033025">!=</span>&nbsp;<span class="ident" id="7033028">args</span><span class="op" id="7033032">.</span><span class="ident" id="7033033">A</span><span class="op" id="7033034">*</span><span class="ident" id="7033035">args</span><span class="op" id="7033039">.</span><span class="ident" id="7033040">B</span>&nbsp;<span class="op" id="7033042">{</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7033046">t</span><span class="op" id="7033047">.</span><span class="ident" id="7033048">Errorf</span><span class="op" id="7033054">(</span><span class="string" id="7033055">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7033080">,</span>&nbsp;<span class="ident" id="7033082">reply</span><span class="op" id="7033087">.</span><span class="ident" id="7033088">C</span><span class="op" id="7033089">,</span>&nbsp;<span class="ident" id="7033091">args</span><span class="op" id="7033095">.</span><span class="ident" id="7033096">A</span><span class="op" id="7033097">*</span><span class="ident" id="7033098">args</span><span class="op" id="7033102">.</span><span class="ident" id="7033103">B</span><span class="op" id="7033104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7033107">}</span><br>
<span class="lineno"></span><span class="op" id="7033109">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7033112">func</span>&nbsp;<span class="ident" id="7033117">TestErrorAfterClientClose</span><span class="op" id="7033142">(</span><span class="ident" id="7033143">t</span>&nbsp;<span class="op" id="7033145">*</span><span class="ident" id="7033146">testing</span><span class="op" id="7033153">.</span><span class="ident" id="7033154">T</span><span class="op" id="7033155">)</span>&nbsp;<span class="op" id="7033157">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7033160">once</span><span class="op" id="7033164">.</span><span class="ident" id="7033165">Do</span><span class="op" id="7033167">(</span><span class="ident" id="7033168">startServer</span><span class="op" id="7033179">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7033183">client</span><span class="op" id="7033189">,</span>&nbsp;<span class="ident" id="7033191">err</span>&nbsp;<span class="op" id="7033195">:=</span>&nbsp;<span class="ident" id="7033198">dialHTTP</span><span class="op" id="7033206">(</span><span class="op" id="7033207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7033210">if</span>&nbsp;<span class="ident" id="7033213">err</span>&nbsp;<span class="op" id="7033217">!=</span>&nbsp;<span class="builtintype" id="7033220">nil</span>&nbsp;<span class="op" id="7033224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7033228">t</span><span class="op" id="7033229">.</span><span class="ident" id="7033230">Fatalf</span><span class="op" id="7033236">(</span><span class="string" id="7033237">&#34;dialing:&nbsp;%v&#34;</span><span class="op" id="7033250">,</span>&nbsp;<span class="ident" id="7033252">err</span><span class="op" id="7033255">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7033258">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7033261">err</span>&nbsp;<span class="op" id="7033265">=</span>&nbsp;<span class="ident" id="7033267">client</span><span class="op" id="7033273">.</span><span class="ident" id="7033274">Close</span><span class="op" id="7033279">(</span><span class="op" id="7033280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7033283">if</span>&nbsp;<span class="ident" id="7033286">err</span>&nbsp;<span class="op" id="7033290">!=</span>&nbsp;<span class="builtintype" id="7033293">nil</span>&nbsp;<span class="op" id="7033297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7033301">t</span><span class="op" id="7033302">.</span><span class="ident" id="7033303">Fatal</span><span class="op" id="7033308">(</span><span class="string" id="7033309">&#34;close&nbsp;error:&#34;</span><span class="op" id="7033323">,</span>&nbsp;<span class="ident" id="7033325">err</span><span class="op" id="7033328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7033331">}</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7033334">err</span>&nbsp;<span class="op" id="7033338">=</span>&nbsp;<span class="ident" id="7033340">client</span><span class="op" id="7033346">.</span><span class="ident" id="7033347">Call</span><span class="op" id="7033351">(</span><span class="string" id="7033352">&#34;Arith.Add&#34;</span><span class="op" id="7033363">,</span>&nbsp;<span class="op" id="7033365">&amp;</span><span class="ident" id="7033366">Args</span><span class="op" id="7033370">{</span><span class="num" id="7033371">7</span><span class="op" id="7033372">,</span>&nbsp;<span class="num" id="7033374">9</span><span class="op" id="7033375">}</span><span class="op" id="7033376">,</span>&nbsp;<span class="builtinfunc" id="7033378">new</span><span class="op" id="7033381">(</span><span class="ident" id="7033382">Reply</span><span class="op" id="7033387">)</span><span class="op" id="7033388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7033391">if</span>&nbsp;<span class="ident" id="7033394">err</span>&nbsp;<span class="op" id="7033398">!=</span>&nbsp;<span class="ident" id="7033401">ErrShutdown</span>&nbsp;<span class="op" id="7033413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7033417">t</span><span class="op" id="7033418">.</span><span class="ident" id="7033419">Errorf</span><span class="op" id="7033425">(</span><span class="string" id="7033426">&#34;Forever:&nbsp;expected&nbsp;ErrShutdown&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7033464">,</span>&nbsp;<span class="ident" id="7033466">err</span><span class="op" id="7033469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7033472">}</span><br>
<span class="lineno"></span><span class="op" id="7033474">}</span><br>
<span class="lineno">595</span><br>
<span class="lineno"></span><span class="keyword" id="7033477">func</span>&nbsp;<span class="ident" id="7033482">benchmarkEndToEnd</span><span class="op" id="7033499">(</span><span class="ident" id="7033500">dial</span>&nbsp;<span class="keyword" id="7033505">func</span><span class="op" id="7033509">(</span><span class="op" id="7033510">)</span>&nbsp;<span class="op" id="7033512">(</span><span class="op" id="7033513">*</span><span class="ident" id="7033514">Client</span><span class="op" id="7033520">,</span>&nbsp;<span class="builtintype" id="7033522">error</span><span class="op" id="7033527">)</span><span class="op" id="7033528">,</span>&nbsp;<span class="ident" id="7033530">b</span>&nbsp;<span class="op" id="7033532">*</span><span class="ident" id="7033533">testing</span><span class="op" id="7033540">.</span><span class="ident" id="7033541">B</span><span class="op" id="7033542">)</span>&nbsp;<span class="op" id="7033544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7033547">once</span><span class="op" id="7033551">.</span><span class="ident" id="7033552">Do</span><span class="op" id="7033554">(</span><span class="ident" id="7033555">startServer</span><span class="op" id="7033566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7033569">client</span><span class="op" id="7033575">,</span>&nbsp;<span class="ident" id="7033577">err</span>&nbsp;<span class="op" id="7033581">:=</span>&nbsp;<span class="ident" id="7033584">dial</span><span class="op" id="7033588">(</span><span class="op" id="7033589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7033592">if</span>&nbsp;<span class="ident" id="7033595">err</span>&nbsp;<span class="op" id="7033599">!=</span>&nbsp;<span class="builtintype" id="7033602">nil</span>&nbsp;<span class="op" id="7033606">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7033610">b</span><span class="op" id="7033611">.</span><span class="ident" id="7033612">Fatal</span><span class="op" id="7033617">(</span><span class="string" id="7033618">&#34;error&nbsp;dialing:&#34;</span><span class="op" id="7033634">,</span>&nbsp;<span class="ident" id="7033636">err</span><span class="op" id="7033639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7033642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7033645">defer</span>&nbsp;<span class="ident" id="7033651">client</span><span class="op" id="7033657">.</span><span class="ident" id="7033658">Close</span><span class="op" id="7033663">(</span><span class="op" id="7033664">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7033668">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7033690">args</span>&nbsp;<span class="op" id="7033695">:=</span>&nbsp;<span class="op" id="7033698">&amp;</span><span class="ident" id="7033699">Args</span><span class="op" id="7033703">{</span><span class="num" id="7033704">7</span><span class="op" id="7033705">,</span>&nbsp;<span class="num" id="7033707">8</span><span class="op" id="7033708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7033711">b</span><span class="op" id="7033712">.</span><span class="ident" id="7033713">ResetTimer</span><span class="op" id="7033723">(</span><span class="op" id="7033724">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7033728">b</span><span class="op" id="7033729">.</span><span class="ident" id="7033730">RunParallel</span><span class="op" id="7033741">(</span><span class="keyword" id="7033742">func</span><span class="op" id="7033746">(</span><span class="ident" id="7033747">pb</span>&nbsp;<span class="op" id="7033750">*</span><span class="ident" id="7033751">testing</span><span class="op" id="7033758">.</span><span class="ident" id="7033759">PB</span><span class="op" id="7033761">)</span>&nbsp;<span class="op" id="7033763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7033767">reply</span>&nbsp;<span class="op" id="7033773">:=</span>&nbsp;<span class="builtinfunc" id="7033776">new</span><span class="op" id="7033779">(</span><span class="ident" id="7033780">Reply</span><span class="op" id="7033785">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7033789">for</span>&nbsp;<span class="ident" id="7033793">pb</span><span class="op" id="7033795">.</span><span class="ident" id="7033796">Next</span><span class="op" id="7033800">(</span><span class="op" id="7033801">)</span>&nbsp;<span class="op" id="7033803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7033808">err</span>&nbsp;<span class="op" id="7033812">:=</span>&nbsp;<span class="ident" id="7033815">client</span><span class="op" id="7033821">.</span><span class="ident" id="7033822">Call</span><span class="op" id="7033826">(</span><span class="string" id="7033827">&#34;Arith.Add&#34;</span><span class="op" id="7033838">,</span>&nbsp;<span class="ident" id="7033840">args</span><span class="op" id="7033844">,</span>&nbsp;<span class="ident" id="7033846">reply</span><span class="op" id="7033851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7033856">if</span>&nbsp;<span class="ident" id="7033859">err</span>&nbsp;<span class="op" id="7033863">!=</span>&nbsp;<span class="builtintype" id="7033866">nil</span>&nbsp;<span class="op" id="7033870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7033876">b</span><span class="op" id="7033877">.</span><span class="ident" id="7033878">Fatalf</span><span class="op" id="7033884">(</span><span class="string" id="7033885">&#34;rpc&nbsp;error:&nbsp;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7033938">,</span>&nbsp;<span class="ident" id="7033940">err</span><span class="op" id="7033943">.</span><span class="ident" id="7033944">Error</span><span class="op" id="7033949">(</span><span class="op" id="7033950">)</span><span class="op" id="7033951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7033956">}</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7033961">if</span>&nbsp;<span class="ident" id="7033964">reply</span><span class="op" id="7033969">.</span><span class="ident" id="7033970">C</span>&nbsp;<span class="op" id="7033972">!=</span>&nbsp;<span class="ident" id="7033975">args</span><span class="op" id="7033979">.</span><span class="ident" id="7033980">A</span><span class="op" id="7033981">+</span><span class="ident" id="7033982">args</span><span class="op" id="7033986">.</span><span class="ident" id="7033987">B</span>&nbsp;<span class="op" id="7033989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7033995">b</span><span class="op" id="7033996">.</span><span class="ident" id="7033997">Fatalf</span><span class="op" id="7034003">(</span><span class="string" id="7034004">&#34;rpc&nbsp;error:&nbsp;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7034040">,</span>&nbsp;<span class="ident" id="7034042">reply</span><span class="op" id="7034047">.</span><span class="ident" id="7034048">C</span><span class="op" id="7034049">,</span>&nbsp;<span class="ident" id="7034051">args</span><span class="op" id="7034055">.</span><span class="ident" id="7034056">A</span><span class="op" id="7034057">+</span><span class="ident" id="7034058">args</span><span class="op" id="7034062">.</span><span class="ident" id="7034063">B</span><span class="op" id="7034064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7034069">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7034073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7034076">}</span><span class="op" id="7034077">)</span><br>
<span class="lineno">620</span><span class="op" id="7034079">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7034082">func</span>&nbsp;<span class="ident" id="7034087">benchmarkEndToEndAsync</span><span class="op" id="7034109">(</span><span class="ident" id="7034110">dial</span>&nbsp;<span class="keyword" id="7034115">func</span><span class="op" id="7034119">(</span><span class="op" id="7034120">)</span>&nbsp;<span class="op" id="7034122">(</span><span class="op" id="7034123">*</span><span class="ident" id="7034124">Client</span><span class="op" id="7034130">,</span>&nbsp;<span class="builtintype" id="7034132">error</span><span class="op" id="7034137">)</span><span class="op" id="7034138">,</span>&nbsp;<span class="ident" id="7034140">b</span>&nbsp;<span class="op" id="7034142">*</span><span class="ident" id="7034143">testing</span><span class="op" id="7034150">.</span><span class="ident" id="7034151">B</span><span class="op" id="7034152">)</span>&nbsp;<span class="op" id="7034154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7034157">const</span>&nbsp;<span class="ident" id="7034163">MaxConcurrentCalls</span>&nbsp;<span class="op" id="7034182">=</span>&nbsp;<span class="num" id="7034184">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7034189">once</span><span class="op" id="7034193">.</span><span class="ident" id="7034194">Do</span><span class="op" id="7034196">(</span><span class="ident" id="7034197">startServer</span><span class="op" id="7034208">)</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7034211">client</span><span class="op" id="7034217">,</span>&nbsp;<span class="ident" id="7034219">err</span>&nbsp;<span class="op" id="7034223">:=</span>&nbsp;<span class="ident" id="7034226">dial</span><span class="op" id="7034230">(</span><span class="op" id="7034231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7034234">if</span>&nbsp;<span class="ident" id="7034237">err</span>&nbsp;<span class="op" id="7034241">!=</span>&nbsp;<span class="builtintype" id="7034244">nil</span>&nbsp;<span class="op" id="7034248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7034252">b</span><span class="op" id="7034253">.</span><span class="ident" id="7034254">Fatal</span><span class="op" id="7034259">(</span><span class="string" id="7034260">&#34;error&nbsp;dialing:&#34;</span><span class="op" id="7034276">,</span>&nbsp;<span class="ident" id="7034278">err</span><span class="op" id="7034281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7034284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7034287">defer</span>&nbsp;<span class="ident" id="7034293">client</span><span class="op" id="7034299">.</span><span class="ident" id="7034300">Close</span><span class="op" id="7034305">(</span><span class="op" id="7034306">)</span><br>
<span class="lineno">630</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7034310">//&nbsp;Asynchronous&nbsp;calls</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7034333">args</span>&nbsp;<span class="op" id="7034338">:=</span>&nbsp;<span class="op" id="7034341">&amp;</span><span class="ident" id="7034342">Args</span><span class="op" id="7034346">{</span><span class="num" id="7034347">7</span><span class="op" id="7034348">,</span>&nbsp;<span class="num" id="7034350">8</span><span class="op" id="7034351">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7034354">procs</span>&nbsp;<span class="op" id="7034360">:=</span>&nbsp;<span class="num" id="7034363">4</span>&nbsp;<span class="op" id="7034365">*</span>&nbsp;<span class="ident" id="7034367">runtime</span><span class="op" id="7034374">.</span><span class="ident" id="7034375">GOMAXPROCS</span><span class="op" id="7034385">(</span><span class="op" id="7034386">-</span><span class="num" id="7034387">1</span><span class="op" id="7034388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7034391">send</span>&nbsp;<span class="op" id="7034396">:=</span>&nbsp;<span class="builtintype" id="7034399">int32</span><span class="op" id="7034404">(</span><span class="ident" id="7034405">b</span><span class="op" id="7034406">.</span><span class="ident" id="7034407">N</span><span class="op" id="7034408">)</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7034411">recv</span>&nbsp;<span class="op" id="7034416">:=</span>&nbsp;<span class="builtintype" id="7034419">int32</span><span class="op" id="7034424">(</span><span class="ident" id="7034425">b</span><span class="op" id="7034426">.</span><span class="ident" id="7034427">N</span><span class="op" id="7034428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7034431">var</span>&nbsp;<span class="ident" id="7034435">wg</span>&nbsp;<span class="ident" id="7034438">sync</span><span class="op" id="7034442">.</span><span class="ident" id="7034443">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7034454">wg</span><span class="op" id="7034456">.</span><span class="ident" id="7034457">Add</span><span class="op" id="7034460">(</span><span class="ident" id="7034461">procs</span><span class="op" id="7034466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7034469">gate</span>&nbsp;<span class="op" id="7034474">:=</span>&nbsp;<span class="builtinfunc" id="7034477">make</span><span class="op" id="7034481">(</span><span class="keyword" id="7034482">chan</span>&nbsp;<span class="builtintype" id="7034487">bool</span><span class="op" id="7034491">,</span>&nbsp;<span class="ident" id="7034493">MaxConcurrentCalls</span><span class="op" id="7034511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7034514">res</span>&nbsp;<span class="op" id="7034518">:=</span>&nbsp;<span class="builtinfunc" id="7034521">make</span><span class="op" id="7034525">(</span><span class="keyword" id="7034526">chan</span>&nbsp;<span class="op" id="7034531">*</span><span class="ident" id="7034532">Call</span><span class="op" id="7034536">,</span>&nbsp;<span class="ident" id="7034538">MaxConcurrentCalls</span><span class="op" id="7034556">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7034559">b</span><span class="op" id="7034560">.</span><span class="ident" id="7034561">ResetTimer</span><span class="op" id="7034571">(</span><span class="op" id="7034572">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7034576">for</span>&nbsp;<span class="ident" id="7034580">p</span>&nbsp;<span class="op" id="7034582">:=</span>&nbsp;<span class="num" id="7034585">0</span><span class="op" id="7034586">;</span>&nbsp;<span class="ident" id="7034588">p</span>&nbsp;<span class="op" id="7034590">&lt;</span>&nbsp;<span class="ident" id="7034592">procs</span><span class="op" id="7034597">;</span>&nbsp;<span class="ident" id="7034599">p</span><span class="op" id="7034600">++</span>&nbsp;<span class="op" id="7034603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7034607">go</span>&nbsp;<span class="keyword" id="7034610">func</span><span class="op" id="7034614">(</span><span class="op" id="7034615">)</span>&nbsp;<span class="op" id="7034617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7034622">for</span>&nbsp;<span class="ident" id="7034626">atomic</span><span class="op" id="7034632">.</span><span class="ident" id="7034633">AddInt32</span><span class="op" id="7034641">(</span><span class="op" id="7034642">&amp;</span><span class="ident" id="7034643">send</span><span class="op" id="7034647">,</span>&nbsp;<span class="op" id="7034649">-</span><span class="num" id="7034650">1</span><span class="op" id="7034651">)</span>&nbsp;<span class="op" id="7034653">&gt;=</span>&nbsp;<span class="num" id="7034656">0</span>&nbsp;<span class="op" id="7034658">{</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7034664">gate</span>&nbsp;<span class="op" id="7034669">&lt;-</span>&nbsp;<span class="builtintype" id="7034672">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7034681">reply</span>&nbsp;<span class="op" id="7034687">:=</span>&nbsp;<span class="builtinfunc" id="7034690">new</span><span class="op" id="7034693">(</span><span class="ident" id="7034694">Reply</span><span class="op" id="7034699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7034705">client</span><span class="op" id="7034711">.</span><span class="ident" id="7034712">Go</span><span class="op" id="7034714">(</span><span class="string" id="7034715">&#34;Arith.Add&#34;</span><span class="op" id="7034726">,</span>&nbsp;<span class="ident" id="7034728">args</span><span class="op" id="7034732">,</span>&nbsp;<span class="ident" id="7034734">reply</span><span class="op" id="7034739">,</span>&nbsp;<span class="ident" id="7034741">res</span><span class="op" id="7034744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7034749">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7034753">}</span><span class="op" id="7034754">(</span><span class="op" id="7034755">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7034759">go</span>&nbsp;<span class="keyword" id="7034762">func</span><span class="op" id="7034766">(</span><span class="op" id="7034767">)</span>&nbsp;<span class="op" id="7034769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7034774">for</span>&nbsp;<span class="ident" id="7034778">call</span>&nbsp;<span class="op" id="7034783">:=</span>&nbsp;<span class="keyword" id="7034786">range</span>&nbsp;<span class="ident" id="7034792">res</span>&nbsp;<span class="op" id="7034796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7034802">A</span>&nbsp;<span class="op" id="7034804">:=</span>&nbsp;<span class="ident" id="7034807">call</span><span class="op" id="7034811">.</span><span class="ident" id="7034812">Args</span><span class="op" id="7034816">.</span><span class="op" id="7034817">(</span><span class="op" id="7034818">*</span><span class="ident" id="7034819">Args</span><span class="op" id="7034823">)</span><span class="op" id="7034824">.</span><span class="ident" id="7034825">A</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7034831">B</span>&nbsp;<span class="op" id="7034833">:=</span>&nbsp;<span class="ident" id="7034836">call</span><span class="op" id="7034840">.</span><span class="ident" id="7034841">Args</span><span class="op" id="7034845">.</span><span class="op" id="7034846">(</span><span class="op" id="7034847">*</span><span class="ident" id="7034848">Args</span><span class="op" id="7034852">)</span><span class="op" id="7034853">.</span><span class="ident" id="7034854">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7034860">C</span>&nbsp;<span class="op" id="7034862">:=</span>&nbsp;<span class="ident" id="7034865">call</span><span class="op" id="7034869">.</span><span class="ident" id="7034870">Reply</span><span class="op" id="7034875">.</span><span class="op" id="7034876">(</span><span class="op" id="7034877">*</span><span class="ident" id="7034878">Reply</span><span class="op" id="7034883">)</span><span class="op" id="7034884">.</span><span class="ident" id="7034885">C</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7034891">if</span>&nbsp;<span class="ident" id="7034894">A</span><span class="op" id="7034895">+</span><span class="ident" id="7034896">B</span>&nbsp;<span class="op" id="7034898">!=</span>&nbsp;<span class="ident" id="7034901">C</span>&nbsp;<span class="op" id="7034903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7034910">b</span><span class="op" id="7034911">.</span><span class="ident" id="7034912">Fatalf</span><span class="op" id="7034918">(</span><span class="string" id="7034919">&#34;incorrect&nbsp;reply:&nbsp;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7034961">,</span>&nbsp;<span class="ident" id="7034963">A</span><span class="op" id="7034964">+</span><span class="ident" id="7034965">B</span><span class="op" id="7034966">,</span>&nbsp;<span class="ident" id="7034968">C</span><span class="op" id="7034969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7034975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7034981">&lt;-</span><span class="ident" id="7034983">gate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7034992">if</span>&nbsp;<span class="ident" id="7034995">atomic</span><span class="op" id="7035001">.</span><span class="ident" id="7035002">AddInt32</span><span class="op" id="7035010">(</span><span class="op" id="7035011">&amp;</span><span class="ident" id="7035012">recv</span><span class="op" id="7035016">,</span>&nbsp;<span class="op" id="7035018">-</span><span class="num" id="7035019">1</span><span class="op" id="7035020">)</span>&nbsp;<span class="op" id="7035022">==</span>&nbsp;<span class="num" id="7035025">0</span>&nbsp;<span class="op" id="7035027">{</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7035034">close</span><span class="op" id="7035039">(</span><span class="ident" id="7035040">res</span><span class="op" id="7035043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7035049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7035054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7035059">wg</span><span class="op" id="7035061">.</span><span class="ident" id="7035062">Done</span><span class="op" id="7035066">(</span><span class="op" id="7035067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7035071">}</span><span class="op" id="7035072">(</span><span class="op" id="7035073">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7035076">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7035079">wg</span><span class="op" id="7035081">.</span><span class="ident" id="7035082">Wait</span><span class="op" id="7035086">(</span><span class="op" id="7035087">)</span><br>
<span class="lineno"></span><span class="op" id="7035089">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7035092">func</span>&nbsp;<span class="ident" id="7035097">BenchmarkEndToEnd</span><span class="op" id="7035114">(</span><span class="ident" id="7035115">b</span>&nbsp;<span class="op" id="7035117">*</span><span class="ident" id="7035118">testing</span><span class="op" id="7035125">.</span><span class="ident" id="7035126">B</span><span class="op" id="7035127">)</span>&nbsp;<span class="op" id="7035129">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7035132">benchmarkEndToEnd</span><span class="op" id="7035149">(</span><span class="ident" id="7035150">dialDirect</span><span class="op" id="7035160">,</span>&nbsp;<span class="ident" id="7035162">b</span><span class="op" id="7035163">)</span><br>
<span class="lineno"></span><span class="op" id="7035165">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7035168">func</span>&nbsp;<span class="ident" id="7035173">BenchmarkEndToEndHTTP</span><span class="op" id="7035194">(</span><span class="ident" id="7035195">b</span>&nbsp;<span class="op" id="7035197">*</span><span class="ident" id="7035198">testing</span><span class="op" id="7035205">.</span><span class="ident" id="7035206">B</span><span class="op" id="7035207">)</span>&nbsp;<span class="op" id="7035209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7035212">benchmarkEndToEnd</span><span class="op" id="7035229">(</span><span class="ident" id="7035230">dialHTTP</span><span class="op" id="7035238">,</span>&nbsp;<span class="ident" id="7035240">b</span><span class="op" id="7035241">)</span><br>
<span class="lineno">675</span><span class="op" id="7035243">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7035246">func</span>&nbsp;<span class="ident" id="7035251">BenchmarkEndToEndAsync</span><span class="op" id="7035273">(</span><span class="ident" id="7035274">b</span>&nbsp;<span class="op" id="7035276">*</span><span class="ident" id="7035277">testing</span><span class="op" id="7035284">.</span><span class="ident" id="7035285">B</span><span class="op" id="7035286">)</span>&nbsp;<span class="op" id="7035288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7035291">benchmarkEndToEndAsync</span><span class="op" id="7035313">(</span><span class="ident" id="7035314">dialDirect</span><span class="op" id="7035324">,</span>&nbsp;<span class="ident" id="7035326">b</span><span class="op" id="7035327">)</span><br>
<span class="lineno"></span><span class="op" id="7035329">}</span><br>
<span class="lineno">680</span><br>
<span class="lineno"></span><span class="keyword" id="7035332">func</span>&nbsp;<span class="ident" id="7035337">BenchmarkEndToEndAsyncHTTP</span><span class="op" id="7035363">(</span><span class="ident" id="7035364">b</span>&nbsp;<span class="op" id="7035366">*</span><span class="ident" id="7035367">testing</span><span class="op" id="7035374">.</span><span class="ident" id="7035375">B</span><span class="op" id="7035376">)</span>&nbsp;<span class="op" id="7035378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7035381">benchmarkEndToEndAsync</span><span class="op" id="7035403">(</span><span class="ident" id="7035404">dialHTTP</span><span class="op" id="7035412">,</span>&nbsp;<span class="ident" id="7035414">b</span><span class="op" id="7035415">)</span><br>
<span class="lineno"></span><span class="op" id="7035417">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
