<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html" class="current">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6693948">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6694004">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6694058">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6694109">package</span>&nbsp;<span class="ident" id="6694117">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6694122">import</span>&nbsp;<span class="op" id="6694129">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6694132">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6694141">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6694148">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6694154">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6694165">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6694176">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6694187">&#34;time&#34;</span><br>
<span class="lineno">15</span><span class="op" id="6694194">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6694197">type</span>&nbsp;<span class="ident" id="6694202">resolveIPAddrTest</span>&nbsp;<span class="keyword" id="6694220">struct</span>&nbsp;<span class="op" id="6694227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6694230">net</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6694244">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6694252">litAddrOrName</span>&nbsp;<span class="builtintype" id="6694266">string</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6694274">addr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6694288">*</span><span class="ident" id="6694289">IPAddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6694297">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6694311">error</span><br>
<span class="lineno"></span><span class="op" id="6694317">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6694320">var</span>&nbsp;<span class="ident" id="6694324">resolveIPAddrTests</span>&nbsp;<span class="op" id="6694343">=</span>&nbsp;<span class="op" id="6694345">[</span><span class="op" id="6694346">]</span><span class="ident" id="6694347">resolveIPAddrTest</span><span class="op" id="6694364">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6694367">{</span><span class="string" id="6694368">&#34;ip&#34;</span><span class="op" id="6694372">,</span>&nbsp;<span class="string" id="6694374">&#34;127.0.0.1&#34;</span><span class="op" id="6694385">,</span>&nbsp;<span class="op" id="6694387">&amp;</span><span class="ident" id="6694388">IPAddr</span><span class="op" id="6694394">{</span><span class="ident" id="6694395">IP</span><span class="op" id="6694397">:</span>&nbsp;<span class="ident" id="6694399">IPv4</span><span class="op" id="6694403">(</span><span class="num" id="6694404">127</span><span class="op" id="6694407">,</span>&nbsp;<span class="num" id="6694409">0</span><span class="op" id="6694410">,</span>&nbsp;<span class="num" id="6694412">0</span><span class="op" id="6694413">,</span>&nbsp;<span class="num" id="6694415">1</span><span class="op" id="6694416">)</span><span class="op" id="6694417">}</span><span class="op" id="6694418">,</span>&nbsp;<span class="builtintype" id="6694420">nil</span><span class="op" id="6694423">}</span><span class="op" id="6694424">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6694427">{</span><span class="string" id="6694428">&#34;ip4&#34;</span><span class="op" id="6694433">,</span>&nbsp;<span class="string" id="6694435">&#34;127.0.0.1&#34;</span><span class="op" id="6694446">,</span>&nbsp;<span class="op" id="6694448">&amp;</span><span class="ident" id="6694449">IPAddr</span><span class="op" id="6694455">{</span><span class="ident" id="6694456">IP</span><span class="op" id="6694458">:</span>&nbsp;<span class="ident" id="6694460">IPv4</span><span class="op" id="6694464">(</span><span class="num" id="6694465">127</span><span class="op" id="6694468">,</span>&nbsp;<span class="num" id="6694470">0</span><span class="op" id="6694471">,</span>&nbsp;<span class="num" id="6694473">0</span><span class="op" id="6694474">,</span>&nbsp;<span class="num" id="6694476">1</span><span class="op" id="6694477">)</span><span class="op" id="6694478">}</span><span class="op" id="6694479">,</span>&nbsp;<span class="builtintype" id="6694481">nil</span><span class="op" id="6694484">}</span><span class="op" id="6694485">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6694488">{</span><span class="string" id="6694489">&#34;ip4:icmp&#34;</span><span class="op" id="6694499">,</span>&nbsp;<span class="string" id="6694501">&#34;127.0.0.1&#34;</span><span class="op" id="6694512">,</span>&nbsp;<span class="op" id="6694514">&amp;</span><span class="ident" id="6694515">IPAddr</span><span class="op" id="6694521">{</span><span class="ident" id="6694522">IP</span><span class="op" id="6694524">:</span>&nbsp;<span class="ident" id="6694526">IPv4</span><span class="op" id="6694530">(</span><span class="num" id="6694531">127</span><span class="op" id="6694534">,</span>&nbsp;<span class="num" id="6694536">0</span><span class="op" id="6694537">,</span>&nbsp;<span class="num" id="6694539">0</span><span class="op" id="6694540">,</span>&nbsp;<span class="num" id="6694542">1</span><span class="op" id="6694543">)</span><span class="op" id="6694544">}</span><span class="op" id="6694545">,</span>&nbsp;<span class="builtintype" id="6694547">nil</span><span class="op" id="6694550">}</span><span class="op" id="6694551">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6694555">{</span><span class="string" id="6694556">&#34;ip&#34;</span><span class="op" id="6694560">,</span>&nbsp;<span class="string" id="6694562">&#34;::1&#34;</span><span class="op" id="6694567">,</span>&nbsp;<span class="op" id="6694569">&amp;</span><span class="ident" id="6694570">IPAddr</span><span class="op" id="6694576">{</span><span class="ident" id="6694577">IP</span><span class="op" id="6694579">:</span>&nbsp;<span class="ident" id="6694581">ParseIP</span><span class="op" id="6694588">(</span><span class="string" id="6694589">&#34;::1&#34;</span><span class="op" id="6694594">)</span><span class="op" id="6694595">}</span><span class="op" id="6694596">,</span>&nbsp;<span class="builtintype" id="6694598">nil</span><span class="op" id="6694601">}</span><span class="op" id="6694602">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6694605">{</span><span class="string" id="6694606">&#34;ip6&#34;</span><span class="op" id="6694611">,</span>&nbsp;<span class="string" id="6694613">&#34;::1&#34;</span><span class="op" id="6694618">,</span>&nbsp;<span class="op" id="6694620">&amp;</span><span class="ident" id="6694621">IPAddr</span><span class="op" id="6694627">{</span><span class="ident" id="6694628">IP</span><span class="op" id="6694630">:</span>&nbsp;<span class="ident" id="6694632">ParseIP</span><span class="op" id="6694639">(</span><span class="string" id="6694640">&#34;::1&#34;</span><span class="op" id="6694645">)</span><span class="op" id="6694646">}</span><span class="op" id="6694647">,</span>&nbsp;<span class="builtintype" id="6694649">nil</span><span class="op" id="6694652">}</span><span class="op" id="6694653">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6694656">{</span><span class="string" id="6694657">&#34;ip6:ipv6-icmp&#34;</span><span class="op" id="6694672">,</span>&nbsp;<span class="string" id="6694674">&#34;::1&#34;</span><span class="op" id="6694679">,</span>&nbsp;<span class="op" id="6694681">&amp;</span><span class="ident" id="6694682">IPAddr</span><span class="op" id="6694688">{</span><span class="ident" id="6694689">IP</span><span class="op" id="6694691">:</span>&nbsp;<span class="ident" id="6694693">ParseIP</span><span class="op" id="6694700">(</span><span class="string" id="6694701">&#34;::1&#34;</span><span class="op" id="6694706">)</span><span class="op" id="6694707">}</span><span class="op" id="6694708">,</span>&nbsp;<span class="builtintype" id="6694710">nil</span><span class="op" id="6694713">}</span><span class="op" id="6694714">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6694717">{</span><span class="string" id="6694718">&#34;ip6:IPv6-ICMP&#34;</span><span class="op" id="6694733">,</span>&nbsp;<span class="string" id="6694735">&#34;::1&#34;</span><span class="op" id="6694740">,</span>&nbsp;<span class="op" id="6694742">&amp;</span><span class="ident" id="6694743">IPAddr</span><span class="op" id="6694749">{</span><span class="ident" id="6694750">IP</span><span class="op" id="6694752">:</span>&nbsp;<span class="ident" id="6694754">ParseIP</span><span class="op" id="6694761">(</span><span class="string" id="6694762">&#34;::1&#34;</span><span class="op" id="6694767">)</span><span class="op" id="6694768">}</span><span class="op" id="6694769">,</span>&nbsp;<span class="builtintype" id="6694771">nil</span><span class="op" id="6694774">}</span><span class="op" id="6694775">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6694779">{</span><span class="string" id="6694780">&#34;ip&#34;</span><span class="op" id="6694784">,</span>&nbsp;<span class="string" id="6694786">&#34;::1%en0&#34;</span><span class="op" id="6694795">,</span>&nbsp;<span class="op" id="6694797">&amp;</span><span class="ident" id="6694798">IPAddr</span><span class="op" id="6694804">{</span><span class="ident" id="6694805">IP</span><span class="op" id="6694807">:</span>&nbsp;<span class="ident" id="6694809">ParseIP</span><span class="op" id="6694816">(</span><span class="string" id="6694817">&#34;::1&#34;</span><span class="op" id="6694822">)</span><span class="op" id="6694823">,</span>&nbsp;<span class="ident" id="6694825">Zone</span><span class="op" id="6694829">:</span>&nbsp;<span class="string" id="6694831">&#34;en0&#34;</span><span class="op" id="6694836">}</span><span class="op" id="6694837">,</span>&nbsp;<span class="builtintype" id="6694839">nil</span><span class="op" id="6694842">}</span><span class="op" id="6694843">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6694846">{</span><span class="string" id="6694847">&#34;ip6&#34;</span><span class="op" id="6694852">,</span>&nbsp;<span class="string" id="6694854">&#34;::1%911&#34;</span><span class="op" id="6694863">,</span>&nbsp;<span class="op" id="6694865">&amp;</span><span class="ident" id="6694866">IPAddr</span><span class="op" id="6694872">{</span><span class="ident" id="6694873">IP</span><span class="op" id="6694875">:</span>&nbsp;<span class="ident" id="6694877">ParseIP</span><span class="op" id="6694884">(</span><span class="string" id="6694885">&#34;::1&#34;</span><span class="op" id="6694890">)</span><span class="op" id="6694891">,</span>&nbsp;<span class="ident" id="6694893">Zone</span><span class="op" id="6694897">:</span>&nbsp;<span class="string" id="6694899">&#34;911&#34;</span><span class="op" id="6694904">}</span><span class="op" id="6694905">,</span>&nbsp;<span class="builtintype" id="6694907">nil</span><span class="op" id="6694910">}</span><span class="op" id="6694911">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6694915">{</span><span class="string" id="6694916">&#34;&#34;</span><span class="op" id="6694918">,</span>&nbsp;<span class="string" id="6694920">&#34;127.0.0.1&#34;</span><span class="op" id="6694931">,</span>&nbsp;<span class="op" id="6694933">&amp;</span><span class="ident" id="6694934">IPAddr</span><span class="op" id="6694940">{</span><span class="ident" id="6694941">IP</span><span class="op" id="6694943">:</span>&nbsp;<span class="ident" id="6694945">IPv4</span><span class="op" id="6694949">(</span><span class="num" id="6694950">127</span><span class="op" id="6694953">,</span>&nbsp;<span class="num" id="6694955">0</span><span class="op" id="6694956">,</span>&nbsp;<span class="num" id="6694958">0</span><span class="op" id="6694959">,</span>&nbsp;<span class="num" id="6694961">1</span><span class="op" id="6694962">)</span><span class="op" id="6694963">}</span><span class="op" id="6694964">,</span>&nbsp;<span class="builtintype" id="6694966">nil</span><span class="op" id="6694969">}</span><span class="op" id="6694970">,</span>&nbsp;<span class="comment" id="6694972">//&nbsp;Go&nbsp;1.0&nbsp;behavior</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6694992">{</span><span class="string" id="6694993">&#34;&#34;</span><span class="op" id="6694995">,</span>&nbsp;<span class="string" id="6694997">&#34;::1&#34;</span><span class="op" id="6695002">,</span>&nbsp;<span class="op" id="6695004">&amp;</span><span class="ident" id="6695005">IPAddr</span><span class="op" id="6695011">{</span><span class="ident" id="6695012">IP</span><span class="op" id="6695014">:</span>&nbsp;<span class="ident" id="6695016">ParseIP</span><span class="op" id="6695023">(</span><span class="string" id="6695024">&#34;::1&#34;</span><span class="op" id="6695029">)</span><span class="op" id="6695030">}</span><span class="op" id="6695031">,</span>&nbsp;<span class="builtintype" id="6695033">nil</span><span class="op" id="6695036">}</span><span class="op" id="6695037">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6695049">//&nbsp;Go&nbsp;1.0&nbsp;behavior</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6695070">{</span><span class="string" id="6695071">&#34;l2tp&#34;</span><span class="op" id="6695077">,</span>&nbsp;<span class="string" id="6695079">&#34;127.0.0.1&#34;</span><span class="op" id="6695090">,</span>&nbsp;<span class="builtintype" id="6695092">nil</span><span class="op" id="6695095">,</span>&nbsp;<span class="ident" id="6695097">UnknownNetworkError</span><span class="op" id="6695116">(</span><span class="string" id="6695117">&#34;l2tp&#34;</span><span class="op" id="6695123">)</span><span class="op" id="6695124">}</span><span class="op" id="6695125">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6695128">{</span><span class="string" id="6695129">&#34;l2tp:gre&#34;</span><span class="op" id="6695139">,</span>&nbsp;<span class="string" id="6695141">&#34;127.0.0.1&#34;</span><span class="op" id="6695152">,</span>&nbsp;<span class="builtintype" id="6695154">nil</span><span class="op" id="6695157">,</span>&nbsp;<span class="ident" id="6695159">UnknownNetworkError</span><span class="op" id="6695178">(</span><span class="string" id="6695179">&#34;l2tp:gre&#34;</span><span class="op" id="6695189">)</span><span class="op" id="6695190">}</span><span class="op" id="6695191">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6695194">{</span><span class="string" id="6695195">&#34;tcp&#34;</span><span class="op" id="6695200">,</span>&nbsp;<span class="string" id="6695202">&#34;1.2.3.4:123&#34;</span><span class="op" id="6695215">,</span>&nbsp;<span class="builtintype" id="6695217">nil</span><span class="op" id="6695220">,</span>&nbsp;<span class="ident" id="6695222">UnknownNetworkError</span><span class="op" id="6695241">(</span><span class="string" id="6695242">&#34;tcp&#34;</span><span class="op" id="6695247">)</span><span class="op" id="6695248">}</span><span class="op" id="6695249">,</span><br>
<span class="lineno"></span><span class="op" id="6695251">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="6695254">func</span>&nbsp;<span class="ident" id="6695259">init</span><span class="op" id="6695263">(</span><span class="op" id="6695264">)</span>&nbsp;<span class="op" id="6695266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6695269">if</span>&nbsp;<span class="ident" id="6695272">ifi</span>&nbsp;<span class="op" id="6695276">:=</span>&nbsp;<span class="ident" id="6695279">loopbackInterface</span><span class="op" id="6695296">(</span><span class="op" id="6695297">)</span><span class="op" id="6695298">;</span>&nbsp;<span class="ident" id="6695300">ifi</span>&nbsp;<span class="op" id="6695304">!=</span>&nbsp;<span class="builtintype" id="6695307">nil</span>&nbsp;<span class="op" id="6695311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6695315">index</span>&nbsp;<span class="op" id="6695321">:=</span>&nbsp;<span class="ident" id="6695324">fmt</span><span class="op" id="6695327">.</span><span class="ident" id="6695328">Sprintf</span><span class="op" id="6695335">(</span><span class="string" id="6695336">&#34;%v&#34;</span><span class="op" id="6695340">,</span>&nbsp;<span class="ident" id="6695342">ifi</span><span class="op" id="6695345">.</span><span class="ident" id="6695346">Index</span><span class="op" id="6695351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6695355">resolveIPAddrTests</span>&nbsp;<span class="op" id="6695374">=</span>&nbsp;<span class="builtinfunc" id="6695376">append</span><span class="op" id="6695382">(</span><span class="ident" id="6695383">resolveIPAddrTests</span><span class="op" id="6695401">,</span>&nbsp;<span class="op" id="6695403">[</span><span class="op" id="6695404">]</span><span class="ident" id="6695405">resolveIPAddrTest</span><span class="op" id="6695422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6695427">{</span><span class="string" id="6695428">&#34;ip6&#34;</span><span class="op" id="6695433">,</span>&nbsp;<span class="string" id="6695435">&#34;fe80::1%&#34;</span>&nbsp;<span class="op" id="6695446">+</span>&nbsp;<span class="ident" id="6695448">ifi</span><span class="op" id="6695451">.</span><span class="ident" id="6695452">Name</span><span class="op" id="6695456">,</span>&nbsp;<span class="op" id="6695458">&amp;</span><span class="ident" id="6695459">IPAddr</span><span class="op" id="6695465">{</span><span class="ident" id="6695466">IP</span><span class="op" id="6695468">:</span>&nbsp;<span class="ident" id="6695470">ParseIP</span><span class="op" id="6695477">(</span><span class="string" id="6695478">&#34;fe80::1&#34;</span><span class="op" id="6695487">)</span><span class="op" id="6695488">,</span>&nbsp;<span class="ident" id="6695490">Zone</span><span class="op" id="6695494">:</span>&nbsp;<span class="ident" id="6695496">zoneToString</span><span class="op" id="6695508">(</span><span class="ident" id="6695509">ifi</span><span class="op" id="6695512">.</span><span class="ident" id="6695513">Index</span><span class="op" id="6695518">)</span><span class="op" id="6695519">}</span><span class="op" id="6695520">,</span>&nbsp;<span class="builtintype" id="6695522">nil</span><span class="op" id="6695525">}</span><span class="op" id="6695526">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6695531">{</span><span class="string" id="6695532">&#34;ip6&#34;</span><span class="op" id="6695537">,</span>&nbsp;<span class="string" id="6695539">&#34;fe80::1%&#34;</span>&nbsp;<span class="op" id="6695550">+</span>&nbsp;<span class="ident" id="6695552">index</span><span class="op" id="6695557">,</span>&nbsp;<span class="op" id="6695559">&amp;</span><span class="ident" id="6695560">IPAddr</span><span class="op" id="6695566">{</span><span class="ident" id="6695567">IP</span><span class="op" id="6695569">:</span>&nbsp;<span class="ident" id="6695571">ParseIP</span><span class="op" id="6695578">(</span><span class="string" id="6695579">&#34;fe80::1&#34;</span><span class="op" id="6695588">)</span><span class="op" id="6695589">,</span>&nbsp;<span class="ident" id="6695591">Zone</span><span class="op" id="6695595">:</span>&nbsp;<span class="ident" id="6695597">index</span><span class="op" id="6695602">}</span><span class="op" id="6695603">,</span>&nbsp;<span class="builtintype" id="6695605">nil</span><span class="op" id="6695608">}</span><span class="op" id="6695609">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6695613">}</span><span class="op" id="6695614">...</span><span class="op" id="6695617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6695620">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6695623">if</span>&nbsp;<span class="ident" id="6695626">ips</span><span class="op" id="6695629">,</span>&nbsp;<span class="ident" id="6695631">err</span>&nbsp;<span class="op" id="6695635">:=</span>&nbsp;<span class="ident" id="6695638">LookupIP</span><span class="op" id="6695646">(</span><span class="string" id="6695647">&#34;localhost&#34;</span><span class="op" id="6695658">)</span><span class="op" id="6695659">;</span>&nbsp;<span class="ident" id="6695661">err</span>&nbsp;<span class="op" id="6695665">==</span>&nbsp;<span class="builtintype" id="6695668">nil</span>&nbsp;<span class="op" id="6695672">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="6695675">len</span><span class="op" id="6695678">(</span><span class="ident" id="6695679">ips</span><span class="op" id="6695682">)</span>&nbsp;<span class="op" id="6695684">&gt;</span>&nbsp;<span class="num" id="6695686">1</span>&nbsp;<span class="op" id="6695688">&amp;&amp;</span>&nbsp;<span class="ident" id="6695691">supportsIPv4</span>&nbsp;<span class="op" id="6695704">&amp;&amp;</span>&nbsp;<span class="ident" id="6695707">supportsIPv6</span>&nbsp;<span class="op" id="6695720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6695724">resolveIPAddrTests</span>&nbsp;<span class="op" id="6695743">=</span>&nbsp;<span class="builtinfunc" id="6695745">append</span><span class="op" id="6695751">(</span><span class="ident" id="6695752">resolveIPAddrTests</span><span class="op" id="6695770">,</span>&nbsp;<span class="op" id="6695772">[</span><span class="op" id="6695773">]</span><span class="ident" id="6695774">resolveIPAddrTest</span><span class="op" id="6695791">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6695796">{</span><span class="string" id="6695797">&#34;ip&#34;</span><span class="op" id="6695801">,</span>&nbsp;<span class="string" id="6695803">&#34;localhost&#34;</span><span class="op" id="6695814">,</span>&nbsp;<span class="op" id="6695816">&amp;</span><span class="ident" id="6695817">IPAddr</span><span class="op" id="6695823">{</span><span class="ident" id="6695824">IP</span><span class="op" id="6695826">:</span>&nbsp;<span class="ident" id="6695828">IPv4</span><span class="op" id="6695832">(</span><span class="num" id="6695833">127</span><span class="op" id="6695836">,</span>&nbsp;<span class="num" id="6695838">0</span><span class="op" id="6695839">,</span>&nbsp;<span class="num" id="6695841">0</span><span class="op" id="6695842">,</span>&nbsp;<span class="num" id="6695844">1</span><span class="op" id="6695845">)</span><span class="op" id="6695846">}</span><span class="op" id="6695847">,</span>&nbsp;<span class="builtintype" id="6695849">nil</span><span class="op" id="6695852">}</span><span class="op" id="6695853">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6695858">{</span><span class="string" id="6695859">&#34;ip4&#34;</span><span class="op" id="6695864">,</span>&nbsp;<span class="string" id="6695866">&#34;localhost&#34;</span><span class="op" id="6695877">,</span>&nbsp;<span class="op" id="6695879">&amp;</span><span class="ident" id="6695880">IPAddr</span><span class="op" id="6695886">{</span><span class="ident" id="6695887">IP</span><span class="op" id="6695889">:</span>&nbsp;<span class="ident" id="6695891">IPv4</span><span class="op" id="6695895">(</span><span class="num" id="6695896">127</span><span class="op" id="6695899">,</span>&nbsp;<span class="num" id="6695901">0</span><span class="op" id="6695902">,</span>&nbsp;<span class="num" id="6695904">0</span><span class="op" id="6695905">,</span>&nbsp;<span class="num" id="6695907">1</span><span class="op" id="6695908">)</span><span class="op" id="6695909">}</span><span class="op" id="6695910">,</span>&nbsp;<span class="builtintype" id="6695912">nil</span><span class="op" id="6695915">}</span><span class="op" id="6695916">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6695921">{</span><span class="string" id="6695922">&#34;ip6&#34;</span><span class="op" id="6695927">,</span>&nbsp;<span class="string" id="6695929">&#34;localhost&#34;</span><span class="op" id="6695940">,</span>&nbsp;<span class="op" id="6695942">&amp;</span><span class="ident" id="6695943">IPAddr</span><span class="op" id="6695949">{</span><span class="ident" id="6695950">IP</span><span class="op" id="6695952">:</span>&nbsp;<span class="ident" id="6695954">IPv6loopback</span><span class="op" id="6695966">}</span><span class="op" id="6695967">,</span>&nbsp;<span class="builtintype" id="6695969">nil</span><span class="op" id="6695972">}</span><span class="op" id="6695973">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6695977">}</span><span class="op" id="6695978">...</span><span class="op" id="6695981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6695984">}</span><br>
<span class="lineno">60</span><span class="op" id="6695986">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6695989">func</span>&nbsp;<span class="ident" id="6695994">skipRawSocketTest</span><span class="op" id="6696011">(</span><span class="ident" id="6696012">t</span>&nbsp;<span class="op" id="6696014">*</span><span class="ident" id="6696015">testing</span><span class="op" id="6696022">.</span><span class="ident" id="6696023">T</span><span class="op" id="6696024">)</span>&nbsp;<span class="op" id="6696026">(</span><span class="ident" id="6696027">skip</span>&nbsp;<span class="builtintype" id="6696032">bool</span><span class="op" id="6696036">,</span>&nbsp;<span class="ident" id="6696038">skipmsg</span>&nbsp;<span class="builtintype" id="6696046">string</span><span class="op" id="6696052">)</span>&nbsp;<span class="op" id="6696054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6696057">skip</span><span class="op" id="6696061">,</span>&nbsp;<span class="ident" id="6696063">skipmsg</span><span class="op" id="6696070">,</span>&nbsp;<span class="ident" id="6696072">err</span>&nbsp;<span class="op" id="6696076">:=</span>&nbsp;<span class="ident" id="6696079">skipRawSocketTests</span><span class="op" id="6696097">(</span><span class="op" id="6696098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6696101">if</span>&nbsp;<span class="ident" id="6696104">err</span>&nbsp;<span class="op" id="6696108">!=</span>&nbsp;<span class="builtintype" id="6696111">nil</span>&nbsp;<span class="op" id="6696115">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6696119">t</span><span class="op" id="6696120">.</span><span class="ident" id="6696121">Fatal</span><span class="op" id="6696126">(</span><span class="ident" id="6696127">err</span><span class="op" id="6696130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6696133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6696136">return</span>&nbsp;<span class="ident" id="6696143">skip</span><span class="op" id="6696147">,</span>&nbsp;<span class="ident" id="6696149">skipmsg</span><br>
<span class="lineno"></span><span class="op" id="6696157">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="6696160">func</span>&nbsp;<span class="ident" id="6696165">TestResolveIPAddr</span><span class="op" id="6696182">(</span><span class="ident" id="6696183">t</span>&nbsp;<span class="op" id="6696185">*</span><span class="ident" id="6696186">testing</span><span class="op" id="6696193">.</span><span class="ident" id="6696194">T</span><span class="op" id="6696195">)</span>&nbsp;<span class="op" id="6696197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6696200">switch</span>&nbsp;<span class="ident" id="6696207">runtime</span><span class="op" id="6696214">.</span><span class="ident" id="6696215">GOOS</span>&nbsp;<span class="op" id="6696220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6696223">case</span>&nbsp;<span class="string" id="6696228">&#34;nacl&#34;</span><span class="op" id="6696234">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6696238">t</span><span class="op" id="6696239">.</span><span class="ident" id="6696240">Skipf</span><span class="op" id="6696245">(</span><span class="string" id="6696246">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6696267">,</span>&nbsp;<span class="ident" id="6696269">runtime</span><span class="op" id="6696276">.</span><span class="ident" id="6696277">GOOS</span><span class="op" id="6696281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6696284">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6696288">for</span>&nbsp;<span class="ident" id="6696292">_</span><span class="op" id="6696293">,</span>&nbsp;<span class="ident" id="6696295">tt</span>&nbsp;<span class="op" id="6696298">:=</span>&nbsp;<span class="keyword" id="6696301">range</span>&nbsp;<span class="ident" id="6696307">resolveIPAddrTests</span>&nbsp;<span class="op" id="6696326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6696330">addr</span><span class="op" id="6696334">,</span>&nbsp;<span class="ident" id="6696336">err</span>&nbsp;<span class="op" id="6696340">:=</span>&nbsp;<span class="ident" id="6696343">ResolveIPAddr</span><span class="op" id="6696356">(</span><span class="ident" id="6696357">tt</span><span class="op" id="6696359">.</span><span class="ident" id="6696360">net</span><span class="op" id="6696363">,</span>&nbsp;<span class="ident" id="6696365">tt</span><span class="op" id="6696367">.</span><span class="ident" id="6696368">litAddrOrName</span><span class="op" id="6696381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6696385">if</span>&nbsp;<span class="ident" id="6696388">err</span>&nbsp;<span class="op" id="6696392">!=</span>&nbsp;<span class="ident" id="6696395">tt</span><span class="op" id="6696397">.</span><span class="ident" id="6696398">err</span>&nbsp;<span class="op" id="6696402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6696407">t</span><span class="op" id="6696408">.</span><span class="ident" id="6696409">Fatalf</span><span class="op" id="6696415">(</span><span class="string" id="6696416">&#34;ResolveIPAddr(%v,&nbsp;%v)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6696450">,</span>&nbsp;<span class="ident" id="6696452">tt</span><span class="op" id="6696454">.</span><span class="ident" id="6696455">net</span><span class="op" id="6696458">,</span>&nbsp;<span class="ident" id="6696460">tt</span><span class="op" id="6696462">.</span><span class="ident" id="6696463">litAddrOrName</span><span class="op" id="6696476">,</span>&nbsp;<span class="ident" id="6696478">err</span><span class="op" id="6696481">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6696485">}</span>&nbsp;<span class="keyword" id="6696487">else</span>&nbsp;<span class="keyword" id="6696492">if</span>&nbsp;<span class="op" id="6696495">!</span><span class="ident" id="6696496">reflect</span><span class="op" id="6696503">.</span><span class="ident" id="6696504">DeepEqual</span><span class="op" id="6696513">(</span><span class="ident" id="6696514">addr</span><span class="op" id="6696518">,</span>&nbsp;<span class="ident" id="6696520">tt</span><span class="op" id="6696522">.</span><span class="ident" id="6696523">addr</span><span class="op" id="6696527">)</span>&nbsp;<span class="op" id="6696529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6696534">t</span><span class="op" id="6696535">.</span><span class="ident" id="6696536">Fatalf</span><span class="op" id="6696542">(</span><span class="string" id="6696543">&#34;got&nbsp;%#v;&nbsp;expected&nbsp;%#v&#34;</span><span class="op" id="6696566">,</span>&nbsp;<span class="ident" id="6696568">addr</span><span class="op" id="6696572">,</span>&nbsp;<span class="ident" id="6696574">tt</span><span class="op" id="6696576">.</span><span class="ident" id="6696577">addr</span><span class="op" id="6696581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6696585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6696588">}</span><br>
<span class="lineno"></span><span class="op" id="6696590">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="6696593">var</span>&nbsp;<span class="ident" id="6696597">icmpEchoTests</span>&nbsp;<span class="op" id="6696611">=</span>&nbsp;<span class="op" id="6696613">[</span><span class="op" id="6696614">]</span><span class="keyword" id="6696615">struct</span>&nbsp;<span class="op" id="6696622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6696625">net</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6696631">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6696639">laddr</span>&nbsp;<span class="builtintype" id="6696645">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6696653">raddr</span>&nbsp;<span class="builtintype" id="6696659">string</span><br>
<span class="lineno">90</span><span class="op" id="6696666">}</span><span class="op" id="6696667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6696670">{</span><span class="string" id="6696671">&#34;ip4:icmp&#34;</span><span class="op" id="6696681">,</span>&nbsp;<span class="string" id="6696683">&#34;0.0.0.0&#34;</span><span class="op" id="6696692">,</span>&nbsp;<span class="string" id="6696694">&#34;127.0.0.1&#34;</span><span class="op" id="6696705">}</span><span class="op" id="6696706">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6696709">{</span><span class="string" id="6696710">&#34;ip6:ipv6-icmp&#34;</span><span class="op" id="6696725">,</span>&nbsp;<span class="string" id="6696727">&#34;::&#34;</span><span class="op" id="6696731">,</span>&nbsp;<span class="string" id="6696733">&#34;::1&#34;</span><span class="op" id="6696738">}</span><span class="op" id="6696739">,</span><br>
<span class="lineno"></span><span class="op" id="6696741">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="6696744">func</span>&nbsp;<span class="ident" id="6696749">TestConnICMPEcho</span><span class="op" id="6696765">(</span><span class="ident" id="6696766">t</span>&nbsp;<span class="op" id="6696768">*</span><span class="ident" id="6696769">testing</span><span class="op" id="6696776">.</span><span class="ident" id="6696777">T</span><span class="op" id="6696778">)</span>&nbsp;<span class="op" id="6696780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6696783">if</span>&nbsp;<span class="ident" id="6696786">skip</span><span class="op" id="6696790">,</span>&nbsp;<span class="ident" id="6696792">skipmsg</span>&nbsp;<span class="op" id="6696800">:=</span>&nbsp;<span class="ident" id="6696803">skipRawSocketTest</span><span class="op" id="6696820">(</span><span class="ident" id="6696821">t</span><span class="op" id="6696822">)</span><span class="op" id="6696823">;</span>&nbsp;<span class="ident" id="6696825">skip</span>&nbsp;<span class="op" id="6696830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6696834">t</span><span class="op" id="6696835">.</span><span class="ident" id="6696836">Skip</span><span class="op" id="6696840">(</span><span class="ident" id="6696841">skipmsg</span><span class="op" id="6696848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6696851">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6696855">for</span>&nbsp;<span class="ident" id="6696859">i</span><span class="op" id="6696860">,</span>&nbsp;<span class="ident" id="6696862">tt</span>&nbsp;<span class="op" id="6696865">:=</span>&nbsp;<span class="keyword" id="6696868">range</span>&nbsp;<span class="ident" id="6696874">icmpEchoTests</span>&nbsp;<span class="op" id="6696888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6696892">net</span><span class="op" id="6696895">,</span>&nbsp;<span class="ident" id="6696897">_</span><span class="op" id="6696898">,</span>&nbsp;<span class="ident" id="6696900">err</span>&nbsp;<span class="op" id="6696904">:=</span>&nbsp;<span class="ident" id="6696907">parseNetwork</span><span class="op" id="6696919">(</span><span class="ident" id="6696920">tt</span><span class="op" id="6696922">.</span><span class="ident" id="6696923">net</span><span class="op" id="6696926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6696930">if</span>&nbsp;<span class="ident" id="6696933">err</span>&nbsp;<span class="op" id="6696937">!=</span>&nbsp;<span class="builtintype" id="6696940">nil</span>&nbsp;<span class="op" id="6696944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6696949">t</span><span class="op" id="6696950">.</span><span class="ident" id="6696951">Fatalf</span><span class="op" id="6696957">(</span><span class="string" id="6696958">&#34;parseNetwork&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6696983">,</span>&nbsp;<span class="ident" id="6696985">err</span><span class="op" id="6696988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6696992">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6696996">if</span>&nbsp;<span class="ident" id="6696999">net</span>&nbsp;<span class="op" id="6697003">==</span>&nbsp;<span class="string" id="6697006">&#34;ip6&#34;</span>&nbsp;<span class="op" id="6697012">&amp;&amp;</span>&nbsp;<span class="op" id="6697015">!</span><span class="ident" id="6697016">supportsIPv6</span>&nbsp;<span class="op" id="6697029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6697034">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6697045">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6697050">c</span><span class="op" id="6697051">,</span>&nbsp;<span class="ident" id="6697053">err</span>&nbsp;<span class="op" id="6697057">:=</span>&nbsp;<span class="ident" id="6697060">Dial</span><span class="op" id="6697064">(</span><span class="ident" id="6697065">tt</span><span class="op" id="6697067">.</span><span class="ident" id="6697068">net</span><span class="op" id="6697071">,</span>&nbsp;<span class="ident" id="6697073">tt</span><span class="op" id="6697075">.</span><span class="ident" id="6697076">raddr</span><span class="op" id="6697081">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6697085">if</span>&nbsp;<span class="ident" id="6697088">err</span>&nbsp;<span class="op" id="6697092">!=</span>&nbsp;<span class="builtintype" id="6697095">nil</span>&nbsp;<span class="op" id="6697099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6697104">t</span><span class="op" id="6697105">.</span><span class="ident" id="6697106">Fatalf</span><span class="op" id="6697112">(</span><span class="string" id="6697113">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6697130">,</span>&nbsp;<span class="ident" id="6697132">err</span><span class="op" id="6697135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6697139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6697143">c</span><span class="op" id="6697144">.</span><span class="ident" id="6697145">SetDeadline</span><span class="op" id="6697156">(</span><span class="ident" id="6697157">time</span><span class="op" id="6697161">.</span><span class="ident" id="6697162">Now</span><span class="op" id="6697165">(</span><span class="op" id="6697166">)</span><span class="op" id="6697167">.</span><span class="ident" id="6697168">Add</span><span class="op" id="6697171">(</span><span class="num" id="6697172">100</span>&nbsp;<span class="op" id="6697176">*</span>&nbsp;<span class="ident" id="6697178">time</span><span class="op" id="6697182">.</span><span class="ident" id="6697183">Millisecond</span><span class="op" id="6697194">)</span><span class="op" id="6697195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6697199">defer</span>&nbsp;<span class="ident" id="6697205">c</span><span class="op" id="6697206">.</span><span class="ident" id="6697207">Close</span><span class="op" id="6697212">(</span><span class="op" id="6697213">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6697218">typ</span>&nbsp;<span class="op" id="6697222">:=</span>&nbsp;<span class="ident" id="6697225">icmpv4EchoRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6697245">if</span>&nbsp;<span class="ident" id="6697248">net</span>&nbsp;<span class="op" id="6697252">==</span>&nbsp;<span class="string" id="6697255">&#34;ip6&#34;</span>&nbsp;<span class="op" id="6697261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6697266">typ</span>&nbsp;<span class="op" id="6697270">=</span>&nbsp;<span class="ident" id="6697272">icmpv6EchoRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6697292">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6697296">xid</span><span class="op" id="6697299">,</span>&nbsp;<span class="ident" id="6697301">xseq</span>&nbsp;<span class="op" id="6697306">:=</span>&nbsp;<span class="ident" id="6697309">os</span><span class="op" id="6697311">.</span><span class="ident" id="6697312">Getpid</span><span class="op" id="6697318">(</span><span class="op" id="6697319">)</span><span class="op" id="6697320">&amp;</span><span class="num" id="6697321">0xffff</span><span class="op" id="6697327">,</span>&nbsp;<span class="ident" id="6697329">i</span><span class="op" id="6697330">+</span><span class="num" id="6697331">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6697335">wb</span><span class="op" id="6697337">,</span>&nbsp;<span class="ident" id="6697339">err</span>&nbsp;<span class="op" id="6697343">:=</span>&nbsp;<span class="op" id="6697346">(</span><span class="op" id="6697347">&amp;</span><span class="ident" id="6697348">icmpMessage</span><span class="op" id="6697359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6697364">Type</span><span class="op" id="6697368">:</span>&nbsp;<span class="ident" id="6697370">typ</span><span class="op" id="6697373">,</span>&nbsp;<span class="ident" id="6697375">Code</span><span class="op" id="6697379">:</span>&nbsp;<span class="num" id="6697381">0</span><span class="op" id="6697382">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6697387">Body</span><span class="op" id="6697391">:</span>&nbsp;<span class="op" id="6697393">&amp;</span><span class="ident" id="6697394">icmpEcho</span><span class="op" id="6697402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6697408">ID</span><span class="op" id="6697410">:</span>&nbsp;<span class="ident" id="6697412">xid</span><span class="op" id="6697415">,</span>&nbsp;<span class="ident" id="6697417">Seq</span><span class="op" id="6697420">:</span>&nbsp;<span class="ident" id="6697422">xseq</span><span class="op" id="6697426">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6697432">Data</span><span class="op" id="6697436">:</span>&nbsp;<span class="ident" id="6697438">bytes</span><span class="op" id="6697443">.</span><span class="ident" id="6697444">Repeat</span><span class="op" id="6697450">(</span><span class="op" id="6697451">[</span><span class="op" id="6697452">]</span><span class="builtintype" id="6697453">byte</span><span class="op" id="6697457">(</span><span class="string" id="6697458">&#34;Go&nbsp;Go&nbsp;Gadget&nbsp;Ping!!!&#34;</span><span class="op" id="6697480">)</span><span class="op" id="6697481">,</span>&nbsp;<span class="num" id="6697483">3</span><span class="op" id="6697484">)</span><span class="op" id="6697485">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6697490">}</span><span class="op" id="6697491">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6697495">}</span><span class="op" id="6697496">)</span><span class="op" id="6697497">.</span><span class="ident" id="6697498">Marshal</span><span class="op" id="6697505">(</span><span class="op" id="6697506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6697510">if</span>&nbsp;<span class="ident" id="6697513">err</span>&nbsp;<span class="op" id="6697517">!=</span>&nbsp;<span class="builtintype" id="6697520">nil</span>&nbsp;<span class="op" id="6697524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6697529">t</span><span class="op" id="6697530">.</span><span class="ident" id="6697531">Fatalf</span><span class="op" id="6697537">(</span><span class="string" id="6697538">&#34;icmpMessage.Marshal&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6697570">,</span>&nbsp;<span class="ident" id="6697572">err</span><span class="op" id="6697575">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6697579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6697583">if</span>&nbsp;<span class="ident" id="6697586">_</span><span class="op" id="6697587">,</span>&nbsp;<span class="ident" id="6697589">err</span>&nbsp;<span class="op" id="6697593">:=</span>&nbsp;<span class="ident" id="6697596">c</span><span class="op" id="6697597">.</span><span class="ident" id="6697598">Write</span><span class="op" id="6697603">(</span><span class="ident" id="6697604">wb</span><span class="op" id="6697606">)</span><span class="op" id="6697607">;</span>&nbsp;<span class="ident" id="6697609">err</span>&nbsp;<span class="op" id="6697613">!=</span>&nbsp;<span class="builtintype" id="6697616">nil</span>&nbsp;<span class="op" id="6697620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6697625">t</span><span class="op" id="6697626">.</span><span class="ident" id="6697627">Fatalf</span><span class="op" id="6697633">(</span><span class="string" id="6697634">&#34;Conn.Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6697657">,</span>&nbsp;<span class="ident" id="6697659">err</span><span class="op" id="6697662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6697666">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6697670">var</span>&nbsp;<span class="ident" id="6697674">m</span>&nbsp;<span class="op" id="6697676">*</span><span class="ident" id="6697677">icmpMessage</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6697691">rb</span>&nbsp;<span class="op" id="6697694">:=</span>&nbsp;<span class="builtinfunc" id="6697697">make</span><span class="op" id="6697701">(</span><span class="op" id="6697702">[</span><span class="op" id="6697703">]</span><span class="builtintype" id="6697704">byte</span><span class="op" id="6697708">,</span>&nbsp;<span class="num" id="6697710">20</span><span class="op" id="6697712">+</span><span class="builtinfunc" id="6697713">len</span><span class="op" id="6697716">(</span><span class="ident" id="6697717">wb</span><span class="op" id="6697719">)</span><span class="op" id="6697720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6697724">for</span>&nbsp;<span class="op" id="6697728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6697733">if</span>&nbsp;<span class="ident" id="6697736">_</span><span class="op" id="6697737">,</span>&nbsp;<span class="ident" id="6697739">err</span>&nbsp;<span class="op" id="6697743">:=</span>&nbsp;<span class="ident" id="6697746">c</span><span class="op" id="6697747">.</span><span class="ident" id="6697748">Read</span><span class="op" id="6697752">(</span><span class="ident" id="6697753">rb</span><span class="op" id="6697755">)</span><span class="op" id="6697756">;</span>&nbsp;<span class="ident" id="6697758">err</span>&nbsp;<span class="op" id="6697762">!=</span>&nbsp;<span class="builtintype" id="6697765">nil</span>&nbsp;<span class="op" id="6697769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6697775">t</span><span class="op" id="6697776">.</span><span class="ident" id="6697777">Fatalf</span><span class="op" id="6697783">(</span><span class="string" id="6697784">&#34;Conn.Read&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6697806">,</span>&nbsp;<span class="ident" id="6697808">err</span><span class="op" id="6697811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6697816">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6697821">if</span>&nbsp;<span class="ident" id="6697824">net</span>&nbsp;<span class="op" id="6697828">==</span>&nbsp;<span class="string" id="6697831">&#34;ip4&#34;</span>&nbsp;<span class="op" id="6697837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6697843">rb</span>&nbsp;<span class="op" id="6697846">=</span>&nbsp;<span class="ident" id="6697848">ipv4Payload</span><span class="op" id="6697859">(</span><span class="ident" id="6697860">rb</span><span class="op" id="6697862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6697867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6697872">if</span>&nbsp;<span class="ident" id="6697875">m</span><span class="op" id="6697876">,</span>&nbsp;<span class="ident" id="6697878">err</span>&nbsp;<span class="op" id="6697882">=</span>&nbsp;<span class="ident" id="6697884">parseICMPMessage</span><span class="op" id="6697900">(</span><span class="ident" id="6697901">rb</span><span class="op" id="6697903">)</span><span class="op" id="6697904">;</span>&nbsp;<span class="ident" id="6697906">err</span>&nbsp;<span class="op" id="6697910">!=</span>&nbsp;<span class="builtintype" id="6697913">nil</span>&nbsp;<span class="op" id="6697917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6697923">t</span><span class="op" id="6697924">.</span><span class="ident" id="6697925">Fatalf</span><span class="op" id="6697931">(</span><span class="string" id="6697932">&#34;parseICMPMessage&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6697961">,</span>&nbsp;<span class="ident" id="6697963">err</span><span class="op" id="6697966">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6697971">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6697976">switch</span>&nbsp;<span class="ident" id="6697983">m</span><span class="op" id="6697984">.</span><span class="ident" id="6697985">Type</span>&nbsp;<span class="op" id="6697990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6697995">case</span>&nbsp;<span class="ident" id="6698000">icmpv4EchoRequest</span><span class="op" id="6698017">,</span>&nbsp;<span class="ident" id="6698019">icmpv6EchoRequest</span><span class="op" id="6698036">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6698042">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6698054">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6698059">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6698067">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6698071">switch</span>&nbsp;<span class="ident" id="6698078">p</span>&nbsp;<span class="op" id="6698080">:=</span>&nbsp;<span class="ident" id="6698083">m</span><span class="op" id="6698084">.</span><span class="ident" id="6698085">Body</span><span class="op" id="6698089">.</span><span class="op" id="6698090">(</span><span class="keyword" id="6698091">type</span><span class="op" id="6698095">)</span>&nbsp;<span class="op" id="6698097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6698101">case</span>&nbsp;<span class="op" id="6698106">*</span><span class="ident" id="6698107">icmpEcho</span><span class="op" id="6698115">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6698120">if</span>&nbsp;<span class="ident" id="6698123">p</span><span class="op" id="6698124">.</span><span class="ident" id="6698125">ID</span>&nbsp;<span class="op" id="6698128">!=</span>&nbsp;<span class="ident" id="6698131">xid</span>&nbsp;<span class="op" id="6698135">||</span>&nbsp;<span class="ident" id="6698138">p</span><span class="op" id="6698139">.</span><span class="ident" id="6698140">Seq</span>&nbsp;<span class="op" id="6698144">!=</span>&nbsp;<span class="ident" id="6698147">xseq</span>&nbsp;<span class="op" id="6698152">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6698158">t</span><span class="op" id="6698159">.</span><span class="ident" id="6698160">Fatalf</span><span class="op" id="6698166">(</span><span class="string" id="6698167">&#34;got&nbsp;id=%v,&nbsp;seqnum=%v;&nbsp;expected&nbsp;id=%v,&nbsp;seqnum=%v&#34;</span><span class="op" id="6698216">,</span>&nbsp;<span class="ident" id="6698218">p</span><span class="op" id="6698219">.</span><span class="ident" id="6698220">ID</span><span class="op" id="6698222">,</span>&nbsp;<span class="ident" id="6698224">p</span><span class="op" id="6698225">.</span><span class="ident" id="6698226">Seq</span><span class="op" id="6698229">,</span>&nbsp;<span class="ident" id="6698231">xid</span><span class="op" id="6698234">,</span>&nbsp;<span class="ident" id="6698236">xseq</span><span class="op" id="6698240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6698245">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6698249">default</span><span class="op" id="6698256">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6698261">t</span><span class="op" id="6698262">.</span><span class="ident" id="6698263">Fatalf</span><span class="op" id="6698269">(</span><span class="string" id="6698270">&#34;got&nbsp;type=%v,&nbsp;code=%v;&nbsp;expected&nbsp;type=%v,&nbsp;code=%v&#34;</span><span class="op" id="6698319">,</span>&nbsp;<span class="ident" id="6698321">m</span><span class="op" id="6698322">.</span><span class="ident" id="6698323">Type</span><span class="op" id="6698327">,</span>&nbsp;<span class="ident" id="6698329">m</span><span class="op" id="6698330">.</span><span class="ident" id="6698331">Code</span><span class="op" id="6698335">,</span>&nbsp;<span class="ident" id="6698337">typ</span><span class="op" id="6698340">,</span>&nbsp;<span class="num" id="6698342">0</span><span class="op" id="6698343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6698347">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6698350">}</span><br>
<span class="lineno"></span><span class="op" id="6698352">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6698355">func</span>&nbsp;<span class="ident" id="6698360">TestPacketConnICMPEcho</span><span class="op" id="6698382">(</span><span class="ident" id="6698383">t</span>&nbsp;<span class="op" id="6698385">*</span><span class="ident" id="6698386">testing</span><span class="op" id="6698393">.</span><span class="ident" id="6698394">T</span><span class="op" id="6698395">)</span>&nbsp;<span class="op" id="6698397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6698400">if</span>&nbsp;<span class="ident" id="6698403">skip</span><span class="op" id="6698407">,</span>&nbsp;<span class="ident" id="6698409">skipmsg</span>&nbsp;<span class="op" id="6698417">:=</span>&nbsp;<span class="ident" id="6698420">skipRawSocketTest</span><span class="op" id="6698437">(</span><span class="ident" id="6698438">t</span><span class="op" id="6698439">)</span><span class="op" id="6698440">;</span>&nbsp;<span class="ident" id="6698442">skip</span>&nbsp;<span class="op" id="6698447">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6698451">t</span><span class="op" id="6698452">.</span><span class="ident" id="6698453">Skip</span><span class="op" id="6698457">(</span><span class="ident" id="6698458">skipmsg</span><span class="op" id="6698465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6698468">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6698472">for</span>&nbsp;<span class="ident" id="6698476">i</span><span class="op" id="6698477">,</span>&nbsp;<span class="ident" id="6698479">tt</span>&nbsp;<span class="op" id="6698482">:=</span>&nbsp;<span class="keyword" id="6698485">range</span>&nbsp;<span class="ident" id="6698491">icmpEchoTests</span>&nbsp;<span class="op" id="6698505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6698509">net</span><span class="op" id="6698512">,</span>&nbsp;<span class="ident" id="6698514">_</span><span class="op" id="6698515">,</span>&nbsp;<span class="ident" id="6698517">err</span>&nbsp;<span class="op" id="6698521">:=</span>&nbsp;<span class="ident" id="6698524">parseNetwork</span><span class="op" id="6698536">(</span><span class="ident" id="6698537">tt</span><span class="op" id="6698539">.</span><span class="ident" id="6698540">net</span><span class="op" id="6698543">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6698547">if</span>&nbsp;<span class="ident" id="6698550">err</span>&nbsp;<span class="op" id="6698554">!=</span>&nbsp;<span class="builtintype" id="6698557">nil</span>&nbsp;<span class="op" id="6698561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6698566">t</span><span class="op" id="6698567">.</span><span class="ident" id="6698568">Fatalf</span><span class="op" id="6698574">(</span><span class="string" id="6698575">&#34;parseNetwork&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6698600">,</span>&nbsp;<span class="ident" id="6698602">err</span><span class="op" id="6698605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6698609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6698613">if</span>&nbsp;<span class="ident" id="6698616">net</span>&nbsp;<span class="op" id="6698620">==</span>&nbsp;<span class="string" id="6698623">&#34;ip6&#34;</span>&nbsp;<span class="op" id="6698629">&amp;&amp;</span>&nbsp;<span class="op" id="6698632">!</span><span class="ident" id="6698633">supportsIPv6</span>&nbsp;<span class="op" id="6698646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6698651">continue</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6698662">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6698667">c</span><span class="op" id="6698668">,</span>&nbsp;<span class="ident" id="6698670">err</span>&nbsp;<span class="op" id="6698674">:=</span>&nbsp;<span class="ident" id="6698677">ListenPacket</span><span class="op" id="6698689">(</span><span class="ident" id="6698690">tt</span><span class="op" id="6698692">.</span><span class="ident" id="6698693">net</span><span class="op" id="6698696">,</span>&nbsp;<span class="ident" id="6698698">tt</span><span class="op" id="6698700">.</span><span class="ident" id="6698701">laddr</span><span class="op" id="6698706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6698710">if</span>&nbsp;<span class="ident" id="6698713">err</span>&nbsp;<span class="op" id="6698717">!=</span>&nbsp;<span class="builtintype" id="6698720">nil</span>&nbsp;<span class="op" id="6698724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6698729">t</span><span class="op" id="6698730">.</span><span class="ident" id="6698731">Fatalf</span><span class="op" id="6698737">(</span><span class="string" id="6698738">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6698763">,</span>&nbsp;<span class="ident" id="6698765">err</span><span class="op" id="6698768">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6698772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6698776">c</span><span class="op" id="6698777">.</span><span class="ident" id="6698778">SetDeadline</span><span class="op" id="6698789">(</span><span class="ident" id="6698790">time</span><span class="op" id="6698794">.</span><span class="ident" id="6698795">Now</span><span class="op" id="6698798">(</span><span class="op" id="6698799">)</span><span class="op" id="6698800">.</span><span class="ident" id="6698801">Add</span><span class="op" id="6698804">(</span><span class="num" id="6698805">100</span>&nbsp;<span class="op" id="6698809">*</span>&nbsp;<span class="ident" id="6698811">time</span><span class="op" id="6698815">.</span><span class="ident" id="6698816">Millisecond</span><span class="op" id="6698827">)</span><span class="op" id="6698828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6698832">defer</span>&nbsp;<span class="ident" id="6698838">c</span><span class="op" id="6698839">.</span><span class="ident" id="6698840">Close</span><span class="op" id="6698845">(</span><span class="op" id="6698846">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6698851">ra</span><span class="op" id="6698853">,</span>&nbsp;<span class="ident" id="6698855">err</span>&nbsp;<span class="op" id="6698859">:=</span>&nbsp;<span class="ident" id="6698862">ResolveIPAddr</span><span class="op" id="6698875">(</span><span class="ident" id="6698876">tt</span><span class="op" id="6698878">.</span><span class="ident" id="6698879">net</span><span class="op" id="6698882">,</span>&nbsp;<span class="ident" id="6698884">tt</span><span class="op" id="6698886">.</span><span class="ident" id="6698887">raddr</span><span class="op" id="6698892">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6698896">if</span>&nbsp;<span class="ident" id="6698899">err</span>&nbsp;<span class="op" id="6698903">!=</span>&nbsp;<span class="builtintype" id="6698906">nil</span>&nbsp;<span class="op" id="6698910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6698915">t</span><span class="op" id="6698916">.</span><span class="ident" id="6698917">Fatalf</span><span class="op" id="6698923">(</span><span class="string" id="6698924">&#34;ResolveIPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6698950">,</span>&nbsp;<span class="ident" id="6698952">err</span><span class="op" id="6698955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6698959">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6698963">typ</span>&nbsp;<span class="op" id="6698967">:=</span>&nbsp;<span class="ident" id="6698970">icmpv4EchoRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6698990">if</span>&nbsp;<span class="ident" id="6698993">net</span>&nbsp;<span class="op" id="6698997">==</span>&nbsp;<span class="string" id="6699000">&#34;ip6&#34;</span>&nbsp;<span class="op" id="6699006">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6699011">typ</span>&nbsp;<span class="op" id="6699015">=</span>&nbsp;<span class="ident" id="6699017">icmpv6EchoRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6699037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6699041">xid</span><span class="op" id="6699044">,</span>&nbsp;<span class="ident" id="6699046">xseq</span>&nbsp;<span class="op" id="6699051">:=</span>&nbsp;<span class="ident" id="6699054">os</span><span class="op" id="6699056">.</span><span class="ident" id="6699057">Getpid</span><span class="op" id="6699063">(</span><span class="op" id="6699064">)</span><span class="op" id="6699065">&amp;</span><span class="num" id="6699066">0xffff</span><span class="op" id="6699072">,</span>&nbsp;<span class="ident" id="6699074">i</span><span class="op" id="6699075">+</span><span class="num" id="6699076">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6699080">wb</span><span class="op" id="6699082">,</span>&nbsp;<span class="ident" id="6699084">err</span>&nbsp;<span class="op" id="6699088">:=</span>&nbsp;<span class="op" id="6699091">(</span><span class="op" id="6699092">&amp;</span><span class="ident" id="6699093">icmpMessage</span><span class="op" id="6699104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6699109">Type</span><span class="op" id="6699113">:</span>&nbsp;<span class="ident" id="6699115">typ</span><span class="op" id="6699118">,</span>&nbsp;<span class="ident" id="6699120">Code</span><span class="op" id="6699124">:</span>&nbsp;<span class="num" id="6699126">0</span><span class="op" id="6699127">,</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6699132">Body</span><span class="op" id="6699136">:</span>&nbsp;<span class="op" id="6699138">&amp;</span><span class="ident" id="6699139">icmpEcho</span><span class="op" id="6699147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6699153">ID</span><span class="op" id="6699155">:</span>&nbsp;<span class="ident" id="6699157">xid</span><span class="op" id="6699160">,</span>&nbsp;<span class="ident" id="6699162">Seq</span><span class="op" id="6699165">:</span>&nbsp;<span class="ident" id="6699167">xseq</span><span class="op" id="6699171">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6699177">Data</span><span class="op" id="6699181">:</span>&nbsp;<span class="ident" id="6699183">bytes</span><span class="op" id="6699188">.</span><span class="ident" id="6699189">Repeat</span><span class="op" id="6699195">(</span><span class="op" id="6699196">[</span><span class="op" id="6699197">]</span><span class="builtintype" id="6699198">byte</span><span class="op" id="6699202">(</span><span class="string" id="6699203">&#34;Go&nbsp;Go&nbsp;Gadget&nbsp;Ping!!!&#34;</span><span class="op" id="6699225">)</span><span class="op" id="6699226">,</span>&nbsp;<span class="num" id="6699228">3</span><span class="op" id="6699229">)</span><span class="op" id="6699230">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6699235">}</span><span class="op" id="6699236">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6699240">}</span><span class="op" id="6699241">)</span><span class="op" id="6699242">.</span><span class="ident" id="6699243">Marshal</span><span class="op" id="6699250">(</span><span class="op" id="6699251">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6699255">if</span>&nbsp;<span class="ident" id="6699258">err</span>&nbsp;<span class="op" id="6699262">!=</span>&nbsp;<span class="builtintype" id="6699265">nil</span>&nbsp;<span class="op" id="6699269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6699274">t</span><span class="op" id="6699275">.</span><span class="ident" id="6699276">Fatalf</span><span class="op" id="6699282">(</span><span class="string" id="6699283">&#34;icmpMessage.Marshal&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6699315">,</span>&nbsp;<span class="ident" id="6699317">err</span><span class="op" id="6699320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6699324">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6699328">if</span>&nbsp;<span class="ident" id="6699331">_</span><span class="op" id="6699332">,</span>&nbsp;<span class="ident" id="6699334">err</span>&nbsp;<span class="op" id="6699338">:=</span>&nbsp;<span class="ident" id="6699341">c</span><span class="op" id="6699342">.</span><span class="ident" id="6699343">WriteTo</span><span class="op" id="6699350">(</span><span class="ident" id="6699351">wb</span><span class="op" id="6699353">,</span>&nbsp;<span class="ident" id="6699355">ra</span><span class="op" id="6699357">)</span><span class="op" id="6699358">;</span>&nbsp;<span class="ident" id="6699360">err</span>&nbsp;<span class="op" id="6699364">!=</span>&nbsp;<span class="builtintype" id="6699367">nil</span>&nbsp;<span class="op" id="6699371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6699376">t</span><span class="op" id="6699377">.</span><span class="ident" id="6699378">Fatalf</span><span class="op" id="6699384">(</span><span class="string" id="6699385">&#34;PacketConn.WriteTo&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6699416">,</span>&nbsp;<span class="ident" id="6699418">err</span><span class="op" id="6699421">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6699425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6699429">var</span>&nbsp;<span class="ident" id="6699433">m</span>&nbsp;<span class="op" id="6699435">*</span><span class="ident" id="6699436">icmpMessage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6699450">rb</span>&nbsp;<span class="op" id="6699453">:=</span>&nbsp;<span class="builtinfunc" id="6699456">make</span><span class="op" id="6699460">(</span><span class="op" id="6699461">[</span><span class="op" id="6699462">]</span><span class="builtintype" id="6699463">byte</span><span class="op" id="6699467">,</span>&nbsp;<span class="num" id="6699469">20</span><span class="op" id="6699471">+</span><span class="builtinfunc" id="6699472">len</span><span class="op" id="6699475">(</span><span class="ident" id="6699476">wb</span><span class="op" id="6699478">)</span><span class="op" id="6699479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6699483">for</span>&nbsp;<span class="op" id="6699487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6699492">if</span>&nbsp;<span class="ident" id="6699495">_</span><span class="op" id="6699496">,</span>&nbsp;<span class="ident" id="6699498">_</span><span class="op" id="6699499">,</span>&nbsp;<span class="ident" id="6699501">err</span>&nbsp;<span class="op" id="6699505">:=</span>&nbsp;<span class="ident" id="6699508">c</span><span class="op" id="6699509">.</span><span class="ident" id="6699510">ReadFrom</span><span class="op" id="6699518">(</span><span class="ident" id="6699519">rb</span><span class="op" id="6699521">)</span><span class="op" id="6699522">;</span>&nbsp;<span class="ident" id="6699524">err</span>&nbsp;<span class="op" id="6699528">!=</span>&nbsp;<span class="builtintype" id="6699531">nil</span>&nbsp;<span class="op" id="6699535">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6699541">t</span><span class="op" id="6699542">.</span><span class="ident" id="6699543">Fatalf</span><span class="op" id="6699549">(</span><span class="string" id="6699550">&#34;PacketConn.ReadFrom&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6699582">,</span>&nbsp;<span class="ident" id="6699584">err</span><span class="op" id="6699587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6699592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6699597">//&nbsp;See&nbsp;BUG&nbsp;section.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6699620">//if&nbsp;net&nbsp;==&nbsp;&#34;ip4&#34;&nbsp;{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6699643">//&nbsp;&nbsp;&nbsp;&nbsp;rb&nbsp;=&nbsp;ipv4Payload(rb)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6699670">//}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6699677">if</span>&nbsp;<span class="ident" id="6699680">m</span><span class="op" id="6699681">,</span>&nbsp;<span class="ident" id="6699683">err</span>&nbsp;<span class="op" id="6699687">=</span>&nbsp;<span class="ident" id="6699689">parseICMPMessage</span><span class="op" id="6699705">(</span><span class="ident" id="6699706">rb</span><span class="op" id="6699708">)</span><span class="op" id="6699709">;</span>&nbsp;<span class="ident" id="6699711">err</span>&nbsp;<span class="op" id="6699715">!=</span>&nbsp;<span class="builtintype" id="6699718">nil</span>&nbsp;<span class="op" id="6699722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6699728">t</span><span class="op" id="6699729">.</span><span class="ident" id="6699730">Fatalf</span><span class="op" id="6699736">(</span><span class="string" id="6699737">&#34;parseICMPMessage&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6699766">,</span>&nbsp;<span class="ident" id="6699768">err</span><span class="op" id="6699771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6699776">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6699781">switch</span>&nbsp;<span class="ident" id="6699788">m</span><span class="op" id="6699789">.</span><span class="ident" id="6699790">Type</span>&nbsp;<span class="op" id="6699795">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6699800">case</span>&nbsp;<span class="ident" id="6699805">icmpv4EchoRequest</span><span class="op" id="6699822">,</span>&nbsp;<span class="ident" id="6699824">icmpv6EchoRequest</span><span class="op" id="6699841">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6699847">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6699859">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6699864">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6699872">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6699876">switch</span>&nbsp;<span class="ident" id="6699883">p</span>&nbsp;<span class="op" id="6699885">:=</span>&nbsp;<span class="ident" id="6699888">m</span><span class="op" id="6699889">.</span><span class="ident" id="6699890">Body</span><span class="op" id="6699894">.</span><span class="op" id="6699895">(</span><span class="keyword" id="6699896">type</span><span class="op" id="6699900">)</span>&nbsp;<span class="op" id="6699902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6699906">case</span>&nbsp;<span class="op" id="6699911">*</span><span class="ident" id="6699912">icmpEcho</span><span class="op" id="6699920">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6699925">if</span>&nbsp;<span class="ident" id="6699928">p</span><span class="op" id="6699929">.</span><span class="ident" id="6699930">ID</span>&nbsp;<span class="op" id="6699933">!=</span>&nbsp;<span class="ident" id="6699936">xid</span>&nbsp;<span class="op" id="6699940">||</span>&nbsp;<span class="ident" id="6699943">p</span><span class="op" id="6699944">.</span><span class="ident" id="6699945">Seq</span>&nbsp;<span class="op" id="6699949">!=</span>&nbsp;<span class="ident" id="6699952">xseq</span>&nbsp;<span class="op" id="6699957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6699963">t</span><span class="op" id="6699964">.</span><span class="ident" id="6699965">Fatalf</span><span class="op" id="6699971">(</span><span class="string" id="6699972">&#34;got&nbsp;id=%v,&nbsp;seqnum=%v;&nbsp;expected&nbsp;id=%v,&nbsp;seqnum=%v&#34;</span><span class="op" id="6700021">,</span>&nbsp;<span class="ident" id="6700023">p</span><span class="op" id="6700024">.</span><span class="ident" id="6700025">ID</span><span class="op" id="6700027">,</span>&nbsp;<span class="ident" id="6700029">p</span><span class="op" id="6700030">.</span><span class="ident" id="6700031">Seq</span><span class="op" id="6700034">,</span>&nbsp;<span class="ident" id="6700036">xid</span><span class="op" id="6700039">,</span>&nbsp;<span class="ident" id="6700041">xseq</span><span class="op" id="6700045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6700050">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6700054">default</span><span class="op" id="6700061">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6700066">t</span><span class="op" id="6700067">.</span><span class="ident" id="6700068">Fatalf</span><span class="op" id="6700074">(</span><span class="string" id="6700075">&#34;got&nbsp;type=%v,&nbsp;code=%v;&nbsp;expected&nbsp;type=%v,&nbsp;code=%v&#34;</span><span class="op" id="6700124">,</span>&nbsp;<span class="ident" id="6700126">m</span><span class="op" id="6700127">.</span><span class="ident" id="6700128">Type</span><span class="op" id="6700132">,</span>&nbsp;<span class="ident" id="6700134">m</span><span class="op" id="6700135">.</span><span class="ident" id="6700136">Code</span><span class="op" id="6700140">,</span>&nbsp;<span class="ident" id="6700142">typ</span><span class="op" id="6700145">,</span>&nbsp;<span class="num" id="6700147">0</span><span class="op" id="6700148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6700152">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6700155">}</span><br>
<span class="lineno"></span><span class="op" id="6700157">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="keyword" id="6700160">func</span>&nbsp;<span class="ident" id="6700165">ipv4Payload</span><span class="op" id="6700176">(</span><span class="ident" id="6700177">b</span>&nbsp;<span class="op" id="6700179">[</span><span class="op" id="6700180">]</span><span class="builtintype" id="6700181">byte</span><span class="op" id="6700185">)</span>&nbsp;<span class="op" id="6700187">[</span><span class="op" id="6700188">]</span><span class="builtintype" id="6700189">byte</span>&nbsp;<span class="op" id="6700194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6700197">if</span>&nbsp;<span class="builtinfunc" id="6700200">len</span><span class="op" id="6700203">(</span><span class="ident" id="6700204">b</span><span class="op" id="6700205">)</span>&nbsp;<span class="op" id="6700207">&lt;</span>&nbsp;<span class="num" id="6700209">20</span>&nbsp;<span class="op" id="6700212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6700216">return</span>&nbsp;<span class="ident" id="6700223">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6700226">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6700229">hdrlen</span>&nbsp;<span class="op" id="6700236">:=</span>&nbsp;<span class="builtintype" id="6700239">int</span><span class="op" id="6700242">(</span><span class="ident" id="6700243">b</span><span class="op" id="6700244">[</span><span class="num" id="6700245">0</span><span class="op" id="6700246">]</span><span class="op" id="6700247">&amp;</span><span class="num" id="6700248">0x0f</span><span class="op" id="6700252">)</span>&nbsp;<span class="op" id="6700254">&lt;&lt;</span>&nbsp;<span class="num" id="6700257">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6700260">return</span>&nbsp;<span class="ident" id="6700267">b</span><span class="op" id="6700268">[</span><span class="ident" id="6700269">hdrlen</span><span class="op" id="6700275">:</span><span class="op" id="6700276">]</span><br>
<span class="lineno"></span><span class="op" id="6700278">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6700281">var</span>&nbsp;<span class="ident" id="6700285">ipConnLocalNameTests</span>&nbsp;<span class="op" id="6700306">=</span>&nbsp;<span class="op" id="6700308">[</span><span class="op" id="6700309">]</span><span class="keyword" id="6700310">struct</span>&nbsp;<span class="op" id="6700317">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6700320">net</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6700326">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6700334">laddr</span>&nbsp;<span class="op" id="6700340">*</span><span class="ident" id="6700341">IPAddr</span><br>
<span class="lineno"></span><span class="op" id="6700348">}</span><span class="op" id="6700349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6700352">{</span><span class="string" id="6700353">&#34;ip4:icmp&#34;</span><span class="op" id="6700363">,</span>&nbsp;<span class="op" id="6700365">&amp;</span><span class="ident" id="6700366">IPAddr</span><span class="op" id="6700372">{</span><span class="ident" id="6700373">IP</span><span class="op" id="6700375">:</span>&nbsp;<span class="ident" id="6700377">IPv4</span><span class="op" id="6700381">(</span><span class="num" id="6700382">127</span><span class="op" id="6700385">,</span>&nbsp;<span class="num" id="6700387">0</span><span class="op" id="6700388">,</span>&nbsp;<span class="num" id="6700390">0</span><span class="op" id="6700391">,</span>&nbsp;<span class="num" id="6700393">1</span><span class="op" id="6700394">)</span><span class="op" id="6700395">}</span><span class="op" id="6700396">}</span><span class="op" id="6700397">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6700400">{</span><span class="string" id="6700401">&#34;ip4:icmp&#34;</span><span class="op" id="6700411">,</span>&nbsp;<span class="op" id="6700413">&amp;</span><span class="ident" id="6700414">IPAddr</span><span class="op" id="6700420">{</span><span class="op" id="6700421">}</span><span class="op" id="6700422">}</span><span class="op" id="6700423">,</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6700426">{</span><span class="string" id="6700427">&#34;ip4:icmp&#34;</span><span class="op" id="6700437">,</span>&nbsp;<span class="builtintype" id="6700439">nil</span><span class="op" id="6700442">}</span><span class="op" id="6700443">,</span><br>
<span class="lineno"></span><span class="op" id="6700445">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6700448">func</span>&nbsp;<span class="ident" id="6700453">TestIPConnLocalName</span><span class="op" id="6700472">(</span><span class="ident" id="6700473">t</span>&nbsp;<span class="op" id="6700475">*</span><span class="ident" id="6700476">testing</span><span class="op" id="6700483">.</span><span class="ident" id="6700484">T</span><span class="op" id="6700485">)</span>&nbsp;<span class="op" id="6700487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6700490">switch</span>&nbsp;<span class="ident" id="6700497">runtime</span><span class="op" id="6700504">.</span><span class="ident" id="6700505">GOOS</span>&nbsp;<span class="op" id="6700510">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6700513">case</span>&nbsp;<span class="string" id="6700518">&#34;nacl&#34;</span><span class="op" id="6700524">,</span>&nbsp;<span class="string" id="6700526">&#34;plan9&#34;</span><span class="op" id="6700533">,</span>&nbsp;<span class="string" id="6700535">&#34;windows&#34;</span><span class="op" id="6700544">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6700548">t</span><span class="op" id="6700549">.</span><span class="ident" id="6700550">Skipf</span><span class="op" id="6700555">(</span><span class="string" id="6700556">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6700577">,</span>&nbsp;<span class="ident" id="6700579">runtime</span><span class="op" id="6700586">.</span><span class="ident" id="6700587">GOOS</span><span class="op" id="6700591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6700594">default</span><span class="op" id="6700601">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6700605">if</span>&nbsp;<span class="ident" id="6700608">os</span><span class="op" id="6700610">.</span><span class="ident" id="6700611">Getuid</span><span class="op" id="6700617">(</span><span class="op" id="6700618">)</span>&nbsp;<span class="op" id="6700620">!=</span>&nbsp;<span class="num" id="6700623">0</span>&nbsp;<span class="op" id="6700625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6700630">t</span><span class="op" id="6700631">.</span><span class="ident" id="6700632">Skip</span><span class="op" id="6700636">(</span><span class="string" id="6700637">&#34;skipping&nbsp;test;&nbsp;must&nbsp;be&nbsp;root&#34;</span><span class="op" id="6700666">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6700670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6700673">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6700677">for</span>&nbsp;<span class="ident" id="6700681">_</span><span class="op" id="6700682">,</span>&nbsp;<span class="ident" id="6700684">tt</span>&nbsp;<span class="op" id="6700687">:=</span>&nbsp;<span class="keyword" id="6700690">range</span>&nbsp;<span class="ident" id="6700696">ipConnLocalNameTests</span>&nbsp;<span class="op" id="6700717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6700721">c</span><span class="op" id="6700722">,</span>&nbsp;<span class="ident" id="6700724">err</span>&nbsp;<span class="op" id="6700728">:=</span>&nbsp;<span class="ident" id="6700731">ListenIP</span><span class="op" id="6700739">(</span><span class="ident" id="6700740">tt</span><span class="op" id="6700742">.</span><span class="ident" id="6700743">net</span><span class="op" id="6700746">,</span>&nbsp;<span class="ident" id="6700748">tt</span><span class="op" id="6700750">.</span><span class="ident" id="6700751">laddr</span><span class="op" id="6700756">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6700760">if</span>&nbsp;<span class="ident" id="6700763">err</span>&nbsp;<span class="op" id="6700767">!=</span>&nbsp;<span class="builtintype" id="6700770">nil</span>&nbsp;<span class="op" id="6700774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6700779">t</span><span class="op" id="6700780">.</span><span class="ident" id="6700781">Fatalf</span><span class="op" id="6700787">(</span><span class="string" id="6700788">&#34;ListenIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6700809">,</span>&nbsp;<span class="ident" id="6700811">err</span><span class="op" id="6700814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6700818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6700822">defer</span>&nbsp;<span class="ident" id="6700828">c</span><span class="op" id="6700829">.</span><span class="ident" id="6700830">Close</span><span class="op" id="6700835">(</span><span class="op" id="6700836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6700840">if</span>&nbsp;<span class="ident" id="6700843">la</span>&nbsp;<span class="op" id="6700846">:=</span>&nbsp;<span class="ident" id="6700849">c</span><span class="op" id="6700850">.</span><span class="ident" id="6700851">LocalAddr</span><span class="op" id="6700860">(</span><span class="op" id="6700861">)</span><span class="op" id="6700862">;</span>&nbsp;<span class="ident" id="6700864">la</span>&nbsp;<span class="op" id="6700867">==</span>&nbsp;<span class="builtintype" id="6700870">nil</span>&nbsp;<span class="op" id="6700874">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6700879">t</span><span class="op" id="6700880">.</span><span class="ident" id="6700881">Fatal</span><span class="op" id="6700886">(</span><span class="string" id="6700887">&#34;IPConn.LocalAddr&nbsp;failed&#34;</span><span class="op" id="6700912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6700916">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6700919">}</span><br>
<span class="lineno"></span><span class="op" id="6700921">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span><span class="keyword" id="6700924">func</span>&nbsp;<span class="ident" id="6700929">TestIPConnRemoteName</span><span class="op" id="6700949">(</span><span class="ident" id="6700950">t</span>&nbsp;<span class="op" id="6700952">*</span><span class="ident" id="6700953">testing</span><span class="op" id="6700960">.</span><span class="ident" id="6700961">T</span><span class="op" id="6700962">)</span>&nbsp;<span class="op" id="6700964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6700967">switch</span>&nbsp;<span class="ident" id="6700974">runtime</span><span class="op" id="6700981">.</span><span class="ident" id="6700982">GOOS</span>&nbsp;<span class="op" id="6700987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6700990">case</span>&nbsp;<span class="string" id="6700995">&#34;plan9&#34;</span><span class="op" id="6701002">,</span>&nbsp;<span class="string" id="6701004">&#34;windows&#34;</span><span class="op" id="6701013">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6701017">t</span><span class="op" id="6701018">.</span><span class="ident" id="6701019">Skipf</span><span class="op" id="6701024">(</span><span class="string" id="6701025">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6701046">,</span>&nbsp;<span class="ident" id="6701048">runtime</span><span class="op" id="6701055">.</span><span class="ident" id="6701056">GOOS</span><span class="op" id="6701060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6701063">default</span><span class="op" id="6701070">:</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6701074">if</span>&nbsp;<span class="ident" id="6701077">os</span><span class="op" id="6701079">.</span><span class="ident" id="6701080">Getuid</span><span class="op" id="6701086">(</span><span class="op" id="6701087">)</span>&nbsp;<span class="op" id="6701089">!=</span>&nbsp;<span class="num" id="6701092">0</span>&nbsp;<span class="op" id="6701094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6701099">t</span><span class="op" id="6701100">.</span><span class="ident" id="6701101">Skip</span><span class="op" id="6701105">(</span><span class="string" id="6701106">&#34;skipping&nbsp;test;&nbsp;must&nbsp;be&nbsp;root&#34;</span><span class="op" id="6701135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6701139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6701142">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6701146">raddr</span>&nbsp;<span class="op" id="6701152">:=</span>&nbsp;<span class="op" id="6701155">&amp;</span><span class="ident" id="6701156">IPAddr</span><span class="op" id="6701162">{</span><span class="ident" id="6701163">IP</span><span class="op" id="6701165">:</span>&nbsp;<span class="ident" id="6701167">IPv4</span><span class="op" id="6701171">(</span><span class="num" id="6701172">127</span><span class="op" id="6701175">,</span>&nbsp;<span class="num" id="6701177">0</span><span class="op" id="6701178">,</span>&nbsp;<span class="num" id="6701180">0</span><span class="op" id="6701181">,</span>&nbsp;<span class="num" id="6701183">1</span><span class="op" id="6701184">)</span><span class="op" id="6701185">.</span><span class="ident" id="6701186">To4</span><span class="op" id="6701189">(</span><span class="op" id="6701190">)</span><span class="op" id="6701191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6701194">c</span><span class="op" id="6701195">,</span>&nbsp;<span class="ident" id="6701197">err</span>&nbsp;<span class="op" id="6701201">:=</span>&nbsp;<span class="ident" id="6701204">DialIP</span><span class="op" id="6701210">(</span><span class="string" id="6701211">&#34;ip:tcp&#34;</span><span class="op" id="6701219">,</span>&nbsp;<span class="op" id="6701221">&amp;</span><span class="ident" id="6701222">IPAddr</span><span class="op" id="6701228">{</span><span class="ident" id="6701229">IP</span><span class="op" id="6701231">:</span>&nbsp;<span class="ident" id="6701233">IPv4</span><span class="op" id="6701237">(</span><span class="num" id="6701238">127</span><span class="op" id="6701241">,</span>&nbsp;<span class="num" id="6701243">0</span><span class="op" id="6701244">,</span>&nbsp;<span class="num" id="6701246">0</span><span class="op" id="6701247">,</span>&nbsp;<span class="num" id="6701249">1</span><span class="op" id="6701250">)</span><span class="op" id="6701251">}</span><span class="op" id="6701252">,</span>&nbsp;<span class="ident" id="6701254">raddr</span><span class="op" id="6701259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6701262">if</span>&nbsp;<span class="ident" id="6701265">err</span>&nbsp;<span class="op" id="6701269">!=</span>&nbsp;<span class="builtintype" id="6701272">nil</span>&nbsp;<span class="op" id="6701276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6701280">t</span><span class="op" id="6701281">.</span><span class="ident" id="6701282">Fatalf</span><span class="op" id="6701288">(</span><span class="string" id="6701289">&#34;DialIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6701308">,</span>&nbsp;<span class="ident" id="6701310">err</span><span class="op" id="6701313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6701316">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6701319">defer</span>&nbsp;<span class="ident" id="6701325">c</span><span class="op" id="6701326">.</span><span class="ident" id="6701327">Close</span><span class="op" id="6701332">(</span><span class="op" id="6701333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6701336">if</span>&nbsp;<span class="op" id="6701339">!</span><span class="ident" id="6701340">reflect</span><span class="op" id="6701347">.</span><span class="ident" id="6701348">DeepEqual</span><span class="op" id="6701357">(</span><span class="ident" id="6701358">raddr</span><span class="op" id="6701363">,</span>&nbsp;<span class="ident" id="6701365">c</span><span class="op" id="6701366">.</span><span class="ident" id="6701367">RemoteAddr</span><span class="op" id="6701377">(</span><span class="op" id="6701378">)</span><span class="op" id="6701379">)</span>&nbsp;<span class="op" id="6701381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6701385">t</span><span class="op" id="6701386">.</span><span class="ident" id="6701387">Fatalf</span><span class="op" id="6701393">(</span><span class="string" id="6701394">&#34;got&nbsp;%#v,&nbsp;expected&nbsp;%#v&#34;</span><span class="op" id="6701417">,</span>&nbsp;<span class="ident" id="6701419">c</span><span class="op" id="6701420">.</span><span class="ident" id="6701421">RemoteAddr</span><span class="op" id="6701431">(</span><span class="op" id="6701432">)</span><span class="op" id="6701433">,</span>&nbsp;<span class="ident" id="6701435">raddr</span><span class="op" id="6701440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6701443">}</span><br>
<span class="lineno"></span><span class="op" id="6701445">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
