<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http</h2>
<ul>
<li><a href="/gostd/net/http/client.go.html">client.go</a></li>
<li><a href="/gostd/net/http/client_test.go.html">client_test.go</a></li>
<li><a href="/gostd/net/http/cookie.go.html">cookie.go</a></li>
<li><a href="/gostd/net/http/cookie_test.go.html">cookie_test.go</a></li>
<li><a href="/gostd/net/http/doc.go.html">doc.go</a></li>
<li><a href="/gostd/net/http/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/http/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/net/http/filetransport.go.html">filetransport.go</a></li>
<li><a href="/gostd/net/http/filetransport_test.go.html">filetransport_test.go</a></li>
<li><a href="/gostd/net/http/fs.go.html">fs.go</a></li>
<li><a href="/gostd/net/http/fs_test.go.html">fs_test.go</a></li>
<li><a href="/gostd/net/http/header.go.html">header.go</a></li>
<li><a href="/gostd/net/http/header_test.go.html">header_test.go</a></li>
<li><a href="/gostd/net/http/jar.go.html">jar.go</a></li>
<li><a href="/gostd/net/http/lex.go.html">lex.go</a></li>
<li><a href="/gostd/net/http/lex_test.go.html">lex_test.go</a></li>
<li><a href="/gostd/net/http/main_test.go.html">main_test.go</a></li>
<li><a href="/gostd/net/http/npn_test.go.html">npn_test.go</a></li>
<li><a href="/gostd/net/http/proxy_test.go.html">proxy_test.go</a></li>
<li><a href="/gostd/net/http/range_test.go.html">range_test.go</a></li>
<li><a href="/gostd/net/http/readrequest_test.go.html">readrequest_test.go</a></li>
<li><a href="/gostd/net/http/request.go.html" class="current">request.go</a></li>
<li><a href="/gostd/net/http/request_test.go.html">request_test.go</a></li>
<li><a href="/gostd/net/http/requestwrite_test.go.html">requestwrite_test.go</a></li>
<li><a href="/gostd/net/http/response.go.html">response.go</a></li>
<li><a href="/gostd/net/http/response_test.go.html">response_test.go</a></li>
<li><a href="/gostd/net/http/responsewrite_test.go.html">responsewrite_test.go</a></li>
<li><a href="/gostd/net/http/serve_test.go.html">serve_test.go</a></li>
<li><a href="/gostd/net/http/server.go.html">server.go</a></li>
<li><a href="/gostd/net/http/sniff.go.html">sniff.go</a></li>
<li><a href="/gostd/net/http/sniff_test.go.html">sniff_test.go</a></li>
<li><a href="/gostd/net/http/status.go.html">status.go</a></li>
<li><a href="/gostd/net/http/transfer.go.html">transfer.go</a></li>
<li><a href="/gostd/net/http/transfer_test.go.html">transfer_test.go</a></li>
<li><a href="/gostd/net/http/transport.go.html">transport.go</a></li>
<li><a href="/gostd/net/http/transport_test.go.html">transport_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2977841">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2977896">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2977950">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2978001">//&nbsp;HTTP&nbsp;Request&nbsp;reading&nbsp;and&nbsp;parsing.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2978039">package</span>&nbsp;<span class="ident" id="2978047">http</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2978053">import</span>&nbsp;<span class="op" id="2978060">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2978063">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2978072">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2978081">&#34;crypto/tls&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2978095">&#34;encoding/base64&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2978114">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2978124">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2978131">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2978137">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2978150">&#34;mime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2978158">&#34;mime/multipart&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2978176">&#34;net/textproto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2978193">&#34;net/url&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2978204">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2978215">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2978226">&#34;sync&#34;</span><br>
<span class="lineno">25</span><span class="op" id="2978233">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2978236">const</span>&nbsp;<span class="op" id="2978242">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2978245">maxValueLength</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2978262">=</span>&nbsp;<span class="num" id="2978264">4096</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2978270">maxHeaderLines</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2978287">=</span>&nbsp;<span class="num" id="2978289">1024</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2978295">chunkSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2978312">=</span>&nbsp;<span class="num" id="2978314">4</span>&nbsp;<span class="op" id="2978316">&lt;&lt;</span>&nbsp;<span class="num" id="2978319">10</span>&nbsp;&nbsp;<span class="comment" id="2978323">//&nbsp;4&nbsp;KB&nbsp;chunks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2978339">defaultMaxMemory</span>&nbsp;<span class="op" id="2978356">=</span>&nbsp;<span class="num" id="2978358">32</span>&nbsp;<span class="op" id="2978361">&lt;&lt;</span>&nbsp;<span class="num" id="2978364">20</span>&nbsp;<span class="comment" id="2978367">//&nbsp;32&nbsp;MB</span><br>
<span class="lineno"></span><span class="op" id="2978376">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2978379">//&nbsp;ErrMissingFile&nbsp;is&nbsp;returned&nbsp;by&nbsp;FormFile&nbsp;when&nbsp;the&nbsp;provided&nbsp;file&nbsp;field&nbsp;name</span><br>
<span class="lineno">35</span><span class="comment" id="2978455">//&nbsp;is&nbsp;either&nbsp;not&nbsp;present&nbsp;in&nbsp;the&nbsp;request&nbsp;or&nbsp;not&nbsp;a&nbsp;file&nbsp;field.</span><br>
<span class="lineno"></span><span class="keyword" id="2978516">var</span>&nbsp;<span class="ident" id="2978520">ErrMissingFile</span>&nbsp;<span class="op" id="2978535">=</span>&nbsp;<span class="ident" id="2978537">errors</span><span class="op" id="2978543">.</span><span class="ident" id="2978544">New</span><span class="op" id="2978547">(</span><span class="string" id="2978548">&#34;http:&nbsp;no&nbsp;such&nbsp;file&#34;</span><span class="op" id="2978568">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2978571">//&nbsp;HTTP&nbsp;request&nbsp;parsing&nbsp;errors.</span><br>
<span class="lineno"></span><span class="keyword" id="2978603">type</span>&nbsp;<span class="ident" id="2978608">ProtocolError</span>&nbsp;<span class="keyword" id="2978622">struct</span>&nbsp;<span class="op" id="2978629">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2978632">ErrorString</span>&nbsp;<span class="builtintype" id="2978644">string</span><br>
<span class="lineno"></span><span class="op" id="2978651">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2978654">func</span>&nbsp;<span class="op" id="2978659">(</span><span class="ident" id="2978660">err</span>&nbsp;<span class="op" id="2978664">*</span><span class="ident" id="2978665">ProtocolError</span><span class="op" id="2978678">)</span>&nbsp;<span class="ident" id="2978680">Error</span><span class="op" id="2978685">(</span><span class="op" id="2978686">)</span>&nbsp;<span class="builtintype" id="2978688">string</span>&nbsp;<span class="op" id="2978695">{</span>&nbsp;<span class="keyword" id="2978697">return</span>&nbsp;<span class="ident" id="2978704">err</span><span class="op" id="2978707">.</span><span class="ident" id="2978708">ErrorString</span>&nbsp;<span class="op" id="2978720">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="2978723">var</span>&nbsp;<span class="op" id="2978727">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2978730">ErrHeaderTooLong</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2978754">=</span>&nbsp;<span class="op" id="2978756">&amp;</span><span class="ident" id="2978757">ProtocolError</span><span class="op" id="2978770">{</span><span class="string" id="2978771">&#34;header&nbsp;too&nbsp;long&#34;</span><span class="op" id="2978788">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2978791">ErrShortBody</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2978815">=</span>&nbsp;<span class="op" id="2978817">&amp;</span><span class="ident" id="2978818">ProtocolError</span><span class="op" id="2978831">{</span><span class="string" id="2978832">&#34;entity&nbsp;body&nbsp;too&nbsp;short&#34;</span><span class="op" id="2978855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2978858">ErrNotSupported</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2978882">=</span>&nbsp;<span class="op" id="2978884">&amp;</span><span class="ident" id="2978885">ProtocolError</span><span class="op" id="2978898">{</span><span class="string" id="2978899">&#34;feature&nbsp;not&nbsp;supported&#34;</span><span class="op" id="2978922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2978925">ErrUnexpectedTrailer</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2978949">=</span>&nbsp;<span class="op" id="2978951">&amp;</span><span class="ident" id="2978952">ProtocolError</span><span class="op" id="2978965">{</span><span class="string" id="2978966">&#34;trailer&nbsp;header&nbsp;without&nbsp;chunked&nbsp;transfer&nbsp;encoding&#34;</span><span class="op" id="2979016">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2979019">ErrMissingContentLength</span>&nbsp;<span class="op" id="2979043">=</span>&nbsp;<span class="op" id="2979045">&amp;</span><span class="ident" id="2979046">ProtocolError</span><span class="op" id="2979059">{</span><span class="string" id="2979060">&#34;missing&nbsp;ContentLength&nbsp;in&nbsp;HEAD&nbsp;response&#34;</span><span class="op" id="2979100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2979103">ErrNotMultipart</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2979127">=</span>&nbsp;<span class="op" id="2979129">&amp;</span><span class="ident" id="2979130">ProtocolError</span><span class="op" id="2979143">{</span><span class="string" id="2979144">&#34;request&nbsp;Content-Type&nbsp;isn&#39;t&nbsp;multipart/form-data&#34;</span><span class="op" id="2979192">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2979195">ErrMissingBoundary</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2979219">=</span>&nbsp;<span class="op" id="2979221">&amp;</span><span class="ident" id="2979222">ProtocolError</span><span class="op" id="2979235">{</span><span class="string" id="2979236">&#34;no&nbsp;multipart&nbsp;boundary&nbsp;param&nbsp;in&nbsp;Content-Type&#34;</span><span class="op" id="2979281">}</span><br>
<span class="lineno"></span><span class="op" id="2979283">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="2979286">type</span>&nbsp;<span class="ident" id="2979291">badStringError</span>&nbsp;<span class="keyword" id="2979306">struct</span>&nbsp;<span class="op" id="2979313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2979316">what</span>&nbsp;<span class="builtintype" id="2979321">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2979329">str</span>&nbsp;&nbsp;<span class="builtintype" id="2979334">string</span><br>
<span class="lineno"></span><span class="op" id="2979341">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="keyword" id="2979344">func</span>&nbsp;<span class="op" id="2979349">(</span><span class="ident" id="2979350">e</span>&nbsp;<span class="op" id="2979352">*</span><span class="ident" id="2979353">badStringError</span><span class="op" id="2979367">)</span>&nbsp;<span class="ident" id="2979369">Error</span><span class="op" id="2979374">(</span><span class="op" id="2979375">)</span>&nbsp;<span class="builtintype" id="2979377">string</span>&nbsp;<span class="op" id="2979384">{</span>&nbsp;<span class="keyword" id="2979386">return</span>&nbsp;<span class="ident" id="2979393">fmt</span><span class="op" id="2979396">.</span><span class="ident" id="2979397">Sprintf</span><span class="op" id="2979404">(</span><span class="string" id="2979405">&#34;%s&nbsp;%q&#34;</span><span class="op" id="2979412">,</span>&nbsp;<span class="ident" id="2979414">e</span><span class="op" id="2979415">.</span><span class="ident" id="2979416">what</span><span class="op" id="2979420">,</span>&nbsp;<span class="ident" id="2979422">e</span><span class="op" id="2979423">.</span><span class="ident" id="2979424">str</span><span class="op" id="2979427">)</span>&nbsp;<span class="op" id="2979429">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2979432">//&nbsp;Headers&nbsp;that&nbsp;Request.Write&nbsp;handles&nbsp;itself&nbsp;and&nbsp;should&nbsp;be&nbsp;skipped.</span><br>
<span class="lineno"></span><span class="keyword" id="2979500">var</span>&nbsp;<span class="ident" id="2979504">reqWriteExcludeHeader</span>&nbsp;<span class="op" id="2979526">=</span>&nbsp;<span class="keyword" id="2979528">map</span><span class="op" id="2979531">[</span><span class="builtintype" id="2979532">string</span><span class="op" id="2979538">]</span><span class="builtintype" id="2979539">bool</span><span class="op" id="2979543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2979546">&#34;Host&#34;</span><span class="op" id="2979552">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2979567">true</span><span class="op" id="2979571">,</span>&nbsp;<span class="comment" id="2979573">//&nbsp;not&nbsp;in&nbsp;Header&nbsp;map&nbsp;anyway</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2979602">&#34;User-Agent&#34;</span><span class="op" id="2979614">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2979623">true</span><span class="op" id="2979627">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2979630">&#34;Content-Length&#34;</span><span class="op" id="2979646">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2979651">true</span><span class="op" id="2979655">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2979658">&#34;Transfer-Encoding&#34;</span><span class="op" id="2979677">:</span>&nbsp;<span class="builtintype" id="2979679">true</span><span class="op" id="2979683">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2979686">&#34;Trailer&#34;</span><span class="op" id="2979695">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2979707">true</span><span class="op" id="2979711">,</span><br>
<span class="lineno"></span><span class="op" id="2979713">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="2979716">//&nbsp;A&nbsp;Request&nbsp;represents&nbsp;an&nbsp;HTTP&nbsp;request&nbsp;received&nbsp;by&nbsp;a&nbsp;server</span><br>
<span class="lineno"></span><span class="comment" id="2979777">//&nbsp;or&nbsp;to&nbsp;be&nbsp;sent&nbsp;by&nbsp;a&nbsp;client.</span><br>
<span class="lineno"></span><span class="comment" id="2979807">//</span><br>
<span class="lineno"></span><span class="comment" id="2979810">//&nbsp;The&nbsp;field&nbsp;semantics&nbsp;differ&nbsp;slightly&nbsp;between&nbsp;client&nbsp;and&nbsp;server</span><br>
<span class="lineno">75</span><span class="comment" id="2979875">//&nbsp;usage.&nbsp;In&nbsp;addition&nbsp;to&nbsp;the&nbsp;notes&nbsp;on&nbsp;the&nbsp;fields&nbsp;below,&nbsp;see&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2979939">//&nbsp;documentation&nbsp;for&nbsp;Request.Write&nbsp;and&nbsp;RoundTripper.</span><br>
<span class="lineno"></span><span class="keyword" id="2979992">type</span>&nbsp;<span class="ident" id="2979997">Request</span>&nbsp;<span class="keyword" id="2980005">struct</span>&nbsp;<span class="op" id="2980012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2980015">//&nbsp;Method&nbsp;specifies&nbsp;the&nbsp;HTTP&nbsp;method&nbsp;(GET,&nbsp;POST,&nbsp;PUT,&nbsp;etc.).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2980076">//&nbsp;For&nbsp;client&nbsp;requests&nbsp;an&nbsp;empty&nbsp;string&nbsp;means&nbsp;GET.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2980127">Method</span>&nbsp;<span class="builtintype" id="2980134">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2980143">//&nbsp;URL&nbsp;specifies&nbsp;either&nbsp;the&nbsp;URI&nbsp;being&nbsp;requested&nbsp;(for&nbsp;server</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2980204">//&nbsp;requests)&nbsp;or&nbsp;the&nbsp;URL&nbsp;to&nbsp;access&nbsp;(for&nbsp;client&nbsp;requests).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2980262">//</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2980266">//&nbsp;For&nbsp;server&nbsp;requests&nbsp;the&nbsp;URL&nbsp;is&nbsp;parsed&nbsp;from&nbsp;the&nbsp;URI</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2980321">//&nbsp;supplied&nbsp;on&nbsp;the&nbsp;Request-Line&nbsp;as&nbsp;stored&nbsp;in&nbsp;RequestURI.&nbsp;&nbsp;For</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2980384">//&nbsp;most&nbsp;requests,&nbsp;fields&nbsp;other&nbsp;than&nbsp;Path&nbsp;and&nbsp;RawQuery&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2980447">//&nbsp;empty.&nbsp;(See&nbsp;RFC&nbsp;2616,&nbsp;Section&nbsp;5.1.2)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2980488">//</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2980492">//&nbsp;For&nbsp;client&nbsp;requests,&nbsp;the&nbsp;URL&#39;s&nbsp;Host&nbsp;specifies&nbsp;the&nbsp;server&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2980556">//&nbsp;connect&nbsp;to,&nbsp;while&nbsp;the&nbsp;Request&#39;s&nbsp;Host&nbsp;field&nbsp;optionally</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2980614">//&nbsp;specifies&nbsp;the&nbsp;Host&nbsp;header&nbsp;value&nbsp;to&nbsp;send&nbsp;in&nbsp;the&nbsp;HTTP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2980670">//&nbsp;request.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2980683">URL</span>&nbsp;<span class="op" id="2980687">*</span><span class="ident" id="2980688">url</span><span class="op" id="2980691">.</span><span class="ident" id="2980692">URL</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2980698">//&nbsp;The&nbsp;protocol&nbsp;version&nbsp;for&nbsp;incoming&nbsp;requests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2980746">//&nbsp;Client&nbsp;requests&nbsp;always&nbsp;use&nbsp;HTTP/1.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2980787">Proto</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2980798">string</span>&nbsp;<span class="comment" id="2980805">//&nbsp;&#34;HTTP/1.0&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2980820">ProtoMajor</span>&nbsp;<span class="builtintype" id="2980831">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2980838">//&nbsp;1</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2980844">ProtoMinor</span>&nbsp;<span class="builtintype" id="2980855">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2980862">//&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2980869">//&nbsp;A&nbsp;header&nbsp;maps&nbsp;request&nbsp;lines&nbsp;to&nbsp;their&nbsp;values.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2980918">//&nbsp;If&nbsp;the&nbsp;header&nbsp;says</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2980941">//</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2980945">//&nbsp;&nbsp;&nbsp;&nbsp;accept-encoding:&nbsp;gzip,&nbsp;deflate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2980980">//&nbsp;&nbsp;&nbsp;&nbsp;Accept-Language:&nbsp;en-us</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2981007">//&nbsp;&nbsp;&nbsp;&nbsp;Connection:&nbsp;keep-alive</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2981034">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2981038">//&nbsp;then</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2981047">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2981051">//&nbsp;&nbsp;&nbsp;&nbsp;Header&nbsp;=&nbsp;map[string][]string{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2981085">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;Accept-Encoding&#34;:&nbsp;{&#34;gzip,&nbsp;deflate&#34;},</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2981128">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;Accept-Language&#34;:&nbsp;{&#34;en-us&#34;},</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2981163">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;Connection&#34;:&nbsp;{&#34;keep-alive&#34;},</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2981198">//&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2981204">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2981208">//&nbsp;HTTP&nbsp;defines&nbsp;that&nbsp;header&nbsp;names&nbsp;are&nbsp;case-insensitive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2981265">//&nbsp;The&nbsp;request&nbsp;parser&nbsp;implements&nbsp;this&nbsp;by&nbsp;canonicalizing&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2981326">//&nbsp;name,&nbsp;making&nbsp;the&nbsp;first&nbsp;character&nbsp;and&nbsp;any&nbsp;characters</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2981382">//&nbsp;following&nbsp;a&nbsp;hyphen&nbsp;uppercase&nbsp;and&nbsp;the&nbsp;rest&nbsp;lowercase.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2981439">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2981443">//&nbsp;For&nbsp;client&nbsp;requests&nbsp;certain&nbsp;headers&nbsp;are&nbsp;automatically</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2981501">//&nbsp;added&nbsp;and&nbsp;may&nbsp;override&nbsp;values&nbsp;in&nbsp;Header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2981546">//</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2981550">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;the&nbsp;Request.Write&nbsp;method.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2981606">Header</span>&nbsp;<span class="ident" id="2981613">Header</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2981622">//&nbsp;Body&nbsp;is&nbsp;the&nbsp;request&#39;s&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2981654">//</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2981658">//&nbsp;For&nbsp;client&nbsp;requests&nbsp;a&nbsp;nil&nbsp;body&nbsp;means&nbsp;the&nbsp;request&nbsp;has&nbsp;no</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2981718">//&nbsp;body,&nbsp;such&nbsp;as&nbsp;a&nbsp;GET&nbsp;request.&nbsp;The&nbsp;HTTP&nbsp;Client&#39;s&nbsp;Transport</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2981779">//&nbsp;is&nbsp;responsible&nbsp;for&nbsp;calling&nbsp;the&nbsp;Close&nbsp;method.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2981828">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2981832">//&nbsp;For&nbsp;server&nbsp;requests&nbsp;the&nbsp;Request&nbsp;Body&nbsp;is&nbsp;always&nbsp;non-nil</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2981891">//&nbsp;but&nbsp;will&nbsp;return&nbsp;EOF&nbsp;immediately&nbsp;when&nbsp;no&nbsp;body&nbsp;is&nbsp;present.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2981952">//&nbsp;The&nbsp;Server&nbsp;will&nbsp;close&nbsp;the&nbsp;request&nbsp;body.&nbsp;The&nbsp;ServeHTTP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2982010">//&nbsp;Handler&nbsp;does&nbsp;not&nbsp;need&nbsp;to.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2982040">Body</span>&nbsp;<span class="ident" id="2982045">io</span><span class="op" id="2982047">.</span><span class="ident" id="2982048">ReadCloser</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2982061">//&nbsp;ContentLength&nbsp;records&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;associated&nbsp;content.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2982125">//&nbsp;The&nbsp;value&nbsp;-1&nbsp;indicates&nbsp;that&nbsp;the&nbsp;length&nbsp;is&nbsp;unknown.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2982180">//&nbsp;Values&nbsp;&gt;=&nbsp;0&nbsp;indicate&nbsp;that&nbsp;the&nbsp;given&nbsp;number&nbsp;of&nbsp;bytes&nbsp;may</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2982240">//&nbsp;be&nbsp;read&nbsp;from&nbsp;Body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2982263">//&nbsp;For&nbsp;client&nbsp;requests,&nbsp;a&nbsp;value&nbsp;of&nbsp;0&nbsp;means&nbsp;unknown&nbsp;if&nbsp;Body&nbsp;is&nbsp;not&nbsp;nil.</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2982335">ContentLength</span>&nbsp;<span class="ident" id="2982349">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2982357">//&nbsp;TransferEncoding&nbsp;lists&nbsp;the&nbsp;transfer&nbsp;encodings&nbsp;from&nbsp;outermost&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2982425">//&nbsp;innermost.&nbsp;An&nbsp;empty&nbsp;list&nbsp;denotes&nbsp;the&nbsp;&#34;identity&#34;&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2982487">//&nbsp;TransferEncoding&nbsp;can&nbsp;usually&nbsp;be&nbsp;ignored;&nbsp;chunked&nbsp;encoding&nbsp;is</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2982552">//&nbsp;automatically&nbsp;added&nbsp;and&nbsp;removed&nbsp;as&nbsp;necessary&nbsp;when&nbsp;sending&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2982618">//&nbsp;receiving&nbsp;requests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2982642">TransferEncoding</span>&nbsp;<span class="op" id="2982659">[</span><span class="op" id="2982660">]</span><span class="builtintype" id="2982661">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2982670">//&nbsp;Close&nbsp;indicates&nbsp;whether&nbsp;to&nbsp;close&nbsp;the&nbsp;connection&nbsp;after</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2982728">//&nbsp;replying&nbsp;to&nbsp;this&nbsp;request&nbsp;(for&nbsp;servers)&nbsp;or&nbsp;after&nbsp;sending</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2982788">//&nbsp;the&nbsp;request&nbsp;(for&nbsp;clients).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2982819">Close</span>&nbsp;<span class="builtintype" id="2982825">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2982832">//&nbsp;For&nbsp;server&nbsp;requests&nbsp;Host&nbsp;specifies&nbsp;the&nbsp;host&nbsp;on&nbsp;which&nbsp;the</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2982893">//&nbsp;URL&nbsp;is&nbsp;sought.&nbsp;Per&nbsp;RFC&nbsp;2616,&nbsp;this&nbsp;is&nbsp;either&nbsp;the&nbsp;value&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2982954">//&nbsp;the&nbsp;&#34;Host&#34;&nbsp;header&nbsp;or&nbsp;the&nbsp;host&nbsp;name&nbsp;given&nbsp;in&nbsp;the&nbsp;URL&nbsp;itself.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2983018">//&nbsp;It&nbsp;may&nbsp;be&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;host:port&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2983057">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2983061">//&nbsp;For&nbsp;client&nbsp;requests&nbsp;Host&nbsp;optionally&nbsp;overrides&nbsp;the&nbsp;Host</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2983120">//&nbsp;header&nbsp;to&nbsp;send.&nbsp;If&nbsp;empty,&nbsp;the&nbsp;Request.Write&nbsp;method&nbsp;uses</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2983180">//&nbsp;the&nbsp;value&nbsp;of&nbsp;URL.Host.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2983207">Host</span>&nbsp;<span class="builtintype" id="2983212">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2983221">//&nbsp;Form&nbsp;contains&nbsp;the&nbsp;parsed&nbsp;form&nbsp;data,&nbsp;including&nbsp;both&nbsp;the&nbsp;URL</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2983284">//&nbsp;field&#39;s&nbsp;query&nbsp;parameters&nbsp;and&nbsp;the&nbsp;POST&nbsp;or&nbsp;PUT&nbsp;form&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2983344">//&nbsp;This&nbsp;field&nbsp;is&nbsp;only&nbsp;available&nbsp;after&nbsp;ParseForm&nbsp;is&nbsp;called.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2983404">//&nbsp;The&nbsp;HTTP&nbsp;client&nbsp;ignores&nbsp;Form&nbsp;and&nbsp;uses&nbsp;Body&nbsp;instead.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2983460">Form</span>&nbsp;<span class="ident" id="2983465">url</span><span class="op" id="2983468">.</span><span class="ident" id="2983469">Values</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2983478">//&nbsp;PostForm&nbsp;contains&nbsp;the&nbsp;parsed&nbsp;form&nbsp;data&nbsp;from&nbsp;POST&nbsp;or&nbsp;PUT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2983538">//&nbsp;body&nbsp;parameters.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2983559">//&nbsp;This&nbsp;field&nbsp;is&nbsp;only&nbsp;available&nbsp;after&nbsp;ParseForm&nbsp;is&nbsp;called.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2983619">//&nbsp;The&nbsp;HTTP&nbsp;client&nbsp;ignores&nbsp;PostForm&nbsp;and&nbsp;uses&nbsp;Body&nbsp;instead.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2983679">PostForm</span>&nbsp;<span class="ident" id="2983688">url</span><span class="op" id="2983691">.</span><span class="ident" id="2983692">Values</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2983701">//&nbsp;MultipartForm&nbsp;is&nbsp;the&nbsp;parsed&nbsp;multipart&nbsp;form,&nbsp;including&nbsp;file&nbsp;uploads.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2983773">//&nbsp;This&nbsp;field&nbsp;is&nbsp;only&nbsp;available&nbsp;after&nbsp;ParseMultipartForm&nbsp;is&nbsp;called.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2983842">//&nbsp;The&nbsp;HTTP&nbsp;client&nbsp;ignores&nbsp;MultipartForm&nbsp;and&nbsp;uses&nbsp;Body&nbsp;instead.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2983907">MultipartForm</span>&nbsp;<span class="op" id="2983921">*</span><span class="ident" id="2983922">multipart</span><span class="op" id="2983931">.</span><span class="ident" id="2983932">Form</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2983939">//&nbsp;Trailer&nbsp;specifies&nbsp;additional&nbsp;headers&nbsp;that&nbsp;are&nbsp;sent&nbsp;after&nbsp;the&nbsp;request</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2984012">//&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2984022">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2984026">//&nbsp;For&nbsp;server&nbsp;requests&nbsp;the&nbsp;Trailer&nbsp;map&nbsp;initially&nbsp;contains&nbsp;only&nbsp;the</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2984094">//&nbsp;trailer&nbsp;keys,&nbsp;with&nbsp;nil&nbsp;values.&nbsp;(The&nbsp;client&nbsp;declares&nbsp;which&nbsp;trailers&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2984168">//&nbsp;will&nbsp;later&nbsp;send.)&nbsp;&nbsp;While&nbsp;the&nbsp;handler&nbsp;is&nbsp;reading&nbsp;from&nbsp;Body,&nbsp;it&nbsp;must</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2984239">//&nbsp;not&nbsp;reference&nbsp;Trailer.&nbsp;After&nbsp;reading&nbsp;from&nbsp;Body&nbsp;returns&nbsp;EOF,&nbsp;Trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2984311">//&nbsp;can&nbsp;be&nbsp;read&nbsp;again&nbsp;and&nbsp;will&nbsp;contain&nbsp;non-nil&nbsp;values,&nbsp;if&nbsp;they&nbsp;were&nbsp;sent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2984384">//&nbsp;by&nbsp;the&nbsp;client.</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2984403">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2984407">//&nbsp;For&nbsp;client&nbsp;requests&nbsp;Trailer&nbsp;must&nbsp;be&nbsp;initialized&nbsp;to&nbsp;a&nbsp;map&nbsp;containing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2984479">//&nbsp;the&nbsp;trailer&nbsp;keys&nbsp;to&nbsp;later&nbsp;send.&nbsp;The&nbsp;values&nbsp;may&nbsp;be&nbsp;nil&nbsp;or&nbsp;their&nbsp;final</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2984552">//&nbsp;values.&nbsp;The&nbsp;ContentLength&nbsp;must&nbsp;be&nbsp;0&nbsp;or&nbsp;-1,&nbsp;to&nbsp;send&nbsp;a&nbsp;chunked&nbsp;request.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2984626">//&nbsp;After&nbsp;the&nbsp;HTTP&nbsp;request&nbsp;is&nbsp;sent&nbsp;the&nbsp;map&nbsp;values&nbsp;can&nbsp;be&nbsp;updated&nbsp;while</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2984697">//&nbsp;the&nbsp;request&nbsp;body&nbsp;is&nbsp;read.&nbsp;Once&nbsp;the&nbsp;body&nbsp;returns&nbsp;EOF,&nbsp;the&nbsp;caller&nbsp;must</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2984770">//&nbsp;not&nbsp;mutate&nbsp;Trailer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2984794">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2984798">//&nbsp;Few&nbsp;HTTP&nbsp;clients,&nbsp;servers,&nbsp;or&nbsp;proxies&nbsp;support&nbsp;HTTP&nbsp;trailers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2984863">Trailer</span>&nbsp;<span class="ident" id="2984871">Header</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2984880">//&nbsp;RemoteAddr&nbsp;allows&nbsp;HTTP&nbsp;servers&nbsp;and&nbsp;other&nbsp;software&nbsp;to&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2984944">//&nbsp;the&nbsp;network&nbsp;address&nbsp;that&nbsp;sent&nbsp;the&nbsp;request,&nbsp;usually&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2985003">//&nbsp;logging.&nbsp;This&nbsp;field&nbsp;is&nbsp;not&nbsp;filled&nbsp;in&nbsp;by&nbsp;ReadRequest&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2985063">//&nbsp;has&nbsp;no&nbsp;defined&nbsp;format.&nbsp;The&nbsp;HTTP&nbsp;server&nbsp;in&nbsp;this&nbsp;package</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2985122">//&nbsp;sets&nbsp;RemoteAddr&nbsp;to&nbsp;an&nbsp;&#34;IP:port&#34;&nbsp;address&nbsp;before&nbsp;invoking&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2985184">//&nbsp;handler.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2985197">//&nbsp;This&nbsp;field&nbsp;is&nbsp;ignored&nbsp;by&nbsp;the&nbsp;HTTP&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2985243">RemoteAddr</span>&nbsp;<span class="builtintype" id="2985254">string</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2985263">//&nbsp;RequestURI&nbsp;is&nbsp;the&nbsp;unmodified&nbsp;Request-URI&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2985315">//&nbsp;Request-Line&nbsp;(RFC&nbsp;2616,&nbsp;Section&nbsp;5.1)&nbsp;as&nbsp;sent&nbsp;by&nbsp;the&nbsp;client</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2985378">//&nbsp;to&nbsp;a&nbsp;server.&nbsp;Usually&nbsp;the&nbsp;URL&nbsp;field&nbsp;should&nbsp;be&nbsp;used&nbsp;instead.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2985441">//&nbsp;It&nbsp;is&nbsp;an&nbsp;error&nbsp;to&nbsp;set&nbsp;this&nbsp;field&nbsp;in&nbsp;an&nbsp;HTTP&nbsp;client&nbsp;request.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2985505">RequestURI</span>&nbsp;<span class="builtintype" id="2985516">string</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2985525">//&nbsp;TLS&nbsp;allows&nbsp;HTTP&nbsp;servers&nbsp;and&nbsp;other&nbsp;software&nbsp;to&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2985582">//&nbsp;information&nbsp;about&nbsp;the&nbsp;TLS&nbsp;connection&nbsp;on&nbsp;which&nbsp;the&nbsp;request</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2985644">//&nbsp;was&nbsp;received.&nbsp;This&nbsp;field&nbsp;is&nbsp;not&nbsp;filled&nbsp;in&nbsp;by&nbsp;ReadRequest.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2985706">//&nbsp;The&nbsp;HTTP&nbsp;server&nbsp;in&nbsp;this&nbsp;package&nbsp;sets&nbsp;the&nbsp;field&nbsp;for</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2985761">//&nbsp;TLS-enabled&nbsp;connections&nbsp;before&nbsp;invoking&nbsp;a&nbsp;handler;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2985816">//&nbsp;otherwise&nbsp;it&nbsp;leaves&nbsp;the&nbsp;field&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2985855">//&nbsp;This&nbsp;field&nbsp;is&nbsp;ignored&nbsp;by&nbsp;the&nbsp;HTTP&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2985901">TLS</span>&nbsp;<span class="op" id="2985905">*</span><span class="ident" id="2985906">tls</span><span class="op" id="2985909">.</span><span class="ident" id="2985910">ConnectionState</span><br>
<span class="lineno"></span><span class="op" id="2985926">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="2985929">//&nbsp;ProtoAtLeast&nbsp;reports&nbsp;whether&nbsp;the&nbsp;HTTP&nbsp;protocol&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="2985984">//&nbsp;in&nbsp;the&nbsp;request&nbsp;is&nbsp;at&nbsp;least&nbsp;major.minor.</span><br>
<span class="lineno"></span><span class="keyword" id="2986027">func</span>&nbsp;<span class="op" id="2986032">(</span><span class="ident" id="2986033">r</span>&nbsp;<span class="op" id="2986035">*</span><span class="ident" id="2986036">Request</span><span class="op" id="2986043">)</span>&nbsp;<span class="ident" id="2986045">ProtoAtLeast</span><span class="op" id="2986057">(</span><span class="ident" id="2986058">major</span><span class="op" id="2986063">,</span>&nbsp;<span class="ident" id="2986065">minor</span>&nbsp;<span class="builtintype" id="2986071">int</span><span class="op" id="2986074">)</span>&nbsp;<span class="builtintype" id="2986076">bool</span>&nbsp;<span class="op" id="2986081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2986084">return</span>&nbsp;<span class="ident" id="2986091">r</span><span class="op" id="2986092">.</span><span class="ident" id="2986093">ProtoMajor</span>&nbsp;<span class="op" id="2986104">&gt;</span>&nbsp;<span class="ident" id="2986106">major</span>&nbsp;<span class="op" id="2986112">||</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2986117">r</span><span class="op" id="2986118">.</span><span class="ident" id="2986119">ProtoMajor</span>&nbsp;<span class="op" id="2986130">==</span>&nbsp;<span class="ident" id="2986133">major</span>&nbsp;<span class="op" id="2986139">&amp;&amp;</span>&nbsp;<span class="ident" id="2986142">r</span><span class="op" id="2986143">.</span><span class="ident" id="2986144">ProtoMinor</span>&nbsp;<span class="op" id="2986155">&gt;=</span>&nbsp;<span class="ident" id="2986158">minor</span><br>
<span class="lineno"></span><span class="op" id="2986164">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2986167">//&nbsp;UserAgent&nbsp;returns&nbsp;the&nbsp;client&#39;s&nbsp;User-Agent,&nbsp;if&nbsp;sent&nbsp;in&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span><span class="keyword" id="2986237">func</span>&nbsp;<span class="op" id="2986242">(</span><span class="ident" id="2986243">r</span>&nbsp;<span class="op" id="2986245">*</span><span class="ident" id="2986246">Request</span><span class="op" id="2986253">)</span>&nbsp;<span class="ident" id="2986255">UserAgent</span><span class="op" id="2986264">(</span><span class="op" id="2986265">)</span>&nbsp;<span class="builtintype" id="2986267">string</span>&nbsp;<span class="op" id="2986274">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2986277">return</span>&nbsp;<span class="ident" id="2986284">r</span><span class="op" id="2986285">.</span><span class="ident" id="2986286">Header</span><span class="op" id="2986292">.</span><span class="ident" id="2986293">Get</span><span class="op" id="2986296">(</span><span class="string" id="2986297">&#34;User-Agent&#34;</span><span class="op" id="2986309">)</span><br>
<span class="lineno"></span><span class="op" id="2986311">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2986314">//&nbsp;Cookies&nbsp;parses&nbsp;and&nbsp;returns&nbsp;the&nbsp;HTTP&nbsp;cookies&nbsp;sent&nbsp;with&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span><span class="keyword" id="2986384">func</span>&nbsp;<span class="op" id="2986389">(</span><span class="ident" id="2986390">r</span>&nbsp;<span class="op" id="2986392">*</span><span class="ident" id="2986393">Request</span><span class="op" id="2986400">)</span>&nbsp;<span class="ident" id="2986402">Cookies</span><span class="op" id="2986409">(</span><span class="op" id="2986410">)</span>&nbsp;<span class="op" id="2986412">[</span><span class="op" id="2986413">]</span><span class="op" id="2986414">*</span><span class="ident" id="2986415">Cookie</span>&nbsp;<span class="op" id="2986422">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2986425">return</span>&nbsp;<span class="ident" id="2986432">readCookies</span><span class="op" id="2986443">(</span><span class="ident" id="2986444">r</span><span class="op" id="2986445">.</span><span class="ident" id="2986446">Header</span><span class="op" id="2986452">,</span>&nbsp;<span class="string" id="2986454">&#34;&#34;</span><span class="op" id="2986456">)</span><br>
<span class="lineno"></span><span class="op" id="2986458">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2986461">var</span>&nbsp;<span class="ident" id="2986465">ErrNoCookie</span>&nbsp;<span class="op" id="2986477">=</span>&nbsp;<span class="ident" id="2986479">errors</span><span class="op" id="2986485">.</span><span class="ident" id="2986486">New</span><span class="op" id="2986489">(</span><span class="string" id="2986490">&#34;http:&nbsp;named&nbsp;cookie&nbsp;not&nbsp;present&#34;</span><span class="op" id="2986522">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="comment" id="2986525">//&nbsp;Cookie&nbsp;returns&nbsp;the&nbsp;named&nbsp;cookie&nbsp;provided&nbsp;in&nbsp;the&nbsp;request&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="2986587">//&nbsp;ErrNoCookie&nbsp;if&nbsp;not&nbsp;found.</span><br>
<span class="lineno"></span><span class="keyword" id="2986616">func</span>&nbsp;<span class="op" id="2986621">(</span><span class="ident" id="2986622">r</span>&nbsp;<span class="op" id="2986624">*</span><span class="ident" id="2986625">Request</span><span class="op" id="2986632">)</span>&nbsp;<span class="ident" id="2986634">Cookie</span><span class="op" id="2986640">(</span><span class="ident" id="2986641">name</span>&nbsp;<span class="builtintype" id="2986646">string</span><span class="op" id="2986652">)</span>&nbsp;<span class="op" id="2986654">(</span><span class="op" id="2986655">*</span><span class="ident" id="2986656">Cookie</span><span class="op" id="2986662">,</span>&nbsp;<span class="builtintype" id="2986664">error</span><span class="op" id="2986669">)</span>&nbsp;<span class="op" id="2986671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2986674">for</span>&nbsp;<span class="ident" id="2986678">_</span><span class="op" id="2986679">,</span>&nbsp;<span class="ident" id="2986681">c</span>&nbsp;<span class="op" id="2986683">:=</span>&nbsp;<span class="keyword" id="2986686">range</span>&nbsp;<span class="ident" id="2986692">readCookies</span><span class="op" id="2986703">(</span><span class="ident" id="2986704">r</span><span class="op" id="2986705">.</span><span class="ident" id="2986706">Header</span><span class="op" id="2986712">,</span>&nbsp;<span class="ident" id="2986714">name</span><span class="op" id="2986718">)</span>&nbsp;<span class="op" id="2986720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2986724">return</span>&nbsp;<span class="ident" id="2986731">c</span><span class="op" id="2986732">,</span>&nbsp;<span class="builtintype" id="2986734">nil</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2986739">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2986742">return</span>&nbsp;<span class="builtintype" id="2986749">nil</span><span class="op" id="2986752">,</span>&nbsp;<span class="ident" id="2986754">ErrNoCookie</span><br>
<span class="lineno"></span><span class="op" id="2986766">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2986769">//&nbsp;AddCookie&nbsp;adds&nbsp;a&nbsp;cookie&nbsp;to&nbsp;the&nbsp;request.&nbsp;&nbsp;Per&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.4,</span><br>
<span class="lineno">260</span><span class="comment" id="2986839">//&nbsp;AddCookie&nbsp;does&nbsp;not&nbsp;attach&nbsp;more&nbsp;than&nbsp;one&nbsp;Cookie&nbsp;header&nbsp;field.&nbsp;&nbsp;That</span><br>
<span class="lineno"></span><span class="comment" id="2986909">//&nbsp;means&nbsp;all&nbsp;cookies,&nbsp;if&nbsp;any,&nbsp;are&nbsp;written&nbsp;into&nbsp;the&nbsp;same&nbsp;line,</span><br>
<span class="lineno"></span><span class="comment" id="2986971">//&nbsp;separated&nbsp;by&nbsp;semicolon.</span><br>
<span class="lineno"></span><span class="keyword" id="2986998">func</span>&nbsp;<span class="op" id="2987003">(</span><span class="ident" id="2987004">r</span>&nbsp;<span class="op" id="2987006">*</span><span class="ident" id="2987007">Request</span><span class="op" id="2987014">)</span>&nbsp;<span class="ident" id="2987016">AddCookie</span><span class="op" id="2987025">(</span><span class="ident" id="2987026">c</span>&nbsp;<span class="op" id="2987028">*</span><span class="ident" id="2987029">Cookie</span><span class="op" id="2987035">)</span>&nbsp;<span class="op" id="2987037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2987040">s</span>&nbsp;<span class="op" id="2987042">:=</span>&nbsp;<span class="ident" id="2987045">fmt</span><span class="op" id="2987048">.</span><span class="ident" id="2987049">Sprintf</span><span class="op" id="2987056">(</span><span class="string" id="2987057">&#34;%s=%s&#34;</span><span class="op" id="2987064">,</span>&nbsp;<span class="ident" id="2987066">sanitizeCookieName</span><span class="op" id="2987084">(</span><span class="ident" id="2987085">c</span><span class="op" id="2987086">.</span><span class="ident" id="2987087">Name</span><span class="op" id="2987091">)</span><span class="op" id="2987092">,</span>&nbsp;<span class="ident" id="2987094">sanitizeCookieValue</span><span class="op" id="2987113">(</span><span class="ident" id="2987114">c</span><span class="op" id="2987115">.</span><span class="ident" id="2987116">Value</span><span class="op" id="2987121">)</span><span class="op" id="2987122">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2987125">if</span>&nbsp;<span class="ident" id="2987128">c</span>&nbsp;<span class="op" id="2987130">:=</span>&nbsp;<span class="ident" id="2987133">r</span><span class="op" id="2987134">.</span><span class="ident" id="2987135">Header</span><span class="op" id="2987141">.</span><span class="ident" id="2987142">Get</span><span class="op" id="2987145">(</span><span class="string" id="2987146">&#34;Cookie&#34;</span><span class="op" id="2987154">)</span><span class="op" id="2987155">;</span>&nbsp;<span class="ident" id="2987157">c</span>&nbsp;<span class="op" id="2987159">!=</span>&nbsp;<span class="string" id="2987162">&#34;&#34;</span>&nbsp;<span class="op" id="2987165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2987169">r</span><span class="op" id="2987170">.</span><span class="ident" id="2987171">Header</span><span class="op" id="2987177">.</span><span class="ident" id="2987178">Set</span><span class="op" id="2987181">(</span><span class="string" id="2987182">&#34;Cookie&#34;</span><span class="op" id="2987190">,</span>&nbsp;<span class="ident" id="2987192">c</span><span class="op" id="2987193">+</span><span class="string" id="2987194">&#34;;&nbsp;&#34;</span><span class="op" id="2987198">+</span><span class="ident" id="2987199">s</span><span class="op" id="2987200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2987203">}</span>&nbsp;<span class="keyword" id="2987205">else</span>&nbsp;<span class="op" id="2987210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2987214">r</span><span class="op" id="2987215">.</span><span class="ident" id="2987216">Header</span><span class="op" id="2987222">.</span><span class="ident" id="2987223">Set</span><span class="op" id="2987226">(</span><span class="string" id="2987227">&#34;Cookie&#34;</span><span class="op" id="2987235">,</span>&nbsp;<span class="ident" id="2987237">s</span><span class="op" id="2987238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2987241">}</span><br>
<span class="lineno">270</span><span class="op" id="2987243">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2987246">//&nbsp;Referer&nbsp;returns&nbsp;the&nbsp;referring&nbsp;URL,&nbsp;if&nbsp;sent&nbsp;in&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span><span class="comment" id="2987308">//</span><br>
<span class="lineno"></span><span class="comment" id="2987311">//&nbsp;Referer&nbsp;is&nbsp;misspelled&nbsp;as&nbsp;in&nbsp;the&nbsp;request&nbsp;itself,&nbsp;a&nbsp;mistake&nbsp;from&nbsp;the</span><br>
<span class="lineno">275</span><span class="comment" id="2987381">//&nbsp;earliest&nbsp;days&nbsp;of&nbsp;HTTP.&nbsp;&nbsp;This&nbsp;value&nbsp;can&nbsp;also&nbsp;be&nbsp;fetched&nbsp;from&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2987448">//&nbsp;Header&nbsp;map&nbsp;as&nbsp;Header[&#34;Referer&#34;];&nbsp;the&nbsp;benefit&nbsp;of&nbsp;making&nbsp;it&nbsp;available</span><br>
<span class="lineno"></span><span class="comment" id="2987519">//&nbsp;as&nbsp;a&nbsp;method&nbsp;is&nbsp;that&nbsp;the&nbsp;compiler&nbsp;can&nbsp;diagnose&nbsp;programs&nbsp;that&nbsp;use&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2987590">//&nbsp;alternate&nbsp;(correct&nbsp;English)&nbsp;spelling&nbsp;req.Referrer()&nbsp;but&nbsp;cannot</span><br>
<span class="lineno"></span><span class="comment" id="2987656">//&nbsp;diagnose&nbsp;programs&nbsp;that&nbsp;use&nbsp;Header[&#34;Referrer&#34;].</span><br>
<span class="lineno">280</span><span class="keyword" id="2987706">func</span>&nbsp;<span class="op" id="2987711">(</span><span class="ident" id="2987712">r</span>&nbsp;<span class="op" id="2987714">*</span><span class="ident" id="2987715">Request</span><span class="op" id="2987722">)</span>&nbsp;<span class="ident" id="2987724">Referer</span><span class="op" id="2987731">(</span><span class="op" id="2987732">)</span>&nbsp;<span class="builtintype" id="2987734">string</span>&nbsp;<span class="op" id="2987741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2987744">return</span>&nbsp;<span class="ident" id="2987751">r</span><span class="op" id="2987752">.</span><span class="ident" id="2987753">Header</span><span class="op" id="2987759">.</span><span class="ident" id="2987760">Get</span><span class="op" id="2987763">(</span><span class="string" id="2987764">&#34;Referer&#34;</span><span class="op" id="2987773">)</span><br>
<span class="lineno"></span><span class="op" id="2987775">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2987778">//&nbsp;multipartByReader&nbsp;is&nbsp;a&nbsp;sentinel&nbsp;value.</span><br>
<span class="lineno">285</span><span class="comment" id="2987820">//&nbsp;Its&nbsp;presence&nbsp;in&nbsp;Request.MultipartForm&nbsp;indicates&nbsp;that&nbsp;parsing&nbsp;of&nbsp;the&nbsp;request</span><br>
<span class="lineno"></span><span class="comment" id="2987899">//&nbsp;body&nbsp;has&nbsp;been&nbsp;handed&nbsp;off&nbsp;to&nbsp;a&nbsp;MultipartReader&nbsp;instead&nbsp;of&nbsp;ParseMultipartFrom.</span><br>
<span class="lineno"></span><span class="keyword" id="2987979">var</span>&nbsp;<span class="ident" id="2987983">multipartByReader</span>&nbsp;<span class="op" id="2988001">=</span>&nbsp;<span class="op" id="2988003">&amp;</span><span class="ident" id="2988004">multipart</span><span class="op" id="2988013">.</span><span class="ident" id="2988014">Form</span><span class="op" id="2988018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2988021">Value</span><span class="op" id="2988026">:</span>&nbsp;<span class="builtinfunc" id="2988028">make</span><span class="op" id="2988032">(</span><span class="keyword" id="2988033">map</span><span class="op" id="2988036">[</span><span class="builtintype" id="2988037">string</span><span class="op" id="2988043">]</span><span class="op" id="2988044">[</span><span class="op" id="2988045">]</span><span class="builtintype" id="2988046">string</span><span class="op" id="2988052">)</span><span class="op" id="2988053">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2988056">File</span><span class="op" id="2988060">:</span>&nbsp;&nbsp;<span class="builtinfunc" id="2988063">make</span><span class="op" id="2988067">(</span><span class="keyword" id="2988068">map</span><span class="op" id="2988071">[</span><span class="builtintype" id="2988072">string</span><span class="op" id="2988078">]</span><span class="op" id="2988079">[</span><span class="op" id="2988080">]</span><span class="op" id="2988081">*</span><span class="ident" id="2988082">multipart</span><span class="op" id="2988091">.</span><span class="ident" id="2988092">FileHeader</span><span class="op" id="2988102">)</span><span class="op" id="2988103">,</span><br>
<span class="lineno">290</span><span class="op" id="2988105">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2988108">//&nbsp;MultipartReader&nbsp;returns&nbsp;a&nbsp;MIME&nbsp;multipart&nbsp;reader&nbsp;if&nbsp;this&nbsp;is&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="2988172">//&nbsp;multipart/form-data&nbsp;POST&nbsp;request,&nbsp;else&nbsp;returns&nbsp;nil&nbsp;and&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="2988240">//&nbsp;Use&nbsp;this&nbsp;function&nbsp;instead&nbsp;of&nbsp;ParseMultipartForm&nbsp;to</span><br>
<span class="lineno">295</span><span class="comment" id="2988294">//&nbsp;process&nbsp;the&nbsp;request&nbsp;body&nbsp;as&nbsp;a&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="2988335">func</span>&nbsp;<span class="op" id="2988340">(</span><span class="ident" id="2988341">r</span>&nbsp;<span class="op" id="2988343">*</span><span class="ident" id="2988344">Request</span><span class="op" id="2988351">)</span>&nbsp;<span class="ident" id="2988353">MultipartReader</span><span class="op" id="2988368">(</span><span class="op" id="2988369">)</span>&nbsp;<span class="op" id="2988371">(</span><span class="op" id="2988372">*</span><span class="ident" id="2988373">multipart</span><span class="op" id="2988382">.</span><span class="ident" id="2988383">Reader</span><span class="op" id="2988389">,</span>&nbsp;<span class="builtintype" id="2988391">error</span><span class="op" id="2988396">)</span>&nbsp;<span class="op" id="2988398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2988401">if</span>&nbsp;<span class="ident" id="2988404">r</span><span class="op" id="2988405">.</span><span class="ident" id="2988406">MultipartForm</span>&nbsp;<span class="op" id="2988420">==</span>&nbsp;<span class="ident" id="2988423">multipartByReader</span>&nbsp;<span class="op" id="2988441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2988445">return</span>&nbsp;<span class="builtintype" id="2988452">nil</span><span class="op" id="2988455">,</span>&nbsp;<span class="ident" id="2988457">errors</span><span class="op" id="2988463">.</span><span class="ident" id="2988464">New</span><span class="op" id="2988467">(</span><span class="string" id="2988468">&#34;http:&nbsp;MultipartReader&nbsp;called&nbsp;twice&#34;</span><span class="op" id="2988504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2988507">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2988510">if</span>&nbsp;<span class="ident" id="2988513">r</span><span class="op" id="2988514">.</span><span class="ident" id="2988515">MultipartForm</span>&nbsp;<span class="op" id="2988529">!=</span>&nbsp;<span class="builtintype" id="2988532">nil</span>&nbsp;<span class="op" id="2988536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2988540">return</span>&nbsp;<span class="builtintype" id="2988547">nil</span><span class="op" id="2988550">,</span>&nbsp;<span class="ident" id="2988552">errors</span><span class="op" id="2988558">.</span><span class="ident" id="2988559">New</span><span class="op" id="2988562">(</span><span class="string" id="2988563">&#34;http:&nbsp;multipart&nbsp;handled&nbsp;by&nbsp;ParseMultipartForm&#34;</span><span class="op" id="2988610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2988613">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2988616">r</span><span class="op" id="2988617">.</span><span class="ident" id="2988618">MultipartForm</span>&nbsp;<span class="op" id="2988632">=</span>&nbsp;<span class="ident" id="2988634">multipartByReader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2988653">return</span>&nbsp;<span class="ident" id="2988660">r</span><span class="op" id="2988661">.</span><span class="ident" id="2988662">multipartReader</span><span class="op" id="2988677">(</span><span class="op" id="2988678">)</span><br>
<span class="lineno">305</span><span class="op" id="2988680">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2988683">func</span>&nbsp;<span class="op" id="2988688">(</span><span class="ident" id="2988689">r</span>&nbsp;<span class="op" id="2988691">*</span><span class="ident" id="2988692">Request</span><span class="op" id="2988699">)</span>&nbsp;<span class="ident" id="2988701">multipartReader</span><span class="op" id="2988716">(</span><span class="op" id="2988717">)</span>&nbsp;<span class="op" id="2988719">(</span><span class="op" id="2988720">*</span><span class="ident" id="2988721">multipart</span><span class="op" id="2988730">.</span><span class="ident" id="2988731">Reader</span><span class="op" id="2988737">,</span>&nbsp;<span class="builtintype" id="2988739">error</span><span class="op" id="2988744">)</span>&nbsp;<span class="op" id="2988746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2988749">v</span>&nbsp;<span class="op" id="2988751">:=</span>&nbsp;<span class="ident" id="2988754">r</span><span class="op" id="2988755">.</span><span class="ident" id="2988756">Header</span><span class="op" id="2988762">.</span><span class="ident" id="2988763">Get</span><span class="op" id="2988766">(</span><span class="string" id="2988767">&#34;Content-Type&#34;</span><span class="op" id="2988781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2988784">if</span>&nbsp;<span class="ident" id="2988787">v</span>&nbsp;<span class="op" id="2988789">==</span>&nbsp;<span class="string" id="2988792">&#34;&#34;</span>&nbsp;<span class="op" id="2988795">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2988799">return</span>&nbsp;<span class="builtintype" id="2988806">nil</span><span class="op" id="2988809">,</span>&nbsp;<span class="ident" id="2988811">ErrNotMultipart</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2988828">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2988831">d</span><span class="op" id="2988832">,</span>&nbsp;<span class="ident" id="2988834">params</span><span class="op" id="2988840">,</span>&nbsp;<span class="ident" id="2988842">err</span>&nbsp;<span class="op" id="2988846">:=</span>&nbsp;<span class="ident" id="2988849">mime</span><span class="op" id="2988853">.</span><span class="ident" id="2988854">ParseMediaType</span><span class="op" id="2988868">(</span><span class="ident" id="2988869">v</span><span class="op" id="2988870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2988873">if</span>&nbsp;<span class="ident" id="2988876">err</span>&nbsp;<span class="op" id="2988880">!=</span>&nbsp;<span class="builtintype" id="2988883">nil</span>&nbsp;<span class="op" id="2988887">||</span>&nbsp;<span class="ident" id="2988890">d</span>&nbsp;<span class="op" id="2988892">!=</span>&nbsp;<span class="string" id="2988895">&#34;multipart/form-data&#34;</span>&nbsp;<span class="op" id="2988917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2988921">return</span>&nbsp;<span class="builtintype" id="2988928">nil</span><span class="op" id="2988931">,</span>&nbsp;<span class="ident" id="2988933">ErrNotMultipart</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2988950">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2988953">boundary</span><span class="op" id="2988961">,</span>&nbsp;<span class="ident" id="2988963">ok</span>&nbsp;<span class="op" id="2988966">:=</span>&nbsp;<span class="ident" id="2988969">params</span><span class="op" id="2988975">[</span><span class="string" id="2988976">&#34;boundary&#34;</span><span class="op" id="2988986">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2988989">if</span>&nbsp;<span class="op" id="2988992">!</span><span class="ident" id="2988993">ok</span>&nbsp;<span class="op" id="2988996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2989000">return</span>&nbsp;<span class="builtintype" id="2989007">nil</span><span class="op" id="2989010">,</span>&nbsp;<span class="ident" id="2989012">ErrMissingBoundary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2989032">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2989035">return</span>&nbsp;<span class="ident" id="2989042">multipart</span><span class="op" id="2989051">.</span><span class="ident" id="2989052">NewReader</span><span class="op" id="2989061">(</span><span class="ident" id="2989062">r</span><span class="op" id="2989063">.</span><span class="ident" id="2989064">Body</span><span class="op" id="2989068">,</span>&nbsp;<span class="ident" id="2989070">boundary</span><span class="op" id="2989078">)</span><span class="op" id="2989079">,</span>&nbsp;<span class="builtintype" id="2989081">nil</span><br>
<span class="lineno"></span><span class="op" id="2989085">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2989088">//&nbsp;Return&nbsp;value&nbsp;if&nbsp;nonempty,&nbsp;def&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="keyword" id="2989132">func</span>&nbsp;<span class="ident" id="2989137">valueOrDefault</span><span class="op" id="2989151">(</span><span class="ident" id="2989152">value</span><span class="op" id="2989157">,</span>&nbsp;<span class="ident" id="2989159">def</span>&nbsp;<span class="builtintype" id="2989163">string</span><span class="op" id="2989169">)</span>&nbsp;<span class="builtintype" id="2989171">string</span>&nbsp;<span class="op" id="2989178">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2989181">if</span>&nbsp;<span class="ident" id="2989184">value</span>&nbsp;<span class="op" id="2989190">!=</span>&nbsp;<span class="string" id="2989193">&#34;&#34;</span>&nbsp;<span class="op" id="2989196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2989200">return</span>&nbsp;<span class="ident" id="2989207">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2989214">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2989217">return</span>&nbsp;<span class="ident" id="2989224">def</span><br>
<span class="lineno"></span><span class="op" id="2989228">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="comment" id="2989231">//&nbsp;NOTE:&nbsp;This&nbsp;is&nbsp;not&nbsp;intended&nbsp;to&nbsp;reflect&nbsp;the&nbsp;actual&nbsp;Go&nbsp;version&nbsp;being&nbsp;used.</span><br>
<span class="lineno"></span><span class="comment" id="2989306">//&nbsp;It&nbsp;was&nbsp;changed&nbsp;from&nbsp;&#34;Go&nbsp;http&nbsp;package&#34;&nbsp;to&nbsp;&#34;Go&nbsp;1.1&nbsp;package&nbsp;http&#34;&nbsp;at&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2989379">//&nbsp;time&nbsp;of&nbsp;the&nbsp;Go&nbsp;1.1&nbsp;release&nbsp;because&nbsp;the&nbsp;former&nbsp;User-Agent&nbsp;had&nbsp;ended&nbsp;up</span><br>
<span class="lineno"></span><span class="comment" id="2989452">//&nbsp;on&nbsp;a&nbsp;blacklist&nbsp;for&nbsp;some&nbsp;intrusion&nbsp;detection&nbsp;systems.</span><br>
<span class="lineno">335</span><span class="comment" id="2989508">//&nbsp;See&nbsp;https://codereview.appspot.com/7532043.</span><br>
<span class="lineno"></span><span class="keyword" id="2989555">const</span>&nbsp;<span class="ident" id="2989561">defaultUserAgent</span>&nbsp;<span class="op" id="2989578">=</span>&nbsp;<span class="string" id="2989580">&#34;Go&nbsp;1.1&nbsp;package&nbsp;http&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2989603">//&nbsp;Write&nbsp;writes&nbsp;an&nbsp;HTTP/1.1&nbsp;request&nbsp;--&nbsp;header&nbsp;and&nbsp;body&nbsp;--&nbsp;in&nbsp;wire&nbsp;format.</span><br>
<span class="lineno"></span><span class="comment" id="2989677">//&nbsp;This&nbsp;method&nbsp;consults&nbsp;the&nbsp;following&nbsp;fields&nbsp;of&nbsp;the&nbsp;request:</span><br>
<span class="lineno">340</span><span class="comment" id="2989738">//&nbsp;&nbsp;&nbsp;&nbsp;Host</span><br>
<span class="lineno"></span><span class="comment" id="2989746">//&nbsp;&nbsp;&nbsp;&nbsp;URL</span><br>
<span class="lineno"></span><span class="comment" id="2989753">//&nbsp;&nbsp;&nbsp;&nbsp;Method&nbsp;(defaults&nbsp;to&nbsp;&#34;GET&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="2989783">//&nbsp;&nbsp;&nbsp;&nbsp;Header</span><br>
<span class="lineno"></span><span class="comment" id="2989793">//&nbsp;&nbsp;&nbsp;&nbsp;ContentLength</span><br>
<span class="lineno">345</span><span class="comment" id="2989810">//&nbsp;&nbsp;&nbsp;&nbsp;TransferEncoding</span><br>
<span class="lineno"></span><span class="comment" id="2989830">//&nbsp;&nbsp;&nbsp;&nbsp;Body</span><br>
<span class="lineno"></span><span class="comment" id="2989838">//</span><br>
<span class="lineno"></span><span class="comment" id="2989841">//&nbsp;If&nbsp;Body&nbsp;is&nbsp;present,&nbsp;Content-Length&nbsp;is&nbsp;&lt;=&nbsp;0&nbsp;and&nbsp;TransferEncoding</span><br>
<span class="lineno"></span><span class="comment" id="2989908">//&nbsp;hasn&#39;t&nbsp;been&nbsp;set&nbsp;to&nbsp;&#34;identity&#34;,&nbsp;Write&nbsp;adds&nbsp;&#34;Transfer-Encoding:</span><br>
<span class="lineno">350</span><span class="comment" id="2989973">//&nbsp;chunked&#34;&nbsp;to&nbsp;the&nbsp;header.&nbsp;Body&nbsp;is&nbsp;closed&nbsp;after&nbsp;it&nbsp;is&nbsp;sent.</span><br>
<span class="lineno"></span><span class="keyword" id="2990033">func</span>&nbsp;<span class="op" id="2990038">(</span><span class="ident" id="2990039">r</span>&nbsp;<span class="op" id="2990041">*</span><span class="ident" id="2990042">Request</span><span class="op" id="2990049">)</span>&nbsp;<span class="ident" id="2990051">Write</span><span class="op" id="2990056">(</span><span class="ident" id="2990057">w</span>&nbsp;<span class="ident" id="2990059">io</span><span class="op" id="2990061">.</span><span class="ident" id="2990062">Writer</span><span class="op" id="2990068">)</span>&nbsp;<span class="builtintype" id="2990070">error</span>&nbsp;<span class="op" id="2990076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2990079">return</span>&nbsp;<span class="ident" id="2990086">r</span><span class="op" id="2990087">.</span><span class="ident" id="2990088">write</span><span class="op" id="2990093">(</span><span class="ident" id="2990094">w</span><span class="op" id="2990095">,</span>&nbsp;<span class="builtintype" id="2990097">false</span><span class="op" id="2990102">,</span>&nbsp;<span class="builtintype" id="2990104">nil</span><span class="op" id="2990107">)</span><br>
<span class="lineno"></span><span class="op" id="2990109">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="comment" id="2990112">//&nbsp;WriteProxy&nbsp;is&nbsp;like&nbsp;Write&nbsp;but&nbsp;writes&nbsp;the&nbsp;request&nbsp;in&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="2990175">//&nbsp;expected&nbsp;by&nbsp;an&nbsp;HTTP&nbsp;proxy.&nbsp;&nbsp;In&nbsp;particular,&nbsp;WriteProxy&nbsp;writes&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2990243">//&nbsp;initial&nbsp;Request-URI&nbsp;line&nbsp;of&nbsp;the&nbsp;request&nbsp;with&nbsp;an&nbsp;absolute&nbsp;URI,&nbsp;per</span><br>
<span class="lineno"></span><span class="comment" id="2990312">//&nbsp;section&nbsp;5.1.2&nbsp;of&nbsp;RFC&nbsp;2616,&nbsp;including&nbsp;the&nbsp;scheme&nbsp;and&nbsp;host.</span><br>
<span class="lineno"></span><span class="comment" id="2990373">//&nbsp;In&nbsp;either&nbsp;case,&nbsp;WriteProxy&nbsp;also&nbsp;writes&nbsp;a&nbsp;Host&nbsp;header,&nbsp;using</span><br>
<span class="lineno">360</span><span class="comment" id="2990436">//&nbsp;either&nbsp;r.Host&nbsp;or&nbsp;r.URL.Host.</span><br>
<span class="lineno"></span><span class="keyword" id="2990468">func</span>&nbsp;<span class="op" id="2990473">(</span><span class="ident" id="2990474">r</span>&nbsp;<span class="op" id="2990476">*</span><span class="ident" id="2990477">Request</span><span class="op" id="2990484">)</span>&nbsp;<span class="ident" id="2990486">WriteProxy</span><span class="op" id="2990496">(</span><span class="ident" id="2990497">w</span>&nbsp;<span class="ident" id="2990499">io</span><span class="op" id="2990501">.</span><span class="ident" id="2990502">Writer</span><span class="op" id="2990508">)</span>&nbsp;<span class="builtintype" id="2990510">error</span>&nbsp;<span class="op" id="2990516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2990519">return</span>&nbsp;<span class="ident" id="2990526">r</span><span class="op" id="2990527">.</span><span class="ident" id="2990528">write</span><span class="op" id="2990533">(</span><span class="ident" id="2990534">w</span><span class="op" id="2990535">,</span>&nbsp;<span class="builtintype" id="2990537">true</span><span class="op" id="2990541">,</span>&nbsp;<span class="builtintype" id="2990543">nil</span><span class="op" id="2990546">)</span><br>
<span class="lineno"></span><span class="op" id="2990548">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="comment" id="2990551">//&nbsp;extraHeaders&nbsp;may&nbsp;be&nbsp;nil</span><br>
<span class="lineno"></span><span class="keyword" id="2990578">func</span>&nbsp;<span class="op" id="2990583">(</span><span class="ident" id="2990584">req</span>&nbsp;<span class="op" id="2990588">*</span><span class="ident" id="2990589">Request</span><span class="op" id="2990596">)</span>&nbsp;<span class="ident" id="2990598">write</span><span class="op" id="2990603">(</span><span class="ident" id="2990604">w</span>&nbsp;<span class="ident" id="2990606">io</span><span class="op" id="2990608">.</span><span class="ident" id="2990609">Writer</span><span class="op" id="2990615">,</span>&nbsp;<span class="ident" id="2990617">usingProxy</span>&nbsp;<span class="builtintype" id="2990628">bool</span><span class="op" id="2990632">,</span>&nbsp;<span class="ident" id="2990634">extraHeaders</span>&nbsp;<span class="ident" id="2990647">Header</span><span class="op" id="2990653">)</span>&nbsp;<span class="builtintype" id="2990655">error</span>&nbsp;<span class="op" id="2990661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2990664">host</span>&nbsp;<span class="op" id="2990669">:=</span>&nbsp;<span class="ident" id="2990672">req</span><span class="op" id="2990675">.</span><span class="ident" id="2990676">Host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2990682">if</span>&nbsp;<span class="ident" id="2990685">host</span>&nbsp;<span class="op" id="2990690">==</span>&nbsp;<span class="string" id="2990693">&#34;&#34;</span>&nbsp;<span class="op" id="2990696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2990700">if</span>&nbsp;<span class="ident" id="2990703">req</span><span class="op" id="2990706">.</span><span class="ident" id="2990707">URL</span>&nbsp;<span class="op" id="2990711">==</span>&nbsp;<span class="builtintype" id="2990714">nil</span>&nbsp;<span class="op" id="2990718">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2990723">return</span>&nbsp;<span class="ident" id="2990730">errors</span><span class="op" id="2990736">.</span><span class="ident" id="2990737">New</span><span class="op" id="2990740">(</span><span class="string" id="2990741">&#34;http:&nbsp;Request.Write&nbsp;on&nbsp;Request&nbsp;with&nbsp;no&nbsp;Host&nbsp;or&nbsp;URL&nbsp;set&#34;</span><span class="op" id="2990797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2990801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2990805">host</span>&nbsp;<span class="op" id="2990810">=</span>&nbsp;<span class="ident" id="2990812">req</span><span class="op" id="2990815">.</span><span class="ident" id="2990816">URL</span><span class="op" id="2990819">.</span><span class="ident" id="2990820">Host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2990826">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2990830">ruri</span>&nbsp;<span class="op" id="2990835">:=</span>&nbsp;<span class="ident" id="2990838">req</span><span class="op" id="2990841">.</span><span class="ident" id="2990842">URL</span><span class="op" id="2990845">.</span><span class="ident" id="2990846">RequestURI</span><span class="op" id="2990856">(</span><span class="op" id="2990857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2990860">if</span>&nbsp;<span class="ident" id="2990863">usingProxy</span>&nbsp;<span class="op" id="2990874">&amp;&amp;</span>&nbsp;<span class="ident" id="2990877">req</span><span class="op" id="2990880">.</span><span class="ident" id="2990881">URL</span><span class="op" id="2990884">.</span><span class="ident" id="2990885">Scheme</span>&nbsp;<span class="op" id="2990892">!=</span>&nbsp;<span class="string" id="2990895">&#34;&#34;</span>&nbsp;<span class="op" id="2990898">&amp;&amp;</span>&nbsp;<span class="ident" id="2990901">req</span><span class="op" id="2990904">.</span><span class="ident" id="2990905">URL</span><span class="op" id="2990908">.</span><span class="ident" id="2990909">Opaque</span>&nbsp;<span class="op" id="2990916">==</span>&nbsp;<span class="string" id="2990919">&#34;&#34;</span>&nbsp;<span class="op" id="2990922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2990926">ruri</span>&nbsp;<span class="op" id="2990931">=</span>&nbsp;<span class="ident" id="2990933">req</span><span class="op" id="2990936">.</span><span class="ident" id="2990937">URL</span><span class="op" id="2990940">.</span><span class="ident" id="2990941">Scheme</span>&nbsp;<span class="op" id="2990948">+</span>&nbsp;<span class="string" id="2990950">&#34;://&#34;</span>&nbsp;<span class="op" id="2990956">+</span>&nbsp;<span class="ident" id="2990958">host</span>&nbsp;<span class="op" id="2990963">+</span>&nbsp;<span class="ident" id="2990965">ruri</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2990971">}</span>&nbsp;<span class="keyword" id="2990973">else</span>&nbsp;<span class="keyword" id="2990978">if</span>&nbsp;<span class="ident" id="2990981">req</span><span class="op" id="2990984">.</span><span class="ident" id="2990985">Method</span>&nbsp;<span class="op" id="2990992">==</span>&nbsp;<span class="string" id="2990995">&#34;CONNECT&#34;</span>&nbsp;<span class="op" id="2991005">&amp;&amp;</span>&nbsp;<span class="ident" id="2991008">req</span><span class="op" id="2991011">.</span><span class="ident" id="2991012">URL</span><span class="op" id="2991015">.</span><span class="ident" id="2991016">Path</span>&nbsp;<span class="op" id="2991021">==</span>&nbsp;<span class="string" id="2991024">&#34;&#34;</span>&nbsp;<span class="op" id="2991027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2991031">//&nbsp;CONNECT&nbsp;requests&nbsp;normally&nbsp;give&nbsp;just&nbsp;the&nbsp;host&nbsp;and&nbsp;port,&nbsp;not&nbsp;a&nbsp;full&nbsp;URL.</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2991107">ruri</span>&nbsp;<span class="op" id="2991112">=</span>&nbsp;<span class="ident" id="2991114">host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2991120">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2991123">//&nbsp;TODO(bradfitz):&nbsp;escape&nbsp;at&nbsp;least&nbsp;newlines&nbsp;in&nbsp;ruri?</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2991178">//&nbsp;Wrap&nbsp;the&nbsp;writer&nbsp;in&nbsp;a&nbsp;bufio&nbsp;Writer&nbsp;if&nbsp;it&#39;s&nbsp;not&nbsp;already&nbsp;buffered.</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2991246">//&nbsp;Don&#39;t&nbsp;always&nbsp;call&nbsp;NewWriter,&nbsp;as&nbsp;that&nbsp;forces&nbsp;a&nbsp;bytes.Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2991309">//&nbsp;and&nbsp;other&nbsp;small&nbsp;bufio&nbsp;Writers&nbsp;to&nbsp;have&nbsp;a&nbsp;minimum&nbsp;4k&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2991371">//&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2991381">var</span>&nbsp;<span class="ident" id="2991385">bw</span>&nbsp;<span class="op" id="2991388">*</span><span class="ident" id="2991389">bufio</span><span class="op" id="2991394">.</span><span class="ident" id="2991395">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2991403">if</span>&nbsp;<span class="ident" id="2991406">_</span><span class="op" id="2991407">,</span>&nbsp;<span class="ident" id="2991409">ok</span>&nbsp;<span class="op" id="2991412">:=</span>&nbsp;<span class="ident" id="2991415">w</span><span class="op" id="2991416">.</span><span class="op" id="2991417">(</span><span class="ident" id="2991418">io</span><span class="op" id="2991420">.</span><span class="ident" id="2991421">ByteWriter</span><span class="op" id="2991431">)</span><span class="op" id="2991432">;</span>&nbsp;<span class="op" id="2991434">!</span><span class="ident" id="2991435">ok</span>&nbsp;<span class="op" id="2991438">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2991442">bw</span>&nbsp;<span class="op" id="2991445">=</span>&nbsp;<span class="ident" id="2991447">bufio</span><span class="op" id="2991452">.</span><span class="ident" id="2991453">NewWriter</span><span class="op" id="2991462">(</span><span class="ident" id="2991463">w</span><span class="op" id="2991464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2991468">w</span>&nbsp;<span class="op" id="2991470">=</span>&nbsp;<span class="ident" id="2991472">bw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2991476">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2991480">_</span><span class="op" id="2991481">,</span>&nbsp;<span class="ident" id="2991483">err</span>&nbsp;<span class="op" id="2991487">:=</span>&nbsp;<span class="ident" id="2991490">fmt</span><span class="op" id="2991493">.</span><span class="ident" id="2991494">Fprintf</span><span class="op" id="2991501">(</span><span class="ident" id="2991502">w</span><span class="op" id="2991503">,</span>&nbsp;<span class="string" id="2991505">&#34;%s&nbsp;%s&nbsp;HTTP/1.1\r\n&#34;</span><span class="op" id="2991525">,</span>&nbsp;<span class="ident" id="2991527">valueOrDefault</span><span class="op" id="2991541">(</span><span class="ident" id="2991542">req</span><span class="op" id="2991545">.</span><span class="ident" id="2991546">Method</span><span class="op" id="2991552">,</span>&nbsp;<span class="string" id="2991554">&#34;GET&#34;</span><span class="op" id="2991559">)</span><span class="op" id="2991560">,</span>&nbsp;<span class="ident" id="2991562">ruri</span><span class="op" id="2991566">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2991569">if</span>&nbsp;<span class="ident" id="2991572">err</span>&nbsp;<span class="op" id="2991576">!=</span>&nbsp;<span class="builtintype" id="2991579">nil</span>&nbsp;<span class="op" id="2991583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2991587">return</span>&nbsp;<span class="ident" id="2991594">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2991599">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2991603">//&nbsp;Header&nbsp;lines</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2991620">_</span><span class="op" id="2991621">,</span>&nbsp;<span class="ident" id="2991623">err</span>&nbsp;<span class="op" id="2991627">=</span>&nbsp;<span class="ident" id="2991629">fmt</span><span class="op" id="2991632">.</span><span class="ident" id="2991633">Fprintf</span><span class="op" id="2991640">(</span><span class="ident" id="2991641">w</span><span class="op" id="2991642">,</span>&nbsp;<span class="string" id="2991644">&#34;Host:&nbsp;%s\r\n&#34;</span><span class="op" id="2991658">,</span>&nbsp;<span class="ident" id="2991660">host</span><span class="op" id="2991664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2991667">if</span>&nbsp;<span class="ident" id="2991670">err</span>&nbsp;<span class="op" id="2991674">!=</span>&nbsp;<span class="builtintype" id="2991677">nil</span>&nbsp;<span class="op" id="2991681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2991685">return</span>&nbsp;<span class="ident" id="2991692">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2991697">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2991701">//&nbsp;Use&nbsp;the&nbsp;defaultUserAgent&nbsp;unless&nbsp;the&nbsp;Header&nbsp;contains&nbsp;one,&nbsp;which</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2991768">//&nbsp;may&nbsp;be&nbsp;blank&nbsp;to&nbsp;not&nbsp;send&nbsp;the&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2991809">userAgent</span>&nbsp;<span class="op" id="2991819">:=</span>&nbsp;<span class="ident" id="2991822">defaultUserAgent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2991840">if</span>&nbsp;<span class="ident" id="2991843">req</span><span class="op" id="2991846">.</span><span class="ident" id="2991847">Header</span>&nbsp;<span class="op" id="2991854">!=</span>&nbsp;<span class="builtintype" id="2991857">nil</span>&nbsp;<span class="op" id="2991861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2991865">if</span>&nbsp;<span class="ident" id="2991868">ua</span>&nbsp;<span class="op" id="2991871">:=</span>&nbsp;<span class="ident" id="2991874">req</span><span class="op" id="2991877">.</span><span class="ident" id="2991878">Header</span><span class="op" id="2991884">[</span><span class="string" id="2991885">&#34;User-Agent&#34;</span><span class="op" id="2991897">]</span><span class="op" id="2991898">;</span>&nbsp;<span class="builtinfunc" id="2991900">len</span><span class="op" id="2991903">(</span><span class="ident" id="2991904">ua</span><span class="op" id="2991906">)</span>&nbsp;<span class="op" id="2991908">&gt;</span>&nbsp;<span class="num" id="2991910">0</span>&nbsp;<span class="op" id="2991912">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2991917">userAgent</span>&nbsp;<span class="op" id="2991927">=</span>&nbsp;<span class="ident" id="2991929">ua</span><span class="op" id="2991931">[</span><span class="num" id="2991932">0</span><span class="op" id="2991933">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2991937">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2991940">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2991943">if</span>&nbsp;<span class="ident" id="2991946">userAgent</span>&nbsp;<span class="op" id="2991956">!=</span>&nbsp;<span class="string" id="2991959">&#34;&#34;</span>&nbsp;<span class="op" id="2991962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2991966">_</span><span class="op" id="2991967">,</span>&nbsp;<span class="ident" id="2991969">err</span>&nbsp;<span class="op" id="2991973">=</span>&nbsp;<span class="ident" id="2991975">fmt</span><span class="op" id="2991978">.</span><span class="ident" id="2991979">Fprintf</span><span class="op" id="2991986">(</span><span class="ident" id="2991987">w</span><span class="op" id="2991988">,</span>&nbsp;<span class="string" id="2991990">&#34;User-Agent:&nbsp;%s\r\n&#34;</span><span class="op" id="2992010">,</span>&nbsp;<span class="ident" id="2992012">userAgent</span><span class="op" id="2992021">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2992025">if</span>&nbsp;<span class="ident" id="2992028">err</span>&nbsp;<span class="op" id="2992032">!=</span>&nbsp;<span class="builtintype" id="2992035">nil</span>&nbsp;<span class="op" id="2992039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2992044">return</span>&nbsp;<span class="ident" id="2992051">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2992057">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2992060">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2992064">//&nbsp;Process&nbsp;Body,ContentLength,Close,Trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2992109">tw</span><span class="op" id="2992111">,</span>&nbsp;<span class="ident" id="2992113">err</span>&nbsp;<span class="op" id="2992117">:=</span>&nbsp;<span class="ident" id="2992120">newTransferWriter</span><span class="op" id="2992137">(</span><span class="ident" id="2992138">req</span><span class="op" id="2992141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2992144">if</span>&nbsp;<span class="ident" id="2992147">err</span>&nbsp;<span class="op" id="2992151">!=</span>&nbsp;<span class="builtintype" id="2992154">nil</span>&nbsp;<span class="op" id="2992158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2992162">return</span>&nbsp;<span class="ident" id="2992169">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2992174">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2992177">err</span>&nbsp;<span class="op" id="2992181">=</span>&nbsp;<span class="ident" id="2992183">tw</span><span class="op" id="2992185">.</span><span class="ident" id="2992186">WriteHeader</span><span class="op" id="2992197">(</span><span class="ident" id="2992198">w</span><span class="op" id="2992199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2992202">if</span>&nbsp;<span class="ident" id="2992205">err</span>&nbsp;<span class="op" id="2992209">!=</span>&nbsp;<span class="builtintype" id="2992212">nil</span>&nbsp;<span class="op" id="2992216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2992220">return</span>&nbsp;<span class="ident" id="2992227">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2992232">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2992236">err</span>&nbsp;<span class="op" id="2992240">=</span>&nbsp;<span class="ident" id="2992242">req</span><span class="op" id="2992245">.</span><span class="ident" id="2992246">Header</span><span class="op" id="2992252">.</span><span class="ident" id="2992253">WriteSubset</span><span class="op" id="2992264">(</span><span class="ident" id="2992265">w</span><span class="op" id="2992266">,</span>&nbsp;<span class="ident" id="2992268">reqWriteExcludeHeader</span><span class="op" id="2992289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2992292">if</span>&nbsp;<span class="ident" id="2992295">err</span>&nbsp;<span class="op" id="2992299">!=</span>&nbsp;<span class="builtintype" id="2992302">nil</span>&nbsp;<span class="op" id="2992306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2992310">return</span>&nbsp;<span class="ident" id="2992317">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2992322">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2992326">if</span>&nbsp;<span class="ident" id="2992329">extraHeaders</span>&nbsp;<span class="op" id="2992342">!=</span>&nbsp;<span class="builtintype" id="2992345">nil</span>&nbsp;<span class="op" id="2992349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2992353">err</span>&nbsp;<span class="op" id="2992357">=</span>&nbsp;<span class="ident" id="2992359">extraHeaders</span><span class="op" id="2992371">.</span><span class="ident" id="2992372">Write</span><span class="op" id="2992377">(</span><span class="ident" id="2992378">w</span><span class="op" id="2992379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2992383">if</span>&nbsp;<span class="ident" id="2992386">err</span>&nbsp;<span class="op" id="2992390">!=</span>&nbsp;<span class="builtintype" id="2992393">nil</span>&nbsp;<span class="op" id="2992397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2992402">return</span>&nbsp;<span class="ident" id="2992409">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2992415">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2992418">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2992422">_</span><span class="op" id="2992423">,</span>&nbsp;<span class="ident" id="2992425">err</span>&nbsp;<span class="op" id="2992429">=</span>&nbsp;<span class="ident" id="2992431">io</span><span class="op" id="2992433">.</span><span class="ident" id="2992434">WriteString</span><span class="op" id="2992445">(</span><span class="ident" id="2992446">w</span><span class="op" id="2992447">,</span>&nbsp;<span class="string" id="2992449">&#34;\r\n&#34;</span><span class="op" id="2992455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2992458">if</span>&nbsp;<span class="ident" id="2992461">err</span>&nbsp;<span class="op" id="2992465">!=</span>&nbsp;<span class="builtintype" id="2992468">nil</span>&nbsp;<span class="op" id="2992472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2992476">return</span>&nbsp;<span class="ident" id="2992483">err</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2992488">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2992492">//&nbsp;Write&nbsp;body&nbsp;and&nbsp;trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2992519">err</span>&nbsp;<span class="op" id="2992523">=</span>&nbsp;<span class="ident" id="2992525">tw</span><span class="op" id="2992527">.</span><span class="ident" id="2992528">WriteBody</span><span class="op" id="2992537">(</span><span class="ident" id="2992538">w</span><span class="op" id="2992539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2992542">if</span>&nbsp;<span class="ident" id="2992545">err</span>&nbsp;<span class="op" id="2992549">!=</span>&nbsp;<span class="builtintype" id="2992552">nil</span>&nbsp;<span class="op" id="2992556">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2992560">return</span>&nbsp;<span class="ident" id="2992567">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2992572">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2992576">if</span>&nbsp;<span class="ident" id="2992579">bw</span>&nbsp;<span class="op" id="2992582">!=</span>&nbsp;<span class="builtintype" id="2992585">nil</span>&nbsp;<span class="op" id="2992589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2992593">return</span>&nbsp;<span class="ident" id="2992600">bw</span><span class="op" id="2992602">.</span><span class="ident" id="2992603">Flush</span><span class="op" id="2992608">(</span><span class="op" id="2992609">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2992612">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2992615">return</span>&nbsp;<span class="builtintype" id="2992622">nil</span><br>
<span class="lineno"></span><span class="op" id="2992626">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2992629">//&nbsp;ParseHTTPVersion&nbsp;parses&nbsp;a&nbsp;HTTP&nbsp;version&nbsp;string.</span><br>
<span class="lineno">460</span><span class="comment" id="2992679">//&nbsp;&#34;HTTP/1.0&#34;&nbsp;returns&nbsp;(1,&nbsp;0,&nbsp;true).</span><br>
<span class="lineno"></span><span class="keyword" id="2992715">func</span>&nbsp;<span class="ident" id="2992720">ParseHTTPVersion</span><span class="op" id="2992736">(</span><span class="ident" id="2992737">vers</span>&nbsp;<span class="builtintype" id="2992742">string</span><span class="op" id="2992748">)</span>&nbsp;<span class="op" id="2992750">(</span><span class="ident" id="2992751">major</span><span class="op" id="2992756">,</span>&nbsp;<span class="ident" id="2992758">minor</span>&nbsp;<span class="builtintype" id="2992764">int</span><span class="op" id="2992767">,</span>&nbsp;<span class="ident" id="2992769">ok</span>&nbsp;<span class="builtintype" id="2992772">bool</span><span class="op" id="2992776">)</span>&nbsp;<span class="op" id="2992778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2992781">const</span>&nbsp;<span class="ident" id="2992787">Big</span>&nbsp;<span class="op" id="2992791">=</span>&nbsp;<span class="num" id="2992793">1000000</span>&nbsp;<span class="comment" id="2992801">//&nbsp;arbitrary&nbsp;upper&nbsp;bound</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2992827">switch</span>&nbsp;<span class="ident" id="2992834">vers</span>&nbsp;<span class="op" id="2992839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2992842">case</span>&nbsp;<span class="string" id="2992847">&#34;HTTP/1.1&#34;</span><span class="op" id="2992857">:</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2992861">return</span>&nbsp;<span class="num" id="2992868">1</span><span class="op" id="2992869">,</span>&nbsp;<span class="num" id="2992871">1</span><span class="op" id="2992872">,</span>&nbsp;<span class="builtintype" id="2992874">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2992880">case</span>&nbsp;<span class="string" id="2992885">&#34;HTTP/1.0&#34;</span><span class="op" id="2992895">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2992899">return</span>&nbsp;<span class="num" id="2992906">1</span><span class="op" id="2992907">,</span>&nbsp;<span class="num" id="2992909">0</span><span class="op" id="2992910">,</span>&nbsp;<span class="builtintype" id="2992912">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2992918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2992921">if</span>&nbsp;<span class="op" id="2992924">!</span><span class="ident" id="2992925">strings</span><span class="op" id="2992932">.</span><span class="ident" id="2992933">HasPrefix</span><span class="op" id="2992942">(</span><span class="ident" id="2992943">vers</span><span class="op" id="2992947">,</span>&nbsp;<span class="string" id="2992949">&#34;HTTP/&#34;</span><span class="op" id="2992956">)</span>&nbsp;<span class="op" id="2992958">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2992962">return</span>&nbsp;<span class="num" id="2992969">0</span><span class="op" id="2992970">,</span>&nbsp;<span class="num" id="2992972">0</span><span class="op" id="2992973">,</span>&nbsp;<span class="builtintype" id="2992975">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2992982">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2992985">dot</span>&nbsp;<span class="op" id="2992989">:=</span>&nbsp;<span class="ident" id="2992992">strings</span><span class="op" id="2992999">.</span><span class="ident" id="2993000">Index</span><span class="op" id="2993005">(</span><span class="ident" id="2993006">vers</span><span class="op" id="2993010">,</span>&nbsp;<span class="string" id="2993012">&#34;.&#34;</span><span class="op" id="2993015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2993018">if</span>&nbsp;<span class="ident" id="2993021">dot</span>&nbsp;<span class="op" id="2993025">&lt;</span>&nbsp;<span class="num" id="2993027">0</span>&nbsp;<span class="op" id="2993029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2993033">return</span>&nbsp;<span class="num" id="2993040">0</span><span class="op" id="2993041">,</span>&nbsp;<span class="num" id="2993043">0</span><span class="op" id="2993044">,</span>&nbsp;<span class="builtintype" id="2993046">false</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2993053">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2993056">major</span><span class="op" id="2993061">,</span>&nbsp;<span class="ident" id="2993063">err</span>&nbsp;<span class="op" id="2993067">:=</span>&nbsp;<span class="ident" id="2993070">strconv</span><span class="op" id="2993077">.</span><span class="ident" id="2993078">Atoi</span><span class="op" id="2993082">(</span><span class="ident" id="2993083">vers</span><span class="op" id="2993087">[</span><span class="num" id="2993088">5</span><span class="op" id="2993089">:</span><span class="ident" id="2993090">dot</span><span class="op" id="2993093">]</span><span class="op" id="2993094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2993097">if</span>&nbsp;<span class="ident" id="2993100">err</span>&nbsp;<span class="op" id="2993104">!=</span>&nbsp;<span class="builtintype" id="2993107">nil</span>&nbsp;<span class="op" id="2993111">||</span>&nbsp;<span class="ident" id="2993114">major</span>&nbsp;<span class="op" id="2993120">&lt;</span>&nbsp;<span class="num" id="2993122">0</span>&nbsp;<span class="op" id="2993124">||</span>&nbsp;<span class="ident" id="2993127">major</span>&nbsp;<span class="op" id="2993133">&gt;</span>&nbsp;<span class="ident" id="2993135">Big</span>&nbsp;<span class="op" id="2993139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2993143">return</span>&nbsp;<span class="num" id="2993150">0</span><span class="op" id="2993151">,</span>&nbsp;<span class="num" id="2993153">0</span><span class="op" id="2993154">,</span>&nbsp;<span class="builtintype" id="2993156">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2993163">}</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2993166">minor</span><span class="op" id="2993171">,</span>&nbsp;<span class="ident" id="2993173">err</span>&nbsp;<span class="op" id="2993177">=</span>&nbsp;<span class="ident" id="2993179">strconv</span><span class="op" id="2993186">.</span><span class="ident" id="2993187">Atoi</span><span class="op" id="2993191">(</span><span class="ident" id="2993192">vers</span><span class="op" id="2993196">[</span><span class="ident" id="2993197">dot</span><span class="op" id="2993200">+</span><span class="num" id="2993201">1</span><span class="op" id="2993202">:</span><span class="op" id="2993203">]</span><span class="op" id="2993204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2993207">if</span>&nbsp;<span class="ident" id="2993210">err</span>&nbsp;<span class="op" id="2993214">!=</span>&nbsp;<span class="builtintype" id="2993217">nil</span>&nbsp;<span class="op" id="2993221">||</span>&nbsp;<span class="ident" id="2993224">minor</span>&nbsp;<span class="op" id="2993230">&lt;</span>&nbsp;<span class="num" id="2993232">0</span>&nbsp;<span class="op" id="2993234">||</span>&nbsp;<span class="ident" id="2993237">minor</span>&nbsp;<span class="op" id="2993243">&gt;</span>&nbsp;<span class="ident" id="2993245">Big</span>&nbsp;<span class="op" id="2993249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2993253">return</span>&nbsp;<span class="num" id="2993260">0</span><span class="op" id="2993261">,</span>&nbsp;<span class="num" id="2993263">0</span><span class="op" id="2993264">,</span>&nbsp;<span class="builtintype" id="2993266">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2993273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2993276">return</span>&nbsp;<span class="ident" id="2993283">major</span><span class="op" id="2993288">,</span>&nbsp;<span class="ident" id="2993290">minor</span><span class="op" id="2993295">,</span>&nbsp;<span class="builtintype" id="2993297">true</span><br>
<span class="lineno">485</span><span class="op" id="2993302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2993305">//&nbsp;NewRequest&nbsp;returns&nbsp;a&nbsp;new&nbsp;Request&nbsp;given&nbsp;a&nbsp;method,&nbsp;URL,&nbsp;and&nbsp;optional&nbsp;body.</span><br>
<span class="lineno"></span><span class="comment" id="2993381">//</span><br>
<span class="lineno"></span><span class="comment" id="2993384">//&nbsp;If&nbsp;the&nbsp;provided&nbsp;body&nbsp;is&nbsp;also&nbsp;an&nbsp;io.Closer,&nbsp;the&nbsp;returned</span><br>
<span class="lineno">490</span><span class="comment" id="2993443">//&nbsp;Request.Body&nbsp;is&nbsp;set&nbsp;to&nbsp;body&nbsp;and&nbsp;will&nbsp;be&nbsp;closed&nbsp;by&nbsp;the&nbsp;Client</span><br>
<span class="lineno"></span><span class="comment" id="2993507">//&nbsp;methods&nbsp;Do,&nbsp;Post,&nbsp;and&nbsp;PostForm,&nbsp;and&nbsp;Transport.RoundTrip.</span><br>
<span class="lineno"></span><span class="keyword" id="2993567">func</span>&nbsp;<span class="ident" id="2993572">NewRequest</span><span class="op" id="2993582">(</span><span class="ident" id="2993583">method</span><span class="op" id="2993589">,</span>&nbsp;<span class="ident" id="2993591">urlStr</span>&nbsp;<span class="builtintype" id="2993598">string</span><span class="op" id="2993604">,</span>&nbsp;<span class="ident" id="2993606">body</span>&nbsp;<span class="ident" id="2993611">io</span><span class="op" id="2993613">.</span><span class="ident" id="2993614">Reader</span><span class="op" id="2993620">)</span>&nbsp;<span class="op" id="2993622">(</span><span class="op" id="2993623">*</span><span class="ident" id="2993624">Request</span><span class="op" id="2993631">,</span>&nbsp;<span class="builtintype" id="2993633">error</span><span class="op" id="2993638">)</span>&nbsp;<span class="op" id="2993640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2993643">u</span><span class="op" id="2993644">,</span>&nbsp;<span class="ident" id="2993646">err</span>&nbsp;<span class="op" id="2993650">:=</span>&nbsp;<span class="ident" id="2993653">url</span><span class="op" id="2993656">.</span><span class="ident" id="2993657">Parse</span><span class="op" id="2993662">(</span><span class="ident" id="2993663">urlStr</span><span class="op" id="2993669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2993672">if</span>&nbsp;<span class="ident" id="2993675">err</span>&nbsp;<span class="op" id="2993679">!=</span>&nbsp;<span class="builtintype" id="2993682">nil</span>&nbsp;<span class="op" id="2993686">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2993690">return</span>&nbsp;<span class="builtintype" id="2993697">nil</span><span class="op" id="2993700">,</span>&nbsp;<span class="ident" id="2993702">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2993707">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2993710">rc</span><span class="op" id="2993712">,</span>&nbsp;<span class="ident" id="2993714">ok</span>&nbsp;<span class="op" id="2993717">:=</span>&nbsp;<span class="ident" id="2993720">body</span><span class="op" id="2993724">.</span><span class="op" id="2993725">(</span><span class="ident" id="2993726">io</span><span class="op" id="2993728">.</span><span class="ident" id="2993729">ReadCloser</span><span class="op" id="2993739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2993742">if</span>&nbsp;<span class="op" id="2993745">!</span><span class="ident" id="2993746">ok</span>&nbsp;<span class="op" id="2993749">&amp;&amp;</span>&nbsp;<span class="ident" id="2993752">body</span>&nbsp;<span class="op" id="2993757">!=</span>&nbsp;<span class="builtintype" id="2993760">nil</span>&nbsp;<span class="op" id="2993764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2993768">rc</span>&nbsp;<span class="op" id="2993771">=</span>&nbsp;<span class="ident" id="2993773">ioutil</span><span class="op" id="2993779">.</span><span class="ident" id="2993780">NopCloser</span><span class="op" id="2993789">(</span><span class="ident" id="2993790">body</span><span class="op" id="2993794">)</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2993797">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2993800">req</span>&nbsp;<span class="op" id="2993804">:=</span>&nbsp;<span class="op" id="2993807">&amp;</span><span class="ident" id="2993808">Request</span><span class="op" id="2993815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2993819">Method</span><span class="op" id="2993825">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2993831">method</span><span class="op" id="2993837">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2993841">URL</span><span class="op" id="2993844">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2993853">u</span><span class="op" id="2993854">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2993858">Proto</span><span class="op" id="2993863">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2993870">&#34;HTTP/1.1&#34;</span><span class="op" id="2993880">,</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2993884">ProtoMajor</span><span class="op" id="2993894">:</span>&nbsp;<span class="num" id="2993896">1</span><span class="op" id="2993897">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2993901">ProtoMinor</span><span class="op" id="2993911">:</span>&nbsp;<span class="num" id="2993913">1</span><span class="op" id="2993914">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2993918">Header</span><span class="op" id="2993924">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2993930">make</span><span class="op" id="2993934">(</span><span class="ident" id="2993935">Header</span><span class="op" id="2993941">)</span><span class="op" id="2993942">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2993946">Body</span><span class="op" id="2993950">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2993958">rc</span><span class="op" id="2993960">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2993964">Host</span><span class="op" id="2993968">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2993976">u</span><span class="op" id="2993977">.</span><span class="ident" id="2993978">Host</span><span class="op" id="2993982">,</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2993985">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2993988">if</span>&nbsp;<span class="ident" id="2993991">body</span>&nbsp;<span class="op" id="2993996">!=</span>&nbsp;<span class="builtintype" id="2993999">nil</span>&nbsp;<span class="op" id="2994003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2994007">switch</span>&nbsp;<span class="ident" id="2994014">v</span>&nbsp;<span class="op" id="2994016">:=</span>&nbsp;<span class="ident" id="2994019">body</span><span class="op" id="2994023">.</span><span class="op" id="2994024">(</span><span class="keyword" id="2994025">type</span><span class="op" id="2994029">)</span>&nbsp;<span class="op" id="2994031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2994035">case</span>&nbsp;<span class="op" id="2994040">*</span><span class="ident" id="2994041">bytes</span><span class="op" id="2994046">.</span><span class="ident" id="2994047">Buffer</span><span class="op" id="2994053">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2994058">req</span><span class="op" id="2994061">.</span><span class="ident" id="2994062">ContentLength</span>&nbsp;<span class="op" id="2994076">=</span>&nbsp;<span class="ident" id="2994078">int64</span><span class="op" id="2994083">(</span><span class="ident" id="2994084">v</span><span class="op" id="2994085">.</span><span class="ident" id="2994086">Len</span><span class="op" id="2994089">(</span><span class="op" id="2994090">)</span><span class="op" id="2994091">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2994095">case</span>&nbsp;<span class="op" id="2994100">*</span><span class="ident" id="2994101">bytes</span><span class="op" id="2994106">.</span><span class="ident" id="2994107">Reader</span><span class="op" id="2994113">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2994118">req</span><span class="op" id="2994121">.</span><span class="ident" id="2994122">ContentLength</span>&nbsp;<span class="op" id="2994136">=</span>&nbsp;<span class="ident" id="2994138">int64</span><span class="op" id="2994143">(</span><span class="ident" id="2994144">v</span><span class="op" id="2994145">.</span><span class="ident" id="2994146">Len</span><span class="op" id="2994149">(</span><span class="op" id="2994150">)</span><span class="op" id="2994151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2994155">case</span>&nbsp;<span class="op" id="2994160">*</span><span class="ident" id="2994161">strings</span><span class="op" id="2994168">.</span><span class="ident" id="2994169">Reader</span><span class="op" id="2994175">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2994180">req</span><span class="op" id="2994183">.</span><span class="ident" id="2994184">ContentLength</span>&nbsp;<span class="op" id="2994198">=</span>&nbsp;<span class="ident" id="2994200">int64</span><span class="op" id="2994205">(</span><span class="ident" id="2994206">v</span><span class="op" id="2994207">.</span><span class="ident" id="2994208">Len</span><span class="op" id="2994211">(</span><span class="op" id="2994212">)</span><span class="op" id="2994213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2994217">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2994220">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2994224">return</span>&nbsp;<span class="ident" id="2994231">req</span><span class="op" id="2994234">,</span>&nbsp;<span class="builtintype" id="2994236">nil</span><br>
<span class="lineno"></span><span class="op" id="2994240">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span><span class="comment" id="2994243">//&nbsp;BasicAuth&nbsp;returns&nbsp;the&nbsp;username&nbsp;and&nbsp;password&nbsp;provided&nbsp;in&nbsp;the&nbsp;request&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="2994316">//&nbsp;Authorization&nbsp;header,&nbsp;if&nbsp;the&nbsp;request&nbsp;uses&nbsp;HTTP&nbsp;Basic&nbsp;Authentication.</span><br>
<span class="lineno"></span><span class="comment" id="2994388">//&nbsp;See&nbsp;RFC&nbsp;2617,&nbsp;Section&nbsp;2.</span><br>
<span class="lineno"></span><span class="keyword" id="2994416">func</span>&nbsp;<span class="op" id="2994421">(</span><span class="ident" id="2994422">r</span>&nbsp;<span class="op" id="2994424">*</span><span class="ident" id="2994425">Request</span><span class="op" id="2994432">)</span>&nbsp;<span class="ident" id="2994434">BasicAuth</span><span class="op" id="2994443">(</span><span class="op" id="2994444">)</span>&nbsp;<span class="op" id="2994446">(</span><span class="ident" id="2994447">username</span><span class="op" id="2994455">,</span>&nbsp;<span class="ident" id="2994457">password</span>&nbsp;<span class="builtintype" id="2994466">string</span><span class="op" id="2994472">,</span>&nbsp;<span class="ident" id="2994474">ok</span>&nbsp;<span class="builtintype" id="2994477">bool</span><span class="op" id="2994481">)</span>&nbsp;<span class="op" id="2994483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2994486">auth</span>&nbsp;<span class="op" id="2994491">:=</span>&nbsp;<span class="ident" id="2994494">r</span><span class="op" id="2994495">.</span><span class="ident" id="2994496">Header</span><span class="op" id="2994502">.</span><span class="ident" id="2994503">Get</span><span class="op" id="2994506">(</span><span class="string" id="2994507">&#34;Authorization&#34;</span><span class="op" id="2994522">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2994525">if</span>&nbsp;<span class="ident" id="2994528">auth</span>&nbsp;<span class="op" id="2994533">==</span>&nbsp;<span class="string" id="2994536">&#34;&#34;</span>&nbsp;<span class="op" id="2994539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2994543">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2994551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2994554">return</span>&nbsp;<span class="ident" id="2994561">parseBasicAuth</span><span class="op" id="2994575">(</span><span class="ident" id="2994576">auth</span><span class="op" id="2994580">)</span><br>
<span class="lineno"></span><span class="op" id="2994582">}</span><br>
<span class="lineno">535</span><br>
<span class="lineno"></span><span class="comment" id="2994585">//&nbsp;parseBasicAuth&nbsp;parses&nbsp;an&nbsp;HTTP&nbsp;Basic&nbsp;Authentication&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="2994647">//&nbsp;&#34;Basic&nbsp;QWxhZGRpbjpvcGVuIHNlc2FtZQ==&#34;&nbsp;returns&nbsp;(&#34;Aladdin&#34;,&nbsp;&#34;open&nbsp;sesame&#34;,&nbsp;true).</span><br>
<span class="lineno"></span><span class="keyword" id="2994729">func</span>&nbsp;<span class="ident" id="2994734">parseBasicAuth</span><span class="op" id="2994748">(</span><span class="ident" id="2994749">auth</span>&nbsp;<span class="builtintype" id="2994754">string</span><span class="op" id="2994760">)</span>&nbsp;<span class="op" id="2994762">(</span><span class="ident" id="2994763">username</span><span class="op" id="2994771">,</span>&nbsp;<span class="ident" id="2994773">password</span>&nbsp;<span class="builtintype" id="2994782">string</span><span class="op" id="2994788">,</span>&nbsp;<span class="ident" id="2994790">ok</span>&nbsp;<span class="builtintype" id="2994793">bool</span><span class="op" id="2994797">)</span>&nbsp;<span class="op" id="2994799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2994802">if</span>&nbsp;<span class="op" id="2994805">!</span><span class="ident" id="2994806">strings</span><span class="op" id="2994813">.</span><span class="ident" id="2994814">HasPrefix</span><span class="op" id="2994823">(</span><span class="ident" id="2994824">auth</span><span class="op" id="2994828">,</span>&nbsp;<span class="string" id="2994830">&#34;Basic&nbsp;&#34;</span><span class="op" id="2994838">)</span>&nbsp;<span class="op" id="2994840">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2994844">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2994852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2994855">c</span><span class="op" id="2994856">,</span>&nbsp;<span class="ident" id="2994858">err</span>&nbsp;<span class="op" id="2994862">:=</span>&nbsp;<span class="ident" id="2994865">base64</span><span class="op" id="2994871">.</span><span class="ident" id="2994872">StdEncoding</span><span class="op" id="2994883">.</span><span class="ident" id="2994884">DecodeString</span><span class="op" id="2994896">(</span><span class="ident" id="2994897">strings</span><span class="op" id="2994904">.</span><span class="ident" id="2994905">TrimPrefix</span><span class="op" id="2994915">(</span><span class="ident" id="2994916">auth</span><span class="op" id="2994920">,</span>&nbsp;<span class="string" id="2994922">&#34;Basic&nbsp;&#34;</span><span class="op" id="2994930">)</span><span class="op" id="2994931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2994934">if</span>&nbsp;<span class="ident" id="2994937">err</span>&nbsp;<span class="op" id="2994941">!=</span>&nbsp;<span class="builtintype" id="2994944">nil</span>&nbsp;<span class="op" id="2994948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2994952">return</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2994960">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2994963">cs</span>&nbsp;<span class="op" id="2994966">:=</span>&nbsp;<span class="builtintype" id="2994969">string</span><span class="op" id="2994975">(</span><span class="ident" id="2994976">c</span><span class="op" id="2994977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2994980">s</span>&nbsp;<span class="op" id="2994982">:=</span>&nbsp;<span class="ident" id="2994985">strings</span><span class="op" id="2994992">.</span><span class="ident" id="2994993">IndexByte</span><span class="op" id="2995002">(</span><span class="ident" id="2995003">cs</span><span class="op" id="2995005">,</span>&nbsp;<span class="string" id="2995007">&#39;:&#39;</span><span class="op" id="2995010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2995013">if</span>&nbsp;<span class="ident" id="2995016">s</span>&nbsp;<span class="op" id="2995018">&lt;</span>&nbsp;<span class="num" id="2995020">0</span>&nbsp;<span class="op" id="2995022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2995026">return</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2995034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2995037">return</span>&nbsp;<span class="ident" id="2995044">cs</span><span class="op" id="2995046">[</span><span class="op" id="2995047">:</span><span class="ident" id="2995048">s</span><span class="op" id="2995049">]</span><span class="op" id="2995050">,</span>&nbsp;<span class="ident" id="2995052">cs</span><span class="op" id="2995054">[</span><span class="ident" id="2995055">s</span><span class="op" id="2995056">+</span><span class="num" id="2995057">1</span><span class="op" id="2995058">:</span><span class="op" id="2995059">]</span><span class="op" id="2995060">,</span>&nbsp;<span class="builtintype" id="2995062">true</span><br>
<span class="lineno"></span><span class="op" id="2995067">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2995070">//&nbsp;SetBasicAuth&nbsp;sets&nbsp;the&nbsp;request&#39;s&nbsp;Authorization&nbsp;header&nbsp;to&nbsp;use&nbsp;HTTP</span><br>
<span class="lineno">555</span><span class="comment" id="2995138">//&nbsp;Basic&nbsp;Authentication&nbsp;with&nbsp;the&nbsp;provided&nbsp;username&nbsp;and&nbsp;password.</span><br>
<span class="lineno"></span><span class="comment" id="2995203">//</span><br>
<span class="lineno"></span><span class="comment" id="2995206">//&nbsp;With&nbsp;HTTP&nbsp;Basic&nbsp;Authentication&nbsp;the&nbsp;provided&nbsp;username&nbsp;and&nbsp;password</span><br>
<span class="lineno"></span><span class="comment" id="2995275">//&nbsp;are&nbsp;not&nbsp;encrypted.</span><br>
<span class="lineno"></span><span class="keyword" id="2995297">func</span>&nbsp;<span class="op" id="2995302">(</span><span class="ident" id="2995303">r</span>&nbsp;<span class="op" id="2995305">*</span><span class="ident" id="2995306">Request</span><span class="op" id="2995313">)</span>&nbsp;<span class="ident" id="2995315">SetBasicAuth</span><span class="op" id="2995327">(</span><span class="ident" id="2995328">username</span><span class="op" id="2995336">,</span>&nbsp;<span class="ident" id="2995338">password</span>&nbsp;<span class="builtintype" id="2995347">string</span><span class="op" id="2995353">)</span>&nbsp;<span class="op" id="2995355">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2995358">r</span><span class="op" id="2995359">.</span><span class="ident" id="2995360">Header</span><span class="op" id="2995366">.</span><span class="ident" id="2995367">Set</span><span class="op" id="2995370">(</span><span class="string" id="2995371">&#34;Authorization&#34;</span><span class="op" id="2995386">,</span>&nbsp;<span class="string" id="2995388">&#34;Basic&nbsp;&#34;</span><span class="op" id="2995396">+</span><span class="ident" id="2995397">basicAuth</span><span class="op" id="2995406">(</span><span class="ident" id="2995407">username</span><span class="op" id="2995415">,</span>&nbsp;<span class="ident" id="2995417">password</span><span class="op" id="2995425">)</span><span class="op" id="2995426">)</span><br>
<span class="lineno"></span><span class="op" id="2995428">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2995431">//&nbsp;parseRequestLine&nbsp;parses&nbsp;&#34;GET&nbsp;/foo&nbsp;HTTP/1.1&#34;&nbsp;into&nbsp;its&nbsp;three&nbsp;parts.</span><br>
<span class="lineno"></span><span class="keyword" id="2995500">func</span>&nbsp;<span class="ident" id="2995505">parseRequestLine</span><span class="op" id="2995521">(</span><span class="ident" id="2995522">line</span>&nbsp;<span class="builtintype" id="2995527">string</span><span class="op" id="2995533">)</span>&nbsp;<span class="op" id="2995535">(</span><span class="ident" id="2995536">method</span><span class="op" id="2995542">,</span>&nbsp;<span class="ident" id="2995544">requestURI</span><span class="op" id="2995554">,</span>&nbsp;<span class="ident" id="2995556">proto</span>&nbsp;<span class="builtintype" id="2995562">string</span><span class="op" id="2995568">,</span>&nbsp;<span class="ident" id="2995570">ok</span>&nbsp;<span class="builtintype" id="2995573">bool</span><span class="op" id="2995577">)</span>&nbsp;<span class="op" id="2995579">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2995582">s1</span>&nbsp;<span class="op" id="2995585">:=</span>&nbsp;<span class="ident" id="2995588">strings</span><span class="op" id="2995595">.</span><span class="ident" id="2995596">Index</span><span class="op" id="2995601">(</span><span class="ident" id="2995602">line</span><span class="op" id="2995606">,</span>&nbsp;<span class="string" id="2995608">&#34;&nbsp;&#34;</span><span class="op" id="2995611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2995614">s2</span>&nbsp;<span class="op" id="2995617">:=</span>&nbsp;<span class="ident" id="2995620">strings</span><span class="op" id="2995627">.</span><span class="ident" id="2995628">Index</span><span class="op" id="2995633">(</span><span class="ident" id="2995634">line</span><span class="op" id="2995638">[</span><span class="ident" id="2995639">s1</span><span class="op" id="2995641">+</span><span class="num" id="2995642">1</span><span class="op" id="2995643">:</span><span class="op" id="2995644">]</span><span class="op" id="2995645">,</span>&nbsp;<span class="string" id="2995647">&#34;&nbsp;&#34;</span><span class="op" id="2995650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2995653">if</span>&nbsp;<span class="ident" id="2995656">s1</span>&nbsp;<span class="op" id="2995659">&lt;</span>&nbsp;<span class="num" id="2995661">0</span>&nbsp;<span class="op" id="2995663">||</span>&nbsp;<span class="ident" id="2995666">s2</span>&nbsp;<span class="op" id="2995669">&lt;</span>&nbsp;<span class="num" id="2995671">0</span>&nbsp;<span class="op" id="2995673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2995677">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2995685">}</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2995688">s2</span>&nbsp;<span class="op" id="2995691">+=</span>&nbsp;<span class="ident" id="2995694">s1</span>&nbsp;<span class="op" id="2995697">+</span>&nbsp;<span class="num" id="2995699">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2995702">return</span>&nbsp;<span class="ident" id="2995709">line</span><span class="op" id="2995713">[</span><span class="op" id="2995714">:</span><span class="ident" id="2995715">s1</span><span class="op" id="2995717">]</span><span class="op" id="2995718">,</span>&nbsp;<span class="ident" id="2995720">line</span><span class="op" id="2995724">[</span><span class="ident" id="2995725">s1</span><span class="op" id="2995727">+</span><span class="num" id="2995728">1</span>&nbsp;<span class="op" id="2995730">:</span>&nbsp;<span class="ident" id="2995732">s2</span><span class="op" id="2995734">]</span><span class="op" id="2995735">,</span>&nbsp;<span class="ident" id="2995737">line</span><span class="op" id="2995741">[</span><span class="ident" id="2995742">s2</span><span class="op" id="2995744">+</span><span class="num" id="2995745">1</span><span class="op" id="2995746">:</span><span class="op" id="2995747">]</span><span class="op" id="2995748">,</span>&nbsp;<span class="builtintype" id="2995750">true</span><br>
<span class="lineno"></span><span class="op" id="2995755">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2995758">var</span>&nbsp;<span class="ident" id="2995762">textprotoReaderPool</span>&nbsp;<span class="ident" id="2995782">sync</span><span class="op" id="2995786">.</span><span class="ident" id="2995787">Pool</span><br>
<span class="lineno">575</span><br>
<span class="lineno"></span><span class="keyword" id="2995793">func</span>&nbsp;<span class="ident" id="2995798">newTextprotoReader</span><span class="op" id="2995816">(</span><span class="ident" id="2995817">br</span>&nbsp;<span class="op" id="2995820">*</span><span class="ident" id="2995821">bufio</span><span class="op" id="2995826">.</span><span class="ident" id="2995827">Reader</span><span class="op" id="2995833">)</span>&nbsp;<span class="op" id="2995835">*</span><span class="ident" id="2995836">textproto</span><span class="op" id="2995845">.</span><span class="ident" id="2995846">Reader</span>&nbsp;<span class="op" id="2995853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2995856">if</span>&nbsp;<span class="ident" id="2995859">v</span>&nbsp;<span class="op" id="2995861">:=</span>&nbsp;<span class="ident" id="2995864">textprotoReaderPool</span><span class="op" id="2995883">.</span><span class="ident" id="2995884">Get</span><span class="op" id="2995887">(</span><span class="op" id="2995888">)</span><span class="op" id="2995889">;</span>&nbsp;<span class="ident" id="2995891">v</span>&nbsp;<span class="op" id="2995893">!=</span>&nbsp;<span class="builtintype" id="2995896">nil</span>&nbsp;<span class="op" id="2995900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2995904">tr</span>&nbsp;<span class="op" id="2995907">:=</span>&nbsp;<span class="ident" id="2995910">v</span><span class="op" id="2995911">.</span><span class="op" id="2995912">(</span><span class="op" id="2995913">*</span><span class="ident" id="2995914">textproto</span><span class="op" id="2995923">.</span><span class="ident" id="2995924">Reader</span><span class="op" id="2995930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2995934">tr</span><span class="op" id="2995936">.</span><span class="ident" id="2995937">R</span>&nbsp;<span class="op" id="2995939">=</span>&nbsp;<span class="ident" id="2995941">br</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2995946">return</span>&nbsp;<span class="ident" id="2995953">tr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2995957">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2995960">return</span>&nbsp;<span class="ident" id="2995967">textproto</span><span class="op" id="2995976">.</span><span class="ident" id="2995977">NewReader</span><span class="op" id="2995986">(</span><span class="ident" id="2995987">br</span><span class="op" id="2995989">)</span><br>
<span class="lineno"></span><span class="op" id="2995991">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">585</span><span class="keyword" id="2995994">func</span>&nbsp;<span class="ident" id="2995999">putTextprotoReader</span><span class="op" id="2996017">(</span><span class="ident" id="2996018">r</span>&nbsp;<span class="op" id="2996020">*</span><span class="ident" id="2996021">textproto</span><span class="op" id="2996030">.</span><span class="ident" id="2996031">Reader</span><span class="op" id="2996037">)</span>&nbsp;<span class="op" id="2996039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2996042">r</span><span class="op" id="2996043">.</span><span class="ident" id="2996044">R</span>&nbsp;<span class="op" id="2996046">=</span>&nbsp;<span class="builtintype" id="2996048">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2996053">textprotoReaderPool</span><span class="op" id="2996072">.</span><span class="ident" id="2996073">Put</span><span class="op" id="2996076">(</span><span class="ident" id="2996077">r</span><span class="op" id="2996078">)</span><br>
<span class="lineno"></span><span class="op" id="2996080">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span><span class="comment" id="2996083">//&nbsp;ReadRequest&nbsp;reads&nbsp;and&nbsp;parses&nbsp;a&nbsp;request&nbsp;from&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="2996133">func</span>&nbsp;<span class="ident" id="2996138">ReadRequest</span><span class="op" id="2996149">(</span><span class="ident" id="2996150">b</span>&nbsp;<span class="op" id="2996152">*</span><span class="ident" id="2996153">bufio</span><span class="op" id="2996158">.</span><span class="ident" id="2996159">Reader</span><span class="op" id="2996165">)</span>&nbsp;<span class="op" id="2996167">(</span><span class="ident" id="2996168">req</span>&nbsp;<span class="op" id="2996172">*</span><span class="ident" id="2996173">Request</span><span class="op" id="2996180">,</span>&nbsp;<span class="ident" id="2996182">err</span>&nbsp;<span class="builtintype" id="2996186">error</span><span class="op" id="2996191">)</span>&nbsp;<span class="op" id="2996193">{</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2996197">tp</span>&nbsp;<span class="op" id="2996200">:=</span>&nbsp;<span class="ident" id="2996203">newTextprotoReader</span><span class="op" id="2996221">(</span><span class="ident" id="2996222">b</span><span class="op" id="2996223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2996226">req</span>&nbsp;<span class="op" id="2996230">=</span>&nbsp;<span class="builtinfunc" id="2996232">new</span><span class="op" id="2996235">(</span><span class="ident" id="2996236">Request</span><span class="op" id="2996243">)</span><br>
<span class="lineno">595</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2996247">//&nbsp;First&nbsp;line:&nbsp;GET&nbsp;/index.html&nbsp;HTTP/1.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2996288">var</span>&nbsp;<span class="ident" id="2996292">s</span>&nbsp;<span class="builtintype" id="2996294">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2996302">if</span>&nbsp;<span class="ident" id="2996305">s</span><span class="op" id="2996306">,</span>&nbsp;<span class="ident" id="2996308">err</span>&nbsp;<span class="op" id="2996312">=</span>&nbsp;<span class="ident" id="2996314">tp</span><span class="op" id="2996316">.</span><span class="ident" id="2996317">ReadLine</span><span class="op" id="2996325">(</span><span class="op" id="2996326">)</span><span class="op" id="2996327">;</span>&nbsp;<span class="ident" id="2996329">err</span>&nbsp;<span class="op" id="2996333">!=</span>&nbsp;<span class="builtintype" id="2996336">nil</span>&nbsp;<span class="op" id="2996340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2996344">return</span>&nbsp;<span class="builtintype" id="2996351">nil</span><span class="op" id="2996354">,</span>&nbsp;<span class="ident" id="2996356">err</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2996361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2996364">defer</span>&nbsp;<span class="keyword" id="2996370">func</span><span class="op" id="2996374">(</span><span class="op" id="2996375">)</span>&nbsp;<span class="op" id="2996377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2996381">putTextprotoReader</span><span class="op" id="2996399">(</span><span class="ident" id="2996400">tp</span><span class="op" id="2996402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2996406">if</span>&nbsp;<span class="ident" id="2996409">err</span>&nbsp;<span class="op" id="2996413">==</span>&nbsp;<span class="ident" id="2996416">io</span><span class="op" id="2996418">.</span><span class="ident" id="2996419">EOF</span>&nbsp;<span class="op" id="2996423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2996428">err</span>&nbsp;<span class="op" id="2996432">=</span>&nbsp;<span class="ident" id="2996434">io</span><span class="op" id="2996436">.</span><span class="ident" id="2996437">ErrUnexpectedEOF</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2996456">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2996459">}</span><span class="op" id="2996460">(</span><span class="op" id="2996461">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2996465">var</span>&nbsp;<span class="ident" id="2996469">ok</span>&nbsp;<span class="builtintype" id="2996472">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2996478">req</span><span class="op" id="2996481">.</span><span class="ident" id="2996482">Method</span><span class="op" id="2996488">,</span>&nbsp;<span class="ident" id="2996490">req</span><span class="op" id="2996493">.</span><span class="ident" id="2996494">RequestURI</span><span class="op" id="2996504">,</span>&nbsp;<span class="ident" id="2996506">req</span><span class="op" id="2996509">.</span><span class="ident" id="2996510">Proto</span><span class="op" id="2996515">,</span>&nbsp;<span class="ident" id="2996517">ok</span>&nbsp;<span class="op" id="2996520">=</span>&nbsp;<span class="ident" id="2996522">parseRequestLine</span><span class="op" id="2996538">(</span><span class="ident" id="2996539">s</span><span class="op" id="2996540">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2996543">if</span>&nbsp;<span class="op" id="2996546">!</span><span class="ident" id="2996547">ok</span>&nbsp;<span class="op" id="2996550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2996554">return</span>&nbsp;<span class="builtintype" id="2996561">nil</span><span class="op" id="2996564">,</span>&nbsp;<span class="op" id="2996566">&amp;</span><span class="ident" id="2996567">badStringError</span><span class="op" id="2996581">{</span><span class="string" id="2996582">&#34;malformed&nbsp;HTTP&nbsp;request&#34;</span><span class="op" id="2996606">,</span>&nbsp;<span class="ident" id="2996608">s</span><span class="op" id="2996609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2996612">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2996615">rawurl</span>&nbsp;<span class="op" id="2996622">:=</span>&nbsp;<span class="ident" id="2996625">req</span><span class="op" id="2996628">.</span><span class="ident" id="2996629">RequestURI</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2996641">if</span>&nbsp;<span class="ident" id="2996644">req</span><span class="op" id="2996647">.</span><span class="ident" id="2996648">ProtoMajor</span><span class="op" id="2996658">,</span>&nbsp;<span class="ident" id="2996660">req</span><span class="op" id="2996663">.</span><span class="ident" id="2996664">ProtoMinor</span><span class="op" id="2996674">,</span>&nbsp;<span class="ident" id="2996676">ok</span>&nbsp;<span class="op" id="2996679">=</span>&nbsp;<span class="ident" id="2996681">ParseHTTPVersion</span><span class="op" id="2996697">(</span><span class="ident" id="2996698">req</span><span class="op" id="2996701">.</span><span class="ident" id="2996702">Proto</span><span class="op" id="2996707">)</span><span class="op" id="2996708">;</span>&nbsp;<span class="op" id="2996710">!</span><span class="ident" id="2996711">ok</span>&nbsp;<span class="op" id="2996714">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2996718">return</span>&nbsp;<span class="builtintype" id="2996725">nil</span><span class="op" id="2996728">,</span>&nbsp;<span class="op" id="2996730">&amp;</span><span class="ident" id="2996731">badStringError</span><span class="op" id="2996745">{</span><span class="string" id="2996746">&#34;malformed&nbsp;HTTP&nbsp;version&#34;</span><span class="op" id="2996770">,</span>&nbsp;<span class="ident" id="2996772">req</span><span class="op" id="2996775">.</span><span class="ident" id="2996776">Proto</span><span class="op" id="2996781">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2996784">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2996788">//&nbsp;CONNECT&nbsp;requests&nbsp;are&nbsp;used&nbsp;two&nbsp;different&nbsp;ways,&nbsp;and&nbsp;neither&nbsp;uses&nbsp;a&nbsp;full&nbsp;URL:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2996867">//&nbsp;The&nbsp;standard&nbsp;use&nbsp;is&nbsp;to&nbsp;tunnel&nbsp;HTTPS&nbsp;through&nbsp;an&nbsp;HTTP&nbsp;proxy.</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2996930">//&nbsp;It&nbsp;looks&nbsp;like&nbsp;&#34;CONNECT&nbsp;www.google.com:443&nbsp;HTTP/1.1&#34;,&nbsp;and&nbsp;the&nbsp;parameter&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2997008">//&nbsp;just&nbsp;the&nbsp;authority&nbsp;section&nbsp;of&nbsp;a&nbsp;URL.&nbsp;This&nbsp;information&nbsp;should&nbsp;go&nbsp;in&nbsp;req.URL.Host.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2997093">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2997097">//&nbsp;The&nbsp;net/rpc&nbsp;package&nbsp;also&nbsp;uses&nbsp;CONNECT,&nbsp;but&nbsp;there&nbsp;the&nbsp;parameter&nbsp;is&nbsp;a&nbsp;path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2997174">//&nbsp;that&nbsp;starts&nbsp;with&nbsp;a&nbsp;slash.&nbsp;It&nbsp;can&nbsp;be&nbsp;parsed&nbsp;with&nbsp;the&nbsp;regular&nbsp;URL&nbsp;parser,</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2997250">//&nbsp;and&nbsp;the&nbsp;path&nbsp;will&nbsp;end&nbsp;up&nbsp;in&nbsp;req.URL.Path,&nbsp;where&nbsp;it&nbsp;needs&nbsp;to&nbsp;be&nbsp;in&nbsp;order&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2997330">//&nbsp;RPC&nbsp;to&nbsp;work.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2997347">justAuthority</span>&nbsp;<span class="op" id="2997361">:=</span>&nbsp;<span class="ident" id="2997364">req</span><span class="op" id="2997367">.</span><span class="ident" id="2997368">Method</span>&nbsp;<span class="op" id="2997375">==</span>&nbsp;<span class="string" id="2997378">&#34;CONNECT&#34;</span>&nbsp;<span class="op" id="2997388">&amp;&amp;</span>&nbsp;<span class="op" id="2997391">!</span><span class="ident" id="2997392">strings</span><span class="op" id="2997399">.</span><span class="ident" id="2997400">HasPrefix</span><span class="op" id="2997409">(</span><span class="ident" id="2997410">rawurl</span><span class="op" id="2997416">,</span>&nbsp;<span class="string" id="2997418">&#34;/&#34;</span><span class="op" id="2997421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2997424">if</span>&nbsp;<span class="ident" id="2997427">justAuthority</span>&nbsp;<span class="op" id="2997441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2997445">rawurl</span>&nbsp;<span class="op" id="2997452">=</span>&nbsp;<span class="string" id="2997454">&#34;http://&#34;</span>&nbsp;<span class="op" id="2997464">+</span>&nbsp;<span class="ident" id="2997466">rawurl</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2997474">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2997478">if</span>&nbsp;<span class="ident" id="2997481">req</span><span class="op" id="2997484">.</span><span class="ident" id="2997485">URL</span><span class="op" id="2997488">,</span>&nbsp;<span class="ident" id="2997490">err</span>&nbsp;<span class="op" id="2997494">=</span>&nbsp;<span class="ident" id="2997496">url</span><span class="op" id="2997499">.</span><span class="ident" id="2997500">ParseRequestURI</span><span class="op" id="2997515">(</span><span class="ident" id="2997516">rawurl</span><span class="op" id="2997522">)</span><span class="op" id="2997523">;</span>&nbsp;<span class="ident" id="2997525">err</span>&nbsp;<span class="op" id="2997529">!=</span>&nbsp;<span class="builtintype" id="2997532">nil</span>&nbsp;<span class="op" id="2997536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2997540">return</span>&nbsp;<span class="builtintype" id="2997547">nil</span><span class="op" id="2997550">,</span>&nbsp;<span class="ident" id="2997552">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2997557">}</span><br>
<span class="lineno">635</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2997561">if</span>&nbsp;<span class="ident" id="2997564">justAuthority</span>&nbsp;<span class="op" id="2997578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2997582">//&nbsp;Strip&nbsp;the&nbsp;bogus&nbsp;&#34;http://&#34;&nbsp;back&nbsp;off.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2997623">req</span><span class="op" id="2997626">.</span><span class="ident" id="2997627">URL</span><span class="op" id="2997630">.</span><span class="ident" id="2997631">Scheme</span>&nbsp;<span class="op" id="2997638">=</span>&nbsp;<span class="string" id="2997640">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2997644">}</span><br>
<span class="lineno">640</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2997648">//&nbsp;Subsequent&nbsp;lines:&nbsp;Key:&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2997682">mimeHeader</span><span class="op" id="2997692">,</span>&nbsp;<span class="ident" id="2997694">err</span>&nbsp;<span class="op" id="2997698">:=</span>&nbsp;<span class="ident" id="2997701">tp</span><span class="op" id="2997703">.</span><span class="ident" id="2997704">ReadMIMEHeader</span><span class="op" id="2997718">(</span><span class="op" id="2997719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2997722">if</span>&nbsp;<span class="ident" id="2997725">err</span>&nbsp;<span class="op" id="2997729">!=</span>&nbsp;<span class="builtintype" id="2997732">nil</span>&nbsp;<span class="op" id="2997736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2997740">return</span>&nbsp;<span class="builtintype" id="2997747">nil</span><span class="op" id="2997750">,</span>&nbsp;<span class="ident" id="2997752">err</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2997757">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2997760">req</span><span class="op" id="2997763">.</span><span class="ident" id="2997764">Header</span>&nbsp;<span class="op" id="2997771">=</span>&nbsp;<span class="ident" id="2997773">Header</span><span class="op" id="2997779">(</span><span class="ident" id="2997780">mimeHeader</span><span class="op" id="2997790">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2997794">//&nbsp;RFC2616:&nbsp;Must&nbsp;treat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2997818">//&nbsp;&nbsp;&nbsp;&nbsp;GET&nbsp;/index.html&nbsp;HTTP/1.1</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2997847">//&nbsp;&nbsp;&nbsp;&nbsp;Host:&nbsp;www.google.com</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2997872">//&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2997880">//&nbsp;&nbsp;&nbsp;&nbsp;GET&nbsp;http://www.google.com/index.html&nbsp;HTTP/1.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2997930">//&nbsp;&nbsp;&nbsp;&nbsp;Host:&nbsp;doesntmatter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2997953">//&nbsp;the&nbsp;same.&nbsp;&nbsp;In&nbsp;the&nbsp;second&nbsp;case,&nbsp;any&nbsp;Host&nbsp;line&nbsp;is&nbsp;ignored.</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2998014">req</span><span class="op" id="2998017">.</span><span class="ident" id="2998018">Host</span>&nbsp;<span class="op" id="2998023">=</span>&nbsp;<span class="ident" id="2998025">req</span><span class="op" id="2998028">.</span><span class="ident" id="2998029">URL</span><span class="op" id="2998032">.</span><span class="ident" id="2998033">Host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2998039">if</span>&nbsp;<span class="ident" id="2998042">req</span><span class="op" id="2998045">.</span><span class="ident" id="2998046">Host</span>&nbsp;<span class="op" id="2998051">==</span>&nbsp;<span class="string" id="2998054">&#34;&#34;</span>&nbsp;<span class="op" id="2998057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2998061">req</span><span class="op" id="2998064">.</span><span class="ident" id="2998065">Host</span>&nbsp;<span class="op" id="2998070">=</span>&nbsp;<span class="ident" id="2998072">req</span><span class="op" id="2998075">.</span><span class="ident" id="2998076">Header</span><span class="op" id="2998082">.</span><span class="ident" id="2998083">get</span><span class="op" id="2998086">(</span><span class="string" id="2998087">&#34;Host&#34;</span><span class="op" id="2998093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2998096">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2998099">delete</span><span class="op" id="2998105">(</span><span class="ident" id="2998106">req</span><span class="op" id="2998109">.</span><span class="ident" id="2998110">Header</span><span class="op" id="2998116">,</span>&nbsp;<span class="string" id="2998118">&#34;Host&#34;</span><span class="op" id="2998124">)</span><br>
<span class="lineno">660</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2998128">fixPragmaCacheControl</span><span class="op" id="2998149">(</span><span class="ident" id="2998150">req</span><span class="op" id="2998153">.</span><span class="ident" id="2998154">Header</span><span class="op" id="2998160">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2998164">err</span>&nbsp;<span class="op" id="2998168">=</span>&nbsp;<span class="ident" id="2998170">readTransfer</span><span class="op" id="2998182">(</span><span class="ident" id="2998183">req</span><span class="op" id="2998186">,</span>&nbsp;<span class="ident" id="2998188">b</span><span class="op" id="2998189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2998192">if</span>&nbsp;<span class="ident" id="2998195">err</span>&nbsp;<span class="op" id="2998199">!=</span>&nbsp;<span class="builtintype" id="2998202">nil</span>&nbsp;<span class="op" id="2998206">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2998210">return</span>&nbsp;<span class="builtintype" id="2998217">nil</span><span class="op" id="2998220">,</span>&nbsp;<span class="ident" id="2998222">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2998227">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2998231">req</span><span class="op" id="2998234">.</span><span class="ident" id="2998235">Close</span>&nbsp;<span class="op" id="2998241">=</span>&nbsp;<span class="ident" id="2998243">shouldClose</span><span class="op" id="2998254">(</span><span class="ident" id="2998255">req</span><span class="op" id="2998258">.</span><span class="ident" id="2998259">ProtoMajor</span><span class="op" id="2998269">,</span>&nbsp;<span class="ident" id="2998271">req</span><span class="op" id="2998274">.</span><span class="ident" id="2998275">ProtoMinor</span><span class="op" id="2998285">,</span>&nbsp;<span class="ident" id="2998287">req</span><span class="op" id="2998290">.</span><span class="ident" id="2998291">Header</span><span class="op" id="2998297">,</span>&nbsp;<span class="builtintype" id="2998299">false</span><span class="op" id="2998304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2998307">return</span>&nbsp;<span class="ident" id="2998314">req</span><span class="op" id="2998317">,</span>&nbsp;<span class="builtintype" id="2998319">nil</span><br>
<span class="lineno">670</span><span class="op" id="2998323">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2998326">//&nbsp;MaxBytesReader&nbsp;is&nbsp;similar&nbsp;to&nbsp;io.LimitReader&nbsp;but&nbsp;is&nbsp;intended&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="2998393">//&nbsp;limiting&nbsp;the&nbsp;size&nbsp;of&nbsp;incoming&nbsp;request&nbsp;bodies.&nbsp;In&nbsp;contrast&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="2998457">//&nbsp;io.LimitReader,&nbsp;MaxBytesReader&#39;s&nbsp;result&nbsp;is&nbsp;a&nbsp;ReadCloser,&nbsp;returns&nbsp;a</span><br>
<span class="lineno">675</span><span class="comment" id="2998527">//&nbsp;non-EOF&nbsp;error&nbsp;for&nbsp;a&nbsp;Read&nbsp;beyond&nbsp;the&nbsp;limit,&nbsp;and&nbsp;Closes&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2998588">//&nbsp;underlying&nbsp;reader&nbsp;when&nbsp;its&nbsp;Close&nbsp;method&nbsp;is&nbsp;called.</span><br>
<span class="lineno"></span><span class="comment" id="2998642">//</span><br>
<span class="lineno"></span><span class="comment" id="2998645">//&nbsp;MaxBytesReader&nbsp;prevents&nbsp;clients&nbsp;from&nbsp;accidentally&nbsp;or&nbsp;maliciously</span><br>
<span class="lineno"></span><span class="comment" id="2998713">//&nbsp;sending&nbsp;a&nbsp;large&nbsp;request&nbsp;and&nbsp;wasting&nbsp;server&nbsp;resources.</span><br>
<span class="lineno">680</span><span class="keyword" id="2998770">func</span>&nbsp;<span class="ident" id="2998775">MaxBytesReader</span><span class="op" id="2998789">(</span><span class="ident" id="2998790">w</span>&nbsp;<span class="ident" id="2998792">ResponseWriter</span><span class="op" id="2998806">,</span>&nbsp;<span class="ident" id="2998808">r</span>&nbsp;<span class="ident" id="2998810">io</span><span class="op" id="2998812">.</span><span class="ident" id="2998813">ReadCloser</span><span class="op" id="2998823">,</span>&nbsp;<span class="ident" id="2998825">n</span>&nbsp;<span class="ident" id="2998827">int64</span><span class="op" id="2998832">)</span>&nbsp;<span class="ident" id="2998834">io</span><span class="op" id="2998836">.</span><span class="ident" id="2998837">ReadCloser</span>&nbsp;<span class="op" id="2998848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2998851">return</span>&nbsp;<span class="op" id="2998858">&amp;</span><span class="ident" id="2998859">maxBytesReader</span><span class="op" id="2998873">{</span><span class="ident" id="2998874">w</span><span class="op" id="2998875">:</span>&nbsp;<span class="ident" id="2998877">w</span><span class="op" id="2998878">,</span>&nbsp;<span class="ident" id="2998880">r</span><span class="op" id="2998881">:</span>&nbsp;<span class="ident" id="2998883">r</span><span class="op" id="2998884">,</span>&nbsp;<span class="ident" id="2998886">n</span><span class="op" id="2998887">:</span>&nbsp;<span class="ident" id="2998889">n</span><span class="op" id="2998890">}</span><br>
<span class="lineno"></span><span class="op" id="2998892">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2998895">type</span>&nbsp;<span class="ident" id="2998900">maxBytesReader</span>&nbsp;<span class="keyword" id="2998915">struct</span>&nbsp;<span class="op" id="2998922">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2998925">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2998933">ResponseWriter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2998949">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2998957">io</span><span class="op" id="2998959">.</span><span class="ident" id="2998960">ReadCloser</span>&nbsp;<span class="comment" id="2998971">//&nbsp;underlying&nbsp;reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2998993">n</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2999001">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2999015">//&nbsp;max&nbsp;bytes&nbsp;remaining</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2999039">stopped</span>&nbsp;<span class="builtintype" id="2999047">bool</span><br>
<span class="lineno"></span><span class="op" id="2999052">}</span><br>
<span class="lineno">690</span><br>
<span class="lineno"></span><span class="keyword" id="2999055">func</span>&nbsp;<span class="op" id="2999060">(</span><span class="ident" id="2999061">l</span>&nbsp;<span class="op" id="2999063">*</span><span class="ident" id="2999064">maxBytesReader</span><span class="op" id="2999078">)</span>&nbsp;<span class="ident" id="2999080">Read</span><span class="op" id="2999084">(</span><span class="ident" id="2999085">p</span>&nbsp;<span class="op" id="2999087">[</span><span class="op" id="2999088">]</span><span class="builtintype" id="2999089">byte</span><span class="op" id="2999093">)</span>&nbsp;<span class="op" id="2999095">(</span><span class="ident" id="2999096">n</span>&nbsp;<span class="builtintype" id="2999098">int</span><span class="op" id="2999101">,</span>&nbsp;<span class="ident" id="2999103">err</span>&nbsp;<span class="builtintype" id="2999107">error</span><span class="op" id="2999112">)</span>&nbsp;<span class="op" id="2999114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2999117">if</span>&nbsp;<span class="ident" id="2999120">l</span><span class="op" id="2999121">.</span><span class="ident" id="2999122">n</span>&nbsp;<span class="op" id="2999124">&lt;=</span>&nbsp;<span class="num" id="2999127">0</span>&nbsp;<span class="op" id="2999129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2999133">if</span>&nbsp;<span class="op" id="2999136">!</span><span class="ident" id="2999137">l</span><span class="op" id="2999138">.</span><span class="ident" id="2999139">stopped</span>&nbsp;<span class="op" id="2999147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2999152">l</span><span class="op" id="2999153">.</span><span class="ident" id="2999154">stopped</span>&nbsp;<span class="op" id="2999162">=</span>&nbsp;<span class="builtintype" id="2999164">true</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2999172">if</span>&nbsp;<span class="ident" id="2999175">res</span><span class="op" id="2999178">,</span>&nbsp;<span class="ident" id="2999180">ok</span>&nbsp;<span class="op" id="2999183">:=</span>&nbsp;<span class="ident" id="2999186">l</span><span class="op" id="2999187">.</span><span class="ident" id="2999188">w</span><span class="op" id="2999189">.</span><span class="op" id="2999190">(</span><span class="op" id="2999191">*</span><span class="ident" id="2999192">response</span><span class="op" id="2999200">)</span><span class="op" id="2999201">;</span>&nbsp;<span class="ident" id="2999203">ok</span>&nbsp;<span class="op" id="2999206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2999212">res</span><span class="op" id="2999215">.</span><span class="ident" id="2999216">requestTooLarge</span><span class="op" id="2999231">(</span><span class="op" id="2999232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2999237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2999241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2999245">return</span>&nbsp;<span class="num" id="2999252">0</span><span class="op" id="2999253">,</span>&nbsp;<span class="ident" id="2999255">errors</span><span class="op" id="2999261">.</span><span class="ident" id="2999262">New</span><span class="op" id="2999265">(</span><span class="string" id="2999266">&#34;http:&nbsp;request&nbsp;body&nbsp;too&nbsp;large&#34;</span><span class="op" id="2999296">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2999299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2999302">if</span>&nbsp;<span class="ident" id="2999305">int64</span><span class="op" id="2999310">(</span><span class="builtinfunc" id="2999311">len</span><span class="op" id="2999314">(</span><span class="ident" id="2999315">p</span><span class="op" id="2999316">)</span><span class="op" id="2999317">)</span>&nbsp;<span class="op" id="2999319">&gt;</span>&nbsp;<span class="ident" id="2999321">l</span><span class="op" id="2999322">.</span><span class="ident" id="2999323">n</span>&nbsp;<span class="op" id="2999325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2999329">p</span>&nbsp;<span class="op" id="2999331">=</span>&nbsp;<span class="ident" id="2999333">p</span><span class="op" id="2999334">[</span><span class="op" id="2999335">:</span><span class="ident" id="2999336">l</span><span class="op" id="2999337">.</span><span class="ident" id="2999338">n</span><span class="op" id="2999339">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2999342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2999345">n</span><span class="op" id="2999346">,</span>&nbsp;<span class="ident" id="2999348">err</span>&nbsp;<span class="op" id="2999352">=</span>&nbsp;<span class="ident" id="2999354">l</span><span class="op" id="2999355">.</span><span class="ident" id="2999356">r</span><span class="op" id="2999357">.</span><span class="ident" id="2999358">Read</span><span class="op" id="2999362">(</span><span class="ident" id="2999363">p</span><span class="op" id="2999364">)</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2999367">l</span><span class="op" id="2999368">.</span><span class="ident" id="2999369">n</span>&nbsp;<span class="op" id="2999371">-=</span>&nbsp;<span class="ident" id="2999374">int64</span><span class="op" id="2999379">(</span><span class="ident" id="2999380">n</span><span class="op" id="2999381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2999384">return</span><br>
<span class="lineno"></span><span class="op" id="2999391">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2999394">func</span>&nbsp;<span class="op" id="2999399">(</span><span class="ident" id="2999400">l</span>&nbsp;<span class="op" id="2999402">*</span><span class="ident" id="2999403">maxBytesReader</span><span class="op" id="2999417">)</span>&nbsp;<span class="ident" id="2999419">Close</span><span class="op" id="2999424">(</span><span class="op" id="2999425">)</span>&nbsp;<span class="builtintype" id="2999427">error</span>&nbsp;<span class="op" id="2999433">{</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2999436">return</span>&nbsp;<span class="ident" id="2999443">l</span><span class="op" id="2999444">.</span><span class="ident" id="2999445">r</span><span class="op" id="2999446">.</span><span class="ident" id="2999447">Close</span><span class="op" id="2999452">(</span><span class="op" id="2999453">)</span><br>
<span class="lineno"></span><span class="op" id="2999455">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2999458">func</span>&nbsp;<span class="ident" id="2999463">copyValues</span><span class="op" id="2999473">(</span><span class="ident" id="2999474">dst</span><span class="op" id="2999477">,</span>&nbsp;<span class="ident" id="2999479">src</span>&nbsp;<span class="ident" id="2999483">url</span><span class="op" id="2999486">.</span><span class="ident" id="2999487">Values</span><span class="op" id="2999493">)</span>&nbsp;<span class="op" id="2999495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2999498">for</span>&nbsp;<span class="ident" id="2999502">k</span><span class="op" id="2999503">,</span>&nbsp;<span class="ident" id="2999505">vs</span>&nbsp;<span class="op" id="2999508">:=</span>&nbsp;<span class="keyword" id="2999511">range</span>&nbsp;<span class="ident" id="2999517">src</span>&nbsp;<span class="op" id="2999521">{</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2999525">for</span>&nbsp;<span class="ident" id="2999529">_</span><span class="op" id="2999530">,</span>&nbsp;<span class="ident" id="2999532">value</span>&nbsp;<span class="op" id="2999538">:=</span>&nbsp;<span class="keyword" id="2999541">range</span>&nbsp;<span class="ident" id="2999547">vs</span>&nbsp;<span class="op" id="2999550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2999555">dst</span><span class="op" id="2999558">.</span><span class="ident" id="2999559">Add</span><span class="op" id="2999562">(</span><span class="ident" id="2999563">k</span><span class="op" id="2999564">,</span>&nbsp;<span class="ident" id="2999566">value</span><span class="op" id="2999571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2999575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2999578">}</span><br>
<span class="lineno"></span><span class="op" id="2999580">}</span><br>
<span class="lineno">720</span><br>
<span class="lineno"></span><span class="keyword" id="2999583">func</span>&nbsp;<span class="ident" id="2999588">parsePostForm</span><span class="op" id="2999601">(</span><span class="ident" id="2999602">r</span>&nbsp;<span class="op" id="2999604">*</span><span class="ident" id="2999605">Request</span><span class="op" id="2999612">)</span>&nbsp;<span class="op" id="2999614">(</span><span class="ident" id="2999615">vs</span>&nbsp;<span class="ident" id="2999618">url</span><span class="op" id="2999621">.</span><span class="ident" id="2999622">Values</span><span class="op" id="2999628">,</span>&nbsp;<span class="ident" id="2999630">err</span>&nbsp;<span class="builtintype" id="2999634">error</span><span class="op" id="2999639">)</span>&nbsp;<span class="op" id="2999641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2999644">if</span>&nbsp;<span class="ident" id="2999647">r</span><span class="op" id="2999648">.</span><span class="ident" id="2999649">Body</span>&nbsp;<span class="op" id="2999654">==</span>&nbsp;<span class="builtintype" id="2999657">nil</span>&nbsp;<span class="op" id="2999661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2999665">err</span>&nbsp;<span class="op" id="2999669">=</span>&nbsp;<span class="ident" id="2999671">errors</span><span class="op" id="2999677">.</span><span class="ident" id="2999678">New</span><span class="op" id="2999681">(</span><span class="string" id="2999682">&#34;missing&nbsp;form&nbsp;body&#34;</span><span class="op" id="2999701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2999705">return</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2999713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2999716">ct</span>&nbsp;<span class="op" id="2999719">:=</span>&nbsp;<span class="ident" id="2999722">r</span><span class="op" id="2999723">.</span><span class="ident" id="2999724">Header</span><span class="op" id="2999730">.</span><span class="ident" id="2999731">Get</span><span class="op" id="2999734">(</span><span class="string" id="2999735">&#34;Content-Type&#34;</span><span class="op" id="2999749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2999752">//&nbsp;RFC&nbsp;2616,&nbsp;section&nbsp;7.2.1&nbsp;-&nbsp;empty&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2999793">//&nbsp;&nbsp;&nbsp;SHOULD&nbsp;be&nbsp;treated&nbsp;as&nbsp;application/octet-stream</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2999845">if</span>&nbsp;<span class="ident" id="2999848">ct</span>&nbsp;<span class="op" id="2999851">==</span>&nbsp;<span class="string" id="2999854">&#34;&#34;</span>&nbsp;<span class="op" id="2999857">{</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2999861">ct</span>&nbsp;<span class="op" id="2999864">=</span>&nbsp;<span class="string" id="2999866">&#34;application/octet-stream&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2999894">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2999897">ct</span><span class="op" id="2999899">,</span>&nbsp;<span class="ident" id="2999901">_</span><span class="op" id="2999902">,</span>&nbsp;<span class="ident" id="2999904">err</span>&nbsp;<span class="op" id="2999908">=</span>&nbsp;<span class="ident" id="2999910">mime</span><span class="op" id="2999914">.</span><span class="ident" id="2999915">ParseMediaType</span><span class="op" id="2999929">(</span><span class="ident" id="2999930">ct</span><span class="op" id="2999932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2999935">switch</span>&nbsp;<span class="op" id="2999942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2999945">case</span>&nbsp;<span class="ident" id="2999950">ct</span>&nbsp;<span class="op" id="2999953">==</span>&nbsp;<span class="string" id="2999956">&#34;application/x-www-form-urlencoded&#34;</span><span class="op" id="2999991">:</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2999995">var</span>&nbsp;<span class="ident" id="2999999">reader</span>&nbsp;<span class="ident" id="3000006">io</span><span class="op" id="3000008">.</span><span class="ident" id="3000009">Reader</span>&nbsp;<span class="op" id="3000016">=</span>&nbsp;<span class="ident" id="3000018">r</span><span class="op" id="3000019">.</span><span class="ident" id="3000020">Body</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3000027">maxFormSize</span>&nbsp;<span class="op" id="3000039">:=</span>&nbsp;<span class="ident" id="3000042">int64</span><span class="op" id="3000047">(</span><span class="num" id="3000048">1</span><span class="op" id="3000049">&lt;&lt;</span><span class="num" id="3000051">63</span>&nbsp;<span class="op" id="3000054">-</span>&nbsp;<span class="num" id="3000056">1</span><span class="op" id="3000057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3000061">if</span>&nbsp;<span class="ident" id="3000064">_</span><span class="op" id="3000065">,</span>&nbsp;<span class="ident" id="3000067">ok</span>&nbsp;<span class="op" id="3000070">:=</span>&nbsp;<span class="ident" id="3000073">r</span><span class="op" id="3000074">.</span><span class="ident" id="3000075">Body</span><span class="op" id="3000079">.</span><span class="op" id="3000080">(</span><span class="op" id="3000081">*</span><span class="ident" id="3000082">maxBytesReader</span><span class="op" id="3000096">)</span><span class="op" id="3000097">;</span>&nbsp;<span class="op" id="3000099">!</span><span class="ident" id="3000100">ok</span>&nbsp;<span class="op" id="3000103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3000108">maxFormSize</span>&nbsp;<span class="op" id="3000120">=</span>&nbsp;<span class="ident" id="3000122">int64</span><span class="op" id="3000127">(</span><span class="num" id="3000128">10</span>&nbsp;<span class="op" id="3000131">&lt;&lt;</span>&nbsp;<span class="num" id="3000134">20</span><span class="op" id="3000136">)</span>&nbsp;<span class="comment" id="3000138">//&nbsp;10&nbsp;MB&nbsp;is&nbsp;a&nbsp;lot&nbsp;of&nbsp;text.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3000168">reader</span>&nbsp;<span class="op" id="3000175">=</span>&nbsp;<span class="ident" id="3000177">io</span><span class="op" id="3000179">.</span><span class="ident" id="3000180">LimitReader</span><span class="op" id="3000191">(</span><span class="ident" id="3000192">r</span><span class="op" id="3000193">.</span><span class="ident" id="3000194">Body</span><span class="op" id="3000198">,</span>&nbsp;<span class="ident" id="3000200">maxFormSize</span><span class="op" id="3000211">+</span><span class="num" id="3000212">1</span><span class="op" id="3000213">)</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3000217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3000221">b</span><span class="op" id="3000222">,</span>&nbsp;<span class="ident" id="3000224">e</span>&nbsp;<span class="op" id="3000226">:=</span>&nbsp;<span class="ident" id="3000229">ioutil</span><span class="op" id="3000235">.</span><span class="ident" id="3000236">ReadAll</span><span class="op" id="3000243">(</span><span class="ident" id="3000244">reader</span><span class="op" id="3000250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3000254">if</span>&nbsp;<span class="ident" id="3000257">e</span>&nbsp;<span class="op" id="3000259">!=</span>&nbsp;<span class="builtintype" id="3000262">nil</span>&nbsp;<span class="op" id="3000266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3000271">if</span>&nbsp;<span class="ident" id="3000274">err</span>&nbsp;<span class="op" id="3000278">==</span>&nbsp;<span class="builtintype" id="3000281">nil</span>&nbsp;<span class="op" id="3000285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3000291">err</span>&nbsp;<span class="op" id="3000295">=</span>&nbsp;<span class="ident" id="3000297">e</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3000302">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3000307">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3000315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3000319">if</span>&nbsp;<span class="ident" id="3000322">int64</span><span class="op" id="3000327">(</span><span class="builtinfunc" id="3000328">len</span><span class="op" id="3000331">(</span><span class="ident" id="3000332">b</span><span class="op" id="3000333">)</span><span class="op" id="3000334">)</span>&nbsp;<span class="op" id="3000336">&gt;</span>&nbsp;<span class="ident" id="3000338">maxFormSize</span>&nbsp;<span class="op" id="3000350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3000355">err</span>&nbsp;<span class="op" id="3000359">=</span>&nbsp;<span class="ident" id="3000361">errors</span><span class="op" id="3000367">.</span><span class="ident" id="3000368">New</span><span class="op" id="3000371">(</span><span class="string" id="3000372">&#34;http:&nbsp;POST&nbsp;too&nbsp;large&#34;</span><span class="op" id="3000394">)</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3000399">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3000408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3000412">vs</span><span class="op" id="3000414">,</span>&nbsp;<span class="ident" id="3000416">e</span>&nbsp;<span class="op" id="3000418">=</span>&nbsp;<span class="ident" id="3000420">url</span><span class="op" id="3000423">.</span><span class="ident" id="3000424">ParseQuery</span><span class="op" id="3000434">(</span><span class="builtintype" id="3000435">string</span><span class="op" id="3000441">(</span><span class="ident" id="3000442">b</span><span class="op" id="3000443">)</span><span class="op" id="3000444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3000448">if</span>&nbsp;<span class="ident" id="3000451">err</span>&nbsp;<span class="op" id="3000455">==</span>&nbsp;<span class="builtintype" id="3000458">nil</span>&nbsp;<span class="op" id="3000462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3000467">err</span>&nbsp;<span class="op" id="3000471">=</span>&nbsp;<span class="ident" id="3000473">e</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3000477">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3000480">case</span>&nbsp;<span class="ident" id="3000485">ct</span>&nbsp;<span class="op" id="3000488">==</span>&nbsp;<span class="string" id="3000491">&#34;multipart/form-data&#34;</span><span class="op" id="3000512">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3000516">//&nbsp;handled&nbsp;by&nbsp;ParseMultipartForm&nbsp;(which&nbsp;is&nbsp;calling&nbsp;us,&nbsp;or&nbsp;should&nbsp;be)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3000587">//&nbsp;TODO(bradfitz):&nbsp;there&nbsp;are&nbsp;too&nbsp;many&nbsp;possible</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3000636">//&nbsp;orders&nbsp;to&nbsp;call&nbsp;too&nbsp;many&nbsp;functions&nbsp;here.</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3000681">//&nbsp;Clean&nbsp;this&nbsp;up&nbsp;and&nbsp;write&nbsp;more&nbsp;tests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3000722">//&nbsp;request_test.go&nbsp;contains&nbsp;the&nbsp;start&nbsp;of&nbsp;this,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3000771">//&nbsp;in&nbsp;TestParseMultipartFormOrder&nbsp;and&nbsp;others.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3000818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3000821">return</span><br>
<span class="lineno">765</span><span class="op" id="3000828">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3000831">//&nbsp;ParseForm&nbsp;parses&nbsp;the&nbsp;raw&nbsp;query&nbsp;from&nbsp;the&nbsp;URL&nbsp;and&nbsp;updates&nbsp;r.Form.</span><br>
<span class="lineno"></span><span class="comment" id="3000898">//</span><br>
<span class="lineno"></span><span class="comment" id="3000901">//&nbsp;For&nbsp;POST&nbsp;or&nbsp;PUT&nbsp;requests,&nbsp;it&nbsp;also&nbsp;parses&nbsp;the&nbsp;request&nbsp;body&nbsp;as&nbsp;a&nbsp;form&nbsp;and</span><br>
<span class="lineno">770</span><span class="comment" id="3000976">//&nbsp;put&nbsp;the&nbsp;results&nbsp;into&nbsp;both&nbsp;r.PostForm&nbsp;and&nbsp;r.Form.</span><br>
<span class="lineno"></span><span class="comment" id="3001028">//&nbsp;POST&nbsp;and&nbsp;PUT&nbsp;body&nbsp;parameters&nbsp;take&nbsp;precedence&nbsp;over&nbsp;URL&nbsp;query&nbsp;string&nbsp;values</span><br>
<span class="lineno"></span><span class="comment" id="3001105">//&nbsp;in&nbsp;r.Form.</span><br>
<span class="lineno"></span><span class="comment" id="3001119">//</span><br>
<span class="lineno"></span><span class="comment" id="3001122">//&nbsp;If&nbsp;the&nbsp;request&nbsp;Body&#39;s&nbsp;size&nbsp;has&nbsp;not&nbsp;already&nbsp;been&nbsp;limited&nbsp;by&nbsp;MaxBytesReader,</span><br>
<span class="lineno">775</span><span class="comment" id="3001200">//&nbsp;the&nbsp;size&nbsp;is&nbsp;capped&nbsp;at&nbsp;10MB.</span><br>
<span class="lineno"></span><span class="comment" id="3001231">//</span><br>
<span class="lineno"></span><span class="comment" id="3001234">//&nbsp;ParseMultipartForm&nbsp;calls&nbsp;ParseForm&nbsp;automatically.</span><br>
<span class="lineno"></span><span class="comment" id="3001287">//&nbsp;It&nbsp;is&nbsp;idempotent.</span><br>
<span class="lineno"></span><span class="keyword" id="3001308">func</span>&nbsp;<span class="op" id="3001313">(</span><span class="ident" id="3001314">r</span>&nbsp;<span class="op" id="3001316">*</span><span class="ident" id="3001317">Request</span><span class="op" id="3001324">)</span>&nbsp;<span class="ident" id="3001326">ParseForm</span><span class="op" id="3001335">(</span><span class="op" id="3001336">)</span>&nbsp;<span class="builtintype" id="3001338">error</span>&nbsp;<span class="op" id="3001344">{</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3001347">var</span>&nbsp;<span class="ident" id="3001351">err</span>&nbsp;<span class="builtintype" id="3001355">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3001362">if</span>&nbsp;<span class="ident" id="3001365">r</span><span class="op" id="3001366">.</span><span class="ident" id="3001367">PostForm</span>&nbsp;<span class="op" id="3001376">==</span>&nbsp;<span class="builtintype" id="3001379">nil</span>&nbsp;<span class="op" id="3001383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3001387">if</span>&nbsp;<span class="ident" id="3001390">r</span><span class="op" id="3001391">.</span><span class="ident" id="3001392">Method</span>&nbsp;<span class="op" id="3001399">==</span>&nbsp;<span class="string" id="3001402">&#34;POST&#34;</span>&nbsp;<span class="op" id="3001409">||</span>&nbsp;<span class="ident" id="3001412">r</span><span class="op" id="3001413">.</span><span class="ident" id="3001414">Method</span>&nbsp;<span class="op" id="3001421">==</span>&nbsp;<span class="string" id="3001424">&#34;PUT&#34;</span>&nbsp;<span class="op" id="3001430">||</span>&nbsp;<span class="ident" id="3001433">r</span><span class="op" id="3001434">.</span><span class="ident" id="3001435">Method</span>&nbsp;<span class="op" id="3001442">==</span>&nbsp;<span class="string" id="3001445">&#34;PATCH&#34;</span>&nbsp;<span class="op" id="3001453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3001458">r</span><span class="op" id="3001459">.</span><span class="ident" id="3001460">PostForm</span><span class="op" id="3001468">,</span>&nbsp;<span class="ident" id="3001470">err</span>&nbsp;<span class="op" id="3001474">=</span>&nbsp;<span class="ident" id="3001476">parsePostForm</span><span class="op" id="3001489">(</span><span class="ident" id="3001490">r</span><span class="op" id="3001491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3001495">}</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3001499">if</span>&nbsp;<span class="ident" id="3001502">r</span><span class="op" id="3001503">.</span><span class="ident" id="3001504">PostForm</span>&nbsp;<span class="op" id="3001513">==</span>&nbsp;<span class="builtintype" id="3001516">nil</span>&nbsp;<span class="op" id="3001520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3001525">r</span><span class="op" id="3001526">.</span><span class="ident" id="3001527">PostForm</span>&nbsp;<span class="op" id="3001536">=</span>&nbsp;<span class="builtinfunc" id="3001538">make</span><span class="op" id="3001542">(</span><span class="ident" id="3001543">url</span><span class="op" id="3001546">.</span><span class="ident" id="3001547">Values</span><span class="op" id="3001553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3001557">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3001560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3001563">if</span>&nbsp;<span class="ident" id="3001566">r</span><span class="op" id="3001567">.</span><span class="ident" id="3001568">Form</span>&nbsp;<span class="op" id="3001573">==</span>&nbsp;<span class="builtintype" id="3001576">nil</span>&nbsp;<span class="op" id="3001580">{</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3001584">if</span>&nbsp;<span class="builtinfunc" id="3001587">len</span><span class="op" id="3001590">(</span><span class="ident" id="3001591">r</span><span class="op" id="3001592">.</span><span class="ident" id="3001593">PostForm</span><span class="op" id="3001601">)</span>&nbsp;<span class="op" id="3001603">&gt;</span>&nbsp;<span class="num" id="3001605">0</span>&nbsp;<span class="op" id="3001607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3001612">r</span><span class="op" id="3001613">.</span><span class="ident" id="3001614">Form</span>&nbsp;<span class="op" id="3001619">=</span>&nbsp;<span class="builtinfunc" id="3001621">make</span><span class="op" id="3001625">(</span><span class="ident" id="3001626">url</span><span class="op" id="3001629">.</span><span class="ident" id="3001630">Values</span><span class="op" id="3001636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3001641">copyValues</span><span class="op" id="3001651">(</span><span class="ident" id="3001652">r</span><span class="op" id="3001653">.</span><span class="ident" id="3001654">Form</span><span class="op" id="3001658">,</span>&nbsp;<span class="ident" id="3001660">r</span><span class="op" id="3001661">.</span><span class="ident" id="3001662">PostForm</span><span class="op" id="3001670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3001674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3001678">var</span>&nbsp;<span class="ident" id="3001682">newValues</span>&nbsp;<span class="ident" id="3001692">url</span><span class="op" id="3001695">.</span><span class="ident" id="3001696">Values</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3001705">if</span>&nbsp;<span class="ident" id="3001708">r</span><span class="op" id="3001709">.</span><span class="ident" id="3001710">URL</span>&nbsp;<span class="op" id="3001714">!=</span>&nbsp;<span class="builtintype" id="3001717">nil</span>&nbsp;<span class="op" id="3001721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3001726">var</span>&nbsp;<span class="ident" id="3001730">e</span>&nbsp;<span class="builtintype" id="3001732">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3001741">newValues</span><span class="op" id="3001750">,</span>&nbsp;<span class="ident" id="3001752">e</span>&nbsp;<span class="op" id="3001754">=</span>&nbsp;<span class="ident" id="3001756">url</span><span class="op" id="3001759">.</span><span class="ident" id="3001760">ParseQuery</span><span class="op" id="3001770">(</span><span class="ident" id="3001771">r</span><span class="op" id="3001772">.</span><span class="ident" id="3001773">URL</span><span class="op" id="3001776">.</span><span class="ident" id="3001777">RawQuery</span><span class="op" id="3001785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3001790">if</span>&nbsp;<span class="ident" id="3001793">err</span>&nbsp;<span class="op" id="3001797">==</span>&nbsp;<span class="builtintype" id="3001800">nil</span>&nbsp;<span class="op" id="3001804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3001810">err</span>&nbsp;<span class="op" id="3001814">=</span>&nbsp;<span class="ident" id="3001816">e</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3001821">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3001825">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3001829">if</span>&nbsp;<span class="ident" id="3001832">newValues</span>&nbsp;<span class="op" id="3001842">==</span>&nbsp;<span class="builtintype" id="3001845">nil</span>&nbsp;<span class="op" id="3001849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3001854">newValues</span>&nbsp;<span class="op" id="3001864">=</span>&nbsp;<span class="builtinfunc" id="3001866">make</span><span class="op" id="3001870">(</span><span class="ident" id="3001871">url</span><span class="op" id="3001874">.</span><span class="ident" id="3001875">Values</span><span class="op" id="3001881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3001885">}</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3001889">if</span>&nbsp;<span class="ident" id="3001892">r</span><span class="op" id="3001893">.</span><span class="ident" id="3001894">Form</span>&nbsp;<span class="op" id="3001899">==</span>&nbsp;<span class="builtintype" id="3001902">nil</span>&nbsp;<span class="op" id="3001906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3001911">r</span><span class="op" id="3001912">.</span><span class="ident" id="3001913">Form</span>&nbsp;<span class="op" id="3001918">=</span>&nbsp;<span class="ident" id="3001920">newValues</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3001932">}</span>&nbsp;<span class="keyword" id="3001934">else</span>&nbsp;<span class="op" id="3001939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3001944">copyValues</span><span class="op" id="3001954">(</span><span class="ident" id="3001955">r</span><span class="op" id="3001956">.</span><span class="ident" id="3001957">Form</span><span class="op" id="3001961">,</span>&nbsp;<span class="ident" id="3001963">newValues</span><span class="op" id="3001972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3001976">}</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3001979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3001982">return</span>&nbsp;<span class="ident" id="3001989">err</span><br>
<span class="lineno"></span><span class="op" id="3001993">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3001996">//&nbsp;ParseMultipartForm&nbsp;parses&nbsp;a&nbsp;request&nbsp;body&nbsp;as&nbsp;multipart/form-data.</span><br>
<span class="lineno">815</span><span class="comment" id="3002064">//&nbsp;The&nbsp;whole&nbsp;request&nbsp;body&nbsp;is&nbsp;parsed&nbsp;and&nbsp;up&nbsp;to&nbsp;a&nbsp;total&nbsp;of&nbsp;maxMemory&nbsp;bytes&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3002140">//&nbsp;its&nbsp;file&nbsp;parts&nbsp;are&nbsp;stored&nbsp;in&nbsp;memory,&nbsp;with&nbsp;the&nbsp;remainder&nbsp;stored&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="3002209">//&nbsp;disk&nbsp;in&nbsp;temporary&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="3002237">//&nbsp;ParseMultipartForm&nbsp;calls&nbsp;ParseForm&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span><span class="comment" id="3002289">//&nbsp;After&nbsp;one&nbsp;call&nbsp;to&nbsp;ParseMultipartForm,&nbsp;subsequent&nbsp;calls&nbsp;have&nbsp;no&nbsp;effect.</span><br>
<span class="lineno">820</span><span class="keyword" id="3002363">func</span>&nbsp;<span class="op" id="3002368">(</span><span class="ident" id="3002369">r</span>&nbsp;<span class="op" id="3002371">*</span><span class="ident" id="3002372">Request</span><span class="op" id="3002379">)</span>&nbsp;<span class="ident" id="3002381">ParseMultipartForm</span><span class="op" id="3002399">(</span><span class="ident" id="3002400">maxMemory</span>&nbsp;<span class="ident" id="3002410">int64</span><span class="op" id="3002415">)</span>&nbsp;<span class="builtintype" id="3002417">error</span>&nbsp;<span class="op" id="3002423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3002426">if</span>&nbsp;<span class="ident" id="3002429">r</span><span class="op" id="3002430">.</span><span class="ident" id="3002431">MultipartForm</span>&nbsp;<span class="op" id="3002445">==</span>&nbsp;<span class="ident" id="3002448">multipartByReader</span>&nbsp;<span class="op" id="3002466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3002470">return</span>&nbsp;<span class="ident" id="3002477">errors</span><span class="op" id="3002483">.</span><span class="ident" id="3002484">New</span><span class="op" id="3002487">(</span><span class="string" id="3002488">&#34;http:&nbsp;multipart&nbsp;handled&nbsp;by&nbsp;MultipartReader&#34;</span><span class="op" id="3002532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3002535">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3002538">if</span>&nbsp;<span class="ident" id="3002541">r</span><span class="op" id="3002542">.</span><span class="ident" id="3002543">Form</span>&nbsp;<span class="op" id="3002548">==</span>&nbsp;<span class="builtintype" id="3002551">nil</span>&nbsp;<span class="op" id="3002555">{</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3002559">err</span>&nbsp;<span class="op" id="3002563">:=</span>&nbsp;<span class="ident" id="3002566">r</span><span class="op" id="3002567">.</span><span class="ident" id="3002568">ParseForm</span><span class="op" id="3002577">(</span><span class="op" id="3002578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3002582">if</span>&nbsp;<span class="ident" id="3002585">err</span>&nbsp;<span class="op" id="3002589">!=</span>&nbsp;<span class="builtintype" id="3002592">nil</span>&nbsp;<span class="op" id="3002596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3002601">return</span>&nbsp;<span class="ident" id="3002608">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3002614">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3002617">}</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3002620">if</span>&nbsp;<span class="ident" id="3002623">r</span><span class="op" id="3002624">.</span><span class="ident" id="3002625">MultipartForm</span>&nbsp;<span class="op" id="3002639">!=</span>&nbsp;<span class="builtintype" id="3002642">nil</span>&nbsp;<span class="op" id="3002646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3002650">return</span>&nbsp;<span class="builtintype" id="3002657">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3002662">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3002666">mr</span><span class="op" id="3002668">,</span>&nbsp;<span class="ident" id="3002670">err</span>&nbsp;<span class="op" id="3002674">:=</span>&nbsp;<span class="ident" id="3002677">r</span><span class="op" id="3002678">.</span><span class="ident" id="3002679">multipartReader</span><span class="op" id="3002694">(</span><span class="op" id="3002695">)</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3002698">if</span>&nbsp;<span class="ident" id="3002701">err</span>&nbsp;<span class="op" id="3002705">!=</span>&nbsp;<span class="builtintype" id="3002708">nil</span>&nbsp;<span class="op" id="3002712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3002716">return</span>&nbsp;<span class="ident" id="3002723">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3002728">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3002732">f</span><span class="op" id="3002733">,</span>&nbsp;<span class="ident" id="3002735">err</span>&nbsp;<span class="op" id="3002739">:=</span>&nbsp;<span class="ident" id="3002742">mr</span><span class="op" id="3002744">.</span><span class="ident" id="3002745">ReadForm</span><span class="op" id="3002753">(</span><span class="ident" id="3002754">maxMemory</span><span class="op" id="3002763">)</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3002766">if</span>&nbsp;<span class="ident" id="3002769">err</span>&nbsp;<span class="op" id="3002773">!=</span>&nbsp;<span class="builtintype" id="3002776">nil</span>&nbsp;<span class="op" id="3002780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3002784">return</span>&nbsp;<span class="ident" id="3002791">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3002796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3002799">for</span>&nbsp;<span class="ident" id="3002803">k</span><span class="op" id="3002804">,</span>&nbsp;<span class="ident" id="3002806">v</span>&nbsp;<span class="op" id="3002808">:=</span>&nbsp;<span class="keyword" id="3002811">range</span>&nbsp;<span class="ident" id="3002817">f</span><span class="op" id="3002818">.</span><span class="ident" id="3002819">Value</span>&nbsp;<span class="op" id="3002825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3002829">r</span><span class="op" id="3002830">.</span><span class="ident" id="3002831">Form</span><span class="op" id="3002835">[</span><span class="ident" id="3002836">k</span><span class="op" id="3002837">]</span>&nbsp;<span class="op" id="3002839">=</span>&nbsp;<span class="builtinfunc" id="3002841">append</span><span class="op" id="3002847">(</span><span class="ident" id="3002848">r</span><span class="op" id="3002849">.</span><span class="ident" id="3002850">Form</span><span class="op" id="3002854">[</span><span class="ident" id="3002855">k</span><span class="op" id="3002856">]</span><span class="op" id="3002857">,</span>&nbsp;<span class="ident" id="3002859">v</span><span class="op" id="3002860">...</span><span class="op" id="3002863">)</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3002866">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3002869">r</span><span class="op" id="3002870">.</span><span class="ident" id="3002871">MultipartForm</span>&nbsp;<span class="op" id="3002885">=</span>&nbsp;<span class="ident" id="3002887">f</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3002891">return</span>&nbsp;<span class="builtintype" id="3002898">nil</span><br>
<span class="lineno"></span><span class="op" id="3002902">}</span><br>
<span class="lineno">850</span><br>
<span class="lineno"></span><span class="comment" id="3002905">//&nbsp;FormValue&nbsp;returns&nbsp;the&nbsp;first&nbsp;value&nbsp;for&nbsp;the&nbsp;named&nbsp;component&nbsp;of&nbsp;the&nbsp;query.</span><br>
<span class="lineno"></span><span class="comment" id="3002980">//&nbsp;POST&nbsp;and&nbsp;PUT&nbsp;body&nbsp;parameters&nbsp;take&nbsp;precedence&nbsp;over&nbsp;URL&nbsp;query&nbsp;string&nbsp;values.</span><br>
<span class="lineno"></span><span class="comment" id="3003058">//&nbsp;FormValue&nbsp;calls&nbsp;ParseMultipartForm&nbsp;and&nbsp;ParseForm&nbsp;if&nbsp;necessary&nbsp;and&nbsp;ignores</span><br>
<span class="lineno"></span><span class="comment" id="3003135">//&nbsp;any&nbsp;errors&nbsp;returned&nbsp;by&nbsp;these&nbsp;functions.</span><br>
<span class="lineno">855</span><span class="comment" id="3003178">//&nbsp;To&nbsp;access&nbsp;multiple&nbsp;values&nbsp;of&nbsp;the&nbsp;same&nbsp;key,&nbsp;call&nbsp;ParseForm&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3003243">//&nbsp;then&nbsp;inspect&nbsp;Request.Form&nbsp;directly.</span><br>
<span class="lineno"></span><span class="keyword" id="3003282">func</span>&nbsp;<span class="op" id="3003287">(</span><span class="ident" id="3003288">r</span>&nbsp;<span class="op" id="3003290">*</span><span class="ident" id="3003291">Request</span><span class="op" id="3003298">)</span>&nbsp;<span class="ident" id="3003300">FormValue</span><span class="op" id="3003309">(</span><span class="ident" id="3003310">key</span>&nbsp;<span class="builtintype" id="3003314">string</span><span class="op" id="3003320">)</span>&nbsp;<span class="builtintype" id="3003322">string</span>&nbsp;<span class="op" id="3003329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3003332">if</span>&nbsp;<span class="ident" id="3003335">r</span><span class="op" id="3003336">.</span><span class="ident" id="3003337">Form</span>&nbsp;<span class="op" id="3003342">==</span>&nbsp;<span class="builtintype" id="3003345">nil</span>&nbsp;<span class="op" id="3003349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3003353">r</span><span class="op" id="3003354">.</span><span class="ident" id="3003355">ParseMultipartForm</span><span class="op" id="3003373">(</span><span class="ident" id="3003374">defaultMaxMemory</span><span class="op" id="3003390">)</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3003393">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3003396">if</span>&nbsp;<span class="ident" id="3003399">vs</span>&nbsp;<span class="op" id="3003402">:=</span>&nbsp;<span class="ident" id="3003405">r</span><span class="op" id="3003406">.</span><span class="ident" id="3003407">Form</span><span class="op" id="3003411">[</span><span class="ident" id="3003412">key</span><span class="op" id="3003415">]</span><span class="op" id="3003416">;</span>&nbsp;<span class="builtinfunc" id="3003418">len</span><span class="op" id="3003421">(</span><span class="ident" id="3003422">vs</span><span class="op" id="3003424">)</span>&nbsp;<span class="op" id="3003426">&gt;</span>&nbsp;<span class="num" id="3003428">0</span>&nbsp;<span class="op" id="3003430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3003434">return</span>&nbsp;<span class="ident" id="3003441">vs</span><span class="op" id="3003443">[</span><span class="num" id="3003444">0</span><span class="op" id="3003445">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3003448">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3003451">return</span>&nbsp;<span class="string" id="3003458">&#34;&#34;</span><br>
<span class="lineno">865</span><span class="op" id="3003461">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3003464">//&nbsp;PostFormValue&nbsp;returns&nbsp;the&nbsp;first&nbsp;value&nbsp;for&nbsp;the&nbsp;named&nbsp;component&nbsp;of&nbsp;the&nbsp;POST</span><br>
<span class="lineno"></span><span class="comment" id="3003541">//&nbsp;or&nbsp;PUT&nbsp;request&nbsp;body.&nbsp;URL&nbsp;query&nbsp;parameters&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="3003599">//&nbsp;PostFormValue&nbsp;calls&nbsp;ParseMultipartForm&nbsp;and&nbsp;ParseForm&nbsp;if&nbsp;necessary&nbsp;and&nbsp;ignores</span><br>
<span class="lineno">870</span><span class="comment" id="3003680">//&nbsp;any&nbsp;errors&nbsp;returned&nbsp;by&nbsp;these&nbsp;functions.</span><br>
<span class="lineno"></span><span class="keyword" id="3003723">func</span>&nbsp;<span class="op" id="3003728">(</span><span class="ident" id="3003729">r</span>&nbsp;<span class="op" id="3003731">*</span><span class="ident" id="3003732">Request</span><span class="op" id="3003739">)</span>&nbsp;<span class="ident" id="3003741">PostFormValue</span><span class="op" id="3003754">(</span><span class="ident" id="3003755">key</span>&nbsp;<span class="builtintype" id="3003759">string</span><span class="op" id="3003765">)</span>&nbsp;<span class="builtintype" id="3003767">string</span>&nbsp;<span class="op" id="3003774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3003777">if</span>&nbsp;<span class="ident" id="3003780">r</span><span class="op" id="3003781">.</span><span class="ident" id="3003782">PostForm</span>&nbsp;<span class="op" id="3003791">==</span>&nbsp;<span class="builtintype" id="3003794">nil</span>&nbsp;<span class="op" id="3003798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3003802">r</span><span class="op" id="3003803">.</span><span class="ident" id="3003804">ParseMultipartForm</span><span class="op" id="3003822">(</span><span class="ident" id="3003823">defaultMaxMemory</span><span class="op" id="3003839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3003842">}</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3003845">if</span>&nbsp;<span class="ident" id="3003848">vs</span>&nbsp;<span class="op" id="3003851">:=</span>&nbsp;<span class="ident" id="3003854">r</span><span class="op" id="3003855">.</span><span class="ident" id="3003856">PostForm</span><span class="op" id="3003864">[</span><span class="ident" id="3003865">key</span><span class="op" id="3003868">]</span><span class="op" id="3003869">;</span>&nbsp;<span class="builtinfunc" id="3003871">len</span><span class="op" id="3003874">(</span><span class="ident" id="3003875">vs</span><span class="op" id="3003877">)</span>&nbsp;<span class="op" id="3003879">&gt;</span>&nbsp;<span class="num" id="3003881">0</span>&nbsp;<span class="op" id="3003883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3003887">return</span>&nbsp;<span class="ident" id="3003894">vs</span><span class="op" id="3003896">[</span><span class="num" id="3003897">0</span><span class="op" id="3003898">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3003901">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3003904">return</span>&nbsp;<span class="string" id="3003911">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="3003914">}</span><br>
<span class="lineno">880</span><br>
<span class="lineno"></span><span class="comment" id="3003917">//&nbsp;FormFile&nbsp;returns&nbsp;the&nbsp;first&nbsp;file&nbsp;for&nbsp;the&nbsp;provided&nbsp;form&nbsp;key.</span><br>
<span class="lineno"></span><span class="comment" id="3003979">//&nbsp;FormFile&nbsp;calls&nbsp;ParseMultipartForm&nbsp;and&nbsp;ParseForm&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span><span class="keyword" id="3004044">func</span>&nbsp;<span class="op" id="3004049">(</span><span class="ident" id="3004050">r</span>&nbsp;<span class="op" id="3004052">*</span><span class="ident" id="3004053">Request</span><span class="op" id="3004060">)</span>&nbsp;<span class="ident" id="3004062">FormFile</span><span class="op" id="3004070">(</span><span class="ident" id="3004071">key</span>&nbsp;<span class="builtintype" id="3004075">string</span><span class="op" id="3004081">)</span>&nbsp;<span class="op" id="3004083">(</span><span class="ident" id="3004084">multipart</span><span class="op" id="3004093">.</span><span class="ident" id="3004094">File</span><span class="op" id="3004098">,</span>&nbsp;<span class="op" id="3004100">*</span><span class="ident" id="3004101">multipart</span><span class="op" id="3004110">.</span><span class="ident" id="3004111">FileHeader</span><span class="op" id="3004121">,</span>&nbsp;<span class="builtintype" id="3004123">error</span><span class="op" id="3004128">)</span>&nbsp;<span class="op" id="3004130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3004133">if</span>&nbsp;<span class="ident" id="3004136">r</span><span class="op" id="3004137">.</span><span class="ident" id="3004138">MultipartForm</span>&nbsp;<span class="op" id="3004152">==</span>&nbsp;<span class="ident" id="3004155">multipartByReader</span>&nbsp;<span class="op" id="3004173">{</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3004177">return</span>&nbsp;<span class="builtintype" id="3004184">nil</span><span class="op" id="3004187">,</span>&nbsp;<span class="builtintype" id="3004189">nil</span><span class="op" id="3004192">,</span>&nbsp;<span class="ident" id="3004194">errors</span><span class="op" id="3004200">.</span><span class="ident" id="3004201">New</span><span class="op" id="3004204">(</span><span class="string" id="3004205">&#34;http:&nbsp;multipart&nbsp;handled&nbsp;by&nbsp;MultipartReader&#34;</span><span class="op" id="3004249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3004252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3004255">if</span>&nbsp;<span class="ident" id="3004258">r</span><span class="op" id="3004259">.</span><span class="ident" id="3004260">MultipartForm</span>&nbsp;<span class="op" id="3004274">==</span>&nbsp;<span class="builtintype" id="3004277">nil</span>&nbsp;<span class="op" id="3004281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3004285">err</span>&nbsp;<span class="op" id="3004289">:=</span>&nbsp;<span class="ident" id="3004292">r</span><span class="op" id="3004293">.</span><span class="ident" id="3004294">ParseMultipartForm</span><span class="op" id="3004312">(</span><span class="ident" id="3004313">defaultMaxMemory</span><span class="op" id="3004329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3004333">if</span>&nbsp;<span class="ident" id="3004336">err</span>&nbsp;<span class="op" id="3004340">!=</span>&nbsp;<span class="builtintype" id="3004343">nil</span>&nbsp;<span class="op" id="3004347">{</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3004352">return</span>&nbsp;<span class="builtintype" id="3004359">nil</span><span class="op" id="3004362">,</span>&nbsp;<span class="builtintype" id="3004364">nil</span><span class="op" id="3004367">,</span>&nbsp;<span class="ident" id="3004369">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3004375">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3004378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3004381">if</span>&nbsp;<span class="ident" id="3004384">r</span><span class="op" id="3004385">.</span><span class="ident" id="3004386">MultipartForm</span>&nbsp;<span class="op" id="3004400">!=</span>&nbsp;<span class="builtintype" id="3004403">nil</span>&nbsp;<span class="op" id="3004407">&amp;&amp;</span>&nbsp;<span class="ident" id="3004410">r</span><span class="op" id="3004411">.</span><span class="ident" id="3004412">MultipartForm</span><span class="op" id="3004425">.</span><span class="ident" id="3004426">File</span>&nbsp;<span class="op" id="3004431">!=</span>&nbsp;<span class="builtintype" id="3004434">nil</span>&nbsp;<span class="op" id="3004438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3004442">if</span>&nbsp;<span class="ident" id="3004445">fhs</span>&nbsp;<span class="op" id="3004449">:=</span>&nbsp;<span class="ident" id="3004452">r</span><span class="op" id="3004453">.</span><span class="ident" id="3004454">MultipartForm</span><span class="op" id="3004467">.</span><span class="ident" id="3004468">File</span><span class="op" id="3004472">[</span><span class="ident" id="3004473">key</span><span class="op" id="3004476">]</span><span class="op" id="3004477">;</span>&nbsp;<span class="builtinfunc" id="3004479">len</span><span class="op" id="3004482">(</span><span class="ident" id="3004483">fhs</span><span class="op" id="3004486">)</span>&nbsp;<span class="op" id="3004488">&gt;</span>&nbsp;<span class="num" id="3004490">0</span>&nbsp;<span class="op" id="3004492">{</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3004497">f</span><span class="op" id="3004498">,</span>&nbsp;<span class="ident" id="3004500">err</span>&nbsp;<span class="op" id="3004504">:=</span>&nbsp;<span class="ident" id="3004507">fhs</span><span class="op" id="3004510">[</span><span class="num" id="3004511">0</span><span class="op" id="3004512">]</span><span class="op" id="3004513">.</span><span class="ident" id="3004514">Open</span><span class="op" id="3004518">(</span><span class="op" id="3004519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3004524">return</span>&nbsp;<span class="ident" id="3004531">f</span><span class="op" id="3004532">,</span>&nbsp;<span class="ident" id="3004534">fhs</span><span class="op" id="3004537">[</span><span class="num" id="3004538">0</span><span class="op" id="3004539">]</span><span class="op" id="3004540">,</span>&nbsp;<span class="ident" id="3004542">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3004548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3004551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3004554">return</span>&nbsp;<span class="builtintype" id="3004561">nil</span><span class="op" id="3004564">,</span>&nbsp;<span class="builtintype" id="3004566">nil</span><span class="op" id="3004569">,</span>&nbsp;<span class="ident" id="3004571">ErrMissingFile</span><br>
<span class="lineno">900</span><span class="op" id="3004586">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3004589">func</span>&nbsp;<span class="op" id="3004594">(</span><span class="ident" id="3004595">r</span>&nbsp;<span class="op" id="3004597">*</span><span class="ident" id="3004598">Request</span><span class="op" id="3004605">)</span>&nbsp;<span class="ident" id="3004607">expectsContinue</span><span class="op" id="3004622">(</span><span class="op" id="3004623">)</span>&nbsp;<span class="builtintype" id="3004625">bool</span>&nbsp;<span class="op" id="3004630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3004633">return</span>&nbsp;<span class="ident" id="3004640">hasToken</span><span class="op" id="3004648">(</span><span class="ident" id="3004649">r</span><span class="op" id="3004650">.</span><span class="ident" id="3004651">Header</span><span class="op" id="3004657">.</span><span class="ident" id="3004658">get</span><span class="op" id="3004661">(</span><span class="string" id="3004662">&#34;Expect&#34;</span><span class="op" id="3004670">)</span><span class="op" id="3004671">,</span>&nbsp;<span class="string" id="3004673">&#34;100-continue&#34;</span><span class="op" id="3004687">)</span><br>
<span class="lineno"></span><span class="op" id="3004689">}</span><br>
<span class="lineno">905</span><br>
<span class="lineno"></span><span class="keyword" id="3004692">func</span>&nbsp;<span class="op" id="3004697">(</span><span class="ident" id="3004698">r</span>&nbsp;<span class="op" id="3004700">*</span><span class="ident" id="3004701">Request</span><span class="op" id="3004708">)</span>&nbsp;<span class="ident" id="3004710">wantsHttp10KeepAlive</span><span class="op" id="3004730">(</span><span class="op" id="3004731">)</span>&nbsp;<span class="builtintype" id="3004733">bool</span>&nbsp;<span class="op" id="3004738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3004741">if</span>&nbsp;<span class="ident" id="3004744">r</span><span class="op" id="3004745">.</span><span class="ident" id="3004746">ProtoMajor</span>&nbsp;<span class="op" id="3004757">!=</span>&nbsp;<span class="num" id="3004760">1</span>&nbsp;<span class="op" id="3004762">||</span>&nbsp;<span class="ident" id="3004765">r</span><span class="op" id="3004766">.</span><span class="ident" id="3004767">ProtoMinor</span>&nbsp;<span class="op" id="3004778">!=</span>&nbsp;<span class="num" id="3004781">0</span>&nbsp;<span class="op" id="3004783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3004787">return</span>&nbsp;<span class="builtintype" id="3004794">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3004801">}</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3004804">return</span>&nbsp;<span class="ident" id="3004811">hasToken</span><span class="op" id="3004819">(</span><span class="ident" id="3004820">r</span><span class="op" id="3004821">.</span><span class="ident" id="3004822">Header</span><span class="op" id="3004828">.</span><span class="ident" id="3004829">get</span><span class="op" id="3004832">(</span><span class="string" id="3004833">&#34;Connection&#34;</span><span class="op" id="3004845">)</span><span class="op" id="3004846">,</span>&nbsp;<span class="string" id="3004848">&#34;keep-alive&#34;</span><span class="op" id="3004860">)</span><br>
<span class="lineno"></span><span class="op" id="3004862">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3004865">func</span>&nbsp;<span class="op" id="3004870">(</span><span class="ident" id="3004871">r</span>&nbsp;<span class="op" id="3004873">*</span><span class="ident" id="3004874">Request</span><span class="op" id="3004881">)</span>&nbsp;<span class="ident" id="3004883">wantsClose</span><span class="op" id="3004893">(</span><span class="op" id="3004894">)</span>&nbsp;<span class="builtintype" id="3004896">bool</span>&nbsp;<span class="op" id="3004901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3004904">return</span>&nbsp;<span class="ident" id="3004911">hasToken</span><span class="op" id="3004919">(</span><span class="ident" id="3004920">r</span><span class="op" id="3004921">.</span><span class="ident" id="3004922">Header</span><span class="op" id="3004928">.</span><span class="ident" id="3004929">get</span><span class="op" id="3004932">(</span><span class="string" id="3004933">&#34;Connection&#34;</span><span class="op" id="3004945">)</span><span class="op" id="3004946">,</span>&nbsp;<span class="string" id="3004948">&#34;close&#34;</span><span class="op" id="3004955">)</span><br>
<span class="lineno">915</span><span class="op" id="3004957">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3004960">func</span>&nbsp;<span class="op" id="3004965">(</span><span class="ident" id="3004966">r</span>&nbsp;<span class="op" id="3004968">*</span><span class="ident" id="3004969">Request</span><span class="op" id="3004976">)</span>&nbsp;<span class="ident" id="3004978">closeBody</span><span class="op" id="3004987">(</span><span class="op" id="3004988">)</span>&nbsp;<span class="op" id="3004990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3004993">if</span>&nbsp;<span class="ident" id="3004996">r</span><span class="op" id="3004997">.</span><span class="ident" id="3004998">Body</span>&nbsp;<span class="op" id="3005003">!=</span>&nbsp;<span class="builtintype" id="3005006">nil</span>&nbsp;<span class="op" id="3005010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3005014">r</span><span class="op" id="3005015">.</span><span class="ident" id="3005016">Body</span><span class="op" id="3005020">.</span><span class="ident" id="3005021">Close</span><span class="op" id="3005026">(</span><span class="op" id="3005027">)</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3005030">}</span><br>
<span class="lineno"></span><span class="op" id="3005032">}</span>
</div>
</body>
</html>
