<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>io</h2>
<ul>
<li><a href="/gostd/io/io.go.html">io.go</a></li>
<li><a href="/gostd/io/io_test.go.html">io_test.go</a></li>
<li><a href="/gostd/io/multi.go.html" class="current">multi.go</a></li>
<li><a href="/gostd/io/multi_test.go.html">multi_test.go</a></li>
<li><a href="/gostd/io/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/io/pipe_test.go.html">pipe_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1399601">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1399656">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1399710">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1399761">package</span>&nbsp;<span class="ident" id="1399769">io</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1399773">type</span>&nbsp;<span class="ident" id="1399778">multiReader</span>&nbsp;<span class="keyword" id="1399790">struct</span>&nbsp;<span class="op" id="1399797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1399800">readers</span>&nbsp;<span class="op" id="1399808">[</span><span class="op" id="1399809">]</span><span class="ident" id="1399810">Reader</span><br>
<span class="lineno"></span><span class="op" id="1399817">}</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1399820">func</span>&nbsp;<span class="op" id="1399825">(</span><span class="ident" id="1399826">mr</span>&nbsp;<span class="op" id="1399829">*</span><span class="ident" id="1399830">multiReader</span><span class="op" id="1399841">)</span>&nbsp;<span class="ident" id="1399843">Read</span><span class="op" id="1399847">(</span><span class="ident" id="1399848">p</span>&nbsp;<span class="op" id="1399850">[</span><span class="op" id="1399851">]</span><span class="builtintype" id="1399852">byte</span><span class="op" id="1399856">)</span>&nbsp;<span class="op" id="1399858">(</span><span class="ident" id="1399859">n</span>&nbsp;<span class="builtintype" id="1399861">int</span><span class="op" id="1399864">,</span>&nbsp;<span class="ident" id="1399866">err</span>&nbsp;<span class="builtintype" id="1399870">error</span><span class="op" id="1399875">)</span>&nbsp;<span class="op" id="1399877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1399880">for</span>&nbsp;<span class="builtinfunc" id="1399884">len</span><span class="op" id="1399887">(</span><span class="ident" id="1399888">mr</span><span class="op" id="1399890">.</span><span class="ident" id="1399891">readers</span><span class="op" id="1399898">)</span>&nbsp;<span class="op" id="1399900">&gt;</span>&nbsp;<span class="num" id="1399902">0</span>&nbsp;<span class="op" id="1399904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1399908">n</span><span class="op" id="1399909">,</span>&nbsp;<span class="ident" id="1399911">err</span>&nbsp;<span class="op" id="1399915">=</span>&nbsp;<span class="ident" id="1399917">mr</span><span class="op" id="1399919">.</span><span class="ident" id="1399920">readers</span><span class="op" id="1399927">[</span><span class="num" id="1399928">0</span><span class="op" id="1399929">]</span><span class="op" id="1399930">.</span><span class="ident" id="1399931">Read</span><span class="op" id="1399935">(</span><span class="ident" id="1399936">p</span><span class="op" id="1399937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1399941">if</span>&nbsp;<span class="ident" id="1399944">n</span>&nbsp;<span class="op" id="1399946">&gt;</span>&nbsp;<span class="num" id="1399948">0</span>&nbsp;<span class="op" id="1399950">||</span>&nbsp;<span class="ident" id="1399953">err</span>&nbsp;<span class="op" id="1399957">!=</span>&nbsp;<span class="ident" id="1399960">EOF</span>&nbsp;<span class="op" id="1399964">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1399969">if</span>&nbsp;<span class="ident" id="1399972">err</span>&nbsp;<span class="op" id="1399976">==</span>&nbsp;<span class="ident" id="1399979">EOF</span>&nbsp;<span class="op" id="1399983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1399989">//&nbsp;Don&#39;t&nbsp;return&nbsp;EOF&nbsp;yet.&nbsp;There&nbsp;may&nbsp;be&nbsp;more&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1400042">//&nbsp;in&nbsp;the&nbsp;remaining&nbsp;readers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1400075">err</span>&nbsp;<span class="op" id="1400079">=</span>&nbsp;<span class="builtintype" id="1400081">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1400088">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1400093">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1400102">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1400106">mr</span><span class="op" id="1400108">.</span><span class="ident" id="1400109">readers</span>&nbsp;<span class="op" id="1400117">=</span>&nbsp;<span class="ident" id="1400119">mr</span><span class="op" id="1400121">.</span><span class="ident" id="1400122">readers</span><span class="op" id="1400129">[</span><span class="num" id="1400130">1</span><span class="op" id="1400131">:</span><span class="op" id="1400132">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1400135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1400138">return</span>&nbsp;<span class="num" id="1400145">0</span><span class="op" id="1400146">,</span>&nbsp;<span class="ident" id="1400148">EOF</span><br>
<span class="lineno">25</span><span class="op" id="1400152">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1400155">//&nbsp;MultiReader&nbsp;returns&nbsp;a&nbsp;Reader&nbsp;that&#39;s&nbsp;the&nbsp;logical&nbsp;concatenation&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="1400223">//&nbsp;the&nbsp;provided&nbsp;input&nbsp;readers.&nbsp;&nbsp;They&#39;re&nbsp;read&nbsp;sequentially.&nbsp;&nbsp;Once&nbsp;all</span><br>
<span class="lineno"></span><span class="comment" id="1400292">//&nbsp;inputs&nbsp;have&nbsp;returned&nbsp;EOF,&nbsp;Read&nbsp;will&nbsp;return&nbsp;EOF.&nbsp;&nbsp;If&nbsp;any&nbsp;of&nbsp;the&nbsp;readers</span><br>
<span class="lineno">30</span><span class="comment" id="1400366">//&nbsp;return&nbsp;a&nbsp;non-nil,&nbsp;non-EOF&nbsp;error,&nbsp;Read&nbsp;will&nbsp;return&nbsp;that&nbsp;error.</span><br>
<span class="lineno"></span><span class="keyword" id="1400431">func</span>&nbsp;<span class="ident" id="1400436">MultiReader</span><span class="op" id="1400447">(</span><span class="ident" id="1400448">readers</span>&nbsp;<span class="op" id="1400456">...</span><span class="ident" id="1400459">Reader</span><span class="op" id="1400465">)</span>&nbsp;<span class="ident" id="1400467">Reader</span>&nbsp;<span class="op" id="1400474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1400477">r</span>&nbsp;<span class="op" id="1400479">:=</span>&nbsp;<span class="builtinfunc" id="1400482">make</span><span class="op" id="1400486">(</span><span class="op" id="1400487">[</span><span class="op" id="1400488">]</span><span class="ident" id="1400489">Reader</span><span class="op" id="1400495">,</span>&nbsp;<span class="builtinfunc" id="1400497">len</span><span class="op" id="1400500">(</span><span class="ident" id="1400501">readers</span><span class="op" id="1400508">)</span><span class="op" id="1400509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1400512">copy</span><span class="op" id="1400516">(</span><span class="ident" id="1400517">r</span><span class="op" id="1400518">,</span>&nbsp;<span class="ident" id="1400520">readers</span><span class="op" id="1400527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1400530">return</span>&nbsp;<span class="op" id="1400537">&amp;</span><span class="ident" id="1400538">multiReader</span><span class="op" id="1400549">{</span><span class="ident" id="1400550">r</span><span class="op" id="1400551">}</span><br>
<span class="lineno">35</span><span class="op" id="1400553">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1400556">type</span>&nbsp;<span class="ident" id="1400561">multiWriter</span>&nbsp;<span class="keyword" id="1400573">struct</span>&nbsp;<span class="op" id="1400580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1400583">writers</span>&nbsp;<span class="op" id="1400591">[</span><span class="op" id="1400592">]</span><span class="ident" id="1400593">Writer</span><br>
<span class="lineno"></span><span class="op" id="1400600">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="1400603">func</span>&nbsp;<span class="op" id="1400608">(</span><span class="ident" id="1400609">t</span>&nbsp;<span class="op" id="1400611">*</span><span class="ident" id="1400612">multiWriter</span><span class="op" id="1400623">)</span>&nbsp;<span class="ident" id="1400625">Write</span><span class="op" id="1400630">(</span><span class="ident" id="1400631">p</span>&nbsp;<span class="op" id="1400633">[</span><span class="op" id="1400634">]</span><span class="builtintype" id="1400635">byte</span><span class="op" id="1400639">)</span>&nbsp;<span class="op" id="1400641">(</span><span class="ident" id="1400642">n</span>&nbsp;<span class="builtintype" id="1400644">int</span><span class="op" id="1400647">,</span>&nbsp;<span class="ident" id="1400649">err</span>&nbsp;<span class="builtintype" id="1400653">error</span><span class="op" id="1400658">)</span>&nbsp;<span class="op" id="1400660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1400663">for</span>&nbsp;<span class="ident" id="1400667">_</span><span class="op" id="1400668">,</span>&nbsp;<span class="ident" id="1400670">w</span>&nbsp;<span class="op" id="1400672">:=</span>&nbsp;<span class="keyword" id="1400675">range</span>&nbsp;<span class="ident" id="1400681">t</span><span class="op" id="1400682">.</span><span class="ident" id="1400683">writers</span>&nbsp;<span class="op" id="1400691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1400695">n</span><span class="op" id="1400696">,</span>&nbsp;<span class="ident" id="1400698">err</span>&nbsp;<span class="op" id="1400702">=</span>&nbsp;<span class="ident" id="1400704">w</span><span class="op" id="1400705">.</span><span class="ident" id="1400706">Write</span><span class="op" id="1400711">(</span><span class="ident" id="1400712">p</span><span class="op" id="1400713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1400717">if</span>&nbsp;<span class="ident" id="1400720">err</span>&nbsp;<span class="op" id="1400724">!=</span>&nbsp;<span class="builtintype" id="1400727">nil</span>&nbsp;<span class="op" id="1400731">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1400736">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1400745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1400749">if</span>&nbsp;<span class="ident" id="1400752">n</span>&nbsp;<span class="op" id="1400754">!=</span>&nbsp;<span class="builtinfunc" id="1400757">len</span><span class="op" id="1400760">(</span><span class="ident" id="1400761">p</span><span class="op" id="1400762">)</span>&nbsp;<span class="op" id="1400764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1400769">err</span>&nbsp;<span class="op" id="1400773">=</span>&nbsp;<span class="ident" id="1400775">ErrShortWrite</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1400792">return</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1400801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1400804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1400807">return</span>&nbsp;<span class="builtinfunc" id="1400814">len</span><span class="op" id="1400817">(</span><span class="ident" id="1400818">p</span><span class="op" id="1400819">)</span><span class="op" id="1400820">,</span>&nbsp;<span class="builtintype" id="1400822">nil</span><br>
<span class="lineno"></span><span class="op" id="1400826">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="1400829">//&nbsp;MultiWriter&nbsp;creates&nbsp;a&nbsp;writer&nbsp;that&nbsp;duplicates&nbsp;its&nbsp;writes&nbsp;to&nbsp;all&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1400899">//&nbsp;provided&nbsp;writers,&nbsp;similar&nbsp;to&nbsp;the&nbsp;Unix&nbsp;tee(1)&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="1400956">func</span>&nbsp;<span class="ident" id="1400961">MultiWriter</span><span class="op" id="1400972">(</span><span class="ident" id="1400973">writers</span>&nbsp;<span class="op" id="1400981">...</span><span class="ident" id="1400984">Writer</span><span class="op" id="1400990">)</span>&nbsp;<span class="ident" id="1400992">Writer</span>&nbsp;<span class="op" id="1400999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1401002">w</span>&nbsp;<span class="op" id="1401004">:=</span>&nbsp;<span class="builtinfunc" id="1401007">make</span><span class="op" id="1401011">(</span><span class="op" id="1401012">[</span><span class="op" id="1401013">]</span><span class="ident" id="1401014">Writer</span><span class="op" id="1401020">,</span>&nbsp;<span class="builtinfunc" id="1401022">len</span><span class="op" id="1401025">(</span><span class="ident" id="1401026">writers</span><span class="op" id="1401033">)</span><span class="op" id="1401034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1401037">copy</span><span class="op" id="1401041">(</span><span class="ident" id="1401042">w</span><span class="op" id="1401043">,</span>&nbsp;<span class="ident" id="1401045">writers</span><span class="op" id="1401052">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1401055">return</span>&nbsp;<span class="op" id="1401062">&amp;</span><span class="ident" id="1401063">multiWriter</span><span class="op" id="1401074">{</span><span class="ident" id="1401075">w</span><span class="op" id="1401076">}</span><br>
<span class="lineno"></span><span class="op" id="1401078">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
