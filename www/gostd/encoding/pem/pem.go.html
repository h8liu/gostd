<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/pem</h2>
<ul>
<li><a href="/gostd/encoding/pem/pem.go.html" class="current">pem.go</a></li>
<li><a href="/gostd/encoding/pem/pem_test.go.html">pem_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4585962">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4586017">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4586071">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4586122">//&nbsp;Package&nbsp;pem&nbsp;implements&nbsp;the&nbsp;PEM&nbsp;data&nbsp;encoding,&nbsp;which&nbsp;originated&nbsp;in&nbsp;Privacy</span><br>
<span class="lineno"></span><span class="comment" id="4586199">//&nbsp;Enhanced&nbsp;Mail.&nbsp;The&nbsp;most&nbsp;common&nbsp;use&nbsp;of&nbsp;PEM&nbsp;encoding&nbsp;today&nbsp;is&nbsp;in&nbsp;TLS&nbsp;keys&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4586278">//&nbsp;certificates.&nbsp;See&nbsp;RFC&nbsp;1421.</span><br>
<span class="lineno"></span><span class="keyword" id="4586309">package</span>&nbsp;<span class="ident" id="4586317">pem</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="4586322">import</span>&nbsp;<span class="op" id="4586329">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4586332">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4586341">&#34;encoding/base64&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4586360">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4586366">&#34;sort&#34;</span><br>
<span class="lineno">15</span><span class="op" id="4586373">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4586376">//&nbsp;A&nbsp;Block&nbsp;represents&nbsp;a&nbsp;PEM&nbsp;encoded&nbsp;structure.</span><br>
<span class="lineno"></span><span class="comment" id="4586423">//</span><br>
<span class="lineno"></span><span class="comment" id="4586426">//&nbsp;The&nbsp;encoded&nbsp;form&nbsp;is:</span><br>
<span class="lineno">20</span><span class="comment" id="4586450">//&nbsp;&nbsp;&nbsp;&nbsp;-----BEGIN&nbsp;Type-----</span><br>
<span class="lineno"></span><span class="comment" id="4586477">//&nbsp;&nbsp;&nbsp;&nbsp;Headers</span><br>
<span class="lineno"></span><span class="comment" id="4586491">//&nbsp;&nbsp;&nbsp;&nbsp;base64-encoded&nbsp;Bytes</span><br>
<span class="lineno"></span><span class="comment" id="4586518">//&nbsp;&nbsp;&nbsp;&nbsp;-----END&nbsp;Type-----</span><br>
<span class="lineno"></span><span class="comment" id="4586543">//&nbsp;where&nbsp;Headers&nbsp;is&nbsp;a&nbsp;possibly&nbsp;empty&nbsp;sequence&nbsp;of&nbsp;Key:&nbsp;Value&nbsp;lines.</span><br>
<span class="lineno">25</span><span class="keyword" id="4586610">type</span>&nbsp;<span class="ident" id="4586615">Block</span>&nbsp;<span class="keyword" id="4586621">struct</span>&nbsp;<span class="op" id="4586628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4586631">Type</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4586639">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4586657">//&nbsp;The&nbsp;type,&nbsp;taken&nbsp;from&nbsp;the&nbsp;preamble&nbsp;(i.e.&nbsp;&#34;RSA&nbsp;PRIVATE&nbsp;KEY&#34;).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4586721">Headers</span>&nbsp;<span class="keyword" id="4586729">map</span><span class="op" id="4586732">[</span><span class="builtintype" id="4586733">string</span><span class="op" id="4586739">]</span><span class="builtintype" id="4586740">string</span>&nbsp;<span class="comment" id="4586747">//&nbsp;Optional&nbsp;headers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4586769">Bytes</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4586777">[</span><span class="op" id="4586778">]</span><span class="builtintype" id="4586779">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4586795">//&nbsp;The&nbsp;decoded&nbsp;bytes&nbsp;of&nbsp;the&nbsp;contents.&nbsp;Typically&nbsp;a&nbsp;DER&nbsp;encoded&nbsp;ASN.1&nbsp;structure.</span><br>
<span class="lineno"></span><span class="op" id="4586874">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="4586877">//&nbsp;getLine&nbsp;results&nbsp;the&nbsp;first&nbsp;\r\n&nbsp;or&nbsp;\n&nbsp;delineated&nbsp;line&nbsp;from&nbsp;the&nbsp;given&nbsp;byte</span><br>
<span class="lineno"></span><span class="comment" id="4586953">//&nbsp;array.&nbsp;The&nbsp;line&nbsp;does&nbsp;not&nbsp;include&nbsp;trailing&nbsp;whitespace&nbsp;or&nbsp;the&nbsp;trailing&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="4587029">//&nbsp;line&nbsp;bytes.&nbsp;The&nbsp;remainder&nbsp;of&nbsp;the&nbsp;byte&nbsp;array&nbsp;(also&nbsp;not&nbsp;including&nbsp;the&nbsp;new&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="4587109">//&nbsp;bytes)&nbsp;is&nbsp;also&nbsp;returned&nbsp;and&nbsp;this&nbsp;will&nbsp;always&nbsp;be&nbsp;smaller&nbsp;than&nbsp;the&nbsp;original</span><br>
<span class="lineno">35</span><span class="comment" id="4587186">//&nbsp;argument.</span><br>
<span class="lineno"></span><span class="keyword" id="4587199">func</span>&nbsp;<span class="ident" id="4587204">getLine</span><span class="op" id="4587211">(</span><span class="ident" id="4587212">data</span>&nbsp;<span class="op" id="4587217">[</span><span class="op" id="4587218">]</span><span class="builtintype" id="4587219">byte</span><span class="op" id="4587223">)</span>&nbsp;<span class="op" id="4587225">(</span><span class="ident" id="4587226">line</span><span class="op" id="4587230">,</span>&nbsp;<span class="ident" id="4587232">rest</span>&nbsp;<span class="op" id="4587237">[</span><span class="op" id="4587238">]</span><span class="builtintype" id="4587239">byte</span><span class="op" id="4587243">)</span>&nbsp;<span class="op" id="4587245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4587248">i</span>&nbsp;<span class="op" id="4587250">:=</span>&nbsp;<span class="ident" id="4587253">bytes</span><span class="op" id="4587258">.</span><span class="ident" id="4587259">Index</span><span class="op" id="4587264">(</span><span class="ident" id="4587265">data</span><span class="op" id="4587269">,</span>&nbsp;<span class="op" id="4587271">[</span><span class="op" id="4587272">]</span><span class="builtintype" id="4587273">byte</span><span class="op" id="4587277">{</span><span class="string" id="4587278">&#39;\n&#39;</span><span class="op" id="4587282">}</span><span class="op" id="4587283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4587286">var</span>&nbsp;<span class="ident" id="4587290">j</span>&nbsp;<span class="builtintype" id="4587292">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4587297">if</span>&nbsp;<span class="ident" id="4587300">i</span>&nbsp;<span class="op" id="4587302">&lt;</span>&nbsp;<span class="num" id="4587304">0</span>&nbsp;<span class="op" id="4587306">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4587310">i</span>&nbsp;<span class="op" id="4587312">=</span>&nbsp;<span class="builtinfunc" id="4587314">len</span><span class="op" id="4587317">(</span><span class="ident" id="4587318">data</span><span class="op" id="4587322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4587326">j</span>&nbsp;<span class="op" id="4587328">=</span>&nbsp;<span class="ident" id="4587330">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4587333">}</span>&nbsp;<span class="keyword" id="4587335">else</span>&nbsp;<span class="op" id="4587340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4587344">j</span>&nbsp;<span class="op" id="4587346">=</span>&nbsp;<span class="ident" id="4587348">i</span>&nbsp;<span class="op" id="4587350">+</span>&nbsp;<span class="num" id="4587352">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4587356">if</span>&nbsp;<span class="ident" id="4587359">i</span>&nbsp;<span class="op" id="4587361">&gt;</span>&nbsp;<span class="num" id="4587363">0</span>&nbsp;<span class="op" id="4587365">&amp;&amp;</span>&nbsp;<span class="ident" id="4587368">data</span><span class="op" id="4587372">[</span><span class="ident" id="4587373">i</span><span class="op" id="4587374">-</span><span class="num" id="4587375">1</span><span class="op" id="4587376">]</span>&nbsp;<span class="op" id="4587378">==</span>&nbsp;<span class="string" id="4587381">&#39;\r&#39;</span>&nbsp;<span class="op" id="4587386">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4587391">i</span><span class="op" id="4587392">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4587397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4587400">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4587403">return</span>&nbsp;<span class="ident" id="4587410">bytes</span><span class="op" id="4587415">.</span><span class="ident" id="4587416">TrimRight</span><span class="op" id="4587425">(</span><span class="ident" id="4587426">data</span><span class="op" id="4587430">[</span><span class="num" id="4587431">0</span><span class="op" id="4587432">:</span><span class="ident" id="4587433">i</span><span class="op" id="4587434">]</span><span class="op" id="4587435">,</span>&nbsp;<span class="string" id="4587437">&#34;&nbsp;\t&#34;</span><span class="op" id="4587442">)</span><span class="op" id="4587443">,</span>&nbsp;<span class="ident" id="4587445">data</span><span class="op" id="4587449">[</span><span class="ident" id="4587450">j</span><span class="op" id="4587451">:</span><span class="op" id="4587452">]</span><br>
<span class="lineno"></span><span class="op" id="4587454">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="comment" id="4587457">//&nbsp;removeWhitespace&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;its&nbsp;input&nbsp;with&nbsp;all&nbsp;spaces,&nbsp;tab&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4587530">//&nbsp;newline&nbsp;characters&nbsp;removed.</span><br>
<span class="lineno"></span><span class="keyword" id="4587561">func</span>&nbsp;<span class="ident" id="4587566">removeWhitespace</span><span class="op" id="4587582">(</span><span class="ident" id="4587583">data</span>&nbsp;<span class="op" id="4587588">[</span><span class="op" id="4587589">]</span><span class="builtintype" id="4587590">byte</span><span class="op" id="4587594">)</span>&nbsp;<span class="op" id="4587596">[</span><span class="op" id="4587597">]</span><span class="builtintype" id="4587598">byte</span>&nbsp;<span class="op" id="4587603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4587606">result</span>&nbsp;<span class="op" id="4587613">:=</span>&nbsp;<span class="builtinfunc" id="4587616">make</span><span class="op" id="4587620">(</span><span class="op" id="4587621">[</span><span class="op" id="4587622">]</span><span class="builtintype" id="4587623">byte</span><span class="op" id="4587627">,</span>&nbsp;<span class="builtinfunc" id="4587629">len</span><span class="op" id="4587632">(</span><span class="ident" id="4587633">data</span><span class="op" id="4587637">)</span><span class="op" id="4587638">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4587641">n</span>&nbsp;<span class="op" id="4587643">:=</span>&nbsp;<span class="num" id="4587646">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4587650">for</span>&nbsp;<span class="ident" id="4587654">_</span><span class="op" id="4587655">,</span>&nbsp;<span class="ident" id="4587657">b</span>&nbsp;<span class="op" id="4587659">:=</span>&nbsp;<span class="keyword" id="4587662">range</span>&nbsp;<span class="ident" id="4587668">data</span>&nbsp;<span class="op" id="4587673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4587677">if</span>&nbsp;<span class="ident" id="4587680">b</span>&nbsp;<span class="op" id="4587682">==</span>&nbsp;<span class="string" id="4587685">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="4587689">||</span>&nbsp;<span class="ident" id="4587692">b</span>&nbsp;<span class="op" id="4587694">==</span>&nbsp;<span class="string" id="4587697">&#39;\t&#39;</span>&nbsp;<span class="op" id="4587702">||</span>&nbsp;<span class="ident" id="4587705">b</span>&nbsp;<span class="op" id="4587707">==</span>&nbsp;<span class="string" id="4587710">&#39;\r&#39;</span>&nbsp;<span class="op" id="4587715">||</span>&nbsp;<span class="ident" id="4587718">b</span>&nbsp;<span class="op" id="4587720">==</span>&nbsp;<span class="string" id="4587723">&#39;\n&#39;</span>&nbsp;<span class="op" id="4587728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4587733">continue</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4587744">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4587748">result</span><span class="op" id="4587754">[</span><span class="ident" id="4587755">n</span><span class="op" id="4587756">]</span>&nbsp;<span class="op" id="4587758">=</span>&nbsp;<span class="ident" id="4587760">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4587764">n</span><span class="op" id="4587765">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4587769">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4587773">return</span>&nbsp;<span class="ident" id="4587780">result</span><span class="op" id="4587786">[</span><span class="num" id="4587787">0</span><span class="op" id="4587788">:</span><span class="ident" id="4587789">n</span><span class="op" id="4587790">]</span><br>
<span class="lineno"></span><span class="op" id="4587792">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4587795">var</span>&nbsp;<span class="ident" id="4587799">pemStart</span>&nbsp;<span class="op" id="4587808">=</span>&nbsp;<span class="op" id="4587810">[</span><span class="op" id="4587811">]</span><span class="builtintype" id="4587812">byte</span><span class="op" id="4587816">(</span><span class="string" id="4587817">&#34;\n-----BEGIN&nbsp;&#34;</span><span class="op" id="4587832">)</span><br>
<span class="lineno"></span><span class="keyword" id="4587834">var</span>&nbsp;<span class="ident" id="4587838">pemEnd</span>&nbsp;<span class="op" id="4587845">=</span>&nbsp;<span class="op" id="4587847">[</span><span class="op" id="4587848">]</span><span class="builtintype" id="4587849">byte</span><span class="op" id="4587853">(</span><span class="string" id="4587854">&#34;\n-----END&nbsp;&#34;</span><span class="op" id="4587867">)</span><br>
<span class="lineno">70</span><span class="keyword" id="4587869">var</span>&nbsp;<span class="ident" id="4587873">pemEndOfLine</span>&nbsp;<span class="op" id="4587886">=</span>&nbsp;<span class="op" id="4587888">[</span><span class="op" id="4587889">]</span><span class="builtintype" id="4587890">byte</span><span class="op" id="4587894">(</span><span class="string" id="4587895">&#34;-----&#34;</span><span class="op" id="4587902">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4587905">//&nbsp;Decode&nbsp;will&nbsp;find&nbsp;the&nbsp;next&nbsp;PEM&nbsp;formatted&nbsp;block&nbsp;(certificate,&nbsp;private&nbsp;key</span><br>
<span class="lineno"></span><span class="comment" id="4587980">//&nbsp;etc)&nbsp;in&nbsp;the&nbsp;input.&nbsp;It&nbsp;returns&nbsp;that&nbsp;block&nbsp;and&nbsp;the&nbsp;remainder&nbsp;of&nbsp;the&nbsp;input.&nbsp;If</span><br>
<span class="lineno"></span><span class="comment" id="4588059">//&nbsp;no&nbsp;PEM&nbsp;data&nbsp;is&nbsp;found,&nbsp;p&nbsp;is&nbsp;nil&nbsp;and&nbsp;the&nbsp;whole&nbsp;of&nbsp;the&nbsp;input&nbsp;is&nbsp;returned&nbsp;in</span><br>
<span class="lineno">75</span><span class="comment" id="4588135">//&nbsp;rest.</span><br>
<span class="lineno"></span><span class="keyword" id="4588144">func</span>&nbsp;<span class="ident" id="4588149">Decode</span><span class="op" id="4588155">(</span><span class="ident" id="4588156">data</span>&nbsp;<span class="op" id="4588161">[</span><span class="op" id="4588162">]</span><span class="builtintype" id="4588163">byte</span><span class="op" id="4588167">)</span>&nbsp;<span class="op" id="4588169">(</span><span class="ident" id="4588170">p</span>&nbsp;<span class="op" id="4588172">*</span><span class="ident" id="4588173">Block</span><span class="op" id="4588178">,</span>&nbsp;<span class="ident" id="4588180">rest</span>&nbsp;<span class="op" id="4588185">[</span><span class="op" id="4588186">]</span><span class="builtintype" id="4588187">byte</span><span class="op" id="4588191">)</span>&nbsp;<span class="op" id="4588193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4588196">//&nbsp;pemStart&nbsp;begins&nbsp;with&nbsp;a&nbsp;newline.&nbsp;However,&nbsp;at&nbsp;the&nbsp;very&nbsp;beginning&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4588266">//&nbsp;the&nbsp;byte&nbsp;array,&nbsp;we&#39;ll&nbsp;accept&nbsp;the&nbsp;start&nbsp;string&nbsp;without&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4588328">rest</span>&nbsp;<span class="op" id="4588333">=</span>&nbsp;<span class="ident" id="4588335">data</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4588341">if</span>&nbsp;<span class="ident" id="4588344">bytes</span><span class="op" id="4588349">.</span><span class="ident" id="4588350">HasPrefix</span><span class="op" id="4588359">(</span><span class="ident" id="4588360">data</span><span class="op" id="4588364">,</span>&nbsp;<span class="ident" id="4588366">pemStart</span><span class="op" id="4588374">[</span><span class="num" id="4588375">1</span><span class="op" id="4588376">:</span><span class="op" id="4588377">]</span><span class="op" id="4588378">)</span>&nbsp;<span class="op" id="4588380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4588384">rest</span>&nbsp;<span class="op" id="4588389">=</span>&nbsp;<span class="ident" id="4588391">rest</span><span class="op" id="4588395">[</span><span class="builtinfunc" id="4588396">len</span><span class="op" id="4588399">(</span><span class="ident" id="4588400">pemStart</span><span class="op" id="4588408">)</span><span class="op" id="4588409">-</span><span class="num" id="4588410">1</span>&nbsp;<span class="op" id="4588412">:</span>&nbsp;<span class="builtinfunc" id="4588414">len</span><span class="op" id="4588417">(</span><span class="ident" id="4588418">data</span><span class="op" id="4588422">)</span><span class="op" id="4588423">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4588426">}</span>&nbsp;<span class="keyword" id="4588428">else</span>&nbsp;<span class="keyword" id="4588433">if</span>&nbsp;<span class="ident" id="4588436">i</span>&nbsp;<span class="op" id="4588438">:=</span>&nbsp;<span class="ident" id="4588441">bytes</span><span class="op" id="4588446">.</span><span class="ident" id="4588447">Index</span><span class="op" id="4588452">(</span><span class="ident" id="4588453">data</span><span class="op" id="4588457">,</span>&nbsp;<span class="ident" id="4588459">pemStart</span><span class="op" id="4588467">)</span><span class="op" id="4588468">;</span>&nbsp;<span class="ident" id="4588470">i</span>&nbsp;<span class="op" id="4588472">&gt;=</span>&nbsp;<span class="num" id="4588475">0</span>&nbsp;<span class="op" id="4588477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4588481">rest</span>&nbsp;<span class="op" id="4588486">=</span>&nbsp;<span class="ident" id="4588488">rest</span><span class="op" id="4588492">[</span><span class="ident" id="4588493">i</span><span class="op" id="4588494">+</span><span class="builtinfunc" id="4588495">len</span><span class="op" id="4588498">(</span><span class="ident" id="4588499">pemStart</span><span class="op" id="4588507">)</span>&nbsp;<span class="op" id="4588509">:</span>&nbsp;<span class="builtinfunc" id="4588511">len</span><span class="op" id="4588514">(</span><span class="ident" id="4588515">data</span><span class="op" id="4588519">)</span><span class="op" id="4588520">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4588523">}</span>&nbsp;<span class="keyword" id="4588525">else</span>&nbsp;<span class="op" id="4588530">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4588534">return</span>&nbsp;<span class="builtintype" id="4588541">nil</span><span class="op" id="4588544">,</span>&nbsp;<span class="ident" id="4588546">data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4588552">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4588556">typeLine</span><span class="op" id="4588564">,</span>&nbsp;<span class="ident" id="4588566">rest</span>&nbsp;<span class="op" id="4588571">:=</span>&nbsp;<span class="ident" id="4588574">getLine</span><span class="op" id="4588581">(</span><span class="ident" id="4588582">rest</span><span class="op" id="4588586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4588589">if</span>&nbsp;<span class="op" id="4588592">!</span><span class="ident" id="4588593">bytes</span><span class="op" id="4588598">.</span><span class="ident" id="4588599">HasSuffix</span><span class="op" id="4588608">(</span><span class="ident" id="4588609">typeLine</span><span class="op" id="4588617">,</span>&nbsp;<span class="ident" id="4588619">pemEndOfLine</span><span class="op" id="4588631">)</span>&nbsp;<span class="op" id="4588633">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4588637">return</span>&nbsp;<span class="ident" id="4588644">decodeError</span><span class="op" id="4588655">(</span><span class="ident" id="4588656">data</span><span class="op" id="4588660">,</span>&nbsp;<span class="ident" id="4588662">rest</span><span class="op" id="4588666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4588669">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4588672">typeLine</span>&nbsp;<span class="op" id="4588681">=</span>&nbsp;<span class="ident" id="4588683">typeLine</span><span class="op" id="4588691">[</span><span class="num" id="4588692">0</span>&nbsp;<span class="op" id="4588694">:</span>&nbsp;<span class="builtinfunc" id="4588696">len</span><span class="op" id="4588699">(</span><span class="ident" id="4588700">typeLine</span><span class="op" id="4588708">)</span><span class="op" id="4588709">-</span><span class="builtinfunc" id="4588710">len</span><span class="op" id="4588713">(</span><span class="ident" id="4588714">pemEndOfLine</span><span class="op" id="4588726">)</span><span class="op" id="4588727">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4588731">p</span>&nbsp;<span class="op" id="4588733">=</span>&nbsp;<span class="op" id="4588735">&amp;</span><span class="ident" id="4588736">Block</span><span class="op" id="4588741">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4588745">Headers</span><span class="op" id="4588752">:</span>&nbsp;<span class="builtinfunc" id="4588754">make</span><span class="op" id="4588758">(</span><span class="keyword" id="4588759">map</span><span class="op" id="4588762">[</span><span class="builtintype" id="4588763">string</span><span class="op" id="4588769">]</span><span class="builtintype" id="4588770">string</span><span class="op" id="4588776">)</span><span class="op" id="4588777">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4588781">Type</span><span class="op" id="4588785">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4588790">string</span><span class="op" id="4588796">(</span><span class="ident" id="4588797">typeLine</span><span class="op" id="4588805">)</span><span class="op" id="4588806">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4588809">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4588813">for</span>&nbsp;<span class="op" id="4588817">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4588821">//&nbsp;This&nbsp;loop&nbsp;terminates&nbsp;because&nbsp;getLine&#39;s&nbsp;second&nbsp;result&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4588882">//&nbsp;always&nbsp;smaller&nbsp;than&nbsp;its&nbsp;argument.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4588921">if</span>&nbsp;<span class="builtinfunc" id="4588924">len</span><span class="op" id="4588927">(</span><span class="ident" id="4588928">rest</span><span class="op" id="4588932">)</span>&nbsp;<span class="op" id="4588934">==</span>&nbsp;<span class="num" id="4588937">0</span>&nbsp;<span class="op" id="4588939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4588944">return</span>&nbsp;<span class="builtintype" id="4588951">nil</span><span class="op" id="4588954">,</span>&nbsp;<span class="ident" id="4588956">data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4588963">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4588967">line</span><span class="op" id="4588971">,</span>&nbsp;<span class="ident" id="4588973">next</span>&nbsp;<span class="op" id="4588978">:=</span>&nbsp;<span class="ident" id="4588981">getLine</span><span class="op" id="4588988">(</span><span class="ident" id="4588989">rest</span><span class="op" id="4588993">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4588998">i</span>&nbsp;<span class="op" id="4589000">:=</span>&nbsp;<span class="ident" id="4589003">bytes</span><span class="op" id="4589008">.</span><span class="ident" id="4589009">Index</span><span class="op" id="4589014">(</span><span class="ident" id="4589015">line</span><span class="op" id="4589019">,</span>&nbsp;<span class="op" id="4589021">[</span><span class="op" id="4589022">]</span><span class="builtintype" id="4589023">byte</span><span class="op" id="4589027">{</span><span class="string" id="4589028">&#39;:&#39;</span><span class="op" id="4589031">}</span><span class="op" id="4589032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4589036">if</span>&nbsp;<span class="ident" id="4589039">i</span>&nbsp;<span class="op" id="4589041">==</span>&nbsp;<span class="op" id="4589044">-</span><span class="num" id="4589045">1</span>&nbsp;<span class="op" id="4589047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4589052">break</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4589060">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4589065">//&nbsp;TODO(agl):&nbsp;need&nbsp;to&nbsp;cope&nbsp;with&nbsp;values&nbsp;that&nbsp;spread&nbsp;across&nbsp;lines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4589132">key</span><span class="op" id="4589135">,</span>&nbsp;<span class="ident" id="4589137">val</span>&nbsp;<span class="op" id="4589141">:=</span>&nbsp;<span class="ident" id="4589144">line</span><span class="op" id="4589148">[</span><span class="num" id="4589149">0</span><span class="op" id="4589150">:</span><span class="ident" id="4589151">i</span><span class="op" id="4589152">]</span><span class="op" id="4589153">,</span>&nbsp;<span class="ident" id="4589155">line</span><span class="op" id="4589159">[</span><span class="ident" id="4589160">i</span><span class="op" id="4589161">+</span><span class="num" id="4589162">1</span><span class="op" id="4589163">:</span><span class="op" id="4589164">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4589168">key</span>&nbsp;<span class="op" id="4589172">=</span>&nbsp;<span class="ident" id="4589174">bytes</span><span class="op" id="4589179">.</span><span class="ident" id="4589180">TrimSpace</span><span class="op" id="4589189">(</span><span class="ident" id="4589190">key</span><span class="op" id="4589193">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4589197">val</span>&nbsp;<span class="op" id="4589201">=</span>&nbsp;<span class="ident" id="4589203">bytes</span><span class="op" id="4589208">.</span><span class="ident" id="4589209">TrimSpace</span><span class="op" id="4589218">(</span><span class="ident" id="4589219">val</span><span class="op" id="4589222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4589226">p</span><span class="op" id="4589227">.</span><span class="ident" id="4589228">Headers</span><span class="op" id="4589235">[</span><span class="builtintype" id="4589236">string</span><span class="op" id="4589242">(</span><span class="ident" id="4589243">key</span><span class="op" id="4589246">)</span><span class="op" id="4589247">]</span>&nbsp;<span class="op" id="4589249">=</span>&nbsp;<span class="builtintype" id="4589251">string</span><span class="op" id="4589257">(</span><span class="ident" id="4589258">val</span><span class="op" id="4589261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4589265">rest</span>&nbsp;<span class="op" id="4589270">=</span>&nbsp;<span class="ident" id="4589272">next</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4589278">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4589282">i</span>&nbsp;<span class="op" id="4589284">:=</span>&nbsp;<span class="ident" id="4589287">bytes</span><span class="op" id="4589292">.</span><span class="ident" id="4589293">Index</span><span class="op" id="4589298">(</span><span class="ident" id="4589299">rest</span><span class="op" id="4589303">,</span>&nbsp;<span class="ident" id="4589305">pemEnd</span><span class="op" id="4589311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4589314">if</span>&nbsp;<span class="ident" id="4589317">i</span>&nbsp;<span class="op" id="4589319">&lt;</span>&nbsp;<span class="num" id="4589321">0</span>&nbsp;<span class="op" id="4589323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4589327">return</span>&nbsp;<span class="ident" id="4589334">decodeError</span><span class="op" id="4589345">(</span><span class="ident" id="4589346">data</span><span class="op" id="4589350">,</span>&nbsp;<span class="ident" id="4589352">rest</span><span class="op" id="4589356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4589359">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4589362">base64Data</span>&nbsp;<span class="op" id="4589373">:=</span>&nbsp;<span class="ident" id="4589376">removeWhitespace</span><span class="op" id="4589392">(</span><span class="ident" id="4589393">rest</span><span class="op" id="4589397">[</span><span class="num" id="4589398">0</span><span class="op" id="4589399">:</span><span class="ident" id="4589400">i</span><span class="op" id="4589401">]</span><span class="op" id="4589402">)</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4589406">p</span><span class="op" id="4589407">.</span><span class="ident" id="4589408">Bytes</span>&nbsp;<span class="op" id="4589414">=</span>&nbsp;<span class="builtinfunc" id="4589416">make</span><span class="op" id="4589420">(</span><span class="op" id="4589421">[</span><span class="op" id="4589422">]</span><span class="builtintype" id="4589423">byte</span><span class="op" id="4589427">,</span>&nbsp;<span class="ident" id="4589429">base64</span><span class="op" id="4589435">.</span><span class="ident" id="4589436">StdEncoding</span><span class="op" id="4589447">.</span><span class="ident" id="4589448">DecodedLen</span><span class="op" id="4589458">(</span><span class="builtinfunc" id="4589459">len</span><span class="op" id="4589462">(</span><span class="ident" id="4589463">base64Data</span><span class="op" id="4589473">)</span><span class="op" id="4589474">)</span><span class="op" id="4589475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4589478">n</span><span class="op" id="4589479">,</span>&nbsp;<span class="ident" id="4589481">err</span>&nbsp;<span class="op" id="4589485">:=</span>&nbsp;<span class="ident" id="4589488">base64</span><span class="op" id="4589494">.</span><span class="ident" id="4589495">StdEncoding</span><span class="op" id="4589506">.</span><span class="ident" id="4589507">Decode</span><span class="op" id="4589513">(</span><span class="ident" id="4589514">p</span><span class="op" id="4589515">.</span><span class="ident" id="4589516">Bytes</span><span class="op" id="4589521">,</span>&nbsp;<span class="ident" id="4589523">base64Data</span><span class="op" id="4589533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4589536">if</span>&nbsp;<span class="ident" id="4589539">err</span>&nbsp;<span class="op" id="4589543">!=</span>&nbsp;<span class="builtintype" id="4589546">nil</span>&nbsp;<span class="op" id="4589550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4589554">return</span>&nbsp;<span class="ident" id="4589561">decodeError</span><span class="op" id="4589572">(</span><span class="ident" id="4589573">data</span><span class="op" id="4589577">,</span>&nbsp;<span class="ident" id="4589579">rest</span><span class="op" id="4589583">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4589586">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4589589">p</span><span class="op" id="4589590">.</span><span class="ident" id="4589591">Bytes</span>&nbsp;<span class="op" id="4589597">=</span>&nbsp;<span class="ident" id="4589599">p</span><span class="op" id="4589600">.</span><span class="ident" id="4589601">Bytes</span><span class="op" id="4589606">[</span><span class="num" id="4589607">0</span><span class="op" id="4589608">:</span><span class="ident" id="4589609">n</span><span class="op" id="4589610">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4589614">_</span><span class="op" id="4589615">,</span>&nbsp;<span class="ident" id="4589617">rest</span>&nbsp;<span class="op" id="4589622">=</span>&nbsp;<span class="ident" id="4589624">getLine</span><span class="op" id="4589631">(</span><span class="ident" id="4589632">rest</span><span class="op" id="4589636">[</span><span class="ident" id="4589637">i</span><span class="op" id="4589638">+</span><span class="builtinfunc" id="4589639">len</span><span class="op" id="4589642">(</span><span class="ident" id="4589643">pemEnd</span><span class="op" id="4589649">)</span><span class="op" id="4589650">:</span><span class="op" id="4589651">]</span><span class="op" id="4589652">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4589656">return</span><br>
<span class="lineno"></span><span class="op" id="4589663">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4589666">func</span>&nbsp;<span class="ident" id="4589671">decodeError</span><span class="op" id="4589682">(</span><span class="ident" id="4589683">data</span><span class="op" id="4589687">,</span>&nbsp;<span class="ident" id="4589689">rest</span>&nbsp;<span class="op" id="4589694">[</span><span class="op" id="4589695">]</span><span class="builtintype" id="4589696">byte</span><span class="op" id="4589700">)</span>&nbsp;<span class="op" id="4589702">(</span><span class="op" id="4589703">*</span><span class="ident" id="4589704">Block</span><span class="op" id="4589709">,</span>&nbsp;<span class="op" id="4589711">[</span><span class="op" id="4589712">]</span><span class="builtintype" id="4589713">byte</span><span class="op" id="4589717">)</span>&nbsp;<span class="op" id="4589719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4589722">//&nbsp;If&nbsp;we&nbsp;get&nbsp;here&nbsp;then&nbsp;we&nbsp;have&nbsp;rejected&nbsp;a&nbsp;likely&nbsp;looking,&nbsp;but</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4589785">//&nbsp;ultimately&nbsp;invalid&nbsp;PEM&nbsp;block.&nbsp;We&nbsp;need&nbsp;to&nbsp;start&nbsp;over&nbsp;from&nbsp;a&nbsp;new</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4589852">//&nbsp;position.&nbsp;&nbsp;We&nbsp;have&nbsp;consumed&nbsp;the&nbsp;preamble&nbsp;line&nbsp;and&nbsp;will&nbsp;have&nbsp;consumed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4589925">//&nbsp;any&nbsp;lines&nbsp;which&nbsp;could&nbsp;be&nbsp;header&nbsp;lines.&nbsp;However,&nbsp;a&nbsp;valid&nbsp;preamble</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4589994">//&nbsp;line&nbsp;is&nbsp;not&nbsp;a&nbsp;valid&nbsp;header&nbsp;line,&nbsp;therefore&nbsp;we&nbsp;cannot&nbsp;have&nbsp;consumed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4590065">//&nbsp;the&nbsp;preamble&nbsp;line&nbsp;for&nbsp;the&nbsp;any&nbsp;subsequent&nbsp;block.&nbsp;Thus,&nbsp;we&nbsp;will&nbsp;always</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4590138">//&nbsp;find&nbsp;any&nbsp;valid&nbsp;block,&nbsp;no&nbsp;matter&nbsp;what&nbsp;bytes&nbsp;precede&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4590197">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4590201">//&nbsp;For&nbsp;example,&nbsp;if&nbsp;the&nbsp;input&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4590234">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4590238">//&nbsp;&nbsp;&nbsp;&nbsp;-----BEGIN&nbsp;MALFORMED&nbsp;BLOCK-----</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4590277">//&nbsp;&nbsp;&nbsp;&nbsp;junk&nbsp;that&nbsp;may&nbsp;look&nbsp;like&nbsp;header&nbsp;lines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4590321">//&nbsp;&nbsp;&nbsp;or&nbsp;data&nbsp;lines,&nbsp;but&nbsp;no&nbsp;END&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4590358">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4590362">//&nbsp;&nbsp;&nbsp;&nbsp;-----BEGIN&nbsp;ACTUAL&nbsp;BLOCK-----</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4590398">//&nbsp;&nbsp;&nbsp;&nbsp;realdata</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4590414">//&nbsp;&nbsp;&nbsp;&nbsp;-----END&nbsp;ACTUAL&nbsp;BLOCK-----</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4590448">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4590452">//&nbsp;we&#39;ve&nbsp;failed&nbsp;to&nbsp;parse&nbsp;using&nbsp;the&nbsp;first&nbsp;BEGIN&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4590505">//&nbsp;and&nbsp;now&nbsp;will&nbsp;try&nbsp;again,&nbsp;using&nbsp;the&nbsp;second&nbsp;BEGIN&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4590562">p</span><span class="op" id="4590563">,</span>&nbsp;<span class="ident" id="4590565">rest</span>&nbsp;<span class="op" id="4590570">:=</span>&nbsp;<span class="ident" id="4590573">Decode</span><span class="op" id="4590579">(</span><span class="ident" id="4590580">rest</span><span class="op" id="4590584">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4590587">if</span>&nbsp;<span class="ident" id="4590590">p</span>&nbsp;<span class="op" id="4590592">==</span>&nbsp;<span class="builtintype" id="4590595">nil</span>&nbsp;<span class="op" id="4590599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4590603">rest</span>&nbsp;<span class="op" id="4590608">=</span>&nbsp;<span class="ident" id="4590610">data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4590616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4590619">return</span>&nbsp;<span class="ident" id="4590626">p</span><span class="op" id="4590627">,</span>&nbsp;<span class="ident" id="4590629">rest</span><br>
<span class="lineno"></span><span class="op" id="4590634">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="keyword" id="4590637">const</span>&nbsp;<span class="ident" id="4590643">pemLineLength</span>&nbsp;<span class="op" id="4590657">=</span>&nbsp;<span class="num" id="4590659">64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4590663">type</span>&nbsp;<span class="ident" id="4590668">lineBreaker</span>&nbsp;<span class="keyword" id="4590680">struct</span>&nbsp;<span class="op" id="4590687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4590690">line</span>&nbsp;<span class="op" id="4590695">[</span><span class="ident" id="4590696">pemLineLength</span><span class="op" id="4590709">]</span><span class="builtintype" id="4590710">byte</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4590716">used</span>&nbsp;<span class="builtintype" id="4590721">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4590726">out</span>&nbsp;&nbsp;<span class="ident" id="4590731">io</span><span class="op" id="4590733">.</span><span class="ident" id="4590734">Writer</span><br>
<span class="lineno"></span><span class="op" id="4590741">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4590744">func</span>&nbsp;<span class="op" id="4590749">(</span><span class="ident" id="4590750">l</span>&nbsp;<span class="op" id="4590752">*</span><span class="ident" id="4590753">lineBreaker</span><span class="op" id="4590764">)</span>&nbsp;<span class="ident" id="4590766">Write</span><span class="op" id="4590771">(</span><span class="ident" id="4590772">b</span>&nbsp;<span class="op" id="4590774">[</span><span class="op" id="4590775">]</span><span class="builtintype" id="4590776">byte</span><span class="op" id="4590780">)</span>&nbsp;<span class="op" id="4590782">(</span><span class="ident" id="4590783">n</span>&nbsp;<span class="builtintype" id="4590785">int</span><span class="op" id="4590788">,</span>&nbsp;<span class="ident" id="4590790">err</span>&nbsp;<span class="builtintype" id="4590794">error</span><span class="op" id="4590799">)</span>&nbsp;<span class="op" id="4590801">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4590804">if</span>&nbsp;<span class="ident" id="4590807">l</span><span class="op" id="4590808">.</span><span class="ident" id="4590809">used</span><span class="op" id="4590813">+</span><span class="builtinfunc" id="4590814">len</span><span class="op" id="4590817">(</span><span class="ident" id="4590818">b</span><span class="op" id="4590819">)</span>&nbsp;<span class="op" id="4590821">&lt;</span>&nbsp;<span class="ident" id="4590823">pemLineLength</span>&nbsp;<span class="op" id="4590837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4590841">copy</span><span class="op" id="4590845">(</span><span class="ident" id="4590846">l</span><span class="op" id="4590847">.</span><span class="ident" id="4590848">line</span><span class="op" id="4590852">[</span><span class="ident" id="4590853">l</span><span class="op" id="4590854">.</span><span class="ident" id="4590855">used</span><span class="op" id="4590859">:</span><span class="op" id="4590860">]</span><span class="op" id="4590861">,</span>&nbsp;<span class="ident" id="4590863">b</span><span class="op" id="4590864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4590868">l</span><span class="op" id="4590869">.</span><span class="ident" id="4590870">used</span>&nbsp;<span class="op" id="4590875">+=</span>&nbsp;<span class="builtinfunc" id="4590878">len</span><span class="op" id="4590881">(</span><span class="ident" id="4590882">b</span><span class="op" id="4590883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4590887">return</span>&nbsp;<span class="builtinfunc" id="4590894">len</span><span class="op" id="4590897">(</span><span class="ident" id="4590898">b</span><span class="op" id="4590899">)</span><span class="op" id="4590900">,</span>&nbsp;<span class="builtintype" id="4590902">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4590907">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4590911">n</span><span class="op" id="4590912">,</span>&nbsp;<span class="ident" id="4590914">err</span>&nbsp;<span class="op" id="4590918">=</span>&nbsp;<span class="ident" id="4590920">l</span><span class="op" id="4590921">.</span><span class="ident" id="4590922">out</span><span class="op" id="4590925">.</span><span class="ident" id="4590926">Write</span><span class="op" id="4590931">(</span><span class="ident" id="4590932">l</span><span class="op" id="4590933">.</span><span class="ident" id="4590934">line</span><span class="op" id="4590938">[</span><span class="num" id="4590939">0</span><span class="op" id="4590940">:</span><span class="ident" id="4590941">l</span><span class="op" id="4590942">.</span><span class="ident" id="4590943">used</span><span class="op" id="4590947">]</span><span class="op" id="4590948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4590951">if</span>&nbsp;<span class="ident" id="4590954">err</span>&nbsp;<span class="op" id="4590958">!=</span>&nbsp;<span class="builtintype" id="4590961">nil</span>&nbsp;<span class="op" id="4590965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4590969">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4590977">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4590980">excess</span>&nbsp;<span class="op" id="4590987">:=</span>&nbsp;<span class="ident" id="4590990">pemLineLength</span>&nbsp;<span class="op" id="4591004">-</span>&nbsp;<span class="ident" id="4591006">l</span><span class="op" id="4591007">.</span><span class="ident" id="4591008">used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4591014">l</span><span class="op" id="4591015">.</span><span class="ident" id="4591016">used</span>&nbsp;<span class="op" id="4591021">=</span>&nbsp;<span class="num" id="4591023">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4591027">n</span><span class="op" id="4591028">,</span>&nbsp;<span class="ident" id="4591030">err</span>&nbsp;<span class="op" id="4591034">=</span>&nbsp;<span class="ident" id="4591036">l</span><span class="op" id="4591037">.</span><span class="ident" id="4591038">out</span><span class="op" id="4591041">.</span><span class="ident" id="4591042">Write</span><span class="op" id="4591047">(</span><span class="ident" id="4591048">b</span><span class="op" id="4591049">[</span><span class="num" id="4591050">0</span><span class="op" id="4591051">:</span><span class="ident" id="4591052">excess</span><span class="op" id="4591058">]</span><span class="op" id="4591059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4591062">if</span>&nbsp;<span class="ident" id="4591065">err</span>&nbsp;<span class="op" id="4591069">!=</span>&nbsp;<span class="builtintype" id="4591072">nil</span>&nbsp;<span class="op" id="4591076">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4591080">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4591088">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4591092">n</span><span class="op" id="4591093">,</span>&nbsp;<span class="ident" id="4591095">err</span>&nbsp;<span class="op" id="4591099">=</span>&nbsp;<span class="ident" id="4591101">l</span><span class="op" id="4591102">.</span><span class="ident" id="4591103">out</span><span class="op" id="4591106">.</span><span class="ident" id="4591107">Write</span><span class="op" id="4591112">(</span><span class="op" id="4591113">[</span><span class="op" id="4591114">]</span><span class="builtintype" id="4591115">byte</span><span class="op" id="4591119">{</span><span class="string" id="4591120">&#39;\n&#39;</span><span class="op" id="4591124">}</span><span class="op" id="4591125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4591128">if</span>&nbsp;<span class="ident" id="4591131">err</span>&nbsp;<span class="op" id="4591135">!=</span>&nbsp;<span class="builtintype" id="4591138">nil</span>&nbsp;<span class="op" id="4591142">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4591146">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4591154">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4591158">return</span>&nbsp;<span class="ident" id="4591165">l</span><span class="op" id="4591166">.</span><span class="ident" id="4591167">Write</span><span class="op" id="4591172">(</span><span class="ident" id="4591173">b</span><span class="op" id="4591174">[</span><span class="ident" id="4591175">excess</span><span class="op" id="4591181">:</span><span class="op" id="4591182">]</span><span class="op" id="4591183">)</span><br>
<span class="lineno"></span><span class="op" id="4591185">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="keyword" id="4591188">func</span>&nbsp;<span class="op" id="4591193">(</span><span class="ident" id="4591194">l</span>&nbsp;<span class="op" id="4591196">*</span><span class="ident" id="4591197">lineBreaker</span><span class="op" id="4591208">)</span>&nbsp;<span class="ident" id="4591210">Close</span><span class="op" id="4591215">(</span><span class="op" id="4591216">)</span>&nbsp;<span class="op" id="4591218">(</span><span class="ident" id="4591219">err</span>&nbsp;<span class="builtintype" id="4591223">error</span><span class="op" id="4591228">)</span>&nbsp;<span class="op" id="4591230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4591233">if</span>&nbsp;<span class="ident" id="4591236">l</span><span class="op" id="4591237">.</span><span class="ident" id="4591238">used</span>&nbsp;<span class="op" id="4591243">&gt;</span>&nbsp;<span class="num" id="4591245">0</span>&nbsp;<span class="op" id="4591247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4591251">_</span><span class="op" id="4591252">,</span>&nbsp;<span class="ident" id="4591254">err</span>&nbsp;<span class="op" id="4591258">=</span>&nbsp;<span class="ident" id="4591260">l</span><span class="op" id="4591261">.</span><span class="ident" id="4591262">out</span><span class="op" id="4591265">.</span><span class="ident" id="4591266">Write</span><span class="op" id="4591271">(</span><span class="ident" id="4591272">l</span><span class="op" id="4591273">.</span><span class="ident" id="4591274">line</span><span class="op" id="4591278">[</span><span class="num" id="4591279">0</span><span class="op" id="4591280">:</span><span class="ident" id="4591281">l</span><span class="op" id="4591282">.</span><span class="ident" id="4591283">used</span><span class="op" id="4591287">]</span><span class="op" id="4591288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4591292">if</span>&nbsp;<span class="ident" id="4591295">err</span>&nbsp;<span class="op" id="4591299">!=</span>&nbsp;<span class="builtintype" id="4591302">nil</span>&nbsp;<span class="op" id="4591306">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4591311">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4591320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4591324">_</span><span class="op" id="4591325">,</span>&nbsp;<span class="ident" id="4591327">err</span>&nbsp;<span class="op" id="4591331">=</span>&nbsp;<span class="ident" id="4591333">l</span><span class="op" id="4591334">.</span><span class="ident" id="4591335">out</span><span class="op" id="4591338">.</span><span class="ident" id="4591339">Write</span><span class="op" id="4591344">(</span><span class="op" id="4591345">[</span><span class="op" id="4591346">]</span><span class="builtintype" id="4591347">byte</span><span class="op" id="4591351">{</span><span class="string" id="4591352">&#39;\n&#39;</span><span class="op" id="4591356">}</span><span class="op" id="4591357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4591360">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4591364">return</span><br>
<span class="lineno"></span><span class="op" id="4591371">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4591374">func</span>&nbsp;<span class="ident" id="4591379">writeHeader</span><span class="op" id="4591390">(</span><span class="ident" id="4591391">out</span>&nbsp;<span class="ident" id="4591395">io</span><span class="op" id="4591397">.</span><span class="ident" id="4591398">Writer</span><span class="op" id="4591404">,</span>&nbsp;<span class="ident" id="4591406">k</span><span class="op" id="4591407">,</span>&nbsp;<span class="ident" id="4591409">v</span>&nbsp;<span class="builtintype" id="4591411">string</span><span class="op" id="4591417">)</span>&nbsp;<span class="builtintype" id="4591419">error</span>&nbsp;<span class="op" id="4591425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4591428">_</span><span class="op" id="4591429">,</span>&nbsp;<span class="ident" id="4591431">err</span>&nbsp;<span class="op" id="4591435">:=</span>&nbsp;<span class="ident" id="4591438">out</span><span class="op" id="4591441">.</span><span class="ident" id="4591442">Write</span><span class="op" id="4591447">(</span><span class="op" id="4591448">[</span><span class="op" id="4591449">]</span><span class="builtintype" id="4591450">byte</span><span class="op" id="4591454">(</span><span class="ident" id="4591455">k</span>&nbsp;<span class="op" id="4591457">+</span>&nbsp;<span class="string" id="4591459">&#34;:&nbsp;&#34;</span>&nbsp;<span class="op" id="4591464">+</span>&nbsp;<span class="ident" id="4591466">v</span>&nbsp;<span class="op" id="4591468">+</span>&nbsp;<span class="string" id="4591470">&#34;\n&#34;</span><span class="op" id="4591474">)</span><span class="op" id="4591475">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4591478">return</span>&nbsp;<span class="ident" id="4591485">err</span><br>
<span class="lineno"></span><span class="op" id="4591489">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4591492">func</span>&nbsp;<span class="ident" id="4591497">Encode</span><span class="op" id="4591503">(</span><span class="ident" id="4591504">out</span>&nbsp;<span class="ident" id="4591508">io</span><span class="op" id="4591510">.</span><span class="ident" id="4591511">Writer</span><span class="op" id="4591517">,</span>&nbsp;<span class="ident" id="4591519">b</span>&nbsp;<span class="op" id="4591521">*</span><span class="ident" id="4591522">Block</span><span class="op" id="4591527">)</span>&nbsp;<span class="builtintype" id="4591529">error</span>&nbsp;<span class="op" id="4591535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4591538">if</span>&nbsp;<span class="ident" id="4591541">_</span><span class="op" id="4591542">,</span>&nbsp;<span class="ident" id="4591544">err</span>&nbsp;<span class="op" id="4591548">:=</span>&nbsp;<span class="ident" id="4591551">out</span><span class="op" id="4591554">.</span><span class="ident" id="4591555">Write</span><span class="op" id="4591560">(</span><span class="ident" id="4591561">pemStart</span><span class="op" id="4591569">[</span><span class="num" id="4591570">1</span><span class="op" id="4591571">:</span><span class="op" id="4591572">]</span><span class="op" id="4591573">)</span><span class="op" id="4591574">;</span>&nbsp;<span class="ident" id="4591576">err</span>&nbsp;<span class="op" id="4591580">!=</span>&nbsp;<span class="builtintype" id="4591583">nil</span>&nbsp;<span class="op" id="4591587">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4591591">return</span>&nbsp;<span class="ident" id="4591598">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4591603">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4591606">if</span>&nbsp;<span class="ident" id="4591609">_</span><span class="op" id="4591610">,</span>&nbsp;<span class="ident" id="4591612">err</span>&nbsp;<span class="op" id="4591616">:=</span>&nbsp;<span class="ident" id="4591619">out</span><span class="op" id="4591622">.</span><span class="ident" id="4591623">Write</span><span class="op" id="4591628">(</span><span class="op" id="4591629">[</span><span class="op" id="4591630">]</span><span class="builtintype" id="4591631">byte</span><span class="op" id="4591635">(</span><span class="ident" id="4591636">b</span><span class="op" id="4591637">.</span><span class="ident" id="4591638">Type</span>&nbsp;<span class="op" id="4591643">+</span>&nbsp;<span class="string" id="4591645">&#34;-----\n&#34;</span><span class="op" id="4591654">)</span><span class="op" id="4591655">)</span><span class="op" id="4591656">;</span>&nbsp;<span class="ident" id="4591658">err</span>&nbsp;<span class="op" id="4591662">!=</span>&nbsp;<span class="builtintype" id="4591665">nil</span>&nbsp;<span class="op" id="4591669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4591673">return</span>&nbsp;<span class="ident" id="4591680">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4591685">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4591689">if</span>&nbsp;<span class="builtinfunc" id="4591692">len</span><span class="op" id="4591695">(</span><span class="ident" id="4591696">b</span><span class="op" id="4591697">.</span><span class="ident" id="4591698">Headers</span><span class="op" id="4591705">)</span>&nbsp;<span class="op" id="4591707">&gt;</span>&nbsp;<span class="num" id="4591709">0</span>&nbsp;<span class="op" id="4591711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4591715">const</span>&nbsp;<span class="ident" id="4591721">procType</span>&nbsp;<span class="op" id="4591730">=</span>&nbsp;<span class="string" id="4591732">&#34;Proc-Type&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4591746">h</span>&nbsp;<span class="op" id="4591748">:=</span>&nbsp;<span class="builtinfunc" id="4591751">make</span><span class="op" id="4591755">(</span><span class="op" id="4591756">[</span><span class="op" id="4591757">]</span><span class="builtintype" id="4591758">string</span><span class="op" id="4591764">,</span>&nbsp;<span class="num" id="4591766">0</span><span class="op" id="4591767">,</span>&nbsp;<span class="builtinfunc" id="4591769">len</span><span class="op" id="4591772">(</span><span class="ident" id="4591773">b</span><span class="op" id="4591774">.</span><span class="ident" id="4591775">Headers</span><span class="op" id="4591782">)</span><span class="op" id="4591783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4591787">hasProcType</span>&nbsp;<span class="op" id="4591799">:=</span>&nbsp;<span class="builtintype" id="4591802">false</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4591810">for</span>&nbsp;<span class="ident" id="4591814">k</span>&nbsp;<span class="op" id="4591816">:=</span>&nbsp;<span class="keyword" id="4591819">range</span>&nbsp;<span class="ident" id="4591825">b</span><span class="op" id="4591826">.</span><span class="ident" id="4591827">Headers</span>&nbsp;<span class="op" id="4591835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4591840">if</span>&nbsp;<span class="ident" id="4591843">k</span>&nbsp;<span class="op" id="4591845">==</span>&nbsp;<span class="ident" id="4591848">procType</span>&nbsp;<span class="op" id="4591857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4591863">hasProcType</span>&nbsp;<span class="op" id="4591875">=</span>&nbsp;<span class="builtintype" id="4591877">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4591886">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4591898">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4591903">h</span>&nbsp;<span class="op" id="4591905">=</span>&nbsp;<span class="builtinfunc" id="4591907">append</span><span class="op" id="4591913">(</span><span class="ident" id="4591914">h</span><span class="op" id="4591915">,</span>&nbsp;<span class="ident" id="4591917">k</span><span class="op" id="4591918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4591922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4591926">//&nbsp;The&nbsp;Proc-Type&nbsp;header&nbsp;must&nbsp;be&nbsp;written&nbsp;first.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4591975">//&nbsp;See&nbsp;RFC&nbsp;1421,&nbsp;section&nbsp;4.6.1.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4592010">if</span>&nbsp;<span class="ident" id="4592013">hasProcType</span>&nbsp;<span class="op" id="4592025">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4592030">if</span>&nbsp;<span class="ident" id="4592033">err</span>&nbsp;<span class="op" id="4592037">:=</span>&nbsp;<span class="ident" id="4592040">writeHeader</span><span class="op" id="4592051">(</span><span class="ident" id="4592052">out</span><span class="op" id="4592055">,</span>&nbsp;<span class="ident" id="4592057">procType</span><span class="op" id="4592065">,</span>&nbsp;<span class="ident" id="4592067">b</span><span class="op" id="4592068">.</span><span class="ident" id="4592069">Headers</span><span class="op" id="4592076">[</span><span class="ident" id="4592077">procType</span><span class="op" id="4592085">]</span><span class="op" id="4592086">)</span><span class="op" id="4592087">;</span>&nbsp;<span class="ident" id="4592089">err</span>&nbsp;<span class="op" id="4592093">!=</span>&nbsp;<span class="builtintype" id="4592096">nil</span>&nbsp;<span class="op" id="4592100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4592106">return</span>&nbsp;<span class="ident" id="4592113">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4592120">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4592124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4592128">//&nbsp;For&nbsp;consistency&nbsp;of&nbsp;output,&nbsp;write&nbsp;other&nbsp;headers&nbsp;sorted&nbsp;by&nbsp;key.</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4592195">sort</span><span class="op" id="4592199">.</span><span class="ident" id="4592200">Strings</span><span class="op" id="4592207">(</span><span class="ident" id="4592208">h</span><span class="op" id="4592209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4592213">for</span>&nbsp;<span class="ident" id="4592217">_</span><span class="op" id="4592218">,</span>&nbsp;<span class="ident" id="4592220">k</span>&nbsp;<span class="op" id="4592222">:=</span>&nbsp;<span class="keyword" id="4592225">range</span>&nbsp;<span class="ident" id="4592231">h</span>&nbsp;<span class="op" id="4592233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4592238">if</span>&nbsp;<span class="ident" id="4592241">err</span>&nbsp;<span class="op" id="4592245">:=</span>&nbsp;<span class="ident" id="4592248">writeHeader</span><span class="op" id="4592259">(</span><span class="ident" id="4592260">out</span><span class="op" id="4592263">,</span>&nbsp;<span class="ident" id="4592265">k</span><span class="op" id="4592266">,</span>&nbsp;<span class="ident" id="4592268">b</span><span class="op" id="4592269">.</span><span class="ident" id="4592270">Headers</span><span class="op" id="4592277">[</span><span class="ident" id="4592278">k</span><span class="op" id="4592279">]</span><span class="op" id="4592280">)</span><span class="op" id="4592281">;</span>&nbsp;<span class="ident" id="4592283">err</span>&nbsp;<span class="op" id="4592287">!=</span>&nbsp;<span class="builtintype" id="4592290">nil</span>&nbsp;<span class="op" id="4592294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4592300">return</span>&nbsp;<span class="ident" id="4592307">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4592314">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4592318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4592322">if</span>&nbsp;<span class="ident" id="4592325">_</span><span class="op" id="4592326">,</span>&nbsp;<span class="ident" id="4592328">err</span>&nbsp;<span class="op" id="4592332">:=</span>&nbsp;<span class="ident" id="4592335">out</span><span class="op" id="4592338">.</span><span class="ident" id="4592339">Write</span><span class="op" id="4592344">(</span><span class="op" id="4592345">[</span><span class="op" id="4592346">]</span><span class="builtintype" id="4592347">byte</span><span class="op" id="4592351">{</span><span class="string" id="4592352">&#39;\n&#39;</span><span class="op" id="4592356">}</span><span class="op" id="4592357">)</span><span class="op" id="4592358">;</span>&nbsp;<span class="ident" id="4592360">err</span>&nbsp;<span class="op" id="4592364">!=</span>&nbsp;<span class="builtintype" id="4592367">nil</span>&nbsp;<span class="op" id="4592371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4592376">return</span>&nbsp;<span class="ident" id="4592383">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4592389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4592392">}</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4592396">var</span>&nbsp;<span class="ident" id="4592400">breaker</span>&nbsp;<span class="ident" id="4592408">lineBreaker</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4592421">breaker</span><span class="op" id="4592428">.</span><span class="ident" id="4592429">out</span>&nbsp;<span class="op" id="4592433">=</span>&nbsp;<span class="ident" id="4592435">out</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4592441">b64</span>&nbsp;<span class="op" id="4592445">:=</span>&nbsp;<span class="ident" id="4592448">base64</span><span class="op" id="4592454">.</span><span class="ident" id="4592455">NewEncoder</span><span class="op" id="4592465">(</span><span class="ident" id="4592466">base64</span><span class="op" id="4592472">.</span><span class="ident" id="4592473">StdEncoding</span><span class="op" id="4592484">,</span>&nbsp;<span class="op" id="4592486">&amp;</span><span class="ident" id="4592487">breaker</span><span class="op" id="4592494">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4592497">if</span>&nbsp;<span class="ident" id="4592500">_</span><span class="op" id="4592501">,</span>&nbsp;<span class="ident" id="4592503">err</span>&nbsp;<span class="op" id="4592507">:=</span>&nbsp;<span class="ident" id="4592510">b64</span><span class="op" id="4592513">.</span><span class="ident" id="4592514">Write</span><span class="op" id="4592519">(</span><span class="ident" id="4592520">b</span><span class="op" id="4592521">.</span><span class="ident" id="4592522">Bytes</span><span class="op" id="4592527">)</span><span class="op" id="4592528">;</span>&nbsp;<span class="ident" id="4592530">err</span>&nbsp;<span class="op" id="4592534">!=</span>&nbsp;<span class="builtintype" id="4592537">nil</span>&nbsp;<span class="op" id="4592541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4592545">return</span>&nbsp;<span class="ident" id="4592552">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4592557">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4592560">b64</span><span class="op" id="4592563">.</span><span class="ident" id="4592564">Close</span><span class="op" id="4592569">(</span><span class="op" id="4592570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4592573">breaker</span><span class="op" id="4592580">.</span><span class="ident" id="4592581">Close</span><span class="op" id="4592586">(</span><span class="op" id="4592587">)</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4592591">if</span>&nbsp;<span class="ident" id="4592594">_</span><span class="op" id="4592595">,</span>&nbsp;<span class="ident" id="4592597">err</span>&nbsp;<span class="op" id="4592601">:=</span>&nbsp;<span class="ident" id="4592604">out</span><span class="op" id="4592607">.</span><span class="ident" id="4592608">Write</span><span class="op" id="4592613">(</span><span class="ident" id="4592614">pemEnd</span><span class="op" id="4592620">[</span><span class="num" id="4592621">1</span><span class="op" id="4592622">:</span><span class="op" id="4592623">]</span><span class="op" id="4592624">)</span><span class="op" id="4592625">;</span>&nbsp;<span class="ident" id="4592627">err</span>&nbsp;<span class="op" id="4592631">!=</span>&nbsp;<span class="builtintype" id="4592634">nil</span>&nbsp;<span class="op" id="4592638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4592642">return</span>&nbsp;<span class="ident" id="4592649">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4592654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4592657">_</span><span class="op" id="4592658">,</span>&nbsp;<span class="ident" id="4592660">err</span>&nbsp;<span class="op" id="4592664">:=</span>&nbsp;<span class="ident" id="4592667">out</span><span class="op" id="4592670">.</span><span class="ident" id="4592671">Write</span><span class="op" id="4592676">(</span><span class="op" id="4592677">[</span><span class="op" id="4592678">]</span><span class="builtintype" id="4592679">byte</span><span class="op" id="4592683">(</span><span class="ident" id="4592684">b</span><span class="op" id="4592685">.</span><span class="ident" id="4592686">Type</span>&nbsp;<span class="op" id="4592691">+</span>&nbsp;<span class="string" id="4592693">&#34;-----\n&#34;</span><span class="op" id="4592702">)</span><span class="op" id="4592703">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4592706">return</span>&nbsp;<span class="ident" id="4592713">err</span><br>
<span class="lineno"></span><span class="op" id="4592717">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4592720">func</span>&nbsp;<span class="ident" id="4592725">EncodeToMemory</span><span class="op" id="4592739">(</span><span class="ident" id="4592740">b</span>&nbsp;<span class="op" id="4592742">*</span><span class="ident" id="4592743">Block</span><span class="op" id="4592748">)</span>&nbsp;<span class="op" id="4592750">[</span><span class="op" id="4592751">]</span><span class="builtintype" id="4592752">byte</span>&nbsp;<span class="op" id="4592757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4592760">var</span>&nbsp;<span class="ident" id="4592764">buf</span>&nbsp;<span class="ident" id="4592768">bytes</span><span class="op" id="4592773">.</span><span class="ident" id="4592774">Buffer</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4592782">Encode</span><span class="op" id="4592788">(</span><span class="op" id="4592789">&amp;</span><span class="ident" id="4592790">buf</span><span class="op" id="4592793">,</span>&nbsp;<span class="ident" id="4592795">b</span><span class="op" id="4592796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4592799">return</span>&nbsp;<span class="ident" id="4592806">buf</span><span class="op" id="4592809">.</span><span class="ident" id="4592810">Bytes</span><span class="op" id="4592815">(</span><span class="op" id="4592816">)</span><br>
<span class="lineno"></span><span class="op" id="4592818">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
