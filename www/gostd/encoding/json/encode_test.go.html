<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/json</h2>
<ul>
<li><a href="/gostd/encoding/json/bench_test.go.html">bench_test.go</a></li>
<li><a href="/gostd/encoding/json/decode.go.html">decode.go</a></li>
<li><a href="/gostd/encoding/json/decode_test.go.html">decode_test.go</a></li>
<li><a href="/gostd/encoding/json/encode.go.html">encode.go</a></li>
<li><a href="/gostd/encoding/json/encode_test.go.html">encode_test.go</a></li>
<li><a href="/gostd/encoding/json/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/json/fold.go.html">fold.go</a></li>
<li><a href="/gostd/encoding/json/fold_test.go.html">fold_test.go</a></li>
<li><a href="/gostd/encoding/json/indent.go.html">indent.go</a></li>
<li><a href="/gostd/encoding/json/scanner.go.html">scanner.go</a></li>
<li><a href="/gostd/encoding/json/scanner_test.go.html">scanner_test.go</a></li>
<li><a href="/gostd/encoding/json/stream.go.html">stream.go</a></li>
<li><a href="/gostd/encoding/json/stream_test.go.html">stream_test.go</a></li>
<li><a href="/gostd/encoding/json/tagkey_test.go.html">tagkey_test.go</a></li>
<li><a href="/gostd/encoding/json/tags.go.html">tags.go</a></li>
<li><a href="/gostd/encoding/json/tags_test.go.html">tags_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6807105">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6807160">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6807214">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6807265">package</span>&nbsp;<span class="ident" id="6807273">json</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6807279">import</span>&nbsp;<span class="op" id="6807286">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6807289">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6807298">&#34;math&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6807306">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6807317">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6807328">&#34;unicode&#34;</span><br>
<span class="lineno"></span><span class="op" id="6807338">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="6807341">type</span>&nbsp;<span class="ident" id="6807346">Optionals</span>&nbsp;<span class="keyword" id="6807356">struct</span>&nbsp;<span class="op" id="6807363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6807366">Sr</span>&nbsp;<span class="builtintype" id="6807369">string</span>&nbsp;<span class="string" id="6807376">`json:&#34;sr&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6807389">So</span>&nbsp;<span class="builtintype" id="6807392">string</span>&nbsp;<span class="string" id="6807399">`json:&#34;so,omitempty&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6807422">Sw</span>&nbsp;<span class="builtintype" id="6807425">string</span>&nbsp;<span class="string" id="6807432">`json:&#34;-&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6807445">Ir</span>&nbsp;<span class="builtintype" id="6807448">int</span>&nbsp;<span class="string" id="6807452">`json:&#34;omitempty&#34;`</span>&nbsp;<span class="comment" id="6807471">//&nbsp;actually&nbsp;named&nbsp;omitempty,&nbsp;not&nbsp;an&nbsp;option</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6807515">Io</span>&nbsp;<span class="builtintype" id="6807518">int</span>&nbsp;<span class="string" id="6807522">`json:&#34;io,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6807546">Slr</span>&nbsp;<span class="op" id="6807550">[</span><span class="op" id="6807551">]</span><span class="builtintype" id="6807552">string</span>&nbsp;<span class="string" id="6807559">`json:&#34;slr,random&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6807580">Slo</span>&nbsp;<span class="op" id="6807584">[</span><span class="op" id="6807585">]</span><span class="builtintype" id="6807586">string</span>&nbsp;<span class="string" id="6807593">`json:&#34;slo,omitempty&#34;`</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6807618">Mr</span>&nbsp;<span class="keyword" id="6807621">map</span><span class="op" id="6807624">[</span><span class="builtintype" id="6807625">string</span><span class="op" id="6807631">]</span><span class="keyword" id="6807632">interface</span><span class="op" id="6807641">{</span><span class="op" id="6807642">}</span>&nbsp;<span class="string" id="6807644">`json:&#34;mr&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6807657">Mo</span>&nbsp;<span class="keyword" id="6807660">map</span><span class="op" id="6807663">[</span><span class="builtintype" id="6807664">string</span><span class="op" id="6807670">]</span><span class="keyword" id="6807671">interface</span><span class="op" id="6807680">{</span><span class="op" id="6807681">}</span>&nbsp;<span class="string" id="6807683">`json:&#34;,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6807705">Fr</span>&nbsp;<span class="builtintype" id="6807708">float64</span>&nbsp;<span class="string" id="6807716">`json:&#34;fr&#34;`</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6807729">Fo</span>&nbsp;<span class="builtintype" id="6807732">float64</span>&nbsp;<span class="string" id="6807740">`json:&#34;fo,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6807764">Br</span>&nbsp;<span class="builtintype" id="6807767">bool</span>&nbsp;<span class="string" id="6807772">`json:&#34;br&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6807785">Bo</span>&nbsp;<span class="builtintype" id="6807788">bool</span>&nbsp;<span class="string" id="6807793">`json:&#34;bo,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6807817">Ur</span>&nbsp;<span class="builtintype" id="6807820">uint</span>&nbsp;<span class="string" id="6807825">`json:&#34;ur&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6807838">Uo</span>&nbsp;<span class="builtintype" id="6807841">uint</span>&nbsp;<span class="string" id="6807846">`json:&#34;uo,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6807870">Str</span>&nbsp;<span class="keyword" id="6807874">struct</span><span class="op" id="6807880">{</span><span class="op" id="6807881">}</span>&nbsp;<span class="string" id="6807883">`json:&#34;str&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6807897">Sto</span>&nbsp;<span class="keyword" id="6807901">struct</span><span class="op" id="6807907">{</span><span class="op" id="6807908">}</span>&nbsp;<span class="string" id="6807910">`json:&#34;sto,omitempty&#34;`</span><br>
<span class="lineno">40</span><span class="op" id="6807933">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6807936">var</span>&nbsp;<span class="ident" id="6807940">optionalsExpected</span>&nbsp;<span class="op" id="6807958">=</span>&nbsp;<span class="string" id="6807960">`{<br>
<span class="lineno"></span>&nbsp;&#34;sr&#34;:&nbsp;&#34;&#34;,<br>
<span class="lineno"></span>&nbsp;&#34;omitempty&#34;:&nbsp;0,<br>
<span class="lineno">45</span>&nbsp;&#34;slr&#34;:&nbsp;null,<br>
<span class="lineno"></span>&nbsp;&#34;mr&#34;:&nbsp;{},<br>
<span class="lineno"></span>&nbsp;&#34;fr&#34;:&nbsp;0,<br>
<span class="lineno"></span>&nbsp;&#34;br&#34;:&nbsp;false,<br>
<span class="lineno"></span>&nbsp;&#34;ur&#34;:&nbsp;0,<br>
<span class="lineno">50</span>&nbsp;&#34;str&#34;:&nbsp;{},<br>
<span class="lineno"></span>&nbsp;&#34;sto&#34;:&nbsp;{}<br>
<span class="lineno"></span>}`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6808077">func</span>&nbsp;<span class="ident" id="6808082">TestOmitEmpty</span><span class="op" id="6808095">(</span><span class="ident" id="6808096">t</span>&nbsp;<span class="op" id="6808098">*</span><span class="ident" id="6808099">testing</span><span class="op" id="6808106">.</span><span class="ident" id="6808107">T</span><span class="op" id="6808108">)</span>&nbsp;<span class="op" id="6808110">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6808113">var</span>&nbsp;<span class="ident" id="6808117">o</span>&nbsp;<span class="ident" id="6808119">Optionals</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6808130">o</span><span class="op" id="6808131">.</span><span class="ident" id="6808132">Sw</span>&nbsp;<span class="op" id="6808135">=</span>&nbsp;<span class="string" id="6808137">&#34;something&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6808150">o</span><span class="op" id="6808151">.</span><span class="ident" id="6808152">Mr</span>&nbsp;<span class="op" id="6808155">=</span>&nbsp;<span class="keyword" id="6808157">map</span><span class="op" id="6808160">[</span><span class="builtintype" id="6808161">string</span><span class="op" id="6808167">]</span><span class="keyword" id="6808168">interface</span><span class="op" id="6808177">{</span><span class="op" id="6808178">}</span><span class="op" id="6808179">{</span><span class="op" id="6808180">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6808183">o</span><span class="op" id="6808184">.</span><span class="ident" id="6808185">Mo</span>&nbsp;<span class="op" id="6808188">=</span>&nbsp;<span class="keyword" id="6808190">map</span><span class="op" id="6808193">[</span><span class="builtintype" id="6808194">string</span><span class="op" id="6808200">]</span><span class="keyword" id="6808201">interface</span><span class="op" id="6808210">{</span><span class="op" id="6808211">}</span><span class="op" id="6808212">{</span><span class="op" id="6808213">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6808217">got</span><span class="op" id="6808220">,</span>&nbsp;<span class="ident" id="6808222">err</span>&nbsp;<span class="op" id="6808226">:=</span>&nbsp;<span class="ident" id="6808229">MarshalIndent</span><span class="op" id="6808242">(</span><span class="op" id="6808243">&amp;</span><span class="ident" id="6808244">o</span><span class="op" id="6808245">,</span>&nbsp;<span class="string" id="6808247">&#34;&#34;</span><span class="op" id="6808249">,</span>&nbsp;<span class="string" id="6808251">&#34;&nbsp;&#34;</span><span class="op" id="6808254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6808257">if</span>&nbsp;<span class="ident" id="6808260">err</span>&nbsp;<span class="op" id="6808264">!=</span>&nbsp;<span class="ident" id="6808267">nil</span>&nbsp;<span class="op" id="6808271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6808275">t</span><span class="op" id="6808276">.</span><span class="ident" id="6808277">Fatal</span><span class="op" id="6808282">(</span><span class="ident" id="6808283">err</span><span class="op" id="6808286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6808289">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6808292">if</span>&nbsp;<span class="ident" id="6808295">got</span>&nbsp;<span class="op" id="6808299">:=</span>&nbsp;<span class="builtintype" id="6808302">string</span><span class="op" id="6808308">(</span><span class="ident" id="6808309">got</span><span class="op" id="6808312">)</span><span class="op" id="6808313">;</span>&nbsp;<span class="ident" id="6808315">got</span>&nbsp;<span class="op" id="6808319">!=</span>&nbsp;<span class="ident" id="6808322">optionalsExpected</span>&nbsp;<span class="op" id="6808340">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6808344">t</span><span class="op" id="6808345">.</span><span class="ident" id="6808346">Errorf</span><span class="op" id="6808352">(</span><span class="string" id="6808353">&#34;&nbsp;got:&nbsp;%s\nwant:&nbsp;%s\n&#34;</span><span class="op" id="6808375">,</span>&nbsp;<span class="ident" id="6808377">got</span><span class="op" id="6808380">,</span>&nbsp;<span class="ident" id="6808382">optionalsExpected</span><span class="op" id="6808399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6808402">}</span><br>
<span class="lineno"></span><span class="op" id="6808404">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6808407">type</span>&nbsp;<span class="ident" id="6808412">StringTag</span>&nbsp;<span class="keyword" id="6808422">struct</span>&nbsp;<span class="op" id="6808429">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6808432">BoolStr</span>&nbsp;<span class="builtintype" id="6808440">bool</span>&nbsp;&nbsp;&nbsp;<span class="string" id="6808447">`json:&#34;,string&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6808465">IntStr</span>&nbsp;&nbsp;<span class="ident" id="6808473">int64</span>&nbsp;&nbsp;<span class="string" id="6808480">`json:&#34;,string&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6808498">StrStr</span>&nbsp;&nbsp;<span class="builtintype" id="6808506">string</span>&nbsp;<span class="string" id="6808513">`json:&#34;,string&#34;`</span><br>
<span class="lineno"></span><span class="op" id="6808530">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="6808533">var</span>&nbsp;<span class="ident" id="6808537">stringTagExpected</span>&nbsp;<span class="op" id="6808555">=</span>&nbsp;<span class="string" id="6808557">`{<br>
<span class="lineno"></span>&nbsp;&#34;BoolStr&#34;:&nbsp;&#34;true&#34;,<br>
<span class="lineno"></span>&nbsp;&#34;IntStr&#34;:&nbsp;&#34;42&#34;,<br>
<span class="lineno"></span>&nbsp;&#34;StrStr&#34;:&nbsp;&#34;\&#34;xzbit\&#34;&#34;<br>
<span class="lineno"></span>}`</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="keyword" id="6808624">func</span>&nbsp;<span class="ident" id="6808629">TestStringTag</span><span class="op" id="6808642">(</span><span class="ident" id="6808643">t</span>&nbsp;<span class="op" id="6808645">*</span><span class="ident" id="6808646">testing</span><span class="op" id="6808653">.</span><span class="ident" id="6808654">T</span><span class="op" id="6808655">)</span>&nbsp;<span class="op" id="6808657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6808660">var</span>&nbsp;<span class="ident" id="6808664">s</span>&nbsp;<span class="ident" id="6808666">StringTag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6808677">s</span><span class="op" id="6808678">.</span><span class="ident" id="6808679">BoolStr</span>&nbsp;<span class="op" id="6808687">=</span>&nbsp;<span class="builtintype" id="6808689">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6808695">s</span><span class="op" id="6808696">.</span><span class="ident" id="6808697">IntStr</span>&nbsp;<span class="op" id="6808704">=</span>&nbsp;<span class="num" id="6808706">42</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6808710">s</span><span class="op" id="6808711">.</span><span class="ident" id="6808712">StrStr</span>&nbsp;<span class="op" id="6808719">=</span>&nbsp;<span class="string" id="6808721">&#34;xzbit&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6808730">got</span><span class="op" id="6808733">,</span>&nbsp;<span class="ident" id="6808735">err</span>&nbsp;<span class="op" id="6808739">:=</span>&nbsp;<span class="ident" id="6808742">MarshalIndent</span><span class="op" id="6808755">(</span><span class="op" id="6808756">&amp;</span><span class="ident" id="6808757">s</span><span class="op" id="6808758">,</span>&nbsp;<span class="string" id="6808760">&#34;&#34;</span><span class="op" id="6808762">,</span>&nbsp;<span class="string" id="6808764">&#34;&nbsp;&#34;</span><span class="op" id="6808767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6808770">if</span>&nbsp;<span class="ident" id="6808773">err</span>&nbsp;<span class="op" id="6808777">!=</span>&nbsp;<span class="ident" id="6808780">nil</span>&nbsp;<span class="op" id="6808784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6808788">t</span><span class="op" id="6808789">.</span><span class="ident" id="6808790">Fatal</span><span class="op" id="6808795">(</span><span class="ident" id="6808796">err</span><span class="op" id="6808799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6808802">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6808805">if</span>&nbsp;<span class="ident" id="6808808">got</span>&nbsp;<span class="op" id="6808812">:=</span>&nbsp;<span class="builtintype" id="6808815">string</span><span class="op" id="6808821">(</span><span class="ident" id="6808822">got</span><span class="op" id="6808825">)</span><span class="op" id="6808826">;</span>&nbsp;<span class="ident" id="6808828">got</span>&nbsp;<span class="op" id="6808832">!=</span>&nbsp;<span class="ident" id="6808835">stringTagExpected</span>&nbsp;<span class="op" id="6808853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6808857">t</span><span class="op" id="6808858">.</span><span class="ident" id="6808859">Fatalf</span><span class="op" id="6808865">(</span><span class="string" id="6808866">&#34;&nbsp;got:&nbsp;%s\nwant:&nbsp;%s\n&#34;</span><span class="op" id="6808888">,</span>&nbsp;<span class="ident" id="6808890">got</span><span class="op" id="6808893">,</span>&nbsp;<span class="ident" id="6808895">stringTagExpected</span><span class="op" id="6808912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6808915">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6808919">//&nbsp;Verify&nbsp;that&nbsp;it&nbsp;round-trips.</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6808951">var</span>&nbsp;<span class="ident" id="6808955">s2</span>&nbsp;<span class="ident" id="6808958">StringTag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6808969">err</span>&nbsp;<span class="op" id="6808973">=</span>&nbsp;<span class="ident" id="6808975">NewDecoder</span><span class="op" id="6808985">(</span><span class="ident" id="6808986">bytes</span><span class="op" id="6808991">.</span><span class="ident" id="6808992">NewReader</span><span class="op" id="6809001">(</span><span class="ident" id="6809002">got</span><span class="op" id="6809005">)</span><span class="op" id="6809006">)</span><span class="op" id="6809007">.</span><span class="ident" id="6809008">Decode</span><span class="op" id="6809014">(</span><span class="op" id="6809015">&amp;</span><span class="ident" id="6809016">s2</span><span class="op" id="6809018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6809021">if</span>&nbsp;<span class="ident" id="6809024">err</span>&nbsp;<span class="op" id="6809028">!=</span>&nbsp;<span class="ident" id="6809031">nil</span>&nbsp;<span class="op" id="6809035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6809039">t</span><span class="op" id="6809040">.</span><span class="ident" id="6809041">Fatalf</span><span class="op" id="6809047">(</span><span class="string" id="6809048">&#34;Decode:&nbsp;%v&#34;</span><span class="op" id="6809060">,</span>&nbsp;<span class="ident" id="6809062">err</span><span class="op" id="6809065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6809068">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6809071">if</span>&nbsp;<span class="op" id="6809074">!</span><span class="ident" id="6809075">reflect</span><span class="op" id="6809082">.</span><span class="ident" id="6809083">DeepEqual</span><span class="op" id="6809092">(</span><span class="ident" id="6809093">s</span><span class="op" id="6809094">,</span>&nbsp;<span class="ident" id="6809096">s2</span><span class="op" id="6809098">)</span>&nbsp;<span class="op" id="6809100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6809104">t</span><span class="op" id="6809105">.</span><span class="ident" id="6809106">Fatalf</span><span class="op" id="6809112">(</span><span class="string" id="6809113">&#34;decode&nbsp;didn&#39;t&nbsp;match.\nsource:&nbsp;%#v\nEncoded&nbsp;as:\n%s\ndecode:&nbsp;%#v&#34;</span><span class="op" id="6809178">,</span>&nbsp;<span class="ident" id="6809180">s</span><span class="op" id="6809181">,</span>&nbsp;<span class="builtintype" id="6809183">string</span><span class="op" id="6809189">(</span><span class="ident" id="6809190">got</span><span class="op" id="6809193">)</span><span class="op" id="6809194">,</span>&nbsp;<span class="ident" id="6809196">s2</span><span class="op" id="6809198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6809201">}</span><br>
<span class="lineno"></span><span class="op" id="6809203">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="6809206">//&nbsp;byte&nbsp;slices&nbsp;are&nbsp;special&nbsp;even&nbsp;if&nbsp;they&#39;re&nbsp;renamed&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="6809264">type</span>&nbsp;<span class="ident" id="6809269">renamedByte</span>&nbsp;<span class="builtintype" id="6809281">byte</span><br>
<span class="lineno"></span><span class="keyword" id="6809286">type</span>&nbsp;<span class="ident" id="6809291">renamedByteSlice</span>&nbsp;<span class="op" id="6809308">[</span><span class="op" id="6809309">]</span><span class="builtintype" id="6809310">byte</span><br>
<span class="lineno"></span><span class="keyword" id="6809315">type</span>&nbsp;<span class="ident" id="6809320">renamedRenamedByteSlice</span>&nbsp;<span class="op" id="6809344">[</span><span class="op" id="6809345">]</span><span class="ident" id="6809346">renamedByte</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="6809359">func</span>&nbsp;<span class="ident" id="6809364">TestEncodeRenamedByteSlice</span><span class="op" id="6809390">(</span><span class="ident" id="6809391">t</span>&nbsp;<span class="op" id="6809393">*</span><span class="ident" id="6809394">testing</span><span class="op" id="6809401">.</span><span class="ident" id="6809402">T</span><span class="op" id="6809403">)</span>&nbsp;<span class="op" id="6809405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6809408">s</span>&nbsp;<span class="op" id="6809410">:=</span>&nbsp;<span class="ident" id="6809413">renamedByteSlice</span><span class="op" id="6809429">(</span><span class="string" id="6809430">&#34;abc&#34;</span><span class="op" id="6809435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6809438">result</span><span class="op" id="6809444">,</span>&nbsp;<span class="ident" id="6809446">err</span>&nbsp;<span class="op" id="6809450">:=</span>&nbsp;<span class="ident" id="6809453">Marshal</span><span class="op" id="6809460">(</span><span class="ident" id="6809461">s</span><span class="op" id="6809462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6809465">if</span>&nbsp;<span class="ident" id="6809468">err</span>&nbsp;<span class="op" id="6809472">!=</span>&nbsp;<span class="ident" id="6809475">nil</span>&nbsp;<span class="op" id="6809479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6809483">t</span><span class="op" id="6809484">.</span><span class="ident" id="6809485">Fatal</span><span class="op" id="6809490">(</span><span class="ident" id="6809491">err</span><span class="op" id="6809494">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6809497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6809500">expect</span>&nbsp;<span class="op" id="6809507">:=</span>&nbsp;<span class="string" id="6809510">`&#34;YWJj&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6809520">if</span>&nbsp;<span class="builtintype" id="6809523">string</span><span class="op" id="6809529">(</span><span class="ident" id="6809530">result</span><span class="op" id="6809536">)</span>&nbsp;<span class="op" id="6809538">!=</span>&nbsp;<span class="ident" id="6809541">expect</span>&nbsp;<span class="op" id="6809548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6809552">t</span><span class="op" id="6809553">.</span><span class="ident" id="6809554">Errorf</span><span class="op" id="6809560">(</span><span class="string" id="6809561">&#34;&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="6809578">,</span>&nbsp;<span class="ident" id="6809580">result</span><span class="op" id="6809586">,</span>&nbsp;<span class="ident" id="6809588">expect</span><span class="op" id="6809594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6809597">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6809600">r</span>&nbsp;<span class="op" id="6809602">:=</span>&nbsp;<span class="ident" id="6809605">renamedRenamedByteSlice</span><span class="op" id="6809628">(</span><span class="string" id="6809629">&#34;abc&#34;</span><span class="op" id="6809634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6809637">result</span><span class="op" id="6809643">,</span>&nbsp;<span class="ident" id="6809645">err</span>&nbsp;<span class="op" id="6809649">=</span>&nbsp;<span class="ident" id="6809651">Marshal</span><span class="op" id="6809658">(</span><span class="ident" id="6809659">r</span><span class="op" id="6809660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6809663">if</span>&nbsp;<span class="ident" id="6809666">err</span>&nbsp;<span class="op" id="6809670">!=</span>&nbsp;<span class="ident" id="6809673">nil</span>&nbsp;<span class="op" id="6809677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6809681">t</span><span class="op" id="6809682">.</span><span class="ident" id="6809683">Fatal</span><span class="op" id="6809688">(</span><span class="ident" id="6809689">err</span><span class="op" id="6809692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6809695">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6809698">if</span>&nbsp;<span class="builtintype" id="6809701">string</span><span class="op" id="6809707">(</span><span class="ident" id="6809708">result</span><span class="op" id="6809714">)</span>&nbsp;<span class="op" id="6809716">!=</span>&nbsp;<span class="ident" id="6809719">expect</span>&nbsp;<span class="op" id="6809726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6809730">t</span><span class="op" id="6809731">.</span><span class="ident" id="6809732">Errorf</span><span class="op" id="6809738">(</span><span class="string" id="6809739">&#34;&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="6809756">,</span>&nbsp;<span class="ident" id="6809758">result</span><span class="op" id="6809764">,</span>&nbsp;<span class="ident" id="6809766">expect</span><span class="op" id="6809772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6809775">}</span><br>
<span class="lineno"></span><span class="op" id="6809777">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="6809780">var</span>&nbsp;<span class="ident" id="6809784">unsupportedValues</span>&nbsp;<span class="op" id="6809802">=</span>&nbsp;<span class="op" id="6809804">[</span><span class="op" id="6809805">]</span><span class="keyword" id="6809806">interface</span><span class="op" id="6809815">{</span><span class="op" id="6809816">}</span><span class="op" id="6809817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6809820">math</span><span class="op" id="6809824">.</span><span class="ident" id="6809825">NaN</span><span class="op" id="6809828">(</span><span class="op" id="6809829">)</span><span class="op" id="6809830">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6809833">math</span><span class="op" id="6809837">.</span><span class="ident" id="6809838">Inf</span><span class="op" id="6809841">(</span><span class="op" id="6809842">-</span><span class="num" id="6809843">1</span><span class="op" id="6809844">)</span><span class="op" id="6809845">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6809848">math</span><span class="op" id="6809852">.</span><span class="ident" id="6809853">Inf</span><span class="op" id="6809856">(</span><span class="num" id="6809857">1</span><span class="op" id="6809858">)</span><span class="op" id="6809859">,</span><br>
<span class="lineno"></span><span class="op" id="6809861">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="keyword" id="6809864">func</span>&nbsp;<span class="ident" id="6809869">TestUnsupportedValues</span><span class="op" id="6809890">(</span><span class="ident" id="6809891">t</span>&nbsp;<span class="op" id="6809893">*</span><span class="ident" id="6809894">testing</span><span class="op" id="6809901">.</span><span class="ident" id="6809902">T</span><span class="op" id="6809903">)</span>&nbsp;<span class="op" id="6809905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6809908">for</span>&nbsp;<span class="ident" id="6809912">_</span><span class="op" id="6809913">,</span>&nbsp;<span class="ident" id="6809915">v</span>&nbsp;<span class="op" id="6809917">:=</span>&nbsp;<span class="keyword" id="6809920">range</span>&nbsp;<span class="ident" id="6809926">unsupportedValues</span>&nbsp;<span class="op" id="6809944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6809948">if</span>&nbsp;<span class="ident" id="6809951">_</span><span class="op" id="6809952">,</span>&nbsp;<span class="ident" id="6809954">err</span>&nbsp;<span class="op" id="6809958">:=</span>&nbsp;<span class="ident" id="6809961">Marshal</span><span class="op" id="6809968">(</span><span class="ident" id="6809969">v</span><span class="op" id="6809970">)</span><span class="op" id="6809971">;</span>&nbsp;<span class="ident" id="6809973">err</span>&nbsp;<span class="op" id="6809977">!=</span>&nbsp;<span class="ident" id="6809980">nil</span>&nbsp;<span class="op" id="6809984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6809989">if</span>&nbsp;<span class="ident" id="6809992">_</span><span class="op" id="6809993">,</span>&nbsp;<span class="ident" id="6809995">ok</span>&nbsp;<span class="op" id="6809998">:=</span>&nbsp;<span class="ident" id="6810001">err</span><span class="op" id="6810004">.</span><span class="op" id="6810005">(</span><span class="op" id="6810006">*</span><span class="ident" id="6810007">UnsupportedValueError</span><span class="op" id="6810028">)</span><span class="op" id="6810029">;</span>&nbsp;<span class="op" id="6810031">!</span><span class="ident" id="6810032">ok</span>&nbsp;<span class="op" id="6810035">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6810041">t</span><span class="op" id="6810042">.</span><span class="ident" id="6810043">Errorf</span><span class="op" id="6810049">(</span><span class="string" id="6810050">&#34;for&nbsp;%v,&nbsp;got&nbsp;%T&nbsp;want&nbsp;UnsupportedValueError&#34;</span><span class="op" id="6810093">,</span>&nbsp;<span class="ident" id="6810095">v</span><span class="op" id="6810096">,</span>&nbsp;<span class="ident" id="6810098">err</span><span class="op" id="6810101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6810106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6810110">}</span>&nbsp;<span class="keyword" id="6810112">else</span>&nbsp;<span class="op" id="6810117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6810122">t</span><span class="op" id="6810123">.</span><span class="ident" id="6810124">Errorf</span><span class="op" id="6810130">(</span><span class="string" id="6810131">&#34;for&nbsp;%v,&nbsp;expected&nbsp;error&#34;</span><span class="op" id="6810155">,</span>&nbsp;<span class="ident" id="6810157">v</span><span class="op" id="6810158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6810162">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6810165">}</span><br>
<span class="lineno"></span><span class="op" id="6810167">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6810170">//&nbsp;Ref&nbsp;has&nbsp;Marshaler&nbsp;and&nbsp;Unmarshaler&nbsp;methods&nbsp;with&nbsp;pointer&nbsp;receiver.</span><br>
<span class="lineno"></span><span class="keyword" id="6810238">type</span>&nbsp;<span class="ident" id="6810243">Ref</span>&nbsp;<span class="builtintype" id="6810247">int</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="keyword" id="6810252">func</span>&nbsp;<span class="op" id="6810257">(</span><span class="op" id="6810258">*</span><span class="ident" id="6810259">Ref</span><span class="op" id="6810262">)</span>&nbsp;<span class="ident" id="6810264">MarshalJSON</span><span class="op" id="6810275">(</span><span class="op" id="6810276">)</span>&nbsp;<span class="op" id="6810278">(</span><span class="op" id="6810279">[</span><span class="op" id="6810280">]</span><span class="builtintype" id="6810281">byte</span><span class="op" id="6810285">,</span>&nbsp;<span class="builtintype" id="6810287">error</span><span class="op" id="6810292">)</span>&nbsp;<span class="op" id="6810294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6810297">return</span>&nbsp;<span class="op" id="6810304">[</span><span class="op" id="6810305">]</span><span class="builtintype" id="6810306">byte</span><span class="op" id="6810310">(</span><span class="string" id="6810311">`&#34;ref&#34;`</span><span class="op" id="6810318">)</span><span class="op" id="6810319">,</span>&nbsp;<span class="ident" id="6810321">nil</span><br>
<span class="lineno"></span><span class="op" id="6810325">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="keyword" id="6810328">func</span>&nbsp;<span class="op" id="6810333">(</span><span class="ident" id="6810334">r</span>&nbsp;<span class="op" id="6810336">*</span><span class="ident" id="6810337">Ref</span><span class="op" id="6810340">)</span>&nbsp;<span class="ident" id="6810342">UnmarshalJSON</span><span class="op" id="6810355">(</span><span class="op" id="6810356">[</span><span class="op" id="6810357">]</span><span class="builtintype" id="6810358">byte</span><span class="op" id="6810362">)</span>&nbsp;<span class="builtintype" id="6810364">error</span>&nbsp;<span class="op" id="6810370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6810373">*</span><span class="ident" id="6810374">r</span>&nbsp;<span class="op" id="6810376">=</span>&nbsp;<span class="num" id="6810378">12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6810382">return</span>&nbsp;<span class="ident" id="6810389">nil</span><br>
<span class="lineno"></span><span class="op" id="6810393">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="6810396">//&nbsp;Val&nbsp;has&nbsp;Marshaler&nbsp;methods&nbsp;with&nbsp;value&nbsp;receiver.</span><br>
<span class="lineno"></span><span class="keyword" id="6810446">type</span>&nbsp;<span class="ident" id="6810451">Val</span>&nbsp;<span class="builtintype" id="6810455">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6810460">func</span>&nbsp;<span class="op" id="6810465">(</span><span class="ident" id="6810466">Val</span><span class="op" id="6810469">)</span>&nbsp;<span class="ident" id="6810471">MarshalJSON</span><span class="op" id="6810482">(</span><span class="op" id="6810483">)</span>&nbsp;<span class="op" id="6810485">(</span><span class="op" id="6810486">[</span><span class="op" id="6810487">]</span><span class="builtintype" id="6810488">byte</span><span class="op" id="6810492">,</span>&nbsp;<span class="builtintype" id="6810494">error</span><span class="op" id="6810499">)</span>&nbsp;<span class="op" id="6810501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6810504">return</span>&nbsp;<span class="op" id="6810511">[</span><span class="op" id="6810512">]</span><span class="builtintype" id="6810513">byte</span><span class="op" id="6810517">(</span><span class="string" id="6810518">`&#34;val&#34;`</span><span class="op" id="6810525">)</span><span class="op" id="6810526">,</span>&nbsp;<span class="ident" id="6810528">nil</span><br>
<span class="lineno">165</span><span class="op" id="6810532">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6810535">//&nbsp;RefText&nbsp;has&nbsp;Marshaler&nbsp;and&nbsp;Unmarshaler&nbsp;methods&nbsp;with&nbsp;pointer&nbsp;receiver.</span><br>
<span class="lineno"></span><span class="keyword" id="6810607">type</span>&nbsp;<span class="ident" id="6810612">RefText</span>&nbsp;<span class="builtintype" id="6810620">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="6810625">func</span>&nbsp;<span class="op" id="6810630">(</span><span class="op" id="6810631">*</span><span class="ident" id="6810632">RefText</span><span class="op" id="6810639">)</span>&nbsp;<span class="ident" id="6810641">MarshalText</span><span class="op" id="6810652">(</span><span class="op" id="6810653">)</span>&nbsp;<span class="op" id="6810655">(</span><span class="op" id="6810656">[</span><span class="op" id="6810657">]</span><span class="builtintype" id="6810658">byte</span><span class="op" id="6810662">,</span>&nbsp;<span class="builtintype" id="6810664">error</span><span class="op" id="6810669">)</span>&nbsp;<span class="op" id="6810671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6810674">return</span>&nbsp;<span class="op" id="6810681">[</span><span class="op" id="6810682">]</span><span class="builtintype" id="6810683">byte</span><span class="op" id="6810687">(</span><span class="string" id="6810688">`&#34;ref&#34;`</span><span class="op" id="6810695">)</span><span class="op" id="6810696">,</span>&nbsp;<span class="ident" id="6810698">nil</span><br>
<span class="lineno"></span><span class="op" id="6810702">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6810705">func</span>&nbsp;<span class="op" id="6810710">(</span><span class="ident" id="6810711">r</span>&nbsp;<span class="op" id="6810713">*</span><span class="ident" id="6810714">RefText</span><span class="op" id="6810721">)</span>&nbsp;<span class="ident" id="6810723">UnmarshalText</span><span class="op" id="6810736">(</span><span class="op" id="6810737">[</span><span class="op" id="6810738">]</span><span class="builtintype" id="6810739">byte</span><span class="op" id="6810743">)</span>&nbsp;<span class="builtintype" id="6810745">error</span>&nbsp;<span class="op" id="6810751">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6810754">*</span><span class="ident" id="6810755">r</span>&nbsp;<span class="op" id="6810757">=</span>&nbsp;<span class="num" id="6810759">13</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6810763">return</span>&nbsp;<span class="ident" id="6810770">nil</span><br>
<span class="lineno"></span><span class="op" id="6810774">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6810777">//&nbsp;ValText&nbsp;has&nbsp;Marshaler&nbsp;methods&nbsp;with&nbsp;value&nbsp;receiver.</span><br>
<span class="lineno">180</span><span class="keyword" id="6810831">type</span>&nbsp;<span class="ident" id="6810836">ValText</span>&nbsp;<span class="builtintype" id="6810844">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6810849">func</span>&nbsp;<span class="op" id="6810854">(</span><span class="ident" id="6810855">ValText</span><span class="op" id="6810862">)</span>&nbsp;<span class="ident" id="6810864">MarshalText</span><span class="op" id="6810875">(</span><span class="op" id="6810876">)</span>&nbsp;<span class="op" id="6810878">(</span><span class="op" id="6810879">[</span><span class="op" id="6810880">]</span><span class="builtintype" id="6810881">byte</span><span class="op" id="6810885">,</span>&nbsp;<span class="builtintype" id="6810887">error</span><span class="op" id="6810892">)</span>&nbsp;<span class="op" id="6810894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6810897">return</span>&nbsp;<span class="op" id="6810904">[</span><span class="op" id="6810905">]</span><span class="builtintype" id="6810906">byte</span><span class="op" id="6810910">(</span><span class="string" id="6810911">`&#34;val&#34;`</span><span class="op" id="6810918">)</span><span class="op" id="6810919">,</span>&nbsp;<span class="ident" id="6810921">nil</span><br>
<span class="lineno"></span><span class="op" id="6810925">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span><span class="keyword" id="6810928">func</span>&nbsp;<span class="ident" id="6810933">TestRefValMarshal</span><span class="op" id="6810950">(</span><span class="ident" id="6810951">t</span>&nbsp;<span class="op" id="6810953">*</span><span class="ident" id="6810954">testing</span><span class="op" id="6810961">.</span><span class="ident" id="6810962">T</span><span class="op" id="6810963">)</span>&nbsp;<span class="op" id="6810965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6810968">var</span>&nbsp;<span class="ident" id="6810972">s</span>&nbsp;<span class="op" id="6810974">=</span>&nbsp;<span class="keyword" id="6810976">struct</span>&nbsp;<span class="op" id="6810983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6810987">R0</span>&nbsp;<span class="ident" id="6810990">Ref</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6810996">R1</span>&nbsp;<span class="op" id="6810999">*</span><span class="ident" id="6811000">Ref</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6811006">R2</span>&nbsp;<span class="ident" id="6811009">RefText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6811019">R3</span>&nbsp;<span class="op" id="6811022">*</span><span class="ident" id="6811023">RefText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6811033">V0</span>&nbsp;<span class="ident" id="6811036">Val</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6811042">V1</span>&nbsp;<span class="op" id="6811045">*</span><span class="ident" id="6811046">Val</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6811052">V2</span>&nbsp;<span class="ident" id="6811055">ValText</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6811065">V3</span>&nbsp;<span class="op" id="6811068">*</span><span class="ident" id="6811069">ValText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6811078">}</span><span class="op" id="6811079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6811083">R0</span><span class="op" id="6811085">:</span>&nbsp;<span class="num" id="6811087">12</span><span class="op" id="6811089">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6811093">R1</span><span class="op" id="6811095">:</span>&nbsp;<span class="builtinfunc" id="6811097">new</span><span class="op" id="6811100">(</span><span class="ident" id="6811101">Ref</span><span class="op" id="6811104">)</span><span class="op" id="6811105">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6811109">R2</span><span class="op" id="6811111">:</span>&nbsp;<span class="num" id="6811113">14</span><span class="op" id="6811115">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6811119">R3</span><span class="op" id="6811121">:</span>&nbsp;<span class="builtinfunc" id="6811123">new</span><span class="op" id="6811126">(</span><span class="ident" id="6811127">RefText</span><span class="op" id="6811134">)</span><span class="op" id="6811135">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6811139">V0</span><span class="op" id="6811141">:</span>&nbsp;<span class="num" id="6811143">13</span><span class="op" id="6811145">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6811149">V1</span><span class="op" id="6811151">:</span>&nbsp;<span class="builtinfunc" id="6811153">new</span><span class="op" id="6811156">(</span><span class="ident" id="6811157">Val</span><span class="op" id="6811160">)</span><span class="op" id="6811161">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6811165">V2</span><span class="op" id="6811167">:</span>&nbsp;<span class="num" id="6811169">15</span><span class="op" id="6811171">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6811175">V3</span><span class="op" id="6811177">:</span>&nbsp;<span class="builtinfunc" id="6811179">new</span><span class="op" id="6811182">(</span><span class="ident" id="6811183">ValText</span><span class="op" id="6811190">)</span><span class="op" id="6811191">,</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6811194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6811197">const</span>&nbsp;<span class="ident" id="6811203">want</span>&nbsp;<span class="op" id="6811208">=</span>&nbsp;<span class="string" id="6811210">`{&#34;R0&#34;:&#34;ref&#34;,&#34;R1&#34;:&#34;ref&#34;,&#34;R2&#34;:&#34;\&#34;ref\&#34;&#34;,&#34;R3&#34;:&#34;\&#34;ref\&#34;&#34;,&#34;V0&#34;:&#34;val&#34;,&#34;V1&#34;:&#34;val&#34;,&#34;V2&#34;:&#34;\&#34;val\&#34;&#34;,&#34;V3&#34;:&#34;\&#34;val\&#34;&#34;}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6811319">b</span><span class="op" id="6811320">,</span>&nbsp;<span class="ident" id="6811322">err</span>&nbsp;<span class="op" id="6811326">:=</span>&nbsp;<span class="ident" id="6811329">Marshal</span><span class="op" id="6811336">(</span><span class="op" id="6811337">&amp;</span><span class="ident" id="6811338">s</span><span class="op" id="6811339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6811342">if</span>&nbsp;<span class="ident" id="6811345">err</span>&nbsp;<span class="op" id="6811349">!=</span>&nbsp;<span class="ident" id="6811352">nil</span>&nbsp;<span class="op" id="6811356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6811360">t</span><span class="op" id="6811361">.</span><span class="ident" id="6811362">Fatalf</span><span class="op" id="6811368">(</span><span class="string" id="6811369">&#34;Marshal:&nbsp;%v&#34;</span><span class="op" id="6811382">,</span>&nbsp;<span class="ident" id="6811384">err</span><span class="op" id="6811387">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6811390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6811393">if</span>&nbsp;<span class="ident" id="6811396">got</span>&nbsp;<span class="op" id="6811400">:=</span>&nbsp;<span class="builtintype" id="6811403">string</span><span class="op" id="6811409">(</span><span class="ident" id="6811410">b</span><span class="op" id="6811411">)</span><span class="op" id="6811412">;</span>&nbsp;<span class="ident" id="6811414">got</span>&nbsp;<span class="op" id="6811418">!=</span>&nbsp;<span class="ident" id="6811421">want</span>&nbsp;<span class="op" id="6811426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6811430">t</span><span class="op" id="6811431">.</span><span class="ident" id="6811432">Errorf</span><span class="op" id="6811438">(</span><span class="string" id="6811439">&#34;got&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6811456">,</span>&nbsp;<span class="ident" id="6811458">got</span><span class="op" id="6811461">,</span>&nbsp;<span class="ident" id="6811463">want</span><span class="op" id="6811467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6811470">}</span><br>
<span class="lineno"></span><span class="op" id="6811472">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span><span class="comment" id="6811475">//&nbsp;C&nbsp;implements&nbsp;Marshaler&nbsp;and&nbsp;returns&nbsp;unescaped&nbsp;JSON.</span><br>
<span class="lineno"></span><span class="keyword" id="6811529">type</span>&nbsp;<span class="ident" id="6811534">C</span>&nbsp;<span class="builtintype" id="6811536">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6811541">func</span>&nbsp;<span class="op" id="6811546">(</span><span class="ident" id="6811547">C</span><span class="op" id="6811548">)</span>&nbsp;<span class="ident" id="6811550">MarshalJSON</span><span class="op" id="6811561">(</span><span class="op" id="6811562">)</span>&nbsp;<span class="op" id="6811564">(</span><span class="op" id="6811565">[</span><span class="op" id="6811566">]</span><span class="builtintype" id="6811567">byte</span><span class="op" id="6811571">,</span>&nbsp;<span class="builtintype" id="6811573">error</span><span class="op" id="6811578">)</span>&nbsp;<span class="op" id="6811580">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6811583">return</span>&nbsp;<span class="op" id="6811590">[</span><span class="op" id="6811591">]</span><span class="builtintype" id="6811592">byte</span><span class="op" id="6811596">(</span><span class="string" id="6811597">`&#34;&lt;&amp;&gt;&#34;`</span><span class="op" id="6811604">)</span><span class="op" id="6811605">,</span>&nbsp;<span class="ident" id="6811607">nil</span><br>
<span class="lineno"></span><span class="op" id="6811611">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6811614">//&nbsp;CText&nbsp;implements&nbsp;Marshaler&nbsp;and&nbsp;returns&nbsp;unescaped&nbsp;text.</span><br>
<span class="lineno"></span><span class="keyword" id="6811672">type</span>&nbsp;<span class="ident" id="6811677">CText</span>&nbsp;<span class="builtintype" id="6811683">int</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="keyword" id="6811688">func</span>&nbsp;<span class="op" id="6811693">(</span><span class="ident" id="6811694">CText</span><span class="op" id="6811699">)</span>&nbsp;<span class="ident" id="6811701">MarshalText</span><span class="op" id="6811712">(</span><span class="op" id="6811713">)</span>&nbsp;<span class="op" id="6811715">(</span><span class="op" id="6811716">[</span><span class="op" id="6811717">]</span><span class="builtintype" id="6811718">byte</span><span class="op" id="6811722">,</span>&nbsp;<span class="builtintype" id="6811724">error</span><span class="op" id="6811729">)</span>&nbsp;<span class="op" id="6811731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6811734">return</span>&nbsp;<span class="op" id="6811741">[</span><span class="op" id="6811742">]</span><span class="builtintype" id="6811743">byte</span><span class="op" id="6811747">(</span><span class="string" id="6811748">`&#34;&lt;&amp;&gt;&#34;`</span><span class="op" id="6811755">)</span><span class="op" id="6811756">,</span>&nbsp;<span class="ident" id="6811758">nil</span><br>
<span class="lineno"></span><span class="op" id="6811762">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="6811765">func</span>&nbsp;<span class="ident" id="6811770">TestMarshalerEscaping</span><span class="op" id="6811791">(</span><span class="ident" id="6811792">t</span>&nbsp;<span class="op" id="6811794">*</span><span class="ident" id="6811795">testing</span><span class="op" id="6811802">.</span><span class="ident" id="6811803">T</span><span class="op" id="6811804">)</span>&nbsp;<span class="op" id="6811806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6811809">var</span>&nbsp;<span class="ident" id="6811813">c</span>&nbsp;<span class="ident" id="6811815">C</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6811818">want</span>&nbsp;<span class="op" id="6811823">:=</span>&nbsp;<span class="string" id="6811826">`&#34;\u003c\u0026\u003e&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6811850">b</span><span class="op" id="6811851">,</span>&nbsp;<span class="ident" id="6811853">err</span>&nbsp;<span class="op" id="6811857">:=</span>&nbsp;<span class="ident" id="6811860">Marshal</span><span class="op" id="6811867">(</span><span class="ident" id="6811868">c</span><span class="op" id="6811869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6811872">if</span>&nbsp;<span class="ident" id="6811875">err</span>&nbsp;<span class="op" id="6811879">!=</span>&nbsp;<span class="ident" id="6811882">nil</span>&nbsp;<span class="op" id="6811886">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6811890">t</span><span class="op" id="6811891">.</span><span class="ident" id="6811892">Fatalf</span><span class="op" id="6811898">(</span><span class="string" id="6811899">&#34;Marshal(c):&nbsp;%v&#34;</span><span class="op" id="6811915">,</span>&nbsp;<span class="ident" id="6811917">err</span><span class="op" id="6811920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6811923">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6811926">if</span>&nbsp;<span class="ident" id="6811929">got</span>&nbsp;<span class="op" id="6811933">:=</span>&nbsp;<span class="builtintype" id="6811936">string</span><span class="op" id="6811942">(</span><span class="ident" id="6811943">b</span><span class="op" id="6811944">)</span><span class="op" id="6811945">;</span>&nbsp;<span class="ident" id="6811947">got</span>&nbsp;<span class="op" id="6811951">!=</span>&nbsp;<span class="ident" id="6811954">want</span>&nbsp;<span class="op" id="6811959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6811963">t</span><span class="op" id="6811964">.</span><span class="ident" id="6811965">Errorf</span><span class="op" id="6811971">(</span><span class="string" id="6811972">&#34;Marshal(c)&nbsp;=&nbsp;%#q,&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="6812000">,</span>&nbsp;<span class="ident" id="6812002">got</span><span class="op" id="6812005">,</span>&nbsp;<span class="ident" id="6812007">want</span><span class="op" id="6812011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6812014">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6812018">var</span>&nbsp;<span class="ident" id="6812022">ct</span>&nbsp;<span class="ident" id="6812025">CText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6812032">want</span>&nbsp;<span class="op" id="6812037">=</span>&nbsp;<span class="string" id="6812039">`&#34;\&#34;\u003c\u0026\u003e\&#34;&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6812067">b</span><span class="op" id="6812068">,</span>&nbsp;<span class="ident" id="6812070">err</span>&nbsp;<span class="op" id="6812074">=</span>&nbsp;<span class="ident" id="6812076">Marshal</span><span class="op" id="6812083">(</span><span class="ident" id="6812084">ct</span><span class="op" id="6812086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6812089">if</span>&nbsp;<span class="ident" id="6812092">err</span>&nbsp;<span class="op" id="6812096">!=</span>&nbsp;<span class="ident" id="6812099">nil</span>&nbsp;<span class="op" id="6812103">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6812107">t</span><span class="op" id="6812108">.</span><span class="ident" id="6812109">Fatalf</span><span class="op" id="6812115">(</span><span class="string" id="6812116">&#34;Marshal(ct):&nbsp;%v&#34;</span><span class="op" id="6812133">,</span>&nbsp;<span class="ident" id="6812135">err</span><span class="op" id="6812138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6812141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6812144">if</span>&nbsp;<span class="ident" id="6812147">got</span>&nbsp;<span class="op" id="6812151">:=</span>&nbsp;<span class="builtintype" id="6812154">string</span><span class="op" id="6812160">(</span><span class="ident" id="6812161">b</span><span class="op" id="6812162">)</span><span class="op" id="6812163">;</span>&nbsp;<span class="ident" id="6812165">got</span>&nbsp;<span class="op" id="6812169">!=</span>&nbsp;<span class="ident" id="6812172">want</span>&nbsp;<span class="op" id="6812177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6812181">t</span><span class="op" id="6812182">.</span><span class="ident" id="6812183">Errorf</span><span class="op" id="6812189">(</span><span class="string" id="6812190">&#34;Marshal(ct)&nbsp;=&nbsp;%#q,&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="6812219">,</span>&nbsp;<span class="ident" id="6812221">got</span><span class="op" id="6812224">,</span>&nbsp;<span class="ident" id="6812226">want</span><span class="op" id="6812230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6812233">}</span><br>
<span class="lineno">250</span><span class="op" id="6812235">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6812238">type</span>&nbsp;<span class="ident" id="6812243">IntType</span>&nbsp;<span class="builtintype" id="6812251">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6812256">type</span>&nbsp;<span class="ident" id="6812261">MyStruct</span>&nbsp;<span class="keyword" id="6812270">struct</span>&nbsp;<span class="op" id="6812277">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6812280">IntType</span><br>
<span class="lineno"></span><span class="op" id="6812288">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6812291">func</span>&nbsp;<span class="ident" id="6812296">TestAnonymousNonstruct</span><span class="op" id="6812318">(</span><span class="ident" id="6812319">t</span>&nbsp;<span class="op" id="6812321">*</span><span class="ident" id="6812322">testing</span><span class="op" id="6812329">.</span><span class="ident" id="6812330">T</span><span class="op" id="6812331">)</span>&nbsp;<span class="op" id="6812333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6812336">var</span>&nbsp;<span class="ident" id="6812340">i</span>&nbsp;<span class="ident" id="6812342">IntType</span>&nbsp;<span class="op" id="6812350">=</span>&nbsp;<span class="num" id="6812352">11</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6812356">a</span>&nbsp;<span class="op" id="6812358">:=</span>&nbsp;<span class="ident" id="6812361">MyStruct</span><span class="op" id="6812369">{</span><span class="ident" id="6812370">i</span><span class="op" id="6812371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6812374">const</span>&nbsp;<span class="ident" id="6812380">want</span>&nbsp;<span class="op" id="6812385">=</span>&nbsp;<span class="string" id="6812387">`{&#34;IntType&#34;:11}`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6812406">b</span><span class="op" id="6812407">,</span>&nbsp;<span class="ident" id="6812409">err</span>&nbsp;<span class="op" id="6812413">:=</span>&nbsp;<span class="ident" id="6812416">Marshal</span><span class="op" id="6812423">(</span><span class="ident" id="6812424">a</span><span class="op" id="6812425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6812428">if</span>&nbsp;<span class="ident" id="6812431">err</span>&nbsp;<span class="op" id="6812435">!=</span>&nbsp;<span class="ident" id="6812438">nil</span>&nbsp;<span class="op" id="6812442">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6812446">t</span><span class="op" id="6812447">.</span><span class="ident" id="6812448">Fatalf</span><span class="op" id="6812454">(</span><span class="string" id="6812455">&#34;Marshal:&nbsp;%v&#34;</span><span class="op" id="6812468">,</span>&nbsp;<span class="ident" id="6812470">err</span><span class="op" id="6812473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6812476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6812479">if</span>&nbsp;<span class="ident" id="6812482">got</span>&nbsp;<span class="op" id="6812486">:=</span>&nbsp;<span class="builtintype" id="6812489">string</span><span class="op" id="6812495">(</span><span class="ident" id="6812496">b</span><span class="op" id="6812497">)</span><span class="op" id="6812498">;</span>&nbsp;<span class="ident" id="6812500">got</span>&nbsp;<span class="op" id="6812504">!=</span>&nbsp;<span class="ident" id="6812507">want</span>&nbsp;<span class="op" id="6812512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6812516">t</span><span class="op" id="6812517">.</span><span class="ident" id="6812518">Errorf</span><span class="op" id="6812524">(</span><span class="string" id="6812525">&#34;got&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6812542">,</span>&nbsp;<span class="ident" id="6812544">got</span><span class="op" id="6812547">,</span>&nbsp;<span class="ident" id="6812549">want</span><span class="op" id="6812553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6812556">}</span><br>
<span class="lineno">270</span><span class="op" id="6812558">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6812561">type</span>&nbsp;<span class="ident" id="6812566">BugA</span>&nbsp;<span class="keyword" id="6812571">struct</span>&nbsp;<span class="op" id="6812578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6812581">S</span>&nbsp;<span class="builtintype" id="6812583">string</span><br>
<span class="lineno"></span><span class="op" id="6812590">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="keyword" id="6812593">type</span>&nbsp;<span class="ident" id="6812598">BugB</span>&nbsp;<span class="keyword" id="6812603">struct</span>&nbsp;<span class="op" id="6812610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6812613">BugA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6812619">S</span>&nbsp;<span class="builtintype" id="6812621">string</span><br>
<span class="lineno"></span><span class="op" id="6812628">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="keyword" id="6812631">type</span>&nbsp;<span class="ident" id="6812636">BugC</span>&nbsp;<span class="keyword" id="6812641">struct</span>&nbsp;<span class="op" id="6812648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6812651">S</span>&nbsp;<span class="builtintype" id="6812653">string</span><br>
<span class="lineno"></span><span class="op" id="6812660">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="comment" id="6812663">//&nbsp;Legal&nbsp;Go:&nbsp;We&nbsp;never&nbsp;use&nbsp;the&nbsp;repeated&nbsp;embedded&nbsp;field&nbsp;(S).</span><br>
<span class="lineno"></span><span class="keyword" id="6812722">type</span>&nbsp;<span class="ident" id="6812727">BugX</span>&nbsp;<span class="keyword" id="6812732">struct</span>&nbsp;<span class="op" id="6812739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6812742">A</span>&nbsp;<span class="builtintype" id="6812744">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6812749">BugA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6812755">BugB</span><br>
<span class="lineno">290</span><span class="op" id="6812760">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6812763">//&nbsp;Issue&nbsp;5245.</span><br>
<span class="lineno"></span><span class="keyword" id="6812778">func</span>&nbsp;<span class="ident" id="6812783">TestEmbeddedBug</span><span class="op" id="6812798">(</span><span class="ident" id="6812799">t</span>&nbsp;<span class="op" id="6812801">*</span><span class="ident" id="6812802">testing</span><span class="op" id="6812809">.</span><span class="ident" id="6812810">T</span><span class="op" id="6812811">)</span>&nbsp;<span class="op" id="6812813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6812816">v</span>&nbsp;<span class="op" id="6812818">:=</span>&nbsp;<span class="ident" id="6812821">BugB</span><span class="op" id="6812825">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6812829">BugA</span><span class="op" id="6812833">{</span><span class="string" id="6812834">&#34;A&#34;</span><span class="op" id="6812837">}</span><span class="op" id="6812838">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6812842">&#34;B&#34;</span><span class="op" id="6812845">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6812848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6812851">b</span><span class="op" id="6812852">,</span>&nbsp;<span class="ident" id="6812854">err</span>&nbsp;<span class="op" id="6812858">:=</span>&nbsp;<span class="ident" id="6812861">Marshal</span><span class="op" id="6812868">(</span><span class="ident" id="6812869">v</span><span class="op" id="6812870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6812873">if</span>&nbsp;<span class="ident" id="6812876">err</span>&nbsp;<span class="op" id="6812880">!=</span>&nbsp;<span class="ident" id="6812883">nil</span>&nbsp;<span class="op" id="6812887">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6812891">t</span><span class="op" id="6812892">.</span><span class="ident" id="6812893">Fatal</span><span class="op" id="6812898">(</span><span class="string" id="6812899">&#34;Marshal:&#34;</span><span class="op" id="6812909">,</span>&nbsp;<span class="ident" id="6812911">err</span><span class="op" id="6812914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6812917">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6812920">want</span>&nbsp;<span class="op" id="6812925">:=</span>&nbsp;<span class="string" id="6812928">`{&#34;S&#34;:&#34;B&#34;}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6812941">got</span>&nbsp;<span class="op" id="6812945">:=</span>&nbsp;<span class="builtintype" id="6812948">string</span><span class="op" id="6812954">(</span><span class="ident" id="6812955">b</span><span class="op" id="6812956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6812959">if</span>&nbsp;<span class="ident" id="6812962">got</span>&nbsp;<span class="op" id="6812966">!=</span>&nbsp;<span class="ident" id="6812969">want</span>&nbsp;<span class="op" id="6812974">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6812978">t</span><span class="op" id="6812979">.</span><span class="ident" id="6812980">Fatalf</span><span class="op" id="6812986">(</span><span class="string" id="6812987">&#34;Marshal:&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="6813012">,</span>&nbsp;<span class="ident" id="6813014">got</span><span class="op" id="6813017">,</span>&nbsp;<span class="ident" id="6813019">want</span><span class="op" id="6813023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6813026">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6813029">//&nbsp;Now&nbsp;check&nbsp;that&nbsp;the&nbsp;duplicate&nbsp;field,&nbsp;S,&nbsp;does&nbsp;not&nbsp;appear.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6813089">x</span>&nbsp;<span class="op" id="6813091">:=</span>&nbsp;<span class="ident" id="6813094">BugX</span><span class="op" id="6813098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6813102">A</span><span class="op" id="6813103">:</span>&nbsp;<span class="num" id="6813105">23</span><span class="op" id="6813107">,</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6813110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6813113">b</span><span class="op" id="6813114">,</span>&nbsp;<span class="ident" id="6813116">err</span>&nbsp;<span class="op" id="6813120">=</span>&nbsp;<span class="ident" id="6813122">Marshal</span><span class="op" id="6813129">(</span><span class="ident" id="6813130">x</span><span class="op" id="6813131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6813134">if</span>&nbsp;<span class="ident" id="6813137">err</span>&nbsp;<span class="op" id="6813141">!=</span>&nbsp;<span class="ident" id="6813144">nil</span>&nbsp;<span class="op" id="6813148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6813152">t</span><span class="op" id="6813153">.</span><span class="ident" id="6813154">Fatal</span><span class="op" id="6813159">(</span><span class="string" id="6813160">&#34;Marshal:&#34;</span><span class="op" id="6813170">,</span>&nbsp;<span class="ident" id="6813172">err</span><span class="op" id="6813175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6813178">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6813181">want</span>&nbsp;<span class="op" id="6813186">=</span>&nbsp;<span class="string" id="6813188">`{&#34;A&#34;:23}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6813200">got</span>&nbsp;<span class="op" id="6813204">=</span>&nbsp;<span class="builtintype" id="6813206">string</span><span class="op" id="6813212">(</span><span class="ident" id="6813213">b</span><span class="op" id="6813214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6813217">if</span>&nbsp;<span class="ident" id="6813220">got</span>&nbsp;<span class="op" id="6813224">!=</span>&nbsp;<span class="ident" id="6813227">want</span>&nbsp;<span class="op" id="6813232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6813236">t</span><span class="op" id="6813237">.</span><span class="ident" id="6813238">Fatalf</span><span class="op" id="6813244">(</span><span class="string" id="6813245">&#34;Marshal:&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="6813270">,</span>&nbsp;<span class="ident" id="6813272">got</span><span class="op" id="6813275">,</span>&nbsp;<span class="ident" id="6813277">want</span><span class="op" id="6813281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6813284">}</span><br>
<span class="lineno">320</span><span class="op" id="6813286">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6813289">type</span>&nbsp;<span class="ident" id="6813294">BugD</span>&nbsp;<span class="keyword" id="6813299">struct</span>&nbsp;<span class="op" id="6813306">{</span>&nbsp;<span class="comment" id="6813308">//&nbsp;Same&nbsp;as&nbsp;BugA&nbsp;after&nbsp;tagging.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6813340">XXX</span>&nbsp;<span class="builtintype" id="6813344">string</span>&nbsp;<span class="string" id="6813351">`json:&#34;S&#34;`</span><br>
<span class="lineno"></span><span class="op" id="6813362">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="comment" id="6813365">//&nbsp;BugD&#39;s&nbsp;tagged&nbsp;S&nbsp;field&nbsp;should&nbsp;dominate&nbsp;BugA&#39;s.</span><br>
<span class="lineno"></span><span class="keyword" id="6813414">type</span>&nbsp;<span class="ident" id="6813419">BugY</span>&nbsp;<span class="keyword" id="6813424">struct</span>&nbsp;<span class="op" id="6813431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6813434">BugA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6813440">BugD</span><br>
<span class="lineno">330</span><span class="op" id="6813445">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6813448">//&nbsp;Test&nbsp;that&nbsp;a&nbsp;field&nbsp;with&nbsp;a&nbsp;tag&nbsp;dominates&nbsp;untagged&nbsp;fields.</span><br>
<span class="lineno"></span><span class="keyword" id="6813507">func</span>&nbsp;<span class="ident" id="6813512">TestTaggedFieldDominates</span><span class="op" id="6813536">(</span><span class="ident" id="6813537">t</span>&nbsp;<span class="op" id="6813539">*</span><span class="ident" id="6813540">testing</span><span class="op" id="6813547">.</span><span class="ident" id="6813548">T</span><span class="op" id="6813549">)</span>&nbsp;<span class="op" id="6813551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6813554">v</span>&nbsp;<span class="op" id="6813556">:=</span>&nbsp;<span class="ident" id="6813559">BugY</span><span class="op" id="6813563">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6813567">BugA</span><span class="op" id="6813571">{</span><span class="string" id="6813572">&#34;BugA&#34;</span><span class="op" id="6813578">}</span><span class="op" id="6813579">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6813583">BugD</span><span class="op" id="6813587">{</span><span class="string" id="6813588">&#34;BugD&#34;</span><span class="op" id="6813594">}</span><span class="op" id="6813595">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6813598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6813601">b</span><span class="op" id="6813602">,</span>&nbsp;<span class="ident" id="6813604">err</span>&nbsp;<span class="op" id="6813608">:=</span>&nbsp;<span class="ident" id="6813611">Marshal</span><span class="op" id="6813618">(</span><span class="ident" id="6813619">v</span><span class="op" id="6813620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6813623">if</span>&nbsp;<span class="ident" id="6813626">err</span>&nbsp;<span class="op" id="6813630">!=</span>&nbsp;<span class="ident" id="6813633">nil</span>&nbsp;<span class="op" id="6813637">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6813641">t</span><span class="op" id="6813642">.</span><span class="ident" id="6813643">Fatal</span><span class="op" id="6813648">(</span><span class="string" id="6813649">&#34;Marshal:&#34;</span><span class="op" id="6813659">,</span>&nbsp;<span class="ident" id="6813661">err</span><span class="op" id="6813664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6813667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6813670">want</span>&nbsp;<span class="op" id="6813675">:=</span>&nbsp;<span class="string" id="6813678">`{&#34;S&#34;:&#34;BugD&#34;}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6813694">got</span>&nbsp;<span class="op" id="6813698">:=</span>&nbsp;<span class="builtintype" id="6813701">string</span><span class="op" id="6813707">(</span><span class="ident" id="6813708">b</span><span class="op" id="6813709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6813712">if</span>&nbsp;<span class="ident" id="6813715">got</span>&nbsp;<span class="op" id="6813719">!=</span>&nbsp;<span class="ident" id="6813722">want</span>&nbsp;<span class="op" id="6813727">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6813731">t</span><span class="op" id="6813732">.</span><span class="ident" id="6813733">Fatalf</span><span class="op" id="6813739">(</span><span class="string" id="6813740">&#34;Marshal:&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="6813765">,</span>&nbsp;<span class="ident" id="6813767">got</span><span class="op" id="6813770">,</span>&nbsp;<span class="ident" id="6813772">want</span><span class="op" id="6813776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6813779">}</span><br>
<span class="lineno"></span><span class="op" id="6813781">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6813784">//&nbsp;There&nbsp;are&nbsp;no&nbsp;tags&nbsp;here,&nbsp;so&nbsp;S&nbsp;should&nbsp;not&nbsp;appear.</span><br>
<span class="lineno">350</span><span class="keyword" id="6813835">type</span>&nbsp;<span class="ident" id="6813840">BugZ</span>&nbsp;<span class="keyword" id="6813845">struct</span>&nbsp;<span class="op" id="6813852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6813855">BugA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6813861">BugC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6813867">BugY</span>&nbsp;<span class="comment" id="6813872">//&nbsp;Contains&nbsp;a&nbsp;tagged&nbsp;S&nbsp;field&nbsp;through&nbsp;BugD;&nbsp;should&nbsp;not&nbsp;dominate.</span><br>
<span class="lineno"></span><span class="op" id="6813936">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span><span class="keyword" id="6813939">func</span>&nbsp;<span class="ident" id="6813944">TestDuplicatedFieldDisappears</span><span class="op" id="6813973">(</span><span class="ident" id="6813974">t</span>&nbsp;<span class="op" id="6813976">*</span><span class="ident" id="6813977">testing</span><span class="op" id="6813984">.</span><span class="ident" id="6813985">T</span><span class="op" id="6813986">)</span>&nbsp;<span class="op" id="6813988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6813991">v</span>&nbsp;<span class="op" id="6813993">:=</span>&nbsp;<span class="ident" id="6813996">BugZ</span><span class="op" id="6814000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6814004">BugA</span><span class="op" id="6814008">{</span><span class="string" id="6814009">&#34;BugA&#34;</span><span class="op" id="6814015">}</span><span class="op" id="6814016">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6814020">BugC</span><span class="op" id="6814024">{</span><span class="string" id="6814025">&#34;BugC&#34;</span><span class="op" id="6814031">}</span><span class="op" id="6814032">,</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6814036">BugY</span><span class="op" id="6814040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6814045">BugA</span><span class="op" id="6814049">{</span><span class="string" id="6814050">&#34;nested&nbsp;BugA&#34;</span><span class="op" id="6814063">}</span><span class="op" id="6814064">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6814069">BugD</span><span class="op" id="6814073">{</span><span class="string" id="6814074">&#34;nested&nbsp;BugD&#34;</span><span class="op" id="6814087">}</span><span class="op" id="6814088">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6814092">}</span><span class="op" id="6814093">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6814096">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6814099">b</span><span class="op" id="6814100">,</span>&nbsp;<span class="ident" id="6814102">err</span>&nbsp;<span class="op" id="6814106">:=</span>&nbsp;<span class="ident" id="6814109">Marshal</span><span class="op" id="6814116">(</span><span class="ident" id="6814117">v</span><span class="op" id="6814118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6814121">if</span>&nbsp;<span class="ident" id="6814124">err</span>&nbsp;<span class="op" id="6814128">!=</span>&nbsp;<span class="ident" id="6814131">nil</span>&nbsp;<span class="op" id="6814135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6814139">t</span><span class="op" id="6814140">.</span><span class="ident" id="6814141">Fatal</span><span class="op" id="6814146">(</span><span class="string" id="6814147">&#34;Marshal:&#34;</span><span class="op" id="6814157">,</span>&nbsp;<span class="ident" id="6814159">err</span><span class="op" id="6814162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6814165">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6814168">want</span>&nbsp;<span class="op" id="6814173">:=</span>&nbsp;<span class="string" id="6814176">`{}`</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6814182">got</span>&nbsp;<span class="op" id="6814186">:=</span>&nbsp;<span class="builtintype" id="6814189">string</span><span class="op" id="6814195">(</span><span class="ident" id="6814196">b</span><span class="op" id="6814197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6814200">if</span>&nbsp;<span class="ident" id="6814203">got</span>&nbsp;<span class="op" id="6814207">!=</span>&nbsp;<span class="ident" id="6814210">want</span>&nbsp;<span class="op" id="6814215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6814219">t</span><span class="op" id="6814220">.</span><span class="ident" id="6814221">Fatalf</span><span class="op" id="6814227">(</span><span class="string" id="6814228">&#34;Marshal:&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="6814253">,</span>&nbsp;<span class="ident" id="6814255">got</span><span class="op" id="6814258">,</span>&nbsp;<span class="ident" id="6814260">want</span><span class="op" id="6814264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6814267">}</span><br>
<span class="lineno"></span><span class="op" id="6814269">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span><span class="keyword" id="6814272">func</span>&nbsp;<span class="ident" id="6814277">TestStringBytes</span><span class="op" id="6814292">(</span><span class="ident" id="6814293">t</span>&nbsp;<span class="op" id="6814295">*</span><span class="ident" id="6814296">testing</span><span class="op" id="6814303">.</span><span class="ident" id="6814304">T</span><span class="op" id="6814305">)</span>&nbsp;<span class="op" id="6814307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6814310">//&nbsp;Test&nbsp;that&nbsp;encodeState.stringBytes&nbsp;and&nbsp;encodeState.string&nbsp;use&nbsp;the&nbsp;same&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6814394">es</span>&nbsp;<span class="op" id="6814397">:=</span>&nbsp;<span class="op" id="6814400">&amp;</span><span class="ident" id="6814401">encodeState</span><span class="op" id="6814412">{</span><span class="op" id="6814413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6814416">var</span>&nbsp;<span class="ident" id="6814420">r</span>&nbsp;<span class="op" id="6814422">[</span><span class="op" id="6814423">]</span><span class="builtintype" id="6814424">rune</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6814430">for</span>&nbsp;<span class="ident" id="6814434">i</span>&nbsp;<span class="op" id="6814436">:=</span>&nbsp;<span class="string" id="6814439">&#39;\u0000&#39;</span><span class="op" id="6814447">;</span>&nbsp;<span class="ident" id="6814449">i</span>&nbsp;<span class="op" id="6814451">&lt;=</span>&nbsp;<span class="ident" id="6814454">unicode</span><span class="op" id="6814461">.</span><span class="ident" id="6814462">MaxRune</span><span class="op" id="6814469">;</span>&nbsp;<span class="ident" id="6814471">i</span><span class="op" id="6814472">++</span>&nbsp;<span class="op" id="6814475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6814479">r</span>&nbsp;<span class="op" id="6814481">=</span>&nbsp;<span class="builtinfunc" id="6814483">append</span><span class="op" id="6814489">(</span><span class="ident" id="6814490">r</span><span class="op" id="6814491">,</span>&nbsp;<span class="ident" id="6814493">i</span><span class="op" id="6814494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6814497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6814500">s</span>&nbsp;<span class="op" id="6814502">:=</span>&nbsp;<span class="builtintype" id="6814505">string</span><span class="op" id="6814511">(</span><span class="ident" id="6814512">r</span><span class="op" id="6814513">)</span>&nbsp;<span class="op" id="6814515">+</span>&nbsp;<span class="string" id="6814517">&#34;\xff\xff\xffhello&#34;</span>&nbsp;<span class="comment" id="6814537">//&nbsp;some&nbsp;invalid&nbsp;UTF-8&nbsp;too</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6814564">_</span><span class="op" id="6814565">,</span>&nbsp;<span class="ident" id="6814567">err</span>&nbsp;<span class="op" id="6814571">:=</span>&nbsp;<span class="ident" id="6814574">es</span><span class="op" id="6814576">.</span><span class="builtintype" id="6814577">string</span><span class="op" id="6814583">(</span><span class="ident" id="6814584">s</span><span class="op" id="6814585">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6814588">if</span>&nbsp;<span class="ident" id="6814591">err</span>&nbsp;<span class="op" id="6814595">!=</span>&nbsp;<span class="ident" id="6814598">nil</span>&nbsp;<span class="op" id="6814602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6814606">t</span><span class="op" id="6814607">.</span><span class="ident" id="6814608">Fatal</span><span class="op" id="6814613">(</span><span class="ident" id="6814614">err</span><span class="op" id="6814617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6814620">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6814624">esBytes</span>&nbsp;<span class="op" id="6814632">:=</span>&nbsp;<span class="op" id="6814635">&amp;</span><span class="ident" id="6814636">encodeState</span><span class="op" id="6814647">{</span><span class="op" id="6814648">}</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6814651">_</span><span class="op" id="6814652">,</span>&nbsp;<span class="ident" id="6814654">err</span>&nbsp;<span class="op" id="6814658">=</span>&nbsp;<span class="ident" id="6814660">esBytes</span><span class="op" id="6814667">.</span><span class="ident" id="6814668">stringBytes</span><span class="op" id="6814679">(</span><span class="op" id="6814680">[</span><span class="op" id="6814681">]</span><span class="builtintype" id="6814682">byte</span><span class="op" id="6814686">(</span><span class="ident" id="6814687">s</span><span class="op" id="6814688">)</span><span class="op" id="6814689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6814692">if</span>&nbsp;<span class="ident" id="6814695">err</span>&nbsp;<span class="op" id="6814699">!=</span>&nbsp;<span class="ident" id="6814702">nil</span>&nbsp;<span class="op" id="6814706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6814710">t</span><span class="op" id="6814711">.</span><span class="ident" id="6814712">Fatal</span><span class="op" id="6814717">(</span><span class="ident" id="6814718">err</span><span class="op" id="6814721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6814724">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6814728">enc</span>&nbsp;<span class="op" id="6814732">:=</span>&nbsp;<span class="ident" id="6814735">es</span><span class="op" id="6814737">.</span><span class="ident" id="6814738">Buffer</span><span class="op" id="6814744">.</span><span class="ident" id="6814745">String</span><span class="op" id="6814751">(</span><span class="op" id="6814752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6814755">encBytes</span>&nbsp;<span class="op" id="6814764">:=</span>&nbsp;<span class="ident" id="6814767">esBytes</span><span class="op" id="6814774">.</span><span class="ident" id="6814775">Buffer</span><span class="op" id="6814781">.</span><span class="ident" id="6814782">String</span><span class="op" id="6814788">(</span><span class="op" id="6814789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6814792">if</span>&nbsp;<span class="ident" id="6814795">enc</span>&nbsp;<span class="op" id="6814799">!=</span>&nbsp;<span class="ident" id="6814802">encBytes</span>&nbsp;<span class="op" id="6814811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6814815">i</span>&nbsp;<span class="op" id="6814817">:=</span>&nbsp;<span class="num" id="6814820">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6814824">for</span>&nbsp;<span class="ident" id="6814828">i</span>&nbsp;<span class="op" id="6814830">&lt;</span>&nbsp;<span class="builtinfunc" id="6814832">len</span><span class="op" id="6814835">(</span><span class="ident" id="6814836">enc</span><span class="op" id="6814839">)</span>&nbsp;<span class="op" id="6814841">&amp;&amp;</span>&nbsp;<span class="ident" id="6814844">i</span>&nbsp;<span class="op" id="6814846">&lt;</span>&nbsp;<span class="builtinfunc" id="6814848">len</span><span class="op" id="6814851">(</span><span class="ident" id="6814852">encBytes</span><span class="op" id="6814860">)</span>&nbsp;<span class="op" id="6814862">&amp;&amp;</span>&nbsp;<span class="ident" id="6814865">enc</span><span class="op" id="6814868">[</span><span class="ident" id="6814869">i</span><span class="op" id="6814870">]</span>&nbsp;<span class="op" id="6814872">==</span>&nbsp;<span class="ident" id="6814875">encBytes</span><span class="op" id="6814883">[</span><span class="ident" id="6814884">i</span><span class="op" id="6814885">]</span>&nbsp;<span class="op" id="6814887">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6814892">i</span><span class="op" id="6814893">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6814898">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6814902">enc</span>&nbsp;<span class="op" id="6814906">=</span>&nbsp;<span class="ident" id="6814908">enc</span><span class="op" id="6814911">[</span><span class="ident" id="6814912">i</span><span class="op" id="6814913">:</span><span class="op" id="6814914">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6814918">encBytes</span>&nbsp;<span class="op" id="6814927">=</span>&nbsp;<span class="ident" id="6814929">encBytes</span><span class="op" id="6814937">[</span><span class="ident" id="6814938">i</span><span class="op" id="6814939">:</span><span class="op" id="6814940">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6814944">i</span>&nbsp;<span class="op" id="6814946">=</span>&nbsp;<span class="num" id="6814948">0</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6814952">for</span>&nbsp;<span class="ident" id="6814956">i</span>&nbsp;<span class="op" id="6814958">&lt;</span>&nbsp;<span class="builtinfunc" id="6814960">len</span><span class="op" id="6814963">(</span><span class="ident" id="6814964">enc</span><span class="op" id="6814967">)</span>&nbsp;<span class="op" id="6814969">&amp;&amp;</span>&nbsp;<span class="ident" id="6814972">i</span>&nbsp;<span class="op" id="6814974">&lt;</span>&nbsp;<span class="builtinfunc" id="6814976">len</span><span class="op" id="6814979">(</span><span class="ident" id="6814980">encBytes</span><span class="op" id="6814988">)</span>&nbsp;<span class="op" id="6814990">&amp;&amp;</span>&nbsp;<span class="ident" id="6814993">enc</span><span class="op" id="6814996">[</span><span class="builtinfunc" id="6814997">len</span><span class="op" id="6815000">(</span><span class="ident" id="6815001">enc</span><span class="op" id="6815004">)</span><span class="op" id="6815005">-</span><span class="ident" id="6815006">i</span><span class="op" id="6815007">-</span><span class="num" id="6815008">1</span><span class="op" id="6815009">]</span>&nbsp;<span class="op" id="6815011">==</span>&nbsp;<span class="ident" id="6815014">encBytes</span><span class="op" id="6815022">[</span><span class="builtinfunc" id="6815023">len</span><span class="op" id="6815026">(</span><span class="ident" id="6815027">encBytes</span><span class="op" id="6815035">)</span><span class="op" id="6815036">-</span><span class="ident" id="6815037">i</span><span class="op" id="6815038">-</span><span class="num" id="6815039">1</span><span class="op" id="6815040">]</span>&nbsp;<span class="op" id="6815042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6815047">i</span><span class="op" id="6815048">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6815053">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6815057">enc</span>&nbsp;<span class="op" id="6815061">=</span>&nbsp;<span class="ident" id="6815063">enc</span><span class="op" id="6815066">[</span><span class="op" id="6815067">:</span><span class="builtinfunc" id="6815068">len</span><span class="op" id="6815071">(</span><span class="ident" id="6815072">enc</span><span class="op" id="6815075">)</span><span class="op" id="6815076">-</span><span class="ident" id="6815077">i</span><span class="op" id="6815078">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6815082">encBytes</span>&nbsp;<span class="op" id="6815091">=</span>&nbsp;<span class="ident" id="6815093">encBytes</span><span class="op" id="6815101">[</span><span class="op" id="6815102">:</span><span class="builtinfunc" id="6815103">len</span><span class="op" id="6815106">(</span><span class="ident" id="6815107">encBytes</span><span class="op" id="6815115">)</span><span class="op" id="6815116">-</span><span class="ident" id="6815117">i</span><span class="op" id="6815118">]</span><br>
<span class="lineno">410</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6815123">if</span>&nbsp;<span class="builtinfunc" id="6815126">len</span><span class="op" id="6815129">(</span><span class="ident" id="6815130">enc</span><span class="op" id="6815133">)</span>&nbsp;<span class="op" id="6815135">&gt;</span>&nbsp;<span class="num" id="6815137">20</span>&nbsp;<span class="op" id="6815140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6815145">enc</span>&nbsp;<span class="op" id="6815149">=</span>&nbsp;<span class="ident" id="6815151">enc</span><span class="op" id="6815154">[</span><span class="op" id="6815155">:</span><span class="num" id="6815156">20</span><span class="op" id="6815158">]</span>&nbsp;<span class="op" id="6815160">+</span>&nbsp;<span class="string" id="6815162">&#34;...&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6815170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6815174">if</span>&nbsp;<span class="builtinfunc" id="6815177">len</span><span class="op" id="6815180">(</span><span class="ident" id="6815181">encBytes</span><span class="op" id="6815189">)</span>&nbsp;<span class="op" id="6815191">&gt;</span>&nbsp;<span class="num" id="6815193">20</span>&nbsp;<span class="op" id="6815196">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6815201">encBytes</span>&nbsp;<span class="op" id="6815210">=</span>&nbsp;<span class="ident" id="6815212">encBytes</span><span class="op" id="6815220">[</span><span class="op" id="6815221">:</span><span class="num" id="6815222">20</span><span class="op" id="6815224">]</span>&nbsp;<span class="op" id="6815226">+</span>&nbsp;<span class="string" id="6815228">&#34;...&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6815236">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6815241">t</span><span class="op" id="6815242">.</span><span class="ident" id="6815243">Errorf</span><span class="op" id="6815249">(</span><span class="string" id="6815250">&#34;encodings&nbsp;differ&nbsp;at&nbsp;%#q&nbsp;vs&nbsp;%#q&#34;</span><span class="op" id="6815282">,</span>&nbsp;<span class="ident" id="6815284">enc</span><span class="op" id="6815287">,</span>&nbsp;<span class="ident" id="6815289">encBytes</span><span class="op" id="6815297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6815300">}</span><br>
<span class="lineno">420</span><span class="op" id="6815302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6815305">func</span>&nbsp;<span class="ident" id="6815310">TestIssue6458</span><span class="op" id="6815323">(</span><span class="ident" id="6815324">t</span>&nbsp;<span class="op" id="6815326">*</span><span class="ident" id="6815327">testing</span><span class="op" id="6815334">.</span><span class="ident" id="6815335">T</span><span class="op" id="6815336">)</span>&nbsp;<span class="op" id="6815338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6815341">type</span>&nbsp;<span class="ident" id="6815346">Foo</span>&nbsp;<span class="keyword" id="6815350">struct</span>&nbsp;<span class="op" id="6815357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6815361">M</span>&nbsp;<span class="ident" id="6815363">RawMessage</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6815375">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6815378">x</span>&nbsp;<span class="op" id="6815380">:=</span>&nbsp;<span class="ident" id="6815383">Foo</span><span class="op" id="6815386">{</span><span class="ident" id="6815387">RawMessage</span><span class="op" id="6815397">(</span><span class="string" id="6815398">`&#34;foo&#34;`</span><span class="op" id="6815405">)</span><span class="op" id="6815406">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6815410">b</span><span class="op" id="6815411">,</span>&nbsp;<span class="ident" id="6815413">err</span>&nbsp;<span class="op" id="6815417">:=</span>&nbsp;<span class="ident" id="6815420">Marshal</span><span class="op" id="6815427">(</span><span class="op" id="6815428">&amp;</span><span class="ident" id="6815429">x</span><span class="op" id="6815430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6815433">if</span>&nbsp;<span class="ident" id="6815436">err</span>&nbsp;<span class="op" id="6815440">!=</span>&nbsp;<span class="ident" id="6815443">nil</span>&nbsp;<span class="op" id="6815447">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6815451">t</span><span class="op" id="6815452">.</span><span class="ident" id="6815453">Fatal</span><span class="op" id="6815458">(</span><span class="ident" id="6815459">err</span><span class="op" id="6815462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6815465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6815468">if</span>&nbsp;<span class="ident" id="6815471">want</span>&nbsp;<span class="op" id="6815476">:=</span>&nbsp;<span class="string" id="6815479">`{&#34;M&#34;:&#34;foo&#34;}`</span><span class="op" id="6815492">;</span>&nbsp;<span class="builtintype" id="6815494">string</span><span class="op" id="6815500">(</span><span class="ident" id="6815501">b</span><span class="op" id="6815502">)</span>&nbsp;<span class="op" id="6815504">!=</span>&nbsp;<span class="ident" id="6815507">want</span>&nbsp;<span class="op" id="6815512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6815516">t</span><span class="op" id="6815517">.</span><span class="ident" id="6815518">Errorf</span><span class="op" id="6815524">(</span><span class="string" id="6815525">&#34;Marshal(&amp;x)&nbsp;=&nbsp;%#q;&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="6815554">,</span>&nbsp;<span class="ident" id="6815556">b</span><span class="op" id="6815557">,</span>&nbsp;<span class="ident" id="6815559">want</span><span class="op" id="6815563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6815566">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6815570">b</span><span class="op" id="6815571">,</span>&nbsp;<span class="ident" id="6815573">err</span>&nbsp;<span class="op" id="6815577">=</span>&nbsp;<span class="ident" id="6815579">Marshal</span><span class="op" id="6815586">(</span><span class="ident" id="6815587">x</span><span class="op" id="6815588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6815591">if</span>&nbsp;<span class="ident" id="6815594">err</span>&nbsp;<span class="op" id="6815598">!=</span>&nbsp;<span class="ident" id="6815601">nil</span>&nbsp;<span class="op" id="6815605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6815609">t</span><span class="op" id="6815610">.</span><span class="ident" id="6815611">Fatal</span><span class="op" id="6815616">(</span><span class="ident" id="6815617">err</span><span class="op" id="6815620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6815623">}</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6815627">if</span>&nbsp;<span class="ident" id="6815630">want</span>&nbsp;<span class="op" id="6815635">:=</span>&nbsp;<span class="string" id="6815638">`{&#34;M&#34;:&#34;ImZvbyI=&#34;}`</span><span class="op" id="6815656">;</span>&nbsp;<span class="builtintype" id="6815658">string</span><span class="op" id="6815664">(</span><span class="ident" id="6815665">b</span><span class="op" id="6815666">)</span>&nbsp;<span class="op" id="6815668">!=</span>&nbsp;<span class="ident" id="6815671">want</span>&nbsp;<span class="op" id="6815676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6815680">t</span><span class="op" id="6815681">.</span><span class="ident" id="6815682">Errorf</span><span class="op" id="6815688">(</span><span class="string" id="6815689">&#34;Marshal(x)&nbsp;=&nbsp;%#q;&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="6815717">,</span>&nbsp;<span class="ident" id="6815719">b</span><span class="op" id="6815720">,</span>&nbsp;<span class="ident" id="6815722">want</span><span class="op" id="6815726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6815729">}</span><br>
<span class="lineno"></span><span class="op" id="6815731">}</span><br>
<span class="lineno">445</span><br>
<span class="lineno"></span><span class="keyword" id="6815734">func</span>&nbsp;<span class="ident" id="6815739">TestHTMLEscape</span><span class="op" id="6815753">(</span><span class="ident" id="6815754">t</span>&nbsp;<span class="op" id="6815756">*</span><span class="ident" id="6815757">testing</span><span class="op" id="6815764">.</span><span class="ident" id="6815765">T</span><span class="op" id="6815766">)</span>&nbsp;<span class="op" id="6815768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6815771">var</span>&nbsp;<span class="ident" id="6815775">b</span><span class="op" id="6815776">,</span>&nbsp;<span class="ident" id="6815778">want</span>&nbsp;<span class="ident" id="6815783">bytes</span><span class="op" id="6815788">.</span><span class="ident" id="6815789">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6815797">m</span>&nbsp;<span class="op" id="6815799">:=</span>&nbsp;<span class="string" id="6815802">`{&#34;M&#34;:&#34;&lt;html&gt;foo&nbsp;&amp;`</span>&nbsp;<span class="op" id="6815822">+</span>&nbsp;<span class="string" id="6815824">&#34;\xe2\x80\xa8&nbsp;\xe2\x80\xa9&#34;</span>&nbsp;<span class="op" id="6815852">+</span>&nbsp;<span class="string" id="6815854">`&lt;/html&gt;&#34;}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6815867">want</span><span class="op" id="6815871">.</span><span class="ident" id="6815872">Write</span><span class="op" id="6815877">(</span><span class="op" id="6815878">[</span><span class="op" id="6815879">]</span><span class="builtintype" id="6815880">byte</span><span class="op" id="6815884">(</span><span class="string" id="6815885">`{&#34;M&#34;:&#34;\u003chtml\u003efoo&nbsp;\u0026\u2028&nbsp;\u2029\u003c/html\u003e&#34;}`</span><span class="op" id="6815951">)</span><span class="op" id="6815952">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6815955">HTMLEscape</span><span class="op" id="6815965">(</span><span class="op" id="6815966">&amp;</span><span class="ident" id="6815967">b</span><span class="op" id="6815968">,</span>&nbsp;<span class="op" id="6815970">[</span><span class="op" id="6815971">]</span><span class="builtintype" id="6815972">byte</span><span class="op" id="6815976">(</span><span class="ident" id="6815977">m</span><span class="op" id="6815978">)</span><span class="op" id="6815979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6815982">if</span>&nbsp;<span class="op" id="6815985">!</span><span class="ident" id="6815986">bytes</span><span class="op" id="6815991">.</span><span class="ident" id="6815992">Equal</span><span class="op" id="6815997">(</span><span class="ident" id="6815998">b</span><span class="op" id="6815999">.</span><span class="ident" id="6816000">Bytes</span><span class="op" id="6816005">(</span><span class="op" id="6816006">)</span><span class="op" id="6816007">,</span>&nbsp;<span class="ident" id="6816009">want</span><span class="op" id="6816013">.</span><span class="ident" id="6816014">Bytes</span><span class="op" id="6816019">(</span><span class="op" id="6816020">)</span><span class="op" id="6816021">)</span>&nbsp;<span class="op" id="6816023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6816027">t</span><span class="op" id="6816028">.</span><span class="ident" id="6816029">Errorf</span><span class="op" id="6816035">(</span><span class="string" id="6816036">&#34;HTMLEscape(&amp;b,&nbsp;[]byte(m))&nbsp;=&nbsp;%s;&nbsp;want&nbsp;%s&#34;</span><span class="op" id="6816077">,</span>&nbsp;<span class="ident" id="6816079">b</span><span class="op" id="6816080">.</span><span class="ident" id="6816081">Bytes</span><span class="op" id="6816086">(</span><span class="op" id="6816087">)</span><span class="op" id="6816088">,</span>&nbsp;<span class="ident" id="6816090">want</span><span class="op" id="6816094">.</span><span class="ident" id="6816095">Bytes</span><span class="op" id="6816100">(</span><span class="op" id="6816101">)</span><span class="op" id="6816102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6816105">}</span><br>
<span class="lineno"></span><span class="op" id="6816107">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="comment" id="6816110">//&nbsp;golang.org/issue/8582</span><br>
<span class="lineno"></span><span class="keyword" id="6816135">func</span>&nbsp;<span class="ident" id="6816140">TestEncodePointerString</span><span class="op" id="6816163">(</span><span class="ident" id="6816164">t</span>&nbsp;<span class="op" id="6816166">*</span><span class="ident" id="6816167">testing</span><span class="op" id="6816174">.</span><span class="ident" id="6816175">T</span><span class="op" id="6816176">)</span>&nbsp;<span class="op" id="6816178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6816181">type</span>&nbsp;<span class="ident" id="6816186">stringPointer</span>&nbsp;<span class="keyword" id="6816200">struct</span>&nbsp;<span class="op" id="6816207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6816211">N</span>&nbsp;<span class="op" id="6816213">*</span><span class="ident" id="6816214">int64</span>&nbsp;<span class="string" id="6816220">`json:&#34;n,string&#34;`</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6816239">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6816242">var</span>&nbsp;<span class="ident" id="6816246">n</span>&nbsp;<span class="ident" id="6816248">int64</span>&nbsp;<span class="op" id="6816254">=</span>&nbsp;<span class="num" id="6816256">42</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6816260">b</span><span class="op" id="6816261">,</span>&nbsp;<span class="ident" id="6816263">err</span>&nbsp;<span class="op" id="6816267">:=</span>&nbsp;<span class="ident" id="6816270">Marshal</span><span class="op" id="6816277">(</span><span class="ident" id="6816278">stringPointer</span><span class="op" id="6816291">{</span><span class="ident" id="6816292">N</span><span class="op" id="6816293">:</span>&nbsp;<span class="op" id="6816295">&amp;</span><span class="ident" id="6816296">n</span><span class="op" id="6816297">}</span><span class="op" id="6816298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6816301">if</span>&nbsp;<span class="ident" id="6816304">err</span>&nbsp;<span class="op" id="6816308">!=</span>&nbsp;<span class="ident" id="6816311">nil</span>&nbsp;<span class="op" id="6816315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6816319">t</span><span class="op" id="6816320">.</span><span class="ident" id="6816321">Fatalf</span><span class="op" id="6816327">(</span><span class="string" id="6816328">&#34;Marshal:&nbsp;%v&#34;</span><span class="op" id="6816341">,</span>&nbsp;<span class="ident" id="6816343">err</span><span class="op" id="6816346">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6816349">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6816352">if</span>&nbsp;<span class="ident" id="6816355">got</span><span class="op" id="6816358">,</span>&nbsp;<span class="ident" id="6816360">want</span>&nbsp;<span class="op" id="6816365">:=</span>&nbsp;<span class="builtintype" id="6816368">string</span><span class="op" id="6816374">(</span><span class="ident" id="6816375">b</span><span class="op" id="6816376">)</span><span class="op" id="6816377">,</span>&nbsp;<span class="string" id="6816379">`{&#34;n&#34;:&#34;42&#34;}`</span><span class="op" id="6816391">;</span>&nbsp;<span class="ident" id="6816393">got</span>&nbsp;<span class="op" id="6816397">!=</span>&nbsp;<span class="ident" id="6816400">want</span>&nbsp;<span class="op" id="6816405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6816409">t</span><span class="op" id="6816410">.</span><span class="ident" id="6816411">Errorf</span><span class="op" id="6816417">(</span><span class="string" id="6816418">&#34;Marshal&nbsp;=&nbsp;%s,&nbsp;want&nbsp;%s&#34;</span><span class="op" id="6816441">,</span>&nbsp;<span class="ident" id="6816443">got</span><span class="op" id="6816446">,</span>&nbsp;<span class="ident" id="6816448">want</span><span class="op" id="6816452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6816455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6816458">var</span>&nbsp;<span class="ident" id="6816462">back</span>&nbsp;<span class="ident" id="6816467">stringPointer</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6816482">err</span>&nbsp;<span class="op" id="6816486">=</span>&nbsp;<span class="ident" id="6816488">Unmarshal</span><span class="op" id="6816497">(</span><span class="ident" id="6816498">b</span><span class="op" id="6816499">,</span>&nbsp;<span class="op" id="6816501">&amp;</span><span class="ident" id="6816502">back</span><span class="op" id="6816506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6816509">if</span>&nbsp;<span class="ident" id="6816512">err</span>&nbsp;<span class="op" id="6816516">!=</span>&nbsp;<span class="ident" id="6816519">nil</span>&nbsp;<span class="op" id="6816523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6816527">t</span><span class="op" id="6816528">.</span><span class="ident" id="6816529">Fatalf</span><span class="op" id="6816535">(</span><span class="string" id="6816536">&#34;Unmarshal:&nbsp;%v&#34;</span><span class="op" id="6816551">,</span>&nbsp;<span class="ident" id="6816553">err</span><span class="op" id="6816556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6816559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6816562">if</span>&nbsp;<span class="ident" id="6816565">back</span><span class="op" id="6816569">.</span><span class="ident" id="6816570">N</span>&nbsp;<span class="op" id="6816572">==</span>&nbsp;<span class="ident" id="6816575">nil</span>&nbsp;<span class="op" id="6816579">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6816583">t</span><span class="op" id="6816584">.</span><span class="ident" id="6816585">Fatalf</span><span class="op" id="6816591">(</span><span class="string" id="6816592">&#34;Unmarshalled&nbsp;nil&nbsp;N&nbsp;field&#34;</span><span class="op" id="6816618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6816621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6816624">if</span>&nbsp;<span class="op" id="6816627">*</span><span class="ident" id="6816628">back</span><span class="op" id="6816632">.</span><span class="ident" id="6816633">N</span>&nbsp;<span class="op" id="6816635">!=</span>&nbsp;<span class="num" id="6816638">42</span>&nbsp;<span class="op" id="6816641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6816645">t</span><span class="op" id="6816646">.</span><span class="ident" id="6816647">Fatalf</span><span class="op" id="6816653">(</span><span class="string" id="6816654">&#34;*N&nbsp;=&nbsp;%d;&nbsp;want&nbsp;42&#34;</span><span class="op" id="6816672">,</span>&nbsp;<span class="op" id="6816674">*</span><span class="ident" id="6816675">back</span><span class="op" id="6816679">.</span><span class="ident" id="6816680">N</span><span class="op" id="6816681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6816684">}</span><br>
<span class="lineno">480</span><span class="op" id="6816686">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6816689">var</span>&nbsp;<span class="ident" id="6816693">encodeStringTests</span>&nbsp;<span class="op" id="6816711">=</span>&nbsp;<span class="op" id="6816713">[</span><span class="op" id="6816714">]</span><span class="keyword" id="6816715">struct</span>&nbsp;<span class="op" id="6816722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6816725">in</span>&nbsp;&nbsp;<span class="builtintype" id="6816729">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6816737">out</span>&nbsp;<span class="builtintype" id="6816741">string</span><br>
<span class="lineno">485</span><span class="op" id="6816748">}</span><span class="op" id="6816749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6816752">{</span><span class="string" id="6816753">&#34;\x00&#34;</span><span class="op" id="6816759">,</span>&nbsp;<span class="string" id="6816761">`&#34;\u0000&#34;`</span><span class="op" id="6816771">}</span><span class="op" id="6816772">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6816775">{</span><span class="string" id="6816776">&#34;\x01&#34;</span><span class="op" id="6816782">,</span>&nbsp;<span class="string" id="6816784">`&#34;\u0001&#34;`</span><span class="op" id="6816794">}</span><span class="op" id="6816795">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6816798">{</span><span class="string" id="6816799">&#34;\x02&#34;</span><span class="op" id="6816805">,</span>&nbsp;<span class="string" id="6816807">`&#34;\u0002&#34;`</span><span class="op" id="6816817">}</span><span class="op" id="6816818">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6816821">{</span><span class="string" id="6816822">&#34;\x03&#34;</span><span class="op" id="6816828">,</span>&nbsp;<span class="string" id="6816830">`&#34;\u0003&#34;`</span><span class="op" id="6816840">}</span><span class="op" id="6816841">,</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6816844">{</span><span class="string" id="6816845">&#34;\x04&#34;</span><span class="op" id="6816851">,</span>&nbsp;<span class="string" id="6816853">`&#34;\u0004&#34;`</span><span class="op" id="6816863">}</span><span class="op" id="6816864">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6816867">{</span><span class="string" id="6816868">&#34;\x05&#34;</span><span class="op" id="6816874">,</span>&nbsp;<span class="string" id="6816876">`&#34;\u0005&#34;`</span><span class="op" id="6816886">}</span><span class="op" id="6816887">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6816890">{</span><span class="string" id="6816891">&#34;\x06&#34;</span><span class="op" id="6816897">,</span>&nbsp;<span class="string" id="6816899">`&#34;\u0006&#34;`</span><span class="op" id="6816909">}</span><span class="op" id="6816910">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6816913">{</span><span class="string" id="6816914">&#34;\x07&#34;</span><span class="op" id="6816920">,</span>&nbsp;<span class="string" id="6816922">`&#34;\u0007&#34;`</span><span class="op" id="6816932">}</span><span class="op" id="6816933">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6816936">{</span><span class="string" id="6816937">&#34;\x08&#34;</span><span class="op" id="6816943">,</span>&nbsp;<span class="string" id="6816945">`&#34;\u0008&#34;`</span><span class="op" id="6816955">}</span><span class="op" id="6816956">,</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6816959">{</span><span class="string" id="6816960">&#34;\x09&#34;</span><span class="op" id="6816966">,</span>&nbsp;<span class="string" id="6816968">`&#34;\t&#34;`</span><span class="op" id="6816974">}</span><span class="op" id="6816975">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6816978">{</span><span class="string" id="6816979">&#34;\x0a&#34;</span><span class="op" id="6816985">,</span>&nbsp;<span class="string" id="6816987">`&#34;\n&#34;`</span><span class="op" id="6816993">}</span><span class="op" id="6816994">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6816997">{</span><span class="string" id="6816998">&#34;\x0b&#34;</span><span class="op" id="6817004">,</span>&nbsp;<span class="string" id="6817006">`&#34;\u000b&#34;`</span><span class="op" id="6817016">}</span><span class="op" id="6817017">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6817020">{</span><span class="string" id="6817021">&#34;\x0c&#34;</span><span class="op" id="6817027">,</span>&nbsp;<span class="string" id="6817029">`&#34;\u000c&#34;`</span><span class="op" id="6817039">}</span><span class="op" id="6817040">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6817043">{</span><span class="string" id="6817044">&#34;\x0d&#34;</span><span class="op" id="6817050">,</span>&nbsp;<span class="string" id="6817052">`&#34;\r&#34;`</span><span class="op" id="6817058">}</span><span class="op" id="6817059">,</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6817062">{</span><span class="string" id="6817063">&#34;\x0e&#34;</span><span class="op" id="6817069">,</span>&nbsp;<span class="string" id="6817071">`&#34;\u000e&#34;`</span><span class="op" id="6817081">}</span><span class="op" id="6817082">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6817085">{</span><span class="string" id="6817086">&#34;\x0f&#34;</span><span class="op" id="6817092">,</span>&nbsp;<span class="string" id="6817094">`&#34;\u000f&#34;`</span><span class="op" id="6817104">}</span><span class="op" id="6817105">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6817108">{</span><span class="string" id="6817109">&#34;\x10&#34;</span><span class="op" id="6817115">,</span>&nbsp;<span class="string" id="6817117">`&#34;\u0010&#34;`</span><span class="op" id="6817127">}</span><span class="op" id="6817128">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6817131">{</span><span class="string" id="6817132">&#34;\x11&#34;</span><span class="op" id="6817138">,</span>&nbsp;<span class="string" id="6817140">`&#34;\u0011&#34;`</span><span class="op" id="6817150">}</span><span class="op" id="6817151">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6817154">{</span><span class="string" id="6817155">&#34;\x12&#34;</span><span class="op" id="6817161">,</span>&nbsp;<span class="string" id="6817163">`&#34;\u0012&#34;`</span><span class="op" id="6817173">}</span><span class="op" id="6817174">,</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6817177">{</span><span class="string" id="6817178">&#34;\x13&#34;</span><span class="op" id="6817184">,</span>&nbsp;<span class="string" id="6817186">`&#34;\u0013&#34;`</span><span class="op" id="6817196">}</span><span class="op" id="6817197">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6817200">{</span><span class="string" id="6817201">&#34;\x14&#34;</span><span class="op" id="6817207">,</span>&nbsp;<span class="string" id="6817209">`&#34;\u0014&#34;`</span><span class="op" id="6817219">}</span><span class="op" id="6817220">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6817223">{</span><span class="string" id="6817224">&#34;\x15&#34;</span><span class="op" id="6817230">,</span>&nbsp;<span class="string" id="6817232">`&#34;\u0015&#34;`</span><span class="op" id="6817242">}</span><span class="op" id="6817243">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6817246">{</span><span class="string" id="6817247">&#34;\x16&#34;</span><span class="op" id="6817253">,</span>&nbsp;<span class="string" id="6817255">`&#34;\u0016&#34;`</span><span class="op" id="6817265">}</span><span class="op" id="6817266">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6817269">{</span><span class="string" id="6817270">&#34;\x17&#34;</span><span class="op" id="6817276">,</span>&nbsp;<span class="string" id="6817278">`&#34;\u0017&#34;`</span><span class="op" id="6817288">}</span><span class="op" id="6817289">,</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6817292">{</span><span class="string" id="6817293">&#34;\x18&#34;</span><span class="op" id="6817299">,</span>&nbsp;<span class="string" id="6817301">`&#34;\u0018&#34;`</span><span class="op" id="6817311">}</span><span class="op" id="6817312">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6817315">{</span><span class="string" id="6817316">&#34;\x19&#34;</span><span class="op" id="6817322">,</span>&nbsp;<span class="string" id="6817324">`&#34;\u0019&#34;`</span><span class="op" id="6817334">}</span><span class="op" id="6817335">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6817338">{</span><span class="string" id="6817339">&#34;\x1a&#34;</span><span class="op" id="6817345">,</span>&nbsp;<span class="string" id="6817347">`&#34;\u001a&#34;`</span><span class="op" id="6817357">}</span><span class="op" id="6817358">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6817361">{</span><span class="string" id="6817362">&#34;\x1b&#34;</span><span class="op" id="6817368">,</span>&nbsp;<span class="string" id="6817370">`&#34;\u001b&#34;`</span><span class="op" id="6817380">}</span><span class="op" id="6817381">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6817384">{</span><span class="string" id="6817385">&#34;\x1c&#34;</span><span class="op" id="6817391">,</span>&nbsp;<span class="string" id="6817393">`&#34;\u001c&#34;`</span><span class="op" id="6817403">}</span><span class="op" id="6817404">,</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6817407">{</span><span class="string" id="6817408">&#34;\x1d&#34;</span><span class="op" id="6817414">,</span>&nbsp;<span class="string" id="6817416">`&#34;\u001d&#34;`</span><span class="op" id="6817426">}</span><span class="op" id="6817427">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6817430">{</span><span class="string" id="6817431">&#34;\x1e&#34;</span><span class="op" id="6817437">,</span>&nbsp;<span class="string" id="6817439">`&#34;\u001e&#34;`</span><span class="op" id="6817449">}</span><span class="op" id="6817450">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6817453">{</span><span class="string" id="6817454">&#34;\x1f&#34;</span><span class="op" id="6817460">,</span>&nbsp;<span class="string" id="6817462">`&#34;\u001f&#34;`</span><span class="op" id="6817472">}</span><span class="op" id="6817473">,</span><br>
<span class="lineno"></span><span class="op" id="6817475">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">520</span><span class="keyword" id="6817478">func</span>&nbsp;<span class="ident" id="6817483">TestEncodeString</span><span class="op" id="6817499">(</span><span class="ident" id="6817500">t</span>&nbsp;<span class="op" id="6817502">*</span><span class="ident" id="6817503">testing</span><span class="op" id="6817510">.</span><span class="ident" id="6817511">T</span><span class="op" id="6817512">)</span>&nbsp;<span class="op" id="6817514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6817517">for</span>&nbsp;<span class="ident" id="6817521">_</span><span class="op" id="6817522">,</span>&nbsp;<span class="ident" id="6817524">tt</span>&nbsp;<span class="op" id="6817527">:=</span>&nbsp;<span class="keyword" id="6817530">range</span>&nbsp;<span class="ident" id="6817536">encodeStringTests</span>&nbsp;<span class="op" id="6817554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6817558">b</span><span class="op" id="6817559">,</span>&nbsp;<span class="ident" id="6817561">err</span>&nbsp;<span class="op" id="6817565">:=</span>&nbsp;<span class="ident" id="6817568">Marshal</span><span class="op" id="6817575">(</span><span class="ident" id="6817576">tt</span><span class="op" id="6817578">.</span><span class="ident" id="6817579">in</span><span class="op" id="6817581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6817585">if</span>&nbsp;<span class="ident" id="6817588">err</span>&nbsp;<span class="op" id="6817592">!=</span>&nbsp;<span class="ident" id="6817595">nil</span>&nbsp;<span class="op" id="6817599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6817604">t</span><span class="op" id="6817605">.</span><span class="ident" id="6817606">Errorf</span><span class="op" id="6817612">(</span><span class="string" id="6817613">&#34;Marshal(%q):&nbsp;%v&#34;</span><span class="op" id="6817630">,</span>&nbsp;<span class="ident" id="6817632">tt</span><span class="op" id="6817634">.</span><span class="ident" id="6817635">in</span><span class="op" id="6817637">,</span>&nbsp;<span class="ident" id="6817639">err</span><span class="op" id="6817642">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6817647">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6817658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6817662">out</span>&nbsp;<span class="op" id="6817666">:=</span>&nbsp;<span class="builtintype" id="6817669">string</span><span class="op" id="6817675">(</span><span class="ident" id="6817676">b</span><span class="op" id="6817677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6817681">if</span>&nbsp;<span class="ident" id="6817684">out</span>&nbsp;<span class="op" id="6817688">!=</span>&nbsp;<span class="ident" id="6817691">tt</span><span class="op" id="6817693">.</span><span class="ident" id="6817694">out</span>&nbsp;<span class="op" id="6817698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6817703">t</span><span class="op" id="6817704">.</span><span class="ident" id="6817705">Errorf</span><span class="op" id="6817711">(</span><span class="string" id="6817712">&#34;Marshal(%q)&nbsp;=&nbsp;%#q,&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="6817741">,</span>&nbsp;<span class="ident" id="6817743">tt</span><span class="op" id="6817745">.</span><span class="ident" id="6817746">in</span><span class="op" id="6817748">,</span>&nbsp;<span class="ident" id="6817750">out</span><span class="op" id="6817753">,</span>&nbsp;<span class="ident" id="6817755">tt</span><span class="op" id="6817757">.</span><span class="ident" id="6817758">out</span><span class="op" id="6817761">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6817765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6817768">}</span><br>
<span class="lineno"></span><span class="op" id="6817770">}</span>
</div>
</body>
</html>
