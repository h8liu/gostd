<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/hmac</h2>
<ul>
<li><a href="/gostd/crypto/hmac/hmac.go.html">hmac.go</a></li>
<li><a href="/gostd/crypto/hmac/hmac_test.go.html">hmac_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3782440">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3782495">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3782549">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3782600">/*<br>
<span class="lineno"></span>Package&nbsp;hmac&nbsp;implements&nbsp;the&nbsp;Keyed-Hash&nbsp;Message&nbsp;Authentication&nbsp;Code&nbsp;(HMAC)&nbsp;as<br>
<span class="lineno"></span>defined&nbsp;in&nbsp;U.S.&nbsp;Federal&nbsp;Information&nbsp;Processing&nbsp;Standards&nbsp;Publication&nbsp;198.<br>
<span class="lineno"></span>An&nbsp;HMAC&nbsp;is&nbsp;a&nbsp;cryptographic&nbsp;hash&nbsp;that&nbsp;uses&nbsp;a&nbsp;key&nbsp;to&nbsp;sign&nbsp;a&nbsp;message.<br>
<span class="lineno"></span>The&nbsp;receiver&nbsp;verifies&nbsp;the&nbsp;hash&nbsp;by&nbsp;recomputing&nbsp;it&nbsp;using&nbsp;the&nbsp;same&nbsp;key.<br>
<span class="lineno">10</span><br>
<span class="lineno"></span>Receivers&nbsp;should&nbsp;be&nbsp;careful&nbsp;to&nbsp;use&nbsp;Equal&nbsp;to&nbsp;compare&nbsp;MACs&nbsp;in&nbsp;order&nbsp;to&nbsp;avoid<br>
<span class="lineno"></span>timing&nbsp;side-channels:<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;CheckMAC&nbsp;returns&nbsp;true&nbsp;if&nbsp;messageMAC&nbsp;is&nbsp;a&nbsp;valid&nbsp;HMAC&nbsp;tag&nbsp;for&nbsp;message.<br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbspfunc&nbsp;CheckMAC(message,&nbsp;messageMAC,&nbsp;key&nbsp;[]byte)&nbsp;bool&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspmac&nbsp;:=&nbsp;hmac.New(sha256.New,&nbsp;key)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspmac.Write(message)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspexpectedMAC&nbsp;:=&nbsp;mac.Sum(nil)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;hmac.Equal(messageMAC,&nbsp;expectedMAC)<br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp}<br>
<span class="lineno"></span>*/</span><br>
<span class="lineno"></span><span class="keyword" id="3783254">package</span>&nbsp;<span class="ident" id="3783262">hmac</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3783268">import</span>&nbsp;<span class="op" id="3783275">(</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3783278">&#34;crypto/subtle&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3783295">&#34;hash&#34;</span><br>
<span class="lineno"></span><span class="op" id="3783302">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3783305">//&nbsp;FIPS&nbsp;198:</span><br>
<span class="lineno">30</span><span class="comment" id="3783318">//&nbsp;http://csrc.nist.gov/publications/fips/fips198/fips-198a.pdf</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3783383">//&nbsp;key&nbsp;is&nbsp;zero&nbsp;padded&nbsp;to&nbsp;the&nbsp;block&nbsp;size&nbsp;of&nbsp;the&nbsp;hash&nbsp;function</span><br>
<span class="lineno"></span><span class="comment" id="3783444">//&nbsp;ipad&nbsp;=&nbsp;0x36&nbsp;byte&nbsp;repeated&nbsp;for&nbsp;key&nbsp;length</span><br>
<span class="lineno"></span><span class="comment" id="3783488">//&nbsp;opad&nbsp;=&nbsp;0x5c&nbsp;byte&nbsp;repeated&nbsp;for&nbsp;key&nbsp;length</span><br>
<span class="lineno">35</span><span class="comment" id="3783532">//&nbsp;hmac&nbsp;=&nbsp;H([key&nbsp;^&nbsp;opad]&nbsp;H([key&nbsp;^&nbsp;ipad]&nbsp;text))</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3783580">type</span>&nbsp;<span class="ident" id="3783585">hmac</span>&nbsp;<span class="keyword" id="3783590">struct</span>&nbsp;<span class="op" id="3783597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3783600">size</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3783613">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3783618">blocksize</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3783631">int</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3783636">key</span><span class="op" id="3783639">,</span>&nbsp;<span class="ident" id="3783641">tmp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3783649">[</span><span class="op" id="3783650">]</span><span class="builtintype" id="3783651">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3783657">outer</span><span class="op" id="3783662">,</span>&nbsp;<span class="ident" id="3783664">inner</span>&nbsp;<span class="ident" id="3783670">hash</span><span class="op" id="3783674">.</span><span class="ident" id="3783675">Hash</span><br>
<span class="lineno"></span><span class="op" id="3783680">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3783683">func</span>&nbsp;<span class="op" id="3783688">(</span><span class="ident" id="3783689">h</span>&nbsp;<span class="op" id="3783691">*</span><span class="ident" id="3783692">hmac</span><span class="op" id="3783696">)</span>&nbsp;<span class="ident" id="3783698">tmpPad</span><span class="op" id="3783704">(</span><span class="ident" id="3783705">xor</span>&nbsp;<span class="builtintype" id="3783709">byte</span><span class="op" id="3783713">)</span>&nbsp;<span class="op" id="3783715">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3783718">for</span>&nbsp;<span class="ident" id="3783722">i</span><span class="op" id="3783723">,</span>&nbsp;<span class="ident" id="3783725">k</span>&nbsp;<span class="op" id="3783727">:=</span>&nbsp;<span class="keyword" id="3783730">range</span>&nbsp;<span class="ident" id="3783736">h</span><span class="op" id="3783737">.</span><span class="ident" id="3783738">key</span>&nbsp;<span class="op" id="3783742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3783746">h</span><span class="op" id="3783747">.</span><span class="ident" id="3783748">tmp</span><span class="op" id="3783751">[</span><span class="ident" id="3783752">i</span><span class="op" id="3783753">]</span>&nbsp;<span class="op" id="3783755">=</span>&nbsp;<span class="ident" id="3783757">xor</span>&nbsp;<span class="op" id="3783761">^</span>&nbsp;<span class="ident" id="3783763">k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3783766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3783769">for</span>&nbsp;<span class="ident" id="3783773">i</span>&nbsp;<span class="op" id="3783775">:=</span>&nbsp;<span class="builtinfunc" id="3783778">len</span><span class="op" id="3783781">(</span><span class="ident" id="3783782">h</span><span class="op" id="3783783">.</span><span class="ident" id="3783784">key</span><span class="op" id="3783787">)</span><span class="op" id="3783788">;</span>&nbsp;<span class="ident" id="3783790">i</span>&nbsp;<span class="op" id="3783792">&lt;</span>&nbsp;<span class="ident" id="3783794">h</span><span class="op" id="3783795">.</span><span class="ident" id="3783796">blocksize</span><span class="op" id="3783805">;</span>&nbsp;<span class="ident" id="3783807">i</span><span class="op" id="3783808">++</span>&nbsp;<span class="op" id="3783811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3783815">h</span><span class="op" id="3783816">.</span><span class="ident" id="3783817">tmp</span><span class="op" id="3783820">[</span><span class="ident" id="3783821">i</span><span class="op" id="3783822">]</span>&nbsp;<span class="op" id="3783824">=</span>&nbsp;<span class="ident" id="3783826">xor</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3783831">}</span><br>
<span class="lineno"></span><span class="op" id="3783833">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3783836">func</span>&nbsp;<span class="op" id="3783841">(</span><span class="ident" id="3783842">h</span>&nbsp;<span class="op" id="3783844">*</span><span class="ident" id="3783845">hmac</span><span class="op" id="3783849">)</span>&nbsp;<span class="ident" id="3783851">Sum</span><span class="op" id="3783854">(</span><span class="ident" id="3783855">in</span>&nbsp;<span class="op" id="3783858">[</span><span class="op" id="3783859">]</span><span class="builtintype" id="3783860">byte</span><span class="op" id="3783864">)</span>&nbsp;<span class="op" id="3783866">[</span><span class="op" id="3783867">]</span><span class="builtintype" id="3783868">byte</span>&nbsp;<span class="op" id="3783873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3783876">origLen</span>&nbsp;<span class="op" id="3783884">:=</span>&nbsp;<span class="builtinfunc" id="3783887">len</span><span class="op" id="3783890">(</span><span class="ident" id="3783891">in</span><span class="op" id="3783893">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3783896">in</span>&nbsp;<span class="op" id="3783899">=</span>&nbsp;<span class="ident" id="3783901">h</span><span class="op" id="3783902">.</span><span class="ident" id="3783903">inner</span><span class="op" id="3783908">.</span><span class="ident" id="3783909">Sum</span><span class="op" id="3783912">(</span><span class="ident" id="3783913">in</span><span class="op" id="3783915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3783918">h</span><span class="op" id="3783919">.</span><span class="ident" id="3783920">tmpPad</span><span class="op" id="3783926">(</span><span class="num" id="3783927">0x5c</span><span class="op" id="3783931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3783934">copy</span><span class="op" id="3783938">(</span><span class="ident" id="3783939">h</span><span class="op" id="3783940">.</span><span class="ident" id="3783941">tmp</span><span class="op" id="3783944">[</span><span class="ident" id="3783945">h</span><span class="op" id="3783946">.</span><span class="ident" id="3783947">blocksize</span><span class="op" id="3783956">:</span><span class="op" id="3783957">]</span><span class="op" id="3783958">,</span>&nbsp;<span class="ident" id="3783960">in</span><span class="op" id="3783962">[</span><span class="ident" id="3783963">origLen</span><span class="op" id="3783970">:</span><span class="op" id="3783971">]</span><span class="op" id="3783972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3783975">h</span><span class="op" id="3783976">.</span><span class="ident" id="3783977">outer</span><span class="op" id="3783982">.</span><span class="ident" id="3783983">Reset</span><span class="op" id="3783988">(</span><span class="op" id="3783989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3783992">h</span><span class="op" id="3783993">.</span><span class="ident" id="3783994">outer</span><span class="op" id="3783999">.</span><span class="ident" id="3784000">Write</span><span class="op" id="3784005">(</span><span class="ident" id="3784006">h</span><span class="op" id="3784007">.</span><span class="ident" id="3784008">tmp</span><span class="op" id="3784011">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3784014">return</span>&nbsp;<span class="ident" id="3784021">h</span><span class="op" id="3784022">.</span><span class="ident" id="3784023">outer</span><span class="op" id="3784028">.</span><span class="ident" id="3784029">Sum</span><span class="op" id="3784032">(</span><span class="ident" id="3784033">in</span><span class="op" id="3784035">[</span><span class="op" id="3784036">:</span><span class="ident" id="3784037">origLen</span><span class="op" id="3784044">]</span><span class="op" id="3784045">)</span><br>
<span class="lineno"></span><span class="op" id="3784047">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3784050">func</span>&nbsp;<span class="op" id="3784055">(</span><span class="ident" id="3784056">h</span>&nbsp;<span class="op" id="3784058">*</span><span class="ident" id="3784059">hmac</span><span class="op" id="3784063">)</span>&nbsp;<span class="ident" id="3784065">Write</span><span class="op" id="3784070">(</span><span class="ident" id="3784071">p</span>&nbsp;<span class="op" id="3784073">[</span><span class="op" id="3784074">]</span><span class="builtintype" id="3784075">byte</span><span class="op" id="3784079">)</span>&nbsp;<span class="op" id="3784081">(</span><span class="ident" id="3784082">n</span>&nbsp;<span class="builtintype" id="3784084">int</span><span class="op" id="3784087">,</span>&nbsp;<span class="ident" id="3784089">err</span>&nbsp;<span class="builtintype" id="3784093">error</span><span class="op" id="3784098">)</span>&nbsp;<span class="op" id="3784100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3784103">return</span>&nbsp;<span class="ident" id="3784110">h</span><span class="op" id="3784111">.</span><span class="ident" id="3784112">inner</span><span class="op" id="3784117">.</span><span class="ident" id="3784118">Write</span><span class="op" id="3784123">(</span><span class="ident" id="3784124">p</span><span class="op" id="3784125">)</span><br>
<span class="lineno">65</span><span class="op" id="3784127">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3784130">func</span>&nbsp;<span class="op" id="3784135">(</span><span class="ident" id="3784136">h</span>&nbsp;<span class="op" id="3784138">*</span><span class="ident" id="3784139">hmac</span><span class="op" id="3784143">)</span>&nbsp;<span class="ident" id="3784145">Size</span><span class="op" id="3784149">(</span><span class="op" id="3784150">)</span>&nbsp;<span class="builtintype" id="3784152">int</span>&nbsp;<span class="op" id="3784156">{</span>&nbsp;<span class="keyword" id="3784158">return</span>&nbsp;<span class="ident" id="3784165">h</span><span class="op" id="3784166">.</span><span class="ident" id="3784167">size</span>&nbsp;<span class="op" id="3784172">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3784175">func</span>&nbsp;<span class="op" id="3784180">(</span><span class="ident" id="3784181">h</span>&nbsp;<span class="op" id="3784183">*</span><span class="ident" id="3784184">hmac</span><span class="op" id="3784188">)</span>&nbsp;<span class="ident" id="3784190">BlockSize</span><span class="op" id="3784199">(</span><span class="op" id="3784200">)</span>&nbsp;<span class="builtintype" id="3784202">int</span>&nbsp;<span class="op" id="3784206">{</span>&nbsp;<span class="keyword" id="3784208">return</span>&nbsp;<span class="ident" id="3784215">h</span><span class="op" id="3784216">.</span><span class="ident" id="3784217">blocksize</span>&nbsp;<span class="op" id="3784227">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="3784230">func</span>&nbsp;<span class="op" id="3784235">(</span><span class="ident" id="3784236">h</span>&nbsp;<span class="op" id="3784238">*</span><span class="ident" id="3784239">hmac</span><span class="op" id="3784243">)</span>&nbsp;<span class="ident" id="3784245">Reset</span><span class="op" id="3784250">(</span><span class="op" id="3784251">)</span>&nbsp;<span class="op" id="3784253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3784256">h</span><span class="op" id="3784257">.</span><span class="ident" id="3784258">inner</span><span class="op" id="3784263">.</span><span class="ident" id="3784264">Reset</span><span class="op" id="3784269">(</span><span class="op" id="3784270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3784273">h</span><span class="op" id="3784274">.</span><span class="ident" id="3784275">tmpPad</span><span class="op" id="3784281">(</span><span class="num" id="3784282">0x36</span><span class="op" id="3784286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3784289">h</span><span class="op" id="3784290">.</span><span class="ident" id="3784291">inner</span><span class="op" id="3784296">.</span><span class="ident" id="3784297">Write</span><span class="op" id="3784302">(</span><span class="ident" id="3784303">h</span><span class="op" id="3784304">.</span><span class="ident" id="3784305">tmp</span><span class="op" id="3784308">[</span><span class="op" id="3784309">:</span><span class="ident" id="3784310">h</span><span class="op" id="3784311">.</span><span class="ident" id="3784312">blocksize</span><span class="op" id="3784321">]</span><span class="op" id="3784322">)</span><br>
<span class="lineno">75</span><span class="op" id="3784324">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3784327">//&nbsp;New&nbsp;returns&nbsp;a&nbsp;new&nbsp;HMAC&nbsp;hash&nbsp;using&nbsp;the&nbsp;given&nbsp;hash.Hash&nbsp;type&nbsp;and&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="3784398">func</span>&nbsp;<span class="ident" id="3784403">New</span><span class="op" id="3784406">(</span><span class="ident" id="3784407">h</span>&nbsp;<span class="keyword" id="3784409">func</span><span class="op" id="3784413">(</span><span class="op" id="3784414">)</span>&nbsp;<span class="ident" id="3784416">hash</span><span class="op" id="3784420">.</span><span class="ident" id="3784421">Hash</span><span class="op" id="3784425">,</span>&nbsp;<span class="ident" id="3784427">key</span>&nbsp;<span class="op" id="3784431">[</span><span class="op" id="3784432">]</span><span class="builtintype" id="3784433">byte</span><span class="op" id="3784437">)</span>&nbsp;<span class="ident" id="3784439">hash</span><span class="op" id="3784443">.</span><span class="ident" id="3784444">Hash</span>&nbsp;<span class="op" id="3784449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3784452">hm</span>&nbsp;<span class="op" id="3784455">:=</span>&nbsp;<span class="builtinfunc" id="3784458">new</span><span class="op" id="3784461">(</span><span class="ident" id="3784462">hmac</span><span class="op" id="3784466">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3784469">hm</span><span class="op" id="3784471">.</span><span class="ident" id="3784472">outer</span>&nbsp;<span class="op" id="3784478">=</span>&nbsp;<span class="ident" id="3784480">h</span><span class="op" id="3784481">(</span><span class="op" id="3784482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3784485">hm</span><span class="op" id="3784487">.</span><span class="ident" id="3784488">inner</span>&nbsp;<span class="op" id="3784494">=</span>&nbsp;<span class="ident" id="3784496">h</span><span class="op" id="3784497">(</span><span class="op" id="3784498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3784501">hm</span><span class="op" id="3784503">.</span><span class="ident" id="3784504">size</span>&nbsp;<span class="op" id="3784509">=</span>&nbsp;<span class="ident" id="3784511">hm</span><span class="op" id="3784513">.</span><span class="ident" id="3784514">inner</span><span class="op" id="3784519">.</span><span class="ident" id="3784520">Size</span><span class="op" id="3784524">(</span><span class="op" id="3784525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3784528">hm</span><span class="op" id="3784530">.</span><span class="ident" id="3784531">blocksize</span>&nbsp;<span class="op" id="3784541">=</span>&nbsp;<span class="ident" id="3784543">hm</span><span class="op" id="3784545">.</span><span class="ident" id="3784546">inner</span><span class="op" id="3784551">.</span><span class="ident" id="3784552">BlockSize</span><span class="op" id="3784561">(</span><span class="op" id="3784562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3784565">hm</span><span class="op" id="3784567">.</span><span class="ident" id="3784568">tmp</span>&nbsp;<span class="op" id="3784572">=</span>&nbsp;<span class="builtinfunc" id="3784574">make</span><span class="op" id="3784578">(</span><span class="op" id="3784579">[</span><span class="op" id="3784580">]</span><span class="builtintype" id="3784581">byte</span><span class="op" id="3784585">,</span>&nbsp;<span class="ident" id="3784587">hm</span><span class="op" id="3784589">.</span><span class="ident" id="3784590">blocksize</span><span class="op" id="3784599">+</span><span class="ident" id="3784600">hm</span><span class="op" id="3784602">.</span><span class="ident" id="3784603">size</span><span class="op" id="3784607">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3784610">if</span>&nbsp;<span class="builtinfunc" id="3784613">len</span><span class="op" id="3784616">(</span><span class="ident" id="3784617">key</span><span class="op" id="3784620">)</span>&nbsp;<span class="op" id="3784622">&gt;</span>&nbsp;<span class="ident" id="3784624">hm</span><span class="op" id="3784626">.</span><span class="ident" id="3784627">blocksize</span>&nbsp;<span class="op" id="3784637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3784641">//&nbsp;If&nbsp;key&nbsp;is&nbsp;too&nbsp;big,&nbsp;hash&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3784674">hm</span><span class="op" id="3784676">.</span><span class="ident" id="3784677">outer</span><span class="op" id="3784682">.</span><span class="ident" id="3784683">Write</span><span class="op" id="3784688">(</span><span class="ident" id="3784689">key</span><span class="op" id="3784692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3784696">key</span>&nbsp;<span class="op" id="3784700">=</span>&nbsp;<span class="ident" id="3784702">hm</span><span class="op" id="3784704">.</span><span class="ident" id="3784705">outer</span><span class="op" id="3784710">.</span><span class="ident" id="3784711">Sum</span><span class="op" id="3784714">(</span><span class="ident" id="3784715">nil</span><span class="op" id="3784718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3784721">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3784724">hm</span><span class="op" id="3784726">.</span><span class="ident" id="3784727">key</span>&nbsp;<span class="op" id="3784731">=</span>&nbsp;<span class="builtinfunc" id="3784733">make</span><span class="op" id="3784737">(</span><span class="op" id="3784738">[</span><span class="op" id="3784739">]</span><span class="builtintype" id="3784740">byte</span><span class="op" id="3784744">,</span>&nbsp;<span class="builtinfunc" id="3784746">len</span><span class="op" id="3784749">(</span><span class="ident" id="3784750">key</span><span class="op" id="3784753">)</span><span class="op" id="3784754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3784757">copy</span><span class="op" id="3784761">(</span><span class="ident" id="3784762">hm</span><span class="op" id="3784764">.</span><span class="ident" id="3784765">key</span><span class="op" id="3784768">,</span>&nbsp;<span class="ident" id="3784770">key</span><span class="op" id="3784773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3784776">hm</span><span class="op" id="3784778">.</span><span class="ident" id="3784779">Reset</span><span class="op" id="3784784">(</span><span class="op" id="3784785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3784788">return</span>&nbsp;<span class="ident" id="3784795">hm</span><br>
<span class="lineno"></span><span class="op" id="3784798">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="comment" id="3784801">//&nbsp;Equal&nbsp;compares&nbsp;two&nbsp;MACs&nbsp;for&nbsp;equality&nbsp;without&nbsp;leaking&nbsp;timing&nbsp;information.</span><br>
<span class="lineno"></span><span class="keyword" id="3784877">func</span>&nbsp;<span class="ident" id="3784882">Equal</span><span class="op" id="3784887">(</span><span class="ident" id="3784888">mac1</span><span class="op" id="3784892">,</span>&nbsp;<span class="ident" id="3784894">mac2</span>&nbsp;<span class="op" id="3784899">[</span><span class="op" id="3784900">]</span><span class="builtintype" id="3784901">byte</span><span class="op" id="3784905">)</span>&nbsp;<span class="builtintype" id="3784907">bool</span>&nbsp;<span class="op" id="3784912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3784915">//&nbsp;We&nbsp;don&#39;t&nbsp;have&nbsp;to&nbsp;be&nbsp;constant&nbsp;time&nbsp;if&nbsp;the&nbsp;lengths&nbsp;of&nbsp;the&nbsp;MACs&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3784984">//&nbsp;different&nbsp;as&nbsp;that&nbsp;suggests&nbsp;that&nbsp;a&nbsp;completely&nbsp;different&nbsp;hash&nbsp;function</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3785057">//&nbsp;was&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3785071">return</span>&nbsp;<span class="builtinfunc" id="3785078">len</span><span class="op" id="3785081">(</span><span class="ident" id="3785082">mac1</span><span class="op" id="3785086">)</span>&nbsp;<span class="op" id="3785088">==</span>&nbsp;<span class="builtinfunc" id="3785091">len</span><span class="op" id="3785094">(</span><span class="ident" id="3785095">mac2</span><span class="op" id="3785099">)</span>&nbsp;<span class="op" id="3785101">&amp;&amp;</span>&nbsp;<span class="ident" id="3785104">subtle</span><span class="op" id="3785110">.</span><span class="ident" id="3785111">ConstantTimeCompare</span><span class="op" id="3785130">(</span><span class="ident" id="3785131">mac1</span><span class="op" id="3785135">,</span>&nbsp;<span class="ident" id="3785137">mac2</span><span class="op" id="3785141">)</span>&nbsp;<span class="op" id="3785143">==</span>&nbsp;<span class="num" id="3785146">1</span><br>
<span class="lineno"></span><span class="op" id="3785148">}</span>
</div>
</body>
</html>
