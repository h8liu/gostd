<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="keyword" id="5053374">package</span>&nbsp;<span class="ident" id="5053382">arch8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5053389">//&nbsp;InstImm&nbsp;executes&nbsp;immediate&nbsp;instructions</span><br>
<span class="lineno"></span><span class="keyword" id="5053432">type</span>&nbsp;<span class="ident" id="5053437">instImm</span>&nbsp;<span class="keyword" id="5053445">struct</span><span class="op" id="5053451">{</span><span class="op" id="5053452">}</span><br>
<span class="lineno">5</span><br>
<span class="lineno"></span><span class="comment" id="5053455">//&nbsp;I&nbsp;executes&nbsp;the&nbsp;instruction.</span><br>
<span class="lineno"></span><span class="comment" id="5053486">//&nbsp;Might&nbsp;return&nbsp;invalid&nbsp;instruction&nbsp;exception,</span><br>
<span class="lineno"></span><span class="comment" id="5053533">//&nbsp;or&nbsp;memory&nbsp;related&nbsp;exceptions.</span><br>
<span class="lineno"></span><span class="keyword" id="5053566">func</span>&nbsp;<span class="op" id="5053571">(</span><span class="ident" id="5053572">i</span>&nbsp;<span class="op" id="5053574">*</span><span class="ident" id="5053575">instImm</span><span class="op" id="5053582">)</span>&nbsp;<span class="ident" id="5053584">I</span><span class="op" id="5053585">(</span><span class="ident" id="5053586">cpu</span>&nbsp;<span class="op" id="5053590">*</span><span class="ident" id="5053591">cpu</span><span class="op" id="5053594">,</span>&nbsp;<span class="ident" id="5053596">in</span>&nbsp;<span class="builtintype" id="5053599">uint32</span><span class="op" id="5053605">)</span>&nbsp;<span class="op" id="5053607">*</span><span class="ident" id="5053608">Excep</span>&nbsp;<span class="op" id="5053614">{</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5053617">op</span>&nbsp;<span class="op" id="5053620">:=</span>&nbsp;<span class="op" id="5053623">(</span><span class="ident" id="5053624">in</span>&nbsp;<span class="op" id="5053627">&gt;&gt;</span>&nbsp;<span class="num" id="5053630">24</span><span class="op" id="5053632">)</span>&nbsp;<span class="op" id="5053634">&amp;</span>&nbsp;<span class="num" id="5053636">0xff</span>&nbsp;&nbsp;<span class="comment" id="5053642">//&nbsp;(32:24]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5053654">dest</span>&nbsp;<span class="op" id="5053659">:=</span>&nbsp;<span class="op" id="5053662">(</span><span class="ident" id="5053663">in</span>&nbsp;<span class="op" id="5053666">&gt;&gt;</span>&nbsp;<span class="num" id="5053669">21</span><span class="op" id="5053671">)</span>&nbsp;<span class="op" id="5053673">&amp;</span>&nbsp;<span class="num" id="5053675">0x7</span>&nbsp;<span class="comment" id="5053679">//&nbsp;(24:21]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5053691">src</span>&nbsp;<span class="op" id="5053695">:=</span>&nbsp;<span class="op" id="5053698">(</span><span class="ident" id="5053699">in</span>&nbsp;<span class="op" id="5053702">&gt;&gt;</span>&nbsp;<span class="num" id="5053705">18</span><span class="op" id="5053707">)</span>&nbsp;<span class="op" id="5053709">&amp;</span>&nbsp;<span class="num" id="5053711">0x7</span>&nbsp;&nbsp;<span class="comment" id="5053716">//&nbsp;(21:18]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5053728">im</span>&nbsp;<span class="op" id="5053731">:=</span>&nbsp;<span class="ident" id="5053734">in</span>&nbsp;<span class="op" id="5053737">&amp;</span>&nbsp;<span class="num" id="5053739">0xffff</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5053753">//&nbsp;(16:0]</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5053765">s</span>&nbsp;<span class="op" id="5053767">:=</span>&nbsp;<span class="ident" id="5053770">cpu</span><span class="op" id="5053773">.</span><span class="ident" id="5053774">regs</span><span class="op" id="5053778">[</span><span class="ident" id="5053779">src</span><span class="op" id="5053782">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5053785">d</span>&nbsp;<span class="op" id="5053787">:=</span>&nbsp;<span class="ident" id="5053790">cpu</span><span class="op" id="5053793">.</span><span class="ident" id="5053794">regs</span><span class="op" id="5053798">[</span><span class="ident" id="5053799">dest</span><span class="op" id="5053803">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5053806">ims</span>&nbsp;<span class="op" id="5053810">:=</span>&nbsp;<span class="builtintype" id="5053813">uint32</span><span class="op" id="5053819">(</span><span class="builtintype" id="5053820">int32</span><span class="op" id="5053825">(</span><span class="ident" id="5053826">im</span><span class="op" id="5053828">&lt;&lt;</span><span class="num" id="5053830">16</span><span class="op" id="5053832">)</span>&nbsp;<span class="op" id="5053834">&gt;&gt;</span>&nbsp;<span class="num" id="5053837">16</span><span class="op" id="5053839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5053842">addr</span>&nbsp;<span class="op" id="5053847">:=</span>&nbsp;<span class="ident" id="5053850">s</span>&nbsp;<span class="op" id="5053852">+</span>&nbsp;<span class="ident" id="5053854">ims</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5053859">var</span>&nbsp;<span class="ident" id="5053863">e</span>&nbsp;<span class="op" id="5053865">*</span><span class="ident" id="5053866">Excep</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5053873">var</span>&nbsp;<span class="ident" id="5053877">b</span>&nbsp;<span class="builtintype" id="5053879">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5053886">switch</span>&nbsp;<span class="ident" id="5053893">op</span>&nbsp;<span class="op" id="5053896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5053899">case</span>&nbsp;<span class="num" id="5053904">0</span><span class="op" id="5053905">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5053909">panic</span><span class="op" id="5053914">(</span><span class="string" id="5053915">&#34;register&nbsp;based&nbsp;instruction&#34;</span><span class="op" id="5053943">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5053946">case</span>&nbsp;<span class="num" id="5053951">1</span><span class="op" id="5053952">:</span>&nbsp;<span class="comment" id="5053954">//&nbsp;addi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5053964">d</span>&nbsp;<span class="op" id="5053966">=</span>&nbsp;<span class="ident" id="5053968">s</span>&nbsp;<span class="op" id="5053970">+</span>&nbsp;<span class="ident" id="5053972">ims</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5053977">case</span>&nbsp;<span class="num" id="5053982">2</span><span class="op" id="5053983">:</span>&nbsp;<span class="comment" id="5053985">//&nbsp;slti</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5053995">if</span>&nbsp;<span class="builtintype" id="5053998">int32</span><span class="op" id="5054003">(</span><span class="ident" id="5054004">s</span><span class="op" id="5054005">)</span>&nbsp;<span class="op" id="5054007">&lt;</span>&nbsp;<span class="builtintype" id="5054009">int32</span><span class="op" id="5054014">(</span><span class="ident" id="5054015">ims</span><span class="op" id="5054018">)</span>&nbsp;<span class="op" id="5054020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5054025">d</span>&nbsp;<span class="op" id="5054027">=</span>&nbsp;<span class="num" id="5054029">1</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5054033">}</span>&nbsp;<span class="keyword" id="5054035">else</span>&nbsp;<span class="op" id="5054040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5054045">d</span>&nbsp;<span class="op" id="5054047">=</span>&nbsp;<span class="num" id="5054049">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5054053">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5054056">case</span>&nbsp;<span class="num" id="5054061">3</span><span class="op" id="5054062">:</span>&nbsp;<span class="comment" id="5054064">//&nbsp;andi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5054074">d</span>&nbsp;<span class="op" id="5054076">=</span>&nbsp;<span class="ident" id="5054078">s</span>&nbsp;<span class="op" id="5054080">&amp;</span>&nbsp;<span class="ident" id="5054082">im</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5054086">case</span>&nbsp;<span class="num" id="5054091">4</span><span class="op" id="5054092">:</span>&nbsp;<span class="comment" id="5054094">//&nbsp;ori</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5054103">d</span>&nbsp;<span class="op" id="5054105">=</span>&nbsp;<span class="ident" id="5054107">s</span>&nbsp;<span class="op" id="5054109">|</span>&nbsp;<span class="ident" id="5054111">im</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5054115">case</span>&nbsp;<span class="num" id="5054120">5</span><span class="op" id="5054121">:</span>&nbsp;<span class="comment" id="5054123">//&nbsp;lui</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5054132">d</span>&nbsp;<span class="op" id="5054134">=</span>&nbsp;<span class="ident" id="5054136">im</span>&nbsp;<span class="op" id="5054139">&lt;&lt;</span>&nbsp;<span class="num" id="5054142">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5054146">case</span>&nbsp;<span class="num" id="5054151">6</span><span class="op" id="5054152">:</span>&nbsp;<span class="comment" id="5054154">//&nbsp;lw</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5054162">d</span><span class="op" id="5054163">,</span>&nbsp;<span class="ident" id="5054165">e</span>&nbsp;<span class="op" id="5054167">=</span>&nbsp;<span class="ident" id="5054169">cpu</span><span class="op" id="5054172">.</span><span class="ident" id="5054173">readWord</span><span class="op" id="5054181">(</span><span class="ident" id="5054182">addr</span><span class="op" id="5054186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5054189">case</span>&nbsp;<span class="num" id="5054194">7</span><span class="op" id="5054195">:</span>&nbsp;<span class="comment" id="5054197">//&nbsp;lb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5054205">b</span><span class="op" id="5054206">,</span>&nbsp;<span class="ident" id="5054208">e</span>&nbsp;<span class="op" id="5054210">=</span>&nbsp;<span class="ident" id="5054212">cpu</span><span class="op" id="5054215">.</span><span class="ident" id="5054216">readByte</span><span class="op" id="5054224">(</span><span class="ident" id="5054225">addr</span><span class="op" id="5054229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5054233">d</span>&nbsp;<span class="op" id="5054235">=</span>&nbsp;<span class="builtintype" id="5054237">uint32</span><span class="op" id="5054243">(</span><span class="builtintype" id="5054244">int32</span><span class="op" id="5054249">(</span><span class="builtintype" id="5054250">int8</span><span class="op" id="5054254">(</span><span class="ident" id="5054255">b</span><span class="op" id="5054256">)</span><span class="op" id="5054257">)</span><span class="op" id="5054258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5054261">case</span>&nbsp;<span class="num" id="5054266">8</span><span class="op" id="5054267">:</span>&nbsp;<span class="comment" id="5054269">//&nbsp;lbu</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5054278">b</span><span class="op" id="5054279">,</span>&nbsp;<span class="ident" id="5054281">e</span>&nbsp;<span class="op" id="5054283">=</span>&nbsp;<span class="ident" id="5054285">cpu</span><span class="op" id="5054288">.</span><span class="ident" id="5054289">readByte</span><span class="op" id="5054297">(</span><span class="ident" id="5054298">addr</span><span class="op" id="5054302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5054306">d</span>&nbsp;<span class="op" id="5054308">=</span>&nbsp;<span class="builtintype" id="5054310">uint32</span><span class="op" id="5054316">(</span><span class="ident" id="5054317">b</span><span class="op" id="5054318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5054321">case</span>&nbsp;<span class="num" id="5054326">9</span><span class="op" id="5054327">:</span>&nbsp;<span class="comment" id="5054329">//&nbsp;sw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5054337">e</span>&nbsp;<span class="op" id="5054339">=</span>&nbsp;<span class="ident" id="5054341">cpu</span><span class="op" id="5054344">.</span><span class="ident" id="5054345">writeWord</span><span class="op" id="5054354">(</span><span class="ident" id="5054355">addr</span><span class="op" id="5054359">,</span>&nbsp;<span class="ident" id="5054361">d</span><span class="op" id="5054362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5054365">case</span>&nbsp;<span class="num" id="5054370">10</span><span class="op" id="5054372">:</span>&nbsp;<span class="comment" id="5054374">//&nbsp;sb</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5054382">e</span>&nbsp;<span class="op" id="5054384">=</span>&nbsp;<span class="ident" id="5054386">cpu</span><span class="op" id="5054389">.</span><span class="ident" id="5054390">writeByte</span><span class="op" id="5054399">(</span><span class="ident" id="5054400">addr</span><span class="op" id="5054404">,</span>&nbsp;<span class="builtintype" id="5054406">byte</span><span class="op" id="5054410">(</span><span class="ident" id="5054411">d</span><span class="op" id="5054412">)</span><span class="op" id="5054413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5054416">default</span><span class="op" id="5054423">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5054427">return</span>&nbsp;<span class="ident" id="5054434">errInvalidInst</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5054450">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5054454">if</span>&nbsp;<span class="ident" id="5054457">e</span>&nbsp;<span class="op" id="5054459">!=</span>&nbsp;<span class="ident" id="5054462">nil</span>&nbsp;<span class="op" id="5054466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5054470">return</span>&nbsp;<span class="ident" id="5054477">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5054480">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5054484">cpu</span><span class="op" id="5054487">.</span><span class="ident" id="5054488">regs</span><span class="op" id="5054492">[</span><span class="ident" id="5054493">dest</span><span class="op" id="5054497">]</span>&nbsp;<span class="op" id="5054499">=</span>&nbsp;<span class="ident" id="5054501">d</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5054504">return</span>&nbsp;<span class="ident" id="5054511">nil</span><br>
<span class="lineno"></span><span class="op" id="5054515">}</span>
</div>
</body>
</html>
