<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/cipher</h2>
<ul>
<li><a href="/gostd/crypto/cipher/benchmark_test.go.html">benchmark_test.go</a></li>
<li><a href="/gostd/crypto/cipher/cbc.go.html">cbc.go</a></li>
<li><a href="/gostd/crypto/cipher/cbc_aes_test.go.html">cbc_aes_test.go</a></li>
<li><a href="/gostd/crypto/cipher/cfb.go.html">cfb.go</a></li>
<li><a href="/gostd/crypto/cipher/cfb_test.go.html">cfb_test.go</a></li>
<li><a href="/gostd/crypto/cipher/cipher.go.html">cipher.go</a></li>
<li><a href="/gostd/crypto/cipher/cipher_test.go.html">cipher_test.go</a></li>
<li><a href="/gostd/crypto/cipher/common_test.go.html">common_test.go</a></li>
<li><a href="/gostd/crypto/cipher/ctr.go.html">ctr.go</a></li>
<li><a href="/gostd/crypto/cipher/ctr_aes_test.go.html">ctr_aes_test.go</a></li>
<li><a href="/gostd/crypto/cipher/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/cipher/gcm.go.html">gcm.go</a></li>
<li><a href="/gostd/crypto/cipher/gcm_test.go.html">gcm_test.go</a></li>
<li><a href="/gostd/crypto/cipher/io.go.html">io.go</a></li>
<li><a href="/gostd/crypto/cipher/ofb.go.html">ofb.go</a></li>
<li><a href="/gostd/crypto/cipher/ofb_test.go.html">ofb_test.go</a></li>
<li><a href="/gostd/crypto/cipher/xor.go.html">xor.go</a></li>
<li><a href="/gostd/crypto/cipher/xor_test.go.html">xor_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3924387">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3924442">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3924496">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3924547">package</span>&nbsp;<span class="ident" id="3924555">cipher</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3924563">import</span>&nbsp;<span class="string" id="3924570">&#34;io&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3924576">//&nbsp;The&nbsp;Stream*&nbsp;objects&nbsp;are&nbsp;so&nbsp;simple&nbsp;that&nbsp;all&nbsp;their&nbsp;members&nbsp;are&nbsp;public.&nbsp;Users</span><br>
<span class="lineno">10</span><span class="comment" id="3924654">//&nbsp;can&nbsp;create&nbsp;them&nbsp;themselves.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3924686">//&nbsp;StreamReader&nbsp;wraps&nbsp;a&nbsp;Stream&nbsp;into&nbsp;an&nbsp;io.Reader.&nbsp;It&nbsp;calls&nbsp;XORKeyStream</span><br>
<span class="lineno"></span><span class="comment" id="3924758">//&nbsp;to&nbsp;process&nbsp;each&nbsp;slice&nbsp;of&nbsp;data&nbsp;which&nbsp;passes&nbsp;through.</span><br>
<span class="lineno"></span><span class="keyword" id="3924813">type</span>&nbsp;<span class="ident" id="3924818">StreamReader</span>&nbsp;<span class="keyword" id="3924831">struct</span>&nbsp;<span class="op" id="3924838">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3924841">S</span>&nbsp;<span class="ident" id="3924843">Stream</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3924851">R</span>&nbsp;<span class="ident" id="3924853">io</span><span class="op" id="3924855">.</span><span class="ident" id="3924856">Reader</span><br>
<span class="lineno"></span><span class="op" id="3924863">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3924866">func</span>&nbsp;<span class="op" id="3924871">(</span><span class="ident" id="3924872">r</span>&nbsp;<span class="ident" id="3924874">StreamReader</span><span class="op" id="3924886">)</span>&nbsp;<span class="ident" id="3924888">Read</span><span class="op" id="3924892">(</span><span class="ident" id="3924893">dst</span>&nbsp;<span class="op" id="3924897">[</span><span class="op" id="3924898">]</span><span class="builtintype" id="3924899">byte</span><span class="op" id="3924903">)</span>&nbsp;<span class="op" id="3924905">(</span><span class="ident" id="3924906">n</span>&nbsp;<span class="builtintype" id="3924908">int</span><span class="op" id="3924911">,</span>&nbsp;<span class="ident" id="3924913">err</span>&nbsp;<span class="builtintype" id="3924917">error</span><span class="op" id="3924922">)</span>&nbsp;<span class="op" id="3924924">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3924927">n</span><span class="op" id="3924928">,</span>&nbsp;<span class="ident" id="3924930">err</span>&nbsp;<span class="op" id="3924934">=</span>&nbsp;<span class="ident" id="3924936">r</span><span class="op" id="3924937">.</span><span class="ident" id="3924938">R</span><span class="op" id="3924939">.</span><span class="ident" id="3924940">Read</span><span class="op" id="3924944">(</span><span class="ident" id="3924945">dst</span><span class="op" id="3924948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3924951">r</span><span class="op" id="3924952">.</span><span class="ident" id="3924953">S</span><span class="op" id="3924954">.</span><span class="ident" id="3924955">XORKeyStream</span><span class="op" id="3924967">(</span><span class="ident" id="3924968">dst</span><span class="op" id="3924971">[</span><span class="op" id="3924972">:</span><span class="ident" id="3924973">n</span><span class="op" id="3924974">]</span><span class="op" id="3924975">,</span>&nbsp;<span class="ident" id="3924977">dst</span><span class="op" id="3924980">[</span><span class="op" id="3924981">:</span><span class="ident" id="3924982">n</span><span class="op" id="3924983">]</span><span class="op" id="3924984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3924987">return</span><br>
<span class="lineno"></span><span class="op" id="3924994">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="3924997">//&nbsp;StreamWriter&nbsp;wraps&nbsp;a&nbsp;Stream&nbsp;into&nbsp;an&nbsp;io.Writer.&nbsp;It&nbsp;calls&nbsp;XORKeyStream</span><br>
<span class="lineno"></span><span class="comment" id="3925069">//&nbsp;to&nbsp;process&nbsp;each&nbsp;slice&nbsp;of&nbsp;data&nbsp;which&nbsp;passes&nbsp;through.&nbsp;If&nbsp;any&nbsp;Write&nbsp;call</span><br>
<span class="lineno"></span><span class="comment" id="3925142">//&nbsp;returns&nbsp;short&nbsp;then&nbsp;the&nbsp;StreamWriter&nbsp;is&nbsp;out&nbsp;of&nbsp;sync&nbsp;and&nbsp;must&nbsp;be&nbsp;discarded.</span><br>
<span class="lineno"></span><span class="comment" id="3925219">//&nbsp;A&nbsp;StreamWriter&nbsp;has&nbsp;no&nbsp;internal&nbsp;buffering;&nbsp;Close&nbsp;does&nbsp;not&nbsp;need</span><br>
<span class="lineno"></span><span class="comment" id="3925284">//&nbsp;to&nbsp;be&nbsp;called&nbsp;to&nbsp;flush&nbsp;write&nbsp;data.</span><br>
<span class="lineno">30</span><span class="keyword" id="3925321">type</span>&nbsp;<span class="ident" id="3925326">StreamWriter</span>&nbsp;<span class="keyword" id="3925339">struct</span>&nbsp;<span class="op" id="3925346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3925349">S</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3925353">Stream</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3925361">W</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3925365">io</span><span class="op" id="3925367">.</span><span class="ident" id="3925368">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3925376">Err</span>&nbsp;<span class="builtintype" id="3925380">error</span>&nbsp;<span class="comment" id="3925386">//&nbsp;unused</span><br>
<span class="lineno"></span><span class="op" id="3925396">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="3925399">func</span>&nbsp;<span class="op" id="3925404">(</span><span class="ident" id="3925405">w</span>&nbsp;<span class="ident" id="3925407">StreamWriter</span><span class="op" id="3925419">)</span>&nbsp;<span class="ident" id="3925421">Write</span><span class="op" id="3925426">(</span><span class="ident" id="3925427">src</span>&nbsp;<span class="op" id="3925431">[</span><span class="op" id="3925432">]</span><span class="builtintype" id="3925433">byte</span><span class="op" id="3925437">)</span>&nbsp;<span class="op" id="3925439">(</span><span class="ident" id="3925440">n</span>&nbsp;<span class="builtintype" id="3925442">int</span><span class="op" id="3925445">,</span>&nbsp;<span class="ident" id="3925447">err</span>&nbsp;<span class="builtintype" id="3925451">error</span><span class="op" id="3925456">)</span>&nbsp;<span class="op" id="3925458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3925461">c</span>&nbsp;<span class="op" id="3925463">:=</span>&nbsp;<span class="builtinfunc" id="3925466">make</span><span class="op" id="3925470">(</span><span class="op" id="3925471">[</span><span class="op" id="3925472">]</span><span class="builtintype" id="3925473">byte</span><span class="op" id="3925477">,</span>&nbsp;<span class="builtinfunc" id="3925479">len</span><span class="op" id="3925482">(</span><span class="ident" id="3925483">src</span><span class="op" id="3925486">)</span><span class="op" id="3925487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3925490">w</span><span class="op" id="3925491">.</span><span class="ident" id="3925492">S</span><span class="op" id="3925493">.</span><span class="ident" id="3925494">XORKeyStream</span><span class="op" id="3925506">(</span><span class="ident" id="3925507">c</span><span class="op" id="3925508">,</span>&nbsp;<span class="ident" id="3925510">src</span><span class="op" id="3925513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3925516">n</span><span class="op" id="3925517">,</span>&nbsp;<span class="ident" id="3925519">err</span>&nbsp;<span class="op" id="3925523">=</span>&nbsp;<span class="ident" id="3925525">w</span><span class="op" id="3925526">.</span><span class="ident" id="3925527">W</span><span class="op" id="3925528">.</span><span class="ident" id="3925529">Write</span><span class="op" id="3925534">(</span><span class="ident" id="3925535">c</span><span class="op" id="3925536">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3925539">if</span>&nbsp;<span class="ident" id="3925542">n</span>&nbsp;<span class="op" id="3925544">!=</span>&nbsp;<span class="builtinfunc" id="3925547">len</span><span class="op" id="3925550">(</span><span class="ident" id="3925551">src</span><span class="op" id="3925554">)</span>&nbsp;<span class="op" id="3925556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3925560">if</span>&nbsp;<span class="ident" id="3925563">err</span>&nbsp;<span class="op" id="3925567">==</span>&nbsp;<span class="ident" id="3925570">nil</span>&nbsp;<span class="op" id="3925574">{</span>&nbsp;<span class="comment" id="3925576">//&nbsp;should&nbsp;never&nbsp;happen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3925602">err</span>&nbsp;<span class="op" id="3925606">=</span>&nbsp;<span class="ident" id="3925608">io</span><span class="op" id="3925610">.</span><span class="ident" id="3925611">ErrShortWrite</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3925627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3925630">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3925633">return</span><br>
<span class="lineno"></span><span class="op" id="3925640">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3925643">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;underlying&nbsp;Writer&nbsp;and&nbsp;returns&nbsp;its&nbsp;Close&nbsp;return&nbsp;value,&nbsp;if&nbsp;the&nbsp;Writer</span><br>
<span class="lineno"></span><span class="comment" id="3925731">//&nbsp;is&nbsp;also&nbsp;an&nbsp;io.Closer.&nbsp;Otherwise&nbsp;it&nbsp;returns&nbsp;nil.</span><br>
<span class="lineno">50</span><span class="keyword" id="3925782">func</span>&nbsp;<span class="op" id="3925787">(</span><span class="ident" id="3925788">w</span>&nbsp;<span class="ident" id="3925790">StreamWriter</span><span class="op" id="3925802">)</span>&nbsp;<span class="ident" id="3925804">Close</span><span class="op" id="3925809">(</span><span class="op" id="3925810">)</span>&nbsp;<span class="builtintype" id="3925812">error</span>&nbsp;<span class="op" id="3925818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3925821">if</span>&nbsp;<span class="ident" id="3925824">c</span><span class="op" id="3925825">,</span>&nbsp;<span class="ident" id="3925827">ok</span>&nbsp;<span class="op" id="3925830">:=</span>&nbsp;<span class="ident" id="3925833">w</span><span class="op" id="3925834">.</span><span class="ident" id="3925835">W</span><span class="op" id="3925836">.</span><span class="op" id="3925837">(</span><span class="ident" id="3925838">io</span><span class="op" id="3925840">.</span><span class="ident" id="3925841">Closer</span><span class="op" id="3925847">)</span><span class="op" id="3925848">;</span>&nbsp;<span class="ident" id="3925850">ok</span>&nbsp;<span class="op" id="3925853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3925857">return</span>&nbsp;<span class="ident" id="3925864">c</span><span class="op" id="3925865">.</span><span class="ident" id="3925866">Close</span><span class="op" id="3925871">(</span><span class="op" id="3925872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3925875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3925878">return</span>&nbsp;<span class="ident" id="3925885">nil</span><br>
<span class="lineno">55</span><span class="op" id="3925889">}</span>
</div>
</body>
</html>
