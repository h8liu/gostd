<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/csv</h2>
<ul>
<li><a href="/gostd/encoding/csv/reader.go.html">reader.go</a></li>
<li><a href="/gostd/encoding/csv/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/encoding/csv/writer.go.html">writer.go</a></li>
<li><a href="/gostd/encoding/csv/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6386639">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6386694">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6386748">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6386799">package</span>&nbsp;<span class="ident" id="6386807">csv</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6386812">import</span>&nbsp;<span class="op" id="6386819">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6386822">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6386831">&#34;io&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6386837">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6386848">&#34;unicode&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6386859">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="6386874">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="6386877">//&nbsp;A&nbsp;Writer&nbsp;writes&nbsp;records&nbsp;to&nbsp;a&nbsp;CSV&nbsp;encoded&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="6386927">//</span><br>
<span class="lineno"></span><span class="comment" id="6386930">//&nbsp;As&nbsp;returned&nbsp;by&nbsp;NewWriter,&nbsp;a&nbsp;Writer&nbsp;writes&nbsp;records&nbsp;terminated&nbsp;by&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="6386999">//&nbsp;newline&nbsp;and&nbsp;uses&nbsp;&#39;,&#39;&nbsp;as&nbsp;the&nbsp;field&nbsp;delimiter.&nbsp;&nbsp;The&nbsp;exported&nbsp;fields&nbsp;can&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="6387075">//&nbsp;changed&nbsp;to&nbsp;customize&nbsp;the&nbsp;details&nbsp;before&nbsp;the&nbsp;first&nbsp;call&nbsp;to&nbsp;Write&nbsp;or&nbsp;WriteAll.</span><br>
<span class="lineno">20</span><span class="comment" id="6387155">//</span><br>
<span class="lineno"></span><span class="comment" id="6387158">//&nbsp;Comma&nbsp;is&nbsp;the&nbsp;field&nbsp;delimiter.</span><br>
<span class="lineno"></span><span class="comment" id="6387191">//</span><br>
<span class="lineno"></span><span class="comment" id="6387194">//&nbsp;If&nbsp;UseCRLF&nbsp;is&nbsp;true,&nbsp;the&nbsp;Writer&nbsp;ends&nbsp;each&nbsp;record&nbsp;with&nbsp;\r\n&nbsp;instead&nbsp;of&nbsp;\n.</span><br>
<span class="lineno"></span><span class="keyword" id="6387270">type</span>&nbsp;<span class="ident" id="6387275">Writer</span>&nbsp;<span class="keyword" id="6387282">struct</span>&nbsp;<span class="op" id="6387289">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6387292">Comma</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6387300">rune</span>&nbsp;<span class="comment" id="6387305">//&nbsp;Field&nbsp;delimiter&nbsp;(set&nbsp;to&nbsp;&#39;,&#39;&nbsp;by&nbsp;NewWriter)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6387351">UseCRLF</span>&nbsp;<span class="builtintype" id="6387359">bool</span>&nbsp;<span class="comment" id="6387364">//&nbsp;True&nbsp;to&nbsp;use&nbsp;\r\n&nbsp;as&nbsp;the&nbsp;line&nbsp;terminator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6387408">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6387416">*</span><span class="ident" id="6387417">bufio</span><span class="op" id="6387422">.</span><span class="ident" id="6387423">Writer</span><br>
<span class="lineno"></span><span class="op" id="6387430">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="6387433">//&nbsp;NewWriter&nbsp;returns&nbsp;a&nbsp;new&nbsp;Writer&nbsp;that&nbsp;writes&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="6387485">func</span>&nbsp;<span class="ident" id="6387490">NewWriter</span><span class="op" id="6387499">(</span><span class="ident" id="6387500">w</span>&nbsp;<span class="ident" id="6387502">io</span><span class="op" id="6387504">.</span><span class="ident" id="6387505">Writer</span><span class="op" id="6387511">)</span>&nbsp;<span class="op" id="6387513">*</span><span class="ident" id="6387514">Writer</span>&nbsp;<span class="op" id="6387521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6387524">return</span>&nbsp;<span class="op" id="6387531">&amp;</span><span class="ident" id="6387532">Writer</span><span class="op" id="6387538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6387542">Comma</span><span class="op" id="6387547">:</span>&nbsp;<span class="string" id="6387549">&#39;,&#39;</span><span class="op" id="6387552">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6387556">w</span><span class="op" id="6387557">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6387563">bufio</span><span class="op" id="6387568">.</span><span class="ident" id="6387569">NewWriter</span><span class="op" id="6387578">(</span><span class="ident" id="6387579">w</span><span class="op" id="6387580">)</span><span class="op" id="6387581">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6387584">}</span><br>
<span class="lineno"></span><span class="op" id="6387586">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6387589">//&nbsp;Writer&nbsp;writes&nbsp;a&nbsp;single&nbsp;CSV&nbsp;record&nbsp;to&nbsp;w&nbsp;along&nbsp;with&nbsp;any&nbsp;necessary&nbsp;quoting.</span><br>
<span class="lineno"></span><span class="comment" id="6387665">//&nbsp;A&nbsp;record&nbsp;is&nbsp;a&nbsp;slice&nbsp;of&nbsp;strings&nbsp;with&nbsp;each&nbsp;string&nbsp;being&nbsp;one&nbsp;field.</span><br>
<span class="lineno">40</span><span class="keyword" id="6387733">func</span>&nbsp;<span class="op" id="6387738">(</span><span class="ident" id="6387739">w</span>&nbsp;<span class="op" id="6387741">*</span><span class="ident" id="6387742">Writer</span><span class="op" id="6387748">)</span>&nbsp;<span class="ident" id="6387750">Write</span><span class="op" id="6387755">(</span><span class="ident" id="6387756">record</span>&nbsp;<span class="op" id="6387763">[</span><span class="op" id="6387764">]</span><span class="builtintype" id="6387765">string</span><span class="op" id="6387771">)</span>&nbsp;<span class="op" id="6387773">(</span><span class="ident" id="6387774">err</span>&nbsp;<span class="builtintype" id="6387778">error</span><span class="op" id="6387783">)</span>&nbsp;<span class="op" id="6387785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6387788">for</span>&nbsp;<span class="ident" id="6387792">n</span><span class="op" id="6387793">,</span>&nbsp;<span class="ident" id="6387795">field</span>&nbsp;<span class="op" id="6387801">:=</span>&nbsp;<span class="keyword" id="6387804">range</span>&nbsp;<span class="ident" id="6387810">record</span>&nbsp;<span class="op" id="6387817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6387821">if</span>&nbsp;<span class="ident" id="6387824">n</span>&nbsp;<span class="op" id="6387826">&gt;</span>&nbsp;<span class="num" id="6387828">0</span>&nbsp;<span class="op" id="6387830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6387835">if</span>&nbsp;<span class="ident" id="6387838">_</span><span class="op" id="6387839">,</span>&nbsp;<span class="ident" id="6387841">err</span>&nbsp;<span class="op" id="6387845">=</span>&nbsp;<span class="ident" id="6387847">w</span><span class="op" id="6387848">.</span><span class="ident" id="6387849">w</span><span class="op" id="6387850">.</span><span class="ident" id="6387851">WriteRune</span><span class="op" id="6387860">(</span><span class="ident" id="6387861">w</span><span class="op" id="6387862">.</span><span class="ident" id="6387863">Comma</span><span class="op" id="6387868">)</span><span class="op" id="6387869">;</span>&nbsp;<span class="ident" id="6387871">err</span>&nbsp;<span class="op" id="6387875">!=</span>&nbsp;<span class="ident" id="6387878">nil</span>&nbsp;<span class="op" id="6387882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6387888">return</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6387898">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6387902">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6387907">//&nbsp;If&nbsp;we&nbsp;don&#39;t&nbsp;have&nbsp;to&nbsp;have&nbsp;a&nbsp;quoted&nbsp;field&nbsp;then&nbsp;just</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6387962">//&nbsp;write&nbsp;out&nbsp;the&nbsp;field&nbsp;and&nbsp;continue&nbsp;to&nbsp;the&nbsp;next&nbsp;field.</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388019">if</span>&nbsp;<span class="op" id="6388022">!</span><span class="ident" id="6388023">w</span><span class="op" id="6388024">.</span><span class="ident" id="6388025">fieldNeedsQuotes</span><span class="op" id="6388041">(</span><span class="ident" id="6388042">field</span><span class="op" id="6388047">)</span>&nbsp;<span class="op" id="6388049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388054">if</span>&nbsp;<span class="ident" id="6388057">_</span><span class="op" id="6388058">,</span>&nbsp;<span class="ident" id="6388060">err</span>&nbsp;<span class="op" id="6388064">=</span>&nbsp;<span class="ident" id="6388066">w</span><span class="op" id="6388067">.</span><span class="ident" id="6388068">w</span><span class="op" id="6388069">.</span><span class="ident" id="6388070">WriteString</span><span class="op" id="6388081">(</span><span class="ident" id="6388082">field</span><span class="op" id="6388087">)</span><span class="op" id="6388088">;</span>&nbsp;<span class="ident" id="6388090">err</span>&nbsp;<span class="op" id="6388094">!=</span>&nbsp;<span class="ident" id="6388097">nil</span>&nbsp;<span class="op" id="6388101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388107">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6388117">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388122">continue</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6388133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388137">if</span>&nbsp;<span class="ident" id="6388140">err</span>&nbsp;<span class="op" id="6388144">=</span>&nbsp;<span class="ident" id="6388146">w</span><span class="op" id="6388147">.</span><span class="ident" id="6388148">w</span><span class="op" id="6388149">.</span><span class="ident" id="6388150">WriteByte</span><span class="op" id="6388159">(</span><span class="string" id="6388160">&#39;&#34;&#39;</span><span class="op" id="6388163">)</span><span class="op" id="6388164">;</span>&nbsp;<span class="ident" id="6388166">err</span>&nbsp;<span class="op" id="6388170">!=</span>&nbsp;<span class="ident" id="6388173">nil</span>&nbsp;<span class="op" id="6388177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388182">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6388191">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388196">for</span>&nbsp;<span class="ident" id="6388200">_</span><span class="op" id="6388201">,</span>&nbsp;<span class="ident" id="6388203">r1</span>&nbsp;<span class="op" id="6388206">:=</span>&nbsp;<span class="keyword" id="6388209">range</span>&nbsp;<span class="ident" id="6388215">field</span>&nbsp;<span class="op" id="6388221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388226">switch</span>&nbsp;<span class="ident" id="6388233">r1</span>&nbsp;<span class="op" id="6388236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388241">case</span>&nbsp;<span class="string" id="6388246">&#39;&#34;&#39;</span><span class="op" id="6388249">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388255">_</span><span class="op" id="6388256">,</span>&nbsp;<span class="ident" id="6388258">err</span>&nbsp;<span class="op" id="6388262">=</span>&nbsp;<span class="ident" id="6388264">w</span><span class="op" id="6388265">.</span><span class="ident" id="6388266">w</span><span class="op" id="6388267">.</span><span class="ident" id="6388268">WriteString</span><span class="op" id="6388279">(</span><span class="string" id="6388280">`&#34;&#34;`</span><span class="op" id="6388284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388289">case</span>&nbsp;<span class="string" id="6388294">&#39;\r&#39;</span><span class="op" id="6388298">:</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388304">if</span>&nbsp;<span class="op" id="6388307">!</span><span class="ident" id="6388308">w</span><span class="op" id="6388309">.</span><span class="ident" id="6388310">UseCRLF</span>&nbsp;<span class="op" id="6388318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388325">err</span>&nbsp;<span class="op" id="6388329">=</span>&nbsp;<span class="ident" id="6388331">w</span><span class="op" id="6388332">.</span><span class="ident" id="6388333">w</span><span class="op" id="6388334">.</span><span class="ident" id="6388335">WriteByte</span><span class="op" id="6388344">(</span><span class="string" id="6388345">&#39;\r&#39;</span><span class="op" id="6388349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6388355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388360">case</span>&nbsp;<span class="string" id="6388365">&#39;\n&#39;</span><span class="op" id="6388369">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388375">if</span>&nbsp;<span class="ident" id="6388378">w</span><span class="op" id="6388379">.</span><span class="ident" id="6388380">UseCRLF</span>&nbsp;<span class="op" id="6388388">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388395">_</span><span class="op" id="6388396">,</span>&nbsp;<span class="ident" id="6388398">err</span>&nbsp;<span class="op" id="6388402">=</span>&nbsp;<span class="ident" id="6388404">w</span><span class="op" id="6388405">.</span><span class="ident" id="6388406">w</span><span class="op" id="6388407">.</span><span class="ident" id="6388408">WriteString</span><span class="op" id="6388419">(</span><span class="string" id="6388420">&#34;\r\n&#34;</span><span class="op" id="6388426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6388432">}</span>&nbsp;<span class="keyword" id="6388434">else</span>&nbsp;<span class="op" id="6388439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388446">err</span>&nbsp;<span class="op" id="6388450">=</span>&nbsp;<span class="ident" id="6388452">w</span><span class="op" id="6388453">.</span><span class="ident" id="6388454">w</span><span class="op" id="6388455">.</span><span class="ident" id="6388456">WriteByte</span><span class="op" id="6388465">(</span><span class="string" id="6388466">&#39;\n&#39;</span><span class="op" id="6388470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6388476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388481">default</span><span class="op" id="6388488">:</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388494">_</span><span class="op" id="6388495">,</span>&nbsp;<span class="ident" id="6388497">err</span>&nbsp;<span class="op" id="6388501">=</span>&nbsp;<span class="ident" id="6388503">w</span><span class="op" id="6388504">.</span><span class="ident" id="6388505">w</span><span class="op" id="6388506">.</span><span class="ident" id="6388507">WriteRune</span><span class="op" id="6388516">(</span><span class="ident" id="6388517">r1</span><span class="op" id="6388519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6388524">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388529">if</span>&nbsp;<span class="ident" id="6388532">err</span>&nbsp;<span class="op" id="6388536">!=</span>&nbsp;<span class="ident" id="6388539">nil</span>&nbsp;<span class="op" id="6388543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388549">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6388559">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6388563">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388568">if</span>&nbsp;<span class="ident" id="6388571">err</span>&nbsp;<span class="op" id="6388575">=</span>&nbsp;<span class="ident" id="6388577">w</span><span class="op" id="6388578">.</span><span class="ident" id="6388579">w</span><span class="op" id="6388580">.</span><span class="ident" id="6388581">WriteByte</span><span class="op" id="6388590">(</span><span class="string" id="6388591">&#39;&#34;&#39;</span><span class="op" id="6388594">)</span><span class="op" id="6388595">;</span>&nbsp;<span class="ident" id="6388597">err</span>&nbsp;<span class="op" id="6388601">!=</span>&nbsp;<span class="ident" id="6388604">nil</span>&nbsp;<span class="op" id="6388608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388613">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6388622">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6388625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388628">if</span>&nbsp;<span class="ident" id="6388631">w</span><span class="op" id="6388632">.</span><span class="ident" id="6388633">UseCRLF</span>&nbsp;<span class="op" id="6388641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388645">_</span><span class="op" id="6388646">,</span>&nbsp;<span class="ident" id="6388648">err</span>&nbsp;<span class="op" id="6388652">=</span>&nbsp;<span class="ident" id="6388654">w</span><span class="op" id="6388655">.</span><span class="ident" id="6388656">w</span><span class="op" id="6388657">.</span><span class="ident" id="6388658">WriteString</span><span class="op" id="6388669">(</span><span class="string" id="6388670">&#34;\r\n&#34;</span><span class="op" id="6388676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6388679">}</span>&nbsp;<span class="keyword" id="6388681">else</span>&nbsp;<span class="op" id="6388686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388690">err</span>&nbsp;<span class="op" id="6388694">=</span>&nbsp;<span class="ident" id="6388696">w</span><span class="op" id="6388697">.</span><span class="ident" id="6388698">w</span><span class="op" id="6388699">.</span><span class="ident" id="6388700">WriteByte</span><span class="op" id="6388709">(</span><span class="string" id="6388710">&#39;\n&#39;</span><span class="op" id="6388714">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6388717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388720">return</span><br>
<span class="lineno"></span><span class="op" id="6388727">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6388730">//&nbsp;Flush&nbsp;writes&nbsp;any&nbsp;buffered&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying&nbsp;io.Writer.</span><br>
<span class="lineno">95</span><span class="comment" id="6388793">//&nbsp;To&nbsp;check&nbsp;if&nbsp;an&nbsp;error&nbsp;occurred&nbsp;during&nbsp;the&nbsp;Flush,&nbsp;call&nbsp;Error.</span><br>
<span class="lineno"></span><span class="keyword" id="6388856">func</span>&nbsp;<span class="op" id="6388861">(</span><span class="ident" id="6388862">w</span>&nbsp;<span class="op" id="6388864">*</span><span class="ident" id="6388865">Writer</span><span class="op" id="6388871">)</span>&nbsp;<span class="ident" id="6388873">Flush</span><span class="op" id="6388878">(</span><span class="op" id="6388879">)</span>&nbsp;<span class="op" id="6388881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388884">w</span><span class="op" id="6388885">.</span><span class="ident" id="6388886">w</span><span class="op" id="6388887">.</span><span class="ident" id="6388888">Flush</span><span class="op" id="6388893">(</span><span class="op" id="6388894">)</span><br>
<span class="lineno"></span><span class="op" id="6388896">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="6388899">//&nbsp;Error&nbsp;reports&nbsp;any&nbsp;error&nbsp;that&nbsp;has&nbsp;occurred&nbsp;during&nbsp;a&nbsp;previous&nbsp;Write&nbsp;or&nbsp;Flush.</span><br>
<span class="lineno"></span><span class="keyword" id="6388978">func</span>&nbsp;<span class="op" id="6388983">(</span><span class="ident" id="6388984">w</span>&nbsp;<span class="op" id="6388986">*</span><span class="ident" id="6388987">Writer</span><span class="op" id="6388993">)</span>&nbsp;<span class="ident" id="6388995">Error</span><span class="op" id="6389000">(</span><span class="op" id="6389001">)</span>&nbsp;<span class="builtintype" id="6389003">error</span>&nbsp;<span class="op" id="6389009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6389012">_</span><span class="op" id="6389013">,</span>&nbsp;<span class="ident" id="6389015">err</span>&nbsp;<span class="op" id="6389019">:=</span>&nbsp;<span class="ident" id="6389022">w</span><span class="op" id="6389023">.</span><span class="ident" id="6389024">w</span><span class="op" id="6389025">.</span><span class="ident" id="6389026">Write</span><span class="op" id="6389031">(</span><span class="ident" id="6389032">nil</span><span class="op" id="6389035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6389038">return</span>&nbsp;<span class="ident" id="6389045">err</span><br>
<span class="lineno"></span><span class="op" id="6389049">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="comment" id="6389052">//&nbsp;WriteAll&nbsp;writes&nbsp;multiple&nbsp;CSV&nbsp;records&nbsp;to&nbsp;w&nbsp;using&nbsp;Write&nbsp;and&nbsp;then&nbsp;calls&nbsp;Flush.</span><br>
<span class="lineno"></span><span class="keyword" id="6389131">func</span>&nbsp;<span class="op" id="6389136">(</span><span class="ident" id="6389137">w</span>&nbsp;<span class="op" id="6389139">*</span><span class="ident" id="6389140">Writer</span><span class="op" id="6389146">)</span>&nbsp;<span class="ident" id="6389148">WriteAll</span><span class="op" id="6389156">(</span><span class="ident" id="6389157">records</span>&nbsp;<span class="op" id="6389165">[</span><span class="op" id="6389166">]</span><span class="op" id="6389167">[</span><span class="op" id="6389168">]</span><span class="builtintype" id="6389169">string</span><span class="op" id="6389175">)</span>&nbsp;<span class="op" id="6389177">(</span><span class="ident" id="6389178">err</span>&nbsp;<span class="builtintype" id="6389182">error</span><span class="op" id="6389187">)</span>&nbsp;<span class="op" id="6389189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6389192">for</span>&nbsp;<span class="ident" id="6389196">_</span><span class="op" id="6389197">,</span>&nbsp;<span class="ident" id="6389199">record</span>&nbsp;<span class="op" id="6389206">:=</span>&nbsp;<span class="keyword" id="6389209">range</span>&nbsp;<span class="ident" id="6389215">records</span>&nbsp;<span class="op" id="6389223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6389227">err</span>&nbsp;<span class="op" id="6389231">=</span>&nbsp;<span class="ident" id="6389233">w</span><span class="op" id="6389234">.</span><span class="ident" id="6389235">Write</span><span class="op" id="6389240">(</span><span class="ident" id="6389241">record</span><span class="op" id="6389247">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6389251">if</span>&nbsp;<span class="ident" id="6389254">err</span>&nbsp;<span class="op" id="6389258">!=</span>&nbsp;<span class="ident" id="6389261">nil</span>&nbsp;<span class="op" id="6389265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6389270">return</span>&nbsp;<span class="ident" id="6389277">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6389283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6389286">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6389289">return</span>&nbsp;<span class="ident" id="6389296">w</span><span class="op" id="6389297">.</span><span class="ident" id="6389298">w</span><span class="op" id="6389299">.</span><span class="ident" id="6389300">Flush</span><span class="op" id="6389305">(</span><span class="op" id="6389306">)</span><br>
<span class="lineno">115</span><span class="op" id="6389308">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6389311">//&nbsp;fieldNeedsQuotes&nbsp;returns&nbsp;true&nbsp;if&nbsp;our&nbsp;field&nbsp;must&nbsp;be&nbsp;enclosed&nbsp;in&nbsp;quotes.</span><br>
<span class="lineno"></span><span class="comment" id="6389385">//&nbsp;Fields&nbsp;with&nbsp;a&nbsp;Comma,&nbsp;fields&nbsp;with&nbsp;a&nbsp;quote&nbsp;or&nbsp;newline,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="6389445">//&nbsp;fields&nbsp;which&nbsp;start&nbsp;with&nbsp;a&nbsp;space&nbsp;must&nbsp;be&nbsp;enclosed&nbsp;in&nbsp;quotes.</span><br>
<span class="lineno">120</span><span class="comment" id="6389508">//&nbsp;We&nbsp;used&nbsp;to&nbsp;quote&nbsp;empty&nbsp;strings,&nbsp;but&nbsp;we&nbsp;do&nbsp;not&nbsp;anymore&nbsp;(as&nbsp;of&nbsp;Go&nbsp;1.4).</span><br>
<span class="lineno"></span><span class="comment" id="6389581">//&nbsp;The&nbsp;two&nbsp;representations&nbsp;should&nbsp;be&nbsp;equivalent,&nbsp;but&nbsp;Postgres&nbsp;distinguishes</span><br>
<span class="lineno"></span><span class="comment" id="6389657">//&nbsp;quoted&nbsp;vs&nbsp;non-quoted&nbsp;empty&nbsp;string&nbsp;during&nbsp;database&nbsp;imports,&nbsp;and&nbsp;it&nbsp;has</span><br>
<span class="lineno"></span><span class="comment" id="6389730">//&nbsp;an&nbsp;option&nbsp;to&nbsp;force&nbsp;the&nbsp;quoted&nbsp;behavior&nbsp;for&nbsp;non-quoted&nbsp;CSV&nbsp;but&nbsp;it&nbsp;has</span><br>
<span class="lineno"></span><span class="comment" id="6389802">//&nbsp;no&nbsp;option&nbsp;to&nbsp;force&nbsp;the&nbsp;non-quoted&nbsp;behavior&nbsp;for&nbsp;quoted&nbsp;CSV,&nbsp;making</span><br>
<span class="lineno">125</span><span class="comment" id="6389871">//&nbsp;CSV&nbsp;with&nbsp;quoted&nbsp;empty&nbsp;strings&nbsp;strictly&nbsp;less&nbsp;useful.</span><br>
<span class="lineno"></span><span class="comment" id="6389926">//&nbsp;Not&nbsp;quoting&nbsp;the&nbsp;empty&nbsp;string&nbsp;also&nbsp;makes&nbsp;this&nbsp;package&nbsp;match&nbsp;the&nbsp;behavior</span><br>
<span class="lineno"></span><span class="comment" id="6390001">//&nbsp;of&nbsp;Microsoft&nbsp;Excel&nbsp;and&nbsp;Google&nbsp;Drive.</span><br>
<span class="lineno"></span><span class="comment" id="6390041">//&nbsp;For&nbsp;Postgres,&nbsp;quote&nbsp;the&nbsp;data&nbsp;termating&nbsp;string&nbsp;`\.`.</span><br>
<span class="lineno"></span><span class="keyword" id="6390096">func</span>&nbsp;<span class="op" id="6390101">(</span><span class="ident" id="6390102">w</span>&nbsp;<span class="op" id="6390104">*</span><span class="ident" id="6390105">Writer</span><span class="op" id="6390111">)</span>&nbsp;<span class="ident" id="6390113">fieldNeedsQuotes</span><span class="op" id="6390129">(</span><span class="ident" id="6390130">field</span>&nbsp;<span class="builtintype" id="6390136">string</span><span class="op" id="6390142">)</span>&nbsp;<span class="builtintype" id="6390144">bool</span>&nbsp;<span class="op" id="6390149">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390152">if</span>&nbsp;<span class="ident" id="6390155">field</span>&nbsp;<span class="op" id="6390161">==</span>&nbsp;<span class="string" id="6390164">&#34;&#34;</span>&nbsp;<span class="op" id="6390167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390171">return</span>&nbsp;<span class="builtintype" id="6390178">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6390185">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390188">if</span>&nbsp;<span class="ident" id="6390191">field</span>&nbsp;<span class="op" id="6390197">==</span>&nbsp;<span class="string" id="6390200">`\.`</span>&nbsp;<span class="op" id="6390205">||</span>&nbsp;<span class="ident" id="6390208">strings</span><span class="op" id="6390215">.</span><span class="ident" id="6390216">IndexRune</span><span class="op" id="6390225">(</span><span class="ident" id="6390226">field</span><span class="op" id="6390231">,</span>&nbsp;<span class="ident" id="6390233">w</span><span class="op" id="6390234">.</span><span class="ident" id="6390235">Comma</span><span class="op" id="6390240">)</span>&nbsp;<span class="op" id="6390242">&gt;=</span>&nbsp;<span class="num" id="6390245">0</span>&nbsp;<span class="op" id="6390247">||</span>&nbsp;<span class="ident" id="6390250">strings</span><span class="op" id="6390257">.</span><span class="ident" id="6390258">IndexAny</span><span class="op" id="6390266">(</span><span class="ident" id="6390267">field</span><span class="op" id="6390272">,</span>&nbsp;<span class="string" id="6390274">&#34;\&#34;\r\n&#34;</span><span class="op" id="6390282">)</span>&nbsp;<span class="op" id="6390284">&gt;=</span>&nbsp;<span class="num" id="6390287">0</span>&nbsp;<span class="op" id="6390289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390293">return</span>&nbsp;<span class="builtintype" id="6390300">true</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6390306">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390310">r1</span><span class="op" id="6390312">,</span>&nbsp;<span class="ident" id="6390314">_</span>&nbsp;<span class="op" id="6390316">:=</span>&nbsp;<span class="ident" id="6390319">utf8</span><span class="op" id="6390323">.</span><span class="ident" id="6390324">DecodeRuneInString</span><span class="op" id="6390342">(</span><span class="ident" id="6390343">field</span><span class="op" id="6390348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390351">return</span>&nbsp;<span class="ident" id="6390358">unicode</span><span class="op" id="6390365">.</span><span class="ident" id="6390366">IsSpace</span><span class="op" id="6390373">(</span><span class="ident" id="6390374">r1</span><span class="op" id="6390376">)</span><br>
<span class="lineno"></span><span class="op" id="6390378">}</span>
</div>
</body>
</html>
