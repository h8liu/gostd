<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6742866">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6742921">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6742975">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6743026">package</span>&nbsp;<span class="ident" id="6743034">internal</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6743044">import</span>&nbsp;<span class="op" id="6743051">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6743054">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6743063">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6743072">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6743079">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6743085">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6743098">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6743109">&#34;testing&#34;</span><br>
<span class="lineno">15</span><span class="op" id="6743119">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6743122">func</span>&nbsp;<span class="ident" id="6743127">TestChunk</span><span class="op" id="6743136">(</span><span class="ident" id="6743137">t</span>&nbsp;<span class="op" id="6743139">*</span><span class="ident" id="6743140"><a href="/net/http/internal/chunked_test.go.html#6743109">testing</a></span><span class="op" id="6743147">.</span><span class="ident" id="6743148">T</span><span class="op" id="6743149">)</span>&nbsp;<span class="op" id="6743151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6743154">var</span>&nbsp;<span class="ident" id="6743158">b</span>&nbsp;<span class="ident" id="6743160"><a href="/net/http/internal/chunked_test.go.html#6743063">bytes</a></span><span class="op" id="6743165">.</span><span class="ident" id="6743166">Buffer</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6743175">w</span>&nbsp;<span class="op" id="6743177">:=</span>&nbsp;<span class="ident" id="6743180"><a href="/net/http/internal/chunked.go.html#4536158">NewChunkedWriter</a></span><span class="op" id="6743196">(</span><span class="op" id="6743197">&amp;</span><span class="ident" id="6743198"><a href="/net/http/internal/chunked_test.go.html#6743158">b</a></span><span class="op" id="6743199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6743202">const</span>&nbsp;<span class="ident" id="6743208">chunk1</span>&nbsp;<span class="op" id="6743215">=</span>&nbsp;<span class="string" id="6743217">&#34;hello,&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6743228">const</span>&nbsp;<span class="ident" id="6743234">chunk2</span>&nbsp;<span class="op" id="6743241">=</span>&nbsp;<span class="string" id="6743243">&#34;world!&nbsp;0123456789abcdef&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6743270"><a href="/net/http/internal/chunked_test.go.html#6743175">w</a></span><span class="op" id="6743271">.</span><span class="ident" id="6743272">Write</span><span class="op" id="6743277">(</span><span class="op" id="6743278">[</span><span class="op" id="6743279">]</span><span class="builtintype" id="6743280">byte</span><span class="op" id="6743284">(</span><span class="ident" id="6743285"><a href="/net/http/internal/chunked_test.go.html#6743208">chunk1</a></span><span class="op" id="6743291">)</span><span class="op" id="6743292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6743295"><a href="/net/http/internal/chunked_test.go.html#6743175">w</a></span><span class="op" id="6743296">.</span><span class="ident" id="6743297">Write</span><span class="op" id="6743302">(</span><span class="op" id="6743303">[</span><span class="op" id="6743304">]</span><span class="builtintype" id="6743305">byte</span><span class="op" id="6743309">(</span><span class="ident" id="6743310"><a href="/net/http/internal/chunked_test.go.html#6743234">chunk2</a></span><span class="op" id="6743316">)</span><span class="op" id="6743317">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6743320"><a href="/net/http/internal/chunked_test.go.html#6743175">w</a></span><span class="op" id="6743321">.</span><span class="ident" id="6743322">Close</span><span class="op" id="6743327">(</span><span class="op" id="6743328">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6743332">if</span>&nbsp;<span class="ident" id="6743335">g</span><span class="op" id="6743336">,</span>&nbsp;<span class="ident" id="6743338">e</span>&nbsp;<span class="op" id="6743340">:=</span>&nbsp;<span class="ident" id="6743343"><a href="/net/http/internal/chunked_test.go.html#6743158">b</a></span><span class="op" id="6743344">.</span><span class="ident" id="6743345">String</span><span class="op" id="6743351">(</span><span class="op" id="6743352">)</span><span class="op" id="6743353">,</span>&nbsp;<span class="string" id="6743355">&#34;7\r\nhello,&nbsp;\r\n17\r\nworld!&nbsp;0123456789abcdef\r\n0\r\n&#34;</span><span class="op" id="6743411">;</span>&nbsp;<span class="ident" id="6743413"><a href="/net/http/internal/chunked_test.go.html#6743335">g</a></span>&nbsp;<span class="op" id="6743415">!=</span>&nbsp;<span class="ident" id="6743418"><a href="/net/http/internal/chunked_test.go.html#6743338">e</a></span>&nbsp;<span class="op" id="6743420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6743424"><a href="/net/http/internal/chunked_test.go.html#6743137">t</a></span><span class="op" id="6743425">.</span><span class="ident" id="6743426">Fatalf</span><span class="op" id="6743432">(</span><span class="string" id="6743433">&#34;chunk&nbsp;writer&nbsp;wrote&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6743465">,</span>&nbsp;<span class="ident" id="6743467"><a href="/net/http/internal/chunked_test.go.html#6743335">g</a></span><span class="op" id="6743468">,</span>&nbsp;<span class="ident" id="6743470"><a href="/net/http/internal/chunked_test.go.html#6743338">e</a></span><span class="op" id="6743471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6743474">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6743478">r</span>&nbsp;<span class="op" id="6743480">:=</span>&nbsp;<span class="ident" id="6743483"><a href="/net/http/internal/chunked.go.html#4533267">NewChunkedReader</a></span><span class="op" id="6743499">(</span><span class="op" id="6743500">&amp;</span><span class="ident" id="6743501"><a href="/net/http/internal/chunked_test.go.html#6743158">b</a></span><span class="op" id="6743502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6743505">data</span><span class="op" id="6743509">,</span>&nbsp;<span class="ident" id="6743511">err</span>&nbsp;<span class="op" id="6743515">:=</span>&nbsp;<span class="ident" id="6743518"><a href="/net/http/internal/chunked_test.go.html#6743085">ioutil</a></span><span class="op" id="6743524">.</span><span class="ident" id="6743525">ReadAll</span><span class="op" id="6743532">(</span><span class="ident" id="6743533"><a href="/net/http/internal/chunked_test.go.html#6743478">r</a></span><span class="op" id="6743534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6743537">if</span>&nbsp;<span class="ident" id="6743540"><a href="/net/http/internal/chunked_test.go.html#6743511">err</a></span>&nbsp;<span class="op" id="6743544">!=</span>&nbsp;<span class="ident" id="6743547">nil</span>&nbsp;<span class="op" id="6743551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6743555"><a href="/net/http/internal/chunked_test.go.html#6743137">t</a></span><span class="op" id="6743556">.</span><span class="ident" id="6743557">Logf</span><span class="op" id="6743561">(</span><span class="string" id="6743562">`data:&nbsp;&#34;%s&#34;`</span><span class="op" id="6743574">,</span>&nbsp;<span class="ident" id="6743576"><a href="/net/http/internal/chunked_test.go.html#6743505">data</a></span><span class="op" id="6743580">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6743584"><a href="/net/http/internal/chunked_test.go.html#6743137">t</a></span><span class="op" id="6743585">.</span><span class="ident" id="6743586">Fatalf</span><span class="op" id="6743592">(</span><span class="string" id="6743593">&#34;ReadAll&nbsp;from&nbsp;reader:&nbsp;%v&#34;</span><span class="op" id="6743618">,</span>&nbsp;<span class="ident" id="6743620"><a href="/net/http/internal/chunked_test.go.html#6743511">err</a></span><span class="op" id="6743623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6743626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6743629">if</span>&nbsp;<span class="ident" id="6743632">g</span><span class="op" id="6743633">,</span>&nbsp;<span class="ident" id="6743635">e</span>&nbsp;<span class="op" id="6743637">:=</span>&nbsp;<span class="builtintype" id="6743640">string</span><span class="op" id="6743646">(</span><span class="ident" id="6743647"><a href="/net/http/internal/chunked_test.go.html#6743505">data</a></span><span class="op" id="6743651">)</span><span class="op" id="6743652">,</span>&nbsp;<span class="ident" id="6743654"><a href="/net/http/internal/chunked_test.go.html#6743208">chunk1</a></span><span class="op" id="6743660">+</span><span class="ident" id="6743661"><a href="/net/http/internal/chunked_test.go.html#6743234">chunk2</a></span><span class="op" id="6743667">;</span>&nbsp;<span class="ident" id="6743669"><a href="/net/http/internal/chunked_test.go.html#6743632">g</a></span>&nbsp;<span class="op" id="6743671">!=</span>&nbsp;<span class="ident" id="6743674"><a href="/net/http/internal/chunked_test.go.html#6743635">e</a></span>&nbsp;<span class="op" id="6743676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6743680"><a href="/net/http/internal/chunked_test.go.html#6743137">t</a></span><span class="op" id="6743681">.</span><span class="ident" id="6743682">Errorf</span><span class="op" id="6743688">(</span><span class="string" id="6743689">&#34;chunk&nbsp;reader&nbsp;read&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6743720">,</span>&nbsp;<span class="ident" id="6743722"><a href="/net/http/internal/chunked_test.go.html#6743632">g</a></span><span class="op" id="6743723">,</span>&nbsp;<span class="ident" id="6743725"><a href="/net/http/internal/chunked_test.go.html#6743635">e</a></span><span class="op" id="6743726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6743729">}</span><br>
<span class="lineno">40</span><span class="op" id="6743731">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6743734">func</span>&nbsp;<span class="ident" id="6743739">TestChunkReadMultiple</span><span class="op" id="6743760">(</span><span class="ident" id="6743761">t</span>&nbsp;<span class="op" id="6743763">*</span><span class="ident" id="6743764"><a href="/net/http/internal/chunked_test.go.html#6743109">testing</a></span><span class="op" id="6743771">.</span><span class="ident" id="6743772">T</span><span class="op" id="6743773">)</span>&nbsp;<span class="op" id="6743775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6743778">//&nbsp;Bunch&nbsp;of&nbsp;small&nbsp;chunks,&nbsp;all&nbsp;read&nbsp;together.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6743824">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6743828">var</span>&nbsp;<span class="ident" id="6743832">b</span>&nbsp;<span class="ident" id="6743834"><a href="/net/http/internal/chunked_test.go.html#6743063">bytes</a></span><span class="op" id="6743839">.</span><span class="ident" id="6743840">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6743849">w</span>&nbsp;<span class="op" id="6743851">:=</span>&nbsp;<span class="ident" id="6743854"><a href="/net/http/internal/chunked.go.html#4536158">NewChunkedWriter</a></span><span class="op" id="6743870">(</span><span class="op" id="6743871">&amp;</span><span class="ident" id="6743872"><a href="/net/http/internal/chunked_test.go.html#6743832">b</a></span><span class="op" id="6743873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6743877"><a href="/net/http/internal/chunked_test.go.html#6743849">w</a></span><span class="op" id="6743878">.</span><span class="ident" id="6743879">Write</span><span class="op" id="6743884">(</span><span class="op" id="6743885">[</span><span class="op" id="6743886">]</span><span class="builtintype" id="6743887">byte</span><span class="op" id="6743891">(</span><span class="string" id="6743892">&#34;foo&#34;</span><span class="op" id="6743897">)</span><span class="op" id="6743898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6743902"><a href="/net/http/internal/chunked_test.go.html#6743849">w</a></span><span class="op" id="6743903">.</span><span class="ident" id="6743904">Write</span><span class="op" id="6743909">(</span><span class="op" id="6743910">[</span><span class="op" id="6743911">]</span><span class="builtintype" id="6743912">byte</span><span class="op" id="6743916">(</span><span class="string" id="6743917">&#34;bar&#34;</span><span class="op" id="6743922">)</span><span class="op" id="6743923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6743927"><a href="/net/http/internal/chunked_test.go.html#6743849">w</a></span><span class="op" id="6743928">.</span><span class="ident" id="6743929">Close</span><span class="op" id="6743934">(</span><span class="op" id="6743935">)</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6743940">r</span>&nbsp;<span class="op" id="6743942">:=</span>&nbsp;<span class="ident" id="6743945"><a href="/net/http/internal/chunked.go.html#4533267">NewChunkedReader</a></span><span class="op" id="6743961">(</span><span class="op" id="6743962">&amp;</span><span class="ident" id="6743963"><a href="/net/http/internal/chunked_test.go.html#6743832">b</a></span><span class="op" id="6743964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6743968">buf</span>&nbsp;<span class="op" id="6743972">:=</span>&nbsp;<span class="builtinfunc" id="6743975">make</span><span class="op" id="6743979">(</span><span class="op" id="6743980">[</span><span class="op" id="6743981">]</span><span class="builtintype" id="6743982">byte</span><span class="op" id="6743986">,</span>&nbsp;<span class="num" id="6743988">10</span><span class="op" id="6743990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6743994">n</span><span class="op" id="6743995">,</span>&nbsp;<span class="ident" id="6743997">err</span>&nbsp;<span class="op" id="6744001">:=</span>&nbsp;<span class="ident" id="6744004"><a href="/net/http/internal/chunked_test.go.html#6743940">r</a></span><span class="op" id="6744005">.</span><span class="ident" id="6744006">Read</span><span class="op" id="6744010">(</span><span class="ident" id="6744011"><a href="/net/http/internal/chunked_test.go.html#6743968">buf</a></span><span class="op" id="6744014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6744018">if</span>&nbsp;<span class="ident" id="6744021"><a href="/net/http/internal/chunked_test.go.html#6743994">n</a></span>&nbsp;<span class="op" id="6744023">!=</span>&nbsp;<span class="num" id="6744026">6</span>&nbsp;<span class="op" id="6744028">||</span>&nbsp;<span class="ident" id="6744031"><a href="/net/http/internal/chunked_test.go.html#6743997">err</a></span>&nbsp;<span class="op" id="6744035">!=</span>&nbsp;<span class="ident" id="6744038"><a href="/net/http/internal/chunked_test.go.html#6743079">io</a></span><span class="op" id="6744040">.</span><span class="ident" id="6744041">EOF</span>&nbsp;<span class="op" id="6744045">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6744050"><a href="/net/http/internal/chunked_test.go.html#6743761">t</a></span><span class="op" id="6744051">.</span><span class="ident" id="6744052">Errorf</span><span class="op" id="6744058">(</span><span class="string" id="6744059">&#34;Read&nbsp;=&nbsp;%d,&nbsp;%v;&nbsp;want&nbsp;6,&nbsp;EOF&#34;</span><span class="op" id="6744087">,</span>&nbsp;<span class="ident" id="6744089"><a href="/net/http/internal/chunked_test.go.html#6743994">n</a></span><span class="op" id="6744090">,</span>&nbsp;<span class="ident" id="6744092"><a href="/net/http/internal/chunked_test.go.html#6743997">err</a></span><span class="op" id="6744095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6744099">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6744103"><a href="/net/http/internal/chunked_test.go.html#6743968">buf</a></span>&nbsp;<span class="op" id="6744107">=</span>&nbsp;<span class="ident" id="6744109"><a href="/net/http/internal/chunked_test.go.html#6743968">buf</a></span><span class="op" id="6744112">[</span><span class="op" id="6744113">:</span><span class="ident" id="6744114"><a href="/net/http/internal/chunked_test.go.html#6743994">n</a></span><span class="op" id="6744115">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6744119">if</span>&nbsp;<span class="builtintype" id="6744122">string</span><span class="op" id="6744128">(</span><span class="ident" id="6744129"><a href="/net/http/internal/chunked_test.go.html#6743968">buf</a></span><span class="op" id="6744132">)</span>&nbsp;<span class="op" id="6744134">!=</span>&nbsp;<span class="string" id="6744137">&#34;foobar&#34;</span>&nbsp;<span class="op" id="6744146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6744151"><a href="/net/http/internal/chunked_test.go.html#6743761">t</a></span><span class="op" id="6744152">.</span><span class="ident" id="6744153">Errorf</span><span class="op" id="6744159">(</span><span class="string" id="6744160">&#34;Read&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6744180">,</span>&nbsp;<span class="ident" id="6744182"><a href="/net/http/internal/chunked_test.go.html#6743968">buf</a></span><span class="op" id="6744185">,</span>&nbsp;<span class="string" id="6744187">&#34;foobar&#34;</span><span class="op" id="6744195">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6744199">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6744202">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6744206">//&nbsp;One&nbsp;big&nbsp;chunk&nbsp;followed&nbsp;by&nbsp;a&nbsp;little&nbsp;chunk,&nbsp;but&nbsp;the&nbsp;small&nbsp;bufio.Reader&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6744284">//&nbsp;should&nbsp;prevent&nbsp;the&nbsp;second&nbsp;chunk&nbsp;header&nbsp;from&nbsp;being&nbsp;read.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6744344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6744348">var</span>&nbsp;<span class="ident" id="6744352">b</span>&nbsp;<span class="ident" id="6744354"><a href="/net/http/internal/chunked_test.go.html#6743063">bytes</a></span><span class="op" id="6744359">.</span><span class="ident" id="6744360">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6744369">w</span>&nbsp;<span class="op" id="6744371">:=</span>&nbsp;<span class="ident" id="6744374"><a href="/net/http/internal/chunked.go.html#4536158">NewChunkedWriter</a></span><span class="op" id="6744390">(</span><span class="op" id="6744391">&amp;</span><span class="ident" id="6744392"><a href="/net/http/internal/chunked_test.go.html#6744352">b</a></span><span class="op" id="6744393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6744397">//&nbsp;fillBufChunk&nbsp;is&nbsp;11&nbsp;bytes&nbsp;+&nbsp;3&nbsp;bytes&nbsp;header&nbsp;+&nbsp;2&nbsp;bytes&nbsp;footer&nbsp;=&nbsp;16&nbsp;bytes,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6744473">//&nbsp;the&nbsp;same&nbsp;as&nbsp;the&nbsp;bufio&nbsp;ReaderSize&nbsp;below&nbsp;(the&nbsp;minimum),&nbsp;so&nbsp;even</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6744540">//&nbsp;though&nbsp;we&#39;re&nbsp;going&nbsp;to&nbsp;try&nbsp;to&nbsp;Read&nbsp;with&nbsp;a&nbsp;buffer&nbsp;larger&nbsp;enough&nbsp;to&nbsp;also</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6744615">//&nbsp;receive&nbsp;&#34;foo&#34;,&nbsp;the&nbsp;second&nbsp;chunk&nbsp;header&nbsp;won&#39;t&nbsp;be&nbsp;read&nbsp;yet.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6744678">const</span>&nbsp;<span class="ident" id="6744684">fillBufChunk</span>&nbsp;<span class="op" id="6744697">=</span>&nbsp;<span class="string" id="6744699">&#34;0123456789a&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6744715">const</span>&nbsp;<span class="ident" id="6744721">shortChunk</span>&nbsp;<span class="op" id="6744732">=</span>&nbsp;<span class="string" id="6744734">&#34;foo&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6744742"><a href="/net/http/internal/chunked_test.go.html#6744369">w</a></span><span class="op" id="6744743">.</span><span class="ident" id="6744744">Write</span><span class="op" id="6744749">(</span><span class="op" id="6744750">[</span><span class="op" id="6744751">]</span><span class="builtintype" id="6744752">byte</span><span class="op" id="6744756">(</span><span class="ident" id="6744757"><a href="/net/http/internal/chunked_test.go.html#6744684">fillBufChunk</a></span><span class="op" id="6744769">)</span><span class="op" id="6744770">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6744774"><a href="/net/http/internal/chunked_test.go.html#6744369">w</a></span><span class="op" id="6744775">.</span><span class="ident" id="6744776">Write</span><span class="op" id="6744781">(</span><span class="op" id="6744782">[</span><span class="op" id="6744783">]</span><span class="builtintype" id="6744784">byte</span><span class="op" id="6744788">(</span><span class="ident" id="6744789"><a href="/net/http/internal/chunked_test.go.html#6744721">shortChunk</a></span><span class="op" id="6744799">)</span><span class="op" id="6744800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6744804"><a href="/net/http/internal/chunked_test.go.html#6744369">w</a></span><span class="op" id="6744805">.</span><span class="ident" id="6744806">Close</span><span class="op" id="6744811">(</span><span class="op" id="6744812">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6744817">r</span>&nbsp;<span class="op" id="6744819">:=</span>&nbsp;<span class="ident" id="6744822"><a href="/net/http/internal/chunked.go.html#4533267">NewChunkedReader</a></span><span class="op" id="6744838">(</span><span class="ident" id="6744839"><a href="/net/http/internal/chunked_test.go.html#6743054">bufio</a></span><span class="op" id="6744844">.</span><span class="ident" id="6744845">NewReaderSize</span><span class="op" id="6744858">(</span><span class="op" id="6744859">&amp;</span><span class="ident" id="6744860"><a href="/net/http/internal/chunked_test.go.html#6744352">b</a></span><span class="op" id="6744861">,</span>&nbsp;<span class="num" id="6744863">16</span><span class="op" id="6744865">)</span><span class="op" id="6744866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6744870">buf</span>&nbsp;<span class="op" id="6744874">:=</span>&nbsp;<span class="builtinfunc" id="6744877">make</span><span class="op" id="6744881">(</span><span class="op" id="6744882">[</span><span class="op" id="6744883">]</span><span class="builtintype" id="6744884">byte</span><span class="op" id="6744888">,</span>&nbsp;<span class="builtinfunc" id="6744890">len</span><span class="op" id="6744893">(</span><span class="ident" id="6744894"><a href="/net/http/internal/chunked_test.go.html#6744684">fillBufChunk</a></span><span class="op" id="6744906">)</span><span class="op" id="6744907">+</span><span class="builtinfunc" id="6744908">len</span><span class="op" id="6744911">(</span><span class="ident" id="6744912"><a href="/net/http/internal/chunked_test.go.html#6744721">shortChunk</a></span><span class="op" id="6744922">)</span><span class="op" id="6744923">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6744927">n</span><span class="op" id="6744928">,</span>&nbsp;<span class="ident" id="6744930">err</span>&nbsp;<span class="op" id="6744934">:=</span>&nbsp;<span class="ident" id="6744937"><a href="/net/http/internal/chunked_test.go.html#6744817">r</a></span><span class="op" id="6744938">.</span><span class="ident" id="6744939">Read</span><span class="op" id="6744943">(</span><span class="ident" id="6744944"><a href="/net/http/internal/chunked_test.go.html#6744870">buf</a></span><span class="op" id="6744947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6744951">if</span>&nbsp;<span class="ident" id="6744954"><a href="/net/http/internal/chunked_test.go.html#6744927">n</a></span>&nbsp;<span class="op" id="6744956">!=</span>&nbsp;<span class="builtinfunc" id="6744959">len</span><span class="op" id="6744962">(</span><span class="ident" id="6744963"><a href="/net/http/internal/chunked_test.go.html#6744684">fillBufChunk</a></span><span class="op" id="6744975">)</span>&nbsp;<span class="op" id="6744977">||</span>&nbsp;<span class="ident" id="6744980"><a href="/net/http/internal/chunked_test.go.html#6744930">err</a></span>&nbsp;<span class="op" id="6744984">!=</span>&nbsp;<span class="ident" id="6744987">nil</span>&nbsp;<span class="op" id="6744991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6744996"><a href="/net/http/internal/chunked_test.go.html#6743761">t</a></span><span class="op" id="6744997">.</span><span class="ident" id="6744998">Errorf</span><span class="op" id="6745004">(</span><span class="string" id="6745005">&#34;Read&nbsp;=&nbsp;%d,&nbsp;%v;&nbsp;want&nbsp;%d,&nbsp;nil&#34;</span><span class="op" id="6745034">,</span>&nbsp;<span class="ident" id="6745036"><a href="/net/http/internal/chunked_test.go.html#6744927">n</a></span><span class="op" id="6745037">,</span>&nbsp;<span class="ident" id="6745039"><a href="/net/http/internal/chunked_test.go.html#6744930">err</a></span><span class="op" id="6745042">,</span>&nbsp;<span class="builtinfunc" id="6745044">len</span><span class="op" id="6745047">(</span><span class="ident" id="6745048"><a href="/net/http/internal/chunked_test.go.html#6744684">fillBufChunk</a></span><span class="op" id="6745060">)</span><span class="op" id="6745061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6745065">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6745069"><a href="/net/http/internal/chunked_test.go.html#6744870">buf</a></span>&nbsp;<span class="op" id="6745073">=</span>&nbsp;<span class="ident" id="6745075"><a href="/net/http/internal/chunked_test.go.html#6744870">buf</a></span><span class="op" id="6745078">[</span><span class="op" id="6745079">:</span><span class="ident" id="6745080"><a href="/net/http/internal/chunked_test.go.html#6744927">n</a></span><span class="op" id="6745081">]</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6745085">if</span>&nbsp;<span class="builtintype" id="6745088">string</span><span class="op" id="6745094">(</span><span class="ident" id="6745095"><a href="/net/http/internal/chunked_test.go.html#6744870">buf</a></span><span class="op" id="6745098">)</span>&nbsp;<span class="op" id="6745100">!=</span>&nbsp;<span class="ident" id="6745103"><a href="/net/http/internal/chunked_test.go.html#6744684">fillBufChunk</a></span>&nbsp;<span class="op" id="6745116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6745121"><a href="/net/http/internal/chunked_test.go.html#6743761">t</a></span><span class="op" id="6745122">.</span><span class="ident" id="6745123">Errorf</span><span class="op" id="6745129">(</span><span class="string" id="6745130">&#34;Read&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6745150">,</span>&nbsp;<span class="ident" id="6745152"><a href="/net/http/internal/chunked_test.go.html#6744870">buf</a></span><span class="op" id="6745155">,</span>&nbsp;<span class="ident" id="6745157"><a href="/net/http/internal/chunked_test.go.html#6744684">fillBufChunk</a></span><span class="op" id="6745169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6745173">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6745178"><a href="/net/http/internal/chunked_test.go.html#6744927">n</a></span><span class="op" id="6745179">,</span>&nbsp;<span class="ident" id="6745181"><a href="/net/http/internal/chunked_test.go.html#6744930">err</a></span>&nbsp;<span class="op" id="6745185">=</span>&nbsp;<span class="ident" id="6745187"><a href="/net/http/internal/chunked_test.go.html#6744817">r</a></span><span class="op" id="6745188">.</span><span class="ident" id="6745189">Read</span><span class="op" id="6745193">(</span><span class="ident" id="6745194"><a href="/net/http/internal/chunked_test.go.html#6744870">buf</a></span><span class="op" id="6745197">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6745201">if</span>&nbsp;<span class="ident" id="6745204"><a href="/net/http/internal/chunked_test.go.html#6744927">n</a></span>&nbsp;<span class="op" id="6745206">!=</span>&nbsp;<span class="builtinfunc" id="6745209">len</span><span class="op" id="6745212">(</span><span class="ident" id="6745213"><a href="/net/http/internal/chunked_test.go.html#6744721">shortChunk</a></span><span class="op" id="6745223">)</span>&nbsp;<span class="op" id="6745225">||</span>&nbsp;<span class="ident" id="6745228"><a href="/net/http/internal/chunked_test.go.html#6744930">err</a></span>&nbsp;<span class="op" id="6745232">!=</span>&nbsp;<span class="ident" id="6745235"><a href="/net/http/internal/chunked_test.go.html#6743079">io</a></span><span class="op" id="6745237">.</span><span class="ident" id="6745238">EOF</span>&nbsp;<span class="op" id="6745242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6745247"><a href="/net/http/internal/chunked_test.go.html#6743761">t</a></span><span class="op" id="6745248">.</span><span class="ident" id="6745249">Errorf</span><span class="op" id="6745255">(</span><span class="string" id="6745256">&#34;Read&nbsp;=&nbsp;%d,&nbsp;%v;&nbsp;want&nbsp;%d,&nbsp;EOF&#34;</span><span class="op" id="6745285">,</span>&nbsp;<span class="ident" id="6745287"><a href="/net/http/internal/chunked_test.go.html#6744927">n</a></span><span class="op" id="6745288">,</span>&nbsp;<span class="ident" id="6745290"><a href="/net/http/internal/chunked_test.go.html#6744930">err</a></span><span class="op" id="6745293">,</span>&nbsp;<span class="builtinfunc" id="6745295">len</span><span class="op" id="6745298">(</span><span class="ident" id="6745299"><a href="/net/http/internal/chunked_test.go.html#6744721">shortChunk</a></span><span class="op" id="6745309">)</span><span class="op" id="6745310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6745314">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6745317">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6745321">//&nbsp;And&nbsp;test&nbsp;that&nbsp;we&nbsp;see&nbsp;an&nbsp;EOF&nbsp;chunk,&nbsp;even&nbsp;though&nbsp;our&nbsp;buffer&nbsp;is&nbsp;already&nbsp;full:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6745400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6745404">r</span>&nbsp;<span class="op" id="6745406">:=</span>&nbsp;<span class="ident" id="6745409"><a href="/net/http/internal/chunked.go.html#4533267">NewChunkedReader</a></span><span class="op" id="6745425">(</span><span class="ident" id="6745426"><a href="/net/http/internal/chunked_test.go.html#6743054">bufio</a></span><span class="op" id="6745431">.</span><span class="ident" id="6745432">NewReader</span><span class="op" id="6745441">(</span><span class="ident" id="6745442"><a href="/net/http/internal/chunked_test.go.html#6743098">strings</a></span><span class="op" id="6745449">.</span><span class="ident" id="6745450">NewReader</span><span class="op" id="6745459">(</span><span class="string" id="6745460">&#34;3\r\nfoo\r\n0\r\n&#34;</span><span class="op" id="6745479">)</span><span class="op" id="6745480">)</span><span class="op" id="6745481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6745485">buf</span>&nbsp;<span class="op" id="6745489">:=</span>&nbsp;<span class="builtinfunc" id="6745492">make</span><span class="op" id="6745496">(</span><span class="op" id="6745497">[</span><span class="op" id="6745498">]</span><span class="builtintype" id="6745499">byte</span><span class="op" id="6745503">,</span>&nbsp;<span class="num" id="6745505">3</span><span class="op" id="6745506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6745510">n</span><span class="op" id="6745511">,</span>&nbsp;<span class="ident" id="6745513">err</span>&nbsp;<span class="op" id="6745517">:=</span>&nbsp;<span class="ident" id="6745520"><a href="/net/http/internal/chunked_test.go.html#6745404">r</a></span><span class="op" id="6745521">.</span><span class="ident" id="6745522">Read</span><span class="op" id="6745526">(</span><span class="ident" id="6745527"><a href="/net/http/internal/chunked_test.go.html#6745485">buf</a></span><span class="op" id="6745530">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6745534">if</span>&nbsp;<span class="ident" id="6745537"><a href="/net/http/internal/chunked_test.go.html#6745510">n</a></span>&nbsp;<span class="op" id="6745539">!=</span>&nbsp;<span class="num" id="6745542">3</span>&nbsp;<span class="op" id="6745544">||</span>&nbsp;<span class="ident" id="6745547"><a href="/net/http/internal/chunked_test.go.html#6745513">err</a></span>&nbsp;<span class="op" id="6745551">!=</span>&nbsp;<span class="ident" id="6745554"><a href="/net/http/internal/chunked_test.go.html#6743079">io</a></span><span class="op" id="6745556">.</span><span class="ident" id="6745557">EOF</span>&nbsp;<span class="op" id="6745561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6745566"><a href="/net/http/internal/chunked_test.go.html#6743761">t</a></span><span class="op" id="6745567">.</span><span class="ident" id="6745568">Errorf</span><span class="op" id="6745574">(</span><span class="string" id="6745575">&#34;Read&nbsp;=&nbsp;%d,&nbsp;%v;&nbsp;want&nbsp;3,&nbsp;EOF&#34;</span><span class="op" id="6745603">,</span>&nbsp;<span class="ident" id="6745605"><a href="/net/http/internal/chunked_test.go.html#6745510">n</a></span><span class="op" id="6745606">,</span>&nbsp;<span class="ident" id="6745608"><a href="/net/http/internal/chunked_test.go.html#6745513">err</a></span><span class="op" id="6745611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6745615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6745619">if</span>&nbsp;<span class="builtintype" id="6745622">string</span><span class="op" id="6745628">(</span><span class="ident" id="6745629"><a href="/net/http/internal/chunked_test.go.html#6745485">buf</a></span><span class="op" id="6745632">)</span>&nbsp;<span class="op" id="6745634">!=</span>&nbsp;<span class="string" id="6745637">&#34;foo&#34;</span>&nbsp;<span class="op" id="6745643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6745648"><a href="/net/http/internal/chunked_test.go.html#6743761">t</a></span><span class="op" id="6745649">.</span><span class="ident" id="6745650">Errorf</span><span class="op" id="6745656">(</span><span class="string" id="6745657">&#34;buf&nbsp;=&nbsp;%q;&nbsp;want&nbsp;foo&#34;</span><span class="op" id="6745677">,</span>&nbsp;<span class="ident" id="6745679"><a href="/net/http/internal/chunked_test.go.html#6745485">buf</a></span><span class="op" id="6745682">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6745686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6745689">}</span><br>
<span class="lineno"></span><span class="op" id="6745691">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6745694">func</span>&nbsp;<span class="ident" id="6745699">TestChunkReaderAllocs</span><span class="op" id="6745720">(</span><span class="ident" id="6745721">t</span>&nbsp;<span class="op" id="6745723">*</span><span class="ident" id="6745724"><a href="/net/http/internal/chunked_test.go.html#6743109">testing</a></span><span class="op" id="6745731">.</span><span class="ident" id="6745732">T</span><span class="op" id="6745733">)</span>&nbsp;<span class="op" id="6745735">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6745738">if</span>&nbsp;<span class="ident" id="6745741"><a href="/net/http/internal/chunked_test.go.html#6743109">testing</a></span><span class="op" id="6745748">.</span><span class="ident" id="6745749">Short</span><span class="op" id="6745754">(</span><span class="op" id="6745755">)</span>&nbsp;<span class="op" id="6745757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6745761"><a href="/net/http/internal/chunked_test.go.html#6745721">t</a></span><span class="op" id="6745762">.</span><span class="ident" id="6745763">Skip</span><span class="op" id="6745767">(</span><span class="string" id="6745768">&#34;skipping&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="6745792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6745795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6745798">var</span>&nbsp;<span class="ident" id="6745802">buf</span>&nbsp;<span class="ident" id="6745806"><a href="/net/http/internal/chunked_test.go.html#6743063">bytes</a></span><span class="op" id="6745811">.</span><span class="ident" id="6745812">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6745820">w</span>&nbsp;<span class="op" id="6745822">:=</span>&nbsp;<span class="ident" id="6745825"><a href="/net/http/internal/chunked.go.html#4536158">NewChunkedWriter</a></span><span class="op" id="6745841">(</span><span class="op" id="6745842">&amp;</span><span class="ident" id="6745843"><a href="/net/http/internal/chunked_test.go.html#6745802">buf</a></span><span class="op" id="6745846">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6745849">a</span><span class="op" id="6745850">,</span>&nbsp;<span class="ident" id="6745852">b</span><span class="op" id="6745853">,</span>&nbsp;<span class="ident" id="6745855">c</span>&nbsp;<span class="op" id="6745857">:=</span>&nbsp;<span class="op" id="6745860">[</span><span class="op" id="6745861">]</span><span class="builtintype" id="6745862">byte</span><span class="op" id="6745866">(</span><span class="string" id="6745867">&#34;aaaaaa&#34;</span><span class="op" id="6745875">)</span><span class="op" id="6745876">,</span>&nbsp;<span class="op" id="6745878">[</span><span class="op" id="6745879">]</span><span class="builtintype" id="6745880">byte</span><span class="op" id="6745884">(</span><span class="string" id="6745885">&#34;bbbbbbbbbbbb&#34;</span><span class="op" id="6745899">)</span><span class="op" id="6745900">,</span>&nbsp;<span class="op" id="6745902">[</span><span class="op" id="6745903">]</span><span class="builtintype" id="6745904">byte</span><span class="op" id="6745908">(</span><span class="string" id="6745909">&#34;cccccccccccccccccccccccc&#34;</span><span class="op" id="6745935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6745938"><a href="/net/http/internal/chunked_test.go.html#6745820">w</a></span><span class="op" id="6745939">.</span><span class="ident" id="6745940">Write</span><span class="op" id="6745945">(</span><span class="ident" id="6745946"><a href="/net/http/internal/chunked_test.go.html#6745849">a</a></span><span class="op" id="6745947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6745950"><a href="/net/http/internal/chunked_test.go.html#6745820">w</a></span><span class="op" id="6745951">.</span><span class="ident" id="6745952">Write</span><span class="op" id="6745957">(</span><span class="ident" id="6745958"><a href="/net/http/internal/chunked_test.go.html#6745852">b</a></span><span class="op" id="6745959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6745962"><a href="/net/http/internal/chunked_test.go.html#6745820">w</a></span><span class="op" id="6745963">.</span><span class="ident" id="6745964">Write</span><span class="op" id="6745969">(</span><span class="ident" id="6745970"><a href="/net/http/internal/chunked_test.go.html#6745855">c</a></span><span class="op" id="6745971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6745974"><a href="/net/http/internal/chunked_test.go.html#6745820">w</a></span><span class="op" id="6745975">.</span><span class="ident" id="6745976">Close</span><span class="op" id="6745981">(</span><span class="op" id="6745982">)</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6745986">readBuf</span>&nbsp;<span class="op" id="6745994">:=</span>&nbsp;<span class="builtinfunc" id="6745997">make</span><span class="op" id="6746001">(</span><span class="op" id="6746002">[</span><span class="op" id="6746003">]</span><span class="builtintype" id="6746004">byte</span><span class="op" id="6746008">,</span>&nbsp;<span class="builtinfunc" id="6746010">len</span><span class="op" id="6746013">(</span><span class="ident" id="6746014"><a href="/net/http/internal/chunked_test.go.html#6745849">a</a></span><span class="op" id="6746015">)</span><span class="op" id="6746016">+</span><span class="builtinfunc" id="6746017">len</span><span class="op" id="6746020">(</span><span class="ident" id="6746021"><a href="/net/http/internal/chunked_test.go.html#6745852">b</a></span><span class="op" id="6746022">)</span><span class="op" id="6746023">+</span><span class="builtinfunc" id="6746024">len</span><span class="op" id="6746027">(</span><span class="ident" id="6746028"><a href="/net/http/internal/chunked_test.go.html#6745855">c</a></span><span class="op" id="6746029">)</span><span class="op" id="6746030">+</span><span class="num" id="6746031">1</span><span class="op" id="6746032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6746035">byter</span>&nbsp;<span class="op" id="6746041">:=</span>&nbsp;<span class="ident" id="6746044"><a href="/net/http/internal/chunked_test.go.html#6743063">bytes</a></span><span class="op" id="6746049">.</span><span class="ident" id="6746050">NewReader</span><span class="op" id="6746059">(</span><span class="ident" id="6746060"><a href="/net/http/internal/chunked_test.go.html#6745802">buf</a></span><span class="op" id="6746063">.</span><span class="ident" id="6746064">Bytes</span><span class="op" id="6746069">(</span><span class="op" id="6746070">)</span><span class="op" id="6746071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6746074">bufr</span>&nbsp;<span class="op" id="6746079">:=</span>&nbsp;<span class="ident" id="6746082"><a href="/net/http/internal/chunked_test.go.html#6743054">bufio</a></span><span class="op" id="6746087">.</span><span class="ident" id="6746088">NewReader</span><span class="op" id="6746097">(</span><span class="ident" id="6746098"><a href="/net/http/internal/chunked_test.go.html#6746035">byter</a></span><span class="op" id="6746103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6746106">mallocs</span>&nbsp;<span class="op" id="6746114">:=</span>&nbsp;<span class="ident" id="6746117"><a href="/net/http/internal/chunked_test.go.html#6743109">testing</a></span><span class="op" id="6746124">.</span><span class="ident" id="6746125">AllocsPerRun</span><span class="op" id="6746137">(</span><span class="num" id="6746138">100</span><span class="op" id="6746141">,</span>&nbsp;<span class="keyword" id="6746143">func</span><span class="op" id="6746147">(</span><span class="op" id="6746148">)</span>&nbsp;<span class="op" id="6746150">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6746154"><a href="/net/http/internal/chunked_test.go.html#6746035">byter</a></span><span class="op" id="6746159">.</span><span class="ident" id="6746160">Seek</span><span class="op" id="6746164">(</span><span class="num" id="6746165">0</span><span class="op" id="6746166">,</span>&nbsp;<span class="num" id="6746168">0</span><span class="op" id="6746169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6746173"><a href="/net/http/internal/chunked_test.go.html#6746074">bufr</a></span><span class="op" id="6746177">.</span><span class="ident" id="6746178">Reset</span><span class="op" id="6746183">(</span><span class="ident" id="6746184"><a href="/net/http/internal/chunked_test.go.html#6746035">byter</a></span><span class="op" id="6746189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6746193">r</span>&nbsp;<span class="op" id="6746195">:=</span>&nbsp;<span class="ident" id="6746198"><a href="/net/http/internal/chunked.go.html#4533267">NewChunkedReader</a></span><span class="op" id="6746214">(</span><span class="ident" id="6746215"><a href="/net/http/internal/chunked_test.go.html#6746074">bufr</a></span><span class="op" id="6746219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6746223">n</span><span class="op" id="6746224">,</span>&nbsp;<span class="ident" id="6746226">err</span>&nbsp;<span class="op" id="6746230">:=</span>&nbsp;<span class="ident" id="6746233"><a href="/net/http/internal/chunked_test.go.html#6743079">io</a></span><span class="op" id="6746235">.</span><span class="ident" id="6746236">ReadFull</span><span class="op" id="6746244">(</span><span class="ident" id="6746245"><a href="/net/http/internal/chunked_test.go.html#6746193">r</a></span><span class="op" id="6746246">,</span>&nbsp;<span class="ident" id="6746248"><a href="/net/http/internal/chunked_test.go.html#6745986">readBuf</a></span><span class="op" id="6746255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6746259">if</span>&nbsp;<span class="ident" id="6746262"><a href="/net/http/internal/chunked_test.go.html#6746223">n</a></span>&nbsp;<span class="op" id="6746264">!=</span>&nbsp;<span class="builtinfunc" id="6746267">len</span><span class="op" id="6746270">(</span><span class="ident" id="6746271"><a href="/net/http/internal/chunked_test.go.html#6745986">readBuf</a></span><span class="op" id="6746278">)</span><span class="op" id="6746279">-</span><span class="num" id="6746280">1</span>&nbsp;<span class="op" id="6746282">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6746287"><a href="/net/http/internal/chunked_test.go.html#6745721">t</a></span><span class="op" id="6746288">.</span><span class="ident" id="6746289">Fatalf</span><span class="op" id="6746295">(</span><span class="string" id="6746296">&#34;read&nbsp;%d&nbsp;bytes;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="6746320">,</span>&nbsp;<span class="ident" id="6746322"><a href="/net/http/internal/chunked_test.go.html#6746223">n</a></span><span class="op" id="6746323">,</span>&nbsp;<span class="builtinfunc" id="6746325">len</span><span class="op" id="6746328">(</span><span class="ident" id="6746329"><a href="/net/http/internal/chunked_test.go.html#6745986">readBuf</a></span><span class="op" id="6746336">)</span><span class="op" id="6746337">-</span><span class="num" id="6746338">1</span><span class="op" id="6746339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6746343">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6746347">if</span>&nbsp;<span class="ident" id="6746350"><a href="/net/http/internal/chunked_test.go.html#6746226">err</a></span>&nbsp;<span class="op" id="6746354">!=</span>&nbsp;<span class="ident" id="6746357"><a href="/net/http/internal/chunked_test.go.html#6743079">io</a></span><span class="op" id="6746359">.</span><span class="ident" id="6746360">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="6746377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6746382"><a href="/net/http/internal/chunked_test.go.html#6745721">t</a></span><span class="op" id="6746383">.</span><span class="ident" id="6746384">Fatalf</span><span class="op" id="6746390">(</span><span class="string" id="6746391">&#34;read&nbsp;error&nbsp;=&nbsp;%v;&nbsp;want&nbsp;ErrUnexpectedEOF&#34;</span><span class="op" id="6746431">,</span>&nbsp;<span class="ident" id="6746433"><a href="/net/http/internal/chunked_test.go.html#6746226">err</a></span><span class="op" id="6746436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6746440">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6746443">}</span><span class="op" id="6746444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6746447">if</span>&nbsp;<span class="ident" id="6746450"><a href="/net/http/internal/chunked_test.go.html#6746106">mallocs</a></span>&nbsp;<span class="op" id="6746458">&gt;</span>&nbsp;<span class="num" id="6746460">1.5</span>&nbsp;<span class="op" id="6746464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6746468"><a href="/net/http/internal/chunked_test.go.html#6745721">t</a></span><span class="op" id="6746469">.</span><span class="ident" id="6746470">Errorf</span><span class="op" id="6746476">(</span><span class="string" id="6746477">&#34;mallocs&nbsp;=&nbsp;%v;&nbsp;want&nbsp;1&#34;</span><span class="op" id="6746499">,</span>&nbsp;<span class="ident" id="6746501"><a href="/net/http/internal/chunked_test.go.html#6746106">mallocs</a></span><span class="op" id="6746508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6746511">}</span><br>
<span class="lineno"></span><span class="op" id="6746513">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="keyword" id="6746516">func</span>&nbsp;<span class="ident" id="6746521">TestParseHexUint</span><span class="op" id="6746537">(</span><span class="ident" id="6746538">t</span>&nbsp;<span class="op" id="6746540">*</span><span class="ident" id="6746541"><a href="/net/http/internal/chunked_test.go.html#6743109">testing</a></span><span class="op" id="6746548">.</span><span class="ident" id="6746549">T</span><span class="op" id="6746550">)</span>&nbsp;<span class="op" id="6746552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6746555">for</span>&nbsp;<span class="ident" id="6746559">i</span>&nbsp;<span class="op" id="6746561">:=</span>&nbsp;<span class="ident" id="6746564">uint64</span><span class="op" id="6746570">(</span><span class="num" id="6746571">0</span><span class="op" id="6746572">)</span><span class="op" id="6746573">;</span>&nbsp;<span class="ident" id="6746575"><a href="/net/http/internal/chunked_test.go.html#6746559">i</a></span>&nbsp;<span class="op" id="6746577">&lt;=</span>&nbsp;<span class="num" id="6746580">1234</span><span class="op" id="6746584">;</span>&nbsp;<span class="ident" id="6746586"><a href="/net/http/internal/chunked_test.go.html#6746559">i</a></span><span class="op" id="6746587">++</span>&nbsp;<span class="op" id="6746590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6746594">line</span>&nbsp;<span class="op" id="6746599">:=</span>&nbsp;<span class="op" id="6746602">[</span><span class="op" id="6746603">]</span><span class="builtintype" id="6746604">byte</span><span class="op" id="6746608">(</span><span class="ident" id="6746609"><a href="/net/http/internal/chunked_test.go.html#6743072">fmt</a></span><span class="op" id="6746612">.</span><span class="ident" id="6746613">Sprintf</span><span class="op" id="6746620">(</span><span class="string" id="6746621">&#34;%x&#34;</span><span class="op" id="6746625">,</span>&nbsp;<span class="ident" id="6746627"><a href="/net/http/internal/chunked_test.go.html#6746559">i</a></span><span class="op" id="6746628">)</span><span class="op" id="6746629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6746633">got</span><span class="op" id="6746636">,</span>&nbsp;<span class="ident" id="6746638">err</span>&nbsp;<span class="op" id="6746642">:=</span>&nbsp;<span class="ident" id="6746645"><a href="/net/http/internal/chunked.go.html#4537153">parseHexUint</a></span><span class="op" id="6746657">(</span><span class="ident" id="6746658"><a href="/net/http/internal/chunked_test.go.html#6746594">line</a></span><span class="op" id="6746662">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6746666">if</span>&nbsp;<span class="ident" id="6746669"><a href="/net/http/internal/chunked_test.go.html#6746638">err</a></span>&nbsp;<span class="op" id="6746673">!=</span>&nbsp;<span class="ident" id="6746676">nil</span>&nbsp;<span class="op" id="6746680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6746685"><a href="/net/http/internal/chunked_test.go.html#6746538">t</a></span><span class="op" id="6746686">.</span><span class="ident" id="6746687">Fatalf</span><span class="op" id="6746693">(</span><span class="string" id="6746694">&#34;on&nbsp;%d:&nbsp;%v&#34;</span><span class="op" id="6746705">,</span>&nbsp;<span class="ident" id="6746707"><a href="/net/http/internal/chunked_test.go.html#6746559">i</a></span><span class="op" id="6746708">,</span>&nbsp;<span class="ident" id="6746710"><a href="/net/http/internal/chunked_test.go.html#6746638">err</a></span><span class="op" id="6746713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6746717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6746721">if</span>&nbsp;<span class="ident" id="6746724"><a href="/net/http/internal/chunked_test.go.html#6746633">got</a></span>&nbsp;<span class="op" id="6746728">!=</span>&nbsp;<span class="ident" id="6746731"><a href="/net/http/internal/chunked_test.go.html#6746559">i</a></span>&nbsp;<span class="op" id="6746733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6746738"><a href="/net/http/internal/chunked_test.go.html#6746538">t</a></span><span class="op" id="6746739">.</span><span class="ident" id="6746740">Errorf</span><span class="op" id="6746746">(</span><span class="string" id="6746747">&#34;for&nbsp;input&nbsp;%q&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="6746775">,</span>&nbsp;<span class="ident" id="6746777"><a href="/net/http/internal/chunked_test.go.html#6746594">line</a></span><span class="op" id="6746781">,</span>&nbsp;<span class="ident" id="6746783"><a href="/net/http/internal/chunked_test.go.html#6746633">got</a></span><span class="op" id="6746786">,</span>&nbsp;<span class="ident" id="6746788"><a href="/net/http/internal/chunked_test.go.html#6746559">i</a></span><span class="op" id="6746789">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6746793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6746796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6746799">_</span><span class="op" id="6746800">,</span>&nbsp;<span class="ident" id="6746802">err</span>&nbsp;<span class="op" id="6746806">:=</span>&nbsp;<span class="ident" id="6746809"><a href="/net/http/internal/chunked.go.html#4537153">parseHexUint</a></span><span class="op" id="6746821">(</span><span class="op" id="6746822">[</span><span class="op" id="6746823">]</span><span class="builtintype" id="6746824">byte</span><span class="op" id="6746828">(</span><span class="string" id="6746829">&#34;bogus&#34;</span><span class="op" id="6746836">)</span><span class="op" id="6746837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6746840">if</span>&nbsp;<span class="ident" id="6746843"><a href="/net/http/internal/chunked_test.go.html#6746802">err</a></span>&nbsp;<span class="op" id="6746847">==</span>&nbsp;<span class="ident" id="6746850">nil</span>&nbsp;<span class="op" id="6746854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6746858"><a href="/net/http/internal/chunked_test.go.html#6746538">t</a></span><span class="op" id="6746859">.</span><span class="ident" id="6746860">Error</span><span class="op" id="6746865">(</span><span class="string" id="6746866">&#34;expected&nbsp;error&nbsp;on&nbsp;bogus&nbsp;input&#34;</span><span class="op" id="6746897">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6746900">}</span><br>
<span class="lineno"></span><span class="op" id="6746902">}</span>
</div>
</body>
</html>
