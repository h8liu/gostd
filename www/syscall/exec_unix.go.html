<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2261373">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2261428">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2261482">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2261533">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2261598">//&nbsp;Fork,&nbsp;exec,&nbsp;wait,&nbsp;etc.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2261625">package</span>&nbsp;<span class="ident" id="2261633">syscall</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="2261642">import</span>&nbsp;<span class="op" id="2261649">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2261652">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2261663">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2261671">&#34;unsafe&#34;</span><br>
<span class="lineno">15</span><span class="op" id="2261680">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2261683">//&nbsp;Lock&nbsp;synchronizing&nbsp;creation&nbsp;of&nbsp;new&nbsp;file&nbsp;descriptors&nbsp;with&nbsp;fork.</span><br>
<span class="lineno"></span><span class="comment" id="2261749">//</span><br>
<span class="lineno"></span><span class="comment" id="2261752">//&nbsp;We&nbsp;want&nbsp;the&nbsp;child&nbsp;in&nbsp;a&nbsp;fork/exec&nbsp;sequence&nbsp;to&nbsp;inherit&nbsp;only&nbsp;the</span><br>
<span class="lineno">20</span><span class="comment" id="2261817">//&nbsp;file&nbsp;descriptors&nbsp;we&nbsp;intend.&nbsp;&nbsp;To&nbsp;do&nbsp;that,&nbsp;we&nbsp;mark&nbsp;all&nbsp;file</span><br>
<span class="lineno"></span><span class="comment" id="2261878">//&nbsp;descriptors&nbsp;close-on-exec&nbsp;and&nbsp;then,&nbsp;in&nbsp;the&nbsp;child,&nbsp;explicitly</span><br>
<span class="lineno"></span><span class="comment" id="2261942">//&nbsp;unmark&nbsp;the&nbsp;ones&nbsp;we&nbsp;want&nbsp;the&nbsp;exec&#39;ed&nbsp;program&nbsp;to&nbsp;keep.</span><br>
<span class="lineno"></span><span class="comment" id="2261998">//&nbsp;Unix&nbsp;doesn&#39;t&nbsp;make&nbsp;this&nbsp;easy:&nbsp;there&nbsp;is,&nbsp;in&nbsp;general,&nbsp;no&nbsp;way&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="2262062">//&nbsp;allocate&nbsp;a&nbsp;new&nbsp;file&nbsp;descriptor&nbsp;close-on-exec.&nbsp;&nbsp;Instead&nbsp;you</span><br>
<span class="lineno">25</span><span class="comment" id="2262124">//&nbsp;have&nbsp;to&nbsp;allocate&nbsp;the&nbsp;descriptor&nbsp;and&nbsp;then&nbsp;mark&nbsp;it&nbsp;close-on-exec.</span><br>
<span class="lineno"></span><span class="comment" id="2262191">//&nbsp;If&nbsp;a&nbsp;fork&nbsp;happens&nbsp;between&nbsp;those&nbsp;two&nbsp;events,&nbsp;the&nbsp;child&#39;s&nbsp;exec</span><br>
<span class="lineno"></span><span class="comment" id="2262255">//&nbsp;will&nbsp;inherit&nbsp;an&nbsp;unwanted&nbsp;file&nbsp;descriptor.</span><br>
<span class="lineno"></span><span class="comment" id="2262300">//</span><br>
<span class="lineno"></span><span class="comment" id="2262303">//&nbsp;This&nbsp;lock&nbsp;solves&nbsp;that&nbsp;race:&nbsp;the&nbsp;create&nbsp;new&nbsp;fd/mark&nbsp;close-on-exec</span><br>
<span class="lineno">30</span><span class="comment" id="2262371">//&nbsp;operation&nbsp;is&nbsp;done&nbsp;holding&nbsp;ForkLock&nbsp;for&nbsp;reading,&nbsp;and&nbsp;the&nbsp;fork&nbsp;itself</span><br>
<span class="lineno"></span><span class="comment" id="2262442">//&nbsp;is&nbsp;done&nbsp;holding&nbsp;ForkLock&nbsp;for&nbsp;writing.&nbsp;&nbsp;At&nbsp;least,&nbsp;that&#39;s&nbsp;the&nbsp;idea.</span><br>
<span class="lineno"></span><span class="comment" id="2262511">//&nbsp;There&nbsp;are&nbsp;some&nbsp;complications.</span><br>
<span class="lineno"></span><span class="comment" id="2262544">//</span><br>
<span class="lineno"></span><span class="comment" id="2262547">//&nbsp;Some&nbsp;system&nbsp;calls&nbsp;that&nbsp;create&nbsp;new&nbsp;file&nbsp;descriptors&nbsp;can&nbsp;block</span><br>
<span class="lineno">35</span><span class="comment" id="2262611">//&nbsp;for&nbsp;arbitrarily&nbsp;long&nbsp;times:&nbsp;open&nbsp;on&nbsp;a&nbsp;hung&nbsp;NFS&nbsp;server&nbsp;or&nbsp;named</span><br>
<span class="lineno"></span><span class="comment" id="2262677">//&nbsp;pipe,&nbsp;accept&nbsp;on&nbsp;a&nbsp;socket,&nbsp;and&nbsp;so&nbsp;on.&nbsp;&nbsp;We&nbsp;can&#39;t&nbsp;reasonably&nbsp;grab</span><br>
<span class="lineno"></span><span class="comment" id="2262743">//&nbsp;the&nbsp;lock&nbsp;across&nbsp;those&nbsp;operations.</span><br>
<span class="lineno"></span><span class="comment" id="2262780">//</span><br>
<span class="lineno"></span><span class="comment" id="2262783">//&nbsp;It&nbsp;is&nbsp;worse&nbsp;to&nbsp;inherit&nbsp;some&nbsp;file&nbsp;descriptors&nbsp;than&nbsp;others.</span><br>
<span class="lineno">40</span><span class="comment" id="2262844">//&nbsp;If&nbsp;a&nbsp;non-malicious&nbsp;child&nbsp;accidentally&nbsp;inherits&nbsp;an&nbsp;open&nbsp;ordinary&nbsp;file,</span><br>
<span class="lineno"></span><span class="comment" id="2262917">//&nbsp;that&#39;s&nbsp;not&nbsp;a&nbsp;big&nbsp;deal.&nbsp;&nbsp;On&nbsp;the&nbsp;other&nbsp;hand,&nbsp;if&nbsp;a&nbsp;long-lived&nbsp;child</span><br>
<span class="lineno"></span><span class="comment" id="2262985">//&nbsp;accidentally&nbsp;inherits&nbsp;the&nbsp;write&nbsp;end&nbsp;of&nbsp;a&nbsp;pipe,&nbsp;then&nbsp;the&nbsp;reader</span><br>
<span class="lineno"></span><span class="comment" id="2263051">//&nbsp;of&nbsp;that&nbsp;pipe&nbsp;will&nbsp;not&nbsp;see&nbsp;EOF&nbsp;until&nbsp;that&nbsp;child&nbsp;exits,&nbsp;potentially</span><br>
<span class="lineno"></span><span class="comment" id="2263120">//&nbsp;causing&nbsp;the&nbsp;parent&nbsp;program&nbsp;to&nbsp;hang.&nbsp;&nbsp;This&nbsp;is&nbsp;a&nbsp;common&nbsp;problem</span><br>
<span class="lineno">45</span><span class="comment" id="2263185">//&nbsp;in&nbsp;threaded&nbsp;C&nbsp;programs&nbsp;that&nbsp;use&nbsp;popen.</span><br>
<span class="lineno"></span><span class="comment" id="2263227">//</span><br>
<span class="lineno"></span><span class="comment" id="2263230">//&nbsp;Luckily,&nbsp;the&nbsp;file&nbsp;descriptors&nbsp;that&nbsp;are&nbsp;most&nbsp;important&nbsp;not&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="2263294">//&nbsp;inherit&nbsp;are&nbsp;not&nbsp;the&nbsp;ones&nbsp;that&nbsp;can&nbsp;take&nbsp;an&nbsp;arbitrarily&nbsp;long&nbsp;time</span><br>
<span class="lineno"></span><span class="comment" id="2263361">//&nbsp;to&nbsp;create:&nbsp;pipe&nbsp;returns&nbsp;instantly,&nbsp;and&nbsp;the&nbsp;net&nbsp;package&nbsp;uses</span><br>
<span class="lineno">50</span><span class="comment" id="2263424">//&nbsp;non-blocking&nbsp;I/O&nbsp;to&nbsp;accept&nbsp;on&nbsp;a&nbsp;listening&nbsp;socket.</span><br>
<span class="lineno"></span><span class="comment" id="2263477">//&nbsp;The&nbsp;rules&nbsp;for&nbsp;which&nbsp;file&nbsp;descriptor-creating&nbsp;operations&nbsp;use&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2263544">//&nbsp;ForkLock&nbsp;are&nbsp;as&nbsp;follows:</span><br>
<span class="lineno"></span><span class="comment" id="2263572">//</span><br>
<span class="lineno"></span><span class="comment" id="2263575">//&nbsp;1)&nbsp;Pipe.&nbsp;&nbsp;&nbsp;&nbsp;Does&nbsp;not&nbsp;block.&nbsp;&nbsp;Use&nbsp;the&nbsp;ForkLock.</span><br>
<span class="lineno">55</span><span class="comment" id="2263625">//&nbsp;2)&nbsp;Socket.&nbsp;&nbsp;Does&nbsp;not&nbsp;block.&nbsp;&nbsp;Use&nbsp;the&nbsp;ForkLock.</span><br>
<span class="lineno"></span><span class="comment" id="2263675">//&nbsp;3)&nbsp;Accept.&nbsp;&nbsp;If&nbsp;using&nbsp;non-blocking&nbsp;mode,&nbsp;use&nbsp;the&nbsp;ForkLock.</span><br>
<span class="lineno"></span><span class="comment" id="2263736">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Otherwise,&nbsp;live&nbsp;with&nbsp;the&nbsp;race.</span><br>
<span class="lineno"></span><span class="comment" id="2263782">//&nbsp;4)&nbsp;Open.&nbsp;&nbsp;&nbsp;&nbsp;Can&nbsp;block.&nbsp;&nbsp;Use&nbsp;O_CLOEXEC&nbsp;if&nbsp;available&nbsp;(Linux).</span><br>
<span class="lineno"></span><span class="comment" id="2263845">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Otherwise,&nbsp;live&nbsp;with&nbsp;the&nbsp;race.</span><br>
<span class="lineno">60</span><span class="comment" id="2263891">//&nbsp;5)&nbsp;Dup.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Does&nbsp;not&nbsp;block.&nbsp;&nbsp;Use&nbsp;the&nbsp;ForkLock.</span><br>
<span class="lineno"></span><span class="comment" id="2263941">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;On&nbsp;Linux,&nbsp;could&nbsp;use&nbsp;fcntl&nbsp;F_DUPFD_CLOEXEC</span><br>
<span class="lineno"></span><span class="comment" id="2263998">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;instead&nbsp;of&nbsp;the&nbsp;ForkLock,&nbsp;but&nbsp;only&nbsp;for&nbsp;dup(fd,&nbsp;-1).</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2264065">var</span>&nbsp;<span class="ident" id="2264069">ForkLock</span>&nbsp;<span class="ident" id="2264078">sync</span><span class="op" id="2264082">.</span><span class="ident" id="2264083">RWMutex</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="comment" id="2264092">//&nbsp;StringSlicePtr&nbsp;is&nbsp;deprecated.&nbsp;Use&nbsp;SlicePtrFromStrings&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="2264158">//&nbsp;If&nbsp;any&nbsp;string&nbsp;contains&nbsp;a&nbsp;NUL&nbsp;byte&nbsp;this&nbsp;function&nbsp;panics&nbsp;instead</span><br>
<span class="lineno"></span><span class="comment" id="2264224">//&nbsp;of&nbsp;returning&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="keyword" id="2264250">func</span>&nbsp;<span class="ident" id="2264255">StringSlicePtr</span><span class="op" id="2264269">(</span><span class="ident" id="2264270">ss</span>&nbsp;<span class="op" id="2264273">[</span><span class="op" id="2264274">]</span><span class="builtintype" id="2264275">string</span><span class="op" id="2264281">)</span>&nbsp;<span class="op" id="2264283">[</span><span class="op" id="2264284">]</span><span class="op" id="2264285">*</span><span class="builtintype" id="2264286">byte</span>&nbsp;<span class="op" id="2264291">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2264294">bb</span>&nbsp;<span class="op" id="2264297">:=</span>&nbsp;<span class="builtinfunc" id="2264300">make</span><span class="op" id="2264304">(</span><span class="op" id="2264305">[</span><span class="op" id="2264306">]</span><span class="op" id="2264307">*</span><span class="builtintype" id="2264308">byte</span><span class="op" id="2264312">,</span>&nbsp;<span class="builtinfunc" id="2264314">len</span><span class="op" id="2264317">(</span><span class="ident" id="2264318">ss</span><span class="op" id="2264320">)</span><span class="op" id="2264321">+</span><span class="num" id="2264322">1</span><span class="op" id="2264323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2264326">for</span>&nbsp;<span class="ident" id="2264330">i</span>&nbsp;<span class="op" id="2264332">:=</span>&nbsp;<span class="num" id="2264335">0</span><span class="op" id="2264336">;</span>&nbsp;<span class="ident" id="2264338">i</span>&nbsp;<span class="op" id="2264340">&lt;</span>&nbsp;<span class="builtinfunc" id="2264342">len</span><span class="op" id="2264345">(</span><span class="ident" id="2264346">ss</span><span class="op" id="2264348">)</span><span class="op" id="2264349">;</span>&nbsp;<span class="ident" id="2264351">i</span><span class="op" id="2264352">++</span>&nbsp;<span class="op" id="2264355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2264359">bb</span><span class="op" id="2264361">[</span><span class="ident" id="2264362">i</span><span class="op" id="2264363">]</span>&nbsp;<span class="op" id="2264365">=</span>&nbsp;<span class="ident" id="2264367">StringBytePtr</span><span class="op" id="2264380">(</span><span class="ident" id="2264381">ss</span><span class="op" id="2264383">[</span><span class="ident" id="2264384">i</span><span class="op" id="2264385">]</span><span class="op" id="2264386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2264389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2264392">bb</span><span class="op" id="2264394">[</span><span class="builtinfunc" id="2264395">len</span><span class="op" id="2264398">(</span><span class="ident" id="2264399">ss</span><span class="op" id="2264401">)</span><span class="op" id="2264402">]</span>&nbsp;<span class="op" id="2264404">=</span>&nbsp;<span class="ident" id="2264406">nil</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2264411">return</span>&nbsp;<span class="ident" id="2264418">bb</span><br>
<span class="lineno"></span><span class="op" id="2264421">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2264424">//&nbsp;SlicePtrFromStrings&nbsp;converts&nbsp;a&nbsp;slice&nbsp;of&nbsp;strings&nbsp;to&nbsp;a&nbsp;slice&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2264489">//&nbsp;pointers&nbsp;to&nbsp;NUL-terminated&nbsp;byte&nbsp;slices.&nbsp;If&nbsp;any&nbsp;string&nbsp;contains</span><br>
<span class="lineno">80</span><span class="comment" id="2264555">//&nbsp;a&nbsp;NUL&nbsp;byte,&nbsp;it&nbsp;returns&nbsp;(nil,&nbsp;EINVAL).</span><br>
<span class="lineno"></span><span class="keyword" id="2264596">func</span>&nbsp;<span class="ident" id="2264601">SlicePtrFromStrings</span><span class="op" id="2264620">(</span><span class="ident" id="2264621">ss</span>&nbsp;<span class="op" id="2264624">[</span><span class="op" id="2264625">]</span><span class="builtintype" id="2264626">string</span><span class="op" id="2264632">)</span>&nbsp;<span class="op" id="2264634">(</span><span class="op" id="2264635">[</span><span class="op" id="2264636">]</span><span class="op" id="2264637">*</span><span class="builtintype" id="2264638">byte</span><span class="op" id="2264642">,</span>&nbsp;<span class="builtintype" id="2264644">error</span><span class="op" id="2264649">)</span>&nbsp;<span class="op" id="2264651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2264654">var</span>&nbsp;<span class="ident" id="2264658">err</span>&nbsp;<span class="builtintype" id="2264662">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2264669">bb</span>&nbsp;<span class="op" id="2264672">:=</span>&nbsp;<span class="builtinfunc" id="2264675">make</span><span class="op" id="2264679">(</span><span class="op" id="2264680">[</span><span class="op" id="2264681">]</span><span class="op" id="2264682">*</span><span class="builtintype" id="2264683">byte</span><span class="op" id="2264687">,</span>&nbsp;<span class="builtinfunc" id="2264689">len</span><span class="op" id="2264692">(</span><span class="ident" id="2264693">ss</span><span class="op" id="2264695">)</span><span class="op" id="2264696">+</span><span class="num" id="2264697">1</span><span class="op" id="2264698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2264701">for</span>&nbsp;<span class="ident" id="2264705">i</span>&nbsp;<span class="op" id="2264707">:=</span>&nbsp;<span class="num" id="2264710">0</span><span class="op" id="2264711">;</span>&nbsp;<span class="ident" id="2264713">i</span>&nbsp;<span class="op" id="2264715">&lt;</span>&nbsp;<span class="builtinfunc" id="2264717">len</span><span class="op" id="2264720">(</span><span class="ident" id="2264721">ss</span><span class="op" id="2264723">)</span><span class="op" id="2264724">;</span>&nbsp;<span class="ident" id="2264726">i</span><span class="op" id="2264727">++</span>&nbsp;<span class="op" id="2264730">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2264734">bb</span><span class="op" id="2264736">[</span><span class="ident" id="2264737">i</span><span class="op" id="2264738">]</span><span class="op" id="2264739">,</span>&nbsp;<span class="ident" id="2264741">err</span>&nbsp;<span class="op" id="2264745">=</span>&nbsp;<span class="ident" id="2264747">BytePtrFromString</span><span class="op" id="2264764">(</span><span class="ident" id="2264765">ss</span><span class="op" id="2264767">[</span><span class="ident" id="2264768">i</span><span class="op" id="2264769">]</span><span class="op" id="2264770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2264774">if</span>&nbsp;<span class="ident" id="2264777">err</span>&nbsp;<span class="op" id="2264781">!=</span>&nbsp;<span class="ident" id="2264784">nil</span>&nbsp;<span class="op" id="2264788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2264793">return</span>&nbsp;<span class="ident" id="2264800">nil</span><span class="op" id="2264803">,</span>&nbsp;<span class="ident" id="2264805">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2264811">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2264814">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2264817">bb</span><span class="op" id="2264819">[</span><span class="builtinfunc" id="2264820">len</span><span class="op" id="2264823">(</span><span class="ident" id="2264824">ss</span><span class="op" id="2264826">)</span><span class="op" id="2264827">]</span>&nbsp;<span class="op" id="2264829">=</span>&nbsp;<span class="ident" id="2264831">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2264836">return</span>&nbsp;<span class="ident" id="2264843">bb</span><span class="op" id="2264845">,</span>&nbsp;<span class="ident" id="2264847">nil</span><br>
<span class="lineno"></span><span class="op" id="2264851">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2264854">func</span>&nbsp;<span class="ident" id="2264859">CloseOnExec</span><span class="op" id="2264870">(</span><span class="ident" id="2264871">fd</span>&nbsp;<span class="builtintype" id="2264874">int</span><span class="op" id="2264877">)</span>&nbsp;<span class="op" id="2264879">{</span>&nbsp;<span class="ident" id="2264881">fcntl</span><span class="op" id="2264886">(</span><span class="ident" id="2264887">fd</span><span class="op" id="2264889">,</span>&nbsp;<span class="ident" id="2264891">F_SETFD</span><span class="op" id="2264898">,</span>&nbsp;<span class="ident" id="2264900">FD_CLOEXEC</span><span class="op" id="2264910">)</span>&nbsp;<span class="op" id="2264912">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="keyword" id="2264915">func</span>&nbsp;<span class="ident" id="2264920">SetNonblock</span><span class="op" id="2264931">(</span><span class="ident" id="2264932">fd</span>&nbsp;<span class="builtintype" id="2264935">int</span><span class="op" id="2264938">,</span>&nbsp;<span class="ident" id="2264940">nonblocking</span>&nbsp;<span class="builtintype" id="2264952">bool</span><span class="op" id="2264956">)</span>&nbsp;<span class="op" id="2264958">(</span><span class="ident" id="2264959">err</span>&nbsp;<span class="builtintype" id="2264963">error</span><span class="op" id="2264968">)</span>&nbsp;<span class="op" id="2264970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2264973">flag</span><span class="op" id="2264977">,</span>&nbsp;<span class="ident" id="2264979">err</span>&nbsp;<span class="op" id="2264983">:=</span>&nbsp;<span class="ident" id="2264986">fcntl</span><span class="op" id="2264991">(</span><span class="ident" id="2264992">fd</span><span class="op" id="2264994">,</span>&nbsp;<span class="ident" id="2264996">F_GETFL</span><span class="op" id="2265003">,</span>&nbsp;<span class="num" id="2265005">0</span><span class="op" id="2265006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2265009">if</span>&nbsp;<span class="ident" id="2265012">err</span>&nbsp;<span class="op" id="2265016">!=</span>&nbsp;<span class="ident" id="2265019">nil</span>&nbsp;<span class="op" id="2265023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2265027">return</span>&nbsp;<span class="ident" id="2265034">err</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2265039">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2265042">if</span>&nbsp;<span class="ident" id="2265045">nonblocking</span>&nbsp;<span class="op" id="2265057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2265061">flag</span>&nbsp;<span class="op" id="2265066">|=</span>&nbsp;<span class="ident" id="2265069">O_NONBLOCK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2265081">}</span>&nbsp;<span class="keyword" id="2265083">else</span>&nbsp;<span class="op" id="2265088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2265092">flag</span>&nbsp;<span class="op" id="2265097">&amp;=</span>&nbsp;<span class="op" id="2265100">^</span><span class="ident" id="2265101">O_NONBLOCK</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2265113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2265116">_</span><span class="op" id="2265117">,</span>&nbsp;<span class="ident" id="2265119">err</span>&nbsp;<span class="op" id="2265123">=</span>&nbsp;<span class="ident" id="2265125">fcntl</span><span class="op" id="2265130">(</span><span class="ident" id="2265131">fd</span><span class="op" id="2265133">,</span>&nbsp;<span class="ident" id="2265135">F_SETFL</span><span class="op" id="2265142">,</span>&nbsp;<span class="ident" id="2265144">flag</span><span class="op" id="2265148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2265151">return</span>&nbsp;<span class="ident" id="2265158">err</span><br>
<span class="lineno"></span><span class="op" id="2265162">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="2265165">//&nbsp;Credential&nbsp;holds&nbsp;user&nbsp;and&nbsp;group&nbsp;identities&nbsp;to&nbsp;be&nbsp;assumed</span><br>
<span class="lineno"></span><span class="comment" id="2265225">//&nbsp;by&nbsp;a&nbsp;child&nbsp;process&nbsp;started&nbsp;by&nbsp;StartProcess.</span><br>
<span class="lineno"></span><span class="keyword" id="2265272">type</span>&nbsp;<span class="ident" id="2265277">Credential</span>&nbsp;<span class="keyword" id="2265288">struct</span>&nbsp;<span class="op" id="2265295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2265298">Uid</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2265305">uint32</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="2265314">//&nbsp;User&nbsp;ID.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2265327">Gid</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2265334">uint32</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="2265343">//&nbsp;Group&nbsp;ID.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2265357">Groups</span>&nbsp;<span class="op" id="2265364">[</span><span class="op" id="2265365">]</span><span class="builtintype" id="2265366">uint32</span>&nbsp;<span class="comment" id="2265373">//&nbsp;Supplementary&nbsp;group&nbsp;IDs.</span><br>
<span class="lineno"></span><span class="op" id="2265401">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2265404">//&nbsp;ProcAttr&nbsp;holds&nbsp;attributes&nbsp;that&nbsp;will&nbsp;be&nbsp;applied&nbsp;to&nbsp;a&nbsp;new&nbsp;process&nbsp;started</span><br>
<span class="lineno"></span><span class="comment" id="2265479">//&nbsp;by&nbsp;StartProcess.</span><br>
<span class="lineno">120</span><span class="keyword" id="2265499">type</span>&nbsp;<span class="ident" id="2265504">ProcAttr</span>&nbsp;<span class="keyword" id="2265513">struct</span>&nbsp;<span class="op" id="2265520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2265523">Dir</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2265529">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2265539">//&nbsp;Current&nbsp;working&nbsp;directory.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2265570">Env</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2265576">[</span><span class="op" id="2265577">]</span><span class="builtintype" id="2265578">string</span>&nbsp;&nbsp;<span class="comment" id="2265586">//&nbsp;Environment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2265603">Files</span>&nbsp;<span class="op" id="2265609">[</span><span class="op" id="2265610">]</span><span class="builtintype" id="2265611">uintptr</span>&nbsp;<span class="comment" id="2265619">//&nbsp;File&nbsp;descriptors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2265641">Sys</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2265647">*</span><span class="ident" id="2265648">SysProcAttr</span><br>
<span class="lineno">125</span><span class="op" id="2265660">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2265663">var</span>&nbsp;<span class="ident" id="2265667">zeroProcAttr</span>&nbsp;<span class="ident" id="2265680">ProcAttr</span><br>
<span class="lineno"></span><span class="keyword" id="2265689">var</span>&nbsp;<span class="ident" id="2265693">zeroSysProcAttr</span>&nbsp;<span class="ident" id="2265709">SysProcAttr</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="2265722">func</span>&nbsp;<span class="ident" id="2265727">forkExec</span><span class="op" id="2265735">(</span><span class="ident" id="2265736">argv0</span>&nbsp;<span class="builtintype" id="2265742">string</span><span class="op" id="2265748">,</span>&nbsp;<span class="ident" id="2265750">argv</span>&nbsp;<span class="op" id="2265755">[</span><span class="op" id="2265756">]</span><span class="builtintype" id="2265757">string</span><span class="op" id="2265763">,</span>&nbsp;<span class="ident" id="2265765">attr</span>&nbsp;<span class="op" id="2265770">*</span><span class="ident" id="2265771">ProcAttr</span><span class="op" id="2265779">)</span>&nbsp;<span class="op" id="2265781">(</span><span class="ident" id="2265782">pid</span>&nbsp;<span class="builtintype" id="2265786">int</span><span class="op" id="2265789">,</span>&nbsp;<span class="ident" id="2265791">err</span>&nbsp;<span class="builtintype" id="2265795">error</span><span class="op" id="2265800">)</span>&nbsp;<span class="op" id="2265802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2265805">var</span>&nbsp;<span class="ident" id="2265809">p</span>&nbsp;<span class="op" id="2265811">[</span><span class="num" id="2265812">2</span><span class="op" id="2265813">]</span><span class="builtintype" id="2265814">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2265819">var</span>&nbsp;<span class="ident" id="2265823">n</span>&nbsp;<span class="builtintype" id="2265825">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2265830">var</span>&nbsp;<span class="ident" id="2265834">err1</span>&nbsp;<span class="ident" id="2265839">Errno</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2265846">var</span>&nbsp;<span class="ident" id="2265850">wstatus</span>&nbsp;<span class="ident" id="2265858">WaitStatus</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2265871">if</span>&nbsp;<span class="ident" id="2265874">attr</span>&nbsp;<span class="op" id="2265879">==</span>&nbsp;<span class="ident" id="2265882">nil</span>&nbsp;<span class="op" id="2265886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2265890">attr</span>&nbsp;<span class="op" id="2265895">=</span>&nbsp;<span class="op" id="2265897">&amp;</span><span class="ident" id="2265898">zeroProcAttr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2265912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2265915">sys</span>&nbsp;<span class="op" id="2265919">:=</span>&nbsp;<span class="ident" id="2265922">attr</span><span class="op" id="2265926">.</span><span class="ident" id="2265927">Sys</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2265932">if</span>&nbsp;<span class="ident" id="2265935">sys</span>&nbsp;<span class="op" id="2265939">==</span>&nbsp;<span class="ident" id="2265942">nil</span>&nbsp;<span class="op" id="2265946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2265950">sys</span>&nbsp;<span class="op" id="2265954">=</span>&nbsp;<span class="op" id="2265956">&amp;</span><span class="ident" id="2265957">zeroSysProcAttr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2265974">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2265978">p</span><span class="op" id="2265979">[</span><span class="num" id="2265980">0</span><span class="op" id="2265981">]</span>&nbsp;<span class="op" id="2265983">=</span>&nbsp;<span class="op" id="2265985">-</span><span class="num" id="2265986">1</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2265989">p</span><span class="op" id="2265990">[</span><span class="num" id="2265991">1</span><span class="op" id="2265992">]</span>&nbsp;<span class="op" id="2265994">=</span>&nbsp;<span class="op" id="2265996">-</span><span class="num" id="2265997">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2266001">//&nbsp;Convert&nbsp;args&nbsp;to&nbsp;C&nbsp;form.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2266029">argv0p</span><span class="op" id="2266035">,</span>&nbsp;<span class="ident" id="2266037">err</span>&nbsp;<span class="op" id="2266041">:=</span>&nbsp;<span class="ident" id="2266044">BytePtrFromString</span><span class="op" id="2266061">(</span><span class="ident" id="2266062">argv0</span><span class="op" id="2266067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2266070">if</span>&nbsp;<span class="ident" id="2266073">err</span>&nbsp;<span class="op" id="2266077">!=</span>&nbsp;<span class="ident" id="2266080">nil</span>&nbsp;<span class="op" id="2266084">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2266088">return</span>&nbsp;<span class="num" id="2266095">0</span><span class="op" id="2266096">,</span>&nbsp;<span class="ident" id="2266098">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2266103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2266106">argvp</span><span class="op" id="2266111">,</span>&nbsp;<span class="ident" id="2266113">err</span>&nbsp;<span class="op" id="2266117">:=</span>&nbsp;<span class="ident" id="2266120">SlicePtrFromStrings</span><span class="op" id="2266139">(</span><span class="ident" id="2266140">argv</span><span class="op" id="2266144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2266147">if</span>&nbsp;<span class="ident" id="2266150">err</span>&nbsp;<span class="op" id="2266154">!=</span>&nbsp;<span class="ident" id="2266157">nil</span>&nbsp;<span class="op" id="2266161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2266165">return</span>&nbsp;<span class="num" id="2266172">0</span><span class="op" id="2266173">,</span>&nbsp;<span class="ident" id="2266175">err</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2266180">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2266183">envvp</span><span class="op" id="2266188">,</span>&nbsp;<span class="ident" id="2266190">err</span>&nbsp;<span class="op" id="2266194">:=</span>&nbsp;<span class="ident" id="2266197">SlicePtrFromStrings</span><span class="op" id="2266216">(</span><span class="ident" id="2266217">attr</span><span class="op" id="2266221">.</span><span class="ident" id="2266222">Env</span><span class="op" id="2266225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2266228">if</span>&nbsp;<span class="ident" id="2266231">err</span>&nbsp;<span class="op" id="2266235">!=</span>&nbsp;<span class="ident" id="2266238">nil</span>&nbsp;<span class="op" id="2266242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2266246">return</span>&nbsp;<span class="num" id="2266253">0</span><span class="op" id="2266254">,</span>&nbsp;<span class="ident" id="2266256">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2266261">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2266265">if</span>&nbsp;<span class="op" id="2266268">(</span><span class="ident" id="2266269">runtime</span><span class="op" id="2266276">.</span><span class="ident" id="2266277">GOOS</span>&nbsp;<span class="op" id="2266282">==</span>&nbsp;<span class="string" id="2266285">&#34;freebsd&#34;</span>&nbsp;<span class="op" id="2266295">||</span>&nbsp;<span class="ident" id="2266298">runtime</span><span class="op" id="2266305">.</span><span class="ident" id="2266306">GOOS</span>&nbsp;<span class="op" id="2266311">==</span>&nbsp;<span class="string" id="2266314">&#34;dragonfly&#34;</span><span class="op" id="2266325">)</span>&nbsp;<span class="op" id="2266327">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2266330">len</span><span class="op" id="2266333">(</span><span class="ident" id="2266334">argv</span><span class="op" id="2266338">[</span><span class="num" id="2266339">0</span><span class="op" id="2266340">]</span><span class="op" id="2266341">)</span>&nbsp;<span class="op" id="2266343">&gt;</span>&nbsp;<span class="builtinfunc" id="2266345">len</span><span class="op" id="2266348">(</span><span class="ident" id="2266349">argv0</span><span class="op" id="2266354">)</span>&nbsp;<span class="op" id="2266356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2266360">argvp</span><span class="op" id="2266365">[</span><span class="num" id="2266366">0</span><span class="op" id="2266367">]</span>&nbsp;<span class="op" id="2266369">=</span>&nbsp;<span class="ident" id="2266371">argv0p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2266379">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2266383">var</span>&nbsp;<span class="ident" id="2266387">chroot</span>&nbsp;<span class="op" id="2266394">*</span><span class="builtintype" id="2266395">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2266401">if</span>&nbsp;<span class="ident" id="2266404">sys</span><span class="op" id="2266407">.</span><span class="ident" id="2266408">Chroot</span>&nbsp;<span class="op" id="2266415">!=</span>&nbsp;<span class="string" id="2266418">&#34;&#34;</span>&nbsp;<span class="op" id="2266421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2266425">chroot</span><span class="op" id="2266431">,</span>&nbsp;<span class="ident" id="2266433">err</span>&nbsp;<span class="op" id="2266437">=</span>&nbsp;<span class="ident" id="2266439">BytePtrFromString</span><span class="op" id="2266456">(</span><span class="ident" id="2266457">sys</span><span class="op" id="2266460">.</span><span class="ident" id="2266461">Chroot</span><span class="op" id="2266467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2266471">if</span>&nbsp;<span class="ident" id="2266474">err</span>&nbsp;<span class="op" id="2266478">!=</span>&nbsp;<span class="ident" id="2266481">nil</span>&nbsp;<span class="op" id="2266485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2266490">return</span>&nbsp;<span class="num" id="2266497">0</span><span class="op" id="2266498">,</span>&nbsp;<span class="ident" id="2266500">err</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2266506">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2266509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2266512">var</span>&nbsp;<span class="ident" id="2266516">dir</span>&nbsp;<span class="op" id="2266520">*</span><span class="builtintype" id="2266521">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2266527">if</span>&nbsp;<span class="ident" id="2266530">attr</span><span class="op" id="2266534">.</span><span class="ident" id="2266535">Dir</span>&nbsp;<span class="op" id="2266539">!=</span>&nbsp;<span class="string" id="2266542">&#34;&#34;</span>&nbsp;<span class="op" id="2266545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2266549">dir</span><span class="op" id="2266552">,</span>&nbsp;<span class="ident" id="2266554">err</span>&nbsp;<span class="op" id="2266558">=</span>&nbsp;<span class="ident" id="2266560">BytePtrFromString</span><span class="op" id="2266577">(</span><span class="ident" id="2266578">attr</span><span class="op" id="2266582">.</span><span class="ident" id="2266583">Dir</span><span class="op" id="2266586">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2266590">if</span>&nbsp;<span class="ident" id="2266593">err</span>&nbsp;<span class="op" id="2266597">!=</span>&nbsp;<span class="ident" id="2266600">nil</span>&nbsp;<span class="op" id="2266604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2266609">return</span>&nbsp;<span class="num" id="2266616">0</span><span class="op" id="2266617">,</span>&nbsp;<span class="ident" id="2266619">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2266625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2266628">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2266632">//&nbsp;Acquire&nbsp;the&nbsp;fork&nbsp;lock&nbsp;so&nbsp;that&nbsp;no&nbsp;other&nbsp;threads</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2266683">//&nbsp;create&nbsp;new&nbsp;fds&nbsp;that&nbsp;are&nbsp;not&nbsp;yet&nbsp;close-on-exec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2266733">//&nbsp;before&nbsp;we&nbsp;fork.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2266753">ForkLock</span><span class="op" id="2266761">.</span><span class="ident" id="2266762">Lock</span><span class="op" id="2266766">(</span><span class="op" id="2266767">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2266771">//&nbsp;Allocate&nbsp;child&nbsp;status&nbsp;pipe&nbsp;close&nbsp;on&nbsp;exec.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2266817">if</span>&nbsp;<span class="ident" id="2266820">err</span>&nbsp;<span class="op" id="2266824">=</span>&nbsp;<span class="ident" id="2266826">forkExecPipe</span><span class="op" id="2266838">(</span><span class="ident" id="2266839">p</span><span class="op" id="2266840">[</span><span class="op" id="2266841">:</span><span class="op" id="2266842">]</span><span class="op" id="2266843">)</span><span class="op" id="2266844">;</span>&nbsp;<span class="ident" id="2266846">err</span>&nbsp;<span class="op" id="2266850">!=</span>&nbsp;<span class="ident" id="2266853">nil</span>&nbsp;<span class="op" id="2266857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2266861">goto</span>&nbsp;<span class="builtintype" id="2266866">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2266873">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2266877">//&nbsp;Kick&nbsp;off&nbsp;child.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2266897">pid</span><span class="op" id="2266900">,</span>&nbsp;<span class="ident" id="2266902">err1</span>&nbsp;<span class="op" id="2266907">=</span>&nbsp;<span class="ident" id="2266909">forkAndExecInChild</span><span class="op" id="2266927">(</span><span class="ident" id="2266928">argv0p</span><span class="op" id="2266934">,</span>&nbsp;<span class="ident" id="2266936">argvp</span><span class="op" id="2266941">,</span>&nbsp;<span class="ident" id="2266943">envvp</span><span class="op" id="2266948">,</span>&nbsp;<span class="ident" id="2266950">chroot</span><span class="op" id="2266956">,</span>&nbsp;<span class="ident" id="2266958">dir</span><span class="op" id="2266961">,</span>&nbsp;<span class="ident" id="2266963">attr</span><span class="op" id="2266967">,</span>&nbsp;<span class="ident" id="2266969">sys</span><span class="op" id="2266972">,</span>&nbsp;<span class="ident" id="2266974">p</span><span class="op" id="2266975">[</span><span class="num" id="2266976">1</span><span class="op" id="2266977">]</span><span class="op" id="2266978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2266981">if</span>&nbsp;<span class="ident" id="2266984">err1</span>&nbsp;<span class="op" id="2266989">!=</span>&nbsp;<span class="num" id="2266992">0</span>&nbsp;<span class="op" id="2266994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2266998">err</span>&nbsp;<span class="op" id="2267002">=</span>&nbsp;<span class="ident" id="2267004">Errno</span><span class="op" id="2267009">(</span><span class="ident" id="2267010">err1</span><span class="op" id="2267014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2267018">goto</span>&nbsp;<span class="builtintype" id="2267023">error</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2267030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2267033">ForkLock</span><span class="op" id="2267041">.</span><span class="ident" id="2267042">Unlock</span><span class="op" id="2267048">(</span><span class="op" id="2267049">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2267053">//&nbsp;Read&nbsp;child&nbsp;error&nbsp;status&nbsp;from&nbsp;pipe.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2267092">Close</span><span class="op" id="2267097">(</span><span class="ident" id="2267098">p</span><span class="op" id="2267099">[</span><span class="num" id="2267100">1</span><span class="op" id="2267101">]</span><span class="op" id="2267102">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2267105">n</span><span class="op" id="2267106">,</span>&nbsp;<span class="ident" id="2267108">err</span>&nbsp;<span class="op" id="2267112">=</span>&nbsp;<span class="ident" id="2267114">readlen</span><span class="op" id="2267121">(</span><span class="ident" id="2267122">p</span><span class="op" id="2267123">[</span><span class="num" id="2267124">0</span><span class="op" id="2267125">]</span><span class="op" id="2267126">,</span>&nbsp;<span class="op" id="2267128">(</span><span class="op" id="2267129">*</span><span class="builtintype" id="2267130">byte</span><span class="op" id="2267134">)</span><span class="op" id="2267135">(</span><span class="ident" id="2267136">unsafe</span><span class="op" id="2267142">.</span><span class="ident" id="2267143">Pointer</span><span class="op" id="2267150">(</span><span class="op" id="2267151">&amp;</span><span class="ident" id="2267152">err1</span><span class="op" id="2267156">)</span><span class="op" id="2267157">)</span><span class="op" id="2267158">,</span>&nbsp;<span class="builtintype" id="2267160">int</span><span class="op" id="2267163">(</span><span class="ident" id="2267164">unsafe</span><span class="op" id="2267170">.</span><span class="ident" id="2267171">Sizeof</span><span class="op" id="2267177">(</span><span class="ident" id="2267178">err1</span><span class="op" id="2267182">)</span><span class="op" id="2267183">)</span><span class="op" id="2267184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2267187">Close</span><span class="op" id="2267192">(</span><span class="ident" id="2267193">p</span><span class="op" id="2267194">[</span><span class="num" id="2267195">0</span><span class="op" id="2267196">]</span><span class="op" id="2267197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2267200">if</span>&nbsp;<span class="ident" id="2267203">err</span>&nbsp;<span class="op" id="2267207">!=</span>&nbsp;<span class="ident" id="2267210">nil</span>&nbsp;<span class="op" id="2267214">||</span>&nbsp;<span class="ident" id="2267217">n</span>&nbsp;<span class="op" id="2267219">!=</span>&nbsp;<span class="num" id="2267222">0</span>&nbsp;<span class="op" id="2267224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2267228">if</span>&nbsp;<span class="ident" id="2267231">n</span>&nbsp;<span class="op" id="2267233">==</span>&nbsp;<span class="builtintype" id="2267236">int</span><span class="op" id="2267239">(</span><span class="ident" id="2267240">unsafe</span><span class="op" id="2267246">.</span><span class="ident" id="2267247">Sizeof</span><span class="op" id="2267253">(</span><span class="ident" id="2267254">err1</span><span class="op" id="2267258">)</span><span class="op" id="2267259">)</span>&nbsp;<span class="op" id="2267261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2267266">err</span>&nbsp;<span class="op" id="2267270">=</span>&nbsp;<span class="ident" id="2267272">Errno</span><span class="op" id="2267277">(</span><span class="ident" id="2267278">err1</span><span class="op" id="2267282">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2267286">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2267290">if</span>&nbsp;<span class="ident" id="2267293">err</span>&nbsp;<span class="op" id="2267297">==</span>&nbsp;<span class="ident" id="2267300">nil</span>&nbsp;<span class="op" id="2267304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2267309">err</span>&nbsp;<span class="op" id="2267313">=</span>&nbsp;<span class="ident" id="2267315">EPIPE</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2267323">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2267328">//&nbsp;Child&nbsp;failed;&nbsp;wait&nbsp;for&nbsp;it&nbsp;to&nbsp;exit,&nbsp;to&nbsp;make&nbsp;sure</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2267381">//&nbsp;the&nbsp;zombies&nbsp;don&#39;t&nbsp;accumulate.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2267416">_</span><span class="op" id="2267417">,</span>&nbsp;<span class="ident" id="2267419">err1</span>&nbsp;<span class="op" id="2267424">:=</span>&nbsp;<span class="ident" id="2267427">Wait4</span><span class="op" id="2267432">(</span><span class="ident" id="2267433">pid</span><span class="op" id="2267436">,</span>&nbsp;<span class="op" id="2267438">&amp;</span><span class="ident" id="2267439">wstatus</span><span class="op" id="2267446">,</span>&nbsp;<span class="num" id="2267448">0</span><span class="op" id="2267449">,</span>&nbsp;<span class="ident" id="2267451">nil</span><span class="op" id="2267454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2267458">for</span>&nbsp;<span class="ident" id="2267462">err1</span>&nbsp;<span class="op" id="2267467">==</span>&nbsp;<span class="ident" id="2267470">EINTR</span>&nbsp;<span class="op" id="2267476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2267481">_</span><span class="op" id="2267482">,</span>&nbsp;<span class="ident" id="2267484">err1</span>&nbsp;<span class="op" id="2267489">=</span>&nbsp;<span class="ident" id="2267491">Wait4</span><span class="op" id="2267496">(</span><span class="ident" id="2267497">pid</span><span class="op" id="2267500">,</span>&nbsp;<span class="op" id="2267502">&amp;</span><span class="ident" id="2267503">wstatus</span><span class="op" id="2267510">,</span>&nbsp;<span class="num" id="2267512">0</span><span class="op" id="2267513">,</span>&nbsp;<span class="ident" id="2267515">nil</span><span class="op" id="2267518">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2267522">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2267526">return</span>&nbsp;<span class="num" id="2267533">0</span><span class="op" id="2267534">,</span>&nbsp;<span class="ident" id="2267536">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2267541">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2267545">//&nbsp;Read&nbsp;got&nbsp;EOF,&nbsp;so&nbsp;pipe&nbsp;closed&nbsp;on&nbsp;exec,&nbsp;so&nbsp;exec&nbsp;succeeded.</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2267606">return</span>&nbsp;<span class="ident" id="2267613">pid</span><span class="op" id="2267616">,</span>&nbsp;<span class="ident" id="2267618">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="builtintype" id="2267623">error</span><span class="op" id="2267628">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2267631">if</span>&nbsp;<span class="ident" id="2267634">p</span><span class="op" id="2267635">[</span><span class="num" id="2267636">0</span><span class="op" id="2267637">]</span>&nbsp;<span class="op" id="2267639">&gt;=</span>&nbsp;<span class="num" id="2267642">0</span>&nbsp;<span class="op" id="2267644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2267648">Close</span><span class="op" id="2267653">(</span><span class="ident" id="2267654">p</span><span class="op" id="2267655">[</span><span class="num" id="2267656">0</span><span class="op" id="2267657">]</span><span class="op" id="2267658">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2267662">Close</span><span class="op" id="2267667">(</span><span class="ident" id="2267668">p</span><span class="op" id="2267669">[</span><span class="num" id="2267670">1</span><span class="op" id="2267671">]</span><span class="op" id="2267672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2267675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2267678">ForkLock</span><span class="op" id="2267686">.</span><span class="ident" id="2267687">Unlock</span><span class="op" id="2267693">(</span><span class="op" id="2267694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2267697">return</span>&nbsp;<span class="num" id="2267704">0</span><span class="op" id="2267705">,</span>&nbsp;<span class="ident" id="2267707">err</span><br>
<span class="lineno"></span><span class="op" id="2267711">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="2267714">//&nbsp;Combination&nbsp;of&nbsp;fork&nbsp;and&nbsp;exec,&nbsp;careful&nbsp;to&nbsp;be&nbsp;thread&nbsp;safe.</span><br>
<span class="lineno"></span><span class="keyword" id="2267774">func</span>&nbsp;<span class="ident" id="2267779">ForkExec</span><span class="op" id="2267787">(</span><span class="ident" id="2267788">argv0</span>&nbsp;<span class="builtintype" id="2267794">string</span><span class="op" id="2267800">,</span>&nbsp;<span class="ident" id="2267802">argv</span>&nbsp;<span class="op" id="2267807">[</span><span class="op" id="2267808">]</span><span class="builtintype" id="2267809">string</span><span class="op" id="2267815">,</span>&nbsp;<span class="ident" id="2267817">attr</span>&nbsp;<span class="op" id="2267822">*</span><span class="ident" id="2267823">ProcAttr</span><span class="op" id="2267831">)</span>&nbsp;<span class="op" id="2267833">(</span><span class="ident" id="2267834">pid</span>&nbsp;<span class="builtintype" id="2267838">int</span><span class="op" id="2267841">,</span>&nbsp;<span class="ident" id="2267843">err</span>&nbsp;<span class="builtintype" id="2267847">error</span><span class="op" id="2267852">)</span>&nbsp;<span class="op" id="2267854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2267857">return</span>&nbsp;<span class="ident" id="2267864">forkExec</span><span class="op" id="2267872">(</span><span class="ident" id="2267873">argv0</span><span class="op" id="2267878">,</span>&nbsp;<span class="ident" id="2267880">argv</span><span class="op" id="2267884">,</span>&nbsp;<span class="ident" id="2267886">attr</span><span class="op" id="2267890">)</span><br>
<span class="lineno"></span><span class="op" id="2267892">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="comment" id="2267895">//&nbsp;StartProcess&nbsp;wraps&nbsp;ForkExec&nbsp;for&nbsp;package&nbsp;os.</span><br>
<span class="lineno"></span><span class="keyword" id="2267942">func</span>&nbsp;<span class="ident" id="2267947">StartProcess</span><span class="op" id="2267959">(</span><span class="ident" id="2267960">argv0</span>&nbsp;<span class="builtintype" id="2267966">string</span><span class="op" id="2267972">,</span>&nbsp;<span class="ident" id="2267974">argv</span>&nbsp;<span class="op" id="2267979">[</span><span class="op" id="2267980">]</span><span class="builtintype" id="2267981">string</span><span class="op" id="2267987">,</span>&nbsp;<span class="ident" id="2267989">attr</span>&nbsp;<span class="op" id="2267994">*</span><span class="ident" id="2267995">ProcAttr</span><span class="op" id="2268003">)</span>&nbsp;<span class="op" id="2268005">(</span><span class="ident" id="2268006">pid</span>&nbsp;<span class="builtintype" id="2268010">int</span><span class="op" id="2268013">,</span>&nbsp;<span class="ident" id="2268015">handle</span>&nbsp;<span class="builtintype" id="2268022">uintptr</span><span class="op" id="2268029">,</span>&nbsp;<span class="ident" id="2268031">err</span>&nbsp;<span class="builtintype" id="2268035">error</span><span class="op" id="2268040">)</span>&nbsp;<span class="op" id="2268042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2268045">pid</span><span class="op" id="2268048">,</span>&nbsp;<span class="ident" id="2268050">err</span>&nbsp;<span class="op" id="2268054">=</span>&nbsp;<span class="ident" id="2268056">forkExec</span><span class="op" id="2268064">(</span><span class="ident" id="2268065">argv0</span><span class="op" id="2268070">,</span>&nbsp;<span class="ident" id="2268072">argv</span><span class="op" id="2268076">,</span>&nbsp;<span class="ident" id="2268078">attr</span><span class="op" id="2268082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2268085">return</span>&nbsp;<span class="ident" id="2268092">pid</span><span class="op" id="2268095">,</span>&nbsp;<span class="num" id="2268097">0</span><span class="op" id="2268098">,</span>&nbsp;<span class="ident" id="2268100">err</span><br>
<span class="lineno">240</span><span class="op" id="2268104">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2268107">//&nbsp;Ordinary&nbsp;exec.</span><br>
<span class="lineno"></span><span class="keyword" id="2268125">func</span>&nbsp;<span class="ident" id="2268130">Exec</span><span class="op" id="2268134">(</span><span class="ident" id="2268135">argv0</span>&nbsp;<span class="builtintype" id="2268141">string</span><span class="op" id="2268147">,</span>&nbsp;<span class="ident" id="2268149">argv</span>&nbsp;<span class="op" id="2268154">[</span><span class="op" id="2268155">]</span><span class="builtintype" id="2268156">string</span><span class="op" id="2268162">,</span>&nbsp;<span class="ident" id="2268164">envv</span>&nbsp;<span class="op" id="2268169">[</span><span class="op" id="2268170">]</span><span class="builtintype" id="2268171">string</span><span class="op" id="2268177">)</span>&nbsp;<span class="op" id="2268179">(</span><span class="ident" id="2268180">err</span>&nbsp;<span class="builtintype" id="2268184">error</span><span class="op" id="2268189">)</span>&nbsp;<span class="op" id="2268191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2268194">argv0p</span><span class="op" id="2268200">,</span>&nbsp;<span class="ident" id="2268202">err</span>&nbsp;<span class="op" id="2268206">:=</span>&nbsp;<span class="ident" id="2268209">BytePtrFromString</span><span class="op" id="2268226">(</span><span class="ident" id="2268227">argv0</span><span class="op" id="2268232">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2268235">if</span>&nbsp;<span class="ident" id="2268238">err</span>&nbsp;<span class="op" id="2268242">!=</span>&nbsp;<span class="ident" id="2268245">nil</span>&nbsp;<span class="op" id="2268249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2268253">return</span>&nbsp;<span class="ident" id="2268260">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2268265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2268268">argvp</span><span class="op" id="2268273">,</span>&nbsp;<span class="ident" id="2268275">err</span>&nbsp;<span class="op" id="2268279">:=</span>&nbsp;<span class="ident" id="2268282">SlicePtrFromStrings</span><span class="op" id="2268301">(</span><span class="ident" id="2268302">argv</span><span class="op" id="2268306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2268309">if</span>&nbsp;<span class="ident" id="2268312">err</span>&nbsp;<span class="op" id="2268316">!=</span>&nbsp;<span class="ident" id="2268319">nil</span>&nbsp;<span class="op" id="2268323">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2268327">return</span>&nbsp;<span class="ident" id="2268334">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2268339">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2268342">envvp</span><span class="op" id="2268347">,</span>&nbsp;<span class="ident" id="2268349">err</span>&nbsp;<span class="op" id="2268353">:=</span>&nbsp;<span class="ident" id="2268356">SlicePtrFromStrings</span><span class="op" id="2268375">(</span><span class="ident" id="2268376">envv</span><span class="op" id="2268380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2268383">if</span>&nbsp;<span class="ident" id="2268386">err</span>&nbsp;<span class="op" id="2268390">!=</span>&nbsp;<span class="ident" id="2268393">nil</span>&nbsp;<span class="op" id="2268397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2268401">return</span>&nbsp;<span class="ident" id="2268408">err</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2268413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2268416">_</span><span class="op" id="2268417">,</span>&nbsp;<span class="ident" id="2268419">_</span><span class="op" id="2268420">,</span>&nbsp;<span class="ident" id="2268422">err1</span>&nbsp;<span class="op" id="2268427">:=</span>&nbsp;<span class="ident" id="2268430">RawSyscall</span><span class="op" id="2268440">(</span><span class="ident" id="2268441">SYS_EXECVE</span><span class="op" id="2268451">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="2268455">uintptr</span><span class="op" id="2268462">(</span><span class="ident" id="2268463">unsafe</span><span class="op" id="2268469">.</span><span class="ident" id="2268470">Pointer</span><span class="op" id="2268477">(</span><span class="ident" id="2268478">argv0p</span><span class="op" id="2268484">)</span><span class="op" id="2268485">)</span><span class="op" id="2268486">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="2268490">uintptr</span><span class="op" id="2268497">(</span><span class="ident" id="2268498">unsafe</span><span class="op" id="2268504">.</span><span class="ident" id="2268505">Pointer</span><span class="op" id="2268512">(</span><span class="op" id="2268513">&amp;</span><span class="ident" id="2268514">argvp</span><span class="op" id="2268519">[</span><span class="num" id="2268520">0</span><span class="op" id="2268521">]</span><span class="op" id="2268522">)</span><span class="op" id="2268523">)</span><span class="op" id="2268524">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="2268528">uintptr</span><span class="op" id="2268535">(</span><span class="ident" id="2268536">unsafe</span><span class="op" id="2268542">.</span><span class="ident" id="2268543">Pointer</span><span class="op" id="2268550">(</span><span class="op" id="2268551">&amp;</span><span class="ident" id="2268552">envvp</span><span class="op" id="2268557">[</span><span class="num" id="2268558">0</span><span class="op" id="2268559">]</span><span class="op" id="2268560">)</span><span class="op" id="2268561">)</span><span class="op" id="2268562">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2268565">return</span>&nbsp;<span class="ident" id="2268572">Errno</span><span class="op" id="2268577">(</span><span class="ident" id="2268578">err1</span><span class="op" id="2268582">)</span><br>
<span class="lineno"></span><span class="op" id="2268584">}</span>
</div>
</body>
</html>
