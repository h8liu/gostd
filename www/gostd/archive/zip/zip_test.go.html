<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/zip</h2>
<ul>
<li><a href="/gostd/archive/zip/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/zip/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/zip/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/zip/register.go.html">register.go</a></li>
<li><a href="/gostd/archive/zip/struct.go.html">struct.go</a></li>
<li><a href="/gostd/archive/zip/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/zip/writer_test.go.html">writer_test.go</a></li>
<li><a href="/gostd/archive/zip/zip_test.go.html" class="current">zip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7203850">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7203905">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7203959">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="7204010">//&nbsp;Tests&nbsp;that&nbsp;involve&nbsp;both&nbsp;reading&nbsp;and&nbsp;writing.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7204059">package</span>&nbsp;<span class="ident" id="7204067">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7204072">import</span>&nbsp;<span class="op" id="7204079">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7204082">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7204091">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7204098">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7204106">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7204112">&#34;io/ioutil&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7204125">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7204133">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7204144">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7204155">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7204162">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="7204165">func</span>&nbsp;<span class="ident" id="7204170">TestOver65kFiles</span><span class="op" id="7204186">(</span><span class="ident" id="7204187">t</span>&nbsp;<span class="op" id="7204189">*</span><span class="ident" id="7204190">testing</span><span class="op" id="7204197">.</span><span class="ident" id="7204198">T</span><span class="op" id="7204199">)</span>&nbsp;<span class="op" id="7204201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7204204">buf</span>&nbsp;<span class="op" id="7204208">:=</span>&nbsp;<span class="builtinfunc" id="7204211">new</span><span class="op" id="7204214">(</span><span class="ident" id="7204215">bytes</span><span class="op" id="7204220">.</span><span class="ident" id="7204221">Buffer</span><span class="op" id="7204227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7204230">w</span>&nbsp;<span class="op" id="7204232">:=</span>&nbsp;<span class="ident" id="7204235">NewWriter</span><span class="op" id="7204244">(</span><span class="ident" id="7204245">buf</span><span class="op" id="7204248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7204251">const</span>&nbsp;<span class="ident" id="7204257">nFiles</span>&nbsp;<span class="op" id="7204264">=</span>&nbsp;<span class="op" id="7204266">(</span><span class="num" id="7204267">1</span>&nbsp;<span class="op" id="7204269">&lt;&lt;</span>&nbsp;<span class="num" id="7204272">16</span><span class="op" id="7204274">)</span>&nbsp;<span class="op" id="7204276">+</span>&nbsp;<span class="num" id="7204278">42</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7204282">for</span>&nbsp;<span class="ident" id="7204286">i</span>&nbsp;<span class="op" id="7204288">:=</span>&nbsp;<span class="num" id="7204291">0</span><span class="op" id="7204292">;</span>&nbsp;<span class="ident" id="7204294">i</span>&nbsp;<span class="op" id="7204296">&lt;</span>&nbsp;<span class="ident" id="7204298">nFiles</span><span class="op" id="7204304">;</span>&nbsp;<span class="ident" id="7204306">i</span><span class="op" id="7204307">++</span>&nbsp;<span class="op" id="7204310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7204314">_</span><span class="op" id="7204315">,</span>&nbsp;<span class="ident" id="7204317">err</span>&nbsp;<span class="op" id="7204321">:=</span>&nbsp;<span class="ident" id="7204324">w</span><span class="op" id="7204325">.</span><span class="ident" id="7204326">CreateHeader</span><span class="op" id="7204338">(</span><span class="op" id="7204339">&amp;</span><span class="ident" id="7204340">FileHeader</span><span class="op" id="7204350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7204355">Name</span><span class="op" id="7204359">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7204363">fmt</span><span class="op" id="7204366">.</span><span class="ident" id="7204367">Sprintf</span><span class="op" id="7204374">(</span><span class="string" id="7204375">&#34;%d.dat&#34;</span><span class="op" id="7204383">,</span>&nbsp;<span class="ident" id="7204385">i</span><span class="op" id="7204386">)</span><span class="op" id="7204387">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7204392">Method</span><span class="op" id="7204398">:</span>&nbsp;<span class="ident" id="7204400">Store</span><span class="op" id="7204405">,</span>&nbsp;<span class="comment" id="7204407">//&nbsp;avoid&nbsp;Issue&nbsp;6136&nbsp;and&nbsp;Issue&nbsp;6138</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7204444">}</span><span class="op" id="7204445">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7204449">if</span>&nbsp;<span class="ident" id="7204452">err</span>&nbsp;<span class="op" id="7204456">!=</span>&nbsp;<span class="builtintype" id="7204459">nil</span>&nbsp;<span class="op" id="7204463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7204468">t</span><span class="op" id="7204469">.</span><span class="ident" id="7204470">Fatalf</span><span class="op" id="7204476">(</span><span class="string" id="7204477">&#34;creating&nbsp;file&nbsp;%d:&nbsp;%v&#34;</span><span class="op" id="7204499">,</span>&nbsp;<span class="ident" id="7204501">i</span><span class="op" id="7204502">,</span>&nbsp;<span class="ident" id="7204504">err</span><span class="op" id="7204507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7204511">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7204514">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7204517">if</span>&nbsp;<span class="ident" id="7204520">err</span>&nbsp;<span class="op" id="7204524">:=</span>&nbsp;<span class="ident" id="7204527">w</span><span class="op" id="7204528">.</span><span class="ident" id="7204529">Close</span><span class="op" id="7204534">(</span><span class="op" id="7204535">)</span><span class="op" id="7204536">;</span>&nbsp;<span class="ident" id="7204538">err</span>&nbsp;<span class="op" id="7204542">!=</span>&nbsp;<span class="builtintype" id="7204545">nil</span>&nbsp;<span class="op" id="7204549">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7204553">t</span><span class="op" id="7204554">.</span><span class="ident" id="7204555">Fatalf</span><span class="op" id="7204561">(</span><span class="string" id="7204562">&#34;Writer.Close:&nbsp;%v&#34;</span><span class="op" id="7204580">,</span>&nbsp;<span class="ident" id="7204582">err</span><span class="op" id="7204585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7204588">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7204591">s</span>&nbsp;<span class="op" id="7204593">:=</span>&nbsp;<span class="ident" id="7204596">buf</span><span class="op" id="7204599">.</span><span class="ident" id="7204600">String</span><span class="op" id="7204606">(</span><span class="op" id="7204607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7204610">zr</span><span class="op" id="7204612">,</span>&nbsp;<span class="ident" id="7204614">err</span>&nbsp;<span class="op" id="7204618">:=</span>&nbsp;<span class="ident" id="7204621">NewReader</span><span class="op" id="7204630">(</span><span class="ident" id="7204631">strings</span><span class="op" id="7204638">.</span><span class="ident" id="7204639">NewReader</span><span class="op" id="7204648">(</span><span class="ident" id="7204649">s</span><span class="op" id="7204650">)</span><span class="op" id="7204651">,</span>&nbsp;<span class="builtintype" id="7204653">int64</span><span class="op" id="7204658">(</span><span class="builtinfunc" id="7204659">len</span><span class="op" id="7204662">(</span><span class="ident" id="7204663">s</span><span class="op" id="7204664">)</span><span class="op" id="7204665">)</span><span class="op" id="7204666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7204669">if</span>&nbsp;<span class="ident" id="7204672">err</span>&nbsp;<span class="op" id="7204676">!=</span>&nbsp;<span class="builtintype" id="7204679">nil</span>&nbsp;<span class="op" id="7204683">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7204687">t</span><span class="op" id="7204688">.</span><span class="ident" id="7204689">Fatalf</span><span class="op" id="7204695">(</span><span class="string" id="7204696">&#34;NewReader:&nbsp;%v&#34;</span><span class="op" id="7204711">,</span>&nbsp;<span class="ident" id="7204713">err</span><span class="op" id="7204716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7204719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7204722">if</span>&nbsp;<span class="ident" id="7204725">got</span>&nbsp;<span class="op" id="7204729">:=</span>&nbsp;<span class="builtinfunc" id="7204732">len</span><span class="op" id="7204735">(</span><span class="ident" id="7204736">zr</span><span class="op" id="7204738">.</span><span class="ident" id="7204739">File</span><span class="op" id="7204743">)</span><span class="op" id="7204744">;</span>&nbsp;<span class="ident" id="7204746">got</span>&nbsp;<span class="op" id="7204750">!=</span>&nbsp;<span class="ident" id="7204753">nFiles</span>&nbsp;<span class="op" id="7204760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7204764">t</span><span class="op" id="7204765">.</span><span class="ident" id="7204766">Fatalf</span><span class="op" id="7204772">(</span><span class="string" id="7204773">&#34;File&nbsp;contains&nbsp;%d&nbsp;files,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7204806">,</span>&nbsp;<span class="ident" id="7204808">got</span><span class="op" id="7204811">,</span>&nbsp;<span class="ident" id="7204813">nFiles</span><span class="op" id="7204819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7204822">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7204825">for</span>&nbsp;<span class="ident" id="7204829">i</span>&nbsp;<span class="op" id="7204831">:=</span>&nbsp;<span class="num" id="7204834">0</span><span class="op" id="7204835">;</span>&nbsp;<span class="ident" id="7204837">i</span>&nbsp;<span class="op" id="7204839">&lt;</span>&nbsp;<span class="ident" id="7204841">nFiles</span><span class="op" id="7204847">;</span>&nbsp;<span class="ident" id="7204849">i</span><span class="op" id="7204850">++</span>&nbsp;<span class="op" id="7204853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7204857">want</span>&nbsp;<span class="op" id="7204862">:=</span>&nbsp;<span class="ident" id="7204865">fmt</span><span class="op" id="7204868">.</span><span class="ident" id="7204869">Sprintf</span><span class="op" id="7204876">(</span><span class="string" id="7204877">&#34;%d.dat&#34;</span><span class="op" id="7204885">,</span>&nbsp;<span class="ident" id="7204887">i</span><span class="op" id="7204888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7204892">if</span>&nbsp;<span class="ident" id="7204895">zr</span><span class="op" id="7204897">.</span><span class="ident" id="7204898">File</span><span class="op" id="7204902">[</span><span class="ident" id="7204903">i</span><span class="op" id="7204904">]</span><span class="op" id="7204905">.</span><span class="ident" id="7204906">Name</span>&nbsp;<span class="op" id="7204911">!=</span>&nbsp;<span class="ident" id="7204914">want</span>&nbsp;<span class="op" id="7204919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7204924">t</span><span class="op" id="7204925">.</span><span class="ident" id="7204926">Fatalf</span><span class="op" id="7204932">(</span><span class="string" id="7204933">&#34;File(%d)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7204957">,</span>&nbsp;<span class="ident" id="7204959">i</span><span class="op" id="7204960">,</span>&nbsp;<span class="ident" id="7204962">zr</span><span class="op" id="7204964">.</span><span class="ident" id="7204965">File</span><span class="op" id="7204969">[</span><span class="ident" id="7204970">i</span><span class="op" id="7204971">]</span><span class="op" id="7204972">.</span><span class="ident" id="7204973">Name</span><span class="op" id="7204977">,</span>&nbsp;<span class="ident" id="7204979">want</span><span class="op" id="7204983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7204987">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7204990">}</span><br>
<span class="lineno"></span><span class="op" id="7204992">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7204995">func</span>&nbsp;<span class="ident" id="7205000">TestModTime</span><span class="op" id="7205011">(</span><span class="ident" id="7205012">t</span>&nbsp;<span class="op" id="7205014">*</span><span class="ident" id="7205015">testing</span><span class="op" id="7205022">.</span><span class="ident" id="7205023">T</span><span class="op" id="7205024">)</span>&nbsp;<span class="op" id="7205026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7205029">var</span>&nbsp;<span class="ident" id="7205033">testTime</span>&nbsp;<span class="op" id="7205042">=</span>&nbsp;<span class="ident" id="7205044">time</span><span class="op" id="7205048">.</span><span class="ident" id="7205049">Date</span><span class="op" id="7205053">(</span><span class="num" id="7205054">2009</span><span class="op" id="7205058">,</span>&nbsp;<span class="ident" id="7205060">time</span><span class="op" id="7205064">.</span><span class="ident" id="7205065">November</span><span class="op" id="7205073">,</span>&nbsp;<span class="num" id="7205075">10</span><span class="op" id="7205077">,</span>&nbsp;<span class="num" id="7205079">23</span><span class="op" id="7205081">,</span>&nbsp;<span class="num" id="7205083">45</span><span class="op" id="7205085">,</span>&nbsp;<span class="num" id="7205087">58</span><span class="op" id="7205089">,</span>&nbsp;<span class="num" id="7205091">0</span><span class="op" id="7205092">,</span>&nbsp;<span class="ident" id="7205094">time</span><span class="op" id="7205098">.</span><span class="ident" id="7205099">UTC</span><span class="op" id="7205102">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7205105">fh</span>&nbsp;<span class="op" id="7205108">:=</span>&nbsp;<span class="builtinfunc" id="7205111">new</span><span class="op" id="7205114">(</span><span class="ident" id="7205115">FileHeader</span><span class="op" id="7205125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7205128">fh</span><span class="op" id="7205130">.</span><span class="ident" id="7205131">SetModTime</span><span class="op" id="7205141">(</span><span class="ident" id="7205142">testTime</span><span class="op" id="7205150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7205153">outTime</span>&nbsp;<span class="op" id="7205161">:=</span>&nbsp;<span class="ident" id="7205164">fh</span><span class="op" id="7205166">.</span><span class="ident" id="7205167">ModTime</span><span class="op" id="7205174">(</span><span class="op" id="7205175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7205178">if</span>&nbsp;<span class="op" id="7205181">!</span><span class="ident" id="7205182">outTime</span><span class="op" id="7205189">.</span><span class="ident" id="7205190">Equal</span><span class="op" id="7205195">(</span><span class="ident" id="7205196">testTime</span><span class="op" id="7205204">)</span>&nbsp;<span class="op" id="7205206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7205210">t</span><span class="op" id="7205211">.</span><span class="ident" id="7205212">Errorf</span><span class="op" id="7205218">(</span><span class="string" id="7205219">&#34;times&nbsp;don&#39;t&nbsp;match:&nbsp;got&nbsp;%s,&nbsp;want&nbsp;%s&#34;</span><span class="op" id="7205255">,</span>&nbsp;<span class="ident" id="7205257">outTime</span><span class="op" id="7205264">,</span>&nbsp;<span class="ident" id="7205266">testTime</span><span class="op" id="7205274">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7205277">}</span><br>
<span class="lineno"></span><span class="op" id="7205279">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7205282">func</span>&nbsp;<span class="ident" id="7205287">testHeaderRoundTrip</span><span class="op" id="7205306">(</span><span class="ident" id="7205307">fh</span>&nbsp;<span class="op" id="7205310">*</span><span class="ident" id="7205311">FileHeader</span><span class="op" id="7205321">,</span>&nbsp;<span class="ident" id="7205323">wantUncompressedSize</span>&nbsp;<span class="builtintype" id="7205344">uint32</span><span class="op" id="7205350">,</span>&nbsp;<span class="ident" id="7205352">wantUncompressedSize64</span>&nbsp;<span class="builtintype" id="7205375">uint64</span><span class="op" id="7205381">,</span>&nbsp;<span class="ident" id="7205383">t</span>&nbsp;<span class="op" id="7205385">*</span><span class="ident" id="7205386">testing</span><span class="op" id="7205393">.</span><span class="ident" id="7205394">T</span><span class="op" id="7205395">)</span>&nbsp;<span class="op" id="7205397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7205400">fi</span>&nbsp;<span class="op" id="7205403">:=</span>&nbsp;<span class="ident" id="7205406">fh</span><span class="op" id="7205408">.</span><span class="ident" id="7205409">FileInfo</span><span class="op" id="7205417">(</span><span class="op" id="7205418">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7205421">fh2</span><span class="op" id="7205424">,</span>&nbsp;<span class="ident" id="7205426">err</span>&nbsp;<span class="op" id="7205430">:=</span>&nbsp;<span class="ident" id="7205433">FileInfoHeader</span><span class="op" id="7205447">(</span><span class="ident" id="7205448">fi</span><span class="op" id="7205450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7205453">if</span>&nbsp;<span class="ident" id="7205456">err</span>&nbsp;<span class="op" id="7205460">!=</span>&nbsp;<span class="builtintype" id="7205463">nil</span>&nbsp;<span class="op" id="7205467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7205471">t</span><span class="op" id="7205472">.</span><span class="ident" id="7205473">Fatal</span><span class="op" id="7205478">(</span><span class="ident" id="7205479">err</span><span class="op" id="7205482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7205485">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7205488">if</span>&nbsp;<span class="ident" id="7205491">got</span><span class="op" id="7205494">,</span>&nbsp;<span class="ident" id="7205496">want</span>&nbsp;<span class="op" id="7205501">:=</span>&nbsp;<span class="ident" id="7205504">fh2</span><span class="op" id="7205507">.</span><span class="ident" id="7205508">Name</span><span class="op" id="7205512">,</span>&nbsp;<span class="ident" id="7205514">fh</span><span class="op" id="7205516">.</span><span class="ident" id="7205517">Name</span><span class="op" id="7205521">;</span>&nbsp;<span class="ident" id="7205523">got</span>&nbsp;<span class="op" id="7205527">!=</span>&nbsp;<span class="ident" id="7205530">want</span>&nbsp;<span class="op" id="7205535">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7205539">t</span><span class="op" id="7205540">.</span><span class="ident" id="7205541">Errorf</span><span class="op" id="7205547">(</span><span class="string" id="7205548">&#34;Name:&nbsp;got&nbsp;%s,&nbsp;want&nbsp;%s\n&#34;</span><span class="op" id="7205573">,</span>&nbsp;<span class="ident" id="7205575">got</span><span class="op" id="7205578">,</span>&nbsp;<span class="ident" id="7205580">want</span><span class="op" id="7205584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7205587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7205590">if</span>&nbsp;<span class="ident" id="7205593">got</span><span class="op" id="7205596">,</span>&nbsp;<span class="ident" id="7205598">want</span>&nbsp;<span class="op" id="7205603">:=</span>&nbsp;<span class="ident" id="7205606">fh2</span><span class="op" id="7205609">.</span><span class="ident" id="7205610">UncompressedSize</span><span class="op" id="7205626">,</span>&nbsp;<span class="ident" id="7205628">wantUncompressedSize</span><span class="op" id="7205648">;</span>&nbsp;<span class="ident" id="7205650">got</span>&nbsp;<span class="op" id="7205654">!=</span>&nbsp;<span class="ident" id="7205657">want</span>&nbsp;<span class="op" id="7205662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7205666">t</span><span class="op" id="7205667">.</span><span class="ident" id="7205668">Errorf</span><span class="op" id="7205674">(</span><span class="string" id="7205675">&#34;UncompressedSize:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d\n&#34;</span><span class="op" id="7205712">,</span>&nbsp;<span class="ident" id="7205714">got</span><span class="op" id="7205717">,</span>&nbsp;<span class="ident" id="7205719">want</span><span class="op" id="7205723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7205726">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7205729">if</span>&nbsp;<span class="ident" id="7205732">got</span><span class="op" id="7205735">,</span>&nbsp;<span class="ident" id="7205737">want</span>&nbsp;<span class="op" id="7205742">:=</span>&nbsp;<span class="ident" id="7205745">fh2</span><span class="op" id="7205748">.</span><span class="ident" id="7205749">UncompressedSize64</span><span class="op" id="7205767">,</span>&nbsp;<span class="ident" id="7205769">wantUncompressedSize64</span><span class="op" id="7205791">;</span>&nbsp;<span class="ident" id="7205793">got</span>&nbsp;<span class="op" id="7205797">!=</span>&nbsp;<span class="ident" id="7205800">want</span>&nbsp;<span class="op" id="7205805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7205809">t</span><span class="op" id="7205810">.</span><span class="ident" id="7205811">Errorf</span><span class="op" id="7205817">(</span><span class="string" id="7205818">&#34;UncompressedSize64:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d\n&#34;</span><span class="op" id="7205857">,</span>&nbsp;<span class="ident" id="7205859">got</span><span class="op" id="7205862">,</span>&nbsp;<span class="ident" id="7205864">want</span><span class="op" id="7205868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7205871">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7205874">if</span>&nbsp;<span class="ident" id="7205877">got</span><span class="op" id="7205880">,</span>&nbsp;<span class="ident" id="7205882">want</span>&nbsp;<span class="op" id="7205887">:=</span>&nbsp;<span class="ident" id="7205890">fh2</span><span class="op" id="7205893">.</span><span class="ident" id="7205894">ModifiedTime</span><span class="op" id="7205906">,</span>&nbsp;<span class="ident" id="7205908">fh</span><span class="op" id="7205910">.</span><span class="ident" id="7205911">ModifiedTime</span><span class="op" id="7205923">;</span>&nbsp;<span class="ident" id="7205925">got</span>&nbsp;<span class="op" id="7205929">!=</span>&nbsp;<span class="ident" id="7205932">want</span>&nbsp;<span class="op" id="7205937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7205941">t</span><span class="op" id="7205942">.</span><span class="ident" id="7205943">Errorf</span><span class="op" id="7205949">(</span><span class="string" id="7205950">&#34;ModifiedTime:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d\n&#34;</span><span class="op" id="7205983">,</span>&nbsp;<span class="ident" id="7205985">got</span><span class="op" id="7205988">,</span>&nbsp;<span class="ident" id="7205990">want</span><span class="op" id="7205994">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7205997">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7206000">if</span>&nbsp;<span class="ident" id="7206003">got</span><span class="op" id="7206006">,</span>&nbsp;<span class="ident" id="7206008">want</span>&nbsp;<span class="op" id="7206013">:=</span>&nbsp;<span class="ident" id="7206016">fh2</span><span class="op" id="7206019">.</span><span class="ident" id="7206020">ModifiedDate</span><span class="op" id="7206032">,</span>&nbsp;<span class="ident" id="7206034">fh</span><span class="op" id="7206036">.</span><span class="ident" id="7206037">ModifiedDate</span><span class="op" id="7206049">;</span>&nbsp;<span class="ident" id="7206051">got</span>&nbsp;<span class="op" id="7206055">!=</span>&nbsp;<span class="ident" id="7206058">want</span>&nbsp;<span class="op" id="7206063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7206067">t</span><span class="op" id="7206068">.</span><span class="ident" id="7206069">Errorf</span><span class="op" id="7206075">(</span><span class="string" id="7206076">&#34;ModifiedDate:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d\n&#34;</span><span class="op" id="7206109">,</span>&nbsp;<span class="ident" id="7206111">got</span><span class="op" id="7206114">,</span>&nbsp;<span class="ident" id="7206116">want</span><span class="op" id="7206120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7206123">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7206127">if</span>&nbsp;<span class="ident" id="7206130">sysfh</span><span class="op" id="7206135">,</span>&nbsp;<span class="ident" id="7206137">ok</span>&nbsp;<span class="op" id="7206140">:=</span>&nbsp;<span class="ident" id="7206143">fi</span><span class="op" id="7206145">.</span><span class="ident" id="7206146">Sys</span><span class="op" id="7206149">(</span><span class="op" id="7206150">)</span><span class="op" id="7206151">.</span><span class="op" id="7206152">(</span><span class="op" id="7206153">*</span><span class="ident" id="7206154">FileHeader</span><span class="op" id="7206164">)</span><span class="op" id="7206165">;</span>&nbsp;<span class="op" id="7206167">!</span><span class="ident" id="7206168">ok</span>&nbsp;<span class="op" id="7206171">&amp;&amp;</span>&nbsp;<span class="ident" id="7206174">sysfh</span>&nbsp;<span class="op" id="7206180">!=</span>&nbsp;<span class="ident" id="7206183">fh</span>&nbsp;<span class="op" id="7206186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7206190">t</span><span class="op" id="7206191">.</span><span class="ident" id="7206192">Errorf</span><span class="op" id="7206198">(</span><span class="string" id="7206199">&#34;Sys&nbsp;didn&#39;t&nbsp;return&nbsp;original&nbsp;*FileHeader&#34;</span><span class="op" id="7206239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7206242">}</span><br>
<span class="lineno"></span><span class="op" id="7206244">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="7206247">func</span>&nbsp;<span class="ident" id="7206252">TestFileHeaderRoundTrip</span><span class="op" id="7206275">(</span><span class="ident" id="7206276">t</span>&nbsp;<span class="op" id="7206278">*</span><span class="ident" id="7206279">testing</span><span class="op" id="7206286">.</span><span class="ident" id="7206287">T</span><span class="op" id="7206288">)</span>&nbsp;<span class="op" id="7206290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7206293">fh</span>&nbsp;<span class="op" id="7206296">:=</span>&nbsp;<span class="op" id="7206299">&amp;</span><span class="ident" id="7206300">FileHeader</span><span class="op" id="7206310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7206314">Name</span><span class="op" id="7206318">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7206332">&#34;foo.txt&#34;</span><span class="op" id="7206341">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7206345">UncompressedSize</span><span class="op" id="7206361">:</span>&nbsp;<span class="num" id="7206363">987654321</span><span class="op" id="7206372">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7206376">ModifiedTime</span><span class="op" id="7206388">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7206394">1234</span><span class="op" id="7206398">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7206402">ModifiedDate</span><span class="op" id="7206414">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7206420">5678</span><span class="op" id="7206424">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7206427">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7206430">testHeaderRoundTrip</span><span class="op" id="7206449">(</span><span class="ident" id="7206450">fh</span><span class="op" id="7206452">,</span>&nbsp;<span class="ident" id="7206454">fh</span><span class="op" id="7206456">.</span><span class="ident" id="7206457">UncompressedSize</span><span class="op" id="7206473">,</span>&nbsp;<span class="builtintype" id="7206475">uint64</span><span class="op" id="7206481">(</span><span class="ident" id="7206482">fh</span><span class="op" id="7206484">.</span><span class="ident" id="7206485">UncompressedSize</span><span class="op" id="7206501">)</span><span class="op" id="7206502">,</span>&nbsp;<span class="ident" id="7206504">t</span><span class="op" id="7206505">)</span><br>
<span class="lineno"></span><span class="op" id="7206507">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="7206510">func</span>&nbsp;<span class="ident" id="7206515">TestFileHeaderRoundTrip64</span><span class="op" id="7206540">(</span><span class="ident" id="7206541">t</span>&nbsp;<span class="op" id="7206543">*</span><span class="ident" id="7206544">testing</span><span class="op" id="7206551">.</span><span class="ident" id="7206552">T</span><span class="op" id="7206553">)</span>&nbsp;<span class="op" id="7206555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7206558">fh</span>&nbsp;<span class="op" id="7206561">:=</span>&nbsp;<span class="op" id="7206564">&amp;</span><span class="ident" id="7206565">FileHeader</span><span class="op" id="7206575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7206579">Name</span><span class="op" id="7206583">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7206599">&#34;foo.txt&#34;</span><span class="op" id="7206608">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7206612">UncompressedSize64</span><span class="op" id="7206630">:</span>&nbsp;<span class="num" id="7206632">9876543210</span><span class="op" id="7206642">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7206646">ModifiedTime</span><span class="op" id="7206658">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7206666">1234</span><span class="op" id="7206670">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7206674">ModifiedDate</span><span class="op" id="7206686">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7206694">5678</span><span class="op" id="7206698">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7206701">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7206704">testHeaderRoundTrip</span><span class="op" id="7206723">(</span><span class="ident" id="7206724">fh</span><span class="op" id="7206726">,</span>&nbsp;<span class="ident" id="7206728">uint32max</span><span class="op" id="7206737">,</span>&nbsp;<span class="ident" id="7206739">fh</span><span class="op" id="7206741">.</span><span class="ident" id="7206742">UncompressedSize64</span><span class="op" id="7206760">,</span>&nbsp;<span class="ident" id="7206762">t</span><span class="op" id="7206763">)</span><br>
<span class="lineno"></span><span class="op" id="7206765">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="7206768">type</span>&nbsp;<span class="ident" id="7206773">repeatedByte</span>&nbsp;<span class="keyword" id="7206786">struct</span>&nbsp;<span class="op" id="7206793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7206796">off</span>&nbsp;<span class="builtintype" id="7206800">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7206807">b</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7206811">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7206817">n</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7206821">int64</span><br>
<span class="lineno"></span><span class="op" id="7206827">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="7206830">//&nbsp;rleBuffer&nbsp;is&nbsp;a&nbsp;run-length-encoded&nbsp;byte&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="7206880">//&nbsp;It&#39;s&nbsp;an&nbsp;io.Writer&nbsp;(like&nbsp;a&nbsp;bytes.Buffer)&nbsp;and&nbsp;also&nbsp;an&nbsp;io.ReaderAt,</span><br>
<span class="lineno"></span><span class="comment" id="7206948">//&nbsp;allowing&nbsp;random-access&nbsp;reads.</span><br>
<span class="lineno"></span><span class="keyword" id="7206981">type</span>&nbsp;<span class="ident" id="7206986">rleBuffer</span>&nbsp;<span class="keyword" id="7206996">struct</span>&nbsp;<span class="op" id="7207003">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7207006">buf</span>&nbsp;<span class="op" id="7207010">[</span><span class="op" id="7207011">]</span><span class="ident" id="7207012">repeatedByte</span><br>
<span class="lineno"></span><span class="op" id="7207025">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7207028">func</span>&nbsp;<span class="op" id="7207033">(</span><span class="ident" id="7207034">r</span>&nbsp;<span class="op" id="7207036">*</span><span class="ident" id="7207037">rleBuffer</span><span class="op" id="7207046">)</span>&nbsp;<span class="ident" id="7207048">Size</span><span class="op" id="7207052">(</span><span class="op" id="7207053">)</span>&nbsp;<span class="builtintype" id="7207055">int64</span>&nbsp;<span class="op" id="7207061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7207064">if</span>&nbsp;<span class="builtinfunc" id="7207067">len</span><span class="op" id="7207070">(</span><span class="ident" id="7207071">r</span><span class="op" id="7207072">.</span><span class="ident" id="7207073">buf</span><span class="op" id="7207076">)</span>&nbsp;<span class="op" id="7207078">==</span>&nbsp;<span class="num" id="7207081">0</span>&nbsp;<span class="op" id="7207083">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7207087">return</span>&nbsp;<span class="num" id="7207094">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7207097">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7207100">last</span>&nbsp;<span class="op" id="7207105">:=</span>&nbsp;<span class="op" id="7207108">&amp;</span><span class="ident" id="7207109">r</span><span class="op" id="7207110">.</span><span class="ident" id="7207111">buf</span><span class="op" id="7207114">[</span><span class="builtinfunc" id="7207115">len</span><span class="op" id="7207118">(</span><span class="ident" id="7207119">r</span><span class="op" id="7207120">.</span><span class="ident" id="7207121">buf</span><span class="op" id="7207124">)</span><span class="op" id="7207125">-</span><span class="num" id="7207126">1</span><span class="op" id="7207127">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7207130">return</span>&nbsp;<span class="ident" id="7207137">last</span><span class="op" id="7207141">.</span><span class="ident" id="7207142">off</span>&nbsp;<span class="op" id="7207146">+</span>&nbsp;<span class="ident" id="7207148">last</span><span class="op" id="7207152">.</span><span class="ident" id="7207153">n</span><br>
<span class="lineno"></span><span class="op" id="7207155">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="keyword" id="7207158">func</span>&nbsp;<span class="op" id="7207163">(</span><span class="ident" id="7207164">r</span>&nbsp;<span class="op" id="7207166">*</span><span class="ident" id="7207167">rleBuffer</span><span class="op" id="7207176">)</span>&nbsp;<span class="ident" id="7207178">Write</span><span class="op" id="7207183">(</span><span class="ident" id="7207184">p</span>&nbsp;<span class="op" id="7207186">[</span><span class="op" id="7207187">]</span><span class="builtintype" id="7207188">byte</span><span class="op" id="7207192">)</span>&nbsp;<span class="op" id="7207194">(</span><span class="ident" id="7207195">n</span>&nbsp;<span class="builtintype" id="7207197">int</span><span class="op" id="7207200">,</span>&nbsp;<span class="ident" id="7207202">err</span>&nbsp;<span class="builtintype" id="7207206">error</span><span class="op" id="7207211">)</span>&nbsp;<span class="op" id="7207213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7207216">var</span>&nbsp;<span class="ident" id="7207220">rp</span>&nbsp;<span class="op" id="7207223">*</span><span class="ident" id="7207224">repeatedByte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7207238">if</span>&nbsp;<span class="builtinfunc" id="7207241">len</span><span class="op" id="7207244">(</span><span class="ident" id="7207245">r</span><span class="op" id="7207246">.</span><span class="ident" id="7207247">buf</span><span class="op" id="7207250">)</span>&nbsp;<span class="op" id="7207252">&gt;</span>&nbsp;<span class="num" id="7207254">0</span>&nbsp;<span class="op" id="7207256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7207260">rp</span>&nbsp;<span class="op" id="7207263">=</span>&nbsp;<span class="op" id="7207265">&amp;</span><span class="ident" id="7207266">r</span><span class="op" id="7207267">.</span><span class="ident" id="7207268">buf</span><span class="op" id="7207271">[</span><span class="builtinfunc" id="7207272">len</span><span class="op" id="7207275">(</span><span class="ident" id="7207276">r</span><span class="op" id="7207277">.</span><span class="ident" id="7207278">buf</span><span class="op" id="7207281">)</span><span class="op" id="7207282">-</span><span class="num" id="7207283">1</span><span class="op" id="7207284">]</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7207288">//&nbsp;Fast&nbsp;path,&nbsp;if&nbsp;p&nbsp;is&nbsp;entirely&nbsp;the&nbsp;same&nbsp;byte&nbsp;repeated.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7207345">if</span>&nbsp;<span class="ident" id="7207348">lastByte</span>&nbsp;<span class="op" id="7207357">:=</span>&nbsp;<span class="ident" id="7207360">rp</span><span class="op" id="7207362">.</span><span class="ident" id="7207363">b</span><span class="op" id="7207364">;</span>&nbsp;<span class="builtinfunc" id="7207366">len</span><span class="op" id="7207369">(</span><span class="ident" id="7207370">p</span><span class="op" id="7207371">)</span>&nbsp;<span class="op" id="7207373">&gt;</span>&nbsp;<span class="num" id="7207375">0</span>&nbsp;<span class="op" id="7207377">&amp;&amp;</span>&nbsp;<span class="ident" id="7207380">p</span><span class="op" id="7207381">[</span><span class="num" id="7207382">0</span><span class="op" id="7207383">]</span>&nbsp;<span class="op" id="7207385">==</span>&nbsp;<span class="ident" id="7207388">lastByte</span>&nbsp;<span class="op" id="7207397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7207402">all</span>&nbsp;<span class="op" id="7207406">:=</span>&nbsp;<span class="builtintype" id="7207409">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7207417">for</span>&nbsp;<span class="ident" id="7207421">_</span><span class="op" id="7207422">,</span>&nbsp;<span class="ident" id="7207424">b</span>&nbsp;<span class="op" id="7207426">:=</span>&nbsp;<span class="keyword" id="7207429">range</span>&nbsp;<span class="ident" id="7207435">p</span>&nbsp;<span class="op" id="7207437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7207443">if</span>&nbsp;<span class="ident" id="7207446">b</span>&nbsp;<span class="op" id="7207448">!=</span>&nbsp;<span class="ident" id="7207451">lastByte</span>&nbsp;<span class="op" id="7207460">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7207467">all</span>&nbsp;<span class="op" id="7207471">=</span>&nbsp;<span class="builtintype" id="7207473">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7207484">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7207494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7207499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7207504">if</span>&nbsp;<span class="ident" id="7207507">all</span>&nbsp;<span class="op" id="7207511">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7207517">rp</span><span class="op" id="7207519">.</span><span class="ident" id="7207520">n</span>&nbsp;<span class="op" id="7207522">+=</span>&nbsp;<span class="builtintype" id="7207525">int64</span><span class="op" id="7207530">(</span><span class="builtinfunc" id="7207531">len</span><span class="op" id="7207534">(</span><span class="ident" id="7207535">p</span><span class="op" id="7207536">)</span><span class="op" id="7207537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7207543">return</span>&nbsp;<span class="builtinfunc" id="7207550">len</span><span class="op" id="7207553">(</span><span class="ident" id="7207554">p</span><span class="op" id="7207555">)</span><span class="op" id="7207556">,</span>&nbsp;<span class="builtintype" id="7207558">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7207565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7207569">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7207572">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7207576">for</span>&nbsp;<span class="ident" id="7207580">_</span><span class="op" id="7207581">,</span>&nbsp;<span class="ident" id="7207583">b</span>&nbsp;<span class="op" id="7207585">:=</span>&nbsp;<span class="keyword" id="7207588">range</span>&nbsp;<span class="ident" id="7207594">p</span>&nbsp;<span class="op" id="7207596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7207600">if</span>&nbsp;<span class="ident" id="7207603">rp</span>&nbsp;<span class="op" id="7207606">==</span>&nbsp;<span class="builtintype" id="7207609">nil</span>&nbsp;<span class="op" id="7207613">||</span>&nbsp;<span class="ident" id="7207616">rp</span><span class="op" id="7207618">.</span><span class="ident" id="7207619">b</span>&nbsp;<span class="op" id="7207621">!=</span>&nbsp;<span class="ident" id="7207624">b</span>&nbsp;<span class="op" id="7207626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7207631">r</span><span class="op" id="7207632">.</span><span class="ident" id="7207633">buf</span>&nbsp;<span class="op" id="7207637">=</span>&nbsp;<span class="builtinfunc" id="7207639">append</span><span class="op" id="7207645">(</span><span class="ident" id="7207646">r</span><span class="op" id="7207647">.</span><span class="ident" id="7207648">buf</span><span class="op" id="7207651">,</span>&nbsp;<span class="ident" id="7207653">repeatedByte</span><span class="op" id="7207665">{</span><span class="ident" id="7207666">r</span><span class="op" id="7207667">.</span><span class="ident" id="7207668">Size</span><span class="op" id="7207672">(</span><span class="op" id="7207673">)</span><span class="op" id="7207674">,</span>&nbsp;<span class="ident" id="7207676">b</span><span class="op" id="7207677">,</span>&nbsp;<span class="num" id="7207679">1</span><span class="op" id="7207680">}</span><span class="op" id="7207681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7207686">rp</span>&nbsp;<span class="op" id="7207689">=</span>&nbsp;<span class="op" id="7207691">&amp;</span><span class="ident" id="7207692">r</span><span class="op" id="7207693">.</span><span class="ident" id="7207694">buf</span><span class="op" id="7207697">[</span><span class="builtinfunc" id="7207698">len</span><span class="op" id="7207701">(</span><span class="ident" id="7207702">r</span><span class="op" id="7207703">.</span><span class="ident" id="7207704">buf</span><span class="op" id="7207707">)</span><span class="op" id="7207708">-</span><span class="num" id="7207709">1</span><span class="op" id="7207710">]</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7207714">}</span>&nbsp;<span class="keyword" id="7207716">else</span>&nbsp;<span class="op" id="7207721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7207726">rp</span><span class="op" id="7207728">.</span><span class="ident" id="7207729">n</span><span class="op" id="7207730">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7207735">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7207738">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7207741">return</span>&nbsp;<span class="builtinfunc" id="7207748">len</span><span class="op" id="7207751">(</span><span class="ident" id="7207752">p</span><span class="op" id="7207753">)</span><span class="op" id="7207754">,</span>&nbsp;<span class="builtintype" id="7207756">nil</span><br>
<span class="lineno">160</span><span class="op" id="7207760">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7207763">func</span>&nbsp;<span class="op" id="7207768">(</span><span class="ident" id="7207769">r</span>&nbsp;<span class="op" id="7207771">*</span><span class="ident" id="7207772">rleBuffer</span><span class="op" id="7207781">)</span>&nbsp;<span class="ident" id="7207783">ReadAt</span><span class="op" id="7207789">(</span><span class="ident" id="7207790">p</span>&nbsp;<span class="op" id="7207792">[</span><span class="op" id="7207793">]</span><span class="builtintype" id="7207794">byte</span><span class="op" id="7207798">,</span>&nbsp;<span class="ident" id="7207800">off</span>&nbsp;<span class="builtintype" id="7207804">int64</span><span class="op" id="7207809">)</span>&nbsp;<span class="op" id="7207811">(</span><span class="ident" id="7207812">n</span>&nbsp;<span class="builtintype" id="7207814">int</span><span class="op" id="7207817">,</span>&nbsp;<span class="ident" id="7207819">err</span>&nbsp;<span class="builtintype" id="7207823">error</span><span class="op" id="7207828">)</span>&nbsp;<span class="op" id="7207830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7207833">if</span>&nbsp;<span class="builtinfunc" id="7207836">len</span><span class="op" id="7207839">(</span><span class="ident" id="7207840">p</span><span class="op" id="7207841">)</span>&nbsp;<span class="op" id="7207843">==</span>&nbsp;<span class="num" id="7207846">0</span>&nbsp;<span class="op" id="7207848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7207852">return</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7207860">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7207863">skipParts</span>&nbsp;<span class="op" id="7207873">:=</span>&nbsp;<span class="ident" id="7207876">sort</span><span class="op" id="7207880">.</span><span class="ident" id="7207881">Search</span><span class="op" id="7207887">(</span><span class="builtinfunc" id="7207888">len</span><span class="op" id="7207891">(</span><span class="ident" id="7207892">r</span><span class="op" id="7207893">.</span><span class="ident" id="7207894">buf</span><span class="op" id="7207897">)</span><span class="op" id="7207898">,</span>&nbsp;<span class="keyword" id="7207900">func</span><span class="op" id="7207904">(</span><span class="ident" id="7207905">i</span>&nbsp;<span class="builtintype" id="7207907">int</span><span class="op" id="7207910">)</span>&nbsp;<span class="builtintype" id="7207912">bool</span>&nbsp;<span class="op" id="7207917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7207921">part</span>&nbsp;<span class="op" id="7207926">:=</span>&nbsp;<span class="op" id="7207929">&amp;</span><span class="ident" id="7207930">r</span><span class="op" id="7207931">.</span><span class="ident" id="7207932">buf</span><span class="op" id="7207935">[</span><span class="ident" id="7207936">i</span><span class="op" id="7207937">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7207941">return</span>&nbsp;<span class="ident" id="7207948">part</span><span class="op" id="7207952">.</span><span class="ident" id="7207953">off</span><span class="op" id="7207956">+</span><span class="ident" id="7207957">part</span><span class="op" id="7207961">.</span><span class="ident" id="7207962">n</span>&nbsp;<span class="op" id="7207964">&gt;</span>&nbsp;<span class="ident" id="7207966">off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7207971">}</span><span class="op" id="7207972">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7207975">parts</span>&nbsp;<span class="op" id="7207981">:=</span>&nbsp;<span class="ident" id="7207984">r</span><span class="op" id="7207985">.</span><span class="ident" id="7207986">buf</span><span class="op" id="7207989">[</span><span class="ident" id="7207990">skipParts</span><span class="op" id="7207999">:</span><span class="op" id="7208000">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7208003">if</span>&nbsp;<span class="builtinfunc" id="7208006">len</span><span class="op" id="7208009">(</span><span class="ident" id="7208010">parts</span><span class="op" id="7208015">)</span>&nbsp;<span class="op" id="7208017">&gt;</span>&nbsp;<span class="num" id="7208019">0</span>&nbsp;<span class="op" id="7208021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7208025">skipBytes</span>&nbsp;<span class="op" id="7208035">:=</span>&nbsp;<span class="ident" id="7208038">off</span>&nbsp;<span class="op" id="7208042">-</span>&nbsp;<span class="ident" id="7208044">parts</span><span class="op" id="7208049">[</span><span class="num" id="7208050">0</span><span class="op" id="7208051">]</span><span class="op" id="7208052">.</span><span class="ident" id="7208053">off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7208059">for</span>&nbsp;<span class="builtinfunc" id="7208063">len</span><span class="op" id="7208066">(</span><span class="ident" id="7208067">parts</span><span class="op" id="7208072">)</span>&nbsp;<span class="op" id="7208074">&gt;</span>&nbsp;<span class="num" id="7208076">0</span>&nbsp;<span class="op" id="7208078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7208083">part</span>&nbsp;<span class="op" id="7208088">:=</span>&nbsp;<span class="ident" id="7208091">parts</span><span class="op" id="7208096">[</span><span class="num" id="7208097">0</span><span class="op" id="7208098">]</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7208103">for</span>&nbsp;<span class="ident" id="7208107">i</span>&nbsp;<span class="op" id="7208109">:=</span>&nbsp;<span class="ident" id="7208112">skipBytes</span><span class="op" id="7208121">;</span>&nbsp;<span class="ident" id="7208123">i</span>&nbsp;<span class="op" id="7208125">&lt;</span>&nbsp;<span class="ident" id="7208127">part</span><span class="op" id="7208131">.</span><span class="ident" id="7208132">n</span><span class="op" id="7208133">;</span>&nbsp;<span class="ident" id="7208135">i</span><span class="op" id="7208136">++</span>&nbsp;<span class="op" id="7208139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7208145">if</span>&nbsp;<span class="ident" id="7208148">n</span>&nbsp;<span class="op" id="7208150">==</span>&nbsp;<span class="builtinfunc" id="7208153">len</span><span class="op" id="7208156">(</span><span class="ident" id="7208157">p</span><span class="op" id="7208158">)</span>&nbsp;<span class="op" id="7208160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7208167">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7208178">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7208184">p</span><span class="op" id="7208185">[</span><span class="ident" id="7208186">n</span><span class="op" id="7208187">]</span>&nbsp;<span class="op" id="7208189">=</span>&nbsp;<span class="ident" id="7208191">part</span><span class="op" id="7208195">.</span><span class="ident" id="7208196">b</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7208202">n</span><span class="op" id="7208203">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7208209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7208214">parts</span>&nbsp;<span class="op" id="7208220">=</span>&nbsp;<span class="ident" id="7208222">parts</span><span class="op" id="7208227">[</span><span class="num" id="7208228">1</span><span class="op" id="7208229">:</span><span class="op" id="7208230">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7208235">skipBytes</span>&nbsp;<span class="op" id="7208245">=</span>&nbsp;<span class="num" id="7208247">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7208251">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7208254">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7208257">if</span>&nbsp;<span class="ident" id="7208260">n</span>&nbsp;<span class="op" id="7208262">!=</span>&nbsp;<span class="builtinfunc" id="7208265">len</span><span class="op" id="7208268">(</span><span class="ident" id="7208269">p</span><span class="op" id="7208270">)</span>&nbsp;<span class="op" id="7208272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7208276">err</span>&nbsp;<span class="op" id="7208280">=</span>&nbsp;<span class="ident" id="7208282">io</span><span class="op" id="7208284">.</span><span class="ident" id="7208285">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7208303">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7208306">return</span><br>
<span class="lineno">190</span><span class="op" id="7208313">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7208316">//&nbsp;Just&nbsp;testing&nbsp;the&nbsp;rleBuffer&nbsp;used&nbsp;in&nbsp;the&nbsp;Zip64&nbsp;test&nbsp;above.&nbsp;Not&nbsp;used&nbsp;by&nbsp;the&nbsp;zip&nbsp;code.</span><br>
<span class="lineno"></span><span class="keyword" id="7208402">func</span>&nbsp;<span class="ident" id="7208407">TestRLEBuffer</span><span class="op" id="7208420">(</span><span class="ident" id="7208421">t</span>&nbsp;<span class="op" id="7208423">*</span><span class="ident" id="7208424">testing</span><span class="op" id="7208431">.</span><span class="ident" id="7208432">T</span><span class="op" id="7208433">)</span>&nbsp;<span class="op" id="7208435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7208438">b</span>&nbsp;<span class="op" id="7208440">:=</span>&nbsp;<span class="builtinfunc" id="7208443">new</span><span class="op" id="7208446">(</span><span class="ident" id="7208447">rleBuffer</span><span class="op" id="7208456">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7208459">var</span>&nbsp;<span class="ident" id="7208463">all</span>&nbsp;<span class="op" id="7208467">[</span><span class="op" id="7208468">]</span><span class="builtintype" id="7208469">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7208475">writes</span>&nbsp;<span class="op" id="7208482">:=</span>&nbsp;<span class="op" id="7208485">[</span><span class="op" id="7208486">]</span><span class="builtintype" id="7208487">string</span><span class="op" id="7208493">{</span><span class="string" id="7208494">&#34;abcdeee&#34;</span><span class="op" id="7208503">,</span>&nbsp;<span class="string" id="7208505">&#34;eeeeeee&#34;</span><span class="op" id="7208514">,</span>&nbsp;<span class="string" id="7208516">&#34;eeeefghaaiii&#34;</span><span class="op" id="7208530">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7208533">for</span>&nbsp;<span class="ident" id="7208537">_</span><span class="op" id="7208538">,</span>&nbsp;<span class="ident" id="7208540">w</span>&nbsp;<span class="op" id="7208542">:=</span>&nbsp;<span class="keyword" id="7208545">range</span>&nbsp;<span class="ident" id="7208551">writes</span>&nbsp;<span class="op" id="7208558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7208562">b</span><span class="op" id="7208563">.</span><span class="ident" id="7208564">Write</span><span class="op" id="7208569">(</span><span class="op" id="7208570">[</span><span class="op" id="7208571">]</span><span class="builtintype" id="7208572">byte</span><span class="op" id="7208576">(</span><span class="ident" id="7208577">w</span><span class="op" id="7208578">)</span><span class="op" id="7208579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7208583">all</span>&nbsp;<span class="op" id="7208587">=</span>&nbsp;<span class="builtinfunc" id="7208589">append</span><span class="op" id="7208595">(</span><span class="ident" id="7208596">all</span><span class="op" id="7208599">,</span>&nbsp;<span class="ident" id="7208601">w</span><span class="op" id="7208602">...</span><span class="op" id="7208605">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7208608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7208611">if</span>&nbsp;<span class="builtinfunc" id="7208614">len</span><span class="op" id="7208617">(</span><span class="ident" id="7208618">b</span><span class="op" id="7208619">.</span><span class="ident" id="7208620">buf</span><span class="op" id="7208623">)</span>&nbsp;<span class="op" id="7208625">!=</span>&nbsp;<span class="num" id="7208628">10</span>&nbsp;<span class="op" id="7208631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7208635">t</span><span class="op" id="7208636">.</span><span class="ident" id="7208637">Fatalf</span><span class="op" id="7208643">(</span><span class="string" id="7208644">&#34;len(b.buf)&nbsp;=&nbsp;%d;&nbsp;want&nbsp;10&#34;</span><span class="op" id="7208670">,</span>&nbsp;<span class="builtinfunc" id="7208672">len</span><span class="op" id="7208675">(</span><span class="ident" id="7208676">b</span><span class="op" id="7208677">.</span><span class="ident" id="7208678">buf</span><span class="op" id="7208681">)</span><span class="op" id="7208682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7208685">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7208689">for</span>&nbsp;<span class="ident" id="7208693">i</span>&nbsp;<span class="op" id="7208695">:=</span>&nbsp;<span class="num" id="7208698">0</span><span class="op" id="7208699">;</span>&nbsp;<span class="ident" id="7208701">i</span>&nbsp;<span class="op" id="7208703">&lt;</span>&nbsp;<span class="builtinfunc" id="7208705">len</span><span class="op" id="7208708">(</span><span class="ident" id="7208709">all</span><span class="op" id="7208712">)</span><span class="op" id="7208713">;</span>&nbsp;<span class="ident" id="7208715">i</span><span class="op" id="7208716">++</span>&nbsp;<span class="op" id="7208719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7208723">for</span>&nbsp;<span class="ident" id="7208727">j</span>&nbsp;<span class="op" id="7208729">:=</span>&nbsp;<span class="num" id="7208732">0</span><span class="op" id="7208733">;</span>&nbsp;<span class="ident" id="7208735">j</span>&nbsp;<span class="op" id="7208737">&lt;</span>&nbsp;<span class="builtinfunc" id="7208739">len</span><span class="op" id="7208742">(</span><span class="ident" id="7208743">all</span><span class="op" id="7208746">)</span><span class="op" id="7208747">-</span><span class="ident" id="7208748">i</span><span class="op" id="7208749">;</span>&nbsp;<span class="ident" id="7208751">j</span><span class="op" id="7208752">++</span>&nbsp;<span class="op" id="7208755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7208760">buf</span>&nbsp;<span class="op" id="7208764">:=</span>&nbsp;<span class="builtinfunc" id="7208767">make</span><span class="op" id="7208771">(</span><span class="op" id="7208772">[</span><span class="op" id="7208773">]</span><span class="builtintype" id="7208774">byte</span><span class="op" id="7208778">,</span>&nbsp;<span class="ident" id="7208780">j</span><span class="op" id="7208781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7208786">n</span><span class="op" id="7208787">,</span>&nbsp;<span class="ident" id="7208789">err</span>&nbsp;<span class="op" id="7208793">:=</span>&nbsp;<span class="ident" id="7208796">b</span><span class="op" id="7208797">.</span><span class="ident" id="7208798">ReadAt</span><span class="op" id="7208804">(</span><span class="ident" id="7208805">buf</span><span class="op" id="7208808">,</span>&nbsp;<span class="builtintype" id="7208810">int64</span><span class="op" id="7208815">(</span><span class="ident" id="7208816">i</span><span class="op" id="7208817">)</span><span class="op" id="7208818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7208823">if</span>&nbsp;<span class="ident" id="7208826">err</span>&nbsp;<span class="op" id="7208830">!=</span>&nbsp;<span class="builtintype" id="7208833">nil</span>&nbsp;<span class="op" id="7208837">||</span>&nbsp;<span class="ident" id="7208840">n</span>&nbsp;<span class="op" id="7208842">!=</span>&nbsp;<span class="builtinfunc" id="7208845">len</span><span class="op" id="7208848">(</span><span class="ident" id="7208849">buf</span><span class="op" id="7208852">)</span>&nbsp;<span class="op" id="7208854">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7208860">t</span><span class="op" id="7208861">.</span><span class="ident" id="7208862">Errorf</span><span class="op" id="7208868">(</span><span class="string" id="7208869">&#34;ReadAt(%d,&nbsp;%d)&nbsp;=&nbsp;%d,&nbsp;%v;&nbsp;want&nbsp;%d,&nbsp;nil&#34;</span><span class="op" id="7208908">,</span>&nbsp;<span class="ident" id="7208910">i</span><span class="op" id="7208911">,</span>&nbsp;<span class="ident" id="7208913">j</span><span class="op" id="7208914">,</span>&nbsp;<span class="ident" id="7208916">n</span><span class="op" id="7208917">,</span>&nbsp;<span class="ident" id="7208919">err</span><span class="op" id="7208922">,</span>&nbsp;<span class="builtinfunc" id="7208924">len</span><span class="op" id="7208927">(</span><span class="ident" id="7208928">buf</span><span class="op" id="7208931">)</span><span class="op" id="7208932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7208937">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7208942">if</span>&nbsp;<span class="op" id="7208945">!</span><span class="ident" id="7208946">bytes</span><span class="op" id="7208951">.</span><span class="ident" id="7208952">Equal</span><span class="op" id="7208957">(</span><span class="ident" id="7208958">buf</span><span class="op" id="7208961">,</span>&nbsp;<span class="ident" id="7208963">all</span><span class="op" id="7208966">[</span><span class="ident" id="7208967">i</span><span class="op" id="7208968">:</span><span class="ident" id="7208969">i</span><span class="op" id="7208970">+</span><span class="ident" id="7208971">j</span><span class="op" id="7208972">]</span><span class="op" id="7208973">)</span>&nbsp;<span class="op" id="7208975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7208981">t</span><span class="op" id="7208982">.</span><span class="ident" id="7208983">Errorf</span><span class="op" id="7208989">(</span><span class="string" id="7208990">&#34;ReadAt(%d,&nbsp;%d)&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7209020">,</span>&nbsp;<span class="ident" id="7209022">i</span><span class="op" id="7209023">,</span>&nbsp;<span class="ident" id="7209025">j</span><span class="op" id="7209026">,</span>&nbsp;<span class="ident" id="7209028">buf</span><span class="op" id="7209031">,</span>&nbsp;<span class="ident" id="7209033">all</span><span class="op" id="7209036">[</span><span class="ident" id="7209037">i</span><span class="op" id="7209038">:</span><span class="ident" id="7209039">i</span><span class="op" id="7209040">+</span><span class="ident" id="7209041">j</span><span class="op" id="7209042">]</span><span class="op" id="7209043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7209048">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7209052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7209055">}</span><br>
<span class="lineno"></span><span class="op" id="7209057">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7209060">//&nbsp;fakeHash32&nbsp;is&nbsp;a&nbsp;dummy&nbsp;Hash32&nbsp;that&nbsp;always&nbsp;returns&nbsp;0.</span><br>
<span class="lineno">220</span><span class="keyword" id="7209115">type</span>&nbsp;<span class="ident" id="7209120">fakeHash32</span>&nbsp;<span class="keyword" id="7209131">struct</span>&nbsp;<span class="op" id="7209138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7209141">hash</span><span class="op" id="7209145">.</span><span class="ident" id="7209146">Hash32</span><br>
<span class="lineno"></span><span class="op" id="7209153">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7209156">func</span>&nbsp;<span class="op" id="7209161">(</span><span class="ident" id="7209162">fakeHash32</span><span class="op" id="7209172">)</span>&nbsp;<span class="ident" id="7209174">Write</span><span class="op" id="7209179">(</span><span class="ident" id="7209180">p</span>&nbsp;<span class="op" id="7209182">[</span><span class="op" id="7209183">]</span><span class="builtintype" id="7209184">byte</span><span class="op" id="7209188">)</span>&nbsp;<span class="op" id="7209190">(</span><span class="builtintype" id="7209191">int</span><span class="op" id="7209194">,</span>&nbsp;<span class="builtintype" id="7209196">error</span><span class="op" id="7209201">)</span>&nbsp;<span class="op" id="7209203">{</span>&nbsp;<span class="keyword" id="7209205">return</span>&nbsp;<span class="builtinfunc" id="7209212">len</span><span class="op" id="7209215">(</span><span class="ident" id="7209216">p</span><span class="op" id="7209217">)</span><span class="op" id="7209218">,</span>&nbsp;<span class="builtintype" id="7209220">nil</span>&nbsp;<span class="op" id="7209224">}</span><br>
<span class="lineno">225</span><span class="keyword" id="7209226">func</span>&nbsp;<span class="op" id="7209231">(</span><span class="ident" id="7209232">fakeHash32</span><span class="op" id="7209242">)</span>&nbsp;<span class="ident" id="7209244">Sum32</span><span class="op" id="7209249">(</span><span class="op" id="7209250">)</span>&nbsp;<span class="builtintype" id="7209252">uint32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7209273">{</span>&nbsp;<span class="keyword" id="7209275">return</span>&nbsp;<span class="num" id="7209282">0</span>&nbsp;<span class="op" id="7209284">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7209287">func</span>&nbsp;<span class="ident" id="7209292">TestZip64</span><span class="op" id="7209301">(</span><span class="ident" id="7209302">t</span>&nbsp;<span class="op" id="7209304">*</span><span class="ident" id="7209305">testing</span><span class="op" id="7209312">.</span><span class="ident" id="7209313">T</span><span class="op" id="7209314">)</span>&nbsp;<span class="op" id="7209316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7209319">if</span>&nbsp;<span class="ident" id="7209322">testing</span><span class="op" id="7209329">.</span><span class="ident" id="7209330">Short</span><span class="op" id="7209335">(</span><span class="op" id="7209336">)</span>&nbsp;<span class="op" id="7209338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7209342">t</span><span class="op" id="7209343">.</span><span class="ident" id="7209344">Skip</span><span class="op" id="7209348">(</span><span class="string" id="7209349">&#34;slow&nbsp;test;&nbsp;skipping&#34;</span><span class="op" id="7209370">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7209373">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7209376">const</span>&nbsp;<span class="ident" id="7209382">size</span>&nbsp;<span class="op" id="7209387">=</span>&nbsp;<span class="num" id="7209389">1</span>&nbsp;<span class="op" id="7209391">&lt;&lt;</span>&nbsp;<span class="num" id="7209394">32</span>&nbsp;<span class="comment" id="7209397">//&nbsp;before&nbsp;the&nbsp;&#34;END\n&#34;&nbsp;part</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7209425">testZip64</span><span class="op" id="7209434">(</span><span class="ident" id="7209435">t</span><span class="op" id="7209436">,</span>&nbsp;<span class="ident" id="7209438">size</span><span class="op" id="7209442">)</span><br>
<span class="lineno"></span><span class="op" id="7209444">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="keyword" id="7209447">func</span>&nbsp;<span class="ident" id="7209452">testZip64</span><span class="op" id="7209461">(</span><span class="ident" id="7209462">t</span>&nbsp;<span class="ident" id="7209464">testing</span><span class="op" id="7209471">.</span><span class="ident" id="7209472">TB</span><span class="op" id="7209474">,</span>&nbsp;<span class="ident" id="7209476">size</span>&nbsp;<span class="builtintype" id="7209481">int64</span><span class="op" id="7209486">)</span>&nbsp;<span class="op" id="7209488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7209491">const</span>&nbsp;<span class="ident" id="7209497">chunkSize</span>&nbsp;<span class="op" id="7209507">=</span>&nbsp;<span class="num" id="7209509">1024</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7209515">chunks</span>&nbsp;<span class="op" id="7209522">:=</span>&nbsp;<span class="builtintype" id="7209525">int</span><span class="op" id="7209528">(</span><span class="ident" id="7209529">size</span>&nbsp;<span class="op" id="7209534">/</span>&nbsp;<span class="ident" id="7209536">chunkSize</span><span class="op" id="7209545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7209548">//&nbsp;write&nbsp;2^32&nbsp;bytes&nbsp;plus&nbsp;&#34;END\n&#34;&nbsp;to&nbsp;a&nbsp;zip&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7209596">buf</span>&nbsp;<span class="op" id="7209600">:=</span>&nbsp;<span class="builtinfunc" id="7209603">new</span><span class="op" id="7209606">(</span><span class="ident" id="7209607">rleBuffer</span><span class="op" id="7209616">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7209619">w</span>&nbsp;<span class="op" id="7209621">:=</span>&nbsp;<span class="ident" id="7209624">NewWriter</span><span class="op" id="7209633">(</span><span class="ident" id="7209634">buf</span><span class="op" id="7209637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7209640">f</span><span class="op" id="7209641">,</span>&nbsp;<span class="ident" id="7209643">err</span>&nbsp;<span class="op" id="7209647">:=</span>&nbsp;<span class="ident" id="7209650">w</span><span class="op" id="7209651">.</span><span class="ident" id="7209652">CreateHeader</span><span class="op" id="7209664">(</span><span class="op" id="7209665">&amp;</span><span class="ident" id="7209666">FileHeader</span><span class="op" id="7209676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7209680">Name</span><span class="op" id="7209684">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7209688">&#34;huge.txt&#34;</span><span class="op" id="7209698">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7209702">Method</span><span class="op" id="7209708">:</span>&nbsp;<span class="ident" id="7209710">Store</span><span class="op" id="7209715">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7209718">}</span><span class="op" id="7209719">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7209722">if</span>&nbsp;<span class="ident" id="7209725">err</span>&nbsp;<span class="op" id="7209729">!=</span>&nbsp;<span class="builtintype" id="7209732">nil</span>&nbsp;<span class="op" id="7209736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7209740">t</span><span class="op" id="7209741">.</span><span class="ident" id="7209742">Fatal</span><span class="op" id="7209747">(</span><span class="ident" id="7209748">err</span><span class="op" id="7209751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7209754">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7209757">f</span><span class="op" id="7209758">.</span><span class="op" id="7209759">(</span><span class="op" id="7209760">*</span><span class="ident" id="7209761">fileWriter</span><span class="op" id="7209771">)</span><span class="op" id="7209772">.</span><span class="ident" id="7209773">crc32</span>&nbsp;<span class="op" id="7209779">=</span>&nbsp;<span class="ident" id="7209781">fakeHash32</span><span class="op" id="7209791">{</span><span class="op" id="7209792">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7209795">chunk</span>&nbsp;<span class="op" id="7209801">:=</span>&nbsp;<span class="builtinfunc" id="7209804">make</span><span class="op" id="7209808">(</span><span class="op" id="7209809">[</span><span class="op" id="7209810">]</span><span class="builtintype" id="7209811">byte</span><span class="op" id="7209815">,</span>&nbsp;<span class="ident" id="7209817">chunkSize</span><span class="op" id="7209826">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7209829">for</span>&nbsp;<span class="ident" id="7209833">i</span>&nbsp;<span class="op" id="7209835">:=</span>&nbsp;<span class="keyword" id="7209838">range</span>&nbsp;<span class="ident" id="7209844">chunk</span>&nbsp;<span class="op" id="7209850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7209854">chunk</span><span class="op" id="7209859">[</span><span class="ident" id="7209860">i</span><span class="op" id="7209861">]</span>&nbsp;<span class="op" id="7209863">=</span>&nbsp;<span class="string" id="7209865">&#39;.&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7209870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7209873">for</span>&nbsp;<span class="ident" id="7209877">i</span>&nbsp;<span class="op" id="7209879">:=</span>&nbsp;<span class="num" id="7209882">0</span><span class="op" id="7209883">;</span>&nbsp;<span class="ident" id="7209885">i</span>&nbsp;<span class="op" id="7209887">&lt;</span>&nbsp;<span class="ident" id="7209889">chunks</span><span class="op" id="7209895">;</span>&nbsp;<span class="ident" id="7209897">i</span><span class="op" id="7209898">++</span>&nbsp;<span class="op" id="7209901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7209905">_</span><span class="op" id="7209906">,</span>&nbsp;<span class="ident" id="7209908">err</span>&nbsp;<span class="op" id="7209912">:=</span>&nbsp;<span class="ident" id="7209915">f</span><span class="op" id="7209916">.</span><span class="ident" id="7209917">Write</span><span class="op" id="7209922">(</span><span class="ident" id="7209923">chunk</span><span class="op" id="7209928">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7209932">if</span>&nbsp;<span class="ident" id="7209935">err</span>&nbsp;<span class="op" id="7209939">!=</span>&nbsp;<span class="builtintype" id="7209942">nil</span>&nbsp;<span class="op" id="7209946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7209951">t</span><span class="op" id="7209952">.</span><span class="ident" id="7209953">Fatal</span><span class="op" id="7209958">(</span><span class="string" id="7209959">&#34;write&nbsp;chunk:&#34;</span><span class="op" id="7209973">,</span>&nbsp;<span class="ident" id="7209975">err</span><span class="op" id="7209978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7209982">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7209985">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7209988">end</span>&nbsp;<span class="op" id="7209992">:=</span>&nbsp;<span class="op" id="7209995">[</span><span class="op" id="7209996">]</span><span class="builtintype" id="7209997">byte</span><span class="op" id="7210001">(</span><span class="string" id="7210002">&#34;END\n&#34;</span><span class="op" id="7210009">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7210012">_</span><span class="op" id="7210013">,</span>&nbsp;<span class="ident" id="7210015">err</span>&nbsp;<span class="op" id="7210019">=</span>&nbsp;<span class="ident" id="7210021">f</span><span class="op" id="7210022">.</span><span class="ident" id="7210023">Write</span><span class="op" id="7210028">(</span><span class="ident" id="7210029">end</span><span class="op" id="7210032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7210035">if</span>&nbsp;<span class="ident" id="7210038">err</span>&nbsp;<span class="op" id="7210042">!=</span>&nbsp;<span class="builtintype" id="7210045">nil</span>&nbsp;<span class="op" id="7210049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7210053">t</span><span class="op" id="7210054">.</span><span class="ident" id="7210055">Fatal</span><span class="op" id="7210060">(</span><span class="string" id="7210061">&#34;write&nbsp;end:&#34;</span><span class="op" id="7210073">,</span>&nbsp;<span class="ident" id="7210075">err</span><span class="op" id="7210078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7210081">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7210084">if</span>&nbsp;<span class="ident" id="7210087">err</span>&nbsp;<span class="op" id="7210091">:=</span>&nbsp;<span class="ident" id="7210094">w</span><span class="op" id="7210095">.</span><span class="ident" id="7210096">Close</span><span class="op" id="7210101">(</span><span class="op" id="7210102">)</span><span class="op" id="7210103">;</span>&nbsp;<span class="ident" id="7210105">err</span>&nbsp;<span class="op" id="7210109">!=</span>&nbsp;<span class="builtintype" id="7210112">nil</span>&nbsp;<span class="op" id="7210116">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7210120">t</span><span class="op" id="7210121">.</span><span class="ident" id="7210122">Fatal</span><span class="op" id="7210127">(</span><span class="ident" id="7210128">err</span><span class="op" id="7210131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7210134">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7210138">//&nbsp;read&nbsp;back&nbsp;zip&nbsp;file&nbsp;and&nbsp;check&nbsp;that&nbsp;we&nbsp;get&nbsp;to&nbsp;the&nbsp;end&nbsp;of&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7210200">r</span><span class="op" id="7210201">,</span>&nbsp;<span class="ident" id="7210203">err</span>&nbsp;<span class="op" id="7210207">:=</span>&nbsp;<span class="ident" id="7210210">NewReader</span><span class="op" id="7210219">(</span><span class="ident" id="7210220">buf</span><span class="op" id="7210223">,</span>&nbsp;<span class="builtintype" id="7210225">int64</span><span class="op" id="7210230">(</span><span class="ident" id="7210231">buf</span><span class="op" id="7210234">.</span><span class="ident" id="7210235">Size</span><span class="op" id="7210239">(</span><span class="op" id="7210240">)</span><span class="op" id="7210241">)</span><span class="op" id="7210242">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7210245">if</span>&nbsp;<span class="ident" id="7210248">err</span>&nbsp;<span class="op" id="7210252">!=</span>&nbsp;<span class="builtintype" id="7210255">nil</span>&nbsp;<span class="op" id="7210259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7210263">t</span><span class="op" id="7210264">.</span><span class="ident" id="7210265">Fatal</span><span class="op" id="7210270">(</span><span class="string" id="7210271">&#34;reader:&#34;</span><span class="op" id="7210280">,</span>&nbsp;<span class="ident" id="7210282">err</span><span class="op" id="7210285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7210288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7210291">f0</span>&nbsp;<span class="op" id="7210294">:=</span>&nbsp;<span class="ident" id="7210297">r</span><span class="op" id="7210298">.</span><span class="ident" id="7210299">File</span><span class="op" id="7210303">[</span><span class="num" id="7210304">0</span><span class="op" id="7210305">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7210308">rc</span><span class="op" id="7210310">,</span>&nbsp;<span class="ident" id="7210312">err</span>&nbsp;<span class="op" id="7210316">:=</span>&nbsp;<span class="ident" id="7210319">f0</span><span class="op" id="7210321">.</span><span class="ident" id="7210322">Open</span><span class="op" id="7210326">(</span><span class="op" id="7210327">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7210330">if</span>&nbsp;<span class="ident" id="7210333">err</span>&nbsp;<span class="op" id="7210337">!=</span>&nbsp;<span class="builtintype" id="7210340">nil</span>&nbsp;<span class="op" id="7210344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7210348">t</span><span class="op" id="7210349">.</span><span class="ident" id="7210350">Fatal</span><span class="op" id="7210355">(</span><span class="string" id="7210356">&#34;opening:&#34;</span><span class="op" id="7210366">,</span>&nbsp;<span class="ident" id="7210368">err</span><span class="op" id="7210371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7210374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7210377">rc</span><span class="op" id="7210379">.</span><span class="op" id="7210380">(</span><span class="op" id="7210381">*</span><span class="ident" id="7210382">checksumReader</span><span class="op" id="7210396">)</span><span class="op" id="7210397">.</span><span class="ident" id="7210398">hash</span>&nbsp;<span class="op" id="7210403">=</span>&nbsp;<span class="ident" id="7210405">fakeHash32</span><span class="op" id="7210415">{</span><span class="op" id="7210416">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7210419">for</span>&nbsp;<span class="ident" id="7210423">i</span>&nbsp;<span class="op" id="7210425">:=</span>&nbsp;<span class="num" id="7210428">0</span><span class="op" id="7210429">;</span>&nbsp;<span class="ident" id="7210431">i</span>&nbsp;<span class="op" id="7210433">&lt;</span>&nbsp;<span class="ident" id="7210435">chunks</span><span class="op" id="7210441">;</span>&nbsp;<span class="ident" id="7210443">i</span><span class="op" id="7210444">++</span>&nbsp;<span class="op" id="7210447">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7210451">_</span><span class="op" id="7210452">,</span>&nbsp;<span class="ident" id="7210454">err</span>&nbsp;<span class="op" id="7210458">:=</span>&nbsp;<span class="ident" id="7210461">io</span><span class="op" id="7210463">.</span><span class="ident" id="7210464">ReadFull</span><span class="op" id="7210472">(</span><span class="ident" id="7210473">rc</span><span class="op" id="7210475">,</span>&nbsp;<span class="ident" id="7210477">chunk</span><span class="op" id="7210482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7210486">if</span>&nbsp;<span class="ident" id="7210489">err</span>&nbsp;<span class="op" id="7210493">!=</span>&nbsp;<span class="builtintype" id="7210496">nil</span>&nbsp;<span class="op" id="7210500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7210505">t</span><span class="op" id="7210506">.</span><span class="ident" id="7210507">Fatal</span><span class="op" id="7210512">(</span><span class="string" id="7210513">&#34;read:&#34;</span><span class="op" id="7210520">,</span>&nbsp;<span class="ident" id="7210522">err</span><span class="op" id="7210525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7210529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7210532">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7210535">gotEnd</span><span class="op" id="7210541">,</span>&nbsp;<span class="ident" id="7210543">err</span>&nbsp;<span class="op" id="7210547">:=</span>&nbsp;<span class="ident" id="7210550">ioutil</span><span class="op" id="7210556">.</span><span class="ident" id="7210557">ReadAll</span><span class="op" id="7210564">(</span><span class="ident" id="7210565">rc</span><span class="op" id="7210567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7210570">if</span>&nbsp;<span class="ident" id="7210573">err</span>&nbsp;<span class="op" id="7210577">!=</span>&nbsp;<span class="builtintype" id="7210580">nil</span>&nbsp;<span class="op" id="7210584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7210588">t</span><span class="op" id="7210589">.</span><span class="ident" id="7210590">Fatal</span><span class="op" id="7210595">(</span><span class="string" id="7210596">&#34;read&nbsp;end:&#34;</span><span class="op" id="7210607">,</span>&nbsp;<span class="ident" id="7210609">err</span><span class="op" id="7210612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7210615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7210618">if</span>&nbsp;<span class="op" id="7210621">!</span><span class="ident" id="7210622">bytes</span><span class="op" id="7210627">.</span><span class="ident" id="7210628">Equal</span><span class="op" id="7210633">(</span><span class="ident" id="7210634">gotEnd</span><span class="op" id="7210640">,</span>&nbsp;<span class="ident" id="7210642">end</span><span class="op" id="7210645">)</span>&nbsp;<span class="op" id="7210647">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7210651">t</span><span class="op" id="7210652">.</span><span class="ident" id="7210653">Errorf</span><span class="op" id="7210659">(</span><span class="string" id="7210660">&#34;End&nbsp;of&nbsp;zip64&nbsp;archive&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7210694">,</span>&nbsp;<span class="ident" id="7210696">gotEnd</span><span class="op" id="7210702">,</span>&nbsp;<span class="ident" id="7210704">end</span><span class="op" id="7210707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7210710">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7210713">err</span>&nbsp;<span class="op" id="7210717">=</span>&nbsp;<span class="ident" id="7210719">rc</span><span class="op" id="7210721">.</span><span class="ident" id="7210722">Close</span><span class="op" id="7210727">(</span><span class="op" id="7210728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7210731">if</span>&nbsp;<span class="ident" id="7210734">err</span>&nbsp;<span class="op" id="7210738">!=</span>&nbsp;<span class="builtintype" id="7210741">nil</span>&nbsp;<span class="op" id="7210745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7210749">t</span><span class="op" id="7210750">.</span><span class="ident" id="7210751">Fatal</span><span class="op" id="7210756">(</span><span class="string" id="7210757">&#34;closing:&#34;</span><span class="op" id="7210767">,</span>&nbsp;<span class="ident" id="7210769">err</span><span class="op" id="7210772">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7210775">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7210778">if</span>&nbsp;<span class="ident" id="7210781">size</span>&nbsp;<span class="op" id="7210786">==</span>&nbsp;<span class="num" id="7210789">1</span><span class="op" id="7210790">&lt;&lt;</span><span class="num" id="7210792">32</span>&nbsp;<span class="op" id="7210795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7210799">if</span>&nbsp;<span class="ident" id="7210802">got</span><span class="op" id="7210805">,</span>&nbsp;<span class="ident" id="7210807">want</span>&nbsp;<span class="op" id="7210812">:=</span>&nbsp;<span class="ident" id="7210815">f0</span><span class="op" id="7210817">.</span><span class="ident" id="7210818">UncompressedSize</span><span class="op" id="7210834">,</span>&nbsp;<span class="builtintype" id="7210836">uint32</span><span class="op" id="7210842">(</span><span class="ident" id="7210843">uint32max</span><span class="op" id="7210852">)</span><span class="op" id="7210853">;</span>&nbsp;<span class="ident" id="7210855">got</span>&nbsp;<span class="op" id="7210859">!=</span>&nbsp;<span class="ident" id="7210862">want</span>&nbsp;<span class="op" id="7210867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7210872">t</span><span class="op" id="7210873">.</span><span class="ident" id="7210874">Errorf</span><span class="op" id="7210880">(</span><span class="string" id="7210881">&#34;UncompressedSize&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7210911">,</span>&nbsp;<span class="ident" id="7210913">got</span><span class="op" id="7210916">,</span>&nbsp;<span class="ident" id="7210918">want</span><span class="op" id="7210922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7210926">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7210929">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7210933">if</span>&nbsp;<span class="ident" id="7210936">got</span><span class="op" id="7210939">,</span>&nbsp;<span class="ident" id="7210941">want</span>&nbsp;<span class="op" id="7210946">:=</span>&nbsp;<span class="ident" id="7210949">f0</span><span class="op" id="7210951">.</span><span class="ident" id="7210952">UncompressedSize64</span><span class="op" id="7210970">,</span>&nbsp;<span class="builtintype" id="7210972">uint64</span><span class="op" id="7210978">(</span><span class="ident" id="7210979">size</span><span class="op" id="7210983">)</span><span class="op" id="7210984">+</span><span class="builtintype" id="7210985">uint64</span><span class="op" id="7210991">(</span><span class="builtinfunc" id="7210992">len</span><span class="op" id="7210995">(</span><span class="ident" id="7210996">end</span><span class="op" id="7210999">)</span><span class="op" id="7211000">)</span><span class="op" id="7211001">;</span>&nbsp;<span class="ident" id="7211003">got</span>&nbsp;<span class="op" id="7211007">!=</span>&nbsp;<span class="ident" id="7211010">want</span>&nbsp;<span class="op" id="7211015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7211019">t</span><span class="op" id="7211020">.</span><span class="ident" id="7211021">Errorf</span><span class="op" id="7211027">(</span><span class="string" id="7211028">&#34;UncompressedSize64&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7211060">,</span>&nbsp;<span class="ident" id="7211062">got</span><span class="op" id="7211065">,</span>&nbsp;<span class="ident" id="7211067">want</span><span class="op" id="7211071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7211074">}</span><br>
<span class="lineno">305</span><span class="op" id="7211076">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7211079">func</span>&nbsp;<span class="ident" id="7211084">testInvalidHeader</span><span class="op" id="7211101">(</span><span class="ident" id="7211102">h</span>&nbsp;<span class="op" id="7211104">*</span><span class="ident" id="7211105">FileHeader</span><span class="op" id="7211115">,</span>&nbsp;<span class="ident" id="7211117">t</span>&nbsp;<span class="op" id="7211119">*</span><span class="ident" id="7211120">testing</span><span class="op" id="7211127">.</span><span class="ident" id="7211128">T</span><span class="op" id="7211129">)</span>&nbsp;<span class="op" id="7211131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7211134">var</span>&nbsp;<span class="ident" id="7211138">buf</span>&nbsp;<span class="ident" id="7211142">bytes</span><span class="op" id="7211147">.</span><span class="ident" id="7211148">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7211156">z</span>&nbsp;<span class="op" id="7211158">:=</span>&nbsp;<span class="ident" id="7211161">NewWriter</span><span class="op" id="7211170">(</span><span class="op" id="7211171">&amp;</span><span class="ident" id="7211172">buf</span><span class="op" id="7211175">)</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7211179">f</span><span class="op" id="7211180">,</span>&nbsp;<span class="ident" id="7211182">err</span>&nbsp;<span class="op" id="7211186">:=</span>&nbsp;<span class="ident" id="7211189">z</span><span class="op" id="7211190">.</span><span class="ident" id="7211191">CreateHeader</span><span class="op" id="7211203">(</span><span class="ident" id="7211204">h</span><span class="op" id="7211205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7211208">if</span>&nbsp;<span class="ident" id="7211211">err</span>&nbsp;<span class="op" id="7211215">!=</span>&nbsp;<span class="builtintype" id="7211218">nil</span>&nbsp;<span class="op" id="7211222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7211226">t</span><span class="op" id="7211227">.</span><span class="ident" id="7211228">Fatalf</span><span class="op" id="7211234">(</span><span class="string" id="7211235">&#34;error&nbsp;creating&nbsp;header:&nbsp;%v&#34;</span><span class="op" id="7211262">,</span>&nbsp;<span class="ident" id="7211264">err</span><span class="op" id="7211267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7211270">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7211273">if</span>&nbsp;<span class="ident" id="7211276">_</span><span class="op" id="7211277">,</span>&nbsp;<span class="ident" id="7211279">err</span>&nbsp;<span class="op" id="7211283">:=</span>&nbsp;<span class="ident" id="7211286">f</span><span class="op" id="7211287">.</span><span class="ident" id="7211288">Write</span><span class="op" id="7211293">(</span><span class="op" id="7211294">[</span><span class="op" id="7211295">]</span><span class="builtintype" id="7211296">byte</span><span class="op" id="7211300">(</span><span class="string" id="7211301">&#34;hi&#34;</span><span class="op" id="7211305">)</span><span class="op" id="7211306">)</span><span class="op" id="7211307">;</span>&nbsp;<span class="ident" id="7211309">err</span>&nbsp;<span class="op" id="7211313">!=</span>&nbsp;<span class="builtintype" id="7211316">nil</span>&nbsp;<span class="op" id="7211320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7211324">t</span><span class="op" id="7211325">.</span><span class="ident" id="7211326">Fatalf</span><span class="op" id="7211332">(</span><span class="string" id="7211333">&#34;error&nbsp;writing&nbsp;content:&nbsp;%v&#34;</span><span class="op" id="7211360">,</span>&nbsp;<span class="ident" id="7211362">err</span><span class="op" id="7211365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7211368">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7211371">if</span>&nbsp;<span class="ident" id="7211374">err</span>&nbsp;<span class="op" id="7211378">:=</span>&nbsp;<span class="ident" id="7211381">z</span><span class="op" id="7211382">.</span><span class="ident" id="7211383">Close</span><span class="op" id="7211388">(</span><span class="op" id="7211389">)</span><span class="op" id="7211390">;</span>&nbsp;<span class="ident" id="7211392">err</span>&nbsp;<span class="op" id="7211396">!=</span>&nbsp;<span class="builtintype" id="7211399">nil</span>&nbsp;<span class="op" id="7211403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7211407">t</span><span class="op" id="7211408">.</span><span class="ident" id="7211409">Fatalf</span><span class="op" id="7211415">(</span><span class="string" id="7211416">&#34;error&nbsp;closing&nbsp;zip&nbsp;writer:&nbsp;%v&#34;</span><span class="op" id="7211446">,</span>&nbsp;<span class="ident" id="7211448">err</span><span class="op" id="7211451">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7211454">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7211458">b</span>&nbsp;<span class="op" id="7211460">:=</span>&nbsp;<span class="ident" id="7211463">buf</span><span class="op" id="7211466">.</span><span class="ident" id="7211467">Bytes</span><span class="op" id="7211472">(</span><span class="op" id="7211473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7211476">if</span>&nbsp;<span class="ident" id="7211479">_</span><span class="op" id="7211480">,</span>&nbsp;<span class="ident" id="7211482">err</span>&nbsp;<span class="op" id="7211486">=</span>&nbsp;<span class="ident" id="7211488">NewReader</span><span class="op" id="7211497">(</span><span class="ident" id="7211498">bytes</span><span class="op" id="7211503">.</span><span class="ident" id="7211504">NewReader</span><span class="op" id="7211513">(</span><span class="ident" id="7211514">b</span><span class="op" id="7211515">)</span><span class="op" id="7211516">,</span>&nbsp;<span class="builtintype" id="7211518">int64</span><span class="op" id="7211523">(</span><span class="builtinfunc" id="7211524">len</span><span class="op" id="7211527">(</span><span class="ident" id="7211528">b</span><span class="op" id="7211529">)</span><span class="op" id="7211530">)</span><span class="op" id="7211531">)</span><span class="op" id="7211532">;</span>&nbsp;<span class="ident" id="7211534">err</span>&nbsp;<span class="op" id="7211538">!=</span>&nbsp;<span class="ident" id="7211541">ErrFormat</span>&nbsp;<span class="op" id="7211551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7211555">t</span><span class="op" id="7211556">.</span><span class="ident" id="7211557">Fatalf</span><span class="op" id="7211563">(</span><span class="string" id="7211564">&#34;got&nbsp;%v,&nbsp;expected&nbsp;ErrFormat&#34;</span><span class="op" id="7211592">,</span>&nbsp;<span class="ident" id="7211594">err</span><span class="op" id="7211597">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7211600">}</span><br>
<span class="lineno"></span><span class="op" id="7211602">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7211605">func</span>&nbsp;<span class="ident" id="7211610">testValidHeader</span><span class="op" id="7211625">(</span><span class="ident" id="7211626">h</span>&nbsp;<span class="op" id="7211628">*</span><span class="ident" id="7211629">FileHeader</span><span class="op" id="7211639">,</span>&nbsp;<span class="ident" id="7211641">t</span>&nbsp;<span class="op" id="7211643">*</span><span class="ident" id="7211644">testing</span><span class="op" id="7211651">.</span><span class="ident" id="7211652">T</span><span class="op" id="7211653">)</span>&nbsp;<span class="op" id="7211655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7211658">var</span>&nbsp;<span class="ident" id="7211662">buf</span>&nbsp;<span class="ident" id="7211666">bytes</span><span class="op" id="7211671">.</span><span class="ident" id="7211672">Buffer</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7211680">z</span>&nbsp;<span class="op" id="7211682">:=</span>&nbsp;<span class="ident" id="7211685">NewWriter</span><span class="op" id="7211694">(</span><span class="op" id="7211695">&amp;</span><span class="ident" id="7211696">buf</span><span class="op" id="7211699">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7211703">f</span><span class="op" id="7211704">,</span>&nbsp;<span class="ident" id="7211706">err</span>&nbsp;<span class="op" id="7211710">:=</span>&nbsp;<span class="ident" id="7211713">z</span><span class="op" id="7211714">.</span><span class="ident" id="7211715">CreateHeader</span><span class="op" id="7211727">(</span><span class="ident" id="7211728">h</span><span class="op" id="7211729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7211732">if</span>&nbsp;<span class="ident" id="7211735">err</span>&nbsp;<span class="op" id="7211739">!=</span>&nbsp;<span class="builtintype" id="7211742">nil</span>&nbsp;<span class="op" id="7211746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7211750">t</span><span class="op" id="7211751">.</span><span class="ident" id="7211752">Fatalf</span><span class="op" id="7211758">(</span><span class="string" id="7211759">&#34;error&nbsp;creating&nbsp;header:&nbsp;%v&#34;</span><span class="op" id="7211786">,</span>&nbsp;<span class="ident" id="7211788">err</span><span class="op" id="7211791">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7211794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7211797">if</span>&nbsp;<span class="ident" id="7211800">_</span><span class="op" id="7211801">,</span>&nbsp;<span class="ident" id="7211803">err</span>&nbsp;<span class="op" id="7211807">:=</span>&nbsp;<span class="ident" id="7211810">f</span><span class="op" id="7211811">.</span><span class="ident" id="7211812">Write</span><span class="op" id="7211817">(</span><span class="op" id="7211818">[</span><span class="op" id="7211819">]</span><span class="builtintype" id="7211820">byte</span><span class="op" id="7211824">(</span><span class="string" id="7211825">&#34;hi&#34;</span><span class="op" id="7211829">)</span><span class="op" id="7211830">)</span><span class="op" id="7211831">;</span>&nbsp;<span class="ident" id="7211833">err</span>&nbsp;<span class="op" id="7211837">!=</span>&nbsp;<span class="builtintype" id="7211840">nil</span>&nbsp;<span class="op" id="7211844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7211848">t</span><span class="op" id="7211849">.</span><span class="ident" id="7211850">Fatalf</span><span class="op" id="7211856">(</span><span class="string" id="7211857">&#34;error&nbsp;writing&nbsp;content:&nbsp;%v&#34;</span><span class="op" id="7211884">,</span>&nbsp;<span class="ident" id="7211886">err</span><span class="op" id="7211889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7211892">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7211895">if</span>&nbsp;<span class="ident" id="7211898">err</span>&nbsp;<span class="op" id="7211902">:=</span>&nbsp;<span class="ident" id="7211905">z</span><span class="op" id="7211906">.</span><span class="ident" id="7211907">Close</span><span class="op" id="7211912">(</span><span class="op" id="7211913">)</span><span class="op" id="7211914">;</span>&nbsp;<span class="ident" id="7211916">err</span>&nbsp;<span class="op" id="7211920">!=</span>&nbsp;<span class="builtintype" id="7211923">nil</span>&nbsp;<span class="op" id="7211927">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7211931">t</span><span class="op" id="7211932">.</span><span class="ident" id="7211933">Fatalf</span><span class="op" id="7211939">(</span><span class="string" id="7211940">&#34;error&nbsp;closing&nbsp;zip&nbsp;writer:&nbsp;%v&#34;</span><span class="op" id="7211970">,</span>&nbsp;<span class="ident" id="7211972">err</span><span class="op" id="7211975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7211978">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7211982">b</span>&nbsp;<span class="op" id="7211984">:=</span>&nbsp;<span class="ident" id="7211987">buf</span><span class="op" id="7211990">.</span><span class="ident" id="7211991">Bytes</span><span class="op" id="7211996">(</span><span class="op" id="7211997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7212000">if</span>&nbsp;<span class="ident" id="7212003">_</span><span class="op" id="7212004">,</span>&nbsp;<span class="ident" id="7212006">err</span>&nbsp;<span class="op" id="7212010">=</span>&nbsp;<span class="ident" id="7212012">NewReader</span><span class="op" id="7212021">(</span><span class="ident" id="7212022">bytes</span><span class="op" id="7212027">.</span><span class="ident" id="7212028">NewReader</span><span class="op" id="7212037">(</span><span class="ident" id="7212038">b</span><span class="op" id="7212039">)</span><span class="op" id="7212040">,</span>&nbsp;<span class="builtintype" id="7212042">int64</span><span class="op" id="7212047">(</span><span class="builtinfunc" id="7212048">len</span><span class="op" id="7212051">(</span><span class="ident" id="7212052">b</span><span class="op" id="7212053">)</span><span class="op" id="7212054">)</span><span class="op" id="7212055">)</span><span class="op" id="7212056">;</span>&nbsp;<span class="ident" id="7212058">err</span>&nbsp;<span class="op" id="7212062">!=</span>&nbsp;<span class="builtintype" id="7212065">nil</span>&nbsp;<span class="op" id="7212069">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7212073">t</span><span class="op" id="7212074">.</span><span class="ident" id="7212075">Fatalf</span><span class="op" id="7212081">(</span><span class="string" id="7212082">&#34;got&nbsp;%v,&nbsp;expected&nbsp;nil&#34;</span><span class="op" id="7212104">,</span>&nbsp;<span class="ident" id="7212106">err</span><span class="op" id="7212109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7212112">}</span><br>
<span class="lineno"></span><span class="op" id="7212114">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7212117">//&nbsp;Issue&nbsp;4302.</span><br>
<span class="lineno">350</span><span class="keyword" id="7212132">func</span>&nbsp;<span class="ident" id="7212137">TestHeaderInvalidTagAndSize</span><span class="op" id="7212164">(</span><span class="ident" id="7212165">t</span>&nbsp;<span class="op" id="7212167">*</span><span class="ident" id="7212168">testing</span><span class="op" id="7212175">.</span><span class="ident" id="7212176">T</span><span class="op" id="7212177">)</span>&nbsp;<span class="op" id="7212179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7212182">const</span>&nbsp;<span class="ident" id="7212188">timeFormat</span>&nbsp;<span class="op" id="7212199">=</span>&nbsp;<span class="string" id="7212201">&#34;20060102T150405.000.txt&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7212229">ts</span>&nbsp;<span class="op" id="7212232">:=</span>&nbsp;<span class="ident" id="7212235">time</span><span class="op" id="7212239">.</span><span class="ident" id="7212240">Now</span><span class="op" id="7212243">(</span><span class="op" id="7212244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7212247">filename</span>&nbsp;<span class="op" id="7212256">:=</span>&nbsp;<span class="ident" id="7212259">ts</span><span class="op" id="7212261">.</span><span class="ident" id="7212262">Format</span><span class="op" id="7212268">(</span><span class="ident" id="7212269">timeFormat</span><span class="op" id="7212279">)</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7212283">h</span>&nbsp;<span class="op" id="7212285">:=</span>&nbsp;<span class="ident" id="7212288">FileHeader</span><span class="op" id="7212298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7212302">Name</span><span class="op" id="7212306">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7212310">filename</span><span class="op" id="7212318">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7212322">Method</span><span class="op" id="7212328">:</span>&nbsp;<span class="ident" id="7212330">Deflate</span><span class="op" id="7212337">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7212341">Extra</span><span class="op" id="7212346">:</span>&nbsp;&nbsp;<span class="op" id="7212349">[</span><span class="op" id="7212350">]</span><span class="builtintype" id="7212351">byte</span><span class="op" id="7212355">(</span><span class="ident" id="7212356">ts</span><span class="op" id="7212358">.</span><span class="ident" id="7212359">Format</span><span class="op" id="7212365">(</span><span class="ident" id="7212366">time</span><span class="op" id="7212370">.</span><span class="ident" id="7212371">RFC3339Nano</span><span class="op" id="7212382">)</span><span class="op" id="7212383">)</span><span class="op" id="7212384">,</span>&nbsp;<span class="comment" id="7212386">//&nbsp;missing&nbsp;tag&nbsp;and&nbsp;len</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7212410">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7212413">h</span><span class="op" id="7212414">.</span><span class="ident" id="7212415">SetModTime</span><span class="op" id="7212425">(</span><span class="ident" id="7212426">ts</span><span class="op" id="7212428">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7212432">testInvalidHeader</span><span class="op" id="7212449">(</span><span class="op" id="7212450">&amp;</span><span class="ident" id="7212451">h</span><span class="op" id="7212452">,</span>&nbsp;<span class="ident" id="7212454">t</span><span class="op" id="7212455">)</span><br>
<span class="lineno"></span><span class="op" id="7212457">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="7212460">func</span>&nbsp;<span class="ident" id="7212465">TestHeaderTooShort</span><span class="op" id="7212483">(</span><span class="ident" id="7212484">t</span>&nbsp;<span class="op" id="7212486">*</span><span class="ident" id="7212487">testing</span><span class="op" id="7212494">.</span><span class="ident" id="7212495">T</span><span class="op" id="7212496">)</span>&nbsp;<span class="op" id="7212498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7212501">h</span>&nbsp;<span class="op" id="7212503">:=</span>&nbsp;<span class="ident" id="7212506">FileHeader</span><span class="op" id="7212516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7212520">Name</span><span class="op" id="7212524">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7212528">&#34;foo.txt&#34;</span><span class="op" id="7212537">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7212541">Method</span><span class="op" id="7212547">:</span>&nbsp;<span class="ident" id="7212549">Deflate</span><span class="op" id="7212556">,</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7212560">Extra</span><span class="op" id="7212565">:</span>&nbsp;&nbsp;<span class="op" id="7212568">[</span><span class="op" id="7212569">]</span><span class="builtintype" id="7212570">byte</span><span class="op" id="7212574">{</span><span class="ident" id="7212575">zip64ExtraId</span><span class="op" id="7212587">}</span><span class="op" id="7212588">,</span>&nbsp;<span class="comment" id="7212590">//&nbsp;missing&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7212607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7212610">testInvalidHeader</span><span class="op" id="7212627">(</span><span class="op" id="7212628">&amp;</span><span class="ident" id="7212629">h</span><span class="op" id="7212630">,</span>&nbsp;<span class="ident" id="7212632">t</span><span class="op" id="7212633">)</span><br>
<span class="lineno"></span><span class="op" id="7212635">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">375</span><span class="comment" id="7212638">//&nbsp;Issue&nbsp;4393.&nbsp;It&nbsp;is&nbsp;valid&nbsp;to&nbsp;have&nbsp;an&nbsp;extra&nbsp;data&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="7212694">//&nbsp;which&nbsp;contains&nbsp;no&nbsp;body.</span><br>
<span class="lineno"></span><span class="keyword" id="7212721">func</span>&nbsp;<span class="ident" id="7212726">TestZeroLengthHeader</span><span class="op" id="7212746">(</span><span class="ident" id="7212747">t</span>&nbsp;<span class="op" id="7212749">*</span><span class="ident" id="7212750">testing</span><span class="op" id="7212757">.</span><span class="ident" id="7212758">T</span><span class="op" id="7212759">)</span>&nbsp;<span class="op" id="7212761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7212764">h</span>&nbsp;<span class="op" id="7212766">:=</span>&nbsp;<span class="ident" id="7212769">FileHeader</span><span class="op" id="7212779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7212783">Name</span><span class="op" id="7212787">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7212791">&#34;extadata.txt&#34;</span><span class="op" id="7212805">,</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7212809">Method</span><span class="op" id="7212815">:</span>&nbsp;<span class="ident" id="7212817">Deflate</span><span class="op" id="7212824">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7212828">Extra</span><span class="op" id="7212833">:</span>&nbsp;<span class="op" id="7212835">[</span><span class="op" id="7212836">]</span><span class="builtintype" id="7212837">byte</span><span class="op" id="7212841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7212846">85</span><span class="op" id="7212848">,</span>&nbsp;<span class="num" id="7212850">84</span><span class="op" id="7212852">,</span>&nbsp;<span class="num" id="7212854">5</span><span class="op" id="7212855">,</span>&nbsp;<span class="num" id="7212857">0</span><span class="op" id="7212858">,</span>&nbsp;<span class="num" id="7212860">3</span><span class="op" id="7212861">,</span>&nbsp;<span class="num" id="7212863">154</span><span class="op" id="7212866">,</span>&nbsp;<span class="num" id="7212868">144</span><span class="op" id="7212871">,</span>&nbsp;<span class="num" id="7212873">195</span><span class="op" id="7212876">,</span>&nbsp;<span class="num" id="7212878">77</span><span class="op" id="7212880">,</span>&nbsp;<span class="comment" id="7212882">//&nbsp;tag&nbsp;21589&nbsp;size&nbsp;5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7212905">85</span><span class="op" id="7212907">,</span>&nbsp;<span class="num" id="7212909">120</span><span class="op" id="7212912">,</span>&nbsp;<span class="num" id="7212914">0</span><span class="op" id="7212915">,</span>&nbsp;<span class="num" id="7212917">0</span><span class="op" id="7212918">,</span>&nbsp;<span class="comment" id="7212920">//&nbsp;tag&nbsp;30805&nbsp;size&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7212942">}</span><span class="op" id="7212943">,</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7212946">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7212949">testValidHeader</span><span class="op" id="7212964">(</span><span class="op" id="7212965">&amp;</span><span class="ident" id="7212966">h</span><span class="op" id="7212967">,</span>&nbsp;<span class="ident" id="7212969">t</span><span class="op" id="7212970">)</span><br>
<span class="lineno"></span><span class="op" id="7212972">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7212975">//&nbsp;Just&nbsp;benchmarking&nbsp;how&nbsp;fast&nbsp;the&nbsp;Zip64&nbsp;test&nbsp;above&nbsp;is.&nbsp;Not&nbsp;related&nbsp;to</span><br>
<span class="lineno">390</span><span class="comment" id="7213045">//&nbsp;our&nbsp;zip&nbsp;performance,&nbsp;since&nbsp;the&nbsp;test&nbsp;above&nbsp;disabled&nbsp;CRC32&nbsp;and&nbsp;flate.</span><br>
<span class="lineno"></span><span class="keyword" id="7213116">func</span>&nbsp;<span class="ident" id="7213121">BenchmarkZip64Test</span><span class="op" id="7213139">(</span><span class="ident" id="7213140">b</span>&nbsp;<span class="op" id="7213142">*</span><span class="ident" id="7213143">testing</span><span class="op" id="7213150">.</span><span class="ident" id="7213151">B</span><span class="op" id="7213152">)</span>&nbsp;<span class="op" id="7213154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7213157">for</span>&nbsp;<span class="ident" id="7213161">i</span>&nbsp;<span class="op" id="7213163">:=</span>&nbsp;<span class="num" id="7213166">0</span><span class="op" id="7213167">;</span>&nbsp;<span class="ident" id="7213169">i</span>&nbsp;<span class="op" id="7213171">&lt;</span>&nbsp;<span class="ident" id="7213173">b</span><span class="op" id="7213174">.</span><span class="ident" id="7213175">N</span><span class="op" id="7213176">;</span>&nbsp;<span class="ident" id="7213178">i</span><span class="op" id="7213179">++</span>&nbsp;<span class="op" id="7213182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7213186">testZip64</span><span class="op" id="7213195">(</span><span class="ident" id="7213196">b</span><span class="op" id="7213197">,</span>&nbsp;<span class="num" id="7213199">1</span><span class="op" id="7213200">&lt;&lt;</span><span class="num" id="7213202">26</span><span class="op" id="7213204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7213207">}</span><br>
<span class="lineno">395</span><span class="op" id="7213209">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
