<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7496573">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7496628">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7496682">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7496733">package</span>&nbsp;<span class="ident" id="7496741">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7496746">import</span>&nbsp;<span class="op" id="7496753">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7496756">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7496762">&#34;io/ioutil&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7496775">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7496781">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7496792">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7496803">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7496810">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="7496813">func</span>&nbsp;<span class="ident" id="7496818">TestShutdown</span><span class="op" id="7496830">(</span><span class="ident" id="7496831">t</span>&nbsp;<span class="op" id="7496833">*</span><span class="ident" id="7496834">testing</span><span class="op" id="7496841">.</span><span class="ident" id="7496842">T</span><span class="op" id="7496843">)</span>&nbsp;<span class="op" id="7496845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7496848">if</span>&nbsp;<span class="ident" id="7496851">runtime</span><span class="op" id="7496858">.</span><span class="ident" id="7496859">GOOS</span>&nbsp;<span class="op" id="7496864">==</span>&nbsp;<span class="string" id="7496867">&#34;plan9&#34;</span>&nbsp;<span class="op" id="7496875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7496879">t</span><span class="op" id="7496880">.</span><span class="ident" id="7496881">Skipf</span><span class="op" id="7496886">(</span><span class="string" id="7496887">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7496908">,</span>&nbsp;<span class="ident" id="7496910">runtime</span><span class="op" id="7496917">.</span><span class="ident" id="7496918">GOOS</span><span class="op" id="7496922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7496925">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7496928">ln</span><span class="op" id="7496930">,</span>&nbsp;<span class="ident" id="7496932">err</span>&nbsp;<span class="op" id="7496936">:=</span>&nbsp;<span class="ident" id="7496939">Listen</span><span class="op" id="7496945">(</span><span class="string" id="7496946">&#34;tcp&#34;</span><span class="op" id="7496951">,</span>&nbsp;<span class="string" id="7496953">&#34;127.0.0.1:0&#34;</span><span class="op" id="7496966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7496969">if</span>&nbsp;<span class="ident" id="7496972">err</span>&nbsp;<span class="op" id="7496976">!=</span>&nbsp;<span class="ident" id="7496979">nil</span>&nbsp;<span class="op" id="7496983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7496987">if</span>&nbsp;<span class="ident" id="7496990">ln</span><span class="op" id="7496992">,</span>&nbsp;<span class="ident" id="7496994">err</span>&nbsp;<span class="op" id="7496998">=</span>&nbsp;<span class="ident" id="7497000">Listen</span><span class="op" id="7497006">(</span><span class="string" id="7497007">&#34;tcp6&#34;</span><span class="op" id="7497013">,</span>&nbsp;<span class="string" id="7497015">&#34;[::1]:0&#34;</span><span class="op" id="7497024">)</span><span class="op" id="7497025">;</span>&nbsp;<span class="ident" id="7497027">err</span>&nbsp;<span class="op" id="7497031">!=</span>&nbsp;<span class="ident" id="7497034">nil</span>&nbsp;<span class="op" id="7497038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7497043">t</span><span class="op" id="7497044">.</span><span class="ident" id="7497045">Fatalf</span><span class="op" id="7497051">(</span><span class="string" id="7497052">&#34;ListenTCP&nbsp;on&nbsp;:0:&nbsp;%v&#34;</span><span class="op" id="7497073">,</span>&nbsp;<span class="ident" id="7497075">err</span><span class="op" id="7497078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7497082">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7497085">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7497089">go</span>&nbsp;<span class="keyword" id="7497092">func</span><span class="op" id="7497096">(</span><span class="op" id="7497097">)</span>&nbsp;<span class="op" id="7497099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7497103">defer</span>&nbsp;<span class="ident" id="7497109">ln</span><span class="op" id="7497111">.</span><span class="ident" id="7497112">Close</span><span class="op" id="7497117">(</span><span class="op" id="7497118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7497122">c</span><span class="op" id="7497123">,</span>&nbsp;<span class="ident" id="7497125">err</span>&nbsp;<span class="op" id="7497129">:=</span>&nbsp;<span class="ident" id="7497132">ln</span><span class="op" id="7497134">.</span><span class="ident" id="7497135">Accept</span><span class="op" id="7497141">(</span><span class="op" id="7497142">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7497146">if</span>&nbsp;<span class="ident" id="7497149">err</span>&nbsp;<span class="op" id="7497153">!=</span>&nbsp;<span class="ident" id="7497156">nil</span>&nbsp;<span class="op" id="7497160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7497165">t</span><span class="op" id="7497166">.</span><span class="ident" id="7497167">Errorf</span><span class="op" id="7497173">(</span><span class="string" id="7497174">&#34;Accept:&nbsp;%v&#34;</span><span class="op" id="7497186">,</span>&nbsp;<span class="ident" id="7497188">err</span><span class="op" id="7497191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7497196">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7497205">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7497209">var</span>&nbsp;<span class="ident" id="7497213">buf</span>&nbsp;<span class="op" id="7497217">[</span><span class="num" id="7497218">10</span><span class="op" id="7497220">]</span><span class="builtintype" id="7497221">byte</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7497228">n</span><span class="op" id="7497229">,</span>&nbsp;<span class="ident" id="7497231">err</span>&nbsp;<span class="op" id="7497235">:=</span>&nbsp;<span class="ident" id="7497238">c</span><span class="op" id="7497239">.</span><span class="ident" id="7497240">Read</span><span class="op" id="7497244">(</span><span class="ident" id="7497245">buf</span><span class="op" id="7497248">[</span><span class="op" id="7497249">:</span><span class="op" id="7497250">]</span><span class="op" id="7497251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7497255">if</span>&nbsp;<span class="ident" id="7497258">n</span>&nbsp;<span class="op" id="7497260">!=</span>&nbsp;<span class="num" id="7497263">0</span>&nbsp;<span class="op" id="7497265">||</span>&nbsp;<span class="ident" id="7497268">err</span>&nbsp;<span class="op" id="7497272">!=</span>&nbsp;<span class="ident" id="7497275">io</span><span class="op" id="7497277">.</span><span class="ident" id="7497278">EOF</span>&nbsp;<span class="op" id="7497282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7497287">t</span><span class="op" id="7497288">.</span><span class="ident" id="7497289">Errorf</span><span class="op" id="7497295">(</span><span class="string" id="7497296">&#34;server&nbsp;Read&nbsp;=&nbsp;%d,&nbsp;%v;&nbsp;want&nbsp;0,&nbsp;io.EOF&#34;</span><span class="op" id="7497334">,</span>&nbsp;<span class="ident" id="7497336">n</span><span class="op" id="7497337">,</span>&nbsp;<span class="ident" id="7497339">err</span><span class="op" id="7497342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7497347">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7497356">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7497360">c</span><span class="op" id="7497361">.</span><span class="ident" id="7497362">Write</span><span class="op" id="7497367">(</span><span class="op" id="7497368">[</span><span class="op" id="7497369">]</span><span class="builtintype" id="7497370">byte</span><span class="op" id="7497374">(</span><span class="string" id="7497375">&#34;response&#34;</span><span class="op" id="7497385">)</span><span class="op" id="7497386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7497390">c</span><span class="op" id="7497391">.</span><span class="ident" id="7497392">Close</span><span class="op" id="7497397">(</span><span class="op" id="7497398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7497401">}</span><span class="op" id="7497402">(</span><span class="op" id="7497403">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7497407">c</span><span class="op" id="7497408">,</span>&nbsp;<span class="ident" id="7497410">err</span>&nbsp;<span class="op" id="7497414">:=</span>&nbsp;<span class="ident" id="7497417">Dial</span><span class="op" id="7497421">(</span><span class="string" id="7497422">&#34;tcp&#34;</span><span class="op" id="7497427">,</span>&nbsp;<span class="ident" id="7497429">ln</span><span class="op" id="7497431">.</span><span class="ident" id="7497432">Addr</span><span class="op" id="7497436">(</span><span class="op" id="7497437">)</span><span class="op" id="7497438">.</span><span class="ident" id="7497439">String</span><span class="op" id="7497445">(</span><span class="op" id="7497446">)</span><span class="op" id="7497447">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7497450">if</span>&nbsp;<span class="ident" id="7497453">err</span>&nbsp;<span class="op" id="7497457">!=</span>&nbsp;<span class="ident" id="7497460">nil</span>&nbsp;<span class="op" id="7497464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7497468">t</span><span class="op" id="7497469">.</span><span class="ident" id="7497470">Fatalf</span><span class="op" id="7497476">(</span><span class="string" id="7497477">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="7497487">,</span>&nbsp;<span class="ident" id="7497489">err</span><span class="op" id="7497492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7497495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7497498">defer</span>&nbsp;<span class="ident" id="7497504">c</span><span class="op" id="7497505">.</span><span class="ident" id="7497506">Close</span><span class="op" id="7497511">(</span><span class="op" id="7497512">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7497516">err</span>&nbsp;<span class="op" id="7497520">=</span>&nbsp;<span class="ident" id="7497522">c</span><span class="op" id="7497523">.</span><span class="op" id="7497524">(</span><span class="op" id="7497525">*</span><span class="ident" id="7497526">TCPConn</span><span class="op" id="7497533">)</span><span class="op" id="7497534">.</span><span class="ident" id="7497535">CloseWrite</span><span class="op" id="7497545">(</span><span class="op" id="7497546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7497549">if</span>&nbsp;<span class="ident" id="7497552">err</span>&nbsp;<span class="op" id="7497556">!=</span>&nbsp;<span class="ident" id="7497559">nil</span>&nbsp;<span class="op" id="7497563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7497567">t</span><span class="op" id="7497568">.</span><span class="ident" id="7497569">Fatalf</span><span class="op" id="7497575">(</span><span class="string" id="7497576">&#34;CloseWrite:&nbsp;%v&#34;</span><span class="op" id="7497592">,</span>&nbsp;<span class="ident" id="7497594">err</span><span class="op" id="7497597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7497600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7497603">var</span>&nbsp;<span class="ident" id="7497607">buf</span>&nbsp;<span class="op" id="7497611">[</span><span class="num" id="7497612">10</span><span class="op" id="7497614">]</span><span class="builtintype" id="7497615">byte</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7497621">n</span><span class="op" id="7497622">,</span>&nbsp;<span class="ident" id="7497624">err</span>&nbsp;<span class="op" id="7497628">:=</span>&nbsp;<span class="ident" id="7497631">c</span><span class="op" id="7497632">.</span><span class="ident" id="7497633">Read</span><span class="op" id="7497637">(</span><span class="ident" id="7497638">buf</span><span class="op" id="7497641">[</span><span class="op" id="7497642">:</span><span class="op" id="7497643">]</span><span class="op" id="7497644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7497647">if</span>&nbsp;<span class="ident" id="7497650">err</span>&nbsp;<span class="op" id="7497654">!=</span>&nbsp;<span class="ident" id="7497657">nil</span>&nbsp;<span class="op" id="7497661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7497665">t</span><span class="op" id="7497666">.</span><span class="ident" id="7497667">Fatalf</span><span class="op" id="7497673">(</span><span class="string" id="7497674">&#34;client&nbsp;Read:&nbsp;%d,&nbsp;%v&#34;</span><span class="op" id="7497695">,</span>&nbsp;<span class="ident" id="7497697">n</span><span class="op" id="7497698">,</span>&nbsp;<span class="ident" id="7497700">err</span><span class="op" id="7497703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7497706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7497709">got</span>&nbsp;<span class="op" id="7497713">:=</span>&nbsp;<span class="builtintype" id="7497716">string</span><span class="op" id="7497722">(</span><span class="ident" id="7497723">buf</span><span class="op" id="7497726">[</span><span class="op" id="7497727">:</span><span class="ident" id="7497728">n</span><span class="op" id="7497729">]</span><span class="op" id="7497730">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7497733">if</span>&nbsp;<span class="ident" id="7497736">got</span>&nbsp;<span class="op" id="7497740">!=</span>&nbsp;<span class="string" id="7497743">&#34;response&#34;</span>&nbsp;<span class="op" id="7497754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7497758">t</span><span class="op" id="7497759">.</span><span class="ident" id="7497760">Errorf</span><span class="op" id="7497766">(</span><span class="string" id="7497767">&#34;read&nbsp;=&nbsp;%q,&nbsp;want&nbsp;\&#34;response\&#34;&#34;</span><span class="op" id="7497797">,</span>&nbsp;<span class="ident" id="7497799">got</span><span class="op" id="7497802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7497805">}</span><br>
<span class="lineno"></span><span class="op" id="7497807">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="keyword" id="7497810">func</span>&nbsp;<span class="ident" id="7497815">TestShutdownUnix</span><span class="op" id="7497831">(</span><span class="ident" id="7497832">t</span>&nbsp;<span class="op" id="7497834">*</span><span class="ident" id="7497835">testing</span><span class="op" id="7497842">.</span><span class="ident" id="7497843">T</span><span class="op" id="7497844">)</span>&nbsp;<span class="op" id="7497846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7497849">switch</span>&nbsp;<span class="ident" id="7497856">runtime</span><span class="op" id="7497863">.</span><span class="ident" id="7497864">GOOS</span>&nbsp;<span class="op" id="7497869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7497872">case</span>&nbsp;<span class="string" id="7497877">&#34;nacl&#34;</span><span class="op" id="7497883">,</span>&nbsp;<span class="string" id="7497885">&#34;plan9&#34;</span><span class="op" id="7497892">,</span>&nbsp;<span class="string" id="7497894">&#34;windows&#34;</span><span class="op" id="7497903">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7497907">t</span><span class="op" id="7497908">.</span><span class="ident" id="7497909">Skipf</span><span class="op" id="7497914">(</span><span class="string" id="7497915">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7497936">,</span>&nbsp;<span class="ident" id="7497938">runtime</span><span class="op" id="7497945">.</span><span class="ident" id="7497946">GOOS</span><span class="op" id="7497950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7497953">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7497956">f</span><span class="op" id="7497957">,</span>&nbsp;<span class="ident" id="7497959">err</span>&nbsp;<span class="op" id="7497963">:=</span>&nbsp;<span class="ident" id="7497966">ioutil</span><span class="op" id="7497972">.</span><span class="ident" id="7497973">TempFile</span><span class="op" id="7497981">(</span><span class="string" id="7497982">&#34;&#34;</span><span class="op" id="7497984">,</span>&nbsp;<span class="string" id="7497986">&#34;go_net_unixtest&#34;</span><span class="op" id="7498003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7498006">if</span>&nbsp;<span class="ident" id="7498009">err</span>&nbsp;<span class="op" id="7498013">!=</span>&nbsp;<span class="ident" id="7498016">nil</span>&nbsp;<span class="op" id="7498020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7498024">t</span><span class="op" id="7498025">.</span><span class="ident" id="7498026">Fatalf</span><span class="op" id="7498032">(</span><span class="string" id="7498033">&#34;TempFile:&nbsp;%s&#34;</span><span class="op" id="7498047">,</span>&nbsp;<span class="ident" id="7498049">err</span><span class="op" id="7498052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7498055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7498058">f</span><span class="op" id="7498059">.</span><span class="ident" id="7498060">Close</span><span class="op" id="7498065">(</span><span class="op" id="7498066">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7498069">tmpname</span>&nbsp;<span class="op" id="7498077">:=</span>&nbsp;<span class="ident" id="7498080">f</span><span class="op" id="7498081">.</span><span class="ident" id="7498082">Name</span><span class="op" id="7498086">(</span><span class="op" id="7498087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7498090">os</span><span class="op" id="7498092">.</span><span class="ident" id="7498093">Remove</span><span class="op" id="7498099">(</span><span class="ident" id="7498100">tmpname</span><span class="op" id="7498107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7498110">ln</span><span class="op" id="7498112">,</span>&nbsp;<span class="ident" id="7498114">err</span>&nbsp;<span class="op" id="7498118">:=</span>&nbsp;<span class="ident" id="7498121">Listen</span><span class="op" id="7498127">(</span><span class="string" id="7498128">&#34;unix&#34;</span><span class="op" id="7498134">,</span>&nbsp;<span class="ident" id="7498136">tmpname</span><span class="op" id="7498143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7498146">if</span>&nbsp;<span class="ident" id="7498149">err</span>&nbsp;<span class="op" id="7498153">!=</span>&nbsp;<span class="ident" id="7498156">nil</span>&nbsp;<span class="op" id="7498160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7498164">t</span><span class="op" id="7498165">.</span><span class="ident" id="7498166">Fatalf</span><span class="op" id="7498172">(</span><span class="string" id="7498173">&#34;ListenUnix&nbsp;on&nbsp;%s:&nbsp;%s&#34;</span><span class="op" id="7498195">,</span>&nbsp;<span class="ident" id="7498197">tmpname</span><span class="op" id="7498204">,</span>&nbsp;<span class="ident" id="7498206">err</span><span class="op" id="7498209">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7498212">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7498215">defer</span>&nbsp;<span class="keyword" id="7498221">func</span><span class="op" id="7498225">(</span><span class="op" id="7498226">)</span>&nbsp;<span class="op" id="7498228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7498232">ln</span><span class="op" id="7498234">.</span><span class="ident" id="7498235">Close</span><span class="op" id="7498240">(</span><span class="op" id="7498241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7498245">os</span><span class="op" id="7498247">.</span><span class="ident" id="7498248">Remove</span><span class="op" id="7498254">(</span><span class="ident" id="7498255">tmpname</span><span class="op" id="7498262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7498265">}</span><span class="op" id="7498266">(</span><span class="op" id="7498267">)</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7498271">go</span>&nbsp;<span class="keyword" id="7498274">func</span><span class="op" id="7498278">(</span><span class="op" id="7498279">)</span>&nbsp;<span class="op" id="7498281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7498285">c</span><span class="op" id="7498286">,</span>&nbsp;<span class="ident" id="7498288">err</span>&nbsp;<span class="op" id="7498292">:=</span>&nbsp;<span class="ident" id="7498295">ln</span><span class="op" id="7498297">.</span><span class="ident" id="7498298">Accept</span><span class="op" id="7498304">(</span><span class="op" id="7498305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7498309">if</span>&nbsp;<span class="ident" id="7498312">err</span>&nbsp;<span class="op" id="7498316">!=</span>&nbsp;<span class="ident" id="7498319">nil</span>&nbsp;<span class="op" id="7498323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7498328">t</span><span class="op" id="7498329">.</span><span class="ident" id="7498330">Errorf</span><span class="op" id="7498336">(</span><span class="string" id="7498337">&#34;Accept:&nbsp;%v&#34;</span><span class="op" id="7498349">,</span>&nbsp;<span class="ident" id="7498351">err</span><span class="op" id="7498354">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7498359">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7498368">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7498372">var</span>&nbsp;<span class="ident" id="7498376">buf</span>&nbsp;<span class="op" id="7498380">[</span><span class="num" id="7498381">10</span><span class="op" id="7498383">]</span><span class="builtintype" id="7498384">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7498391">n</span><span class="op" id="7498392">,</span>&nbsp;<span class="ident" id="7498394">err</span>&nbsp;<span class="op" id="7498398">:=</span>&nbsp;<span class="ident" id="7498401">c</span><span class="op" id="7498402">.</span><span class="ident" id="7498403">Read</span><span class="op" id="7498407">(</span><span class="ident" id="7498408">buf</span><span class="op" id="7498411">[</span><span class="op" id="7498412">:</span><span class="op" id="7498413">]</span><span class="op" id="7498414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7498418">if</span>&nbsp;<span class="ident" id="7498421">n</span>&nbsp;<span class="op" id="7498423">!=</span>&nbsp;<span class="num" id="7498426">0</span>&nbsp;<span class="op" id="7498428">||</span>&nbsp;<span class="ident" id="7498431">err</span>&nbsp;<span class="op" id="7498435">!=</span>&nbsp;<span class="ident" id="7498438">io</span><span class="op" id="7498440">.</span><span class="ident" id="7498441">EOF</span>&nbsp;<span class="op" id="7498445">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7498450">t</span><span class="op" id="7498451">.</span><span class="ident" id="7498452">Errorf</span><span class="op" id="7498458">(</span><span class="string" id="7498459">&#34;server&nbsp;Read&nbsp;=&nbsp;%d,&nbsp;%v;&nbsp;want&nbsp;0,&nbsp;io.EOF&#34;</span><span class="op" id="7498497">,</span>&nbsp;<span class="ident" id="7498499">n</span><span class="op" id="7498500">,</span>&nbsp;<span class="ident" id="7498502">err</span><span class="op" id="7498505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7498510">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7498519">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7498523">c</span><span class="op" id="7498524">.</span><span class="ident" id="7498525">Write</span><span class="op" id="7498530">(</span><span class="op" id="7498531">[</span><span class="op" id="7498532">]</span><span class="builtintype" id="7498533">byte</span><span class="op" id="7498537">(</span><span class="string" id="7498538">&#34;response&#34;</span><span class="op" id="7498548">)</span><span class="op" id="7498549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7498553">c</span><span class="op" id="7498554">.</span><span class="ident" id="7498555">Close</span><span class="op" id="7498560">(</span><span class="op" id="7498561">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7498564">}</span><span class="op" id="7498565">(</span><span class="op" id="7498566">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7498570">c</span><span class="op" id="7498571">,</span>&nbsp;<span class="ident" id="7498573">err</span>&nbsp;<span class="op" id="7498577">:=</span>&nbsp;<span class="ident" id="7498580">Dial</span><span class="op" id="7498584">(</span><span class="string" id="7498585">&#34;unix&#34;</span><span class="op" id="7498591">,</span>&nbsp;<span class="ident" id="7498593">tmpname</span><span class="op" id="7498600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7498603">if</span>&nbsp;<span class="ident" id="7498606">err</span>&nbsp;<span class="op" id="7498610">!=</span>&nbsp;<span class="ident" id="7498613">nil</span>&nbsp;<span class="op" id="7498617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7498621">t</span><span class="op" id="7498622">.</span><span class="ident" id="7498623">Fatalf</span><span class="op" id="7498629">(</span><span class="string" id="7498630">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="7498640">,</span>&nbsp;<span class="ident" id="7498642">err</span><span class="op" id="7498645">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7498648">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7498651">defer</span>&nbsp;<span class="ident" id="7498657">c</span><span class="op" id="7498658">.</span><span class="ident" id="7498659">Close</span><span class="op" id="7498664">(</span><span class="op" id="7498665">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7498669">err</span>&nbsp;<span class="op" id="7498673">=</span>&nbsp;<span class="ident" id="7498675">c</span><span class="op" id="7498676">.</span><span class="op" id="7498677">(</span><span class="op" id="7498678">*</span><span class="ident" id="7498679">UnixConn</span><span class="op" id="7498687">)</span><span class="op" id="7498688">.</span><span class="ident" id="7498689">CloseWrite</span><span class="op" id="7498699">(</span><span class="op" id="7498700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7498703">if</span>&nbsp;<span class="ident" id="7498706">err</span>&nbsp;<span class="op" id="7498710">!=</span>&nbsp;<span class="ident" id="7498713">nil</span>&nbsp;<span class="op" id="7498717">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7498721">t</span><span class="op" id="7498722">.</span><span class="ident" id="7498723">Fatalf</span><span class="op" id="7498729">(</span><span class="string" id="7498730">&#34;CloseWrite:&nbsp;%v&#34;</span><span class="op" id="7498746">,</span>&nbsp;<span class="ident" id="7498748">err</span><span class="op" id="7498751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7498754">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7498757">var</span>&nbsp;<span class="ident" id="7498761">buf</span>&nbsp;<span class="op" id="7498765">[</span><span class="num" id="7498766">10</span><span class="op" id="7498768">]</span><span class="builtintype" id="7498769">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7498775">n</span><span class="op" id="7498776">,</span>&nbsp;<span class="ident" id="7498778">err</span>&nbsp;<span class="op" id="7498782">:=</span>&nbsp;<span class="ident" id="7498785">c</span><span class="op" id="7498786">.</span><span class="ident" id="7498787">Read</span><span class="op" id="7498791">(</span><span class="ident" id="7498792">buf</span><span class="op" id="7498795">[</span><span class="op" id="7498796">:</span><span class="op" id="7498797">]</span><span class="op" id="7498798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7498801">if</span>&nbsp;<span class="ident" id="7498804">err</span>&nbsp;<span class="op" id="7498808">!=</span>&nbsp;<span class="ident" id="7498811">nil</span>&nbsp;<span class="op" id="7498815">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7498819">t</span><span class="op" id="7498820">.</span><span class="ident" id="7498821">Fatalf</span><span class="op" id="7498827">(</span><span class="string" id="7498828">&#34;client&nbsp;Read:&nbsp;%d,&nbsp;%v&#34;</span><span class="op" id="7498849">,</span>&nbsp;<span class="ident" id="7498851">n</span><span class="op" id="7498852">,</span>&nbsp;<span class="ident" id="7498854">err</span><span class="op" id="7498857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7498860">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7498863">got</span>&nbsp;<span class="op" id="7498867">:=</span>&nbsp;<span class="builtintype" id="7498870">string</span><span class="op" id="7498876">(</span><span class="ident" id="7498877">buf</span><span class="op" id="7498880">[</span><span class="op" id="7498881">:</span><span class="ident" id="7498882">n</span><span class="op" id="7498883">]</span><span class="op" id="7498884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7498887">if</span>&nbsp;<span class="ident" id="7498890">got</span>&nbsp;<span class="op" id="7498894">!=</span>&nbsp;<span class="string" id="7498897">&#34;response&#34;</span>&nbsp;<span class="op" id="7498908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7498912">t</span><span class="op" id="7498913">.</span><span class="ident" id="7498914">Errorf</span><span class="op" id="7498920">(</span><span class="string" id="7498921">&#34;read&nbsp;=&nbsp;%q,&nbsp;want&nbsp;\&#34;response\&#34;&#34;</span><span class="op" id="7498951">,</span>&nbsp;<span class="ident" id="7498953">got</span><span class="op" id="7498956">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7498959">}</span><br>
<span class="lineno"></span><span class="op" id="7498961">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7498964">func</span>&nbsp;<span class="ident" id="7498969">TestTCPListenClose</span><span class="op" id="7498987">(</span><span class="ident" id="7498988">t</span>&nbsp;<span class="op" id="7498990">*</span><span class="ident" id="7498991">testing</span><span class="op" id="7498998">.</span><span class="ident" id="7498999">T</span><span class="op" id="7499000">)</span>&nbsp;<span class="op" id="7499002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7499005">ln</span><span class="op" id="7499007">,</span>&nbsp;<span class="ident" id="7499009">err</span>&nbsp;<span class="op" id="7499013">:=</span>&nbsp;<span class="ident" id="7499016">Listen</span><span class="op" id="7499022">(</span><span class="string" id="7499023">&#34;tcp&#34;</span><span class="op" id="7499028">,</span>&nbsp;<span class="string" id="7499030">&#34;127.0.0.1:0&#34;</span><span class="op" id="7499043">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7499046">if</span>&nbsp;<span class="ident" id="7499049">err</span>&nbsp;<span class="op" id="7499053">!=</span>&nbsp;<span class="ident" id="7499056">nil</span>&nbsp;<span class="op" id="7499060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7499064">t</span><span class="op" id="7499065">.</span><span class="ident" id="7499066">Fatalf</span><span class="op" id="7499072">(</span><span class="string" id="7499073">&#34;Listen&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7499092">,</span>&nbsp;<span class="ident" id="7499094">err</span><span class="op" id="7499097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7499100">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7499104">done</span>&nbsp;<span class="op" id="7499109">:=</span>&nbsp;<span class="builtinfunc" id="7499112">make</span><span class="op" id="7499116">(</span><span class="keyword" id="7499117">chan</span>&nbsp;<span class="builtintype" id="7499122">bool</span><span class="op" id="7499126">,</span>&nbsp;<span class="num" id="7499128">1</span><span class="op" id="7499129">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7499132">go</span>&nbsp;<span class="keyword" id="7499135">func</span><span class="op" id="7499139">(</span><span class="op" id="7499140">)</span>&nbsp;<span class="op" id="7499142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7499146">time</span><span class="op" id="7499150">.</span><span class="ident" id="7499151">Sleep</span><span class="op" id="7499156">(</span><span class="num" id="7499157">100</span>&nbsp;<span class="op" id="7499161">*</span>&nbsp;<span class="ident" id="7499163">time</span><span class="op" id="7499167">.</span><span class="ident" id="7499168">Millisecond</span><span class="op" id="7499179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7499183">ln</span><span class="op" id="7499185">.</span><span class="ident" id="7499186">Close</span><span class="op" id="7499191">(</span><span class="op" id="7499192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7499195">}</span><span class="op" id="7499196">(</span><span class="op" id="7499197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7499200">go</span>&nbsp;<span class="keyword" id="7499203">func</span><span class="op" id="7499207">(</span><span class="op" id="7499208">)</span>&nbsp;<span class="op" id="7499210">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7499214">c</span><span class="op" id="7499215">,</span>&nbsp;<span class="ident" id="7499217">err</span>&nbsp;<span class="op" id="7499221">:=</span>&nbsp;<span class="ident" id="7499224">ln</span><span class="op" id="7499226">.</span><span class="ident" id="7499227">Accept</span><span class="op" id="7499233">(</span><span class="op" id="7499234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7499238">if</span>&nbsp;<span class="ident" id="7499241">err</span>&nbsp;<span class="op" id="7499245">==</span>&nbsp;<span class="ident" id="7499248">nil</span>&nbsp;<span class="op" id="7499252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7499257">c</span><span class="op" id="7499258">.</span><span class="ident" id="7499259">Close</span><span class="op" id="7499264">(</span><span class="op" id="7499265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7499270">t</span><span class="op" id="7499271">.</span><span class="ident" id="7499272">Error</span><span class="op" id="7499277">(</span><span class="string" id="7499278">&#34;Accept&nbsp;succeeded&#34;</span><span class="op" id="7499296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7499300">}</span>&nbsp;<span class="keyword" id="7499302">else</span>&nbsp;<span class="op" id="7499307">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7499312">t</span><span class="op" id="7499313">.</span><span class="ident" id="7499314">Logf</span><span class="op" id="7499318">(</span><span class="string" id="7499319">&#34;Accept&nbsp;timeout&nbsp;error:&nbsp;%s&nbsp;(any&nbsp;error&nbsp;is&nbsp;fine)&#34;</span><span class="op" id="7499365">,</span>&nbsp;<span class="ident" id="7499367">err</span><span class="op" id="7499370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7499374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7499378">done</span>&nbsp;<span class="op" id="7499383">&lt;-</span>&nbsp;<span class="ident" id="7499386">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7499392">}</span><span class="op" id="7499393">(</span><span class="op" id="7499394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7499397">select</span>&nbsp;<span class="op" id="7499404">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7499407">case</span>&nbsp;<span class="op" id="7499412">&lt;-</span><span class="ident" id="7499414">done</span><span class="op" id="7499418">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7499421">case</span>&nbsp;<span class="op" id="7499426">&lt;-</span><span class="ident" id="7499428">time</span><span class="op" id="7499432">.</span><span class="ident" id="7499433">After</span><span class="op" id="7499438">(</span><span class="num" id="7499439">2</span>&nbsp;<span class="op" id="7499441">*</span>&nbsp;<span class="ident" id="7499443">time</span><span class="op" id="7499447">.</span><span class="ident" id="7499448">Second</span><span class="op" id="7499454">)</span><span class="op" id="7499455">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7499459">t</span><span class="op" id="7499460">.</span><span class="ident" id="7499461">Fatal</span><span class="op" id="7499466">(</span><span class="string" id="7499467">&#34;timeout&nbsp;waiting&nbsp;for&nbsp;TCP&nbsp;close&#34;</span><span class="op" id="7499498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7499501">}</span><br>
<span class="lineno"></span><span class="op" id="7499503">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="keyword" id="7499506">func</span>&nbsp;<span class="ident" id="7499511">TestUDPListenClose</span><span class="op" id="7499529">(</span><span class="ident" id="7499530">t</span>&nbsp;<span class="op" id="7499532">*</span><span class="ident" id="7499533">testing</span><span class="op" id="7499540">.</span><span class="ident" id="7499541">T</span><span class="op" id="7499542">)</span>&nbsp;<span class="op" id="7499544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7499547">switch</span>&nbsp;<span class="ident" id="7499554">runtime</span><span class="op" id="7499561">.</span><span class="ident" id="7499562">GOOS</span>&nbsp;<span class="op" id="7499567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7499570">case</span>&nbsp;<span class="string" id="7499575">&#34;plan9&#34;</span><span class="op" id="7499582">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7499586">t</span><span class="op" id="7499587">.</span><span class="ident" id="7499588">Skipf</span><span class="op" id="7499593">(</span><span class="string" id="7499594">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7499615">,</span>&nbsp;<span class="ident" id="7499617">runtime</span><span class="op" id="7499624">.</span><span class="ident" id="7499625">GOOS</span><span class="op" id="7499629">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7499632">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7499635">ln</span><span class="op" id="7499637">,</span>&nbsp;<span class="ident" id="7499639">err</span>&nbsp;<span class="op" id="7499643">:=</span>&nbsp;<span class="ident" id="7499646">ListenPacket</span><span class="op" id="7499658">(</span><span class="string" id="7499659">&#34;udp&#34;</span><span class="op" id="7499664">,</span>&nbsp;<span class="string" id="7499666">&#34;127.0.0.1:0&#34;</span><span class="op" id="7499679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7499682">if</span>&nbsp;<span class="ident" id="7499685">err</span>&nbsp;<span class="op" id="7499689">!=</span>&nbsp;<span class="ident" id="7499692">nil</span>&nbsp;<span class="op" id="7499696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7499700">t</span><span class="op" id="7499701">.</span><span class="ident" id="7499702">Fatalf</span><span class="op" id="7499708">(</span><span class="string" id="7499709">&#34;Listen&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7499728">,</span>&nbsp;<span class="ident" id="7499730">err</span><span class="op" id="7499733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7499736">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7499740">buf</span>&nbsp;<span class="op" id="7499744">:=</span>&nbsp;<span class="builtinfunc" id="7499747">make</span><span class="op" id="7499751">(</span><span class="op" id="7499752">[</span><span class="op" id="7499753">]</span><span class="builtintype" id="7499754">byte</span><span class="op" id="7499758">,</span>&nbsp;<span class="num" id="7499760">1000</span><span class="op" id="7499764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7499767">done</span>&nbsp;<span class="op" id="7499772">:=</span>&nbsp;<span class="builtinfunc" id="7499775">make</span><span class="op" id="7499779">(</span><span class="keyword" id="7499780">chan</span>&nbsp;<span class="builtintype" id="7499785">bool</span><span class="op" id="7499789">,</span>&nbsp;<span class="num" id="7499791">1</span><span class="op" id="7499792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7499795">go</span>&nbsp;<span class="keyword" id="7499798">func</span><span class="op" id="7499802">(</span><span class="op" id="7499803">)</span>&nbsp;<span class="op" id="7499805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7499809">time</span><span class="op" id="7499813">.</span><span class="ident" id="7499814">Sleep</span><span class="op" id="7499819">(</span><span class="num" id="7499820">100</span>&nbsp;<span class="op" id="7499824">*</span>&nbsp;<span class="ident" id="7499826">time</span><span class="op" id="7499830">.</span><span class="ident" id="7499831">Millisecond</span><span class="op" id="7499842">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7499846">ln</span><span class="op" id="7499848">.</span><span class="ident" id="7499849">Close</span><span class="op" id="7499854">(</span><span class="op" id="7499855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7499858">}</span><span class="op" id="7499859">(</span><span class="op" id="7499860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7499863">go</span>&nbsp;<span class="keyword" id="7499866">func</span><span class="op" id="7499870">(</span><span class="op" id="7499871">)</span>&nbsp;<span class="op" id="7499873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7499877">_</span><span class="op" id="7499878">,</span>&nbsp;<span class="ident" id="7499880">_</span><span class="op" id="7499881">,</span>&nbsp;<span class="ident" id="7499883">err</span>&nbsp;<span class="op" id="7499887">=</span>&nbsp;<span class="ident" id="7499889">ln</span><span class="op" id="7499891">.</span><span class="ident" id="7499892">ReadFrom</span><span class="op" id="7499900">(</span><span class="ident" id="7499901">buf</span><span class="op" id="7499904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7499908">if</span>&nbsp;<span class="ident" id="7499911">err</span>&nbsp;<span class="op" id="7499915">==</span>&nbsp;<span class="ident" id="7499918">nil</span>&nbsp;<span class="op" id="7499922">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7499927">t</span><span class="op" id="7499928">.</span><span class="ident" id="7499929">Error</span><span class="op" id="7499934">(</span><span class="string" id="7499935">&#34;ReadFrom&nbsp;succeeded&#34;</span><span class="op" id="7499955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7499959">}</span>&nbsp;<span class="keyword" id="7499961">else</span>&nbsp;<span class="op" id="7499966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7499971">t</span><span class="op" id="7499972">.</span><span class="ident" id="7499973">Logf</span><span class="op" id="7499977">(</span><span class="string" id="7499978">&#34;ReadFrom&nbsp;timeout&nbsp;error:&nbsp;%s&nbsp;(any&nbsp;error&nbsp;is&nbsp;fine)&#34;</span><span class="op" id="7500026">,</span>&nbsp;<span class="ident" id="7500028">err</span><span class="op" id="7500031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7500035">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7500039">done</span>&nbsp;<span class="op" id="7500044">&lt;-</span>&nbsp;<span class="ident" id="7500047">true</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7500053">}</span><span class="op" id="7500054">(</span><span class="op" id="7500055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7500058">select</span>&nbsp;<span class="op" id="7500065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7500068">case</span>&nbsp;<span class="op" id="7500073">&lt;-</span><span class="ident" id="7500075">done</span><span class="op" id="7500079">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7500082">case</span>&nbsp;<span class="op" id="7500087">&lt;-</span><span class="ident" id="7500089">time</span><span class="op" id="7500093">.</span><span class="ident" id="7500094">After</span><span class="op" id="7500099">(</span><span class="num" id="7500100">2</span>&nbsp;<span class="op" id="7500102">*</span>&nbsp;<span class="ident" id="7500104">time</span><span class="op" id="7500108">.</span><span class="ident" id="7500109">Second</span><span class="op" id="7500115">)</span><span class="op" id="7500116">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7500120">t</span><span class="op" id="7500121">.</span><span class="ident" id="7500122">Fatal</span><span class="op" id="7500127">(</span><span class="string" id="7500128">&#34;timeout&nbsp;waiting&nbsp;for&nbsp;UDP&nbsp;close&#34;</span><span class="op" id="7500159">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7500162">}</span><br>
<span class="lineno"></span><span class="op" id="7500164">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7500167">func</span>&nbsp;<span class="ident" id="7500172">TestTCPClose</span><span class="op" id="7500184">(</span><span class="ident" id="7500185">t</span>&nbsp;<span class="op" id="7500187">*</span><span class="ident" id="7500188">testing</span><span class="op" id="7500195">.</span><span class="ident" id="7500196">T</span><span class="op" id="7500197">)</span>&nbsp;<span class="op" id="7500199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7500202">switch</span>&nbsp;<span class="ident" id="7500209">runtime</span><span class="op" id="7500216">.</span><span class="ident" id="7500217">GOOS</span>&nbsp;<span class="op" id="7500222">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7500225">case</span>&nbsp;<span class="string" id="7500230">&#34;plan9&#34;</span><span class="op" id="7500237">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7500241">t</span><span class="op" id="7500242">.</span><span class="ident" id="7500243">Skipf</span><span class="op" id="7500248">(</span><span class="string" id="7500249">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7500270">,</span>&nbsp;<span class="ident" id="7500272">runtime</span><span class="op" id="7500279">.</span><span class="ident" id="7500280">GOOS</span><span class="op" id="7500284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7500287">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7500290">l</span><span class="op" id="7500291">,</span>&nbsp;<span class="ident" id="7500293">err</span>&nbsp;<span class="op" id="7500297">:=</span>&nbsp;<span class="ident" id="7500300">Listen</span><span class="op" id="7500306">(</span><span class="string" id="7500307">&#34;tcp&#34;</span><span class="op" id="7500312">,</span>&nbsp;<span class="string" id="7500314">&#34;127.0.0.1:0&#34;</span><span class="op" id="7500327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7500330">if</span>&nbsp;<span class="ident" id="7500333">err</span>&nbsp;<span class="op" id="7500337">!=</span>&nbsp;<span class="ident" id="7500340">nil</span>&nbsp;<span class="op" id="7500344">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7500348">t</span><span class="op" id="7500349">.</span><span class="ident" id="7500350">Fatal</span><span class="op" id="7500355">(</span><span class="ident" id="7500356">err</span><span class="op" id="7500359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7500362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7500365">defer</span>&nbsp;<span class="ident" id="7500371">l</span><span class="op" id="7500372">.</span><span class="ident" id="7500373">Close</span><span class="op" id="7500378">(</span><span class="op" id="7500379">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7500383">read</span>&nbsp;<span class="op" id="7500388">:=</span>&nbsp;<span class="keyword" id="7500391">func</span><span class="op" id="7500395">(</span><span class="ident" id="7500396">r</span>&nbsp;<span class="ident" id="7500398">io</span><span class="op" id="7500400">.</span><span class="ident" id="7500401">Reader</span><span class="op" id="7500407">)</span>&nbsp;<span class="builtintype" id="7500409">error</span>&nbsp;<span class="op" id="7500415">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7500419">var</span>&nbsp;<span class="ident" id="7500423">m</span>&nbsp;<span class="op" id="7500425">[</span><span class="num" id="7500426">1</span><span class="op" id="7500427">]</span><span class="builtintype" id="7500428">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7500435">_</span><span class="op" id="7500436">,</span>&nbsp;<span class="ident" id="7500438">err</span>&nbsp;<span class="op" id="7500442">:=</span>&nbsp;<span class="ident" id="7500445">r</span><span class="op" id="7500446">.</span><span class="ident" id="7500447">Read</span><span class="op" id="7500451">(</span><span class="ident" id="7500452">m</span><span class="op" id="7500453">[</span><span class="op" id="7500454">:</span><span class="op" id="7500455">]</span><span class="op" id="7500456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7500460">return</span>&nbsp;<span class="ident" id="7500467">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7500472">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7500476">go</span>&nbsp;<span class="keyword" id="7500479">func</span><span class="op" id="7500483">(</span><span class="op" id="7500484">)</span>&nbsp;<span class="op" id="7500486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7500490">c</span><span class="op" id="7500491">,</span>&nbsp;<span class="ident" id="7500493">err</span>&nbsp;<span class="op" id="7500497">:=</span>&nbsp;<span class="ident" id="7500500">Dial</span><span class="op" id="7500504">(</span><span class="string" id="7500505">&#34;tcp&#34;</span><span class="op" id="7500510">,</span>&nbsp;<span class="ident" id="7500512">l</span><span class="op" id="7500513">.</span><span class="ident" id="7500514">Addr</span><span class="op" id="7500518">(</span><span class="op" id="7500519">)</span><span class="op" id="7500520">.</span><span class="ident" id="7500521">String</span><span class="op" id="7500527">(</span><span class="op" id="7500528">)</span><span class="op" id="7500529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7500533">if</span>&nbsp;<span class="ident" id="7500536">err</span>&nbsp;<span class="op" id="7500540">!=</span>&nbsp;<span class="ident" id="7500543">nil</span>&nbsp;<span class="op" id="7500547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7500552">t</span><span class="op" id="7500553">.</span><span class="ident" id="7500554">Errorf</span><span class="op" id="7500560">(</span><span class="string" id="7500561">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="7500571">,</span>&nbsp;<span class="ident" id="7500573">err</span><span class="op" id="7500576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7500581">return</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7500590">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7500595">go</span>&nbsp;<span class="ident" id="7500598">read</span><span class="op" id="7500602">(</span><span class="ident" id="7500603">c</span><span class="op" id="7500604">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7500609">time</span><span class="op" id="7500613">.</span><span class="ident" id="7500614">Sleep</span><span class="op" id="7500619">(</span><span class="num" id="7500620">10</span>&nbsp;<span class="op" id="7500623">*</span>&nbsp;<span class="ident" id="7500625">time</span><span class="op" id="7500629">.</span><span class="ident" id="7500630">Millisecond</span><span class="op" id="7500641">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7500645">c</span><span class="op" id="7500646">.</span><span class="ident" id="7500647">Close</span><span class="op" id="7500652">(</span><span class="op" id="7500653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7500656">}</span><span class="op" id="7500657">(</span><span class="op" id="7500658">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7500662">c</span><span class="op" id="7500663">,</span>&nbsp;<span class="ident" id="7500665">err</span>&nbsp;<span class="op" id="7500669">:=</span>&nbsp;<span class="ident" id="7500672">l</span><span class="op" id="7500673">.</span><span class="ident" id="7500674">Accept</span><span class="op" id="7500680">(</span><span class="op" id="7500681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7500684">if</span>&nbsp;<span class="ident" id="7500687">err</span>&nbsp;<span class="op" id="7500691">!=</span>&nbsp;<span class="ident" id="7500694">nil</span>&nbsp;<span class="op" id="7500698">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7500702">t</span><span class="op" id="7500703">.</span><span class="ident" id="7500704">Fatal</span><span class="op" id="7500709">(</span><span class="ident" id="7500710">err</span><span class="op" id="7500713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7500716">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7500719">defer</span>&nbsp;<span class="ident" id="7500725">c</span><span class="op" id="7500726">.</span><span class="ident" id="7500727">Close</span><span class="op" id="7500732">(</span><span class="op" id="7500733">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7500737">for</span>&nbsp;<span class="ident" id="7500741">err</span>&nbsp;<span class="op" id="7500745">==</span>&nbsp;<span class="ident" id="7500748">nil</span>&nbsp;<span class="op" id="7500752">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7500756">err</span>&nbsp;<span class="op" id="7500760">=</span>&nbsp;<span class="ident" id="7500762">read</span><span class="op" id="7500766">(</span><span class="ident" id="7500767">c</span><span class="op" id="7500768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7500771">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7500774">if</span>&nbsp;<span class="ident" id="7500777">err</span>&nbsp;<span class="op" id="7500781">!=</span>&nbsp;<span class="ident" id="7500784">nil</span>&nbsp;<span class="op" id="7500788">&amp;&amp;</span>&nbsp;<span class="ident" id="7500791">err</span>&nbsp;<span class="op" id="7500795">!=</span>&nbsp;<span class="ident" id="7500798">io</span><span class="op" id="7500800">.</span><span class="ident" id="7500801">EOF</span>&nbsp;<span class="op" id="7500805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7500809">t</span><span class="op" id="7500810">.</span><span class="ident" id="7500811">Fatal</span><span class="op" id="7500816">(</span><span class="ident" id="7500817">err</span><span class="op" id="7500820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7500823">}</span><br>
<span class="lineno">225</span><span class="op" id="7500825">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7500828">func</span>&nbsp;<span class="ident" id="7500833">TestErrorNil</span><span class="op" id="7500845">(</span><span class="ident" id="7500846">t</span>&nbsp;<span class="op" id="7500848">*</span><span class="ident" id="7500849">testing</span><span class="op" id="7500856">.</span><span class="ident" id="7500857">T</span><span class="op" id="7500858">)</span>&nbsp;<span class="op" id="7500860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7500863">c</span><span class="op" id="7500864">,</span>&nbsp;<span class="ident" id="7500866">err</span>&nbsp;<span class="op" id="7500870">:=</span>&nbsp;<span class="ident" id="7500873">Dial</span><span class="op" id="7500877">(</span><span class="string" id="7500878">&#34;tcp&#34;</span><span class="op" id="7500883">,</span>&nbsp;<span class="string" id="7500885">&#34;127.0.0.1:65535&#34;</span><span class="op" id="7500902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7500905">if</span>&nbsp;<span class="ident" id="7500908">err</span>&nbsp;<span class="op" id="7500912">==</span>&nbsp;<span class="ident" id="7500915">nil</span>&nbsp;<span class="op" id="7500919">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7500923">t</span><span class="op" id="7500924">.</span><span class="ident" id="7500925">Fatal</span><span class="op" id="7500930">(</span><span class="string" id="7500931">&#34;Dial&nbsp;127.0.0.1:65535&nbsp;succeeded&#34;</span><span class="op" id="7500963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7500966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7500969">if</span>&nbsp;<span class="ident" id="7500972">c</span>&nbsp;<span class="op" id="7500974">!=</span>&nbsp;<span class="ident" id="7500977">nil</span>&nbsp;<span class="op" id="7500981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7500985">t</span><span class="op" id="7500986">.</span><span class="ident" id="7500987">Fatalf</span><span class="op" id="7500993">(</span><span class="string" id="7500994">&#34;Dial&nbsp;returned&nbsp;non-nil&nbsp;interface&nbsp;%T(%v)&nbsp;with&nbsp;err&nbsp;!=&nbsp;nil&#34;</span><span class="op" id="7501050">,</span>&nbsp;<span class="ident" id="7501052">c</span><span class="op" id="7501053">,</span>&nbsp;<span class="ident" id="7501055">c</span><span class="op" id="7501056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7501059">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7501063">//&nbsp;Make&nbsp;Listen&nbsp;fail&nbsp;by&nbsp;relistening&nbsp;on&nbsp;the&nbsp;same&nbsp;address.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7501120">l</span><span class="op" id="7501121">,</span>&nbsp;<span class="ident" id="7501123">err</span>&nbsp;<span class="op" id="7501127">:=</span>&nbsp;<span class="ident" id="7501130">Listen</span><span class="op" id="7501136">(</span><span class="string" id="7501137">&#34;tcp&#34;</span><span class="op" id="7501142">,</span>&nbsp;<span class="string" id="7501144">&#34;127.0.0.1:0&#34;</span><span class="op" id="7501157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7501160">if</span>&nbsp;<span class="ident" id="7501163">err</span>&nbsp;<span class="op" id="7501167">!=</span>&nbsp;<span class="ident" id="7501170">nil</span>&nbsp;<span class="op" id="7501174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7501178">t</span><span class="op" id="7501179">.</span><span class="ident" id="7501180">Fatalf</span><span class="op" id="7501186">(</span><span class="string" id="7501187">&#34;Listen&nbsp;127.0.0.1:0:&nbsp;%v&#34;</span><span class="op" id="7501211">,</span>&nbsp;<span class="ident" id="7501213">err</span><span class="op" id="7501216">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7501219">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7501222">defer</span>&nbsp;<span class="ident" id="7501228">l</span><span class="op" id="7501229">.</span><span class="ident" id="7501230">Close</span><span class="op" id="7501235">(</span><span class="op" id="7501236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7501239">l1</span><span class="op" id="7501241">,</span>&nbsp;<span class="ident" id="7501243">err</span>&nbsp;<span class="op" id="7501247">:=</span>&nbsp;<span class="ident" id="7501250">Listen</span><span class="op" id="7501256">(</span><span class="string" id="7501257">&#34;tcp&#34;</span><span class="op" id="7501262">,</span>&nbsp;<span class="ident" id="7501264">l</span><span class="op" id="7501265">.</span><span class="ident" id="7501266">Addr</span><span class="op" id="7501270">(</span><span class="op" id="7501271">)</span><span class="op" id="7501272">.</span><span class="ident" id="7501273">String</span><span class="op" id="7501279">(</span><span class="op" id="7501280">)</span><span class="op" id="7501281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7501284">if</span>&nbsp;<span class="ident" id="7501287">err</span>&nbsp;<span class="op" id="7501291">==</span>&nbsp;<span class="ident" id="7501294">nil</span>&nbsp;<span class="op" id="7501298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7501302">t</span><span class="op" id="7501303">.</span><span class="ident" id="7501304">Fatalf</span><span class="op" id="7501310">(</span><span class="string" id="7501311">&#34;second&nbsp;Listen&nbsp;%v:&nbsp;%v&#34;</span><span class="op" id="7501333">,</span>&nbsp;<span class="ident" id="7501335">l</span><span class="op" id="7501336">.</span><span class="ident" id="7501337">Addr</span><span class="op" id="7501341">(</span><span class="op" id="7501342">)</span><span class="op" id="7501343">,</span>&nbsp;<span class="ident" id="7501345">err</span><span class="op" id="7501348">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7501351">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7501354">if</span>&nbsp;<span class="ident" id="7501357">l1</span>&nbsp;<span class="op" id="7501360">!=</span>&nbsp;<span class="ident" id="7501363">nil</span>&nbsp;<span class="op" id="7501367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7501371">t</span><span class="op" id="7501372">.</span><span class="ident" id="7501373">Fatalf</span><span class="op" id="7501379">(</span><span class="string" id="7501380">&#34;Listen&nbsp;returned&nbsp;non-nil&nbsp;interface&nbsp;%T(%v)&nbsp;with&nbsp;err&nbsp;!=&nbsp;nil&#34;</span><span class="op" id="7501438">,</span>&nbsp;<span class="ident" id="7501440">l1</span><span class="op" id="7501442">,</span>&nbsp;<span class="ident" id="7501444">l1</span><span class="op" id="7501446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7501449">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7501453">//&nbsp;Make&nbsp;ListenPacket&nbsp;fail&nbsp;by&nbsp;relistening&nbsp;on&nbsp;the&nbsp;same&nbsp;address.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7501516">lp</span><span class="op" id="7501518">,</span>&nbsp;<span class="ident" id="7501520">err</span>&nbsp;<span class="op" id="7501524">:=</span>&nbsp;<span class="ident" id="7501527">ListenPacket</span><span class="op" id="7501539">(</span><span class="string" id="7501540">&#34;udp&#34;</span><span class="op" id="7501545">,</span>&nbsp;<span class="string" id="7501547">&#34;127.0.0.1:0&#34;</span><span class="op" id="7501560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7501563">if</span>&nbsp;<span class="ident" id="7501566">err</span>&nbsp;<span class="op" id="7501570">!=</span>&nbsp;<span class="ident" id="7501573">nil</span>&nbsp;<span class="op" id="7501577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7501581">t</span><span class="op" id="7501582">.</span><span class="ident" id="7501583">Fatalf</span><span class="op" id="7501589">(</span><span class="string" id="7501590">&#34;Listen&nbsp;127.0.0.1:0:&nbsp;%v&#34;</span><span class="op" id="7501614">,</span>&nbsp;<span class="ident" id="7501616">err</span><span class="op" id="7501619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7501622">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7501625">defer</span>&nbsp;<span class="ident" id="7501631">lp</span><span class="op" id="7501633">.</span><span class="ident" id="7501634">Close</span><span class="op" id="7501639">(</span><span class="op" id="7501640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7501643">lp1</span><span class="op" id="7501646">,</span>&nbsp;<span class="ident" id="7501648">err</span>&nbsp;<span class="op" id="7501652">:=</span>&nbsp;<span class="ident" id="7501655">ListenPacket</span><span class="op" id="7501667">(</span><span class="string" id="7501668">&#34;udp&#34;</span><span class="op" id="7501673">,</span>&nbsp;<span class="ident" id="7501675">lp</span><span class="op" id="7501677">.</span><span class="ident" id="7501678">LocalAddr</span><span class="op" id="7501687">(</span><span class="op" id="7501688">)</span><span class="op" id="7501689">.</span><span class="ident" id="7501690">String</span><span class="op" id="7501696">(</span><span class="op" id="7501697">)</span><span class="op" id="7501698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7501701">if</span>&nbsp;<span class="ident" id="7501704">err</span>&nbsp;<span class="op" id="7501708">==</span>&nbsp;<span class="ident" id="7501711">nil</span>&nbsp;<span class="op" id="7501715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7501719">t</span><span class="op" id="7501720">.</span><span class="ident" id="7501721">Fatalf</span><span class="op" id="7501727">(</span><span class="string" id="7501728">&#34;second&nbsp;Listen&nbsp;%v:&nbsp;%v&#34;</span><span class="op" id="7501750">,</span>&nbsp;<span class="ident" id="7501752">lp</span><span class="op" id="7501754">.</span><span class="ident" id="7501755">LocalAddr</span><span class="op" id="7501764">(</span><span class="op" id="7501765">)</span><span class="op" id="7501766">,</span>&nbsp;<span class="ident" id="7501768">err</span><span class="op" id="7501771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7501774">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7501777">if</span>&nbsp;<span class="ident" id="7501780">lp1</span>&nbsp;<span class="op" id="7501784">!=</span>&nbsp;<span class="ident" id="7501787">nil</span>&nbsp;<span class="op" id="7501791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7501795">t</span><span class="op" id="7501796">.</span><span class="ident" id="7501797">Fatalf</span><span class="op" id="7501803">(</span><span class="string" id="7501804">&#34;ListenPacket&nbsp;returned&nbsp;non-nil&nbsp;interface&nbsp;%T(%v)&nbsp;with&nbsp;err&nbsp;!=&nbsp;nil&#34;</span><span class="op" id="7501868">,</span>&nbsp;<span class="ident" id="7501870">lp1</span><span class="op" id="7501873">,</span>&nbsp;<span class="ident" id="7501875">lp1</span><span class="op" id="7501878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7501881">}</span><br>
<span class="lineno"></span><span class="op" id="7501883">}</span>
</div>
</body>
</html>
