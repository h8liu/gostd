<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/internal</h2>
<ul>
<li><a href="/gostd/net/http/internal/chunked.go.html">chunked.go</a></li>
<li><a href="/gostd/net/http/internal/chunked_test.go.html" class="current">chunked_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7053832">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7053887">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7053941">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7053992">package</span>&nbsp;<span class="ident" id="7054000">internal</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7054010">import</span>&nbsp;<span class="op" id="7054017">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7054020">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7054029">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7054038">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7054045">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7054051">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7054064">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7054075">&#34;testing&#34;</span><br>
<span class="lineno">15</span><span class="op" id="7054085">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7054088">func</span>&nbsp;<span class="ident" id="7054093">TestChunk</span><span class="op" id="7054102">(</span><span class="ident" id="7054103">t</span>&nbsp;<span class="op" id="7054105">*</span><span class="ident" id="7054106">testing</span><span class="op" id="7054113">.</span><span class="ident" id="7054114">T</span><span class="op" id="7054115">)</span>&nbsp;<span class="op" id="7054117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7054120">var</span>&nbsp;<span class="ident" id="7054124">b</span>&nbsp;<span class="ident" id="7054126">bytes</span><span class="op" id="7054131">.</span><span class="ident" id="7054132">Buffer</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7054141">w</span>&nbsp;<span class="op" id="7054143">:=</span>&nbsp;<span class="ident" id="7054146">NewChunkedWriter</span><span class="op" id="7054162">(</span><span class="op" id="7054163">&amp;</span><span class="ident" id="7054164">b</span><span class="op" id="7054165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7054168">const</span>&nbsp;<span class="ident" id="7054174">chunk1</span>&nbsp;<span class="op" id="7054181">=</span>&nbsp;<span class="string" id="7054183">&#34;hello,&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7054194">const</span>&nbsp;<span class="ident" id="7054200">chunk2</span>&nbsp;<span class="op" id="7054207">=</span>&nbsp;<span class="string" id="7054209">&#34;world!&nbsp;0123456789abcdef&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7054236">w</span><span class="op" id="7054237">.</span><span class="ident" id="7054238">Write</span><span class="op" id="7054243">(</span><span class="op" id="7054244">[</span><span class="op" id="7054245">]</span><span class="builtintype" id="7054246">byte</span><span class="op" id="7054250">(</span><span class="ident" id="7054251">chunk1</span><span class="op" id="7054257">)</span><span class="op" id="7054258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7054261">w</span><span class="op" id="7054262">.</span><span class="ident" id="7054263">Write</span><span class="op" id="7054268">(</span><span class="op" id="7054269">[</span><span class="op" id="7054270">]</span><span class="builtintype" id="7054271">byte</span><span class="op" id="7054275">(</span><span class="ident" id="7054276">chunk2</span><span class="op" id="7054282">)</span><span class="op" id="7054283">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7054286">w</span><span class="op" id="7054287">.</span><span class="ident" id="7054288">Close</span><span class="op" id="7054293">(</span><span class="op" id="7054294">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7054298">if</span>&nbsp;<span class="ident" id="7054301">g</span><span class="op" id="7054302">,</span>&nbsp;<span class="ident" id="7054304">e</span>&nbsp;<span class="op" id="7054306">:=</span>&nbsp;<span class="ident" id="7054309">b</span><span class="op" id="7054310">.</span><span class="ident" id="7054311">String</span><span class="op" id="7054317">(</span><span class="op" id="7054318">)</span><span class="op" id="7054319">,</span>&nbsp;<span class="string" id="7054321">&#34;7\r\nhello,&nbsp;\r\n17\r\nworld!&nbsp;0123456789abcdef\r\n0\r\n&#34;</span><span class="op" id="7054377">;</span>&nbsp;<span class="ident" id="7054379">g</span>&nbsp;<span class="op" id="7054381">!=</span>&nbsp;<span class="ident" id="7054384">e</span>&nbsp;<span class="op" id="7054386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7054390">t</span><span class="op" id="7054391">.</span><span class="ident" id="7054392">Fatalf</span><span class="op" id="7054398">(</span><span class="string" id="7054399">&#34;chunk&nbsp;writer&nbsp;wrote&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7054431">,</span>&nbsp;<span class="ident" id="7054433">g</span><span class="op" id="7054434">,</span>&nbsp;<span class="ident" id="7054436">e</span><span class="op" id="7054437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7054440">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7054444">r</span>&nbsp;<span class="op" id="7054446">:=</span>&nbsp;<span class="ident" id="7054449">NewChunkedReader</span><span class="op" id="7054465">(</span><span class="op" id="7054466">&amp;</span><span class="ident" id="7054467">b</span><span class="op" id="7054468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7054471">data</span><span class="op" id="7054475">,</span>&nbsp;<span class="ident" id="7054477">err</span>&nbsp;<span class="op" id="7054481">:=</span>&nbsp;<span class="ident" id="7054484">ioutil</span><span class="op" id="7054490">.</span><span class="ident" id="7054491">ReadAll</span><span class="op" id="7054498">(</span><span class="ident" id="7054499">r</span><span class="op" id="7054500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7054503">if</span>&nbsp;<span class="ident" id="7054506">err</span>&nbsp;<span class="op" id="7054510">!=</span>&nbsp;<span class="builtintype" id="7054513">nil</span>&nbsp;<span class="op" id="7054517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7054521">t</span><span class="op" id="7054522">.</span><span class="ident" id="7054523">Logf</span><span class="op" id="7054527">(</span><span class="string" id="7054528">`data:&nbsp;&#34;%s&#34;`</span><span class="op" id="7054540">,</span>&nbsp;<span class="ident" id="7054542">data</span><span class="op" id="7054546">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7054550">t</span><span class="op" id="7054551">.</span><span class="ident" id="7054552">Fatalf</span><span class="op" id="7054558">(</span><span class="string" id="7054559">&#34;ReadAll&nbsp;from&nbsp;reader:&nbsp;%v&#34;</span><span class="op" id="7054584">,</span>&nbsp;<span class="ident" id="7054586">err</span><span class="op" id="7054589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7054592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7054595">if</span>&nbsp;<span class="ident" id="7054598">g</span><span class="op" id="7054599">,</span>&nbsp;<span class="ident" id="7054601">e</span>&nbsp;<span class="op" id="7054603">:=</span>&nbsp;<span class="builtintype" id="7054606">string</span><span class="op" id="7054612">(</span><span class="ident" id="7054613">data</span><span class="op" id="7054617">)</span><span class="op" id="7054618">,</span>&nbsp;<span class="ident" id="7054620">chunk1</span><span class="op" id="7054626">+</span><span class="ident" id="7054627">chunk2</span><span class="op" id="7054633">;</span>&nbsp;<span class="ident" id="7054635">g</span>&nbsp;<span class="op" id="7054637">!=</span>&nbsp;<span class="ident" id="7054640">e</span>&nbsp;<span class="op" id="7054642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7054646">t</span><span class="op" id="7054647">.</span><span class="ident" id="7054648">Errorf</span><span class="op" id="7054654">(</span><span class="string" id="7054655">&#34;chunk&nbsp;reader&nbsp;read&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7054686">,</span>&nbsp;<span class="ident" id="7054688">g</span><span class="op" id="7054689">,</span>&nbsp;<span class="ident" id="7054691">e</span><span class="op" id="7054692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7054695">}</span><br>
<span class="lineno">40</span><span class="op" id="7054697">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7054700">func</span>&nbsp;<span class="ident" id="7054705">TestChunkReadMultiple</span><span class="op" id="7054726">(</span><span class="ident" id="7054727">t</span>&nbsp;<span class="op" id="7054729">*</span><span class="ident" id="7054730">testing</span><span class="op" id="7054737">.</span><span class="ident" id="7054738">T</span><span class="op" id="7054739">)</span>&nbsp;<span class="op" id="7054741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7054744">//&nbsp;Bunch&nbsp;of&nbsp;small&nbsp;chunks,&nbsp;all&nbsp;read&nbsp;together.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7054790">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7054794">var</span>&nbsp;<span class="ident" id="7054798">b</span>&nbsp;<span class="ident" id="7054800">bytes</span><span class="op" id="7054805">.</span><span class="ident" id="7054806">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7054815">w</span>&nbsp;<span class="op" id="7054817">:=</span>&nbsp;<span class="ident" id="7054820">NewChunkedWriter</span><span class="op" id="7054836">(</span><span class="op" id="7054837">&amp;</span><span class="ident" id="7054838">b</span><span class="op" id="7054839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7054843">w</span><span class="op" id="7054844">.</span><span class="ident" id="7054845">Write</span><span class="op" id="7054850">(</span><span class="op" id="7054851">[</span><span class="op" id="7054852">]</span><span class="builtintype" id="7054853">byte</span><span class="op" id="7054857">(</span><span class="string" id="7054858">&#34;foo&#34;</span><span class="op" id="7054863">)</span><span class="op" id="7054864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7054868">w</span><span class="op" id="7054869">.</span><span class="ident" id="7054870">Write</span><span class="op" id="7054875">(</span><span class="op" id="7054876">[</span><span class="op" id="7054877">]</span><span class="builtintype" id="7054878">byte</span><span class="op" id="7054882">(</span><span class="string" id="7054883">&#34;bar&#34;</span><span class="op" id="7054888">)</span><span class="op" id="7054889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7054893">w</span><span class="op" id="7054894">.</span><span class="ident" id="7054895">Close</span><span class="op" id="7054900">(</span><span class="op" id="7054901">)</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7054906">r</span>&nbsp;<span class="op" id="7054908">:=</span>&nbsp;<span class="ident" id="7054911">NewChunkedReader</span><span class="op" id="7054927">(</span><span class="op" id="7054928">&amp;</span><span class="ident" id="7054929">b</span><span class="op" id="7054930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7054934">buf</span>&nbsp;<span class="op" id="7054938">:=</span>&nbsp;<span class="builtinfunc" id="7054941">make</span><span class="op" id="7054945">(</span><span class="op" id="7054946">[</span><span class="op" id="7054947">]</span><span class="builtintype" id="7054948">byte</span><span class="op" id="7054952">,</span>&nbsp;<span class="num" id="7054954">10</span><span class="op" id="7054956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7054960">n</span><span class="op" id="7054961">,</span>&nbsp;<span class="ident" id="7054963">err</span>&nbsp;<span class="op" id="7054967">:=</span>&nbsp;<span class="ident" id="7054970">r</span><span class="op" id="7054971">.</span><span class="ident" id="7054972">Read</span><span class="op" id="7054976">(</span><span class="ident" id="7054977">buf</span><span class="op" id="7054980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7054984">if</span>&nbsp;<span class="ident" id="7054987">n</span>&nbsp;<span class="op" id="7054989">!=</span>&nbsp;<span class="num" id="7054992">6</span>&nbsp;<span class="op" id="7054994">||</span>&nbsp;<span class="ident" id="7054997">err</span>&nbsp;<span class="op" id="7055001">!=</span>&nbsp;<span class="ident" id="7055004">io</span><span class="op" id="7055006">.</span><span class="ident" id="7055007">EOF</span>&nbsp;<span class="op" id="7055011">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7055016">t</span><span class="op" id="7055017">.</span><span class="ident" id="7055018">Errorf</span><span class="op" id="7055024">(</span><span class="string" id="7055025">&#34;Read&nbsp;=&nbsp;%d,&nbsp;%v;&nbsp;want&nbsp;6,&nbsp;EOF&#34;</span><span class="op" id="7055053">,</span>&nbsp;<span class="ident" id="7055055">n</span><span class="op" id="7055056">,</span>&nbsp;<span class="ident" id="7055058">err</span><span class="op" id="7055061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7055065">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7055069">buf</span>&nbsp;<span class="op" id="7055073">=</span>&nbsp;<span class="ident" id="7055075">buf</span><span class="op" id="7055078">[</span><span class="op" id="7055079">:</span><span class="ident" id="7055080">n</span><span class="op" id="7055081">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7055085">if</span>&nbsp;<span class="builtintype" id="7055088">string</span><span class="op" id="7055094">(</span><span class="ident" id="7055095">buf</span><span class="op" id="7055098">)</span>&nbsp;<span class="op" id="7055100">!=</span>&nbsp;<span class="string" id="7055103">&#34;foobar&#34;</span>&nbsp;<span class="op" id="7055112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7055117">t</span><span class="op" id="7055118">.</span><span class="ident" id="7055119">Errorf</span><span class="op" id="7055125">(</span><span class="string" id="7055126">&#34;Read&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7055146">,</span>&nbsp;<span class="ident" id="7055148">buf</span><span class="op" id="7055151">,</span>&nbsp;<span class="string" id="7055153">&#34;foobar&#34;</span><span class="op" id="7055161">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7055165">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7055168">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7055172">//&nbsp;One&nbsp;big&nbsp;chunk&nbsp;followed&nbsp;by&nbsp;a&nbsp;little&nbsp;chunk,&nbsp;but&nbsp;the&nbsp;small&nbsp;bufio.Reader&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7055250">//&nbsp;should&nbsp;prevent&nbsp;the&nbsp;second&nbsp;chunk&nbsp;header&nbsp;from&nbsp;being&nbsp;read.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7055310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7055314">var</span>&nbsp;<span class="ident" id="7055318">b</span>&nbsp;<span class="ident" id="7055320">bytes</span><span class="op" id="7055325">.</span><span class="ident" id="7055326">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7055335">w</span>&nbsp;<span class="op" id="7055337">:=</span>&nbsp;<span class="ident" id="7055340">NewChunkedWriter</span><span class="op" id="7055356">(</span><span class="op" id="7055357">&amp;</span><span class="ident" id="7055358">b</span><span class="op" id="7055359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7055363">//&nbsp;fillBufChunk&nbsp;is&nbsp;11&nbsp;bytes&nbsp;+&nbsp;3&nbsp;bytes&nbsp;header&nbsp;+&nbsp;2&nbsp;bytes&nbsp;footer&nbsp;=&nbsp;16&nbsp;bytes,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7055439">//&nbsp;the&nbsp;same&nbsp;as&nbsp;the&nbsp;bufio&nbsp;ReaderSize&nbsp;below&nbsp;(the&nbsp;minimum),&nbsp;so&nbsp;even</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7055506">//&nbsp;though&nbsp;we&#39;re&nbsp;going&nbsp;to&nbsp;try&nbsp;to&nbsp;Read&nbsp;with&nbsp;a&nbsp;buffer&nbsp;larger&nbsp;enough&nbsp;to&nbsp;also</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7055581">//&nbsp;receive&nbsp;&#34;foo&#34;,&nbsp;the&nbsp;second&nbsp;chunk&nbsp;header&nbsp;won&#39;t&nbsp;be&nbsp;read&nbsp;yet.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7055644">const</span>&nbsp;<span class="ident" id="7055650">fillBufChunk</span>&nbsp;<span class="op" id="7055663">=</span>&nbsp;<span class="string" id="7055665">&#34;0123456789a&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7055681">const</span>&nbsp;<span class="ident" id="7055687">shortChunk</span>&nbsp;<span class="op" id="7055698">=</span>&nbsp;<span class="string" id="7055700">&#34;foo&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7055708">w</span><span class="op" id="7055709">.</span><span class="ident" id="7055710">Write</span><span class="op" id="7055715">(</span><span class="op" id="7055716">[</span><span class="op" id="7055717">]</span><span class="builtintype" id="7055718">byte</span><span class="op" id="7055722">(</span><span class="ident" id="7055723">fillBufChunk</span><span class="op" id="7055735">)</span><span class="op" id="7055736">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7055740">w</span><span class="op" id="7055741">.</span><span class="ident" id="7055742">Write</span><span class="op" id="7055747">(</span><span class="op" id="7055748">[</span><span class="op" id="7055749">]</span><span class="builtintype" id="7055750">byte</span><span class="op" id="7055754">(</span><span class="ident" id="7055755">shortChunk</span><span class="op" id="7055765">)</span><span class="op" id="7055766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7055770">w</span><span class="op" id="7055771">.</span><span class="ident" id="7055772">Close</span><span class="op" id="7055777">(</span><span class="op" id="7055778">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7055783">r</span>&nbsp;<span class="op" id="7055785">:=</span>&nbsp;<span class="ident" id="7055788">NewChunkedReader</span><span class="op" id="7055804">(</span><span class="ident" id="7055805">bufio</span><span class="op" id="7055810">.</span><span class="ident" id="7055811">NewReaderSize</span><span class="op" id="7055824">(</span><span class="op" id="7055825">&amp;</span><span class="ident" id="7055826">b</span><span class="op" id="7055827">,</span>&nbsp;<span class="num" id="7055829">16</span><span class="op" id="7055831">)</span><span class="op" id="7055832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7055836">buf</span>&nbsp;<span class="op" id="7055840">:=</span>&nbsp;<span class="builtinfunc" id="7055843">make</span><span class="op" id="7055847">(</span><span class="op" id="7055848">[</span><span class="op" id="7055849">]</span><span class="builtintype" id="7055850">byte</span><span class="op" id="7055854">,</span>&nbsp;<span class="builtinfunc" id="7055856">len</span><span class="op" id="7055859">(</span><span class="ident" id="7055860">fillBufChunk</span><span class="op" id="7055872">)</span><span class="op" id="7055873">+</span><span class="builtinfunc" id="7055874">len</span><span class="op" id="7055877">(</span><span class="ident" id="7055878">shortChunk</span><span class="op" id="7055888">)</span><span class="op" id="7055889">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7055893">n</span><span class="op" id="7055894">,</span>&nbsp;<span class="ident" id="7055896">err</span>&nbsp;<span class="op" id="7055900">:=</span>&nbsp;<span class="ident" id="7055903">r</span><span class="op" id="7055904">.</span><span class="ident" id="7055905">Read</span><span class="op" id="7055909">(</span><span class="ident" id="7055910">buf</span><span class="op" id="7055913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7055917">if</span>&nbsp;<span class="ident" id="7055920">n</span>&nbsp;<span class="op" id="7055922">!=</span>&nbsp;<span class="builtinfunc" id="7055925">len</span><span class="op" id="7055928">(</span><span class="ident" id="7055929">fillBufChunk</span><span class="op" id="7055941">)</span>&nbsp;<span class="op" id="7055943">||</span>&nbsp;<span class="ident" id="7055946">err</span>&nbsp;<span class="op" id="7055950">!=</span>&nbsp;<span class="builtintype" id="7055953">nil</span>&nbsp;<span class="op" id="7055957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7055962">t</span><span class="op" id="7055963">.</span><span class="ident" id="7055964">Errorf</span><span class="op" id="7055970">(</span><span class="string" id="7055971">&#34;Read&nbsp;=&nbsp;%d,&nbsp;%v;&nbsp;want&nbsp;%d,&nbsp;nil&#34;</span><span class="op" id="7056000">,</span>&nbsp;<span class="ident" id="7056002">n</span><span class="op" id="7056003">,</span>&nbsp;<span class="ident" id="7056005">err</span><span class="op" id="7056008">,</span>&nbsp;<span class="builtinfunc" id="7056010">len</span><span class="op" id="7056013">(</span><span class="ident" id="7056014">fillBufChunk</span><span class="op" id="7056026">)</span><span class="op" id="7056027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7056031">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7056035">buf</span>&nbsp;<span class="op" id="7056039">=</span>&nbsp;<span class="ident" id="7056041">buf</span><span class="op" id="7056044">[</span><span class="op" id="7056045">:</span><span class="ident" id="7056046">n</span><span class="op" id="7056047">]</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7056051">if</span>&nbsp;<span class="builtintype" id="7056054">string</span><span class="op" id="7056060">(</span><span class="ident" id="7056061">buf</span><span class="op" id="7056064">)</span>&nbsp;<span class="op" id="7056066">!=</span>&nbsp;<span class="ident" id="7056069">fillBufChunk</span>&nbsp;<span class="op" id="7056082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7056087">t</span><span class="op" id="7056088">.</span><span class="ident" id="7056089">Errorf</span><span class="op" id="7056095">(</span><span class="string" id="7056096">&#34;Read&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7056116">,</span>&nbsp;<span class="ident" id="7056118">buf</span><span class="op" id="7056121">,</span>&nbsp;<span class="ident" id="7056123">fillBufChunk</span><span class="op" id="7056135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7056139">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7056144">n</span><span class="op" id="7056145">,</span>&nbsp;<span class="ident" id="7056147">err</span>&nbsp;<span class="op" id="7056151">=</span>&nbsp;<span class="ident" id="7056153">r</span><span class="op" id="7056154">.</span><span class="ident" id="7056155">Read</span><span class="op" id="7056159">(</span><span class="ident" id="7056160">buf</span><span class="op" id="7056163">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7056167">if</span>&nbsp;<span class="ident" id="7056170">n</span>&nbsp;<span class="op" id="7056172">!=</span>&nbsp;<span class="builtinfunc" id="7056175">len</span><span class="op" id="7056178">(</span><span class="ident" id="7056179">shortChunk</span><span class="op" id="7056189">)</span>&nbsp;<span class="op" id="7056191">||</span>&nbsp;<span class="ident" id="7056194">err</span>&nbsp;<span class="op" id="7056198">!=</span>&nbsp;<span class="ident" id="7056201">io</span><span class="op" id="7056203">.</span><span class="ident" id="7056204">EOF</span>&nbsp;<span class="op" id="7056208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7056213">t</span><span class="op" id="7056214">.</span><span class="ident" id="7056215">Errorf</span><span class="op" id="7056221">(</span><span class="string" id="7056222">&#34;Read&nbsp;=&nbsp;%d,&nbsp;%v;&nbsp;want&nbsp;%d,&nbsp;EOF&#34;</span><span class="op" id="7056251">,</span>&nbsp;<span class="ident" id="7056253">n</span><span class="op" id="7056254">,</span>&nbsp;<span class="ident" id="7056256">err</span><span class="op" id="7056259">,</span>&nbsp;<span class="builtinfunc" id="7056261">len</span><span class="op" id="7056264">(</span><span class="ident" id="7056265">shortChunk</span><span class="op" id="7056275">)</span><span class="op" id="7056276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7056280">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7056283">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7056287">//&nbsp;And&nbsp;test&nbsp;that&nbsp;we&nbsp;see&nbsp;an&nbsp;EOF&nbsp;chunk,&nbsp;even&nbsp;though&nbsp;our&nbsp;buffer&nbsp;is&nbsp;already&nbsp;full:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7056366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7056370">r</span>&nbsp;<span class="op" id="7056372">:=</span>&nbsp;<span class="ident" id="7056375">NewChunkedReader</span><span class="op" id="7056391">(</span><span class="ident" id="7056392">bufio</span><span class="op" id="7056397">.</span><span class="ident" id="7056398">NewReader</span><span class="op" id="7056407">(</span><span class="ident" id="7056408">strings</span><span class="op" id="7056415">.</span><span class="ident" id="7056416">NewReader</span><span class="op" id="7056425">(</span><span class="string" id="7056426">&#34;3\r\nfoo\r\n0\r\n&#34;</span><span class="op" id="7056445">)</span><span class="op" id="7056446">)</span><span class="op" id="7056447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7056451">buf</span>&nbsp;<span class="op" id="7056455">:=</span>&nbsp;<span class="builtinfunc" id="7056458">make</span><span class="op" id="7056462">(</span><span class="op" id="7056463">[</span><span class="op" id="7056464">]</span><span class="builtintype" id="7056465">byte</span><span class="op" id="7056469">,</span>&nbsp;<span class="num" id="7056471">3</span><span class="op" id="7056472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7056476">n</span><span class="op" id="7056477">,</span>&nbsp;<span class="ident" id="7056479">err</span>&nbsp;<span class="op" id="7056483">:=</span>&nbsp;<span class="ident" id="7056486">r</span><span class="op" id="7056487">.</span><span class="ident" id="7056488">Read</span><span class="op" id="7056492">(</span><span class="ident" id="7056493">buf</span><span class="op" id="7056496">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7056500">if</span>&nbsp;<span class="ident" id="7056503">n</span>&nbsp;<span class="op" id="7056505">!=</span>&nbsp;<span class="num" id="7056508">3</span>&nbsp;<span class="op" id="7056510">||</span>&nbsp;<span class="ident" id="7056513">err</span>&nbsp;<span class="op" id="7056517">!=</span>&nbsp;<span class="ident" id="7056520">io</span><span class="op" id="7056522">.</span><span class="ident" id="7056523">EOF</span>&nbsp;<span class="op" id="7056527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7056532">t</span><span class="op" id="7056533">.</span><span class="ident" id="7056534">Errorf</span><span class="op" id="7056540">(</span><span class="string" id="7056541">&#34;Read&nbsp;=&nbsp;%d,&nbsp;%v;&nbsp;want&nbsp;3,&nbsp;EOF&#34;</span><span class="op" id="7056569">,</span>&nbsp;<span class="ident" id="7056571">n</span><span class="op" id="7056572">,</span>&nbsp;<span class="ident" id="7056574">err</span><span class="op" id="7056577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7056581">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7056585">if</span>&nbsp;<span class="builtintype" id="7056588">string</span><span class="op" id="7056594">(</span><span class="ident" id="7056595">buf</span><span class="op" id="7056598">)</span>&nbsp;<span class="op" id="7056600">!=</span>&nbsp;<span class="string" id="7056603">&#34;foo&#34;</span>&nbsp;<span class="op" id="7056609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7056614">t</span><span class="op" id="7056615">.</span><span class="ident" id="7056616">Errorf</span><span class="op" id="7056622">(</span><span class="string" id="7056623">&#34;buf&nbsp;=&nbsp;%q;&nbsp;want&nbsp;foo&#34;</span><span class="op" id="7056643">,</span>&nbsp;<span class="ident" id="7056645">buf</span><span class="op" id="7056648">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7056652">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7056655">}</span><br>
<span class="lineno"></span><span class="op" id="7056657">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7056660">func</span>&nbsp;<span class="ident" id="7056665">TestChunkReaderAllocs</span><span class="op" id="7056686">(</span><span class="ident" id="7056687">t</span>&nbsp;<span class="op" id="7056689">*</span><span class="ident" id="7056690">testing</span><span class="op" id="7056697">.</span><span class="ident" id="7056698">T</span><span class="op" id="7056699">)</span>&nbsp;<span class="op" id="7056701">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7056704">if</span>&nbsp;<span class="ident" id="7056707">testing</span><span class="op" id="7056714">.</span><span class="ident" id="7056715">Short</span><span class="op" id="7056720">(</span><span class="op" id="7056721">)</span>&nbsp;<span class="op" id="7056723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7056727">t</span><span class="op" id="7056728">.</span><span class="ident" id="7056729">Skip</span><span class="op" id="7056733">(</span><span class="string" id="7056734">&#34;skipping&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="7056758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7056761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7056764">var</span>&nbsp;<span class="ident" id="7056768">buf</span>&nbsp;<span class="ident" id="7056772">bytes</span><span class="op" id="7056777">.</span><span class="ident" id="7056778">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7056786">w</span>&nbsp;<span class="op" id="7056788">:=</span>&nbsp;<span class="ident" id="7056791">NewChunkedWriter</span><span class="op" id="7056807">(</span><span class="op" id="7056808">&amp;</span><span class="ident" id="7056809">buf</span><span class="op" id="7056812">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7056815">a</span><span class="op" id="7056816">,</span>&nbsp;<span class="ident" id="7056818">b</span><span class="op" id="7056819">,</span>&nbsp;<span class="ident" id="7056821">c</span>&nbsp;<span class="op" id="7056823">:=</span>&nbsp;<span class="op" id="7056826">[</span><span class="op" id="7056827">]</span><span class="builtintype" id="7056828">byte</span><span class="op" id="7056832">(</span><span class="string" id="7056833">&#34;aaaaaa&#34;</span><span class="op" id="7056841">)</span><span class="op" id="7056842">,</span>&nbsp;<span class="op" id="7056844">[</span><span class="op" id="7056845">]</span><span class="builtintype" id="7056846">byte</span><span class="op" id="7056850">(</span><span class="string" id="7056851">&#34;bbbbbbbbbbbb&#34;</span><span class="op" id="7056865">)</span><span class="op" id="7056866">,</span>&nbsp;<span class="op" id="7056868">[</span><span class="op" id="7056869">]</span><span class="builtintype" id="7056870">byte</span><span class="op" id="7056874">(</span><span class="string" id="7056875">&#34;cccccccccccccccccccccccc&#34;</span><span class="op" id="7056901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7056904">w</span><span class="op" id="7056905">.</span><span class="ident" id="7056906">Write</span><span class="op" id="7056911">(</span><span class="ident" id="7056912">a</span><span class="op" id="7056913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7056916">w</span><span class="op" id="7056917">.</span><span class="ident" id="7056918">Write</span><span class="op" id="7056923">(</span><span class="ident" id="7056924">b</span><span class="op" id="7056925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7056928">w</span><span class="op" id="7056929">.</span><span class="ident" id="7056930">Write</span><span class="op" id="7056935">(</span><span class="ident" id="7056936">c</span><span class="op" id="7056937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7056940">w</span><span class="op" id="7056941">.</span><span class="ident" id="7056942">Close</span><span class="op" id="7056947">(</span><span class="op" id="7056948">)</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7056952">readBuf</span>&nbsp;<span class="op" id="7056960">:=</span>&nbsp;<span class="builtinfunc" id="7056963">make</span><span class="op" id="7056967">(</span><span class="op" id="7056968">[</span><span class="op" id="7056969">]</span><span class="builtintype" id="7056970">byte</span><span class="op" id="7056974">,</span>&nbsp;<span class="builtinfunc" id="7056976">len</span><span class="op" id="7056979">(</span><span class="ident" id="7056980">a</span><span class="op" id="7056981">)</span><span class="op" id="7056982">+</span><span class="builtinfunc" id="7056983">len</span><span class="op" id="7056986">(</span><span class="ident" id="7056987">b</span><span class="op" id="7056988">)</span><span class="op" id="7056989">+</span><span class="builtinfunc" id="7056990">len</span><span class="op" id="7056993">(</span><span class="ident" id="7056994">c</span><span class="op" id="7056995">)</span><span class="op" id="7056996">+</span><span class="num" id="7056997">1</span><span class="op" id="7056998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7057001">byter</span>&nbsp;<span class="op" id="7057007">:=</span>&nbsp;<span class="ident" id="7057010">bytes</span><span class="op" id="7057015">.</span><span class="ident" id="7057016">NewReader</span><span class="op" id="7057025">(</span><span class="ident" id="7057026">buf</span><span class="op" id="7057029">.</span><span class="ident" id="7057030">Bytes</span><span class="op" id="7057035">(</span><span class="op" id="7057036">)</span><span class="op" id="7057037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7057040">bufr</span>&nbsp;<span class="op" id="7057045">:=</span>&nbsp;<span class="ident" id="7057048">bufio</span><span class="op" id="7057053">.</span><span class="ident" id="7057054">NewReader</span><span class="op" id="7057063">(</span><span class="ident" id="7057064">byter</span><span class="op" id="7057069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7057072">mallocs</span>&nbsp;<span class="op" id="7057080">:=</span>&nbsp;<span class="ident" id="7057083">testing</span><span class="op" id="7057090">.</span><span class="ident" id="7057091">AllocsPerRun</span><span class="op" id="7057103">(</span><span class="num" id="7057104">100</span><span class="op" id="7057107">,</span>&nbsp;<span class="keyword" id="7057109">func</span><span class="op" id="7057113">(</span><span class="op" id="7057114">)</span>&nbsp;<span class="op" id="7057116">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7057120">byter</span><span class="op" id="7057125">.</span><span class="ident" id="7057126">Seek</span><span class="op" id="7057130">(</span><span class="num" id="7057131">0</span><span class="op" id="7057132">,</span>&nbsp;<span class="num" id="7057134">0</span><span class="op" id="7057135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7057139">bufr</span><span class="op" id="7057143">.</span><span class="ident" id="7057144">Reset</span><span class="op" id="7057149">(</span><span class="ident" id="7057150">byter</span><span class="op" id="7057155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7057159">r</span>&nbsp;<span class="op" id="7057161">:=</span>&nbsp;<span class="ident" id="7057164">NewChunkedReader</span><span class="op" id="7057180">(</span><span class="ident" id="7057181">bufr</span><span class="op" id="7057185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7057189">n</span><span class="op" id="7057190">,</span>&nbsp;<span class="ident" id="7057192">err</span>&nbsp;<span class="op" id="7057196">:=</span>&nbsp;<span class="ident" id="7057199">io</span><span class="op" id="7057201">.</span><span class="ident" id="7057202">ReadFull</span><span class="op" id="7057210">(</span><span class="ident" id="7057211">r</span><span class="op" id="7057212">,</span>&nbsp;<span class="ident" id="7057214">readBuf</span><span class="op" id="7057221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7057225">if</span>&nbsp;<span class="ident" id="7057228">n</span>&nbsp;<span class="op" id="7057230">!=</span>&nbsp;<span class="builtinfunc" id="7057233">len</span><span class="op" id="7057236">(</span><span class="ident" id="7057237">readBuf</span><span class="op" id="7057244">)</span><span class="op" id="7057245">-</span><span class="num" id="7057246">1</span>&nbsp;<span class="op" id="7057248">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7057253">t</span><span class="op" id="7057254">.</span><span class="ident" id="7057255">Fatalf</span><span class="op" id="7057261">(</span><span class="string" id="7057262">&#34;read&nbsp;%d&nbsp;bytes;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7057286">,</span>&nbsp;<span class="ident" id="7057288">n</span><span class="op" id="7057289">,</span>&nbsp;<span class="builtinfunc" id="7057291">len</span><span class="op" id="7057294">(</span><span class="ident" id="7057295">readBuf</span><span class="op" id="7057302">)</span><span class="op" id="7057303">-</span><span class="num" id="7057304">1</span><span class="op" id="7057305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7057309">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7057313">if</span>&nbsp;<span class="ident" id="7057316">err</span>&nbsp;<span class="op" id="7057320">!=</span>&nbsp;<span class="ident" id="7057323">io</span><span class="op" id="7057325">.</span><span class="ident" id="7057326">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="7057343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7057348">t</span><span class="op" id="7057349">.</span><span class="ident" id="7057350">Fatalf</span><span class="op" id="7057356">(</span><span class="string" id="7057357">&#34;read&nbsp;error&nbsp;=&nbsp;%v;&nbsp;want&nbsp;ErrUnexpectedEOF&#34;</span><span class="op" id="7057397">,</span>&nbsp;<span class="ident" id="7057399">err</span><span class="op" id="7057402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7057406">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7057409">}</span><span class="op" id="7057410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7057413">if</span>&nbsp;<span class="ident" id="7057416">mallocs</span>&nbsp;<span class="op" id="7057424">&gt;</span>&nbsp;<span class="num" id="7057426">1.5</span>&nbsp;<span class="op" id="7057430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7057434">t</span><span class="op" id="7057435">.</span><span class="ident" id="7057436">Errorf</span><span class="op" id="7057442">(</span><span class="string" id="7057443">&#34;mallocs&nbsp;=&nbsp;%v;&nbsp;want&nbsp;1&#34;</span><span class="op" id="7057465">,</span>&nbsp;<span class="ident" id="7057467">mallocs</span><span class="op" id="7057474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7057477">}</span><br>
<span class="lineno"></span><span class="op" id="7057479">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="keyword" id="7057482">func</span>&nbsp;<span class="ident" id="7057487">TestParseHexUint</span><span class="op" id="7057503">(</span><span class="ident" id="7057504">t</span>&nbsp;<span class="op" id="7057506">*</span><span class="ident" id="7057507">testing</span><span class="op" id="7057514">.</span><span class="ident" id="7057515">T</span><span class="op" id="7057516">)</span>&nbsp;<span class="op" id="7057518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7057521">for</span>&nbsp;<span class="ident" id="7057525">i</span>&nbsp;<span class="op" id="7057527">:=</span>&nbsp;<span class="ident" id="7057530">uint64</span><span class="op" id="7057536">(</span><span class="num" id="7057537">0</span><span class="op" id="7057538">)</span><span class="op" id="7057539">;</span>&nbsp;<span class="ident" id="7057541">i</span>&nbsp;<span class="op" id="7057543">&lt;=</span>&nbsp;<span class="num" id="7057546">1234</span><span class="op" id="7057550">;</span>&nbsp;<span class="ident" id="7057552">i</span><span class="op" id="7057553">++</span>&nbsp;<span class="op" id="7057556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7057560">line</span>&nbsp;<span class="op" id="7057565">:=</span>&nbsp;<span class="op" id="7057568">[</span><span class="op" id="7057569">]</span><span class="builtintype" id="7057570">byte</span><span class="op" id="7057574">(</span><span class="ident" id="7057575">fmt</span><span class="op" id="7057578">.</span><span class="ident" id="7057579">Sprintf</span><span class="op" id="7057586">(</span><span class="string" id="7057587">&#34;%x&#34;</span><span class="op" id="7057591">,</span>&nbsp;<span class="ident" id="7057593">i</span><span class="op" id="7057594">)</span><span class="op" id="7057595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7057599">got</span><span class="op" id="7057602">,</span>&nbsp;<span class="ident" id="7057604">err</span>&nbsp;<span class="op" id="7057608">:=</span>&nbsp;<span class="ident" id="7057611">parseHexUint</span><span class="op" id="7057623">(</span><span class="ident" id="7057624">line</span><span class="op" id="7057628">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7057632">if</span>&nbsp;<span class="ident" id="7057635">err</span>&nbsp;<span class="op" id="7057639">!=</span>&nbsp;<span class="builtintype" id="7057642">nil</span>&nbsp;<span class="op" id="7057646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7057651">t</span><span class="op" id="7057652">.</span><span class="ident" id="7057653">Fatalf</span><span class="op" id="7057659">(</span><span class="string" id="7057660">&#34;on&nbsp;%d:&nbsp;%v&#34;</span><span class="op" id="7057671">,</span>&nbsp;<span class="ident" id="7057673">i</span><span class="op" id="7057674">,</span>&nbsp;<span class="ident" id="7057676">err</span><span class="op" id="7057679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7057683">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7057687">if</span>&nbsp;<span class="ident" id="7057690">got</span>&nbsp;<span class="op" id="7057694">!=</span>&nbsp;<span class="ident" id="7057697">i</span>&nbsp;<span class="op" id="7057699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7057704">t</span><span class="op" id="7057705">.</span><span class="ident" id="7057706">Errorf</span><span class="op" id="7057712">(</span><span class="string" id="7057713">&#34;for&nbsp;input&nbsp;%q&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7057741">,</span>&nbsp;<span class="ident" id="7057743">line</span><span class="op" id="7057747">,</span>&nbsp;<span class="ident" id="7057749">got</span><span class="op" id="7057752">,</span>&nbsp;<span class="ident" id="7057754">i</span><span class="op" id="7057755">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7057759">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7057762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7057765">_</span><span class="op" id="7057766">,</span>&nbsp;<span class="ident" id="7057768">err</span>&nbsp;<span class="op" id="7057772">:=</span>&nbsp;<span class="ident" id="7057775">parseHexUint</span><span class="op" id="7057787">(</span><span class="op" id="7057788">[</span><span class="op" id="7057789">]</span><span class="builtintype" id="7057790">byte</span><span class="op" id="7057794">(</span><span class="string" id="7057795">&#34;bogus&#34;</span><span class="op" id="7057802">)</span><span class="op" id="7057803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7057806">if</span>&nbsp;<span class="ident" id="7057809">err</span>&nbsp;<span class="op" id="7057813">==</span>&nbsp;<span class="builtintype" id="7057816">nil</span>&nbsp;<span class="op" id="7057820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7057824">t</span><span class="op" id="7057825">.</span><span class="ident" id="7057826">Error</span><span class="op" id="7057831">(</span><span class="string" id="7057832">&#34;expected&nbsp;error&nbsp;on&nbsp;bogus&nbsp;input&#34;</span><span class="op" id="7057863">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7057866">}</span><br>
<span class="lineno"></span><span class="op" id="7057868">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
