<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/aes</h2>
<ul>
<li><a href="/gostd/crypto/aes/aes_test.go.html">aes_test.go</a></li>
<li><a href="/gostd/crypto/aes/block.go.html">block.go</a></li>
<li><a href="/gostd/crypto/aes/cipher.go.html" class="current">cipher.go</a></li>
<li><a href="/gostd/crypto/aes/cipher_asm.go.html">cipher_asm.go</a></li>
<li><a href="/gostd/crypto/aes/const.go.html">const.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3439516">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3439571">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3439625">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3439676">package</span>&nbsp;<span class="ident" id="3439684">aes</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3439689">import</span>&nbsp;<span class="op" id="3439696">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3439699">&#34;crypto/cipher&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3439716">&#34;strconv&#34;</span><br>
<span class="lineno">10</span><span class="op" id="3439726">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3439729">//&nbsp;The&nbsp;AES&nbsp;block&nbsp;size&nbsp;in&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="3439761">const</span>&nbsp;<span class="ident" id="3439767">BlockSize</span>&nbsp;<span class="op" id="3439777">=</span>&nbsp;<span class="num" id="3439779">16</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="3439783">//&nbsp;A&nbsp;cipher&nbsp;is&nbsp;an&nbsp;instance&nbsp;of&nbsp;AES&nbsp;encryption&nbsp;using&nbsp;a&nbsp;particular&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="3439852">type</span>&nbsp;<span class="ident" id="3439857">aesCipher</span>&nbsp;<span class="keyword" id="3439867">struct</span>&nbsp;<span class="op" id="3439874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3439877">enc</span>&nbsp;<span class="op" id="3439881">[</span><span class="op" id="3439882">]</span><span class="builtintype" id="3439883">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3439891">dec</span>&nbsp;<span class="op" id="3439895">[</span><span class="op" id="3439896">]</span><span class="builtintype" id="3439897">uint32</span><br>
<span class="lineno"></span><span class="op" id="3439904">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="3439907">type</span>&nbsp;<span class="ident" id="3439912">KeySizeError</span>&nbsp;<span class="builtintype" id="3439925">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3439930">func</span>&nbsp;<span class="op" id="3439935">(</span><span class="ident" id="3439936">k</span>&nbsp;<span class="ident" id="3439938">KeySizeError</span><span class="op" id="3439950">)</span>&nbsp;<span class="ident" id="3439952">Error</span><span class="op" id="3439957">(</span><span class="op" id="3439958">)</span>&nbsp;<span class="builtintype" id="3439960">string</span>&nbsp;<span class="op" id="3439967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3439970">return</span>&nbsp;<span class="string" id="3439977">&#34;crypto/aes:&nbsp;invalid&nbsp;key&nbsp;size&nbsp;&#34;</span>&nbsp;<span class="op" id="3440009">+</span>&nbsp;<span class="ident" id="3440011">strconv</span><span class="op" id="3440018">.</span><span class="ident" id="3440019">Itoa</span><span class="op" id="3440023">(</span><span class="builtintype" id="3440024">int</span><span class="op" id="3440027">(</span><span class="ident" id="3440028">k</span><span class="op" id="3440029">)</span><span class="op" id="3440030">)</span><br>
<span class="lineno">25</span><span class="op" id="3440032">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3440035">//&nbsp;NewCipher&nbsp;creates&nbsp;and&nbsp;returns&nbsp;a&nbsp;new&nbsp;cipher.Block.</span><br>
<span class="lineno"></span><span class="comment" id="3440088">//&nbsp;The&nbsp;key&nbsp;argument&nbsp;should&nbsp;be&nbsp;the&nbsp;AES&nbsp;key,</span><br>
<span class="lineno"></span><span class="comment" id="3440131">//&nbsp;either&nbsp;16,&nbsp;24,&nbsp;or&nbsp;32&nbsp;bytes&nbsp;to&nbsp;select</span><br>
<span class="lineno">30</span><span class="comment" id="3440171">//&nbsp;AES-128,&nbsp;AES-192,&nbsp;or&nbsp;AES-256.</span><br>
<span class="lineno"></span><span class="keyword" id="3440204">func</span>&nbsp;<span class="ident" id="3440209">NewCipher</span><span class="op" id="3440218">(</span><span class="ident" id="3440219">key</span>&nbsp;<span class="op" id="3440223">[</span><span class="op" id="3440224">]</span><span class="builtintype" id="3440225">byte</span><span class="op" id="3440229">)</span>&nbsp;<span class="op" id="3440231">(</span><span class="ident" id="3440232">cipher</span><span class="op" id="3440238">.</span><span class="ident" id="3440239">Block</span><span class="op" id="3440244">,</span>&nbsp;<span class="builtintype" id="3440246">error</span><span class="op" id="3440251">)</span>&nbsp;<span class="op" id="3440253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3440256">k</span>&nbsp;<span class="op" id="3440258">:=</span>&nbsp;<span class="builtinfunc" id="3440261">len</span><span class="op" id="3440264">(</span><span class="ident" id="3440265">key</span><span class="op" id="3440268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3440271">switch</span>&nbsp;<span class="ident" id="3440278">k</span>&nbsp;<span class="op" id="3440280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3440283">default</span><span class="op" id="3440290">:</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3440294">return</span>&nbsp;<span class="ident" id="3440301">nil</span><span class="op" id="3440304">,</span>&nbsp;<span class="ident" id="3440306">KeySizeError</span><span class="op" id="3440318">(</span><span class="ident" id="3440319">k</span><span class="op" id="3440320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3440323">case</span>&nbsp;<span class="num" id="3440328">16</span><span class="op" id="3440330">,</span>&nbsp;<span class="num" id="3440332">24</span><span class="op" id="3440334">,</span>&nbsp;<span class="num" id="3440336">32</span><span class="op" id="3440338">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3440342">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3440349">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3440353">n</span>&nbsp;<span class="op" id="3440355">:=</span>&nbsp;<span class="ident" id="3440358">k</span>&nbsp;<span class="op" id="3440360">+</span>&nbsp;<span class="num" id="3440362">28</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3440366">c</span>&nbsp;<span class="op" id="3440368">:=</span>&nbsp;<span class="op" id="3440371">&amp;</span><span class="ident" id="3440372">aesCipher</span><span class="op" id="3440381">{</span><span class="builtinfunc" id="3440382">make</span><span class="op" id="3440386">(</span><span class="op" id="3440387">[</span><span class="op" id="3440388">]</span><span class="builtintype" id="3440389">uint32</span><span class="op" id="3440395">,</span>&nbsp;<span class="ident" id="3440397">n</span><span class="op" id="3440398">)</span><span class="op" id="3440399">,</span>&nbsp;<span class="builtinfunc" id="3440401">make</span><span class="op" id="3440405">(</span><span class="op" id="3440406">[</span><span class="op" id="3440407">]</span><span class="builtintype" id="3440408">uint32</span><span class="op" id="3440414">,</span>&nbsp;<span class="ident" id="3440416">n</span><span class="op" id="3440417">)</span><span class="op" id="3440418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3440421">expandKey</span><span class="op" id="3440430">(</span><span class="ident" id="3440431">key</span><span class="op" id="3440434">,</span>&nbsp;<span class="ident" id="3440436">c</span><span class="op" id="3440437">.</span><span class="ident" id="3440438">enc</span><span class="op" id="3440441">,</span>&nbsp;<span class="ident" id="3440443">c</span><span class="op" id="3440444">.</span><span class="ident" id="3440445">dec</span><span class="op" id="3440448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3440451">return</span>&nbsp;<span class="ident" id="3440458">c</span><span class="op" id="3440459">,</span>&nbsp;<span class="ident" id="3440461">nil</span><br>
<span class="lineno"></span><span class="op" id="3440465">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="3440468">func</span>&nbsp;<span class="op" id="3440473">(</span><span class="ident" id="3440474">c</span>&nbsp;<span class="op" id="3440476">*</span><span class="ident" id="3440477">aesCipher</span><span class="op" id="3440486">)</span>&nbsp;<span class="ident" id="3440488">BlockSize</span><span class="op" id="3440497">(</span><span class="op" id="3440498">)</span>&nbsp;<span class="builtintype" id="3440500">int</span>&nbsp;<span class="op" id="3440504">{</span>&nbsp;<span class="keyword" id="3440506">return</span>&nbsp;<span class="ident" id="3440513">BlockSize</span>&nbsp;<span class="op" id="3440523">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3440526">func</span>&nbsp;<span class="op" id="3440531">(</span><span class="ident" id="3440532">c</span>&nbsp;<span class="op" id="3440534">*</span><span class="ident" id="3440535">aesCipher</span><span class="op" id="3440544">)</span>&nbsp;<span class="ident" id="3440546">Encrypt</span><span class="op" id="3440553">(</span><span class="ident" id="3440554">dst</span><span class="op" id="3440557">,</span>&nbsp;<span class="ident" id="3440559">src</span>&nbsp;<span class="op" id="3440563">[</span><span class="op" id="3440564">]</span><span class="builtintype" id="3440565">byte</span><span class="op" id="3440569">)</span>&nbsp;<span class="op" id="3440571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3440574">if</span>&nbsp;<span class="builtinfunc" id="3440577">len</span><span class="op" id="3440580">(</span><span class="ident" id="3440581">src</span><span class="op" id="3440584">)</span>&nbsp;<span class="op" id="3440586">&lt;</span>&nbsp;<span class="ident" id="3440588">BlockSize</span>&nbsp;<span class="op" id="3440598">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3440602">panic</span><span class="op" id="3440607">(</span><span class="string" id="3440608">&#34;crypto/aes:&nbsp;input&nbsp;not&nbsp;full&nbsp;block&#34;</span><span class="op" id="3440642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3440645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3440648">if</span>&nbsp;<span class="builtinfunc" id="3440651">len</span><span class="op" id="3440654">(</span><span class="ident" id="3440655">dst</span><span class="op" id="3440658">)</span>&nbsp;<span class="op" id="3440660">&lt;</span>&nbsp;<span class="ident" id="3440662">BlockSize</span>&nbsp;<span class="op" id="3440672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3440676">panic</span><span class="op" id="3440681">(</span><span class="string" id="3440682">&#34;crypto/aes:&nbsp;output&nbsp;not&nbsp;full&nbsp;block&#34;</span><span class="op" id="3440717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3440720">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3440723">encryptBlock</span><span class="op" id="3440735">(</span><span class="ident" id="3440736">c</span><span class="op" id="3440737">.</span><span class="ident" id="3440738">enc</span><span class="op" id="3440741">,</span>&nbsp;<span class="ident" id="3440743">dst</span><span class="op" id="3440746">,</span>&nbsp;<span class="ident" id="3440748">src</span><span class="op" id="3440751">)</span><br>
<span class="lineno"></span><span class="op" id="3440753">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3440756">func</span>&nbsp;<span class="op" id="3440761">(</span><span class="ident" id="3440762">c</span>&nbsp;<span class="op" id="3440764">*</span><span class="ident" id="3440765">aesCipher</span><span class="op" id="3440774">)</span>&nbsp;<span class="ident" id="3440776">Decrypt</span><span class="op" id="3440783">(</span><span class="ident" id="3440784">dst</span><span class="op" id="3440787">,</span>&nbsp;<span class="ident" id="3440789">src</span>&nbsp;<span class="op" id="3440793">[</span><span class="op" id="3440794">]</span><span class="builtintype" id="3440795">byte</span><span class="op" id="3440799">)</span>&nbsp;<span class="op" id="3440801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3440804">if</span>&nbsp;<span class="builtinfunc" id="3440807">len</span><span class="op" id="3440810">(</span><span class="ident" id="3440811">src</span><span class="op" id="3440814">)</span>&nbsp;<span class="op" id="3440816">&lt;</span>&nbsp;<span class="ident" id="3440818">BlockSize</span>&nbsp;<span class="op" id="3440828">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3440832">panic</span><span class="op" id="3440837">(</span><span class="string" id="3440838">&#34;crypto/aes:&nbsp;input&nbsp;not&nbsp;full&nbsp;block&#34;</span><span class="op" id="3440872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3440875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3440878">if</span>&nbsp;<span class="builtinfunc" id="3440881">len</span><span class="op" id="3440884">(</span><span class="ident" id="3440885">dst</span><span class="op" id="3440888">)</span>&nbsp;<span class="op" id="3440890">&lt;</span>&nbsp;<span class="ident" id="3440892">BlockSize</span>&nbsp;<span class="op" id="3440902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3440906">panic</span><span class="op" id="3440911">(</span><span class="string" id="3440912">&#34;crypto/aes:&nbsp;output&nbsp;not&nbsp;full&nbsp;block&#34;</span><span class="op" id="3440947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3440950">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3440953">decryptBlock</span><span class="op" id="3440965">(</span><span class="ident" id="3440966">c</span><span class="op" id="3440967">.</span><span class="ident" id="3440968">dec</span><span class="op" id="3440971">,</span>&nbsp;<span class="ident" id="3440973">dst</span><span class="op" id="3440976">,</span>&nbsp;<span class="ident" id="3440978">src</span><span class="op" id="3440981">)</span><br>
<span class="lineno"></span><span class="op" id="3440983">}</span>
</div>
</body>
</html>
