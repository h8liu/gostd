<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="8670706">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8670761">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8670815">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8670866">package</span>&nbsp;<span class="ident" id="8670874">debug</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8670881">import</span>&nbsp;<span class="op" id="8670888">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8670891">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8670902">&#34;testing&#34;</span><br>
<span class="lineno">10</span><span class="op" id="8670912">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8670915">type</span>&nbsp;<span class="ident" id="8670920">T</span>&nbsp;<span class="builtintype" id="8670922">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8670927">func</span>&nbsp;<span class="op" id="8670932">(</span><span class="ident" id="8670933">t</span>&nbsp;<span class="op" id="8670935">*</span><span class="ident" id="8670936"><a href="/runtime/debug/stack_test.go.html#8670920">T</a></span><span class="op" id="8670937">)</span>&nbsp;<span class="ident" id="8670939">ptrmethod</span><span class="op" id="8670948">(</span><span class="op" id="8670949">)</span>&nbsp;<span class="op" id="8670951">[</span><span class="op" id="8670952">]</span><span class="builtintype" id="8670953">byte</span>&nbsp;<span class="op" id="8670958">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8670961">return</span>&nbsp;<span class="ident" id="8670968"><a href="/runtime/debug/stack.go.html#6022171">Stack</a></span><span class="op" id="8670973">(</span><span class="op" id="8670974">)</span><br>
<span class="lineno"></span><span class="op" id="8670976">}</span><br>
<span class="lineno"></span><span class="keyword" id="8670978">func</span>&nbsp;<span class="op" id="8670983">(</span><span class="ident" id="8670984">t</span>&nbsp;<span class="ident" id="8670986"><a href="/runtime/debug/stack_test.go.html#8670920">T</a></span><span class="op" id="8670987">)</span>&nbsp;<span class="ident" id="8670989">method</span><span class="op" id="8670995">(</span><span class="op" id="8670996">)</span>&nbsp;<span class="op" id="8670998">[</span><span class="op" id="8670999">]</span><span class="builtintype" id="8671000">byte</span>&nbsp;<span class="op" id="8671005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8671008">return</span>&nbsp;<span class="ident" id="8671015"><a href="/runtime/debug/stack_test.go.html#8670984">t</a></span><span class="op" id="8671016">.</span><span class="ident" id="8671017">ptrmethod</span><span class="op" id="8671026">(</span><span class="op" id="8671027">)</span><br>
<span class="lineno"></span><span class="op" id="8671029">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="8671032">/*<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspThe&nbsp;traceback&nbsp;should&nbsp;look&nbsp;something&nbsp;like&nbsp;this,&nbsp;modulo&nbsp;line&nbsp;numbers&nbsp;and&nbsp;hex&nbsp;constants.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspDon&#39;t&nbsp;worry&nbsp;much&nbsp;about&nbsp;the&nbsp;base&nbsp;levels,&nbsp;but&nbsp;check&nbsp;the&nbsp;ones&nbsp;in&nbsp;our&nbsp;own&nbsp;package.<br>
<span class="lineno"></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp/Users/r/go/src/runtime/debug/stack_test.go:15&nbsp;(0x13878)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp(*T).ptrmethod:&nbsp;return&nbsp;Stack()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp/Users/r/go/src/runtime/debug/stack_test.go:18&nbsp;(0x138dd)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspT.method:&nbsp;return&nbsp;t.ptrmethod()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp/Users/r/go/src/runtime/debug/stack_test.go:23&nbsp;(0x13920)<br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspTestStack:&nbsp;b&nbsp;:=&nbsp;T(0).method()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp/Users/r/go/src/testing/testing.go:132&nbsp;(0x14a7a)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsptRunner:&nbsp;test.F(t)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp/Users/r/go/src/runtime/proc.c:145&nbsp;(0xc970)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp???:&nbsp;runtime·unlock(&amp;runtime·sched);<br>
<span class="lineno">35</span>*/</span><br>
<span class="lineno"></span><span class="keyword" id="8671645">func</span>&nbsp;<span class="ident" id="8671650">TestStack</span><span class="op" id="8671659">(</span><span class="ident" id="8671660">t</span>&nbsp;<span class="op" id="8671662">*</span><span class="ident" id="8671663"><a href="/runtime/debug/stack_test.go.html#8670902">testing</a></span><span class="op" id="8671670">.</span><span class="ident" id="8671671">T</span><span class="op" id="8671672">)</span>&nbsp;<span class="op" id="8671674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8671677">b</span>&nbsp;<span class="op" id="8671679">:=</span>&nbsp;<span class="ident" id="8671682"><a href="/runtime/debug/stack_test.go.html#8670920">T</a></span><span class="op" id="8671683">(</span><span class="num" id="8671684">0</span><span class="op" id="8671685">)</span><span class="op" id="8671686">.</span><span class="ident" id="8671687">method</span><span class="op" id="8671693">(</span><span class="op" id="8671694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8671697">lines</span>&nbsp;<span class="op" id="8671703">:=</span>&nbsp;<span class="ident" id="8671706"><a href="/runtime/debug/stack_test.go.html#8670891">strings</a></span><span class="op" id="8671713">.</span><span class="ident" id="8671714">Split</span><span class="op" id="8671719">(</span><span class="builtintype" id="8671720">string</span><span class="op" id="8671726">(</span><span class="ident" id="8671727"><a href="/runtime/debug/stack_test.go.html#8671677">b</a></span><span class="op" id="8671728">)</span><span class="op" id="8671729">,</span>&nbsp;<span class="string" id="8671731">&#34;\n&#34;</span><span class="op" id="8671735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8671738">if</span>&nbsp;<span class="builtinfunc" id="8671741">len</span><span class="op" id="8671744">(</span><span class="ident" id="8671745"><a href="/runtime/debug/stack_test.go.html#8671697">lines</a></span><span class="op" id="8671750">)</span>&nbsp;<span class="op" id="8671752">&lt;</span>&nbsp;<span class="num" id="8671754">6</span>&nbsp;<span class="op" id="8671756">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8671760"><a href="/runtime/debug/stack_test.go.html#8671660">t</a></span><span class="op" id="8671761">.</span><span class="ident" id="8671762">Fatal</span><span class="op" id="8671767">(</span><span class="string" id="8671768">&#34;too&nbsp;few&nbsp;lines&#34;</span><span class="op" id="8671783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8671786">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8671789">n</span>&nbsp;<span class="op" id="8671791">:=</span>&nbsp;<span class="num" id="8671794">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8671797">frame</span>&nbsp;<span class="op" id="8671803">:=</span>&nbsp;<span class="keyword" id="8671806">func</span><span class="op" id="8671810">(</span><span class="ident" id="8671811">line</span><span class="op" id="8671815">,</span>&nbsp;<span class="ident" id="8671817">code</span>&nbsp;<span class="builtintype" id="8671822">string</span><span class="op" id="8671828">)</span>&nbsp;<span class="op" id="8671830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8671834"><a href="/runtime/debug/stack_test.go.html#8672289">check</a></span><span class="op" id="8671839">(</span><span class="ident" id="8671840"><a href="/runtime/debug/stack_test.go.html#8671660">t</a></span><span class="op" id="8671841">,</span>&nbsp;<span class="ident" id="8671843"><a href="/runtime/debug/stack_test.go.html#8671697">lines</a></span><span class="op" id="8671848">[</span><span class="ident" id="8671849"><a href="/runtime/debug/stack_test.go.html#8671789">n</a></span><span class="op" id="8671850">]</span><span class="op" id="8671851">,</span>&nbsp;<span class="ident" id="8671853"><a href="/runtime/debug/stack_test.go.html#8671811">line</a></span><span class="op" id="8671857">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8671861"><a href="/runtime/debug/stack_test.go.html#8671789">n</a></span><span class="op" id="8671862">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8671867">//&nbsp;The&nbsp;source&nbsp;might&nbsp;not&nbsp;be&nbsp;available&nbsp;while&nbsp;running&nbsp;the&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8671930">if</span>&nbsp;<span class="ident" id="8671933"><a href="/runtime/debug/stack_test.go.html#8670891">strings</a></span><span class="op" id="8671940">.</span><span class="ident" id="8671941">HasPrefix</span><span class="op" id="8671950">(</span><span class="ident" id="8671951"><a href="/runtime/debug/stack_test.go.html#8671697">lines</a></span><span class="op" id="8671956">[</span><span class="ident" id="8671957"><a href="/runtime/debug/stack_test.go.html#8671789">n</a></span><span class="op" id="8671958">]</span><span class="op" id="8671959">,</span>&nbsp;<span class="string" id="8671961">&#34;\t&#34;</span><span class="op" id="8671965">)</span>&nbsp;<span class="op" id="8671967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8671972"><a href="/runtime/debug/stack_test.go.html#8672289">check</a></span><span class="op" id="8671977">(</span><span class="ident" id="8671978"><a href="/runtime/debug/stack_test.go.html#8671660">t</a></span><span class="op" id="8671979">,</span>&nbsp;<span class="ident" id="8671981"><a href="/runtime/debug/stack_test.go.html#8671697">lines</a></span><span class="op" id="8671986">[</span><span class="ident" id="8671987"><a href="/runtime/debug/stack_test.go.html#8671789">n</a></span><span class="op" id="8671988">]</span><span class="op" id="8671989">,</span>&nbsp;<span class="ident" id="8671991"><a href="/runtime/debug/stack_test.go.html#8671817">code</a></span><span class="op" id="8671995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8672000"><a href="/runtime/debug/stack_test.go.html#8671789">n</a></span><span class="op" id="8672001">++</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8672006">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8672009">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8672012"><a href="/runtime/debug/stack_test.go.html#8671797">frame</a></span><span class="op" id="8672017">(</span><span class="string" id="8672018">&#34;src/runtime/debug/stack_test.go&#34;</span><span class="op" id="8672051">,</span>&nbsp;<span class="string" id="8672053">&#34;\t(*T).ptrmethod:&nbsp;return&nbsp;Stack()&#34;</span><span class="op" id="8672087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8672090"><a href="/runtime/debug/stack_test.go.html#8671797">frame</a></span><span class="op" id="8672095">(</span><span class="string" id="8672096">&#34;src/runtime/debug/stack_test.go&#34;</span><span class="op" id="8672129">,</span>&nbsp;<span class="string" id="8672131">&#34;\tT.method:&nbsp;return&nbsp;t.ptrmethod()&#34;</span><span class="op" id="8672165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8672168"><a href="/runtime/debug/stack_test.go.html#8671797">frame</a></span><span class="op" id="8672173">(</span><span class="string" id="8672174">&#34;src/runtime/debug/stack_test.go&#34;</span><span class="op" id="8672207">,</span>&nbsp;<span class="string" id="8672209">&#34;\tTestStack:&nbsp;b&nbsp;:=&nbsp;T(0).method()&#34;</span><span class="op" id="8672242">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8672245"><a href="/runtime/debug/stack_test.go.html#8671797">frame</a></span><span class="op" id="8672250">(</span><span class="string" id="8672251">&#34;src/testing/testing.go&#34;</span><span class="op" id="8672275">,</span>&nbsp;<span class="string" id="8672277">&#34;&#34;</span><span class="op" id="8672279">)</span><br>
<span class="lineno"></span><span class="op" id="8672281">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8672284">func</span>&nbsp;<span class="ident" id="8672289">check</span><span class="op" id="8672294">(</span><span class="ident" id="8672295">t</span>&nbsp;<span class="op" id="8672297">*</span><span class="ident" id="8672298"><a href="/runtime/debug/stack_test.go.html#8670902">testing</a></span><span class="op" id="8672305">.</span><span class="ident" id="8672306">T</span><span class="op" id="8672307">,</span>&nbsp;<span class="ident" id="8672309">line</span><span class="op" id="8672313">,</span>&nbsp;<span class="ident" id="8672315">has</span>&nbsp;<span class="builtintype" id="8672319">string</span><span class="op" id="8672325">)</span>&nbsp;<span class="op" id="8672327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8672330">if</span>&nbsp;<span class="ident" id="8672333"><a href="/runtime/debug/stack_test.go.html#8670891">strings</a></span><span class="op" id="8672340">.</span><span class="ident" id="8672341">Index</span><span class="op" id="8672346">(</span><span class="ident" id="8672347"><a href="/runtime/debug/stack_test.go.html#8672309">line</a></span><span class="op" id="8672351">,</span>&nbsp;<span class="ident" id="8672353"><a href="/runtime/debug/stack_test.go.html#8672315">has</a></span><span class="op" id="8672356">)</span>&nbsp;<span class="op" id="8672358">&lt;</span>&nbsp;<span class="num" id="8672360">0</span>&nbsp;<span class="op" id="8672362">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8672366"><a href="/runtime/debug/stack_test.go.html#8672295">t</a></span><span class="op" id="8672367">.</span><span class="ident" id="8672368">Errorf</span><span class="op" id="8672374">(</span><span class="string" id="8672375">&#34;expected&nbsp;%q&nbsp;in&nbsp;%q&#34;</span><span class="op" id="8672394">,</span>&nbsp;<span class="ident" id="8672396"><a href="/runtime/debug/stack_test.go.html#8672315">has</a></span><span class="op" id="8672399">,</span>&nbsp;<span class="ident" id="8672401"><a href="/runtime/debug/stack_test.go.html#8672309">line</a></span><span class="op" id="8672405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8672408">}</span><br>
<span class="lineno"></span><span class="op" id="8672410">}</span>
</div>
</body>
</html>
