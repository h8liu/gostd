<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7467908">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7467964">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7468018">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7468069">package</span>&nbsp;<span class="ident" id="7468077">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7468082">import</span>&nbsp;<span class="op" id="7468089">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7468092">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7468101">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7468108">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7468114">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7468125">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7468136">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7468147">&#34;time&#34;</span><br>
<span class="lineno">15</span><span class="op" id="7468154">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7468157">type</span>&nbsp;<span class="ident" id="7468162">resolveIPAddrTest</span>&nbsp;<span class="keyword" id="7468180">struct</span>&nbsp;<span class="op" id="7468187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7468190">net</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7468204">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7468212">litAddrOrName</span>&nbsp;<span class="builtintype" id="7468226">string</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7468234">addr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7468248">*</span><span class="ident" id="7468249">IPAddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7468257">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7468271">error</span><br>
<span class="lineno"></span><span class="op" id="7468277">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7468280">var</span>&nbsp;<span class="ident" id="7468284">resolveIPAddrTests</span>&nbsp;<span class="op" id="7468303">=</span>&nbsp;<span class="op" id="7468305">[</span><span class="op" id="7468306">]</span><span class="ident" id="7468307">resolveIPAddrTest</span><span class="op" id="7468324">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7468327">{</span><span class="string" id="7468328">&#34;ip&#34;</span><span class="op" id="7468332">,</span>&nbsp;<span class="string" id="7468334">&#34;127.0.0.1&#34;</span><span class="op" id="7468345">,</span>&nbsp;<span class="op" id="7468347">&amp;</span><span class="ident" id="7468348">IPAddr</span><span class="op" id="7468354">{</span><span class="ident" id="7468355">IP</span><span class="op" id="7468357">:</span>&nbsp;<span class="ident" id="7468359">IPv4</span><span class="op" id="7468363">(</span><span class="num" id="7468364">127</span><span class="op" id="7468367">,</span>&nbsp;<span class="num" id="7468369">0</span><span class="op" id="7468370">,</span>&nbsp;<span class="num" id="7468372">0</span><span class="op" id="7468373">,</span>&nbsp;<span class="num" id="7468375">1</span><span class="op" id="7468376">)</span><span class="op" id="7468377">}</span><span class="op" id="7468378">,</span>&nbsp;<span class="ident" id="7468380">nil</span><span class="op" id="7468383">}</span><span class="op" id="7468384">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7468387">{</span><span class="string" id="7468388">&#34;ip4&#34;</span><span class="op" id="7468393">,</span>&nbsp;<span class="string" id="7468395">&#34;127.0.0.1&#34;</span><span class="op" id="7468406">,</span>&nbsp;<span class="op" id="7468408">&amp;</span><span class="ident" id="7468409">IPAddr</span><span class="op" id="7468415">{</span><span class="ident" id="7468416">IP</span><span class="op" id="7468418">:</span>&nbsp;<span class="ident" id="7468420">IPv4</span><span class="op" id="7468424">(</span><span class="num" id="7468425">127</span><span class="op" id="7468428">,</span>&nbsp;<span class="num" id="7468430">0</span><span class="op" id="7468431">,</span>&nbsp;<span class="num" id="7468433">0</span><span class="op" id="7468434">,</span>&nbsp;<span class="num" id="7468436">1</span><span class="op" id="7468437">)</span><span class="op" id="7468438">}</span><span class="op" id="7468439">,</span>&nbsp;<span class="ident" id="7468441">nil</span><span class="op" id="7468444">}</span><span class="op" id="7468445">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7468448">{</span><span class="string" id="7468449">&#34;ip4:icmp&#34;</span><span class="op" id="7468459">,</span>&nbsp;<span class="string" id="7468461">&#34;127.0.0.1&#34;</span><span class="op" id="7468472">,</span>&nbsp;<span class="op" id="7468474">&amp;</span><span class="ident" id="7468475">IPAddr</span><span class="op" id="7468481">{</span><span class="ident" id="7468482">IP</span><span class="op" id="7468484">:</span>&nbsp;<span class="ident" id="7468486">IPv4</span><span class="op" id="7468490">(</span><span class="num" id="7468491">127</span><span class="op" id="7468494">,</span>&nbsp;<span class="num" id="7468496">0</span><span class="op" id="7468497">,</span>&nbsp;<span class="num" id="7468499">0</span><span class="op" id="7468500">,</span>&nbsp;<span class="num" id="7468502">1</span><span class="op" id="7468503">)</span><span class="op" id="7468504">}</span><span class="op" id="7468505">,</span>&nbsp;<span class="ident" id="7468507">nil</span><span class="op" id="7468510">}</span><span class="op" id="7468511">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7468515">{</span><span class="string" id="7468516">&#34;ip&#34;</span><span class="op" id="7468520">,</span>&nbsp;<span class="string" id="7468522">&#34;::1&#34;</span><span class="op" id="7468527">,</span>&nbsp;<span class="op" id="7468529">&amp;</span><span class="ident" id="7468530">IPAddr</span><span class="op" id="7468536">{</span><span class="ident" id="7468537">IP</span><span class="op" id="7468539">:</span>&nbsp;<span class="ident" id="7468541">ParseIP</span><span class="op" id="7468548">(</span><span class="string" id="7468549">&#34;::1&#34;</span><span class="op" id="7468554">)</span><span class="op" id="7468555">}</span><span class="op" id="7468556">,</span>&nbsp;<span class="ident" id="7468558">nil</span><span class="op" id="7468561">}</span><span class="op" id="7468562">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7468565">{</span><span class="string" id="7468566">&#34;ip6&#34;</span><span class="op" id="7468571">,</span>&nbsp;<span class="string" id="7468573">&#34;::1&#34;</span><span class="op" id="7468578">,</span>&nbsp;<span class="op" id="7468580">&amp;</span><span class="ident" id="7468581">IPAddr</span><span class="op" id="7468587">{</span><span class="ident" id="7468588">IP</span><span class="op" id="7468590">:</span>&nbsp;<span class="ident" id="7468592">ParseIP</span><span class="op" id="7468599">(</span><span class="string" id="7468600">&#34;::1&#34;</span><span class="op" id="7468605">)</span><span class="op" id="7468606">}</span><span class="op" id="7468607">,</span>&nbsp;<span class="ident" id="7468609">nil</span><span class="op" id="7468612">}</span><span class="op" id="7468613">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7468616">{</span><span class="string" id="7468617">&#34;ip6:ipv6-icmp&#34;</span><span class="op" id="7468632">,</span>&nbsp;<span class="string" id="7468634">&#34;::1&#34;</span><span class="op" id="7468639">,</span>&nbsp;<span class="op" id="7468641">&amp;</span><span class="ident" id="7468642">IPAddr</span><span class="op" id="7468648">{</span><span class="ident" id="7468649">IP</span><span class="op" id="7468651">:</span>&nbsp;<span class="ident" id="7468653">ParseIP</span><span class="op" id="7468660">(</span><span class="string" id="7468661">&#34;::1&#34;</span><span class="op" id="7468666">)</span><span class="op" id="7468667">}</span><span class="op" id="7468668">,</span>&nbsp;<span class="ident" id="7468670">nil</span><span class="op" id="7468673">}</span><span class="op" id="7468674">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7468677">{</span><span class="string" id="7468678">&#34;ip6:IPv6-ICMP&#34;</span><span class="op" id="7468693">,</span>&nbsp;<span class="string" id="7468695">&#34;::1&#34;</span><span class="op" id="7468700">,</span>&nbsp;<span class="op" id="7468702">&amp;</span><span class="ident" id="7468703">IPAddr</span><span class="op" id="7468709">{</span><span class="ident" id="7468710">IP</span><span class="op" id="7468712">:</span>&nbsp;<span class="ident" id="7468714">ParseIP</span><span class="op" id="7468721">(</span><span class="string" id="7468722">&#34;::1&#34;</span><span class="op" id="7468727">)</span><span class="op" id="7468728">}</span><span class="op" id="7468729">,</span>&nbsp;<span class="ident" id="7468731">nil</span><span class="op" id="7468734">}</span><span class="op" id="7468735">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7468739">{</span><span class="string" id="7468740">&#34;ip&#34;</span><span class="op" id="7468744">,</span>&nbsp;<span class="string" id="7468746">&#34;::1%en0&#34;</span><span class="op" id="7468755">,</span>&nbsp;<span class="op" id="7468757">&amp;</span><span class="ident" id="7468758">IPAddr</span><span class="op" id="7468764">{</span><span class="ident" id="7468765">IP</span><span class="op" id="7468767">:</span>&nbsp;<span class="ident" id="7468769">ParseIP</span><span class="op" id="7468776">(</span><span class="string" id="7468777">&#34;::1&#34;</span><span class="op" id="7468782">)</span><span class="op" id="7468783">,</span>&nbsp;<span class="ident" id="7468785">Zone</span><span class="op" id="7468789">:</span>&nbsp;<span class="string" id="7468791">&#34;en0&#34;</span><span class="op" id="7468796">}</span><span class="op" id="7468797">,</span>&nbsp;<span class="ident" id="7468799">nil</span><span class="op" id="7468802">}</span><span class="op" id="7468803">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7468806">{</span><span class="string" id="7468807">&#34;ip6&#34;</span><span class="op" id="7468812">,</span>&nbsp;<span class="string" id="7468814">&#34;::1%911&#34;</span><span class="op" id="7468823">,</span>&nbsp;<span class="op" id="7468825">&amp;</span><span class="ident" id="7468826">IPAddr</span><span class="op" id="7468832">{</span><span class="ident" id="7468833">IP</span><span class="op" id="7468835">:</span>&nbsp;<span class="ident" id="7468837">ParseIP</span><span class="op" id="7468844">(</span><span class="string" id="7468845">&#34;::1&#34;</span><span class="op" id="7468850">)</span><span class="op" id="7468851">,</span>&nbsp;<span class="ident" id="7468853">Zone</span><span class="op" id="7468857">:</span>&nbsp;<span class="string" id="7468859">&#34;911&#34;</span><span class="op" id="7468864">}</span><span class="op" id="7468865">,</span>&nbsp;<span class="ident" id="7468867">nil</span><span class="op" id="7468870">}</span><span class="op" id="7468871">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7468875">{</span><span class="string" id="7468876">&#34;&#34;</span><span class="op" id="7468878">,</span>&nbsp;<span class="string" id="7468880">&#34;127.0.0.1&#34;</span><span class="op" id="7468891">,</span>&nbsp;<span class="op" id="7468893">&amp;</span><span class="ident" id="7468894">IPAddr</span><span class="op" id="7468900">{</span><span class="ident" id="7468901">IP</span><span class="op" id="7468903">:</span>&nbsp;<span class="ident" id="7468905">IPv4</span><span class="op" id="7468909">(</span><span class="num" id="7468910">127</span><span class="op" id="7468913">,</span>&nbsp;<span class="num" id="7468915">0</span><span class="op" id="7468916">,</span>&nbsp;<span class="num" id="7468918">0</span><span class="op" id="7468919">,</span>&nbsp;<span class="num" id="7468921">1</span><span class="op" id="7468922">)</span><span class="op" id="7468923">}</span><span class="op" id="7468924">,</span>&nbsp;<span class="ident" id="7468926">nil</span><span class="op" id="7468929">}</span><span class="op" id="7468930">,</span>&nbsp;<span class="comment" id="7468932">//&nbsp;Go&nbsp;1.0&nbsp;behavior</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7468952">{</span><span class="string" id="7468953">&#34;&#34;</span><span class="op" id="7468955">,</span>&nbsp;<span class="string" id="7468957">&#34;::1&#34;</span><span class="op" id="7468962">,</span>&nbsp;<span class="op" id="7468964">&amp;</span><span class="ident" id="7468965">IPAddr</span><span class="op" id="7468971">{</span><span class="ident" id="7468972">IP</span><span class="op" id="7468974">:</span>&nbsp;<span class="ident" id="7468976">ParseIP</span><span class="op" id="7468983">(</span><span class="string" id="7468984">&#34;::1&#34;</span><span class="op" id="7468989">)</span><span class="op" id="7468990">}</span><span class="op" id="7468991">,</span>&nbsp;<span class="ident" id="7468993">nil</span><span class="op" id="7468996">}</span><span class="op" id="7468997">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7469009">//&nbsp;Go&nbsp;1.0&nbsp;behavior</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7469030">{</span><span class="string" id="7469031">&#34;l2tp&#34;</span><span class="op" id="7469037">,</span>&nbsp;<span class="string" id="7469039">&#34;127.0.0.1&#34;</span><span class="op" id="7469050">,</span>&nbsp;<span class="ident" id="7469052">nil</span><span class="op" id="7469055">,</span>&nbsp;<span class="ident" id="7469057">UnknownNetworkError</span><span class="op" id="7469076">(</span><span class="string" id="7469077">&#34;l2tp&#34;</span><span class="op" id="7469083">)</span><span class="op" id="7469084">}</span><span class="op" id="7469085">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7469088">{</span><span class="string" id="7469089">&#34;l2tp:gre&#34;</span><span class="op" id="7469099">,</span>&nbsp;<span class="string" id="7469101">&#34;127.0.0.1&#34;</span><span class="op" id="7469112">,</span>&nbsp;<span class="ident" id="7469114">nil</span><span class="op" id="7469117">,</span>&nbsp;<span class="ident" id="7469119">UnknownNetworkError</span><span class="op" id="7469138">(</span><span class="string" id="7469139">&#34;l2tp:gre&#34;</span><span class="op" id="7469149">)</span><span class="op" id="7469150">}</span><span class="op" id="7469151">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7469154">{</span><span class="string" id="7469155">&#34;tcp&#34;</span><span class="op" id="7469160">,</span>&nbsp;<span class="string" id="7469162">&#34;1.2.3.4:123&#34;</span><span class="op" id="7469175">,</span>&nbsp;<span class="ident" id="7469177">nil</span><span class="op" id="7469180">,</span>&nbsp;<span class="ident" id="7469182">UnknownNetworkError</span><span class="op" id="7469201">(</span><span class="string" id="7469202">&#34;tcp&#34;</span><span class="op" id="7469207">)</span><span class="op" id="7469208">}</span><span class="op" id="7469209">,</span><br>
<span class="lineno"></span><span class="op" id="7469211">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="7469214">func</span>&nbsp;<span class="ident" id="7469219">init</span><span class="op" id="7469223">(</span><span class="op" id="7469224">)</span>&nbsp;<span class="op" id="7469226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7469229">if</span>&nbsp;<span class="ident" id="7469232">ifi</span>&nbsp;<span class="op" id="7469236">:=</span>&nbsp;<span class="ident" id="7469239">loopbackInterface</span><span class="op" id="7469256">(</span><span class="op" id="7469257">)</span><span class="op" id="7469258">;</span>&nbsp;<span class="ident" id="7469260">ifi</span>&nbsp;<span class="op" id="7469264">!=</span>&nbsp;<span class="ident" id="7469267">nil</span>&nbsp;<span class="op" id="7469271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7469275">index</span>&nbsp;<span class="op" id="7469281">:=</span>&nbsp;<span class="ident" id="7469284">fmt</span><span class="op" id="7469287">.</span><span class="ident" id="7469288">Sprintf</span><span class="op" id="7469295">(</span><span class="string" id="7469296">&#34;%v&#34;</span><span class="op" id="7469300">,</span>&nbsp;<span class="ident" id="7469302">ifi</span><span class="op" id="7469305">.</span><span class="ident" id="7469306">Index</span><span class="op" id="7469311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7469315">resolveIPAddrTests</span>&nbsp;<span class="op" id="7469334">=</span>&nbsp;<span class="builtinfunc" id="7469336">append</span><span class="op" id="7469342">(</span><span class="ident" id="7469343">resolveIPAddrTests</span><span class="op" id="7469361">,</span>&nbsp;<span class="op" id="7469363">[</span><span class="op" id="7469364">]</span><span class="ident" id="7469365">resolveIPAddrTest</span><span class="op" id="7469382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7469387">{</span><span class="string" id="7469388">&#34;ip6&#34;</span><span class="op" id="7469393">,</span>&nbsp;<span class="string" id="7469395">&#34;fe80::1%&#34;</span>&nbsp;<span class="op" id="7469406">+</span>&nbsp;<span class="ident" id="7469408">ifi</span><span class="op" id="7469411">.</span><span class="ident" id="7469412">Name</span><span class="op" id="7469416">,</span>&nbsp;<span class="op" id="7469418">&amp;</span><span class="ident" id="7469419">IPAddr</span><span class="op" id="7469425">{</span><span class="ident" id="7469426">IP</span><span class="op" id="7469428">:</span>&nbsp;<span class="ident" id="7469430">ParseIP</span><span class="op" id="7469437">(</span><span class="string" id="7469438">&#34;fe80::1&#34;</span><span class="op" id="7469447">)</span><span class="op" id="7469448">,</span>&nbsp;<span class="ident" id="7469450">Zone</span><span class="op" id="7469454">:</span>&nbsp;<span class="ident" id="7469456">zoneToString</span><span class="op" id="7469468">(</span><span class="ident" id="7469469">ifi</span><span class="op" id="7469472">.</span><span class="ident" id="7469473">Index</span><span class="op" id="7469478">)</span><span class="op" id="7469479">}</span><span class="op" id="7469480">,</span>&nbsp;<span class="ident" id="7469482">nil</span><span class="op" id="7469485">}</span><span class="op" id="7469486">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7469491">{</span><span class="string" id="7469492">&#34;ip6&#34;</span><span class="op" id="7469497">,</span>&nbsp;<span class="string" id="7469499">&#34;fe80::1%&#34;</span>&nbsp;<span class="op" id="7469510">+</span>&nbsp;<span class="ident" id="7469512">index</span><span class="op" id="7469517">,</span>&nbsp;<span class="op" id="7469519">&amp;</span><span class="ident" id="7469520">IPAddr</span><span class="op" id="7469526">{</span><span class="ident" id="7469527">IP</span><span class="op" id="7469529">:</span>&nbsp;<span class="ident" id="7469531">ParseIP</span><span class="op" id="7469538">(</span><span class="string" id="7469539">&#34;fe80::1&#34;</span><span class="op" id="7469548">)</span><span class="op" id="7469549">,</span>&nbsp;<span class="ident" id="7469551">Zone</span><span class="op" id="7469555">:</span>&nbsp;<span class="ident" id="7469557">index</span><span class="op" id="7469562">}</span><span class="op" id="7469563">,</span>&nbsp;<span class="ident" id="7469565">nil</span><span class="op" id="7469568">}</span><span class="op" id="7469569">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7469573">}</span><span class="op" id="7469574">...</span><span class="op" id="7469577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7469580">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7469583">if</span>&nbsp;<span class="ident" id="7469586">ips</span><span class="op" id="7469589">,</span>&nbsp;<span class="ident" id="7469591">err</span>&nbsp;<span class="op" id="7469595">:=</span>&nbsp;<span class="ident" id="7469598">LookupIP</span><span class="op" id="7469606">(</span><span class="string" id="7469607">&#34;localhost&#34;</span><span class="op" id="7469618">)</span><span class="op" id="7469619">;</span>&nbsp;<span class="ident" id="7469621">err</span>&nbsp;<span class="op" id="7469625">==</span>&nbsp;<span class="ident" id="7469628">nil</span>&nbsp;<span class="op" id="7469632">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="7469635">len</span><span class="op" id="7469638">(</span><span class="ident" id="7469639">ips</span><span class="op" id="7469642">)</span>&nbsp;<span class="op" id="7469644">&gt;</span>&nbsp;<span class="num" id="7469646">1</span>&nbsp;<span class="op" id="7469648">&amp;&amp;</span>&nbsp;<span class="ident" id="7469651">supportsIPv4</span>&nbsp;<span class="op" id="7469664">&amp;&amp;</span>&nbsp;<span class="ident" id="7469667">supportsIPv6</span>&nbsp;<span class="op" id="7469680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7469684">resolveIPAddrTests</span>&nbsp;<span class="op" id="7469703">=</span>&nbsp;<span class="builtinfunc" id="7469705">append</span><span class="op" id="7469711">(</span><span class="ident" id="7469712">resolveIPAddrTests</span><span class="op" id="7469730">,</span>&nbsp;<span class="op" id="7469732">[</span><span class="op" id="7469733">]</span><span class="ident" id="7469734">resolveIPAddrTest</span><span class="op" id="7469751">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7469756">{</span><span class="string" id="7469757">&#34;ip&#34;</span><span class="op" id="7469761">,</span>&nbsp;<span class="string" id="7469763">&#34;localhost&#34;</span><span class="op" id="7469774">,</span>&nbsp;<span class="op" id="7469776">&amp;</span><span class="ident" id="7469777">IPAddr</span><span class="op" id="7469783">{</span><span class="ident" id="7469784">IP</span><span class="op" id="7469786">:</span>&nbsp;<span class="ident" id="7469788">IPv4</span><span class="op" id="7469792">(</span><span class="num" id="7469793">127</span><span class="op" id="7469796">,</span>&nbsp;<span class="num" id="7469798">0</span><span class="op" id="7469799">,</span>&nbsp;<span class="num" id="7469801">0</span><span class="op" id="7469802">,</span>&nbsp;<span class="num" id="7469804">1</span><span class="op" id="7469805">)</span><span class="op" id="7469806">}</span><span class="op" id="7469807">,</span>&nbsp;<span class="ident" id="7469809">nil</span><span class="op" id="7469812">}</span><span class="op" id="7469813">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7469818">{</span><span class="string" id="7469819">&#34;ip4&#34;</span><span class="op" id="7469824">,</span>&nbsp;<span class="string" id="7469826">&#34;localhost&#34;</span><span class="op" id="7469837">,</span>&nbsp;<span class="op" id="7469839">&amp;</span><span class="ident" id="7469840">IPAddr</span><span class="op" id="7469846">{</span><span class="ident" id="7469847">IP</span><span class="op" id="7469849">:</span>&nbsp;<span class="ident" id="7469851">IPv4</span><span class="op" id="7469855">(</span><span class="num" id="7469856">127</span><span class="op" id="7469859">,</span>&nbsp;<span class="num" id="7469861">0</span><span class="op" id="7469862">,</span>&nbsp;<span class="num" id="7469864">0</span><span class="op" id="7469865">,</span>&nbsp;<span class="num" id="7469867">1</span><span class="op" id="7469868">)</span><span class="op" id="7469869">}</span><span class="op" id="7469870">,</span>&nbsp;<span class="ident" id="7469872">nil</span><span class="op" id="7469875">}</span><span class="op" id="7469876">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7469881">{</span><span class="string" id="7469882">&#34;ip6&#34;</span><span class="op" id="7469887">,</span>&nbsp;<span class="string" id="7469889">&#34;localhost&#34;</span><span class="op" id="7469900">,</span>&nbsp;<span class="op" id="7469902">&amp;</span><span class="ident" id="7469903">IPAddr</span><span class="op" id="7469909">{</span><span class="ident" id="7469910">IP</span><span class="op" id="7469912">:</span>&nbsp;<span class="ident" id="7469914">IPv6loopback</span><span class="op" id="7469926">}</span><span class="op" id="7469927">,</span>&nbsp;<span class="ident" id="7469929">nil</span><span class="op" id="7469932">}</span><span class="op" id="7469933">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7469937">}</span><span class="op" id="7469938">...</span><span class="op" id="7469941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7469944">}</span><br>
<span class="lineno">60</span><span class="op" id="7469946">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7469949">func</span>&nbsp;<span class="ident" id="7469954">skipRawSocketTest</span><span class="op" id="7469971">(</span><span class="ident" id="7469972">t</span>&nbsp;<span class="op" id="7469974">*</span><span class="ident" id="7469975">testing</span><span class="op" id="7469982">.</span><span class="ident" id="7469983">T</span><span class="op" id="7469984">)</span>&nbsp;<span class="op" id="7469986">(</span><span class="ident" id="7469987">skip</span>&nbsp;<span class="builtintype" id="7469992">bool</span><span class="op" id="7469996">,</span>&nbsp;<span class="ident" id="7469998">skipmsg</span>&nbsp;<span class="builtintype" id="7470006">string</span><span class="op" id="7470012">)</span>&nbsp;<span class="op" id="7470014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7470017">skip</span><span class="op" id="7470021">,</span>&nbsp;<span class="ident" id="7470023">skipmsg</span><span class="op" id="7470030">,</span>&nbsp;<span class="ident" id="7470032">err</span>&nbsp;<span class="op" id="7470036">:=</span>&nbsp;<span class="ident" id="7470039">skipRawSocketTests</span><span class="op" id="7470057">(</span><span class="op" id="7470058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7470061">if</span>&nbsp;<span class="ident" id="7470064">err</span>&nbsp;<span class="op" id="7470068">!=</span>&nbsp;<span class="ident" id="7470071">nil</span>&nbsp;<span class="op" id="7470075">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7470079">t</span><span class="op" id="7470080">.</span><span class="ident" id="7470081">Fatal</span><span class="op" id="7470086">(</span><span class="ident" id="7470087">err</span><span class="op" id="7470090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7470093">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7470096">return</span>&nbsp;<span class="ident" id="7470103">skip</span><span class="op" id="7470107">,</span>&nbsp;<span class="ident" id="7470109">skipmsg</span><br>
<span class="lineno"></span><span class="op" id="7470117">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="7470120">func</span>&nbsp;<span class="ident" id="7470125">TestResolveIPAddr</span><span class="op" id="7470142">(</span><span class="ident" id="7470143">t</span>&nbsp;<span class="op" id="7470145">*</span><span class="ident" id="7470146">testing</span><span class="op" id="7470153">.</span><span class="ident" id="7470154">T</span><span class="op" id="7470155">)</span>&nbsp;<span class="op" id="7470157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7470160">switch</span>&nbsp;<span class="ident" id="7470167">runtime</span><span class="op" id="7470174">.</span><span class="ident" id="7470175">GOOS</span>&nbsp;<span class="op" id="7470180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7470183">case</span>&nbsp;<span class="string" id="7470188">&#34;nacl&#34;</span><span class="op" id="7470194">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7470198">t</span><span class="op" id="7470199">.</span><span class="ident" id="7470200">Skipf</span><span class="op" id="7470205">(</span><span class="string" id="7470206">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7470227">,</span>&nbsp;<span class="ident" id="7470229">runtime</span><span class="op" id="7470236">.</span><span class="ident" id="7470237">GOOS</span><span class="op" id="7470241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7470244">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7470248">for</span>&nbsp;<span class="ident" id="7470252">_</span><span class="op" id="7470253">,</span>&nbsp;<span class="ident" id="7470255">tt</span>&nbsp;<span class="op" id="7470258">:=</span>&nbsp;<span class="keyword" id="7470261">range</span>&nbsp;<span class="ident" id="7470267">resolveIPAddrTests</span>&nbsp;<span class="op" id="7470286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7470290">addr</span><span class="op" id="7470294">,</span>&nbsp;<span class="ident" id="7470296">err</span>&nbsp;<span class="op" id="7470300">:=</span>&nbsp;<span class="ident" id="7470303">ResolveIPAddr</span><span class="op" id="7470316">(</span><span class="ident" id="7470317">tt</span><span class="op" id="7470319">.</span><span class="ident" id="7470320">net</span><span class="op" id="7470323">,</span>&nbsp;<span class="ident" id="7470325">tt</span><span class="op" id="7470327">.</span><span class="ident" id="7470328">litAddrOrName</span><span class="op" id="7470341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7470345">if</span>&nbsp;<span class="ident" id="7470348">err</span>&nbsp;<span class="op" id="7470352">!=</span>&nbsp;<span class="ident" id="7470355">tt</span><span class="op" id="7470357">.</span><span class="ident" id="7470358">err</span>&nbsp;<span class="op" id="7470362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7470367">t</span><span class="op" id="7470368">.</span><span class="ident" id="7470369">Fatalf</span><span class="op" id="7470375">(</span><span class="string" id="7470376">&#34;ResolveIPAddr(%v,&nbsp;%v)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7470410">,</span>&nbsp;<span class="ident" id="7470412">tt</span><span class="op" id="7470414">.</span><span class="ident" id="7470415">net</span><span class="op" id="7470418">,</span>&nbsp;<span class="ident" id="7470420">tt</span><span class="op" id="7470422">.</span><span class="ident" id="7470423">litAddrOrName</span><span class="op" id="7470436">,</span>&nbsp;<span class="ident" id="7470438">err</span><span class="op" id="7470441">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7470445">}</span>&nbsp;<span class="keyword" id="7470447">else</span>&nbsp;<span class="keyword" id="7470452">if</span>&nbsp;<span class="op" id="7470455">!</span><span class="ident" id="7470456">reflect</span><span class="op" id="7470463">.</span><span class="ident" id="7470464">DeepEqual</span><span class="op" id="7470473">(</span><span class="ident" id="7470474">addr</span><span class="op" id="7470478">,</span>&nbsp;<span class="ident" id="7470480">tt</span><span class="op" id="7470482">.</span><span class="ident" id="7470483">addr</span><span class="op" id="7470487">)</span>&nbsp;<span class="op" id="7470489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7470494">t</span><span class="op" id="7470495">.</span><span class="ident" id="7470496">Fatalf</span><span class="op" id="7470502">(</span><span class="string" id="7470503">&#34;got&nbsp;%#v;&nbsp;expected&nbsp;%#v&#34;</span><span class="op" id="7470526">,</span>&nbsp;<span class="ident" id="7470528">addr</span><span class="op" id="7470532">,</span>&nbsp;<span class="ident" id="7470534">tt</span><span class="op" id="7470536">.</span><span class="ident" id="7470537">addr</span><span class="op" id="7470541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7470545">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7470548">}</span><br>
<span class="lineno"></span><span class="op" id="7470550">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="7470553">var</span>&nbsp;<span class="ident" id="7470557">icmpEchoTests</span>&nbsp;<span class="op" id="7470571">=</span>&nbsp;<span class="op" id="7470573">[</span><span class="op" id="7470574">]</span><span class="keyword" id="7470575">struct</span>&nbsp;<span class="op" id="7470582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7470585">net</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7470591">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7470599">laddr</span>&nbsp;<span class="builtintype" id="7470605">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7470613">raddr</span>&nbsp;<span class="builtintype" id="7470619">string</span><br>
<span class="lineno">90</span><span class="op" id="7470626">}</span><span class="op" id="7470627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7470630">{</span><span class="string" id="7470631">&#34;ip4:icmp&#34;</span><span class="op" id="7470641">,</span>&nbsp;<span class="string" id="7470643">&#34;0.0.0.0&#34;</span><span class="op" id="7470652">,</span>&nbsp;<span class="string" id="7470654">&#34;127.0.0.1&#34;</span><span class="op" id="7470665">}</span><span class="op" id="7470666">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7470669">{</span><span class="string" id="7470670">&#34;ip6:ipv6-icmp&#34;</span><span class="op" id="7470685">,</span>&nbsp;<span class="string" id="7470687">&#34;::&#34;</span><span class="op" id="7470691">,</span>&nbsp;<span class="string" id="7470693">&#34;::1&#34;</span><span class="op" id="7470698">}</span><span class="op" id="7470699">,</span><br>
<span class="lineno"></span><span class="op" id="7470701">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="7470704">func</span>&nbsp;<span class="ident" id="7470709">TestConnICMPEcho</span><span class="op" id="7470725">(</span><span class="ident" id="7470726">t</span>&nbsp;<span class="op" id="7470728">*</span><span class="ident" id="7470729">testing</span><span class="op" id="7470736">.</span><span class="ident" id="7470737">T</span><span class="op" id="7470738">)</span>&nbsp;<span class="op" id="7470740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7470743">if</span>&nbsp;<span class="ident" id="7470746">skip</span><span class="op" id="7470750">,</span>&nbsp;<span class="ident" id="7470752">skipmsg</span>&nbsp;<span class="op" id="7470760">:=</span>&nbsp;<span class="ident" id="7470763">skipRawSocketTest</span><span class="op" id="7470780">(</span><span class="ident" id="7470781">t</span><span class="op" id="7470782">)</span><span class="op" id="7470783">;</span>&nbsp;<span class="ident" id="7470785">skip</span>&nbsp;<span class="op" id="7470790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7470794">t</span><span class="op" id="7470795">.</span><span class="ident" id="7470796">Skip</span><span class="op" id="7470800">(</span><span class="ident" id="7470801">skipmsg</span><span class="op" id="7470808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7470811">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7470815">for</span>&nbsp;<span class="ident" id="7470819">i</span><span class="op" id="7470820">,</span>&nbsp;<span class="ident" id="7470822">tt</span>&nbsp;<span class="op" id="7470825">:=</span>&nbsp;<span class="keyword" id="7470828">range</span>&nbsp;<span class="ident" id="7470834">icmpEchoTests</span>&nbsp;<span class="op" id="7470848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7470852">net</span><span class="op" id="7470855">,</span>&nbsp;<span class="ident" id="7470857">_</span><span class="op" id="7470858">,</span>&nbsp;<span class="ident" id="7470860">err</span>&nbsp;<span class="op" id="7470864">:=</span>&nbsp;<span class="ident" id="7470867">parseNetwork</span><span class="op" id="7470879">(</span><span class="ident" id="7470880">tt</span><span class="op" id="7470882">.</span><span class="ident" id="7470883">net</span><span class="op" id="7470886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7470890">if</span>&nbsp;<span class="ident" id="7470893">err</span>&nbsp;<span class="op" id="7470897">!=</span>&nbsp;<span class="ident" id="7470900">nil</span>&nbsp;<span class="op" id="7470904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7470909">t</span><span class="op" id="7470910">.</span><span class="ident" id="7470911">Fatalf</span><span class="op" id="7470917">(</span><span class="string" id="7470918">&#34;parseNetwork&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7470943">,</span>&nbsp;<span class="ident" id="7470945">err</span><span class="op" id="7470948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7470952">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7470956">if</span>&nbsp;<span class="ident" id="7470959">net</span>&nbsp;<span class="op" id="7470963">==</span>&nbsp;<span class="string" id="7470966">&#34;ip6&#34;</span>&nbsp;<span class="op" id="7470972">&amp;&amp;</span>&nbsp;<span class="op" id="7470975">!</span><span class="ident" id="7470976">supportsIPv6</span>&nbsp;<span class="op" id="7470989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7470994">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7471005">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7471010">c</span><span class="op" id="7471011">,</span>&nbsp;<span class="ident" id="7471013">err</span>&nbsp;<span class="op" id="7471017">:=</span>&nbsp;<span class="ident" id="7471020">Dial</span><span class="op" id="7471024">(</span><span class="ident" id="7471025">tt</span><span class="op" id="7471027">.</span><span class="ident" id="7471028">net</span><span class="op" id="7471031">,</span>&nbsp;<span class="ident" id="7471033">tt</span><span class="op" id="7471035">.</span><span class="ident" id="7471036">raddr</span><span class="op" id="7471041">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7471045">if</span>&nbsp;<span class="ident" id="7471048">err</span>&nbsp;<span class="op" id="7471052">!=</span>&nbsp;<span class="ident" id="7471055">nil</span>&nbsp;<span class="op" id="7471059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7471064">t</span><span class="op" id="7471065">.</span><span class="ident" id="7471066">Fatalf</span><span class="op" id="7471072">(</span><span class="string" id="7471073">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7471090">,</span>&nbsp;<span class="ident" id="7471092">err</span><span class="op" id="7471095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7471099">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7471103">c</span><span class="op" id="7471104">.</span><span class="ident" id="7471105">SetDeadline</span><span class="op" id="7471116">(</span><span class="ident" id="7471117">time</span><span class="op" id="7471121">.</span><span class="ident" id="7471122">Now</span><span class="op" id="7471125">(</span><span class="op" id="7471126">)</span><span class="op" id="7471127">.</span><span class="ident" id="7471128">Add</span><span class="op" id="7471131">(</span><span class="num" id="7471132">100</span>&nbsp;<span class="op" id="7471136">*</span>&nbsp;<span class="ident" id="7471138">time</span><span class="op" id="7471142">.</span><span class="ident" id="7471143">Millisecond</span><span class="op" id="7471154">)</span><span class="op" id="7471155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7471159">defer</span>&nbsp;<span class="ident" id="7471165">c</span><span class="op" id="7471166">.</span><span class="ident" id="7471167">Close</span><span class="op" id="7471172">(</span><span class="op" id="7471173">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7471178">typ</span>&nbsp;<span class="op" id="7471182">:=</span>&nbsp;<span class="ident" id="7471185">icmpv4EchoRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7471205">if</span>&nbsp;<span class="ident" id="7471208">net</span>&nbsp;<span class="op" id="7471212">==</span>&nbsp;<span class="string" id="7471215">&#34;ip6&#34;</span>&nbsp;<span class="op" id="7471221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7471226">typ</span>&nbsp;<span class="op" id="7471230">=</span>&nbsp;<span class="ident" id="7471232">icmpv6EchoRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7471252">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7471256">xid</span><span class="op" id="7471259">,</span>&nbsp;<span class="ident" id="7471261">xseq</span>&nbsp;<span class="op" id="7471266">:=</span>&nbsp;<span class="ident" id="7471269">os</span><span class="op" id="7471271">.</span><span class="ident" id="7471272">Getpid</span><span class="op" id="7471278">(</span><span class="op" id="7471279">)</span><span class="op" id="7471280">&amp;</span><span class="num" id="7471281">0xffff</span><span class="op" id="7471287">,</span>&nbsp;<span class="ident" id="7471289">i</span><span class="op" id="7471290">+</span><span class="num" id="7471291">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7471295">wb</span><span class="op" id="7471297">,</span>&nbsp;<span class="ident" id="7471299">err</span>&nbsp;<span class="op" id="7471303">:=</span>&nbsp;<span class="op" id="7471306">(</span><span class="op" id="7471307">&amp;</span><span class="ident" id="7471308">icmpMessage</span><span class="op" id="7471319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7471324">Type</span><span class="op" id="7471328">:</span>&nbsp;<span class="ident" id="7471330">typ</span><span class="op" id="7471333">,</span>&nbsp;<span class="ident" id="7471335">Code</span><span class="op" id="7471339">:</span>&nbsp;<span class="num" id="7471341">0</span><span class="op" id="7471342">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7471347">Body</span><span class="op" id="7471351">:</span>&nbsp;<span class="op" id="7471353">&amp;</span><span class="ident" id="7471354">icmpEcho</span><span class="op" id="7471362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7471368">ID</span><span class="op" id="7471370">:</span>&nbsp;<span class="ident" id="7471372">xid</span><span class="op" id="7471375">,</span>&nbsp;<span class="ident" id="7471377">Seq</span><span class="op" id="7471380">:</span>&nbsp;<span class="ident" id="7471382">xseq</span><span class="op" id="7471386">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7471392">Data</span><span class="op" id="7471396">:</span>&nbsp;<span class="ident" id="7471398">bytes</span><span class="op" id="7471403">.</span><span class="ident" id="7471404">Repeat</span><span class="op" id="7471410">(</span><span class="op" id="7471411">[</span><span class="op" id="7471412">]</span><span class="builtintype" id="7471413">byte</span><span class="op" id="7471417">(</span><span class="string" id="7471418">&#34;Go&nbsp;Go&nbsp;Gadget&nbsp;Ping!!!&#34;</span><span class="op" id="7471440">)</span><span class="op" id="7471441">,</span>&nbsp;<span class="num" id="7471443">3</span><span class="op" id="7471444">)</span><span class="op" id="7471445">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7471450">}</span><span class="op" id="7471451">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7471455">}</span><span class="op" id="7471456">)</span><span class="op" id="7471457">.</span><span class="ident" id="7471458">Marshal</span><span class="op" id="7471465">(</span><span class="op" id="7471466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7471470">if</span>&nbsp;<span class="ident" id="7471473">err</span>&nbsp;<span class="op" id="7471477">!=</span>&nbsp;<span class="ident" id="7471480">nil</span>&nbsp;<span class="op" id="7471484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7471489">t</span><span class="op" id="7471490">.</span><span class="ident" id="7471491">Fatalf</span><span class="op" id="7471497">(</span><span class="string" id="7471498">&#34;icmpMessage.Marshal&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7471530">,</span>&nbsp;<span class="ident" id="7471532">err</span><span class="op" id="7471535">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7471539">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7471543">if</span>&nbsp;<span class="ident" id="7471546">_</span><span class="op" id="7471547">,</span>&nbsp;<span class="ident" id="7471549">err</span>&nbsp;<span class="op" id="7471553">:=</span>&nbsp;<span class="ident" id="7471556">c</span><span class="op" id="7471557">.</span><span class="ident" id="7471558">Write</span><span class="op" id="7471563">(</span><span class="ident" id="7471564">wb</span><span class="op" id="7471566">)</span><span class="op" id="7471567">;</span>&nbsp;<span class="ident" id="7471569">err</span>&nbsp;<span class="op" id="7471573">!=</span>&nbsp;<span class="ident" id="7471576">nil</span>&nbsp;<span class="op" id="7471580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7471585">t</span><span class="op" id="7471586">.</span><span class="ident" id="7471587">Fatalf</span><span class="op" id="7471593">(</span><span class="string" id="7471594">&#34;Conn.Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7471617">,</span>&nbsp;<span class="ident" id="7471619">err</span><span class="op" id="7471622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7471626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7471630">var</span>&nbsp;<span class="ident" id="7471634">m</span>&nbsp;<span class="op" id="7471636">*</span><span class="ident" id="7471637">icmpMessage</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7471651">rb</span>&nbsp;<span class="op" id="7471654">:=</span>&nbsp;<span class="builtinfunc" id="7471657">make</span><span class="op" id="7471661">(</span><span class="op" id="7471662">[</span><span class="op" id="7471663">]</span><span class="builtintype" id="7471664">byte</span><span class="op" id="7471668">,</span>&nbsp;<span class="num" id="7471670">20</span><span class="op" id="7471672">+</span><span class="builtinfunc" id="7471673">len</span><span class="op" id="7471676">(</span><span class="ident" id="7471677">wb</span><span class="op" id="7471679">)</span><span class="op" id="7471680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7471684">for</span>&nbsp;<span class="op" id="7471688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7471693">if</span>&nbsp;<span class="ident" id="7471696">_</span><span class="op" id="7471697">,</span>&nbsp;<span class="ident" id="7471699">err</span>&nbsp;<span class="op" id="7471703">:=</span>&nbsp;<span class="ident" id="7471706">c</span><span class="op" id="7471707">.</span><span class="ident" id="7471708">Read</span><span class="op" id="7471712">(</span><span class="ident" id="7471713">rb</span><span class="op" id="7471715">)</span><span class="op" id="7471716">;</span>&nbsp;<span class="ident" id="7471718">err</span>&nbsp;<span class="op" id="7471722">!=</span>&nbsp;<span class="ident" id="7471725">nil</span>&nbsp;<span class="op" id="7471729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7471735">t</span><span class="op" id="7471736">.</span><span class="ident" id="7471737">Fatalf</span><span class="op" id="7471743">(</span><span class="string" id="7471744">&#34;Conn.Read&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7471766">,</span>&nbsp;<span class="ident" id="7471768">err</span><span class="op" id="7471771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7471776">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7471781">if</span>&nbsp;<span class="ident" id="7471784">net</span>&nbsp;<span class="op" id="7471788">==</span>&nbsp;<span class="string" id="7471791">&#34;ip4&#34;</span>&nbsp;<span class="op" id="7471797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7471803">rb</span>&nbsp;<span class="op" id="7471806">=</span>&nbsp;<span class="ident" id="7471808">ipv4Payload</span><span class="op" id="7471819">(</span><span class="ident" id="7471820">rb</span><span class="op" id="7471822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7471827">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7471832">if</span>&nbsp;<span class="ident" id="7471835">m</span><span class="op" id="7471836">,</span>&nbsp;<span class="ident" id="7471838">err</span>&nbsp;<span class="op" id="7471842">=</span>&nbsp;<span class="ident" id="7471844">parseICMPMessage</span><span class="op" id="7471860">(</span><span class="ident" id="7471861">rb</span><span class="op" id="7471863">)</span><span class="op" id="7471864">;</span>&nbsp;<span class="ident" id="7471866">err</span>&nbsp;<span class="op" id="7471870">!=</span>&nbsp;<span class="ident" id="7471873">nil</span>&nbsp;<span class="op" id="7471877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7471883">t</span><span class="op" id="7471884">.</span><span class="ident" id="7471885">Fatalf</span><span class="op" id="7471891">(</span><span class="string" id="7471892">&#34;parseICMPMessage&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7471921">,</span>&nbsp;<span class="ident" id="7471923">err</span><span class="op" id="7471926">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7471931">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7471936">switch</span>&nbsp;<span class="ident" id="7471943">m</span><span class="op" id="7471944">.</span><span class="ident" id="7471945">Type</span>&nbsp;<span class="op" id="7471950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7471955">case</span>&nbsp;<span class="ident" id="7471960">icmpv4EchoRequest</span><span class="op" id="7471977">,</span>&nbsp;<span class="ident" id="7471979">icmpv6EchoRequest</span><span class="op" id="7471996">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7472002">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7472014">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7472019">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7472027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7472031">switch</span>&nbsp;<span class="ident" id="7472038">p</span>&nbsp;<span class="op" id="7472040">:=</span>&nbsp;<span class="ident" id="7472043">m</span><span class="op" id="7472044">.</span><span class="ident" id="7472045">Body</span><span class="op" id="7472049">.</span><span class="op" id="7472050">(</span><span class="keyword" id="7472051">type</span><span class="op" id="7472055">)</span>&nbsp;<span class="op" id="7472057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7472061">case</span>&nbsp;<span class="op" id="7472066">*</span><span class="ident" id="7472067">icmpEcho</span><span class="op" id="7472075">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7472080">if</span>&nbsp;<span class="ident" id="7472083">p</span><span class="op" id="7472084">.</span><span class="ident" id="7472085">ID</span>&nbsp;<span class="op" id="7472088">!=</span>&nbsp;<span class="ident" id="7472091">xid</span>&nbsp;<span class="op" id="7472095">||</span>&nbsp;<span class="ident" id="7472098">p</span><span class="op" id="7472099">.</span><span class="ident" id="7472100">Seq</span>&nbsp;<span class="op" id="7472104">!=</span>&nbsp;<span class="ident" id="7472107">xseq</span>&nbsp;<span class="op" id="7472112">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7472118">t</span><span class="op" id="7472119">.</span><span class="ident" id="7472120">Fatalf</span><span class="op" id="7472126">(</span><span class="string" id="7472127">&#34;got&nbsp;id=%v,&nbsp;seqnum=%v;&nbsp;expected&nbsp;id=%v,&nbsp;seqnum=%v&#34;</span><span class="op" id="7472176">,</span>&nbsp;<span class="ident" id="7472178">p</span><span class="op" id="7472179">.</span><span class="ident" id="7472180">ID</span><span class="op" id="7472182">,</span>&nbsp;<span class="ident" id="7472184">p</span><span class="op" id="7472185">.</span><span class="ident" id="7472186">Seq</span><span class="op" id="7472189">,</span>&nbsp;<span class="ident" id="7472191">xid</span><span class="op" id="7472194">,</span>&nbsp;<span class="ident" id="7472196">xseq</span><span class="op" id="7472200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7472205">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7472209">default</span><span class="op" id="7472216">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7472221">t</span><span class="op" id="7472222">.</span><span class="ident" id="7472223">Fatalf</span><span class="op" id="7472229">(</span><span class="string" id="7472230">&#34;got&nbsp;type=%v,&nbsp;code=%v;&nbsp;expected&nbsp;type=%v,&nbsp;code=%v&#34;</span><span class="op" id="7472279">,</span>&nbsp;<span class="ident" id="7472281">m</span><span class="op" id="7472282">.</span><span class="ident" id="7472283">Type</span><span class="op" id="7472287">,</span>&nbsp;<span class="ident" id="7472289">m</span><span class="op" id="7472290">.</span><span class="ident" id="7472291">Code</span><span class="op" id="7472295">,</span>&nbsp;<span class="ident" id="7472297">typ</span><span class="op" id="7472300">,</span>&nbsp;<span class="num" id="7472302">0</span><span class="op" id="7472303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7472307">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7472310">}</span><br>
<span class="lineno"></span><span class="op" id="7472312">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7472315">func</span>&nbsp;<span class="ident" id="7472320">TestPacketConnICMPEcho</span><span class="op" id="7472342">(</span><span class="ident" id="7472343">t</span>&nbsp;<span class="op" id="7472345">*</span><span class="ident" id="7472346">testing</span><span class="op" id="7472353">.</span><span class="ident" id="7472354">T</span><span class="op" id="7472355">)</span>&nbsp;<span class="op" id="7472357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7472360">if</span>&nbsp;<span class="ident" id="7472363">skip</span><span class="op" id="7472367">,</span>&nbsp;<span class="ident" id="7472369">skipmsg</span>&nbsp;<span class="op" id="7472377">:=</span>&nbsp;<span class="ident" id="7472380">skipRawSocketTest</span><span class="op" id="7472397">(</span><span class="ident" id="7472398">t</span><span class="op" id="7472399">)</span><span class="op" id="7472400">;</span>&nbsp;<span class="ident" id="7472402">skip</span>&nbsp;<span class="op" id="7472407">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7472411">t</span><span class="op" id="7472412">.</span><span class="ident" id="7472413">Skip</span><span class="op" id="7472417">(</span><span class="ident" id="7472418">skipmsg</span><span class="op" id="7472425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7472428">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7472432">for</span>&nbsp;<span class="ident" id="7472436">i</span><span class="op" id="7472437">,</span>&nbsp;<span class="ident" id="7472439">tt</span>&nbsp;<span class="op" id="7472442">:=</span>&nbsp;<span class="keyword" id="7472445">range</span>&nbsp;<span class="ident" id="7472451">icmpEchoTests</span>&nbsp;<span class="op" id="7472465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7472469">net</span><span class="op" id="7472472">,</span>&nbsp;<span class="ident" id="7472474">_</span><span class="op" id="7472475">,</span>&nbsp;<span class="ident" id="7472477">err</span>&nbsp;<span class="op" id="7472481">:=</span>&nbsp;<span class="ident" id="7472484">parseNetwork</span><span class="op" id="7472496">(</span><span class="ident" id="7472497">tt</span><span class="op" id="7472499">.</span><span class="ident" id="7472500">net</span><span class="op" id="7472503">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7472507">if</span>&nbsp;<span class="ident" id="7472510">err</span>&nbsp;<span class="op" id="7472514">!=</span>&nbsp;<span class="ident" id="7472517">nil</span>&nbsp;<span class="op" id="7472521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7472526">t</span><span class="op" id="7472527">.</span><span class="ident" id="7472528">Fatalf</span><span class="op" id="7472534">(</span><span class="string" id="7472535">&#34;parseNetwork&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7472560">,</span>&nbsp;<span class="ident" id="7472562">err</span><span class="op" id="7472565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7472569">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7472573">if</span>&nbsp;<span class="ident" id="7472576">net</span>&nbsp;<span class="op" id="7472580">==</span>&nbsp;<span class="string" id="7472583">&#34;ip6&#34;</span>&nbsp;<span class="op" id="7472589">&amp;&amp;</span>&nbsp;<span class="op" id="7472592">!</span><span class="ident" id="7472593">supportsIPv6</span>&nbsp;<span class="op" id="7472606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7472611">continue</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7472622">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7472627">c</span><span class="op" id="7472628">,</span>&nbsp;<span class="ident" id="7472630">err</span>&nbsp;<span class="op" id="7472634">:=</span>&nbsp;<span class="ident" id="7472637">ListenPacket</span><span class="op" id="7472649">(</span><span class="ident" id="7472650">tt</span><span class="op" id="7472652">.</span><span class="ident" id="7472653">net</span><span class="op" id="7472656">,</span>&nbsp;<span class="ident" id="7472658">tt</span><span class="op" id="7472660">.</span><span class="ident" id="7472661">laddr</span><span class="op" id="7472666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7472670">if</span>&nbsp;<span class="ident" id="7472673">err</span>&nbsp;<span class="op" id="7472677">!=</span>&nbsp;<span class="ident" id="7472680">nil</span>&nbsp;<span class="op" id="7472684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7472689">t</span><span class="op" id="7472690">.</span><span class="ident" id="7472691">Fatalf</span><span class="op" id="7472697">(</span><span class="string" id="7472698">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7472723">,</span>&nbsp;<span class="ident" id="7472725">err</span><span class="op" id="7472728">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7472732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7472736">c</span><span class="op" id="7472737">.</span><span class="ident" id="7472738">SetDeadline</span><span class="op" id="7472749">(</span><span class="ident" id="7472750">time</span><span class="op" id="7472754">.</span><span class="ident" id="7472755">Now</span><span class="op" id="7472758">(</span><span class="op" id="7472759">)</span><span class="op" id="7472760">.</span><span class="ident" id="7472761">Add</span><span class="op" id="7472764">(</span><span class="num" id="7472765">100</span>&nbsp;<span class="op" id="7472769">*</span>&nbsp;<span class="ident" id="7472771">time</span><span class="op" id="7472775">.</span><span class="ident" id="7472776">Millisecond</span><span class="op" id="7472787">)</span><span class="op" id="7472788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7472792">defer</span>&nbsp;<span class="ident" id="7472798">c</span><span class="op" id="7472799">.</span><span class="ident" id="7472800">Close</span><span class="op" id="7472805">(</span><span class="op" id="7472806">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7472811">ra</span><span class="op" id="7472813">,</span>&nbsp;<span class="ident" id="7472815">err</span>&nbsp;<span class="op" id="7472819">:=</span>&nbsp;<span class="ident" id="7472822">ResolveIPAddr</span><span class="op" id="7472835">(</span><span class="ident" id="7472836">tt</span><span class="op" id="7472838">.</span><span class="ident" id="7472839">net</span><span class="op" id="7472842">,</span>&nbsp;<span class="ident" id="7472844">tt</span><span class="op" id="7472846">.</span><span class="ident" id="7472847">raddr</span><span class="op" id="7472852">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7472856">if</span>&nbsp;<span class="ident" id="7472859">err</span>&nbsp;<span class="op" id="7472863">!=</span>&nbsp;<span class="ident" id="7472866">nil</span>&nbsp;<span class="op" id="7472870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7472875">t</span><span class="op" id="7472876">.</span><span class="ident" id="7472877">Fatalf</span><span class="op" id="7472883">(</span><span class="string" id="7472884">&#34;ResolveIPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7472910">,</span>&nbsp;<span class="ident" id="7472912">err</span><span class="op" id="7472915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7472919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7472923">typ</span>&nbsp;<span class="op" id="7472927">:=</span>&nbsp;<span class="ident" id="7472930">icmpv4EchoRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7472950">if</span>&nbsp;<span class="ident" id="7472953">net</span>&nbsp;<span class="op" id="7472957">==</span>&nbsp;<span class="string" id="7472960">&#34;ip6&#34;</span>&nbsp;<span class="op" id="7472966">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7472971">typ</span>&nbsp;<span class="op" id="7472975">=</span>&nbsp;<span class="ident" id="7472977">icmpv6EchoRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7472997">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7473001">xid</span><span class="op" id="7473004">,</span>&nbsp;<span class="ident" id="7473006">xseq</span>&nbsp;<span class="op" id="7473011">:=</span>&nbsp;<span class="ident" id="7473014">os</span><span class="op" id="7473016">.</span><span class="ident" id="7473017">Getpid</span><span class="op" id="7473023">(</span><span class="op" id="7473024">)</span><span class="op" id="7473025">&amp;</span><span class="num" id="7473026">0xffff</span><span class="op" id="7473032">,</span>&nbsp;<span class="ident" id="7473034">i</span><span class="op" id="7473035">+</span><span class="num" id="7473036">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7473040">wb</span><span class="op" id="7473042">,</span>&nbsp;<span class="ident" id="7473044">err</span>&nbsp;<span class="op" id="7473048">:=</span>&nbsp;<span class="op" id="7473051">(</span><span class="op" id="7473052">&amp;</span><span class="ident" id="7473053">icmpMessage</span><span class="op" id="7473064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7473069">Type</span><span class="op" id="7473073">:</span>&nbsp;<span class="ident" id="7473075">typ</span><span class="op" id="7473078">,</span>&nbsp;<span class="ident" id="7473080">Code</span><span class="op" id="7473084">:</span>&nbsp;<span class="num" id="7473086">0</span><span class="op" id="7473087">,</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7473092">Body</span><span class="op" id="7473096">:</span>&nbsp;<span class="op" id="7473098">&amp;</span><span class="ident" id="7473099">icmpEcho</span><span class="op" id="7473107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7473113">ID</span><span class="op" id="7473115">:</span>&nbsp;<span class="ident" id="7473117">xid</span><span class="op" id="7473120">,</span>&nbsp;<span class="ident" id="7473122">Seq</span><span class="op" id="7473125">:</span>&nbsp;<span class="ident" id="7473127">xseq</span><span class="op" id="7473131">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7473137">Data</span><span class="op" id="7473141">:</span>&nbsp;<span class="ident" id="7473143">bytes</span><span class="op" id="7473148">.</span><span class="ident" id="7473149">Repeat</span><span class="op" id="7473155">(</span><span class="op" id="7473156">[</span><span class="op" id="7473157">]</span><span class="builtintype" id="7473158">byte</span><span class="op" id="7473162">(</span><span class="string" id="7473163">&#34;Go&nbsp;Go&nbsp;Gadget&nbsp;Ping!!!&#34;</span><span class="op" id="7473185">)</span><span class="op" id="7473186">,</span>&nbsp;<span class="num" id="7473188">3</span><span class="op" id="7473189">)</span><span class="op" id="7473190">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7473195">}</span><span class="op" id="7473196">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7473200">}</span><span class="op" id="7473201">)</span><span class="op" id="7473202">.</span><span class="ident" id="7473203">Marshal</span><span class="op" id="7473210">(</span><span class="op" id="7473211">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7473215">if</span>&nbsp;<span class="ident" id="7473218">err</span>&nbsp;<span class="op" id="7473222">!=</span>&nbsp;<span class="ident" id="7473225">nil</span>&nbsp;<span class="op" id="7473229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7473234">t</span><span class="op" id="7473235">.</span><span class="ident" id="7473236">Fatalf</span><span class="op" id="7473242">(</span><span class="string" id="7473243">&#34;icmpMessage.Marshal&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7473275">,</span>&nbsp;<span class="ident" id="7473277">err</span><span class="op" id="7473280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7473284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7473288">if</span>&nbsp;<span class="ident" id="7473291">_</span><span class="op" id="7473292">,</span>&nbsp;<span class="ident" id="7473294">err</span>&nbsp;<span class="op" id="7473298">:=</span>&nbsp;<span class="ident" id="7473301">c</span><span class="op" id="7473302">.</span><span class="ident" id="7473303">WriteTo</span><span class="op" id="7473310">(</span><span class="ident" id="7473311">wb</span><span class="op" id="7473313">,</span>&nbsp;<span class="ident" id="7473315">ra</span><span class="op" id="7473317">)</span><span class="op" id="7473318">;</span>&nbsp;<span class="ident" id="7473320">err</span>&nbsp;<span class="op" id="7473324">!=</span>&nbsp;<span class="ident" id="7473327">nil</span>&nbsp;<span class="op" id="7473331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7473336">t</span><span class="op" id="7473337">.</span><span class="ident" id="7473338">Fatalf</span><span class="op" id="7473344">(</span><span class="string" id="7473345">&#34;PacketConn.WriteTo&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7473376">,</span>&nbsp;<span class="ident" id="7473378">err</span><span class="op" id="7473381">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7473385">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7473389">var</span>&nbsp;<span class="ident" id="7473393">m</span>&nbsp;<span class="op" id="7473395">*</span><span class="ident" id="7473396">icmpMessage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7473410">rb</span>&nbsp;<span class="op" id="7473413">:=</span>&nbsp;<span class="builtinfunc" id="7473416">make</span><span class="op" id="7473420">(</span><span class="op" id="7473421">[</span><span class="op" id="7473422">]</span><span class="builtintype" id="7473423">byte</span><span class="op" id="7473427">,</span>&nbsp;<span class="num" id="7473429">20</span><span class="op" id="7473431">+</span><span class="builtinfunc" id="7473432">len</span><span class="op" id="7473435">(</span><span class="ident" id="7473436">wb</span><span class="op" id="7473438">)</span><span class="op" id="7473439">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7473443">for</span>&nbsp;<span class="op" id="7473447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7473452">if</span>&nbsp;<span class="ident" id="7473455">_</span><span class="op" id="7473456">,</span>&nbsp;<span class="ident" id="7473458">_</span><span class="op" id="7473459">,</span>&nbsp;<span class="ident" id="7473461">err</span>&nbsp;<span class="op" id="7473465">:=</span>&nbsp;<span class="ident" id="7473468">c</span><span class="op" id="7473469">.</span><span class="ident" id="7473470">ReadFrom</span><span class="op" id="7473478">(</span><span class="ident" id="7473479">rb</span><span class="op" id="7473481">)</span><span class="op" id="7473482">;</span>&nbsp;<span class="ident" id="7473484">err</span>&nbsp;<span class="op" id="7473488">!=</span>&nbsp;<span class="ident" id="7473491">nil</span>&nbsp;<span class="op" id="7473495">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7473501">t</span><span class="op" id="7473502">.</span><span class="ident" id="7473503">Fatalf</span><span class="op" id="7473509">(</span><span class="string" id="7473510">&#34;PacketConn.ReadFrom&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7473542">,</span>&nbsp;<span class="ident" id="7473544">err</span><span class="op" id="7473547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7473552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7473557">//&nbsp;See&nbsp;BUG&nbsp;section.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7473580">//if&nbsp;net&nbsp;==&nbsp;&#34;ip4&#34;&nbsp;{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7473603">//&nbsp;&nbsp;&nbsp;&nbsprb&nbsp;=&nbsp;ipv4Payload(rb)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7473630">//}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7473637">if</span>&nbsp;<span class="ident" id="7473640">m</span><span class="op" id="7473641">,</span>&nbsp;<span class="ident" id="7473643">err</span>&nbsp;<span class="op" id="7473647">=</span>&nbsp;<span class="ident" id="7473649">parseICMPMessage</span><span class="op" id="7473665">(</span><span class="ident" id="7473666">rb</span><span class="op" id="7473668">)</span><span class="op" id="7473669">;</span>&nbsp;<span class="ident" id="7473671">err</span>&nbsp;<span class="op" id="7473675">!=</span>&nbsp;<span class="ident" id="7473678">nil</span>&nbsp;<span class="op" id="7473682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7473688">t</span><span class="op" id="7473689">.</span><span class="ident" id="7473690">Fatalf</span><span class="op" id="7473696">(</span><span class="string" id="7473697">&#34;parseICMPMessage&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7473726">,</span>&nbsp;<span class="ident" id="7473728">err</span><span class="op" id="7473731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7473736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7473741">switch</span>&nbsp;<span class="ident" id="7473748">m</span><span class="op" id="7473749">.</span><span class="ident" id="7473750">Type</span>&nbsp;<span class="op" id="7473755">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7473760">case</span>&nbsp;<span class="ident" id="7473765">icmpv4EchoRequest</span><span class="op" id="7473782">,</span>&nbsp;<span class="ident" id="7473784">icmpv6EchoRequest</span><span class="op" id="7473801">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7473807">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7473819">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7473824">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7473832">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7473836">switch</span>&nbsp;<span class="ident" id="7473843">p</span>&nbsp;<span class="op" id="7473845">:=</span>&nbsp;<span class="ident" id="7473848">m</span><span class="op" id="7473849">.</span><span class="ident" id="7473850">Body</span><span class="op" id="7473854">.</span><span class="op" id="7473855">(</span><span class="keyword" id="7473856">type</span><span class="op" id="7473860">)</span>&nbsp;<span class="op" id="7473862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7473866">case</span>&nbsp;<span class="op" id="7473871">*</span><span class="ident" id="7473872">icmpEcho</span><span class="op" id="7473880">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7473885">if</span>&nbsp;<span class="ident" id="7473888">p</span><span class="op" id="7473889">.</span><span class="ident" id="7473890">ID</span>&nbsp;<span class="op" id="7473893">!=</span>&nbsp;<span class="ident" id="7473896">xid</span>&nbsp;<span class="op" id="7473900">||</span>&nbsp;<span class="ident" id="7473903">p</span><span class="op" id="7473904">.</span><span class="ident" id="7473905">Seq</span>&nbsp;<span class="op" id="7473909">!=</span>&nbsp;<span class="ident" id="7473912">xseq</span>&nbsp;<span class="op" id="7473917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7473923">t</span><span class="op" id="7473924">.</span><span class="ident" id="7473925">Fatalf</span><span class="op" id="7473931">(</span><span class="string" id="7473932">&#34;got&nbsp;id=%v,&nbsp;seqnum=%v;&nbsp;expected&nbsp;id=%v,&nbsp;seqnum=%v&#34;</span><span class="op" id="7473981">,</span>&nbsp;<span class="ident" id="7473983">p</span><span class="op" id="7473984">.</span><span class="ident" id="7473985">ID</span><span class="op" id="7473987">,</span>&nbsp;<span class="ident" id="7473989">p</span><span class="op" id="7473990">.</span><span class="ident" id="7473991">Seq</span><span class="op" id="7473994">,</span>&nbsp;<span class="ident" id="7473996">xid</span><span class="op" id="7473999">,</span>&nbsp;<span class="ident" id="7474001">xseq</span><span class="op" id="7474005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7474010">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7474014">default</span><span class="op" id="7474021">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7474026">t</span><span class="op" id="7474027">.</span><span class="ident" id="7474028">Fatalf</span><span class="op" id="7474034">(</span><span class="string" id="7474035">&#34;got&nbsp;type=%v,&nbsp;code=%v;&nbsp;expected&nbsp;type=%v,&nbsp;code=%v&#34;</span><span class="op" id="7474084">,</span>&nbsp;<span class="ident" id="7474086">m</span><span class="op" id="7474087">.</span><span class="ident" id="7474088">Type</span><span class="op" id="7474092">,</span>&nbsp;<span class="ident" id="7474094">m</span><span class="op" id="7474095">.</span><span class="ident" id="7474096">Code</span><span class="op" id="7474100">,</span>&nbsp;<span class="ident" id="7474102">typ</span><span class="op" id="7474105">,</span>&nbsp;<span class="num" id="7474107">0</span><span class="op" id="7474108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7474112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7474115">}</span><br>
<span class="lineno"></span><span class="op" id="7474117">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="keyword" id="7474120">func</span>&nbsp;<span class="ident" id="7474125">ipv4Payload</span><span class="op" id="7474136">(</span><span class="ident" id="7474137">b</span>&nbsp;<span class="op" id="7474139">[</span><span class="op" id="7474140">]</span><span class="builtintype" id="7474141">byte</span><span class="op" id="7474145">)</span>&nbsp;<span class="op" id="7474147">[</span><span class="op" id="7474148">]</span><span class="builtintype" id="7474149">byte</span>&nbsp;<span class="op" id="7474154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7474157">if</span>&nbsp;<span class="builtinfunc" id="7474160">len</span><span class="op" id="7474163">(</span><span class="ident" id="7474164">b</span><span class="op" id="7474165">)</span>&nbsp;<span class="op" id="7474167">&lt;</span>&nbsp;<span class="num" id="7474169">20</span>&nbsp;<span class="op" id="7474172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7474176">return</span>&nbsp;<span class="ident" id="7474183">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7474186">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7474189">hdrlen</span>&nbsp;<span class="op" id="7474196">:=</span>&nbsp;<span class="builtintype" id="7474199">int</span><span class="op" id="7474202">(</span><span class="ident" id="7474203">b</span><span class="op" id="7474204">[</span><span class="num" id="7474205">0</span><span class="op" id="7474206">]</span><span class="op" id="7474207">&amp;</span><span class="num" id="7474208">0x0f</span><span class="op" id="7474212">)</span>&nbsp;<span class="op" id="7474214">&lt;&lt;</span>&nbsp;<span class="num" id="7474217">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7474220">return</span>&nbsp;<span class="ident" id="7474227">b</span><span class="op" id="7474228">[</span><span class="ident" id="7474229">hdrlen</span><span class="op" id="7474235">:</span><span class="op" id="7474236">]</span><br>
<span class="lineno"></span><span class="op" id="7474238">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7474241">var</span>&nbsp;<span class="ident" id="7474245">ipConnLocalNameTests</span>&nbsp;<span class="op" id="7474266">=</span>&nbsp;<span class="op" id="7474268">[</span><span class="op" id="7474269">]</span><span class="keyword" id="7474270">struct</span>&nbsp;<span class="op" id="7474277">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7474280">net</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7474286">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7474294">laddr</span>&nbsp;<span class="op" id="7474300">*</span><span class="ident" id="7474301">IPAddr</span><br>
<span class="lineno"></span><span class="op" id="7474308">}</span><span class="op" id="7474309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7474312">{</span><span class="string" id="7474313">&#34;ip4:icmp&#34;</span><span class="op" id="7474323">,</span>&nbsp;<span class="op" id="7474325">&amp;</span><span class="ident" id="7474326">IPAddr</span><span class="op" id="7474332">{</span><span class="ident" id="7474333">IP</span><span class="op" id="7474335">:</span>&nbsp;<span class="ident" id="7474337">IPv4</span><span class="op" id="7474341">(</span><span class="num" id="7474342">127</span><span class="op" id="7474345">,</span>&nbsp;<span class="num" id="7474347">0</span><span class="op" id="7474348">,</span>&nbsp;<span class="num" id="7474350">0</span><span class="op" id="7474351">,</span>&nbsp;<span class="num" id="7474353">1</span><span class="op" id="7474354">)</span><span class="op" id="7474355">}</span><span class="op" id="7474356">}</span><span class="op" id="7474357">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7474360">{</span><span class="string" id="7474361">&#34;ip4:icmp&#34;</span><span class="op" id="7474371">,</span>&nbsp;<span class="op" id="7474373">&amp;</span><span class="ident" id="7474374">IPAddr</span><span class="op" id="7474380">{</span><span class="op" id="7474381">}</span><span class="op" id="7474382">}</span><span class="op" id="7474383">,</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7474386">{</span><span class="string" id="7474387">&#34;ip4:icmp&#34;</span><span class="op" id="7474397">,</span>&nbsp;<span class="ident" id="7474399">nil</span><span class="op" id="7474402">}</span><span class="op" id="7474403">,</span><br>
<span class="lineno"></span><span class="op" id="7474405">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7474408">func</span>&nbsp;<span class="ident" id="7474413">TestIPConnLocalName</span><span class="op" id="7474432">(</span><span class="ident" id="7474433">t</span>&nbsp;<span class="op" id="7474435">*</span><span class="ident" id="7474436">testing</span><span class="op" id="7474443">.</span><span class="ident" id="7474444">T</span><span class="op" id="7474445">)</span>&nbsp;<span class="op" id="7474447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7474450">switch</span>&nbsp;<span class="ident" id="7474457">runtime</span><span class="op" id="7474464">.</span><span class="ident" id="7474465">GOOS</span>&nbsp;<span class="op" id="7474470">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7474473">case</span>&nbsp;<span class="string" id="7474478">&#34;nacl&#34;</span><span class="op" id="7474484">,</span>&nbsp;<span class="string" id="7474486">&#34;plan9&#34;</span><span class="op" id="7474493">,</span>&nbsp;<span class="string" id="7474495">&#34;windows&#34;</span><span class="op" id="7474504">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7474508">t</span><span class="op" id="7474509">.</span><span class="ident" id="7474510">Skipf</span><span class="op" id="7474515">(</span><span class="string" id="7474516">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7474537">,</span>&nbsp;<span class="ident" id="7474539">runtime</span><span class="op" id="7474546">.</span><span class="ident" id="7474547">GOOS</span><span class="op" id="7474551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7474554">default</span><span class="op" id="7474561">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7474565">if</span>&nbsp;<span class="ident" id="7474568">os</span><span class="op" id="7474570">.</span><span class="ident" id="7474571">Getuid</span><span class="op" id="7474577">(</span><span class="op" id="7474578">)</span>&nbsp;<span class="op" id="7474580">!=</span>&nbsp;<span class="num" id="7474583">0</span>&nbsp;<span class="op" id="7474585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7474590">t</span><span class="op" id="7474591">.</span><span class="ident" id="7474592">Skip</span><span class="op" id="7474596">(</span><span class="string" id="7474597">&#34;skipping&nbsp;test;&nbsp;must&nbsp;be&nbsp;root&#34;</span><span class="op" id="7474626">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7474630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7474633">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7474637">for</span>&nbsp;<span class="ident" id="7474641">_</span><span class="op" id="7474642">,</span>&nbsp;<span class="ident" id="7474644">tt</span>&nbsp;<span class="op" id="7474647">:=</span>&nbsp;<span class="keyword" id="7474650">range</span>&nbsp;<span class="ident" id="7474656">ipConnLocalNameTests</span>&nbsp;<span class="op" id="7474677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7474681">c</span><span class="op" id="7474682">,</span>&nbsp;<span class="ident" id="7474684">err</span>&nbsp;<span class="op" id="7474688">:=</span>&nbsp;<span class="ident" id="7474691">ListenIP</span><span class="op" id="7474699">(</span><span class="ident" id="7474700">tt</span><span class="op" id="7474702">.</span><span class="ident" id="7474703">net</span><span class="op" id="7474706">,</span>&nbsp;<span class="ident" id="7474708">tt</span><span class="op" id="7474710">.</span><span class="ident" id="7474711">laddr</span><span class="op" id="7474716">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7474720">if</span>&nbsp;<span class="ident" id="7474723">err</span>&nbsp;<span class="op" id="7474727">!=</span>&nbsp;<span class="ident" id="7474730">nil</span>&nbsp;<span class="op" id="7474734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7474739">t</span><span class="op" id="7474740">.</span><span class="ident" id="7474741">Fatalf</span><span class="op" id="7474747">(</span><span class="string" id="7474748">&#34;ListenIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7474769">,</span>&nbsp;<span class="ident" id="7474771">err</span><span class="op" id="7474774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7474778">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7474782">defer</span>&nbsp;<span class="ident" id="7474788">c</span><span class="op" id="7474789">.</span><span class="ident" id="7474790">Close</span><span class="op" id="7474795">(</span><span class="op" id="7474796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7474800">if</span>&nbsp;<span class="ident" id="7474803">la</span>&nbsp;<span class="op" id="7474806">:=</span>&nbsp;<span class="ident" id="7474809">c</span><span class="op" id="7474810">.</span><span class="ident" id="7474811">LocalAddr</span><span class="op" id="7474820">(</span><span class="op" id="7474821">)</span><span class="op" id="7474822">;</span>&nbsp;<span class="ident" id="7474824">la</span>&nbsp;<span class="op" id="7474827">==</span>&nbsp;<span class="ident" id="7474830">nil</span>&nbsp;<span class="op" id="7474834">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7474839">t</span><span class="op" id="7474840">.</span><span class="ident" id="7474841">Fatal</span><span class="op" id="7474846">(</span><span class="string" id="7474847">&#34;IPConn.LocalAddr&nbsp;failed&#34;</span><span class="op" id="7474872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7474876">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7474879">}</span><br>
<span class="lineno"></span><span class="op" id="7474881">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span><span class="keyword" id="7474884">func</span>&nbsp;<span class="ident" id="7474889">TestIPConnRemoteName</span><span class="op" id="7474909">(</span><span class="ident" id="7474910">t</span>&nbsp;<span class="op" id="7474912">*</span><span class="ident" id="7474913">testing</span><span class="op" id="7474920">.</span><span class="ident" id="7474921">T</span><span class="op" id="7474922">)</span>&nbsp;<span class="op" id="7474924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7474927">switch</span>&nbsp;<span class="ident" id="7474934">runtime</span><span class="op" id="7474941">.</span><span class="ident" id="7474942">GOOS</span>&nbsp;<span class="op" id="7474947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7474950">case</span>&nbsp;<span class="string" id="7474955">&#34;plan9&#34;</span><span class="op" id="7474962">,</span>&nbsp;<span class="string" id="7474964">&#34;windows&#34;</span><span class="op" id="7474973">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7474977">t</span><span class="op" id="7474978">.</span><span class="ident" id="7474979">Skipf</span><span class="op" id="7474984">(</span><span class="string" id="7474985">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7475006">,</span>&nbsp;<span class="ident" id="7475008">runtime</span><span class="op" id="7475015">.</span><span class="ident" id="7475016">GOOS</span><span class="op" id="7475020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7475023">default</span><span class="op" id="7475030">:</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7475034">if</span>&nbsp;<span class="ident" id="7475037">os</span><span class="op" id="7475039">.</span><span class="ident" id="7475040">Getuid</span><span class="op" id="7475046">(</span><span class="op" id="7475047">)</span>&nbsp;<span class="op" id="7475049">!=</span>&nbsp;<span class="num" id="7475052">0</span>&nbsp;<span class="op" id="7475054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7475059">t</span><span class="op" id="7475060">.</span><span class="ident" id="7475061">Skip</span><span class="op" id="7475065">(</span><span class="string" id="7475066">&#34;skipping&nbsp;test;&nbsp;must&nbsp;be&nbsp;root&#34;</span><span class="op" id="7475095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7475099">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7475102">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7475106">raddr</span>&nbsp;<span class="op" id="7475112">:=</span>&nbsp;<span class="op" id="7475115">&amp;</span><span class="ident" id="7475116">IPAddr</span><span class="op" id="7475122">{</span><span class="ident" id="7475123">IP</span><span class="op" id="7475125">:</span>&nbsp;<span class="ident" id="7475127">IPv4</span><span class="op" id="7475131">(</span><span class="num" id="7475132">127</span><span class="op" id="7475135">,</span>&nbsp;<span class="num" id="7475137">0</span><span class="op" id="7475138">,</span>&nbsp;<span class="num" id="7475140">0</span><span class="op" id="7475141">,</span>&nbsp;<span class="num" id="7475143">1</span><span class="op" id="7475144">)</span><span class="op" id="7475145">.</span><span class="ident" id="7475146">To4</span><span class="op" id="7475149">(</span><span class="op" id="7475150">)</span><span class="op" id="7475151">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7475154">c</span><span class="op" id="7475155">,</span>&nbsp;<span class="ident" id="7475157">err</span>&nbsp;<span class="op" id="7475161">:=</span>&nbsp;<span class="ident" id="7475164">DialIP</span><span class="op" id="7475170">(</span><span class="string" id="7475171">&#34;ip:tcp&#34;</span><span class="op" id="7475179">,</span>&nbsp;<span class="op" id="7475181">&amp;</span><span class="ident" id="7475182">IPAddr</span><span class="op" id="7475188">{</span><span class="ident" id="7475189">IP</span><span class="op" id="7475191">:</span>&nbsp;<span class="ident" id="7475193">IPv4</span><span class="op" id="7475197">(</span><span class="num" id="7475198">127</span><span class="op" id="7475201">,</span>&nbsp;<span class="num" id="7475203">0</span><span class="op" id="7475204">,</span>&nbsp;<span class="num" id="7475206">0</span><span class="op" id="7475207">,</span>&nbsp;<span class="num" id="7475209">1</span><span class="op" id="7475210">)</span><span class="op" id="7475211">}</span><span class="op" id="7475212">,</span>&nbsp;<span class="ident" id="7475214">raddr</span><span class="op" id="7475219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7475222">if</span>&nbsp;<span class="ident" id="7475225">err</span>&nbsp;<span class="op" id="7475229">!=</span>&nbsp;<span class="ident" id="7475232">nil</span>&nbsp;<span class="op" id="7475236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7475240">t</span><span class="op" id="7475241">.</span><span class="ident" id="7475242">Fatalf</span><span class="op" id="7475248">(</span><span class="string" id="7475249">&#34;DialIP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7475268">,</span>&nbsp;<span class="ident" id="7475270">err</span><span class="op" id="7475273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7475276">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7475279">defer</span>&nbsp;<span class="ident" id="7475285">c</span><span class="op" id="7475286">.</span><span class="ident" id="7475287">Close</span><span class="op" id="7475292">(</span><span class="op" id="7475293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7475296">if</span>&nbsp;<span class="op" id="7475299">!</span><span class="ident" id="7475300">reflect</span><span class="op" id="7475307">.</span><span class="ident" id="7475308">DeepEqual</span><span class="op" id="7475317">(</span><span class="ident" id="7475318">raddr</span><span class="op" id="7475323">,</span>&nbsp;<span class="ident" id="7475325">c</span><span class="op" id="7475326">.</span><span class="ident" id="7475327">RemoteAddr</span><span class="op" id="7475337">(</span><span class="op" id="7475338">)</span><span class="op" id="7475339">)</span>&nbsp;<span class="op" id="7475341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7475345">t</span><span class="op" id="7475346">.</span><span class="ident" id="7475347">Fatalf</span><span class="op" id="7475353">(</span><span class="string" id="7475354">&#34;got&nbsp;%#v,&nbsp;expected&nbsp;%#v&#34;</span><span class="op" id="7475377">,</span>&nbsp;<span class="ident" id="7475379">c</span><span class="op" id="7475380">.</span><span class="ident" id="7475381">RemoteAddr</span><span class="op" id="7475391">(</span><span class="op" id="7475392">)</span><span class="op" id="7475393">,</span>&nbsp;<span class="ident" id="7475395">raddr</span><span class="op" id="7475400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7475403">}</span><br>
<span class="lineno"></span><span class="op" id="7475405">}</span>
</div>
</body>
</html>
