<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html" class="current">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3240737">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3240792">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3240846">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3240897">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;sysSocket&nbsp;and&nbsp;accept&nbsp;for&nbsp;platforms&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="3240961">//&nbsp;provide&nbsp;a&nbsp;fast&nbsp;path&nbsp;for&nbsp;setting&nbsp;SetNonblock&nbsp;and&nbsp;CloseOnExec.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3241026">//&nbsp;+build&nbsp;freebsd&nbsp;linux</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="3241051">package</span>&nbsp;<span class="ident" id="3241059">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3241064">import</span>&nbsp;<span class="string" id="3241071">&#34;syscall&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3241082">//&nbsp;Wrapper&nbsp;around&nbsp;the&nbsp;socket&nbsp;system&nbsp;call&nbsp;that&nbsp;marks&nbsp;the&nbsp;returned&nbsp;file</span><br>
<span class="lineno">15</span><span class="comment" id="3241152">//&nbsp;descriptor&nbsp;as&nbsp;nonblocking&nbsp;and&nbsp;close-on-exec.</span><br>
<span class="lineno"></span><span class="keyword" id="3241200">func</span>&nbsp;<span class="ident" id="3241205">sysSocket</span><span class="op" id="3241214">(</span><span class="ident" id="3241215">family</span><span class="op" id="3241221">,</span>&nbsp;<span class="ident" id="3241223">sotype</span><span class="op" id="3241229">,</span>&nbsp;<span class="ident" id="3241231">proto</span>&nbsp;<span class="builtintype" id="3241237">int</span><span class="op" id="3241240">)</span>&nbsp;<span class="op" id="3241242">(</span><span class="builtintype" id="3241243">int</span><span class="op" id="3241246">,</span>&nbsp;<span class="builtintype" id="3241248">error</span><span class="op" id="3241253">)</span>&nbsp;<span class="op" id="3241255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3241258">s</span><span class="op" id="3241259">,</span>&nbsp;<span class="ident" id="3241261">err</span>&nbsp;<span class="op" id="3241265">:=</span>&nbsp;<span class="ident" id="3241268">syscall</span><span class="op" id="3241275">.</span><span class="ident" id="3241276">Socket</span><span class="op" id="3241282">(</span><span class="ident" id="3241283">family</span><span class="op" id="3241289">,</span>&nbsp;<span class="ident" id="3241291">sotype</span><span class="op" id="3241297">|</span><span class="ident" id="3241298">syscall</span><span class="op" id="3241305">.</span><span class="ident" id="3241306">SOCK_NONBLOCK</span><span class="op" id="3241319">|</span><span class="ident" id="3241320">syscall</span><span class="op" id="3241327">.</span><span class="ident" id="3241328">SOCK_CLOEXEC</span><span class="op" id="3241340">,</span>&nbsp;<span class="ident" id="3241342">proto</span><span class="op" id="3241347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3241350">//&nbsp;On&nbsp;Linux&nbsp;the&nbsp;SOCK_NONBLOCK&nbsp;and&nbsp;SOCK_CLOEXEC&nbsp;flags&nbsp;were</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3241409">//&nbsp;introduced&nbsp;in&nbsp;2.6.27&nbsp;kernel&nbsp;and&nbsp;on&nbsp;FreeBSD&nbsp;both&nbsp;flags&nbsp;were</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3241472">//&nbsp;introduced&nbsp;in&nbsp;10&nbsp;kernel.&nbsp;If&nbsp;we&nbsp;get&nbsp;an&nbsp;EINVAL&nbsp;error&nbsp;on&nbsp;Linux</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3241536">//&nbsp;or&nbsp;EPROTONOSUPPORT&nbsp;error&nbsp;on&nbsp;FreeBSD,&nbsp;fall&nbsp;back&nbsp;to&nbsp;using</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3241596">//&nbsp;socket&nbsp;without&nbsp;them.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3241621">if</span>&nbsp;<span class="ident" id="3241624">err</span>&nbsp;<span class="op" id="3241628">==</span>&nbsp;<span class="ident" id="3241631">nil</span>&nbsp;<span class="op" id="3241635">||</span>&nbsp;<span class="op" id="3241638">(</span><span class="ident" id="3241639">err</span>&nbsp;<span class="op" id="3241643">!=</span>&nbsp;<span class="ident" id="3241646">syscall</span><span class="op" id="3241653">.</span><span class="ident" id="3241654">EPROTONOSUPPORT</span>&nbsp;<span class="op" id="3241670">&amp;&amp;</span>&nbsp;<span class="ident" id="3241673">err</span>&nbsp;<span class="op" id="3241677">!=</span>&nbsp;<span class="ident" id="3241680">syscall</span><span class="op" id="3241687">.</span><span class="ident" id="3241688">EINVAL</span><span class="op" id="3241694">)</span>&nbsp;<span class="op" id="3241696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3241700">return</span>&nbsp;<span class="ident" id="3241707">s</span><span class="op" id="3241708">,</span>&nbsp;<span class="ident" id="3241710">err</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3241715">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3241719">//&nbsp;See&nbsp;../syscall/exec_unix.go&nbsp;for&nbsp;description&nbsp;of&nbsp;ForkLock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3241780">syscall</span><span class="op" id="3241787">.</span><span class="ident" id="3241788">ForkLock</span><span class="op" id="3241796">.</span><span class="ident" id="3241797">RLock</span><span class="op" id="3241802">(</span><span class="op" id="3241803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3241806">s</span><span class="op" id="3241807">,</span>&nbsp;<span class="ident" id="3241809">err</span>&nbsp;<span class="op" id="3241813">=</span>&nbsp;<span class="ident" id="3241815">syscall</span><span class="op" id="3241822">.</span><span class="ident" id="3241823">Socket</span><span class="op" id="3241829">(</span><span class="ident" id="3241830">family</span><span class="op" id="3241836">,</span>&nbsp;<span class="ident" id="3241838">sotype</span><span class="op" id="3241844">,</span>&nbsp;<span class="ident" id="3241846">proto</span><span class="op" id="3241851">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3241854">if</span>&nbsp;<span class="ident" id="3241857">err</span>&nbsp;<span class="op" id="3241861">==</span>&nbsp;<span class="ident" id="3241864">nil</span>&nbsp;<span class="op" id="3241868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3241872">syscall</span><span class="op" id="3241879">.</span><span class="ident" id="3241880">CloseOnExec</span><span class="op" id="3241891">(</span><span class="ident" id="3241892">s</span><span class="op" id="3241893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3241896">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3241899">syscall</span><span class="op" id="3241906">.</span><span class="ident" id="3241907">ForkLock</span><span class="op" id="3241915">.</span><span class="ident" id="3241916">RUnlock</span><span class="op" id="3241923">(</span><span class="op" id="3241924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3241927">if</span>&nbsp;<span class="ident" id="3241930">err</span>&nbsp;<span class="op" id="3241934">!=</span>&nbsp;<span class="ident" id="3241937">nil</span>&nbsp;<span class="op" id="3241941">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3241945">return</span>&nbsp;<span class="op" id="3241952">-</span><span class="num" id="3241953">1</span><span class="op" id="3241954">,</span>&nbsp;<span class="ident" id="3241956">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3241961">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3241964">if</span>&nbsp;<span class="ident" id="3241967">err</span>&nbsp;<span class="op" id="3241971">=</span>&nbsp;<span class="ident" id="3241973">syscall</span><span class="op" id="3241980">.</span><span class="ident" id="3241981">SetNonblock</span><span class="op" id="3241992">(</span><span class="ident" id="3241993">s</span><span class="op" id="3241994">,</span>&nbsp;<span class="builtintype" id="3241996">true</span><span class="op" id="3242000">)</span><span class="op" id="3242001">;</span>&nbsp;<span class="ident" id="3242003">err</span>&nbsp;<span class="op" id="3242007">!=</span>&nbsp;<span class="ident" id="3242010">nil</span>&nbsp;<span class="op" id="3242014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3242018">syscall</span><span class="op" id="3242025">.</span><span class="ident" id="3242026">Close</span><span class="op" id="3242031">(</span><span class="ident" id="3242032">s</span><span class="op" id="3242033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3242037">return</span>&nbsp;<span class="op" id="3242044">-</span><span class="num" id="3242045">1</span><span class="op" id="3242046">,</span>&nbsp;<span class="ident" id="3242048">err</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3242053">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3242056">return</span>&nbsp;<span class="ident" id="3242063">s</span><span class="op" id="3242064">,</span>&nbsp;<span class="ident" id="3242066">nil</span><br>
<span class="lineno"></span><span class="op" id="3242070">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3242073">//&nbsp;Wrapper&nbsp;around&nbsp;the&nbsp;accept&nbsp;system&nbsp;call&nbsp;that&nbsp;marks&nbsp;the&nbsp;returned&nbsp;file</span><br>
<span class="lineno">45</span><span class="comment" id="3242143">//&nbsp;descriptor&nbsp;as&nbsp;nonblocking&nbsp;and&nbsp;close-on-exec.</span><br>
<span class="lineno"></span><span class="keyword" id="3242191">func</span>&nbsp;<span class="ident" id="3242196">accept</span><span class="op" id="3242202">(</span><span class="ident" id="3242203">s</span>&nbsp;<span class="builtintype" id="3242205">int</span><span class="op" id="3242208">)</span>&nbsp;<span class="op" id="3242210">(</span><span class="builtintype" id="3242211">int</span><span class="op" id="3242214">,</span>&nbsp;<span class="ident" id="3242216">syscall</span><span class="op" id="3242223">.</span><span class="ident" id="3242224">Sockaddr</span><span class="op" id="3242232">,</span>&nbsp;<span class="builtintype" id="3242234">error</span><span class="op" id="3242239">)</span>&nbsp;<span class="op" id="3242241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3242244">ns</span><span class="op" id="3242246">,</span>&nbsp;<span class="ident" id="3242248">sa</span><span class="op" id="3242250">,</span>&nbsp;<span class="ident" id="3242252">err</span>&nbsp;<span class="op" id="3242256">:=</span>&nbsp;<span class="ident" id="3242259">syscall</span><span class="op" id="3242266">.</span><span class="ident" id="3242267">Accept4</span><span class="op" id="3242274">(</span><span class="ident" id="3242275">s</span><span class="op" id="3242276">,</span>&nbsp;<span class="ident" id="3242278">syscall</span><span class="op" id="3242285">.</span><span class="ident" id="3242286">SOCK_NONBLOCK</span><span class="op" id="3242299">|</span><span class="ident" id="3242300">syscall</span><span class="op" id="3242307">.</span><span class="ident" id="3242308">SOCK_CLOEXEC</span><span class="op" id="3242320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3242323">//&nbsp;On&nbsp;Linux&nbsp;the&nbsp;accept4&nbsp;system&nbsp;call&nbsp;was&nbsp;introduced&nbsp;in&nbsp;2.6.28</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3242385">//&nbsp;kernel&nbsp;and&nbsp;on&nbsp;FreeBSD&nbsp;it&nbsp;was&nbsp;introduced&nbsp;in&nbsp;10&nbsp;kernel.&nbsp;If&nbsp;we</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3242449">//&nbsp;get&nbsp;an&nbsp;ENOSYS&nbsp;error&nbsp;on&nbsp;both&nbsp;Linux&nbsp;and&nbsp;FreeBSD,&nbsp;or&nbsp;EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3242510">//&nbsp;error&nbsp;on&nbsp;Linux,&nbsp;fall&nbsp;back&nbsp;to&nbsp;using&nbsp;accept.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3242557">switch</span>&nbsp;<span class="ident" id="3242564">err</span>&nbsp;<span class="op" id="3242568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3242571">default</span><span class="op" id="3242578">:</span>&nbsp;<span class="comment" id="3242580">//&nbsp;nil&nbsp;and&nbsp;errors&nbsp;other&nbsp;than&nbsp;the&nbsp;ones&nbsp;listed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3242627">return</span>&nbsp;<span class="ident" id="3242634">ns</span><span class="op" id="3242636">,</span>&nbsp;<span class="ident" id="3242638">sa</span><span class="op" id="3242640">,</span>&nbsp;<span class="ident" id="3242642">err</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3242647">case</span>&nbsp;<span class="ident" id="3242652">syscall</span><span class="op" id="3242659">.</span><span class="ident" id="3242660">ENOSYS</span><span class="op" id="3242666">:</span>&nbsp;<span class="comment" id="3242668">//&nbsp;syscall&nbsp;missing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3242688">case</span>&nbsp;<span class="ident" id="3242693">syscall</span><span class="op" id="3242700">.</span><span class="ident" id="3242701">EINVAL</span><span class="op" id="3242707">:</span>&nbsp;<span class="comment" id="3242709">//&nbsp;some&nbsp;Linux&nbsp;use&nbsp;this&nbsp;instead&nbsp;of&nbsp;ENOSYS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3242751">case</span>&nbsp;<span class="ident" id="3242756">syscall</span><span class="op" id="3242763">.</span><span class="ident" id="3242764">EACCES</span><span class="op" id="3242770">:</span>&nbsp;<span class="comment" id="3242772">//&nbsp;some&nbsp;Linux&nbsp;use&nbsp;this&nbsp;instead&nbsp;of&nbsp;ENOSYS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3242814">case</span>&nbsp;<span class="ident" id="3242819">syscall</span><span class="op" id="3242826">.</span><span class="ident" id="3242827">EFAULT</span><span class="op" id="3242833">:</span>&nbsp;<span class="comment" id="3242835">//&nbsp;some&nbsp;Linux&nbsp;use&nbsp;this&nbsp;instead&nbsp;of&nbsp;ENOSYS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3242877">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3242881">//&nbsp;See&nbsp;../syscall/exec_unix.go&nbsp;for&nbsp;description&nbsp;of&nbsp;ForkLock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3242942">//&nbsp;It&nbsp;is&nbsp;probably&nbsp;okay&nbsp;to&nbsp;hold&nbsp;the&nbsp;lock&nbsp;across&nbsp;syscall.Accept</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3243005">//&nbsp;because&nbsp;we&nbsp;have&nbsp;put&nbsp;fd.sysfd&nbsp;into&nbsp;non-blocking&nbsp;mode.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3243062">//&nbsp;However,&nbsp;a&nbsp;call&nbsp;to&nbsp;the&nbsp;File&nbsp;method&nbsp;will&nbsp;put&nbsp;it&nbsp;back&nbsp;into</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3243123">//&nbsp;blocking&nbsp;mode.&nbsp;We&nbsp;can&#39;t&nbsp;take&nbsp;that&nbsp;risk,&nbsp;so&nbsp;no&nbsp;use&nbsp;of&nbsp;ForkLock&nbsp;here.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3243195">ns</span><span class="op" id="3243197">,</span>&nbsp;<span class="ident" id="3243199">sa</span><span class="op" id="3243201">,</span>&nbsp;<span class="ident" id="3243203">err</span>&nbsp;<span class="op" id="3243207">=</span>&nbsp;<span class="ident" id="3243209">syscall</span><span class="op" id="3243216">.</span><span class="ident" id="3243217">Accept</span><span class="op" id="3243223">(</span><span class="ident" id="3243224">s</span><span class="op" id="3243225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3243228">if</span>&nbsp;<span class="ident" id="3243231">err</span>&nbsp;<span class="op" id="3243235">==</span>&nbsp;<span class="ident" id="3243238">nil</span>&nbsp;<span class="op" id="3243242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3243246">syscall</span><span class="op" id="3243253">.</span><span class="ident" id="3243254">CloseOnExec</span><span class="op" id="3243265">(</span><span class="ident" id="3243266">ns</span><span class="op" id="3243268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3243271">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3243274">if</span>&nbsp;<span class="ident" id="3243277">err</span>&nbsp;<span class="op" id="3243281">!=</span>&nbsp;<span class="ident" id="3243284">nil</span>&nbsp;<span class="op" id="3243288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3243292">return</span>&nbsp;<span class="op" id="3243299">-</span><span class="num" id="3243300">1</span><span class="op" id="3243301">,</span>&nbsp;<span class="ident" id="3243303">nil</span><span class="op" id="3243306">,</span>&nbsp;<span class="ident" id="3243308">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3243313">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3243316">if</span>&nbsp;<span class="ident" id="3243319">err</span>&nbsp;<span class="op" id="3243323">=</span>&nbsp;<span class="ident" id="3243325">syscall</span><span class="op" id="3243332">.</span><span class="ident" id="3243333">SetNonblock</span><span class="op" id="3243344">(</span><span class="ident" id="3243345">ns</span><span class="op" id="3243347">,</span>&nbsp;<span class="builtintype" id="3243349">true</span><span class="op" id="3243353">)</span><span class="op" id="3243354">;</span>&nbsp;<span class="ident" id="3243356">err</span>&nbsp;<span class="op" id="3243360">!=</span>&nbsp;<span class="ident" id="3243363">nil</span>&nbsp;<span class="op" id="3243367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3243371">syscall</span><span class="op" id="3243378">.</span><span class="ident" id="3243379">Close</span><span class="op" id="3243384">(</span><span class="ident" id="3243385">ns</span><span class="op" id="3243387">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3243391">return</span>&nbsp;<span class="op" id="3243398">-</span><span class="num" id="3243399">1</span><span class="op" id="3243400">,</span>&nbsp;<span class="ident" id="3243402">nil</span><span class="op" id="3243405">,</span>&nbsp;<span class="ident" id="3243407">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3243412">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3243415">return</span>&nbsp;<span class="ident" id="3243422">ns</span><span class="op" id="3243424">,</span>&nbsp;<span class="ident" id="3243426">sa</span><span class="op" id="3243428">,</span>&nbsp;<span class="ident" id="3243430">nil</span><br>
<span class="lineno"></span><span class="op" id="3243434">}</span>
</div>
</body>
</html>
