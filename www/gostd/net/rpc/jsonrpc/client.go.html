<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6207790">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6207846">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6207900">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6207951">//&nbsp;Package&nbsp;jsonrpc&nbsp;implements&nbsp;a&nbsp;JSON-RPC&nbsp;ClientCodec&nbsp;and&nbsp;ServerCodec</span><br>
<span class="lineno"></span><span class="comment" id="6208020">//&nbsp;for&nbsp;the&nbsp;rpc&nbsp;package.</span><br>
<span class="lineno"></span><span class="keyword" id="6208044">package</span>&nbsp;<span class="ident" id="6208052">jsonrpc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6208061">import</span>&nbsp;<span class="op" id="6208068">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6208071">&#34;encoding/json&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6208088">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6208095">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6208101">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6208108">&#34;net/rpc&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6208119">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="6208126">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6208129">type</span>&nbsp;<span class="ident" id="6208134">clientCodec</span>&nbsp;<span class="keyword" id="6208146">struct</span>&nbsp;<span class="op" id="6208153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6208156">dec</span>&nbsp;<span class="op" id="6208160">*</span><span class="ident" id="6208161">json</span><span class="op" id="6208165">.</span><span class="ident" id="6208166">Decoder</span>&nbsp;<span class="comment" id="6208174">//&nbsp;for&nbsp;reading&nbsp;JSON&nbsp;values</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6208202">enc</span>&nbsp;<span class="op" id="6208206">*</span><span class="ident" id="6208207">json</span><span class="op" id="6208211">.</span><span class="ident" id="6208212">Encoder</span>&nbsp;<span class="comment" id="6208220">//&nbsp;for&nbsp;writing&nbsp;JSON&nbsp;values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6208248">c</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6208252">io</span><span class="op" id="6208254">.</span><span class="ident" id="6208255">Closer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6208264">//&nbsp;temporary&nbsp;work&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6208289">req</span>&nbsp;&nbsp;<span class="ident" id="6208294">clientRequest</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6208309">resp</span>&nbsp;<span class="ident" id="6208314">clientResponse</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6208331">//&nbsp;JSON-RPC&nbsp;responses&nbsp;include&nbsp;the&nbsp;request&nbsp;id&nbsp;but&nbsp;not&nbsp;the&nbsp;request&nbsp;method.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6208405">//&nbsp;Package&nbsp;rpc&nbsp;expects&nbsp;both.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6208435">//&nbsp;We&nbsp;save&nbsp;the&nbsp;request&nbsp;method&nbsp;in&nbsp;pending&nbsp;when&nbsp;sending&nbsp;a&nbsp;request</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6208500">//&nbsp;and&nbsp;then&nbsp;look&nbsp;it&nbsp;up&nbsp;by&nbsp;request&nbsp;ID&nbsp;when&nbsp;filling&nbsp;out&nbsp;the&nbsp;rpc&nbsp;Response.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6208573">mutex</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6208581">sync</span><span class="op" id="6208585">.</span><span class="ident" id="6208586">Mutex</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6208599">//&nbsp;protects&nbsp;pending</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6208620">pending</span>&nbsp;<span class="keyword" id="6208628">map</span><span class="op" id="6208631">[</span><span class="ident" id="6208632">uint64</span><span class="op" id="6208638">]</span><span class="builtintype" id="6208639">string</span>&nbsp;<span class="comment" id="6208646">//&nbsp;map&nbsp;request&nbsp;id&nbsp;to&nbsp;method&nbsp;name</span><br>
<span class="lineno"></span><span class="op" id="6208679">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="6208682">//&nbsp;NewClientCodec&nbsp;returns&nbsp;a&nbsp;new&nbsp;rpc.ClientCodec&nbsp;using&nbsp;JSON-RPC&nbsp;on&nbsp;conn.</span><br>
<span class="lineno"></span><span class="keyword" id="6208754">func</span>&nbsp;<span class="ident" id="6208759">NewClientCodec</span><span class="op" id="6208773">(</span><span class="ident" id="6208774">conn</span>&nbsp;<span class="ident" id="6208779">io</span><span class="op" id="6208781">.</span><span class="ident" id="6208782">ReadWriteCloser</span><span class="op" id="6208797">)</span>&nbsp;<span class="ident" id="6208799">rpc</span><span class="op" id="6208802">.</span><span class="ident" id="6208803">ClientCodec</span>&nbsp;<span class="op" id="6208815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6208818">return</span>&nbsp;<span class="op" id="6208825">&amp;</span><span class="ident" id="6208826">clientCodec</span><span class="op" id="6208837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6208841">dec</span><span class="op" id="6208844">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6208850">json</span><span class="op" id="6208854">.</span><span class="ident" id="6208855">NewDecoder</span><span class="op" id="6208865">(</span><span class="ident" id="6208866">conn</span><span class="op" id="6208870">)</span><span class="op" id="6208871">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6208875">enc</span><span class="op" id="6208878">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6208884">json</span><span class="op" id="6208888">.</span><span class="ident" id="6208889">NewEncoder</span><span class="op" id="6208899">(</span><span class="ident" id="6208900">conn</span><span class="op" id="6208904">)</span><span class="op" id="6208905">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6208909">c</span><span class="op" id="6208910">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6208918">conn</span><span class="op" id="6208922">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6208926">pending</span><span class="op" id="6208933">:</span>&nbsp;<span class="builtinfunc" id="6208935">make</span><span class="op" id="6208939">(</span><span class="keyword" id="6208940">map</span><span class="op" id="6208943">[</span><span class="ident" id="6208944">uint64</span><span class="op" id="6208950">]</span><span class="builtintype" id="6208951">string</span><span class="op" id="6208957">)</span><span class="op" id="6208958">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6208961">}</span><br>
<span class="lineno"></span><span class="op" id="6208963">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="6208966">type</span>&nbsp;<span class="ident" id="6208971">clientRequest</span>&nbsp;<span class="keyword" id="6208985">struct</span>&nbsp;<span class="op" id="6208992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6208995">Method</span>&nbsp;<span class="builtintype" id="6209002">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6209017">`json:&#34;method&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209034">Params</span>&nbsp;<span class="op" id="6209041">[</span><span class="num" id="6209042">1</span><span class="op" id="6209043">]</span><span class="keyword" id="6209044">interface</span><span class="op" id="6209053">{</span><span class="op" id="6209054">}</span>&nbsp;<span class="string" id="6209056">`json:&#34;params&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209073">Id</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6209080">uint64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6209095">`json:&#34;id&#34;`</span><br>
<span class="lineno"></span><span class="op" id="6209107">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="6209110">func</span>&nbsp;<span class="op" id="6209115">(</span><span class="ident" id="6209116">c</span>&nbsp;<span class="op" id="6209118">*</span><span class="ident" id="6209119">clientCodec</span><span class="op" id="6209130">)</span>&nbsp;<span class="ident" id="6209132">WriteRequest</span><span class="op" id="6209144">(</span><span class="ident" id="6209145">r</span>&nbsp;<span class="op" id="6209147">*</span><span class="ident" id="6209148">rpc</span><span class="op" id="6209151">.</span><span class="ident" id="6209152">Request</span><span class="op" id="6209159">,</span>&nbsp;<span class="ident" id="6209161">param</span>&nbsp;<span class="keyword" id="6209167">interface</span><span class="op" id="6209176">{</span><span class="op" id="6209177">}</span><span class="op" id="6209178">)</span>&nbsp;<span class="builtintype" id="6209180">error</span>&nbsp;<span class="op" id="6209186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209189">c</span><span class="op" id="6209190">.</span><span class="ident" id="6209191">mutex</span><span class="op" id="6209196">.</span><span class="ident" id="6209197">Lock</span><span class="op" id="6209201">(</span><span class="op" id="6209202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209205">c</span><span class="op" id="6209206">.</span><span class="ident" id="6209207">pending</span><span class="op" id="6209214">[</span><span class="ident" id="6209215">r</span><span class="op" id="6209216">.</span><span class="ident" id="6209217">Seq</span><span class="op" id="6209220">]</span>&nbsp;<span class="op" id="6209222">=</span>&nbsp;<span class="ident" id="6209224">r</span><span class="op" id="6209225">.</span><span class="ident" id="6209226">ServiceMethod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209241">c</span><span class="op" id="6209242">.</span><span class="ident" id="6209243">mutex</span><span class="op" id="6209248">.</span><span class="ident" id="6209249">Unlock</span><span class="op" id="6209255">(</span><span class="op" id="6209256">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209259">c</span><span class="op" id="6209260">.</span><span class="ident" id="6209261">req</span><span class="op" id="6209264">.</span><span class="ident" id="6209265">Method</span>&nbsp;<span class="op" id="6209272">=</span>&nbsp;<span class="ident" id="6209274">r</span><span class="op" id="6209275">.</span><span class="ident" id="6209276">ServiceMethod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209291">c</span><span class="op" id="6209292">.</span><span class="ident" id="6209293">req</span><span class="op" id="6209296">.</span><span class="ident" id="6209297">Params</span><span class="op" id="6209303">[</span><span class="num" id="6209304">0</span><span class="op" id="6209305">]</span>&nbsp;<span class="op" id="6209307">=</span>&nbsp;<span class="ident" id="6209309">param</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209316">c</span><span class="op" id="6209317">.</span><span class="ident" id="6209318">req</span><span class="op" id="6209321">.</span><span class="ident" id="6209322">Id</span>&nbsp;<span class="op" id="6209325">=</span>&nbsp;<span class="ident" id="6209327">r</span><span class="op" id="6209328">.</span><span class="ident" id="6209329">Seq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6209334">return</span>&nbsp;<span class="ident" id="6209341">c</span><span class="op" id="6209342">.</span><span class="ident" id="6209343">enc</span><span class="op" id="6209346">.</span><span class="ident" id="6209347">Encode</span><span class="op" id="6209353">(</span><span class="op" id="6209354">&amp;</span><span class="ident" id="6209355">c</span><span class="op" id="6209356">.</span><span class="ident" id="6209357">req</span><span class="op" id="6209360">)</span><br>
<span class="lineno"></span><span class="op" id="6209362">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="6209365">type</span>&nbsp;<span class="ident" id="6209370">clientResponse</span>&nbsp;<span class="keyword" id="6209385">struct</span>&nbsp;<span class="op" id="6209392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209395">Id</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6209402">uint64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6209419">`json:&#34;id&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209432">Result</span>&nbsp;<span class="op" id="6209439">*</span><span class="ident" id="6209440">json</span><span class="op" id="6209444">.</span><span class="ident" id="6209445">RawMessage</span>&nbsp;<span class="string" id="6209456">`json:&#34;result&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209473">Error</span>&nbsp;&nbsp;<span class="keyword" id="6209480">interface</span><span class="op" id="6209489">{</span><span class="op" id="6209490">}</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6209497">`json:&#34;error&#34;`</span><br>
<span class="lineno">65</span><span class="op" id="6209512">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6209515">func</span>&nbsp;<span class="op" id="6209520">(</span><span class="ident" id="6209521">r</span>&nbsp;<span class="op" id="6209523">*</span><span class="ident" id="6209524">clientResponse</span><span class="op" id="6209538">)</span>&nbsp;<span class="ident" id="6209540">reset</span><span class="op" id="6209545">(</span><span class="op" id="6209546">)</span>&nbsp;<span class="op" id="6209548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209551">r</span><span class="op" id="6209552">.</span><span class="ident" id="6209553">Id</span>&nbsp;<span class="op" id="6209556">=</span>&nbsp;<span class="num" id="6209558">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209561">r</span><span class="op" id="6209562">.</span><span class="ident" id="6209563">Result</span>&nbsp;<span class="op" id="6209570">=</span>&nbsp;<span class="ident" id="6209572">nil</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209577">r</span><span class="op" id="6209578">.</span><span class="ident" id="6209579">Error</span>&nbsp;<span class="op" id="6209585">=</span>&nbsp;<span class="ident" id="6209587">nil</span><br>
<span class="lineno"></span><span class="op" id="6209591">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6209594">func</span>&nbsp;<span class="op" id="6209599">(</span><span class="ident" id="6209600">c</span>&nbsp;<span class="op" id="6209602">*</span><span class="ident" id="6209603">clientCodec</span><span class="op" id="6209614">)</span>&nbsp;<span class="ident" id="6209616">ReadResponseHeader</span><span class="op" id="6209634">(</span><span class="ident" id="6209635">r</span>&nbsp;<span class="op" id="6209637">*</span><span class="ident" id="6209638">rpc</span><span class="op" id="6209641">.</span><span class="ident" id="6209642">Response</span><span class="op" id="6209650">)</span>&nbsp;<span class="builtintype" id="6209652">error</span>&nbsp;<span class="op" id="6209658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209661">c</span><span class="op" id="6209662">.</span><span class="ident" id="6209663">resp</span><span class="op" id="6209667">.</span><span class="ident" id="6209668">reset</span><span class="op" id="6209673">(</span><span class="op" id="6209674">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6209677">if</span>&nbsp;<span class="ident" id="6209680">err</span>&nbsp;<span class="op" id="6209684">:=</span>&nbsp;<span class="ident" id="6209687">c</span><span class="op" id="6209688">.</span><span class="ident" id="6209689">dec</span><span class="op" id="6209692">.</span><span class="ident" id="6209693">Decode</span><span class="op" id="6209699">(</span><span class="op" id="6209700">&amp;</span><span class="ident" id="6209701">c</span><span class="op" id="6209702">.</span><span class="ident" id="6209703">resp</span><span class="op" id="6209707">)</span><span class="op" id="6209708">;</span>&nbsp;<span class="ident" id="6209710">err</span>&nbsp;<span class="op" id="6209714">!=</span>&nbsp;<span class="ident" id="6209717">nil</span>&nbsp;<span class="op" id="6209721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6209725">return</span>&nbsp;<span class="ident" id="6209732">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6209737">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209741">c</span><span class="op" id="6209742">.</span><span class="ident" id="6209743">mutex</span><span class="op" id="6209748">.</span><span class="ident" id="6209749">Lock</span><span class="op" id="6209753">(</span><span class="op" id="6209754">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209757">r</span><span class="op" id="6209758">.</span><span class="ident" id="6209759">ServiceMethod</span>&nbsp;<span class="op" id="6209773">=</span>&nbsp;<span class="ident" id="6209775">c</span><span class="op" id="6209776">.</span><span class="ident" id="6209777">pending</span><span class="op" id="6209784">[</span><span class="ident" id="6209785">c</span><span class="op" id="6209786">.</span><span class="ident" id="6209787">resp</span><span class="op" id="6209791">.</span><span class="ident" id="6209792">Id</span><span class="op" id="6209794">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6209797">delete</span><span class="op" id="6209803">(</span><span class="ident" id="6209804">c</span><span class="op" id="6209805">.</span><span class="ident" id="6209806">pending</span><span class="op" id="6209813">,</span>&nbsp;<span class="ident" id="6209815">c</span><span class="op" id="6209816">.</span><span class="ident" id="6209817">resp</span><span class="op" id="6209821">.</span><span class="ident" id="6209822">Id</span><span class="op" id="6209824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209827">c</span><span class="op" id="6209828">.</span><span class="ident" id="6209829">mutex</span><span class="op" id="6209834">.</span><span class="ident" id="6209835">Unlock</span><span class="op" id="6209841">(</span><span class="op" id="6209842">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209846">r</span><span class="op" id="6209847">.</span><span class="ident" id="6209848">Error</span>&nbsp;<span class="op" id="6209854">=</span>&nbsp;<span class="string" id="6209856">&#34;&#34;</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209860">r</span><span class="op" id="6209861">.</span><span class="ident" id="6209862">Seq</span>&nbsp;<span class="op" id="6209866">=</span>&nbsp;<span class="ident" id="6209868">c</span><span class="op" id="6209869">.</span><span class="ident" id="6209870">resp</span><span class="op" id="6209874">.</span><span class="ident" id="6209875">Id</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6209879">if</span>&nbsp;<span class="ident" id="6209882">c</span><span class="op" id="6209883">.</span><span class="ident" id="6209884">resp</span><span class="op" id="6209888">.</span><span class="ident" id="6209889">Error</span>&nbsp;<span class="op" id="6209895">!=</span>&nbsp;<span class="ident" id="6209898">nil</span>&nbsp;<span class="op" id="6209902">||</span>&nbsp;<span class="ident" id="6209905">c</span><span class="op" id="6209906">.</span><span class="ident" id="6209907">resp</span><span class="op" id="6209911">.</span><span class="ident" id="6209912">Result</span>&nbsp;<span class="op" id="6209919">==</span>&nbsp;<span class="ident" id="6209922">nil</span>&nbsp;<span class="op" id="6209926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209930">x</span><span class="op" id="6209931">,</span>&nbsp;<span class="ident" id="6209933">ok</span>&nbsp;<span class="op" id="6209936">:=</span>&nbsp;<span class="ident" id="6209939">c</span><span class="op" id="6209940">.</span><span class="ident" id="6209941">resp</span><span class="op" id="6209945">.</span><span class="ident" id="6209946">Error</span><span class="op" id="6209951">.</span><span class="op" id="6209952">(</span><span class="builtintype" id="6209953">string</span><span class="op" id="6209959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6209963">if</span>&nbsp;<span class="op" id="6209966">!</span><span class="ident" id="6209967">ok</span>&nbsp;<span class="op" id="6209970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6209975">return</span>&nbsp;<span class="ident" id="6209982">fmt</span><span class="op" id="6209985">.</span><span class="ident" id="6209986">Errorf</span><span class="op" id="6209992">(</span><span class="string" id="6209993">&#34;invalid&nbsp;error&nbsp;%v&#34;</span><span class="op" id="6210011">,</span>&nbsp;<span class="ident" id="6210013">c</span><span class="op" id="6210014">.</span><span class="ident" id="6210015">resp</span><span class="op" id="6210019">.</span><span class="ident" id="6210020">Error</span><span class="op" id="6210025">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6210029">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6210033">if</span>&nbsp;<span class="ident" id="6210036">x</span>&nbsp;<span class="op" id="6210038">==</span>&nbsp;<span class="string" id="6210041">&#34;&#34;</span>&nbsp;<span class="op" id="6210044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6210049">x</span>&nbsp;<span class="op" id="6210051">=</span>&nbsp;<span class="string" id="6210053">&#34;unspecified&nbsp;error&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6210075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6210079">r</span><span class="op" id="6210080">.</span><span class="ident" id="6210081">Error</span>&nbsp;<span class="op" id="6210087">=</span>&nbsp;<span class="ident" id="6210089">x</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6210092">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6210095">return</span>&nbsp;<span class="ident" id="6210102">nil</span><br>
<span class="lineno"></span><span class="op" id="6210106">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6210109">func</span>&nbsp;<span class="op" id="6210114">(</span><span class="ident" id="6210115">c</span>&nbsp;<span class="op" id="6210117">*</span><span class="ident" id="6210118">clientCodec</span><span class="op" id="6210129">)</span>&nbsp;<span class="ident" id="6210131">ReadResponseBody</span><span class="op" id="6210147">(</span><span class="ident" id="6210148">x</span>&nbsp;<span class="keyword" id="6210150">interface</span><span class="op" id="6210159">{</span><span class="op" id="6210160">}</span><span class="op" id="6210161">)</span>&nbsp;<span class="builtintype" id="6210163">error</span>&nbsp;<span class="op" id="6210169">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6210172">if</span>&nbsp;<span class="ident" id="6210175">x</span>&nbsp;<span class="op" id="6210177">==</span>&nbsp;<span class="ident" id="6210180">nil</span>&nbsp;<span class="op" id="6210184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6210188">return</span>&nbsp;<span class="ident" id="6210195">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6210200">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6210203">return</span>&nbsp;<span class="ident" id="6210210">json</span><span class="op" id="6210214">.</span><span class="ident" id="6210215">Unmarshal</span><span class="op" id="6210224">(</span><span class="op" id="6210225">*</span><span class="ident" id="6210226">c</span><span class="op" id="6210227">.</span><span class="ident" id="6210228">resp</span><span class="op" id="6210232">.</span><span class="ident" id="6210233">Result</span><span class="op" id="6210239">,</span>&nbsp;<span class="ident" id="6210241">x</span><span class="op" id="6210242">)</span><br>
<span class="lineno"></span><span class="op" id="6210244">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="6210247">func</span>&nbsp;<span class="op" id="6210252">(</span><span class="ident" id="6210253">c</span>&nbsp;<span class="op" id="6210255">*</span><span class="ident" id="6210256">clientCodec</span><span class="op" id="6210267">)</span>&nbsp;<span class="ident" id="6210269">Close</span><span class="op" id="6210274">(</span><span class="op" id="6210275">)</span>&nbsp;<span class="builtintype" id="6210277">error</span>&nbsp;<span class="op" id="6210283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6210286">return</span>&nbsp;<span class="ident" id="6210293">c</span><span class="op" id="6210294">.</span><span class="ident" id="6210295">c</span><span class="op" id="6210296">.</span><span class="ident" id="6210297">Close</span><span class="op" id="6210302">(</span><span class="op" id="6210303">)</span><br>
<span class="lineno"></span><span class="op" id="6210305">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="6210308">//&nbsp;NewClient&nbsp;returns&nbsp;a&nbsp;new&nbsp;rpc.Client&nbsp;to&nbsp;handle&nbsp;requests&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6210372">//&nbsp;set&nbsp;of&nbsp;services&nbsp;at&nbsp;the&nbsp;other&nbsp;end&nbsp;of&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="6210427">func</span>&nbsp;<span class="ident" id="6210432">NewClient</span><span class="op" id="6210441">(</span><span class="ident" id="6210442">conn</span>&nbsp;<span class="ident" id="6210447">io</span><span class="op" id="6210449">.</span><span class="ident" id="6210450">ReadWriteCloser</span><span class="op" id="6210465">)</span>&nbsp;<span class="op" id="6210467">*</span><span class="ident" id="6210468">rpc</span><span class="op" id="6210471">.</span><span class="ident" id="6210472">Client</span>&nbsp;<span class="op" id="6210479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6210482">return</span>&nbsp;<span class="ident" id="6210489">rpc</span><span class="op" id="6210492">.</span><span class="ident" id="6210493">NewClientWithCodec</span><span class="op" id="6210511">(</span><span class="ident" id="6210512">NewClientCodec</span><span class="op" id="6210526">(</span><span class="ident" id="6210527">conn</span><span class="op" id="6210531">)</span><span class="op" id="6210532">)</span><br>
<span class="lineno"></span><span class="op" id="6210534">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="6210537">//&nbsp;Dial&nbsp;connects&nbsp;to&nbsp;a&nbsp;JSON-RPC&nbsp;server&nbsp;at&nbsp;the&nbsp;specified&nbsp;network&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="6210609">func</span>&nbsp;<span class="ident" id="6210614">Dial</span><span class="op" id="6210618">(</span><span class="ident" id="6210619">network</span><span class="op" id="6210626">,</span>&nbsp;<span class="ident" id="6210628">address</span>&nbsp;<span class="builtintype" id="6210636">string</span><span class="op" id="6210642">)</span>&nbsp;<span class="op" id="6210644">(</span><span class="op" id="6210645">*</span><span class="ident" id="6210646">rpc</span><span class="op" id="6210649">.</span><span class="ident" id="6210650">Client</span><span class="op" id="6210656">,</span>&nbsp;<span class="builtintype" id="6210658">error</span><span class="op" id="6210663">)</span>&nbsp;<span class="op" id="6210665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6210668">conn</span><span class="op" id="6210672">,</span>&nbsp;<span class="ident" id="6210674">err</span>&nbsp;<span class="op" id="6210678">:=</span>&nbsp;<span class="ident" id="6210681">net</span><span class="op" id="6210684">.</span><span class="ident" id="6210685">Dial</span><span class="op" id="6210689">(</span><span class="ident" id="6210690">network</span><span class="op" id="6210697">,</span>&nbsp;<span class="ident" id="6210699">address</span><span class="op" id="6210706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6210709">if</span>&nbsp;<span class="ident" id="6210712">err</span>&nbsp;<span class="op" id="6210716">!=</span>&nbsp;<span class="ident" id="6210719">nil</span>&nbsp;<span class="op" id="6210723">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6210727">return</span>&nbsp;<span class="ident" id="6210734">nil</span><span class="op" id="6210737">,</span>&nbsp;<span class="ident" id="6210739">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6210744">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6210747">return</span>&nbsp;<span class="ident" id="6210754">NewClient</span><span class="op" id="6210763">(</span><span class="ident" id="6210764">conn</span><span class="op" id="6210768">)</span><span class="op" id="6210769">,</span>&nbsp;<span class="ident" id="6210771">err</span><br>
<span class="lineno"></span><span class="op" id="6210775">}</span>
</div>
</body>
</html>
