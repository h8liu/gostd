<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>mime/multipart</h2>
<ul>
<li><a href="/gostd/mime/multipart/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/mime/multipart/formdata.go.html">formdata.go</a></li>
<li><a href="/gostd/mime/multipart/formdata_test.go.html">formdata_test.go</a></li>
<li><a href="/gostd/mime/multipart/multipart.go.html">multipart.go</a></li>
<li><a href="/gostd/mime/multipart/multipart_test.go.html">multipart_test.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable.go.html" class="current">quotedprintable.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable_test.go.html">quotedprintable_test.go</a></li>
<li><a href="/gostd/mime/multipart/writer.go.html">writer.go</a></li>
<li><a href="/gostd/mime/multipart/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3674676">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3674731">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3674785">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3674836">//&nbsp;The&nbsp;file&nbsp;define&nbsp;a&nbsp;quoted-printable&nbsp;decoder,&nbsp;as&nbsp;specified&nbsp;in&nbsp;RFC&nbsp;2045.</span><br>
<span class="lineno"></span><span class="comment" id="3674909">//&nbsp;Deviations:</span><br>
<span class="lineno"></span><span class="comment" id="3674924">//&nbsp;1.&nbsp;in&nbsp;addition&nbsp;to&nbsp;&#34;=\r\n&#34;,&nbsp;&#34;=\n&#34;&nbsp;is&nbsp;also&nbsp;treated&nbsp;as&nbsp;soft&nbsp;line&nbsp;break.</span><br>
<span class="lineno"></span><span class="comment" id="3674996">//&nbsp;2.&nbsp;it&nbsp;will&nbsp;pass&nbsp;through&nbsp;a&nbsp;&#39;\r&#39;&nbsp;or&nbsp;&#39;\n&#39;&nbsp;not&nbsp;preceded&nbsp;by&nbsp;&#39;=&#39;,&nbsp;consistent</span><br>
<span class="lineno"></span><span class="comment" id="3675070">//&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;other&nbsp;broken&nbsp;QP&nbsp;encoders&nbsp;&amp;&nbsp;decoders.</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="3675119">package</span>&nbsp;<span class="ident" id="3675127">multipart</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3675138">import</span>&nbsp;<span class="op" id="3675145">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3675148">&#34;bufio&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3675157">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3675166">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3675173">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="3675178">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="3675181">type</span>&nbsp;<span class="ident" id="3675186">qpReader</span>&nbsp;<span class="keyword" id="3675195">struct</span>&nbsp;<span class="op" id="3675202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3675205">br</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3675210">*</span><span class="ident" id="3675211">bufio</span><span class="op" id="3675216">.</span><span class="ident" id="3675217">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3675225">rerr</span>&nbsp;<span class="builtintype" id="3675230">error</span>&nbsp;&nbsp;<span class="comment" id="3675237">//&nbsp;last&nbsp;read&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3675257">line</span>&nbsp;<span class="op" id="3675262">[</span><span class="op" id="3675263">]</span><span class="builtintype" id="3675264">byte</span>&nbsp;<span class="comment" id="3675269">//&nbsp;to&nbsp;be&nbsp;consumed&nbsp;before&nbsp;more&nbsp;of&nbsp;br</span><br>
<span class="lineno"></span><span class="op" id="3675305">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="3675308">func</span>&nbsp;<span class="ident" id="3675313">newQuotedPrintableReader</span><span class="op" id="3675337">(</span><span class="ident" id="3675338">r</span>&nbsp;<span class="ident" id="3675340">io</span><span class="op" id="3675342">.</span><span class="ident" id="3675343">Reader</span><span class="op" id="3675349">)</span>&nbsp;<span class="ident" id="3675351">io</span><span class="op" id="3675353">.</span><span class="ident" id="3675354">Reader</span>&nbsp;<span class="op" id="3675361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3675364">return</span>&nbsp;<span class="op" id="3675371">&amp;</span><span class="ident" id="3675372">qpReader</span><span class="op" id="3675380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3675384">br</span><span class="op" id="3675386">:</span>&nbsp;<span class="ident" id="3675388">bufio</span><span class="op" id="3675393">.</span><span class="ident" id="3675394">NewReader</span><span class="op" id="3675403">(</span><span class="ident" id="3675404">r</span><span class="op" id="3675405">)</span><span class="op" id="3675406">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3675409">}</span><br>
<span class="lineno">30</span><span class="op" id="3675411">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3675414">func</span>&nbsp;<span class="ident" id="3675419">fromHex</span><span class="op" id="3675426">(</span><span class="ident" id="3675427">b</span>&nbsp;<span class="builtintype" id="3675429">byte</span><span class="op" id="3675433">)</span>&nbsp;<span class="op" id="3675435">(</span><span class="builtintype" id="3675436">byte</span><span class="op" id="3675440">,</span>&nbsp;<span class="builtintype" id="3675442">error</span><span class="op" id="3675447">)</span>&nbsp;<span class="op" id="3675449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3675452">switch</span>&nbsp;<span class="op" id="3675459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3675462">case</span>&nbsp;<span class="ident" id="3675467">b</span>&nbsp;<span class="op" id="3675469">&gt;=</span>&nbsp;<span class="string" id="3675472">&#39;0&#39;</span>&nbsp;<span class="op" id="3675476">&amp;&amp;</span>&nbsp;<span class="ident" id="3675479">b</span>&nbsp;<span class="op" id="3675481">&lt;=</span>&nbsp;<span class="string" id="3675484">&#39;9&#39;</span><span class="op" id="3675487">:</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3675491">return</span>&nbsp;<span class="ident" id="3675498">b</span>&nbsp;<span class="op" id="3675500">-</span>&nbsp;<span class="string" id="3675502">&#39;0&#39;</span><span class="op" id="3675505">,</span>&nbsp;<span class="ident" id="3675507">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3675512">case</span>&nbsp;<span class="ident" id="3675517">b</span>&nbsp;<span class="op" id="3675519">&gt;=</span>&nbsp;<span class="string" id="3675522">&#39;A&#39;</span>&nbsp;<span class="op" id="3675526">&amp;&amp;</span>&nbsp;<span class="ident" id="3675529">b</span>&nbsp;<span class="op" id="3675531">&lt;=</span>&nbsp;<span class="string" id="3675534">&#39;F&#39;</span><span class="op" id="3675537">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3675541">return</span>&nbsp;<span class="ident" id="3675548">b</span>&nbsp;<span class="op" id="3675550">-</span>&nbsp;<span class="string" id="3675552">&#39;A&#39;</span>&nbsp;<span class="op" id="3675556">+</span>&nbsp;<span class="num" id="3675558">10</span><span class="op" id="3675560">,</span>&nbsp;<span class="ident" id="3675562">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3675567">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3675570">return</span>&nbsp;<span class="num" id="3675577">0</span><span class="op" id="3675578">,</span>&nbsp;<span class="ident" id="3675580">fmt</span><span class="op" id="3675583">.</span><span class="ident" id="3675584">Errorf</span><span class="op" id="3675590">(</span><span class="string" id="3675591">&#34;multipart:&nbsp;invalid&nbsp;quoted-printable&nbsp;hex&nbsp;byte&nbsp;0x%02x&#34;</span><span class="op" id="3675644">,</span>&nbsp;<span class="ident" id="3675646">b</span><span class="op" id="3675647">)</span><br>
<span class="lineno">40</span><span class="op" id="3675649">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3675652">func</span>&nbsp;<span class="op" id="3675657">(</span><span class="ident" id="3675658">q</span>&nbsp;<span class="op" id="3675660">*</span><span class="ident" id="3675661">qpReader</span><span class="op" id="3675669">)</span>&nbsp;<span class="ident" id="3675671">readHexByte</span><span class="op" id="3675682">(</span><span class="ident" id="3675683">v</span>&nbsp;<span class="op" id="3675685">[</span><span class="op" id="3675686">]</span><span class="builtintype" id="3675687">byte</span><span class="op" id="3675691">)</span>&nbsp;<span class="op" id="3675693">(</span><span class="ident" id="3675694">b</span>&nbsp;<span class="builtintype" id="3675696">byte</span><span class="op" id="3675700">,</span>&nbsp;<span class="ident" id="3675702">err</span>&nbsp;<span class="builtintype" id="3675706">error</span><span class="op" id="3675711">)</span>&nbsp;<span class="op" id="3675713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3675716">if</span>&nbsp;<span class="builtinfunc" id="3675719">len</span><span class="op" id="3675722">(</span><span class="ident" id="3675723">v</span><span class="op" id="3675724">)</span>&nbsp;<span class="op" id="3675726">&lt;</span>&nbsp;<span class="num" id="3675728">2</span>&nbsp;<span class="op" id="3675730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3675734">return</span>&nbsp;<span class="num" id="3675741">0</span><span class="op" id="3675742">,</span>&nbsp;<span class="ident" id="3675744">io</span><span class="op" id="3675746">.</span><span class="ident" id="3675747">ErrUnexpectedEOF</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3675765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3675768">var</span>&nbsp;<span class="ident" id="3675772">hb</span><span class="op" id="3675774">,</span>&nbsp;<span class="ident" id="3675776">lb</span>&nbsp;<span class="builtintype" id="3675779">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3675785">if</span>&nbsp;<span class="ident" id="3675788">hb</span><span class="op" id="3675790">,</span>&nbsp;<span class="ident" id="3675792">err</span>&nbsp;<span class="op" id="3675796">=</span>&nbsp;<span class="ident" id="3675798">fromHex</span><span class="op" id="3675805">(</span><span class="ident" id="3675806">v</span><span class="op" id="3675807">[</span><span class="num" id="3675808">0</span><span class="op" id="3675809">]</span><span class="op" id="3675810">)</span><span class="op" id="3675811">;</span>&nbsp;<span class="ident" id="3675813">err</span>&nbsp;<span class="op" id="3675817">!=</span>&nbsp;<span class="ident" id="3675820">nil</span>&nbsp;<span class="op" id="3675824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3675828">return</span>&nbsp;<span class="num" id="3675835">0</span><span class="op" id="3675836">,</span>&nbsp;<span class="ident" id="3675838">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3675843">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3675846">if</span>&nbsp;<span class="ident" id="3675849">lb</span><span class="op" id="3675851">,</span>&nbsp;<span class="ident" id="3675853">err</span>&nbsp;<span class="op" id="3675857">=</span>&nbsp;<span class="ident" id="3675859">fromHex</span><span class="op" id="3675866">(</span><span class="ident" id="3675867">v</span><span class="op" id="3675868">[</span><span class="num" id="3675869">1</span><span class="op" id="3675870">]</span><span class="op" id="3675871">)</span><span class="op" id="3675872">;</span>&nbsp;<span class="ident" id="3675874">err</span>&nbsp;<span class="op" id="3675878">!=</span>&nbsp;<span class="ident" id="3675881">nil</span>&nbsp;<span class="op" id="3675885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3675889">return</span>&nbsp;<span class="num" id="3675896">0</span><span class="op" id="3675897">,</span>&nbsp;<span class="ident" id="3675899">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3675904">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3675907">return</span>&nbsp;<span class="ident" id="3675914">hb</span><span class="op" id="3675916">&lt;&lt;</span><span class="num" id="3675918">4</span>&nbsp;<span class="op" id="3675920">|</span>&nbsp;<span class="ident" id="3675922">lb</span><span class="op" id="3675924">,</span>&nbsp;<span class="ident" id="3675926">nil</span><br>
<span class="lineno"></span><span class="op" id="3675930">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="keyword" id="3675933">func</span>&nbsp;<span class="ident" id="3675938">isQPDiscardWhitespace</span><span class="op" id="3675959">(</span><span class="ident" id="3675960">r</span>&nbsp;<span class="builtintype" id="3675962">rune</span><span class="op" id="3675966">)</span>&nbsp;<span class="builtintype" id="3675968">bool</span>&nbsp;<span class="op" id="3675973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3675976">switch</span>&nbsp;<span class="ident" id="3675983">r</span>&nbsp;<span class="op" id="3675985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3675988">case</span>&nbsp;<span class="string" id="3675993">&#39;\n&#39;</span><span class="op" id="3675997">,</span>&nbsp;<span class="string" id="3675999">&#39;\r&#39;</span><span class="op" id="3676003">,</span>&nbsp;<span class="string" id="3676005">&#39;&nbsp;&#39;</span><span class="op" id="3676008">,</span>&nbsp;<span class="string" id="3676010">&#39;\t&#39;</span><span class="op" id="3676014">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3676018">return</span>&nbsp;<span class="builtintype" id="3676025">true</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3676031">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3676034">return</span>&nbsp;<span class="builtintype" id="3676041">false</span><br>
<span class="lineno"></span><span class="op" id="3676047">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3676050">var</span>&nbsp;<span class="op" id="3676054">(</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3676057">crlf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3676068">=</span>&nbsp;<span class="op" id="3676070">[</span><span class="op" id="3676071">]</span><span class="builtintype" id="3676072">byte</span><span class="op" id="3676076">(</span><span class="string" id="3676077">&#34;\r\n&#34;</span><span class="op" id="3676083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3676086">lf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3676097">=</span>&nbsp;<span class="op" id="3676099">[</span><span class="op" id="3676100">]</span><span class="builtintype" id="3676101">byte</span><span class="op" id="3676105">(</span><span class="string" id="3676106">&#34;\n&#34;</span><span class="op" id="3676110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3676113">softSuffix</span>&nbsp;<span class="op" id="3676124">=</span>&nbsp;<span class="op" id="3676126">[</span><span class="op" id="3676127">]</span><span class="builtintype" id="3676128">byte</span><span class="op" id="3676132">(</span><span class="string" id="3676133">&#34;=&#34;</span><span class="op" id="3676136">)</span><br>
<span class="lineno"></span><span class="op" id="3676138">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="3676141">func</span>&nbsp;<span class="op" id="3676146">(</span><span class="ident" id="3676147">q</span>&nbsp;<span class="op" id="3676149">*</span><span class="ident" id="3676150">qpReader</span><span class="op" id="3676158">)</span>&nbsp;<span class="ident" id="3676160">Read</span><span class="op" id="3676164">(</span><span class="ident" id="3676165">p</span>&nbsp;<span class="op" id="3676167">[</span><span class="op" id="3676168">]</span><span class="builtintype" id="3676169">byte</span><span class="op" id="3676173">)</span>&nbsp;<span class="op" id="3676175">(</span><span class="ident" id="3676176">n</span>&nbsp;<span class="builtintype" id="3676178">int</span><span class="op" id="3676181">,</span>&nbsp;<span class="ident" id="3676183">err</span>&nbsp;<span class="builtintype" id="3676187">error</span><span class="op" id="3676192">)</span>&nbsp;<span class="op" id="3676194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3676197">for</span>&nbsp;<span class="builtinfunc" id="3676201">len</span><span class="op" id="3676204">(</span><span class="ident" id="3676205">p</span><span class="op" id="3676206">)</span>&nbsp;<span class="op" id="3676208">&gt;</span>&nbsp;<span class="num" id="3676210">0</span>&nbsp;<span class="op" id="3676212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3676216">if</span>&nbsp;<span class="builtinfunc" id="3676219">len</span><span class="op" id="3676222">(</span><span class="ident" id="3676223">q</span><span class="op" id="3676224">.</span><span class="ident" id="3676225">line</span><span class="op" id="3676229">)</span>&nbsp;<span class="op" id="3676231">==</span>&nbsp;<span class="num" id="3676234">0</span>&nbsp;<span class="op" id="3676236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3676241">if</span>&nbsp;<span class="ident" id="3676244">q</span><span class="op" id="3676245">.</span><span class="ident" id="3676246">rerr</span>&nbsp;<span class="op" id="3676251">!=</span>&nbsp;<span class="ident" id="3676254">nil</span>&nbsp;<span class="op" id="3676258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3676264">return</span>&nbsp;<span class="ident" id="3676271">n</span><span class="op" id="3676272">,</span>&nbsp;<span class="ident" id="3676274">q</span><span class="op" id="3676275">.</span><span class="ident" id="3676276">rerr</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3676284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3676289">q</span><span class="op" id="3676290">.</span><span class="ident" id="3676291">line</span><span class="op" id="3676295">,</span>&nbsp;<span class="ident" id="3676297">q</span><span class="op" id="3676298">.</span><span class="ident" id="3676299">rerr</span>&nbsp;<span class="op" id="3676304">=</span>&nbsp;<span class="ident" id="3676306">q</span><span class="op" id="3676307">.</span><span class="ident" id="3676308">br</span><span class="op" id="3676310">.</span><span class="ident" id="3676311">ReadSlice</span><span class="op" id="3676320">(</span><span class="string" id="3676321">&#39;\n&#39;</span><span class="op" id="3676325">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3676331">//&nbsp;Does&nbsp;the&nbsp;line&nbsp;end&nbsp;in&nbsp;CRLF&nbsp;instead&nbsp;of&nbsp;just&nbsp;LF?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3676383">hasLF</span>&nbsp;<span class="op" id="3676389">:=</span>&nbsp;<span class="ident" id="3676392">bytes</span><span class="op" id="3676397">.</span><span class="ident" id="3676398">HasSuffix</span><span class="op" id="3676407">(</span><span class="ident" id="3676408">q</span><span class="op" id="3676409">.</span><span class="ident" id="3676410">line</span><span class="op" id="3676414">,</span>&nbsp;<span class="ident" id="3676416">lf</span><span class="op" id="3676418">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3676423">hasCR</span>&nbsp;<span class="op" id="3676429">:=</span>&nbsp;<span class="ident" id="3676432">bytes</span><span class="op" id="3676437">.</span><span class="ident" id="3676438">HasSuffix</span><span class="op" id="3676447">(</span><span class="ident" id="3676448">q</span><span class="op" id="3676449">.</span><span class="ident" id="3676450">line</span><span class="op" id="3676454">,</span>&nbsp;<span class="ident" id="3676456">crlf</span><span class="op" id="3676460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3676465">wholeLine</span>&nbsp;<span class="op" id="3676475">:=</span>&nbsp;<span class="ident" id="3676478">q</span><span class="op" id="3676479">.</span><span class="ident" id="3676480">line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3676488">q</span><span class="op" id="3676489">.</span><span class="ident" id="3676490">line</span>&nbsp;<span class="op" id="3676495">=</span>&nbsp;<span class="ident" id="3676497">bytes</span><span class="op" id="3676502">.</span><span class="ident" id="3676503">TrimRightFunc</span><span class="op" id="3676516">(</span><span class="ident" id="3676517">wholeLine</span><span class="op" id="3676526">,</span>&nbsp;<span class="ident" id="3676528">isQPDiscardWhitespace</span><span class="op" id="3676549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3676554">if</span>&nbsp;<span class="ident" id="3676557">bytes</span><span class="op" id="3676562">.</span><span class="ident" id="3676563">HasSuffix</span><span class="op" id="3676572">(</span><span class="ident" id="3676573">q</span><span class="op" id="3676574">.</span><span class="ident" id="3676575">line</span><span class="op" id="3676579">,</span>&nbsp;<span class="ident" id="3676581">softSuffix</span><span class="op" id="3676591">)</span>&nbsp;<span class="op" id="3676593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3676599">rightStripped</span>&nbsp;<span class="op" id="3676613">:=</span>&nbsp;<span class="ident" id="3676616">wholeLine</span><span class="op" id="3676625">[</span><span class="builtinfunc" id="3676626">len</span><span class="op" id="3676629">(</span><span class="ident" id="3676630">q</span><span class="op" id="3676631">.</span><span class="ident" id="3676632">line</span><span class="op" id="3676636">)</span><span class="op" id="3676637">:</span><span class="op" id="3676638">]</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3676644">q</span><span class="op" id="3676645">.</span><span class="ident" id="3676646">line</span>&nbsp;<span class="op" id="3676651">=</span>&nbsp;<span class="ident" id="3676653">q</span><span class="op" id="3676654">.</span><span class="ident" id="3676655">line</span><span class="op" id="3676659">[</span><span class="op" id="3676660">:</span><span class="builtinfunc" id="3676661">len</span><span class="op" id="3676664">(</span><span class="ident" id="3676665">q</span><span class="op" id="3676666">.</span><span class="ident" id="3676667">line</span><span class="op" id="3676671">)</span><span class="op" id="3676672">-</span><span class="num" id="3676673">1</span><span class="op" id="3676674">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3676680">if</span>&nbsp;<span class="op" id="3676683">!</span><span class="ident" id="3676684">bytes</span><span class="op" id="3676689">.</span><span class="ident" id="3676690">HasPrefix</span><span class="op" id="3676699">(</span><span class="ident" id="3676700">rightStripped</span><span class="op" id="3676713">,</span>&nbsp;<span class="ident" id="3676715">lf</span><span class="op" id="3676717">)</span>&nbsp;<span class="op" id="3676719">&amp;&amp;</span>&nbsp;<span class="op" id="3676722">!</span><span class="ident" id="3676723">bytes</span><span class="op" id="3676728">.</span><span class="ident" id="3676729">HasPrefix</span><span class="op" id="3676738">(</span><span class="ident" id="3676739">rightStripped</span><span class="op" id="3676752">,</span>&nbsp;<span class="ident" id="3676754">crlf</span><span class="op" id="3676758">)</span>&nbsp;<span class="op" id="3676760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3676767">q</span><span class="op" id="3676768">.</span><span class="ident" id="3676769">rerr</span>&nbsp;<span class="op" id="3676774">=</span>&nbsp;<span class="ident" id="3676776">fmt</span><span class="op" id="3676779">.</span><span class="ident" id="3676780">Errorf</span><span class="op" id="3676786">(</span><span class="string" id="3676787">&#34;multipart:&nbsp;invalid&nbsp;bytes&nbsp;after&nbsp;=:&nbsp;%q&#34;</span><span class="op" id="3676825">,</span>&nbsp;<span class="ident" id="3676827">rightStripped</span><span class="op" id="3676840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3676846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3676851">}</span>&nbsp;<span class="keyword" id="3676853">else</span>&nbsp;<span class="keyword" id="3676858">if</span>&nbsp;<span class="ident" id="3676861">hasLF</span>&nbsp;<span class="op" id="3676867">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3676873">if</span>&nbsp;<span class="ident" id="3676876">hasCR</span>&nbsp;<span class="op" id="3676882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3676889">q</span><span class="op" id="3676890">.</span><span class="ident" id="3676891">line</span>&nbsp;<span class="op" id="3676896">=</span>&nbsp;<span class="builtinfunc" id="3676898">append</span><span class="op" id="3676904">(</span><span class="ident" id="3676905">q</span><span class="op" id="3676906">.</span><span class="ident" id="3676907">line</span><span class="op" id="3676911">,</span>&nbsp;<span class="string" id="3676913">&#39;\r&#39;</span><span class="op" id="3676917">,</span>&nbsp;<span class="string" id="3676919">&#39;\n&#39;</span><span class="op" id="3676923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3676929">}</span>&nbsp;<span class="keyword" id="3676931">else</span>&nbsp;<span class="op" id="3676936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3676943">q</span><span class="op" id="3676944">.</span><span class="ident" id="3676945">line</span>&nbsp;<span class="op" id="3676950">=</span>&nbsp;<span class="builtinfunc" id="3676952">append</span><span class="op" id="3676958">(</span><span class="ident" id="3676959">q</span><span class="op" id="3676960">.</span><span class="ident" id="3676961">line</span><span class="op" id="3676965">,</span>&nbsp;<span class="string" id="3676967">&#39;\n&#39;</span><span class="op" id="3676971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3676977">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3676982">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3676987">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3676998">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3677002">b</span>&nbsp;<span class="op" id="3677004">:=</span>&nbsp;<span class="ident" id="3677007">q</span><span class="op" id="3677008">.</span><span class="ident" id="3677009">line</span><span class="op" id="3677013">[</span><span class="num" id="3677014">0</span><span class="op" id="3677015">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3677020">switch</span>&nbsp;<span class="op" id="3677027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3677031">case</span>&nbsp;<span class="ident" id="3677036">b</span>&nbsp;<span class="op" id="3677038">==</span>&nbsp;<span class="string" id="3677041">&#39;=&#39;</span><span class="op" id="3677044">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3677049">b</span><span class="op" id="3677050">,</span>&nbsp;<span class="ident" id="3677052">err</span>&nbsp;<span class="op" id="3677056">=</span>&nbsp;<span class="ident" id="3677058">q</span><span class="op" id="3677059">.</span><span class="ident" id="3677060">readHexByte</span><span class="op" id="3677071">(</span><span class="ident" id="3677072">q</span><span class="op" id="3677073">.</span><span class="ident" id="3677074">line</span><span class="op" id="3677078">[</span><span class="num" id="3677079">1</span><span class="op" id="3677080">:</span><span class="op" id="3677081">]</span><span class="op" id="3677082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3677087">if</span>&nbsp;<span class="ident" id="3677090">err</span>&nbsp;<span class="op" id="3677094">!=</span>&nbsp;<span class="ident" id="3677097">nil</span>&nbsp;<span class="op" id="3677101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3677107">return</span>&nbsp;<span class="ident" id="3677114">n</span><span class="op" id="3677115">,</span>&nbsp;<span class="ident" id="3677117">err</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3677124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3677129">q</span><span class="op" id="3677130">.</span><span class="ident" id="3677131">line</span>&nbsp;<span class="op" id="3677136">=</span>&nbsp;<span class="ident" id="3677138">q</span><span class="op" id="3677139">.</span><span class="ident" id="3677140">line</span><span class="op" id="3677144">[</span><span class="num" id="3677145">2</span><span class="op" id="3677146">:</span><span class="op" id="3677147">]</span>&nbsp;<span class="comment" id="3677149">//&nbsp;2&nbsp;of&nbsp;the&nbsp;3;&nbsp;other&nbsp;1&nbsp;is&nbsp;done&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3677188">case</span>&nbsp;<span class="ident" id="3677193">b</span>&nbsp;<span class="op" id="3677195">==</span>&nbsp;<span class="string" id="3677198">&#39;\t&#39;</span>&nbsp;<span class="op" id="3677203">||</span>&nbsp;<span class="ident" id="3677206">b</span>&nbsp;<span class="op" id="3677208">==</span>&nbsp;<span class="string" id="3677211">&#39;\r&#39;</span>&nbsp;<span class="op" id="3677216">||</span>&nbsp;<span class="ident" id="3677219">b</span>&nbsp;<span class="op" id="3677221">==</span>&nbsp;<span class="string" id="3677224">&#39;\n&#39;</span><span class="op" id="3677228">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3677233">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3677241">case</span>&nbsp;<span class="ident" id="3677246">b</span>&nbsp;<span class="op" id="3677248">&lt;</span>&nbsp;<span class="string" id="3677250">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3677254">||</span>&nbsp;<span class="ident" id="3677257">b</span>&nbsp;<span class="op" id="3677259">&gt;</span>&nbsp;<span class="string" id="3677261">&#39;~&#39;</span><span class="op" id="3677264">:</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3677269">return</span>&nbsp;<span class="ident" id="3677276">n</span><span class="op" id="3677277">,</span>&nbsp;<span class="ident" id="3677279">fmt</span><span class="op" id="3677282">.</span><span class="ident" id="3677283">Errorf</span><span class="op" id="3677289">(</span><span class="string" id="3677290">&#34;multipart:&nbsp;invalid&nbsp;unescaped&nbsp;byte&nbsp;0x%02x&nbsp;in&nbsp;quoted-printable&nbsp;body&#34;</span><span class="op" id="3677357">,</span>&nbsp;<span class="ident" id="3677359">b</span><span class="op" id="3677360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3677364">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3677368">p</span><span class="op" id="3677369">[</span><span class="num" id="3677370">0</span><span class="op" id="3677371">]</span>&nbsp;<span class="op" id="3677373">=</span>&nbsp;<span class="ident" id="3677375">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3677379">p</span>&nbsp;<span class="op" id="3677381">=</span>&nbsp;<span class="ident" id="3677383">p</span><span class="op" id="3677384">[</span><span class="num" id="3677385">1</span><span class="op" id="3677386">:</span><span class="op" id="3677387">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3677391">q</span><span class="op" id="3677392">.</span><span class="ident" id="3677393">line</span>&nbsp;<span class="op" id="3677398">=</span>&nbsp;<span class="ident" id="3677400">q</span><span class="op" id="3677401">.</span><span class="ident" id="3677402">line</span><span class="op" id="3677406">[</span><span class="num" id="3677407">1</span><span class="op" id="3677408">:</span><span class="op" id="3677409">]</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3677413">n</span><span class="op" id="3677414">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3677418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3677421">return</span>&nbsp;<span class="ident" id="3677428">n</span><span class="op" id="3677429">,</span>&nbsp;<span class="ident" id="3677431">nil</span><br>
<span class="lineno"></span><span class="op" id="3677435">}</span>
</div>
</body>
</html>
