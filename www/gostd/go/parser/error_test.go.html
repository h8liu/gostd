<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/parser</h2>
<ul>
<li><a href="/gostd/go/parser/error_test.go.html">error_test.go</a></li>
<li><a href="/gostd/go/parser/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/parser/interface.go.html">interface.go</a></li>
<li><a href="/gostd/go/parser/parser.go.html">parser.go</a></li>
<li><a href="/gostd/go/parser/parser_test.go.html">parser_test.go</a></li>
<li><a href="/gostd/go/parser/performance_test.go.html">performance_test.go</a></li>
<li><a href="/gostd/go/parser/short_test.go.html">short_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8016823">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8016878">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8016932">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="8016983">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;a&nbsp;parser&nbsp;test&nbsp;harness.&nbsp;The&nbsp;files&nbsp;in&nbsp;the&nbsp;testdata</span><br>
<span class="lineno"></span><span class="comment" id="8017056">//&nbsp;directory&nbsp;are&nbsp;parsed&nbsp;and&nbsp;the&nbsp;errors&nbsp;reported&nbsp;are&nbsp;compared&nbsp;against&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="8017129">//&nbsp;error&nbsp;messages&nbsp;expected&nbsp;in&nbsp;the&nbsp;test&nbsp;files.&nbsp;The&nbsp;test&nbsp;files&nbsp;must&nbsp;end&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="8017202">//&nbsp;.src&nbsp;rather&nbsp;than&nbsp;.go&nbsp;so&nbsp;that&nbsp;they&nbsp;are&nbsp;not&nbsp;disturbed&nbsp;by&nbsp;gofmt&nbsp;runs.</span><br>
<span class="lineno"></span><span class="comment" id="8017272">//</span><br>
<span class="lineno">10</span><span class="comment" id="8017275">//&nbsp;Expected&nbsp;errors&nbsp;are&nbsp;indicated&nbsp;in&nbsp;the&nbsp;test&nbsp;files&nbsp;by&nbsp;putting&nbsp;a&nbsp;comment</span><br>
<span class="lineno"></span><span class="comment" id="8017347">//&nbsp;of&nbsp;the&nbsp;form&nbsp;/*&nbsp;ERROR&nbsp;&#34;rx&#34;&nbsp;*/&nbsp;immediately&nbsp;following&nbsp;an&nbsp;offending&nbsp;token.</span><br>
<span class="lineno"></span><span class="comment" id="8017421">//&nbsp;The&nbsp;harness&nbsp;will&nbsp;verify&nbsp;that&nbsp;an&nbsp;error&nbsp;matching&nbsp;the&nbsp;regular&nbsp;expression</span><br>
<span class="lineno"></span><span class="comment" id="8017494">//&nbsp;rx&nbsp;is&nbsp;reported&nbsp;at&nbsp;that&nbsp;source&nbsp;position.</span><br>
<span class="lineno"></span><span class="comment" id="8017537">//</span><br>
<span class="lineno">15</span><span class="comment" id="8017540">//&nbsp;For&nbsp;instance,&nbsp;the&nbsp;following&nbsp;test&nbsp;file&nbsp;indicates&nbsp;that&nbsp;a&nbsp;&#34;not&nbsp;declared&#34;</span><br>
<span class="lineno"></span><span class="comment" id="8017613">//&nbsp;error&nbsp;should&nbsp;be&nbsp;reported&nbsp;for&nbsp;the&nbsp;undeclared&nbsp;variable&nbsp;x:</span><br>
<span class="lineno"></span><span class="comment" id="8017672">//</span><br>
<span class="lineno"></span><span class="comment" id="8017675">//&nbsp;&nbsp;&nbsp;&nbsppackage&nbsp;p</span><br>
<span class="lineno"></span><span class="comment" id="8017688">//&nbsp;&nbsp;&nbsp;&nbspfunc&nbsp;f()&nbsp;{</span><br>
<span class="lineno">20</span><span class="comment" id="8017702">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp_&nbsp;=&nbsp;x&nbsp;/*&nbsp;ERROR&nbsp;&#34;not&nbsp;declared&#34;&nbsp;*/&nbsp;+&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="8017743">//&nbsp;&nbsp;&nbsp;&nbsp}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8017749">package</span>&nbsp;<span class="ident" id="8017757">parser</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="8017765">import</span>&nbsp;<span class="op" id="8017772">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8017775">&#34;go/scanner&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8017789">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8017801">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8017814">&#34;path/filepath&#34;</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8017831">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8017841">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8017852">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8017862">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="keyword" id="8017865">const</span>&nbsp;<span class="ident" id="8017871">testdata</span>&nbsp;<span class="op" id="8017880">=</span>&nbsp;<span class="string" id="8017882">&#34;testdata&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8017894">var</span>&nbsp;<span class="ident" id="8017898">fsetErrs</span>&nbsp;<span class="op" id="8017907">=</span>&nbsp;<span class="ident" id="8017909">token</span><span class="op" id="8017914">.</span><span class="ident" id="8017915">NewFileSet</span><span class="op" id="8017925">(</span><span class="op" id="8017926">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8017929">//&nbsp;getFile&nbsp;assumes&nbsp;that&nbsp;each&nbsp;filename&nbsp;occurs&nbsp;at&nbsp;most&nbsp;once</span><br>
<span class="lineno">40</span><span class="keyword" id="8017987">func</span>&nbsp;<span class="ident" id="8017992">getFile</span><span class="op" id="8017999">(</span><span class="ident" id="8018000">filename</span>&nbsp;<span class="builtintype" id="8018009">string</span><span class="op" id="8018015">)</span>&nbsp;<span class="op" id="8018017">(</span><span class="ident" id="8018018">file</span>&nbsp;<span class="op" id="8018023">*</span><span class="ident" id="8018024">token</span><span class="op" id="8018029">.</span><span class="ident" id="8018030">File</span><span class="op" id="8018034">)</span>&nbsp;<span class="op" id="8018036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8018039">fsetErrs</span><span class="op" id="8018047">.</span><span class="ident" id="8018048">Iterate</span><span class="op" id="8018055">(</span><span class="keyword" id="8018056">func</span><span class="op" id="8018060">(</span><span class="ident" id="8018061">f</span>&nbsp;<span class="op" id="8018063">*</span><span class="ident" id="8018064">token</span><span class="op" id="8018069">.</span><span class="ident" id="8018070">File</span><span class="op" id="8018074">)</span>&nbsp;<span class="builtintype" id="8018076">bool</span>&nbsp;<span class="op" id="8018081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8018085">if</span>&nbsp;<span class="ident" id="8018088">f</span><span class="op" id="8018089">.</span><span class="ident" id="8018090">Name</span><span class="op" id="8018094">(</span><span class="op" id="8018095">)</span>&nbsp;<span class="op" id="8018097">==</span>&nbsp;<span class="ident" id="8018100">filename</span>&nbsp;<span class="op" id="8018109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8018114">if</span>&nbsp;<span class="ident" id="8018117">file</span>&nbsp;<span class="op" id="8018122">!=</span>&nbsp;<span class="ident" id="8018125">nil</span>&nbsp;<span class="op" id="8018129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8018135">panic</span><span class="op" id="8018140">(</span><span class="ident" id="8018141">filename</span>&nbsp;<span class="op" id="8018150">+</span>&nbsp;<span class="string" id="8018152">&#34;&nbsp;used&nbsp;multiple&nbsp;times&#34;</span><span class="op" id="8018174">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8018179">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8018184">file</span>&nbsp;<span class="op" id="8018189">=</span>&nbsp;<span class="ident" id="8018191">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8018195">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8018199">return</span>&nbsp;<span class="builtintype" id="8018206">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8018212">}</span><span class="op" id="8018213">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8018216">return</span>&nbsp;<span class="ident" id="8018223">file</span><br>
<span class="lineno"></span><span class="op" id="8018228">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8018231">func</span>&nbsp;<span class="ident" id="8018236">getPos</span><span class="op" id="8018242">(</span><span class="ident" id="8018243">filename</span>&nbsp;<span class="builtintype" id="8018252">string</span><span class="op" id="8018258">,</span>&nbsp;<span class="ident" id="8018260">offset</span>&nbsp;<span class="builtintype" id="8018267">int</span><span class="op" id="8018270">)</span>&nbsp;<span class="ident" id="8018272">token</span><span class="op" id="8018277">.</span><span class="ident" id="8018278">Pos</span>&nbsp;<span class="op" id="8018282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8018285">if</span>&nbsp;<span class="ident" id="8018288">f</span>&nbsp;<span class="op" id="8018290">:=</span>&nbsp;<span class="ident" id="8018293">getFile</span><span class="op" id="8018300">(</span><span class="ident" id="8018301">filename</span><span class="op" id="8018309">)</span><span class="op" id="8018310">;</span>&nbsp;<span class="ident" id="8018312">f</span>&nbsp;<span class="op" id="8018314">!=</span>&nbsp;<span class="ident" id="8018317">nil</span>&nbsp;<span class="op" id="8018321">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8018325">return</span>&nbsp;<span class="ident" id="8018332">f</span><span class="op" id="8018333">.</span><span class="ident" id="8018334">Pos</span><span class="op" id="8018337">(</span><span class="ident" id="8018338">offset</span><span class="op" id="8018344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8018347">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8018350">return</span>&nbsp;<span class="ident" id="8018357">token</span><span class="op" id="8018362">.</span><span class="ident" id="8018363">NoPos</span><br>
<span class="lineno"></span><span class="op" id="8018369">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="8018372">//&nbsp;ERROR&nbsp;comments&nbsp;must&nbsp;be&nbsp;of&nbsp;the&nbsp;form&nbsp;/*&nbsp;ERROR&nbsp;&#34;rx&#34;&nbsp;*/&nbsp;and&nbsp;rx&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="8018437">//&nbsp;a&nbsp;regular&nbsp;expression&nbsp;that&nbsp;matches&nbsp;the&nbsp;expected&nbsp;error&nbsp;message.</span><br>
<span class="lineno"></span><span class="comment" id="8018502">//&nbsp;The&nbsp;special&nbsp;form&nbsp;/*&nbsp;ERROR&nbsp;HERE&nbsp;&#34;rx&#34;&nbsp;*/&nbsp;must&nbsp;be&nbsp;used&nbsp;for&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="8018567">//&nbsp;messages&nbsp;that&nbsp;appear&nbsp;immediately&nbsp;after&nbsp;a&nbsp;token,&nbsp;rather&nbsp;than&nbsp;at</span><br>
<span class="lineno"></span><span class="comment" id="8018633">//&nbsp;a&nbsp;token&#39;s&nbsp;position.</span><br>
<span class="lineno">65</span><span class="comment" id="8018656">//</span><br>
<span class="lineno"></span><span class="keyword" id="8018659">var</span>&nbsp;<span class="ident" id="8018663">errRx</span>&nbsp;<span class="op" id="8018669">=</span>&nbsp;<span class="ident" id="8018671">regexp</span><span class="op" id="8018677">.</span><span class="ident" id="8018678">MustCompile</span><span class="op" id="8018689">(</span><span class="string" id="8018690">`^/\*&nbsp;*ERROR&nbsp;*(HERE)?&nbsp;*&#34;([^&#34;]*)&#34;&nbsp;*\*/$`</span><span class="op" id="8018729">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8018732">//&nbsp;expectedErrors&nbsp;collects&nbsp;the&nbsp;regular&nbsp;expressions&nbsp;of&nbsp;ERROR&nbsp;comments&nbsp;found</span><br>
<span class="lineno"></span><span class="comment" id="8018807">//&nbsp;in&nbsp;files&nbsp;and&nbsp;returns&nbsp;them&nbsp;as&nbsp;a&nbsp;map&nbsp;of&nbsp;error&nbsp;positions&nbsp;to&nbsp;error&nbsp;messages.</span><br>
<span class="lineno">70</span><span class="comment" id="8018883">//</span><br>
<span class="lineno"></span><span class="keyword" id="8018886">func</span>&nbsp;<span class="ident" id="8018891">expectedErrors</span><span class="op" id="8018905">(</span><span class="ident" id="8018906">t</span>&nbsp;<span class="op" id="8018908">*</span><span class="ident" id="8018909">testing</span><span class="op" id="8018916">.</span><span class="ident" id="8018917">T</span><span class="op" id="8018918">,</span>&nbsp;<span class="ident" id="8018920">filename</span>&nbsp;<span class="builtintype" id="8018929">string</span><span class="op" id="8018935">,</span>&nbsp;<span class="ident" id="8018937">src</span>&nbsp;<span class="op" id="8018941">[</span><span class="op" id="8018942">]</span><span class="builtintype" id="8018943">byte</span><span class="op" id="8018947">)</span>&nbsp;<span class="keyword" id="8018949">map</span><span class="op" id="8018952">[</span><span class="ident" id="8018953">token</span><span class="op" id="8018958">.</span><span class="ident" id="8018959">Pos</span><span class="op" id="8018962">]</span><span class="builtintype" id="8018963">string</span>&nbsp;<span class="op" id="8018970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8018973">errors</span>&nbsp;<span class="op" id="8018980">:=</span>&nbsp;<span class="builtinfunc" id="8018983">make</span><span class="op" id="8018987">(</span><span class="keyword" id="8018988">map</span><span class="op" id="8018991">[</span><span class="ident" id="8018992">token</span><span class="op" id="8018997">.</span><span class="ident" id="8018998">Pos</span><span class="op" id="8019001">]</span><span class="builtintype" id="8019002">string</span><span class="op" id="8019008">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8019012">var</span>&nbsp;<span class="ident" id="8019016">s</span>&nbsp;<span class="ident" id="8019018">scanner</span><span class="op" id="8019025">.</span><span class="ident" id="8019026">Scanner</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8019035">//&nbsp;file&nbsp;was&nbsp;parsed&nbsp;already&nbsp;-&nbsp;do&nbsp;not&nbsp;add&nbsp;it&nbsp;again&nbsp;to&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8019097">//&nbsp;set&nbsp;otherwise&nbsp;the&nbsp;position&nbsp;information&nbsp;returned&nbsp;here&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8019159">//&nbsp;not&nbsp;match&nbsp;the&nbsp;position&nbsp;information&nbsp;collected&nbsp;by&nbsp;the&nbsp;parser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8019222">s</span><span class="op" id="8019223">.</span><span class="ident" id="8019224">Init</span><span class="op" id="8019228">(</span><span class="ident" id="8019229">getFile</span><span class="op" id="8019236">(</span><span class="ident" id="8019237">filename</span><span class="op" id="8019245">)</span><span class="op" id="8019246">,</span>&nbsp;<span class="ident" id="8019248">src</span><span class="op" id="8019251">,</span>&nbsp;<span class="ident" id="8019253">nil</span><span class="op" id="8019256">,</span>&nbsp;<span class="ident" id="8019258">scanner</span><span class="op" id="8019265">.</span><span class="ident" id="8019266">ScanComments</span><span class="op" id="8019278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8019281">var</span>&nbsp;<span class="ident" id="8019285">prev</span>&nbsp;<span class="ident" id="8019290">token</span><span class="op" id="8019295">.</span><span class="ident" id="8019296">Pos</span>&nbsp;<span class="comment" id="8019300">//&nbsp;position&nbsp;of&nbsp;last&nbsp;non-comment,&nbsp;non-semicolon&nbsp;token</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8019354">var</span>&nbsp;<span class="ident" id="8019358">here</span>&nbsp;<span class="ident" id="8019363">token</span><span class="op" id="8019368">.</span><span class="ident" id="8019369">Pos</span>&nbsp;<span class="comment" id="8019373">//&nbsp;position&nbsp;immediately&nbsp;after&nbsp;the&nbsp;token&nbsp;at&nbsp;position&nbsp;prev</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8019432">for</span>&nbsp;<span class="op" id="8019436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8019440">pos</span><span class="op" id="8019443">,</span>&nbsp;<span class="ident" id="8019445">tok</span><span class="op" id="8019448">,</span>&nbsp;<span class="ident" id="8019450">lit</span>&nbsp;<span class="op" id="8019454">:=</span>&nbsp;<span class="ident" id="8019457">s</span><span class="op" id="8019458">.</span><span class="ident" id="8019459">Scan</span><span class="op" id="8019463">(</span><span class="op" id="8019464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8019468">switch</span>&nbsp;<span class="ident" id="8019475">tok</span>&nbsp;<span class="op" id="8019479">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8019483">case</span>&nbsp;<span class="ident" id="8019488">token</span><span class="op" id="8019493">.</span><span class="ident" id="8019494">EOF</span><span class="op" id="8019497">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8019502">return</span>&nbsp;<span class="ident" id="8019509">errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8019518">case</span>&nbsp;<span class="ident" id="8019523">token</span><span class="op" id="8019528">.</span><span class="ident" id="8019529">COMMENT</span><span class="op" id="8019536">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8019541">s</span>&nbsp;<span class="op" id="8019543">:=</span>&nbsp;<span class="ident" id="8019546">errRx</span><span class="op" id="8019551">.</span><span class="ident" id="8019552">FindStringSubmatch</span><span class="op" id="8019570">(</span><span class="ident" id="8019571">lit</span><span class="op" id="8019574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8019579">if</span>&nbsp;<span class="builtinfunc" id="8019582">len</span><span class="op" id="8019585">(</span><span class="ident" id="8019586">s</span><span class="op" id="8019587">)</span>&nbsp;<span class="op" id="8019589">==</span>&nbsp;<span class="num" id="8019592">3</span>&nbsp;<span class="op" id="8019594">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8019600">pos</span>&nbsp;<span class="op" id="8019604">:=</span>&nbsp;<span class="ident" id="8019607">prev</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8019616">if</span>&nbsp;<span class="ident" id="8019619">s</span><span class="op" id="8019620">[</span><span class="num" id="8019621">1</span><span class="op" id="8019622">]</span>&nbsp;<span class="op" id="8019624">==</span>&nbsp;<span class="string" id="8019627">&#34;HERE&#34;</span>&nbsp;<span class="op" id="8019634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8019641">pos</span>&nbsp;<span class="op" id="8019645">=</span>&nbsp;<span class="ident" id="8019647">here</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8019656">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8019662">errors</span><span class="op" id="8019668">[</span><span class="ident" id="8019669">pos</span><span class="op" id="8019672">]</span>&nbsp;<span class="op" id="8019674">=</span>&nbsp;<span class="builtintype" id="8019676">string</span><span class="op" id="8019682">(</span><span class="ident" id="8019683">s</span><span class="op" id="8019684">[</span><span class="num" id="8019685">2</span><span class="op" id="8019686">]</span><span class="op" id="8019687">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8019692">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8019696">default</span><span class="op" id="8019703">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8019708">prev</span>&nbsp;<span class="op" id="8019713">=</span>&nbsp;<span class="ident" id="8019715">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8019722">var</span>&nbsp;<span class="ident" id="8019726">l</span>&nbsp;<span class="builtintype" id="8019728">int</span>&nbsp;<span class="comment" id="8019732">//&nbsp;token&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8019751">if</span>&nbsp;<span class="ident" id="8019754">tok</span><span class="op" id="8019757">.</span><span class="ident" id="8019758">IsLiteral</span><span class="op" id="8019767">(</span><span class="op" id="8019768">)</span>&nbsp;<span class="op" id="8019770">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8019776">l</span>&nbsp;<span class="op" id="8019778">=</span>&nbsp;<span class="builtinfunc" id="8019780">len</span><span class="op" id="8019783">(</span><span class="ident" id="8019784">lit</span><span class="op" id="8019787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8019792">}</span>&nbsp;<span class="keyword" id="8019794">else</span>&nbsp;<span class="op" id="8019799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8019805">l</span>&nbsp;<span class="op" id="8019807">=</span>&nbsp;<span class="builtinfunc" id="8019809">len</span><span class="op" id="8019812">(</span><span class="ident" id="8019813">tok</span><span class="op" id="8019816">.</span><span class="ident" id="8019817">String</span><span class="op" id="8019823">(</span><span class="op" id="8019824">)</span><span class="op" id="8019825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8019830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8019835">here</span>&nbsp;<span class="op" id="8019840">=</span>&nbsp;<span class="ident" id="8019842">prev</span>&nbsp;<span class="op" id="8019847">+</span>&nbsp;<span class="ident" id="8019849">token</span><span class="op" id="8019854">.</span><span class="ident" id="8019855">Pos</span><span class="op" id="8019858">(</span><span class="ident" id="8019859">l</span><span class="op" id="8019860">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8019864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8019867">}</span><br>
<span class="lineno"></span><span class="op" id="8019869">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8019872">//&nbsp;compareErrors&nbsp;compares&nbsp;the&nbsp;map&nbsp;of&nbsp;expected&nbsp;error&nbsp;messages&nbsp;with&nbsp;the&nbsp;list</span><br>
<span class="lineno">110</span><span class="comment" id="8019947">//&nbsp;of&nbsp;found&nbsp;errors&nbsp;and&nbsp;reports&nbsp;discrepancies.</span><br>
<span class="lineno"></span><span class="comment" id="8019993">//</span><br>
<span class="lineno"></span><span class="keyword" id="8019996">func</span>&nbsp;<span class="ident" id="8020001">compareErrors</span><span class="op" id="8020014">(</span><span class="ident" id="8020015">t</span>&nbsp;<span class="op" id="8020017">*</span><span class="ident" id="8020018">testing</span><span class="op" id="8020025">.</span><span class="ident" id="8020026">T</span><span class="op" id="8020027">,</span>&nbsp;<span class="ident" id="8020029">expected</span>&nbsp;<span class="keyword" id="8020038">map</span><span class="op" id="8020041">[</span><span class="ident" id="8020042">token</span><span class="op" id="8020047">.</span><span class="ident" id="8020048">Pos</span><span class="op" id="8020051">]</span><span class="builtintype" id="8020052">string</span><span class="op" id="8020058">,</span>&nbsp;<span class="ident" id="8020060">found</span>&nbsp;<span class="ident" id="8020066">scanner</span><span class="op" id="8020073">.</span><span class="ident" id="8020074">ErrorList</span><span class="op" id="8020083">)</span>&nbsp;<span class="op" id="8020085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8020088">for</span>&nbsp;<span class="ident" id="8020092">_</span><span class="op" id="8020093">,</span>&nbsp;<span class="builtintype" id="8020095">error</span>&nbsp;<span class="op" id="8020101">:=</span>&nbsp;<span class="keyword" id="8020104">range</span>&nbsp;<span class="ident" id="8020110">found</span>&nbsp;<span class="op" id="8020116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8020120">//&nbsp;error.Pos&nbsp;is&nbsp;a&nbsp;token.Position,&nbsp;but&nbsp;we&nbsp;want</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8020168">//&nbsp;a&nbsp;token.Pos&nbsp;so&nbsp;we&nbsp;can&nbsp;do&nbsp;a&nbsp;map&nbsp;lookup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8020211">pos</span>&nbsp;<span class="op" id="8020215">:=</span>&nbsp;<span class="ident" id="8020218">getPos</span><span class="op" id="8020224">(</span><span class="builtintype" id="8020225">error</span><span class="op" id="8020230">.</span><span class="ident" id="8020231">Pos</span><span class="op" id="8020234">.</span><span class="ident" id="8020235">Filename</span><span class="op" id="8020243">,</span>&nbsp;<span class="builtintype" id="8020245">error</span><span class="op" id="8020250">.</span><span class="ident" id="8020251">Pos</span><span class="op" id="8020254">.</span><span class="ident" id="8020255">Offset</span><span class="op" id="8020261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8020265">if</span>&nbsp;<span class="ident" id="8020268">msg</span><span class="op" id="8020271">,</span>&nbsp;<span class="ident" id="8020273">found</span>&nbsp;<span class="op" id="8020279">:=</span>&nbsp;<span class="ident" id="8020282">expected</span><span class="op" id="8020290">[</span><span class="ident" id="8020291">pos</span><span class="op" id="8020294">]</span><span class="op" id="8020295">;</span>&nbsp;<span class="ident" id="8020297">found</span>&nbsp;<span class="op" id="8020303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8020308">//&nbsp;we&nbsp;expect&nbsp;a&nbsp;message&nbsp;at&nbsp;pos;&nbsp;check&nbsp;if&nbsp;it&nbsp;matches</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8020362">rx</span><span class="op" id="8020364">,</span>&nbsp;<span class="ident" id="8020366">err</span>&nbsp;<span class="op" id="8020370">:=</span>&nbsp;<span class="ident" id="8020373">regexp</span><span class="op" id="8020379">.</span><span class="ident" id="8020380">Compile</span><span class="op" id="8020387">(</span><span class="ident" id="8020388">msg</span><span class="op" id="8020391">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8020396">if</span>&nbsp;<span class="ident" id="8020399">err</span>&nbsp;<span class="op" id="8020403">!=</span>&nbsp;<span class="ident" id="8020406">nil</span>&nbsp;<span class="op" id="8020410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8020416">t</span><span class="op" id="8020417">.</span><span class="ident" id="8020418">Errorf</span><span class="op" id="8020424">(</span><span class="string" id="8020425">&#34;%s:&nbsp;%v&#34;</span><span class="op" id="8020433">,</span>&nbsp;<span class="builtintype" id="8020435">error</span><span class="op" id="8020440">.</span><span class="ident" id="8020441">Pos</span><span class="op" id="8020444">,</span>&nbsp;<span class="ident" id="8020446">err</span><span class="op" id="8020449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8020455">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8020467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8020472">if</span>&nbsp;<span class="ident" id="8020475">match</span>&nbsp;<span class="op" id="8020481">:=</span>&nbsp;<span class="ident" id="8020484">rx</span><span class="op" id="8020486">.</span><span class="ident" id="8020487">MatchString</span><span class="op" id="8020498">(</span><span class="builtintype" id="8020499">error</span><span class="op" id="8020504">.</span><span class="ident" id="8020505">Msg</span><span class="op" id="8020508">)</span><span class="op" id="8020509">;</span>&nbsp;<span class="op" id="8020511">!</span><span class="ident" id="8020512">match</span>&nbsp;<span class="op" id="8020518">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8020524">t</span><span class="op" id="8020525">.</span><span class="ident" id="8020526">Errorf</span><span class="op" id="8020532">(</span><span class="string" id="8020533">&#34;%s:&nbsp;%q&nbsp;does&nbsp;not&nbsp;match&nbsp;%q&#34;</span><span class="op" id="8020559">,</span>&nbsp;<span class="builtintype" id="8020561">error</span><span class="op" id="8020566">.</span><span class="ident" id="8020567">Pos</span><span class="op" id="8020570">,</span>&nbsp;<span class="builtintype" id="8020572">error</span><span class="op" id="8020577">.</span><span class="ident" id="8020578">Msg</span><span class="op" id="8020581">,</span>&nbsp;<span class="ident" id="8020583">msg</span><span class="op" id="8020586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8020592">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8020604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8020609">//&nbsp;we&nbsp;have&nbsp;a&nbsp;match&nbsp;-&nbsp;eliminate&nbsp;this&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8020654">delete</span><span class="op" id="8020660">(</span><span class="ident" id="8020661">expected</span><span class="op" id="8020669">,</span>&nbsp;<span class="ident" id="8020671">pos</span><span class="op" id="8020674">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8020678">}</span>&nbsp;<span class="keyword" id="8020680">else</span>&nbsp;<span class="op" id="8020685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8020690">//&nbsp;To&nbsp;keep&nbsp;in&nbsp;mind&nbsp;when&nbsp;analyzing&nbsp;failed&nbsp;test&nbsp;output:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8020747">//&nbsp;If&nbsp;the&nbsp;same&nbsp;error&nbsp;position&nbsp;occurs&nbsp;multiple&nbsp;times&nbsp;in&nbsp;errors,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8020813">//&nbsp;this&nbsp;message&nbsp;will&nbsp;be&nbsp;triggered&nbsp;(because&nbsp;the&nbsp;first&nbsp;error&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8020878">//&nbsp;the&nbsp;position&nbsp;removes&nbsp;this&nbsp;position&nbsp;from&nbsp;the&nbsp;expected&nbsp;errors).</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8020946">t</span><span class="op" id="8020947">.</span><span class="ident" id="8020948">Errorf</span><span class="op" id="8020954">(</span><span class="string" id="8020955">&#34;%s:&nbsp;unexpected&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="8020981">,</span>&nbsp;<span class="builtintype" id="8020983">error</span><span class="op" id="8020988">.</span><span class="ident" id="8020989">Pos</span><span class="op" id="8020992">,</span>&nbsp;<span class="builtintype" id="8020994">error</span><span class="op" id="8020999">.</span><span class="ident" id="8021000">Msg</span><span class="op" id="8021003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8021007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8021010">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8021014">//&nbsp;there&nbsp;should&nbsp;be&nbsp;no&nbsp;expected&nbsp;errors&nbsp;left</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8021058">if</span>&nbsp;<span class="builtinfunc" id="8021061">len</span><span class="op" id="8021064">(</span><span class="ident" id="8021065">expected</span><span class="op" id="8021073">)</span>&nbsp;<span class="op" id="8021075">&gt;</span>&nbsp;<span class="num" id="8021077">0</span>&nbsp;<span class="op" id="8021079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8021083">t</span><span class="op" id="8021084">.</span><span class="ident" id="8021085">Errorf</span><span class="op" id="8021091">(</span><span class="string" id="8021092">&#34;%d&nbsp;errors&nbsp;not&nbsp;reported:&#34;</span><span class="op" id="8021117">,</span>&nbsp;<span class="builtinfunc" id="8021119">len</span><span class="op" id="8021122">(</span><span class="ident" id="8021123">expected</span><span class="op" id="8021131">)</span><span class="op" id="8021132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8021136">for</span>&nbsp;<span class="ident" id="8021140">pos</span><span class="op" id="8021143">,</span>&nbsp;<span class="ident" id="8021145">msg</span>&nbsp;<span class="op" id="8021149">:=</span>&nbsp;<span class="keyword" id="8021152">range</span>&nbsp;<span class="ident" id="8021158">expected</span>&nbsp;<span class="op" id="8021167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8021172">t</span><span class="op" id="8021173">.</span><span class="ident" id="8021174">Errorf</span><span class="op" id="8021180">(</span><span class="string" id="8021181">&#34;%s:&nbsp;%s\n&#34;</span><span class="op" id="8021191">,</span>&nbsp;<span class="ident" id="8021193">fsetErrs</span><span class="op" id="8021201">.</span><span class="ident" id="8021202">Position</span><span class="op" id="8021210">(</span><span class="ident" id="8021211">pos</span><span class="op" id="8021214">)</span><span class="op" id="8021215">,</span>&nbsp;<span class="ident" id="8021217">msg</span><span class="op" id="8021220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8021224">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8021227">}</span><br>
<span class="lineno"></span><span class="op" id="8021229">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8021232">func</span>&nbsp;<span class="ident" id="8021237">checkErrors</span><span class="op" id="8021248">(</span><span class="ident" id="8021249">t</span>&nbsp;<span class="op" id="8021251">*</span><span class="ident" id="8021252">testing</span><span class="op" id="8021259">.</span><span class="ident" id="8021260">T</span><span class="op" id="8021261">,</span>&nbsp;<span class="ident" id="8021263">filename</span>&nbsp;<span class="builtintype" id="8021272">string</span><span class="op" id="8021278">,</span>&nbsp;<span class="ident" id="8021280">input</span>&nbsp;<span class="keyword" id="8021286">interface</span><span class="op" id="8021295">{</span><span class="op" id="8021296">}</span><span class="op" id="8021297">)</span>&nbsp;<span class="op" id="8021299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8021302">src</span><span class="op" id="8021305">,</span>&nbsp;<span class="ident" id="8021307">err</span>&nbsp;<span class="op" id="8021311">:=</span>&nbsp;<span class="ident" id="8021314">readSource</span><span class="op" id="8021324">(</span><span class="ident" id="8021325">filename</span><span class="op" id="8021333">,</span>&nbsp;<span class="ident" id="8021335">input</span><span class="op" id="8021340">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8021343">if</span>&nbsp;<span class="ident" id="8021346">err</span>&nbsp;<span class="op" id="8021350">!=</span>&nbsp;<span class="ident" id="8021353">nil</span>&nbsp;<span class="op" id="8021357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8021361">t</span><span class="op" id="8021362">.</span><span class="ident" id="8021363">Error</span><span class="op" id="8021368">(</span><span class="ident" id="8021369">err</span><span class="op" id="8021372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8021376">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8021384">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8021388">_</span><span class="op" id="8021389">,</span>&nbsp;<span class="ident" id="8021391">err</span>&nbsp;<span class="op" id="8021395">=</span>&nbsp;<span class="ident" id="8021397">ParseFile</span><span class="op" id="8021406">(</span><span class="ident" id="8021407">fsetErrs</span><span class="op" id="8021415">,</span>&nbsp;<span class="ident" id="8021417">filename</span><span class="op" id="8021425">,</span>&nbsp;<span class="ident" id="8021427">src</span><span class="op" id="8021430">,</span>&nbsp;<span class="ident" id="8021432">DeclarationErrors</span><span class="op" id="8021449">|</span><span class="ident" id="8021450">AllErrors</span><span class="op" id="8021459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8021462">found</span><span class="op" id="8021467">,</span>&nbsp;<span class="ident" id="8021469">ok</span>&nbsp;<span class="op" id="8021472">:=</span>&nbsp;<span class="ident" id="8021475">err</span><span class="op" id="8021478">.</span><span class="op" id="8021479">(</span><span class="ident" id="8021480">scanner</span><span class="op" id="8021487">.</span><span class="ident" id="8021488">ErrorList</span><span class="op" id="8021497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8021500">if</span>&nbsp;<span class="ident" id="8021503">err</span>&nbsp;<span class="op" id="8021507">!=</span>&nbsp;<span class="ident" id="8021510">nil</span>&nbsp;<span class="op" id="8021514">&amp;&amp;</span>&nbsp;<span class="op" id="8021517">!</span><span class="ident" id="8021518">ok</span>&nbsp;<span class="op" id="8021521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8021525">t</span><span class="op" id="8021526">.</span><span class="ident" id="8021527">Error</span><span class="op" id="8021532">(</span><span class="ident" id="8021533">err</span><span class="op" id="8021536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8021540">return</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8021548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8021551">found</span><span class="op" id="8021556">.</span><span class="ident" id="8021557">RemoveMultiples</span><span class="op" id="8021572">(</span><span class="op" id="8021573">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8021577">//&nbsp;we&nbsp;are&nbsp;expecting&nbsp;the&nbsp;following&nbsp;errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8021619">//&nbsp;(collect&nbsp;these&nbsp;after&nbsp;parsing&nbsp;a&nbsp;file&nbsp;so&nbsp;that&nbsp;it&nbsp;is&nbsp;found&nbsp;in&nbsp;the&nbsp;file&nbsp;set)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8021696">expected</span>&nbsp;<span class="op" id="8021705">:=</span>&nbsp;<span class="ident" id="8021708">expectedErrors</span><span class="op" id="8021722">(</span><span class="ident" id="8021723">t</span><span class="op" id="8021724">,</span>&nbsp;<span class="ident" id="8021726">filename</span><span class="op" id="8021734">,</span>&nbsp;<span class="ident" id="8021736">src</span><span class="op" id="8021739">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8021743">//&nbsp;verify&nbsp;errors&nbsp;returned&nbsp;by&nbsp;the&nbsp;parser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8021784">compareErrors</span><span class="op" id="8021797">(</span><span class="ident" id="8021798">t</span><span class="op" id="8021799">,</span>&nbsp;<span class="ident" id="8021801">expected</span><span class="op" id="8021809">,</span>&nbsp;<span class="ident" id="8021811">found</span><span class="op" id="8021816">)</span><br>
<span class="lineno"></span><span class="op" id="8021818">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="8021821">func</span>&nbsp;<span class="ident" id="8021826">TestErrors</span><span class="op" id="8021836">(</span><span class="ident" id="8021837">t</span>&nbsp;<span class="op" id="8021839">*</span><span class="ident" id="8021840">testing</span><span class="op" id="8021847">.</span><span class="ident" id="8021848">T</span><span class="op" id="8021849">)</span>&nbsp;<span class="op" id="8021851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8021854">list</span><span class="op" id="8021858">,</span>&nbsp;<span class="ident" id="8021860">err</span>&nbsp;<span class="op" id="8021864">:=</span>&nbsp;<span class="ident" id="8021867">ioutil</span><span class="op" id="8021873">.</span><span class="ident" id="8021874">ReadDir</span><span class="op" id="8021881">(</span><span class="ident" id="8021882">testdata</span><span class="op" id="8021890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8021893">if</span>&nbsp;<span class="ident" id="8021896">err</span>&nbsp;<span class="op" id="8021900">!=</span>&nbsp;<span class="ident" id="8021903">nil</span>&nbsp;<span class="op" id="8021907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8021911">t</span><span class="op" id="8021912">.</span><span class="ident" id="8021913">Fatal</span><span class="op" id="8021918">(</span><span class="ident" id="8021919">err</span><span class="op" id="8021922">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8021925">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8021928">for</span>&nbsp;<span class="ident" id="8021932">_</span><span class="op" id="8021933">,</span>&nbsp;<span class="ident" id="8021935">fi</span>&nbsp;<span class="op" id="8021938">:=</span>&nbsp;<span class="keyword" id="8021941">range</span>&nbsp;<span class="ident" id="8021947">list</span>&nbsp;<span class="op" id="8021952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8021956">name</span>&nbsp;<span class="op" id="8021961">:=</span>&nbsp;<span class="ident" id="8021964">fi</span><span class="op" id="8021966">.</span><span class="ident" id="8021967">Name</span><span class="op" id="8021971">(</span><span class="op" id="8021972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8021976">if</span>&nbsp;<span class="op" id="8021979">!</span><span class="ident" id="8021980">fi</span><span class="op" id="8021982">.</span><span class="ident" id="8021983">IsDir</span><span class="op" id="8021988">(</span><span class="op" id="8021989">)</span>&nbsp;<span class="op" id="8021991">&amp;&amp;</span>&nbsp;<span class="op" id="8021994">!</span><span class="ident" id="8021995">strings</span><span class="op" id="8022002">.</span><span class="ident" id="8022003">HasPrefix</span><span class="op" id="8022012">(</span><span class="ident" id="8022013">name</span><span class="op" id="8022017">,</span>&nbsp;<span class="string" id="8022019">&#34;.&#34;</span><span class="op" id="8022022">)</span>&nbsp;<span class="op" id="8022024">&amp;&amp;</span>&nbsp;<span class="ident" id="8022027">strings</span><span class="op" id="8022034">.</span><span class="ident" id="8022035">HasSuffix</span><span class="op" id="8022044">(</span><span class="ident" id="8022045">name</span><span class="op" id="8022049">,</span>&nbsp;<span class="string" id="8022051">&#34;.src&#34;</span><span class="op" id="8022057">)</span>&nbsp;<span class="op" id="8022059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8022064">checkErrors</span><span class="op" id="8022075">(</span><span class="ident" id="8022076">t</span><span class="op" id="8022077">,</span>&nbsp;<span class="ident" id="8022079">filepath</span><span class="op" id="8022087">.</span><span class="ident" id="8022088">Join</span><span class="op" id="8022092">(</span><span class="ident" id="8022093">testdata</span><span class="op" id="8022101">,</span>&nbsp;<span class="ident" id="8022103">name</span><span class="op" id="8022107">)</span><span class="op" id="8022108">,</span>&nbsp;<span class="ident" id="8022110">nil</span><span class="op" id="8022113">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8022117">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8022120">}</span><br>
<span class="lineno"></span><span class="op" id="8022122">}</span>
</div>
</body>
</html>
