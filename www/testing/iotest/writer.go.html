<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4858322">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4858377">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4858431">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4858482">package</span>&nbsp;<span class="ident" id="4858490">iotest</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4858498">import</span>&nbsp;<span class="string" id="4858505">&#34;io&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4858511">//&nbsp;TruncateWriter&nbsp;returns&nbsp;a&nbsp;Writer&nbsp;that&nbsp;writes&nbsp;to&nbsp;w</span><br>
<span class="lineno">10</span><span class="comment" id="4858563">//&nbsp;but&nbsp;stops&nbsp;silently&nbsp;after&nbsp;n&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="4858600">func</span>&nbsp;<span class="ident" id="4858605">TruncateWriter</span><span class="op" id="4858619">(</span><span class="ident" id="4858620">w</span>&nbsp;<span class="ident" id="4858622"><a href="/testing/iotest/writer.go.html#4858505">io</a></span><span class="op" id="4858624">.</span><span class="ident" id="4858625">Writer</span><span class="op" id="4858631">,</span>&nbsp;<span class="ident" id="4858633">n</span>&nbsp;<span class="ident" id="4858635">int64</span><span class="op" id="4858640">)</span>&nbsp;<span class="ident" id="4858642"><a href="/testing/iotest/writer.go.html#4858505">io</a></span><span class="op" id="4858644">.</span><span class="ident" id="4858645">Writer</span>&nbsp;<span class="op" id="4858652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4858655">return</span>&nbsp;<span class="op" id="4858662">&amp;</span><span class="ident" id="4858663"><a href="/testing/iotest/writer.go.html#4858692">truncateWriter</a></span><span class="op" id="4858677">{</span><span class="ident" id="4858678"><a href="/testing/iotest/writer.go.html#4858620">w</a></span><span class="op" id="4858679">,</span>&nbsp;<span class="ident" id="4858681"><a href="/testing/iotest/writer.go.html#4858633">n</a></span><span class="op" id="4858682">}</span><br>
<span class="lineno"></span><span class="op" id="4858684">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="4858687">type</span>&nbsp;<span class="ident" id="4858692">truncateWriter</span>&nbsp;<span class="keyword" id="4858707">struct</span>&nbsp;<span class="op" id="4858714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4858717">w</span>&nbsp;<span class="ident" id="4858719"><a href="/testing/iotest/writer.go.html#4858505">io</a></span><span class="op" id="4858721">.</span><span class="ident" id="4858722">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4858730">n</span>&nbsp;<span class="ident" id="4858732">int64</span><br>
<span class="lineno"></span><span class="op" id="4858738">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="4858741">func</span>&nbsp;<span class="op" id="4858746">(</span><span class="ident" id="4858747">t</span>&nbsp;<span class="op" id="4858749">*</span><span class="ident" id="4858750"><a href="/testing/iotest/writer.go.html#4858692">truncateWriter</a></span><span class="op" id="4858764">)</span>&nbsp;<span class="ident" id="4858766">Write</span><span class="op" id="4858771">(</span><span class="ident" id="4858772">p</span>&nbsp;<span class="op" id="4858774">[</span><span class="op" id="4858775">]</span><span class="builtintype" id="4858776">byte</span><span class="op" id="4858780">)</span>&nbsp;<span class="op" id="4858782">(</span><span class="ident" id="4858783">n</span>&nbsp;<span class="builtintype" id="4858785">int</span><span class="op" id="4858788">,</span>&nbsp;<span class="ident" id="4858790">err</span>&nbsp;<span class="builtintype" id="4858794">error</span><span class="op" id="4858799">)</span>&nbsp;<span class="op" id="4858801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4858804">if</span>&nbsp;<span class="ident" id="4858807"><a href="/testing/iotest/writer.go.html#4858747">t</a></span><span class="op" id="4858808">.</span><span class="ident" id="4858809">n</span>&nbsp;<span class="op" id="4858811">&lt;=</span>&nbsp;<span class="num" id="4858814">0</span>&nbsp;<span class="op" id="4858816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4858820">return</span>&nbsp;<span class="builtinfunc" id="4858827">len</span><span class="op" id="4858830">(</span><span class="ident" id="4858831"><a href="/testing/iotest/writer.go.html#4858772">p</a></span><span class="op" id="4858832">)</span><span class="op" id="4858833">,</span>&nbsp;<span class="ident" id="4858835">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4858840">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4858843">//&nbsp;real&nbsp;write</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4858858"><a href="/testing/iotest/writer.go.html#4858783">n</a></span>&nbsp;<span class="op" id="4858860">=</span>&nbsp;<span class="builtinfunc" id="4858862">len</span><span class="op" id="4858865">(</span><span class="ident" id="4858866"><a href="/testing/iotest/writer.go.html#4858772">p</a></span><span class="op" id="4858867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4858870">if</span>&nbsp;<span class="ident" id="4858873">int64</span><span class="op" id="4858878">(</span><span class="ident" id="4858879"><a href="/testing/iotest/writer.go.html#4858783">n</a></span><span class="op" id="4858880">)</span>&nbsp;<span class="op" id="4858882">&gt;</span>&nbsp;<span class="ident" id="4858884"><a href="/testing/iotest/writer.go.html#4858747">t</a></span><span class="op" id="4858885">.</span><span class="ident" id="4858886">n</span>&nbsp;<span class="op" id="4858888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4858892"><a href="/testing/iotest/writer.go.html#4858783">n</a></span>&nbsp;<span class="op" id="4858894">=</span>&nbsp;<span class="builtintype" id="4858896">int</span><span class="op" id="4858899">(</span><span class="ident" id="4858900"><a href="/testing/iotest/writer.go.html#4858747">t</a></span><span class="op" id="4858901">.</span><span class="ident" id="4858902">n</span><span class="op" id="4858903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4858906">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4858909"><a href="/testing/iotest/writer.go.html#4858783">n</a></span><span class="op" id="4858910">,</span>&nbsp;<span class="ident" id="4858912"><a href="/testing/iotest/writer.go.html#4858790">err</a></span>&nbsp;<span class="op" id="4858916">=</span>&nbsp;<span class="ident" id="4858918"><a href="/testing/iotest/writer.go.html#4858747">t</a></span><span class="op" id="4858919">.</span><span class="ident" id="4858920">w</span><span class="op" id="4858921">.</span><span class="ident" id="4858922">Write</span><span class="op" id="4858927">(</span><span class="ident" id="4858928"><a href="/testing/iotest/writer.go.html#4858772">p</a></span><span class="op" id="4858929">[</span><span class="num" id="4858930">0</span><span class="op" id="4858931">:</span><span class="ident" id="4858932"><a href="/testing/iotest/writer.go.html#4858783">n</a></span><span class="op" id="4858933">]</span><span class="op" id="4858934">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4858937"><a href="/testing/iotest/writer.go.html#4858747">t</a></span><span class="op" id="4858938">.</span><span class="ident" id="4858939">n</span>&nbsp;<span class="op" id="4858941">-=</span>&nbsp;<span class="ident" id="4858944">int64</span><span class="op" id="4858949">(</span><span class="ident" id="4858950"><a href="/testing/iotest/writer.go.html#4858783">n</a></span><span class="op" id="4858951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4858954">if</span>&nbsp;<span class="ident" id="4858957"><a href="/testing/iotest/writer.go.html#4858790">err</a></span>&nbsp;<span class="op" id="4858961">==</span>&nbsp;<span class="ident" id="4858964">nil</span>&nbsp;<span class="op" id="4858968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4858972"><a href="/testing/iotest/writer.go.html#4858783">n</a></span>&nbsp;<span class="op" id="4858974">=</span>&nbsp;<span class="builtinfunc" id="4858976">len</span><span class="op" id="4858979">(</span><span class="ident" id="4858980"><a href="/testing/iotest/writer.go.html#4858772">p</a></span><span class="op" id="4858981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4858984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4858987">return</span><br>
<span class="lineno">35</span><span class="op" id="4858994">}</span>
</div>
</body>
</html>
