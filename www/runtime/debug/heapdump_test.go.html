<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="8669952">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8670007">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8670061">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8670112">package</span>&nbsp;<span class="ident" id="8670120">debug</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8670127">import</span>&nbsp;<span class="op" id="8670134">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8670137">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8670150">&#34;os&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8670156">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8670167">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8670177">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8670180">func</span>&nbsp;<span class="ident" id="8670185">TestWriteHeapDumpNonempty</span><span class="op" id="8670210">(</span><span class="ident" id="8670211">t</span>&nbsp;<span class="op" id="8670213">*</span><span class="ident" id="8670214"><a href="/runtime/debug/heapdump_test.go.html#8670167">testing</a></span><span class="op" id="8670221">.</span><span class="ident" id="8670222">T</span><span class="op" id="8670223">)</span>&nbsp;<span class="op" id="8670225">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8670228">if</span>&nbsp;<span class="ident" id="8670231"><a href="/runtime/debug/heapdump_test.go.html#8670156">runtime</a></span><span class="op" id="8670238">.</span><span class="ident" id="8670239">GOOS</span>&nbsp;<span class="op" id="8670244">==</span>&nbsp;<span class="string" id="8670247">&#34;nacl&#34;</span>&nbsp;<span class="op" id="8670254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8670258"><a href="/runtime/debug/heapdump_test.go.html#8670211">t</a></span><span class="op" id="8670259">.</span><span class="ident" id="8670260">Skip</span><span class="op" id="8670264">(</span><span class="string" id="8670265">&#34;WriteHeapDump&nbsp;is&nbsp;not&nbsp;available&nbsp;on&nbsp;NaCl.&#34;</span><span class="op" id="8670306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8670309">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8670312">f</span><span class="op" id="8670313">,</span>&nbsp;<span class="ident" id="8670315">err</span>&nbsp;<span class="op" id="8670319">:=</span>&nbsp;<span class="ident" id="8670322"><a href="/runtime/debug/heapdump_test.go.html#8670137">ioutil</a></span><span class="op" id="8670328">.</span><span class="ident" id="8670329">TempFile</span><span class="op" id="8670337">(</span><span class="string" id="8670338">&#34;&#34;</span><span class="op" id="8670340">,</span>&nbsp;<span class="string" id="8670342">&#34;heapdumptest&#34;</span><span class="op" id="8670356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8670359">if</span>&nbsp;<span class="ident" id="8670362"><a href="/runtime/debug/heapdump_test.go.html#8670315">err</a></span>&nbsp;<span class="op" id="8670366">!=</span>&nbsp;<span class="ident" id="8670369">nil</span>&nbsp;<span class="op" id="8670373">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8670377"><a href="/runtime/debug/heapdump_test.go.html#8670211">t</a></span><span class="op" id="8670378">.</span><span class="ident" id="8670379">Fatalf</span><span class="op" id="8670385">(</span><span class="string" id="8670386">&#34;TempFile&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8670407">,</span>&nbsp;<span class="ident" id="8670409"><a href="/runtime/debug/heapdump_test.go.html#8670315">err</a></span><span class="op" id="8670412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8670415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8670418">defer</span>&nbsp;<span class="ident" id="8670424"><a href="/runtime/debug/heapdump_test.go.html#8670150">os</a></span><span class="op" id="8670426">.</span><span class="ident" id="8670427">Remove</span><span class="op" id="8670433">(</span><span class="ident" id="8670434"><a href="/runtime/debug/heapdump_test.go.html#8670312">f</a></span><span class="op" id="8670435">.</span><span class="ident" id="8670436">Name</span><span class="op" id="8670440">(</span><span class="op" id="8670441">)</span><span class="op" id="8670442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8670445">defer</span>&nbsp;<span class="ident" id="8670451"><a href="/runtime/debug/heapdump_test.go.html#8670312">f</a></span><span class="op" id="8670452">.</span><span class="ident" id="8670453">Close</span><span class="op" id="8670458">(</span><span class="op" id="8670459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8670462"><a href="/runtime/debug/garbage.go.html#6021220">WriteHeapDump</a></span><span class="op" id="8670475">(</span><span class="ident" id="8670476"><a href="/runtime/debug/heapdump_test.go.html#8670312">f</a></span><span class="op" id="8670477">.</span><span class="ident" id="8670478">Fd</span><span class="op" id="8670480">(</span><span class="op" id="8670481">)</span><span class="op" id="8670482">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8670485">fi</span><span class="op" id="8670487">,</span>&nbsp;<span class="ident" id="8670489"><a href="/runtime/debug/heapdump_test.go.html#8670315">err</a></span>&nbsp;<span class="op" id="8670493">:=</span>&nbsp;<span class="ident" id="8670496"><a href="/runtime/debug/heapdump_test.go.html#8670312">f</a></span><span class="op" id="8670497">.</span><span class="ident" id="8670498">Stat</span><span class="op" id="8670502">(</span><span class="op" id="8670503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8670506">if</span>&nbsp;<span class="ident" id="8670509"><a href="/runtime/debug/heapdump_test.go.html#8670315">err</a></span>&nbsp;<span class="op" id="8670513">!=</span>&nbsp;<span class="ident" id="8670516">nil</span>&nbsp;<span class="op" id="8670520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8670524"><a href="/runtime/debug/heapdump_test.go.html#8670211">t</a></span><span class="op" id="8670525">.</span><span class="ident" id="8670526">Fatalf</span><span class="op" id="8670532">(</span><span class="string" id="8670533">&#34;Stat&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8670550">,</span>&nbsp;<span class="ident" id="8670552"><a href="/runtime/debug/heapdump_test.go.html#8670315">err</a></span><span class="op" id="8670555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8670558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8670561">const</span>&nbsp;<span class="ident" id="8670567">minSize</span>&nbsp;<span class="op" id="8670575">=</span>&nbsp;<span class="num" id="8670577">1</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8670580">if</span>&nbsp;<span class="ident" id="8670583">size</span>&nbsp;<span class="op" id="8670588">:=</span>&nbsp;<span class="ident" id="8670591"><a href="/runtime/debug/heapdump_test.go.html#8670485">fi</a></span><span class="op" id="8670593">.</span><span class="ident" id="8670594">Size</span><span class="op" id="8670598">(</span><span class="op" id="8670599">)</span><span class="op" id="8670600">;</span>&nbsp;<span class="ident" id="8670602"><a href="/runtime/debug/heapdump_test.go.html#8670583">size</a></span>&nbsp;<span class="op" id="8670607">&lt;</span>&nbsp;<span class="ident" id="8670609"><a href="/runtime/debug/heapdump_test.go.html#8670567">minSize</a></span>&nbsp;<span class="op" id="8670617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8670621"><a href="/runtime/debug/heapdump_test.go.html#8670211">t</a></span><span class="op" id="8670622">.</span><span class="ident" id="8670623">Fatalf</span><span class="op" id="8670629">(</span><span class="string" id="8670630">&#34;Heap&nbsp;dump&nbsp;size&nbsp;%d&nbsp;bytes,&nbsp;expected&nbsp;at&nbsp;least&nbsp;%d&nbsp;bytes&#34;</span><span class="op" id="8670683">,</span>&nbsp;<span class="ident" id="8670685"><a href="/runtime/debug/heapdump_test.go.html#8670583">size</a></span><span class="op" id="8670689">,</span>&nbsp;<span class="ident" id="8670691"><a href="/runtime/debug/heapdump_test.go.html#8670567">minSize</a></span><span class="op" id="8670698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8670701">}</span><br>
<span class="lineno"></span><span class="op" id="8670703">}</span>
</div>
</body>
</html>
