<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/rand</h2>
<ul>
<li><a href="/gostd/crypto/rand/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/rand/rand.go.html">rand.go</a></li>
<li><a href="/gostd/crypto/rand/rand_linux.go.html">rand_linux.go</a></li>
<li><a href="/gostd/crypto/rand/rand_test.go.html">rand_test.go</a></li>
<li><a href="/gostd/crypto/rand/rand_unix.go.html">rand_unix.go</a></li>
<li><a href="/gostd/crypto/rand/util.go.html">util.go</a></li>
<li><a href="/gostd/crypto/rand/util_test.go.html">util_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4831913">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4831969">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4832023">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4832074">package</span>&nbsp;<span class="ident" id="4832082">rand</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4832088">import</span>&nbsp;<span class="op" id="4832095">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4832098">&#34;internal/syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4832118">&#34;sync&#34;</span><br>
<span class="lineno">10</span><span class="op" id="4832125">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4832128">func</span>&nbsp;<span class="ident" id="4832133">init</span><span class="op" id="4832137">(</span><span class="op" id="4832138">)</span>&nbsp;<span class="op" id="4832140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4832143">altGetRandom</span>&nbsp;<span class="op" id="4832156">=</span>&nbsp;<span class="ident" id="4832158">getRandomLinux</span><br>
<span class="lineno"></span><span class="op" id="4832173">}</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="4832176">var</span>&nbsp;<span class="op" id="4832180">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4832183">once</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4832194">sync</span><span class="op" id="4832198">.</span><span class="ident" id="4832199">Once</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4832205">useSyscall</span>&nbsp;<span class="builtintype" id="4832216">bool</span><br>
<span class="lineno"></span><span class="op" id="4832221">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="4832224">func</span>&nbsp;<span class="ident" id="4832229">pickStrategy</span><span class="op" id="4832241">(</span><span class="op" id="4832242">)</span>&nbsp;<span class="op" id="4832244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4832247">//&nbsp;Test&nbsp;whether&nbsp;we&nbsp;should&nbsp;use&nbsp;the&nbsp;system&nbsp;call&nbsp;or&nbsp;/dev/urandom.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4832311">//&nbsp;We&#39;ll&nbsp;fall&nbsp;back&nbsp;to&nbsp;urandom&nbsp;if:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4832346">//&nbsp;-&nbsp;the&nbsp;kernel&nbsp;is&nbsp;too&nbsp;old&nbsp;(before&nbsp;3.17)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4832388">//&nbsp;-&nbsp;the&nbsp;machine&nbsp;has&nbsp;no&nbsp;entropy&nbsp;available&nbsp;(early&nbsp;boot&nbsp;+&nbsp;no&nbsp;hardware</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4832457">//&nbsp;&nbsp;&nbsp;entropy&nbsp;source?)&nbsp;and&nbsp;we&nbsp;want&nbsp;to&nbsp;avoid&nbsp;blocking&nbsp;later.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4832517">var</span>&nbsp;<span class="ident" id="4832521">buf</span>&nbsp;<span class="op" id="4832525">[</span><span class="num" id="4832526">1</span><span class="op" id="4832527">]</span><span class="builtintype" id="4832528">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4832534">n</span><span class="op" id="4832535">,</span>&nbsp;<span class="ident" id="4832537">err</span>&nbsp;<span class="op" id="4832541">:=</span>&nbsp;<span class="ident" id="4832544">syscall</span><span class="op" id="4832551">.</span><span class="ident" id="4832552">GetRandom</span><span class="op" id="4832561">(</span><span class="ident" id="4832562">buf</span><span class="op" id="4832565">[</span><span class="op" id="4832566">:</span><span class="op" id="4832567">]</span><span class="op" id="4832568">,</span>&nbsp;<span class="ident" id="4832570">syscall</span><span class="op" id="4832577">.</span><span class="ident" id="4832578">GRND_NONBLOCK</span><span class="op" id="4832591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4832594">useSyscall</span>&nbsp;<span class="op" id="4832605">=</span>&nbsp;<span class="ident" id="4832607">n</span>&nbsp;<span class="op" id="4832609">==</span>&nbsp;<span class="num" id="4832612">1</span>&nbsp;<span class="op" id="4832614">&amp;&amp;</span>&nbsp;<span class="ident" id="4832617">err</span>&nbsp;<span class="op" id="4832621">==</span>&nbsp;<span class="ident" id="4832624">nil</span><br>
<span class="lineno">30</span><span class="op" id="4832628">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4832631">func</span>&nbsp;<span class="ident" id="4832636">getRandomLinux</span><span class="op" id="4832650">(</span><span class="ident" id="4832651">p</span>&nbsp;<span class="op" id="4832653">[</span><span class="op" id="4832654">]</span><span class="builtintype" id="4832655">byte</span><span class="op" id="4832659">)</span>&nbsp;<span class="op" id="4832661">(</span><span class="ident" id="4832662">ok</span>&nbsp;<span class="builtintype" id="4832665">bool</span><span class="op" id="4832669">)</span>&nbsp;<span class="op" id="4832671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4832674">once</span><span class="op" id="4832678">.</span><span class="ident" id="4832679">Do</span><span class="op" id="4832681">(</span><span class="ident" id="4832682">pickStrategy</span><span class="op" id="4832694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4832697">if</span>&nbsp;<span class="op" id="4832700">!</span><span class="ident" id="4832701">useSyscall</span>&nbsp;<span class="op" id="4832712">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4832716">return</span>&nbsp;<span class="builtintype" id="4832723">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4832730">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4832733">n</span><span class="op" id="4832734">,</span>&nbsp;<span class="ident" id="4832736">err</span>&nbsp;<span class="op" id="4832740">:=</span>&nbsp;<span class="ident" id="4832743">syscall</span><span class="op" id="4832750">.</span><span class="ident" id="4832751">GetRandom</span><span class="op" id="4832760">(</span><span class="ident" id="4832761">p</span><span class="op" id="4832762">,</span>&nbsp;<span class="num" id="4832764">0</span><span class="op" id="4832765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4832768">return</span>&nbsp;<span class="ident" id="4832775">n</span>&nbsp;<span class="op" id="4832777">==</span>&nbsp;<span class="builtinfunc" id="4832780">len</span><span class="op" id="4832783">(</span><span class="ident" id="4832784">p</span><span class="op" id="4832785">)</span>&nbsp;<span class="op" id="4832787">&amp;&amp;</span>&nbsp;<span class="ident" id="4832790">err</span>&nbsp;<span class="op" id="4832794">==</span>&nbsp;<span class="ident" id="4832797">nil</span><br>
<span class="lineno"></span><span class="op" id="4832801">}</span>
</div>
</body>
</html>
