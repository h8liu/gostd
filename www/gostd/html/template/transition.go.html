<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>html/template</h2>
<ul>
<li><a href="/gostd/html/template/attr.go.html">attr.go</a></li>
<li><a href="/gostd/html/template/clone_test.go.html">clone_test.go</a></li>
<li><a href="/gostd/html/template/content.go.html">content.go</a></li>
<li><a href="/gostd/html/template/content_test.go.html">content_test.go</a></li>
<li><a href="/gostd/html/template/context.go.html">context.go</a></li>
<li><a href="/gostd/html/template/css.go.html">css.go</a></li>
<li><a href="/gostd/html/template/css_test.go.html">css_test.go</a></li>
<li><a href="/gostd/html/template/doc.go.html">doc.go</a></li>
<li><a href="/gostd/html/template/error.go.html">error.go</a></li>
<li><a href="/gostd/html/template/escape.go.html">escape.go</a></li>
<li><a href="/gostd/html/template/escape_test.go.html">escape_test.go</a></li>
<li><a href="/gostd/html/template/html.go.html">html.go</a></li>
<li><a href="/gostd/html/template/html_test.go.html">html_test.go</a></li>
<li><a href="/gostd/html/template/js.go.html">js.go</a></li>
<li><a href="/gostd/html/template/js_test.go.html">js_test.go</a></li>
<li><a href="/gostd/html/template/template.go.html">template.go</a></li>
<li><a href="/gostd/html/template/transition.go.html" class="current">transition.go</a></li>
<li><a href="/gostd/html/template/url.go.html">url.go</a></li>
<li><a href="/gostd/html/template/url_test.go.html">url_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5201742">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5201797">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5201851">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5201902">package</span>&nbsp;<span class="ident" id="5201910">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5201920">import</span>&nbsp;<span class="op" id="5201927">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5201930">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5201939">&#34;strings&#34;</span><br>
<span class="lineno">10</span><span class="op" id="5201949">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5201952">//&nbsp;transitionFunc&nbsp;is&nbsp;the&nbsp;array&nbsp;of&nbsp;context&nbsp;transition&nbsp;functions&nbsp;for&nbsp;text&nbsp;nodes.</span><br>
<span class="lineno"></span><span class="comment" id="5202031">//&nbsp;A&nbsp;transition&nbsp;function&nbsp;takes&nbsp;a&nbsp;context&nbsp;and&nbsp;template&nbsp;text&nbsp;input,&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="5202109">//&nbsp;the&nbsp;updated&nbsp;context&nbsp;and&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;consumed&nbsp;from&nbsp;the&nbsp;front&nbsp;of&nbsp;the</span><br>
<span class="lineno">15</span><span class="comment" id="5202187">//&nbsp;input.</span><br>
<span class="lineno"></span><span class="keyword" id="5202197">var</span>&nbsp;<span class="ident" id="5202201">transitionFunc</span>&nbsp;<span class="op" id="5202216">=</span>&nbsp;<span class="op" id="5202218">[</span><span class="op" id="5202219">...</span><span class="op" id="5202222">]</span><span class="keyword" id="5202223">func</span><span class="op" id="5202227">(</span><span class="ident" id="5202228">context</span><span class="op" id="5202235">,</span>&nbsp;<span class="op" id="5202237">[</span><span class="op" id="5202238">]</span><span class="builtintype" id="5202239">byte</span><span class="op" id="5202243">)</span>&nbsp;<span class="op" id="5202245">(</span><span class="ident" id="5202246">context</span><span class="op" id="5202253">,</span>&nbsp;<span class="builtintype" id="5202255">int</span><span class="op" id="5202258">)</span><span class="op" id="5202259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5202262">stateText</span><span class="op" id="5202271">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5202280">tText</span><span class="op" id="5202285">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5202288">stateTag</span><span class="op" id="5202296">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5202306">tTag</span><span class="op" id="5202310">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5202313">stateAttrName</span><span class="op" id="5202326">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5202331">tAttrName</span><span class="op" id="5202340">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5202343">stateAfterName</span><span class="op" id="5202357">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5202361">tAfterName</span><span class="op" id="5202371">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5202374">stateBeforeValue</span><span class="op" id="5202390">:</span>&nbsp;<span class="ident" id="5202392">tBeforeValue</span><span class="op" id="5202404">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5202407">stateHTMLCmt</span><span class="op" id="5202419">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5202425">tHTMLCmt</span><span class="op" id="5202433">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5202436">stateRCDATA</span><span class="op" id="5202447">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5202454">tSpecialTagEnd</span><span class="op" id="5202468">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5202471">stateAttr</span><span class="op" id="5202480">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5202489">tAttr</span><span class="op" id="5202494">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5202497">stateURL</span><span class="op" id="5202505">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5202515">tURL</span><span class="op" id="5202519">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5202522">stateJS</span><span class="op" id="5202529">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5202540">tJS</span><span class="op" id="5202543">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5202546">stateJSDqStr</span><span class="op" id="5202558">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5202564">tJSDelimited</span><span class="op" id="5202576">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5202579">stateJSSqStr</span><span class="op" id="5202591">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5202597">tJSDelimited</span><span class="op" id="5202609">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5202612">stateJSRegexp</span><span class="op" id="5202625">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5202630">tJSDelimited</span><span class="op" id="5202642">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5202645">stateJSBlockCmt</span><span class="op" id="5202660">:</span>&nbsp;&nbsp;<span class="ident" id="5202663">tBlockCmt</span><span class="op" id="5202672">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5202675">stateJSLineCmt</span><span class="op" id="5202689">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5202693">tLineCmt</span><span class="op" id="5202701">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5202704">stateCSS</span><span class="op" id="5202712">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5202722">tCSS</span><span class="op" id="5202726">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5202729">stateCSSDqStr</span><span class="op" id="5202742">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5202747">tCSSStr</span><span class="op" id="5202754">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5202757">stateCSSSqStr</span><span class="op" id="5202770">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5202775">tCSSStr</span><span class="op" id="5202782">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5202785">stateCSSDqURL</span><span class="op" id="5202798">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5202803">tCSSStr</span><span class="op" id="5202810">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5202813">stateCSSSqURL</span><span class="op" id="5202826">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5202831">tCSSStr</span><span class="op" id="5202838">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5202841">stateCSSURL</span><span class="op" id="5202852">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5202859">tCSSStr</span><span class="op" id="5202866">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5202869">stateCSSBlockCmt</span><span class="op" id="5202885">:</span>&nbsp;<span class="ident" id="5202887">tBlockCmt</span><span class="op" id="5202896">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5202899">stateCSSLineCmt</span><span class="op" id="5202914">:</span>&nbsp;&nbsp;<span class="ident" id="5202917">tLineCmt</span><span class="op" id="5202925">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5202928">stateError</span><span class="op" id="5202938">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5202946">tError</span><span class="op" id="5202952">,</span><br>
<span class="lineno"></span><span class="op" id="5202954">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5202957">var</span>&nbsp;<span class="ident" id="5202961">commentStart</span>&nbsp;<span class="op" id="5202974">=</span>&nbsp;<span class="op" id="5202976">[</span><span class="op" id="5202977">]</span><span class="builtintype" id="5202978">byte</span><span class="op" id="5202982">(</span><span class="string" id="5202983">&#34;&lt;!--&#34;</span><span class="op" id="5202989">)</span><br>
<span class="lineno"></span><span class="keyword" id="5202991">var</span>&nbsp;<span class="ident" id="5202995">commentEnd</span>&nbsp;<span class="op" id="5203006">=</span>&nbsp;<span class="op" id="5203008">[</span><span class="op" id="5203009">]</span><span class="builtintype" id="5203010">byte</span><span class="op" id="5203014">(</span><span class="string" id="5203015">&#34;--&gt;&#34;</span><span class="op" id="5203020">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="5203023">//&nbsp;tText&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;text&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="5203087">func</span>&nbsp;<span class="ident" id="5203092">tText</span><span class="op" id="5203097">(</span><span class="ident" id="5203098">c</span>&nbsp;<span class="ident" id="5203100">context</span><span class="op" id="5203107">,</span>&nbsp;<span class="ident" id="5203109">s</span>&nbsp;<span class="op" id="5203111">[</span><span class="op" id="5203112">]</span><span class="builtintype" id="5203113">byte</span><span class="op" id="5203117">)</span>&nbsp;<span class="op" id="5203119">(</span><span class="ident" id="5203120">context</span><span class="op" id="5203127">,</span>&nbsp;<span class="builtintype" id="5203129">int</span><span class="op" id="5203132">)</span>&nbsp;<span class="op" id="5203134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5203137">k</span>&nbsp;<span class="op" id="5203139">:=</span>&nbsp;<span class="num" id="5203142">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5203145">for</span>&nbsp;<span class="op" id="5203149">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5203153">i</span>&nbsp;<span class="op" id="5203155">:=</span>&nbsp;<span class="ident" id="5203158">k</span>&nbsp;<span class="op" id="5203160">+</span>&nbsp;<span class="ident" id="5203162">bytes</span><span class="op" id="5203167">.</span><span class="ident" id="5203168">IndexByte</span><span class="op" id="5203177">(</span><span class="ident" id="5203178">s</span><span class="op" id="5203179">[</span><span class="ident" id="5203180">k</span><span class="op" id="5203181">:</span><span class="op" id="5203182">]</span><span class="op" id="5203183">,</span>&nbsp;<span class="string" id="5203185">&#39;&lt;&#39;</span><span class="op" id="5203188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5203192">if</span>&nbsp;<span class="ident" id="5203195">i</span>&nbsp;<span class="op" id="5203197">&lt;</span>&nbsp;<span class="ident" id="5203199">k</span>&nbsp;<span class="op" id="5203201">||</span>&nbsp;<span class="ident" id="5203204">i</span><span class="op" id="5203205">+</span><span class="num" id="5203206">1</span>&nbsp;<span class="op" id="5203208">==</span>&nbsp;<span class="builtinfunc" id="5203211">len</span><span class="op" id="5203214">(</span><span class="ident" id="5203215">s</span><span class="op" id="5203216">)</span>&nbsp;<span class="op" id="5203218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5203223">return</span>&nbsp;<span class="ident" id="5203230">c</span><span class="op" id="5203231">,</span>&nbsp;<span class="builtinfunc" id="5203233">len</span><span class="op" id="5203236">(</span><span class="ident" id="5203237">s</span><span class="op" id="5203238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5203242">}</span>&nbsp;<span class="keyword" id="5203244">else</span>&nbsp;<span class="keyword" id="5203249">if</span>&nbsp;<span class="ident" id="5203252">i</span><span class="op" id="5203253">+</span><span class="num" id="5203254">4</span>&nbsp;<span class="op" id="5203256">&lt;=</span>&nbsp;<span class="builtinfunc" id="5203259">len</span><span class="op" id="5203262">(</span><span class="ident" id="5203263">s</span><span class="op" id="5203264">)</span>&nbsp;<span class="op" id="5203266">&amp;&amp;</span>&nbsp;<span class="ident" id="5203269">bytes</span><span class="op" id="5203274">.</span><span class="ident" id="5203275">Equal</span><span class="op" id="5203280">(</span><span class="ident" id="5203281">commentStart</span><span class="op" id="5203293">,</span>&nbsp;<span class="ident" id="5203295">s</span><span class="op" id="5203296">[</span><span class="ident" id="5203297">i</span><span class="op" id="5203298">:</span><span class="ident" id="5203299">i</span><span class="op" id="5203300">+</span><span class="num" id="5203301">4</span><span class="op" id="5203302">]</span><span class="op" id="5203303">)</span>&nbsp;<span class="op" id="5203305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5203310">return</span>&nbsp;<span class="ident" id="5203317">context</span><span class="op" id="5203324">{</span><span class="ident" id="5203325">state</span><span class="op" id="5203330">:</span>&nbsp;<span class="ident" id="5203332">stateHTMLCmt</span><span class="op" id="5203344">}</span><span class="op" id="5203345">,</span>&nbsp;<span class="ident" id="5203347">i</span>&nbsp;<span class="op" id="5203349">+</span>&nbsp;<span class="num" id="5203351">4</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5203355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5203359">i</span><span class="op" id="5203360">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5203365">end</span>&nbsp;<span class="op" id="5203369">:=</span>&nbsp;<span class="builtintype" id="5203372">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5203380">if</span>&nbsp;<span class="ident" id="5203383">s</span><span class="op" id="5203384">[</span><span class="ident" id="5203385">i</span><span class="op" id="5203386">]</span>&nbsp;<span class="op" id="5203388">==</span>&nbsp;<span class="string" id="5203391">&#39;/&#39;</span>&nbsp;<span class="op" id="5203395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5203400">if</span>&nbsp;<span class="ident" id="5203403">i</span><span class="op" id="5203404">+</span><span class="num" id="5203405">1</span>&nbsp;<span class="op" id="5203407">==</span>&nbsp;<span class="builtinfunc" id="5203410">len</span><span class="op" id="5203413">(</span><span class="ident" id="5203414">s</span><span class="op" id="5203415">)</span>&nbsp;<span class="op" id="5203417">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5203423">return</span>&nbsp;<span class="ident" id="5203430">c</span><span class="op" id="5203431">,</span>&nbsp;<span class="builtinfunc" id="5203433">len</span><span class="op" id="5203436">(</span><span class="ident" id="5203437">s</span><span class="op" id="5203438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5203443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5203448">end</span><span class="op" id="5203451">,</span>&nbsp;<span class="ident" id="5203453">i</span>&nbsp;<span class="op" id="5203455">=</span>&nbsp;<span class="builtintype" id="5203457">true</span><span class="op" id="5203461">,</span>&nbsp;<span class="ident" id="5203463">i</span><span class="op" id="5203464">+</span><span class="num" id="5203465">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5203469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5203473">j</span><span class="op" id="5203474">,</span>&nbsp;<span class="ident" id="5203476">e</span>&nbsp;<span class="op" id="5203478">:=</span>&nbsp;<span class="ident" id="5203481">eatTagName</span><span class="op" id="5203491">(</span><span class="ident" id="5203492">s</span><span class="op" id="5203493">,</span>&nbsp;<span class="ident" id="5203495">i</span><span class="op" id="5203496">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5203500">if</span>&nbsp;<span class="ident" id="5203503">j</span>&nbsp;<span class="op" id="5203505">!=</span>&nbsp;<span class="ident" id="5203508">i</span>&nbsp;<span class="op" id="5203510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5203515">if</span>&nbsp;<span class="ident" id="5203518">end</span>&nbsp;<span class="op" id="5203522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5203528">e</span>&nbsp;<span class="op" id="5203530">=</span>&nbsp;<span class="ident" id="5203532">elementNone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5203547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5203552">//&nbsp;We&#39;ve&nbsp;found&nbsp;an&nbsp;HTML&nbsp;tag.</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5203583">return</span>&nbsp;<span class="ident" id="5203590">context</span><span class="op" id="5203597">{</span><span class="ident" id="5203598">state</span><span class="op" id="5203603">:</span>&nbsp;<span class="ident" id="5203605">stateTag</span><span class="op" id="5203613">,</span>&nbsp;<span class="ident" id="5203615">element</span><span class="op" id="5203622">:</span>&nbsp;<span class="ident" id="5203624">e</span><span class="op" id="5203625">}</span><span class="op" id="5203626">,</span>&nbsp;<span class="ident" id="5203628">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5203632">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5203636">k</span>&nbsp;<span class="op" id="5203638">=</span>&nbsp;<span class="ident" id="5203640">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5203643">}</span><br>
<span class="lineno"></span><span class="op" id="5203645">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="keyword" id="5203648">var</span>&nbsp;<span class="ident" id="5203652">elementContentType</span>&nbsp;<span class="op" id="5203671">=</span>&nbsp;<span class="op" id="5203673">[</span><span class="op" id="5203674">...</span><span class="op" id="5203677">]</span><span class="ident" id="5203678">state</span><span class="op" id="5203683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5203686">elementNone</span><span class="op" id="5203697">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5203703">stateText</span><span class="op" id="5203712">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5203715">elementScript</span><span class="op" id="5203728">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5203732">stateJS</span><span class="op" id="5203739">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5203742">elementStyle</span><span class="op" id="5203754">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5203759">stateCSS</span><span class="op" id="5203767">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5203770">elementTextarea</span><span class="op" id="5203785">:</span>&nbsp;<span class="ident" id="5203787">stateRCDATA</span><span class="op" id="5203798">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5203801">elementTitle</span><span class="op" id="5203813">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5203818">stateRCDATA</span><span class="op" id="5203829">,</span><br>
<span class="lineno"></span><span class="op" id="5203831">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5203834">//&nbsp;tTag&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;tag&nbsp;state.</span><br>
<span class="lineno">85</span><span class="keyword" id="5203896">func</span>&nbsp;<span class="ident" id="5203901">tTag</span><span class="op" id="5203905">(</span><span class="ident" id="5203906">c</span>&nbsp;<span class="ident" id="5203908">context</span><span class="op" id="5203915">,</span>&nbsp;<span class="ident" id="5203917">s</span>&nbsp;<span class="op" id="5203919">[</span><span class="op" id="5203920">]</span><span class="builtintype" id="5203921">byte</span><span class="op" id="5203925">)</span>&nbsp;<span class="op" id="5203927">(</span><span class="ident" id="5203928">context</span><span class="op" id="5203935">,</span>&nbsp;<span class="builtintype" id="5203937">int</span><span class="op" id="5203940">)</span>&nbsp;<span class="op" id="5203942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5203945">//&nbsp;Find&nbsp;the&nbsp;attribute&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5203974">i</span>&nbsp;<span class="op" id="5203976">:=</span>&nbsp;<span class="ident" id="5203979">eatWhiteSpace</span><span class="op" id="5203992">(</span><span class="ident" id="5203993">s</span><span class="op" id="5203994">,</span>&nbsp;<span class="num" id="5203996">0</span><span class="op" id="5203997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5204000">if</span>&nbsp;<span class="ident" id="5204003">i</span>&nbsp;<span class="op" id="5204005">==</span>&nbsp;<span class="builtinfunc" id="5204008">len</span><span class="op" id="5204011">(</span><span class="ident" id="5204012">s</span><span class="op" id="5204013">)</span>&nbsp;<span class="op" id="5204015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5204019">return</span>&nbsp;<span class="ident" id="5204026">c</span><span class="op" id="5204027">,</span>&nbsp;<span class="builtinfunc" id="5204029">len</span><span class="op" id="5204032">(</span><span class="ident" id="5204033">s</span><span class="op" id="5204034">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5204037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5204040">if</span>&nbsp;<span class="ident" id="5204043">s</span><span class="op" id="5204044">[</span><span class="ident" id="5204045">i</span><span class="op" id="5204046">]</span>&nbsp;<span class="op" id="5204048">==</span>&nbsp;<span class="string" id="5204051">&#39;&gt;&#39;</span>&nbsp;<span class="op" id="5204055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5204059">return</span>&nbsp;<span class="ident" id="5204066">context</span><span class="op" id="5204073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5204078">state</span><span class="op" id="5204083">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5204087">elementContentType</span><span class="op" id="5204105">[</span><span class="ident" id="5204106">c</span><span class="op" id="5204107">.</span><span class="ident" id="5204108">element</span><span class="op" id="5204115">]</span><span class="op" id="5204116">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5204121">element</span><span class="op" id="5204128">:</span>&nbsp;<span class="ident" id="5204130">c</span><span class="op" id="5204131">.</span><span class="ident" id="5204132">element</span><span class="op" id="5204139">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5204143">}</span><span class="op" id="5204144">,</span>&nbsp;<span class="ident" id="5204146">i</span>&nbsp;<span class="op" id="5204148">+</span>&nbsp;<span class="num" id="5204150">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5204153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5204156">j</span><span class="op" id="5204157">,</span>&nbsp;<span class="ident" id="5204159">err</span>&nbsp;<span class="op" id="5204163">:=</span>&nbsp;<span class="ident" id="5204166">eatAttrName</span><span class="op" id="5204177">(</span><span class="ident" id="5204178">s</span><span class="op" id="5204179">,</span>&nbsp;<span class="ident" id="5204181">i</span><span class="op" id="5204182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5204185">if</span>&nbsp;<span class="ident" id="5204188">err</span>&nbsp;<span class="op" id="5204192">!=</span>&nbsp;<span class="builtintype" id="5204195">nil</span>&nbsp;<span class="op" id="5204199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5204203">return</span>&nbsp;<span class="ident" id="5204210">context</span><span class="op" id="5204217">{</span><span class="ident" id="5204218">state</span><span class="op" id="5204223">:</span>&nbsp;<span class="ident" id="5204225">stateError</span><span class="op" id="5204235">,</span>&nbsp;<span class="ident" id="5204237">err</span><span class="op" id="5204240">:</span>&nbsp;<span class="ident" id="5204242">err</span><span class="op" id="5204245">}</span><span class="op" id="5204246">,</span>&nbsp;<span class="builtinfunc" id="5204248">len</span><span class="op" id="5204251">(</span><span class="ident" id="5204252">s</span><span class="op" id="5204253">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5204256">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5204259">state</span><span class="op" id="5204264">,</span>&nbsp;<span class="ident" id="5204266">attr</span>&nbsp;<span class="op" id="5204271">:=</span>&nbsp;<span class="ident" id="5204274">stateTag</span><span class="op" id="5204282">,</span>&nbsp;<span class="ident" id="5204284">attrNone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5204294">if</span>&nbsp;<span class="ident" id="5204297">i</span>&nbsp;<span class="op" id="5204299">==</span>&nbsp;<span class="ident" id="5204302">j</span>&nbsp;<span class="op" id="5204304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5204308">return</span>&nbsp;<span class="ident" id="5204315">context</span><span class="op" id="5204322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5204327">state</span><span class="op" id="5204332">:</span>&nbsp;<span class="ident" id="5204334">stateError</span><span class="op" id="5204344">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5204349">err</span><span class="op" id="5204352">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5204356">errorf</span><span class="op" id="5204362">(</span><span class="ident" id="5204363">ErrBadHTML</span><span class="op" id="5204373">,</span>&nbsp;<span class="builtintype" id="5204375">nil</span><span class="op" id="5204378">,</span>&nbsp;<span class="num" id="5204380">0</span><span class="op" id="5204381">,</span>&nbsp;<span class="string" id="5204383">&#34;expected&nbsp;space,&nbsp;attr&nbsp;name,&nbsp;or&nbsp;end&nbsp;of&nbsp;tag,&nbsp;but&nbsp;got&nbsp;%q&#34;</span><span class="op" id="5204437">,</span>&nbsp;<span class="ident" id="5204439">s</span><span class="op" id="5204440">[</span><span class="ident" id="5204441">i</span><span class="op" id="5204442">:</span><span class="op" id="5204443">]</span><span class="op" id="5204444">)</span><span class="op" id="5204445">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5204449">}</span><span class="op" id="5204450">,</span>&nbsp;<span class="builtinfunc" id="5204452">len</span><span class="op" id="5204455">(</span><span class="ident" id="5204456">s</span><span class="op" id="5204457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5204460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5204463">switch</span>&nbsp;<span class="ident" id="5204470">attrType</span><span class="op" id="5204478">(</span><span class="builtintype" id="5204479">string</span><span class="op" id="5204485">(</span><span class="ident" id="5204486">s</span><span class="op" id="5204487">[</span><span class="ident" id="5204488">i</span><span class="op" id="5204489">:</span><span class="ident" id="5204490">j</span><span class="op" id="5204491">]</span><span class="op" id="5204492">)</span><span class="op" id="5204493">)</span>&nbsp;<span class="op" id="5204495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5204498">case</span>&nbsp;<span class="ident" id="5204503">contentTypeURL</span><span class="op" id="5204517">:</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5204521">attr</span>&nbsp;<span class="op" id="5204526">=</span>&nbsp;<span class="ident" id="5204528">attrURL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5204537">case</span>&nbsp;<span class="ident" id="5204542">contentTypeCSS</span><span class="op" id="5204556">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5204560">attr</span>&nbsp;<span class="op" id="5204565">=</span>&nbsp;<span class="ident" id="5204567">attrStyle</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5204578">case</span>&nbsp;<span class="ident" id="5204583">contentTypeJS</span><span class="op" id="5204596">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5204600">attr</span>&nbsp;<span class="op" id="5204605">=</span>&nbsp;<span class="ident" id="5204607">attrScript</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5204619">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5204622">if</span>&nbsp;<span class="ident" id="5204625">j</span>&nbsp;<span class="op" id="5204627">==</span>&nbsp;<span class="builtinfunc" id="5204630">len</span><span class="op" id="5204633">(</span><span class="ident" id="5204634">s</span><span class="op" id="5204635">)</span>&nbsp;<span class="op" id="5204637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5204641">state</span>&nbsp;<span class="op" id="5204647">=</span>&nbsp;<span class="ident" id="5204649">stateAttrName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5204664">}</span>&nbsp;<span class="keyword" id="5204666">else</span>&nbsp;<span class="op" id="5204671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5204675">state</span>&nbsp;<span class="op" id="5204681">=</span>&nbsp;<span class="ident" id="5204683">stateAfterName</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5204699">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5204702">return</span>&nbsp;<span class="ident" id="5204709">context</span><span class="op" id="5204716">{</span><span class="ident" id="5204717">state</span><span class="op" id="5204722">:</span>&nbsp;<span class="ident" id="5204724">state</span><span class="op" id="5204729">,</span>&nbsp;<span class="ident" id="5204731">element</span><span class="op" id="5204738">:</span>&nbsp;<span class="ident" id="5204740">c</span><span class="op" id="5204741">.</span><span class="ident" id="5204742">element</span><span class="op" id="5204749">,</span>&nbsp;<span class="ident" id="5204751">attr</span><span class="op" id="5204755">:</span>&nbsp;<span class="ident" id="5204757">attr</span><span class="op" id="5204761">}</span><span class="op" id="5204762">,</span>&nbsp;<span class="ident" id="5204764">j</span><br>
<span class="lineno"></span><span class="op" id="5204766">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5204769">//&nbsp;tAttrName&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;stateAttrName.</span><br>
<span class="lineno">125</span><span class="keyword" id="5204836">func</span>&nbsp;<span class="ident" id="5204841">tAttrName</span><span class="op" id="5204850">(</span><span class="ident" id="5204851">c</span>&nbsp;<span class="ident" id="5204853">context</span><span class="op" id="5204860">,</span>&nbsp;<span class="ident" id="5204862">s</span>&nbsp;<span class="op" id="5204864">[</span><span class="op" id="5204865">]</span><span class="builtintype" id="5204866">byte</span><span class="op" id="5204870">)</span>&nbsp;<span class="op" id="5204872">(</span><span class="ident" id="5204873">context</span><span class="op" id="5204880">,</span>&nbsp;<span class="builtintype" id="5204882">int</span><span class="op" id="5204885">)</span>&nbsp;<span class="op" id="5204887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5204890">i</span><span class="op" id="5204891">,</span>&nbsp;<span class="ident" id="5204893">err</span>&nbsp;<span class="op" id="5204897">:=</span>&nbsp;<span class="ident" id="5204900">eatAttrName</span><span class="op" id="5204911">(</span><span class="ident" id="5204912">s</span><span class="op" id="5204913">,</span>&nbsp;<span class="num" id="5204915">0</span><span class="op" id="5204916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5204919">if</span>&nbsp;<span class="ident" id="5204922">err</span>&nbsp;<span class="op" id="5204926">!=</span>&nbsp;<span class="builtintype" id="5204929">nil</span>&nbsp;<span class="op" id="5204933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5204937">return</span>&nbsp;<span class="ident" id="5204944">context</span><span class="op" id="5204951">{</span><span class="ident" id="5204952">state</span><span class="op" id="5204957">:</span>&nbsp;<span class="ident" id="5204959">stateError</span><span class="op" id="5204969">,</span>&nbsp;<span class="ident" id="5204971">err</span><span class="op" id="5204974">:</span>&nbsp;<span class="ident" id="5204976">err</span><span class="op" id="5204979">}</span><span class="op" id="5204980">,</span>&nbsp;<span class="builtinfunc" id="5204982">len</span><span class="op" id="5204985">(</span><span class="ident" id="5204986">s</span><span class="op" id="5204987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5204990">}</span>&nbsp;<span class="keyword" id="5204992">else</span>&nbsp;<span class="keyword" id="5204997">if</span>&nbsp;<span class="ident" id="5205000">i</span>&nbsp;<span class="op" id="5205002">!=</span>&nbsp;<span class="builtinfunc" id="5205005">len</span><span class="op" id="5205008">(</span><span class="ident" id="5205009">s</span><span class="op" id="5205010">)</span>&nbsp;<span class="op" id="5205012">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5205016">c</span><span class="op" id="5205017">.</span><span class="ident" id="5205018">state</span>&nbsp;<span class="op" id="5205024">=</span>&nbsp;<span class="ident" id="5205026">stateAfterName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5205042">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5205045">return</span>&nbsp;<span class="ident" id="5205052">c</span><span class="op" id="5205053">,</span>&nbsp;<span class="ident" id="5205055">i</span><br>
<span class="lineno"></span><span class="op" id="5205057">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="comment" id="5205060">//&nbsp;tAfterName&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;stateAfterName.</span><br>
<span class="lineno"></span><span class="keyword" id="5205129">func</span>&nbsp;<span class="ident" id="5205134">tAfterName</span><span class="op" id="5205144">(</span><span class="ident" id="5205145">c</span>&nbsp;<span class="ident" id="5205147">context</span><span class="op" id="5205154">,</span>&nbsp;<span class="ident" id="5205156">s</span>&nbsp;<span class="op" id="5205158">[</span><span class="op" id="5205159">]</span><span class="builtintype" id="5205160">byte</span><span class="op" id="5205164">)</span>&nbsp;<span class="op" id="5205166">(</span><span class="ident" id="5205167">context</span><span class="op" id="5205174">,</span>&nbsp;<span class="builtintype" id="5205176">int</span><span class="op" id="5205179">)</span>&nbsp;<span class="op" id="5205181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5205184">//&nbsp;Look&nbsp;for&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5205221">i</span>&nbsp;<span class="op" id="5205223">:=</span>&nbsp;<span class="ident" id="5205226">eatWhiteSpace</span><span class="op" id="5205239">(</span><span class="ident" id="5205240">s</span><span class="op" id="5205241">,</span>&nbsp;<span class="num" id="5205243">0</span><span class="op" id="5205244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5205247">if</span>&nbsp;<span class="ident" id="5205250">i</span>&nbsp;<span class="op" id="5205252">==</span>&nbsp;<span class="builtinfunc" id="5205255">len</span><span class="op" id="5205258">(</span><span class="ident" id="5205259">s</span><span class="op" id="5205260">)</span>&nbsp;<span class="op" id="5205262">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5205266">return</span>&nbsp;<span class="ident" id="5205273">c</span><span class="op" id="5205274">,</span>&nbsp;<span class="builtinfunc" id="5205276">len</span><span class="op" id="5205279">(</span><span class="ident" id="5205280">s</span><span class="op" id="5205281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5205284">}</span>&nbsp;<span class="keyword" id="5205286">else</span>&nbsp;<span class="keyword" id="5205291">if</span>&nbsp;<span class="ident" id="5205294">s</span><span class="op" id="5205295">[</span><span class="ident" id="5205296">i</span><span class="op" id="5205297">]</span>&nbsp;<span class="op" id="5205299">!=</span>&nbsp;<span class="string" id="5205302">&#39;=&#39;</span>&nbsp;<span class="op" id="5205306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5205310">//&nbsp;Occurs&nbsp;due&nbsp;to&nbsp;tag&nbsp;ending&nbsp;&#39;&gt;&#39;,&nbsp;and&nbsp;valueless&nbsp;attribute.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5205370">c</span><span class="op" id="5205371">.</span><span class="ident" id="5205372">state</span>&nbsp;<span class="op" id="5205378">=</span>&nbsp;<span class="ident" id="5205380">stateTag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5205391">return</span>&nbsp;<span class="ident" id="5205398">c</span><span class="op" id="5205399">,</span>&nbsp;<span class="ident" id="5205401">i</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5205404">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5205407">c</span><span class="op" id="5205408">.</span><span class="ident" id="5205409">state</span>&nbsp;<span class="op" id="5205415">=</span>&nbsp;<span class="ident" id="5205417">stateBeforeValue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5205435">//&nbsp;Consume&nbsp;the&nbsp;&#34;=&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5205456">return</span>&nbsp;<span class="ident" id="5205463">c</span><span class="op" id="5205464">,</span>&nbsp;<span class="ident" id="5205466">i</span>&nbsp;<span class="op" id="5205468">+</span>&nbsp;<span class="num" id="5205470">1</span><br>
<span class="lineno"></span><span class="op" id="5205472">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="keyword" id="5205475">var</span>&nbsp;<span class="ident" id="5205479">attrStartStates</span>&nbsp;<span class="op" id="5205495">=</span>&nbsp;<span class="op" id="5205497">[</span><span class="op" id="5205498">...</span><span class="op" id="5205501">]</span><span class="ident" id="5205502">state</span><span class="op" id="5205507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5205510">attrNone</span><span class="op" id="5205518">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5205522">stateAttr</span><span class="op" id="5205531">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5205534">attrScript</span><span class="op" id="5205544">:</span>&nbsp;<span class="ident" id="5205546">stateJS</span><span class="op" id="5205553">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5205556">attrStyle</span><span class="op" id="5205565">:</span>&nbsp;&nbsp;<span class="ident" id="5205568">stateCSS</span><span class="op" id="5205576">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5205579">attrURL</span><span class="op" id="5205586">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5205591">stateURL</span><span class="op" id="5205599">,</span><br>
<span class="lineno"></span><span class="op" id="5205601">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5205604">//&nbsp;tBeforeValue&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;stateBeforeValue.</span><br>
<span class="lineno"></span><span class="keyword" id="5205677">func</span>&nbsp;<span class="ident" id="5205682">tBeforeValue</span><span class="op" id="5205694">(</span><span class="ident" id="5205695">c</span>&nbsp;<span class="ident" id="5205697">context</span><span class="op" id="5205704">,</span>&nbsp;<span class="ident" id="5205706">s</span>&nbsp;<span class="op" id="5205708">[</span><span class="op" id="5205709">]</span><span class="builtintype" id="5205710">byte</span><span class="op" id="5205714">)</span>&nbsp;<span class="op" id="5205716">(</span><span class="ident" id="5205717">context</span><span class="op" id="5205724">,</span>&nbsp;<span class="builtintype" id="5205726">int</span><span class="op" id="5205729">)</span>&nbsp;<span class="op" id="5205731">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5205734">i</span>&nbsp;<span class="op" id="5205736">:=</span>&nbsp;<span class="ident" id="5205739">eatWhiteSpace</span><span class="op" id="5205752">(</span><span class="ident" id="5205753">s</span><span class="op" id="5205754">,</span>&nbsp;<span class="num" id="5205756">0</span><span class="op" id="5205757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5205760">if</span>&nbsp;<span class="ident" id="5205763">i</span>&nbsp;<span class="op" id="5205765">==</span>&nbsp;<span class="builtinfunc" id="5205768">len</span><span class="op" id="5205771">(</span><span class="ident" id="5205772">s</span><span class="op" id="5205773">)</span>&nbsp;<span class="op" id="5205775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5205779">return</span>&nbsp;<span class="ident" id="5205786">c</span><span class="op" id="5205787">,</span>&nbsp;<span class="builtinfunc" id="5205789">len</span><span class="op" id="5205792">(</span><span class="ident" id="5205793">s</span><span class="op" id="5205794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5205797">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5205800">//&nbsp;Find&nbsp;the&nbsp;attribute&nbsp;delimiter.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5205834">delim</span>&nbsp;<span class="op" id="5205840">:=</span>&nbsp;<span class="ident" id="5205843">delimSpaceOrTagEnd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5205863">switch</span>&nbsp;<span class="ident" id="5205870">s</span><span class="op" id="5205871">[</span><span class="ident" id="5205872">i</span><span class="op" id="5205873">]</span>&nbsp;<span class="op" id="5205875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5205878">case</span>&nbsp;<span class="string" id="5205883">&#39;\&#39;&#39;</span><span class="op" id="5205887">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5205891">delim</span><span class="op" id="5205896">,</span>&nbsp;<span class="ident" id="5205898">i</span>&nbsp;<span class="op" id="5205900">=</span>&nbsp;<span class="ident" id="5205902">delimSingleQuote</span><span class="op" id="5205918">,</span>&nbsp;<span class="ident" id="5205920">i</span><span class="op" id="5205921">+</span><span class="num" id="5205922">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5205925">case</span>&nbsp;<span class="string" id="5205930">&#39;&#34;&#39;</span><span class="op" id="5205933">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5205937">delim</span><span class="op" id="5205942">,</span>&nbsp;<span class="ident" id="5205944">i</span>&nbsp;<span class="op" id="5205946">=</span>&nbsp;<span class="ident" id="5205948">delimDoubleQuote</span><span class="op" id="5205964">,</span>&nbsp;<span class="ident" id="5205966">i</span><span class="op" id="5205967">+</span><span class="num" id="5205968">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5205971">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5205974">c</span><span class="op" id="5205975">.</span><span class="ident" id="5205976">state</span><span class="op" id="5205981">,</span>&nbsp;<span class="ident" id="5205983">c</span><span class="op" id="5205984">.</span><span class="ident" id="5205985">delim</span><span class="op" id="5205990">,</span>&nbsp;<span class="ident" id="5205992">c</span><span class="op" id="5205993">.</span><span class="ident" id="5205994">attr</span>&nbsp;<span class="op" id="5205999">=</span>&nbsp;<span class="ident" id="5206001">attrStartStates</span><span class="op" id="5206016">[</span><span class="ident" id="5206017">c</span><span class="op" id="5206018">.</span><span class="ident" id="5206019">attr</span><span class="op" id="5206023">]</span><span class="op" id="5206024">,</span>&nbsp;<span class="ident" id="5206026">delim</span><span class="op" id="5206031">,</span>&nbsp;<span class="ident" id="5206033">attrNone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5206043">return</span>&nbsp;<span class="ident" id="5206050">c</span><span class="op" id="5206051">,</span>&nbsp;<span class="ident" id="5206053">i</span><br>
<span class="lineno"></span><span class="op" id="5206055">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="comment" id="5206058">//&nbsp;tHTMLCmt&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;stateHTMLCmt.</span><br>
<span class="lineno"></span><span class="keyword" id="5206123">func</span>&nbsp;<span class="ident" id="5206128">tHTMLCmt</span><span class="op" id="5206136">(</span><span class="ident" id="5206137">c</span>&nbsp;<span class="ident" id="5206139">context</span><span class="op" id="5206146">,</span>&nbsp;<span class="ident" id="5206148">s</span>&nbsp;<span class="op" id="5206150">[</span><span class="op" id="5206151">]</span><span class="builtintype" id="5206152">byte</span><span class="op" id="5206156">)</span>&nbsp;<span class="op" id="5206158">(</span><span class="ident" id="5206159">context</span><span class="op" id="5206166">,</span>&nbsp;<span class="builtintype" id="5206168">int</span><span class="op" id="5206171">)</span>&nbsp;<span class="op" id="5206173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5206176">if</span>&nbsp;<span class="ident" id="5206179">i</span>&nbsp;<span class="op" id="5206181">:=</span>&nbsp;<span class="ident" id="5206184">bytes</span><span class="op" id="5206189">.</span><span class="ident" id="5206190">Index</span><span class="op" id="5206195">(</span><span class="ident" id="5206196">s</span><span class="op" id="5206197">,</span>&nbsp;<span class="ident" id="5206199">commentEnd</span><span class="op" id="5206209">)</span><span class="op" id="5206210">;</span>&nbsp;<span class="ident" id="5206212">i</span>&nbsp;<span class="op" id="5206214">!=</span>&nbsp;<span class="op" id="5206217">-</span><span class="num" id="5206218">1</span>&nbsp;<span class="op" id="5206220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5206224">return</span>&nbsp;<span class="ident" id="5206231">context</span><span class="op" id="5206238">{</span><span class="op" id="5206239">}</span><span class="op" id="5206240">,</span>&nbsp;<span class="ident" id="5206242">i</span>&nbsp;<span class="op" id="5206244">+</span>&nbsp;<span class="num" id="5206246">3</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5206249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5206252">return</span>&nbsp;<span class="ident" id="5206259">c</span><span class="op" id="5206260">,</span>&nbsp;<span class="builtinfunc" id="5206262">len</span><span class="op" id="5206265">(</span><span class="ident" id="5206266">s</span><span class="op" id="5206267">)</span><br>
<span class="lineno"></span><span class="op" id="5206269">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5206272">//&nbsp;specialTagEndMarkers&nbsp;maps&nbsp;element&nbsp;types&nbsp;to&nbsp;the&nbsp;character&nbsp;sequence&nbsp;that</span><br>
<span class="lineno">185</span><span class="comment" id="5206346">//&nbsp;case-insensitively&nbsp;signals&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;special&nbsp;tag&nbsp;body.</span><br>
<span class="lineno"></span><span class="keyword" id="5206409">var</span>&nbsp;<span class="ident" id="5206413">specialTagEndMarkers</span>&nbsp;<span class="op" id="5206434">=</span>&nbsp;<span class="op" id="5206436">[</span><span class="op" id="5206437">...</span><span class="op" id="5206440">]</span><span class="builtintype" id="5206441">string</span><span class="op" id="5206447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5206450">elementScript</span><span class="op" id="5206463">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="5206467">&#34;&lt;/script&#34;</span><span class="op" id="5206477">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5206480">elementStyle</span><span class="op" id="5206492">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5206497">&#34;&lt;/style&#34;</span><span class="op" id="5206506">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5206509">elementTextarea</span><span class="op" id="5206524">:</span>&nbsp;<span class="string" id="5206526">&#34;&lt;/textarea&#34;</span><span class="op" id="5206538">,</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5206541">elementTitle</span><span class="op" id="5206553">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5206558">&#34;&lt;/title&#34;</span><span class="op" id="5206567">,</span><br>
<span class="lineno"></span><span class="op" id="5206569">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5206572">//&nbsp;tSpecialTagEnd&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;raw&nbsp;text&nbsp;and&nbsp;RCDATA</span><br>
<span class="lineno"></span><span class="comment" id="5206649">//&nbsp;element&nbsp;states.</span><br>
<span class="lineno">195</span><span class="keyword" id="5206668">func</span>&nbsp;<span class="ident" id="5206673">tSpecialTagEnd</span><span class="op" id="5206687">(</span><span class="ident" id="5206688">c</span>&nbsp;<span class="ident" id="5206690">context</span><span class="op" id="5206697">,</span>&nbsp;<span class="ident" id="5206699">s</span>&nbsp;<span class="op" id="5206701">[</span><span class="op" id="5206702">]</span><span class="builtintype" id="5206703">byte</span><span class="op" id="5206707">)</span>&nbsp;<span class="op" id="5206709">(</span><span class="ident" id="5206710">context</span><span class="op" id="5206717">,</span>&nbsp;<span class="builtintype" id="5206719">int</span><span class="op" id="5206722">)</span>&nbsp;<span class="op" id="5206724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5206727">if</span>&nbsp;<span class="ident" id="5206730">c</span><span class="op" id="5206731">.</span><span class="ident" id="5206732">element</span>&nbsp;<span class="op" id="5206740">!=</span>&nbsp;<span class="ident" id="5206743">elementNone</span>&nbsp;<span class="op" id="5206755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5206759">if</span>&nbsp;<span class="ident" id="5206762">i</span>&nbsp;<span class="op" id="5206764">:=</span>&nbsp;<span class="ident" id="5206767">strings</span><span class="op" id="5206774">.</span><span class="ident" id="5206775">Index</span><span class="op" id="5206780">(</span><span class="ident" id="5206781">strings</span><span class="op" id="5206788">.</span><span class="ident" id="5206789">ToLower</span><span class="op" id="5206796">(</span><span class="builtintype" id="5206797">string</span><span class="op" id="5206803">(</span><span class="ident" id="5206804">s</span><span class="op" id="5206805">)</span><span class="op" id="5206806">)</span><span class="op" id="5206807">,</span>&nbsp;<span class="ident" id="5206809">specialTagEndMarkers</span><span class="op" id="5206829">[</span><span class="ident" id="5206830">c</span><span class="op" id="5206831">.</span><span class="ident" id="5206832">element</span><span class="op" id="5206839">]</span><span class="op" id="5206840">)</span><span class="op" id="5206841">;</span>&nbsp;<span class="ident" id="5206843">i</span>&nbsp;<span class="op" id="5206845">!=</span>&nbsp;<span class="op" id="5206848">-</span><span class="num" id="5206849">1</span>&nbsp;<span class="op" id="5206851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5206856">return</span>&nbsp;<span class="ident" id="5206863">context</span><span class="op" id="5206870">{</span><span class="op" id="5206871">}</span><span class="op" id="5206872">,</span>&nbsp;<span class="ident" id="5206874">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5206878">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5206881">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5206884">return</span>&nbsp;<span class="ident" id="5206891">c</span><span class="op" id="5206892">,</span>&nbsp;<span class="builtinfunc" id="5206894">len</span><span class="op" id="5206897">(</span><span class="ident" id="5206898">s</span><span class="op" id="5206899">)</span><br>
<span class="lineno"></span><span class="op" id="5206901">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5206904">//&nbsp;tAttr&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;attribute&nbsp;state.</span><br>
<span class="lineno">205</span><span class="keyword" id="5206973">func</span>&nbsp;<span class="ident" id="5206978">tAttr</span><span class="op" id="5206983">(</span><span class="ident" id="5206984">c</span>&nbsp;<span class="ident" id="5206986">context</span><span class="op" id="5206993">,</span>&nbsp;<span class="ident" id="5206995">s</span>&nbsp;<span class="op" id="5206997">[</span><span class="op" id="5206998">]</span><span class="builtintype" id="5206999">byte</span><span class="op" id="5207003">)</span>&nbsp;<span class="op" id="5207005">(</span><span class="ident" id="5207006">context</span><span class="op" id="5207013">,</span>&nbsp;<span class="builtintype" id="5207015">int</span><span class="op" id="5207018">)</span>&nbsp;<span class="op" id="5207020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5207023">return</span>&nbsp;<span class="ident" id="5207030">c</span><span class="op" id="5207031">,</span>&nbsp;<span class="builtinfunc" id="5207033">len</span><span class="op" id="5207036">(</span><span class="ident" id="5207037">s</span><span class="op" id="5207038">)</span><br>
<span class="lineno"></span><span class="op" id="5207040">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5207043">//&nbsp;tURL&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;URL&nbsp;state.</span><br>
<span class="lineno">210</span><span class="keyword" id="5207105">func</span>&nbsp;<span class="ident" id="5207110">tURL</span><span class="op" id="5207114">(</span><span class="ident" id="5207115">c</span>&nbsp;<span class="ident" id="5207117">context</span><span class="op" id="5207124">,</span>&nbsp;<span class="ident" id="5207126">s</span>&nbsp;<span class="op" id="5207128">[</span><span class="op" id="5207129">]</span><span class="builtintype" id="5207130">byte</span><span class="op" id="5207134">)</span>&nbsp;<span class="op" id="5207136">(</span><span class="ident" id="5207137">context</span><span class="op" id="5207144">,</span>&nbsp;<span class="builtintype" id="5207146">int</span><span class="op" id="5207149">)</span>&nbsp;<span class="op" id="5207151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5207154">if</span>&nbsp;<span class="ident" id="5207157">bytes</span><span class="op" id="5207162">.</span><span class="ident" id="5207163">IndexAny</span><span class="op" id="5207171">(</span><span class="ident" id="5207172">s</span><span class="op" id="5207173">,</span>&nbsp;<span class="string" id="5207175">&#34;#?&#34;</span><span class="op" id="5207179">)</span>&nbsp;<span class="op" id="5207181">&gt;=</span>&nbsp;<span class="num" id="5207184">0</span>&nbsp;<span class="op" id="5207186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5207190">c</span><span class="op" id="5207191">.</span><span class="ident" id="5207192">urlPart</span>&nbsp;<span class="op" id="5207200">=</span>&nbsp;<span class="ident" id="5207202">urlPartQueryOrFrag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5207222">}</span>&nbsp;<span class="keyword" id="5207224">else</span>&nbsp;<span class="keyword" id="5207229">if</span>&nbsp;<span class="builtinfunc" id="5207232">len</span><span class="op" id="5207235">(</span><span class="ident" id="5207236">s</span><span class="op" id="5207237">)</span>&nbsp;<span class="op" id="5207239">!=</span>&nbsp;<span class="ident" id="5207242">eatWhiteSpace</span><span class="op" id="5207255">(</span><span class="ident" id="5207256">s</span><span class="op" id="5207257">,</span>&nbsp;<span class="num" id="5207259">0</span><span class="op" id="5207260">)</span>&nbsp;<span class="op" id="5207262">&amp;&amp;</span>&nbsp;<span class="ident" id="5207265">c</span><span class="op" id="5207266">.</span><span class="ident" id="5207267">urlPart</span>&nbsp;<span class="op" id="5207275">==</span>&nbsp;<span class="ident" id="5207278">urlPartNone</span>&nbsp;<span class="op" id="5207290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5207294">//&nbsp;HTML5&nbsp;uses&nbsp;&#34;Valid&nbsp;URL&nbsp;potentially&nbsp;surrounded&nbsp;by&nbsp;spaces&#34;&nbsp;for</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5207359">//&nbsp;attrs:&nbsp;http://www.w3.org/TR/html5/index.html#attributes-1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5207422">c</span><span class="op" id="5207423">.</span><span class="ident" id="5207424">urlPart</span>&nbsp;<span class="op" id="5207432">=</span>&nbsp;<span class="ident" id="5207434">urlPartPreQuery</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5207451">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5207454">return</span>&nbsp;<span class="ident" id="5207461">c</span><span class="op" id="5207462">,</span>&nbsp;<span class="builtinfunc" id="5207464">len</span><span class="op" id="5207467">(</span><span class="ident" id="5207468">s</span><span class="op" id="5207469">)</span><br>
<span class="lineno"></span><span class="op" id="5207471">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="5207474">//&nbsp;tJS&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;JS&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="5207534">func</span>&nbsp;<span class="ident" id="5207539">tJS</span><span class="op" id="5207542">(</span><span class="ident" id="5207543">c</span>&nbsp;<span class="ident" id="5207545">context</span><span class="op" id="5207552">,</span>&nbsp;<span class="ident" id="5207554">s</span>&nbsp;<span class="op" id="5207556">[</span><span class="op" id="5207557">]</span><span class="builtintype" id="5207558">byte</span><span class="op" id="5207562">)</span>&nbsp;<span class="op" id="5207564">(</span><span class="ident" id="5207565">context</span><span class="op" id="5207572">,</span>&nbsp;<span class="builtintype" id="5207574">int</span><span class="op" id="5207577">)</span>&nbsp;<span class="op" id="5207579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5207582">i</span>&nbsp;<span class="op" id="5207584">:=</span>&nbsp;<span class="ident" id="5207587">bytes</span><span class="op" id="5207592">.</span><span class="ident" id="5207593">IndexAny</span><span class="op" id="5207601">(</span><span class="ident" id="5207602">s</span><span class="op" id="5207603">,</span>&nbsp;<span class="string" id="5207605">`&#34;&#39;/`</span><span class="op" id="5207610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5207613">if</span>&nbsp;<span class="ident" id="5207616">i</span>&nbsp;<span class="op" id="5207618">==</span>&nbsp;<span class="op" id="5207621">-</span><span class="num" id="5207622">1</span>&nbsp;<span class="op" id="5207624">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5207628">//&nbsp;Entire&nbsp;input&nbsp;is&nbsp;non&nbsp;string,&nbsp;comment,&nbsp;regexp&nbsp;tokens.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5207685">c</span><span class="op" id="5207686">.</span><span class="ident" id="5207687">jsCtx</span>&nbsp;<span class="op" id="5207693">=</span>&nbsp;<span class="ident" id="5207695">nextJSCtx</span><span class="op" id="5207704">(</span><span class="ident" id="5207705">s</span><span class="op" id="5207706">,</span>&nbsp;<span class="ident" id="5207708">c</span><span class="op" id="5207709">.</span><span class="ident" id="5207710">jsCtx</span><span class="op" id="5207715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5207719">return</span>&nbsp;<span class="ident" id="5207726">c</span><span class="op" id="5207727">,</span>&nbsp;<span class="builtinfunc" id="5207729">len</span><span class="op" id="5207732">(</span><span class="ident" id="5207733">s</span><span class="op" id="5207734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5207737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5207740">c</span><span class="op" id="5207741">.</span><span class="ident" id="5207742">jsCtx</span>&nbsp;<span class="op" id="5207748">=</span>&nbsp;<span class="ident" id="5207750">nextJSCtx</span><span class="op" id="5207759">(</span><span class="ident" id="5207760">s</span><span class="op" id="5207761">[</span><span class="op" id="5207762">:</span><span class="ident" id="5207763">i</span><span class="op" id="5207764">]</span><span class="op" id="5207765">,</span>&nbsp;<span class="ident" id="5207767">c</span><span class="op" id="5207768">.</span><span class="ident" id="5207769">jsCtx</span><span class="op" id="5207774">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5207777">switch</span>&nbsp;<span class="ident" id="5207784">s</span><span class="op" id="5207785">[</span><span class="ident" id="5207786">i</span><span class="op" id="5207787">]</span>&nbsp;<span class="op" id="5207789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5207792">case</span>&nbsp;<span class="string" id="5207797">&#39;&#34;&#39;</span><span class="op" id="5207800">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5207804">c</span><span class="op" id="5207805">.</span><span class="ident" id="5207806">state</span><span class="op" id="5207811">,</span>&nbsp;<span class="ident" id="5207813">c</span><span class="op" id="5207814">.</span><span class="ident" id="5207815">jsCtx</span>&nbsp;<span class="op" id="5207821">=</span>&nbsp;<span class="ident" id="5207823">stateJSDqStr</span><span class="op" id="5207835">,</span>&nbsp;<span class="ident" id="5207837">jsCtxRegexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5207850">case</span>&nbsp;<span class="string" id="5207855">&#39;\&#39;&#39;</span><span class="op" id="5207859">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5207863">c</span><span class="op" id="5207864">.</span><span class="ident" id="5207865">state</span><span class="op" id="5207870">,</span>&nbsp;<span class="ident" id="5207872">c</span><span class="op" id="5207873">.</span><span class="ident" id="5207874">jsCtx</span>&nbsp;<span class="op" id="5207880">=</span>&nbsp;<span class="ident" id="5207882">stateJSSqStr</span><span class="op" id="5207894">,</span>&nbsp;<span class="ident" id="5207896">jsCtxRegexp</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5207909">case</span>&nbsp;<span class="string" id="5207914">&#39;/&#39;</span><span class="op" id="5207917">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5207921">switch</span>&nbsp;<span class="op" id="5207928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5207932">case</span>&nbsp;<span class="ident" id="5207937">i</span><span class="op" id="5207938">+</span><span class="num" id="5207939">1</span>&nbsp;<span class="op" id="5207941">&lt;</span>&nbsp;<span class="builtinfunc" id="5207943">len</span><span class="op" id="5207946">(</span><span class="ident" id="5207947">s</span><span class="op" id="5207948">)</span>&nbsp;<span class="op" id="5207950">&amp;&amp;</span>&nbsp;<span class="ident" id="5207953">s</span><span class="op" id="5207954">[</span><span class="ident" id="5207955">i</span><span class="op" id="5207956">+</span><span class="num" id="5207957">1</span><span class="op" id="5207958">]</span>&nbsp;<span class="op" id="5207960">==</span>&nbsp;<span class="string" id="5207963">&#39;/&#39;</span><span class="op" id="5207966">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5207971">c</span><span class="op" id="5207972">.</span><span class="ident" id="5207973">state</span><span class="op" id="5207978">,</span>&nbsp;<span class="ident" id="5207980">i</span>&nbsp;<span class="op" id="5207982">=</span>&nbsp;<span class="ident" id="5207984">stateJSLineCmt</span><span class="op" id="5207998">,</span>&nbsp;<span class="ident" id="5208000">i</span><span class="op" id="5208001">+</span><span class="num" id="5208002">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5208006">case</span>&nbsp;<span class="ident" id="5208011">i</span><span class="op" id="5208012">+</span><span class="num" id="5208013">1</span>&nbsp;<span class="op" id="5208015">&lt;</span>&nbsp;<span class="builtinfunc" id="5208017">len</span><span class="op" id="5208020">(</span><span class="ident" id="5208021">s</span><span class="op" id="5208022">)</span>&nbsp;<span class="op" id="5208024">&amp;&amp;</span>&nbsp;<span class="ident" id="5208027">s</span><span class="op" id="5208028">[</span><span class="ident" id="5208029">i</span><span class="op" id="5208030">+</span><span class="num" id="5208031">1</span><span class="op" id="5208032">]</span>&nbsp;<span class="op" id="5208034">==</span>&nbsp;<span class="string" id="5208037">&#39;*&#39;</span><span class="op" id="5208040">:</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5208045">c</span><span class="op" id="5208046">.</span><span class="ident" id="5208047">state</span><span class="op" id="5208052">,</span>&nbsp;<span class="ident" id="5208054">i</span>&nbsp;<span class="op" id="5208056">=</span>&nbsp;<span class="ident" id="5208058">stateJSBlockCmt</span><span class="op" id="5208073">,</span>&nbsp;<span class="ident" id="5208075">i</span><span class="op" id="5208076">+</span><span class="num" id="5208077">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5208081">case</span>&nbsp;<span class="ident" id="5208086">c</span><span class="op" id="5208087">.</span><span class="ident" id="5208088">jsCtx</span>&nbsp;<span class="op" id="5208094">==</span>&nbsp;<span class="ident" id="5208097">jsCtxRegexp</span><span class="op" id="5208108">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5208113">c</span><span class="op" id="5208114">.</span><span class="ident" id="5208115">state</span>&nbsp;<span class="op" id="5208121">=</span>&nbsp;<span class="ident" id="5208123">stateJSRegexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5208139">case</span>&nbsp;<span class="ident" id="5208144">c</span><span class="op" id="5208145">.</span><span class="ident" id="5208146">jsCtx</span>&nbsp;<span class="op" id="5208152">==</span>&nbsp;<span class="ident" id="5208155">jsCtxDivOp</span><span class="op" id="5208165">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5208170">c</span><span class="op" id="5208171">.</span><span class="ident" id="5208172">jsCtx</span>&nbsp;<span class="op" id="5208178">=</span>&nbsp;<span class="ident" id="5208180">jsCtxRegexp</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5208194">default</span><span class="op" id="5208201">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5208206">return</span>&nbsp;<span class="ident" id="5208213">context</span><span class="op" id="5208220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5208226">state</span><span class="op" id="5208231">:</span>&nbsp;<span class="ident" id="5208233">stateError</span><span class="op" id="5208243">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5208249">err</span><span class="op" id="5208252">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5208256">errorf</span><span class="op" id="5208262">(</span><span class="ident" id="5208263">ErrSlashAmbig</span><span class="op" id="5208276">,</span>&nbsp;<span class="builtintype" id="5208278">nil</span><span class="op" id="5208281">,</span>&nbsp;<span class="num" id="5208283">0</span><span class="op" id="5208284">,</span>&nbsp;<span class="string" id="5208286">&#34;&#39;/&#39;&nbsp;could&nbsp;start&nbsp;a&nbsp;division&nbsp;or&nbsp;regexp:&nbsp;%.32q&#34;</span><span class="op" id="5208331">,</span>&nbsp;<span class="ident" id="5208333">s</span><span class="op" id="5208334">[</span><span class="ident" id="5208335">i</span><span class="op" id="5208336">:</span><span class="op" id="5208337">]</span><span class="op" id="5208338">)</span><span class="op" id="5208339">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5208344">}</span><span class="op" id="5208345">,</span>&nbsp;<span class="builtinfunc" id="5208347">len</span><span class="op" id="5208350">(</span><span class="ident" id="5208351">s</span><span class="op" id="5208352">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5208356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5208359">default</span><span class="op" id="5208366">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5208370">panic</span><span class="op" id="5208375">(</span><span class="string" id="5208376">&#34;unreachable&#34;</span><span class="op" id="5208389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5208392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5208395">return</span>&nbsp;<span class="ident" id="5208402">c</span><span class="op" id="5208403">,</span>&nbsp;<span class="ident" id="5208405">i</span>&nbsp;<span class="op" id="5208407">+</span>&nbsp;<span class="num" id="5208409">1</span><br>
<span class="lineno">255</span><span class="op" id="5208411">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5208414">//&nbsp;tJSDelimited&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;JS&nbsp;string&nbsp;and&nbsp;regexp</span><br>
<span class="lineno"></span><span class="comment" id="5208494">//&nbsp;states.</span><br>
<span class="lineno"></span><span class="keyword" id="5208505">func</span>&nbsp;<span class="ident" id="5208510">tJSDelimited</span><span class="op" id="5208522">(</span><span class="ident" id="5208523">c</span>&nbsp;<span class="ident" id="5208525">context</span><span class="op" id="5208532">,</span>&nbsp;<span class="ident" id="5208534">s</span>&nbsp;<span class="op" id="5208536">[</span><span class="op" id="5208537">]</span><span class="builtintype" id="5208538">byte</span><span class="op" id="5208542">)</span>&nbsp;<span class="op" id="5208544">(</span><span class="ident" id="5208545">context</span><span class="op" id="5208552">,</span>&nbsp;<span class="builtintype" id="5208554">int</span><span class="op" id="5208557">)</span>&nbsp;<span class="op" id="5208559">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5208562">specials</span>&nbsp;<span class="op" id="5208571">:=</span>&nbsp;<span class="string" id="5208574">`\&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5208580">switch</span>&nbsp;<span class="ident" id="5208587">c</span><span class="op" id="5208588">.</span><span class="ident" id="5208589">state</span>&nbsp;<span class="op" id="5208595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5208598">case</span>&nbsp;<span class="ident" id="5208603">stateJSSqStr</span><span class="op" id="5208615">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5208619">specials</span>&nbsp;<span class="op" id="5208628">=</span>&nbsp;<span class="string" id="5208630">`\&#39;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5208636">case</span>&nbsp;<span class="ident" id="5208641">stateJSRegexp</span><span class="op" id="5208654">:</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5208658">specials</span>&nbsp;<span class="op" id="5208667">=</span>&nbsp;<span class="string" id="5208669">`\/[]`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5208677">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5208681">k</span><span class="op" id="5208682">,</span>&nbsp;<span class="ident" id="5208684">inCharset</span>&nbsp;<span class="op" id="5208694">:=</span>&nbsp;<span class="num" id="5208697">0</span><span class="op" id="5208698">,</span>&nbsp;<span class="builtintype" id="5208700">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5208707">for</span>&nbsp;<span class="op" id="5208711">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5208715">i</span>&nbsp;<span class="op" id="5208717">:=</span>&nbsp;<span class="ident" id="5208720">k</span>&nbsp;<span class="op" id="5208722">+</span>&nbsp;<span class="ident" id="5208724">bytes</span><span class="op" id="5208729">.</span><span class="ident" id="5208730">IndexAny</span><span class="op" id="5208738">(</span><span class="ident" id="5208739">s</span><span class="op" id="5208740">[</span><span class="ident" id="5208741">k</span><span class="op" id="5208742">:</span><span class="op" id="5208743">]</span><span class="op" id="5208744">,</span>&nbsp;<span class="ident" id="5208746">specials</span><span class="op" id="5208754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5208758">if</span>&nbsp;<span class="ident" id="5208761">i</span>&nbsp;<span class="op" id="5208763">&lt;</span>&nbsp;<span class="ident" id="5208765">k</span>&nbsp;<span class="op" id="5208767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5208772">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5208780">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5208784">switch</span>&nbsp;<span class="ident" id="5208791">s</span><span class="op" id="5208792">[</span><span class="ident" id="5208793">i</span><span class="op" id="5208794">]</span>&nbsp;<span class="op" id="5208796">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5208800">case</span>&nbsp;<span class="string" id="5208805">&#39;\\&#39;</span><span class="op" id="5208809">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5208814">i</span><span class="op" id="5208815">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5208821">if</span>&nbsp;<span class="ident" id="5208824">i</span>&nbsp;<span class="op" id="5208826">==</span>&nbsp;<span class="builtinfunc" id="5208829">len</span><span class="op" id="5208832">(</span><span class="ident" id="5208833">s</span><span class="op" id="5208834">)</span>&nbsp;<span class="op" id="5208836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5208842">return</span>&nbsp;<span class="ident" id="5208849">context</span><span class="op" id="5208856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5208863">state</span><span class="op" id="5208868">:</span>&nbsp;<span class="ident" id="5208870">stateError</span><span class="op" id="5208880">,</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5208887">err</span><span class="op" id="5208890">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5208894">errorf</span><span class="op" id="5208900">(</span><span class="ident" id="5208901">ErrPartialEscape</span><span class="op" id="5208917">,</span>&nbsp;<span class="builtintype" id="5208919">nil</span><span class="op" id="5208922">,</span>&nbsp;<span class="num" id="5208924">0</span><span class="op" id="5208925">,</span>&nbsp;<span class="string" id="5208927">&#34;unfinished&nbsp;escape&nbsp;sequence&nbsp;in&nbsp;JS&nbsp;string:&nbsp;%q&#34;</span><span class="op" id="5208972">,</span>&nbsp;<span class="ident" id="5208974">s</span><span class="op" id="5208975">)</span><span class="op" id="5208976">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5208982">}</span><span class="op" id="5208983">,</span>&nbsp;<span class="builtinfunc" id="5208985">len</span><span class="op" id="5208988">(</span><span class="ident" id="5208989">s</span><span class="op" id="5208990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5208995">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5208999">case</span>&nbsp;<span class="string" id="5209004">&#39;[&#39;</span><span class="op" id="5209007">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5209012">inCharset</span>&nbsp;<span class="op" id="5209022">=</span>&nbsp;<span class="builtintype" id="5209024">true</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5209031">case</span>&nbsp;<span class="string" id="5209036">&#39;]&#39;</span><span class="op" id="5209039">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5209044">inCharset</span>&nbsp;<span class="op" id="5209054">=</span>&nbsp;<span class="builtintype" id="5209056">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5209064">default</span><span class="op" id="5209071">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5209076">//&nbsp;end&nbsp;delimiter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5209096">if</span>&nbsp;<span class="op" id="5209099">!</span><span class="ident" id="5209100">inCharset</span>&nbsp;<span class="op" id="5209110">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5209116">c</span><span class="op" id="5209117">.</span><span class="ident" id="5209118">state</span><span class="op" id="5209123">,</span>&nbsp;<span class="ident" id="5209125">c</span><span class="op" id="5209126">.</span><span class="ident" id="5209127">jsCtx</span>&nbsp;<span class="op" id="5209133">=</span>&nbsp;<span class="ident" id="5209135">stateJS</span><span class="op" id="5209142">,</span>&nbsp;<span class="ident" id="5209144">jsCtxDivOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5209159">return</span>&nbsp;<span class="ident" id="5209166">c</span><span class="op" id="5209167">,</span>&nbsp;<span class="ident" id="5209169">i</span>&nbsp;<span class="op" id="5209171">+</span>&nbsp;<span class="num" id="5209173">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5209178">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5209182">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5209186">k</span>&nbsp;<span class="op" id="5209188">=</span>&nbsp;<span class="ident" id="5209190">i</span>&nbsp;<span class="op" id="5209192">+</span>&nbsp;<span class="num" id="5209194">1</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5209197">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5209201">if</span>&nbsp;<span class="ident" id="5209204">inCharset</span>&nbsp;<span class="op" id="5209214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5209218">//&nbsp;This&nbsp;can&nbsp;be&nbsp;fixed&nbsp;by&nbsp;making&nbsp;context&nbsp;richer&nbsp;if&nbsp;interpolation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5209283">//&nbsp;into&nbsp;charsets&nbsp;is&nbsp;desired.</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5209314">return</span>&nbsp;<span class="ident" id="5209321">context</span><span class="op" id="5209328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5209333">state</span><span class="op" id="5209338">:</span>&nbsp;<span class="ident" id="5209340">stateError</span><span class="op" id="5209350">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5209355">err</span><span class="op" id="5209358">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5209362">errorf</span><span class="op" id="5209368">(</span><span class="ident" id="5209369">ErrPartialCharset</span><span class="op" id="5209386">,</span>&nbsp;<span class="builtintype" id="5209388">nil</span><span class="op" id="5209391">,</span>&nbsp;<span class="num" id="5209393">0</span><span class="op" id="5209394">,</span>&nbsp;<span class="string" id="5209396">&#34;unfinished&nbsp;JS&nbsp;regexp&nbsp;charset:&nbsp;%q&#34;</span><span class="op" id="5209430">,</span>&nbsp;<span class="ident" id="5209432">s</span><span class="op" id="5209433">)</span><span class="op" id="5209434">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5209438">}</span><span class="op" id="5209439">,</span>&nbsp;<span class="builtinfunc" id="5209441">len</span><span class="op" id="5209444">(</span><span class="ident" id="5209445">s</span><span class="op" id="5209446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5209449">}</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5209453">return</span>&nbsp;<span class="ident" id="5209460">c</span><span class="op" id="5209461">,</span>&nbsp;<span class="builtinfunc" id="5209463">len</span><span class="op" id="5209466">(</span><span class="ident" id="5209467">s</span><span class="op" id="5209468">)</span><br>
<span class="lineno"></span><span class="op" id="5209470">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5209473">var</span>&nbsp;<span class="ident" id="5209477">blockCommentEnd</span>&nbsp;<span class="op" id="5209493">=</span>&nbsp;<span class="op" id="5209495">[</span><span class="op" id="5209496">]</span><span class="builtintype" id="5209497">byte</span><span class="op" id="5209501">(</span><span class="string" id="5209502">&#34;*/&#34;</span><span class="op" id="5209506">)</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span><span class="comment" id="5209509">//&nbsp;tBlockCmt&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;/*comment*/&nbsp;states.</span><br>
<span class="lineno"></span><span class="keyword" id="5209581">func</span>&nbsp;<span class="ident" id="5209586">tBlockCmt</span><span class="op" id="5209595">(</span><span class="ident" id="5209596">c</span>&nbsp;<span class="ident" id="5209598">context</span><span class="op" id="5209605">,</span>&nbsp;<span class="ident" id="5209607">s</span>&nbsp;<span class="op" id="5209609">[</span><span class="op" id="5209610">]</span><span class="builtintype" id="5209611">byte</span><span class="op" id="5209615">)</span>&nbsp;<span class="op" id="5209617">(</span><span class="ident" id="5209618">context</span><span class="op" id="5209625">,</span>&nbsp;<span class="builtintype" id="5209627">int</span><span class="op" id="5209630">)</span>&nbsp;<span class="op" id="5209632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5209635">i</span>&nbsp;<span class="op" id="5209637">:=</span>&nbsp;<span class="ident" id="5209640">bytes</span><span class="op" id="5209645">.</span><span class="ident" id="5209646">Index</span><span class="op" id="5209651">(</span><span class="ident" id="5209652">s</span><span class="op" id="5209653">,</span>&nbsp;<span class="ident" id="5209655">blockCommentEnd</span><span class="op" id="5209670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5209673">if</span>&nbsp;<span class="ident" id="5209676">i</span>&nbsp;<span class="op" id="5209678">==</span>&nbsp;<span class="op" id="5209681">-</span><span class="num" id="5209682">1</span>&nbsp;<span class="op" id="5209684">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5209688">return</span>&nbsp;<span class="ident" id="5209695">c</span><span class="op" id="5209696">,</span>&nbsp;<span class="builtinfunc" id="5209698">len</span><span class="op" id="5209701">(</span><span class="ident" id="5209702">s</span><span class="op" id="5209703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5209706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5209709">switch</span>&nbsp;<span class="ident" id="5209716">c</span><span class="op" id="5209717">.</span><span class="ident" id="5209718">state</span>&nbsp;<span class="op" id="5209724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5209727">case</span>&nbsp;<span class="ident" id="5209732">stateJSBlockCmt</span><span class="op" id="5209747">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5209751">c</span><span class="op" id="5209752">.</span><span class="ident" id="5209753">state</span>&nbsp;<span class="op" id="5209759">=</span>&nbsp;<span class="ident" id="5209761">stateJS</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5209770">case</span>&nbsp;<span class="ident" id="5209775">stateCSSBlockCmt</span><span class="op" id="5209791">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5209795">c</span><span class="op" id="5209796">.</span><span class="ident" id="5209797">state</span>&nbsp;<span class="op" id="5209803">=</span>&nbsp;<span class="ident" id="5209805">stateCSS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5209815">default</span><span class="op" id="5209822">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5209826">panic</span><span class="op" id="5209831">(</span><span class="ident" id="5209832">c</span><span class="op" id="5209833">.</span><span class="ident" id="5209834">state</span><span class="op" id="5209839">.</span><span class="ident" id="5209840">String</span><span class="op" id="5209846">(</span><span class="op" id="5209847">)</span><span class="op" id="5209848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5209851">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5209854">return</span>&nbsp;<span class="ident" id="5209861">c</span><span class="op" id="5209862">,</span>&nbsp;<span class="ident" id="5209864">i</span>&nbsp;<span class="op" id="5209866">+</span>&nbsp;<span class="num" id="5209868">2</span><br>
<span class="lineno"></span><span class="op" id="5209870">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5209873">//&nbsp;tLineCmt&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;//comment&nbsp;states.</span><br>
<span class="lineno"></span><span class="keyword" id="5209942">func</span>&nbsp;<span class="ident" id="5209947">tLineCmt</span><span class="op" id="5209955">(</span><span class="ident" id="5209956">c</span>&nbsp;<span class="ident" id="5209958">context</span><span class="op" id="5209965">,</span>&nbsp;<span class="ident" id="5209967">s</span>&nbsp;<span class="op" id="5209969">[</span><span class="op" id="5209970">]</span><span class="builtintype" id="5209971">byte</span><span class="op" id="5209975">)</span>&nbsp;<span class="op" id="5209977">(</span><span class="ident" id="5209978">context</span><span class="op" id="5209985">,</span>&nbsp;<span class="builtintype" id="5209987">int</span><span class="op" id="5209990">)</span>&nbsp;<span class="op" id="5209992">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5209995">var</span>&nbsp;<span class="ident" id="5209999">lineTerminators</span>&nbsp;<span class="builtintype" id="5210015">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5210023">var</span>&nbsp;<span class="ident" id="5210027">endState</span>&nbsp;<span class="ident" id="5210036">state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5210043">switch</span>&nbsp;<span class="ident" id="5210050">c</span><span class="op" id="5210051">.</span><span class="ident" id="5210052">state</span>&nbsp;<span class="op" id="5210058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5210061">case</span>&nbsp;<span class="ident" id="5210066">stateJSLineCmt</span><span class="op" id="5210080">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5210084">lineTerminators</span><span class="op" id="5210099">,</span>&nbsp;<span class="ident" id="5210101">endState</span>&nbsp;<span class="op" id="5210110">=</span>&nbsp;<span class="string" id="5210112">&#34;\n\r\u2028\u2029&#34;</span><span class="op" id="5210130">,</span>&nbsp;<span class="ident" id="5210132">stateJS</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5210141">case</span>&nbsp;<span class="ident" id="5210146">stateCSSLineCmt</span><span class="op" id="5210161">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5210165">lineTerminators</span><span class="op" id="5210180">,</span>&nbsp;<span class="ident" id="5210182">endState</span>&nbsp;<span class="op" id="5210191">=</span>&nbsp;<span class="string" id="5210193">&#34;\n\f\r&#34;</span><span class="op" id="5210201">,</span>&nbsp;<span class="ident" id="5210203">stateCSS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5210214">//&nbsp;Line&nbsp;comments&nbsp;are&nbsp;not&nbsp;part&nbsp;of&nbsp;any&nbsp;published&nbsp;CSS&nbsp;standard&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5210280">//&nbsp;are&nbsp;supported&nbsp;by&nbsp;the&nbsp;4&nbsp;major&nbsp;browsers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5210324">//&nbsp;This&nbsp;defines&nbsp;line&nbsp;comments&nbsp;as</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5210359">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LINECOMMENT&nbsp;::=&nbsp;&#34;//&#34;&nbsp;[^\n\f\d]*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5210400">//&nbsp;since&nbsp;http://www.w3.org/TR/css3-syntax/#SUBTOK-nl&nbsp;defines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5210463">//&nbsp;newlines:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5210478">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nl&nbsp;::=&nbsp;#xA&nbsp;|&nbsp;#xD&nbsp;#xA&nbsp;|&nbsp;#xD&nbsp;|&nbsp;#xC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5210519">default</span><span class="op" id="5210526">:</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5210530">panic</span><span class="op" id="5210535">(</span><span class="ident" id="5210536">c</span><span class="op" id="5210537">.</span><span class="ident" id="5210538">state</span><span class="op" id="5210543">.</span><span class="ident" id="5210544">String</span><span class="op" id="5210550">(</span><span class="op" id="5210551">)</span><span class="op" id="5210552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5210555">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5210559">i</span>&nbsp;<span class="op" id="5210561">:=</span>&nbsp;<span class="ident" id="5210564">bytes</span><span class="op" id="5210569">.</span><span class="ident" id="5210570">IndexAny</span><span class="op" id="5210578">(</span><span class="ident" id="5210579">s</span><span class="op" id="5210580">,</span>&nbsp;<span class="ident" id="5210582">lineTerminators</span><span class="op" id="5210597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5210600">if</span>&nbsp;<span class="ident" id="5210603">i</span>&nbsp;<span class="op" id="5210605">==</span>&nbsp;<span class="op" id="5210608">-</span><span class="num" id="5210609">1</span>&nbsp;<span class="op" id="5210611">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5210615">return</span>&nbsp;<span class="ident" id="5210622">c</span><span class="op" id="5210623">,</span>&nbsp;<span class="builtinfunc" id="5210625">len</span><span class="op" id="5210628">(</span><span class="ident" id="5210629">s</span><span class="op" id="5210630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5210633">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5210636">c</span><span class="op" id="5210637">.</span><span class="ident" id="5210638">state</span>&nbsp;<span class="op" id="5210644">=</span>&nbsp;<span class="ident" id="5210646">endState</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5210656">//&nbsp;Per&nbsp;section&nbsp;7.4&nbsp;of&nbsp;EcmaScript&nbsp;5&nbsp;:&nbsp;http://es5.github.com/#x7.4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5210722">//&nbsp;&#34;However,&nbsp;the&nbsp;LineTerminator&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;line&nbsp;is&nbsp;not</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5210785">//&nbsp;considered&nbsp;to&nbsp;be&nbsp;part&nbsp;of&nbsp;the&nbsp;single-line&nbsp;comment;&nbsp;it&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5210845">//&nbsp;recognized&nbsp;separately&nbsp;by&nbsp;the&nbsp;lexical&nbsp;grammar&nbsp;and&nbsp;becomes&nbsp;part</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5210911">//&nbsp;of&nbsp;the&nbsp;stream&nbsp;of&nbsp;input&nbsp;elements&nbsp;for&nbsp;the&nbsp;syntactic&nbsp;grammar.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5210975">return</span>&nbsp;<span class="ident" id="5210982">c</span><span class="op" id="5210983">,</span>&nbsp;<span class="ident" id="5210985">i</span><br>
<span class="lineno"></span><span class="op" id="5210987">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span><span class="comment" id="5210990">//&nbsp;tCSS&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;CSS&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="5211052">func</span>&nbsp;<span class="ident" id="5211057">tCSS</span><span class="op" id="5211061">(</span><span class="ident" id="5211062">c</span>&nbsp;<span class="ident" id="5211064">context</span><span class="op" id="5211071">,</span>&nbsp;<span class="ident" id="5211073">s</span>&nbsp;<span class="op" id="5211075">[</span><span class="op" id="5211076">]</span><span class="builtintype" id="5211077">byte</span><span class="op" id="5211081">)</span>&nbsp;<span class="op" id="5211083">(</span><span class="ident" id="5211084">context</span><span class="op" id="5211091">,</span>&nbsp;<span class="builtintype" id="5211093">int</span><span class="op" id="5211096">)</span>&nbsp;<span class="op" id="5211098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5211101">//&nbsp;CSS&nbsp;quoted&nbsp;strings&nbsp;are&nbsp;almost&nbsp;never&nbsp;used&nbsp;except&nbsp;for:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5211158">//&nbsp;(1)&nbsp;URLs&nbsp;as&nbsp;in&nbsp;background:&nbsp;&#34;/foo.png&#34;</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5211200">//&nbsp;(2)&nbsp;Multiword&nbsp;font-names&nbsp;as&nbsp;in&nbsp;font-family:&nbsp;&#34;Times&nbsp;New&nbsp;Roman&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5211266">//&nbsp;(3)&nbsp;List&nbsp;separators&nbsp;in&nbsp;content&nbsp;values&nbsp;as&nbsp;in&nbsp;inline-lists:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5211328">//&nbsp;&nbsp;&nbsp;&nbsp;&lt;style&gt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5211343">//&nbsp;&nbsp;&nbsp;&nbsp;ul.inlineList&nbsp;{&nbsp;list-style:&nbsp;none;&nbsp;padding:0&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5211396">//&nbsp;&nbsp;&nbsp;&nbsp;ul.inlineList&nbsp;&gt;&nbsp;li&nbsp;{&nbsp;display:&nbsp;inline&nbsp;}</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5211442">//&nbsp;&nbsp;&nbsp;&nbsp;ul.inlineList&nbsp;&gt;&nbsp;li:before&nbsp;{&nbsp;content:&nbsp;&#34;,&nbsp;&#34;&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5211493">//&nbsp;&nbsp;&nbsp;&nbsp;ul.inlineList&nbsp;&gt;&nbsp;li:first-child:before&nbsp;{&nbsp;content:&nbsp;&#34;&#34;&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5211554">//&nbsp;&nbsp;&nbsp;&nbsp;&lt;/style&gt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5211570">//&nbsp;&nbsp;&nbsp;&nbsp;&lt;ul&nbsp;class=inlineList&gt;&lt;li&gt;One&lt;li&gt;Two&lt;li&gt;Three&lt;/ul&gt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5211627">//&nbsp;(4)&nbsp;Attribute&nbsp;value&nbsp;selectors&nbsp;as&nbsp;in&nbsp;a[href=&#34;http://example.com/&#34;]</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5211697">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5211701">//&nbsp;We&nbsp;conservatively&nbsp;treat&nbsp;all&nbsp;strings&nbsp;as&nbsp;URLs,&nbsp;but&nbsp;make&nbsp;some</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5211764">//&nbsp;allowances&nbsp;to&nbsp;avoid&nbsp;confusion.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5211799">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5211803">//&nbsp;In&nbsp;(1),&nbsp;our&nbsp;conservative&nbsp;assumption&nbsp;is&nbsp;justified.</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5211857">//&nbsp;In&nbsp;(2),&nbsp;valid&nbsp;font&nbsp;names&nbsp;do&nbsp;not&nbsp;contain&nbsp;&#39;:&#39;,&nbsp;&#39;?&#39;,&nbsp;or&nbsp;&#39;#&#39;,&nbsp;so&nbsp;our</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5211926">//&nbsp;conservative&nbsp;assumption&nbsp;is&nbsp;fine&nbsp;since&nbsp;we&nbsp;will&nbsp;never&nbsp;transition&nbsp;past</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5211998">//&nbsp;urlPartPreQuery.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5212019">//&nbsp;In&nbsp;(3),&nbsp;our&nbsp;protocol&nbsp;heuristic&nbsp;should&nbsp;not&nbsp;be&nbsp;tripped,&nbsp;and&nbsp;there</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5212087">//&nbsp;should&nbsp;not&nbsp;be&nbsp;non-space&nbsp;content&nbsp;after&nbsp;a&nbsp;&#39;?&#39;&nbsp;or&nbsp;&#39;#&#39;,&nbsp;so&nbsp;as&nbsp;long&nbsp;as</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5212157">//&nbsp;we&nbsp;only&nbsp;%-encode&nbsp;RFC&nbsp;3986&nbsp;reserved&nbsp;characters&nbsp;we&nbsp;are&nbsp;ok.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5212218">//&nbsp;In&nbsp;(4),&nbsp;we&nbsp;should&nbsp;URL&nbsp;escape&nbsp;for&nbsp;URL&nbsp;attributes,&nbsp;and&nbsp;for&nbsp;others&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5212289">//&nbsp;have&nbsp;the&nbsp;attribute&nbsp;name&nbsp;available&nbsp;if&nbsp;our&nbsp;conservative&nbsp;assumption</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5212358">//&nbsp;proves&nbsp;problematic&nbsp;for&nbsp;real&nbsp;code.</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5212397">k</span>&nbsp;<span class="op" id="5212399">:=</span>&nbsp;<span class="num" id="5212402">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5212405">for</span>&nbsp;<span class="op" id="5212409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5212413">i</span>&nbsp;<span class="op" id="5212415">:=</span>&nbsp;<span class="ident" id="5212418">k</span>&nbsp;<span class="op" id="5212420">+</span>&nbsp;<span class="ident" id="5212422">bytes</span><span class="op" id="5212427">.</span><span class="ident" id="5212428">IndexAny</span><span class="op" id="5212436">(</span><span class="ident" id="5212437">s</span><span class="op" id="5212438">[</span><span class="ident" id="5212439">k</span><span class="op" id="5212440">:</span><span class="op" id="5212441">]</span><span class="op" id="5212442">,</span>&nbsp;<span class="string" id="5212444">`(&#34;&#39;/`</span><span class="op" id="5212450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5212454">if</span>&nbsp;<span class="ident" id="5212457">i</span>&nbsp;<span class="op" id="5212459">&lt;</span>&nbsp;<span class="ident" id="5212461">k</span>&nbsp;<span class="op" id="5212463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5212468">return</span>&nbsp;<span class="ident" id="5212475">c</span><span class="op" id="5212476">,</span>&nbsp;<span class="builtinfunc" id="5212478">len</span><span class="op" id="5212481">(</span><span class="ident" id="5212482">s</span><span class="op" id="5212483">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5212487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5212491">switch</span>&nbsp;<span class="ident" id="5212498">s</span><span class="op" id="5212499">[</span><span class="ident" id="5212500">i</span><span class="op" id="5212501">]</span>&nbsp;<span class="op" id="5212503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5212507">case</span>&nbsp;<span class="string" id="5212512">&#39;(&#39;</span><span class="op" id="5212515">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5212520">//&nbsp;Look&nbsp;for&nbsp;url&nbsp;to&nbsp;the&nbsp;left.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5212552">p</span>&nbsp;<span class="op" id="5212554">:=</span>&nbsp;<span class="ident" id="5212557">bytes</span><span class="op" id="5212562">.</span><span class="ident" id="5212563">TrimRight</span><span class="op" id="5212572">(</span><span class="ident" id="5212573">s</span><span class="op" id="5212574">[</span><span class="op" id="5212575">:</span><span class="ident" id="5212576">i</span><span class="op" id="5212577">]</span><span class="op" id="5212578">,</span>&nbsp;<span class="string" id="5212580">&#34;\t\n\f\r&nbsp;&#34;</span><span class="op" id="5212591">)</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5212596">if</span>&nbsp;<span class="ident" id="5212599">endsWithCSSKeyword</span><span class="op" id="5212617">(</span><span class="ident" id="5212618">p</span><span class="op" id="5212619">,</span>&nbsp;<span class="string" id="5212621">&#34;url&#34;</span><span class="op" id="5212626">)</span>&nbsp;<span class="op" id="5212628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5212634">j</span>&nbsp;<span class="op" id="5212636">:=</span>&nbsp;<span class="builtinfunc" id="5212639">len</span><span class="op" id="5212642">(</span><span class="ident" id="5212643">s</span><span class="op" id="5212644">)</span>&nbsp;<span class="op" id="5212646">-</span>&nbsp;<span class="builtinfunc" id="5212648">len</span><span class="op" id="5212651">(</span><span class="ident" id="5212652">bytes</span><span class="op" id="5212657">.</span><span class="ident" id="5212658">TrimLeft</span><span class="op" id="5212666">(</span><span class="ident" id="5212667">s</span><span class="op" id="5212668">[</span><span class="ident" id="5212669">i</span><span class="op" id="5212670">+</span><span class="num" id="5212671">1</span><span class="op" id="5212672">:</span><span class="op" id="5212673">]</span><span class="op" id="5212674">,</span>&nbsp;<span class="string" id="5212676">&#34;\t\n\f\r&nbsp;&#34;</span><span class="op" id="5212687">)</span><span class="op" id="5212688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5212694">switch</span>&nbsp;<span class="op" id="5212701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5212707">case</span>&nbsp;<span class="ident" id="5212712">j</span>&nbsp;<span class="op" id="5212714">!=</span>&nbsp;<span class="builtinfunc" id="5212717">len</span><span class="op" id="5212720">(</span><span class="ident" id="5212721">s</span><span class="op" id="5212722">)</span>&nbsp;<span class="op" id="5212724">&amp;&amp;</span>&nbsp;<span class="ident" id="5212727">s</span><span class="op" id="5212728">[</span><span class="ident" id="5212729">j</span><span class="op" id="5212730">]</span>&nbsp;<span class="op" id="5212732">==</span>&nbsp;<span class="string" id="5212735">&#39;&#34;&#39;</span><span class="op" id="5212738">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5212745">c</span><span class="op" id="5212746">.</span><span class="ident" id="5212747">state</span><span class="op" id="5212752">,</span>&nbsp;<span class="ident" id="5212754">j</span>&nbsp;<span class="op" id="5212756">=</span>&nbsp;<span class="ident" id="5212758">stateCSSDqURL</span><span class="op" id="5212771">,</span>&nbsp;<span class="ident" id="5212773">j</span><span class="op" id="5212774">+</span><span class="num" id="5212775">1</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5212781">case</span>&nbsp;<span class="ident" id="5212786">j</span>&nbsp;<span class="op" id="5212788">!=</span>&nbsp;<span class="builtinfunc" id="5212791">len</span><span class="op" id="5212794">(</span><span class="ident" id="5212795">s</span><span class="op" id="5212796">)</span>&nbsp;<span class="op" id="5212798">&amp;&amp;</span>&nbsp;<span class="ident" id="5212801">s</span><span class="op" id="5212802">[</span><span class="ident" id="5212803">j</span><span class="op" id="5212804">]</span>&nbsp;<span class="op" id="5212806">==</span>&nbsp;<span class="string" id="5212809">&#39;\&#39;&#39;</span><span class="op" id="5212813">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5212820">c</span><span class="op" id="5212821">.</span><span class="ident" id="5212822">state</span><span class="op" id="5212827">,</span>&nbsp;<span class="ident" id="5212829">j</span>&nbsp;<span class="op" id="5212831">=</span>&nbsp;<span class="ident" id="5212833">stateCSSSqURL</span><span class="op" id="5212846">,</span>&nbsp;<span class="ident" id="5212848">j</span><span class="op" id="5212849">+</span><span class="num" id="5212850">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5212856">default</span><span class="op" id="5212863">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5212870">c</span><span class="op" id="5212871">.</span><span class="ident" id="5212872">state</span>&nbsp;<span class="op" id="5212878">=</span>&nbsp;<span class="ident" id="5212880">stateCSSURL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5212896">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5212902">return</span>&nbsp;<span class="ident" id="5212909">c</span><span class="op" id="5212910">,</span>&nbsp;<span class="ident" id="5212912">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5212917">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5212921">case</span>&nbsp;<span class="string" id="5212926">&#39;/&#39;</span><span class="op" id="5212929">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5212934">if</span>&nbsp;<span class="ident" id="5212937">i</span><span class="op" id="5212938">+</span><span class="num" id="5212939">1</span>&nbsp;<span class="op" id="5212941">&lt;</span>&nbsp;<span class="builtinfunc" id="5212943">len</span><span class="op" id="5212946">(</span><span class="ident" id="5212947">s</span><span class="op" id="5212948">)</span>&nbsp;<span class="op" id="5212950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5212956">switch</span>&nbsp;<span class="ident" id="5212963">s</span><span class="op" id="5212964">[</span><span class="ident" id="5212965">i</span><span class="op" id="5212966">+</span><span class="num" id="5212967">1</span><span class="op" id="5212968">]</span>&nbsp;<span class="op" id="5212970">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5212976">case</span>&nbsp;<span class="string" id="5212981">&#39;/&#39;</span><span class="op" id="5212984">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5212991">c</span><span class="op" id="5212992">.</span><span class="ident" id="5212993">state</span>&nbsp;<span class="op" id="5212999">=</span>&nbsp;<span class="ident" id="5213001">stateCSSLineCmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5213022">return</span>&nbsp;<span class="ident" id="5213029">c</span><span class="op" id="5213030">,</span>&nbsp;<span class="ident" id="5213032">i</span>&nbsp;<span class="op" id="5213034">+</span>&nbsp;<span class="num" id="5213036">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5213042">case</span>&nbsp;<span class="string" id="5213047">&#39;*&#39;</span><span class="op" id="5213050">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5213057">c</span><span class="op" id="5213058">.</span><span class="ident" id="5213059">state</span>&nbsp;<span class="op" id="5213065">=</span>&nbsp;<span class="ident" id="5213067">stateCSSBlockCmt</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5213089">return</span>&nbsp;<span class="ident" id="5213096">c</span><span class="op" id="5213097">,</span>&nbsp;<span class="ident" id="5213099">i</span>&nbsp;<span class="op" id="5213101">+</span>&nbsp;<span class="num" id="5213103">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5213109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5213114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5213118">case</span>&nbsp;<span class="string" id="5213123">&#39;&#34;&#39;</span><span class="op" id="5213126">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5213131">c</span><span class="op" id="5213132">.</span><span class="ident" id="5213133">state</span>&nbsp;<span class="op" id="5213139">=</span>&nbsp;<span class="ident" id="5213141">stateCSSDqStr</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5213158">return</span>&nbsp;<span class="ident" id="5213165">c</span><span class="op" id="5213166">,</span>&nbsp;<span class="ident" id="5213168">i</span>&nbsp;<span class="op" id="5213170">+</span>&nbsp;<span class="num" id="5213172">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5213176">case</span>&nbsp;<span class="string" id="5213181">&#39;\&#39;&#39;</span><span class="op" id="5213185">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5213190">c</span><span class="op" id="5213191">.</span><span class="ident" id="5213192">state</span>&nbsp;<span class="op" id="5213198">=</span>&nbsp;<span class="ident" id="5213200">stateCSSSqStr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5213217">return</span>&nbsp;<span class="ident" id="5213224">c</span><span class="op" id="5213225">,</span>&nbsp;<span class="ident" id="5213227">i</span>&nbsp;<span class="op" id="5213229">+</span>&nbsp;<span class="num" id="5213231">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5213235">}</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5213239">k</span>&nbsp;<span class="op" id="5213241">=</span>&nbsp;<span class="ident" id="5213243">i</span>&nbsp;<span class="op" id="5213245">+</span>&nbsp;<span class="num" id="5213247">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5213250">}</span><br>
<span class="lineno"></span><span class="op" id="5213252">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5213255">//&nbsp;tCSSStr&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;CSS&nbsp;string&nbsp;and&nbsp;URL&nbsp;states.</span><br>
<span class="lineno">435</span><span class="keyword" id="5213336">func</span>&nbsp;<span class="ident" id="5213341">tCSSStr</span><span class="op" id="5213348">(</span><span class="ident" id="5213349">c</span>&nbsp;<span class="ident" id="5213351">context</span><span class="op" id="5213358">,</span>&nbsp;<span class="ident" id="5213360">s</span>&nbsp;<span class="op" id="5213362">[</span><span class="op" id="5213363">]</span><span class="builtintype" id="5213364">byte</span><span class="op" id="5213368">)</span>&nbsp;<span class="op" id="5213370">(</span><span class="ident" id="5213371">context</span><span class="op" id="5213378">,</span>&nbsp;<span class="builtintype" id="5213380">int</span><span class="op" id="5213383">)</span>&nbsp;<span class="op" id="5213385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5213388">var</span>&nbsp;<span class="ident" id="5213392">endAndEsc</span>&nbsp;<span class="builtintype" id="5213402">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5213410">switch</span>&nbsp;<span class="ident" id="5213417">c</span><span class="op" id="5213418">.</span><span class="ident" id="5213419">state</span>&nbsp;<span class="op" id="5213425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5213428">case</span>&nbsp;<span class="ident" id="5213433">stateCSSDqStr</span><span class="op" id="5213446">,</span>&nbsp;<span class="ident" id="5213448">stateCSSDqURL</span><span class="op" id="5213461">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5213465">endAndEsc</span>&nbsp;<span class="op" id="5213475">=</span>&nbsp;<span class="string" id="5213477">`\&#34;`</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5213483">case</span>&nbsp;<span class="ident" id="5213488">stateCSSSqStr</span><span class="op" id="5213501">,</span>&nbsp;<span class="ident" id="5213503">stateCSSSqURL</span><span class="op" id="5213516">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5213520">endAndEsc</span>&nbsp;<span class="op" id="5213530">=</span>&nbsp;<span class="string" id="5213532">`\&#39;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5213538">case</span>&nbsp;<span class="ident" id="5213543">stateCSSURL</span><span class="op" id="5213554">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5213558">//&nbsp;Unquoted&nbsp;URLs&nbsp;end&nbsp;with&nbsp;a&nbsp;newline&nbsp;or&nbsp;close&nbsp;parenthesis.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5213618">//&nbsp;The&nbsp;below&nbsp;includes&nbsp;the&nbsp;wc&nbsp;(whitespace&nbsp;character)&nbsp;and&nbsp;nl.</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5213680">endAndEsc</span>&nbsp;<span class="op" id="5213690">=</span>&nbsp;<span class="string" id="5213692">&#34;\\\t\n\f\r&nbsp;)&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5213708">default</span><span class="op" id="5213715">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5213719">panic</span><span class="op" id="5213724">(</span><span class="ident" id="5213725">c</span><span class="op" id="5213726">.</span><span class="ident" id="5213727">state</span><span class="op" id="5213732">.</span><span class="ident" id="5213733">String</span><span class="op" id="5213739">(</span><span class="op" id="5213740">)</span><span class="op" id="5213741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5213744">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5213748">k</span>&nbsp;<span class="op" id="5213750">:=</span>&nbsp;<span class="num" id="5213753">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5213756">for</span>&nbsp;<span class="op" id="5213760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5213764">i</span>&nbsp;<span class="op" id="5213766">:=</span>&nbsp;<span class="ident" id="5213769">k</span>&nbsp;<span class="op" id="5213771">+</span>&nbsp;<span class="ident" id="5213773">bytes</span><span class="op" id="5213778">.</span><span class="ident" id="5213779">IndexAny</span><span class="op" id="5213787">(</span><span class="ident" id="5213788">s</span><span class="op" id="5213789">[</span><span class="ident" id="5213790">k</span><span class="op" id="5213791">:</span><span class="op" id="5213792">]</span><span class="op" id="5213793">,</span>&nbsp;<span class="ident" id="5213795">endAndEsc</span><span class="op" id="5213804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5213808">if</span>&nbsp;<span class="ident" id="5213811">i</span>&nbsp;<span class="op" id="5213813">&lt;</span>&nbsp;<span class="ident" id="5213815">k</span>&nbsp;<span class="op" id="5213817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5213822">c</span><span class="op" id="5213823">,</span>&nbsp;<span class="ident" id="5213825">nread</span>&nbsp;<span class="op" id="5213831">:=</span>&nbsp;<span class="ident" id="5213834">tURL</span><span class="op" id="5213838">(</span><span class="ident" id="5213839">c</span><span class="op" id="5213840">,</span>&nbsp;<span class="ident" id="5213842">decodeCSS</span><span class="op" id="5213851">(</span><span class="ident" id="5213852">s</span><span class="op" id="5213853">[</span><span class="ident" id="5213854">k</span><span class="op" id="5213855">:</span><span class="op" id="5213856">]</span><span class="op" id="5213857">)</span><span class="op" id="5213858">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5213863">return</span>&nbsp;<span class="ident" id="5213870">c</span><span class="op" id="5213871">,</span>&nbsp;<span class="ident" id="5213873">k</span>&nbsp;<span class="op" id="5213875">+</span>&nbsp;<span class="ident" id="5213877">nread</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5213885">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5213889">if</span>&nbsp;<span class="ident" id="5213892">s</span><span class="op" id="5213893">[</span><span class="ident" id="5213894">i</span><span class="op" id="5213895">]</span>&nbsp;<span class="op" id="5213897">==</span>&nbsp;<span class="string" id="5213900">&#39;\\&#39;</span>&nbsp;<span class="op" id="5213905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5213910">i</span><span class="op" id="5213911">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5213917">if</span>&nbsp;<span class="ident" id="5213920">i</span>&nbsp;<span class="op" id="5213922">==</span>&nbsp;<span class="builtinfunc" id="5213925">len</span><span class="op" id="5213928">(</span><span class="ident" id="5213929">s</span><span class="op" id="5213930">)</span>&nbsp;<span class="op" id="5213932">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5213938">return</span>&nbsp;<span class="ident" id="5213945">context</span><span class="op" id="5213952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5213959">state</span><span class="op" id="5213964">:</span>&nbsp;<span class="ident" id="5213966">stateError</span><span class="op" id="5213976">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5213983">err</span><span class="op" id="5213986">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5213990">errorf</span><span class="op" id="5213996">(</span><span class="ident" id="5213997">ErrPartialEscape</span><span class="op" id="5214013">,</span>&nbsp;<span class="builtintype" id="5214015">nil</span><span class="op" id="5214018">,</span>&nbsp;<span class="num" id="5214020">0</span><span class="op" id="5214021">,</span>&nbsp;<span class="string" id="5214023">&#34;unfinished&nbsp;escape&nbsp;sequence&nbsp;in&nbsp;CSS&nbsp;string:&nbsp;%q&#34;</span><span class="op" id="5214069">,</span>&nbsp;<span class="ident" id="5214071">s</span><span class="op" id="5214072">)</span><span class="op" id="5214073">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5214079">}</span><span class="op" id="5214080">,</span>&nbsp;<span class="builtinfunc" id="5214082">len</span><span class="op" id="5214085">(</span><span class="ident" id="5214086">s</span><span class="op" id="5214087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5214092">}</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5214096">}</span>&nbsp;<span class="keyword" id="5214098">else</span>&nbsp;<span class="op" id="5214103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5214108">c</span><span class="op" id="5214109">.</span><span class="ident" id="5214110">state</span>&nbsp;<span class="op" id="5214116">=</span>&nbsp;<span class="ident" id="5214118">stateCSS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5214130">return</span>&nbsp;<span class="ident" id="5214137">c</span><span class="op" id="5214138">,</span>&nbsp;<span class="ident" id="5214140">i</span>&nbsp;<span class="op" id="5214142">+</span>&nbsp;<span class="num" id="5214144">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5214148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5214152">c</span><span class="op" id="5214153">,</span>&nbsp;<span class="ident" id="5214155">_</span>&nbsp;<span class="op" id="5214157">=</span>&nbsp;<span class="ident" id="5214159">tURL</span><span class="op" id="5214163">(</span><span class="ident" id="5214164">c</span><span class="op" id="5214165">,</span>&nbsp;<span class="ident" id="5214167">decodeCSS</span><span class="op" id="5214176">(</span><span class="ident" id="5214177">s</span><span class="op" id="5214178">[</span><span class="op" id="5214179">:</span><span class="ident" id="5214180">i</span><span class="op" id="5214181">+</span><span class="num" id="5214182">1</span><span class="op" id="5214183">]</span><span class="op" id="5214184">)</span><span class="op" id="5214185">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5214189">k</span>&nbsp;<span class="op" id="5214191">=</span>&nbsp;<span class="ident" id="5214193">i</span>&nbsp;<span class="op" id="5214195">+</span>&nbsp;<span class="num" id="5214197">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5214200">}</span><br>
<span class="lineno"></span><span class="op" id="5214202">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5214205">//&nbsp;tError&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;error&nbsp;state.</span><br>
<span class="lineno">475</span><span class="keyword" id="5214271">func</span>&nbsp;<span class="ident" id="5214276">tError</span><span class="op" id="5214282">(</span><span class="ident" id="5214283">c</span>&nbsp;<span class="ident" id="5214285">context</span><span class="op" id="5214292">,</span>&nbsp;<span class="ident" id="5214294">s</span>&nbsp;<span class="op" id="5214296">[</span><span class="op" id="5214297">]</span><span class="builtintype" id="5214298">byte</span><span class="op" id="5214302">)</span>&nbsp;<span class="op" id="5214304">(</span><span class="ident" id="5214305">context</span><span class="op" id="5214312">,</span>&nbsp;<span class="builtintype" id="5214314">int</span><span class="op" id="5214317">)</span>&nbsp;<span class="op" id="5214319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5214322">return</span>&nbsp;<span class="ident" id="5214329">c</span><span class="op" id="5214330">,</span>&nbsp;<span class="builtinfunc" id="5214332">len</span><span class="op" id="5214335">(</span><span class="ident" id="5214336">s</span><span class="op" id="5214337">)</span><br>
<span class="lineno"></span><span class="op" id="5214339">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5214342">//&nbsp;eatAttrName&nbsp;returns&nbsp;the&nbsp;largest&nbsp;j&nbsp;such&nbsp;that&nbsp;s[i:j]&nbsp;is&nbsp;an&nbsp;attribute&nbsp;name.</span><br>
<span class="lineno">480</span><span class="comment" id="5214418">//&nbsp;It&nbsp;returns&nbsp;an&nbsp;error&nbsp;if&nbsp;s[i:]&nbsp;does&nbsp;not&nbsp;look&nbsp;like&nbsp;it&nbsp;begins&nbsp;with&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="5214487">//&nbsp;attribute&nbsp;name,&nbsp;such&nbsp;as&nbsp;encountering&nbsp;a&nbsp;quote&nbsp;mark&nbsp;without&nbsp;a&nbsp;preceding</span><br>
<span class="lineno"></span><span class="comment" id="5214560">//&nbsp;equals&nbsp;sign.</span><br>
<span class="lineno"></span><span class="keyword" id="5214576">func</span>&nbsp;<span class="ident" id="5214581">eatAttrName</span><span class="op" id="5214592">(</span><span class="ident" id="5214593">s</span>&nbsp;<span class="op" id="5214595">[</span><span class="op" id="5214596">]</span><span class="builtintype" id="5214597">byte</span><span class="op" id="5214601">,</span>&nbsp;<span class="ident" id="5214603">i</span>&nbsp;<span class="builtintype" id="5214605">int</span><span class="op" id="5214608">)</span>&nbsp;<span class="op" id="5214610">(</span><span class="builtintype" id="5214611">int</span><span class="op" id="5214614">,</span>&nbsp;<span class="op" id="5214616">*</span><span class="ident" id="5214617">Error</span><span class="op" id="5214622">)</span>&nbsp;<span class="op" id="5214624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5214627">for</span>&nbsp;<span class="ident" id="5214631">j</span>&nbsp;<span class="op" id="5214633">:=</span>&nbsp;<span class="ident" id="5214636">i</span><span class="op" id="5214637">;</span>&nbsp;<span class="ident" id="5214639">j</span>&nbsp;<span class="op" id="5214641">&lt;</span>&nbsp;<span class="builtinfunc" id="5214643">len</span><span class="op" id="5214646">(</span><span class="ident" id="5214647">s</span><span class="op" id="5214648">)</span><span class="op" id="5214649">;</span>&nbsp;<span class="ident" id="5214651">j</span><span class="op" id="5214652">++</span>&nbsp;<span class="op" id="5214655">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5214659">switch</span>&nbsp;<span class="ident" id="5214666">s</span><span class="op" id="5214667">[</span><span class="ident" id="5214668">j</span><span class="op" id="5214669">]</span>&nbsp;<span class="op" id="5214671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5214675">case</span>&nbsp;<span class="string" id="5214680">&#39;&nbsp;&#39;</span><span class="op" id="5214683">,</span>&nbsp;<span class="string" id="5214685">&#39;\t&#39;</span><span class="op" id="5214689">,</span>&nbsp;<span class="string" id="5214691">&#39;\n&#39;</span><span class="op" id="5214695">,</span>&nbsp;<span class="string" id="5214697">&#39;\f&#39;</span><span class="op" id="5214701">,</span>&nbsp;<span class="string" id="5214703">&#39;\r&#39;</span><span class="op" id="5214707">,</span>&nbsp;<span class="string" id="5214709">&#39;=&#39;</span><span class="op" id="5214712">,</span>&nbsp;<span class="string" id="5214714">&#39;&gt;&#39;</span><span class="op" id="5214717">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5214722">return</span>&nbsp;<span class="ident" id="5214729">j</span><span class="op" id="5214730">,</span>&nbsp;<span class="builtintype" id="5214732">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5214738">case</span>&nbsp;<span class="string" id="5214743">&#39;\&#39;&#39;</span><span class="op" id="5214747">,</span>&nbsp;<span class="string" id="5214749">&#39;&#34;&#39;</span><span class="op" id="5214752">,</span>&nbsp;<span class="string" id="5214754">&#39;&lt;&#39;</span><span class="op" id="5214757">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5214762">//&nbsp;These&nbsp;result&nbsp;in&nbsp;a&nbsp;parse&nbsp;warning&nbsp;in&nbsp;HTML5&nbsp;and&nbsp;are</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5214817">//&nbsp;indicative&nbsp;of&nbsp;serious&nbsp;problems&nbsp;if&nbsp;seen&nbsp;in&nbsp;an&nbsp;attr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5214873">//&nbsp;name&nbsp;in&nbsp;a&nbsp;template.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5214899">return</span>&nbsp;<span class="op" id="5214906">-</span><span class="num" id="5214907">1</span><span class="op" id="5214908">,</span>&nbsp;<span class="ident" id="5214910">errorf</span><span class="op" id="5214916">(</span><span class="ident" id="5214917">ErrBadHTML</span><span class="op" id="5214927">,</span>&nbsp;<span class="builtintype" id="5214929">nil</span><span class="op" id="5214932">,</span>&nbsp;<span class="num" id="5214934">0</span><span class="op" id="5214935">,</span>&nbsp;<span class="string" id="5214937">&#34;%q&nbsp;in&nbsp;attribute&nbsp;name:&nbsp;%.32q&#34;</span><span class="op" id="5214966">,</span>&nbsp;<span class="ident" id="5214968">s</span><span class="op" id="5214969">[</span><span class="ident" id="5214970">j</span><span class="op" id="5214971">:</span><span class="ident" id="5214972">j</span><span class="op" id="5214973">+</span><span class="num" id="5214974">1</span><span class="op" id="5214975">]</span><span class="op" id="5214976">,</span>&nbsp;<span class="ident" id="5214978">s</span><span class="op" id="5214979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5214983">default</span><span class="op" id="5214990">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5214995">//&nbsp;No-op.</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5215007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5215010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5215013">return</span>&nbsp;<span class="builtinfunc" id="5215020">len</span><span class="op" id="5215023">(</span><span class="ident" id="5215024">s</span><span class="op" id="5215025">)</span><span class="op" id="5215026">,</span>&nbsp;<span class="builtintype" id="5215028">nil</span><br>
<span class="lineno"></span><span class="op" id="5215032">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">500</span><span class="keyword" id="5215035">var</span>&nbsp;<span class="ident" id="5215039">elementNameMap</span>&nbsp;<span class="op" id="5215054">=</span>&nbsp;<span class="keyword" id="5215056">map</span><span class="op" id="5215059">[</span><span class="builtintype" id="5215060">string</span><span class="op" id="5215066">]</span><span class="ident" id="5215067">element</span><span class="op" id="5215074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5215077">&#34;script&#34;</span><span class="op" id="5215085">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5215089">elementScript</span><span class="op" id="5215102">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5215105">&#34;style&#34;</span><span class="op" id="5215112">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5215117">elementStyle</span><span class="op" id="5215129">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5215132">&#34;textarea&#34;</span><span class="op" id="5215142">:</span>&nbsp;<span class="ident" id="5215144">elementTextarea</span><span class="op" id="5215159">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5215162">&#34;title&#34;</span><span class="op" id="5215169">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5215174">elementTitle</span><span class="op" id="5215186">,</span><br>
<span class="lineno">505</span><span class="op" id="5215188">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5215191">//&nbsp;asciiAlpha&nbsp;reports&nbsp;whether&nbsp;c&nbsp;is&nbsp;an&nbsp;ASCII&nbsp;letter.</span><br>
<span class="lineno"></span><span class="keyword" id="5215243">func</span>&nbsp;<span class="ident" id="5215248">asciiAlpha</span><span class="op" id="5215258">(</span><span class="ident" id="5215259">c</span>&nbsp;<span class="builtintype" id="5215261">byte</span><span class="op" id="5215265">)</span>&nbsp;<span class="builtintype" id="5215267">bool</span>&nbsp;<span class="op" id="5215272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5215275">return</span>&nbsp;<span class="string" id="5215282">&#39;A&#39;</span>&nbsp;<span class="op" id="5215286">&lt;=</span>&nbsp;<span class="ident" id="5215289">c</span>&nbsp;<span class="op" id="5215291">&amp;&amp;</span>&nbsp;<span class="ident" id="5215294">c</span>&nbsp;<span class="op" id="5215296">&lt;=</span>&nbsp;<span class="string" id="5215299">&#39;Z&#39;</span>&nbsp;<span class="op" id="5215303">||</span>&nbsp;<span class="string" id="5215306">&#39;a&#39;</span>&nbsp;<span class="op" id="5215310">&lt;=</span>&nbsp;<span class="ident" id="5215313">c</span>&nbsp;<span class="op" id="5215315">&amp;&amp;</span>&nbsp;<span class="ident" id="5215318">c</span>&nbsp;<span class="op" id="5215320">&lt;=</span>&nbsp;<span class="string" id="5215323">&#39;z&#39;</span><br>
<span class="lineno">510</span><span class="op" id="5215327">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5215330">//&nbsp;asciiAlphaNum&nbsp;reports&nbsp;whether&nbsp;c&nbsp;is&nbsp;an&nbsp;ASCII&nbsp;letter&nbsp;or&nbsp;digit.</span><br>
<span class="lineno"></span><span class="keyword" id="5215394">func</span>&nbsp;<span class="ident" id="5215399">asciiAlphaNum</span><span class="op" id="5215412">(</span><span class="ident" id="5215413">c</span>&nbsp;<span class="builtintype" id="5215415">byte</span><span class="op" id="5215419">)</span>&nbsp;<span class="builtintype" id="5215421">bool</span>&nbsp;<span class="op" id="5215426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5215429">return</span>&nbsp;<span class="ident" id="5215436">asciiAlpha</span><span class="op" id="5215446">(</span><span class="ident" id="5215447">c</span><span class="op" id="5215448">)</span>&nbsp;<span class="op" id="5215450">||</span>&nbsp;<span class="string" id="5215453">&#39;0&#39;</span>&nbsp;<span class="op" id="5215457">&lt;=</span>&nbsp;<span class="ident" id="5215460">c</span>&nbsp;<span class="op" id="5215462">&amp;&amp;</span>&nbsp;<span class="ident" id="5215465">c</span>&nbsp;<span class="op" id="5215467">&lt;=</span>&nbsp;<span class="string" id="5215470">&#39;9&#39;</span><br>
<span class="lineno">515</span><span class="op" id="5215474">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5215477">//&nbsp;eatTagName&nbsp;returns&nbsp;the&nbsp;largest&nbsp;j&nbsp;such&nbsp;that&nbsp;s[i:j]&nbsp;is&nbsp;a&nbsp;tag&nbsp;name&nbsp;and&nbsp;the&nbsp;tag&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="5215562">func</span>&nbsp;<span class="ident" id="5215567">eatTagName</span><span class="op" id="5215577">(</span><span class="ident" id="5215578">s</span>&nbsp;<span class="op" id="5215580">[</span><span class="op" id="5215581">]</span><span class="builtintype" id="5215582">byte</span><span class="op" id="5215586">,</span>&nbsp;<span class="ident" id="5215588">i</span>&nbsp;<span class="builtintype" id="5215590">int</span><span class="op" id="5215593">)</span>&nbsp;<span class="op" id="5215595">(</span><span class="builtintype" id="5215596">int</span><span class="op" id="5215599">,</span>&nbsp;<span class="ident" id="5215601">element</span><span class="op" id="5215608">)</span>&nbsp;<span class="op" id="5215610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5215613">if</span>&nbsp;<span class="ident" id="5215616">i</span>&nbsp;<span class="op" id="5215618">==</span>&nbsp;<span class="builtinfunc" id="5215621">len</span><span class="op" id="5215624">(</span><span class="ident" id="5215625">s</span><span class="op" id="5215626">)</span>&nbsp;<span class="op" id="5215628">||</span>&nbsp;<span class="op" id="5215631">!</span><span class="ident" id="5215632">asciiAlpha</span><span class="op" id="5215642">(</span><span class="ident" id="5215643">s</span><span class="op" id="5215644">[</span><span class="ident" id="5215645">i</span><span class="op" id="5215646">]</span><span class="op" id="5215647">)</span>&nbsp;<span class="op" id="5215649">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5215653">return</span>&nbsp;<span class="ident" id="5215660">i</span><span class="op" id="5215661">,</span>&nbsp;<span class="ident" id="5215663">elementNone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5215676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5215679">j</span>&nbsp;<span class="op" id="5215681">:=</span>&nbsp;<span class="ident" id="5215684">i</span>&nbsp;<span class="op" id="5215686">+</span>&nbsp;<span class="num" id="5215688">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5215691">for</span>&nbsp;<span class="ident" id="5215695">j</span>&nbsp;<span class="op" id="5215697">&lt;</span>&nbsp;<span class="builtinfunc" id="5215699">len</span><span class="op" id="5215702">(</span><span class="ident" id="5215703">s</span><span class="op" id="5215704">)</span>&nbsp;<span class="op" id="5215706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5215710">x</span>&nbsp;<span class="op" id="5215712">:=</span>&nbsp;<span class="ident" id="5215715">s</span><span class="op" id="5215716">[</span><span class="ident" id="5215717">j</span><span class="op" id="5215718">]</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5215722">if</span>&nbsp;<span class="ident" id="5215725">asciiAlphaNum</span><span class="op" id="5215738">(</span><span class="ident" id="5215739">x</span><span class="op" id="5215740">)</span>&nbsp;<span class="op" id="5215742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5215747">j</span><span class="op" id="5215748">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5215754">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5215765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5215769">//&nbsp;Allow&nbsp;&#34;x-y&#34;&nbsp;or&nbsp;&#34;x:y&#34;&nbsp;but&nbsp;not&nbsp;&#34;x-&#34;,&nbsp;&#34;-y&#34;,&nbsp;or&nbsp;&#34;x--y&#34;.</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5215826">if</span>&nbsp;<span class="op" id="5215829">(</span><span class="ident" id="5215830">x</span>&nbsp;<span class="op" id="5215832">==</span>&nbsp;<span class="string" id="5215835">&#39;:&#39;</span>&nbsp;<span class="op" id="5215839">||</span>&nbsp;<span class="ident" id="5215842">x</span>&nbsp;<span class="op" id="5215844">==</span>&nbsp;<span class="string" id="5215847">&#39;-&#39;</span><span class="op" id="5215850">)</span>&nbsp;<span class="op" id="5215852">&amp;&amp;</span>&nbsp;<span class="ident" id="5215855">j</span><span class="op" id="5215856">+</span><span class="num" id="5215857">1</span>&nbsp;<span class="op" id="5215859">&lt;</span>&nbsp;<span class="builtinfunc" id="5215861">len</span><span class="op" id="5215864">(</span><span class="ident" id="5215865">s</span><span class="op" id="5215866">)</span>&nbsp;<span class="op" id="5215868">&amp;&amp;</span>&nbsp;<span class="ident" id="5215871">asciiAlphaNum</span><span class="op" id="5215884">(</span><span class="ident" id="5215885">s</span><span class="op" id="5215886">[</span><span class="ident" id="5215887">j</span><span class="op" id="5215888">+</span><span class="num" id="5215889">1</span><span class="op" id="5215890">]</span><span class="op" id="5215891">)</span>&nbsp;<span class="op" id="5215893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5215898">j</span>&nbsp;<span class="op" id="5215900">+=</span>&nbsp;<span class="num" id="5215903">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5215908">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5215919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5215923">break</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5215930">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5215933">return</span>&nbsp;<span class="ident" id="5215940">j</span><span class="op" id="5215941">,</span>&nbsp;<span class="ident" id="5215943">elementNameMap</span><span class="op" id="5215957">[</span><span class="ident" id="5215958">strings</span><span class="op" id="5215965">.</span><span class="ident" id="5215966">ToLower</span><span class="op" id="5215973">(</span><span class="builtintype" id="5215974">string</span><span class="op" id="5215980">(</span><span class="ident" id="5215981">s</span><span class="op" id="5215982">[</span><span class="ident" id="5215983">i</span><span class="op" id="5215984">:</span><span class="ident" id="5215985">j</span><span class="op" id="5215986">]</span><span class="op" id="5215987">)</span><span class="op" id="5215988">)</span><span class="op" id="5215989">]</span><br>
<span class="lineno"></span><span class="op" id="5215991">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5215994">//&nbsp;eatWhiteSpace&nbsp;returns&nbsp;the&nbsp;largest&nbsp;j&nbsp;such&nbsp;that&nbsp;s[i:j]&nbsp;is&nbsp;white&nbsp;space.</span><br>
<span class="lineno">540</span><span class="keyword" id="5216066">func</span>&nbsp;<span class="ident" id="5216071">eatWhiteSpace</span><span class="op" id="5216084">(</span><span class="ident" id="5216085">s</span>&nbsp;<span class="op" id="5216087">[</span><span class="op" id="5216088">]</span><span class="builtintype" id="5216089">byte</span><span class="op" id="5216093">,</span>&nbsp;<span class="ident" id="5216095">i</span>&nbsp;<span class="builtintype" id="5216097">int</span><span class="op" id="5216100">)</span>&nbsp;<span class="builtintype" id="5216102">int</span>&nbsp;<span class="op" id="5216106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5216109">for</span>&nbsp;<span class="ident" id="5216113">j</span>&nbsp;<span class="op" id="5216115">:=</span>&nbsp;<span class="ident" id="5216118">i</span><span class="op" id="5216119">;</span>&nbsp;<span class="ident" id="5216121">j</span>&nbsp;<span class="op" id="5216123">&lt;</span>&nbsp;<span class="builtinfunc" id="5216125">len</span><span class="op" id="5216128">(</span><span class="ident" id="5216129">s</span><span class="op" id="5216130">)</span><span class="op" id="5216131">;</span>&nbsp;<span class="ident" id="5216133">j</span><span class="op" id="5216134">++</span>&nbsp;<span class="op" id="5216137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5216141">switch</span>&nbsp;<span class="ident" id="5216148">s</span><span class="op" id="5216149">[</span><span class="ident" id="5216150">j</span><span class="op" id="5216151">]</span>&nbsp;<span class="op" id="5216153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5216157">case</span>&nbsp;<span class="string" id="5216162">&#39;&nbsp;&#39;</span><span class="op" id="5216165">,</span>&nbsp;<span class="string" id="5216167">&#39;\t&#39;</span><span class="op" id="5216171">,</span>&nbsp;<span class="string" id="5216173">&#39;\n&#39;</span><span class="op" id="5216177">,</span>&nbsp;<span class="string" id="5216179">&#39;\f&#39;</span><span class="op" id="5216183">,</span>&nbsp;<span class="string" id="5216185">&#39;\r&#39;</span><span class="op" id="5216189">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5216194">//&nbsp;No-op.</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5216206">default</span><span class="op" id="5216213">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5216218">return</span>&nbsp;<span class="ident" id="5216225">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5216229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5216232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5216235">return</span>&nbsp;<span class="builtinfunc" id="5216242">len</span><span class="op" id="5216245">(</span><span class="ident" id="5216246">s</span><span class="op" id="5216247">)</span><br>
<span class="lineno">550</span><span class="op" id="5216249">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
