<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/lzw</h2>
<ul>
<li><a href="/gostd/compress/lzw/reader.go.html" class="current">reader.go</a></li>
<li><a href="/gostd/compress/lzw/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/lzw/writer.go.html">writer.go</a></li>
<li><a href="/gostd/compress/lzw/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6049719">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6049774">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6049828">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6049879">//&nbsp;Package&nbsp;lzw&nbsp;implements&nbsp;the&nbsp;Lempel-Ziv-Welch&nbsp;compressed&nbsp;data&nbsp;format,</span><br>
<span class="lineno"></span><span class="comment" id="6049950">//&nbsp;described&nbsp;in&nbsp;T.&nbsp;A.&nbsp;Welch,&nbsp;``A&nbsp;Technique&nbsp;for&nbsp;High-Performance&nbsp;Data</span><br>
<span class="lineno"></span><span class="comment" id="6050019">//&nbsp;Compression&#39;&#39;,&nbsp;Computer,&nbsp;17(6)&nbsp;(June&nbsp;1984),&nbsp;pp&nbsp;8-19.</span><br>
<span class="lineno"></span><span class="comment" id="6050075">//</span><br>
<span class="lineno"></span><span class="comment" id="6050078">//&nbsp;In&nbsp;particular,&nbsp;it&nbsp;implements&nbsp;LZW&nbsp;as&nbsp;used&nbsp;by&nbsp;the&nbsp;GIF&nbsp;and&nbsp;PDF&nbsp;file</span><br>
<span class="lineno">10</span><span class="comment" id="6050146">//&nbsp;formats,&nbsp;which&nbsp;means&nbsp;variable-width&nbsp;codes&nbsp;up&nbsp;to&nbsp;12&nbsp;bits&nbsp;and&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span><span class="comment" id="6050219">//&nbsp;two&nbsp;non-literal&nbsp;codes&nbsp;are&nbsp;a&nbsp;clear&nbsp;code&nbsp;and&nbsp;an&nbsp;EOF&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="6050278">//</span><br>
<span class="lineno"></span><span class="comment" id="6050281">//&nbsp;The&nbsp;TIFF&nbsp;file&nbsp;format&nbsp;uses&nbsp;a&nbsp;similar&nbsp;but&nbsp;incompatible&nbsp;version&nbsp;of&nbsp;the&nbsp;LZW</span><br>
<span class="lineno"></span><span class="comment" id="6050356">//&nbsp;algorithm.&nbsp;See&nbsp;the&nbsp;golang.org/x/image/tiff/lzw&nbsp;package&nbsp;for&nbsp;an</span><br>
<span class="lineno">15</span><span class="comment" id="6050421">//&nbsp;implementation.</span><br>
<span class="lineno"></span><span class="keyword" id="6050440">package</span>&nbsp;<span class="ident" id="6050448">lzw</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6050453">//&nbsp;TODO(nigeltao):&nbsp;check&nbsp;that&nbsp;PDF&nbsp;uses&nbsp;LZW&nbsp;in&nbsp;the&nbsp;same&nbsp;way&nbsp;as&nbsp;GIF,</span><br>
<span class="lineno"></span><span class="comment" id="6050520">//&nbsp;modulo&nbsp;LSB/MSB&nbsp;packing&nbsp;order.</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="6050554">import</span>&nbsp;<span class="op" id="6050561">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6050564">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6050573">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6050583">&#34;fmt&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6050590">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="6050595">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6050598">//&nbsp;Order&nbsp;specifies&nbsp;the&nbsp;bit&nbsp;ordering&nbsp;in&nbsp;an&nbsp;LZW&nbsp;data&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="6050657">type</span>&nbsp;<span class="ident" id="6050662">Order</span>&nbsp;<span class="builtintype" id="6050668">int</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="keyword" id="6050673">const</span>&nbsp;<span class="op" id="6050679">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6050682">//&nbsp;LSB&nbsp;means&nbsp;Least&nbsp;Significant&nbsp;Bits&nbsp;first,&nbsp;as&nbsp;used&nbsp;in&nbsp;the&nbsp;GIF&nbsp;file&nbsp;format.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6050758">LSB</span>&nbsp;<span class="ident" id="6050762">Order</span>&nbsp;<span class="op" id="6050768">=</span>&nbsp;<span class="ident" id="6050770">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6050776">//&nbsp;MSB&nbsp;means&nbsp;Most&nbsp;Significant&nbsp;Bits&nbsp;first,&nbsp;as&nbsp;used&nbsp;in&nbsp;the&nbsp;TIFF&nbsp;and&nbsp;PDF</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6050847">//&nbsp;file&nbsp;formats.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6050865">MSB</span><br>
<span class="lineno"></span><span class="op" id="6050869">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6050872">const</span>&nbsp;<span class="op" id="6050878">(</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6050881">maxWidth</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6050900">=</span>&nbsp;<span class="num" id="6050902">12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6050906">decoderInvalidCode</span>&nbsp;<span class="op" id="6050925">=</span>&nbsp;<span class="num" id="6050927">0xffff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6050935">flushBuffer</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6050954">=</span>&nbsp;<span class="num" id="6050956">1</span>&nbsp;<span class="op" id="6050958">&lt;&lt;</span>&nbsp;<span class="ident" id="6050961">maxWidth</span><br>
<span class="lineno"></span><span class="op" id="6050970">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="6050973">//&nbsp;decoder&nbsp;is&nbsp;the&nbsp;state&nbsp;from&nbsp;which&nbsp;the&nbsp;readXxx&nbsp;method&nbsp;converts&nbsp;a&nbsp;byte</span><br>
<span class="lineno"></span><span class="comment" id="6051043">//&nbsp;stream&nbsp;into&nbsp;a&nbsp;code&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="6051073">type</span>&nbsp;<span class="ident" id="6051078">decoder</span>&nbsp;<span class="keyword" id="6051086">struct</span>&nbsp;<span class="op" id="6051093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6051096">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6051105">io</span><span class="op" id="6051107">.</span><span class="ident" id="6051108">ByteReader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6051120">bits</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6051129">uint32</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6051137">nBits</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6051146">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6051152">width</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6051161">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6051167">read</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6051176">func</span><span class="op" id="6051180">(</span><span class="op" id="6051181">*</span><span class="ident" id="6051182">decoder</span><span class="op" id="6051189">)</span>&nbsp;<span class="op" id="6051191">(</span><span class="builtintype" id="6051192">uint16</span><span class="op" id="6051198">,</span>&nbsp;<span class="builtintype" id="6051200">error</span><span class="op" id="6051205">)</span>&nbsp;<span class="comment" id="6051207">//&nbsp;readLSB&nbsp;or&nbsp;readMSB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6051230">litWidth</span>&nbsp;<span class="builtintype" id="6051239">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6051270">//&nbsp;width&nbsp;in&nbsp;bits&nbsp;of&nbsp;literal&nbsp;codes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6051305">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6051314">error</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6051322">//&nbsp;The&nbsp;first&nbsp;1&lt;&lt;litWidth&nbsp;codes&nbsp;are&nbsp;literal&nbsp;codes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6051373">//&nbsp;The&nbsp;next&nbsp;two&nbsp;codes&nbsp;mean&nbsp;clear&nbsp;and&nbsp;EOF.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6051416">//&nbsp;Other&nbsp;valid&nbsp;codes&nbsp;are&nbsp;in&nbsp;the&nbsp;range&nbsp;[lo,&nbsp;hi]&nbsp;where&nbsp;lo&nbsp;:=&nbsp;clear&nbsp;+&nbsp;2,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6051487">//&nbsp;with&nbsp;the&nbsp;upper&nbsp;bound&nbsp;incrementing&nbsp;on&nbsp;each&nbsp;code&nbsp;seen.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6051544">//&nbsp;overflow&nbsp;is&nbsp;the&nbsp;code&nbsp;at&nbsp;which&nbsp;hi&nbsp;overflows&nbsp;the&nbsp;code&nbsp;width.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6051607">//&nbsp;last&nbsp;is&nbsp;the&nbsp;most&nbsp;recently&nbsp;seen&nbsp;code,&nbsp;or&nbsp;decoderInvalidCode.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6051671">clear</span><span class="op" id="6051676">,</span>&nbsp;<span class="ident" id="6051678">eof</span><span class="op" id="6051681">,</span>&nbsp;<span class="ident" id="6051683">hi</span><span class="op" id="6051685">,</span>&nbsp;<span class="ident" id="6051687">overflow</span><span class="op" id="6051695">,</span>&nbsp;<span class="ident" id="6051697">last</span>&nbsp;<span class="builtintype" id="6051702">uint16</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6051711">//&nbsp;Each&nbsp;code&nbsp;c&nbsp;in&nbsp;[lo,&nbsp;hi]&nbsp;expands&nbsp;to&nbsp;two&nbsp;or&nbsp;more&nbsp;bytes.&nbsp;For&nbsp;c&nbsp;!=&nbsp;hi:</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6051782">//&nbsp;&nbsp;&nbsp;suffix[c]&nbsp;is&nbsp;the&nbsp;last&nbsp;of&nbsp;these&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6051826">//&nbsp;&nbsp;&nbsp;prefix[c]&nbsp;is&nbsp;the&nbsp;code&nbsp;for&nbsp;all&nbsp;but&nbsp;the&nbsp;last&nbsp;byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6051881">//&nbsp;&nbsp;&nbsp;This&nbsp;code&nbsp;can&nbsp;either&nbsp;be&nbsp;a&nbsp;literal&nbsp;code&nbsp;or&nbsp;another&nbsp;code&nbsp;in&nbsp;[lo,&nbsp;c).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6051954">//&nbsp;The&nbsp;c&nbsp;==&nbsp;hi&nbsp;case&nbsp;is&nbsp;a&nbsp;special&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6051994">suffix</span>&nbsp;<span class="op" id="6052001">[</span><span class="num" id="6052002">1</span>&nbsp;<span class="op" id="6052004">&lt;&lt;</span>&nbsp;<span class="ident" id="6052007">maxWidth</span><span class="op" id="6052015">]</span><span class="builtintype" id="6052016">uint8</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6052023">prefix</span>&nbsp;<span class="op" id="6052030">[</span><span class="num" id="6052031">1</span>&nbsp;<span class="op" id="6052033">&lt;&lt;</span>&nbsp;<span class="ident" id="6052036">maxWidth</span><span class="op" id="6052044">]</span><span class="builtintype" id="6052045">uint16</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6052054">//&nbsp;output&nbsp;is&nbsp;the&nbsp;temporary&nbsp;output&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6052097">//&nbsp;Literal&nbsp;codes&nbsp;are&nbsp;accumulated&nbsp;from&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6052161">//&nbsp;Non-literal&nbsp;codes&nbsp;decode&nbsp;to&nbsp;a&nbsp;sequence&nbsp;of&nbsp;suffixes&nbsp;that&nbsp;are&nbsp;first</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6052231">//&nbsp;written&nbsp;right-to-left&nbsp;from&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;buffer&nbsp;before&nbsp;being&nbsp;copied</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6052304">//&nbsp;to&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6052336">//&nbsp;It&nbsp;is&nbsp;flushed&nbsp;when&nbsp;it&nbsp;contains&nbsp;&gt;=&nbsp;1&lt;&lt;maxWidth&nbsp;bytes,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6052393">//&nbsp;so&nbsp;that&nbsp;there&nbsp;is&nbsp;always&nbsp;room&nbsp;to&nbsp;decode&nbsp;an&nbsp;entire&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6052452">output</span>&nbsp;<span class="op" id="6052459">[</span><span class="num" id="6052460">2</span>&nbsp;<span class="op" id="6052462">*</span>&nbsp;<span class="num" id="6052464">1</span>&nbsp;<span class="op" id="6052466">&lt;&lt;</span>&nbsp;<span class="ident" id="6052469">maxWidth</span><span class="op" id="6052477">]</span><span class="builtintype" id="6052478">byte</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6052484">o</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6052491">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6052498">//&nbsp;write&nbsp;index&nbsp;into&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6052526">toRead</span>&nbsp;<span class="op" id="6052533">[</span><span class="op" id="6052534">]</span><span class="builtintype" id="6052535">byte</span>&nbsp;<span class="comment" id="6052540">//&nbsp;bytes&nbsp;to&nbsp;return&nbsp;from&nbsp;Read</span><br>
<span class="lineno"></span><span class="op" id="6052569">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6052572">//&nbsp;readLSB&nbsp;returns&nbsp;the&nbsp;next&nbsp;code&nbsp;for&nbsp;&#34;Least&nbsp;Significant&nbsp;Bits&nbsp;first&#34;&nbsp;data.</span><br>
<span class="lineno">85</span><span class="keyword" id="6052646">func</span>&nbsp;<span class="op" id="6052651">(</span><span class="ident" id="6052652">d</span>&nbsp;<span class="op" id="6052654">*</span><span class="ident" id="6052655">decoder</span><span class="op" id="6052662">)</span>&nbsp;<span class="ident" id="6052664">readLSB</span><span class="op" id="6052671">(</span><span class="op" id="6052672">)</span>&nbsp;<span class="op" id="6052674">(</span><span class="builtintype" id="6052675">uint16</span><span class="op" id="6052681">,</span>&nbsp;<span class="builtintype" id="6052683">error</span><span class="op" id="6052688">)</span>&nbsp;<span class="op" id="6052690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6052693">for</span>&nbsp;<span class="ident" id="6052697">d</span><span class="op" id="6052698">.</span><span class="ident" id="6052699">nBits</span>&nbsp;<span class="op" id="6052705">&lt;</span>&nbsp;<span class="ident" id="6052707">d</span><span class="op" id="6052708">.</span><span class="ident" id="6052709">width</span>&nbsp;<span class="op" id="6052715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6052719">x</span><span class="op" id="6052720">,</span>&nbsp;<span class="ident" id="6052722">err</span>&nbsp;<span class="op" id="6052726">:=</span>&nbsp;<span class="ident" id="6052729">d</span><span class="op" id="6052730">.</span><span class="ident" id="6052731">r</span><span class="op" id="6052732">.</span><span class="ident" id="6052733">ReadByte</span><span class="op" id="6052741">(</span><span class="op" id="6052742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6052746">if</span>&nbsp;<span class="ident" id="6052749">err</span>&nbsp;<span class="op" id="6052753">!=</span>&nbsp;<span class="builtintype" id="6052756">nil</span>&nbsp;<span class="op" id="6052760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6052765">return</span>&nbsp;<span class="num" id="6052772">0</span><span class="op" id="6052773">,</span>&nbsp;<span class="ident" id="6052775">err</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6052781">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6052785">d</span><span class="op" id="6052786">.</span><span class="ident" id="6052787">bits</span>&nbsp;<span class="op" id="6052792">|=</span>&nbsp;<span class="builtintype" id="6052795">uint32</span><span class="op" id="6052801">(</span><span class="ident" id="6052802">x</span><span class="op" id="6052803">)</span>&nbsp;<span class="op" id="6052805">&lt;&lt;</span>&nbsp;<span class="ident" id="6052808">d</span><span class="op" id="6052809">.</span><span class="ident" id="6052810">nBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6052818">d</span><span class="op" id="6052819">.</span><span class="ident" id="6052820">nBits</span>&nbsp;<span class="op" id="6052826">+=</span>&nbsp;<span class="num" id="6052829">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6052832">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6052835">code</span>&nbsp;<span class="op" id="6052840">:=</span>&nbsp;<span class="builtintype" id="6052843">uint16</span><span class="op" id="6052849">(</span><span class="ident" id="6052850">d</span><span class="op" id="6052851">.</span><span class="ident" id="6052852">bits</span>&nbsp;<span class="op" id="6052857">&amp;</span>&nbsp;<span class="op" id="6052859">(</span><span class="num" id="6052860">1</span><span class="op" id="6052861">&lt;&lt;</span><span class="ident" id="6052863">d</span><span class="op" id="6052864">.</span><span class="ident" id="6052865">width</span>&nbsp;<span class="op" id="6052871">-</span>&nbsp;<span class="num" id="6052873">1</span><span class="op" id="6052874">)</span><span class="op" id="6052875">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6052878">d</span><span class="op" id="6052879">.</span><span class="ident" id="6052880">bits</span>&nbsp;<span class="op" id="6052885">&gt;&gt;=</span>&nbsp;<span class="ident" id="6052889">d</span><span class="op" id="6052890">.</span><span class="ident" id="6052891">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6052898">d</span><span class="op" id="6052899">.</span><span class="ident" id="6052900">nBits</span>&nbsp;<span class="op" id="6052906">-=</span>&nbsp;<span class="ident" id="6052909">d</span><span class="op" id="6052910">.</span><span class="ident" id="6052911">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6052918">return</span>&nbsp;<span class="ident" id="6052925">code</span><span class="op" id="6052929">,</span>&nbsp;<span class="builtintype" id="6052931">nil</span><br>
<span class="lineno"></span><span class="op" id="6052935">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="6052938">//&nbsp;readMSB&nbsp;returns&nbsp;the&nbsp;next&nbsp;code&nbsp;for&nbsp;&#34;Most&nbsp;Significant&nbsp;Bits&nbsp;first&#34;&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="6053011">func</span>&nbsp;<span class="op" id="6053016">(</span><span class="ident" id="6053017">d</span>&nbsp;<span class="op" id="6053019">*</span><span class="ident" id="6053020">decoder</span><span class="op" id="6053027">)</span>&nbsp;<span class="ident" id="6053029">readMSB</span><span class="op" id="6053036">(</span><span class="op" id="6053037">)</span>&nbsp;<span class="op" id="6053039">(</span><span class="builtintype" id="6053040">uint16</span><span class="op" id="6053046">,</span>&nbsp;<span class="builtintype" id="6053048">error</span><span class="op" id="6053053">)</span>&nbsp;<span class="op" id="6053055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6053058">for</span>&nbsp;<span class="ident" id="6053062">d</span><span class="op" id="6053063">.</span><span class="ident" id="6053064">nBits</span>&nbsp;<span class="op" id="6053070">&lt;</span>&nbsp;<span class="ident" id="6053072">d</span><span class="op" id="6053073">.</span><span class="ident" id="6053074">width</span>&nbsp;<span class="op" id="6053080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6053084">x</span><span class="op" id="6053085">,</span>&nbsp;<span class="ident" id="6053087">err</span>&nbsp;<span class="op" id="6053091">:=</span>&nbsp;<span class="ident" id="6053094">d</span><span class="op" id="6053095">.</span><span class="ident" id="6053096">r</span><span class="op" id="6053097">.</span><span class="ident" id="6053098">ReadByte</span><span class="op" id="6053106">(</span><span class="op" id="6053107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6053111">if</span>&nbsp;<span class="ident" id="6053114">err</span>&nbsp;<span class="op" id="6053118">!=</span>&nbsp;<span class="builtintype" id="6053121">nil</span>&nbsp;<span class="op" id="6053125">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6053130">return</span>&nbsp;<span class="num" id="6053137">0</span><span class="op" id="6053138">,</span>&nbsp;<span class="ident" id="6053140">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6053146">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6053150">d</span><span class="op" id="6053151">.</span><span class="ident" id="6053152">bits</span>&nbsp;<span class="op" id="6053157">|=</span>&nbsp;<span class="builtintype" id="6053160">uint32</span><span class="op" id="6053166">(</span><span class="ident" id="6053167">x</span><span class="op" id="6053168">)</span>&nbsp;<span class="op" id="6053170">&lt;&lt;</span>&nbsp;<span class="op" id="6053173">(</span><span class="num" id="6053174">24</span>&nbsp;<span class="op" id="6053177">-</span>&nbsp;<span class="ident" id="6053179">d</span><span class="op" id="6053180">.</span><span class="ident" id="6053181">nBits</span><span class="op" id="6053186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6053190">d</span><span class="op" id="6053191">.</span><span class="ident" id="6053192">nBits</span>&nbsp;<span class="op" id="6053198">+=</span>&nbsp;<span class="num" id="6053201">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6053204">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6053207">code</span>&nbsp;<span class="op" id="6053212">:=</span>&nbsp;<span class="builtintype" id="6053215">uint16</span><span class="op" id="6053221">(</span><span class="ident" id="6053222">d</span><span class="op" id="6053223">.</span><span class="ident" id="6053224">bits</span>&nbsp;<span class="op" id="6053229">&gt;&gt;</span>&nbsp;<span class="op" id="6053232">(</span><span class="num" id="6053233">32</span>&nbsp;<span class="op" id="6053236">-</span>&nbsp;<span class="ident" id="6053238">d</span><span class="op" id="6053239">.</span><span class="ident" id="6053240">width</span><span class="op" id="6053245">)</span><span class="op" id="6053246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6053249">d</span><span class="op" id="6053250">.</span><span class="ident" id="6053251">bits</span>&nbsp;<span class="op" id="6053256">&lt;&lt;=</span>&nbsp;<span class="ident" id="6053260">d</span><span class="op" id="6053261">.</span><span class="ident" id="6053262">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6053269">d</span><span class="op" id="6053270">.</span><span class="ident" id="6053271">nBits</span>&nbsp;<span class="op" id="6053277">-=</span>&nbsp;<span class="ident" id="6053280">d</span><span class="op" id="6053281">.</span><span class="ident" id="6053282">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6053289">return</span>&nbsp;<span class="ident" id="6053296">code</span><span class="op" id="6053300">,</span>&nbsp;<span class="builtintype" id="6053302">nil</span><br>
<span class="lineno"></span><span class="op" id="6053306">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="keyword" id="6053309">func</span>&nbsp;<span class="op" id="6053314">(</span><span class="ident" id="6053315">d</span>&nbsp;<span class="op" id="6053317">*</span><span class="ident" id="6053318">decoder</span><span class="op" id="6053325">)</span>&nbsp;<span class="ident" id="6053327">Read</span><span class="op" id="6053331">(</span><span class="ident" id="6053332">b</span>&nbsp;<span class="op" id="6053334">[</span><span class="op" id="6053335">]</span><span class="builtintype" id="6053336">byte</span><span class="op" id="6053340">)</span>&nbsp;<span class="op" id="6053342">(</span><span class="builtintype" id="6053343">int</span><span class="op" id="6053346">,</span>&nbsp;<span class="builtintype" id="6053348">error</span><span class="op" id="6053353">)</span>&nbsp;<span class="op" id="6053355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6053358">for</span>&nbsp;<span class="op" id="6053362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6053366">if</span>&nbsp;<span class="builtinfunc" id="6053369">len</span><span class="op" id="6053372">(</span><span class="ident" id="6053373">d</span><span class="op" id="6053374">.</span><span class="ident" id="6053375">toRead</span><span class="op" id="6053381">)</span>&nbsp;<span class="op" id="6053383">&gt;</span>&nbsp;<span class="num" id="6053385">0</span>&nbsp;<span class="op" id="6053387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6053392">n</span>&nbsp;<span class="op" id="6053394">:=</span>&nbsp;<span class="builtinfunc" id="6053397">copy</span><span class="op" id="6053401">(</span><span class="ident" id="6053402">b</span><span class="op" id="6053403">,</span>&nbsp;<span class="ident" id="6053405">d</span><span class="op" id="6053406">.</span><span class="ident" id="6053407">toRead</span><span class="op" id="6053413">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6053418">d</span><span class="op" id="6053419">.</span><span class="ident" id="6053420">toRead</span>&nbsp;<span class="op" id="6053427">=</span>&nbsp;<span class="ident" id="6053429">d</span><span class="op" id="6053430">.</span><span class="ident" id="6053431">toRead</span><span class="op" id="6053437">[</span><span class="ident" id="6053438">n</span><span class="op" id="6053439">:</span><span class="op" id="6053440">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6053445">return</span>&nbsp;<span class="ident" id="6053452">n</span><span class="op" id="6053453">,</span>&nbsp;<span class="builtintype" id="6053455">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6053461">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6053465">if</span>&nbsp;<span class="ident" id="6053468">d</span><span class="op" id="6053469">.</span><span class="ident" id="6053470">err</span>&nbsp;<span class="op" id="6053474">!=</span>&nbsp;<span class="builtintype" id="6053477">nil</span>&nbsp;<span class="op" id="6053481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6053486">return</span>&nbsp;<span class="num" id="6053493">0</span><span class="op" id="6053494">,</span>&nbsp;<span class="ident" id="6053496">d</span><span class="op" id="6053497">.</span><span class="ident" id="6053498">err</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6053504">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6053508">d</span><span class="op" id="6053509">.</span><span class="ident" id="6053510">decode</span><span class="op" id="6053516">(</span><span class="op" id="6053517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6053520">}</span><br>
<span class="lineno"></span><span class="op" id="6053522">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="6053525">//&nbsp;decode&nbsp;decompresses&nbsp;bytes&nbsp;from&nbsp;r&nbsp;and&nbsp;leaves&nbsp;them&nbsp;in&nbsp;d.toRead.</span><br>
<span class="lineno"></span><span class="comment" id="6053590">//&nbsp;read&nbsp;specifies&nbsp;how&nbsp;to&nbsp;decode&nbsp;bytes&nbsp;into&nbsp;codes.</span><br>
<span class="lineno"></span><span class="comment" id="6053640">//&nbsp;litWidth&nbsp;is&nbsp;the&nbsp;width&nbsp;in&nbsp;bits&nbsp;of&nbsp;literal&nbsp;codes.</span><br>
<span class="lineno"></span><span class="keyword" id="6053691">func</span>&nbsp;<span class="op" id="6053696">(</span><span class="ident" id="6053697">d</span>&nbsp;<span class="op" id="6053699">*</span><span class="ident" id="6053700">decoder</span><span class="op" id="6053707">)</span>&nbsp;<span class="ident" id="6053709">decode</span><span class="op" id="6053715">(</span><span class="op" id="6053716">)</span>&nbsp;<span class="op" id="6053718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6053721">//&nbsp;Loop&nbsp;over&nbsp;the&nbsp;code&nbsp;stream,&nbsp;converting&nbsp;codes&nbsp;into&nbsp;decompressed&nbsp;bytes.</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6053794">for</span>&nbsp;<span class="op" id="6053798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6053802">code</span><span class="op" id="6053806">,</span>&nbsp;<span class="ident" id="6053808">err</span>&nbsp;<span class="op" id="6053812">:=</span>&nbsp;<span class="ident" id="6053815">d</span><span class="op" id="6053816">.</span><span class="ident" id="6053817">read</span><span class="op" id="6053821">(</span><span class="ident" id="6053822">d</span><span class="op" id="6053823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6053827">if</span>&nbsp;<span class="ident" id="6053830">err</span>&nbsp;<span class="op" id="6053834">!=</span>&nbsp;<span class="builtintype" id="6053837">nil</span>&nbsp;<span class="op" id="6053841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6053846">if</span>&nbsp;<span class="ident" id="6053849">err</span>&nbsp;<span class="op" id="6053853">==</span>&nbsp;<span class="ident" id="6053856">io</span><span class="op" id="6053858">.</span><span class="ident" id="6053859">EOF</span>&nbsp;<span class="op" id="6053863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6053869">err</span>&nbsp;<span class="op" id="6053873">=</span>&nbsp;<span class="ident" id="6053875">io</span><span class="op" id="6053877">.</span><span class="ident" id="6053878">ErrUnexpectedEOF</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6053898">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6053903">d</span><span class="op" id="6053904">.</span><span class="ident" id="6053905">err</span>&nbsp;<span class="op" id="6053909">=</span>&nbsp;<span class="ident" id="6053911">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6053918">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6053927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6053931">switch</span>&nbsp;<span class="op" id="6053938">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6053942">case</span>&nbsp;<span class="ident" id="6053947">code</span>&nbsp;<span class="op" id="6053952">&lt;</span>&nbsp;<span class="ident" id="6053954">d</span><span class="op" id="6053955">.</span><span class="ident" id="6053956">clear</span><span class="op" id="6053961">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6053966">//&nbsp;We&nbsp;have&nbsp;a&nbsp;literal&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6053996">d</span><span class="op" id="6053997">.</span><span class="ident" id="6053998">output</span><span class="op" id="6054004">[</span><span class="ident" id="6054005">d</span><span class="op" id="6054006">.</span><span class="ident" id="6054007">o</span><span class="op" id="6054008">]</span>&nbsp;<span class="op" id="6054010">=</span>&nbsp;<span class="builtintype" id="6054012">uint8</span><span class="op" id="6054017">(</span><span class="ident" id="6054018">code</span><span class="op" id="6054022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6054027">d</span><span class="op" id="6054028">.</span><span class="ident" id="6054029">o</span><span class="op" id="6054030">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6054036">if</span>&nbsp;<span class="ident" id="6054039">d</span><span class="op" id="6054040">.</span><span class="ident" id="6054041">last</span>&nbsp;<span class="op" id="6054046">!=</span>&nbsp;<span class="ident" id="6054049">decoderInvalidCode</span>&nbsp;<span class="op" id="6054068">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6054074">//&nbsp;Save&nbsp;what&nbsp;the&nbsp;hi&nbsp;code&nbsp;expands&nbsp;to.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6054115">d</span><span class="op" id="6054116">.</span><span class="ident" id="6054117">suffix</span><span class="op" id="6054123">[</span><span class="ident" id="6054124">d</span><span class="op" id="6054125">.</span><span class="ident" id="6054126">hi</span><span class="op" id="6054128">]</span>&nbsp;<span class="op" id="6054130">=</span>&nbsp;<span class="builtintype" id="6054132">uint8</span><span class="op" id="6054137">(</span><span class="ident" id="6054138">code</span><span class="op" id="6054142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6054148">d</span><span class="op" id="6054149">.</span><span class="ident" id="6054150">prefix</span><span class="op" id="6054156">[</span><span class="ident" id="6054157">d</span><span class="op" id="6054158">.</span><span class="ident" id="6054159">hi</span><span class="op" id="6054161">]</span>&nbsp;<span class="op" id="6054163">=</span>&nbsp;<span class="ident" id="6054165">d</span><span class="op" id="6054166">.</span><span class="ident" id="6054167">last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6054175">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6054179">case</span>&nbsp;<span class="ident" id="6054184">code</span>&nbsp;<span class="op" id="6054189">==</span>&nbsp;<span class="ident" id="6054192">d</span><span class="op" id="6054193">.</span><span class="ident" id="6054194">clear</span><span class="op" id="6054199">:</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6054204">d</span><span class="op" id="6054205">.</span><span class="ident" id="6054206">width</span>&nbsp;<span class="op" id="6054212">=</span>&nbsp;<span class="num" id="6054214">1</span>&nbsp;<span class="op" id="6054216">+</span>&nbsp;<span class="builtintype" id="6054218">uint</span><span class="op" id="6054222">(</span><span class="ident" id="6054223">d</span><span class="op" id="6054224">.</span><span class="ident" id="6054225">litWidth</span><span class="op" id="6054233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6054238">d</span><span class="op" id="6054239">.</span><span class="ident" id="6054240">hi</span>&nbsp;<span class="op" id="6054243">=</span>&nbsp;<span class="ident" id="6054245">d</span><span class="op" id="6054246">.</span><span class="ident" id="6054247">eof</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6054254">d</span><span class="op" id="6054255">.</span><span class="ident" id="6054256">overflow</span>&nbsp;<span class="op" id="6054265">=</span>&nbsp;<span class="num" id="6054267">1</span>&nbsp;<span class="op" id="6054269">&lt;&lt;</span>&nbsp;<span class="ident" id="6054272">d</span><span class="op" id="6054273">.</span><span class="ident" id="6054274">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6054283">d</span><span class="op" id="6054284">.</span><span class="ident" id="6054285">last</span>&nbsp;<span class="op" id="6054290">=</span>&nbsp;<span class="ident" id="6054292">decoderInvalidCode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6054314">continue</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6054325">case</span>&nbsp;<span class="ident" id="6054330">code</span>&nbsp;<span class="op" id="6054335">==</span>&nbsp;<span class="ident" id="6054338">d</span><span class="op" id="6054339">.</span><span class="ident" id="6054340">eof</span><span class="op" id="6054343">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6054348">d</span><span class="op" id="6054349">.</span><span class="ident" id="6054350">flush</span><span class="op" id="6054355">(</span><span class="op" id="6054356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6054361">d</span><span class="op" id="6054362">.</span><span class="ident" id="6054363">err</span>&nbsp;<span class="op" id="6054367">=</span>&nbsp;<span class="ident" id="6054369">io</span><span class="op" id="6054371">.</span><span class="ident" id="6054372">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6054379">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6054388">case</span>&nbsp;<span class="ident" id="6054393">code</span>&nbsp;<span class="op" id="6054398">&lt;=</span>&nbsp;<span class="ident" id="6054401">d</span><span class="op" id="6054402">.</span><span class="ident" id="6054403">hi</span><span class="op" id="6054405">:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6054410">c</span><span class="op" id="6054411">,</span>&nbsp;<span class="ident" id="6054413">i</span>&nbsp;<span class="op" id="6054415">:=</span>&nbsp;<span class="ident" id="6054418">code</span><span class="op" id="6054422">,</span>&nbsp;<span class="builtinfunc" id="6054424">len</span><span class="op" id="6054427">(</span><span class="ident" id="6054428">d</span><span class="op" id="6054429">.</span><span class="ident" id="6054430">output</span><span class="op" id="6054436">)</span><span class="op" id="6054437">-</span><span class="num" id="6054438">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6054443">if</span>&nbsp;<span class="ident" id="6054446">code</span>&nbsp;<span class="op" id="6054451">==</span>&nbsp;<span class="ident" id="6054454">d</span><span class="op" id="6054455">.</span><span class="ident" id="6054456">hi</span>&nbsp;<span class="op" id="6054459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6054465">//&nbsp;code&nbsp;==&nbsp;hi&nbsp;is&nbsp;a&nbsp;special&nbsp;case&nbsp;which&nbsp;expands&nbsp;to&nbsp;the&nbsp;last&nbsp;expansion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6054537">//&nbsp;followed&nbsp;by&nbsp;the&nbsp;head&nbsp;of&nbsp;the&nbsp;last&nbsp;expansion.&nbsp;To&nbsp;find&nbsp;the&nbsp;head,&nbsp;we&nbsp;walk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6054614">//&nbsp;the&nbsp;prefix&nbsp;chain&nbsp;until&nbsp;we&nbsp;find&nbsp;a&nbsp;literal&nbsp;code.</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6054668">c</span>&nbsp;<span class="op" id="6054670">=</span>&nbsp;<span class="ident" id="6054672">d</span><span class="op" id="6054673">.</span><span class="ident" id="6054674">last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6054683">for</span>&nbsp;<span class="ident" id="6054687">c</span>&nbsp;<span class="op" id="6054689">&gt;=</span>&nbsp;<span class="ident" id="6054692">d</span><span class="op" id="6054693">.</span><span class="ident" id="6054694">clear</span>&nbsp;<span class="op" id="6054700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6054707">c</span>&nbsp;<span class="op" id="6054709">=</span>&nbsp;<span class="ident" id="6054711">d</span><span class="op" id="6054712">.</span><span class="ident" id="6054713">prefix</span><span class="op" id="6054719">[</span><span class="ident" id="6054720">c</span><span class="op" id="6054721">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6054727">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6054733">d</span><span class="op" id="6054734">.</span><span class="ident" id="6054735">output</span><span class="op" id="6054741">[</span><span class="ident" id="6054742">i</span><span class="op" id="6054743">]</span>&nbsp;<span class="op" id="6054745">=</span>&nbsp;<span class="builtintype" id="6054747">uint8</span><span class="op" id="6054752">(</span><span class="ident" id="6054753">c</span><span class="op" id="6054754">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6054760">i</span><span class="op" id="6054761">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6054768">c</span>&nbsp;<span class="op" id="6054770">=</span>&nbsp;<span class="ident" id="6054772">d</span><span class="op" id="6054773">.</span><span class="ident" id="6054774">last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6054782">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6054787">//&nbsp;Copy&nbsp;the&nbsp;suffix&nbsp;chain&nbsp;into&nbsp;output&nbsp;and&nbsp;then&nbsp;write&nbsp;that&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6054853">for</span>&nbsp;<span class="ident" id="6054857">c</span>&nbsp;<span class="op" id="6054859">&gt;=</span>&nbsp;<span class="ident" id="6054862">d</span><span class="op" id="6054863">.</span><span class="ident" id="6054864">clear</span>&nbsp;<span class="op" id="6054870">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6054876">d</span><span class="op" id="6054877">.</span><span class="ident" id="6054878">output</span><span class="op" id="6054884">[</span><span class="ident" id="6054885">i</span><span class="op" id="6054886">]</span>&nbsp;<span class="op" id="6054888">=</span>&nbsp;<span class="ident" id="6054890">d</span><span class="op" id="6054891">.</span><span class="ident" id="6054892">suffix</span><span class="op" id="6054898">[</span><span class="ident" id="6054899">c</span><span class="op" id="6054900">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6054906">i</span><span class="op" id="6054907">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6054914">c</span>&nbsp;<span class="op" id="6054916">=</span>&nbsp;<span class="ident" id="6054918">d</span><span class="op" id="6054919">.</span><span class="ident" id="6054920">prefix</span><span class="op" id="6054926">[</span><span class="ident" id="6054927">c</span><span class="op" id="6054928">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6054933">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6054938">d</span><span class="op" id="6054939">.</span><span class="ident" id="6054940">output</span><span class="op" id="6054946">[</span><span class="ident" id="6054947">i</span><span class="op" id="6054948">]</span>&nbsp;<span class="op" id="6054950">=</span>&nbsp;<span class="builtintype" id="6054952">uint8</span><span class="op" id="6054957">(</span><span class="ident" id="6054958">c</span><span class="op" id="6054959">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6054964">d</span><span class="op" id="6054965">.</span><span class="ident" id="6054966">o</span>&nbsp;<span class="op" id="6054968">+=</span>&nbsp;<span class="builtinfunc" id="6054971">copy</span><span class="op" id="6054975">(</span><span class="ident" id="6054976">d</span><span class="op" id="6054977">.</span><span class="ident" id="6054978">output</span><span class="op" id="6054984">[</span><span class="ident" id="6054985">d</span><span class="op" id="6054986">.</span><span class="ident" id="6054987">o</span><span class="op" id="6054988">:</span><span class="op" id="6054989">]</span><span class="op" id="6054990">,</span>&nbsp;<span class="ident" id="6054992">d</span><span class="op" id="6054993">.</span><span class="ident" id="6054994">output</span><span class="op" id="6055000">[</span><span class="ident" id="6055001">i</span><span class="op" id="6055002">:</span><span class="op" id="6055003">]</span><span class="op" id="6055004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6055009">if</span>&nbsp;<span class="ident" id="6055012">d</span><span class="op" id="6055013">.</span><span class="ident" id="6055014">last</span>&nbsp;<span class="op" id="6055019">!=</span>&nbsp;<span class="ident" id="6055022">decoderInvalidCode</span>&nbsp;<span class="op" id="6055041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6055047">//&nbsp;Save&nbsp;what&nbsp;the&nbsp;hi&nbsp;code&nbsp;expands&nbsp;to.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6055088">d</span><span class="op" id="6055089">.</span><span class="ident" id="6055090">suffix</span><span class="op" id="6055096">[</span><span class="ident" id="6055097">d</span><span class="op" id="6055098">.</span><span class="ident" id="6055099">hi</span><span class="op" id="6055101">]</span>&nbsp;<span class="op" id="6055103">=</span>&nbsp;<span class="builtintype" id="6055105">uint8</span><span class="op" id="6055110">(</span><span class="ident" id="6055111">c</span><span class="op" id="6055112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6055118">d</span><span class="op" id="6055119">.</span><span class="ident" id="6055120">prefix</span><span class="op" id="6055126">[</span><span class="ident" id="6055127">d</span><span class="op" id="6055128">.</span><span class="ident" id="6055129">hi</span><span class="op" id="6055131">]</span>&nbsp;<span class="op" id="6055133">=</span>&nbsp;<span class="ident" id="6055135">d</span><span class="op" id="6055136">.</span><span class="ident" id="6055137">last</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6055145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6055149">default</span><span class="op" id="6055156">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6055161">d</span><span class="op" id="6055162">.</span><span class="ident" id="6055163">err</span>&nbsp;<span class="op" id="6055167">=</span>&nbsp;<span class="ident" id="6055169">errors</span><span class="op" id="6055175">.</span><span class="ident" id="6055176">New</span><span class="op" id="6055179">(</span><span class="string" id="6055180">&#34;lzw:&nbsp;invalid&nbsp;code&#34;</span><span class="op" id="6055199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6055204">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6055213">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6055217">d</span><span class="op" id="6055218">.</span><span class="ident" id="6055219">last</span><span class="op" id="6055223">,</span>&nbsp;<span class="ident" id="6055225">d</span><span class="op" id="6055226">.</span><span class="ident" id="6055227">hi</span>&nbsp;<span class="op" id="6055230">=</span>&nbsp;<span class="ident" id="6055232">code</span><span class="op" id="6055236">,</span>&nbsp;<span class="ident" id="6055238">d</span><span class="op" id="6055239">.</span><span class="ident" id="6055240">hi</span><span class="op" id="6055242">+</span><span class="num" id="6055243">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6055247">if</span>&nbsp;<span class="ident" id="6055250">d</span><span class="op" id="6055251">.</span><span class="ident" id="6055252">hi</span>&nbsp;<span class="op" id="6055255">&gt;=</span>&nbsp;<span class="ident" id="6055258">d</span><span class="op" id="6055259">.</span><span class="ident" id="6055260">overflow</span>&nbsp;<span class="op" id="6055269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6055274">if</span>&nbsp;<span class="ident" id="6055277">d</span><span class="op" id="6055278">.</span><span class="ident" id="6055279">width</span>&nbsp;<span class="op" id="6055285">==</span>&nbsp;<span class="ident" id="6055288">maxWidth</span>&nbsp;<span class="op" id="6055297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6055303">d</span><span class="op" id="6055304">.</span><span class="ident" id="6055305">last</span>&nbsp;<span class="op" id="6055310">=</span>&nbsp;<span class="ident" id="6055312">decoderInvalidCode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6055334">}</span>&nbsp;<span class="keyword" id="6055336">else</span>&nbsp;<span class="op" id="6055341">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6055347">d</span><span class="op" id="6055348">.</span><span class="ident" id="6055349">width</span><span class="op" id="6055354">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6055361">d</span><span class="op" id="6055362">.</span><span class="ident" id="6055363">overflow</span>&nbsp;<span class="op" id="6055372">&lt;&lt;=</span>&nbsp;<span class="num" id="6055376">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6055381">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6055385">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6055389">if</span>&nbsp;<span class="ident" id="6055392">d</span><span class="op" id="6055393">.</span><span class="ident" id="6055394">o</span>&nbsp;<span class="op" id="6055396">&gt;=</span>&nbsp;<span class="ident" id="6055399">flushBuffer</span>&nbsp;<span class="op" id="6055411">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6055416">d</span><span class="op" id="6055417">.</span><span class="ident" id="6055418">flush</span><span class="op" id="6055423">(</span><span class="op" id="6055424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6055429">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6055438">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6055441">}</span><br>
<span class="lineno"></span><span class="op" id="6055443">}</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span><span class="keyword" id="6055446">func</span>&nbsp;<span class="op" id="6055451">(</span><span class="ident" id="6055452">d</span>&nbsp;<span class="op" id="6055454">*</span><span class="ident" id="6055455">decoder</span><span class="op" id="6055462">)</span>&nbsp;<span class="ident" id="6055464">flush</span><span class="op" id="6055469">(</span><span class="op" id="6055470">)</span>&nbsp;<span class="op" id="6055472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6055475">d</span><span class="op" id="6055476">.</span><span class="ident" id="6055477">toRead</span>&nbsp;<span class="op" id="6055484">=</span>&nbsp;<span class="ident" id="6055486">d</span><span class="op" id="6055487">.</span><span class="ident" id="6055488">output</span><span class="op" id="6055494">[</span><span class="op" id="6055495">:</span><span class="ident" id="6055496">d</span><span class="op" id="6055497">.</span><span class="ident" id="6055498">o</span><span class="op" id="6055499">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6055502">d</span><span class="op" id="6055503">.</span><span class="ident" id="6055504">o</span>&nbsp;<span class="op" id="6055506">=</span>&nbsp;<span class="num" id="6055508">0</span><br>
<span class="lineno"></span><span class="op" id="6055510">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span><span class="keyword" id="6055513">var</span>&nbsp;<span class="ident" id="6055517">errClosed</span>&nbsp;<span class="op" id="6055527">=</span>&nbsp;<span class="ident" id="6055529">errors</span><span class="op" id="6055535">.</span><span class="ident" id="6055536">New</span><span class="op" id="6055539">(</span><span class="string" id="6055540">&#34;compress/lzw:&nbsp;reader/writer&nbsp;is&nbsp;closed&#34;</span><span class="op" id="6055579">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6055582">func</span>&nbsp;<span class="op" id="6055587">(</span><span class="ident" id="6055588">d</span>&nbsp;<span class="op" id="6055590">*</span><span class="ident" id="6055591">decoder</span><span class="op" id="6055598">)</span>&nbsp;<span class="ident" id="6055600">Close</span><span class="op" id="6055605">(</span><span class="op" id="6055606">)</span>&nbsp;<span class="builtintype" id="6055608">error</span>&nbsp;<span class="op" id="6055614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6055617">d</span><span class="op" id="6055618">.</span><span class="ident" id="6055619">err</span>&nbsp;<span class="op" id="6055623">=</span>&nbsp;<span class="ident" id="6055625">errClosed</span>&nbsp;<span class="comment" id="6055635">//&nbsp;in&nbsp;case&nbsp;any&nbsp;Reads&nbsp;come&nbsp;along</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6055668">return</span>&nbsp;<span class="builtintype" id="6055675">nil</span><br>
<span class="lineno"></span><span class="op" id="6055679">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6055682">//&nbsp;NewReader&nbsp;creates&nbsp;a&nbsp;new&nbsp;io.ReadCloser.</span><br>
<span class="lineno"></span><span class="comment" id="6055724">//&nbsp;Reads&nbsp;from&nbsp;the&nbsp;returned&nbsp;io.ReadCloser&nbsp;read&nbsp;and&nbsp;decompress&nbsp;data&nbsp;from&nbsp;r.</span><br>
<span class="lineno">225</span><span class="comment" id="6055798">//&nbsp;If&nbsp;r&nbsp;does&nbsp;not&nbsp;also&nbsp;implement&nbsp;io.ByteReader,</span><br>
<span class="lineno"></span><span class="comment" id="6055845">//&nbsp;the&nbsp;decompressor&nbsp;may&nbsp;read&nbsp;more&nbsp;data&nbsp;than&nbsp;necessary&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="6055907">//&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;call&nbsp;Close&nbsp;on&nbsp;the&nbsp;ReadCloser&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="6055981">//&nbsp;finished&nbsp;reading.</span><br>
<span class="lineno"></span><span class="comment" id="6056002">//&nbsp;The&nbsp;number&nbsp;of&nbsp;bits&nbsp;to&nbsp;use&nbsp;for&nbsp;literal&nbsp;codes,&nbsp;litWidth,&nbsp;must&nbsp;be&nbsp;in&nbsp;the</span><br>
<span class="lineno">230</span><span class="comment" id="6056075">//&nbsp;range&nbsp;[2,8]&nbsp;and&nbsp;is&nbsp;typically&nbsp;8.</span><br>
<span class="lineno"></span><span class="keyword" id="6056110">func</span>&nbsp;<span class="ident" id="6056115">NewReader</span><span class="op" id="6056124">(</span><span class="ident" id="6056125">r</span>&nbsp;<span class="ident" id="6056127">io</span><span class="op" id="6056129">.</span><span class="ident" id="6056130">Reader</span><span class="op" id="6056136">,</span>&nbsp;<span class="ident" id="6056138">order</span>&nbsp;<span class="ident" id="6056144">Order</span><span class="op" id="6056149">,</span>&nbsp;<span class="ident" id="6056151">litWidth</span>&nbsp;<span class="builtintype" id="6056160">int</span><span class="op" id="6056163">)</span>&nbsp;<span class="ident" id="6056165">io</span><span class="op" id="6056167">.</span><span class="ident" id="6056168">ReadCloser</span>&nbsp;<span class="op" id="6056179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6056182">d</span>&nbsp;<span class="op" id="6056184">:=</span>&nbsp;<span class="builtinfunc" id="6056187">new</span><span class="op" id="6056190">(</span><span class="ident" id="6056191">decoder</span><span class="op" id="6056198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6056201">switch</span>&nbsp;<span class="ident" id="6056208">order</span>&nbsp;<span class="op" id="6056214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6056217">case</span>&nbsp;<span class="ident" id="6056222">LSB</span><span class="op" id="6056225">:</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6056229">d</span><span class="op" id="6056230">.</span><span class="ident" id="6056231">read</span>&nbsp;<span class="op" id="6056236">=</span>&nbsp;<span class="op" id="6056238">(</span><span class="op" id="6056239">*</span><span class="ident" id="6056240">decoder</span><span class="op" id="6056247">)</span><span class="op" id="6056248">.</span><span class="ident" id="6056249">readLSB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6056258">case</span>&nbsp;<span class="ident" id="6056263">MSB</span><span class="op" id="6056266">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6056270">d</span><span class="op" id="6056271">.</span><span class="ident" id="6056272">read</span>&nbsp;<span class="op" id="6056277">=</span>&nbsp;<span class="op" id="6056279">(</span><span class="op" id="6056280">*</span><span class="ident" id="6056281">decoder</span><span class="op" id="6056288">)</span><span class="op" id="6056289">.</span><span class="ident" id="6056290">readMSB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6056299">default</span><span class="op" id="6056306">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6056310">d</span><span class="op" id="6056311">.</span><span class="ident" id="6056312">err</span>&nbsp;<span class="op" id="6056316">=</span>&nbsp;<span class="ident" id="6056318">errors</span><span class="op" id="6056324">.</span><span class="ident" id="6056325">New</span><span class="op" id="6056328">(</span><span class="string" id="6056329">&#34;lzw:&nbsp;unknown&nbsp;order&#34;</span><span class="op" id="6056349">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6056353">return</span>&nbsp;<span class="ident" id="6056360">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6056363">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6056366">if</span>&nbsp;<span class="ident" id="6056369">litWidth</span>&nbsp;<span class="op" id="6056378">&lt;</span>&nbsp;<span class="num" id="6056380">2</span>&nbsp;<span class="op" id="6056382">||</span>&nbsp;<span class="num" id="6056385">8</span>&nbsp;<span class="op" id="6056387">&lt;</span>&nbsp;<span class="ident" id="6056389">litWidth</span>&nbsp;<span class="op" id="6056398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6056402">d</span><span class="op" id="6056403">.</span><span class="ident" id="6056404">err</span>&nbsp;<span class="op" id="6056408">=</span>&nbsp;<span class="ident" id="6056410">fmt</span><span class="op" id="6056413">.</span><span class="ident" id="6056414">Errorf</span><span class="op" id="6056420">(</span><span class="string" id="6056421">&#34;lzw:&nbsp;litWidth&nbsp;%d&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="6056452">,</span>&nbsp;<span class="ident" id="6056454">litWidth</span><span class="op" id="6056462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6056466">return</span>&nbsp;<span class="ident" id="6056473">d</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6056476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6056479">if</span>&nbsp;<span class="ident" id="6056482">br</span><span class="op" id="6056484">,</span>&nbsp;<span class="ident" id="6056486">ok</span>&nbsp;<span class="op" id="6056489">:=</span>&nbsp;<span class="ident" id="6056492">r</span><span class="op" id="6056493">.</span><span class="op" id="6056494">(</span><span class="ident" id="6056495">io</span><span class="op" id="6056497">.</span><span class="ident" id="6056498">ByteReader</span><span class="op" id="6056508">)</span><span class="op" id="6056509">;</span>&nbsp;<span class="ident" id="6056511">ok</span>&nbsp;<span class="op" id="6056514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6056518">d</span><span class="op" id="6056519">.</span><span class="ident" id="6056520">r</span>&nbsp;<span class="op" id="6056522">=</span>&nbsp;<span class="ident" id="6056524">br</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6056528">}</span>&nbsp;<span class="keyword" id="6056530">else</span>&nbsp;<span class="op" id="6056535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6056539">d</span><span class="op" id="6056540">.</span><span class="ident" id="6056541">r</span>&nbsp;<span class="op" id="6056543">=</span>&nbsp;<span class="ident" id="6056545">bufio</span><span class="op" id="6056550">.</span><span class="ident" id="6056551">NewReader</span><span class="op" id="6056560">(</span><span class="ident" id="6056561">r</span><span class="op" id="6056562">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6056565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6056568">d</span><span class="op" id="6056569">.</span><span class="ident" id="6056570">litWidth</span>&nbsp;<span class="op" id="6056579">=</span>&nbsp;<span class="ident" id="6056581">litWidth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6056591">d</span><span class="op" id="6056592">.</span><span class="ident" id="6056593">width</span>&nbsp;<span class="op" id="6056599">=</span>&nbsp;<span class="num" id="6056601">1</span>&nbsp;<span class="op" id="6056603">+</span>&nbsp;<span class="builtintype" id="6056605">uint</span><span class="op" id="6056609">(</span><span class="ident" id="6056610">litWidth</span><span class="op" id="6056618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6056621">d</span><span class="op" id="6056622">.</span><span class="ident" id="6056623">clear</span>&nbsp;<span class="op" id="6056629">=</span>&nbsp;<span class="builtintype" id="6056631">uint16</span><span class="op" id="6056637">(</span><span class="num" id="6056638">1</span><span class="op" id="6056639">)</span>&nbsp;<span class="op" id="6056641">&lt;&lt;</span>&nbsp;<span class="builtintype" id="6056644">uint</span><span class="op" id="6056648">(</span><span class="ident" id="6056649">litWidth</span><span class="op" id="6056657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6056660">d</span><span class="op" id="6056661">.</span><span class="ident" id="6056662">eof</span><span class="op" id="6056665">,</span>&nbsp;<span class="ident" id="6056667">d</span><span class="op" id="6056668">.</span><span class="ident" id="6056669">hi</span>&nbsp;<span class="op" id="6056672">=</span>&nbsp;<span class="ident" id="6056674">d</span><span class="op" id="6056675">.</span><span class="ident" id="6056676">clear</span><span class="op" id="6056681">+</span><span class="num" id="6056682">1</span><span class="op" id="6056683">,</span>&nbsp;<span class="ident" id="6056685">d</span><span class="op" id="6056686">.</span><span class="ident" id="6056687">clear</span><span class="op" id="6056692">+</span><span class="num" id="6056693">1</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6056696">d</span><span class="op" id="6056697">.</span><span class="ident" id="6056698">overflow</span>&nbsp;<span class="op" id="6056707">=</span>&nbsp;<span class="builtintype" id="6056709">uint16</span><span class="op" id="6056715">(</span><span class="num" id="6056716">1</span><span class="op" id="6056717">)</span>&nbsp;<span class="op" id="6056719">&lt;&lt;</span>&nbsp;<span class="ident" id="6056722">d</span><span class="op" id="6056723">.</span><span class="ident" id="6056724">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6056731">d</span><span class="op" id="6056732">.</span><span class="ident" id="6056733">last</span>&nbsp;<span class="op" id="6056738">=</span>&nbsp;<span class="ident" id="6056740">decoderInvalidCode</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6056761">return</span>&nbsp;<span class="ident" id="6056768">d</span><br>
<span class="lineno"></span><span class="op" id="6056770">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
