<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5402437">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5402492">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5402546">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5402597">//&nbsp;Package&nbsp;jpeg&nbsp;implements&nbsp;a&nbsp;JPEG&nbsp;image&nbsp;decoder&nbsp;and&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="comment" id="5402658">//</span><br>
<span class="lineno"></span><span class="comment" id="5402661">//&nbsp;JPEG&nbsp;is&nbsp;defined&nbsp;in&nbsp;ITU-T&nbsp;T.81:&nbsp;http://www.w3.org/Graphics/JPEG/itu-t81.pdf.</span><br>
<span class="lineno"></span><span class="keyword" id="5402740">package</span>&nbsp;<span class="ident" id="5402748">jpeg</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="5402754">import</span>&nbsp;<span class="op" id="5402761">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5402764">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5402773">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5402788">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="5402793">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="5402796">//&nbsp;TODO(nigeltao):&nbsp;fix&nbsp;up&nbsp;the&nbsp;doc&nbsp;comment&nbsp;style&nbsp;so&nbsp;that&nbsp;sentences&nbsp;start&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="5402873">//&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;type&nbsp;or&nbsp;function&nbsp;that&nbsp;they&nbsp;annotate.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5402930">//&nbsp;A&nbsp;FormatError&nbsp;reports&nbsp;that&nbsp;the&nbsp;input&nbsp;is&nbsp;not&nbsp;a&nbsp;valid&nbsp;JPEG.</span><br>
<span class="lineno">20</span><span class="keyword" id="5402991">type</span>&nbsp;<span class="ident" id="5402996">FormatError</span>&nbsp;<span class="builtintype" id="5403008">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5403016">func</span>&nbsp;<span class="op" id="5403021">(</span><span class="ident" id="5403022">e</span>&nbsp;<span class="ident" id="5403024"><a href="/image/jpeg/reader.go.html#5402996">FormatError</a></span><span class="op" id="5403035">)</span>&nbsp;<span class="ident" id="5403037">Error</span><span class="op" id="5403042">(</span><span class="op" id="5403043">)</span>&nbsp;<span class="builtintype" id="5403045">string</span>&nbsp;<span class="op" id="5403052">{</span>&nbsp;<span class="keyword" id="5403054">return</span>&nbsp;<span class="string" id="5403061">&#34;invalid&nbsp;JPEG&nbsp;format:&nbsp;&#34;</span>&nbsp;<span class="op" id="5403085">+</span>&nbsp;<span class="builtintype" id="5403087">string</span><span class="op" id="5403093">(</span><span class="ident" id="5403094"><a href="/image/jpeg/reader.go.html#5403022">e</a></span><span class="op" id="5403095">)</span>&nbsp;<span class="op" id="5403097">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5403100">//&nbsp;An&nbsp;UnsupportedError&nbsp;reports&nbsp;that&nbsp;the&nbsp;input&nbsp;uses&nbsp;a&nbsp;valid&nbsp;but&nbsp;unimplemented&nbsp;JPEG&nbsp;feature.</span><br>
<span class="lineno">25</span><span class="keyword" id="5403191">type</span>&nbsp;<span class="ident" id="5403196">UnsupportedError</span>&nbsp;<span class="builtintype" id="5403213">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5403221">func</span>&nbsp;<span class="op" id="5403226">(</span><span class="ident" id="5403227">e</span>&nbsp;<span class="ident" id="5403229"><a href="/image/jpeg/reader.go.html#5403196">UnsupportedError</a></span><span class="op" id="5403245">)</span>&nbsp;<span class="ident" id="5403247">Error</span><span class="op" id="5403252">(</span><span class="op" id="5403253">)</span>&nbsp;<span class="builtintype" id="5403255">string</span>&nbsp;<span class="op" id="5403262">{</span>&nbsp;<span class="keyword" id="5403264">return</span>&nbsp;<span class="string" id="5403271">&#34;unsupported&nbsp;JPEG&nbsp;feature:&nbsp;&#34;</span>&nbsp;<span class="op" id="5403300">+</span>&nbsp;<span class="builtintype" id="5403302">string</span><span class="op" id="5403308">(</span><span class="ident" id="5403309"><a href="/image/jpeg/reader.go.html#5403227">e</a></span><span class="op" id="5403310">)</span>&nbsp;<span class="op" id="5403312">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5403315">//&nbsp;Component&nbsp;specification,&nbsp;specified&nbsp;in&nbsp;section&nbsp;B.2.2.</span><br>
<span class="lineno">30</span><span class="keyword" id="5403371">type</span>&nbsp;<span class="ident" id="5403376">component</span>&nbsp;<span class="keyword" id="5403386">struct</span>&nbsp;<span class="op" id="5403393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5403396">h</span>&nbsp;&nbsp;<span class="builtintype" id="5403399">int</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5403405">//&nbsp;Horizontal&nbsp;sampling&nbsp;factor.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5403437">v</span>&nbsp;&nbsp;<span class="builtintype" id="5403440">int</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5403446">//&nbsp;Vertical&nbsp;sampling&nbsp;factor.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5403476">c</span>&nbsp;&nbsp;<span class="builtintype" id="5403479">uint8</span>&nbsp;<span class="comment" id="5403485">//&nbsp;Component&nbsp;identifier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5403511">tq</span>&nbsp;<span class="builtintype" id="5403514">uint8</span>&nbsp;<span class="comment" id="5403520">//&nbsp;Quantization&nbsp;table&nbsp;destination&nbsp;selector.</span><br>
<span class="lineno">35</span><span class="op" id="5403564">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5403567">const</span>&nbsp;<span class="op" id="5403573">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5403576">dcTable</span>&nbsp;<span class="op" id="5403584">=</span>&nbsp;<span class="num" id="5403586">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5403589">acTable</span>&nbsp;<span class="op" id="5403597">=</span>&nbsp;<span class="num" id="5403599">1</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5403602">maxTc</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5403610">=</span>&nbsp;<span class="num" id="5403612">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5403615">maxTh</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5403623">=</span>&nbsp;<span class="num" id="5403625">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5403628">maxTq</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5403636">=</span>&nbsp;<span class="num" id="5403638">3</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5403642">//&nbsp;A&nbsp;grayscale&nbsp;JPEG&nbsp;image&nbsp;has&nbsp;only&nbsp;a&nbsp;Y&nbsp;component.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5403693">nGrayComponent</span>&nbsp;<span class="op" id="5403708">=</span>&nbsp;<span class="num" id="5403710">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5403713">//&nbsp;A&nbsp;color&nbsp;JPEG&nbsp;image&nbsp;has&nbsp;Y,&nbsp;Cb&nbsp;and&nbsp;Cr&nbsp;components.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5403765">nColorComponent</span>&nbsp;<span class="op" id="5403781">=</span>&nbsp;<span class="num" id="5403783">3</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5403787">//&nbsp;We&nbsp;only&nbsp;support&nbsp;4:4:4,&nbsp;4:4:0,&nbsp;4:2:2&nbsp;and&nbsp;4:2:0&nbsp;downsampling,&nbsp;and&nbsp;therefore&nbsp;the</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5403869">//&nbsp;number&nbsp;of&nbsp;luma&nbsp;samples&nbsp;per&nbsp;chroma&nbsp;sample&nbsp;is&nbsp;at&nbsp;most&nbsp;2&nbsp;in&nbsp;the&nbsp;horizontal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5403945">//&nbsp;and&nbsp;2&nbsp;in&nbsp;the&nbsp;vertical&nbsp;direction.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5403982">maxH</span>&nbsp;<span class="op" id="5403987">=</span>&nbsp;<span class="num" id="5403989">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5403992">maxV</span>&nbsp;<span class="op" id="5403997">=</span>&nbsp;<span class="num" id="5403999">2</span><br>
<span class="lineno"></span><span class="op" id="5404001">)</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="keyword" id="5404004">const</span>&nbsp;<span class="op" id="5404010">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5404013">soiMarker</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5404025">=</span>&nbsp;<span class="num" id="5404027">0xd8</span>&nbsp;<span class="comment" id="5404032">//&nbsp;Start&nbsp;Of&nbsp;Image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5404052">eoiMarker</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5404064">=</span>&nbsp;<span class="num" id="5404066">0xd9</span>&nbsp;<span class="comment" id="5404071">//&nbsp;End&nbsp;Of&nbsp;Image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5404089">sof0Marker</span>&nbsp;&nbsp;<span class="op" id="5404101">=</span>&nbsp;<span class="num" id="5404103">0xc0</span>&nbsp;<span class="comment" id="5404108">//&nbsp;Start&nbsp;Of&nbsp;Frame&nbsp;(Baseline).</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5404139">sof2Marker</span>&nbsp;&nbsp;<span class="op" id="5404151">=</span>&nbsp;<span class="num" id="5404153">0xc2</span>&nbsp;<span class="comment" id="5404158">//&nbsp;Start&nbsp;Of&nbsp;Frame&nbsp;(Progressive).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5404192">dhtMarker</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5404204">=</span>&nbsp;<span class="num" id="5404206">0xc4</span>&nbsp;<span class="comment" id="5404211">//&nbsp;Define&nbsp;Huffman&nbsp;Table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5404237">dqtMarker</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5404249">=</span>&nbsp;<span class="num" id="5404251">0xdb</span>&nbsp;<span class="comment" id="5404256">//&nbsp;Define&nbsp;Quantization&nbsp;Table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5404287">sosMarker</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5404299">=</span>&nbsp;<span class="num" id="5404301">0xda</span>&nbsp;<span class="comment" id="5404306">//&nbsp;Start&nbsp;Of&nbsp;Scan.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5404325">driMarker</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5404337">=</span>&nbsp;<span class="num" id="5404339">0xdd</span>&nbsp;<span class="comment" id="5404344">//&nbsp;Define&nbsp;Restart&nbsp;Interval.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5404373">rst0Marker</span>&nbsp;&nbsp;<span class="op" id="5404385">=</span>&nbsp;<span class="num" id="5404387">0xd0</span>&nbsp;<span class="comment" id="5404392">//&nbsp;ReSTart&nbsp;(0).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5404409">rst7Marker</span>&nbsp;&nbsp;<span class="op" id="5404421">=</span>&nbsp;<span class="num" id="5404423">0xd7</span>&nbsp;<span class="comment" id="5404428">//&nbsp;ReSTart&nbsp;(7).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5404445">app0Marker</span>&nbsp;&nbsp;<span class="op" id="5404457">=</span>&nbsp;<span class="num" id="5404459">0xe0</span>&nbsp;<span class="comment" id="5404464">//&nbsp;APPlication&nbsp;specific&nbsp;(0).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5404494">app15Marker</span>&nbsp;<span class="op" id="5404506">=</span>&nbsp;<span class="num" id="5404508">0xef</span>&nbsp;<span class="comment" id="5404513">//&nbsp;APPlication&nbsp;specific&nbsp;(15).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5404544">comMarker</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5404556">=</span>&nbsp;<span class="num" id="5404558">0xfe</span>&nbsp;<span class="comment" id="5404563">//&nbsp;COMment.</span><br>
<span class="lineno">70</span><span class="op" id="5404575">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5404578">//&nbsp;unzig&nbsp;maps&nbsp;from&nbsp;the&nbsp;zig-zag&nbsp;ordering&nbsp;to&nbsp;the&nbsp;natural&nbsp;ordering.&nbsp;For&nbsp;example,</span><br>
<span class="lineno"></span><span class="comment" id="5404656">//&nbsp;unzig[3]&nbsp;is&nbsp;the&nbsp;column&nbsp;and&nbsp;row&nbsp;of&nbsp;the&nbsp;fourth&nbsp;element&nbsp;in&nbsp;zig-zag&nbsp;order.&nbsp;The</span><br>
<span class="lineno"></span><span class="comment" id="5404734">//&nbsp;value&nbsp;is&nbsp;16,&nbsp;which&nbsp;means&nbsp;first&nbsp;column&nbsp;(16%8&nbsp;==&nbsp;0)&nbsp;and&nbsp;third&nbsp;row&nbsp;(16/8&nbsp;==&nbsp;2).</span><br>
<span class="lineno">75</span><span class="keyword" id="5404814">var</span>&nbsp;<span class="ident" id="5404818">unzig</span>&nbsp;<span class="op" id="5404824">=</span>&nbsp;<span class="op" id="5404826">[</span><span class="ident" id="5404827"><a href="/image/jpeg/idct.go.html#5398910">blockSize</a></span><span class="op" id="5404836">]</span><span class="builtintype" id="5404837">int</span><span class="op" id="5404840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5404843">0</span><span class="op" id="5404844">,</span>&nbsp;<span class="num" id="5404846">1</span><span class="op" id="5404847">,</span>&nbsp;<span class="num" id="5404849">8</span><span class="op" id="5404850">,</span>&nbsp;<span class="num" id="5404852">16</span><span class="op" id="5404854">,</span>&nbsp;<span class="num" id="5404856">9</span><span class="op" id="5404857">,</span>&nbsp;<span class="num" id="5404859">2</span><span class="op" id="5404860">,</span>&nbsp;<span class="num" id="5404862">3</span><span class="op" id="5404863">,</span>&nbsp;<span class="num" id="5404865">10</span><span class="op" id="5404867">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5404870">17</span><span class="op" id="5404872">,</span>&nbsp;<span class="num" id="5404874">24</span><span class="op" id="5404876">,</span>&nbsp;<span class="num" id="5404878">32</span><span class="op" id="5404880">,</span>&nbsp;<span class="num" id="5404882">25</span><span class="op" id="5404884">,</span>&nbsp;<span class="num" id="5404886">18</span><span class="op" id="5404888">,</span>&nbsp;<span class="num" id="5404890">11</span><span class="op" id="5404892">,</span>&nbsp;<span class="num" id="5404894">4</span><span class="op" id="5404895">,</span>&nbsp;<span class="num" id="5404897">5</span><span class="op" id="5404898">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5404901">12</span><span class="op" id="5404903">,</span>&nbsp;<span class="num" id="5404905">19</span><span class="op" id="5404907">,</span>&nbsp;<span class="num" id="5404909">26</span><span class="op" id="5404911">,</span>&nbsp;<span class="num" id="5404913">33</span><span class="op" id="5404915">,</span>&nbsp;<span class="num" id="5404917">40</span><span class="op" id="5404919">,</span>&nbsp;<span class="num" id="5404921">48</span><span class="op" id="5404923">,</span>&nbsp;<span class="num" id="5404925">41</span><span class="op" id="5404927">,</span>&nbsp;<span class="num" id="5404929">34</span><span class="op" id="5404931">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5404934">27</span><span class="op" id="5404936">,</span>&nbsp;<span class="num" id="5404938">20</span><span class="op" id="5404940">,</span>&nbsp;<span class="num" id="5404942">13</span><span class="op" id="5404944">,</span>&nbsp;<span class="num" id="5404946">6</span><span class="op" id="5404947">,</span>&nbsp;<span class="num" id="5404949">7</span><span class="op" id="5404950">,</span>&nbsp;<span class="num" id="5404952">14</span><span class="op" id="5404954">,</span>&nbsp;<span class="num" id="5404956">21</span><span class="op" id="5404958">,</span>&nbsp;<span class="num" id="5404960">28</span><span class="op" id="5404962">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5404965">35</span><span class="op" id="5404967">,</span>&nbsp;<span class="num" id="5404969">42</span><span class="op" id="5404971">,</span>&nbsp;<span class="num" id="5404973">49</span><span class="op" id="5404975">,</span>&nbsp;<span class="num" id="5404977">56</span><span class="op" id="5404979">,</span>&nbsp;<span class="num" id="5404981">57</span><span class="op" id="5404983">,</span>&nbsp;<span class="num" id="5404985">50</span><span class="op" id="5404987">,</span>&nbsp;<span class="num" id="5404989">43</span><span class="op" id="5404991">,</span>&nbsp;<span class="num" id="5404993">36</span><span class="op" id="5404995">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5404998">29</span><span class="op" id="5405000">,</span>&nbsp;<span class="num" id="5405002">22</span><span class="op" id="5405004">,</span>&nbsp;<span class="num" id="5405006">15</span><span class="op" id="5405008">,</span>&nbsp;<span class="num" id="5405010">23</span><span class="op" id="5405012">,</span>&nbsp;<span class="num" id="5405014">30</span><span class="op" id="5405016">,</span>&nbsp;<span class="num" id="5405018">37</span><span class="op" id="5405020">,</span>&nbsp;<span class="num" id="5405022">44</span><span class="op" id="5405024">,</span>&nbsp;<span class="num" id="5405026">51</span><span class="op" id="5405028">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5405031">58</span><span class="op" id="5405033">,</span>&nbsp;<span class="num" id="5405035">59</span><span class="op" id="5405037">,</span>&nbsp;<span class="num" id="5405039">52</span><span class="op" id="5405041">,</span>&nbsp;<span class="num" id="5405043">45</span><span class="op" id="5405045">,</span>&nbsp;<span class="num" id="5405047">38</span><span class="op" id="5405049">,</span>&nbsp;<span class="num" id="5405051">31</span><span class="op" id="5405053">,</span>&nbsp;<span class="num" id="5405055">39</span><span class="op" id="5405057">,</span>&nbsp;<span class="num" id="5405059">46</span><span class="op" id="5405061">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5405064">53</span><span class="op" id="5405066">,</span>&nbsp;<span class="num" id="5405068">60</span><span class="op" id="5405070">,</span>&nbsp;<span class="num" id="5405072">61</span><span class="op" id="5405074">,</span>&nbsp;<span class="num" id="5405076">54</span><span class="op" id="5405078">,</span>&nbsp;<span class="num" id="5405080">47</span><span class="op" id="5405082">,</span>&nbsp;<span class="num" id="5405084">55</span><span class="op" id="5405086">,</span>&nbsp;<span class="num" id="5405088">62</span><span class="op" id="5405090">,</span>&nbsp;<span class="num" id="5405092">63</span><span class="op" id="5405094">,</span><br>
<span class="lineno"></span><span class="op" id="5405096">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="5405099">//&nbsp;Reader&nbsp;is&nbsp;deprecated.</span><br>
<span class="lineno"></span><span class="keyword" id="5405124">type</span>&nbsp;<span class="ident" id="5405129">Reader</span>&nbsp;<span class="keyword" id="5405136">interface</span>&nbsp;<span class="op" id="5405146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5405149"><a href="/image/jpeg/reader.go.html#5402788">io</a></span><span class="op" id="5405151">.</span><span class="ident" id="5405152">ByteReader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5405164"><a href="/image/jpeg/reader.go.html#5402788">io</a></span><span class="op" id="5405166">.</span><span class="ident" id="5405167">Reader</span><br>
<span class="lineno">90</span><span class="op" id="5405174">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5405177">//&nbsp;bits&nbsp;holds&nbsp;the&nbsp;unprocessed&nbsp;bits&nbsp;that&nbsp;have&nbsp;been&nbsp;taken&nbsp;from&nbsp;the&nbsp;byte-stream.</span><br>
<span class="lineno"></span><span class="comment" id="5405255">//&nbsp;The&nbsp;n&nbsp;least&nbsp;significant&nbsp;bits&nbsp;of&nbsp;a&nbsp;form&nbsp;the&nbsp;unread&nbsp;bits,&nbsp;to&nbsp;be&nbsp;read&nbsp;in&nbsp;MSB&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5405335">//&nbsp;LSB&nbsp;order.</span><br>
<span class="lineno">95</span><span class="keyword" id="5405349">type</span>&nbsp;<span class="ident" id="5405354">bits</span>&nbsp;<span class="keyword" id="5405359">struct</span>&nbsp;<span class="op" id="5405366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5405369">a</span>&nbsp;<span class="builtintype" id="5405371">uint32</span>&nbsp;<span class="comment" id="5405378">//&nbsp;accumulator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5405395">m</span>&nbsp;<span class="builtintype" id="5405397">uint32</span>&nbsp;<span class="comment" id="5405404">//&nbsp;mask.&nbsp;m==1&lt;&lt;(n-1)&nbsp;when&nbsp;n&gt;0,&nbsp;with&nbsp;m==0&nbsp;when&nbsp;n==0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5405457">n</span>&nbsp;<span class="builtintype" id="5405459">int32</span>&nbsp;&nbsp;<span class="comment" id="5405466">//&nbsp;the&nbsp;number&nbsp;of&nbsp;unread&nbsp;bits&nbsp;in&nbsp;a.</span><br>
<span class="lineno"></span><span class="op" id="5405501">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="keyword" id="5405504">type</span>&nbsp;<span class="ident" id="5405509">decoder</span>&nbsp;<span class="keyword" id="5405517">struct</span>&nbsp;<span class="op" id="5405524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5405527">r</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5405532"><a href="/image/jpeg/reader.go.html#5402788">io</a></span><span class="op" id="5405534">.</span><span class="ident" id="5405535">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5405543">bits</span>&nbsp;<span class="ident" id="5405548"><a href="/image/jpeg/reader.go.html#5405354">bits</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5405554">//&nbsp;bytes&nbsp;is&nbsp;a&nbsp;byte&nbsp;buffer,&nbsp;similar&nbsp;to&nbsp;a&nbsp;bufio.Reader,&nbsp;except&nbsp;that&nbsp;it</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5405624">//&nbsp;has&nbsp;to&nbsp;be&nbsp;able&nbsp;to&nbsp;unread&nbsp;more&nbsp;than&nbsp;1&nbsp;byte,&nbsp;due&nbsp;to&nbsp;byte&nbsp;stuffing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5405693">//&nbsp;Byte&nbsp;stuffing&nbsp;is&nbsp;specified&nbsp;in&nbsp;section&nbsp;F.1.2.3.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5405744">bytes</span>&nbsp;<span class="keyword" id="5405750">struct</span>&nbsp;<span class="op" id="5405757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5405761">//&nbsp;buf[i:j]&nbsp;are&nbsp;the&nbsp;buffered&nbsp;bytes&nbsp;read&nbsp;from&nbsp;the&nbsp;underlying</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5405823">//&nbsp;io.Reader&nbsp;that&nbsp;haven&#39;t&nbsp;yet&nbsp;been&nbsp;passed&nbsp;further&nbsp;on.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5405879">buf</span>&nbsp;&nbsp;<span class="op" id="5405884">[</span><span class="num" id="5405885">4096</span><span class="op" id="5405889">]</span><span class="builtintype" id="5405890">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5405897">i</span><span class="op" id="5405898">,</span>&nbsp;<span class="ident" id="5405900">j</span>&nbsp;<span class="builtintype" id="5405902">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5405908">//&nbsp;nUnreadable&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;to&nbsp;back&nbsp;up&nbsp;i&nbsp;after</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5405967">//&nbsp;overshooting.&nbsp;It&nbsp;can&nbsp;be&nbsp;0,&nbsp;1&nbsp;or&nbsp;2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5406007">nUnreadable</span>&nbsp;<span class="builtintype" id="5406019">int</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5406024">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5406027">width</span><span class="op" id="5406032">,</span>&nbsp;<span class="ident" id="5406034">height</span>&nbsp;<span class="builtintype" id="5406041">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5406046">img1</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5406060">*</span><span class="ident" id="5406061"><a href="/image/jpeg/reader.go.html#5402764">image</a></span><span class="op" id="5406066">.</span><span class="ident" id="5406067">Gray</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5406073">img3</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5406087">*</span><span class="ident" id="5406088"><a href="/image/jpeg/reader.go.html#5402764">image</a></span><span class="op" id="5406093">.</span><span class="ident" id="5406094">YCbCr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5406101">ri</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5406115">int</span>&nbsp;<span class="comment" id="5406119">//&nbsp;Restart&nbsp;Interval.</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5406141">nComp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5406155">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5406160">progressive</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5406174">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5406180">eobRun</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5406194">uint16</span>&nbsp;<span class="comment" id="5406201">//&nbsp;End-of-Band&nbsp;run,&nbsp;specified&nbsp;in&nbsp;section&nbsp;G.1.2.2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5406252">comp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5406266">[</span><span class="ident" id="5406267"><a href="/image/jpeg/reader.go.html#5403765">nColorComponent</a></span><span class="op" id="5406282">]</span><span class="ident" id="5406283"><a href="/image/jpeg/reader.go.html#5403376">component</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5406294">progCoeffs</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5406308">[</span><span class="ident" id="5406309"><a href="/image/jpeg/reader.go.html#5403765">nColorComponent</a></span><span class="op" id="5406324">]</span><span class="op" id="5406325">[</span><span class="op" id="5406326">]</span><span class="ident" id="5406327"><a href="/image/jpeg/idct.go.html#5398954">block</a></span>&nbsp;<span class="comment" id="5406333">//&nbsp;Saved&nbsp;state&nbsp;between&nbsp;progressive-mode&nbsp;scans.</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5406381">huff</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5406395">[</span><span class="ident" id="5406396"><a href="/image/jpeg/reader.go.html#5403602">maxTc</a></span>&nbsp;<span class="op" id="5406402">+</span>&nbsp;<span class="num" id="5406404">1</span><span class="op" id="5406405">]</span><span class="op" id="5406406">[</span><span class="ident" id="5406407"><a href="/image/jpeg/reader.go.html#5403615">maxTh</a></span>&nbsp;<span class="op" id="5406413">+</span>&nbsp;<span class="num" id="5406415">1</span><span class="op" id="5406416">]</span><span class="ident" id="5406417"><a href="/image/jpeg/huffman.go.html#5391520">huffman</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5406426">quant</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5406440">[</span><span class="ident" id="5406441"><a href="/image/jpeg/reader.go.html#5403628">maxTq</a></span>&nbsp;<span class="op" id="5406447">+</span>&nbsp;<span class="num" id="5406449">1</span><span class="op" id="5406450">]</span><span class="ident" id="5406451"><a href="/image/jpeg/idct.go.html#5398954">block</a></span>&nbsp;<span class="comment" id="5406457">//&nbsp;Quantization&nbsp;tables,&nbsp;in&nbsp;zig-zag&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5406500">tmp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5406514">[</span><span class="ident" id="5406515"><a href="/image/jpeg/idct.go.html#5398910">blockSize</a></span>&nbsp;<span class="op" id="5406525">+</span>&nbsp;<span class="num" id="5406527">1</span><span class="op" id="5406528">]</span><span class="builtintype" id="5406529">byte</span><br>
<span class="lineno"></span><span class="op" id="5406534">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="5406537">//&nbsp;fill&nbsp;fills&nbsp;up&nbsp;the&nbsp;d.bytes.buf&nbsp;buffer&nbsp;from&nbsp;the&nbsp;underlying&nbsp;io.Reader.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="5406611">//&nbsp;should&nbsp;only&nbsp;be&nbsp;called&nbsp;when&nbsp;there&nbsp;are&nbsp;no&nbsp;unread&nbsp;bytes&nbsp;in&nbsp;d.bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="5406679">func</span>&nbsp;<span class="op" id="5406684">(</span><span class="ident" id="5406685">d</span>&nbsp;<span class="op" id="5406687">*</span><span class="ident" id="5406688"><a href="/image/jpeg/reader.go.html#5405509">decoder</a></span><span class="op" id="5406695">)</span>&nbsp;<span class="ident" id="5406697">fill</span><span class="op" id="5406701">(</span><span class="op" id="5406702">)</span>&nbsp;<span class="builtintype" id="5406704">error</span>&nbsp;<span class="op" id="5406710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5406713">if</span>&nbsp;<span class="ident" id="5406716"><a href="/image/jpeg/reader.go.html#5406685">d</a></span><span class="op" id="5406717">.</span><span class="ident" id="5406718">bytes</span><span class="op" id="5406723">.</span><span class="ident" id="5406724">i</span>&nbsp;<span class="op" id="5406726">!=</span>&nbsp;<span class="ident" id="5406729"><a href="/image/jpeg/reader.go.html#5406685">d</a></span><span class="op" id="5406730">.</span><span class="ident" id="5406731">bytes</span><span class="op" id="5406736">.</span><span class="ident" id="5406737">j</span>&nbsp;<span class="op" id="5406739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5406743">panic</span><span class="op" id="5406748">(</span><span class="string" id="5406749">&#34;jpeg:&nbsp;fill&nbsp;called&nbsp;when&nbsp;unread&nbsp;bytes&nbsp;exist&#34;</span><span class="op" id="5406792">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5406795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5406798">//&nbsp;Move&nbsp;the&nbsp;last&nbsp;2&nbsp;bytes&nbsp;to&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;buffer,&nbsp;in&nbsp;case&nbsp;we&nbsp;need</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5406868">//&nbsp;to&nbsp;call&nbsp;unreadByteStuffedByte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5406903">if</span>&nbsp;<span class="ident" id="5406906"><a href="/image/jpeg/reader.go.html#5406685">d</a></span><span class="op" id="5406907">.</span><span class="ident" id="5406908">bytes</span><span class="op" id="5406913">.</span><span class="ident" id="5406914">j</span>&nbsp;<span class="op" id="5406916">&gt;</span>&nbsp;<span class="num" id="5406918">2</span>&nbsp;<span class="op" id="5406920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5406924"><a href="/image/jpeg/reader.go.html#5406685">d</a></span><span class="op" id="5406925">.</span><span class="ident" id="5406926">bytes</span><span class="op" id="5406931">.</span><span class="ident" id="5406932">buf</span><span class="op" id="5406935">[</span><span class="num" id="5406936">0</span><span class="op" id="5406937">]</span>&nbsp;<span class="op" id="5406939">=</span>&nbsp;<span class="ident" id="5406941"><a href="/image/jpeg/reader.go.html#5406685">d</a></span><span class="op" id="5406942">.</span><span class="ident" id="5406943">bytes</span><span class="op" id="5406948">.</span><span class="ident" id="5406949">buf</span><span class="op" id="5406952">[</span><span class="ident" id="5406953"><a href="/image/jpeg/reader.go.html#5406685">d</a></span><span class="op" id="5406954">.</span><span class="ident" id="5406955">bytes</span><span class="op" id="5406960">.</span><span class="ident" id="5406961">j</span><span class="op" id="5406962">-</span><span class="num" id="5406963">2</span><span class="op" id="5406964">]</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5406968"><a href="/image/jpeg/reader.go.html#5406685">d</a></span><span class="op" id="5406969">.</span><span class="ident" id="5406970">bytes</span><span class="op" id="5406975">.</span><span class="ident" id="5406976">buf</span><span class="op" id="5406979">[</span><span class="num" id="5406980">1</span><span class="op" id="5406981">]</span>&nbsp;<span class="op" id="5406983">=</span>&nbsp;<span class="ident" id="5406985"><a href="/image/jpeg/reader.go.html#5406685">d</a></span><span class="op" id="5406986">.</span><span class="ident" id="5406987">bytes</span><span class="op" id="5406992">.</span><span class="ident" id="5406993">buf</span><span class="op" id="5406996">[</span><span class="ident" id="5406997"><a href="/image/jpeg/reader.go.html#5406685">d</a></span><span class="op" id="5406998">.</span><span class="ident" id="5406999">bytes</span><span class="op" id="5407004">.</span><span class="ident" id="5407005">j</span><span class="op" id="5407006">-</span><span class="num" id="5407007">1</span><span class="op" id="5407008">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5407012"><a href="/image/jpeg/reader.go.html#5406685">d</a></span><span class="op" id="5407013">.</span><span class="ident" id="5407014">bytes</span><span class="op" id="5407019">.</span><span class="ident" id="5407020">i</span><span class="op" id="5407021">,</span>&nbsp;<span class="ident" id="5407023"><a href="/image/jpeg/reader.go.html#5406685">d</a></span><span class="op" id="5407024">.</span><span class="ident" id="5407025">bytes</span><span class="op" id="5407030">.</span><span class="ident" id="5407031">j</span>&nbsp;<span class="op" id="5407033">=</span>&nbsp;<span class="num" id="5407035">2</span><span class="op" id="5407036">,</span>&nbsp;<span class="num" id="5407038">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5407041">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5407044">//&nbsp;Fill&nbsp;in&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5407080">n</span><span class="op" id="5407081">,</span>&nbsp;<span class="ident" id="5407083">err</span>&nbsp;<span class="op" id="5407087">:=</span>&nbsp;<span class="ident" id="5407090"><a href="/image/jpeg/reader.go.html#5406685">d</a></span><span class="op" id="5407091">.</span><span class="ident" id="5407092">r</span><span class="op" id="5407093">.</span><span class="ident" id="5407094">Read</span><span class="op" id="5407098">(</span><span class="ident" id="5407099"><a href="/image/jpeg/reader.go.html#5406685">d</a></span><span class="op" id="5407100">.</span><span class="ident" id="5407101">bytes</span><span class="op" id="5407106">.</span><span class="ident" id="5407107">buf</span><span class="op" id="5407110">[</span><span class="ident" id="5407111"><a href="/image/jpeg/reader.go.html#5406685">d</a></span><span class="op" id="5407112">.</span><span class="ident" id="5407113">bytes</span><span class="op" id="5407118">.</span><span class="ident" id="5407119">j</span><span class="op" id="5407120">:</span><span class="op" id="5407121">]</span><span class="op" id="5407122">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5407125"><a href="/image/jpeg/reader.go.html#5406685">d</a></span><span class="op" id="5407126">.</span><span class="ident" id="5407127">bytes</span><span class="op" id="5407132">.</span><span class="ident" id="5407133">j</span>&nbsp;<span class="op" id="5407135">+=</span>&nbsp;<span class="ident" id="5407138"><a href="/image/jpeg/reader.go.html#5407080">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5407141">if</span>&nbsp;<span class="ident" id="5407144"><a href="/image/jpeg/reader.go.html#5407080">n</a></span>&nbsp;<span class="op" id="5407146">&gt;</span>&nbsp;<span class="num" id="5407148">0</span>&nbsp;<span class="op" id="5407150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5407154"><a href="/image/jpeg/reader.go.html#5407083">err</a></span>&nbsp;<span class="op" id="5407158">=</span>&nbsp;<span class="ident" id="5407160">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5407165">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5407168">return</span>&nbsp;<span class="ident" id="5407175"><a href="/image/jpeg/reader.go.html#5407083">err</a></span><br>
<span class="lineno">150</span><span class="op" id="5407179">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5407182">//&nbsp;unreadByteStuffedByte&nbsp;undoes&nbsp;the&nbsp;most&nbsp;recent&nbsp;readByteStuffedByte&nbsp;call,</span><br>
<span class="lineno"></span><span class="comment" id="5407256">//&nbsp;giving&nbsp;a&nbsp;byte&nbsp;of&nbsp;data&nbsp;back&nbsp;from&nbsp;d.bits&nbsp;to&nbsp;d.bytes.&nbsp;The&nbsp;Huffman&nbsp;look-up&nbsp;table</span><br>
<span class="lineno"></span><span class="comment" id="5407336">//&nbsp;requires&nbsp;at&nbsp;least&nbsp;8&nbsp;bits&nbsp;for&nbsp;look-up,&nbsp;which&nbsp;means&nbsp;that&nbsp;Huffman&nbsp;decoding&nbsp;can</span><br>
<span class="lineno">155</span><span class="comment" id="5407415">//&nbsp;sometimes&nbsp;overshoot&nbsp;and&nbsp;read&nbsp;one&nbsp;or&nbsp;two&nbsp;too&nbsp;many&nbsp;bytes.&nbsp;Two-byte&nbsp;overshoot</span><br>
<span class="lineno"></span><span class="comment" id="5407493">//&nbsp;can&nbsp;happen&nbsp;when&nbsp;expecting&nbsp;to&nbsp;read&nbsp;a&nbsp;0xff&nbsp;0x00&nbsp;byte-stuffed&nbsp;byte.</span><br>
<span class="lineno"></span><span class="keyword" id="5407561">func</span>&nbsp;<span class="op" id="5407566">(</span><span class="ident" id="5407567">d</span>&nbsp;<span class="op" id="5407569">*</span><span class="ident" id="5407570"><a href="/image/jpeg/reader.go.html#5405509">decoder</a></span><span class="op" id="5407577">)</span>&nbsp;<span class="ident" id="5407579">unreadByteStuffedByte</span><span class="op" id="5407600">(</span><span class="op" id="5407601">)</span>&nbsp;<span class="op" id="5407603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5407606">if</span>&nbsp;<span class="ident" id="5407609"><a href="/image/jpeg/reader.go.html#5407567">d</a></span><span class="op" id="5407610">.</span><span class="ident" id="5407611">bytes</span><span class="op" id="5407616">.</span><span class="ident" id="5407617">nUnreadable</span>&nbsp;<span class="op" id="5407629">==</span>&nbsp;<span class="num" id="5407632">0</span>&nbsp;<span class="op" id="5407634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5407638">panic</span><span class="op" id="5407643">(</span><span class="string" id="5407644">&#34;jpeg:&nbsp;unreadByteStuffedByte&nbsp;call&nbsp;cannot&nbsp;be&nbsp;fulfilled&#34;</span><span class="op" id="5407698">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5407701">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5407704"><a href="/image/jpeg/reader.go.html#5407567">d</a></span><span class="op" id="5407705">.</span><span class="ident" id="5407706">bytes</span><span class="op" id="5407711">.</span><span class="ident" id="5407712">i</span>&nbsp;<span class="op" id="5407714">-=</span>&nbsp;<span class="ident" id="5407717"><a href="/image/jpeg/reader.go.html#5407567">d</a></span><span class="op" id="5407718">.</span><span class="ident" id="5407719">bytes</span><span class="op" id="5407724">.</span><span class="ident" id="5407725">nUnreadable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5407738"><a href="/image/jpeg/reader.go.html#5407567">d</a></span><span class="op" id="5407739">.</span><span class="ident" id="5407740">bytes</span><span class="op" id="5407745">.</span><span class="ident" id="5407746">nUnreadable</span>&nbsp;<span class="op" id="5407758">=</span>&nbsp;<span class="num" id="5407760">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5407763">if</span>&nbsp;<span class="ident" id="5407766"><a href="/image/jpeg/reader.go.html#5407567">d</a></span><span class="op" id="5407767">.</span><span class="ident" id="5407768">bits</span><span class="op" id="5407772">.</span><span class="ident" id="5407773">n</span>&nbsp;<span class="op" id="5407775">&gt;=</span>&nbsp;<span class="num" id="5407778">8</span>&nbsp;<span class="op" id="5407780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5407784"><a href="/image/jpeg/reader.go.html#5407567">d</a></span><span class="op" id="5407785">.</span><span class="ident" id="5407786">bits</span><span class="op" id="5407790">.</span><span class="ident" id="5407791">a</span>&nbsp;<span class="op" id="5407793">&gt;&gt;=</span>&nbsp;<span class="num" id="5407797">8</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5407801"><a href="/image/jpeg/reader.go.html#5407567">d</a></span><span class="op" id="5407802">.</span><span class="ident" id="5407803">bits</span><span class="op" id="5407807">.</span><span class="ident" id="5407808">n</span>&nbsp;<span class="op" id="5407810">-=</span>&nbsp;<span class="num" id="5407813">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5407817"><a href="/image/jpeg/reader.go.html#5407567">d</a></span><span class="op" id="5407818">.</span><span class="ident" id="5407819">bits</span><span class="op" id="5407823">.</span><span class="ident" id="5407824">m</span>&nbsp;<span class="op" id="5407826">&gt;&gt;=</span>&nbsp;<span class="num" id="5407830">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5407833">}</span><br>
<span class="lineno"></span><span class="op" id="5407835">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="comment" id="5407838">//&nbsp;readByte&nbsp;returns&nbsp;the&nbsp;next&nbsp;byte,&nbsp;whether&nbsp;buffered&nbsp;or&nbsp;not&nbsp;buffered.&nbsp;It&nbsp;does</span><br>
<span class="lineno"></span><span class="comment" id="5407915">//&nbsp;not&nbsp;care&nbsp;about&nbsp;byte&nbsp;stuffing.</span><br>
<span class="lineno"></span><span class="keyword" id="5407948">func</span>&nbsp;<span class="op" id="5407953">(</span><span class="ident" id="5407954">d</span>&nbsp;<span class="op" id="5407956">*</span><span class="ident" id="5407957"><a href="/image/jpeg/reader.go.html#5405509">decoder</a></span><span class="op" id="5407964">)</span>&nbsp;<span class="ident" id="5407966">readByte</span><span class="op" id="5407974">(</span><span class="op" id="5407975">)</span>&nbsp;<span class="op" id="5407977">(</span><span class="ident" id="5407978">x</span>&nbsp;<span class="builtintype" id="5407980">byte</span><span class="op" id="5407984">,</span>&nbsp;<span class="ident" id="5407986">err</span>&nbsp;<span class="builtintype" id="5407990">error</span><span class="op" id="5407995">)</span>&nbsp;<span class="op" id="5407997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5408000">for</span>&nbsp;<span class="ident" id="5408004"><a href="/image/jpeg/reader.go.html#5407954">d</a></span><span class="op" id="5408005">.</span><span class="ident" id="5408006">bytes</span><span class="op" id="5408011">.</span><span class="ident" id="5408012">i</span>&nbsp;<span class="op" id="5408014">==</span>&nbsp;<span class="ident" id="5408017"><a href="/image/jpeg/reader.go.html#5407954">d</a></span><span class="op" id="5408018">.</span><span class="ident" id="5408019">bytes</span><span class="op" id="5408024">.</span><span class="ident" id="5408025">j</span>&nbsp;<span class="op" id="5408027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5408031">if</span>&nbsp;<span class="ident" id="5408034"><a href="/image/jpeg/reader.go.html#5407986">err</a></span>&nbsp;<span class="op" id="5408038">=</span>&nbsp;<span class="ident" id="5408040"><a href="/image/jpeg/reader.go.html#5407954">d</a></span><span class="op" id="5408041">.</span><span class="ident" id="5408042">fill</span><span class="op" id="5408046">(</span><span class="op" id="5408047">)</span><span class="op" id="5408048">;</span>&nbsp;<span class="ident" id="5408050"><a href="/image/jpeg/reader.go.html#5407986">err</a></span>&nbsp;<span class="op" id="5408054">!=</span>&nbsp;<span class="ident" id="5408057">nil</span>&nbsp;<span class="op" id="5408061">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5408066">return</span>&nbsp;<span class="num" id="5408073">0</span><span class="op" id="5408074">,</span>&nbsp;<span class="ident" id="5408076"><a href="/image/jpeg/reader.go.html#5407986">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5408082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5408085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5408088"><a href="/image/jpeg/reader.go.html#5407978">x</a></span>&nbsp;<span class="op" id="5408090">=</span>&nbsp;<span class="ident" id="5408092"><a href="/image/jpeg/reader.go.html#5407954">d</a></span><span class="op" id="5408093">.</span><span class="ident" id="5408094">bytes</span><span class="op" id="5408099">.</span><span class="ident" id="5408100">buf</span><span class="op" id="5408103">[</span><span class="ident" id="5408104"><a href="/image/jpeg/reader.go.html#5407954">d</a></span><span class="op" id="5408105">.</span><span class="ident" id="5408106">bytes</span><span class="op" id="5408111">.</span><span class="ident" id="5408112">i</span><span class="op" id="5408113">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5408116"><a href="/image/jpeg/reader.go.html#5407954">d</a></span><span class="op" id="5408117">.</span><span class="ident" id="5408118">bytes</span><span class="op" id="5408123">.</span><span class="ident" id="5408124">i</span><span class="op" id="5408125">++</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5408129"><a href="/image/jpeg/reader.go.html#5407954">d</a></span><span class="op" id="5408130">.</span><span class="ident" id="5408131">bytes</span><span class="op" id="5408136">.</span><span class="ident" id="5408137">nUnreadable</span>&nbsp;<span class="op" id="5408149">=</span>&nbsp;<span class="num" id="5408151">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5408154">return</span>&nbsp;<span class="ident" id="5408161"><a href="/image/jpeg/reader.go.html#5407978">x</a></span><span class="op" id="5408162">,</span>&nbsp;<span class="ident" id="5408164">nil</span><br>
<span class="lineno"></span><span class="op" id="5408168">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5408171">//&nbsp;errMissingFF00&nbsp;means&nbsp;that&nbsp;readByteStuffedByte&nbsp;encountered&nbsp;an&nbsp;0xff&nbsp;byte&nbsp;(a</span><br>
<span class="lineno">185</span><span class="comment" id="5408248">//&nbsp;marker&nbsp;byte)&nbsp;that&nbsp;wasn&#39;t&nbsp;the&nbsp;expected&nbsp;byte-stuffed&nbsp;sequence&nbsp;0xff,&nbsp;0x00.</span><br>
<span class="lineno"></span><span class="keyword" id="5408323">var</span>&nbsp;<span class="ident" id="5408327">errMissingFF00</span>&nbsp;<span class="op" id="5408342">=</span>&nbsp;<span class="ident" id="5408344"><a href="/image/jpeg/reader.go.html#5402996">FormatError</a></span><span class="op" id="5408355">(</span><span class="string" id="5408356">&#34;missing&nbsp;0xff00&nbsp;sequence&#34;</span><span class="op" id="5408381">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5408384">//&nbsp;readByteStuffedByte&nbsp;is&nbsp;like&nbsp;readByte&nbsp;but&nbsp;is&nbsp;for&nbsp;byte-stuffed&nbsp;Huffman&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="5408462">func</span>&nbsp;<span class="op" id="5408467">(</span><span class="ident" id="5408468">d</span>&nbsp;<span class="op" id="5408470">*</span><span class="ident" id="5408471"><a href="/image/jpeg/reader.go.html#5405509">decoder</a></span><span class="op" id="5408478">)</span>&nbsp;<span class="ident" id="5408480">readByteStuffedByte</span><span class="op" id="5408499">(</span><span class="op" id="5408500">)</span>&nbsp;<span class="op" id="5408502">(</span><span class="ident" id="5408503">x</span>&nbsp;<span class="builtintype" id="5408505">byte</span><span class="op" id="5408509">,</span>&nbsp;<span class="ident" id="5408511">err</span>&nbsp;<span class="builtintype" id="5408515">error</span><span class="op" id="5408520">)</span>&nbsp;<span class="op" id="5408522">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5408525">//&nbsp;Take&nbsp;the&nbsp;fast&nbsp;path&nbsp;if&nbsp;d.bytes.buf&nbsp;contains&nbsp;at&nbsp;least&nbsp;two&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5408592">if</span>&nbsp;<span class="ident" id="5408595"><a href="/image/jpeg/reader.go.html#5408468">d</a></span><span class="op" id="5408596">.</span><span class="ident" id="5408597">bytes</span><span class="op" id="5408602">.</span><span class="ident" id="5408603">i</span><span class="op" id="5408604">+</span><span class="num" id="5408605">2</span>&nbsp;<span class="op" id="5408607">&lt;=</span>&nbsp;<span class="ident" id="5408610"><a href="/image/jpeg/reader.go.html#5408468">d</a></span><span class="op" id="5408611">.</span><span class="ident" id="5408612">bytes</span><span class="op" id="5408617">.</span><span class="ident" id="5408618">j</span>&nbsp;<span class="op" id="5408620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5408624"><a href="/image/jpeg/reader.go.html#5408503">x</a></span>&nbsp;<span class="op" id="5408626">=</span>&nbsp;<span class="ident" id="5408628"><a href="/image/jpeg/reader.go.html#5408468">d</a></span><span class="op" id="5408629">.</span><span class="ident" id="5408630">bytes</span><span class="op" id="5408635">.</span><span class="ident" id="5408636">buf</span><span class="op" id="5408639">[</span><span class="ident" id="5408640"><a href="/image/jpeg/reader.go.html#5408468">d</a></span><span class="op" id="5408641">.</span><span class="ident" id="5408642">bytes</span><span class="op" id="5408647">.</span><span class="ident" id="5408648">i</span><span class="op" id="5408649">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5408653"><a href="/image/jpeg/reader.go.html#5408468">d</a></span><span class="op" id="5408654">.</span><span class="ident" id="5408655">bytes</span><span class="op" id="5408660">.</span><span class="ident" id="5408661">i</span><span class="op" id="5408662">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5408667"><a href="/image/jpeg/reader.go.html#5408468">d</a></span><span class="op" id="5408668">.</span><span class="ident" id="5408669">bytes</span><span class="op" id="5408674">.</span><span class="ident" id="5408675">nUnreadable</span>&nbsp;<span class="op" id="5408687">=</span>&nbsp;<span class="num" id="5408689">1</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5408693">if</span>&nbsp;<span class="ident" id="5408696"><a href="/image/jpeg/reader.go.html#5408503">x</a></span>&nbsp;<span class="op" id="5408698">!=</span>&nbsp;<span class="num" id="5408701">0xff</span>&nbsp;<span class="op" id="5408706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5408711">return</span>&nbsp;<span class="ident" id="5408718"><a href="/image/jpeg/reader.go.html#5408503">x</a></span><span class="op" id="5408719">,</span>&nbsp;<span class="ident" id="5408721"><a href="/image/jpeg/reader.go.html#5408511">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5408727">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5408731">if</span>&nbsp;<span class="ident" id="5408734"><a href="/image/jpeg/reader.go.html#5408468">d</a></span><span class="op" id="5408735">.</span><span class="ident" id="5408736">bytes</span><span class="op" id="5408741">.</span><span class="ident" id="5408742">buf</span><span class="op" id="5408745">[</span><span class="ident" id="5408746"><a href="/image/jpeg/reader.go.html#5408468">d</a></span><span class="op" id="5408747">.</span><span class="ident" id="5408748">bytes</span><span class="op" id="5408753">.</span><span class="ident" id="5408754">i</span><span class="op" id="5408755">]</span>&nbsp;<span class="op" id="5408757">!=</span>&nbsp;<span class="num" id="5408760">0x00</span>&nbsp;<span class="op" id="5408765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5408770">return</span>&nbsp;<span class="num" id="5408777">0</span><span class="op" id="5408778">,</span>&nbsp;<span class="ident" id="5408780"><a href="/image/jpeg/reader.go.html#5408327">errMissingFF00</a></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5408797">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5408801"><a href="/image/jpeg/reader.go.html#5408468">d</a></span><span class="op" id="5408802">.</span><span class="ident" id="5408803">bytes</span><span class="op" id="5408808">.</span><span class="ident" id="5408809">i</span><span class="op" id="5408810">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5408815"><a href="/image/jpeg/reader.go.html#5408468">d</a></span><span class="op" id="5408816">.</span><span class="ident" id="5408817">bytes</span><span class="op" id="5408822">.</span><span class="ident" id="5408823">nUnreadable</span>&nbsp;<span class="op" id="5408835">=</span>&nbsp;<span class="num" id="5408837">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5408841">return</span>&nbsp;<span class="num" id="5408848">0xff</span><span class="op" id="5408852">,</span>&nbsp;<span class="ident" id="5408854">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5408859">}</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5408863"><a href="/image/jpeg/reader.go.html#5408503">x</a></span><span class="op" id="5408864">,</span>&nbsp;<span class="ident" id="5408866"><a href="/image/jpeg/reader.go.html#5408511">err</a></span>&nbsp;<span class="op" id="5408870">=</span>&nbsp;<span class="ident" id="5408872"><a href="/image/jpeg/reader.go.html#5408468">d</a></span><span class="op" id="5408873">.</span><span class="ident" id="5408874">readByte</span><span class="op" id="5408882">(</span><span class="op" id="5408883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5408886">if</span>&nbsp;<span class="ident" id="5408889"><a href="/image/jpeg/reader.go.html#5408511">err</a></span>&nbsp;<span class="op" id="5408893">!=</span>&nbsp;<span class="ident" id="5408896">nil</span>&nbsp;<span class="op" id="5408900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5408904">return</span>&nbsp;<span class="num" id="5408911">0</span><span class="op" id="5408912">,</span>&nbsp;<span class="ident" id="5408914"><a href="/image/jpeg/reader.go.html#5408511">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5408919">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5408922">if</span>&nbsp;<span class="ident" id="5408925"><a href="/image/jpeg/reader.go.html#5408503">x</a></span>&nbsp;<span class="op" id="5408927">!=</span>&nbsp;<span class="num" id="5408930">0xff</span>&nbsp;<span class="op" id="5408935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5408939"><a href="/image/jpeg/reader.go.html#5408468">d</a></span><span class="op" id="5408940">.</span><span class="ident" id="5408941">bytes</span><span class="op" id="5408946">.</span><span class="ident" id="5408947">nUnreadable</span>&nbsp;<span class="op" id="5408959">=</span>&nbsp;<span class="num" id="5408961">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5408965">return</span>&nbsp;<span class="ident" id="5408972"><a href="/image/jpeg/reader.go.html#5408503">x</a></span><span class="op" id="5408973">,</span>&nbsp;<span class="ident" id="5408975">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5408980">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5408984"><a href="/image/jpeg/reader.go.html#5408503">x</a></span><span class="op" id="5408985">,</span>&nbsp;<span class="ident" id="5408987"><a href="/image/jpeg/reader.go.html#5408511">err</a></span>&nbsp;<span class="op" id="5408991">=</span>&nbsp;<span class="ident" id="5408993"><a href="/image/jpeg/reader.go.html#5408468">d</a></span><span class="op" id="5408994">.</span><span class="ident" id="5408995">readByte</span><span class="op" id="5409003">(</span><span class="op" id="5409004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5409007">if</span>&nbsp;<span class="ident" id="5409010"><a href="/image/jpeg/reader.go.html#5408511">err</a></span>&nbsp;<span class="op" id="5409014">!=</span>&nbsp;<span class="ident" id="5409017">nil</span>&nbsp;<span class="op" id="5409021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5409025"><a href="/image/jpeg/reader.go.html#5408468">d</a></span><span class="op" id="5409026">.</span><span class="ident" id="5409027">bytes</span><span class="op" id="5409032">.</span><span class="ident" id="5409033">nUnreadable</span>&nbsp;<span class="op" id="5409045">=</span>&nbsp;<span class="num" id="5409047">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5409051">return</span>&nbsp;<span class="num" id="5409058">0</span><span class="op" id="5409059">,</span>&nbsp;<span class="ident" id="5409061"><a href="/image/jpeg/reader.go.html#5408511">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5409066">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5409069"><a href="/image/jpeg/reader.go.html#5408468">d</a></span><span class="op" id="5409070">.</span><span class="ident" id="5409071">bytes</span><span class="op" id="5409076">.</span><span class="ident" id="5409077">nUnreadable</span>&nbsp;<span class="op" id="5409089">=</span>&nbsp;<span class="num" id="5409091">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5409094">if</span>&nbsp;<span class="ident" id="5409097"><a href="/image/jpeg/reader.go.html#5408503">x</a></span>&nbsp;<span class="op" id="5409099">!=</span>&nbsp;<span class="num" id="5409102">0x00</span>&nbsp;<span class="op" id="5409107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5409111">return</span>&nbsp;<span class="num" id="5409118">0</span><span class="op" id="5409119">,</span>&nbsp;<span class="ident" id="5409121"><a href="/image/jpeg/reader.go.html#5408327">errMissingFF00</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5409137">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5409140">return</span>&nbsp;<span class="num" id="5409147">0xff</span><span class="op" id="5409151">,</span>&nbsp;<span class="ident" id="5409153">nil</span><br>
<span class="lineno">225</span><span class="op" id="5409157">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5409160">//&nbsp;readFull&nbsp;reads&nbsp;exactly&nbsp;len(p)&nbsp;bytes&nbsp;into&nbsp;p.&nbsp;It&nbsp;does&nbsp;not&nbsp;care&nbsp;about&nbsp;byte</span><br>
<span class="lineno"></span><span class="comment" id="5409235">//&nbsp;stuffing.</span><br>
<span class="lineno"></span><span class="keyword" id="5409248">func</span>&nbsp;<span class="op" id="5409253">(</span><span class="ident" id="5409254">d</span>&nbsp;<span class="op" id="5409256">*</span><span class="ident" id="5409257"><a href="/image/jpeg/reader.go.html#5405509">decoder</a></span><span class="op" id="5409264">)</span>&nbsp;<span class="ident" id="5409266">readFull</span><span class="op" id="5409274">(</span><span class="ident" id="5409275">p</span>&nbsp;<span class="op" id="5409277">[</span><span class="op" id="5409278">]</span><span class="builtintype" id="5409279">byte</span><span class="op" id="5409283">)</span>&nbsp;<span class="builtintype" id="5409285">error</span>&nbsp;<span class="op" id="5409291">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5409294">//&nbsp;Unread&nbsp;the&nbsp;overshot&nbsp;bytes,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5409333">if</span>&nbsp;<span class="ident" id="5409336"><a href="/image/jpeg/reader.go.html#5409254">d</a></span><span class="op" id="5409337">.</span><span class="ident" id="5409338">bytes</span><span class="op" id="5409343">.</span><span class="ident" id="5409344">nUnreadable</span>&nbsp;<span class="op" id="5409356">!=</span>&nbsp;<span class="num" id="5409359">0</span>&nbsp;<span class="op" id="5409361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5409365">if</span>&nbsp;<span class="ident" id="5409368"><a href="/image/jpeg/reader.go.html#5409254">d</a></span><span class="op" id="5409369">.</span><span class="ident" id="5409370">bits</span><span class="op" id="5409374">.</span><span class="ident" id="5409375">n</span>&nbsp;<span class="op" id="5409377">&gt;=</span>&nbsp;<span class="num" id="5409380">8</span>&nbsp;<span class="op" id="5409382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5409387"><a href="/image/jpeg/reader.go.html#5409254">d</a></span><span class="op" id="5409388">.</span><span class="ident" id="5409389">unreadByteStuffedByte</span><span class="op" id="5409410">(</span><span class="op" id="5409411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5409415">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5409419"><a href="/image/jpeg/reader.go.html#5409254">d</a></span><span class="op" id="5409420">.</span><span class="ident" id="5409421">bytes</span><span class="op" id="5409426">.</span><span class="ident" id="5409427">nUnreadable</span>&nbsp;<span class="op" id="5409439">=</span>&nbsp;<span class="num" id="5409441">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5409444">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5409448">for</span>&nbsp;<span class="op" id="5409452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5409456">n</span>&nbsp;<span class="op" id="5409458">:=</span>&nbsp;<span class="builtinfunc" id="5409461">copy</span><span class="op" id="5409465">(</span><span class="ident" id="5409466"><a href="/image/jpeg/reader.go.html#5409275">p</a></span><span class="op" id="5409467">,</span>&nbsp;<span class="ident" id="5409469"><a href="/image/jpeg/reader.go.html#5409254">d</a></span><span class="op" id="5409470">.</span><span class="ident" id="5409471">bytes</span><span class="op" id="5409476">.</span><span class="ident" id="5409477">buf</span><span class="op" id="5409480">[</span><span class="ident" id="5409481"><a href="/image/jpeg/reader.go.html#5409254">d</a></span><span class="op" id="5409482">.</span><span class="ident" id="5409483">bytes</span><span class="op" id="5409488">.</span><span class="ident" id="5409489">i</span><span class="op" id="5409490">:</span><span class="ident" id="5409491"><a href="/image/jpeg/reader.go.html#5409254">d</a></span><span class="op" id="5409492">.</span><span class="ident" id="5409493">bytes</span><span class="op" id="5409498">.</span><span class="ident" id="5409499">j</span><span class="op" id="5409500">]</span><span class="op" id="5409501">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5409505"><a href="/image/jpeg/reader.go.html#5409275">p</a></span>&nbsp;<span class="op" id="5409507">=</span>&nbsp;<span class="ident" id="5409509"><a href="/image/jpeg/reader.go.html#5409275">p</a></span><span class="op" id="5409510">[</span><span class="ident" id="5409511"><a href="/image/jpeg/reader.go.html#5409456">n</a></span><span class="op" id="5409512">:</span><span class="op" id="5409513">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5409517"><a href="/image/jpeg/reader.go.html#5409254">d</a></span><span class="op" id="5409518">.</span><span class="ident" id="5409519">bytes</span><span class="op" id="5409524">.</span><span class="ident" id="5409525">i</span>&nbsp;<span class="op" id="5409527">+=</span>&nbsp;<span class="ident" id="5409530"><a href="/image/jpeg/reader.go.html#5409456">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5409534">if</span>&nbsp;<span class="builtinfunc" id="5409537">len</span><span class="op" id="5409540">(</span><span class="ident" id="5409541"><a href="/image/jpeg/reader.go.html#5409275">p</a></span><span class="op" id="5409542">)</span>&nbsp;<span class="op" id="5409544">==</span>&nbsp;<span class="num" id="5409547">0</span>&nbsp;<span class="op" id="5409549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5409554">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5409562">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5409566">if</span>&nbsp;<span class="ident" id="5409569">err</span>&nbsp;<span class="op" id="5409573">:=</span>&nbsp;<span class="ident" id="5409576"><a href="/image/jpeg/reader.go.html#5409254">d</a></span><span class="op" id="5409577">.</span><span class="ident" id="5409578">fill</span><span class="op" id="5409582">(</span><span class="op" id="5409583">)</span><span class="op" id="5409584">;</span>&nbsp;<span class="ident" id="5409586"><a href="/image/jpeg/reader.go.html#5409569">err</a></span>&nbsp;<span class="op" id="5409590">!=</span>&nbsp;<span class="ident" id="5409593">nil</span>&nbsp;<span class="op" id="5409597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5409602">if</span>&nbsp;<span class="ident" id="5409605"><a href="/image/jpeg/reader.go.html#5409569">err</a></span>&nbsp;<span class="op" id="5409609">==</span>&nbsp;<span class="ident" id="5409612"><a href="/image/jpeg/reader.go.html#5402788">io</a></span><span class="op" id="5409614">.</span><span class="ident" id="5409615">EOF</span>&nbsp;<span class="op" id="5409619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5409625"><a href="/image/jpeg/reader.go.html#5409569">err</a></span>&nbsp;<span class="op" id="5409629">=</span>&nbsp;<span class="ident" id="5409631"><a href="/image/jpeg/reader.go.html#5402788">io</a></span><span class="op" id="5409633">.</span><span class="ident" id="5409634">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5409654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5409659">return</span>&nbsp;<span class="ident" id="5409666"><a href="/image/jpeg/reader.go.html#5409569">err</a></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5409672">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5409675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5409678">return</span>&nbsp;<span class="ident" id="5409685">nil</span><br>
<span class="lineno"></span><span class="op" id="5409689">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="comment" id="5409692">//&nbsp;ignore&nbsp;ignores&nbsp;the&nbsp;next&nbsp;n&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="5409728">func</span>&nbsp;<span class="op" id="5409733">(</span><span class="ident" id="5409734">d</span>&nbsp;<span class="op" id="5409736">*</span><span class="ident" id="5409737"><a href="/image/jpeg/reader.go.html#5405509">decoder</a></span><span class="op" id="5409744">)</span>&nbsp;<span class="ident" id="5409746">ignore</span><span class="op" id="5409752">(</span><span class="ident" id="5409753">n</span>&nbsp;<span class="builtintype" id="5409755">int</span><span class="op" id="5409758">)</span>&nbsp;<span class="builtintype" id="5409760">error</span>&nbsp;<span class="op" id="5409766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5409769">//&nbsp;Unread&nbsp;the&nbsp;overshot&nbsp;bytes,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5409808">if</span>&nbsp;<span class="ident" id="5409811"><a href="/image/jpeg/reader.go.html#5409734">d</a></span><span class="op" id="5409812">.</span><span class="ident" id="5409813">bytes</span><span class="op" id="5409818">.</span><span class="ident" id="5409819">nUnreadable</span>&nbsp;<span class="op" id="5409831">!=</span>&nbsp;<span class="num" id="5409834">0</span>&nbsp;<span class="op" id="5409836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5409840">if</span>&nbsp;<span class="ident" id="5409843"><a href="/image/jpeg/reader.go.html#5409734">d</a></span><span class="op" id="5409844">.</span><span class="ident" id="5409845">bits</span><span class="op" id="5409849">.</span><span class="ident" id="5409850">n</span>&nbsp;<span class="op" id="5409852">&gt;=</span>&nbsp;<span class="num" id="5409855">8</span>&nbsp;<span class="op" id="5409857">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5409862"><a href="/image/jpeg/reader.go.html#5409734">d</a></span><span class="op" id="5409863">.</span><span class="ident" id="5409864">unreadByteStuffedByte</span><span class="op" id="5409885">(</span><span class="op" id="5409886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5409890">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5409894"><a href="/image/jpeg/reader.go.html#5409734">d</a></span><span class="op" id="5409895">.</span><span class="ident" id="5409896">bytes</span><span class="op" id="5409901">.</span><span class="ident" id="5409902">nUnreadable</span>&nbsp;<span class="op" id="5409914">=</span>&nbsp;<span class="num" id="5409916">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5409919">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5409923">for</span>&nbsp;<span class="op" id="5409927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5409931">m</span>&nbsp;<span class="op" id="5409933">:=</span>&nbsp;<span class="ident" id="5409936"><a href="/image/jpeg/reader.go.html#5409734">d</a></span><span class="op" id="5409937">.</span><span class="ident" id="5409938">bytes</span><span class="op" id="5409943">.</span><span class="ident" id="5409944">j</span>&nbsp;<span class="op" id="5409946">-</span>&nbsp;<span class="ident" id="5409948"><a href="/image/jpeg/reader.go.html#5409734">d</a></span><span class="op" id="5409949">.</span><span class="ident" id="5409950">bytes</span><span class="op" id="5409955">.</span><span class="ident" id="5409956">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5409960">if</span>&nbsp;<span class="ident" id="5409963"><a href="/image/jpeg/reader.go.html#5409931">m</a></span>&nbsp;<span class="op" id="5409965">&gt;</span>&nbsp;<span class="ident" id="5409967"><a href="/image/jpeg/reader.go.html#5409753">n</a></span>&nbsp;<span class="op" id="5409969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5409974"><a href="/image/jpeg/reader.go.html#5409931">m</a></span>&nbsp;<span class="op" id="5409976">=</span>&nbsp;<span class="ident" id="5409978"><a href="/image/jpeg/reader.go.html#5409753">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5409982">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5409986"><a href="/image/jpeg/reader.go.html#5409734">d</a></span><span class="op" id="5409987">.</span><span class="ident" id="5409988">bytes</span><span class="op" id="5409993">.</span><span class="ident" id="5409994">i</span>&nbsp;<span class="op" id="5409996">+=</span>&nbsp;<span class="ident" id="5409999"><a href="/image/jpeg/reader.go.html#5409931">m</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5410003"><a href="/image/jpeg/reader.go.html#5409753">n</a></span>&nbsp;<span class="op" id="5410005">-=</span>&nbsp;<span class="ident" id="5410008"><a href="/image/jpeg/reader.go.html#5409931">m</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5410012">if</span>&nbsp;<span class="ident" id="5410015"><a href="/image/jpeg/reader.go.html#5409753">n</a></span>&nbsp;<span class="op" id="5410017">==</span>&nbsp;<span class="num" id="5410020">0</span>&nbsp;<span class="op" id="5410022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5410027">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5410035">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5410039">if</span>&nbsp;<span class="ident" id="5410042">err</span>&nbsp;<span class="op" id="5410046">:=</span>&nbsp;<span class="ident" id="5410049"><a href="/image/jpeg/reader.go.html#5409734">d</a></span><span class="op" id="5410050">.</span><span class="ident" id="5410051">fill</span><span class="op" id="5410055">(</span><span class="op" id="5410056">)</span><span class="op" id="5410057">;</span>&nbsp;<span class="ident" id="5410059"><a href="/image/jpeg/reader.go.html#5410042">err</a></span>&nbsp;<span class="op" id="5410063">!=</span>&nbsp;<span class="ident" id="5410066">nil</span>&nbsp;<span class="op" id="5410070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5410075">if</span>&nbsp;<span class="ident" id="5410078"><a href="/image/jpeg/reader.go.html#5410042">err</a></span>&nbsp;<span class="op" id="5410082">==</span>&nbsp;<span class="ident" id="5410085"><a href="/image/jpeg/reader.go.html#5402788">io</a></span><span class="op" id="5410087">.</span><span class="ident" id="5410088">EOF</span>&nbsp;<span class="op" id="5410092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5410098"><a href="/image/jpeg/reader.go.html#5410042">err</a></span>&nbsp;<span class="op" id="5410102">=</span>&nbsp;<span class="ident" id="5410104"><a href="/image/jpeg/reader.go.html#5402788">io</a></span><span class="op" id="5410106">.</span><span class="ident" id="5410107">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5410127">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5410132">return</span>&nbsp;<span class="ident" id="5410139"><a href="/image/jpeg/reader.go.html#5410042">err</a></span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5410145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5410148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5410151">return</span>&nbsp;<span class="ident" id="5410158">nil</span><br>
<span class="lineno"></span><span class="op" id="5410162">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="comment" id="5410165">//&nbsp;Specified&nbsp;in&nbsp;section&nbsp;B.2.2.</span><br>
<span class="lineno"></span><span class="keyword" id="5410196">func</span>&nbsp;<span class="op" id="5410201">(</span><span class="ident" id="5410202">d</span>&nbsp;<span class="op" id="5410204">*</span><span class="ident" id="5410205"><a href="/image/jpeg/reader.go.html#5405509">decoder</a></span><span class="op" id="5410212">)</span>&nbsp;<span class="ident" id="5410214">processSOF</span><span class="op" id="5410224">(</span><span class="ident" id="5410225">n</span>&nbsp;<span class="builtintype" id="5410227">int</span><span class="op" id="5410230">)</span>&nbsp;<span class="builtintype" id="5410232">error</span>&nbsp;<span class="op" id="5410238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5410241">switch</span>&nbsp;<span class="ident" id="5410248"><a href="/image/jpeg/reader.go.html#5410225">n</a></span>&nbsp;<span class="op" id="5410250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5410253">case</span>&nbsp;<span class="num" id="5410258">6</span>&nbsp;<span class="op" id="5410260">+</span>&nbsp;<span class="num" id="5410262">3</span><span class="op" id="5410263">*</span><span class="ident" id="5410264"><a href="/image/jpeg/reader.go.html#5403693">nGrayComponent</a></span><span class="op" id="5410278">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5410282"><a href="/image/jpeg/reader.go.html#5410202">d</a></span><span class="op" id="5410283">.</span><span class="ident" id="5410284">nComp</span>&nbsp;<span class="op" id="5410290">=</span>&nbsp;<span class="ident" id="5410292"><a href="/image/jpeg/reader.go.html#5403693">nGrayComponent</a></span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5410308">case</span>&nbsp;<span class="num" id="5410313">6</span>&nbsp;<span class="op" id="5410315">+</span>&nbsp;<span class="num" id="5410317">3</span><span class="op" id="5410318">*</span><span class="ident" id="5410319"><a href="/image/jpeg/reader.go.html#5403765">nColorComponent</a></span><span class="op" id="5410334">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5410338"><a href="/image/jpeg/reader.go.html#5410202">d</a></span><span class="op" id="5410339">.</span><span class="ident" id="5410340">nComp</span>&nbsp;<span class="op" id="5410346">=</span>&nbsp;<span class="ident" id="5410348"><a href="/image/jpeg/reader.go.html#5403765">nColorComponent</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5410365">default</span><span class="op" id="5410372">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5410376">return</span>&nbsp;<span class="ident" id="5410383"><a href="/image/jpeg/reader.go.html#5403196">UnsupportedError</a></span><span class="op" id="5410399">(</span><span class="string" id="5410400">&#34;SOF&nbsp;has&nbsp;wrong&nbsp;length&#34;</span><span class="op" id="5410422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5410425">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5410428">if</span>&nbsp;<span class="ident" id="5410431">err</span>&nbsp;<span class="op" id="5410435">:=</span>&nbsp;<span class="ident" id="5410438"><a href="/image/jpeg/reader.go.html#5410202">d</a></span><span class="op" id="5410439">.</span><span class="ident" id="5410440">readFull</span><span class="op" id="5410448">(</span><span class="ident" id="5410449"><a href="/image/jpeg/reader.go.html#5410202">d</a></span><span class="op" id="5410450">.</span><span class="ident" id="5410451">tmp</span><span class="op" id="5410454">[</span><span class="op" id="5410455">:</span><span class="ident" id="5410456"><a href="/image/jpeg/reader.go.html#5410225">n</a></span><span class="op" id="5410457">]</span><span class="op" id="5410458">)</span><span class="op" id="5410459">;</span>&nbsp;<span class="ident" id="5410461"><a href="/image/jpeg/reader.go.html#5410431">err</a></span>&nbsp;<span class="op" id="5410465">!=</span>&nbsp;<span class="ident" id="5410468">nil</span>&nbsp;<span class="op" id="5410472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5410476">return</span>&nbsp;<span class="ident" id="5410483"><a href="/image/jpeg/reader.go.html#5410431">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5410488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5410491">//&nbsp;We&nbsp;only&nbsp;support&nbsp;8-bit&nbsp;precision.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5410528">if</span>&nbsp;<span class="ident" id="5410531"><a href="/image/jpeg/reader.go.html#5410202">d</a></span><span class="op" id="5410532">.</span><span class="ident" id="5410533">tmp</span><span class="op" id="5410536">[</span><span class="num" id="5410537">0</span><span class="op" id="5410538">]</span>&nbsp;<span class="op" id="5410540">!=</span>&nbsp;<span class="num" id="5410543">8</span>&nbsp;<span class="op" id="5410545">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5410549">return</span>&nbsp;<span class="ident" id="5410556"><a href="/image/jpeg/reader.go.html#5403196">UnsupportedError</a></span><span class="op" id="5410572">(</span><span class="string" id="5410573">&#34;precision&#34;</span><span class="op" id="5410584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5410587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5410590"><a href="/image/jpeg/reader.go.html#5410202">d</a></span><span class="op" id="5410591">.</span><span class="ident" id="5410592">height</span>&nbsp;<span class="op" id="5410599">=</span>&nbsp;<span class="builtintype" id="5410601">int</span><span class="op" id="5410604">(</span><span class="ident" id="5410605"><a href="/image/jpeg/reader.go.html#5410202">d</a></span><span class="op" id="5410606">.</span><span class="ident" id="5410607">tmp</span><span class="op" id="5410610">[</span><span class="num" id="5410611">1</span><span class="op" id="5410612">]</span><span class="op" id="5410613">)</span><span class="op" id="5410614">&lt;&lt;</span><span class="num" id="5410616">8</span>&nbsp;<span class="op" id="5410618">+</span>&nbsp;<span class="builtintype" id="5410620">int</span><span class="op" id="5410623">(</span><span class="ident" id="5410624"><a href="/image/jpeg/reader.go.html#5410202">d</a></span><span class="op" id="5410625">.</span><span class="ident" id="5410626">tmp</span><span class="op" id="5410629">[</span><span class="num" id="5410630">2</span><span class="op" id="5410631">]</span><span class="op" id="5410632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5410635"><a href="/image/jpeg/reader.go.html#5410202">d</a></span><span class="op" id="5410636">.</span><span class="ident" id="5410637">width</span>&nbsp;<span class="op" id="5410643">=</span>&nbsp;<span class="builtintype" id="5410645">int</span><span class="op" id="5410648">(</span><span class="ident" id="5410649"><a href="/image/jpeg/reader.go.html#5410202">d</a></span><span class="op" id="5410650">.</span><span class="ident" id="5410651">tmp</span><span class="op" id="5410654">[</span><span class="num" id="5410655">3</span><span class="op" id="5410656">]</span><span class="op" id="5410657">)</span><span class="op" id="5410658">&lt;&lt;</span><span class="num" id="5410660">8</span>&nbsp;<span class="op" id="5410662">+</span>&nbsp;<span class="builtintype" id="5410664">int</span><span class="op" id="5410667">(</span><span class="ident" id="5410668"><a href="/image/jpeg/reader.go.html#5410202">d</a></span><span class="op" id="5410669">.</span><span class="ident" id="5410670">tmp</span><span class="op" id="5410673">[</span><span class="num" id="5410674">4</span><span class="op" id="5410675">]</span><span class="op" id="5410676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5410679">if</span>&nbsp;<span class="builtintype" id="5410682">int</span><span class="op" id="5410685">(</span><span class="ident" id="5410686"><a href="/image/jpeg/reader.go.html#5410202">d</a></span><span class="op" id="5410687">.</span><span class="ident" id="5410688">tmp</span><span class="op" id="5410691">[</span><span class="num" id="5410692">5</span><span class="op" id="5410693">]</span><span class="op" id="5410694">)</span>&nbsp;<span class="op" id="5410696">!=</span>&nbsp;<span class="ident" id="5410699"><a href="/image/jpeg/reader.go.html#5410202">d</a></span><span class="op" id="5410700">.</span><span class="ident" id="5410701">nComp</span>&nbsp;<span class="op" id="5410707">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5410711">return</span>&nbsp;<span class="ident" id="5410718"><a href="/image/jpeg/reader.go.html#5403196">UnsupportedError</a></span><span class="op" id="5410734">(</span><span class="string" id="5410735">&#34;SOF&nbsp;has&nbsp;wrong&nbsp;number&nbsp;of&nbsp;image&nbsp;components&#34;</span><span class="op" id="5410777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5410780">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5410783">for</span>&nbsp;<span class="ident" id="5410787">i</span>&nbsp;<span class="op" id="5410789">:=</span>&nbsp;<span class="num" id="5410792">0</span><span class="op" id="5410793">;</span>&nbsp;<span class="ident" id="5410795"><a href="/image/jpeg/reader.go.html#5410787">i</a></span>&nbsp;<span class="op" id="5410797">&lt;</span>&nbsp;<span class="ident" id="5410799"><a href="/image/jpeg/reader.go.html#5410202">d</a></span><span class="op" id="5410800">.</span><span class="ident" id="5410801">nComp</span><span class="op" id="5410806">;</span>&nbsp;<span class="ident" id="5410808"><a href="/image/jpeg/reader.go.html#5410787">i</a></span><span class="op" id="5410809">++</span>&nbsp;<span class="op" id="5410812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5410816"><a href="/image/jpeg/reader.go.html#5410202">d</a></span><span class="op" id="5410817">.</span><span class="ident" id="5410818">comp</span><span class="op" id="5410822">[</span><span class="ident" id="5410823"><a href="/image/jpeg/reader.go.html#5410787">i</a></span><span class="op" id="5410824">]</span><span class="op" id="5410825">.</span><span class="ident" id="5410826">c</span>&nbsp;<span class="op" id="5410828">=</span>&nbsp;<span class="ident" id="5410830"><a href="/image/jpeg/reader.go.html#5410202">d</a></span><span class="op" id="5410831">.</span><span class="ident" id="5410832">tmp</span><span class="op" id="5410835">[</span><span class="num" id="5410836">6</span><span class="op" id="5410837">+</span><span class="num" id="5410838">3</span><span class="op" id="5410839">*</span><span class="ident" id="5410840"><a href="/image/jpeg/reader.go.html#5410787">i</a></span><span class="op" id="5410841">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5410845"><a href="/image/jpeg/reader.go.html#5410202">d</a></span><span class="op" id="5410846">.</span><span class="ident" id="5410847">comp</span><span class="op" id="5410851">[</span><span class="ident" id="5410852"><a href="/image/jpeg/reader.go.html#5410787">i</a></span><span class="op" id="5410853">]</span><span class="op" id="5410854">.</span><span class="ident" id="5410855">tq</span>&nbsp;<span class="op" id="5410858">=</span>&nbsp;<span class="ident" id="5410860"><a href="/image/jpeg/reader.go.html#5410202">d</a></span><span class="op" id="5410861">.</span><span class="ident" id="5410862">tmp</span><span class="op" id="5410865">[</span><span class="num" id="5410866">8</span><span class="op" id="5410867">+</span><span class="num" id="5410868">3</span><span class="op" id="5410869">*</span><span class="ident" id="5410870"><a href="/image/jpeg/reader.go.html#5410787">i</a></span><span class="op" id="5410871">]</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5410875">if</span>&nbsp;<span class="ident" id="5410878"><a href="/image/jpeg/reader.go.html#5410202">d</a></span><span class="op" id="5410879">.</span><span class="ident" id="5410880">nComp</span>&nbsp;<span class="op" id="5410886">==</span>&nbsp;<span class="ident" id="5410889"><a href="/image/jpeg/reader.go.html#5403693">nGrayComponent</a></span>&nbsp;<span class="op" id="5410904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5410909">//&nbsp;If&nbsp;a&nbsp;JPEG&nbsp;image&nbsp;has&nbsp;only&nbsp;one&nbsp;component,&nbsp;section&nbsp;A.2&nbsp;says&nbsp;&#34;this&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5410983">//&nbsp;is&nbsp;non-interleaved&nbsp;by&nbsp;definition&#34;&nbsp;and&nbsp;section&nbsp;A.2.2&nbsp;says&nbsp;&#34;[in&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5411056">//&nbsp;case...]&nbsp;the&nbsp;order&nbsp;of&nbsp;data&nbsp;units&nbsp;within&nbsp;a&nbsp;scan&nbsp;shall&nbsp;be&nbsp;left-to-right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5411132">//&nbsp;and&nbsp;top-to-bottom...&nbsp;regardless&nbsp;of&nbsp;the&nbsp;values&nbsp;of&nbsp;H_1&nbsp;and&nbsp;V_1&#34;.&nbsp;Section</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5411209">//&nbsp;4.8.2&nbsp;also&nbsp;says&nbsp;&#34;[for&nbsp;non-interleaved&nbsp;data],&nbsp;the&nbsp;MCU&nbsp;is&nbsp;defined&nbsp;to&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5411285">//&nbsp;one&nbsp;data&nbsp;unit&#34;.&nbsp;Similarly,&nbsp;section&nbsp;A.1.1&nbsp;explains&nbsp;that&nbsp;it&nbsp;is&nbsp;the&nbsp;ratio</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5411362">//&nbsp;of&nbsp;H_i&nbsp;to&nbsp;max_j(H_j)&nbsp;that&nbsp;matters,&nbsp;and&nbsp;similarly&nbsp;for&nbsp;V.&nbsp;For&nbsp;grayscale</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5411438">//&nbsp;images,&nbsp;H_1&nbsp;is&nbsp;the&nbsp;maximum&nbsp;H_j&nbsp;for&nbsp;all&nbsp;components&nbsp;j,&nbsp;so&nbsp;that&nbsp;ratio&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5411514">//&nbsp;always&nbsp;1.&nbsp;The&nbsp;component&#39;s&nbsp;(h,&nbsp;v)&nbsp;is&nbsp;effectively&nbsp;always&nbsp;(1,&nbsp;1):&nbsp;even&nbsp;if</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5411591">//&nbsp;the&nbsp;nominal&nbsp;(h,&nbsp;v)&nbsp;is&nbsp;(2,&nbsp;1),&nbsp;a&nbsp;20x5&nbsp;image&nbsp;is&nbsp;encoded&nbsp;in&nbsp;three&nbsp;8x8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5411664">//&nbsp;MCUs,&nbsp;not&nbsp;two&nbsp;16x8&nbsp;MCUs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5411695"><a href="/image/jpeg/reader.go.html#5410202">d</a></span><span class="op" id="5411696">.</span><span class="ident" id="5411697">comp</span><span class="op" id="5411701">[</span><span class="ident" id="5411702"><a href="/image/jpeg/reader.go.html#5410787">i</a></span><span class="op" id="5411703">]</span><span class="op" id="5411704">.</span><span class="ident" id="5411705">h</span>&nbsp;<span class="op" id="5411707">=</span>&nbsp;<span class="num" id="5411709">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5411714"><a href="/image/jpeg/reader.go.html#5410202">d</a></span><span class="op" id="5411715">.</span><span class="ident" id="5411716">comp</span><span class="op" id="5411720">[</span><span class="ident" id="5411721"><a href="/image/jpeg/reader.go.html#5410787">i</a></span><span class="op" id="5411722">]</span><span class="op" id="5411723">.</span><span class="ident" id="5411724">v</span>&nbsp;<span class="op" id="5411726">=</span>&nbsp;<span class="num" id="5411728">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5411733">continue</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5411744">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5411748">hv</span>&nbsp;<span class="op" id="5411751">:=</span>&nbsp;<span class="ident" id="5411754"><a href="/image/jpeg/reader.go.html#5410202">d</a></span><span class="op" id="5411755">.</span><span class="ident" id="5411756">tmp</span><span class="op" id="5411759">[</span><span class="num" id="5411760">7</span><span class="op" id="5411761">+</span><span class="num" id="5411762">3</span><span class="op" id="5411763">*</span><span class="ident" id="5411764"><a href="/image/jpeg/reader.go.html#5410787">i</a></span><span class="op" id="5411765">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5411769"><a href="/image/jpeg/reader.go.html#5410202">d</a></span><span class="op" id="5411770">.</span><span class="ident" id="5411771">comp</span><span class="op" id="5411775">[</span><span class="ident" id="5411776"><a href="/image/jpeg/reader.go.html#5410787">i</a></span><span class="op" id="5411777">]</span><span class="op" id="5411778">.</span><span class="ident" id="5411779">h</span>&nbsp;<span class="op" id="5411781">=</span>&nbsp;<span class="builtintype" id="5411783">int</span><span class="op" id="5411786">(</span><span class="ident" id="5411787"><a href="/image/jpeg/reader.go.html#5411748">hv</a></span>&nbsp;<span class="op" id="5411790">&gt;&gt;</span>&nbsp;<span class="num" id="5411793">4</span><span class="op" id="5411794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5411798"><a href="/image/jpeg/reader.go.html#5410202">d</a></span><span class="op" id="5411799">.</span><span class="ident" id="5411800">comp</span><span class="op" id="5411804">[</span><span class="ident" id="5411805"><a href="/image/jpeg/reader.go.html#5410787">i</a></span><span class="op" id="5411806">]</span><span class="op" id="5411807">.</span><span class="ident" id="5411808">v</span>&nbsp;<span class="op" id="5411810">=</span>&nbsp;<span class="builtintype" id="5411812">int</span><span class="op" id="5411815">(</span><span class="ident" id="5411816"><a href="/image/jpeg/reader.go.html#5411748">hv</a></span>&nbsp;<span class="op" id="5411819">&amp;</span>&nbsp;<span class="num" id="5411821">0x0f</span><span class="op" id="5411825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5411829">//&nbsp;For&nbsp;color&nbsp;images,&nbsp;we&nbsp;only&nbsp;support&nbsp;4:4:4,&nbsp;4:4:0,&nbsp;4:2:2&nbsp;or&nbsp;4:2:0&nbsp;chroma</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5411904">//&nbsp;downsampling&nbsp;ratios.&nbsp;This&nbsp;implies&nbsp;that&nbsp;the&nbsp;(h,&nbsp;v)&nbsp;values&nbsp;for&nbsp;the&nbsp;Y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5411976">//&nbsp;component&nbsp;are&nbsp;either&nbsp;(1,&nbsp;1),&nbsp;(1,&nbsp;2),&nbsp;(2,&nbsp;1)&nbsp;or&nbsp;(2,&nbsp;2),&nbsp;and&nbsp;the&nbsp;(h,&nbsp;v)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5412051">//&nbsp;values&nbsp;for&nbsp;the&nbsp;Cr&nbsp;and&nbsp;Cb&nbsp;components&nbsp;must&nbsp;be&nbsp;(1,&nbsp;1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5412108">if</span>&nbsp;<span class="ident" id="5412111"><a href="/image/jpeg/reader.go.html#5410787">i</a></span>&nbsp;<span class="op" id="5412113">==</span>&nbsp;<span class="num" id="5412116">0</span>&nbsp;<span class="op" id="5412118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5412123">if</span>&nbsp;<span class="ident" id="5412126"><a href="/image/jpeg/reader.go.html#5411748">hv</a></span>&nbsp;<span class="op" id="5412129">!=</span>&nbsp;<span class="num" id="5412132">0x11</span>&nbsp;<span class="op" id="5412137">&amp;&amp;</span>&nbsp;<span class="ident" id="5412140"><a href="/image/jpeg/reader.go.html#5411748">hv</a></span>&nbsp;<span class="op" id="5412143">!=</span>&nbsp;<span class="num" id="5412146">0x21</span>&nbsp;<span class="op" id="5412151">&amp;&amp;</span>&nbsp;<span class="ident" id="5412154"><a href="/image/jpeg/reader.go.html#5411748">hv</a></span>&nbsp;<span class="op" id="5412157">!=</span>&nbsp;<span class="num" id="5412160">0x22</span>&nbsp;<span class="op" id="5412165">&amp;&amp;</span>&nbsp;<span class="ident" id="5412168"><a href="/image/jpeg/reader.go.html#5411748">hv</a></span>&nbsp;<span class="op" id="5412171">!=</span>&nbsp;<span class="num" id="5412174">0x12</span>&nbsp;<span class="op" id="5412179">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5412185">return</span>&nbsp;<span class="ident" id="5412192"><a href="/image/jpeg/reader.go.html#5403196">UnsupportedError</a></span><span class="op" id="5412208">(</span><span class="string" id="5412209">&#34;luma/chroma&nbsp;downsample&nbsp;ratio&#34;</span><span class="op" id="5412239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5412244">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5412248">}</span>&nbsp;<span class="keyword" id="5412250">else</span>&nbsp;<span class="keyword" id="5412255">if</span>&nbsp;<span class="ident" id="5412258"><a href="/image/jpeg/reader.go.html#5411748">hv</a></span>&nbsp;<span class="op" id="5412261">!=</span>&nbsp;<span class="num" id="5412264">0x11</span>&nbsp;<span class="op" id="5412269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5412274">return</span>&nbsp;<span class="ident" id="5412281"><a href="/image/jpeg/reader.go.html#5403196">UnsupportedError</a></span><span class="op" id="5412297">(</span><span class="string" id="5412298">&#34;luma/chroma&nbsp;downsample&nbsp;ratio&#34;</span><span class="op" id="5412328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5412332">}</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5412335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5412338">return</span>&nbsp;<span class="ident" id="5412345">nil</span><br>
<span class="lineno"></span><span class="op" id="5412349">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5412352">//&nbsp;Specified&nbsp;in&nbsp;section&nbsp;B.2.4.1.</span><br>
<span class="lineno">345</span><span class="keyword" id="5412385">func</span>&nbsp;<span class="op" id="5412390">(</span><span class="ident" id="5412391">d</span>&nbsp;<span class="op" id="5412393">*</span><span class="ident" id="5412394"><a href="/image/jpeg/reader.go.html#5405509">decoder</a></span><span class="op" id="5412401">)</span>&nbsp;<span class="ident" id="5412403">processDQT</span><span class="op" id="5412413">(</span><span class="ident" id="5412414">n</span>&nbsp;<span class="builtintype" id="5412416">int</span><span class="op" id="5412419">)</span>&nbsp;<span class="builtintype" id="5412421">error</span>&nbsp;<span class="op" id="5412427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5412430">const</span>&nbsp;<span class="ident" id="5412436">qtLength</span>&nbsp;<span class="op" id="5412445">=</span>&nbsp;<span class="num" id="5412447">1</span>&nbsp;<span class="op" id="5412449">+</span>&nbsp;<span class="ident" id="5412451"><a href="/image/jpeg/idct.go.html#5398910">blockSize</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5412462">for</span>&nbsp;<span class="op" id="5412466">;</span>&nbsp;<span class="ident" id="5412468"><a href="/image/jpeg/reader.go.html#5412414">n</a></span>&nbsp;<span class="op" id="5412470">&gt;=</span>&nbsp;<span class="ident" id="5412473"><a href="/image/jpeg/reader.go.html#5412436">qtLength</a></span><span class="op" id="5412481">;</span>&nbsp;<span class="ident" id="5412483"><a href="/image/jpeg/reader.go.html#5412414">n</a></span>&nbsp;<span class="op" id="5412485">-=</span>&nbsp;<span class="ident" id="5412488"><a href="/image/jpeg/reader.go.html#5412436">qtLength</a></span>&nbsp;<span class="op" id="5412497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5412501">if</span>&nbsp;<span class="ident" id="5412504">err</span>&nbsp;<span class="op" id="5412508">:=</span>&nbsp;<span class="ident" id="5412511"><a href="/image/jpeg/reader.go.html#5412391">d</a></span><span class="op" id="5412512">.</span><span class="ident" id="5412513">readFull</span><span class="op" id="5412521">(</span><span class="ident" id="5412522"><a href="/image/jpeg/reader.go.html#5412391">d</a></span><span class="op" id="5412523">.</span><span class="ident" id="5412524">tmp</span><span class="op" id="5412527">[</span><span class="op" id="5412528">:</span><span class="ident" id="5412529"><a href="/image/jpeg/reader.go.html#5412436">qtLength</a></span><span class="op" id="5412537">]</span><span class="op" id="5412538">)</span><span class="op" id="5412539">;</span>&nbsp;<span class="ident" id="5412541"><a href="/image/jpeg/reader.go.html#5412504">err</a></span>&nbsp;<span class="op" id="5412545">!=</span>&nbsp;<span class="ident" id="5412548">nil</span>&nbsp;<span class="op" id="5412552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5412557">return</span>&nbsp;<span class="ident" id="5412564"><a href="/image/jpeg/reader.go.html#5412504">err</a></span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5412570">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5412574">pq</span>&nbsp;<span class="op" id="5412577">:=</span>&nbsp;<span class="ident" id="5412580"><a href="/image/jpeg/reader.go.html#5412391">d</a></span><span class="op" id="5412581">.</span><span class="ident" id="5412582">tmp</span><span class="op" id="5412585">[</span><span class="num" id="5412586">0</span><span class="op" id="5412587">]</span>&nbsp;<span class="op" id="5412589">&gt;&gt;</span>&nbsp;<span class="num" id="5412592">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5412596">if</span>&nbsp;<span class="ident" id="5412599"><a href="/image/jpeg/reader.go.html#5412574">pq</a></span>&nbsp;<span class="op" id="5412602">!=</span>&nbsp;<span class="num" id="5412605">0</span>&nbsp;<span class="op" id="5412607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5412612">return</span>&nbsp;<span class="ident" id="5412619"><a href="/image/jpeg/reader.go.html#5403196">UnsupportedError</a></span><span class="op" id="5412635">(</span><span class="string" id="5412636">&#34;bad&nbsp;Pq&nbsp;value&#34;</span><span class="op" id="5412650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5412654">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5412658">tq</span>&nbsp;<span class="op" id="5412661">:=</span>&nbsp;<span class="ident" id="5412664"><a href="/image/jpeg/reader.go.html#5412391">d</a></span><span class="op" id="5412665">.</span><span class="ident" id="5412666">tmp</span><span class="op" id="5412669">[</span><span class="num" id="5412670">0</span><span class="op" id="5412671">]</span>&nbsp;<span class="op" id="5412673">&amp;</span>&nbsp;<span class="num" id="5412675">0x0f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5412682">if</span>&nbsp;<span class="ident" id="5412685"><a href="/image/jpeg/reader.go.html#5412658">tq</a></span>&nbsp;<span class="op" id="5412688">&gt;</span>&nbsp;<span class="ident" id="5412690"><a href="/image/jpeg/reader.go.html#5403628">maxTq</a></span>&nbsp;<span class="op" id="5412696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5412701">return</span>&nbsp;<span class="ident" id="5412708"><a href="/image/jpeg/reader.go.html#5402996">FormatError</a></span><span class="op" id="5412719">(</span><span class="string" id="5412720">&#34;bad&nbsp;Tq&nbsp;value&#34;</span><span class="op" id="5412734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5412738">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5412742">for</span>&nbsp;<span class="ident" id="5412746">i</span>&nbsp;<span class="op" id="5412748">:=</span>&nbsp;<span class="keyword" id="5412751">range</span>&nbsp;<span class="ident" id="5412757"><a href="/image/jpeg/reader.go.html#5412391">d</a></span><span class="op" id="5412758">.</span><span class="ident" id="5412759">quant</span><span class="op" id="5412764">[</span><span class="ident" id="5412765"><a href="/image/jpeg/reader.go.html#5412658">tq</a></span><span class="op" id="5412767">]</span>&nbsp;<span class="op" id="5412769">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5412774"><a href="/image/jpeg/reader.go.html#5412391">d</a></span><span class="op" id="5412775">.</span><span class="ident" id="5412776">quant</span><span class="op" id="5412781">[</span><span class="ident" id="5412782"><a href="/image/jpeg/reader.go.html#5412658">tq</a></span><span class="op" id="5412784">]</span><span class="op" id="5412785">[</span><span class="ident" id="5412786"><a href="/image/jpeg/reader.go.html#5412746">i</a></span><span class="op" id="5412787">]</span>&nbsp;<span class="op" id="5412789">=</span>&nbsp;<span class="builtintype" id="5412791">int32</span><span class="op" id="5412796">(</span><span class="ident" id="5412797"><a href="/image/jpeg/reader.go.html#5412391">d</a></span><span class="op" id="5412798">.</span><span class="ident" id="5412799">tmp</span><span class="op" id="5412802">[</span><span class="ident" id="5412803"><a href="/image/jpeg/reader.go.html#5412746">i</a></span><span class="op" id="5412804">+</span><span class="num" id="5412805">1</span><span class="op" id="5412806">]</span><span class="op" id="5412807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5412811">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5412814">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5412817">if</span>&nbsp;<span class="ident" id="5412820"><a href="/image/jpeg/reader.go.html#5412414">n</a></span>&nbsp;<span class="op" id="5412822">!=</span>&nbsp;<span class="num" id="5412825">0</span>&nbsp;<span class="op" id="5412827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5412831">return</span>&nbsp;<span class="ident" id="5412838"><a href="/image/jpeg/reader.go.html#5402996">FormatError</a></span><span class="op" id="5412849">(</span><span class="string" id="5412850">&#34;DQT&nbsp;has&nbsp;wrong&nbsp;length&#34;</span><span class="op" id="5412872">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5412875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5412878">return</span>&nbsp;<span class="ident" id="5412885">nil</span><br>
<span class="lineno"></span><span class="op" id="5412889">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5412892">//&nbsp;Specified&nbsp;in&nbsp;section&nbsp;B.2.4.4.</span><br>
<span class="lineno">370</span><span class="keyword" id="5412925">func</span>&nbsp;<span class="op" id="5412930">(</span><span class="ident" id="5412931">d</span>&nbsp;<span class="op" id="5412933">*</span><span class="ident" id="5412934"><a href="/image/jpeg/reader.go.html#5405509">decoder</a></span><span class="op" id="5412941">)</span>&nbsp;<span class="ident" id="5412943">processDRI</span><span class="op" id="5412953">(</span><span class="ident" id="5412954">n</span>&nbsp;<span class="builtintype" id="5412956">int</span><span class="op" id="5412959">)</span>&nbsp;<span class="builtintype" id="5412961">error</span>&nbsp;<span class="op" id="5412967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5412970">if</span>&nbsp;<span class="ident" id="5412973"><a href="/image/jpeg/reader.go.html#5412954">n</a></span>&nbsp;<span class="op" id="5412975">!=</span>&nbsp;<span class="num" id="5412978">2</span>&nbsp;<span class="op" id="5412980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5412984">return</span>&nbsp;<span class="ident" id="5412991"><a href="/image/jpeg/reader.go.html#5402996">FormatError</a></span><span class="op" id="5413002">(</span><span class="string" id="5413003">&#34;DRI&nbsp;has&nbsp;wrong&nbsp;length&#34;</span><span class="op" id="5413025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5413028">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5413031">if</span>&nbsp;<span class="ident" id="5413034">err</span>&nbsp;<span class="op" id="5413038">:=</span>&nbsp;<span class="ident" id="5413041"><a href="/image/jpeg/reader.go.html#5412931">d</a></span><span class="op" id="5413042">.</span><span class="ident" id="5413043">readFull</span><span class="op" id="5413051">(</span><span class="ident" id="5413052"><a href="/image/jpeg/reader.go.html#5412931">d</a></span><span class="op" id="5413053">.</span><span class="ident" id="5413054">tmp</span><span class="op" id="5413057">[</span><span class="op" id="5413058">:</span><span class="num" id="5413059">2</span><span class="op" id="5413060">]</span><span class="op" id="5413061">)</span><span class="op" id="5413062">;</span>&nbsp;<span class="ident" id="5413064"><a href="/image/jpeg/reader.go.html#5413034">err</a></span>&nbsp;<span class="op" id="5413068">!=</span>&nbsp;<span class="ident" id="5413071">nil</span>&nbsp;<span class="op" id="5413075">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5413079">return</span>&nbsp;<span class="ident" id="5413086"><a href="/image/jpeg/reader.go.html#5413034">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5413091">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5413094"><a href="/image/jpeg/reader.go.html#5412931">d</a></span><span class="op" id="5413095">.</span><span class="ident" id="5413096">ri</span>&nbsp;<span class="op" id="5413099">=</span>&nbsp;<span class="builtintype" id="5413101">int</span><span class="op" id="5413104">(</span><span class="ident" id="5413105"><a href="/image/jpeg/reader.go.html#5412931">d</a></span><span class="op" id="5413106">.</span><span class="ident" id="5413107">tmp</span><span class="op" id="5413110">[</span><span class="num" id="5413111">0</span><span class="op" id="5413112">]</span><span class="op" id="5413113">)</span><span class="op" id="5413114">&lt;&lt;</span><span class="num" id="5413116">8</span>&nbsp;<span class="op" id="5413118">+</span>&nbsp;<span class="builtintype" id="5413120">int</span><span class="op" id="5413123">(</span><span class="ident" id="5413124"><a href="/image/jpeg/reader.go.html#5412931">d</a></span><span class="op" id="5413125">.</span><span class="ident" id="5413126">tmp</span><span class="op" id="5413129">[</span><span class="num" id="5413130">1</span><span class="op" id="5413131">]</span><span class="op" id="5413132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5413135">return</span>&nbsp;<span class="ident" id="5413142">nil</span><br>
<span class="lineno"></span><span class="op" id="5413146">}</span><br>
<span class="lineno">380</span><br>
<span class="lineno"></span><span class="comment" id="5413149">//&nbsp;decode&nbsp;reads&nbsp;a&nbsp;JPEG&nbsp;image&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;it&nbsp;as&nbsp;an&nbsp;image.Image.</span><br>
<span class="lineno"></span><span class="keyword" id="5413219">func</span>&nbsp;<span class="op" id="5413224">(</span><span class="ident" id="5413225">d</span>&nbsp;<span class="op" id="5413227">*</span><span class="ident" id="5413228"><a href="/image/jpeg/reader.go.html#5405509">decoder</a></span><span class="op" id="5413235">)</span>&nbsp;<span class="ident" id="5413237">decode</span><span class="op" id="5413243">(</span><span class="ident" id="5413244">r</span>&nbsp;<span class="ident" id="5413246"><a href="/image/jpeg/reader.go.html#5402788">io</a></span><span class="op" id="5413248">.</span><span class="ident" id="5413249">Reader</span><span class="op" id="5413255">,</span>&nbsp;<span class="ident" id="5413257">configOnly</span>&nbsp;<span class="builtintype" id="5413268">bool</span><span class="op" id="5413272">)</span>&nbsp;<span class="op" id="5413274">(</span><span class="ident" id="5413275"><a href="/image/jpeg/reader.go.html#5402764">image</a></span><span class="op" id="5413280">.</span><span class="ident" id="5413281">Image</span><span class="op" id="5413286">,</span>&nbsp;<span class="builtintype" id="5413288">error</span><span class="op" id="5413293">)</span>&nbsp;<span class="op" id="5413295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5413298"><a href="/image/jpeg/reader.go.html#5413225">d</a></span><span class="op" id="5413299">.</span><span class="ident" id="5413300">r</span>&nbsp;<span class="op" id="5413302">=</span>&nbsp;<span class="ident" id="5413304"><a href="/image/jpeg/reader.go.html#5413244">r</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5413308">//&nbsp;Check&nbsp;for&nbsp;the&nbsp;Start&nbsp;Of&nbsp;Image&nbsp;marker.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5413349">if</span>&nbsp;<span class="ident" id="5413352">err</span>&nbsp;<span class="op" id="5413356">:=</span>&nbsp;<span class="ident" id="5413359"><a href="/image/jpeg/reader.go.html#5413225">d</a></span><span class="op" id="5413360">.</span><span class="ident" id="5413361">readFull</span><span class="op" id="5413369">(</span><span class="ident" id="5413370"><a href="/image/jpeg/reader.go.html#5413225">d</a></span><span class="op" id="5413371">.</span><span class="ident" id="5413372">tmp</span><span class="op" id="5413375">[</span><span class="op" id="5413376">:</span><span class="num" id="5413377">2</span><span class="op" id="5413378">]</span><span class="op" id="5413379">)</span><span class="op" id="5413380">;</span>&nbsp;<span class="ident" id="5413382"><a href="/image/jpeg/reader.go.html#5413352">err</a></span>&nbsp;<span class="op" id="5413386">!=</span>&nbsp;<span class="ident" id="5413389">nil</span>&nbsp;<span class="op" id="5413393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5413397">return</span>&nbsp;<span class="ident" id="5413404">nil</span><span class="op" id="5413407">,</span>&nbsp;<span class="ident" id="5413409"><a href="/image/jpeg/reader.go.html#5413352">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5413414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5413417">if</span>&nbsp;<span class="ident" id="5413420"><a href="/image/jpeg/reader.go.html#5413225">d</a></span><span class="op" id="5413421">.</span><span class="ident" id="5413422">tmp</span><span class="op" id="5413425">[</span><span class="num" id="5413426">0</span><span class="op" id="5413427">]</span>&nbsp;<span class="op" id="5413429">!=</span>&nbsp;<span class="num" id="5413432">0xff</span>&nbsp;<span class="op" id="5413437">||</span>&nbsp;<span class="ident" id="5413440"><a href="/image/jpeg/reader.go.html#5413225">d</a></span><span class="op" id="5413441">.</span><span class="ident" id="5413442">tmp</span><span class="op" id="5413445">[</span><span class="num" id="5413446">1</span><span class="op" id="5413447">]</span>&nbsp;<span class="op" id="5413449">!=</span>&nbsp;<span class="ident" id="5413452"><a href="/image/jpeg/reader.go.html#5404013">soiMarker</a></span>&nbsp;<span class="op" id="5413462">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5413466">return</span>&nbsp;<span class="ident" id="5413473">nil</span><span class="op" id="5413476">,</span>&nbsp;<span class="ident" id="5413478"><a href="/image/jpeg/reader.go.html#5402996">FormatError</a></span><span class="op" id="5413489">(</span><span class="string" id="5413490">&#34;missing&nbsp;SOI&nbsp;marker&#34;</span><span class="op" id="5413510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5413513">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5413517">//&nbsp;Process&nbsp;the&nbsp;remaining&nbsp;segments&nbsp;until&nbsp;the&nbsp;End&nbsp;Of&nbsp;Image&nbsp;marker.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5413583">for</span>&nbsp;<span class="op" id="5413587">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5413591">err</span>&nbsp;<span class="op" id="5413595">:=</span>&nbsp;<span class="ident" id="5413598"><a href="/image/jpeg/reader.go.html#5413225">d</a></span><span class="op" id="5413599">.</span><span class="ident" id="5413600">readFull</span><span class="op" id="5413608">(</span><span class="ident" id="5413609"><a href="/image/jpeg/reader.go.html#5413225">d</a></span><span class="op" id="5413610">.</span><span class="ident" id="5413611">tmp</span><span class="op" id="5413614">[</span><span class="op" id="5413615">:</span><span class="num" id="5413616">2</span><span class="op" id="5413617">]</span><span class="op" id="5413618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5413622">if</span>&nbsp;<span class="ident" id="5413625"><a href="/image/jpeg/reader.go.html#5413591">err</a></span>&nbsp;<span class="op" id="5413629">!=</span>&nbsp;<span class="ident" id="5413632">nil</span>&nbsp;<span class="op" id="5413636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5413641">return</span>&nbsp;<span class="ident" id="5413648">nil</span><span class="op" id="5413651">,</span>&nbsp;<span class="ident" id="5413653"><a href="/image/jpeg/reader.go.html#5413591">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5413659">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5413663">for</span>&nbsp;<span class="ident" id="5413667"><a href="/image/jpeg/reader.go.html#5413225">d</a></span><span class="op" id="5413668">.</span><span class="ident" id="5413669">tmp</span><span class="op" id="5413672">[</span><span class="num" id="5413673">0</span><span class="op" id="5413674">]</span>&nbsp;<span class="op" id="5413676">!=</span>&nbsp;<span class="num" id="5413679">0xff</span>&nbsp;<span class="op" id="5413684">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5413689">//&nbsp;Strictly&nbsp;speaking,&nbsp;this&nbsp;is&nbsp;a&nbsp;format&nbsp;error.&nbsp;However,&nbsp;libjpeg&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5413758">//&nbsp;liberal&nbsp;in&nbsp;what&nbsp;it&nbsp;accepts.&nbsp;As&nbsp;of&nbsp;version&nbsp;9,&nbsp;next_marker&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5413824">//&nbsp;jdmarker.c&nbsp;treats&nbsp;this&nbsp;as&nbsp;a&nbsp;warning&nbsp;(JWRN_EXTRANEOUS_DATA)&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5413893">//&nbsp;continues&nbsp;to&nbsp;decode&nbsp;the&nbsp;stream.&nbsp;Even&nbsp;before&nbsp;next_marker&nbsp;sees</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5413960">//&nbsp;extraneous&nbsp;data,&nbsp;jpeg_fill_bit_buffer&nbsp;in&nbsp;jdhuff.c&nbsp;reads&nbsp;as&nbsp;many</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5414030">//&nbsp;bytes&nbsp;as&nbsp;it&nbsp;can,&nbsp;possibly&nbsp;past&nbsp;the&nbsp;end&nbsp;of&nbsp;a&nbsp;scan&#39;s&nbsp;data.&nbsp;It</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5414096">//&nbsp;effectively&nbsp;puts&nbsp;back&nbsp;any&nbsp;markers&nbsp;that&nbsp;it&nbsp;overscanned&nbsp;(e.g.&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5414165">//&nbsp;&#34;\xff\xd9&#34;&nbsp;EOI&nbsp;marker),&nbsp;but&nbsp;it&nbsp;does&nbsp;not&nbsp;put&nbsp;back&nbsp;non-marker&nbsp;data,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5414237">//&nbsp;and&nbsp;thus&nbsp;it&nbsp;can&nbsp;silently&nbsp;ignore&nbsp;a&nbsp;small&nbsp;number&nbsp;of&nbsp;extraneous</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5414304">//&nbsp;non-marker&nbsp;bytes&nbsp;before&nbsp;next_marker&nbsp;has&nbsp;a&nbsp;chance&nbsp;to&nbsp;see&nbsp;them&nbsp;(and</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5414376">//&nbsp;print&nbsp;a&nbsp;warning).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5414400">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5414406">//&nbsp;We&nbsp;are&nbsp;therefore&nbsp;also&nbsp;liberal&nbsp;in&nbsp;what&nbsp;we&nbsp;accept.&nbsp;Extraneous&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5414477">//&nbsp;is&nbsp;silently&nbsp;ignored.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5414504">//</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5414510">//&nbsp;This&nbsp;is&nbsp;similar&nbsp;to,&nbsp;but&nbsp;not&nbsp;exactly&nbsp;the&nbsp;same&nbsp;as,&nbsp;the&nbsp;restart</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5414577">//&nbsp;mechanism&nbsp;within&nbsp;a&nbsp;scan&nbsp;(the&nbsp;RST[0-7]&nbsp;markers).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5414631">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5414637">//&nbsp;Note&nbsp;that&nbsp;extraneous&nbsp;0xff&nbsp;bytes&nbsp;in&nbsp;e.g.&nbsp;SOS&nbsp;data&nbsp;are&nbsp;escaped&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5414707">//&nbsp;&#34;\xff\x00&#34;,&nbsp;and&nbsp;so&nbsp;are&nbsp;detected&nbsp;a&nbsp;little&nbsp;further&nbsp;down&nbsp;below.</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5414774"><a href="/image/jpeg/reader.go.html#5413225">d</a></span><span class="op" id="5414775">.</span><span class="ident" id="5414776">tmp</span><span class="op" id="5414779">[</span><span class="num" id="5414780">0</span><span class="op" id="5414781">]</span>&nbsp;<span class="op" id="5414783">=</span>&nbsp;<span class="ident" id="5414785"><a href="/image/jpeg/reader.go.html#5413225">d</a></span><span class="op" id="5414786">.</span><span class="ident" id="5414787">tmp</span><span class="op" id="5414790">[</span><span class="num" id="5414791">1</span><span class="op" id="5414792">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5414797"><a href="/image/jpeg/reader.go.html#5413225">d</a></span><span class="op" id="5414798">.</span><span class="ident" id="5414799">tmp</span><span class="op" id="5414802">[</span><span class="num" id="5414803">1</span><span class="op" id="5414804">]</span><span class="op" id="5414805">,</span>&nbsp;<span class="ident" id="5414807"><a href="/image/jpeg/reader.go.html#5413591">err</a></span>&nbsp;<span class="op" id="5414811">=</span>&nbsp;<span class="ident" id="5414813"><a href="/image/jpeg/reader.go.html#5413225">d</a></span><span class="op" id="5414814">.</span><span class="ident" id="5414815">readByte</span><span class="op" id="5414823">(</span><span class="op" id="5414824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5414829">if</span>&nbsp;<span class="ident" id="5414832"><a href="/image/jpeg/reader.go.html#5413591">err</a></span>&nbsp;<span class="op" id="5414836">!=</span>&nbsp;<span class="ident" id="5414839">nil</span>&nbsp;<span class="op" id="5414843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5414849">return</span>&nbsp;<span class="ident" id="5414856">nil</span><span class="op" id="5414859">,</span>&nbsp;<span class="ident" id="5414861"><a href="/image/jpeg/reader.go.html#5413591">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5414868">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5414872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5414876">marker</span>&nbsp;<span class="op" id="5414883">:=</span>&nbsp;<span class="ident" id="5414886"><a href="/image/jpeg/reader.go.html#5413225">d</a></span><span class="op" id="5414887">.</span><span class="ident" id="5414888">tmp</span><span class="op" id="5414891">[</span><span class="num" id="5414892">1</span><span class="op" id="5414893">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5414897">if</span>&nbsp;<span class="ident" id="5414900"><a href="/image/jpeg/reader.go.html#5414876">marker</a></span>&nbsp;<span class="op" id="5414907">==</span>&nbsp;<span class="num" id="5414910">0</span>&nbsp;<span class="op" id="5414912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5414917">//&nbsp;Treat&nbsp;&#34;\xff\x00&#34;&nbsp;as&nbsp;extraneous&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5414960">continue</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5414971">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5414975">for</span>&nbsp;<span class="ident" id="5414979"><a href="/image/jpeg/reader.go.html#5414876">marker</a></span>&nbsp;<span class="op" id="5414986">==</span>&nbsp;<span class="num" id="5414989">0xff</span>&nbsp;<span class="op" id="5414994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5414999">//&nbsp;Section&nbsp;B.1.1.2&nbsp;says,&nbsp;&#34;Any&nbsp;marker&nbsp;may&nbsp;optionally&nbsp;be&nbsp;preceded&nbsp;by&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5415073">//&nbsp;number&nbsp;of&nbsp;fill&nbsp;bytes,&nbsp;which&nbsp;are&nbsp;bytes&nbsp;assigned&nbsp;code&nbsp;X&#39;FF&#39;&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5415139"><a href="/image/jpeg/reader.go.html#5414876">marker</a></span><span class="op" id="5415145">,</span>&nbsp;<span class="ident" id="5415147"><a href="/image/jpeg/reader.go.html#5413591">err</a></span>&nbsp;<span class="op" id="5415151">=</span>&nbsp;<span class="ident" id="5415153"><a href="/image/jpeg/reader.go.html#5413225">d</a></span><span class="op" id="5415154">.</span><span class="ident" id="5415155">readByte</span><span class="op" id="5415163">(</span><span class="op" id="5415164">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5415169">if</span>&nbsp;<span class="ident" id="5415172"><a href="/image/jpeg/reader.go.html#5413591">err</a></span>&nbsp;<span class="op" id="5415176">!=</span>&nbsp;<span class="ident" id="5415179">nil</span>&nbsp;<span class="op" id="5415183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5415189">return</span>&nbsp;<span class="ident" id="5415196">nil</span><span class="op" id="5415199">,</span>&nbsp;<span class="ident" id="5415201"><a href="/image/jpeg/reader.go.html#5413591">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5415208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5415212">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5415216">if</span>&nbsp;<span class="ident" id="5415219"><a href="/image/jpeg/reader.go.html#5414876">marker</a></span>&nbsp;<span class="op" id="5415226">==</span>&nbsp;<span class="ident" id="5415229"><a href="/image/jpeg/reader.go.html#5404052">eoiMarker</a></span>&nbsp;<span class="op" id="5415239">{</span>&nbsp;<span class="comment" id="5415241">//&nbsp;End&nbsp;Of&nbsp;Image.</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5415261">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5415269">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5415273">if</span>&nbsp;<span class="ident" id="5415276"><a href="/image/jpeg/reader.go.html#5404373">rst0Marker</a></span>&nbsp;<span class="op" id="5415287">&lt;=</span>&nbsp;<span class="ident" id="5415290"><a href="/image/jpeg/reader.go.html#5414876">marker</a></span>&nbsp;<span class="op" id="5415297">&amp;&amp;</span>&nbsp;<span class="ident" id="5415300"><a href="/image/jpeg/reader.go.html#5414876">marker</a></span>&nbsp;<span class="op" id="5415307">&lt;=</span>&nbsp;<span class="ident" id="5415310"><a href="/image/jpeg/reader.go.html#5404409">rst7Marker</a></span>&nbsp;<span class="op" id="5415321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5415326">//&nbsp;Figures&nbsp;B.2&nbsp;and&nbsp;B.16&nbsp;of&nbsp;the&nbsp;specification&nbsp;suggest&nbsp;that&nbsp;restart&nbsp;markers&nbsp;should</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5415410">//&nbsp;only&nbsp;occur&nbsp;between&nbsp;Entropy&nbsp;Coded&nbsp;Segments&nbsp;and&nbsp;not&nbsp;after&nbsp;the&nbsp;final&nbsp;ECS.</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5415487">//&nbsp;However,&nbsp;some&nbsp;encoders&nbsp;may&nbsp;generate&nbsp;incorrect&nbsp;JPEGs&nbsp;with&nbsp;a&nbsp;final&nbsp;restart</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5415566">//&nbsp;marker.&nbsp;That&nbsp;restart&nbsp;marker&nbsp;will&nbsp;be&nbsp;seen&nbsp;here&nbsp;instead&nbsp;of&nbsp;inside&nbsp;the&nbsp;processSOS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5415651">//&nbsp;method,&nbsp;and&nbsp;is&nbsp;ignored&nbsp;as&nbsp;a&nbsp;harmless&nbsp;error.&nbsp;Restart&nbsp;markers&nbsp;have&nbsp;no&nbsp;extra&nbsp;data,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5415737">//&nbsp;so&nbsp;we&nbsp;check&nbsp;for&nbsp;this&nbsp;before&nbsp;we&nbsp;read&nbsp;the&nbsp;16-bit&nbsp;length&nbsp;of&nbsp;the&nbsp;segment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5415813">continue</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5415824">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5415829">//&nbsp;Read&nbsp;the&nbsp;16-bit&nbsp;length&nbsp;of&nbsp;the&nbsp;segment.&nbsp;The&nbsp;value&nbsp;includes&nbsp;the&nbsp;2&nbsp;bytes&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5415912">//&nbsp;length&nbsp;itself,&nbsp;so&nbsp;we&nbsp;subtract&nbsp;2&nbsp;to&nbsp;get&nbsp;the&nbsp;number&nbsp;of&nbsp;remaining&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5415987">if</span>&nbsp;<span class="ident" id="5415990"><a href="/image/jpeg/reader.go.html#5413591">err</a></span>&nbsp;<span class="op" id="5415994">=</span>&nbsp;<span class="ident" id="5415996"><a href="/image/jpeg/reader.go.html#5413225">d</a></span><span class="op" id="5415997">.</span><span class="ident" id="5415998">readFull</span><span class="op" id="5416006">(</span><span class="ident" id="5416007"><a href="/image/jpeg/reader.go.html#5413225">d</a></span><span class="op" id="5416008">.</span><span class="ident" id="5416009">tmp</span><span class="op" id="5416012">[</span><span class="op" id="5416013">:</span><span class="num" id="5416014">2</span><span class="op" id="5416015">]</span><span class="op" id="5416016">)</span><span class="op" id="5416017">;</span>&nbsp;<span class="ident" id="5416019"><a href="/image/jpeg/reader.go.html#5413591">err</a></span>&nbsp;<span class="op" id="5416023">!=</span>&nbsp;<span class="ident" id="5416026">nil</span>&nbsp;<span class="op" id="5416030">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5416035">return</span>&nbsp;<span class="ident" id="5416042">nil</span><span class="op" id="5416045">,</span>&nbsp;<span class="ident" id="5416047"><a href="/image/jpeg/reader.go.html#5413591">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5416053">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5416057">n</span>&nbsp;<span class="op" id="5416059">:=</span>&nbsp;<span class="builtintype" id="5416062">int</span><span class="op" id="5416065">(</span><span class="ident" id="5416066"><a href="/image/jpeg/reader.go.html#5413225">d</a></span><span class="op" id="5416067">.</span><span class="ident" id="5416068">tmp</span><span class="op" id="5416071">[</span><span class="num" id="5416072">0</span><span class="op" id="5416073">]</span><span class="op" id="5416074">)</span><span class="op" id="5416075">&lt;&lt;</span><span class="num" id="5416077">8</span>&nbsp;<span class="op" id="5416079">+</span>&nbsp;<span class="builtintype" id="5416081">int</span><span class="op" id="5416084">(</span><span class="ident" id="5416085"><a href="/image/jpeg/reader.go.html#5413225">d</a></span><span class="op" id="5416086">.</span><span class="ident" id="5416087">tmp</span><span class="op" id="5416090">[</span><span class="num" id="5416091">1</span><span class="op" id="5416092">]</span><span class="op" id="5416093">)</span>&nbsp;<span class="op" id="5416095">-</span>&nbsp;<span class="num" id="5416097">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5416101">if</span>&nbsp;<span class="ident" id="5416104"><a href="/image/jpeg/reader.go.html#5416057">n</a></span>&nbsp;<span class="op" id="5416106">&lt;</span>&nbsp;<span class="num" id="5416108">0</span>&nbsp;<span class="op" id="5416110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5416115">return</span>&nbsp;<span class="ident" id="5416122">nil</span><span class="op" id="5416125">,</span>&nbsp;<span class="ident" id="5416127"><a href="/image/jpeg/reader.go.html#5402996">FormatError</a></span><span class="op" id="5416138">(</span><span class="string" id="5416139">&#34;short&nbsp;segment&nbsp;length&#34;</span><span class="op" id="5416161">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5416165">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5416170">switch</span>&nbsp;<span class="op" id="5416177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5416181">case</span>&nbsp;<span class="ident" id="5416186"><a href="/image/jpeg/reader.go.html#5414876">marker</a></span>&nbsp;<span class="op" id="5416193">==</span>&nbsp;<span class="ident" id="5416196"><a href="/image/jpeg/reader.go.html#5404089">sof0Marker</a></span>&nbsp;<span class="op" id="5416207">||</span>&nbsp;<span class="ident" id="5416210"><a href="/image/jpeg/reader.go.html#5414876">marker</a></span>&nbsp;<span class="op" id="5416217">==</span>&nbsp;<span class="ident" id="5416220"><a href="/image/jpeg/reader.go.html#5404139">sof2Marker</a></span><span class="op" id="5416230">:</span>&nbsp;<span class="comment" id="5416232">//&nbsp;Start&nbsp;Of&nbsp;Frame.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5416254"><a href="/image/jpeg/reader.go.html#5413225">d</a></span><span class="op" id="5416255">.</span><span class="ident" id="5416256">progressive</span>&nbsp;<span class="op" id="5416268">=</span>&nbsp;<span class="ident" id="5416270"><a href="/image/jpeg/reader.go.html#5414876">marker</a></span>&nbsp;<span class="op" id="5416277">==</span>&nbsp;<span class="ident" id="5416280"><a href="/image/jpeg/reader.go.html#5404139">sof2Marker</a></span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5416294"><a href="/image/jpeg/reader.go.html#5413591">err</a></span>&nbsp;<span class="op" id="5416298">=</span>&nbsp;<span class="ident" id="5416300"><a href="/image/jpeg/reader.go.html#5413225">d</a></span><span class="op" id="5416301">.</span><span class="ident" id="5416302">processSOF</span><span class="op" id="5416312">(</span><span class="ident" id="5416313"><a href="/image/jpeg/reader.go.html#5416057">n</a></span><span class="op" id="5416314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5416319">if</span>&nbsp;<span class="ident" id="5416322"><a href="/image/jpeg/reader.go.html#5413257">configOnly</a></span>&nbsp;<span class="op" id="5416333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5416339">return</span>&nbsp;<span class="ident" id="5416346">nil</span><span class="op" id="5416349">,</span>&nbsp;<span class="ident" id="5416351"><a href="/image/jpeg/reader.go.html#5413591">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5416358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5416362">case</span>&nbsp;<span class="ident" id="5416367"><a href="/image/jpeg/reader.go.html#5414876">marker</a></span>&nbsp;<span class="op" id="5416374">==</span>&nbsp;<span class="ident" id="5416377"><a href="/image/jpeg/reader.go.html#5404192">dhtMarker</a></span><span class="op" id="5416386">:</span>&nbsp;<span class="comment" id="5416388">//&nbsp;Define&nbsp;Huffman&nbsp;Table.</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5416416"><a href="/image/jpeg/reader.go.html#5413591">err</a></span>&nbsp;<span class="op" id="5416420">=</span>&nbsp;<span class="ident" id="5416422"><a href="/image/jpeg/reader.go.html#5413225">d</a></span><span class="op" id="5416423">.</span><span class="ident" id="5416424">processDHT</span><span class="op" id="5416434">(</span><span class="ident" id="5416435"><a href="/image/jpeg/reader.go.html#5416057">n</a></span><span class="op" id="5416436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5416440">case</span>&nbsp;<span class="ident" id="5416445"><a href="/image/jpeg/reader.go.html#5414876">marker</a></span>&nbsp;<span class="op" id="5416452">==</span>&nbsp;<span class="ident" id="5416455"><a href="/image/jpeg/reader.go.html#5404237">dqtMarker</a></span><span class="op" id="5416464">:</span>&nbsp;<span class="comment" id="5416466">//&nbsp;Define&nbsp;Quantization&nbsp;Table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5416499"><a href="/image/jpeg/reader.go.html#5413591">err</a></span>&nbsp;<span class="op" id="5416503">=</span>&nbsp;<span class="ident" id="5416505"><a href="/image/jpeg/reader.go.html#5413225">d</a></span><span class="op" id="5416506">.</span><span class="ident" id="5416507">processDQT</span><span class="op" id="5416517">(</span><span class="ident" id="5416518"><a href="/image/jpeg/reader.go.html#5416057">n</a></span><span class="op" id="5416519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5416523">case</span>&nbsp;<span class="ident" id="5416528"><a href="/image/jpeg/reader.go.html#5414876">marker</a></span>&nbsp;<span class="op" id="5416535">==</span>&nbsp;<span class="ident" id="5416538"><a href="/image/jpeg/reader.go.html#5404287">sosMarker</a></span><span class="op" id="5416547">:</span>&nbsp;<span class="comment" id="5416549">//&nbsp;Start&nbsp;Of&nbsp;Scan.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5416570"><a href="/image/jpeg/reader.go.html#5413591">err</a></span>&nbsp;<span class="op" id="5416574">=</span>&nbsp;<span class="ident" id="5416576"><a href="/image/jpeg/reader.go.html#5413225">d</a></span><span class="op" id="5416577">.</span><span class="ident" id="5416578">processSOS</span><span class="op" id="5416588">(</span><span class="ident" id="5416589"><a href="/image/jpeg/reader.go.html#5416057">n</a></span><span class="op" id="5416590">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5416594">case</span>&nbsp;<span class="ident" id="5416599"><a href="/image/jpeg/reader.go.html#5414876">marker</a></span>&nbsp;<span class="op" id="5416606">==</span>&nbsp;<span class="ident" id="5416609"><a href="/image/jpeg/reader.go.html#5404325">driMarker</a></span><span class="op" id="5416618">:</span>&nbsp;<span class="comment" id="5416620">//&nbsp;Define&nbsp;Restart&nbsp;Interval.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5416651"><a href="/image/jpeg/reader.go.html#5413591">err</a></span>&nbsp;<span class="op" id="5416655">=</span>&nbsp;<span class="ident" id="5416657"><a href="/image/jpeg/reader.go.html#5413225">d</a></span><span class="op" id="5416658">.</span><span class="ident" id="5416659">processDRI</span><span class="op" id="5416669">(</span><span class="ident" id="5416670"><a href="/image/jpeg/reader.go.html#5416057">n</a></span><span class="op" id="5416671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5416675">case</span>&nbsp;<span class="ident" id="5416680"><a href="/image/jpeg/reader.go.html#5404445">app0Marker</a></span>&nbsp;<span class="op" id="5416691">&lt;=</span>&nbsp;<span class="ident" id="5416694"><a href="/image/jpeg/reader.go.html#5414876">marker</a></span>&nbsp;<span class="op" id="5416701">&amp;&amp;</span>&nbsp;<span class="ident" id="5416704"><a href="/image/jpeg/reader.go.html#5414876">marker</a></span>&nbsp;<span class="op" id="5416711">&lt;=</span>&nbsp;<span class="ident" id="5416714"><a href="/image/jpeg/reader.go.html#5404494">app15Marker</a></span>&nbsp;<span class="op" id="5416726">||</span>&nbsp;<span class="ident" id="5416729"><a href="/image/jpeg/reader.go.html#5414876">marker</a></span>&nbsp;<span class="op" id="5416736">==</span>&nbsp;<span class="ident" id="5416739"><a href="/image/jpeg/reader.go.html#5404544">comMarker</a></span><span class="op" id="5416748">:</span>&nbsp;<span class="comment" id="5416750">//&nbsp;APPlication&nbsp;specific,&nbsp;or&nbsp;COMment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5416790"><a href="/image/jpeg/reader.go.html#5413591">err</a></span>&nbsp;<span class="op" id="5416794">=</span>&nbsp;<span class="ident" id="5416796"><a href="/image/jpeg/reader.go.html#5413225">d</a></span><span class="op" id="5416797">.</span><span class="ident" id="5416798">ignore</span><span class="op" id="5416804">(</span><span class="ident" id="5416805"><a href="/image/jpeg/reader.go.html#5416057">n</a></span><span class="op" id="5416806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5416810">default</span><span class="op" id="5416817">:</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5416822"><a href="/image/jpeg/reader.go.html#5413591">err</a></span>&nbsp;<span class="op" id="5416826">=</span>&nbsp;<span class="ident" id="5416828"><a href="/image/jpeg/reader.go.html#5403196">UnsupportedError</a></span><span class="op" id="5416844">(</span><span class="string" id="5416845">&#34;unknown&nbsp;marker&#34;</span><span class="op" id="5416861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5416865">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5416869">if</span>&nbsp;<span class="ident" id="5416872"><a href="/image/jpeg/reader.go.html#5413591">err</a></span>&nbsp;<span class="op" id="5416876">!=</span>&nbsp;<span class="ident" id="5416879">nil</span>&nbsp;<span class="op" id="5416883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5416888">return</span>&nbsp;<span class="ident" id="5416895">nil</span><span class="op" id="5416898">,</span>&nbsp;<span class="ident" id="5416900"><a href="/image/jpeg/reader.go.html#5413591">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5416906">}</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5416909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5416912">if</span>&nbsp;<span class="ident" id="5416915"><a href="/image/jpeg/reader.go.html#5413225">d</a></span><span class="op" id="5416916">.</span><span class="ident" id="5416917">img1</span>&nbsp;<span class="op" id="5416922">!=</span>&nbsp;<span class="ident" id="5416925">nil</span>&nbsp;<span class="op" id="5416929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5416933">return</span>&nbsp;<span class="ident" id="5416940"><a href="/image/jpeg/reader.go.html#5413225">d</a></span><span class="op" id="5416941">.</span><span class="ident" id="5416942">img1</span><span class="op" id="5416946">,</span>&nbsp;<span class="ident" id="5416948">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5416953">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5416956">if</span>&nbsp;<span class="ident" id="5416959"><a href="/image/jpeg/reader.go.html#5413225">d</a></span><span class="op" id="5416960">.</span><span class="ident" id="5416961">img3</span>&nbsp;<span class="op" id="5416966">!=</span>&nbsp;<span class="ident" id="5416969">nil</span>&nbsp;<span class="op" id="5416973">{</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5416977">return</span>&nbsp;<span class="ident" id="5416984"><a href="/image/jpeg/reader.go.html#5413225">d</a></span><span class="op" id="5416985">.</span><span class="ident" id="5416986">img3</span><span class="op" id="5416990">,</span>&nbsp;<span class="ident" id="5416992">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5416997">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5417000">return</span>&nbsp;<span class="ident" id="5417007">nil</span><span class="op" id="5417010">,</span>&nbsp;<span class="ident" id="5417012"><a href="/image/jpeg/reader.go.html#5402996">FormatError</a></span><span class="op" id="5417023">(</span><span class="string" id="5417024">&#34;missing&nbsp;SOS&nbsp;marker&#34;</span><span class="op" id="5417044">)</span><br>
<span class="lineno"></span><span class="op" id="5417046">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">495</span><span class="comment" id="5417049">//&nbsp;Decode&nbsp;reads&nbsp;a&nbsp;JPEG&nbsp;image&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;it&nbsp;as&nbsp;an&nbsp;image.Image.</span><br>
<span class="lineno"></span><span class="keyword" id="5417119">func</span>&nbsp;<span class="ident" id="5417124">Decode</span><span class="op" id="5417130">(</span><span class="ident" id="5417131">r</span>&nbsp;<span class="ident" id="5417133"><a href="/image/jpeg/reader.go.html#5402788">io</a></span><span class="op" id="5417135">.</span><span class="ident" id="5417136">Reader</span><span class="op" id="5417142">)</span>&nbsp;<span class="op" id="5417144">(</span><span class="ident" id="5417145"><a href="/image/jpeg/reader.go.html#5402764">image</a></span><span class="op" id="5417150">.</span><span class="ident" id="5417151">Image</span><span class="op" id="5417156">,</span>&nbsp;<span class="builtintype" id="5417158">error</span><span class="op" id="5417163">)</span>&nbsp;<span class="op" id="5417165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5417168">var</span>&nbsp;<span class="ident" id="5417172">d</span>&nbsp;<span class="ident" id="5417174"><a href="/image/jpeg/reader.go.html#5405509">decoder</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5417183">return</span>&nbsp;<span class="ident" id="5417190"><a href="/image/jpeg/reader.go.html#5417172">d</a></span><span class="op" id="5417191">.</span><span class="ident" id="5417192">decode</span><span class="op" id="5417198">(</span><span class="ident" id="5417199"><a href="/image/jpeg/reader.go.html#5417131">r</a></span><span class="op" id="5417200">,</span>&nbsp;<span class="ident" id="5417202">false</span><span class="op" id="5417207">)</span><br>
<span class="lineno"></span><span class="op" id="5417209">}</span><br>
<span class="lineno">500</span><br>
<span class="lineno"></span><span class="comment" id="5417212">//&nbsp;DecodeConfig&nbsp;returns&nbsp;the&nbsp;color&nbsp;model&nbsp;and&nbsp;dimensions&nbsp;of&nbsp;a&nbsp;JPEG&nbsp;image&nbsp;without</span><br>
<span class="lineno"></span><span class="comment" id="5417291">//&nbsp;decoding&nbsp;the&nbsp;entire&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5417321">func</span>&nbsp;<span class="ident" id="5417326">DecodeConfig</span><span class="op" id="5417338">(</span><span class="ident" id="5417339">r</span>&nbsp;<span class="ident" id="5417341"><a href="/image/jpeg/reader.go.html#5402788">io</a></span><span class="op" id="5417343">.</span><span class="ident" id="5417344">Reader</span><span class="op" id="5417350">)</span>&nbsp;<span class="op" id="5417352">(</span><span class="ident" id="5417353"><a href="/image/jpeg/reader.go.html#5402764">image</a></span><span class="op" id="5417358">.</span><span class="ident" id="5417359">Config</span><span class="op" id="5417365">,</span>&nbsp;<span class="builtintype" id="5417367">error</span><span class="op" id="5417372">)</span>&nbsp;<span class="op" id="5417374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5417377">var</span>&nbsp;<span class="ident" id="5417381">d</span>&nbsp;<span class="ident" id="5417383"><a href="/image/jpeg/reader.go.html#5405509">decoder</a></span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5417392">if</span>&nbsp;<span class="ident" id="5417395">_</span><span class="op" id="5417396">,</span>&nbsp;<span class="ident" id="5417398">err</span>&nbsp;<span class="op" id="5417402">:=</span>&nbsp;<span class="ident" id="5417405"><a href="/image/jpeg/reader.go.html#5417381">d</a></span><span class="op" id="5417406">.</span><span class="ident" id="5417407">decode</span><span class="op" id="5417413">(</span><span class="ident" id="5417414"><a href="/image/jpeg/reader.go.html#5417339">r</a></span><span class="op" id="5417415">,</span>&nbsp;<span class="ident" id="5417417">true</span><span class="op" id="5417421">)</span><span class="op" id="5417422">;</span>&nbsp;<span class="ident" id="5417424"><a href="/image/jpeg/reader.go.html#5417398">err</a></span>&nbsp;<span class="op" id="5417428">!=</span>&nbsp;<span class="ident" id="5417431">nil</span>&nbsp;<span class="op" id="5417435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5417439">return</span>&nbsp;<span class="ident" id="5417446"><a href="/image/jpeg/reader.go.html#5402764">image</a></span><span class="op" id="5417451">.</span><span class="ident" id="5417452">Config</span><span class="op" id="5417458">{</span><span class="op" id="5417459">}</span><span class="op" id="5417460">,</span>&nbsp;<span class="ident" id="5417462"><a href="/image/jpeg/reader.go.html#5417398">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5417467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5417470">switch</span>&nbsp;<span class="ident" id="5417477"><a href="/image/jpeg/reader.go.html#5417381">d</a></span><span class="op" id="5417478">.</span><span class="ident" id="5417479">nComp</span>&nbsp;<span class="op" id="5417485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5417488">case</span>&nbsp;<span class="ident" id="5417493"><a href="/image/jpeg/reader.go.html#5403693">nGrayComponent</a></span><span class="op" id="5417507">:</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5417511">return</span>&nbsp;<span class="ident" id="5417518"><a href="/image/jpeg/reader.go.html#5402764">image</a></span><span class="op" id="5417523">.</span><span class="ident" id="5417524">Config</span><span class="op" id="5417530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5417535">ColorModel</span><span class="op" id="5417545">:</span>&nbsp;<span class="ident" id="5417547"><a href="/image/jpeg/reader.go.html#5402773">color</a></span><span class="op" id="5417552">.</span><span class="ident" id="5417553">GrayModel</span><span class="op" id="5417562">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5417567">Width</span><span class="op" id="5417572">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5417579"><a href="/image/jpeg/reader.go.html#5417381">d</a></span><span class="op" id="5417580">.</span><span class="ident" id="5417581">width</span><span class="op" id="5417586">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5417591">Height</span><span class="op" id="5417597">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5417603"><a href="/image/jpeg/reader.go.html#5417381">d</a></span><span class="op" id="5417604">.</span><span class="ident" id="5417605">height</span><span class="op" id="5417611">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5417615">}</span><span class="op" id="5417616">,</span>&nbsp;<span class="ident" id="5417618">nil</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5417623">case</span>&nbsp;<span class="ident" id="5417628"><a href="/image/jpeg/reader.go.html#5403765">nColorComponent</a></span><span class="op" id="5417643">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5417647">return</span>&nbsp;<span class="ident" id="5417654"><a href="/image/jpeg/reader.go.html#5402764">image</a></span><span class="op" id="5417659">.</span><span class="ident" id="5417660">Config</span><span class="op" id="5417666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5417671">ColorModel</span><span class="op" id="5417681">:</span>&nbsp;<span class="ident" id="5417683"><a href="/image/jpeg/reader.go.html#5402773">color</a></span><span class="op" id="5417688">.</span><span class="ident" id="5417689">YCbCrModel</span><span class="op" id="5417699">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5417704">Width</span><span class="op" id="5417709">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5417716"><a href="/image/jpeg/reader.go.html#5417381">d</a></span><span class="op" id="5417717">.</span><span class="ident" id="5417718">width</span><span class="op" id="5417723">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5417728">Height</span><span class="op" id="5417734">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5417740"><a href="/image/jpeg/reader.go.html#5417381">d</a></span><span class="op" id="5417741">.</span><span class="ident" id="5417742">height</span><span class="op" id="5417748">,</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5417752">}</span><span class="op" id="5417753">,</span>&nbsp;<span class="ident" id="5417755">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5417760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5417763">return</span>&nbsp;<span class="ident" id="5417770"><a href="/image/jpeg/reader.go.html#5402764">image</a></span><span class="op" id="5417775">.</span><span class="ident" id="5417776">Config</span><span class="op" id="5417782">{</span><span class="op" id="5417783">}</span><span class="op" id="5417784">,</span>&nbsp;<span class="ident" id="5417786"><a href="/image/jpeg/reader.go.html#5402996">FormatError</a></span><span class="op" id="5417797">(</span><span class="string" id="5417798">&#34;missing&nbsp;SOF&nbsp;marker&#34;</span><span class="op" id="5417818">)</span><br>
<span class="lineno"></span><span class="op" id="5417820">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span><span class="keyword" id="5417823">func</span>&nbsp;<span class="ident" id="5417828">init</span><span class="op" id="5417832">(</span><span class="op" id="5417833">)</span>&nbsp;<span class="op" id="5417835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5417838"><a href="/image/jpeg/reader.go.html#5402764">image</a></span><span class="op" id="5417843">.</span><span class="ident" id="5417844">RegisterFormat</span><span class="op" id="5417858">(</span><span class="string" id="5417859">&#34;jpeg&#34;</span><span class="op" id="5417865">,</span>&nbsp;<span class="string" id="5417867">&#34;\xff\xd8&#34;</span><span class="op" id="5417877">,</span>&nbsp;<span class="ident" id="5417879"><a href="/image/jpeg/reader.go.html#5417124">Decode</a></span><span class="op" id="5417885">,</span>&nbsp;<span class="ident" id="5417887"><a href="/image/jpeg/reader.go.html#5417326">DecodeConfig</a></span><span class="op" id="5417899">)</span><br>
<span class="lineno"></span><span class="op" id="5417901">}</span>
</div>
</body>
</html>
