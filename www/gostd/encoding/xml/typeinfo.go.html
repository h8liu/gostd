<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/xml</h2>
<ul>
<li><a href="/gostd/encoding/xml/atom_test.go.html">atom_test.go</a></li>
<li><a href="/gostd/encoding/xml/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/xml/marshal.go.html">marshal.go</a></li>
<li><a href="/gostd/encoding/xml/marshal_test.go.html">marshal_test.go</a></li>
<li><a href="/gostd/encoding/xml/read.go.html">read.go</a></li>
<li><a href="/gostd/encoding/xml/read_test.go.html">read_test.go</a></li>
<li><a href="/gostd/encoding/xml/typeinfo.go.html" class="current">typeinfo.go</a></li>
<li><a href="/gostd/encoding/xml/xml.go.html">xml.go</a></li>
<li><a href="/gostd/encoding/xml/xml_test.go.html">xml_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6223990">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6224046">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6224100">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6224151">package</span>&nbsp;<span class="ident" id="6224159">xml</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6224164">import</span>&nbsp;<span class="op" id="6224171">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6224174">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6224181">&#34;reflect&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6224192">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6224203">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="6224210">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6224213">//&nbsp;typeInfo&nbsp;holds&nbsp;details&nbsp;for&nbsp;the&nbsp;xml&nbsp;representation&nbsp;of&nbsp;a&nbsp;type.</span><br>
<span class="lineno">15</span><span class="keyword" id="6224277">type</span>&nbsp;<span class="ident" id="6224282">typeInfo</span>&nbsp;<span class="keyword" id="6224291">struct</span>&nbsp;<span class="op" id="6224298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6224301">xmlname</span>&nbsp;<span class="op" id="6224309">*</span><span class="ident" id="6224310">fieldInfo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6224321">fields</span>&nbsp;&nbsp;<span class="op" id="6224329">[</span><span class="op" id="6224330">]</span><span class="ident" id="6224331">fieldInfo</span><br>
<span class="lineno"></span><span class="op" id="6224341">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="6224344">//&nbsp;fieldInfo&nbsp;holds&nbsp;details&nbsp;for&nbsp;the&nbsp;xml&nbsp;representation&nbsp;of&nbsp;a&nbsp;single&nbsp;field.</span><br>
<span class="lineno"></span><span class="keyword" id="6224417">type</span>&nbsp;<span class="ident" id="6224422">fieldInfo</span>&nbsp;<span class="keyword" id="6224432">struct</span>&nbsp;<span class="op" id="6224439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6224442">idx</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6224450">[</span><span class="op" id="6224451">]</span><span class="builtintype" id="6224452">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6224457">name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6224465">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6224473">xmlns</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6224481">string</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6224489">flags</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6224497">fieldFlags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6224509">parents</span>&nbsp;<span class="op" id="6224517">[</span><span class="op" id="6224518">]</span><span class="builtintype" id="6224519">string</span><br>
<span class="lineno"></span><span class="op" id="6224526">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6224529">type</span>&nbsp;<span class="ident" id="6224534">fieldFlags</span>&nbsp;<span class="builtintype" id="6224545">int</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="keyword" id="6224550">const</span>&nbsp;<span class="op" id="6224556">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6224559">fElement</span>&nbsp;<span class="ident" id="6224568">fieldFlags</span>&nbsp;<span class="op" id="6224579">=</span>&nbsp;<span class="num" id="6224581">1</span>&nbsp;<span class="op" id="6224583">&lt;&lt;</span>&nbsp;<span class="ident" id="6224586">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6224592">fAttr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6224599">fCharData</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6224610">fInnerXml</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6224621">fComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6224631">fAny</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6224638">fOmitEmpty</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6224651">fMode</span>&nbsp;<span class="op" id="6224657">=</span>&nbsp;<span class="ident" id="6224659">fElement</span>&nbsp;<span class="op" id="6224668">|</span>&nbsp;<span class="ident" id="6224670">fAttr</span>&nbsp;<span class="op" id="6224676">|</span>&nbsp;<span class="ident" id="6224678">fCharData</span>&nbsp;<span class="op" id="6224688">|</span>&nbsp;<span class="ident" id="6224690">fInnerXml</span>&nbsp;<span class="op" id="6224700">|</span>&nbsp;<span class="ident" id="6224702">fComment</span>&nbsp;<span class="op" id="6224711">|</span>&nbsp;<span class="ident" id="6224713">fAny</span><br>
<span class="lineno"></span><span class="op" id="6224718">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6224721">var</span>&nbsp;<span class="ident" id="6224725">tinfoMap</span>&nbsp;<span class="op" id="6224734">=</span>&nbsp;<span class="builtinfunc" id="6224736">make</span><span class="op" id="6224740">(</span><span class="keyword" id="6224741">map</span><span class="op" id="6224744">[</span><span class="ident" id="6224745">reflect</span><span class="op" id="6224752">.</span><span class="ident" id="6224753">Type</span><span class="op" id="6224757">]</span><span class="op" id="6224758">*</span><span class="ident" id="6224759">typeInfo</span><span class="op" id="6224767">)</span><br>
<span class="lineno">45</span><span class="keyword" id="6224769">var</span>&nbsp;<span class="ident" id="6224773">tinfoLock</span>&nbsp;<span class="ident" id="6224783">sync</span><span class="op" id="6224787">.</span><span class="ident" id="6224788">RWMutex</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6224797">var</span>&nbsp;<span class="ident" id="6224801">nameType</span>&nbsp;<span class="op" id="6224810">=</span>&nbsp;<span class="ident" id="6224812">reflect</span><span class="op" id="6224819">.</span><span class="ident" id="6224820">TypeOf</span><span class="op" id="6224826">(</span><span class="ident" id="6224827">Name</span><span class="op" id="6224831">{</span><span class="op" id="6224832">}</span><span class="op" id="6224833">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6224836">//&nbsp;getTypeInfo&nbsp;returns&nbsp;the&nbsp;typeInfo&nbsp;structure&nbsp;with&nbsp;details&nbsp;necessary</span><br>
<span class="lineno">50</span><span class="comment" id="6224905">//&nbsp;for&nbsp;marshalling&nbsp;and&nbsp;unmarshalling&nbsp;typ.</span><br>
<span class="lineno"></span><span class="keyword" id="6224947">func</span>&nbsp;<span class="ident" id="6224952">getTypeInfo</span><span class="op" id="6224963">(</span><span class="ident" id="6224964">typ</span>&nbsp;<span class="ident" id="6224968">reflect</span><span class="op" id="6224975">.</span><span class="ident" id="6224976">Type</span><span class="op" id="6224980">)</span>&nbsp;<span class="op" id="6224982">(</span><span class="op" id="6224983">*</span><span class="ident" id="6224984">typeInfo</span><span class="op" id="6224992">,</span>&nbsp;<span class="builtintype" id="6224994">error</span><span class="op" id="6224999">)</span>&nbsp;<span class="op" id="6225001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6225004">tinfoLock</span><span class="op" id="6225013">.</span><span class="ident" id="6225014">RLock</span><span class="op" id="6225019">(</span><span class="op" id="6225020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6225023">tinfo</span><span class="op" id="6225028">,</span>&nbsp;<span class="ident" id="6225030">ok</span>&nbsp;<span class="op" id="6225033">:=</span>&nbsp;<span class="ident" id="6225036">tinfoMap</span><span class="op" id="6225044">[</span><span class="ident" id="6225045">typ</span><span class="op" id="6225048">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6225051">tinfoLock</span><span class="op" id="6225060">.</span><span class="ident" id="6225061">RUnlock</span><span class="op" id="6225068">(</span><span class="op" id="6225069">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6225072">if</span>&nbsp;<span class="ident" id="6225075">ok</span>&nbsp;<span class="op" id="6225078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6225082">return</span>&nbsp;<span class="ident" id="6225089">tinfo</span><span class="op" id="6225094">,</span>&nbsp;<span class="builtintype" id="6225096">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6225101">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6225104">tinfo</span>&nbsp;<span class="op" id="6225110">=</span>&nbsp;<span class="op" id="6225112">&amp;</span><span class="ident" id="6225113">typeInfo</span><span class="op" id="6225121">{</span><span class="op" id="6225122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6225125">if</span>&nbsp;<span class="ident" id="6225128">typ</span><span class="op" id="6225131">.</span><span class="ident" id="6225132">Kind</span><span class="op" id="6225136">(</span><span class="op" id="6225137">)</span>&nbsp;<span class="op" id="6225139">==</span>&nbsp;<span class="ident" id="6225142">reflect</span><span class="op" id="6225149">.</span><span class="ident" id="6225150">Struct</span>&nbsp;<span class="op" id="6225157">&amp;&amp;</span>&nbsp;<span class="ident" id="6225160">typ</span>&nbsp;<span class="op" id="6225164">!=</span>&nbsp;<span class="ident" id="6225167">nameType</span>&nbsp;<span class="op" id="6225176">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6225180">n</span>&nbsp;<span class="op" id="6225182">:=</span>&nbsp;<span class="ident" id="6225185">typ</span><span class="op" id="6225188">.</span><span class="ident" id="6225189">NumField</span><span class="op" id="6225197">(</span><span class="op" id="6225198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6225202">for</span>&nbsp;<span class="ident" id="6225206">i</span>&nbsp;<span class="op" id="6225208">:=</span>&nbsp;<span class="num" id="6225211">0</span><span class="op" id="6225212">;</span>&nbsp;<span class="ident" id="6225214">i</span>&nbsp;<span class="op" id="6225216">&lt;</span>&nbsp;<span class="ident" id="6225218">n</span><span class="op" id="6225219">;</span>&nbsp;<span class="ident" id="6225221">i</span><span class="op" id="6225222">++</span>&nbsp;<span class="op" id="6225225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6225230">f</span>&nbsp;<span class="op" id="6225232">:=</span>&nbsp;<span class="ident" id="6225235">typ</span><span class="op" id="6225238">.</span><span class="ident" id="6225239">Field</span><span class="op" id="6225244">(</span><span class="ident" id="6225245">i</span><span class="op" id="6225246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6225251">if</span>&nbsp;<span class="ident" id="6225254">f</span><span class="op" id="6225255">.</span><span class="ident" id="6225256">PkgPath</span>&nbsp;<span class="op" id="6225264">!=</span>&nbsp;<span class="string" id="6225267">&#34;&#34;</span>&nbsp;<span class="op" id="6225270">||</span>&nbsp;<span class="ident" id="6225273">f</span><span class="op" id="6225274">.</span><span class="ident" id="6225275">Tag</span><span class="op" id="6225278">.</span><span class="ident" id="6225279">Get</span><span class="op" id="6225282">(</span><span class="string" id="6225283">&#34;xml&#34;</span><span class="op" id="6225288">)</span>&nbsp;<span class="op" id="6225290">==</span>&nbsp;<span class="string" id="6225293">&#34;-&#34;</span>&nbsp;<span class="op" id="6225297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6225303">continue</span>&nbsp;<span class="comment" id="6225312">//&nbsp;Private&nbsp;field</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6225332">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6225338">//&nbsp;For&nbsp;embedded&nbsp;structs,&nbsp;embed&nbsp;its&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6225384">if</span>&nbsp;<span class="ident" id="6225387">f</span><span class="op" id="6225388">.</span><span class="ident" id="6225389">Anonymous</span>&nbsp;<span class="op" id="6225399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6225405">t</span>&nbsp;<span class="op" id="6225407">:=</span>&nbsp;<span class="ident" id="6225410">f</span><span class="op" id="6225411">.</span><span class="ident" id="6225412">Type</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6225421">if</span>&nbsp;<span class="ident" id="6225424">t</span><span class="op" id="6225425">.</span><span class="ident" id="6225426">Kind</span><span class="op" id="6225430">(</span><span class="op" id="6225431">)</span>&nbsp;<span class="op" id="6225433">==</span>&nbsp;<span class="ident" id="6225436">reflect</span><span class="op" id="6225443">.</span><span class="ident" id="6225444">Ptr</span>&nbsp;<span class="op" id="6225448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6225455">t</span>&nbsp;<span class="op" id="6225457">=</span>&nbsp;<span class="ident" id="6225459">t</span><span class="op" id="6225460">.</span><span class="ident" id="6225461">Elem</span><span class="op" id="6225465">(</span><span class="op" id="6225466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6225472">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6225478">if</span>&nbsp;<span class="ident" id="6225481">t</span><span class="op" id="6225482">.</span><span class="ident" id="6225483">Kind</span><span class="op" id="6225487">(</span><span class="op" id="6225488">)</span>&nbsp;<span class="op" id="6225490">==</span>&nbsp;<span class="ident" id="6225493">reflect</span><span class="op" id="6225500">.</span><span class="ident" id="6225501">Struct</span>&nbsp;<span class="op" id="6225508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6225515">inner</span><span class="op" id="6225520">,</span>&nbsp;<span class="ident" id="6225522">err</span>&nbsp;<span class="op" id="6225526">:=</span>&nbsp;<span class="ident" id="6225529">getTypeInfo</span><span class="op" id="6225540">(</span><span class="ident" id="6225541">t</span><span class="op" id="6225542">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6225549">if</span>&nbsp;<span class="ident" id="6225552">err</span>&nbsp;<span class="op" id="6225556">!=</span>&nbsp;<span class="builtintype" id="6225559">nil</span>&nbsp;<span class="op" id="6225563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6225571">return</span>&nbsp;<span class="builtintype" id="6225578">nil</span><span class="op" id="6225581">,</span>&nbsp;<span class="ident" id="6225583">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6225592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6225599">if</span>&nbsp;<span class="ident" id="6225602">tinfo</span><span class="op" id="6225607">.</span><span class="ident" id="6225608">xmlname</span>&nbsp;<span class="op" id="6225616">==</span>&nbsp;<span class="builtintype" id="6225619">nil</span>&nbsp;<span class="op" id="6225623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6225631">tinfo</span><span class="op" id="6225636">.</span><span class="ident" id="6225637">xmlname</span>&nbsp;<span class="op" id="6225645">=</span>&nbsp;<span class="ident" id="6225647">inner</span><span class="op" id="6225652">.</span><span class="ident" id="6225653">xmlname</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6225666">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6225673">for</span>&nbsp;<span class="ident" id="6225677">_</span><span class="op" id="6225678">,</span>&nbsp;<span class="ident" id="6225680">finfo</span>&nbsp;<span class="op" id="6225686">:=</span>&nbsp;<span class="keyword" id="6225689">range</span>&nbsp;<span class="ident" id="6225695">inner</span><span class="op" id="6225700">.</span><span class="ident" id="6225701">fields</span>&nbsp;<span class="op" id="6225708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6225716">finfo</span><span class="op" id="6225721">.</span><span class="ident" id="6225722">idx</span>&nbsp;<span class="op" id="6225726">=</span>&nbsp;<span class="builtinfunc" id="6225728">append</span><span class="op" id="6225734">(</span><span class="op" id="6225735">[</span><span class="op" id="6225736">]</span><span class="builtintype" id="6225737">int</span><span class="op" id="6225740">{</span><span class="ident" id="6225741">i</span><span class="op" id="6225742">}</span><span class="op" id="6225743">,</span>&nbsp;<span class="ident" id="6225745">finfo</span><span class="op" id="6225750">.</span><span class="ident" id="6225751">idx</span><span class="op" id="6225754">...</span><span class="op" id="6225757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6225765">if</span>&nbsp;<span class="ident" id="6225768">err</span>&nbsp;<span class="op" id="6225772">:=</span>&nbsp;<span class="ident" id="6225775">addFieldInfo</span><span class="op" id="6225787">(</span><span class="ident" id="6225788">typ</span><span class="op" id="6225791">,</span>&nbsp;<span class="ident" id="6225793">tinfo</span><span class="op" id="6225798">,</span>&nbsp;<span class="op" id="6225800">&amp;</span><span class="ident" id="6225801">finfo</span><span class="op" id="6225806">)</span><span class="op" id="6225807">;</span>&nbsp;<span class="ident" id="6225809">err</span>&nbsp;<span class="op" id="6225813">!=</span>&nbsp;<span class="builtintype" id="6225816">nil</span>&nbsp;<span class="op" id="6225820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6225829">return</span>&nbsp;<span class="builtintype" id="6225836">nil</span><span class="op" id="6225839">,</span>&nbsp;<span class="ident" id="6225841">err</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6225851">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6225858">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6225865">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6225878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6225883">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6225889">finfo</span><span class="op" id="6225894">,</span>&nbsp;<span class="ident" id="6225896">err</span>&nbsp;<span class="op" id="6225900">:=</span>&nbsp;<span class="ident" id="6225903">structFieldInfo</span><span class="op" id="6225918">(</span><span class="ident" id="6225919">typ</span><span class="op" id="6225922">,</span>&nbsp;<span class="op" id="6225924">&amp;</span><span class="ident" id="6225925">f</span><span class="op" id="6225926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6225931">if</span>&nbsp;<span class="ident" id="6225934">err</span>&nbsp;<span class="op" id="6225938">!=</span>&nbsp;<span class="builtintype" id="6225941">nil</span>&nbsp;<span class="op" id="6225945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6225951">return</span>&nbsp;<span class="builtintype" id="6225958">nil</span><span class="op" id="6225961">,</span>&nbsp;<span class="ident" id="6225963">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6225970">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6225976">if</span>&nbsp;<span class="ident" id="6225979">f</span><span class="op" id="6225980">.</span><span class="ident" id="6225981">Name</span>&nbsp;<span class="op" id="6225986">==</span>&nbsp;<span class="string" id="6225989">&#34;XMLName&#34;</span>&nbsp;<span class="op" id="6225999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6226005">tinfo</span><span class="op" id="6226010">.</span><span class="ident" id="6226011">xmlname</span>&nbsp;<span class="op" id="6226019">=</span>&nbsp;<span class="ident" id="6226021">finfo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6226031">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6226043">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6226049">//&nbsp;Add&nbsp;the&nbsp;field&nbsp;if&nbsp;it&nbsp;doesn&#39;t&nbsp;conflict&nbsp;with&nbsp;other&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6226111">if</span>&nbsp;<span class="ident" id="6226114">err</span>&nbsp;<span class="op" id="6226118">:=</span>&nbsp;<span class="ident" id="6226121">addFieldInfo</span><span class="op" id="6226133">(</span><span class="ident" id="6226134">typ</span><span class="op" id="6226137">,</span>&nbsp;<span class="ident" id="6226139">tinfo</span><span class="op" id="6226144">,</span>&nbsp;<span class="ident" id="6226146">finfo</span><span class="op" id="6226151">)</span><span class="op" id="6226152">;</span>&nbsp;<span class="ident" id="6226154">err</span>&nbsp;<span class="op" id="6226158">!=</span>&nbsp;<span class="builtintype" id="6226161">nil</span>&nbsp;<span class="op" id="6226165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6226171">return</span>&nbsp;<span class="builtintype" id="6226178">nil</span><span class="op" id="6226181">,</span>&nbsp;<span class="ident" id="6226183">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6226190">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6226194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6226197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6226200">tinfoLock</span><span class="op" id="6226209">.</span><span class="ident" id="6226210">Lock</span><span class="op" id="6226214">(</span><span class="op" id="6226215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6226218">tinfoMap</span><span class="op" id="6226226">[</span><span class="ident" id="6226227">typ</span><span class="op" id="6226230">]</span>&nbsp;<span class="op" id="6226232">=</span>&nbsp;<span class="ident" id="6226234">tinfo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6226241">tinfoLock</span><span class="op" id="6226250">.</span><span class="ident" id="6226251">Unlock</span><span class="op" id="6226257">(</span><span class="op" id="6226258">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6226261">return</span>&nbsp;<span class="ident" id="6226268">tinfo</span><span class="op" id="6226273">,</span>&nbsp;<span class="builtintype" id="6226275">nil</span><br>
<span class="lineno"></span><span class="op" id="6226279">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6226282">//&nbsp;structFieldInfo&nbsp;builds&nbsp;and&nbsp;returns&nbsp;a&nbsp;fieldInfo&nbsp;for&nbsp;f.</span><br>
<span class="lineno"></span><span class="keyword" id="6226339">func</span>&nbsp;<span class="ident" id="6226344">structFieldInfo</span><span class="op" id="6226359">(</span><span class="ident" id="6226360">typ</span>&nbsp;<span class="ident" id="6226364">reflect</span><span class="op" id="6226371">.</span><span class="ident" id="6226372">Type</span><span class="op" id="6226376">,</span>&nbsp;<span class="ident" id="6226378">f</span>&nbsp;<span class="op" id="6226380">*</span><span class="ident" id="6226381">reflect</span><span class="op" id="6226388">.</span><span class="ident" id="6226389">StructField</span><span class="op" id="6226400">)</span>&nbsp;<span class="op" id="6226402">(</span><span class="op" id="6226403">*</span><span class="ident" id="6226404">fieldInfo</span><span class="op" id="6226413">,</span>&nbsp;<span class="builtintype" id="6226415">error</span><span class="op" id="6226420">)</span>&nbsp;<span class="op" id="6226422">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6226425">finfo</span>&nbsp;<span class="op" id="6226431">:=</span>&nbsp;<span class="op" id="6226434">&amp;</span><span class="ident" id="6226435">fieldInfo</span><span class="op" id="6226444">{</span><span class="ident" id="6226445">idx</span><span class="op" id="6226448">:</span>&nbsp;<span class="ident" id="6226450">f</span><span class="op" id="6226451">.</span><span class="ident" id="6226452">Index</span><span class="op" id="6226457">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6226461">//&nbsp;Split&nbsp;the&nbsp;tag&nbsp;from&nbsp;the&nbsp;xml&nbsp;namespace&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6226516">tag</span>&nbsp;<span class="op" id="6226520">:=</span>&nbsp;<span class="ident" id="6226523">f</span><span class="op" id="6226524">.</span><span class="ident" id="6226525">Tag</span><span class="op" id="6226528">.</span><span class="ident" id="6226529">Get</span><span class="op" id="6226532">(</span><span class="string" id="6226533">&#34;xml&#34;</span><span class="op" id="6226538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6226541">if</span>&nbsp;<span class="ident" id="6226544">i</span>&nbsp;<span class="op" id="6226546">:=</span>&nbsp;<span class="ident" id="6226549">strings</span><span class="op" id="6226556">.</span><span class="ident" id="6226557">Index</span><span class="op" id="6226562">(</span><span class="ident" id="6226563">tag</span><span class="op" id="6226566">,</span>&nbsp;<span class="string" id="6226568">&#34;&nbsp;&#34;</span><span class="op" id="6226571">)</span><span class="op" id="6226572">;</span>&nbsp;<span class="ident" id="6226574">i</span>&nbsp;<span class="op" id="6226576">&gt;=</span>&nbsp;<span class="num" id="6226579">0</span>&nbsp;<span class="op" id="6226581">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6226585">finfo</span><span class="op" id="6226590">.</span><span class="ident" id="6226591">xmlns</span><span class="op" id="6226596">,</span>&nbsp;<span class="ident" id="6226598">tag</span>&nbsp;<span class="op" id="6226602">=</span>&nbsp;<span class="ident" id="6226604">tag</span><span class="op" id="6226607">[</span><span class="op" id="6226608">:</span><span class="ident" id="6226609">i</span><span class="op" id="6226610">]</span><span class="op" id="6226611">,</span>&nbsp;<span class="ident" id="6226613">tag</span><span class="op" id="6226616">[</span><span class="ident" id="6226617">i</span><span class="op" id="6226618">+</span><span class="num" id="6226619">1</span><span class="op" id="6226620">:</span><span class="op" id="6226621">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6226624">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6226628">//&nbsp;Parse&nbsp;flags.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6226645">tokens</span>&nbsp;<span class="op" id="6226652">:=</span>&nbsp;<span class="ident" id="6226655">strings</span><span class="op" id="6226662">.</span><span class="ident" id="6226663">Split</span><span class="op" id="6226668">(</span><span class="ident" id="6226669">tag</span><span class="op" id="6226672">,</span>&nbsp;<span class="string" id="6226674">&#34;,&#34;</span><span class="op" id="6226677">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6226680">if</span>&nbsp;<span class="builtinfunc" id="6226683">len</span><span class="op" id="6226686">(</span><span class="ident" id="6226687">tokens</span><span class="op" id="6226693">)</span>&nbsp;<span class="op" id="6226695">==</span>&nbsp;<span class="num" id="6226698">1</span>&nbsp;<span class="op" id="6226700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6226704">finfo</span><span class="op" id="6226709">.</span><span class="ident" id="6226710">flags</span>&nbsp;<span class="op" id="6226716">=</span>&nbsp;<span class="ident" id="6226718">fElement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6226728">}</span>&nbsp;<span class="keyword" id="6226730">else</span>&nbsp;<span class="op" id="6226735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6226739">tag</span>&nbsp;<span class="op" id="6226743">=</span>&nbsp;<span class="ident" id="6226745">tokens</span><span class="op" id="6226751">[</span><span class="num" id="6226752">0</span><span class="op" id="6226753">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6226757">for</span>&nbsp;<span class="ident" id="6226761">_</span><span class="op" id="6226762">,</span>&nbsp;<span class="ident" id="6226764">flag</span>&nbsp;<span class="op" id="6226769">:=</span>&nbsp;<span class="keyword" id="6226772">range</span>&nbsp;<span class="ident" id="6226778">tokens</span><span class="op" id="6226784">[</span><span class="num" id="6226785">1</span><span class="op" id="6226786">:</span><span class="op" id="6226787">]</span>&nbsp;<span class="op" id="6226789">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6226794">switch</span>&nbsp;<span class="ident" id="6226801">flag</span>&nbsp;<span class="op" id="6226806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6226811">case</span>&nbsp;<span class="string" id="6226816">&#34;attr&#34;</span><span class="op" id="6226822">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6226828">finfo</span><span class="op" id="6226833">.</span><span class="ident" id="6226834">flags</span>&nbsp;<span class="op" id="6226840">|=</span>&nbsp;<span class="ident" id="6226843">fAttr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6226852">case</span>&nbsp;<span class="string" id="6226857">&#34;chardata&#34;</span><span class="op" id="6226867">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6226873">finfo</span><span class="op" id="6226878">.</span><span class="ident" id="6226879">flags</span>&nbsp;<span class="op" id="6226885">|=</span>&nbsp;<span class="ident" id="6226888">fCharData</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6226901">case</span>&nbsp;<span class="string" id="6226906">&#34;innerxml&#34;</span><span class="op" id="6226916">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6226922">finfo</span><span class="op" id="6226927">.</span><span class="ident" id="6226928">flags</span>&nbsp;<span class="op" id="6226934">|=</span>&nbsp;<span class="ident" id="6226937">fInnerXml</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6226950">case</span>&nbsp;<span class="string" id="6226955">&#34;comment&#34;</span><span class="op" id="6226964">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6226970">finfo</span><span class="op" id="6226975">.</span><span class="ident" id="6226976">flags</span>&nbsp;<span class="op" id="6226982">|=</span>&nbsp;<span class="ident" id="6226985">fComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6226997">case</span>&nbsp;<span class="string" id="6227002">&#34;any&#34;</span><span class="op" id="6227007">:</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6227013">finfo</span><span class="op" id="6227018">.</span><span class="ident" id="6227019">flags</span>&nbsp;<span class="op" id="6227025">|=</span>&nbsp;<span class="ident" id="6227028">fAny</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6227036">case</span>&nbsp;<span class="string" id="6227041">&#34;omitempty&#34;</span><span class="op" id="6227052">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6227058">finfo</span><span class="op" id="6227063">.</span><span class="ident" id="6227064">flags</span>&nbsp;<span class="op" id="6227070">|=</span>&nbsp;<span class="ident" id="6227073">fOmitEmpty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6227087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6227091">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6227096">//&nbsp;Validate&nbsp;the&nbsp;flags&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6227126">valid</span>&nbsp;<span class="op" id="6227132">:=</span>&nbsp;<span class="builtintype" id="6227135">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6227142">switch</span>&nbsp;<span class="ident" id="6227149">mode</span>&nbsp;<span class="op" id="6227154">:=</span>&nbsp;<span class="ident" id="6227157">finfo</span><span class="op" id="6227162">.</span><span class="ident" id="6227163">flags</span>&nbsp;<span class="op" id="6227169">&amp;</span>&nbsp;<span class="ident" id="6227171">fMode</span><span class="op" id="6227176">;</span>&nbsp;<span class="ident" id="6227178">mode</span>&nbsp;<span class="op" id="6227183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6227187">case</span>&nbsp;<span class="num" id="6227192">0</span><span class="op" id="6227193">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6227198">finfo</span><span class="op" id="6227203">.</span><span class="ident" id="6227204">flags</span>&nbsp;<span class="op" id="6227210">|=</span>&nbsp;<span class="ident" id="6227213">fElement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6227224">case</span>&nbsp;<span class="ident" id="6227229">fAttr</span><span class="op" id="6227234">,</span>&nbsp;<span class="ident" id="6227236">fCharData</span><span class="op" id="6227245">,</span>&nbsp;<span class="ident" id="6227247">fInnerXml</span><span class="op" id="6227256">,</span>&nbsp;<span class="ident" id="6227258">fComment</span><span class="op" id="6227266">,</span>&nbsp;<span class="ident" id="6227268">fAny</span><span class="op" id="6227272">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6227277">if</span>&nbsp;<span class="ident" id="6227280">f</span><span class="op" id="6227281">.</span><span class="ident" id="6227282">Name</span>&nbsp;<span class="op" id="6227287">==</span>&nbsp;<span class="string" id="6227290">&#34;XMLName&#34;</span>&nbsp;<span class="op" id="6227300">||</span>&nbsp;<span class="ident" id="6227303">tag</span>&nbsp;<span class="op" id="6227307">!=</span>&nbsp;<span class="string" id="6227310">&#34;&#34;</span>&nbsp;<span class="op" id="6227313">&amp;&amp;</span>&nbsp;<span class="ident" id="6227316">mode</span>&nbsp;<span class="op" id="6227321">!=</span>&nbsp;<span class="ident" id="6227324">fAttr</span>&nbsp;<span class="op" id="6227330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6227336">valid</span>&nbsp;<span class="op" id="6227342">=</span>&nbsp;<span class="builtintype" id="6227344">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6227353">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6227357">default</span><span class="op" id="6227364">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6227369">//&nbsp;This&nbsp;will&nbsp;also&nbsp;catch&nbsp;multiple&nbsp;modes&nbsp;in&nbsp;a&nbsp;single&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6227430">valid</span>&nbsp;<span class="op" id="6227436">=</span>&nbsp;<span class="builtintype" id="6227438">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6227446">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6227450">if</span>&nbsp;<span class="ident" id="6227453">finfo</span><span class="op" id="6227458">.</span><span class="ident" id="6227459">flags</span><span class="op" id="6227464">&amp;</span><span class="ident" id="6227465">fMode</span>&nbsp;<span class="op" id="6227471">==</span>&nbsp;<span class="ident" id="6227474">fAny</span>&nbsp;<span class="op" id="6227479">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6227484">finfo</span><span class="op" id="6227489">.</span><span class="ident" id="6227490">flags</span>&nbsp;<span class="op" id="6227496">|=</span>&nbsp;<span class="ident" id="6227499">fElement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6227510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6227514">if</span>&nbsp;<span class="ident" id="6227517">finfo</span><span class="op" id="6227522">.</span><span class="ident" id="6227523">flags</span><span class="op" id="6227528">&amp;</span><span class="ident" id="6227529">fOmitEmpty</span>&nbsp;<span class="op" id="6227540">!=</span>&nbsp;<span class="num" id="6227543">0</span>&nbsp;<span class="op" id="6227545">&amp;&amp;</span>&nbsp;<span class="ident" id="6227548">finfo</span><span class="op" id="6227553">.</span><span class="ident" id="6227554">flags</span><span class="op" id="6227559">&amp;</span><span class="op" id="6227560">(</span><span class="ident" id="6227561">fElement</span><span class="op" id="6227569">|</span><span class="ident" id="6227570">fAttr</span><span class="op" id="6227575">)</span>&nbsp;<span class="op" id="6227577">==</span>&nbsp;<span class="num" id="6227580">0</span>&nbsp;<span class="op" id="6227582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6227587">valid</span>&nbsp;<span class="op" id="6227593">=</span>&nbsp;<span class="builtintype" id="6227595">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6227603">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6227607">if</span>&nbsp;<span class="op" id="6227610">!</span><span class="ident" id="6227611">valid</span>&nbsp;<span class="op" id="6227617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6227622">return</span>&nbsp;<span class="builtintype" id="6227629">nil</span><span class="op" id="6227632">,</span>&nbsp;<span class="ident" id="6227634">fmt</span><span class="op" id="6227637">.</span><span class="ident" id="6227638">Errorf</span><span class="op" id="6227644">(</span><span class="string" id="6227645">&#34;xml:&nbsp;invalid&nbsp;tag&nbsp;in&nbsp;field&nbsp;%s&nbsp;of&nbsp;type&nbsp;%s:&nbsp;%q&#34;</span><span class="op" id="6227690">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6227696">f</span><span class="op" id="6227697">.</span><span class="ident" id="6227698">Name</span><span class="op" id="6227702">,</span>&nbsp;<span class="ident" id="6227704">typ</span><span class="op" id="6227707">,</span>&nbsp;<span class="ident" id="6227709">f</span><span class="op" id="6227710">.</span><span class="ident" id="6227711">Tag</span><span class="op" id="6227714">.</span><span class="ident" id="6227715">Get</span><span class="op" id="6227718">(</span><span class="string" id="6227719">&#34;xml&#34;</span><span class="op" id="6227724">)</span><span class="op" id="6227725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6227729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6227732">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6227736">//&nbsp;Use&nbsp;of&nbsp;xmlns&nbsp;without&nbsp;a&nbsp;name&nbsp;is&nbsp;not&nbsp;allowed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6227784">if</span>&nbsp;<span class="ident" id="6227787">finfo</span><span class="op" id="6227792">.</span><span class="ident" id="6227793">xmlns</span>&nbsp;<span class="op" id="6227799">!=</span>&nbsp;<span class="string" id="6227802">&#34;&#34;</span>&nbsp;<span class="op" id="6227805">&amp;&amp;</span>&nbsp;<span class="ident" id="6227808">tag</span>&nbsp;<span class="op" id="6227812">==</span>&nbsp;<span class="string" id="6227815">&#34;&#34;</span>&nbsp;<span class="op" id="6227818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6227822">return</span>&nbsp;<span class="builtintype" id="6227829">nil</span><span class="op" id="6227832">,</span>&nbsp;<span class="ident" id="6227834">fmt</span><span class="op" id="6227837">.</span><span class="ident" id="6227838">Errorf</span><span class="op" id="6227844">(</span><span class="string" id="6227845">&#34;xml:&nbsp;namespace&nbsp;without&nbsp;name&nbsp;in&nbsp;field&nbsp;%s&nbsp;of&nbsp;type&nbsp;%s:&nbsp;%q&#34;</span><span class="op" id="6227901">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6227906">f</span><span class="op" id="6227907">.</span><span class="ident" id="6227908">Name</span><span class="op" id="6227912">,</span>&nbsp;<span class="ident" id="6227914">typ</span><span class="op" id="6227917">,</span>&nbsp;<span class="ident" id="6227919">f</span><span class="op" id="6227920">.</span><span class="ident" id="6227921">Tag</span><span class="op" id="6227924">.</span><span class="ident" id="6227925">Get</span><span class="op" id="6227928">(</span><span class="string" id="6227929">&#34;xml&#34;</span><span class="op" id="6227934">)</span><span class="op" id="6227935">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6227938">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6227942">if</span>&nbsp;<span class="ident" id="6227945">f</span><span class="op" id="6227946">.</span><span class="ident" id="6227947">Name</span>&nbsp;<span class="op" id="6227952">==</span>&nbsp;<span class="string" id="6227955">&#34;XMLName&#34;</span>&nbsp;<span class="op" id="6227965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6227969">//&nbsp;The&nbsp;XMLName&nbsp;field&nbsp;records&nbsp;the&nbsp;XML&nbsp;element&nbsp;name.&nbsp;Don&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6228028">//&nbsp;process&nbsp;it&nbsp;as&nbsp;usual&nbsp;because&nbsp;its&nbsp;name&nbsp;should&nbsp;default&nbsp;to</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6228088">//&nbsp;empty&nbsp;rather&nbsp;than&nbsp;to&nbsp;the&nbsp;field&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6228130">finfo</span><span class="op" id="6228135">.</span><span class="ident" id="6228136">name</span>&nbsp;<span class="op" id="6228141">=</span>&nbsp;<span class="ident" id="6228143">tag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6228149">return</span>&nbsp;<span class="ident" id="6228156">finfo</span><span class="op" id="6228161">,</span>&nbsp;<span class="builtintype" id="6228163">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6228168">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6228172">if</span>&nbsp;<span class="ident" id="6228175">tag</span>&nbsp;<span class="op" id="6228179">==</span>&nbsp;<span class="string" id="6228182">&#34;&#34;</span>&nbsp;<span class="op" id="6228185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6228189">//&nbsp;If&nbsp;the&nbsp;name&nbsp;part&nbsp;of&nbsp;the&nbsp;tag&nbsp;is&nbsp;completely&nbsp;empty,&nbsp;get</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6228247">//&nbsp;default&nbsp;from&nbsp;XMLName&nbsp;of&nbsp;underlying&nbsp;struct&nbsp;if&nbsp;feasible,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6228307">//&nbsp;or&nbsp;field&nbsp;name&nbsp;otherwise.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6228337">if</span>&nbsp;<span class="ident" id="6228340">xmlname</span>&nbsp;<span class="op" id="6228348">:=</span>&nbsp;<span class="ident" id="6228351">lookupXMLName</span><span class="op" id="6228364">(</span><span class="ident" id="6228365">f</span><span class="op" id="6228366">.</span><span class="ident" id="6228367">Type</span><span class="op" id="6228371">)</span><span class="op" id="6228372">;</span>&nbsp;<span class="ident" id="6228374">xmlname</span>&nbsp;<span class="op" id="6228382">!=</span>&nbsp;<span class="builtintype" id="6228385">nil</span>&nbsp;<span class="op" id="6228389">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6228394">finfo</span><span class="op" id="6228399">.</span><span class="ident" id="6228400">xmlns</span><span class="op" id="6228405">,</span>&nbsp;<span class="ident" id="6228407">finfo</span><span class="op" id="6228412">.</span><span class="ident" id="6228413">name</span>&nbsp;<span class="op" id="6228418">=</span>&nbsp;<span class="ident" id="6228420">xmlname</span><span class="op" id="6228427">.</span><span class="ident" id="6228428">xmlns</span><span class="op" id="6228433">,</span>&nbsp;<span class="ident" id="6228435">xmlname</span><span class="op" id="6228442">.</span><span class="ident" id="6228443">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6228450">}</span>&nbsp;<span class="keyword" id="6228452">else</span>&nbsp;<span class="op" id="6228457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6228462">finfo</span><span class="op" id="6228467">.</span><span class="ident" id="6228468">name</span>&nbsp;<span class="op" id="6228473">=</span>&nbsp;<span class="ident" id="6228475">f</span><span class="op" id="6228476">.</span><span class="ident" id="6228477">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6228484">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6228488">return</span>&nbsp;<span class="ident" id="6228495">finfo</span><span class="op" id="6228500">,</span>&nbsp;<span class="builtintype" id="6228502">nil</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6228507">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6228511">//&nbsp;Prepare&nbsp;field&nbsp;name&nbsp;and&nbsp;parents.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6228547">parents</span>&nbsp;<span class="op" id="6228555">:=</span>&nbsp;<span class="ident" id="6228558">strings</span><span class="op" id="6228565">.</span><span class="ident" id="6228566">Split</span><span class="op" id="6228571">(</span><span class="ident" id="6228572">tag</span><span class="op" id="6228575">,</span>&nbsp;<span class="string" id="6228577">&#34;&gt;&#34;</span><span class="op" id="6228580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6228583">if</span>&nbsp;<span class="ident" id="6228586">parents</span><span class="op" id="6228593">[</span><span class="num" id="6228594">0</span><span class="op" id="6228595">]</span>&nbsp;<span class="op" id="6228597">==</span>&nbsp;<span class="string" id="6228600">&#34;&#34;</span>&nbsp;<span class="op" id="6228603">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6228607">parents</span><span class="op" id="6228614">[</span><span class="num" id="6228615">0</span><span class="op" id="6228616">]</span>&nbsp;<span class="op" id="6228618">=</span>&nbsp;<span class="ident" id="6228620">f</span><span class="op" id="6228621">.</span><span class="ident" id="6228622">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6228628">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6228631">if</span>&nbsp;<span class="ident" id="6228634">parents</span><span class="op" id="6228641">[</span><span class="builtinfunc" id="6228642">len</span><span class="op" id="6228645">(</span><span class="ident" id="6228646">parents</span><span class="op" id="6228653">)</span><span class="op" id="6228654">-</span><span class="num" id="6228655">1</span><span class="op" id="6228656">]</span>&nbsp;<span class="op" id="6228658">==</span>&nbsp;<span class="string" id="6228661">&#34;&#34;</span>&nbsp;<span class="op" id="6228664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6228668">return</span>&nbsp;<span class="builtintype" id="6228675">nil</span><span class="op" id="6228678">,</span>&nbsp;<span class="ident" id="6228680">fmt</span><span class="op" id="6228683">.</span><span class="ident" id="6228684">Errorf</span><span class="op" id="6228690">(</span><span class="string" id="6228691">&#34;xml:&nbsp;trailing&nbsp;&#39;&gt;&#39;&nbsp;in&nbsp;field&nbsp;%s&nbsp;of&nbsp;type&nbsp;%s&#34;</span><span class="op" id="6228733">,</span>&nbsp;<span class="ident" id="6228735">f</span><span class="op" id="6228736">.</span><span class="ident" id="6228737">Name</span><span class="op" id="6228741">,</span>&nbsp;<span class="ident" id="6228743">typ</span><span class="op" id="6228746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6228749">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6228752">finfo</span><span class="op" id="6228757">.</span><span class="ident" id="6228758">name</span>&nbsp;<span class="op" id="6228763">=</span>&nbsp;<span class="ident" id="6228765">parents</span><span class="op" id="6228772">[</span><span class="builtinfunc" id="6228773">len</span><span class="op" id="6228776">(</span><span class="ident" id="6228777">parents</span><span class="op" id="6228784">)</span><span class="op" id="6228785">-</span><span class="num" id="6228786">1</span><span class="op" id="6228787">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6228790">if</span>&nbsp;<span class="builtinfunc" id="6228793">len</span><span class="op" id="6228796">(</span><span class="ident" id="6228797">parents</span><span class="op" id="6228804">)</span>&nbsp;<span class="op" id="6228806">&gt;</span>&nbsp;<span class="num" id="6228808">1</span>&nbsp;<span class="op" id="6228810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6228814">if</span>&nbsp;<span class="op" id="6228817">(</span><span class="ident" id="6228818">finfo</span><span class="op" id="6228823">.</span><span class="ident" id="6228824">flags</span>&nbsp;<span class="op" id="6228830">&amp;</span>&nbsp;<span class="ident" id="6228832">fElement</span><span class="op" id="6228840">)</span>&nbsp;<span class="op" id="6228842">==</span>&nbsp;<span class="num" id="6228845">0</span>&nbsp;<span class="op" id="6228847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6228852">return</span>&nbsp;<span class="builtintype" id="6228859">nil</span><span class="op" id="6228862">,</span>&nbsp;<span class="ident" id="6228864">fmt</span><span class="op" id="6228867">.</span><span class="ident" id="6228868">Errorf</span><span class="op" id="6228874">(</span><span class="string" id="6228875">&#34;xml:&nbsp;%s&nbsp;chain&nbsp;not&nbsp;valid&nbsp;with&nbsp;%s&nbsp;flag&#34;</span><span class="op" id="6228913">,</span>&nbsp;<span class="ident" id="6228915">tag</span><span class="op" id="6228918">,</span>&nbsp;<span class="ident" id="6228920">strings</span><span class="op" id="6228927">.</span><span class="ident" id="6228928">Join</span><span class="op" id="6228932">(</span><span class="ident" id="6228933">tokens</span><span class="op" id="6228939">[</span><span class="num" id="6228940">1</span><span class="op" id="6228941">:</span><span class="op" id="6228942">]</span><span class="op" id="6228943">,</span>&nbsp;<span class="string" id="6228945">&#34;,&#34;</span><span class="op" id="6228948">)</span><span class="op" id="6228949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6228953">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6228957">finfo</span><span class="op" id="6228962">.</span><span class="ident" id="6228963">parents</span>&nbsp;<span class="op" id="6228971">=</span>&nbsp;<span class="ident" id="6228973">parents</span><span class="op" id="6228980">[</span><span class="op" id="6228981">:</span><span class="builtinfunc" id="6228982">len</span><span class="op" id="6228985">(</span><span class="ident" id="6228986">parents</span><span class="op" id="6228993">)</span><span class="op" id="6228994">-</span><span class="num" id="6228995">1</span><span class="op" id="6228996">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6228999">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6229003">//&nbsp;If&nbsp;the&nbsp;field&nbsp;type&nbsp;has&nbsp;an&nbsp;XMLName&nbsp;field,&nbsp;the&nbsp;names&nbsp;must&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6229068">//&nbsp;so&nbsp;that&nbsp;the&nbsp;behavior&nbsp;of&nbsp;both&nbsp;marshalling&nbsp;and&nbsp;unmarshalling</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6229131">//&nbsp;is&nbsp;straightforward&nbsp;and&nbsp;unambiguous.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6229171">if</span>&nbsp;<span class="ident" id="6229174">finfo</span><span class="op" id="6229179">.</span><span class="ident" id="6229180">flags</span><span class="op" id="6229185">&amp;</span><span class="ident" id="6229186">fElement</span>&nbsp;<span class="op" id="6229195">!=</span>&nbsp;<span class="num" id="6229198">0</span>&nbsp;<span class="op" id="6229200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6229204">ftyp</span>&nbsp;<span class="op" id="6229209">:=</span>&nbsp;<span class="ident" id="6229212">f</span><span class="op" id="6229213">.</span><span class="ident" id="6229214">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6229221">xmlname</span>&nbsp;<span class="op" id="6229229">:=</span>&nbsp;<span class="ident" id="6229232">lookupXMLName</span><span class="op" id="6229245">(</span><span class="ident" id="6229246">ftyp</span><span class="op" id="6229250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6229254">if</span>&nbsp;<span class="ident" id="6229257">xmlname</span>&nbsp;<span class="op" id="6229265">!=</span>&nbsp;<span class="builtintype" id="6229268">nil</span>&nbsp;<span class="op" id="6229272">&amp;&amp;</span>&nbsp;<span class="ident" id="6229275">xmlname</span><span class="op" id="6229282">.</span><span class="ident" id="6229283">name</span>&nbsp;<span class="op" id="6229288">!=</span>&nbsp;<span class="ident" id="6229291">finfo</span><span class="op" id="6229296">.</span><span class="ident" id="6229297">name</span>&nbsp;<span class="op" id="6229302">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6229307">return</span>&nbsp;<span class="builtintype" id="6229314">nil</span><span class="op" id="6229317">,</span>&nbsp;<span class="ident" id="6229319">fmt</span><span class="op" id="6229322">.</span><span class="ident" id="6229323">Errorf</span><span class="op" id="6229329">(</span><span class="string" id="6229330">&#34;xml:&nbsp;name&nbsp;%q&nbsp;in&nbsp;tag&nbsp;of&nbsp;%s.%s&nbsp;conflicts&nbsp;with&nbsp;name&nbsp;%q&nbsp;in&nbsp;%s.XMLName&#34;</span><span class="op" id="6229397">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6229403">finfo</span><span class="op" id="6229408">.</span><span class="ident" id="6229409">name</span><span class="op" id="6229413">,</span>&nbsp;<span class="ident" id="6229415">typ</span><span class="op" id="6229418">,</span>&nbsp;<span class="ident" id="6229420">f</span><span class="op" id="6229421">.</span><span class="ident" id="6229422">Name</span><span class="op" id="6229426">,</span>&nbsp;<span class="ident" id="6229428">xmlname</span><span class="op" id="6229435">.</span><span class="ident" id="6229436">name</span><span class="op" id="6229440">,</span>&nbsp;<span class="ident" id="6229442">ftyp</span><span class="op" id="6229446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6229450">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6229453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6229456">return</span>&nbsp;<span class="ident" id="6229463">finfo</span><span class="op" id="6229468">,</span>&nbsp;<span class="builtintype" id="6229470">nil</span><br>
<span class="lineno">225</span><span class="op" id="6229474">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6229477">//&nbsp;lookupXMLName&nbsp;returns&nbsp;the&nbsp;fieldInfo&nbsp;for&nbsp;typ&#39;s&nbsp;XMLName&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="6229540">//&nbsp;in&nbsp;case&nbsp;it&nbsp;exists&nbsp;and&nbsp;has&nbsp;a&nbsp;valid&nbsp;xml&nbsp;field&nbsp;tag,&nbsp;otherwise</span><br>
<span class="lineno"></span><span class="comment" id="6229602">//&nbsp;it&nbsp;returns&nbsp;nil.</span><br>
<span class="lineno">230</span><span class="keyword" id="6229621">func</span>&nbsp;<span class="ident" id="6229626">lookupXMLName</span><span class="op" id="6229639">(</span><span class="ident" id="6229640">typ</span>&nbsp;<span class="ident" id="6229644">reflect</span><span class="op" id="6229651">.</span><span class="ident" id="6229652">Type</span><span class="op" id="6229656">)</span>&nbsp;<span class="op" id="6229658">(</span><span class="ident" id="6229659">xmlname</span>&nbsp;<span class="op" id="6229667">*</span><span class="ident" id="6229668">fieldInfo</span><span class="op" id="6229677">)</span>&nbsp;<span class="op" id="6229679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6229682">for</span>&nbsp;<span class="ident" id="6229686">typ</span><span class="op" id="6229689">.</span><span class="ident" id="6229690">Kind</span><span class="op" id="6229694">(</span><span class="op" id="6229695">)</span>&nbsp;<span class="op" id="6229697">==</span>&nbsp;<span class="ident" id="6229700">reflect</span><span class="op" id="6229707">.</span><span class="ident" id="6229708">Ptr</span>&nbsp;<span class="op" id="6229712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6229716">typ</span>&nbsp;<span class="op" id="6229720">=</span>&nbsp;<span class="ident" id="6229722">typ</span><span class="op" id="6229725">.</span><span class="ident" id="6229726">Elem</span><span class="op" id="6229730">(</span><span class="op" id="6229731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6229734">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6229737">if</span>&nbsp;<span class="ident" id="6229740">typ</span><span class="op" id="6229743">.</span><span class="ident" id="6229744">Kind</span><span class="op" id="6229748">(</span><span class="op" id="6229749">)</span>&nbsp;<span class="op" id="6229751">!=</span>&nbsp;<span class="ident" id="6229754">reflect</span><span class="op" id="6229761">.</span><span class="ident" id="6229762">Struct</span>&nbsp;<span class="op" id="6229769">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6229773">return</span>&nbsp;<span class="builtintype" id="6229780">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6229785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6229788">for</span>&nbsp;<span class="ident" id="6229792">i</span><span class="op" id="6229793">,</span>&nbsp;<span class="ident" id="6229795">n</span>&nbsp;<span class="op" id="6229797">:=</span>&nbsp;<span class="num" id="6229800">0</span><span class="op" id="6229801">,</span>&nbsp;<span class="ident" id="6229803">typ</span><span class="op" id="6229806">.</span><span class="ident" id="6229807">NumField</span><span class="op" id="6229815">(</span><span class="op" id="6229816">)</span><span class="op" id="6229817">;</span>&nbsp;<span class="ident" id="6229819">i</span>&nbsp;<span class="op" id="6229821">&lt;</span>&nbsp;<span class="ident" id="6229823">n</span><span class="op" id="6229824">;</span>&nbsp;<span class="ident" id="6229826">i</span><span class="op" id="6229827">++</span>&nbsp;<span class="op" id="6229830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6229834">f</span>&nbsp;<span class="op" id="6229836">:=</span>&nbsp;<span class="ident" id="6229839">typ</span><span class="op" id="6229842">.</span><span class="ident" id="6229843">Field</span><span class="op" id="6229848">(</span><span class="ident" id="6229849">i</span><span class="op" id="6229850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6229854">if</span>&nbsp;<span class="ident" id="6229857">f</span><span class="op" id="6229858">.</span><span class="ident" id="6229859">Name</span>&nbsp;<span class="op" id="6229864">!=</span>&nbsp;<span class="string" id="6229867">&#34;XMLName&#34;</span>&nbsp;<span class="op" id="6229877">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6229882">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6229893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6229897">finfo</span><span class="op" id="6229902">,</span>&nbsp;<span class="ident" id="6229904">err</span>&nbsp;<span class="op" id="6229908">:=</span>&nbsp;<span class="ident" id="6229911">structFieldInfo</span><span class="op" id="6229926">(</span><span class="ident" id="6229927">typ</span><span class="op" id="6229930">,</span>&nbsp;<span class="op" id="6229932">&amp;</span><span class="ident" id="6229933">f</span><span class="op" id="6229934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6229938">if</span>&nbsp;<span class="ident" id="6229941">finfo</span><span class="op" id="6229946">.</span><span class="ident" id="6229947">name</span>&nbsp;<span class="op" id="6229952">!=</span>&nbsp;<span class="string" id="6229955">&#34;&#34;</span>&nbsp;<span class="op" id="6229958">&amp;&amp;</span>&nbsp;<span class="ident" id="6229961">err</span>&nbsp;<span class="op" id="6229965">==</span>&nbsp;<span class="builtintype" id="6229968">nil</span>&nbsp;<span class="op" id="6229972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6229977">return</span>&nbsp;<span class="ident" id="6229984">finfo</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6229992">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6229996">//&nbsp;Also&nbsp;consider&nbsp;errors&nbsp;as&nbsp;a&nbsp;non-existent&nbsp;field&nbsp;tag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6230050">//&nbsp;and&nbsp;let&nbsp;getTypeInfo&nbsp;itself&nbsp;report&nbsp;the&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6230100">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6230107">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6230110">return</span>&nbsp;<span class="builtintype" id="6230117">nil</span><br>
<span class="lineno"></span><span class="op" id="6230121">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6230124">func</span>&nbsp;<span class="ident" id="6230129">min</span><span class="op" id="6230132">(</span><span class="ident" id="6230133">a</span><span class="op" id="6230134">,</span>&nbsp;<span class="ident" id="6230136">b</span>&nbsp;<span class="builtintype" id="6230138">int</span><span class="op" id="6230141">)</span>&nbsp;<span class="builtintype" id="6230143">int</span>&nbsp;<span class="op" id="6230147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6230150">if</span>&nbsp;<span class="ident" id="6230153">a</span>&nbsp;<span class="op" id="6230155">&lt;=</span>&nbsp;<span class="ident" id="6230158">b</span>&nbsp;<span class="op" id="6230160">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6230164">return</span>&nbsp;<span class="ident" id="6230171">a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6230174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6230177">return</span>&nbsp;<span class="ident" id="6230184">b</span><br>
<span class="lineno"></span><span class="op" id="6230186">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="comment" id="6230189">//&nbsp;addFieldInfo&nbsp;adds&nbsp;finfo&nbsp;to&nbsp;tinfo.fields&nbsp;if&nbsp;there&nbsp;are&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="6230248">//&nbsp;conflicts,&nbsp;or&nbsp;if&nbsp;conflicts&nbsp;arise&nbsp;from&nbsp;previous&nbsp;fields&nbsp;that&nbsp;were</span><br>
<span class="lineno"></span><span class="comment" id="6230315">//&nbsp;obtained&nbsp;from&nbsp;deeper&nbsp;embedded&nbsp;structures&nbsp;than&nbsp;finfo.&nbsp;In&nbsp;the&nbsp;latter</span><br>
<span class="lineno"></span><span class="comment" id="6230385">//&nbsp;case,&nbsp;the&nbsp;conflicting&nbsp;entries&nbsp;are&nbsp;dropped.</span><br>
<span class="lineno"></span><span class="comment" id="6230431">//&nbsp;A&nbsp;conflict&nbsp;occurs&nbsp;when&nbsp;the&nbsp;path&nbsp;(parent&nbsp;+&nbsp;name)&nbsp;to&nbsp;a&nbsp;field&nbsp;is</span><br>
<span class="lineno">265</span><span class="comment" id="6230496">//&nbsp;itself&nbsp;a&nbsp;prefix&nbsp;of&nbsp;another&nbsp;path,&nbsp;or&nbsp;when&nbsp;two&nbsp;paths&nbsp;match&nbsp;exactly.</span><br>
<span class="lineno"></span><span class="comment" id="6230565">//&nbsp;It&nbsp;is&nbsp;okay&nbsp;for&nbsp;field&nbsp;paths&nbsp;to&nbsp;share&nbsp;a&nbsp;common,&nbsp;shorter&nbsp;prefix.</span><br>
<span class="lineno"></span><span class="keyword" id="6230630">func</span>&nbsp;<span class="ident" id="6230635">addFieldInfo</span><span class="op" id="6230647">(</span><span class="ident" id="6230648">typ</span>&nbsp;<span class="ident" id="6230652">reflect</span><span class="op" id="6230659">.</span><span class="ident" id="6230660">Type</span><span class="op" id="6230664">,</span>&nbsp;<span class="ident" id="6230666">tinfo</span>&nbsp;<span class="op" id="6230672">*</span><span class="ident" id="6230673">typeInfo</span><span class="op" id="6230681">,</span>&nbsp;<span class="ident" id="6230683">newf</span>&nbsp;<span class="op" id="6230688">*</span><span class="ident" id="6230689">fieldInfo</span><span class="op" id="6230698">)</span>&nbsp;<span class="builtintype" id="6230700">error</span>&nbsp;<span class="op" id="6230706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6230709">var</span>&nbsp;<span class="ident" id="6230713">conflicts</span>&nbsp;<span class="op" id="6230723">[</span><span class="op" id="6230724">]</span><span class="builtintype" id="6230725">int</span><br>
<span class="lineno"></span><span class="ident" id="6230729">Loop</span><span class="op" id="6230733">:</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6230736">//&nbsp;First,&nbsp;figure&nbsp;all&nbsp;conflicts.&nbsp;Most&nbsp;working&nbsp;code&nbsp;will&nbsp;have&nbsp;none.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6230803">for</span>&nbsp;<span class="ident" id="6230807">i</span>&nbsp;<span class="op" id="6230809">:=</span>&nbsp;<span class="keyword" id="6230812">range</span>&nbsp;<span class="ident" id="6230818">tinfo</span><span class="op" id="6230823">.</span><span class="ident" id="6230824">fields</span>&nbsp;<span class="op" id="6230831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6230835">oldf</span>&nbsp;<span class="op" id="6230840">:=</span>&nbsp;<span class="op" id="6230843">&amp;</span><span class="ident" id="6230844">tinfo</span><span class="op" id="6230849">.</span><span class="ident" id="6230850">fields</span><span class="op" id="6230856">[</span><span class="ident" id="6230857">i</span><span class="op" id="6230858">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6230862">if</span>&nbsp;<span class="ident" id="6230865">oldf</span><span class="op" id="6230869">.</span><span class="ident" id="6230870">flags</span><span class="op" id="6230875">&amp;</span><span class="ident" id="6230876">fMode</span>&nbsp;<span class="op" id="6230882">!=</span>&nbsp;<span class="ident" id="6230885">newf</span><span class="op" id="6230889">.</span><span class="ident" id="6230890">flags</span><span class="op" id="6230895">&amp;</span><span class="ident" id="6230896">fMode</span>&nbsp;<span class="op" id="6230902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6230907">continue</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6230918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6230922">if</span>&nbsp;<span class="ident" id="6230925">oldf</span><span class="op" id="6230929">.</span><span class="ident" id="6230930">xmlns</span>&nbsp;<span class="op" id="6230936">!=</span>&nbsp;<span class="string" id="6230939">&#34;&#34;</span>&nbsp;<span class="op" id="6230942">&amp;&amp;</span>&nbsp;<span class="ident" id="6230945">newf</span><span class="op" id="6230949">.</span><span class="ident" id="6230950">xmlns</span>&nbsp;<span class="op" id="6230956">!=</span>&nbsp;<span class="string" id="6230959">&#34;&#34;</span>&nbsp;<span class="op" id="6230962">&amp;&amp;</span>&nbsp;<span class="ident" id="6230965">oldf</span><span class="op" id="6230969">.</span><span class="ident" id="6230970">xmlns</span>&nbsp;<span class="op" id="6230976">!=</span>&nbsp;<span class="ident" id="6230979">newf</span><span class="op" id="6230983">.</span><span class="ident" id="6230984">xmlns</span>&nbsp;<span class="op" id="6230990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6230995">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6231006">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6231010">minl</span>&nbsp;<span class="op" id="6231015">:=</span>&nbsp;<span class="ident" id="6231018">min</span><span class="op" id="6231021">(</span><span class="builtinfunc" id="6231022">len</span><span class="op" id="6231025">(</span><span class="ident" id="6231026">newf</span><span class="op" id="6231030">.</span><span class="ident" id="6231031">parents</span><span class="op" id="6231038">)</span><span class="op" id="6231039">,</span>&nbsp;<span class="builtinfunc" id="6231041">len</span><span class="op" id="6231044">(</span><span class="ident" id="6231045">oldf</span><span class="op" id="6231049">.</span><span class="ident" id="6231050">parents</span><span class="op" id="6231057">)</span><span class="op" id="6231058">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6231062">for</span>&nbsp;<span class="ident" id="6231066">p</span>&nbsp;<span class="op" id="6231068">:=</span>&nbsp;<span class="num" id="6231071">0</span><span class="op" id="6231072">;</span>&nbsp;<span class="ident" id="6231074">p</span>&nbsp;<span class="op" id="6231076">&lt;</span>&nbsp;<span class="ident" id="6231078">minl</span><span class="op" id="6231082">;</span>&nbsp;<span class="ident" id="6231084">p</span><span class="op" id="6231085">++</span>&nbsp;<span class="op" id="6231088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6231093">if</span>&nbsp;<span class="ident" id="6231096">oldf</span><span class="op" id="6231100">.</span><span class="ident" id="6231101">parents</span><span class="op" id="6231108">[</span><span class="ident" id="6231109">p</span><span class="op" id="6231110">]</span>&nbsp;<span class="op" id="6231112">!=</span>&nbsp;<span class="ident" id="6231115">newf</span><span class="op" id="6231119">.</span><span class="ident" id="6231120">parents</span><span class="op" id="6231127">[</span><span class="ident" id="6231128">p</span><span class="op" id="6231129">]</span>&nbsp;<span class="op" id="6231131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6231137">continue</span>&nbsp;<span class="ident" id="6231146">Loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6231154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6231158">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6231162">if</span>&nbsp;<span class="builtinfunc" id="6231165">len</span><span class="op" id="6231168">(</span><span class="ident" id="6231169">oldf</span><span class="op" id="6231173">.</span><span class="ident" id="6231174">parents</span><span class="op" id="6231181">)</span>&nbsp;<span class="op" id="6231183">&gt;</span>&nbsp;<span class="builtinfunc" id="6231185">len</span><span class="op" id="6231188">(</span><span class="ident" id="6231189">newf</span><span class="op" id="6231193">.</span><span class="ident" id="6231194">parents</span><span class="op" id="6231201">)</span>&nbsp;<span class="op" id="6231203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6231208">if</span>&nbsp;<span class="ident" id="6231211">oldf</span><span class="op" id="6231215">.</span><span class="ident" id="6231216">parents</span><span class="op" id="6231223">[</span><span class="builtinfunc" id="6231224">len</span><span class="op" id="6231227">(</span><span class="ident" id="6231228">newf</span><span class="op" id="6231232">.</span><span class="ident" id="6231233">parents</span><span class="op" id="6231240">)</span><span class="op" id="6231241">]</span>&nbsp;<span class="op" id="6231243">==</span>&nbsp;<span class="ident" id="6231246">newf</span><span class="op" id="6231250">.</span><span class="ident" id="6231251">name</span>&nbsp;<span class="op" id="6231256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6231262">conflicts</span>&nbsp;<span class="op" id="6231272">=</span>&nbsp;<span class="builtinfunc" id="6231274">append</span><span class="op" id="6231280">(</span><span class="ident" id="6231281">conflicts</span><span class="op" id="6231290">,</span>&nbsp;<span class="ident" id="6231292">i</span><span class="op" id="6231293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6231298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6231302">}</span>&nbsp;<span class="keyword" id="6231304">else</span>&nbsp;<span class="keyword" id="6231309">if</span>&nbsp;<span class="builtinfunc" id="6231312">len</span><span class="op" id="6231315">(</span><span class="ident" id="6231316">oldf</span><span class="op" id="6231320">.</span><span class="ident" id="6231321">parents</span><span class="op" id="6231328">)</span>&nbsp;<span class="op" id="6231330">&lt;</span>&nbsp;<span class="builtinfunc" id="6231332">len</span><span class="op" id="6231335">(</span><span class="ident" id="6231336">newf</span><span class="op" id="6231340">.</span><span class="ident" id="6231341">parents</span><span class="op" id="6231348">)</span>&nbsp;<span class="op" id="6231350">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6231355">if</span>&nbsp;<span class="ident" id="6231358">newf</span><span class="op" id="6231362">.</span><span class="ident" id="6231363">parents</span><span class="op" id="6231370">[</span><span class="builtinfunc" id="6231371">len</span><span class="op" id="6231374">(</span><span class="ident" id="6231375">oldf</span><span class="op" id="6231379">.</span><span class="ident" id="6231380">parents</span><span class="op" id="6231387">)</span><span class="op" id="6231388">]</span>&nbsp;<span class="op" id="6231390">==</span>&nbsp;<span class="ident" id="6231393">oldf</span><span class="op" id="6231397">.</span><span class="ident" id="6231398">name</span>&nbsp;<span class="op" id="6231403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6231409">conflicts</span>&nbsp;<span class="op" id="6231419">=</span>&nbsp;<span class="builtinfunc" id="6231421">append</span><span class="op" id="6231427">(</span><span class="ident" id="6231428">conflicts</span><span class="op" id="6231437">,</span>&nbsp;<span class="ident" id="6231439">i</span><span class="op" id="6231440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6231445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6231449">}</span>&nbsp;<span class="keyword" id="6231451">else</span>&nbsp;<span class="op" id="6231456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6231461">if</span>&nbsp;<span class="ident" id="6231464">newf</span><span class="op" id="6231468">.</span><span class="ident" id="6231469">name</span>&nbsp;<span class="op" id="6231474">==</span>&nbsp;<span class="ident" id="6231477">oldf</span><span class="op" id="6231481">.</span><span class="ident" id="6231482">name</span>&nbsp;<span class="op" id="6231487">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6231493">conflicts</span>&nbsp;<span class="op" id="6231503">=</span>&nbsp;<span class="builtinfunc" id="6231505">append</span><span class="op" id="6231511">(</span><span class="ident" id="6231512">conflicts</span><span class="op" id="6231521">,</span>&nbsp;<span class="ident" id="6231523">i</span><span class="op" id="6231524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6231529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6231533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6231536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6231539">//&nbsp;Without&nbsp;conflicts,&nbsp;add&nbsp;the&nbsp;new&nbsp;field&nbsp;and&nbsp;return.</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6231592">if</span>&nbsp;<span class="ident" id="6231595">conflicts</span>&nbsp;<span class="op" id="6231605">==</span>&nbsp;<span class="builtintype" id="6231608">nil</span>&nbsp;<span class="op" id="6231612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6231616">tinfo</span><span class="op" id="6231621">.</span><span class="ident" id="6231622">fields</span>&nbsp;<span class="op" id="6231629">=</span>&nbsp;<span class="builtinfunc" id="6231631">append</span><span class="op" id="6231637">(</span><span class="ident" id="6231638">tinfo</span><span class="op" id="6231643">.</span><span class="ident" id="6231644">fields</span><span class="op" id="6231650">,</span>&nbsp;<span class="op" id="6231652">*</span><span class="ident" id="6231653">newf</span><span class="op" id="6231657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6231661">return</span>&nbsp;<span class="builtintype" id="6231668">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6231673">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6231677">//&nbsp;If&nbsp;any&nbsp;conflict&nbsp;is&nbsp;shallower,&nbsp;ignore&nbsp;the&nbsp;new&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6231733">//&nbsp;This&nbsp;matches&nbsp;the&nbsp;Go&nbsp;field&nbsp;resolution&nbsp;on&nbsp;embedding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6231788">for</span>&nbsp;<span class="ident" id="6231792">_</span><span class="op" id="6231793">,</span>&nbsp;<span class="ident" id="6231795">i</span>&nbsp;<span class="op" id="6231797">:=</span>&nbsp;<span class="keyword" id="6231800">range</span>&nbsp;<span class="ident" id="6231806">conflicts</span>&nbsp;<span class="op" id="6231816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6231820">if</span>&nbsp;<span class="builtinfunc" id="6231823">len</span><span class="op" id="6231826">(</span><span class="ident" id="6231827">tinfo</span><span class="op" id="6231832">.</span><span class="ident" id="6231833">fields</span><span class="op" id="6231839">[</span><span class="ident" id="6231840">i</span><span class="op" id="6231841">]</span><span class="op" id="6231842">.</span><span class="ident" id="6231843">idx</span><span class="op" id="6231846">)</span>&nbsp;<span class="op" id="6231848">&lt;</span>&nbsp;<span class="builtinfunc" id="6231850">len</span><span class="op" id="6231853">(</span><span class="ident" id="6231854">newf</span><span class="op" id="6231858">.</span><span class="ident" id="6231859">idx</span><span class="op" id="6231862">)</span>&nbsp;<span class="op" id="6231864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6231869">return</span>&nbsp;<span class="builtintype" id="6231876">nil</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6231882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6231885">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6231889">//&nbsp;Otherwise,&nbsp;if&nbsp;any&nbsp;of&nbsp;them&nbsp;is&nbsp;at&nbsp;the&nbsp;same&nbsp;depth&nbsp;level,&nbsp;it&#39;s&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6231962">for</span>&nbsp;<span class="ident" id="6231966">_</span><span class="op" id="6231967">,</span>&nbsp;<span class="ident" id="6231969">i</span>&nbsp;<span class="op" id="6231971">:=</span>&nbsp;<span class="keyword" id="6231974">range</span>&nbsp;<span class="ident" id="6231980">conflicts</span>&nbsp;<span class="op" id="6231990">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6231994">oldf</span>&nbsp;<span class="op" id="6231999">:=</span>&nbsp;<span class="op" id="6232002">&amp;</span><span class="ident" id="6232003">tinfo</span><span class="op" id="6232008">.</span><span class="ident" id="6232009">fields</span><span class="op" id="6232015">[</span><span class="ident" id="6232016">i</span><span class="op" id="6232017">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6232021">if</span>&nbsp;<span class="builtinfunc" id="6232024">len</span><span class="op" id="6232027">(</span><span class="ident" id="6232028">oldf</span><span class="op" id="6232032">.</span><span class="ident" id="6232033">idx</span><span class="op" id="6232036">)</span>&nbsp;<span class="op" id="6232038">==</span>&nbsp;<span class="builtinfunc" id="6232041">len</span><span class="op" id="6232044">(</span><span class="ident" id="6232045">newf</span><span class="op" id="6232049">.</span><span class="ident" id="6232050">idx</span><span class="op" id="6232053">)</span>&nbsp;<span class="op" id="6232055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6232060">f1</span>&nbsp;<span class="op" id="6232063">:=</span>&nbsp;<span class="ident" id="6232066">typ</span><span class="op" id="6232069">.</span><span class="ident" id="6232070">FieldByIndex</span><span class="op" id="6232082">(</span><span class="ident" id="6232083">oldf</span><span class="op" id="6232087">.</span><span class="ident" id="6232088">idx</span><span class="op" id="6232091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6232096">f2</span>&nbsp;<span class="op" id="6232099">:=</span>&nbsp;<span class="ident" id="6232102">typ</span><span class="op" id="6232105">.</span><span class="ident" id="6232106">FieldByIndex</span><span class="op" id="6232118">(</span><span class="ident" id="6232119">newf</span><span class="op" id="6232123">.</span><span class="ident" id="6232124">idx</span><span class="op" id="6232127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6232132">return</span>&nbsp;<span class="op" id="6232139">&amp;</span><span class="ident" id="6232140">TagPathError</span><span class="op" id="6232152">{</span><span class="ident" id="6232153">typ</span><span class="op" id="6232156">,</span>&nbsp;<span class="ident" id="6232158">f1</span><span class="op" id="6232160">.</span><span class="ident" id="6232161">Name</span><span class="op" id="6232165">,</span>&nbsp;<span class="ident" id="6232167">f1</span><span class="op" id="6232169">.</span><span class="ident" id="6232170">Tag</span><span class="op" id="6232173">.</span><span class="ident" id="6232174">Get</span><span class="op" id="6232177">(</span><span class="string" id="6232178">&#34;xml&#34;</span><span class="op" id="6232183">)</span><span class="op" id="6232184">,</span>&nbsp;<span class="ident" id="6232186">f2</span><span class="op" id="6232188">.</span><span class="ident" id="6232189">Name</span><span class="op" id="6232193">,</span>&nbsp;<span class="ident" id="6232195">f2</span><span class="op" id="6232197">.</span><span class="ident" id="6232198">Tag</span><span class="op" id="6232201">.</span><span class="ident" id="6232202">Get</span><span class="op" id="6232205">(</span><span class="string" id="6232206">&#34;xml&#34;</span><span class="op" id="6232211">)</span><span class="op" id="6232212">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6232216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6232219">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6232223">//&nbsp;Otherwise,&nbsp;the&nbsp;new&nbsp;field&nbsp;is&nbsp;shallower,&nbsp;and&nbsp;thus&nbsp;takes&nbsp;precedence,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6232293">//&nbsp;so&nbsp;drop&nbsp;the&nbsp;conflicting&nbsp;fields&nbsp;from&nbsp;tinfo&nbsp;and&nbsp;append&nbsp;the&nbsp;new&nbsp;one.</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6232363">for</span>&nbsp;<span class="ident" id="6232367">c</span>&nbsp;<span class="op" id="6232369">:=</span>&nbsp;<span class="builtinfunc" id="6232372">len</span><span class="op" id="6232375">(</span><span class="ident" id="6232376">conflicts</span><span class="op" id="6232385">)</span>&nbsp;<span class="op" id="6232387">-</span>&nbsp;<span class="num" id="6232389">1</span><span class="op" id="6232390">;</span>&nbsp;<span class="ident" id="6232392">c</span>&nbsp;<span class="op" id="6232394">&gt;=</span>&nbsp;<span class="num" id="6232397">0</span><span class="op" id="6232398">;</span>&nbsp;<span class="ident" id="6232400">c</span><span class="op" id="6232401">--</span>&nbsp;<span class="op" id="6232404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6232408">i</span>&nbsp;<span class="op" id="6232410">:=</span>&nbsp;<span class="ident" id="6232413">conflicts</span><span class="op" id="6232422">[</span><span class="ident" id="6232423">c</span><span class="op" id="6232424">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6232428">copy</span><span class="op" id="6232432">(</span><span class="ident" id="6232433">tinfo</span><span class="op" id="6232438">.</span><span class="ident" id="6232439">fields</span><span class="op" id="6232445">[</span><span class="ident" id="6232446">i</span><span class="op" id="6232447">:</span><span class="op" id="6232448">]</span><span class="op" id="6232449">,</span>&nbsp;<span class="ident" id="6232451">tinfo</span><span class="op" id="6232456">.</span><span class="ident" id="6232457">fields</span><span class="op" id="6232463">[</span><span class="ident" id="6232464">i</span><span class="op" id="6232465">+</span><span class="num" id="6232466">1</span><span class="op" id="6232467">:</span><span class="op" id="6232468">]</span><span class="op" id="6232469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6232473">tinfo</span><span class="op" id="6232478">.</span><span class="ident" id="6232479">fields</span>&nbsp;<span class="op" id="6232486">=</span>&nbsp;<span class="ident" id="6232488">tinfo</span><span class="op" id="6232493">.</span><span class="ident" id="6232494">fields</span><span class="op" id="6232500">[</span><span class="op" id="6232501">:</span><span class="builtinfunc" id="6232502">len</span><span class="op" id="6232505">(</span><span class="ident" id="6232506">tinfo</span><span class="op" id="6232511">.</span><span class="ident" id="6232512">fields</span><span class="op" id="6232518">)</span><span class="op" id="6232519">-</span><span class="num" id="6232520">1</span><span class="op" id="6232521">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6232524">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6232527">tinfo</span><span class="op" id="6232532">.</span><span class="ident" id="6232533">fields</span>&nbsp;<span class="op" id="6232540">=</span>&nbsp;<span class="builtinfunc" id="6232542">append</span><span class="op" id="6232548">(</span><span class="ident" id="6232549">tinfo</span><span class="op" id="6232554">.</span><span class="ident" id="6232555">fields</span><span class="op" id="6232561">,</span>&nbsp;<span class="op" id="6232563">*</span><span class="ident" id="6232564">newf</span><span class="op" id="6232568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6232571">return</span>&nbsp;<span class="builtintype" id="6232578">nil</span><br>
<span class="lineno"></span><span class="op" id="6232582">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6232585">//&nbsp;A&nbsp;TagPathError&nbsp;represents&nbsp;an&nbsp;error&nbsp;in&nbsp;the&nbsp;unmarshalling&nbsp;process</span><br>
<span class="lineno">335</span><span class="comment" id="6232652">//&nbsp;caused&nbsp;by&nbsp;the&nbsp;use&nbsp;of&nbsp;field&nbsp;tags&nbsp;with&nbsp;conflicting&nbsp;paths.</span><br>
<span class="lineno"></span><span class="keyword" id="6232711">type</span>&nbsp;<span class="ident" id="6232716">TagPathError</span>&nbsp;<span class="keyword" id="6232729">struct</span>&nbsp;<span class="op" id="6232736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6232739">Struct</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6232752">reflect</span><span class="op" id="6232759">.</span><span class="ident" id="6232760">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6232766">Field1</span><span class="op" id="6232772">,</span>&nbsp;<span class="ident" id="6232774">Tag1</span>&nbsp;<span class="builtintype" id="6232779">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6232787">Field2</span><span class="op" id="6232793">,</span>&nbsp;<span class="ident" id="6232795">Tag2</span>&nbsp;<span class="builtintype" id="6232800">string</span><br>
<span class="lineno">340</span><span class="op" id="6232807">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6232810">func</span>&nbsp;<span class="op" id="6232815">(</span><span class="ident" id="6232816">e</span>&nbsp;<span class="op" id="6232818">*</span><span class="ident" id="6232819">TagPathError</span><span class="op" id="6232831">)</span>&nbsp;<span class="ident" id="6232833">Error</span><span class="op" id="6232838">(</span><span class="op" id="6232839">)</span>&nbsp;<span class="builtintype" id="6232841">string</span>&nbsp;<span class="op" id="6232848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6232851">return</span>&nbsp;<span class="ident" id="6232858">fmt</span><span class="op" id="6232861">.</span><span class="ident" id="6232862">Sprintf</span><span class="op" id="6232869">(</span><span class="string" id="6232870">&#34;%s&nbsp;field&nbsp;%q&nbsp;with&nbsp;tag&nbsp;%q&nbsp;conflicts&nbsp;with&nbsp;field&nbsp;%q&nbsp;with&nbsp;tag&nbsp;%q&#34;</span><span class="op" id="6232931">,</span>&nbsp;<span class="ident" id="6232933">e</span><span class="op" id="6232934">.</span><span class="ident" id="6232935">Struct</span><span class="op" id="6232941">,</span>&nbsp;<span class="ident" id="6232943">e</span><span class="op" id="6232944">.</span><span class="ident" id="6232945">Field1</span><span class="op" id="6232951">,</span>&nbsp;<span class="ident" id="6232953">e</span><span class="op" id="6232954">.</span><span class="ident" id="6232955">Tag1</span><span class="op" id="6232959">,</span>&nbsp;<span class="ident" id="6232961">e</span><span class="op" id="6232962">.</span><span class="ident" id="6232963">Field2</span><span class="op" id="6232969">,</span>&nbsp;<span class="ident" id="6232971">e</span><span class="op" id="6232972">.</span><span class="ident" id="6232973">Tag2</span><span class="op" id="6232977">)</span><br>
<span class="lineno"></span><span class="op" id="6232979">}</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span><span class="comment" id="6232982">//&nbsp;value&nbsp;returns&nbsp;v&#39;s&nbsp;field&nbsp;value&nbsp;corresponding&nbsp;to&nbsp;finfo.</span><br>
<span class="lineno"></span><span class="comment" id="6233039">//&nbsp;It&#39;s&nbsp;equivalent&nbsp;to&nbsp;v.FieldByIndex(finfo.idx),&nbsp;but&nbsp;initializes</span><br>
<span class="lineno"></span><span class="comment" id="6233104">//&nbsp;and&nbsp;dereferences&nbsp;pointers&nbsp;as&nbsp;necessary.</span><br>
<span class="lineno"></span><span class="keyword" id="6233147">func</span>&nbsp;<span class="op" id="6233152">(</span><span class="ident" id="6233153">finfo</span>&nbsp;<span class="op" id="6233159">*</span><span class="ident" id="6233160">fieldInfo</span><span class="op" id="6233169">)</span>&nbsp;<span class="ident" id="6233171">value</span><span class="op" id="6233176">(</span><span class="ident" id="6233177">v</span>&nbsp;<span class="ident" id="6233179">reflect</span><span class="op" id="6233186">.</span><span class="ident" id="6233187">Value</span><span class="op" id="6233192">)</span>&nbsp;<span class="ident" id="6233194">reflect</span><span class="op" id="6233201">.</span><span class="ident" id="6233202">Value</span>&nbsp;<span class="op" id="6233208">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6233211">for</span>&nbsp;<span class="ident" id="6233215">i</span><span class="op" id="6233216">,</span>&nbsp;<span class="ident" id="6233218">x</span>&nbsp;<span class="op" id="6233220">:=</span>&nbsp;<span class="keyword" id="6233223">range</span>&nbsp;<span class="ident" id="6233229">finfo</span><span class="op" id="6233234">.</span><span class="ident" id="6233235">idx</span>&nbsp;<span class="op" id="6233239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6233243">if</span>&nbsp;<span class="ident" id="6233246">i</span>&nbsp;<span class="op" id="6233248">&gt;</span>&nbsp;<span class="num" id="6233250">0</span>&nbsp;<span class="op" id="6233252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6233257">t</span>&nbsp;<span class="op" id="6233259">:=</span>&nbsp;<span class="ident" id="6233262">v</span><span class="op" id="6233263">.</span><span class="ident" id="6233264">Type</span><span class="op" id="6233268">(</span><span class="op" id="6233269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6233274">if</span>&nbsp;<span class="ident" id="6233277">t</span><span class="op" id="6233278">.</span><span class="ident" id="6233279">Kind</span><span class="op" id="6233283">(</span><span class="op" id="6233284">)</span>&nbsp;<span class="op" id="6233286">==</span>&nbsp;<span class="ident" id="6233289">reflect</span><span class="op" id="6233296">.</span><span class="ident" id="6233297">Ptr</span>&nbsp;<span class="op" id="6233301">&amp;&amp;</span>&nbsp;<span class="ident" id="6233304">t</span><span class="op" id="6233305">.</span><span class="ident" id="6233306">Elem</span><span class="op" id="6233310">(</span><span class="op" id="6233311">)</span><span class="op" id="6233312">.</span><span class="ident" id="6233313">Kind</span><span class="op" id="6233317">(</span><span class="op" id="6233318">)</span>&nbsp;<span class="op" id="6233320">==</span>&nbsp;<span class="ident" id="6233323">reflect</span><span class="op" id="6233330">.</span><span class="ident" id="6233331">Struct</span>&nbsp;<span class="op" id="6233338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6233344">if</span>&nbsp;<span class="ident" id="6233347">v</span><span class="op" id="6233348">.</span><span class="ident" id="6233349">IsNil</span><span class="op" id="6233354">(</span><span class="op" id="6233355">)</span>&nbsp;<span class="op" id="6233357">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6233364">v</span><span class="op" id="6233365">.</span><span class="ident" id="6233366">Set</span><span class="op" id="6233369">(</span><span class="ident" id="6233370">reflect</span><span class="op" id="6233377">.</span><span class="ident" id="6233378">New</span><span class="op" id="6233381">(</span><span class="ident" id="6233382">v</span><span class="op" id="6233383">.</span><span class="ident" id="6233384">Type</span><span class="op" id="6233388">(</span><span class="op" id="6233389">)</span><span class="op" id="6233390">.</span><span class="ident" id="6233391">Elem</span><span class="op" id="6233395">(</span><span class="op" id="6233396">)</span><span class="op" id="6233397">)</span><span class="op" id="6233398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6233404">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6233410">v</span>&nbsp;<span class="op" id="6233412">=</span>&nbsp;<span class="ident" id="6233414">v</span><span class="op" id="6233415">.</span><span class="ident" id="6233416">Elem</span><span class="op" id="6233420">(</span><span class="op" id="6233421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6233426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6233430">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6233434">v</span>&nbsp;<span class="op" id="6233436">=</span>&nbsp;<span class="ident" id="6233438">v</span><span class="op" id="6233439">.</span><span class="ident" id="6233440">Field</span><span class="op" id="6233445">(</span><span class="ident" id="6233446">x</span><span class="op" id="6233447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6233450">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6233453">return</span>&nbsp;<span class="ident" id="6233460">v</span><br>
<span class="lineno"></span><span class="op" id="6233462">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
