<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/x509</h2>
<ul>
<li><a href="/gostd/crypto/x509/cert_pool.go.html">cert_pool.go</a></li>
<li><a href="/gostd/crypto/x509/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt.go.html">pem_decrypt.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt_test.go.html">pem_decrypt_test.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs1.go.html">pkcs1.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8.go.html">pkcs8.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8_test.go.html">pkcs8_test.go</a></li>
<li><a href="/gostd/crypto/x509/root.go.html">root.go</a></li>
<li><a href="/gostd/crypto/x509/root_unix.go.html" class="current">root_unix.go</a></li>
<li><a href="/gostd/crypto/x509/sec1.go.html">sec1.go</a></li>
<li><a href="/gostd/crypto/x509/sec1_test.go.html">sec1_test.go</a></li>
<li><a href="/gostd/crypto/x509/verify.go.html">verify.go</a></li>
<li><a href="/gostd/crypto/x509/verify_test.go.html">verify_test.go</a></li>
<li><a href="/gostd/crypto/x509/x509.go.html">x509.go</a></li>
<li><a href="/gostd/crypto/x509/x509_test.go.html">x509_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4052650">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4052705">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4052759">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4052810">//&nbsp;+build&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4052873">package</span>&nbsp;<span class="ident" id="4052881">x509</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4052887">import</span>&nbsp;<span class="string" id="4052894">&#34;io/ioutil&#34;</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="4052907">//&nbsp;Possible&nbsp;certificate&nbsp;files;&nbsp;stop&nbsp;after&nbsp;finding&nbsp;one.</span><br>
<span class="lineno"></span><span class="keyword" id="4052962">var</span>&nbsp;<span class="ident" id="4052966">certFiles</span>&nbsp;<span class="op" id="4052976">=</span>&nbsp;<span class="op" id="4052978">[</span><span class="op" id="4052979">]</span><span class="builtintype" id="4052980">string</span><span class="op" id="4052986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4052989">&#34;/etc/ssl/certs/ca-certificates.crt&#34;</span><span class="op" id="4053025">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4053031">//&nbsp;Debian/Ubuntu/Gentoo&nbsp;etc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4053061">&#34;/etc/pki/tls/certs/ca-bundle.crt&#34;</span><span class="op" id="4053095">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4053103">//&nbsp;Fedora/RHEL</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4053119">&#34;/etc/ssl/ca-bundle.pem&#34;</span><span class="op" id="4053143">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4053161">//&nbsp;OpenSUSE</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4053174">&#34;/etc/ssl/cert.pem&#34;</span><span class="op" id="4053193">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4053216">//&nbsp;OpenBSD</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4053228">&#34;/usr/local/share/certs/ca-root-nss.crt&#34;</span><span class="op" id="4053268">,</span>&nbsp;<span class="comment" id="4053270">//&nbsp;FreeBSD/DragonFly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4053292">&#34;/etc/pki/tls/cacert.pem&#34;</span><span class="op" id="4053317">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4053334">//&nbsp;OpenELEC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4053347">&#34;/etc/certs/ca-certificates.crt&#34;</span><span class="op" id="4053379">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4053389">//&nbsp;Solaris&nbsp;11.2+</span><br>
<span class="lineno">20</span><span class="op" id="4053406">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4053409">//&nbsp;Possible&nbsp;directories&nbsp;with&nbsp;certificate&nbsp;files;&nbsp;stop&nbsp;after&nbsp;successfully</span><br>
<span class="lineno"></span><span class="comment" id="4053481">//&nbsp;reading&nbsp;at&nbsp;least&nbsp;one&nbsp;file&nbsp;from&nbsp;a&nbsp;directory.</span><br>
<span class="lineno"></span><span class="keyword" id="4053528">var</span>&nbsp;<span class="ident" id="4053532">certDirectories</span>&nbsp;<span class="op" id="4053548">=</span>&nbsp;<span class="op" id="4053550">[</span><span class="op" id="4053551">]</span><span class="builtintype" id="4053552">string</span><span class="op" id="4053558">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4053561">&#34;/system/etc/security/cacerts&#34;</span><span class="op" id="4053591">,</span>&nbsp;<span class="comment" id="4053593">//&nbsp;Android</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="op" id="4053605">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4053608">func</span>&nbsp;<span class="op" id="4053613">(</span><span class="ident" id="4053614">c</span>&nbsp;<span class="op" id="4053616">*</span><span class="ident" id="4053617">Certificate</span><span class="op" id="4053628">)</span>&nbsp;<span class="ident" id="4053630">systemVerify</span><span class="op" id="4053642">(</span><span class="ident" id="4053643">opts</span>&nbsp;<span class="op" id="4053648">*</span><span class="ident" id="4053649">VerifyOptions</span><span class="op" id="4053662">)</span>&nbsp;<span class="op" id="4053664">(</span><span class="ident" id="4053665">chains</span>&nbsp;<span class="op" id="4053672">[</span><span class="op" id="4053673">]</span><span class="op" id="4053674">[</span><span class="op" id="4053675">]</span><span class="op" id="4053676">*</span><span class="ident" id="4053677">Certificate</span><span class="op" id="4053688">,</span>&nbsp;<span class="ident" id="4053690">err</span>&nbsp;<span class="builtintype" id="4053694">error</span><span class="op" id="4053699">)</span>&nbsp;<span class="op" id="4053701">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4053704">return</span>&nbsp;<span class="ident" id="4053711">nil</span><span class="op" id="4053714">,</span>&nbsp;<span class="ident" id="4053716">nil</span><br>
<span class="lineno"></span><span class="op" id="4053720">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4053723">func</span>&nbsp;<span class="ident" id="4053728">initSystemRoots</span><span class="op" id="4053743">(</span><span class="op" id="4053744">)</span>&nbsp;<span class="op" id="4053746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4053749">roots</span>&nbsp;<span class="op" id="4053755">:=</span>&nbsp;<span class="ident" id="4053758">NewCertPool</span><span class="op" id="4053769">(</span><span class="op" id="4053770">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4053773">for</span>&nbsp;<span class="ident" id="4053777">_</span><span class="op" id="4053778">,</span>&nbsp;<span class="ident" id="4053780">file</span>&nbsp;<span class="op" id="4053785">:=</span>&nbsp;<span class="keyword" id="4053788">range</span>&nbsp;<span class="ident" id="4053794">certFiles</span>&nbsp;<span class="op" id="4053804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4053808">data</span><span class="op" id="4053812">,</span>&nbsp;<span class="ident" id="4053814">err</span>&nbsp;<span class="op" id="4053818">:=</span>&nbsp;<span class="ident" id="4053821">ioutil</span><span class="op" id="4053827">.</span><span class="ident" id="4053828">ReadFile</span><span class="op" id="4053836">(</span><span class="ident" id="4053837">file</span><span class="op" id="4053841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4053845">if</span>&nbsp;<span class="ident" id="4053848">err</span>&nbsp;<span class="op" id="4053852">==</span>&nbsp;<span class="ident" id="4053855">nil</span>&nbsp;<span class="op" id="4053859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4053864">roots</span><span class="op" id="4053869">.</span><span class="ident" id="4053870">AppendCertsFromPEM</span><span class="op" id="4053888">(</span><span class="ident" id="4053889">data</span><span class="op" id="4053893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4053898">systemRoots</span>&nbsp;<span class="op" id="4053910">=</span>&nbsp;<span class="ident" id="4053912">roots</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4053921">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4053930">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4053933">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4053937">for</span>&nbsp;<span class="ident" id="4053941">_</span><span class="op" id="4053942">,</span>&nbsp;<span class="ident" id="4053944">directory</span>&nbsp;<span class="op" id="4053954">:=</span>&nbsp;<span class="keyword" id="4053957">range</span>&nbsp;<span class="ident" id="4053963">certDirectories</span>&nbsp;<span class="op" id="4053979">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4053983">fis</span><span class="op" id="4053986">,</span>&nbsp;<span class="ident" id="4053988">err</span>&nbsp;<span class="op" id="4053992">:=</span>&nbsp;<span class="ident" id="4053995">ioutil</span><span class="op" id="4054001">.</span><span class="ident" id="4054002">ReadDir</span><span class="op" id="4054009">(</span><span class="ident" id="4054010">directory</span><span class="op" id="4054019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4054023">if</span>&nbsp;<span class="ident" id="4054026">err</span>&nbsp;<span class="op" id="4054030">!=</span>&nbsp;<span class="ident" id="4054033">nil</span>&nbsp;<span class="op" id="4054037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4054042">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4054053">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4054057">rootsAdded</span>&nbsp;<span class="op" id="4054068">:=</span>&nbsp;<span class="builtintype" id="4054071">false</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4054079">for</span>&nbsp;<span class="ident" id="4054083">_</span><span class="op" id="4054084">,</span>&nbsp;<span class="ident" id="4054086">fi</span>&nbsp;<span class="op" id="4054089">:=</span>&nbsp;<span class="keyword" id="4054092">range</span>&nbsp;<span class="ident" id="4054098">fis</span>&nbsp;<span class="op" id="4054102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4054107">data</span><span class="op" id="4054111">,</span>&nbsp;<span class="ident" id="4054113">err</span>&nbsp;<span class="op" id="4054117">:=</span>&nbsp;<span class="ident" id="4054120">ioutil</span><span class="op" id="4054126">.</span><span class="ident" id="4054127">ReadFile</span><span class="op" id="4054135">(</span><span class="ident" id="4054136">directory</span>&nbsp;<span class="op" id="4054146">+</span>&nbsp;<span class="string" id="4054148">&#34;/&#34;</span>&nbsp;<span class="op" id="4054152">+</span>&nbsp;<span class="ident" id="4054154">fi</span><span class="op" id="4054156">.</span><span class="ident" id="4054157">Name</span><span class="op" id="4054161">(</span><span class="op" id="4054162">)</span><span class="op" id="4054163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4054168">if</span>&nbsp;<span class="ident" id="4054171">err</span>&nbsp;<span class="op" id="4054175">==</span>&nbsp;<span class="ident" id="4054178">nil</span>&nbsp;<span class="op" id="4054182">&amp;&amp;</span>&nbsp;<span class="ident" id="4054185">roots</span><span class="op" id="4054190">.</span><span class="ident" id="4054191">AppendCertsFromPEM</span><span class="op" id="4054209">(</span><span class="ident" id="4054210">data</span><span class="op" id="4054214">)</span>&nbsp;<span class="op" id="4054216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4054222">rootsAdded</span>&nbsp;<span class="op" id="4054233">=</span>&nbsp;<span class="builtintype" id="4054235">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4054243">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4054247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4054251">if</span>&nbsp;<span class="ident" id="4054254">rootsAdded</span>&nbsp;<span class="op" id="4054265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4054270">systemRoots</span>&nbsp;<span class="op" id="4054282">=</span>&nbsp;<span class="ident" id="4054284">roots</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4054293">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4054302">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4054305">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4054309">//&nbsp;All&nbsp;of&nbsp;the&nbsp;files&nbsp;failed&nbsp;to&nbsp;load.&nbsp;systemRoots&nbsp;will&nbsp;be&nbsp;nil&nbsp;which&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4054381">//&nbsp;trigger&nbsp;a&nbsp;specific&nbsp;error&nbsp;at&nbsp;verification&nbsp;time.</span><br>
<span class="lineno"></span><span class="op" id="4054431">}</span>
</div>
</body>
</html>
