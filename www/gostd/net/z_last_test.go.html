<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html" class="current">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7686467">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7686522">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7686576">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7686627">package</span>&nbsp;<span class="ident" id="7686635">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7686640">import</span>&nbsp;<span class="op" id="7686647">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7686650">&#34;flag&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7686658">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7686665">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7686676">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7686683">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7686686">var</span>&nbsp;<span class="ident" id="7686690">testDNSFlood</span>&nbsp;<span class="op" id="7686703">=</span>&nbsp;<span class="ident" id="7686705">flag</span><span class="op" id="7686709">.</span><span class="ident" id="7686710">Bool</span><span class="op" id="7686714">(</span><span class="string" id="7686715">&#34;dnsflood&#34;</span><span class="op" id="7686725">,</span>&nbsp;<span class="builtintype" id="7686727">false</span><span class="op" id="7686732">,</span>&nbsp;<span class="string" id="7686734">&#34;whether&nbsp;to&nbsp;test&nbsp;dns&nbsp;query&nbsp;flooding&#34;</span><span class="op" id="7686770">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="7686773">func</span>&nbsp;<span class="ident" id="7686778">TestDNSThreadLimit</span><span class="op" id="7686796">(</span><span class="ident" id="7686797">t</span>&nbsp;<span class="op" id="7686799">*</span><span class="ident" id="7686800">testing</span><span class="op" id="7686807">.</span><span class="ident" id="7686808">T</span><span class="op" id="7686809">)</span>&nbsp;<span class="op" id="7686811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7686814">if</span>&nbsp;<span class="op" id="7686817">!</span><span class="op" id="7686818">*</span><span class="ident" id="7686819">testDNSFlood</span>&nbsp;<span class="op" id="7686832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686836">t</span><span class="op" id="7686837">.</span><span class="ident" id="7686838">Skip</span><span class="op" id="7686842">(</span><span class="string" id="7686843">&#34;test&nbsp;disabled;&nbsp;use&nbsp;-dnsflood&nbsp;to&nbsp;enable&#34;</span><span class="op" id="7686883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7686886">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7686890">const</span>&nbsp;<span class="ident" id="7686896">N</span>&nbsp;<span class="op" id="7686898">=</span>&nbsp;<span class="num" id="7686900">10000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686907">c</span>&nbsp;<span class="op" id="7686909">:=</span>&nbsp;<span class="builtinfunc" id="7686912">make</span><span class="op" id="7686916">(</span><span class="keyword" id="7686917">chan</span>&nbsp;<span class="builtintype" id="7686922">int</span><span class="op" id="7686925">,</span>&nbsp;<span class="ident" id="7686927">N</span><span class="op" id="7686928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7686931">for</span>&nbsp;<span class="ident" id="7686935">i</span>&nbsp;<span class="op" id="7686937">:=</span>&nbsp;<span class="num" id="7686940">0</span><span class="op" id="7686941">;</span>&nbsp;<span class="ident" id="7686943">i</span>&nbsp;<span class="op" id="7686945">&lt;</span>&nbsp;<span class="ident" id="7686947">N</span><span class="op" id="7686948">;</span>&nbsp;<span class="ident" id="7686950">i</span><span class="op" id="7686951">++</span>&nbsp;<span class="op" id="7686954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7686958">go</span>&nbsp;<span class="keyword" id="7686961">func</span><span class="op" id="7686965">(</span><span class="ident" id="7686966">i</span>&nbsp;<span class="builtintype" id="7686968">int</span><span class="op" id="7686971">)</span>&nbsp;<span class="op" id="7686973">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686978">LookupIP</span><span class="op" id="7686986">(</span><span class="ident" id="7686987">fmt</span><span class="op" id="7686990">.</span><span class="ident" id="7686991">Sprintf</span><span class="op" id="7686998">(</span><span class="string" id="7686999">&#34;%d.net-test.golang.org&#34;</span><span class="op" id="7687023">,</span>&nbsp;<span class="ident" id="7687025">i</span><span class="op" id="7687026">)</span><span class="op" id="7687027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7687032">c</span>&nbsp;<span class="op" id="7687034">&lt;-</span>&nbsp;<span class="num" id="7687037">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7687041">}</span><span class="op" id="7687042">(</span><span class="ident" id="7687043">i</span><span class="op" id="7687044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7687047">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7687050">//&nbsp;Don&#39;t&nbsp;bother&nbsp;waiting&nbsp;for&nbsp;the&nbsp;stragglers;&nbsp;stop&nbsp;at&nbsp;0.9&nbsp;N.</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7687110">for</span>&nbsp;<span class="ident" id="7687114">i</span>&nbsp;<span class="op" id="7687116">:=</span>&nbsp;<span class="num" id="7687119">0</span><span class="op" id="7687120">;</span>&nbsp;<span class="ident" id="7687122">i</span>&nbsp;<span class="op" id="7687124">&lt;</span>&nbsp;<span class="ident" id="7687126">N</span><span class="op" id="7687127">*</span><span class="num" id="7687128">9</span><span class="op" id="7687129">/</span><span class="num" id="7687130">10</span><span class="op" id="7687132">;</span>&nbsp;<span class="ident" id="7687134">i</span><span class="op" id="7687135">++</span>&nbsp;<span class="op" id="7687138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7687142">if</span>&nbsp;<span class="ident" id="7687145">i</span><span class="op" id="7687146">%</span><span class="num" id="7687147">100</span>&nbsp;<span class="op" id="7687151">==</span>&nbsp;<span class="num" id="7687154">0</span>&nbsp;<span class="op" id="7687156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7687161">//println(&#34;TestDNSThreadLimit:&#34;,&nbsp;i)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7687199">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7687203">&lt;-</span><span class="ident" id="7687205">c</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7687208">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7687212">//&nbsp;If&nbsp;we&#39;re&nbsp;still&nbsp;here,&nbsp;it&nbsp;worked.</span><br>
<span class="lineno"></span><span class="op" id="7687247">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="7687250">func</span>&nbsp;<span class="ident" id="7687255">TestLookupIPDeadline</span><span class="op" id="7687275">(</span><span class="ident" id="7687276">t</span>&nbsp;<span class="op" id="7687278">*</span><span class="ident" id="7687279">testing</span><span class="op" id="7687286">.</span><span class="ident" id="7687287">T</span><span class="op" id="7687288">)</span>&nbsp;<span class="op" id="7687290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7687293">if</span>&nbsp;<span class="op" id="7687296">!</span><span class="op" id="7687297">*</span><span class="ident" id="7687298">testDNSFlood</span>&nbsp;<span class="op" id="7687311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7687315">t</span><span class="op" id="7687316">.</span><span class="ident" id="7687317">Skip</span><span class="op" id="7687321">(</span><span class="string" id="7687322">&#34;test&nbsp;disabled;&nbsp;use&nbsp;-dnsflood&nbsp;to&nbsp;enable&#34;</span><span class="op" id="7687362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7687365">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7687369">const</span>&nbsp;<span class="ident" id="7687375">N</span>&nbsp;<span class="op" id="7687377">=</span>&nbsp;<span class="num" id="7687379">5000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7687385">const</span>&nbsp;<span class="ident" id="7687391">timeout</span>&nbsp;<span class="op" id="7687399">=</span>&nbsp;<span class="num" id="7687401">3</span>&nbsp;<span class="op" id="7687403">*</span>&nbsp;<span class="ident" id="7687405">time</span><span class="op" id="7687409">.</span><span class="ident" id="7687410">Second</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7687418">c</span>&nbsp;<span class="op" id="7687420">:=</span>&nbsp;<span class="builtinfunc" id="7687423">make</span><span class="op" id="7687427">(</span><span class="keyword" id="7687428">chan</span>&nbsp;<span class="builtintype" id="7687433">error</span><span class="op" id="7687438">,</span>&nbsp;<span class="num" id="7687440">2</span><span class="op" id="7687441">*</span><span class="ident" id="7687442">N</span><span class="op" id="7687443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7687446">for</span>&nbsp;<span class="ident" id="7687450">i</span>&nbsp;<span class="op" id="7687452">:=</span>&nbsp;<span class="num" id="7687455">0</span><span class="op" id="7687456">;</span>&nbsp;<span class="ident" id="7687458">i</span>&nbsp;<span class="op" id="7687460">&lt;</span>&nbsp;<span class="ident" id="7687462">N</span><span class="op" id="7687463">;</span>&nbsp;<span class="ident" id="7687465">i</span><span class="op" id="7687466">++</span>&nbsp;<span class="op" id="7687469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7687473">name</span>&nbsp;<span class="op" id="7687478">:=</span>&nbsp;<span class="ident" id="7687481">fmt</span><span class="op" id="7687484">.</span><span class="ident" id="7687485">Sprintf</span><span class="op" id="7687492">(</span><span class="string" id="7687493">&#34;%d.net-test.golang.org&#34;</span><span class="op" id="7687517">,</span>&nbsp;<span class="ident" id="7687519">i</span><span class="op" id="7687520">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7687524">go</span>&nbsp;<span class="keyword" id="7687527">func</span><span class="op" id="7687531">(</span><span class="op" id="7687532">)</span>&nbsp;<span class="op" id="7687534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7687539">_</span><span class="op" id="7687540">,</span>&nbsp;<span class="ident" id="7687542">err</span>&nbsp;<span class="op" id="7687546">:=</span>&nbsp;<span class="ident" id="7687549">lookupIPDeadline</span><span class="op" id="7687565">(</span><span class="ident" id="7687566">name</span><span class="op" id="7687570">,</span>&nbsp;<span class="ident" id="7687572">time</span><span class="op" id="7687576">.</span><span class="ident" id="7687577">Now</span><span class="op" id="7687580">(</span><span class="op" id="7687581">)</span><span class="op" id="7687582">.</span><span class="ident" id="7687583">Add</span><span class="op" id="7687586">(</span><span class="ident" id="7687587">timeout</span><span class="op" id="7687594">/</span><span class="num" id="7687595">2</span><span class="op" id="7687596">)</span><span class="op" id="7687597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7687602">c</span>&nbsp;<span class="op" id="7687604">&lt;-</span>&nbsp;<span class="ident" id="7687607">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7687613">}</span><span class="op" id="7687614">(</span><span class="op" id="7687615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7687619">go</span>&nbsp;<span class="keyword" id="7687622">func</span><span class="op" id="7687626">(</span><span class="op" id="7687627">)</span>&nbsp;<span class="op" id="7687629">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7687634">_</span><span class="op" id="7687635">,</span>&nbsp;<span class="ident" id="7687637">err</span>&nbsp;<span class="op" id="7687641">:=</span>&nbsp;<span class="ident" id="7687644">lookupIPDeadline</span><span class="op" id="7687660">(</span><span class="ident" id="7687661">name</span><span class="op" id="7687665">,</span>&nbsp;<span class="ident" id="7687667">time</span><span class="op" id="7687671">.</span><span class="ident" id="7687672">Now</span><span class="op" id="7687675">(</span><span class="op" id="7687676">)</span><span class="op" id="7687677">.</span><span class="ident" id="7687678">Add</span><span class="op" id="7687681">(</span><span class="ident" id="7687682">timeout</span><span class="op" id="7687689">)</span><span class="op" id="7687690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7687695">c</span>&nbsp;<span class="op" id="7687697">&lt;-</span>&nbsp;<span class="ident" id="7687700">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7687706">}</span><span class="op" id="7687707">(</span><span class="op" id="7687708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7687711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7687714">qstats</span>&nbsp;<span class="op" id="7687721">:=</span>&nbsp;<span class="keyword" id="7687724">struct</span>&nbsp;<span class="op" id="7687731">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7687735">succeeded</span><span class="op" id="7687744">,</span>&nbsp;<span class="ident" id="7687746">failed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7687761">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7687767">timeout</span><span class="op" id="7687774">,</span>&nbsp;<span class="ident" id="7687776">temporary</span><span class="op" id="7687785">,</span>&nbsp;<span class="ident" id="7687787">other</span>&nbsp;<span class="builtintype" id="7687793">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7687799">unknown</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7687825">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7687830">}</span><span class="op" id="7687831">{</span><span class="op" id="7687832">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7687835">deadline</span>&nbsp;<span class="op" id="7687844">:=</span>&nbsp;<span class="ident" id="7687847">time</span><span class="op" id="7687851">.</span><span class="ident" id="7687852">After</span><span class="op" id="7687857">(</span><span class="ident" id="7687858">timeout</span>&nbsp;<span class="op" id="7687866">+</span>&nbsp;<span class="ident" id="7687868">time</span><span class="op" id="7687872">.</span><span class="ident" id="7687873">Second</span><span class="op" id="7687879">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7687882">for</span>&nbsp;<span class="ident" id="7687886">i</span>&nbsp;<span class="op" id="7687888">:=</span>&nbsp;<span class="num" id="7687891">0</span><span class="op" id="7687892">;</span>&nbsp;<span class="ident" id="7687894">i</span>&nbsp;<span class="op" id="7687896">&lt;</span>&nbsp;<span class="num" id="7687898">2</span><span class="op" id="7687899">*</span><span class="ident" id="7687900">N</span><span class="op" id="7687901">;</span>&nbsp;<span class="ident" id="7687903">i</span><span class="op" id="7687904">++</span>&nbsp;<span class="op" id="7687907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7687911">select</span>&nbsp;<span class="op" id="7687918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7687922">case</span>&nbsp;<span class="op" id="7687927">&lt;-</span><span class="ident" id="7687929">deadline</span><span class="op" id="7687937">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7687942">t</span><span class="op" id="7687943">.</span><span class="ident" id="7687944">Fatal</span><span class="op" id="7687949">(</span><span class="string" id="7687950">&#34;deadline&nbsp;exceeded&#34;</span><span class="op" id="7687969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7687973">case</span>&nbsp;<span class="ident" id="7687978">err</span>&nbsp;<span class="op" id="7687982">:=</span>&nbsp;<span class="op" id="7687985">&lt;-</span><span class="ident" id="7687987">c</span><span class="op" id="7687988">:</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7687993">switch</span>&nbsp;<span class="ident" id="7688000">err</span>&nbsp;<span class="op" id="7688004">:=</span>&nbsp;<span class="ident" id="7688007">err</span><span class="op" id="7688010">.</span><span class="op" id="7688011">(</span><span class="keyword" id="7688012">type</span><span class="op" id="7688016">)</span>&nbsp;<span class="op" id="7688018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7688023">case</span>&nbsp;<span class="ident" id="7688028">nil</span><span class="op" id="7688031">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688037">qstats</span><span class="op" id="7688043">.</span><span class="ident" id="7688044">succeeded</span><span class="op" id="7688053">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7688059">case</span>&nbsp;<span class="ident" id="7688064">Error</span><span class="op" id="7688069">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688075">qstats</span><span class="op" id="7688081">.</span><span class="ident" id="7688082">failed</span><span class="op" id="7688088">++</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7688095">if</span>&nbsp;<span class="ident" id="7688098">err</span><span class="op" id="7688101">.</span><span class="ident" id="7688102">Timeout</span><span class="op" id="7688109">(</span><span class="op" id="7688110">)</span>&nbsp;<span class="op" id="7688112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688119">qstats</span><span class="op" id="7688125">.</span><span class="ident" id="7688126">timeout</span><span class="op" id="7688133">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7688140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7688146">if</span>&nbsp;<span class="ident" id="7688149">err</span><span class="op" id="7688152">.</span><span class="ident" id="7688153">Temporary</span><span class="op" id="7688162">(</span><span class="op" id="7688163">)</span>&nbsp;<span class="op" id="7688165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688172">qstats</span><span class="op" id="7688178">.</span><span class="ident" id="7688179">temporary</span><span class="op" id="7688188">++</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7688195">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7688201">if</span>&nbsp;<span class="op" id="7688204">!</span><span class="ident" id="7688205">err</span><span class="op" id="7688208">.</span><span class="ident" id="7688209">Timeout</span><span class="op" id="7688216">(</span><span class="op" id="7688217">)</span>&nbsp;<span class="op" id="7688219">&amp;&amp;</span>&nbsp;<span class="op" id="7688222">!</span><span class="ident" id="7688223">err</span><span class="op" id="7688226">.</span><span class="ident" id="7688227">Temporary</span><span class="op" id="7688236">(</span><span class="op" id="7688237">)</span>&nbsp;<span class="op" id="7688239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688246">qstats</span><span class="op" id="7688252">.</span><span class="ident" id="7688253">other</span><span class="op" id="7688258">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7688265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7688270">default</span><span class="op" id="7688277">:</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688283">qstats</span><span class="op" id="7688289">.</span><span class="ident" id="7688290">failed</span><span class="op" id="7688296">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688303">qstats</span><span class="op" id="7688309">.</span><span class="ident" id="7688310">unknown</span><span class="op" id="7688317">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7688323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7688327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7688330">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7688334">//&nbsp;A&nbsp;high&nbsp;volume&nbsp;of&nbsp;DNS&nbsp;queries&nbsp;for&nbsp;sub-domain&nbsp;of&nbsp;golang.org</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7688396">//&nbsp;would&nbsp;be&nbsp;coordinated&nbsp;by&nbsp;authoritative&nbsp;or&nbsp;recursive&nbsp;server,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7688459">//&nbsp;or&nbsp;stub&nbsp;resolver&nbsp;which&nbsp;implements&nbsp;query-response&nbsp;rate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7688517">//&nbsp;limitation,&nbsp;so&nbsp;we&nbsp;can&nbsp;expect&nbsp;some&nbsp;query&nbsp;successes&nbsp;and&nbsp;more</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7688580">//&nbsp;failures&nbsp;including&nbsp;timeout,&nbsp;temporary&nbsp;and&nbsp;other&nbsp;here.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7688638">//&nbsp;As&nbsp;a&nbsp;rule,&nbsp;unknown&nbsp;must&nbsp;not&nbsp;be&nbsp;shown&nbsp;but&nbsp;it&nbsp;might&nbsp;possibly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7688701">//&nbsp;happen&nbsp;due&nbsp;to&nbsp;issue&nbsp;4856&nbsp;for&nbsp;now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688739">t</span><span class="op" id="7688740">.</span><span class="ident" id="7688741">Logf</span><span class="op" id="7688745">(</span><span class="string" id="7688746">&#34;%v&nbsp;succeeded,&nbsp;%v&nbsp;failed&nbsp;(%v&nbsp;timeout,&nbsp;%v&nbsp;temporary,&nbsp;%v&nbsp;other,&nbsp;%v&nbsp;unknown)&#34;</span><span class="op" id="7688820">,</span>&nbsp;<span class="ident" id="7688822">qstats</span><span class="op" id="7688828">.</span><span class="ident" id="7688829">succeeded</span><span class="op" id="7688838">,</span>&nbsp;<span class="ident" id="7688840">qstats</span><span class="op" id="7688846">.</span><span class="ident" id="7688847">failed</span><span class="op" id="7688853">,</span>&nbsp;<span class="ident" id="7688855">qstats</span><span class="op" id="7688861">.</span><span class="ident" id="7688862">timeout</span><span class="op" id="7688869">,</span>&nbsp;<span class="ident" id="7688871">qstats</span><span class="op" id="7688877">.</span><span class="ident" id="7688878">temporary</span><span class="op" id="7688887">,</span>&nbsp;<span class="ident" id="7688889">qstats</span><span class="op" id="7688895">.</span><span class="ident" id="7688896">other</span><span class="op" id="7688901">,</span>&nbsp;<span class="ident" id="7688903">qstats</span><span class="op" id="7688909">.</span><span class="ident" id="7688910">unknown</span><span class="op" id="7688917">)</span><br>
<span class="lineno"></span><span class="op" id="7688919">}</span>
</div>
</body>
</html>
