<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7976804">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7976859">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7976913">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7976964">package</span>&nbsp;<span class="ident" id="7976972">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7976982">import</span>&nbsp;<span class="op" id="7976989">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7976992">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7977001">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7977011">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7977024">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7977035">&#34;text/template/parse&#34;</span><br>
<span class="lineno"></span><span class="op" id="7977057">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="7977060">func</span>&nbsp;<span class="ident" id="7977065">TestAddParseTree</span><span class="op" id="7977081">(</span><span class="ident" id="7977082">t</span>&nbsp;<span class="op" id="7977084">*</span><span class="ident" id="7977085">testing</span><span class="op" id="7977092">.</span><span class="ident" id="7977093">T</span><span class="op" id="7977094">)</span>&nbsp;<span class="op" id="7977096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7977099">root</span>&nbsp;<span class="op" id="7977104">:=</span>&nbsp;<span class="ident" id="7977107">Must</span><span class="op" id="7977111">(</span><span class="ident" id="7977112">New</span><span class="op" id="7977115">(</span><span class="string" id="7977116">&#34;root&#34;</span><span class="op" id="7977122">)</span><span class="op" id="7977123">.</span><span class="ident" id="7977124">Parse</span><span class="op" id="7977129">(</span><span class="string" id="7977130">`{{define&nbsp;&#34;a&#34;}}&nbsp;{{.}}&nbsp;{{template&nbsp;&#34;b&#34;}}&nbsp;{{.}}&nbsp;&#34;&gt;&lt;/a&gt;{{end}}`</span><span class="op" id="7977189">)</span><span class="op" id="7977190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7977193">tree</span><span class="op" id="7977197">,</span>&nbsp;<span class="ident" id="7977199">err</span>&nbsp;<span class="op" id="7977203">:=</span>&nbsp;<span class="ident" id="7977206">parse</span><span class="op" id="7977211">.</span><span class="ident" id="7977212">Parse</span><span class="op" id="7977217">(</span><span class="string" id="7977218">&#34;t&#34;</span><span class="op" id="7977221">,</span>&nbsp;<span class="string" id="7977223">`{{define&nbsp;&#34;b&#34;}}&lt;a&nbsp;href=&#34;{{end}}`</span><span class="op" id="7977255">,</span>&nbsp;<span class="string" id="7977257">&#34;&#34;</span><span class="op" id="7977259">,</span>&nbsp;<span class="string" id="7977261">&#34;&#34;</span><span class="op" id="7977263">,</span>&nbsp;<span class="ident" id="7977265">nil</span><span class="op" id="7977268">,</span>&nbsp;<span class="ident" id="7977270">nil</span><span class="op" id="7977273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7977276">if</span>&nbsp;<span class="ident" id="7977279">err</span>&nbsp;<span class="op" id="7977283">!=</span>&nbsp;<span class="ident" id="7977286">nil</span>&nbsp;<span class="op" id="7977290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7977294">t</span><span class="op" id="7977295">.</span><span class="ident" id="7977296">Fatal</span><span class="op" id="7977301">(</span><span class="ident" id="7977302">err</span><span class="op" id="7977305">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7977308">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7977311">added</span>&nbsp;<span class="op" id="7977317">:=</span>&nbsp;<span class="ident" id="7977320">Must</span><span class="op" id="7977324">(</span><span class="ident" id="7977325">root</span><span class="op" id="7977329">.</span><span class="ident" id="7977330">AddParseTree</span><span class="op" id="7977342">(</span><span class="string" id="7977343">&#34;b&#34;</span><span class="op" id="7977346">,</span>&nbsp;<span class="ident" id="7977348">tree</span><span class="op" id="7977352">[</span><span class="string" id="7977353">&#34;b&#34;</span><span class="op" id="7977356">]</span><span class="op" id="7977357">)</span><span class="op" id="7977358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7977361">b</span>&nbsp;<span class="op" id="7977363">:=</span>&nbsp;<span class="builtinfunc" id="7977366">new</span><span class="op" id="7977369">(</span><span class="ident" id="7977370">bytes</span><span class="op" id="7977375">.</span><span class="ident" id="7977376">Buffer</span><span class="op" id="7977382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7977385">err</span>&nbsp;<span class="op" id="7977389">=</span>&nbsp;<span class="ident" id="7977391">added</span><span class="op" id="7977396">.</span><span class="ident" id="7977397">ExecuteTemplate</span><span class="op" id="7977412">(</span><span class="ident" id="7977413">b</span><span class="op" id="7977414">,</span>&nbsp;<span class="string" id="7977416">&#34;a&#34;</span><span class="op" id="7977419">,</span>&nbsp;<span class="string" id="7977421">&#34;1&gt;0&#34;</span><span class="op" id="7977426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7977429">if</span>&nbsp;<span class="ident" id="7977432">err</span>&nbsp;<span class="op" id="7977436">!=</span>&nbsp;<span class="ident" id="7977439">nil</span>&nbsp;<span class="op" id="7977443">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7977447">t</span><span class="op" id="7977448">.</span><span class="ident" id="7977449">Fatal</span><span class="op" id="7977454">(</span><span class="ident" id="7977455">err</span><span class="op" id="7977458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7977461">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7977464">if</span>&nbsp;<span class="ident" id="7977467">got</span><span class="op" id="7977470">,</span>&nbsp;<span class="ident" id="7977472">want</span>&nbsp;<span class="op" id="7977477">:=</span>&nbsp;<span class="ident" id="7977480">b</span><span class="op" id="7977481">.</span><span class="ident" id="7977482">String</span><span class="op" id="7977488">(</span><span class="op" id="7977489">)</span><span class="op" id="7977490">,</span>&nbsp;<span class="string" id="7977492">`&nbsp;1&amp;gt;0&nbsp;&lt;a&nbsp;href=&#34;&nbsp;1%3e0&nbsp;&#34;&gt;&lt;/a&gt;`</span><span class="op" id="7977524">;</span>&nbsp;<span class="ident" id="7977526">got</span>&nbsp;<span class="op" id="7977530">!=</span>&nbsp;<span class="ident" id="7977533">want</span>&nbsp;<span class="op" id="7977538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7977542">t</span><span class="op" id="7977543">.</span><span class="ident" id="7977544">Errorf</span><span class="op" id="7977550">(</span><span class="string" id="7977551">&#34;got&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7977567">,</span>&nbsp;<span class="ident" id="7977569">got</span><span class="op" id="7977572">,</span>&nbsp;<span class="ident" id="7977574">want</span><span class="op" id="7977578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7977581">}</span><br>
<span class="lineno">30</span><span class="op" id="7977583">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7977586">func</span>&nbsp;<span class="ident" id="7977591">TestClone</span><span class="op" id="7977600">(</span><span class="ident" id="7977601">t</span>&nbsp;<span class="op" id="7977603">*</span><span class="ident" id="7977604">testing</span><span class="op" id="7977611">.</span><span class="ident" id="7977612">T</span><span class="op" id="7977613">)</span>&nbsp;<span class="op" id="7977615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7977618">//&nbsp;The&nbsp;{{.}}&nbsp;will&nbsp;be&nbsp;executed&nbsp;with&nbsp;data&nbsp;&#34;&lt;i&gt;*/&#34;&nbsp;in&nbsp;different&nbsp;contexts.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7977690">//&nbsp;In&nbsp;the&nbsp;t0&nbsp;template,&nbsp;it&nbsp;will&nbsp;be&nbsp;in&nbsp;a&nbsp;text&nbsp;context.</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7977744">//&nbsp;In&nbsp;the&nbsp;t1&nbsp;template,&nbsp;it&nbsp;will&nbsp;be&nbsp;in&nbsp;a&nbsp;URL&nbsp;context.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7977797">//&nbsp;In&nbsp;the&nbsp;t2&nbsp;template,&nbsp;it&nbsp;will&nbsp;be&nbsp;in&nbsp;a&nbsp;JavaScript&nbsp;context.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7977857">//&nbsp;In&nbsp;the&nbsp;t3&nbsp;template,&nbsp;it&nbsp;will&nbsp;be&nbsp;in&nbsp;a&nbsp;CSS&nbsp;context.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7977910">const</span>&nbsp;<span class="ident" id="7977916">tmpl</span>&nbsp;<span class="op" id="7977921">=</span>&nbsp;<span class="string" id="7977923">`{{define&nbsp;&#34;a&#34;}}{{template&nbsp;&#34;lhs&#34;}}{{.}}{{template&nbsp;&#34;rhs&#34;}}{{end}}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7977989">b</span>&nbsp;<span class="op" id="7977991">:=</span>&nbsp;<span class="builtinfunc" id="7977994">new</span><span class="op" id="7977997">(</span><span class="ident" id="7977998">bytes</span><span class="op" id="7978003">.</span><span class="ident" id="7978004">Buffer</span><span class="op" id="7978010">)</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7978014">//&nbsp;Create&nbsp;an&nbsp;incomplete&nbsp;template&nbsp;t0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7978052">t0</span>&nbsp;<span class="op" id="7978055">:=</span>&nbsp;<span class="ident" id="7978058">Must</span><span class="op" id="7978062">(</span><span class="ident" id="7978063">New</span><span class="op" id="7978066">(</span><span class="string" id="7978067">&#34;t0&#34;</span><span class="op" id="7978071">)</span><span class="op" id="7978072">.</span><span class="ident" id="7978073">Parse</span><span class="op" id="7978078">(</span><span class="ident" id="7978079">tmpl</span><span class="op" id="7978083">)</span><span class="op" id="7978084">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7978088">//&nbsp;Clone&nbsp;t0&nbsp;as&nbsp;t1.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7978108">t1</span>&nbsp;<span class="op" id="7978111">:=</span>&nbsp;<span class="ident" id="7978114">Must</span><span class="op" id="7978118">(</span><span class="ident" id="7978119">t0</span><span class="op" id="7978121">.</span><span class="ident" id="7978122">Clone</span><span class="op" id="7978127">(</span><span class="op" id="7978128">)</span><span class="op" id="7978129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7978132">Must</span><span class="op" id="7978136">(</span><span class="ident" id="7978137">t1</span><span class="op" id="7978139">.</span><span class="ident" id="7978140">Parse</span><span class="op" id="7978145">(</span><span class="string" id="7978146">`{{define&nbsp;&#34;lhs&#34;}}&nbsp;&lt;a&nbsp;href=&#34;&nbsp;{{end}}`</span><span class="op" id="7978182">)</span><span class="op" id="7978183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7978186">Must</span><span class="op" id="7978190">(</span><span class="ident" id="7978191">t1</span><span class="op" id="7978193">.</span><span class="ident" id="7978194">Parse</span><span class="op" id="7978199">(</span><span class="string" id="7978200">`{{define&nbsp;&#34;rhs&#34;}}&nbsp;&#34;&gt;&lt;/a&gt;&nbsp;{{end}}`</span><span class="op" id="7978233">)</span><span class="op" id="7978234">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7978238">//&nbsp;Execute&nbsp;t1.</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7978254">b</span><span class="op" id="7978255">.</span><span class="ident" id="7978256">Reset</span><span class="op" id="7978261">(</span><span class="op" id="7978262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7978265">if</span>&nbsp;<span class="ident" id="7978268">err</span>&nbsp;<span class="op" id="7978272">:=</span>&nbsp;<span class="ident" id="7978275">t1</span><span class="op" id="7978277">.</span><span class="ident" id="7978278">ExecuteTemplate</span><span class="op" id="7978293">(</span><span class="ident" id="7978294">b</span><span class="op" id="7978295">,</span>&nbsp;<span class="string" id="7978297">&#34;a&#34;</span><span class="op" id="7978300">,</span>&nbsp;<span class="string" id="7978302">&#34;&lt;i&gt;*/&#34;</span><span class="op" id="7978309">)</span><span class="op" id="7978310">;</span>&nbsp;<span class="ident" id="7978312">err</span>&nbsp;<span class="op" id="7978316">!=</span>&nbsp;<span class="ident" id="7978319">nil</span>&nbsp;<span class="op" id="7978323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7978327">t</span><span class="op" id="7978328">.</span><span class="ident" id="7978329">Fatal</span><span class="op" id="7978334">(</span><span class="ident" id="7978335">err</span><span class="op" id="7978338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7978341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7978344">if</span>&nbsp;<span class="ident" id="7978347">got</span><span class="op" id="7978350">,</span>&nbsp;<span class="ident" id="7978352">want</span>&nbsp;<span class="op" id="7978357">:=</span>&nbsp;<span class="ident" id="7978360">b</span><span class="op" id="7978361">.</span><span class="ident" id="7978362">String</span><span class="op" id="7978368">(</span><span class="op" id="7978369">)</span><span class="op" id="7978370">,</span>&nbsp;<span class="string" id="7978372">`&nbsp;&lt;a&nbsp;href=&#34;&nbsp;%3ci%3e*/&nbsp;&#34;&gt;&lt;/a&gt;&nbsp;`</span><span class="op" id="7978402">;</span>&nbsp;<span class="ident" id="7978404">got</span>&nbsp;<span class="op" id="7978408">!=</span>&nbsp;<span class="ident" id="7978411">want</span>&nbsp;<span class="op" id="7978416">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7978420">t</span><span class="op" id="7978421">.</span><span class="ident" id="7978422">Errorf</span><span class="op" id="7978428">(</span><span class="string" id="7978429">&#34;t1:&nbsp;got&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7978449">,</span>&nbsp;<span class="ident" id="7978451">got</span><span class="op" id="7978454">,</span>&nbsp;<span class="ident" id="7978456">want</span><span class="op" id="7978460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7978463">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7978467">//&nbsp;Clone&nbsp;t0&nbsp;as&nbsp;t2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7978487">t2</span>&nbsp;<span class="op" id="7978490">:=</span>&nbsp;<span class="ident" id="7978493">Must</span><span class="op" id="7978497">(</span><span class="ident" id="7978498">t0</span><span class="op" id="7978500">.</span><span class="ident" id="7978501">Clone</span><span class="op" id="7978506">(</span><span class="op" id="7978507">)</span><span class="op" id="7978508">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7978511">Must</span><span class="op" id="7978515">(</span><span class="ident" id="7978516">t2</span><span class="op" id="7978518">.</span><span class="ident" id="7978519">Parse</span><span class="op" id="7978524">(</span><span class="string" id="7978525">`{{define&nbsp;&#34;lhs&#34;}}&nbsp;&lt;p&nbsp;onclick=&#34;javascript:&nbsp;{{end}}`</span><span class="op" id="7978575">)</span><span class="op" id="7978576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7978579">Must</span><span class="op" id="7978583">(</span><span class="ident" id="7978584">t2</span><span class="op" id="7978586">.</span><span class="ident" id="7978587">Parse</span><span class="op" id="7978592">(</span><span class="string" id="7978593">`{{define&nbsp;&#34;rhs&#34;}}&nbsp;&#34;&gt;&lt;/p&gt;&nbsp;{{end}}`</span><span class="op" id="7978626">)</span><span class="op" id="7978627">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7978631">//&nbsp;Execute&nbsp;t2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7978647">b</span><span class="op" id="7978648">.</span><span class="ident" id="7978649">Reset</span><span class="op" id="7978654">(</span><span class="op" id="7978655">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7978658">if</span>&nbsp;<span class="ident" id="7978661">err</span>&nbsp;<span class="op" id="7978665">:=</span>&nbsp;<span class="ident" id="7978668">t2</span><span class="op" id="7978670">.</span><span class="ident" id="7978671">ExecuteTemplate</span><span class="op" id="7978686">(</span><span class="ident" id="7978687">b</span><span class="op" id="7978688">,</span>&nbsp;<span class="string" id="7978690">&#34;a&#34;</span><span class="op" id="7978693">,</span>&nbsp;<span class="string" id="7978695">&#34;&lt;i&gt;*/&#34;</span><span class="op" id="7978702">)</span><span class="op" id="7978703">;</span>&nbsp;<span class="ident" id="7978705">err</span>&nbsp;<span class="op" id="7978709">!=</span>&nbsp;<span class="ident" id="7978712">nil</span>&nbsp;<span class="op" id="7978716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7978720">t</span><span class="op" id="7978721">.</span><span class="ident" id="7978722">Fatal</span><span class="op" id="7978727">(</span><span class="ident" id="7978728">err</span><span class="op" id="7978731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7978734">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7978737">if</span>&nbsp;<span class="ident" id="7978740">got</span><span class="op" id="7978743">,</span>&nbsp;<span class="ident" id="7978745">want</span>&nbsp;<span class="op" id="7978750">:=</span>&nbsp;<span class="ident" id="7978753">b</span><span class="op" id="7978754">.</span><span class="ident" id="7978755">String</span><span class="op" id="7978761">(</span><span class="op" id="7978762">)</span><span class="op" id="7978763">,</span>&nbsp;<span class="string" id="7978765">`&nbsp;&lt;p&nbsp;onclick=&#34;javascript:&nbsp;&amp;#34;\u003ci\u003e*/&amp;#34;&nbsp;&#34;&gt;&lt;/p&gt;&nbsp;`</span><span class="op" id="7978825">;</span>&nbsp;<span class="ident" id="7978827">got</span>&nbsp;<span class="op" id="7978831">!=</span>&nbsp;<span class="ident" id="7978834">want</span>&nbsp;<span class="op" id="7978839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7978843">t</span><span class="op" id="7978844">.</span><span class="ident" id="7978845">Errorf</span><span class="op" id="7978851">(</span><span class="string" id="7978852">&#34;t2:&nbsp;got&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7978872">,</span>&nbsp;<span class="ident" id="7978874">got</span><span class="op" id="7978877">,</span>&nbsp;<span class="ident" id="7978879">want</span><span class="op" id="7978883">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7978886">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7978890">//&nbsp;Clone&nbsp;t0&nbsp;as&nbsp;t3,&nbsp;but&nbsp;do&nbsp;not&nbsp;execute&nbsp;t3&nbsp;yet.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7978937">t3</span>&nbsp;<span class="op" id="7978940">:=</span>&nbsp;<span class="ident" id="7978943">Must</span><span class="op" id="7978947">(</span><span class="ident" id="7978948">t0</span><span class="op" id="7978950">.</span><span class="ident" id="7978951">Clone</span><span class="op" id="7978956">(</span><span class="op" id="7978957">)</span><span class="op" id="7978958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7978961">Must</span><span class="op" id="7978965">(</span><span class="ident" id="7978966">t3</span><span class="op" id="7978968">.</span><span class="ident" id="7978969">Parse</span><span class="op" id="7978974">(</span><span class="string" id="7978975">`{{define&nbsp;&#34;lhs&#34;}}&nbsp;&lt;style&gt;&nbsp;{{end}}`</span><span class="op" id="7979009">)</span><span class="op" id="7979010">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7979013">Must</span><span class="op" id="7979017">(</span><span class="ident" id="7979018">t3</span><span class="op" id="7979020">.</span><span class="ident" id="7979021">Parse</span><span class="op" id="7979026">(</span><span class="string" id="7979027">`{{define&nbsp;&#34;rhs&#34;}}&nbsp;&lt;/style&gt;&nbsp;{{end}}`</span><span class="op" id="7979062">)</span><span class="op" id="7979063">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7979067">//&nbsp;Complete&nbsp;t0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7979084">Must</span><span class="op" id="7979088">(</span><span class="ident" id="7979089">t0</span><span class="op" id="7979091">.</span><span class="ident" id="7979092">Parse</span><span class="op" id="7979097">(</span><span class="string" id="7979098">`{{define&nbsp;&#34;lhs&#34;}}&nbsp;(&nbsp;{{end}}`</span><span class="op" id="7979126">)</span><span class="op" id="7979127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7979130">Must</span><span class="op" id="7979134">(</span><span class="ident" id="7979135">t0</span><span class="op" id="7979137">.</span><span class="ident" id="7979138">Parse</span><span class="op" id="7979143">(</span><span class="string" id="7979144">`{{define&nbsp;&#34;rhs&#34;}}&nbsp;)&nbsp;{{end}}`</span><span class="op" id="7979172">)</span><span class="op" id="7979173">)</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7979177">//&nbsp;Clone&nbsp;t0&nbsp;as&nbsp;t4.&nbsp;Redefining&nbsp;the&nbsp;&#34;lhs&#34;&nbsp;template&nbsp;should&nbsp;fail.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7979240">t4</span>&nbsp;<span class="op" id="7979243">:=</span>&nbsp;<span class="ident" id="7979246">Must</span><span class="op" id="7979250">(</span><span class="ident" id="7979251">t0</span><span class="op" id="7979253">.</span><span class="ident" id="7979254">Clone</span><span class="op" id="7979259">(</span><span class="op" id="7979260">)</span><span class="op" id="7979261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7979264">if</span>&nbsp;<span class="ident" id="7979267">_</span><span class="op" id="7979268">,</span>&nbsp;<span class="ident" id="7979270">err</span>&nbsp;<span class="op" id="7979274">:=</span>&nbsp;<span class="ident" id="7979277">t4</span><span class="op" id="7979279">.</span><span class="ident" id="7979280">Parse</span><span class="op" id="7979285">(</span><span class="string" id="7979286">`{{define&nbsp;&#34;lhs&#34;}}&nbsp;FAIL&nbsp;{{end}}`</span><span class="op" id="7979317">)</span><span class="op" id="7979318">;</span>&nbsp;<span class="ident" id="7979320">err</span>&nbsp;<span class="op" id="7979324">==</span>&nbsp;<span class="ident" id="7979327">nil</span>&nbsp;<span class="op" id="7979331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7979335">t</span><span class="op" id="7979336">.</span><span class="ident" id="7979337">Error</span><span class="op" id="7979342">(</span><span class="string" id="7979343">`redefine&nbsp;&#34;lhs&#34;:&nbsp;got&nbsp;nil&nbsp;err&nbsp;want&nbsp;non-nil`</span><span class="op" id="7979385">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7979388">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7979392">//&nbsp;Execute&nbsp;t0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7979408">b</span><span class="op" id="7979409">.</span><span class="ident" id="7979410">Reset</span><span class="op" id="7979415">(</span><span class="op" id="7979416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7979419">if</span>&nbsp;<span class="ident" id="7979422">err</span>&nbsp;<span class="op" id="7979426">:=</span>&nbsp;<span class="ident" id="7979429">t0</span><span class="op" id="7979431">.</span><span class="ident" id="7979432">ExecuteTemplate</span><span class="op" id="7979447">(</span><span class="ident" id="7979448">b</span><span class="op" id="7979449">,</span>&nbsp;<span class="string" id="7979451">&#34;a&#34;</span><span class="op" id="7979454">,</span>&nbsp;<span class="string" id="7979456">&#34;&lt;i&gt;*/&#34;</span><span class="op" id="7979463">)</span><span class="op" id="7979464">;</span>&nbsp;<span class="ident" id="7979466">err</span>&nbsp;<span class="op" id="7979470">!=</span>&nbsp;<span class="ident" id="7979473">nil</span>&nbsp;<span class="op" id="7979477">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7979481">t</span><span class="op" id="7979482">.</span><span class="ident" id="7979483">Fatal</span><span class="op" id="7979488">(</span><span class="ident" id="7979489">err</span><span class="op" id="7979492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7979495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7979498">if</span>&nbsp;<span class="ident" id="7979501">got</span><span class="op" id="7979504">,</span>&nbsp;<span class="ident" id="7979506">want</span>&nbsp;<span class="op" id="7979511">:=</span>&nbsp;<span class="ident" id="7979514">b</span><span class="op" id="7979515">.</span><span class="ident" id="7979516">String</span><span class="op" id="7979522">(</span><span class="op" id="7979523">)</span><span class="op" id="7979524">,</span>&nbsp;<span class="string" id="7979526">`&nbsp;(&nbsp;&amp;lt;i&amp;gt;*/&nbsp;)&nbsp;`</span><span class="op" id="7979545">;</span>&nbsp;<span class="ident" id="7979547">got</span>&nbsp;<span class="op" id="7979551">!=</span>&nbsp;<span class="ident" id="7979554">want</span>&nbsp;<span class="op" id="7979559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7979563">t</span><span class="op" id="7979564">.</span><span class="ident" id="7979565">Errorf</span><span class="op" id="7979571">(</span><span class="string" id="7979572">&#34;t0:&nbsp;got&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7979592">,</span>&nbsp;<span class="ident" id="7979594">got</span><span class="op" id="7979597">,</span>&nbsp;<span class="ident" id="7979599">want</span><span class="op" id="7979603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7979606">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7979610">//&nbsp;Clone&nbsp;t0.&nbsp;This&nbsp;should&nbsp;fail,&nbsp;as&nbsp;t0&nbsp;has&nbsp;already&nbsp;executed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7979670">if</span>&nbsp;<span class="ident" id="7979673">_</span><span class="op" id="7979674">,</span>&nbsp;<span class="ident" id="7979676">err</span>&nbsp;<span class="op" id="7979680">:=</span>&nbsp;<span class="ident" id="7979683">t0</span><span class="op" id="7979685">.</span><span class="ident" id="7979686">Clone</span><span class="op" id="7979691">(</span><span class="op" id="7979692">)</span><span class="op" id="7979693">;</span>&nbsp;<span class="ident" id="7979695">err</span>&nbsp;<span class="op" id="7979699">==</span>&nbsp;<span class="ident" id="7979702">nil</span>&nbsp;<span class="op" id="7979706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7979710">t</span><span class="op" id="7979711">.</span><span class="ident" id="7979712">Error</span><span class="op" id="7979717">(</span><span class="string" id="7979718">`t0.Clone():&nbsp;got&nbsp;nil&nbsp;err&nbsp;want&nbsp;non-nil`</span><span class="op" id="7979756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7979759">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7979763">//&nbsp;Similarly,&nbsp;cloning&nbsp;sub-templates&nbsp;should&nbsp;fail.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7979813">if</span>&nbsp;<span class="ident" id="7979816">_</span><span class="op" id="7979817">,</span>&nbsp;<span class="ident" id="7979819">err</span>&nbsp;<span class="op" id="7979823">:=</span>&nbsp;<span class="ident" id="7979826">t0</span><span class="op" id="7979828">.</span><span class="ident" id="7979829">Lookup</span><span class="op" id="7979835">(</span><span class="string" id="7979836">&#34;a&#34;</span><span class="op" id="7979839">)</span><span class="op" id="7979840">.</span><span class="ident" id="7979841">Clone</span><span class="op" id="7979846">(</span><span class="op" id="7979847">)</span><span class="op" id="7979848">;</span>&nbsp;<span class="ident" id="7979850">err</span>&nbsp;<span class="op" id="7979854">==</span>&nbsp;<span class="ident" id="7979857">nil</span>&nbsp;<span class="op" id="7979861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7979865">t</span><span class="op" id="7979866">.</span><span class="ident" id="7979867">Error</span><span class="op" id="7979872">(</span><span class="string" id="7979873">`t0.Lookup(&#34;a&#34;).Clone():&nbsp;got&nbsp;nil&nbsp;err&nbsp;want&nbsp;non-nil`</span><span class="op" id="7979923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7979926">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7979929">if</span>&nbsp;<span class="ident" id="7979932">_</span><span class="op" id="7979933">,</span>&nbsp;<span class="ident" id="7979935">err</span>&nbsp;<span class="op" id="7979939">:=</span>&nbsp;<span class="ident" id="7979942">t0</span><span class="op" id="7979944">.</span><span class="ident" id="7979945">Lookup</span><span class="op" id="7979951">(</span><span class="string" id="7979952">&#34;lhs&#34;</span><span class="op" id="7979957">)</span><span class="op" id="7979958">.</span><span class="ident" id="7979959">Clone</span><span class="op" id="7979964">(</span><span class="op" id="7979965">)</span><span class="op" id="7979966">;</span>&nbsp;<span class="ident" id="7979968">err</span>&nbsp;<span class="op" id="7979972">==</span>&nbsp;<span class="ident" id="7979975">nil</span>&nbsp;<span class="op" id="7979979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7979983">t</span><span class="op" id="7979984">.</span><span class="ident" id="7979985">Error</span><span class="op" id="7979990">(</span><span class="string" id="7979991">`t0.Lookup(&#34;lhs&#34;).Clone():&nbsp;got&nbsp;nil&nbsp;err&nbsp;want&nbsp;non-nil`</span><span class="op" id="7980043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7980046">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7980050">//&nbsp;Execute&nbsp;t3.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980066">b</span><span class="op" id="7980067">.</span><span class="ident" id="7980068">Reset</span><span class="op" id="7980073">(</span><span class="op" id="7980074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7980077">if</span>&nbsp;<span class="ident" id="7980080">err</span>&nbsp;<span class="op" id="7980084">:=</span>&nbsp;<span class="ident" id="7980087">t3</span><span class="op" id="7980089">.</span><span class="ident" id="7980090">ExecuteTemplate</span><span class="op" id="7980105">(</span><span class="ident" id="7980106">b</span><span class="op" id="7980107">,</span>&nbsp;<span class="string" id="7980109">&#34;a&#34;</span><span class="op" id="7980112">,</span>&nbsp;<span class="string" id="7980114">&#34;&lt;i&gt;*/&#34;</span><span class="op" id="7980121">)</span><span class="op" id="7980122">;</span>&nbsp;<span class="ident" id="7980124">err</span>&nbsp;<span class="op" id="7980128">!=</span>&nbsp;<span class="ident" id="7980131">nil</span>&nbsp;<span class="op" id="7980135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980139">t</span><span class="op" id="7980140">.</span><span class="ident" id="7980141">Fatal</span><span class="op" id="7980146">(</span><span class="ident" id="7980147">err</span><span class="op" id="7980150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7980153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7980156">if</span>&nbsp;<span class="ident" id="7980159">got</span><span class="op" id="7980162">,</span>&nbsp;<span class="ident" id="7980164">want</span>&nbsp;<span class="op" id="7980169">:=</span>&nbsp;<span class="ident" id="7980172">b</span><span class="op" id="7980173">.</span><span class="ident" id="7980174">String</span><span class="op" id="7980180">(</span><span class="op" id="7980181">)</span><span class="op" id="7980182">,</span>&nbsp;<span class="string" id="7980184">`&nbsp;&lt;style&gt;&nbsp;ZgotmplZ&nbsp;&lt;/style&gt;&nbsp;`</span><span class="op" id="7980213">;</span>&nbsp;<span class="ident" id="7980215">got</span>&nbsp;<span class="op" id="7980219">!=</span>&nbsp;<span class="ident" id="7980222">want</span>&nbsp;<span class="op" id="7980227">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980231">t</span><span class="op" id="7980232">.</span><span class="ident" id="7980233">Errorf</span><span class="op" id="7980239">(</span><span class="string" id="7980240">&#34;t3:&nbsp;got&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7980260">,</span>&nbsp;<span class="ident" id="7980262">got</span><span class="op" id="7980265">,</span>&nbsp;<span class="ident" id="7980267">want</span><span class="op" id="7980271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7980274">}</span><br>
<span class="lineno"></span><span class="op" id="7980276">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7980279">func</span>&nbsp;<span class="ident" id="7980284">TestTemplates</span><span class="op" id="7980297">(</span><span class="ident" id="7980298">t</span>&nbsp;<span class="op" id="7980300">*</span><span class="ident" id="7980301">testing</span><span class="op" id="7980308">.</span><span class="ident" id="7980309">T</span><span class="op" id="7980310">)</span>&nbsp;<span class="op" id="7980312">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980315">names</span>&nbsp;<span class="op" id="7980321">:=</span>&nbsp;<span class="op" id="7980324">[</span><span class="op" id="7980325">]</span><span class="builtintype" id="7980326">string</span><span class="op" id="7980332">{</span><span class="string" id="7980333">&#34;t0&#34;</span><span class="op" id="7980337">,</span>&nbsp;<span class="string" id="7980339">&#34;a&#34;</span><span class="op" id="7980342">,</span>&nbsp;<span class="string" id="7980344">&#34;lhs&#34;</span><span class="op" id="7980349">,</span>&nbsp;<span class="string" id="7980351">&#34;rhs&#34;</span><span class="op" id="7980356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7980359">//&nbsp;Some&nbsp;template&nbsp;definitions&nbsp;borrowed&nbsp;from&nbsp;TestClone.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7980414">const</span>&nbsp;<span class="ident" id="7980420">tmpl</span>&nbsp;<span class="op" id="7980425">=</span>&nbsp;<span class="string" id="7980427">`<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp{{define&nbsp;&#34;a&#34;}}{{template&nbsp;&#34;lhs&#34;}}{{.}}{{template&nbsp;&#34;rhs&#34;}}{{end}}<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp{{define&nbsp;&#34;lhs&#34;}}&nbsp;&lt;a&nbsp;href=&#34;&nbsp;{{end}}<br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp{{define&nbsp;&#34;rhs&#34;}}&nbsp;&#34;&gt;&lt;/a&gt;&nbsp;{{end}}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980567">t0</span>&nbsp;<span class="op" id="7980570">:=</span>&nbsp;<span class="ident" id="7980573">Must</span><span class="op" id="7980577">(</span><span class="ident" id="7980578">New</span><span class="op" id="7980581">(</span><span class="string" id="7980582">&#34;t0&#34;</span><span class="op" id="7980586">)</span><span class="op" id="7980587">.</span><span class="ident" id="7980588">Parse</span><span class="op" id="7980593">(</span><span class="ident" id="7980594">tmpl</span><span class="op" id="7980598">)</span><span class="op" id="7980599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980602">templates</span>&nbsp;<span class="op" id="7980612">:=</span>&nbsp;<span class="ident" id="7980615">t0</span><span class="op" id="7980617">.</span><span class="ident" id="7980618">Templates</span><span class="op" id="7980627">(</span><span class="op" id="7980628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7980631">if</span>&nbsp;<span class="builtinfunc" id="7980634">len</span><span class="op" id="7980637">(</span><span class="ident" id="7980638">templates</span><span class="op" id="7980647">)</span>&nbsp;<span class="op" id="7980649">!=</span>&nbsp;<span class="builtinfunc" id="7980652">len</span><span class="op" id="7980655">(</span><span class="ident" id="7980656">names</span><span class="op" id="7980661">)</span>&nbsp;<span class="op" id="7980663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980667">t</span><span class="op" id="7980668">.</span><span class="ident" id="7980669">Errorf</span><span class="op" id="7980675">(</span><span class="string" id="7980676">&#34;expected&nbsp;%d&nbsp;templates;&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7980707">,</span>&nbsp;<span class="builtinfunc" id="7980709">len</span><span class="op" id="7980712">(</span><span class="ident" id="7980713">names</span><span class="op" id="7980718">)</span><span class="op" id="7980719">,</span>&nbsp;<span class="builtinfunc" id="7980721">len</span><span class="op" id="7980724">(</span><span class="ident" id="7980725">templates</span><span class="op" id="7980734">)</span><span class="op" id="7980735">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7980738">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7980741">for</span>&nbsp;<span class="ident" id="7980745">_</span><span class="op" id="7980746">,</span>&nbsp;<span class="ident" id="7980748">name</span>&nbsp;<span class="op" id="7980753">:=</span>&nbsp;<span class="keyword" id="7980756">range</span>&nbsp;<span class="ident" id="7980762">names</span>&nbsp;<span class="op" id="7980768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980772">found</span>&nbsp;<span class="op" id="7980778">:=</span>&nbsp;<span class="builtintype" id="7980781">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7980789">for</span>&nbsp;<span class="ident" id="7980793">_</span><span class="op" id="7980794">,</span>&nbsp;<span class="ident" id="7980796">tmpl</span>&nbsp;<span class="op" id="7980801">:=</span>&nbsp;<span class="keyword" id="7980804">range</span>&nbsp;<span class="ident" id="7980810">templates</span>&nbsp;<span class="op" id="7980820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7980825">if</span>&nbsp;<span class="ident" id="7980828">name</span>&nbsp;<span class="op" id="7980833">==</span>&nbsp;<span class="ident" id="7980836">tmpl</span><span class="op" id="7980840">.</span><span class="ident" id="7980841">text</span><span class="op" id="7980845">.</span><span class="ident" id="7980846">Name</span><span class="op" id="7980850">(</span><span class="op" id="7980851">)</span>&nbsp;<span class="op" id="7980853">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980859">found</span>&nbsp;<span class="op" id="7980865">=</span>&nbsp;<span class="builtintype" id="7980867">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7980876">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7980885">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7980889">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7980893">if</span>&nbsp;<span class="op" id="7980896">!</span><span class="ident" id="7980897">found</span>&nbsp;<span class="op" id="7980903">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980908">t</span><span class="op" id="7980909">.</span><span class="ident" id="7980910">Error</span><span class="op" id="7980915">(</span><span class="string" id="7980916">&#34;could&nbsp;not&nbsp;find&nbsp;template&#34;</span><span class="op" id="7980941">,</span>&nbsp;<span class="ident" id="7980943">name</span><span class="op" id="7980947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7980951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7980954">}</span><br>
<span class="lineno"></span><span class="op" id="7980956">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="comment" id="7980959">//&nbsp;This&nbsp;used&nbsp;to&nbsp;crash;&nbsp;http://golang.org/issue/3281</span><br>
<span class="lineno"></span><span class="keyword" id="7981011">func</span>&nbsp;<span class="ident" id="7981016">TestCloneCrash</span><span class="op" id="7981030">(</span><span class="ident" id="7981031">t</span>&nbsp;<span class="op" id="7981033">*</span><span class="ident" id="7981034">testing</span><span class="op" id="7981041">.</span><span class="ident" id="7981042">T</span><span class="op" id="7981043">)</span>&nbsp;<span class="op" id="7981045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7981048">t1</span>&nbsp;<span class="op" id="7981051">:=</span>&nbsp;<span class="ident" id="7981054">New</span><span class="op" id="7981057">(</span><span class="string" id="7981058">&#34;all&#34;</span><span class="op" id="7981063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7981066">Must</span><span class="op" id="7981070">(</span><span class="ident" id="7981071">t1</span><span class="op" id="7981073">.</span><span class="ident" id="7981074">New</span><span class="op" id="7981077">(</span><span class="string" id="7981078">&#34;t1&#34;</span><span class="op" id="7981082">)</span><span class="op" id="7981083">.</span><span class="ident" id="7981084">Parse</span><span class="op" id="7981089">(</span><span class="string" id="7981090">`{{define&nbsp;&#34;foo&#34;}}foo{{end}}`</span><span class="op" id="7981118">)</span><span class="op" id="7981119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7981122">t1</span><span class="op" id="7981124">.</span><span class="ident" id="7981125">Clone</span><span class="op" id="7981130">(</span><span class="op" id="7981131">)</span><br>
<span class="lineno">150</span><span class="op" id="7981133">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7981136">//&nbsp;Ensure&nbsp;that&nbsp;this&nbsp;guarantee&nbsp;from&nbsp;the&nbsp;docs&nbsp;is&nbsp;upheld:</span><br>
<span class="lineno"></span><span class="comment" id="7981191">//&nbsp;&#34;Further&nbsp;calls&nbsp;to&nbsp;Parse&nbsp;in&nbsp;the&nbsp;copy&nbsp;will&nbsp;add&nbsp;templates</span><br>
<span class="lineno"></span><span class="comment" id="7981249">//&nbsp;to&nbsp;the&nbsp;copy&nbsp;but&nbsp;not&nbsp;to&nbsp;the&nbsp;original.&#34;</span><br>
<span class="lineno">155</span><span class="keyword" id="7981290">func</span>&nbsp;<span class="ident" id="7981295">TestCloneThenParse</span><span class="op" id="7981313">(</span><span class="ident" id="7981314">t</span>&nbsp;<span class="op" id="7981316">*</span><span class="ident" id="7981317">testing</span><span class="op" id="7981324">.</span><span class="ident" id="7981325">T</span><span class="op" id="7981326">)</span>&nbsp;<span class="op" id="7981328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7981331">t0</span>&nbsp;<span class="op" id="7981334">:=</span>&nbsp;<span class="ident" id="7981337">Must</span><span class="op" id="7981341">(</span><span class="ident" id="7981342">New</span><span class="op" id="7981345">(</span><span class="string" id="7981346">&#34;t0&#34;</span><span class="op" id="7981350">)</span><span class="op" id="7981351">.</span><span class="ident" id="7981352">Parse</span><span class="op" id="7981357">(</span><span class="string" id="7981358">`{{define&nbsp;&#34;a&#34;}}{{template&nbsp;&#34;embedded&#34;}}{{end}}`</span><span class="op" id="7981404">)</span><span class="op" id="7981405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7981408">t1</span>&nbsp;<span class="op" id="7981411">:=</span>&nbsp;<span class="ident" id="7981414">Must</span><span class="op" id="7981418">(</span><span class="ident" id="7981419">t0</span><span class="op" id="7981421">.</span><span class="ident" id="7981422">Clone</span><span class="op" id="7981427">(</span><span class="op" id="7981428">)</span><span class="op" id="7981429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7981432">Must</span><span class="op" id="7981436">(</span><span class="ident" id="7981437">t1</span><span class="op" id="7981439">.</span><span class="ident" id="7981440">Parse</span><span class="op" id="7981445">(</span><span class="string" id="7981446">`{{define&nbsp;&#34;embedded&#34;}}t1{{end}}`</span><span class="op" id="7981478">)</span><span class="op" id="7981479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7981482">if</span>&nbsp;<span class="builtinfunc" id="7981485">len</span><span class="op" id="7981488">(</span><span class="ident" id="7981489">t0</span><span class="op" id="7981491">.</span><span class="ident" id="7981492">Templates</span><span class="op" id="7981501">(</span><span class="op" id="7981502">)</span><span class="op" id="7981503">)</span><span class="op" id="7981504">+</span><span class="num" id="7981505">1</span>&nbsp;<span class="op" id="7981507">!=</span>&nbsp;<span class="builtinfunc" id="7981510">len</span><span class="op" id="7981513">(</span><span class="ident" id="7981514">t1</span><span class="op" id="7981516">.</span><span class="ident" id="7981517">Templates</span><span class="op" id="7981526">(</span><span class="op" id="7981527">)</span><span class="op" id="7981528">)</span>&nbsp;<span class="op" id="7981530">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7981534">t</span><span class="op" id="7981535">.</span><span class="ident" id="7981536">Error</span><span class="op" id="7981541">(</span><span class="string" id="7981542">&#34;adding&nbsp;a&nbsp;template&nbsp;to&nbsp;a&nbsp;clone&nbsp;added&nbsp;it&nbsp;to&nbsp;the&nbsp;original&#34;</span><span class="op" id="7981597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7981600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7981603">//&nbsp;double&nbsp;check&nbsp;that&nbsp;the&nbsp;embedded&nbsp;template&nbsp;isn&#39;t&nbsp;available&nbsp;in&nbsp;the&nbsp;original</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7981679">err</span>&nbsp;<span class="op" id="7981683">:=</span>&nbsp;<span class="ident" id="7981686">t0</span><span class="op" id="7981688">.</span><span class="ident" id="7981689">ExecuteTemplate</span><span class="op" id="7981704">(</span><span class="ident" id="7981705">ioutil</span><span class="op" id="7981711">.</span><span class="ident" id="7981712">Discard</span><span class="op" id="7981719">,</span>&nbsp;<span class="string" id="7981721">&#34;a&#34;</span><span class="op" id="7981724">,</span>&nbsp;<span class="ident" id="7981726">nil</span><span class="op" id="7981729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7981732">if</span>&nbsp;<span class="ident" id="7981735">err</span>&nbsp;<span class="op" id="7981739">==</span>&nbsp;<span class="ident" id="7981742">nil</span>&nbsp;<span class="op" id="7981746">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7981750">t</span><span class="op" id="7981751">.</span><span class="ident" id="7981752">Error</span><span class="op" id="7981757">(</span><span class="string" id="7981758">&#34;expected&nbsp;&#39;no&nbsp;such&nbsp;template&#39;&nbsp;error&#34;</span><span class="op" id="7981793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7981796">}</span><br>
<span class="lineno"></span><span class="op" id="7981798">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7981801">//&nbsp;https://code.google.com/p/go/issues/detail?id=5980</span><br>
<span class="lineno">170</span><span class="keyword" id="7981855">func</span>&nbsp;<span class="ident" id="7981860">TestFuncMapWorksAfterClone</span><span class="op" id="7981886">(</span><span class="ident" id="7981887">t</span>&nbsp;<span class="op" id="7981889">*</span><span class="ident" id="7981890">testing</span><span class="op" id="7981897">.</span><span class="ident" id="7981898">T</span><span class="op" id="7981899">)</span>&nbsp;<span class="op" id="7981901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7981904">funcs</span>&nbsp;<span class="op" id="7981910">:=</span>&nbsp;<span class="ident" id="7981913">FuncMap</span><span class="op" id="7981920">{</span><span class="string" id="7981921">&#34;customFunc&#34;</span><span class="op" id="7981933">:</span>&nbsp;<span class="keyword" id="7981935">func</span><span class="op" id="7981939">(</span><span class="op" id="7981940">)</span>&nbsp;<span class="op" id="7981942">(</span><span class="builtintype" id="7981943">string</span><span class="op" id="7981949">,</span>&nbsp;<span class="builtintype" id="7981951">error</span><span class="op" id="7981956">)</span>&nbsp;<span class="op" id="7981958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7981962">return</span>&nbsp;<span class="string" id="7981969">&#34;&#34;</span><span class="op" id="7981971">,</span>&nbsp;<span class="ident" id="7981973">errors</span><span class="op" id="7981979">.</span><span class="ident" id="7981980">New</span><span class="op" id="7981983">(</span><span class="string" id="7981984">&#34;issue5980&#34;</span><span class="op" id="7981995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7981998">}</span><span class="op" id="7981999">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7982003">//&nbsp;get&nbsp;the&nbsp;expected&nbsp;error&nbsp;output&nbsp;(no&nbsp;clone)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7982048">uncloned</span>&nbsp;<span class="op" id="7982057">:=</span>&nbsp;<span class="ident" id="7982060">Must</span><span class="op" id="7982064">(</span><span class="ident" id="7982065">New</span><span class="op" id="7982068">(</span><span class="string" id="7982069">&#34;&#34;</span><span class="op" id="7982071">)</span><span class="op" id="7982072">.</span><span class="ident" id="7982073">Funcs</span><span class="op" id="7982078">(</span><span class="ident" id="7982079">funcs</span><span class="op" id="7982084">)</span><span class="op" id="7982085">.</span><span class="ident" id="7982086">Parse</span><span class="op" id="7982091">(</span><span class="string" id="7982092">&#34;{{customFunc}}&#34;</span><span class="op" id="7982108">)</span><span class="op" id="7982109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7982112">wantErr</span>&nbsp;<span class="op" id="7982120">:=</span>&nbsp;<span class="ident" id="7982123">uncloned</span><span class="op" id="7982131">.</span><span class="ident" id="7982132">Execute</span><span class="op" id="7982139">(</span><span class="ident" id="7982140">ioutil</span><span class="op" id="7982146">.</span><span class="ident" id="7982147">Discard</span><span class="op" id="7982154">,</span>&nbsp;<span class="ident" id="7982156">nil</span><span class="op" id="7982159">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7982163">//&nbsp;toClone&nbsp;must&nbsp;be&nbsp;the&nbsp;same&nbsp;as&nbsp;uncloned.&nbsp;It&nbsp;has&nbsp;to&nbsp;be&nbsp;recreated&nbsp;from&nbsp;scratch,</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7982242">//&nbsp;since&nbsp;cloning&nbsp;cannot&nbsp;occur&nbsp;after&nbsp;execution.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7982290">toClone</span>&nbsp;<span class="op" id="7982298">:=</span>&nbsp;<span class="ident" id="7982301">Must</span><span class="op" id="7982305">(</span><span class="ident" id="7982306">New</span><span class="op" id="7982309">(</span><span class="string" id="7982310">&#34;&#34;</span><span class="op" id="7982312">)</span><span class="op" id="7982313">.</span><span class="ident" id="7982314">Funcs</span><span class="op" id="7982319">(</span><span class="ident" id="7982320">funcs</span><span class="op" id="7982325">)</span><span class="op" id="7982326">.</span><span class="ident" id="7982327">Parse</span><span class="op" id="7982332">(</span><span class="string" id="7982333">&#34;{{customFunc}}&#34;</span><span class="op" id="7982349">)</span><span class="op" id="7982350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7982353">cloned</span>&nbsp;<span class="op" id="7982360">:=</span>&nbsp;<span class="ident" id="7982363">Must</span><span class="op" id="7982367">(</span><span class="ident" id="7982368">toClone</span><span class="op" id="7982375">.</span><span class="ident" id="7982376">Clone</span><span class="op" id="7982381">(</span><span class="op" id="7982382">)</span><span class="op" id="7982383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7982386">gotErr</span>&nbsp;<span class="op" id="7982393">:=</span>&nbsp;<span class="ident" id="7982396">cloned</span><span class="op" id="7982402">.</span><span class="ident" id="7982403">Execute</span><span class="op" id="7982410">(</span><span class="ident" id="7982411">ioutil</span><span class="op" id="7982417">.</span><span class="ident" id="7982418">Discard</span><span class="op" id="7982425">,</span>&nbsp;<span class="ident" id="7982427">nil</span><span class="op" id="7982430">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7982434">if</span>&nbsp;<span class="ident" id="7982437">wantErr</span><span class="op" id="7982444">.</span><span class="ident" id="7982445">Error</span><span class="op" id="7982450">(</span><span class="op" id="7982451">)</span>&nbsp;<span class="op" id="7982453">!=</span>&nbsp;<span class="ident" id="7982456">gotErr</span><span class="op" id="7982462">.</span><span class="ident" id="7982463">Error</span><span class="op" id="7982468">(</span><span class="op" id="7982469">)</span>&nbsp;<span class="op" id="7982471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7982475">t</span><span class="op" id="7982476">.</span><span class="ident" id="7982477">Errorf</span><span class="op" id="7982483">(</span><span class="string" id="7982484">&#34;clone&nbsp;error&nbsp;message&nbsp;mismatch&nbsp;want&nbsp;%q&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7982529">,</span>&nbsp;<span class="ident" id="7982531">wantErr</span><span class="op" id="7982538">,</span>&nbsp;<span class="ident" id="7982540">gotErr</span><span class="op" id="7982546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7982549">}</span><br>
<span class="lineno"></span><span class="op" id="7982551">}</span>
</div>
</body>
</html>
