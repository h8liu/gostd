<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>math</h2>
<ul>
<li><a href="/gostd/math/abs.go.html">abs.go</a></li>
<li><a href="/gostd/math/acosh.go.html">acosh.go</a></li>
<li><a href="/gostd/math/all_test.go.html">all_test.go</a></li>
<li><a href="/gostd/math/asin.go.html">asin.go</a></li>
<li><a href="/gostd/math/asinh.go.html">asinh.go</a></li>
<li><a href="/gostd/math/atan.go.html">atan.go</a></li>
<li><a href="/gostd/math/atan2.go.html">atan2.go</a></li>
<li><a href="/gostd/math/atanh.go.html">atanh.go</a></li>
<li><a href="/gostd/math/bits.go.html">bits.go</a></li>
<li><a href="/gostd/math/cbrt.go.html">cbrt.go</a></li>
<li><a href="/gostd/math/const.go.html">const.go</a></li>
<li><a href="/gostd/math/copysign.go.html">copysign.go</a></li>
<li><a href="/gostd/math/dim.go.html">dim.go</a></li>
<li><a href="/gostd/math/erf.go.html">erf.go</a></li>
<li><a href="/gostd/math/exp.go.html">exp.go</a></li>
<li><a href="/gostd/math/expm1.go.html">expm1.go</a></li>
<li><a href="/gostd/math/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/math/floor.go.html">floor.go</a></li>
<li><a href="/gostd/math/frexp.go.html">frexp.go</a></li>
<li><a href="/gostd/math/gamma.go.html">gamma.go</a></li>
<li><a href="/gostd/math/hypot.go.html">hypot.go</a></li>
<li><a href="/gostd/math/j0.go.html">j0.go</a></li>
<li><a href="/gostd/math/j1.go.html">j1.go</a></li>
<li><a href="/gostd/math/jn.go.html">jn.go</a></li>
<li><a href="/gostd/math/ldexp.go.html">ldexp.go</a></li>
<li><a href="/gostd/math/lgamma.go.html">lgamma.go</a></li>
<li><a href="/gostd/math/log.go.html">log.go</a></li>
<li><a href="/gostd/math/log10.go.html">log10.go</a></li>
<li><a href="/gostd/math/log1p.go.html">log1p.go</a></li>
<li><a href="/gostd/math/logb.go.html">logb.go</a></li>
<li><a href="/gostd/math/mod.go.html">mod.go</a></li>
<li><a href="/gostd/math/modf.go.html">modf.go</a></li>
<li><a href="/gostd/math/nextafter.go.html">nextafter.go</a></li>
<li><a href="/gostd/math/pow.go.html">pow.go</a></li>
<li><a href="/gostd/math/pow10.go.html">pow10.go</a></li>
<li><a href="/gostd/math/remainder.go.html">remainder.go</a></li>
<li><a href="/gostd/math/signbit.go.html">signbit.go</a></li>
<li><a href="/gostd/math/sin.go.html">sin.go</a></li>
<li><a href="/gostd/math/sincos.go.html">sincos.go</a></li>
<li><a href="/gostd/math/sinh.go.html">sinh.go</a></li>
<li><a href="/gostd/math/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/math/tan.go.html">tan.go</a></li>
<li><a href="/gostd/math/tanh.go.html">tanh.go</a></li>
<li><a href="/gostd/math/unsafe.go.html">unsafe.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2117908">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2117963">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2118017">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2118068">package</span>&nbsp;<span class="ident" id="2118076">math</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2118082">//&nbsp;The&nbsp;original&nbsp;C&nbsp;code,&nbsp;the&nbsp;long&nbsp;comment,&nbsp;and&nbsp;the&nbsp;constants</span><br>
<span class="lineno"></span><span class="comment" id="2118142">//&nbsp;below&nbsp;are&nbsp;from&nbsp;FreeBSD&#39;s&nbsp;/usr/src/lib/msun/src/s_expm1.c</span><br>
<span class="lineno"></span><span class="comment" id="2118202">//&nbsp;and&nbsp;came&nbsp;with&nbsp;this&nbsp;notice.&nbsp;&nbsp;The&nbsp;go&nbsp;code&nbsp;is&nbsp;a&nbsp;simplified</span><br>
<span class="lineno">10</span><span class="comment" id="2118261">//&nbsp;version&nbsp;of&nbsp;the&nbsp;original&nbsp;C.</span><br>
<span class="lineno"></span><span class="comment" id="2118291">//</span><br>
<span class="lineno"></span><span class="comment" id="2118294">//&nbsp;====================================================</span><br>
<span class="lineno"></span><span class="comment" id="2118350">//&nbsp;Copyright&nbsp;(C)&nbsp;1993&nbsp;by&nbsp;Sun&nbsp;Microsystems,&nbsp;Inc.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2118419">//</span><br>
<span class="lineno">15</span><span class="comment" id="2118422">//&nbsp;Developed&nbsp;at&nbsp;SunPro,&nbsp;a&nbsp;Sun&nbsp;Microsystems,&nbsp;Inc.&nbsp;business.</span><br>
<span class="lineno"></span><span class="comment" id="2118481">//&nbsp;Permission&nbsp;to&nbsp;use,&nbsp;copy,&nbsp;modify,&nbsp;and&nbsp;distribute&nbsp;this</span><br>
<span class="lineno"></span><span class="comment" id="2118537">//&nbsp;software&nbsp;is&nbsp;freely&nbsp;granted,&nbsp;provided&nbsp;that&nbsp;this&nbsp;notice</span><br>
<span class="lineno"></span><span class="comment" id="2118594">//&nbsp;is&nbsp;preserved.</span><br>
<span class="lineno"></span><span class="comment" id="2118611">//&nbsp;====================================================</span><br>
<span class="lineno">20</span><span class="comment" id="2118667">//</span><br>
<span class="lineno"></span><span class="comment" id="2118670">//&nbsp;expm1(x)</span><br>
<span class="lineno"></span><span class="comment" id="2118682">//&nbsp;Returns&nbsp;exp(x)-1,&nbsp;the&nbsp;exponential&nbsp;of&nbsp;x&nbsp;minus&nbsp;1.</span><br>
<span class="lineno"></span><span class="comment" id="2118733">//</span><br>
<span class="lineno"></span><span class="comment" id="2118736">//&nbsp;Method</span><br>
<span class="lineno">25</span><span class="comment" id="2118746">//&nbsp;&nbsp;&nbsp;1.&nbsp;Argument&nbsp;reduction:</span><br>
<span class="lineno"></span><span class="comment" id="2118774">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Given&nbsp;x,&nbsp;find&nbsp;r&nbsp;and&nbsp;integer&nbsp;k&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="2118822">//</span><br>
<span class="lineno"></span><span class="comment" id="2118825">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x&nbsp;=&nbsp;k*ln2&nbsp;+&nbsp;r,&nbsp;&nbsp;|r|&nbsp;&lt;=&nbsp;0.5*ln2&nbsp;~&nbsp;0.34658</span><br>
<span class="lineno"></span><span class="comment" id="2118883">//</span><br>
<span class="lineno">30</span><span class="comment" id="2118886">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Here&nbsp;a&nbsp;correction&nbsp;term&nbsp;c&nbsp;will&nbsp;be&nbsp;computed&nbsp;to&nbsp;compensate</span><br>
<span class="lineno"></span><span class="comment" id="2118950">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;error&nbsp;in&nbsp;r&nbsp;when&nbsp;rounded&nbsp;to&nbsp;a&nbsp;floating-point&nbsp;number.</span><br>
<span class="lineno"></span><span class="comment" id="2119014">//</span><br>
<span class="lineno"></span><span class="comment" id="2119017">//&nbsp;&nbsp;&nbsp;2.&nbsp;Approximating&nbsp;expm1(r)&nbsp;by&nbsp;a&nbsp;special&nbsp;rational&nbsp;function&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="2119082">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;interval&nbsp;[0,0.34658]:</span><br>
<span class="lineno">35</span><span class="comment" id="2119116">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Since</span><br>
<span class="lineno"></span><span class="comment" id="2119130">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r*(exp(r)+1)/(exp(r)-1)&nbsp;=&nbsp;2+&nbsp;r**2/6&nbsp;-&nbsp;r**4/360&nbsp;+&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="2119195">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;we&nbsp;define&nbsp;R1(r*r)&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="2119224">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r*(exp(r)+1)/(exp(r)-1)&nbsp;=&nbsp;2+&nbsp;r**2/6&nbsp;*&nbsp;R1(r*r)</span><br>
<span class="lineno"></span><span class="comment" id="2119282">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;That&nbsp;is,</span><br>
<span class="lineno">40</span><span class="comment" id="2119299">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R1(r**2)&nbsp;=&nbsp;6/r&nbsp;*((exp(r)+1)/(exp(r)-1)&nbsp;-&nbsp;2/r)</span><br>
<span class="lineno"></span><span class="comment" id="2119357">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;6/r&nbsp;*&nbsp;(&nbsp;1&nbsp;+&nbsp;2.0*(1/(exp(r)-1)&nbsp;-&nbsp;1/r))</span><br>
<span class="lineno"></span><span class="comment" id="2119418">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1&nbsp;-&nbsp;r**2/60&nbsp;+&nbsp;r**4/2520&nbsp;-&nbsp;r**6/100800&nbsp;+&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="2119485">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;We&nbsp;use&nbsp;a&nbsp;special&nbsp;Reme&nbsp;algorithm&nbsp;on&nbsp;[0,0.347]&nbsp;to&nbsp;generate</span><br>
<span class="lineno"></span><span class="comment" id="2119550">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;polynomial&nbsp;of&nbsp;degree&nbsp;5&nbsp;in&nbsp;r*r&nbsp;to&nbsp;approximate&nbsp;R1.&nbsp;The</span><br>
<span class="lineno">45</span><span class="comment" id="2119613">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;maximum&nbsp;error&nbsp;of&nbsp;this&nbsp;polynomial&nbsp;approximation&nbsp;is&nbsp;bounded</span><br>
<span class="lineno"></span><span class="comment" id="2119679">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;by&nbsp;2**-61.&nbsp;In&nbsp;other&nbsp;words,</span><br>
<span class="lineno"></span><span class="comment" id="2119714">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;R1(z)&nbsp;~&nbsp;1.0&nbsp;+&nbsp;Q1*z&nbsp;+&nbsp;Q2*z**2&nbsp;+&nbsp;Q3*z**3&nbsp;+&nbsp;Q4*z**4&nbsp;+&nbsp;Q5*z**5</span><br>
<span class="lineno"></span><span class="comment" id="2119785">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;where&nbsp;&nbsp;&nbsp;Q1&nbsp;&nbsp;=&nbsp;&nbsp;-1.6666666666666567384E-2,</span><br>
<span class="lineno"></span><span class="comment" id="2119835">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q2&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;3.9682539681370365873E-4,</span><br>
<span class="lineno">50</span><span class="comment" id="2119885">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q3&nbsp;&nbsp;=&nbsp;&nbsp;-9.9206344733435987357E-6,</span><br>
<span class="lineno"></span><span class="comment" id="2119935">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q4&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;2.5051361420808517002E-7,</span><br>
<span class="lineno"></span><span class="comment" id="2119985">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q5&nbsp;&nbsp;=&nbsp;&nbsp;-6.2843505682382617102E-9;</span><br>
<span class="lineno"></span><span class="comment" id="2120035">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(where&nbsp;z=r*r,&nbsp;and&nbsp;the&nbsp;values&nbsp;of&nbsp;Q1&nbsp;to&nbsp;Q5&nbsp;are&nbsp;listed&nbsp;below)</span><br>
<span class="lineno"></span><span class="comment" id="2120102">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;error&nbsp;bounded&nbsp;by</span><br>
<span class="lineno">55</span><span class="comment" id="2120132">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-61</span><br>
<span class="lineno"></span><span class="comment" id="2120185">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;1.0+Q1*z+...+Q5*z&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;R1(z)&nbsp;|&nbsp;&lt;=&nbsp;2</span><br>
<span class="lineno"></span><span class="comment" id="2120235">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span><br>
<span class="lineno"></span><span class="comment" id="2120280">//</span><br>
<span class="lineno"></span><span class="comment" id="2120283">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r)&nbsp;=&nbsp;exp(r)-1&nbsp;is&nbsp;then&nbsp;computed&nbsp;by&nbsp;the&nbsp;following</span><br>
<span class="lineno">60</span><span class="comment" id="2120345">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;specific&nbsp;way&nbsp;which&nbsp;minimize&nbsp;the&nbsp;accumulation&nbsp;rounding&nbsp;error:</span><br>
<span class="lineno"></span><span class="comment" id="2120414">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3</span><br>
<span class="lineno"></span><span class="comment" id="2120453">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;3&nbsp;-&nbsp;(R1&nbsp;+&nbsp;R1*r/2)&nbsp;&nbsp;]</span><br>
<span class="lineno"></span><span class="comment" id="2120517">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r)&nbsp;=&nbsp;r&nbsp;+&nbsp;---&nbsp;+&nbsp;---&nbsp;*&nbsp;[--------------------]</span><br>
<span class="lineno"></span><span class="comment" id="2120581">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;6&nbsp;-&nbsp;r*(3&nbsp;-&nbsp;R1*r/2)&nbsp;]</span><br>
<span class="lineno">65</span><span class="comment" id="2120645">//</span><br>
<span class="lineno"></span><span class="comment" id="2120648">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;To&nbsp;compensate&nbsp;the&nbsp;error&nbsp;in&nbsp;the&nbsp;argument&nbsp;reduction,&nbsp;we&nbsp;use</span><br>
<span class="lineno"></span><span class="comment" id="2120714">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r+c)&nbsp;=&nbsp;expm1(r)&nbsp;+&nbsp;c&nbsp;+&nbsp;expm1(r)*c</span><br>
<span class="lineno"></span><span class="comment" id="2120769">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~&nbsp;expm1(r)&nbsp;+&nbsp;c&nbsp;+&nbsp;r*c</span><br>
<span class="lineno"></span><span class="comment" id="2120817">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Thus&nbsp;c+r*c&nbsp;will&nbsp;be&nbsp;added&nbsp;in&nbsp;as&nbsp;the&nbsp;correction&nbsp;terms&nbsp;for</span><br>
<span class="lineno">70</span><span class="comment" id="2120881">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r+c).&nbsp;Now&nbsp;rearrange&nbsp;the&nbsp;term&nbsp;to&nbsp;avoid&nbsp;optimization</span><br>
<span class="lineno"></span><span class="comment" id="2120946">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;screw&nbsp;up:</span><br>
<span class="lineno"></span><span class="comment" id="2120964">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;)</span><br>
<span class="lineno"></span><span class="comment" id="2121036">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;({&nbsp;&nbsp;(&nbsp;r&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;R1&nbsp;-&nbsp;&nbsp;(3&nbsp;-&nbsp;R1*r/2)&nbsp;]&nbsp;&nbsp;)&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;r&nbsp;&nbsp;)</span><br>
<span class="lineno"></span><span class="comment" id="2121108">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(r+c)~r&nbsp;-&nbsp;({r*(---&nbsp;*&nbsp;[--------------------]-c)-c}&nbsp;-&nbsp;---&nbsp;)</span><br>
<span class="lineno">75</span><span class="comment" id="2121180">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;({&nbsp;&nbsp;(&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;6&nbsp;-&nbsp;r*(3&nbsp;-&nbsp;R1*r/2)&nbsp;]&nbsp;&nbsp;)&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;)</span><br>
<span class="lineno"></span><span class="comment" id="2121252">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</span><br>
<span class="lineno"></span><span class="comment" id="2121324">//</span><br>
<span class="lineno"></span><span class="comment" id="2121327">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;r&nbsp;-&nbsp;E</span><br>
<span class="lineno"></span><span class="comment" id="2121354">//&nbsp;&nbsp;&nbsp;3.&nbsp;Scale&nbsp;back&nbsp;to&nbsp;obtain&nbsp;expm1(x):</span><br>
<span class="lineno">80</span><span class="comment" id="2121393">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;From&nbsp;step&nbsp;1,&nbsp;we&nbsp;have</span><br>
<span class="lineno"></span><span class="comment" id="2121422">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(x)&nbsp;=&nbsp;either&nbsp;2**k*[expm1(r)+1]&nbsp;-&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="2121473">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;or&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2**k*[expm1(r)&nbsp;+&nbsp;(1-2**-k)]</span><br>
<span class="lineno"></span><span class="comment" id="2121530">//&nbsp;&nbsp;&nbsp;4.&nbsp;Implementation&nbsp;notes:</span><br>
<span class="lineno"></span><span class="comment" id="2121560">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(A).&nbsp;To&nbsp;save&nbsp;one&nbsp;multiplication,&nbsp;we&nbsp;scale&nbsp;the&nbsp;coefficient&nbsp;Qi</span><br>
<span class="lineno">85</span><span class="comment" id="2121629">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;Qi*2**i,&nbsp;and&nbsp;replace&nbsp;z&nbsp;by&nbsp;(x**2)/2.</span><br>
<span class="lineno"></span><span class="comment" id="2121681">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(B).&nbsp;To&nbsp;achieve&nbsp;maximum&nbsp;accuracy,&nbsp;we&nbsp;compute&nbsp;expm1(x)&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="2121746">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(i)&nbsp;&nbsp;&nbsp;if&nbsp;x&nbsp;&lt;&nbsp;-56*ln2,&nbsp;return&nbsp;-1.0,&nbsp;(raise&nbsp;inexact&nbsp;if&nbsp;x!=inf)</span><br>
<span class="lineno"></span><span class="comment" id="2121817">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ii)&nbsp;&nbsp;if&nbsp;k=0,&nbsp;return&nbsp;r-E</span><br>
<span class="lineno"></span><span class="comment" id="2121852">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(iii)&nbsp;if&nbsp;k=-1,&nbsp;return&nbsp;0.5*(r-E)-0.5</span><br>
<span class="lineno">90</span><span class="comment" id="2121898">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(iv)&nbsp;&nbsp;if&nbsp;k=1&nbsp;if&nbsp;r&nbsp;&lt;&nbsp;-0.25,&nbsp;return&nbsp;2*((r+0.5)-&nbsp;E)</span><br>
<span class="lineno"></span><span class="comment" id="2121957">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;&nbsp;1.0+2.0*(r-E);</span><br>
<span class="lineno"></span><span class="comment" id="2122017">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(v)&nbsp;&nbsp;&nbsp;if&nbsp;(k&lt;-2||k&gt;56)&nbsp;return&nbsp;2**k(1-(E-r))&nbsp;-&nbsp;1&nbsp;(or&nbsp;exp(x)-1)</span><br>
<span class="lineno"></span><span class="comment" id="2122088">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(vi)&nbsp;&nbsp;if&nbsp;k&nbsp;&lt;=&nbsp;20,&nbsp;return&nbsp;2**k((1-2**-k)-(E-r)),&nbsp;else</span><br>
<span class="lineno"></span><span class="comment" id="2122151">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(vii)&nbsp;return&nbsp;2**k(1-((E+2**-k)-r))</span><br>
<span class="lineno">95</span><span class="comment" id="2122196">//</span><br>
<span class="lineno"></span><span class="comment" id="2122199">//&nbsp;Special&nbsp;cases:</span><br>
<span class="lineno"></span><span class="comment" id="2122217">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(INF)&nbsp;is&nbsp;INF,&nbsp;expm1(NaN)&nbsp;is&nbsp;NaN;</span><br>
<span class="lineno"></span><span class="comment" id="2122263">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expm1(-INF)&nbsp;is&nbsp;-1,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2122294">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;finite&nbsp;argument,&nbsp;only&nbsp;expm1(0)=0&nbsp;is&nbsp;exact.</span><br>
<span class="lineno">100</span><span class="comment" id="2122349">//</span><br>
<span class="lineno"></span><span class="comment" id="2122352">//&nbsp;Accuracy:</span><br>
<span class="lineno"></span><span class="comment" id="2122365">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;according&nbsp;to&nbsp;an&nbsp;error&nbsp;analysis,&nbsp;the&nbsp;error&nbsp;is&nbsp;always&nbsp;less&nbsp;than</span><br>
<span class="lineno"></span><span class="comment" id="2122435">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;ulp&nbsp;(unit&nbsp;in&nbsp;the&nbsp;last&nbsp;place).</span><br>
<span class="lineno"></span><span class="comment" id="2122475">//</span><br>
<span class="lineno">105</span><span class="comment" id="2122478">//&nbsp;Misc.&nbsp;info.</span><br>
<span class="lineno"></span><span class="comment" id="2122493">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;For&nbsp;IEEE&nbsp;double</span><br>
<span class="lineno"></span><span class="comment" id="2122517">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;x&nbsp;&gt;&nbsp;&nbsp;7.09782712893383973096e+02&nbsp;then&nbsp;expm1(x)&nbsp;overflow</span><br>
<span class="lineno"></span><span class="comment" id="2122587">//</span><br>
<span class="lineno"></span><span class="comment" id="2122590">//&nbsp;Constants:</span><br>
<span class="lineno">110</span><span class="comment" id="2122604">//&nbsp;The&nbsp;hexadecimal&nbsp;values&nbsp;are&nbsp;the&nbsp;intended&nbsp;ones&nbsp;for&nbsp;the&nbsp;following</span><br>
<span class="lineno"></span><span class="comment" id="2122670">//&nbsp;constants.&nbsp;The&nbsp;decimal&nbsp;values&nbsp;may&nbsp;be&nbsp;used,&nbsp;provided&nbsp;that&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2122734">//&nbsp;compiler&nbsp;will&nbsp;convert&nbsp;from&nbsp;decimal&nbsp;to&nbsp;binary&nbsp;accurately&nbsp;enough</span><br>
<span class="lineno"></span><span class="comment" id="2122800">//&nbsp;to&nbsp;produce&nbsp;the&nbsp;hexadecimal&nbsp;values&nbsp;shown.</span><br>
<span class="lineno"></span><span class="comment" id="2122844">//</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="2122848">//&nbsp;Expm1&nbsp;returns&nbsp;e**x&nbsp;-&nbsp;1,&nbsp;the&nbsp;base-e&nbsp;exponential&nbsp;of&nbsp;x&nbsp;minus&nbsp;1.</span><br>
<span class="lineno"></span><span class="comment" id="2122912">//&nbsp;It&nbsp;is&nbsp;more&nbsp;accurate&nbsp;than&nbsp;Exp(x)&nbsp;-&nbsp;1&nbsp;when&nbsp;x&nbsp;is&nbsp;near&nbsp;zero.</span><br>
<span class="lineno"></span><span class="comment" id="2122972">//</span><br>
<span class="lineno"></span><span class="comment" id="2122975">//&nbsp;Special&nbsp;cases&nbsp;are:</span><br>
<span class="lineno">120</span><span class="comment" id="2122997">//&nbsp;&nbsp;&nbsp;&nbspExpm1(+Inf)&nbsp;=&nbsp;+Inf</span><br>
<span class="lineno"></span><span class="comment" id="2123019">//&nbsp;&nbsp;&nbsp;&nbspExpm1(-Inf)&nbsp;=&nbsp;-1</span><br>
<span class="lineno"></span><span class="comment" id="2123039">//&nbsp;&nbsp;&nbsp;&nbspExpm1(NaN)&nbsp;=&nbsp;NaN</span><br>
<span class="lineno"></span><span class="comment" id="2123059">//&nbsp;Very&nbsp;large&nbsp;values&nbsp;overflow&nbsp;to&nbsp;-1&nbsp;or&nbsp;+Inf.</span><br>
<span class="lineno"></span><span class="keyword" id="2123104">func</span>&nbsp;<span class="ident" id="2123109">Expm1</span><span class="op" id="2123114">(</span><span class="ident" id="2123115">x</span>&nbsp;<span class="builtintype" id="2123117">float64</span><span class="op" id="2123124">)</span>&nbsp;<span class="builtintype" id="2123126">float64</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="2123135">func</span>&nbsp;<span class="ident" id="2123140">expm1</span><span class="op" id="2123145">(</span><span class="ident" id="2123146">x</span>&nbsp;<span class="builtintype" id="2123148">float64</span><span class="op" id="2123155">)</span>&nbsp;<span class="builtintype" id="2123157">float64</span>&nbsp;<span class="op" id="2123165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2123168">const</span>&nbsp;<span class="op" id="2123174">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2123178">Othreshold</span>&nbsp;<span class="op" id="2123189">=</span>&nbsp;<span class="num" id="2123191">7.09782712893383973096e+02</span>&nbsp;<span class="comment" id="2123218">//&nbsp;0x40862E42FEFA39EF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2123242">Ln2X56</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2123253">=</span>&nbsp;<span class="num" id="2123255">3.88162421113569373274e+01</span>&nbsp;<span class="comment" id="2123282">//&nbsp;0x4043687a9f1af2b1</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2123306">Ln2HalfX3</span>&nbsp;&nbsp;<span class="op" id="2123317">=</span>&nbsp;<span class="num" id="2123319">1.03972077083991796413e+00</span>&nbsp;<span class="comment" id="2123346">//&nbsp;0x3ff0a2b23f3bab73</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2123370">Ln2Half</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2123381">=</span>&nbsp;<span class="num" id="2123383">3.46573590279972654709e-01</span>&nbsp;<span class="comment" id="2123410">//&nbsp;0x3fd62e42fefa39ef</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2123434">Ln2Hi</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2123445">=</span>&nbsp;<span class="num" id="2123447">6.93147180369123816490e-01</span>&nbsp;<span class="comment" id="2123474">//&nbsp;0x3fe62e42fee00000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2123498">Ln2Lo</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2123509">=</span>&nbsp;<span class="num" id="2123511">1.90821492927058770002e-10</span>&nbsp;<span class="comment" id="2123538">//&nbsp;0x3dea39ef35793c76</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2123562">InvLn2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2123573">=</span>&nbsp;<span class="num" id="2123575">1.44269504088896338700e+00</span>&nbsp;<span class="comment" id="2123602">//&nbsp;0x3ff71547652b82fe</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2123626">Tiny</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2123637">=</span>&nbsp;<span class="num" id="2123639">1.0</span>&nbsp;<span class="op" id="2123643">/</span>&nbsp;<span class="op" id="2123645">(</span><span class="num" id="2123646">1</span>&nbsp;<span class="op" id="2123648">&lt;&lt;</span>&nbsp;<span class="num" id="2123651">54</span><span class="op" id="2123653">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2123666">//&nbsp;2**-54&nbsp;=&nbsp;0x3c90000000000000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2123699">//&nbsp;scaled&nbsp;coefficients&nbsp;related&nbsp;to&nbsp;expm1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2123741">Q1</span>&nbsp;<span class="op" id="2123744">=</span>&nbsp;<span class="op" id="2123746">-</span><span class="num" id="2123747">3.33333333333331316428e-02</span>&nbsp;<span class="comment" id="2123774">//&nbsp;0xBFA11111111110F4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2123798">Q2</span>&nbsp;<span class="op" id="2123801">=</span>&nbsp;<span class="num" id="2123803">1.58730158725481460165e-03</span>&nbsp;&nbsp;<span class="comment" id="2123831">//&nbsp;0x3F5A01A019FE5585</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2123855">Q3</span>&nbsp;<span class="op" id="2123858">=</span>&nbsp;<span class="op" id="2123860">-</span><span class="num" id="2123861">7.93650757867487942473e-05</span>&nbsp;<span class="comment" id="2123888">//&nbsp;0xBF14CE199EAADBB7</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2123912">Q4</span>&nbsp;<span class="op" id="2123915">=</span>&nbsp;<span class="num" id="2123917">4.00821782732936239552e-06</span>&nbsp;&nbsp;<span class="comment" id="2123945">//&nbsp;0x3ED0CFCA86E65239</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2123969">Q5</span>&nbsp;<span class="op" id="2123972">=</span>&nbsp;<span class="op" id="2123974">-</span><span class="num" id="2123975">2.01099218183624371326e-07</span>&nbsp;<span class="comment" id="2124002">//&nbsp;0xBE8AFDB76E09C32D</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2124025">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2124029">//&nbsp;special&nbsp;cases</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2124047">switch</span>&nbsp;<span class="op" id="2124054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2124057">case</span>&nbsp;<span class="ident" id="2124062">IsInf</span><span class="op" id="2124067">(</span><span class="ident" id="2124068">x</span><span class="op" id="2124069">,</span>&nbsp;<span class="num" id="2124071">1</span><span class="op" id="2124072">)</span>&nbsp;<span class="op" id="2124074">||</span>&nbsp;<span class="ident" id="2124077">IsNaN</span><span class="op" id="2124082">(</span><span class="ident" id="2124083">x</span><span class="op" id="2124084">)</span><span class="op" id="2124085">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2124089">return</span>&nbsp;<span class="ident" id="2124096">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2124099">case</span>&nbsp;<span class="ident" id="2124104">IsInf</span><span class="op" id="2124109">(</span><span class="ident" id="2124110">x</span><span class="op" id="2124111">,</span>&nbsp;<span class="op" id="2124113">-</span><span class="num" id="2124114">1</span><span class="op" id="2124115">)</span><span class="op" id="2124116">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2124120">return</span>&nbsp;<span class="op" id="2124127">-</span><span class="num" id="2124128">1</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2124131">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2124135">absx</span>&nbsp;<span class="op" id="2124140">:=</span>&nbsp;<span class="ident" id="2124143">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2124146">sign</span>&nbsp;<span class="op" id="2124151">:=</span>&nbsp;<span class="builtintype" id="2124154">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2124161">if</span>&nbsp;<span class="ident" id="2124164">x</span>&nbsp;<span class="op" id="2124166">&lt;</span>&nbsp;<span class="num" id="2124168">0</span>&nbsp;<span class="op" id="2124170">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2124174">absx</span>&nbsp;<span class="op" id="2124179">=</span>&nbsp;<span class="op" id="2124181">-</span><span class="ident" id="2124182">absx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2124189">sign</span>&nbsp;<span class="op" id="2124194">=</span>&nbsp;<span class="builtintype" id="2124196">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2124202">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2124206">//&nbsp;filter&nbsp;out&nbsp;huge&nbsp;argument</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2124235">if</span>&nbsp;<span class="ident" id="2124238">absx</span>&nbsp;<span class="op" id="2124243">&gt;=</span>&nbsp;<span class="ident" id="2124246">Ln2X56</span>&nbsp;<span class="op" id="2124253">{</span>&nbsp;<span class="comment" id="2124255">//&nbsp;if&nbsp;|x|&nbsp;&gt;=&nbsp;56&nbsp;*&nbsp;ln2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2124279">if</span>&nbsp;<span class="ident" id="2124282">absx</span>&nbsp;<span class="op" id="2124287">&gt;=</span>&nbsp;<span class="ident" id="2124290">Othreshold</span>&nbsp;<span class="op" id="2124301">{</span>&nbsp;<span class="comment" id="2124303">//&nbsp;if&nbsp;|x|&nbsp;&gt;=&nbsp;709.78...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2124329">return</span>&nbsp;<span class="ident" id="2124336">Inf</span><span class="op" id="2124339">(</span><span class="num" id="2124340">1</span><span class="op" id="2124341">)</span>&nbsp;<span class="comment" id="2124343">//&nbsp;overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2124357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2124361">if</span>&nbsp;<span class="ident" id="2124364">sign</span>&nbsp;<span class="op" id="2124369">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2124374">return</span>&nbsp;<span class="op" id="2124381">-</span><span class="num" id="2124382">1</span>&nbsp;<span class="comment" id="2124384">//&nbsp;x&nbsp;&lt;&nbsp;-56*ln2,&nbsp;return&nbsp;-1.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2124414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2124417">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2124421">//&nbsp;argument&nbsp;reduction</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2124444">var</span>&nbsp;<span class="ident" id="2124448">c</span>&nbsp;<span class="builtintype" id="2124450">float64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2124459">var</span>&nbsp;<span class="ident" id="2124463">k</span>&nbsp;<span class="builtintype" id="2124465">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2124470">if</span>&nbsp;<span class="ident" id="2124473">absx</span>&nbsp;<span class="op" id="2124478">&gt;</span>&nbsp;<span class="ident" id="2124480">Ln2Half</span>&nbsp;<span class="op" id="2124488">{</span>&nbsp;<span class="comment" id="2124490">//&nbsp;if&nbsp;&nbsp;|x|&nbsp;&gt;&nbsp;0.5&nbsp;*&nbsp;ln2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2124515">var</span>&nbsp;<span class="ident" id="2124519">hi</span><span class="op" id="2124521">,</span>&nbsp;<span class="ident" id="2124523">lo</span>&nbsp;<span class="builtintype" id="2124526">float64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2124536">if</span>&nbsp;<span class="ident" id="2124539">absx</span>&nbsp;<span class="op" id="2124544">&lt;</span>&nbsp;<span class="ident" id="2124546">Ln2HalfX3</span>&nbsp;<span class="op" id="2124556">{</span>&nbsp;<span class="comment" id="2124558">//&nbsp;and&nbsp;|x|&nbsp;&lt;&nbsp;1.5&nbsp;*&nbsp;ln2</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2124584">if</span>&nbsp;<span class="op" id="2124587">!</span><span class="ident" id="2124588">sign</span>&nbsp;<span class="op" id="2124593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2124599">hi</span>&nbsp;<span class="op" id="2124602">=</span>&nbsp;<span class="ident" id="2124604">x</span>&nbsp;<span class="op" id="2124606">-</span>&nbsp;<span class="ident" id="2124608">Ln2Hi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2124618">lo</span>&nbsp;<span class="op" id="2124621">=</span>&nbsp;<span class="ident" id="2124623">Ln2Lo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2124633">k</span>&nbsp;<span class="op" id="2124635">=</span>&nbsp;<span class="num" id="2124637">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2124642">}</span>&nbsp;<span class="keyword" id="2124644">else</span>&nbsp;<span class="op" id="2124649">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2124655">hi</span>&nbsp;<span class="op" id="2124658">=</span>&nbsp;<span class="ident" id="2124660">x</span>&nbsp;<span class="op" id="2124662">+</span>&nbsp;<span class="ident" id="2124664">Ln2Hi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2124674">lo</span>&nbsp;<span class="op" id="2124677">=</span>&nbsp;<span class="op" id="2124679">-</span><span class="ident" id="2124680">Ln2Lo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2124690">k</span>&nbsp;<span class="op" id="2124692">=</span>&nbsp;<span class="op" id="2124694">-</span><span class="num" id="2124695">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2124700">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2124704">}</span>&nbsp;<span class="keyword" id="2124706">else</span>&nbsp;<span class="op" id="2124711">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2124716">if</span>&nbsp;<span class="op" id="2124719">!</span><span class="ident" id="2124720">sign</span>&nbsp;<span class="op" id="2124725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2124731">k</span>&nbsp;<span class="op" id="2124733">=</span>&nbsp;<span class="builtintype" id="2124735">int</span><span class="op" id="2124738">(</span><span class="ident" id="2124739">InvLn2</span><span class="op" id="2124745">*</span><span class="ident" id="2124746">x</span>&nbsp;<span class="op" id="2124748">+</span>&nbsp;<span class="num" id="2124750">0.5</span><span class="op" id="2124753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2124758">}</span>&nbsp;<span class="keyword" id="2124760">else</span>&nbsp;<span class="op" id="2124765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2124771">k</span>&nbsp;<span class="op" id="2124773">=</span>&nbsp;<span class="builtintype" id="2124775">int</span><span class="op" id="2124778">(</span><span class="ident" id="2124779">InvLn2</span><span class="op" id="2124785">*</span><span class="ident" id="2124786">x</span>&nbsp;<span class="op" id="2124788">-</span>&nbsp;<span class="num" id="2124790">0.5</span><span class="op" id="2124793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2124798">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2124803">t</span>&nbsp;<span class="op" id="2124805">:=</span>&nbsp;<span class="builtintype" id="2124808">float64</span><span class="op" id="2124815">(</span><span class="ident" id="2124816">k</span><span class="op" id="2124817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2124822">hi</span>&nbsp;<span class="op" id="2124825">=</span>&nbsp;<span class="ident" id="2124827">x</span>&nbsp;<span class="op" id="2124829">-</span>&nbsp;<span class="ident" id="2124831">t</span><span class="op" id="2124832">*</span><span class="ident" id="2124833">Ln2Hi</span>&nbsp;<span class="comment" id="2124839">//&nbsp;t&nbsp;*&nbsp;Ln2Hi&nbsp;is&nbsp;exact&nbsp;here</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2124869">lo</span>&nbsp;<span class="op" id="2124872">=</span>&nbsp;<span class="ident" id="2124874">t</span>&nbsp;<span class="op" id="2124876">*</span>&nbsp;<span class="ident" id="2124878">Ln2Lo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2124886">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2124890">x</span>&nbsp;<span class="op" id="2124892">=</span>&nbsp;<span class="ident" id="2124894">hi</span>&nbsp;<span class="op" id="2124897">-</span>&nbsp;<span class="ident" id="2124899">lo</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2124904">c</span>&nbsp;<span class="op" id="2124906">=</span>&nbsp;<span class="op" id="2124908">(</span><span class="ident" id="2124909">hi</span>&nbsp;<span class="op" id="2124912">-</span>&nbsp;<span class="ident" id="2124914">x</span><span class="op" id="2124915">)</span>&nbsp;<span class="op" id="2124917">-</span>&nbsp;<span class="ident" id="2124919">lo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2124923">}</span>&nbsp;<span class="keyword" id="2124925">else</span>&nbsp;<span class="keyword" id="2124930">if</span>&nbsp;<span class="ident" id="2124933">absx</span>&nbsp;<span class="op" id="2124938">&lt;</span>&nbsp;<span class="ident" id="2124940">Tiny</span>&nbsp;<span class="op" id="2124945">{</span>&nbsp;<span class="comment" id="2124947">//&nbsp;when&nbsp;|x|&nbsp;&lt;&nbsp;2**-54,&nbsp;return&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2124980">return</span>&nbsp;<span class="ident" id="2124987">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2124990">}</span>&nbsp;<span class="keyword" id="2124992">else</span>&nbsp;<span class="op" id="2124997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2125001">k</span>&nbsp;<span class="op" id="2125003">=</span>&nbsp;<span class="num" id="2125005">0</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2125008">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2125012">//&nbsp;x&nbsp;is&nbsp;now&nbsp;in&nbsp;primary&nbsp;range</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2125042">hfx</span>&nbsp;<span class="op" id="2125046">:=</span>&nbsp;<span class="num" id="2125049">0.5</span>&nbsp;<span class="op" id="2125053">*</span>&nbsp;<span class="ident" id="2125055">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2125058">hxs</span>&nbsp;<span class="op" id="2125062">:=</span>&nbsp;<span class="ident" id="2125065">x</span>&nbsp;<span class="op" id="2125067">*</span>&nbsp;<span class="ident" id="2125069">hfx</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2125074">r1</span>&nbsp;<span class="op" id="2125077">:=</span>&nbsp;<span class="num" id="2125080">1</span>&nbsp;<span class="op" id="2125082">+</span>&nbsp;<span class="ident" id="2125084">hxs</span><span class="op" id="2125087">*</span><span class="op" id="2125088">(</span><span class="ident" id="2125089">Q1</span><span class="op" id="2125091">+</span><span class="ident" id="2125092">hxs</span><span class="op" id="2125095">*</span><span class="op" id="2125096">(</span><span class="ident" id="2125097">Q2</span><span class="op" id="2125099">+</span><span class="ident" id="2125100">hxs</span><span class="op" id="2125103">*</span><span class="op" id="2125104">(</span><span class="ident" id="2125105">Q3</span><span class="op" id="2125107">+</span><span class="ident" id="2125108">hxs</span><span class="op" id="2125111">*</span><span class="op" id="2125112">(</span><span class="ident" id="2125113">Q4</span><span class="op" id="2125115">+</span><span class="ident" id="2125116">hxs</span><span class="op" id="2125119">*</span><span class="ident" id="2125120">Q5</span><span class="op" id="2125122">)</span><span class="op" id="2125123">)</span><span class="op" id="2125124">)</span><span class="op" id="2125125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2125128">t</span>&nbsp;<span class="op" id="2125130">:=</span>&nbsp;<span class="num" id="2125133">3</span>&nbsp;<span class="op" id="2125135">-</span>&nbsp;<span class="ident" id="2125137">r1</span><span class="op" id="2125139">*</span><span class="ident" id="2125140">hfx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2125145">e</span>&nbsp;<span class="op" id="2125147">:=</span>&nbsp;<span class="ident" id="2125150">hxs</span>&nbsp;<span class="op" id="2125154">*</span>&nbsp;<span class="op" id="2125156">(</span><span class="op" id="2125157">(</span><span class="ident" id="2125158">r1</span>&nbsp;<span class="op" id="2125161">-</span>&nbsp;<span class="ident" id="2125163">t</span><span class="op" id="2125164">)</span>&nbsp;<span class="op" id="2125166">/</span>&nbsp;<span class="op" id="2125168">(</span><span class="num" id="2125169">6.0</span>&nbsp;<span class="op" id="2125173">-</span>&nbsp;<span class="ident" id="2125175">x</span><span class="op" id="2125176">*</span><span class="ident" id="2125177">t</span><span class="op" id="2125178">)</span><span class="op" id="2125179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2125182">if</span>&nbsp;<span class="ident" id="2125185">k</span>&nbsp;<span class="op" id="2125187">!=</span>&nbsp;<span class="num" id="2125190">0</span>&nbsp;<span class="op" id="2125192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2125196">e</span>&nbsp;<span class="op" id="2125198">=</span>&nbsp;<span class="op" id="2125200">(</span><span class="ident" id="2125201">x</span><span class="op" id="2125202">*</span><span class="op" id="2125203">(</span><span class="ident" id="2125204">e</span><span class="op" id="2125205">-</span><span class="ident" id="2125206">c</span><span class="op" id="2125207">)</span>&nbsp;<span class="op" id="2125209">-</span>&nbsp;<span class="ident" id="2125211">c</span><span class="op" id="2125212">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2125216">e</span>&nbsp;<span class="op" id="2125218">-=</span>&nbsp;<span class="ident" id="2125221">hxs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2125227">switch</span>&nbsp;<span class="op" id="2125234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2125238">case</span>&nbsp;<span class="ident" id="2125243">k</span>&nbsp;<span class="op" id="2125245">==</span>&nbsp;<span class="op" id="2125248">-</span><span class="num" id="2125249">1</span><span class="op" id="2125250">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2125255">return</span>&nbsp;<span class="num" id="2125262">0.5</span><span class="op" id="2125265">*</span><span class="op" id="2125266">(</span><span class="ident" id="2125267">x</span><span class="op" id="2125268">-</span><span class="ident" id="2125269">e</span><span class="op" id="2125270">)</span>&nbsp;<span class="op" id="2125272">-</span>&nbsp;<span class="num" id="2125274">0.5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2125280">case</span>&nbsp;<span class="ident" id="2125285">k</span>&nbsp;<span class="op" id="2125287">==</span>&nbsp;<span class="num" id="2125290">1</span><span class="op" id="2125291">:</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2125296">if</span>&nbsp;<span class="ident" id="2125299">x</span>&nbsp;<span class="op" id="2125301">&lt;</span>&nbsp;<span class="op" id="2125303">-</span><span class="num" id="2125304">0.25</span>&nbsp;<span class="op" id="2125309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2125315">return</span>&nbsp;<span class="op" id="2125322">-</span><span class="num" id="2125323">2</span>&nbsp;<span class="op" id="2125325">*</span>&nbsp;<span class="op" id="2125327">(</span><span class="ident" id="2125328">e</span>&nbsp;<span class="op" id="2125330">-</span>&nbsp;<span class="op" id="2125332">(</span><span class="ident" id="2125333">x</span>&nbsp;<span class="op" id="2125335">+</span>&nbsp;<span class="num" id="2125337">0.5</span><span class="op" id="2125340">)</span><span class="op" id="2125341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2125346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2125351">return</span>&nbsp;<span class="num" id="2125358">1</span>&nbsp;<span class="op" id="2125360">+</span>&nbsp;<span class="num" id="2125362">2</span><span class="op" id="2125363">*</span><span class="op" id="2125364">(</span><span class="ident" id="2125365">x</span><span class="op" id="2125366">-</span><span class="ident" id="2125367">e</span><span class="op" id="2125368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2125372">case</span>&nbsp;<span class="ident" id="2125377">k</span>&nbsp;<span class="op" id="2125379">&lt;=</span>&nbsp;<span class="op" id="2125382">-</span><span class="num" id="2125383">2</span>&nbsp;<span class="op" id="2125385">||</span>&nbsp;<span class="ident" id="2125388">k</span>&nbsp;<span class="op" id="2125390">&gt;</span>&nbsp;<span class="num" id="2125392">56</span><span class="op" id="2125394">:</span>&nbsp;<span class="comment" id="2125396">//&nbsp;suffice&nbsp;to&nbsp;return&nbsp;exp(x)-1</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2125429">y</span>&nbsp;<span class="op" id="2125431">:=</span>&nbsp;<span class="num" id="2125434">1</span>&nbsp;<span class="op" id="2125436">-</span>&nbsp;<span class="op" id="2125438">(</span><span class="ident" id="2125439">e</span>&nbsp;<span class="op" id="2125441">-</span>&nbsp;<span class="ident" id="2125443">x</span><span class="op" id="2125444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2125449">y</span>&nbsp;<span class="op" id="2125451">=</span>&nbsp;<span class="ident" id="2125453">Float64frombits</span><span class="op" id="2125468">(</span><span class="ident" id="2125469">Float64bits</span><span class="op" id="2125480">(</span><span class="ident" id="2125481">y</span><span class="op" id="2125482">)</span>&nbsp;<span class="op" id="2125484">+</span>&nbsp;<span class="ident" id="2125486">uint64</span><span class="op" id="2125492">(</span><span class="ident" id="2125493">k</span><span class="op" id="2125494">)</span><span class="op" id="2125495">&lt;&lt;</span><span class="num" id="2125497">52</span><span class="op" id="2125499">)</span>&nbsp;<span class="comment" id="2125501">//&nbsp;add&nbsp;k&nbsp;to&nbsp;y&#39;s&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2125529">return</span>&nbsp;<span class="ident" id="2125536">y</span>&nbsp;<span class="op" id="2125538">-</span>&nbsp;<span class="num" id="2125540">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2125544">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2125548">if</span>&nbsp;<span class="ident" id="2125551">k</span>&nbsp;<span class="op" id="2125553">&lt;</span>&nbsp;<span class="num" id="2125555">20</span>&nbsp;<span class="op" id="2125558">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2125563">t</span>&nbsp;<span class="op" id="2125565">:=</span>&nbsp;<span class="ident" id="2125568">Float64frombits</span><span class="op" id="2125583">(</span><span class="num" id="2125584">0x3ff0000000000000</span>&nbsp;<span class="op" id="2125603">-</span>&nbsp;<span class="op" id="2125605">(</span><span class="num" id="2125606">0x20000000000000</span>&nbsp;<span class="op" id="2125623">&gt;&gt;</span>&nbsp;<span class="builtintype" id="2125626">uint</span><span class="op" id="2125630">(</span><span class="ident" id="2125631">k</span><span class="op" id="2125632">)</span><span class="op" id="2125633">)</span><span class="op" id="2125634">)</span>&nbsp;<span class="comment" id="2125636">//&nbsp;t=1-2**-k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2125652">y</span>&nbsp;<span class="op" id="2125654">:=</span>&nbsp;<span class="ident" id="2125657">t</span>&nbsp;<span class="op" id="2125659">-</span>&nbsp;<span class="op" id="2125661">(</span><span class="ident" id="2125662">e</span>&nbsp;<span class="op" id="2125664">-</span>&nbsp;<span class="ident" id="2125666">x</span><span class="op" id="2125667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2125672">y</span>&nbsp;<span class="op" id="2125674">=</span>&nbsp;<span class="ident" id="2125676">Float64frombits</span><span class="op" id="2125691">(</span><span class="ident" id="2125692">Float64bits</span><span class="op" id="2125703">(</span><span class="ident" id="2125704">y</span><span class="op" id="2125705">)</span>&nbsp;<span class="op" id="2125707">+</span>&nbsp;<span class="ident" id="2125709">uint64</span><span class="op" id="2125715">(</span><span class="ident" id="2125716">k</span><span class="op" id="2125717">)</span><span class="op" id="2125718">&lt;&lt;</span><span class="num" id="2125720">52</span><span class="op" id="2125722">)</span>&nbsp;<span class="comment" id="2125724">//&nbsp;add&nbsp;k&nbsp;to&nbsp;y&#39;s&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2125752">return</span>&nbsp;<span class="ident" id="2125759">y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2125763">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2125767">t</span>&nbsp;<span class="op" id="2125769">:=</span>&nbsp;<span class="ident" id="2125772">Float64frombits</span><span class="op" id="2125787">(</span><span class="ident" id="2125788">uint64</span><span class="op" id="2125794">(</span><span class="op" id="2125795">(</span><span class="num" id="2125796">0x3ff</span>&nbsp;<span class="op" id="2125802">-</span>&nbsp;<span class="ident" id="2125804">k</span><span class="op" id="2125805">)</span>&nbsp;<span class="op" id="2125807">&lt;&lt;</span>&nbsp;<span class="num" id="2125810">52</span><span class="op" id="2125812">)</span><span class="op" id="2125813">)</span>&nbsp;<span class="comment" id="2125815">//&nbsp;2**-k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2125826">y</span>&nbsp;<span class="op" id="2125828">:=</span>&nbsp;<span class="ident" id="2125831">x</span>&nbsp;<span class="op" id="2125833">-</span>&nbsp;<span class="op" id="2125835">(</span><span class="ident" id="2125836">e</span>&nbsp;<span class="op" id="2125838">+</span>&nbsp;<span class="ident" id="2125840">t</span><span class="op" id="2125841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2125845">y</span>&nbsp;<span class="op" id="2125847">+=</span>&nbsp;<span class="num" id="2125850">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2125854">y</span>&nbsp;<span class="op" id="2125856">=</span>&nbsp;<span class="ident" id="2125858">Float64frombits</span><span class="op" id="2125873">(</span><span class="ident" id="2125874">Float64bits</span><span class="op" id="2125885">(</span><span class="ident" id="2125886">y</span><span class="op" id="2125887">)</span>&nbsp;<span class="op" id="2125889">+</span>&nbsp;<span class="ident" id="2125891">uint64</span><span class="op" id="2125897">(</span><span class="ident" id="2125898">k</span><span class="op" id="2125899">)</span><span class="op" id="2125900">&lt;&lt;</span><span class="num" id="2125902">52</span><span class="op" id="2125904">)</span>&nbsp;<span class="comment" id="2125906">//&nbsp;add&nbsp;k&nbsp;to&nbsp;y&#39;s&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2125933">return</span>&nbsp;<span class="ident" id="2125940">y</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2125943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2125946">return</span>&nbsp;<span class="ident" id="2125953">x</span>&nbsp;<span class="op" id="2125955">-</span>&nbsp;<span class="op" id="2125957">(</span><span class="ident" id="2125958">x</span><span class="op" id="2125959">*</span><span class="ident" id="2125960">e</span>&nbsp;<span class="op" id="2125962">-</span>&nbsp;<span class="ident" id="2125964">hxs</span><span class="op" id="2125967">)</span>&nbsp;<span class="comment" id="2125969">//&nbsp;c&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span><span class="op" id="2125979">}</span>
</div>
</body>
</html>
