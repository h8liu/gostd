<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/fcgi</h2>
<ul>
<li><a href="/gostd/net/http/fcgi/child.go.html">child.go</a></li>
<li><a href="/gostd/net/http/fcgi/fcgi.go.html">fcgi.go</a></li>
<li><a href="/gostd/net/http/fcgi/fcgi_test.go.html">fcgi_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6816894">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6816949">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6817003">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6817054">package</span>&nbsp;<span class="ident" id="6817062">fcgi</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6817068">import</span>&nbsp;<span class="op" id="6817075">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6817078">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6817087">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6817097">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6817103">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6817113">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6817116">var</span>&nbsp;<span class="ident" id="6817120">sizeTests</span>&nbsp;<span class="op" id="6817130">=</span>&nbsp;<span class="op" id="6817132">[</span><span class="op" id="6817133">]</span><span class="keyword" id="6817134">struct</span>&nbsp;<span class="op" id="6817141">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6817144">size</span>&nbsp;&nbsp;<span class="builtintype" id="6817150">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6817158">bytes</span>&nbsp;<span class="op" id="6817164">[</span><span class="op" id="6817165">]</span><span class="builtintype" id="6817166">byte</span><br>
<span class="lineno"></span><span class="op" id="6817171">}</span><span class="op" id="6817172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6817175">{</span><span class="num" id="6817176">0</span><span class="op" id="6817177">,</span>&nbsp;<span class="op" id="6817179">[</span><span class="op" id="6817180">]</span><span class="builtintype" id="6817181">byte</span><span class="op" id="6817185">{</span><span class="num" id="6817186">0x00</span><span class="op" id="6817190">}</span><span class="op" id="6817191">}</span><span class="op" id="6817192">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6817195">{</span><span class="num" id="6817196">127</span><span class="op" id="6817199">,</span>&nbsp;<span class="op" id="6817201">[</span><span class="op" id="6817202">]</span><span class="builtintype" id="6817203">byte</span><span class="op" id="6817207">{</span><span class="num" id="6817208">0x7F</span><span class="op" id="6817212">}</span><span class="op" id="6817213">}</span><span class="op" id="6817214">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6817217">{</span><span class="num" id="6817218">128</span><span class="op" id="6817221">,</span>&nbsp;<span class="op" id="6817223">[</span><span class="op" id="6817224">]</span><span class="builtintype" id="6817225">byte</span><span class="op" id="6817229">{</span><span class="num" id="6817230">0x80</span><span class="op" id="6817234">,</span>&nbsp;<span class="num" id="6817236">0x00</span><span class="op" id="6817240">,</span>&nbsp;<span class="num" id="6817242">0x00</span><span class="op" id="6817246">,</span>&nbsp;<span class="num" id="6817248">0x80</span><span class="op" id="6817252">}</span><span class="op" id="6817253">}</span><span class="op" id="6817254">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6817257">{</span><span class="num" id="6817258">1000</span><span class="op" id="6817262">,</span>&nbsp;<span class="op" id="6817264">[</span><span class="op" id="6817265">]</span><span class="builtintype" id="6817266">byte</span><span class="op" id="6817270">{</span><span class="num" id="6817271">0x80</span><span class="op" id="6817275">,</span>&nbsp;<span class="num" id="6817277">0x00</span><span class="op" id="6817281">,</span>&nbsp;<span class="num" id="6817283">0x03</span><span class="op" id="6817287">,</span>&nbsp;<span class="num" id="6817289">0xE8</span><span class="op" id="6817293">}</span><span class="op" id="6817294">}</span><span class="op" id="6817295">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6817298">{</span><span class="num" id="6817299">33554431</span><span class="op" id="6817307">,</span>&nbsp;<span class="op" id="6817309">[</span><span class="op" id="6817310">]</span><span class="builtintype" id="6817311">byte</span><span class="op" id="6817315">{</span><span class="num" id="6817316">0x81</span><span class="op" id="6817320">,</span>&nbsp;<span class="num" id="6817322">0xFF</span><span class="op" id="6817326">,</span>&nbsp;<span class="num" id="6817328">0xFF</span><span class="op" id="6817332">,</span>&nbsp;<span class="num" id="6817334">0xFF</span><span class="op" id="6817338">}</span><span class="op" id="6817339">}</span><span class="op" id="6817340">,</span><br>
<span class="lineno"></span><span class="op" id="6817342">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="6817345">func</span>&nbsp;<span class="ident" id="6817350">TestSize</span><span class="op" id="6817358">(</span><span class="ident" id="6817359">t</span>&nbsp;<span class="op" id="6817361">*</span><span class="ident" id="6817362">testing</span><span class="op" id="6817369">.</span><span class="ident" id="6817370">T</span><span class="op" id="6817371">)</span>&nbsp;<span class="op" id="6817373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6817376">b</span>&nbsp;<span class="op" id="6817378">:=</span>&nbsp;<span class="builtinfunc" id="6817381">make</span><span class="op" id="6817385">(</span><span class="op" id="6817386">[</span><span class="op" id="6817387">]</span><span class="builtintype" id="6817388">byte</span><span class="op" id="6817392">,</span>&nbsp;<span class="num" id="6817394">4</span><span class="op" id="6817395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6817398">for</span>&nbsp;<span class="ident" id="6817402">i</span><span class="op" id="6817403">,</span>&nbsp;<span class="ident" id="6817405">test</span>&nbsp;<span class="op" id="6817410">:=</span>&nbsp;<span class="keyword" id="6817413">range</span>&nbsp;<span class="ident" id="6817419">sizeTests</span>&nbsp;<span class="op" id="6817429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6817433">n</span>&nbsp;<span class="op" id="6817435">:=</span>&nbsp;<span class="ident" id="6817438">encodeSize</span><span class="op" id="6817448">(</span><span class="ident" id="6817449">b</span><span class="op" id="6817450">,</span>&nbsp;<span class="ident" id="6817452">test</span><span class="op" id="6817456">.</span><span class="ident" id="6817457">size</span><span class="op" id="6817461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6817465">if</span>&nbsp;<span class="op" id="6817468">!</span><span class="ident" id="6817469">bytes</span><span class="op" id="6817474">.</span><span class="ident" id="6817475">Equal</span><span class="op" id="6817480">(</span><span class="ident" id="6817481">b</span><span class="op" id="6817482">[</span><span class="op" id="6817483">:</span><span class="ident" id="6817484">n</span><span class="op" id="6817485">]</span><span class="op" id="6817486">,</span>&nbsp;<span class="ident" id="6817488">test</span><span class="op" id="6817492">.</span><span class="ident" id="6817493">bytes</span><span class="op" id="6817498">)</span>&nbsp;<span class="op" id="6817500">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6817505">t</span><span class="op" id="6817506">.</span><span class="ident" id="6817507">Errorf</span><span class="op" id="6817513">(</span><span class="string" id="6817514">&#34;%d&nbsp;expected&nbsp;%x,&nbsp;encoded&nbsp;%x&#34;</span><span class="op" id="6817542">,</span>&nbsp;<span class="ident" id="6817544">i</span><span class="op" id="6817545">,</span>&nbsp;<span class="ident" id="6817547">test</span><span class="op" id="6817551">.</span><span class="ident" id="6817552">bytes</span><span class="op" id="6817557">,</span>&nbsp;<span class="ident" id="6817559">b</span><span class="op" id="6817560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6817564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6817568">size</span><span class="op" id="6817572">,</span>&nbsp;<span class="ident" id="6817574">n</span>&nbsp;<span class="op" id="6817576">:=</span>&nbsp;<span class="ident" id="6817579">readSize</span><span class="op" id="6817587">(</span><span class="ident" id="6817588">test</span><span class="op" id="6817592">.</span><span class="ident" id="6817593">bytes</span><span class="op" id="6817598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6817602">if</span>&nbsp;<span class="ident" id="6817605">size</span>&nbsp;<span class="op" id="6817610">!=</span>&nbsp;<span class="ident" id="6817613">test</span><span class="op" id="6817617">.</span><span class="ident" id="6817618">size</span>&nbsp;<span class="op" id="6817623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6817628">t</span><span class="op" id="6817629">.</span><span class="ident" id="6817630">Errorf</span><span class="op" id="6817636">(</span><span class="string" id="6817637">&#34;%d&nbsp;expected&nbsp;%d,&nbsp;read&nbsp;%d&#34;</span><span class="op" id="6817662">,</span>&nbsp;<span class="ident" id="6817664">i</span><span class="op" id="6817665">,</span>&nbsp;<span class="ident" id="6817667">test</span><span class="op" id="6817671">.</span><span class="ident" id="6817672">size</span><span class="op" id="6817676">,</span>&nbsp;<span class="ident" id="6817678">size</span><span class="op" id="6817682">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6817686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6817690">if</span>&nbsp;<span class="builtinfunc" id="6817693">len</span><span class="op" id="6817696">(</span><span class="ident" id="6817697">test</span><span class="op" id="6817701">.</span><span class="ident" id="6817702">bytes</span><span class="op" id="6817707">)</span>&nbsp;<span class="op" id="6817709">!=</span>&nbsp;<span class="ident" id="6817712">n</span>&nbsp;<span class="op" id="6817714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6817719">t</span><span class="op" id="6817720">.</span><span class="ident" id="6817721">Errorf</span><span class="op" id="6817727">(</span><span class="string" id="6817728">&#34;%d&nbsp;did&nbsp;not&nbsp;consume&nbsp;all&nbsp;the&nbsp;bytes&#34;</span><span class="op" id="6817762">,</span>&nbsp;<span class="ident" id="6817764">i</span><span class="op" id="6817765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6817769">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6817772">}</span><br>
<span class="lineno">40</span><span class="op" id="6817774">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6817777">var</span>&nbsp;<span class="ident" id="6817781">streamTests</span>&nbsp;<span class="op" id="6817793">=</span>&nbsp;<span class="op" id="6817795">[</span><span class="op" id="6817796">]</span><span class="keyword" id="6817797">struct</span>&nbsp;<span class="op" id="6817804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6817807">desc</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6817815">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6817823">recType</span>&nbsp;<span class="ident" id="6817831">recType</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6817840">reqId</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6817848">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6817856">content</span>&nbsp;<span class="op" id="6817864">[</span><span class="op" id="6817865">]</span><span class="builtintype" id="6817866">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6817872">raw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6817880">[</span><span class="op" id="6817881">]</span><span class="builtintype" id="6817882">byte</span><br>
<span class="lineno"></span><span class="op" id="6817887">}</span><span class="op" id="6817888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6817891">{</span><span class="string" id="6817892">&#34;single&nbsp;record&#34;</span><span class="op" id="6817907">,</span>&nbsp;<span class="ident" id="6817909">typeStdout</span><span class="op" id="6817919">,</span>&nbsp;<span class="num" id="6817921">1</span><span class="op" id="6817922">,</span>&nbsp;<span class="ident" id="6817924">nil</span><span class="op" id="6817927">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6817931">[</span><span class="op" id="6817932">]</span><span class="builtintype" id="6817933">byte</span><span class="op" id="6817937">{</span><span class="num" id="6817938">1</span><span class="op" id="6817939">,</span>&nbsp;<span class="builtintype" id="6817941">byte</span><span class="op" id="6817945">(</span><span class="ident" id="6817946">typeStdout</span><span class="op" id="6817956">)</span><span class="op" id="6817957">,</span>&nbsp;<span class="num" id="6817959">0</span><span class="op" id="6817960">,</span>&nbsp;<span class="num" id="6817962">1</span><span class="op" id="6817963">,</span>&nbsp;<span class="num" id="6817965">0</span><span class="op" id="6817966">,</span>&nbsp;<span class="num" id="6817968">0</span><span class="op" id="6817969">,</span>&nbsp;<span class="num" id="6817971">0</span><span class="op" id="6817972">,</span>&nbsp;<span class="num" id="6817974">0</span><span class="op" id="6817975">}</span><span class="op" id="6817976">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6817979">}</span><span class="op" id="6817980">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6817983">//&nbsp;this&nbsp;data&nbsp;will&nbsp;have&nbsp;to&nbsp;be&nbsp;split&nbsp;into&nbsp;two&nbsp;records</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6818036">{</span><span class="string" id="6818037">&#34;two&nbsp;records&#34;</span><span class="op" id="6818050">,</span>&nbsp;<span class="ident" id="6818052">typeStdin</span><span class="op" id="6818061">,</span>&nbsp;<span class="num" id="6818063">300</span><span class="op" id="6818066">,</span>&nbsp;<span class="builtinfunc" id="6818068">make</span><span class="op" id="6818072">(</span><span class="op" id="6818073">[</span><span class="op" id="6818074">]</span><span class="builtintype" id="6818075">byte</span><span class="op" id="6818079">,</span>&nbsp;<span class="num" id="6818081">66000</span><span class="op" id="6818086">)</span><span class="op" id="6818087">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6818091">bytes</span><span class="op" id="6818096">.</span><span class="ident" id="6818097">Join</span><span class="op" id="6818101">(</span><span class="op" id="6818102">[</span><span class="op" id="6818103">]</span><span class="op" id="6818104">[</span><span class="op" id="6818105">]</span><span class="builtintype" id="6818106">byte</span><span class="op" id="6818110">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6818115">//&nbsp;header&nbsp;for&nbsp;the&nbsp;first&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6818149">{</span><span class="num" id="6818150">1</span><span class="op" id="6818151">,</span>&nbsp;<span class="builtintype" id="6818153">byte</span><span class="op" id="6818157">(</span><span class="ident" id="6818158">typeStdin</span><span class="op" id="6818167">)</span><span class="op" id="6818168">,</span>&nbsp;<span class="num" id="6818170">0x01</span><span class="op" id="6818174">,</span>&nbsp;<span class="num" id="6818176">0x2C</span><span class="op" id="6818180">,</span>&nbsp;<span class="num" id="6818182">0xFF</span><span class="op" id="6818186">,</span>&nbsp;<span class="num" id="6818188">0xFF</span><span class="op" id="6818192">,</span>&nbsp;<span class="num" id="6818194">1</span><span class="op" id="6818195">,</span>&nbsp;<span class="num" id="6818197">0</span><span class="op" id="6818198">}</span><span class="op" id="6818199">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6818204">make</span><span class="op" id="6818208">(</span><span class="op" id="6818209">[</span><span class="op" id="6818210">]</span><span class="builtintype" id="6818211">byte</span><span class="op" id="6818215">,</span>&nbsp;<span class="num" id="6818217">65536</span><span class="op" id="6818222">)</span><span class="op" id="6818223">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6818228">//&nbsp;header&nbsp;for&nbsp;the&nbsp;second</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6818256">{</span><span class="num" id="6818257">1</span><span class="op" id="6818258">,</span>&nbsp;<span class="builtintype" id="6818260">byte</span><span class="op" id="6818264">(</span><span class="ident" id="6818265">typeStdin</span><span class="op" id="6818274">)</span><span class="op" id="6818275">,</span>&nbsp;<span class="num" id="6818277">0x01</span><span class="op" id="6818281">,</span>&nbsp;<span class="num" id="6818283">0x2C</span><span class="op" id="6818287">,</span>&nbsp;<span class="num" id="6818289">0x01</span><span class="op" id="6818293">,</span>&nbsp;<span class="num" id="6818295">0xD1</span><span class="op" id="6818299">,</span>&nbsp;<span class="num" id="6818301">7</span><span class="op" id="6818302">,</span>&nbsp;<span class="num" id="6818304">0</span><span class="op" id="6818305">}</span><span class="op" id="6818306">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6818311">make</span><span class="op" id="6818315">(</span><span class="op" id="6818316">[</span><span class="op" id="6818317">]</span><span class="builtintype" id="6818318">byte</span><span class="op" id="6818322">,</span>&nbsp;<span class="num" id="6818324">472</span><span class="op" id="6818327">)</span><span class="op" id="6818328">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6818333">//&nbsp;header&nbsp;for&nbsp;the&nbsp;empty&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6818367">{</span><span class="num" id="6818368">1</span><span class="op" id="6818369">,</span>&nbsp;<span class="builtintype" id="6818371">byte</span><span class="op" id="6818375">(</span><span class="ident" id="6818376">typeStdin</span><span class="op" id="6818385">)</span><span class="op" id="6818386">,</span>&nbsp;<span class="num" id="6818388">0x01</span><span class="op" id="6818392">,</span>&nbsp;<span class="num" id="6818394">0x2C</span><span class="op" id="6818398">,</span>&nbsp;<span class="num" id="6818400">0</span><span class="op" id="6818401">,</span>&nbsp;<span class="num" id="6818403">0</span><span class="op" id="6818404">,</span>&nbsp;<span class="num" id="6818406">0</span><span class="op" id="6818407">,</span>&nbsp;<span class="num" id="6818409">0</span><span class="op" id="6818410">}</span><span class="op" id="6818411">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6818415">}</span><span class="op" id="6818416">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6818421">nil</span><span class="op" id="6818424">)</span><span class="op" id="6818425">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6818428">}</span><span class="op" id="6818429">,</span><br>
<span class="lineno"></span><span class="op" id="6818431">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6818434">type</span>&nbsp;<span class="ident" id="6818439">nilCloser</span>&nbsp;<span class="keyword" id="6818449">struct</span>&nbsp;<span class="op" id="6818456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6818459">io</span><span class="op" id="6818461">.</span><span class="ident" id="6818462">ReadWriter</span><br>
<span class="lineno">70</span><span class="op" id="6818473">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6818476">func</span>&nbsp;<span class="op" id="6818481">(</span><span class="ident" id="6818482">c</span>&nbsp;<span class="op" id="6818484">*</span><span class="ident" id="6818485">nilCloser</span><span class="op" id="6818494">)</span>&nbsp;<span class="ident" id="6818496">Close</span><span class="op" id="6818501">(</span><span class="op" id="6818502">)</span>&nbsp;<span class="builtintype" id="6818504">error</span>&nbsp;<span class="op" id="6818510">{</span>&nbsp;<span class="keyword" id="6818512">return</span>&nbsp;<span class="ident" id="6818519">nil</span>&nbsp;<span class="op" id="6818523">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6818526">func</span>&nbsp;<span class="ident" id="6818531">TestStreams</span><span class="op" id="6818542">(</span><span class="ident" id="6818543">t</span>&nbsp;<span class="op" id="6818545">*</span><span class="ident" id="6818546">testing</span><span class="op" id="6818553">.</span><span class="ident" id="6818554">T</span><span class="op" id="6818555">)</span>&nbsp;<span class="op" id="6818557">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6818560">var</span>&nbsp;<span class="ident" id="6818564">rec</span>&nbsp;<span class="ident" id="6818568">record</span><br>
<span class="lineno"></span><span class="ident" id="6818575">outer</span><span class="op" id="6818580">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6818583">for</span>&nbsp;<span class="ident" id="6818587">_</span><span class="op" id="6818588">,</span>&nbsp;<span class="ident" id="6818590">test</span>&nbsp;<span class="op" id="6818595">:=</span>&nbsp;<span class="keyword" id="6818598">range</span>&nbsp;<span class="ident" id="6818604">streamTests</span>&nbsp;<span class="op" id="6818616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6818620">buf</span>&nbsp;<span class="op" id="6818624">:=</span>&nbsp;<span class="ident" id="6818627">bytes</span><span class="op" id="6818632">.</span><span class="ident" id="6818633">NewBuffer</span><span class="op" id="6818642">(</span><span class="ident" id="6818643">test</span><span class="op" id="6818647">.</span><span class="ident" id="6818648">raw</span><span class="op" id="6818651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6818655">var</span>&nbsp;<span class="ident" id="6818659">content</span>&nbsp;<span class="op" id="6818667">[</span><span class="op" id="6818668">]</span><span class="builtintype" id="6818669">byte</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6818676">for</span>&nbsp;<span class="ident" id="6818680">buf</span><span class="op" id="6818683">.</span><span class="ident" id="6818684">Len</span><span class="op" id="6818687">(</span><span class="op" id="6818688">)</span>&nbsp;<span class="op" id="6818690">&gt;</span>&nbsp;<span class="num" id="6818692">0</span>&nbsp;<span class="op" id="6818694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6818699">if</span>&nbsp;<span class="ident" id="6818702">err</span>&nbsp;<span class="op" id="6818706">:=</span>&nbsp;<span class="ident" id="6818709">rec</span><span class="op" id="6818712">.</span><span class="ident" id="6818713">read</span><span class="op" id="6818717">(</span><span class="ident" id="6818718">buf</span><span class="op" id="6818721">)</span><span class="op" id="6818722">;</span>&nbsp;<span class="ident" id="6818724">err</span>&nbsp;<span class="op" id="6818728">!=</span>&nbsp;<span class="ident" id="6818731">nil</span>&nbsp;<span class="op" id="6818735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6818741">t</span><span class="op" id="6818742">.</span><span class="ident" id="6818743">Errorf</span><span class="op" id="6818749">(</span><span class="string" id="6818750">&#34;%s:&nbsp;error&nbsp;reading&nbsp;record:&nbsp;%v&#34;</span><span class="op" id="6818780">,</span>&nbsp;<span class="ident" id="6818782">test</span><span class="op" id="6818786">.</span><span class="ident" id="6818787">desc</span><span class="op" id="6818791">,</span>&nbsp;<span class="ident" id="6818793">err</span><span class="op" id="6818796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6818802">continue</span>&nbsp;<span class="ident" id="6818811">outer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6818820">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6818825">content</span>&nbsp;<span class="op" id="6818833">=</span>&nbsp;<span class="builtinfunc" id="6818835">append</span><span class="op" id="6818841">(</span><span class="ident" id="6818842">content</span><span class="op" id="6818849">,</span>&nbsp;<span class="ident" id="6818851">rec</span><span class="op" id="6818854">.</span><span class="ident" id="6818855">content</span><span class="op" id="6818862">(</span><span class="op" id="6818863">)</span><span class="op" id="6818864">...</span><span class="op" id="6818867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6818871">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6818875">if</span>&nbsp;<span class="ident" id="6818878">rec</span><span class="op" id="6818881">.</span><span class="ident" id="6818882">h</span><span class="op" id="6818883">.</span><span class="ident" id="6818884">Type</span>&nbsp;<span class="op" id="6818889">!=</span>&nbsp;<span class="ident" id="6818892">test</span><span class="op" id="6818896">.</span><span class="ident" id="6818897">recType</span>&nbsp;<span class="op" id="6818905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6818910">t</span><span class="op" id="6818911">.</span><span class="ident" id="6818912">Errorf</span><span class="op" id="6818918">(</span><span class="string" id="6818919">&#34;%s:&nbsp;got&nbsp;type&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="6818948">,</span>&nbsp;<span class="ident" id="6818950">test</span><span class="op" id="6818954">.</span><span class="ident" id="6818955">desc</span><span class="op" id="6818959">,</span>&nbsp;<span class="ident" id="6818961">rec</span><span class="op" id="6818964">.</span><span class="ident" id="6818965">h</span><span class="op" id="6818966">.</span><span class="ident" id="6818967">Type</span><span class="op" id="6818971">,</span>&nbsp;<span class="ident" id="6818973">test</span><span class="op" id="6818977">.</span><span class="ident" id="6818978">recType</span><span class="op" id="6818985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6818990">continue</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6819001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6819005">if</span>&nbsp;<span class="ident" id="6819008">rec</span><span class="op" id="6819011">.</span><span class="ident" id="6819012">h</span><span class="op" id="6819013">.</span><span class="ident" id="6819014">Id</span>&nbsp;<span class="op" id="6819017">!=</span>&nbsp;<span class="ident" id="6819020">test</span><span class="op" id="6819024">.</span><span class="ident" id="6819025">reqId</span>&nbsp;<span class="op" id="6819031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6819036">t</span><span class="op" id="6819037">.</span><span class="ident" id="6819038">Errorf</span><span class="op" id="6819044">(</span><span class="string" id="6819045">&#34;%s:&nbsp;got&nbsp;request&nbsp;ID&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="6819080">,</span>&nbsp;<span class="ident" id="6819082">test</span><span class="op" id="6819086">.</span><span class="ident" id="6819087">desc</span><span class="op" id="6819091">,</span>&nbsp;<span class="ident" id="6819093">rec</span><span class="op" id="6819096">.</span><span class="ident" id="6819097">h</span><span class="op" id="6819098">.</span><span class="ident" id="6819099">Id</span><span class="op" id="6819101">,</span>&nbsp;<span class="ident" id="6819103">test</span><span class="op" id="6819107">.</span><span class="ident" id="6819108">reqId</span><span class="op" id="6819113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6819118">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6819129">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6819133">if</span>&nbsp;<span class="op" id="6819136">!</span><span class="ident" id="6819137">bytes</span><span class="op" id="6819142">.</span><span class="ident" id="6819143">Equal</span><span class="op" id="6819148">(</span><span class="ident" id="6819149">content</span><span class="op" id="6819156">,</span>&nbsp;<span class="ident" id="6819158">test</span><span class="op" id="6819162">.</span><span class="ident" id="6819163">content</span><span class="op" id="6819170">)</span>&nbsp;<span class="op" id="6819172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6819177">t</span><span class="op" id="6819178">.</span><span class="ident" id="6819179">Errorf</span><span class="op" id="6819185">(</span><span class="string" id="6819186">&#34;%s:&nbsp;read&nbsp;wrong&nbsp;content&#34;</span><span class="op" id="6819210">,</span>&nbsp;<span class="ident" id="6819212">test</span><span class="op" id="6819216">.</span><span class="ident" id="6819217">desc</span><span class="op" id="6819221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6819226">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6819237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6819241">buf</span><span class="op" id="6819244">.</span><span class="ident" id="6819245">Reset</span><span class="op" id="6819250">(</span><span class="op" id="6819251">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6819255">c</span>&nbsp;<span class="op" id="6819257">:=</span>&nbsp;<span class="ident" id="6819260">newConn</span><span class="op" id="6819267">(</span><span class="op" id="6819268">&amp;</span><span class="ident" id="6819269">nilCloser</span><span class="op" id="6819278">{</span><span class="ident" id="6819279">buf</span><span class="op" id="6819282">}</span><span class="op" id="6819283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6819287">w</span>&nbsp;<span class="op" id="6819289">:=</span>&nbsp;<span class="ident" id="6819292">newWriter</span><span class="op" id="6819301">(</span><span class="ident" id="6819302">c</span><span class="op" id="6819303">,</span>&nbsp;<span class="ident" id="6819305">test</span><span class="op" id="6819309">.</span><span class="ident" id="6819310">recType</span><span class="op" id="6819317">,</span>&nbsp;<span class="ident" id="6819319">test</span><span class="op" id="6819323">.</span><span class="ident" id="6819324">reqId</span><span class="op" id="6819329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6819333">if</span>&nbsp;<span class="ident" id="6819336">_</span><span class="op" id="6819337">,</span>&nbsp;<span class="ident" id="6819339">err</span>&nbsp;<span class="op" id="6819343">:=</span>&nbsp;<span class="ident" id="6819346">w</span><span class="op" id="6819347">.</span><span class="ident" id="6819348">Write</span><span class="op" id="6819353">(</span><span class="ident" id="6819354">test</span><span class="op" id="6819358">.</span><span class="ident" id="6819359">content</span><span class="op" id="6819366">)</span><span class="op" id="6819367">;</span>&nbsp;<span class="ident" id="6819369">err</span>&nbsp;<span class="op" id="6819373">!=</span>&nbsp;<span class="ident" id="6819376">nil</span>&nbsp;<span class="op" id="6819380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6819385">t</span><span class="op" id="6819386">.</span><span class="ident" id="6819387">Errorf</span><span class="op" id="6819393">(</span><span class="string" id="6819394">&#34;%s:&nbsp;error&nbsp;writing&nbsp;record:&nbsp;%v&#34;</span><span class="op" id="6819424">,</span>&nbsp;<span class="ident" id="6819426">test</span><span class="op" id="6819430">.</span><span class="ident" id="6819431">desc</span><span class="op" id="6819435">,</span>&nbsp;<span class="ident" id="6819437">err</span><span class="op" id="6819440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6819445">continue</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6819456">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6819460">if</span>&nbsp;<span class="ident" id="6819463">err</span>&nbsp;<span class="op" id="6819467">:=</span>&nbsp;<span class="ident" id="6819470">w</span><span class="op" id="6819471">.</span><span class="ident" id="6819472">Close</span><span class="op" id="6819477">(</span><span class="op" id="6819478">)</span><span class="op" id="6819479">;</span>&nbsp;<span class="ident" id="6819481">err</span>&nbsp;<span class="op" id="6819485">!=</span>&nbsp;<span class="ident" id="6819488">nil</span>&nbsp;<span class="op" id="6819492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6819497">t</span><span class="op" id="6819498">.</span><span class="ident" id="6819499">Errorf</span><span class="op" id="6819505">(</span><span class="string" id="6819506">&#34;%s:&nbsp;error&nbsp;closing&nbsp;stream:&nbsp;%v&#34;</span><span class="op" id="6819536">,</span>&nbsp;<span class="ident" id="6819538">test</span><span class="op" id="6819542">.</span><span class="ident" id="6819543">desc</span><span class="op" id="6819547">,</span>&nbsp;<span class="ident" id="6819549">err</span><span class="op" id="6819552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6819557">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6819568">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6819572">if</span>&nbsp;<span class="op" id="6819575">!</span><span class="ident" id="6819576">bytes</span><span class="op" id="6819581">.</span><span class="ident" id="6819582">Equal</span><span class="op" id="6819587">(</span><span class="ident" id="6819588">buf</span><span class="op" id="6819591">.</span><span class="ident" id="6819592">Bytes</span><span class="op" id="6819597">(</span><span class="op" id="6819598">)</span><span class="op" id="6819599">,</span>&nbsp;<span class="ident" id="6819601">test</span><span class="op" id="6819605">.</span><span class="ident" id="6819606">raw</span><span class="op" id="6819609">)</span>&nbsp;<span class="op" id="6819611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6819616">t</span><span class="op" id="6819617">.</span><span class="ident" id="6819618">Errorf</span><span class="op" id="6819624">(</span><span class="string" id="6819625">&#34;%s:&nbsp;wrote&nbsp;wrong&nbsp;content&#34;</span><span class="op" id="6819650">,</span>&nbsp;<span class="ident" id="6819652">test</span><span class="op" id="6819656">.</span><span class="ident" id="6819657">desc</span><span class="op" id="6819661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6819665">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6819668">}</span><br>
<span class="lineno"></span><span class="op" id="6819670">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="keyword" id="6819673">type</span>&nbsp;<span class="ident" id="6819678">writeOnlyConn</span>&nbsp;<span class="keyword" id="6819692">struct</span>&nbsp;<span class="op" id="6819699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6819702">buf</span>&nbsp;<span class="op" id="6819706">[</span><span class="op" id="6819707">]</span><span class="builtintype" id="6819708">byte</span><br>
<span class="lineno"></span><span class="op" id="6819713">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="6819716">func</span>&nbsp;<span class="op" id="6819721">(</span><span class="ident" id="6819722">c</span>&nbsp;<span class="op" id="6819724">*</span><span class="ident" id="6819725">writeOnlyConn</span><span class="op" id="6819738">)</span>&nbsp;<span class="ident" id="6819740">Write</span><span class="op" id="6819745">(</span><span class="ident" id="6819746">p</span>&nbsp;<span class="op" id="6819748">[</span><span class="op" id="6819749">]</span><span class="builtintype" id="6819750">byte</span><span class="op" id="6819754">)</span>&nbsp;<span class="op" id="6819756">(</span><span class="builtintype" id="6819757">int</span><span class="op" id="6819760">,</span>&nbsp;<span class="builtintype" id="6819762">error</span><span class="op" id="6819767">)</span>&nbsp;<span class="op" id="6819769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6819772">c</span><span class="op" id="6819773">.</span><span class="ident" id="6819774">buf</span>&nbsp;<span class="op" id="6819778">=</span>&nbsp;<span class="builtinfunc" id="6819780">append</span><span class="op" id="6819786">(</span><span class="ident" id="6819787">c</span><span class="op" id="6819788">.</span><span class="ident" id="6819789">buf</span><span class="op" id="6819792">,</span>&nbsp;<span class="ident" id="6819794">p</span><span class="op" id="6819795">...</span><span class="op" id="6819798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6819801">return</span>&nbsp;<span class="builtinfunc" id="6819808">len</span><span class="op" id="6819811">(</span><span class="ident" id="6819812">p</span><span class="op" id="6819813">)</span><span class="op" id="6819814">,</span>&nbsp;<span class="ident" id="6819816">nil</span><br>
<span class="lineno"></span><span class="op" id="6819820">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="6819823">func</span>&nbsp;<span class="op" id="6819828">(</span><span class="ident" id="6819829">c</span>&nbsp;<span class="op" id="6819831">*</span><span class="ident" id="6819832">writeOnlyConn</span><span class="op" id="6819845">)</span>&nbsp;<span class="ident" id="6819847">Read</span><span class="op" id="6819851">(</span><span class="ident" id="6819852">p</span>&nbsp;<span class="op" id="6819854">[</span><span class="op" id="6819855">]</span><span class="builtintype" id="6819856">byte</span><span class="op" id="6819860">)</span>&nbsp;<span class="op" id="6819862">(</span><span class="builtintype" id="6819863">int</span><span class="op" id="6819866">,</span>&nbsp;<span class="builtintype" id="6819868">error</span><span class="op" id="6819873">)</span>&nbsp;<span class="op" id="6819875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6819878">return</span>&nbsp;<span class="num" id="6819885">0</span><span class="op" id="6819886">,</span>&nbsp;<span class="ident" id="6819888">errors</span><span class="op" id="6819894">.</span><span class="ident" id="6819895">New</span><span class="op" id="6819898">(</span><span class="string" id="6819899">&#34;conn&nbsp;is&nbsp;write-only&#34;</span><span class="op" id="6819919">)</span><br>
<span class="lineno"></span><span class="op" id="6819921">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6819924">func</span>&nbsp;<span class="op" id="6819929">(</span><span class="ident" id="6819930">c</span>&nbsp;<span class="op" id="6819932">*</span><span class="ident" id="6819933">writeOnlyConn</span><span class="op" id="6819946">)</span>&nbsp;<span class="ident" id="6819948">Close</span><span class="op" id="6819953">(</span><span class="op" id="6819954">)</span>&nbsp;<span class="builtintype" id="6819956">error</span>&nbsp;<span class="op" id="6819962">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6819965">return</span>&nbsp;<span class="ident" id="6819972">nil</span><br>
<span class="lineno"></span><span class="op" id="6819976">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6819979">func</span>&nbsp;<span class="ident" id="6819984">TestGetValues</span><span class="op" id="6819997">(</span><span class="ident" id="6819998">t</span>&nbsp;<span class="op" id="6820000">*</span><span class="ident" id="6820001">testing</span><span class="op" id="6820008">.</span><span class="ident" id="6820009">T</span><span class="op" id="6820010">)</span>&nbsp;<span class="op" id="6820012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6820015">var</span>&nbsp;<span class="ident" id="6820019">rec</span>&nbsp;<span class="ident" id="6820023">record</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6820031">rec</span><span class="op" id="6820034">.</span><span class="ident" id="6820035">h</span><span class="op" id="6820036">.</span><span class="ident" id="6820037">Type</span>&nbsp;<span class="op" id="6820042">=</span>&nbsp;<span class="ident" id="6820044">typeGetValues</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6820060">wc</span>&nbsp;<span class="op" id="6820063">:=</span>&nbsp;<span class="builtinfunc" id="6820066">new</span><span class="op" id="6820069">(</span><span class="ident" id="6820070">writeOnlyConn</span><span class="op" id="6820083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6820086">c</span>&nbsp;<span class="op" id="6820088">:=</span>&nbsp;<span class="ident" id="6820091">newChild</span><span class="op" id="6820099">(</span><span class="ident" id="6820100">wc</span><span class="op" id="6820102">,</span>&nbsp;<span class="ident" id="6820104">nil</span><span class="op" id="6820107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6820110">err</span>&nbsp;<span class="op" id="6820114">:=</span>&nbsp;<span class="ident" id="6820117">c</span><span class="op" id="6820118">.</span><span class="ident" id="6820119">handleRecord</span><span class="op" id="6820131">(</span><span class="op" id="6820132">&amp;</span><span class="ident" id="6820133">rec</span><span class="op" id="6820136">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6820139">if</span>&nbsp;<span class="ident" id="6820142">err</span>&nbsp;<span class="op" id="6820146">!=</span>&nbsp;<span class="ident" id="6820149">nil</span>&nbsp;<span class="op" id="6820153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6820157">t</span><span class="op" id="6820158">.</span><span class="ident" id="6820159">Fatalf</span><span class="op" id="6820165">(</span><span class="string" id="6820166">&#34;handleRecord:&nbsp;%v&#34;</span><span class="op" id="6820184">,</span>&nbsp;<span class="ident" id="6820186">err</span><span class="op" id="6820189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6820192">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6820196">const</span>&nbsp;<span class="ident" id="6820202">want</span>&nbsp;<span class="op" id="6820207">=</span>&nbsp;<span class="string" id="6820209">&#34;\x01\n\x00\x00\x00\x12\x06\x00&#34;</span>&nbsp;<span class="op" id="6820242">+</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6820246">&#34;\x0f\x01FCGI_MPXS_CONNS1&#34;</span>&nbsp;<span class="op" id="6820273">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6820277">&#34;\x00\x00\x00\x00\x00\x00\x01\n\x00\x00\x00\x00\x00\x00&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6820335">if</span>&nbsp;<span class="ident" id="6820338">got</span>&nbsp;<span class="op" id="6820342">:=</span>&nbsp;<span class="builtintype" id="6820345">string</span><span class="op" id="6820351">(</span><span class="ident" id="6820352">wc</span><span class="op" id="6820354">.</span><span class="ident" id="6820355">buf</span><span class="op" id="6820358">)</span><span class="op" id="6820359">;</span>&nbsp;<span class="ident" id="6820361">got</span>&nbsp;<span class="op" id="6820365">!=</span>&nbsp;<span class="ident" id="6820368">want</span>&nbsp;<span class="op" id="6820373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6820377">t</span><span class="op" id="6820378">.</span><span class="ident" id="6820379">Errorf</span><span class="op" id="6820385">(</span><span class="string" id="6820386">&#34;&nbsp;got:&nbsp;%q\nwant:&nbsp;%q\n&#34;</span><span class="op" id="6820408">,</span>&nbsp;<span class="ident" id="6820410">got</span><span class="op" id="6820413">,</span>&nbsp;<span class="ident" id="6820415">want</span><span class="op" id="6820419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6820422">}</span><br>
<span class="lineno">150</span><span class="op" id="6820424">}</span>
</div>
</body>
</html>
