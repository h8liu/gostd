<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/base64</h2>
<ul>
<li><a href="/gostd/encoding/base64/base64.go.html">base64.go</a></li>
<li><a href="/gostd/encoding/base64/base64_test.go.html">base64_test.go</a></li>
<li><a href="/gostd/encoding/base64/example_test.go.html">example_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7705797">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7705852">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7705906">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7705957">package</span>&nbsp;<span class="ident" id="7705965">base64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7705973">import</span>&nbsp;<span class="op" id="7705980">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7705983">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7705992">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7706002">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7706008">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7706021">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7706032">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7706043">&#34;testing&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7706054">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7706061">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7706064">type</span>&nbsp;<span class="ident" id="7706069">testpair</span>&nbsp;<span class="keyword" id="7706078">struct</span>&nbsp;<span class="op" id="7706085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7706088">decoded</span><span class="op" id="7706095">,</span>&nbsp;<span class="ident" id="7706097">encoded</span>&nbsp;<span class="builtintype" id="7706105">string</span><br>
<span class="lineno">20</span><span class="op" id="7706112">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7706115">var</span>&nbsp;<span class="ident" id="7706119">pairs</span>&nbsp;<span class="op" id="7706125">=</span>&nbsp;<span class="op" id="7706127">[</span><span class="op" id="7706128">]</span><span class="ident" id="7706129">testpair</span><span class="op" id="7706137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7706140">//&nbsp;RFC&nbsp;3548&nbsp;examples</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7706162">{</span><span class="string" id="7706163">&#34;\x14\xfb\x9c\x03\xd9\x7e&#34;</span><span class="op" id="7706189">,</span>&nbsp;<span class="string" id="7706191">&#34;FPucA9l+&#34;</span><span class="op" id="7706201">}</span><span class="op" id="7706202">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7706205">{</span><span class="string" id="7706206">&#34;\x14\xfb\x9c\x03\xd9&#34;</span><span class="op" id="7706228">,</span>&nbsp;<span class="string" id="7706230">&#34;FPucA9k=&#34;</span><span class="op" id="7706240">}</span><span class="op" id="7706241">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7706244">{</span><span class="string" id="7706245">&#34;\x14\xfb\x9c\x03&#34;</span><span class="op" id="7706263">,</span>&nbsp;<span class="string" id="7706265">&#34;FPucAw==&#34;</span><span class="op" id="7706275">}</span><span class="op" id="7706276">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7706280">//&nbsp;RFC&nbsp;4648&nbsp;examples</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7706302">{</span><span class="string" id="7706303">&#34;&#34;</span><span class="op" id="7706305">,</span>&nbsp;<span class="string" id="7706307">&#34;&#34;</span><span class="op" id="7706309">}</span><span class="op" id="7706310">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7706313">{</span><span class="string" id="7706314">&#34;f&#34;</span><span class="op" id="7706317">,</span>&nbsp;<span class="string" id="7706319">&#34;Zg==&#34;</span><span class="op" id="7706325">}</span><span class="op" id="7706326">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7706329">{</span><span class="string" id="7706330">&#34;fo&#34;</span><span class="op" id="7706334">,</span>&nbsp;<span class="string" id="7706336">&#34;Zm8=&#34;</span><span class="op" id="7706342">}</span><span class="op" id="7706343">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7706346">{</span><span class="string" id="7706347">&#34;foo&#34;</span><span class="op" id="7706352">,</span>&nbsp;<span class="string" id="7706354">&#34;Zm9v&#34;</span><span class="op" id="7706360">}</span><span class="op" id="7706361">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7706364">{</span><span class="string" id="7706365">&#34;foob&#34;</span><span class="op" id="7706371">,</span>&nbsp;<span class="string" id="7706373">&#34;Zm9vYg==&#34;</span><span class="op" id="7706383">}</span><span class="op" id="7706384">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7706387">{</span><span class="string" id="7706388">&#34;fooba&#34;</span><span class="op" id="7706395">,</span>&nbsp;<span class="string" id="7706397">&#34;Zm9vYmE=&#34;</span><span class="op" id="7706407">}</span><span class="op" id="7706408">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7706411">{</span><span class="string" id="7706412">&#34;foobar&#34;</span><span class="op" id="7706420">,</span>&nbsp;<span class="string" id="7706422">&#34;Zm9vYmFy&#34;</span><span class="op" id="7706432">}</span><span class="op" id="7706433">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7706437">//&nbsp;Wikipedia&nbsp;examples</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7706460">{</span><span class="string" id="7706461">&#34;sure.&#34;</span><span class="op" id="7706468">,</span>&nbsp;<span class="string" id="7706470">&#34;c3VyZS4=&#34;</span><span class="op" id="7706480">}</span><span class="op" id="7706481">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7706484">{</span><span class="string" id="7706485">&#34;sure&#34;</span><span class="op" id="7706491">,</span>&nbsp;<span class="string" id="7706493">&#34;c3VyZQ==&#34;</span><span class="op" id="7706503">}</span><span class="op" id="7706504">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7706507">{</span><span class="string" id="7706508">&#34;sur&#34;</span><span class="op" id="7706513">,</span>&nbsp;<span class="string" id="7706515">&#34;c3Vy&#34;</span><span class="op" id="7706521">}</span><span class="op" id="7706522">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7706525">{</span><span class="string" id="7706526">&#34;su&#34;</span><span class="op" id="7706530">,</span>&nbsp;<span class="string" id="7706532">&#34;c3U=&#34;</span><span class="op" id="7706538">}</span><span class="op" id="7706539">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7706542">{</span><span class="string" id="7706543">&#34;leasure.&#34;</span><span class="op" id="7706553">,</span>&nbsp;<span class="string" id="7706555">&#34;bGVhc3VyZS4=&#34;</span><span class="op" id="7706569">}</span><span class="op" id="7706570">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7706573">{</span><span class="string" id="7706574">&#34;easure.&#34;</span><span class="op" id="7706583">,</span>&nbsp;<span class="string" id="7706585">&#34;ZWFzdXJlLg==&#34;</span><span class="op" id="7706599">}</span><span class="op" id="7706600">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7706603">{</span><span class="string" id="7706604">&#34;asure.&#34;</span><span class="op" id="7706612">,</span>&nbsp;<span class="string" id="7706614">&#34;YXN1cmUu&#34;</span><span class="op" id="7706624">}</span><span class="op" id="7706625">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7706628">{</span><span class="string" id="7706629">&#34;sure.&#34;</span><span class="op" id="7706636">,</span>&nbsp;<span class="string" id="7706638">&#34;c3VyZS4=&#34;</span><span class="op" id="7706648">}</span><span class="op" id="7706649">,</span><br>
<span class="lineno"></span><span class="op" id="7706651">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7706654">var</span>&nbsp;<span class="ident" id="7706658">bigtest</span>&nbsp;<span class="op" id="7706666">=</span>&nbsp;<span class="ident" id="7706668">testpair</span><span class="op" id="7706676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7706679">&#34;Twas&nbsp;brillig,&nbsp;and&nbsp;the&nbsp;slithy&nbsp;toves&#34;</span><span class="op" id="7706715">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7706718">&#34;VHdhcyBicmlsbGlnLCBhbmQgdGhlIHNsaXRoeSB0b3Zlcw==&#34;</span><span class="op" id="7706768">,</span><br>
<span class="lineno"></span><span class="op" id="7706770">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7706773">func</span>&nbsp;<span class="ident" id="7706778">testEqual</span><span class="op" id="7706787">(</span><span class="ident" id="7706788">t</span>&nbsp;<span class="op" id="7706790">*</span><span class="ident" id="7706791">testing</span><span class="op" id="7706798">.</span><span class="ident" id="7706799">T</span><span class="op" id="7706800">,</span>&nbsp;<span class="ident" id="7706802">msg</span>&nbsp;<span class="builtintype" id="7706806">string</span><span class="op" id="7706812">,</span>&nbsp;<span class="ident" id="7706814">args</span>&nbsp;<span class="op" id="7706819">...</span><span class="keyword" id="7706822">interface</span><span class="op" id="7706831">{</span><span class="op" id="7706832">}</span><span class="op" id="7706833">)</span>&nbsp;<span class="builtintype" id="7706835">bool</span>&nbsp;<span class="op" id="7706840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7706843">if</span>&nbsp;<span class="ident" id="7706846">args</span><span class="op" id="7706850">[</span><span class="builtinfunc" id="7706851">len</span><span class="op" id="7706854">(</span><span class="ident" id="7706855">args</span><span class="op" id="7706859">)</span><span class="op" id="7706860">-</span><span class="num" id="7706861">2</span><span class="op" id="7706862">]</span>&nbsp;<span class="op" id="7706864">!=</span>&nbsp;<span class="ident" id="7706867">args</span><span class="op" id="7706871">[</span><span class="builtinfunc" id="7706872">len</span><span class="op" id="7706875">(</span><span class="ident" id="7706876">args</span><span class="op" id="7706880">)</span><span class="op" id="7706881">-</span><span class="num" id="7706882">1</span><span class="op" id="7706883">]</span>&nbsp;<span class="op" id="7706885">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7706889">t</span><span class="op" id="7706890">.</span><span class="ident" id="7706891">Errorf</span><span class="op" id="7706897">(</span><span class="ident" id="7706898">msg</span><span class="op" id="7706901">,</span>&nbsp;<span class="ident" id="7706903">args</span><span class="op" id="7706907">...</span><span class="op" id="7706910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7706914">return</span>&nbsp;<span class="builtintype" id="7706921">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7706928">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7706931">return</span>&nbsp;<span class="builtintype" id="7706938">true</span><br>
<span class="lineno"></span><span class="op" id="7706943">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="7706946">func</span>&nbsp;<span class="ident" id="7706951">TestEncode</span><span class="op" id="7706961">(</span><span class="ident" id="7706962">t</span>&nbsp;<span class="op" id="7706964">*</span><span class="ident" id="7706965">testing</span><span class="op" id="7706972">.</span><span class="ident" id="7706973">T</span><span class="op" id="7706974">)</span>&nbsp;<span class="op" id="7706976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7706979">for</span>&nbsp;<span class="ident" id="7706983">_</span><span class="op" id="7706984">,</span>&nbsp;<span class="ident" id="7706986">p</span>&nbsp;<span class="op" id="7706988">:=</span>&nbsp;<span class="keyword" id="7706991">range</span>&nbsp;<span class="ident" id="7706997">pairs</span>&nbsp;<span class="op" id="7707003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7707007">got</span>&nbsp;<span class="op" id="7707011">:=</span>&nbsp;<span class="ident" id="7707014">StdEncoding</span><span class="op" id="7707025">.</span><span class="ident" id="7707026">EncodeToString</span><span class="op" id="7707040">(</span><span class="op" id="7707041">[</span><span class="op" id="7707042">]</span><span class="builtintype" id="7707043">byte</span><span class="op" id="7707047">(</span><span class="ident" id="7707048">p</span><span class="op" id="7707049">.</span><span class="ident" id="7707050">decoded</span><span class="op" id="7707057">)</span><span class="op" id="7707058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7707062">testEqual</span><span class="op" id="7707071">(</span><span class="ident" id="7707072">t</span><span class="op" id="7707073">,</span>&nbsp;<span class="string" id="7707075">&#34;Encode(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7707101">,</span>&nbsp;<span class="ident" id="7707103">p</span><span class="op" id="7707104">.</span><span class="ident" id="7707105">decoded</span><span class="op" id="7707112">,</span>&nbsp;<span class="ident" id="7707114">got</span><span class="op" id="7707117">,</span>&nbsp;<span class="ident" id="7707119">p</span><span class="op" id="7707120">.</span><span class="ident" id="7707121">encoded</span><span class="op" id="7707128">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7707131">}</span><br>
<span class="lineno"></span><span class="op" id="7707133">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7707136">func</span>&nbsp;<span class="ident" id="7707141">TestEncoder</span><span class="op" id="7707152">(</span><span class="ident" id="7707153">t</span>&nbsp;<span class="op" id="7707155">*</span><span class="ident" id="7707156">testing</span><span class="op" id="7707163">.</span><span class="ident" id="7707164">T</span><span class="op" id="7707165">)</span>&nbsp;<span class="op" id="7707167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7707170">for</span>&nbsp;<span class="ident" id="7707174">_</span><span class="op" id="7707175">,</span>&nbsp;<span class="ident" id="7707177">p</span>&nbsp;<span class="op" id="7707179">:=</span>&nbsp;<span class="keyword" id="7707182">range</span>&nbsp;<span class="ident" id="7707188">pairs</span>&nbsp;<span class="op" id="7707194">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7707198">bb</span>&nbsp;<span class="op" id="7707201">:=</span>&nbsp;<span class="op" id="7707204">&amp;</span><span class="ident" id="7707205">bytes</span><span class="op" id="7707210">.</span><span class="ident" id="7707211">Buffer</span><span class="op" id="7707217">{</span><span class="op" id="7707218">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7707222">encoder</span>&nbsp;<span class="op" id="7707230">:=</span>&nbsp;<span class="ident" id="7707233">NewEncoder</span><span class="op" id="7707243">(</span><span class="ident" id="7707244">StdEncoding</span><span class="op" id="7707255">,</span>&nbsp;<span class="ident" id="7707257">bb</span><span class="op" id="7707259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7707263">encoder</span><span class="op" id="7707270">.</span><span class="ident" id="7707271">Write</span><span class="op" id="7707276">(</span><span class="op" id="7707277">[</span><span class="op" id="7707278">]</span><span class="builtintype" id="7707279">byte</span><span class="op" id="7707283">(</span><span class="ident" id="7707284">p</span><span class="op" id="7707285">.</span><span class="ident" id="7707286">decoded</span><span class="op" id="7707293">)</span><span class="op" id="7707294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7707298">encoder</span><span class="op" id="7707305">.</span><span class="ident" id="7707306">Close</span><span class="op" id="7707311">(</span><span class="op" id="7707312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7707316">testEqual</span><span class="op" id="7707325">(</span><span class="ident" id="7707326">t</span><span class="op" id="7707327">,</span>&nbsp;<span class="string" id="7707329">&#34;Encode(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7707355">,</span>&nbsp;<span class="ident" id="7707357">p</span><span class="op" id="7707358">.</span><span class="ident" id="7707359">decoded</span><span class="op" id="7707366">,</span>&nbsp;<span class="ident" id="7707368">bb</span><span class="op" id="7707370">.</span><span class="ident" id="7707371">String</span><span class="op" id="7707377">(</span><span class="op" id="7707378">)</span><span class="op" id="7707379">,</span>&nbsp;<span class="ident" id="7707381">p</span><span class="op" id="7707382">.</span><span class="ident" id="7707383">encoded</span><span class="op" id="7707390">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7707393">}</span><br>
<span class="lineno"></span><span class="op" id="7707395">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7707398">func</span>&nbsp;<span class="ident" id="7707403">TestEncoderBuffering</span><span class="op" id="7707423">(</span><span class="ident" id="7707424">t</span>&nbsp;<span class="op" id="7707426">*</span><span class="ident" id="7707427">testing</span><span class="op" id="7707434">.</span><span class="ident" id="7707435">T</span><span class="op" id="7707436">)</span>&nbsp;<span class="op" id="7707438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7707441">input</span>&nbsp;<span class="op" id="7707447">:=</span>&nbsp;<span class="op" id="7707450">[</span><span class="op" id="7707451">]</span><span class="builtintype" id="7707452">byte</span><span class="op" id="7707456">(</span><span class="ident" id="7707457">bigtest</span><span class="op" id="7707464">.</span><span class="ident" id="7707465">decoded</span><span class="op" id="7707472">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7707475">for</span>&nbsp;<span class="ident" id="7707479">bs</span>&nbsp;<span class="op" id="7707482">:=</span>&nbsp;<span class="num" id="7707485">1</span><span class="op" id="7707486">;</span>&nbsp;<span class="ident" id="7707488">bs</span>&nbsp;<span class="op" id="7707491">&lt;=</span>&nbsp;<span class="num" id="7707494">12</span><span class="op" id="7707496">;</span>&nbsp;<span class="ident" id="7707498">bs</span><span class="op" id="7707500">++</span>&nbsp;<span class="op" id="7707503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7707507">bb</span>&nbsp;<span class="op" id="7707510">:=</span>&nbsp;<span class="op" id="7707513">&amp;</span><span class="ident" id="7707514">bytes</span><span class="op" id="7707519">.</span><span class="ident" id="7707520">Buffer</span><span class="op" id="7707526">{</span><span class="op" id="7707527">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7707531">encoder</span>&nbsp;<span class="op" id="7707539">:=</span>&nbsp;<span class="ident" id="7707542">NewEncoder</span><span class="op" id="7707552">(</span><span class="ident" id="7707553">StdEncoding</span><span class="op" id="7707564">,</span>&nbsp;<span class="ident" id="7707566">bb</span><span class="op" id="7707568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7707572">for</span>&nbsp;<span class="ident" id="7707576">pos</span>&nbsp;<span class="op" id="7707580">:=</span>&nbsp;<span class="num" id="7707583">0</span><span class="op" id="7707584">;</span>&nbsp;<span class="ident" id="7707586">pos</span>&nbsp;<span class="op" id="7707590">&lt;</span>&nbsp;<span class="builtinfunc" id="7707592">len</span><span class="op" id="7707595">(</span><span class="ident" id="7707596">input</span><span class="op" id="7707601">)</span><span class="op" id="7707602">;</span>&nbsp;<span class="ident" id="7707604">pos</span>&nbsp;<span class="op" id="7707608">+=</span>&nbsp;<span class="ident" id="7707611">bs</span>&nbsp;<span class="op" id="7707614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7707619">end</span>&nbsp;<span class="op" id="7707623">:=</span>&nbsp;<span class="ident" id="7707626">pos</span>&nbsp;<span class="op" id="7707630">+</span>&nbsp;<span class="ident" id="7707632">bs</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7707638">if</span>&nbsp;<span class="ident" id="7707641">end</span>&nbsp;<span class="op" id="7707645">&gt;</span>&nbsp;<span class="builtinfunc" id="7707647">len</span><span class="op" id="7707650">(</span><span class="ident" id="7707651">input</span><span class="op" id="7707656">)</span>&nbsp;<span class="op" id="7707658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7707664">end</span>&nbsp;<span class="op" id="7707668">=</span>&nbsp;<span class="builtinfunc" id="7707670">len</span><span class="op" id="7707673">(</span><span class="ident" id="7707674">input</span><span class="op" id="7707679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7707684">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7707689">n</span><span class="op" id="7707690">,</span>&nbsp;<span class="ident" id="7707692">err</span>&nbsp;<span class="op" id="7707696">:=</span>&nbsp;<span class="ident" id="7707699">encoder</span><span class="op" id="7707706">.</span><span class="ident" id="7707707">Write</span><span class="op" id="7707712">(</span><span class="ident" id="7707713">input</span><span class="op" id="7707718">[</span><span class="ident" id="7707719">pos</span><span class="op" id="7707722">:</span><span class="ident" id="7707723">end</span><span class="op" id="7707726">]</span><span class="op" id="7707727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7707732">testEqual</span><span class="op" id="7707741">(</span><span class="ident" id="7707742">t</span><span class="op" id="7707743">,</span>&nbsp;<span class="string" id="7707745">&#34;Write(%q)&nbsp;gave&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7707779">,</span>&nbsp;<span class="ident" id="7707781">input</span><span class="op" id="7707786">[</span><span class="ident" id="7707787">pos</span><span class="op" id="7707790">:</span><span class="ident" id="7707791">end</span><span class="op" id="7707794">]</span><span class="op" id="7707795">,</span>&nbsp;<span class="ident" id="7707797">err</span><span class="op" id="7707800">,</span>&nbsp;<span class="builtintype" id="7707802">error</span><span class="op" id="7707807">(</span><span class="ident" id="7707808">nil</span><span class="op" id="7707811">)</span><span class="op" id="7707812">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7707817">testEqual</span><span class="op" id="7707826">(</span><span class="ident" id="7707827">t</span><span class="op" id="7707828">,</span>&nbsp;<span class="string" id="7707830">&#34;Write(%q)&nbsp;gave&nbsp;length&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7707865">,</span>&nbsp;<span class="ident" id="7707867">input</span><span class="op" id="7707872">[</span><span class="ident" id="7707873">pos</span><span class="op" id="7707876">:</span><span class="ident" id="7707877">end</span><span class="op" id="7707880">]</span><span class="op" id="7707881">,</span>&nbsp;<span class="ident" id="7707883">n</span><span class="op" id="7707884">,</span>&nbsp;<span class="ident" id="7707886">end</span><span class="op" id="7707889">-</span><span class="ident" id="7707890">pos</span><span class="op" id="7707893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7707897">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7707901">err</span>&nbsp;<span class="op" id="7707905">:=</span>&nbsp;<span class="ident" id="7707908">encoder</span><span class="op" id="7707915">.</span><span class="ident" id="7707916">Close</span><span class="op" id="7707921">(</span><span class="op" id="7707922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7707926">testEqual</span><span class="op" id="7707935">(</span><span class="ident" id="7707936">t</span><span class="op" id="7707937">,</span>&nbsp;<span class="string" id="7707939">&#34;Close&nbsp;gave&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7707969">,</span>&nbsp;<span class="ident" id="7707971">err</span><span class="op" id="7707974">,</span>&nbsp;<span class="builtintype" id="7707976">error</span><span class="op" id="7707981">(</span><span class="ident" id="7707982">nil</span><span class="op" id="7707985">)</span><span class="op" id="7707986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7707990">testEqual</span><span class="op" id="7707999">(</span><span class="ident" id="7708000">t</span><span class="op" id="7708001">,</span>&nbsp;<span class="string" id="7708003">&#34;Encoding/%d&nbsp;of&nbsp;%q&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7708036">,</span>&nbsp;<span class="ident" id="7708038">bs</span><span class="op" id="7708040">,</span>&nbsp;<span class="ident" id="7708042">bigtest</span><span class="op" id="7708049">.</span><span class="ident" id="7708050">decoded</span><span class="op" id="7708057">,</span>&nbsp;<span class="ident" id="7708059">bb</span><span class="op" id="7708061">.</span><span class="ident" id="7708062">String</span><span class="op" id="7708068">(</span><span class="op" id="7708069">)</span><span class="op" id="7708070">,</span>&nbsp;<span class="ident" id="7708072">bigtest</span><span class="op" id="7708079">.</span><span class="ident" id="7708080">encoded</span><span class="op" id="7708087">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7708090">}</span><br>
<span class="lineno"></span><span class="op" id="7708092">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7708095">func</span>&nbsp;<span class="ident" id="7708100">TestDecode</span><span class="op" id="7708110">(</span><span class="ident" id="7708111">t</span>&nbsp;<span class="op" id="7708113">*</span><span class="ident" id="7708114">testing</span><span class="op" id="7708121">.</span><span class="ident" id="7708122">T</span><span class="op" id="7708123">)</span>&nbsp;<span class="op" id="7708125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7708128">for</span>&nbsp;<span class="ident" id="7708132">_</span><span class="op" id="7708133">,</span>&nbsp;<span class="ident" id="7708135">p</span>&nbsp;<span class="op" id="7708137">:=</span>&nbsp;<span class="keyword" id="7708140">range</span>&nbsp;<span class="ident" id="7708146">pairs</span>&nbsp;<span class="op" id="7708152">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7708156">dbuf</span>&nbsp;<span class="op" id="7708161">:=</span>&nbsp;<span class="builtinfunc" id="7708164">make</span><span class="op" id="7708168">(</span><span class="op" id="7708169">[</span><span class="op" id="7708170">]</span><span class="builtintype" id="7708171">byte</span><span class="op" id="7708175">,</span>&nbsp;<span class="ident" id="7708177">StdEncoding</span><span class="op" id="7708188">.</span><span class="ident" id="7708189">DecodedLen</span><span class="op" id="7708199">(</span><span class="builtinfunc" id="7708200">len</span><span class="op" id="7708203">(</span><span class="ident" id="7708204">p</span><span class="op" id="7708205">.</span><span class="ident" id="7708206">encoded</span><span class="op" id="7708213">)</span><span class="op" id="7708214">)</span><span class="op" id="7708215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7708219">count</span><span class="op" id="7708224">,</span>&nbsp;<span class="ident" id="7708226">end</span><span class="op" id="7708229">,</span>&nbsp;<span class="ident" id="7708231">err</span>&nbsp;<span class="op" id="7708235">:=</span>&nbsp;<span class="ident" id="7708238">StdEncoding</span><span class="op" id="7708249">.</span><span class="ident" id="7708250">decode</span><span class="op" id="7708256">(</span><span class="ident" id="7708257">dbuf</span><span class="op" id="7708261">,</span>&nbsp;<span class="op" id="7708263">[</span><span class="op" id="7708264">]</span><span class="builtintype" id="7708265">byte</span><span class="op" id="7708269">(</span><span class="ident" id="7708270">p</span><span class="op" id="7708271">.</span><span class="ident" id="7708272">encoded</span><span class="op" id="7708279">)</span><span class="op" id="7708280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7708284">testEqual</span><span class="op" id="7708293">(</span><span class="ident" id="7708294">t</span><span class="op" id="7708295">,</span>&nbsp;<span class="string" id="7708297">&#34;Decode(%q)&nbsp;=&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7708329">,</span>&nbsp;<span class="ident" id="7708331">p</span><span class="op" id="7708332">.</span><span class="ident" id="7708333">encoded</span><span class="op" id="7708340">,</span>&nbsp;<span class="ident" id="7708342">err</span><span class="op" id="7708345">,</span>&nbsp;<span class="builtintype" id="7708347">error</span><span class="op" id="7708352">(</span><span class="ident" id="7708353">nil</span><span class="op" id="7708356">)</span><span class="op" id="7708357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7708361">testEqual</span><span class="op" id="7708370">(</span><span class="ident" id="7708371">t</span><span class="op" id="7708372">,</span>&nbsp;<span class="string" id="7708374">&#34;Decode(%q)&nbsp;=&nbsp;length&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7708407">,</span>&nbsp;<span class="ident" id="7708409">p</span><span class="op" id="7708410">.</span><span class="ident" id="7708411">encoded</span><span class="op" id="7708418">,</span>&nbsp;<span class="ident" id="7708420">count</span><span class="op" id="7708425">,</span>&nbsp;<span class="builtinfunc" id="7708427">len</span><span class="op" id="7708430">(</span><span class="ident" id="7708431">p</span><span class="op" id="7708432">.</span><span class="ident" id="7708433">decoded</span><span class="op" id="7708440">)</span><span class="op" id="7708441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7708445">if</span>&nbsp;<span class="builtinfunc" id="7708448">len</span><span class="op" id="7708451">(</span><span class="ident" id="7708452">p</span><span class="op" id="7708453">.</span><span class="ident" id="7708454">encoded</span><span class="op" id="7708461">)</span>&nbsp;<span class="op" id="7708463">&gt;</span>&nbsp;<span class="num" id="7708465">0</span>&nbsp;<span class="op" id="7708467">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7708472">testEqual</span><span class="op" id="7708481">(</span><span class="ident" id="7708482">t</span><span class="op" id="7708483">,</span>&nbsp;<span class="string" id="7708485">&#34;Decode(%q)&nbsp;=&nbsp;end&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7708515">,</span>&nbsp;<span class="ident" id="7708517">p</span><span class="op" id="7708518">.</span><span class="ident" id="7708519">encoded</span><span class="op" id="7708526">,</span>&nbsp;<span class="ident" id="7708528">end</span><span class="op" id="7708531">,</span>&nbsp;<span class="op" id="7708533">(</span><span class="ident" id="7708534">p</span><span class="op" id="7708535">.</span><span class="ident" id="7708536">encoded</span><span class="op" id="7708543">[</span><span class="builtinfunc" id="7708544">len</span><span class="op" id="7708547">(</span><span class="ident" id="7708548">p</span><span class="op" id="7708549">.</span><span class="ident" id="7708550">encoded</span><span class="op" id="7708557">)</span><span class="op" id="7708558">-</span><span class="num" id="7708559">1</span><span class="op" id="7708560">]</span>&nbsp;<span class="op" id="7708562">==</span>&nbsp;<span class="string" id="7708565">&#39;=&#39;</span><span class="op" id="7708568">)</span><span class="op" id="7708569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7708573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7708577">testEqual</span><span class="op" id="7708586">(</span><span class="ident" id="7708587">t</span><span class="op" id="7708588">,</span>&nbsp;<span class="string" id="7708590">&#34;Decode(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7708616">,</span>&nbsp;<span class="ident" id="7708618">p</span><span class="op" id="7708619">.</span><span class="ident" id="7708620">encoded</span><span class="op" id="7708627">,</span>&nbsp;<span class="builtintype" id="7708629">string</span><span class="op" id="7708635">(</span><span class="ident" id="7708636">dbuf</span><span class="op" id="7708640">[</span><span class="num" id="7708641">0</span><span class="op" id="7708642">:</span><span class="ident" id="7708643">count</span><span class="op" id="7708648">]</span><span class="op" id="7708649">)</span><span class="op" id="7708650">,</span>&nbsp;<span class="ident" id="7708652">p</span><span class="op" id="7708653">.</span><span class="ident" id="7708654">decoded</span><span class="op" id="7708661">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7708666">dbuf</span><span class="op" id="7708670">,</span>&nbsp;<span class="ident" id="7708672">err</span>&nbsp;<span class="op" id="7708676">=</span>&nbsp;<span class="ident" id="7708678">StdEncoding</span><span class="op" id="7708689">.</span><span class="ident" id="7708690">DecodeString</span><span class="op" id="7708702">(</span><span class="ident" id="7708703">p</span><span class="op" id="7708704">.</span><span class="ident" id="7708705">encoded</span><span class="op" id="7708712">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7708716">testEqual</span><span class="op" id="7708725">(</span><span class="ident" id="7708726">t</span><span class="op" id="7708727">,</span>&nbsp;<span class="string" id="7708729">&#34;DecodeString(%q)&nbsp;=&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7708767">,</span>&nbsp;<span class="ident" id="7708769">p</span><span class="op" id="7708770">.</span><span class="ident" id="7708771">encoded</span><span class="op" id="7708778">,</span>&nbsp;<span class="ident" id="7708780">err</span><span class="op" id="7708783">,</span>&nbsp;<span class="builtintype" id="7708785">error</span><span class="op" id="7708790">(</span><span class="ident" id="7708791">nil</span><span class="op" id="7708794">)</span><span class="op" id="7708795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7708799">testEqual</span><span class="op" id="7708808">(</span><span class="ident" id="7708809">t</span><span class="op" id="7708810">,</span>&nbsp;<span class="string" id="7708812">&#34;DecodeString(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7708844">,</span>&nbsp;<span class="builtintype" id="7708846">string</span><span class="op" id="7708852">(</span><span class="ident" id="7708853">dbuf</span><span class="op" id="7708857">)</span><span class="op" id="7708858">,</span>&nbsp;<span class="ident" id="7708860">p</span><span class="op" id="7708861">.</span><span class="ident" id="7708862">decoded</span><span class="op" id="7708869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7708872">}</span><br>
<span class="lineno"></span><span class="op" id="7708874">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="7708877">func</span>&nbsp;<span class="ident" id="7708882">TestDecoder</span><span class="op" id="7708893">(</span><span class="ident" id="7708894">t</span>&nbsp;<span class="op" id="7708896">*</span><span class="ident" id="7708897">testing</span><span class="op" id="7708904">.</span><span class="ident" id="7708905">T</span><span class="op" id="7708906">)</span>&nbsp;<span class="op" id="7708908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7708911">for</span>&nbsp;<span class="ident" id="7708915">_</span><span class="op" id="7708916">,</span>&nbsp;<span class="ident" id="7708918">p</span>&nbsp;<span class="op" id="7708920">:=</span>&nbsp;<span class="keyword" id="7708923">range</span>&nbsp;<span class="ident" id="7708929">pairs</span>&nbsp;<span class="op" id="7708935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7708939">decoder</span>&nbsp;<span class="op" id="7708947">:=</span>&nbsp;<span class="ident" id="7708950">NewDecoder</span><span class="op" id="7708960">(</span><span class="ident" id="7708961">StdEncoding</span><span class="op" id="7708972">,</span>&nbsp;<span class="ident" id="7708974">strings</span><span class="op" id="7708981">.</span><span class="ident" id="7708982">NewReader</span><span class="op" id="7708991">(</span><span class="ident" id="7708992">p</span><span class="op" id="7708993">.</span><span class="ident" id="7708994">encoded</span><span class="op" id="7709001">)</span><span class="op" id="7709002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7709006">dbuf</span>&nbsp;<span class="op" id="7709011">:=</span>&nbsp;<span class="builtinfunc" id="7709014">make</span><span class="op" id="7709018">(</span><span class="op" id="7709019">[</span><span class="op" id="7709020">]</span><span class="builtintype" id="7709021">byte</span><span class="op" id="7709025">,</span>&nbsp;<span class="ident" id="7709027">StdEncoding</span><span class="op" id="7709038">.</span><span class="ident" id="7709039">DecodedLen</span><span class="op" id="7709049">(</span><span class="builtinfunc" id="7709050">len</span><span class="op" id="7709053">(</span><span class="ident" id="7709054">p</span><span class="op" id="7709055">.</span><span class="ident" id="7709056">encoded</span><span class="op" id="7709063">)</span><span class="op" id="7709064">)</span><span class="op" id="7709065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7709069">count</span><span class="op" id="7709074">,</span>&nbsp;<span class="ident" id="7709076">err</span>&nbsp;<span class="op" id="7709080">:=</span>&nbsp;<span class="ident" id="7709083">decoder</span><span class="op" id="7709090">.</span><span class="ident" id="7709091">Read</span><span class="op" id="7709095">(</span><span class="ident" id="7709096">dbuf</span><span class="op" id="7709100">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7709104">if</span>&nbsp;<span class="ident" id="7709107">err</span>&nbsp;<span class="op" id="7709111">!=</span>&nbsp;<span class="ident" id="7709114">nil</span>&nbsp;<span class="op" id="7709118">&amp;&amp;</span>&nbsp;<span class="ident" id="7709121">err</span>&nbsp;<span class="op" id="7709125">!=</span>&nbsp;<span class="ident" id="7709128">io</span><span class="op" id="7709130">.</span><span class="ident" id="7709131">EOF</span>&nbsp;<span class="op" id="7709135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7709140">t</span><span class="op" id="7709141">.</span><span class="ident" id="7709142">Fatal</span><span class="op" id="7709147">(</span><span class="string" id="7709148">&#34;Read&nbsp;failed&#34;</span><span class="op" id="7709161">,</span>&nbsp;<span class="ident" id="7709163">err</span><span class="op" id="7709166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7709170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7709174">testEqual</span><span class="op" id="7709183">(</span><span class="ident" id="7709184">t</span><span class="op" id="7709185">,</span>&nbsp;<span class="string" id="7709187">&#34;Read&nbsp;from&nbsp;%q&nbsp;=&nbsp;length&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7709222">,</span>&nbsp;<span class="ident" id="7709224">p</span><span class="op" id="7709225">.</span><span class="ident" id="7709226">encoded</span><span class="op" id="7709233">,</span>&nbsp;<span class="ident" id="7709235">count</span><span class="op" id="7709240">,</span>&nbsp;<span class="builtinfunc" id="7709242">len</span><span class="op" id="7709245">(</span><span class="ident" id="7709246">p</span><span class="op" id="7709247">.</span><span class="ident" id="7709248">decoded</span><span class="op" id="7709255">)</span><span class="op" id="7709256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7709260">testEqual</span><span class="op" id="7709269">(</span><span class="ident" id="7709270">t</span><span class="op" id="7709271">,</span>&nbsp;<span class="string" id="7709273">&#34;Decoding&nbsp;of&nbsp;%q&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7709303">,</span>&nbsp;<span class="ident" id="7709305">p</span><span class="op" id="7709306">.</span><span class="ident" id="7709307">encoded</span><span class="op" id="7709314">,</span>&nbsp;<span class="builtintype" id="7709316">string</span><span class="op" id="7709322">(</span><span class="ident" id="7709323">dbuf</span><span class="op" id="7709327">[</span><span class="num" id="7709328">0</span><span class="op" id="7709329">:</span><span class="ident" id="7709330">count</span><span class="op" id="7709335">]</span><span class="op" id="7709336">)</span><span class="op" id="7709337">,</span>&nbsp;<span class="ident" id="7709339">p</span><span class="op" id="7709340">.</span><span class="ident" id="7709341">decoded</span><span class="op" id="7709348">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7709352">if</span>&nbsp;<span class="ident" id="7709355">err</span>&nbsp;<span class="op" id="7709359">!=</span>&nbsp;<span class="ident" id="7709362">io</span><span class="op" id="7709364">.</span><span class="ident" id="7709365">EOF</span>&nbsp;<span class="op" id="7709369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7709374">count</span><span class="op" id="7709379">,</span>&nbsp;<span class="ident" id="7709381">err</span>&nbsp;<span class="op" id="7709385">=</span>&nbsp;<span class="ident" id="7709387">decoder</span><span class="op" id="7709394">.</span><span class="ident" id="7709395">Read</span><span class="op" id="7709399">(</span><span class="ident" id="7709400">dbuf</span><span class="op" id="7709404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7709408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7709412">testEqual</span><span class="op" id="7709421">(</span><span class="ident" id="7709422">t</span><span class="op" id="7709423">,</span>&nbsp;<span class="string" id="7709425">&#34;Read&nbsp;from&nbsp;%q&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7709453">,</span>&nbsp;<span class="ident" id="7709455">p</span><span class="op" id="7709456">.</span><span class="ident" id="7709457">encoded</span><span class="op" id="7709464">,</span>&nbsp;<span class="ident" id="7709466">err</span><span class="op" id="7709469">,</span>&nbsp;<span class="ident" id="7709471">io</span><span class="op" id="7709473">.</span><span class="ident" id="7709474">EOF</span><span class="op" id="7709477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7709480">}</span><br>
<span class="lineno">130</span><span class="op" id="7709482">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7709485">func</span>&nbsp;<span class="ident" id="7709490">TestDecoderBuffering</span><span class="op" id="7709510">(</span><span class="ident" id="7709511">t</span>&nbsp;<span class="op" id="7709513">*</span><span class="ident" id="7709514">testing</span><span class="op" id="7709521">.</span><span class="ident" id="7709522">T</span><span class="op" id="7709523">)</span>&nbsp;<span class="op" id="7709525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7709528">for</span>&nbsp;<span class="ident" id="7709532">bs</span>&nbsp;<span class="op" id="7709535">:=</span>&nbsp;<span class="num" id="7709538">1</span><span class="op" id="7709539">;</span>&nbsp;<span class="ident" id="7709541">bs</span>&nbsp;<span class="op" id="7709544">&lt;=</span>&nbsp;<span class="num" id="7709547">12</span><span class="op" id="7709549">;</span>&nbsp;<span class="ident" id="7709551">bs</span><span class="op" id="7709553">++</span>&nbsp;<span class="op" id="7709556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7709560">decoder</span>&nbsp;<span class="op" id="7709568">:=</span>&nbsp;<span class="ident" id="7709571">NewDecoder</span><span class="op" id="7709581">(</span><span class="ident" id="7709582">StdEncoding</span><span class="op" id="7709593">,</span>&nbsp;<span class="ident" id="7709595">strings</span><span class="op" id="7709602">.</span><span class="ident" id="7709603">NewReader</span><span class="op" id="7709612">(</span><span class="ident" id="7709613">bigtest</span><span class="op" id="7709620">.</span><span class="ident" id="7709621">encoded</span><span class="op" id="7709628">)</span><span class="op" id="7709629">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7709633">buf</span>&nbsp;<span class="op" id="7709637">:=</span>&nbsp;<span class="builtinfunc" id="7709640">make</span><span class="op" id="7709644">(</span><span class="op" id="7709645">[</span><span class="op" id="7709646">]</span><span class="builtintype" id="7709647">byte</span><span class="op" id="7709651">,</span>&nbsp;<span class="builtinfunc" id="7709653">len</span><span class="op" id="7709656">(</span><span class="ident" id="7709657">bigtest</span><span class="op" id="7709664">.</span><span class="ident" id="7709665">decoded</span><span class="op" id="7709672">)</span><span class="op" id="7709673">+</span><span class="num" id="7709674">12</span><span class="op" id="7709676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7709680">var</span>&nbsp;<span class="ident" id="7709684">total</span>&nbsp;<span class="builtintype" id="7709690">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7709696">for</span>&nbsp;<span class="ident" id="7709700">total</span>&nbsp;<span class="op" id="7709706">=</span>&nbsp;<span class="num" id="7709708">0</span><span class="op" id="7709709">;</span>&nbsp;<span class="ident" id="7709711">total</span>&nbsp;<span class="op" id="7709717">&lt;</span>&nbsp;<span class="builtinfunc" id="7709719">len</span><span class="op" id="7709722">(</span><span class="ident" id="7709723">bigtest</span><span class="op" id="7709730">.</span><span class="ident" id="7709731">decoded</span><span class="op" id="7709738">)</span><span class="op" id="7709739">;</span>&nbsp;<span class="op" id="7709741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7709746">n</span><span class="op" id="7709747">,</span>&nbsp;<span class="ident" id="7709749">err</span>&nbsp;<span class="op" id="7709753">:=</span>&nbsp;<span class="ident" id="7709756">decoder</span><span class="op" id="7709763">.</span><span class="ident" id="7709764">Read</span><span class="op" id="7709768">(</span><span class="ident" id="7709769">buf</span><span class="op" id="7709772">[</span><span class="ident" id="7709773">total</span>&nbsp;<span class="op" id="7709779">:</span>&nbsp;<span class="ident" id="7709781">total</span><span class="op" id="7709786">+</span><span class="ident" id="7709787">bs</span><span class="op" id="7709789">]</span><span class="op" id="7709790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7709795">testEqual</span><span class="op" id="7709804">(</span><span class="ident" id="7709805">t</span><span class="op" id="7709806">,</span>&nbsp;<span class="string" id="7709808">&#34;Read&nbsp;from&nbsp;%q&nbsp;at&nbsp;pos&nbsp;%d&nbsp;=&nbsp;%d,&nbsp;%v,&nbsp;want&nbsp;_,&nbsp;%v&#34;</span><span class="op" id="7709853">,</span>&nbsp;<span class="ident" id="7709855">bigtest</span><span class="op" id="7709862">.</span><span class="ident" id="7709863">encoded</span><span class="op" id="7709870">,</span>&nbsp;<span class="ident" id="7709872">total</span><span class="op" id="7709877">,</span>&nbsp;<span class="ident" id="7709879">n</span><span class="op" id="7709880">,</span>&nbsp;<span class="ident" id="7709882">err</span><span class="op" id="7709885">,</span>&nbsp;<span class="builtintype" id="7709887">error</span><span class="op" id="7709892">(</span><span class="ident" id="7709893">nil</span><span class="op" id="7709896">)</span><span class="op" id="7709897">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7709902">total</span>&nbsp;<span class="op" id="7709908">+=</span>&nbsp;<span class="ident" id="7709911">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7709915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7709919">testEqual</span><span class="op" id="7709928">(</span><span class="ident" id="7709929">t</span><span class="op" id="7709930">,</span>&nbsp;<span class="string" id="7709932">&#34;Decoding/%d&nbsp;of&nbsp;%q&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7709965">,</span>&nbsp;<span class="ident" id="7709967">bs</span><span class="op" id="7709969">,</span>&nbsp;<span class="ident" id="7709971">bigtest</span><span class="op" id="7709978">.</span><span class="ident" id="7709979">encoded</span><span class="op" id="7709986">,</span>&nbsp;<span class="builtintype" id="7709988">string</span><span class="op" id="7709994">(</span><span class="ident" id="7709995">buf</span><span class="op" id="7709998">[</span><span class="num" id="7709999">0</span><span class="op" id="7710000">:</span><span class="ident" id="7710001">total</span><span class="op" id="7710006">]</span><span class="op" id="7710007">)</span><span class="op" id="7710008">,</span>&nbsp;<span class="ident" id="7710010">bigtest</span><span class="op" id="7710017">.</span><span class="ident" id="7710018">decoded</span><span class="op" id="7710025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7710028">}</span><br>
<span class="lineno"></span><span class="op" id="7710030">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="keyword" id="7710033">func</span>&nbsp;<span class="ident" id="7710038">TestDecodeCorrupt</span><span class="op" id="7710055">(</span><span class="ident" id="7710056">t</span>&nbsp;<span class="op" id="7710058">*</span><span class="ident" id="7710059">testing</span><span class="op" id="7710066">.</span><span class="ident" id="7710067">T</span><span class="op" id="7710068">)</span>&nbsp;<span class="op" id="7710070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7710073">testCases</span>&nbsp;<span class="op" id="7710083">:=</span>&nbsp;<span class="op" id="7710086">[</span><span class="op" id="7710087">]</span><span class="keyword" id="7710088">struct</span>&nbsp;<span class="op" id="7710095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7710099">input</span>&nbsp;&nbsp;<span class="builtintype" id="7710106">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7710115">offset</span>&nbsp;<span class="builtintype" id="7710122">int</span>&nbsp;<span class="comment" id="7710126">//&nbsp;-1&nbsp;means&nbsp;no&nbsp;corruption.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7710154">}</span><span class="op" id="7710155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7710159">{</span><span class="string" id="7710160">&#34;&#34;</span><span class="op" id="7710162">,</span>&nbsp;<span class="op" id="7710164">-</span><span class="num" id="7710165">1</span><span class="op" id="7710166">}</span><span class="op" id="7710167">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7710171">{</span><span class="string" id="7710172">&#34;!!!!&#34;</span><span class="op" id="7710178">,</span>&nbsp;<span class="num" id="7710180">0</span><span class="op" id="7710181">}</span><span class="op" id="7710182">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7710186">{</span><span class="string" id="7710187">&#34;====&#34;</span><span class="op" id="7710193">,</span>&nbsp;<span class="num" id="7710195">0</span><span class="op" id="7710196">}</span><span class="op" id="7710197">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7710201">{</span><span class="string" id="7710202">&#34;x===&#34;</span><span class="op" id="7710208">,</span>&nbsp;<span class="num" id="7710210">1</span><span class="op" id="7710211">}</span><span class="op" id="7710212">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7710216">{</span><span class="string" id="7710217">&#34;=AAA&#34;</span><span class="op" id="7710223">,</span>&nbsp;<span class="num" id="7710225">0</span><span class="op" id="7710226">}</span><span class="op" id="7710227">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7710231">{</span><span class="string" id="7710232">&#34;A=AA&#34;</span><span class="op" id="7710238">,</span>&nbsp;<span class="num" id="7710240">1</span><span class="op" id="7710241">}</span><span class="op" id="7710242">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7710246">{</span><span class="string" id="7710247">&#34;AA=A&#34;</span><span class="op" id="7710253">,</span>&nbsp;<span class="num" id="7710255">2</span><span class="op" id="7710256">}</span><span class="op" id="7710257">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7710261">{</span><span class="string" id="7710262">&#34;AA==A&#34;</span><span class="op" id="7710269">,</span>&nbsp;<span class="num" id="7710271">4</span><span class="op" id="7710272">}</span><span class="op" id="7710273">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7710277">{</span><span class="string" id="7710278">&#34;AAA=AAAA&#34;</span><span class="op" id="7710288">,</span>&nbsp;<span class="num" id="7710290">4</span><span class="op" id="7710291">}</span><span class="op" id="7710292">,</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7710296">{</span><span class="string" id="7710297">&#34;AAAAA&#34;</span><span class="op" id="7710304">,</span>&nbsp;<span class="num" id="7710306">4</span><span class="op" id="7710307">}</span><span class="op" id="7710308">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7710312">{</span><span class="string" id="7710313">&#34;AAAAAA&#34;</span><span class="op" id="7710321">,</span>&nbsp;<span class="num" id="7710323">4</span><span class="op" id="7710324">}</span><span class="op" id="7710325">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7710329">{</span><span class="string" id="7710330">&#34;A=&#34;</span><span class="op" id="7710334">,</span>&nbsp;<span class="num" id="7710336">1</span><span class="op" id="7710337">}</span><span class="op" id="7710338">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7710342">{</span><span class="string" id="7710343">&#34;A==&#34;</span><span class="op" id="7710348">,</span>&nbsp;<span class="num" id="7710350">1</span><span class="op" id="7710351">}</span><span class="op" id="7710352">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7710356">{</span><span class="string" id="7710357">&#34;AA=&#34;</span><span class="op" id="7710362">,</span>&nbsp;<span class="num" id="7710364">3</span><span class="op" id="7710365">}</span><span class="op" id="7710366">,</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7710370">{</span><span class="string" id="7710371">&#34;AA==&#34;</span><span class="op" id="7710377">,</span>&nbsp;<span class="op" id="7710379">-</span><span class="num" id="7710380">1</span><span class="op" id="7710381">}</span><span class="op" id="7710382">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7710386">{</span><span class="string" id="7710387">&#34;AAA=&#34;</span><span class="op" id="7710393">,</span>&nbsp;<span class="op" id="7710395">-</span><span class="num" id="7710396">1</span><span class="op" id="7710397">}</span><span class="op" id="7710398">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7710402">{</span><span class="string" id="7710403">&#34;AAAA&#34;</span><span class="op" id="7710409">,</span>&nbsp;<span class="op" id="7710411">-</span><span class="num" id="7710412">1</span><span class="op" id="7710413">}</span><span class="op" id="7710414">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7710418">{</span><span class="string" id="7710419">&#34;AAAAAA=&#34;</span><span class="op" id="7710428">,</span>&nbsp;<span class="num" id="7710430">7</span><span class="op" id="7710431">}</span><span class="op" id="7710432">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7710436">{</span><span class="string" id="7710437">&#34;YWJjZA=====&#34;</span><span class="op" id="7710450">,</span>&nbsp;<span class="num" id="7710452">8</span><span class="op" id="7710453">}</span><span class="op" id="7710454">,</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7710457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7710460">for</span>&nbsp;<span class="ident" id="7710464">_</span><span class="op" id="7710465">,</span>&nbsp;<span class="ident" id="7710467">tc</span>&nbsp;<span class="op" id="7710470">:=</span>&nbsp;<span class="keyword" id="7710473">range</span>&nbsp;<span class="ident" id="7710479">testCases</span>&nbsp;<span class="op" id="7710489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7710493">dbuf</span>&nbsp;<span class="op" id="7710498">:=</span>&nbsp;<span class="builtinfunc" id="7710501">make</span><span class="op" id="7710505">(</span><span class="op" id="7710506">[</span><span class="op" id="7710507">]</span><span class="builtintype" id="7710508">byte</span><span class="op" id="7710512">,</span>&nbsp;<span class="ident" id="7710514">StdEncoding</span><span class="op" id="7710525">.</span><span class="ident" id="7710526">DecodedLen</span><span class="op" id="7710536">(</span><span class="builtinfunc" id="7710537">len</span><span class="op" id="7710540">(</span><span class="ident" id="7710541">tc</span><span class="op" id="7710543">.</span><span class="ident" id="7710544">input</span><span class="op" id="7710549">)</span><span class="op" id="7710550">)</span><span class="op" id="7710551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7710555">_</span><span class="op" id="7710556">,</span>&nbsp;<span class="ident" id="7710558">err</span>&nbsp;<span class="op" id="7710562">:=</span>&nbsp;<span class="ident" id="7710565">StdEncoding</span><span class="op" id="7710576">.</span><span class="ident" id="7710577">Decode</span><span class="op" id="7710583">(</span><span class="ident" id="7710584">dbuf</span><span class="op" id="7710588">,</span>&nbsp;<span class="op" id="7710590">[</span><span class="op" id="7710591">]</span><span class="builtintype" id="7710592">byte</span><span class="op" id="7710596">(</span><span class="ident" id="7710597">tc</span><span class="op" id="7710599">.</span><span class="ident" id="7710600">input</span><span class="op" id="7710605">)</span><span class="op" id="7710606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7710610">if</span>&nbsp;<span class="ident" id="7710613">tc</span><span class="op" id="7710615">.</span><span class="ident" id="7710616">offset</span>&nbsp;<span class="op" id="7710623">==</span>&nbsp;<span class="op" id="7710626">-</span><span class="num" id="7710627">1</span>&nbsp;<span class="op" id="7710629">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7710634">if</span>&nbsp;<span class="ident" id="7710637">err</span>&nbsp;<span class="op" id="7710641">!=</span>&nbsp;<span class="ident" id="7710644">nil</span>&nbsp;<span class="op" id="7710648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7710654">t</span><span class="op" id="7710655">.</span><span class="ident" id="7710656">Error</span><span class="op" id="7710661">(</span><span class="string" id="7710662">&#34;Decoder&nbsp;wrongly&nbsp;detected&nbsp;coruption&nbsp;in&#34;</span><span class="op" id="7710701">,</span>&nbsp;<span class="ident" id="7710703">tc</span><span class="op" id="7710705">.</span><span class="ident" id="7710706">input</span><span class="op" id="7710711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7710716">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7710721">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7710732">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7710736">switch</span>&nbsp;<span class="ident" id="7710743">err</span>&nbsp;<span class="op" id="7710747">:=</span>&nbsp;<span class="ident" id="7710750">err</span><span class="op" id="7710753">.</span><span class="op" id="7710754">(</span><span class="keyword" id="7710755">type</span><span class="op" id="7710759">)</span>&nbsp;<span class="op" id="7710761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7710765">case</span>&nbsp;<span class="ident" id="7710770">CorruptInputError</span><span class="op" id="7710787">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7710792">testEqual</span><span class="op" id="7710801">(</span><span class="ident" id="7710802">t</span><span class="op" id="7710803">,</span>&nbsp;<span class="string" id="7710805">&#34;Corruption&nbsp;in&nbsp;%q&nbsp;at&nbsp;offset&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7710845">,</span>&nbsp;<span class="ident" id="7710847">tc</span><span class="op" id="7710849">.</span><span class="ident" id="7710850">input</span><span class="op" id="7710855">,</span>&nbsp;<span class="builtintype" id="7710857">int</span><span class="op" id="7710860">(</span><span class="ident" id="7710861">err</span><span class="op" id="7710864">)</span><span class="op" id="7710865">,</span>&nbsp;<span class="ident" id="7710867">tc</span><span class="op" id="7710869">.</span><span class="ident" id="7710870">offset</span><span class="op" id="7710876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7710880">default</span><span class="op" id="7710887">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7710892">t</span><span class="op" id="7710893">.</span><span class="ident" id="7710894">Error</span><span class="op" id="7710899">(</span><span class="string" id="7710900">&#34;Decoder&nbsp;failed&nbsp;to&nbsp;detect&nbsp;corruption&nbsp;in&#34;</span><span class="op" id="7710940">,</span>&nbsp;<span class="ident" id="7710942">tc</span><span class="op" id="7710944">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7710948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7710951">}</span><br>
<span class="lineno"></span><span class="op" id="7710953">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7710956">func</span>&nbsp;<span class="ident" id="7710961">TestBig</span><span class="op" id="7710968">(</span><span class="ident" id="7710969">t</span>&nbsp;<span class="op" id="7710971">*</span><span class="ident" id="7710972">testing</span><span class="op" id="7710979">.</span><span class="ident" id="7710980">T</span><span class="op" id="7710981">)</span>&nbsp;<span class="op" id="7710983">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7710986">n</span>&nbsp;<span class="op" id="7710988">:=</span>&nbsp;<span class="num" id="7710991">3</span><span class="op" id="7710992">*</span><span class="num" id="7710993">1000</span>&nbsp;<span class="op" id="7710998">+</span>&nbsp;<span class="num" id="7711000">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7711003">raw</span>&nbsp;<span class="op" id="7711007">:=</span>&nbsp;<span class="builtinfunc" id="7711010">make</span><span class="op" id="7711014">(</span><span class="op" id="7711015">[</span><span class="op" id="7711016">]</span><span class="builtintype" id="7711017">byte</span><span class="op" id="7711021">,</span>&nbsp;<span class="ident" id="7711023">n</span><span class="op" id="7711024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7711027">const</span>&nbsp;<span class="ident" id="7711033">alpha</span>&nbsp;<span class="op" id="7711039">=</span>&nbsp;<span class="string" id="7711041">&#34;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7711107">for</span>&nbsp;<span class="ident" id="7711111">i</span>&nbsp;<span class="op" id="7711113">:=</span>&nbsp;<span class="num" id="7711116">0</span><span class="op" id="7711117">;</span>&nbsp;<span class="ident" id="7711119">i</span>&nbsp;<span class="op" id="7711121">&lt;</span>&nbsp;<span class="ident" id="7711123">n</span><span class="op" id="7711124">;</span>&nbsp;<span class="ident" id="7711126">i</span><span class="op" id="7711127">++</span>&nbsp;<span class="op" id="7711130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7711134">raw</span><span class="op" id="7711137">[</span><span class="ident" id="7711138">i</span><span class="op" id="7711139">]</span>&nbsp;<span class="op" id="7711141">=</span>&nbsp;<span class="ident" id="7711143">alpha</span><span class="op" id="7711148">[</span><span class="ident" id="7711149">i</span><span class="op" id="7711150">%</span><span class="builtinfunc" id="7711151">len</span><span class="op" id="7711154">(</span><span class="ident" id="7711155">alpha</span><span class="op" id="7711160">)</span><span class="op" id="7711161">]</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7711164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7711167">encoded</span>&nbsp;<span class="op" id="7711175">:=</span>&nbsp;<span class="builtinfunc" id="7711178">new</span><span class="op" id="7711181">(</span><span class="ident" id="7711182">bytes</span><span class="op" id="7711187">.</span><span class="ident" id="7711188">Buffer</span><span class="op" id="7711194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7711197">w</span>&nbsp;<span class="op" id="7711199">:=</span>&nbsp;<span class="ident" id="7711202">NewEncoder</span><span class="op" id="7711212">(</span><span class="ident" id="7711213">StdEncoding</span><span class="op" id="7711224">,</span>&nbsp;<span class="ident" id="7711226">encoded</span><span class="op" id="7711233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7711236">nn</span><span class="op" id="7711238">,</span>&nbsp;<span class="ident" id="7711240">err</span>&nbsp;<span class="op" id="7711244">:=</span>&nbsp;<span class="ident" id="7711247">w</span><span class="op" id="7711248">.</span><span class="ident" id="7711249">Write</span><span class="op" id="7711254">(</span><span class="ident" id="7711255">raw</span><span class="op" id="7711258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7711261">if</span>&nbsp;<span class="ident" id="7711264">nn</span>&nbsp;<span class="op" id="7711267">!=</span>&nbsp;<span class="ident" id="7711270">n</span>&nbsp;<span class="op" id="7711272">||</span>&nbsp;<span class="ident" id="7711275">err</span>&nbsp;<span class="op" id="7711279">!=</span>&nbsp;<span class="ident" id="7711282">nil</span>&nbsp;<span class="op" id="7711286">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7711290">t</span><span class="op" id="7711291">.</span><span class="ident" id="7711292">Fatalf</span><span class="op" id="7711298">(</span><span class="string" id="7711299">&#34;Encoder.Write(raw)&nbsp;=&nbsp;%d,&nbsp;%v&nbsp;want&nbsp;%d,&nbsp;nil&#34;</span><span class="op" id="7711341">,</span>&nbsp;<span class="ident" id="7711343">nn</span><span class="op" id="7711345">,</span>&nbsp;<span class="ident" id="7711347">err</span><span class="op" id="7711350">,</span>&nbsp;<span class="ident" id="7711352">n</span><span class="op" id="7711353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7711356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7711359">err</span>&nbsp;<span class="op" id="7711363">=</span>&nbsp;<span class="ident" id="7711365">w</span><span class="op" id="7711366">.</span><span class="ident" id="7711367">Close</span><span class="op" id="7711372">(</span><span class="op" id="7711373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7711376">if</span>&nbsp;<span class="ident" id="7711379">err</span>&nbsp;<span class="op" id="7711383">!=</span>&nbsp;<span class="ident" id="7711386">nil</span>&nbsp;<span class="op" id="7711390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7711394">t</span><span class="op" id="7711395">.</span><span class="ident" id="7711396">Fatalf</span><span class="op" id="7711402">(</span><span class="string" id="7711403">&#34;Encoder.Close()&nbsp;=&nbsp;%v&nbsp;want&nbsp;nil&#34;</span><span class="op" id="7711434">,</span>&nbsp;<span class="ident" id="7711436">err</span><span class="op" id="7711439">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7711442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7711445">decoded</span><span class="op" id="7711452">,</span>&nbsp;<span class="ident" id="7711454">err</span>&nbsp;<span class="op" id="7711458">:=</span>&nbsp;<span class="ident" id="7711461">ioutil</span><span class="op" id="7711467">.</span><span class="ident" id="7711468">ReadAll</span><span class="op" id="7711475">(</span><span class="ident" id="7711476">NewDecoder</span><span class="op" id="7711486">(</span><span class="ident" id="7711487">StdEncoding</span><span class="op" id="7711498">,</span>&nbsp;<span class="ident" id="7711500">encoded</span><span class="op" id="7711507">)</span><span class="op" id="7711508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7711511">if</span>&nbsp;<span class="ident" id="7711514">err</span>&nbsp;<span class="op" id="7711518">!=</span>&nbsp;<span class="ident" id="7711521">nil</span>&nbsp;<span class="op" id="7711525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7711529">t</span><span class="op" id="7711530">.</span><span class="ident" id="7711531">Fatalf</span><span class="op" id="7711537">(</span><span class="string" id="7711538">&#34;ioutil.ReadAll(NewDecoder(...)):&nbsp;%v&#34;</span><span class="op" id="7711575">,</span>&nbsp;<span class="ident" id="7711577">err</span><span class="op" id="7711580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7711583">}</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7711587">if</span>&nbsp;<span class="op" id="7711590">!</span><span class="ident" id="7711591">bytes</span><span class="op" id="7711596">.</span><span class="ident" id="7711597">Equal</span><span class="op" id="7711602">(</span><span class="ident" id="7711603">raw</span><span class="op" id="7711606">,</span>&nbsp;<span class="ident" id="7711608">decoded</span><span class="op" id="7711615">)</span>&nbsp;<span class="op" id="7711617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7711621">var</span>&nbsp;<span class="ident" id="7711625">i</span>&nbsp;<span class="builtintype" id="7711627">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7711633">for</span>&nbsp;<span class="ident" id="7711637">i</span>&nbsp;<span class="op" id="7711639">=</span>&nbsp;<span class="num" id="7711641">0</span><span class="op" id="7711642">;</span>&nbsp;<span class="ident" id="7711644">i</span>&nbsp;<span class="op" id="7711646">&lt;</span>&nbsp;<span class="builtinfunc" id="7711648">len</span><span class="op" id="7711651">(</span><span class="ident" id="7711652">decoded</span><span class="op" id="7711659">)</span>&nbsp;<span class="op" id="7711661">&amp;&amp;</span>&nbsp;<span class="ident" id="7711664">i</span>&nbsp;<span class="op" id="7711666">&lt;</span>&nbsp;<span class="builtinfunc" id="7711668">len</span><span class="op" id="7711671">(</span><span class="ident" id="7711672">raw</span><span class="op" id="7711675">)</span><span class="op" id="7711676">;</span>&nbsp;<span class="ident" id="7711678">i</span><span class="op" id="7711679">++</span>&nbsp;<span class="op" id="7711682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7711687">if</span>&nbsp;<span class="ident" id="7711690">decoded</span><span class="op" id="7711697">[</span><span class="ident" id="7711698">i</span><span class="op" id="7711699">]</span>&nbsp;<span class="op" id="7711701">!=</span>&nbsp;<span class="ident" id="7711704">raw</span><span class="op" id="7711707">[</span><span class="ident" id="7711708">i</span><span class="op" id="7711709">]</span>&nbsp;<span class="op" id="7711711">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7711717">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7711726">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7711730">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7711734">t</span><span class="op" id="7711735">.</span><span class="ident" id="7711736">Errorf</span><span class="op" id="7711742">(</span><span class="string" id="7711743">&#34;Decode(Encode(%d-byte&nbsp;string))&nbsp;failed&nbsp;at&nbsp;offset&nbsp;%d&#34;</span><span class="op" id="7711795">,</span>&nbsp;<span class="ident" id="7711797">n</span><span class="op" id="7711798">,</span>&nbsp;<span class="ident" id="7711800">i</span><span class="op" id="7711801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7711804">}</span><br>
<span class="lineno">220</span><span class="op" id="7711806">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7711809">func</span>&nbsp;<span class="ident" id="7711814">TestNewLineCharacters</span><span class="op" id="7711835">(</span><span class="ident" id="7711836">t</span>&nbsp;<span class="op" id="7711838">*</span><span class="ident" id="7711839">testing</span><span class="op" id="7711846">.</span><span class="ident" id="7711847">T</span><span class="op" id="7711848">)</span>&nbsp;<span class="op" id="7711850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7711853">//&nbsp;Each&nbsp;of&nbsp;these&nbsp;should&nbsp;decode&nbsp;to&nbsp;the&nbsp;string&nbsp;&#34;sure&#34;,&nbsp;without&nbsp;errors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7711923">const</span>&nbsp;<span class="ident" id="7711929">expected</span>&nbsp;<span class="op" id="7711938">=</span>&nbsp;<span class="string" id="7711940">&#34;sure&#34;</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7711948">examples</span>&nbsp;<span class="op" id="7711957">:=</span>&nbsp;<span class="op" id="7711960">[</span><span class="op" id="7711961">]</span><span class="builtintype" id="7711962">string</span><span class="op" id="7711968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7711972">&#34;c3VyZQ==&#34;</span><span class="op" id="7711982">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7711986">&#34;c3VyZQ==\r&#34;</span><span class="op" id="7711998">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7712002">&#34;c3VyZQ==\n&#34;</span><span class="op" id="7712014">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7712018">&#34;c3VyZQ==\r\n&#34;</span><span class="op" id="7712032">,</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7712036">&#34;c3VyZ\r\nQ==&#34;</span><span class="op" id="7712050">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7712054">&#34;c3V\ryZ\nQ==&#34;</span><span class="op" id="7712068">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7712072">&#34;c3V\nyZ\rQ==&#34;</span><span class="op" id="7712086">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7712090">&#34;c3VyZ\nQ==&#34;</span><span class="op" id="7712102">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7712106">&#34;c3VyZQ\n==&#34;</span><span class="op" id="7712118">,</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7712122">&#34;c3VyZQ=\n=&#34;</span><span class="op" id="7712134">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7712138">&#34;c3VyZQ=\r\n\r\n=&#34;</span><span class="op" id="7712156">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7712159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7712162">for</span>&nbsp;<span class="ident" id="7712166">_</span><span class="op" id="7712167">,</span>&nbsp;<span class="ident" id="7712169">e</span>&nbsp;<span class="op" id="7712171">:=</span>&nbsp;<span class="keyword" id="7712174">range</span>&nbsp;<span class="ident" id="7712180">examples</span>&nbsp;<span class="op" id="7712189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7712193">buf</span><span class="op" id="7712196">,</span>&nbsp;<span class="ident" id="7712198">err</span>&nbsp;<span class="op" id="7712202">:=</span>&nbsp;<span class="ident" id="7712205">StdEncoding</span><span class="op" id="7712216">.</span><span class="ident" id="7712217">DecodeString</span><span class="op" id="7712229">(</span><span class="ident" id="7712230">e</span><span class="op" id="7712231">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7712235">if</span>&nbsp;<span class="ident" id="7712238">err</span>&nbsp;<span class="op" id="7712242">!=</span>&nbsp;<span class="ident" id="7712245">nil</span>&nbsp;<span class="op" id="7712249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7712254">t</span><span class="op" id="7712255">.</span><span class="ident" id="7712256">Errorf</span><span class="op" id="7712262">(</span><span class="string" id="7712263">&#34;Decode(%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7712286">,</span>&nbsp;<span class="ident" id="7712288">e</span><span class="op" id="7712289">,</span>&nbsp;<span class="ident" id="7712291">err</span><span class="op" id="7712294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7712299">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7712310">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7712314">if</span>&nbsp;<span class="ident" id="7712317">s</span>&nbsp;<span class="op" id="7712319">:=</span>&nbsp;<span class="builtintype" id="7712322">string</span><span class="op" id="7712328">(</span><span class="ident" id="7712329">buf</span><span class="op" id="7712332">)</span><span class="op" id="7712333">;</span>&nbsp;<span class="ident" id="7712335">s</span>&nbsp;<span class="op" id="7712337">!=</span>&nbsp;<span class="ident" id="7712340">expected</span>&nbsp;<span class="op" id="7712349">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7712354">t</span><span class="op" id="7712355">.</span><span class="ident" id="7712356">Errorf</span><span class="op" id="7712362">(</span><span class="string" id="7712363">&#34;Decode(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7712389">,</span>&nbsp;<span class="ident" id="7712391">e</span><span class="op" id="7712392">,</span>&nbsp;<span class="ident" id="7712394">s</span><span class="op" id="7712395">,</span>&nbsp;<span class="ident" id="7712397">expected</span><span class="op" id="7712405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7712409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7712412">}</span><br>
<span class="lineno"></span><span class="op" id="7712414">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="keyword" id="7712417">type</span>&nbsp;<span class="ident" id="7712422">nextRead</span>&nbsp;<span class="keyword" id="7712431">struct</span>&nbsp;<span class="op" id="7712438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7712441">n</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7712445">int</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="7712451">//&nbsp;bytes&nbsp;to&nbsp;return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7712471">err</span>&nbsp;<span class="builtintype" id="7712475">error</span>&nbsp;<span class="comment" id="7712481">//&nbsp;error&nbsp;to&nbsp;return</span><br>
<span class="lineno"></span><span class="op" id="7712500">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="comment" id="7712503">//&nbsp;faultInjectReader&nbsp;returns&nbsp;data&nbsp;from&nbsp;source,&nbsp;rate-limited</span><br>
<span class="lineno"></span><span class="comment" id="7712563">//&nbsp;and&nbsp;with&nbsp;the&nbsp;errors&nbsp;as&nbsp;written&nbsp;to&nbsp;nextc.</span><br>
<span class="lineno"></span><span class="keyword" id="7712607">type</span>&nbsp;<span class="ident" id="7712612">faultInjectReader</span>&nbsp;<span class="keyword" id="7712630">struct</span>&nbsp;<span class="op" id="7712637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7712640">source</span>&nbsp;<span class="builtintype" id="7712647">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7712655">nextc</span>&nbsp;&nbsp;<span class="op" id="7712662">&lt;-</span><span class="keyword" id="7712664">chan</span>&nbsp;<span class="ident" id="7712669">nextRead</span><br>
<span class="lineno">260</span><span class="op" id="7712678">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7712681">func</span>&nbsp;<span class="op" id="7712686">(</span><span class="ident" id="7712687">r</span>&nbsp;<span class="op" id="7712689">*</span><span class="ident" id="7712690">faultInjectReader</span><span class="op" id="7712707">)</span>&nbsp;<span class="ident" id="7712709">Read</span><span class="op" id="7712713">(</span><span class="ident" id="7712714">p</span>&nbsp;<span class="op" id="7712716">[</span><span class="op" id="7712717">]</span><span class="builtintype" id="7712718">byte</span><span class="op" id="7712722">)</span>&nbsp;<span class="op" id="7712724">(</span><span class="builtintype" id="7712725">int</span><span class="op" id="7712728">,</span>&nbsp;<span class="builtintype" id="7712730">error</span><span class="op" id="7712735">)</span>&nbsp;<span class="op" id="7712737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7712740">nr</span>&nbsp;<span class="op" id="7712743">:=</span>&nbsp;<span class="op" id="7712746">&lt;-</span><span class="ident" id="7712748">r</span><span class="op" id="7712749">.</span><span class="ident" id="7712750">nextc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7712757">if</span>&nbsp;<span class="builtinfunc" id="7712760">len</span><span class="op" id="7712763">(</span><span class="ident" id="7712764">p</span><span class="op" id="7712765">)</span>&nbsp;<span class="op" id="7712767">&gt;</span>&nbsp;<span class="ident" id="7712769">nr</span><span class="op" id="7712771">.</span><span class="ident" id="7712772">n</span>&nbsp;<span class="op" id="7712774">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7712778">p</span>&nbsp;<span class="op" id="7712780">=</span>&nbsp;<span class="ident" id="7712782">p</span><span class="op" id="7712783">[</span><span class="op" id="7712784">:</span><span class="ident" id="7712785">nr</span><span class="op" id="7712787">.</span><span class="ident" id="7712788">n</span><span class="op" id="7712789">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7712792">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7712795">n</span>&nbsp;<span class="op" id="7712797">:=</span>&nbsp;<span class="builtinfunc" id="7712800">copy</span><span class="op" id="7712804">(</span><span class="ident" id="7712805">p</span><span class="op" id="7712806">,</span>&nbsp;<span class="ident" id="7712808">r</span><span class="op" id="7712809">.</span><span class="ident" id="7712810">source</span><span class="op" id="7712816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7712819">r</span><span class="op" id="7712820">.</span><span class="ident" id="7712821">source</span>&nbsp;<span class="op" id="7712828">=</span>&nbsp;<span class="ident" id="7712830">r</span><span class="op" id="7712831">.</span><span class="ident" id="7712832">source</span><span class="op" id="7712838">[</span><span class="ident" id="7712839">n</span><span class="op" id="7712840">:</span><span class="op" id="7712841">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7712844">return</span>&nbsp;<span class="ident" id="7712851">n</span><span class="op" id="7712852">,</span>&nbsp;<span class="ident" id="7712854">nr</span><span class="op" id="7712856">.</span><span class="ident" id="7712857">err</span><br>
<span class="lineno">270</span><span class="op" id="7712861">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7712864">//&nbsp;tests&nbsp;that&nbsp;we&nbsp;don&#39;t&nbsp;ignore&nbsp;errors&nbsp;from&nbsp;our&nbsp;underlying&nbsp;reader</span><br>
<span class="lineno"></span><span class="keyword" id="7712928">func</span>&nbsp;<span class="ident" id="7712933">TestDecoderIssue3577</span><span class="op" id="7712953">(</span><span class="ident" id="7712954">t</span>&nbsp;<span class="op" id="7712956">*</span><span class="ident" id="7712957">testing</span><span class="op" id="7712964">.</span><span class="ident" id="7712965">T</span><span class="op" id="7712966">)</span>&nbsp;<span class="op" id="7712968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7712971">next</span>&nbsp;<span class="op" id="7712976">:=</span>&nbsp;<span class="builtinfunc" id="7712979">make</span><span class="op" id="7712983">(</span><span class="keyword" id="7712984">chan</span>&nbsp;<span class="ident" id="7712989">nextRead</span><span class="op" id="7712997">,</span>&nbsp;<span class="num" id="7712999">10</span><span class="op" id="7713001">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7713004">wantErr</span>&nbsp;<span class="op" id="7713012">:=</span>&nbsp;<span class="ident" id="7713015">errors</span><span class="op" id="7713021">.</span><span class="ident" id="7713022">New</span><span class="op" id="7713025">(</span><span class="string" id="7713026">&#34;my&nbsp;error&#34;</span><span class="op" id="7713036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7713039">next</span>&nbsp;<span class="op" id="7713044">&lt;-</span>&nbsp;<span class="ident" id="7713047">nextRead</span><span class="op" id="7713055">{</span><span class="num" id="7713056">5</span><span class="op" id="7713057">,</span>&nbsp;<span class="ident" id="7713059">nil</span><span class="op" id="7713062">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7713065">next</span>&nbsp;<span class="op" id="7713070">&lt;-</span>&nbsp;<span class="ident" id="7713073">nextRead</span><span class="op" id="7713081">{</span><span class="num" id="7713082">10</span><span class="op" id="7713084">,</span>&nbsp;<span class="ident" id="7713086">wantErr</span><span class="op" id="7713093">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7713096">next</span>&nbsp;<span class="op" id="7713101">&lt;-</span>&nbsp;<span class="ident" id="7713104">nextRead</span><span class="op" id="7713112">{</span><span class="num" id="7713113">0</span><span class="op" id="7713114">,</span>&nbsp;<span class="ident" id="7713116">wantErr</span><span class="op" id="7713123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7713126">d</span>&nbsp;<span class="op" id="7713128">:=</span>&nbsp;<span class="ident" id="7713131">NewDecoder</span><span class="op" id="7713141">(</span><span class="ident" id="7713142">StdEncoding</span><span class="op" id="7713153">,</span>&nbsp;<span class="op" id="7713155">&amp;</span><span class="ident" id="7713156">faultInjectReader</span><span class="op" id="7713173">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7713177">source</span><span class="op" id="7713183">:</span>&nbsp;<span class="string" id="7713185">&#34;VHdhcyBicmlsbGlnLCBhbmQgdGhlIHNsaXRoeSB0b3Zlcw==&#34;</span><span class="op" id="7713235">,</span>&nbsp;<span class="comment" id="7713237">//&nbsp;twas&nbsp;brillig...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7713258">nextc</span><span class="op" id="7713263">:</span>&nbsp;&nbsp;<span class="ident" id="7713266">next</span><span class="op" id="7713270">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7713273">}</span><span class="op" id="7713274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7713277">errc</span>&nbsp;<span class="op" id="7713282">:=</span>&nbsp;<span class="builtinfunc" id="7713285">make</span><span class="op" id="7713289">(</span><span class="keyword" id="7713290">chan</span>&nbsp;<span class="builtintype" id="7713295">error</span><span class="op" id="7713300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7713303">go</span>&nbsp;<span class="keyword" id="7713306">func</span><span class="op" id="7713310">(</span><span class="op" id="7713311">)</span>&nbsp;<span class="op" id="7713313">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7713317">_</span><span class="op" id="7713318">,</span>&nbsp;<span class="ident" id="7713320">err</span>&nbsp;<span class="op" id="7713324">:=</span>&nbsp;<span class="ident" id="7713327">ioutil</span><span class="op" id="7713333">.</span><span class="ident" id="7713334">ReadAll</span><span class="op" id="7713341">(</span><span class="ident" id="7713342">d</span><span class="op" id="7713343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7713347">errc</span>&nbsp;<span class="op" id="7713352">&lt;-</span>&nbsp;<span class="ident" id="7713355">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7713360">}</span><span class="op" id="7713361">(</span><span class="op" id="7713362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7713365">select</span>&nbsp;<span class="op" id="7713372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7713375">case</span>&nbsp;<span class="ident" id="7713380">err</span>&nbsp;<span class="op" id="7713384">:=</span>&nbsp;<span class="op" id="7713387">&lt;-</span><span class="ident" id="7713389">errc</span><span class="op" id="7713393">:</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7713397">if</span>&nbsp;<span class="ident" id="7713400">err</span>&nbsp;<span class="op" id="7713404">!=</span>&nbsp;<span class="ident" id="7713407">wantErr</span>&nbsp;<span class="op" id="7713415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7713420">t</span><span class="op" id="7713421">.</span><span class="ident" id="7713422">Errorf</span><span class="op" id="7713428">(</span><span class="string" id="7713429">&#34;got&nbsp;error&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7713452">,</span>&nbsp;<span class="ident" id="7713454">err</span><span class="op" id="7713457">,</span>&nbsp;<span class="ident" id="7713459">wantErr</span><span class="op" id="7713466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7713470">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7713473">case</span>&nbsp;<span class="op" id="7713478">&lt;-</span><span class="ident" id="7713480">time</span><span class="op" id="7713484">.</span><span class="ident" id="7713485">After</span><span class="op" id="7713490">(</span><span class="num" id="7713491">5</span>&nbsp;<span class="op" id="7713493">*</span>&nbsp;<span class="ident" id="7713495">time</span><span class="op" id="7713499">.</span><span class="ident" id="7713500">Second</span><span class="op" id="7713506">)</span><span class="op" id="7713507">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7713511">t</span><span class="op" id="7713512">.</span><span class="ident" id="7713513">Errorf</span><span class="op" id="7713519">(</span><span class="string" id="7713520">&#34;timeout;&nbsp;Decoder&nbsp;blocked&nbsp;without&nbsp;returning&nbsp;an&nbsp;error&#34;</span><span class="op" id="7713573">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7713576">}</span><br>
<span class="lineno"></span><span class="op" id="7713578">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7713581">func</span>&nbsp;<span class="ident" id="7713586">TestDecoderIssue4779</span><span class="op" id="7713606">(</span><span class="ident" id="7713607">t</span>&nbsp;<span class="op" id="7713609">*</span><span class="ident" id="7713610">testing</span><span class="op" id="7713617">.</span><span class="ident" id="7713618">T</span><span class="op" id="7713619">)</span>&nbsp;<span class="op" id="7713621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7713624">encoded</span>&nbsp;<span class="op" id="7713632">:=</span>&nbsp;<span class="string" id="7713635">`CP/EAT8AAAEF<br>
<span class="lineno">300</span>AQEBAQEBAAAAAAAAAAMAAQIEBQYHCAkKCwEAAQUBAQEBAQEAAAAAAAAAAQACAwQFBgcICQoLEAAB<br>
<span class="lineno"></span>BAEDAgQCBQcGCAUDDDMBAAIRAwQhEjEFQVFhEyJxgTIGFJGhsUIjJBVSwWIzNHKC0UMHJZJT8OHx<br>
<span class="lineno"></span>Y3M1FqKygyZEk1RkRcKjdDYX0lXiZfKzhMPTdePzRieUpIW0lcTU5PSltcXV5fVWZnaGlqa2xtbm<br>
<span class="lineno"></span>9jdHV2d3h5ent8fX5/cRAAICAQIEBAMEBQYHBwYFNQEAAhEDITESBEFRYXEiEwUygZEUobFCI8FS<br>
<span class="lineno"></span>0fAzJGLhcoKSQ1MVY3M08SUGFqKygwcmNcLSRJNUoxdkRVU2dGXi8rOEw9N14/NGlKSFtJXE1OT0<br>
<span class="lineno">305</span>pbXF1eX1VmZ2hpamtsbW5vYnN0dXZ3eHl6e3x//aAAwDAQACEQMRAD8A9VSSSSUpJJJJSkkkJ+Tj<br>
<span class="lineno"></span>1kiy1jCJJDnAcCTykpKkuQ6p/jN6FgmxlNduXawwAzaGH+V6jn/R/wCt71zdn+N/qL3kVYFNYB4N<br>
<span class="lineno"></span>ji6PDVjWpKp9TSXnvTf8bFNjg3qOEa2n6VlLpj/rT/pf567DpX1i6L1hs9Py67X8mqdtg/rUWbbf<br>
<span class="lineno"></span>+gkp0kkkklKSSSSUpJJJJT//0PVUkkklKVLq3WMDpGI7KzrNjADtYNXvI/Mqr/Pd/q9W3vaxjnvM<br>
<span class="lineno"></span>NaCXE9gNSvGPrf8AWS3qmba5jjsJhoB0DAf0NDf6sevf+/lf8Hj0JJATfWT6/dV6oXU1uOLQeKKn<br>
<span class="lineno">310</span>EQP+Hubtfe/+R7Mf/g7f5xcocp++Z11JMCJPgFBxOg7/AOuqDx8I/ikpkXkmSdU8mJIJA/O8EMAy<br>
<span class="lineno"></span>j+mSARB/17pKVXYWHXjsj7yIex0PadzXMO1zT5KHoNA3HT8ietoGhgjsfA+CSnvvqh/jJtqsrwOv<br>
<span class="lineno"></span>2b6NGNzXfTYexzJ+nU7/ALkf4P8Awv6P9KvTQQ4AgyDqCF85Pho3CTB7eHwXoH+LT65uZbX9X+o2<br>
<span class="lineno"></span>bqbPb06551Y4<br>
<span class="lineno"></span>`</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7714666">encodedShort</span>&nbsp;<span class="op" id="7714679">:=</span>&nbsp;<span class="ident" id="7714682">strings</span><span class="op" id="7714689">.</span><span class="ident" id="7714690">Replace</span><span class="op" id="7714697">(</span><span class="ident" id="7714698">encoded</span><span class="op" id="7714705">,</span>&nbsp;<span class="string" id="7714707">&#34;\n&#34;</span><span class="op" id="7714711">,</span>&nbsp;<span class="string" id="7714713">&#34;&#34;</span><span class="op" id="7714715">,</span>&nbsp;<span class="op" id="7714717">-</span><span class="num" id="7714718">1</span><span class="op" id="7714719">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7714723">dec</span>&nbsp;<span class="op" id="7714727">:=</span>&nbsp;<span class="ident" id="7714730">NewDecoder</span><span class="op" id="7714740">(</span><span class="ident" id="7714741">StdEncoding</span><span class="op" id="7714752">,</span>&nbsp;<span class="ident" id="7714754">strings</span><span class="op" id="7714761">.</span><span class="ident" id="7714762">NewReader</span><span class="op" id="7714771">(</span><span class="ident" id="7714772">encoded</span><span class="op" id="7714779">)</span><span class="op" id="7714780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7714783">res1</span><span class="op" id="7714787">,</span>&nbsp;<span class="ident" id="7714789">err</span>&nbsp;<span class="op" id="7714793">:=</span>&nbsp;<span class="ident" id="7714796">ioutil</span><span class="op" id="7714802">.</span><span class="ident" id="7714803">ReadAll</span><span class="op" id="7714810">(</span><span class="ident" id="7714811">dec</span><span class="op" id="7714814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7714817">if</span>&nbsp;<span class="ident" id="7714820">err</span>&nbsp;<span class="op" id="7714824">!=</span>&nbsp;<span class="ident" id="7714827">nil</span>&nbsp;<span class="op" id="7714831">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7714835">t</span><span class="op" id="7714836">.</span><span class="ident" id="7714837">Errorf</span><span class="op" id="7714843">(</span><span class="string" id="7714844">&#34;ReadAll&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7714864">,</span>&nbsp;<span class="ident" id="7714866">err</span><span class="op" id="7714869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7714872">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7714876">dec</span>&nbsp;<span class="op" id="7714880">=</span>&nbsp;<span class="ident" id="7714882">NewDecoder</span><span class="op" id="7714892">(</span><span class="ident" id="7714893">StdEncoding</span><span class="op" id="7714904">,</span>&nbsp;<span class="ident" id="7714906">strings</span><span class="op" id="7714913">.</span><span class="ident" id="7714914">NewReader</span><span class="op" id="7714923">(</span><span class="ident" id="7714924">encodedShort</span><span class="op" id="7714936">)</span><span class="op" id="7714937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7714940">var</span>&nbsp;<span class="ident" id="7714944">res2</span>&nbsp;<span class="op" id="7714949">[</span><span class="op" id="7714950">]</span><span class="builtintype" id="7714951">byte</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7714957">res2</span><span class="op" id="7714961">,</span>&nbsp;<span class="ident" id="7714963">err</span>&nbsp;<span class="op" id="7714967">=</span>&nbsp;<span class="ident" id="7714969">ioutil</span><span class="op" id="7714975">.</span><span class="ident" id="7714976">ReadAll</span><span class="op" id="7714983">(</span><span class="ident" id="7714984">dec</span><span class="op" id="7714987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7714990">if</span>&nbsp;<span class="ident" id="7714993">err</span>&nbsp;<span class="op" id="7714997">!=</span>&nbsp;<span class="ident" id="7715000">nil</span>&nbsp;<span class="op" id="7715004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7715008">t</span><span class="op" id="7715009">.</span><span class="ident" id="7715010">Errorf</span><span class="op" id="7715016">(</span><span class="string" id="7715017">&#34;ReadAll&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7715037">,</span>&nbsp;<span class="ident" id="7715039">err</span><span class="op" id="7715042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7715045">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7715049">if</span>&nbsp;<span class="op" id="7715052">!</span><span class="ident" id="7715053">bytes</span><span class="op" id="7715058">.</span><span class="ident" id="7715059">Equal</span><span class="op" id="7715064">(</span><span class="ident" id="7715065">res1</span><span class="op" id="7715069">,</span>&nbsp;<span class="ident" id="7715071">res2</span><span class="op" id="7715075">)</span>&nbsp;<span class="op" id="7715077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7715081">t</span><span class="op" id="7715082">.</span><span class="ident" id="7715083">Error</span><span class="op" id="7715088">(</span><span class="string" id="7715089">&#34;Decoded&nbsp;results&nbsp;not&nbsp;equal&#34;</span><span class="op" id="7715116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7715119">}</span><br>
<span class="lineno"></span><span class="op" id="7715121">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span><span class="keyword" id="7715124">func</span>&nbsp;<span class="ident" id="7715129">TestDecoderIssue7733</span><span class="op" id="7715149">(</span><span class="ident" id="7715150">t</span>&nbsp;<span class="op" id="7715152">*</span><span class="ident" id="7715153">testing</span><span class="op" id="7715160">.</span><span class="ident" id="7715161">T</span><span class="op" id="7715162">)</span>&nbsp;<span class="op" id="7715164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7715167">s</span><span class="op" id="7715168">,</span>&nbsp;<span class="ident" id="7715170">err</span>&nbsp;<span class="op" id="7715174">:=</span>&nbsp;<span class="ident" id="7715177">StdEncoding</span><span class="op" id="7715188">.</span><span class="ident" id="7715189">DecodeString</span><span class="op" id="7715201">(</span><span class="string" id="7715202">&#34;YWJjZA=====&#34;</span><span class="op" id="7715215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7715218">want</span>&nbsp;<span class="op" id="7715223">:=</span>&nbsp;<span class="ident" id="7715226">CorruptInputError</span><span class="op" id="7715243">(</span><span class="num" id="7715244">8</span><span class="op" id="7715245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7715248">if</span>&nbsp;<span class="op" id="7715251">!</span><span class="ident" id="7715252">reflect</span><span class="op" id="7715259">.</span><span class="ident" id="7715260">DeepEqual</span><span class="op" id="7715269">(</span><span class="ident" id="7715270">want</span><span class="op" id="7715274">,</span>&nbsp;<span class="ident" id="7715276">err</span><span class="op" id="7715279">)</span>&nbsp;<span class="op" id="7715281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7715285">t</span><span class="op" id="7715286">.</span><span class="ident" id="7715287">Errorf</span><span class="op" id="7715293">(</span><span class="string" id="7715294">&#34;Error&nbsp;=&nbsp;%v;&nbsp;want&nbsp;CorruptInputError(8)&#34;</span><span class="op" id="7715333">,</span>&nbsp;<span class="ident" id="7715335">err</span><span class="op" id="7715338">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7715341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7715344">if</span>&nbsp;<span class="builtintype" id="7715347">string</span><span class="op" id="7715353">(</span><span class="ident" id="7715354">s</span><span class="op" id="7715355">)</span>&nbsp;<span class="op" id="7715357">!=</span>&nbsp;<span class="string" id="7715360">&#34;abcd&#34;</span>&nbsp;<span class="op" id="7715367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7715371">t</span><span class="op" id="7715372">.</span><span class="ident" id="7715373">Errorf</span><span class="op" id="7715379">(</span><span class="string" id="7715380">&#34;DecodeString&nbsp;=&nbsp;%q;&nbsp;want&nbsp;abcd&#34;</span><span class="op" id="7715410">,</span>&nbsp;<span class="ident" id="7715412">s</span><span class="op" id="7715413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7715416">}</span><br>
<span class="lineno"></span><span class="op" id="7715418">}</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span><span class="keyword" id="7715421">func</span>&nbsp;<span class="ident" id="7715426">BenchmarkEncodeToString</span><span class="op" id="7715449">(</span><span class="ident" id="7715450">b</span>&nbsp;<span class="op" id="7715452">*</span><span class="ident" id="7715453">testing</span><span class="op" id="7715460">.</span><span class="ident" id="7715461">B</span><span class="op" id="7715462">)</span>&nbsp;<span class="op" id="7715464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7715467">data</span>&nbsp;<span class="op" id="7715472">:=</span>&nbsp;<span class="builtinfunc" id="7715475">make</span><span class="op" id="7715479">(</span><span class="op" id="7715480">[</span><span class="op" id="7715481">]</span><span class="builtintype" id="7715482">byte</span><span class="op" id="7715486">,</span>&nbsp;<span class="num" id="7715488">8192</span><span class="op" id="7715492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7715495">b</span><span class="op" id="7715496">.</span><span class="ident" id="7715497">SetBytes</span><span class="op" id="7715505">(</span><span class="ident" id="7715506">int64</span><span class="op" id="7715511">(</span><span class="builtinfunc" id="7715512">len</span><span class="op" id="7715515">(</span><span class="ident" id="7715516">data</span><span class="op" id="7715520">)</span><span class="op" id="7715521">)</span><span class="op" id="7715522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7715525">for</span>&nbsp;<span class="ident" id="7715529">i</span>&nbsp;<span class="op" id="7715531">:=</span>&nbsp;<span class="num" id="7715534">0</span><span class="op" id="7715535">;</span>&nbsp;<span class="ident" id="7715537">i</span>&nbsp;<span class="op" id="7715539">&lt;</span>&nbsp;<span class="ident" id="7715541">b</span><span class="op" id="7715542">.</span><span class="ident" id="7715543">N</span><span class="op" id="7715544">;</span>&nbsp;<span class="ident" id="7715546">i</span><span class="op" id="7715547">++</span>&nbsp;<span class="op" id="7715550">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7715554">StdEncoding</span><span class="op" id="7715565">.</span><span class="ident" id="7715566">EncodeToString</span><span class="op" id="7715580">(</span><span class="ident" id="7715581">data</span><span class="op" id="7715585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7715588">}</span><br>
<span class="lineno"></span><span class="op" id="7715590">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7715593">func</span>&nbsp;<span class="ident" id="7715598">BenchmarkDecodeString</span><span class="op" id="7715619">(</span><span class="ident" id="7715620">b</span>&nbsp;<span class="op" id="7715622">*</span><span class="ident" id="7715623">testing</span><span class="op" id="7715630">.</span><span class="ident" id="7715631">B</span><span class="op" id="7715632">)</span>&nbsp;<span class="op" id="7715634">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7715637">data</span>&nbsp;<span class="op" id="7715642">:=</span>&nbsp;<span class="ident" id="7715645">StdEncoding</span><span class="op" id="7715656">.</span><span class="ident" id="7715657">EncodeToString</span><span class="op" id="7715671">(</span><span class="builtinfunc" id="7715672">make</span><span class="op" id="7715676">(</span><span class="op" id="7715677">[</span><span class="op" id="7715678">]</span><span class="builtintype" id="7715679">byte</span><span class="op" id="7715683">,</span>&nbsp;<span class="num" id="7715685">8192</span><span class="op" id="7715689">)</span><span class="op" id="7715690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7715693">b</span><span class="op" id="7715694">.</span><span class="ident" id="7715695">SetBytes</span><span class="op" id="7715703">(</span><span class="ident" id="7715704">int64</span><span class="op" id="7715709">(</span><span class="builtinfunc" id="7715710">len</span><span class="op" id="7715713">(</span><span class="ident" id="7715714">data</span><span class="op" id="7715718">)</span><span class="op" id="7715719">)</span><span class="op" id="7715720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7715723">for</span>&nbsp;<span class="ident" id="7715727">i</span>&nbsp;<span class="op" id="7715729">:=</span>&nbsp;<span class="num" id="7715732">0</span><span class="op" id="7715733">;</span>&nbsp;<span class="ident" id="7715735">i</span>&nbsp;<span class="op" id="7715737">&lt;</span>&nbsp;<span class="ident" id="7715739">b</span><span class="op" id="7715740">.</span><span class="ident" id="7715741">N</span><span class="op" id="7715742">;</span>&nbsp;<span class="ident" id="7715744">i</span><span class="op" id="7715745">++</span>&nbsp;<span class="op" id="7715748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7715752">StdEncoding</span><span class="op" id="7715763">.</span><span class="ident" id="7715764">DecodeString</span><span class="op" id="7715776">(</span><span class="ident" id="7715777">data</span><span class="op" id="7715781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7715784">}</span><br>
<span class="lineno">360</span><span class="op" id="7715786">}</span>
</div>
</body>
</html>
