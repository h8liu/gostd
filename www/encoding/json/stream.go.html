<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4789699">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4789755">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4789809">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4789860">package</span>&nbsp;<span class="ident" id="4789868">json</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4789874">import</span>&nbsp;<span class="op" id="4789881">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4789884">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4789893">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4789903">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="4789908">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4789911">//&nbsp;A&nbsp;Decoder&nbsp;reads&nbsp;and&nbsp;decodes&nbsp;JSON&nbsp;objects&nbsp;from&nbsp;an&nbsp;input&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="4789977">type</span>&nbsp;<span class="ident" id="4789982">Decoder</span>&nbsp;<span class="keyword" id="4789990">struct</span>&nbsp;<span class="op" id="4789997">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4790000">r</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4790005">io</span><span class="op" id="4790007">.</span><span class="ident" id="4790008">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4790016">buf</span>&nbsp;&nbsp;<span class="op" id="4790021">[</span><span class="op" id="4790022">]</span><span class="builtintype" id="4790023">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4790029">d</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4790034">decodeState</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4790047">scan</span>&nbsp;<span class="ident" id="4790052">scanner</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4790061">err</span>&nbsp;&nbsp;<span class="builtintype" id="4790066">error</span><br>
<span class="lineno">20</span><span class="op" id="4790072">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4790075">//&nbsp;NewDecoder&nbsp;returns&nbsp;a&nbsp;new&nbsp;decoder&nbsp;that&nbsp;reads&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="4790130">//</span><br>
<span class="lineno"></span><span class="comment" id="4790133">//&nbsp;The&nbsp;decoder&nbsp;introduces&nbsp;its&nbsp;own&nbsp;buffering&nbsp;and&nbsp;may</span><br>
<span class="lineno">25</span><span class="comment" id="4790185">//&nbsp;read&nbsp;data&nbsp;from&nbsp;r&nbsp;beyond&nbsp;the&nbsp;JSON&nbsp;values&nbsp;requested.</span><br>
<span class="lineno"></span><span class="keyword" id="4790239">func</span>&nbsp;<span class="ident" id="4790244">NewDecoder</span><span class="op" id="4790254">(</span><span class="ident" id="4790255">r</span>&nbsp;<span class="ident" id="4790257">io</span><span class="op" id="4790259">.</span><span class="ident" id="4790260">Reader</span><span class="op" id="4790266">)</span>&nbsp;<span class="op" id="4790268">*</span><span class="ident" id="4790269">Decoder</span>&nbsp;<span class="op" id="4790277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4790280">return</span>&nbsp;<span class="op" id="4790287">&amp;</span><span class="ident" id="4790288">Decoder</span><span class="op" id="4790295">{</span><span class="ident" id="4790296">r</span><span class="op" id="4790297">:</span>&nbsp;<span class="ident" id="4790299">r</span><span class="op" id="4790300">}</span><br>
<span class="lineno"></span><span class="op" id="4790302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="4790305">//&nbsp;UseNumber&nbsp;causes&nbsp;the&nbsp;Decoder&nbsp;to&nbsp;unmarshal&nbsp;a&nbsp;number&nbsp;into&nbsp;an&nbsp;interface{}&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4790384">//&nbsp;Number&nbsp;instead&nbsp;of&nbsp;as&nbsp;a&nbsp;float64.</span><br>
<span class="lineno"></span><span class="keyword" id="4790419">func</span>&nbsp;<span class="op" id="4790424">(</span><span class="ident" id="4790425">dec</span>&nbsp;<span class="op" id="4790429">*</span><span class="ident" id="4790430">Decoder</span><span class="op" id="4790437">)</span>&nbsp;<span class="ident" id="4790439">UseNumber</span><span class="op" id="4790448">(</span><span class="op" id="4790449">)</span>&nbsp;<span class="op" id="4790451">{</span>&nbsp;<span class="ident" id="4790453">dec</span><span class="op" id="4790456">.</span><span class="ident" id="4790457">d</span><span class="op" id="4790458">.</span><span class="ident" id="4790459">useNumber</span>&nbsp;<span class="op" id="4790469">=</span>&nbsp;<span class="ident" id="4790471">true</span>&nbsp;<span class="op" id="4790476">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4790479">//&nbsp;Decode&nbsp;reads&nbsp;the&nbsp;next&nbsp;JSON-encoded&nbsp;value&nbsp;from&nbsp;its</span><br>
<span class="lineno">35</span><span class="comment" id="4790532">//&nbsp;input&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;the&nbsp;value&nbsp;pointed&nbsp;to&nbsp;by&nbsp;v.</span><br>
<span class="lineno"></span><span class="comment" id="4790585">//</span><br>
<span class="lineno"></span><span class="comment" id="4790588">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;Unmarshal&nbsp;for&nbsp;details&nbsp;about</span><br>
<span class="lineno"></span><span class="comment" id="4790645">//&nbsp;the&nbsp;conversion&nbsp;of&nbsp;JSON&nbsp;into&nbsp;a&nbsp;Go&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="4790688">func</span>&nbsp;<span class="op" id="4790693">(</span><span class="ident" id="4790694">dec</span>&nbsp;<span class="op" id="4790698">*</span><span class="ident" id="4790699">Decoder</span><span class="op" id="4790706">)</span>&nbsp;<span class="ident" id="4790708">Decode</span><span class="op" id="4790714">(</span><span class="ident" id="4790715">v</span>&nbsp;<span class="keyword" id="4790717">interface</span><span class="op" id="4790726">{</span><span class="op" id="4790727">}</span><span class="op" id="4790728">)</span>&nbsp;<span class="builtintype" id="4790730">error</span>&nbsp;<span class="op" id="4790736">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4790739">if</span>&nbsp;<span class="ident" id="4790742">dec</span><span class="op" id="4790745">.</span><span class="ident" id="4790746">err</span>&nbsp;<span class="op" id="4790750">!=</span>&nbsp;<span class="ident" id="4790753">nil</span>&nbsp;<span class="op" id="4790757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4790761">return</span>&nbsp;<span class="ident" id="4790768">dec</span><span class="op" id="4790771">.</span><span class="ident" id="4790772">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4790777">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4790781">n</span><span class="op" id="4790782">,</span>&nbsp;<span class="ident" id="4790784">err</span>&nbsp;<span class="op" id="4790788">:=</span>&nbsp;<span class="ident" id="4790791">dec</span><span class="op" id="4790794">.</span><span class="ident" id="4790795">readValue</span><span class="op" id="4790804">(</span><span class="op" id="4790805">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4790808">if</span>&nbsp;<span class="ident" id="4790811">err</span>&nbsp;<span class="op" id="4790815">!=</span>&nbsp;<span class="ident" id="4790818">nil</span>&nbsp;<span class="op" id="4790822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4790826">return</span>&nbsp;<span class="ident" id="4790833">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4790838">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4790842">//&nbsp;Don&#39;t&nbsp;save&nbsp;err&nbsp;from&nbsp;unmarshal&nbsp;into&nbsp;dec.err:</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4790890">//&nbsp;the&nbsp;connection&nbsp;is&nbsp;still&nbsp;usable&nbsp;since&nbsp;we&nbsp;read&nbsp;a&nbsp;complete&nbsp;JSON</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4790955">//&nbsp;object&nbsp;from&nbsp;it&nbsp;before&nbsp;the&nbsp;error&nbsp;happened.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4791001">dec</span><span class="op" id="4791004">.</span><span class="ident" id="4791005">d</span><span class="op" id="4791006">.</span><span class="ident" id="4791007">init</span><span class="op" id="4791011">(</span><span class="ident" id="4791012">dec</span><span class="op" id="4791015">.</span><span class="ident" id="4791016">buf</span><span class="op" id="4791019">[</span><span class="num" id="4791020">0</span><span class="op" id="4791021">:</span><span class="ident" id="4791022">n</span><span class="op" id="4791023">]</span><span class="op" id="4791024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4791027">err</span>&nbsp;<span class="op" id="4791031">=</span>&nbsp;<span class="ident" id="4791033">dec</span><span class="op" id="4791036">.</span><span class="ident" id="4791037">d</span><span class="op" id="4791038">.</span><span class="ident" id="4791039">unmarshal</span><span class="op" id="4791048">(</span><span class="ident" id="4791049">v</span><span class="op" id="4791050">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4791054">//&nbsp;Slide&nbsp;rest&nbsp;of&nbsp;data&nbsp;down.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4791083">rest</span>&nbsp;<span class="op" id="4791088">:=</span>&nbsp;<span class="builtinfunc" id="4791091">copy</span><span class="op" id="4791095">(</span><span class="ident" id="4791096">dec</span><span class="op" id="4791099">.</span><span class="ident" id="4791100">buf</span><span class="op" id="4791103">,</span>&nbsp;<span class="ident" id="4791105">dec</span><span class="op" id="4791108">.</span><span class="ident" id="4791109">buf</span><span class="op" id="4791112">[</span><span class="ident" id="4791113">n</span><span class="op" id="4791114">:</span><span class="op" id="4791115">]</span><span class="op" id="4791116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4791119">dec</span><span class="op" id="4791122">.</span><span class="ident" id="4791123">buf</span>&nbsp;<span class="op" id="4791127">=</span>&nbsp;<span class="ident" id="4791129">dec</span><span class="op" id="4791132">.</span><span class="ident" id="4791133">buf</span><span class="op" id="4791136">[</span><span class="num" id="4791137">0</span><span class="op" id="4791138">:</span><span class="ident" id="4791139">rest</span><span class="op" id="4791143">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4791147">return</span>&nbsp;<span class="ident" id="4791154">err</span><br>
<span class="lineno">60</span><span class="op" id="4791158">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4791161">//&nbsp;Buffered&nbsp;returns&nbsp;a&nbsp;reader&nbsp;of&nbsp;the&nbsp;data&nbsp;remaining&nbsp;in&nbsp;the&nbsp;Decoder&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="4791229">//&nbsp;buffer.&nbsp;The&nbsp;reader&nbsp;is&nbsp;valid&nbsp;until&nbsp;the&nbsp;next&nbsp;call&nbsp;to&nbsp;Decode.</span><br>
<span class="lineno"></span><span class="keyword" id="4791291">func</span>&nbsp;<span class="op" id="4791296">(</span><span class="ident" id="4791297">dec</span>&nbsp;<span class="op" id="4791301">*</span><span class="ident" id="4791302">Decoder</span><span class="op" id="4791309">)</span>&nbsp;<span class="ident" id="4791311">Buffered</span><span class="op" id="4791319">(</span><span class="op" id="4791320">)</span>&nbsp;<span class="ident" id="4791322">io</span><span class="op" id="4791324">.</span><span class="ident" id="4791325">Reader</span>&nbsp;<span class="op" id="4791332">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4791335">return</span>&nbsp;<span class="ident" id="4791342">bytes</span><span class="op" id="4791347">.</span><span class="ident" id="4791348">NewReader</span><span class="op" id="4791357">(</span><span class="ident" id="4791358">dec</span><span class="op" id="4791361">.</span><span class="ident" id="4791362">buf</span><span class="op" id="4791365">)</span><br>
<span class="lineno"></span><span class="op" id="4791367">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4791370">//&nbsp;readValue&nbsp;reads&nbsp;a&nbsp;JSON&nbsp;value&nbsp;into&nbsp;dec.buf.</span><br>
<span class="lineno"></span><span class="comment" id="4791416">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno">70</span><span class="keyword" id="4791458">func</span>&nbsp;<span class="op" id="4791463">(</span><span class="ident" id="4791464">dec</span>&nbsp;<span class="op" id="4791468">*</span><span class="ident" id="4791469">Decoder</span><span class="op" id="4791476">)</span>&nbsp;<span class="ident" id="4791478">readValue</span><span class="op" id="4791487">(</span><span class="op" id="4791488">)</span>&nbsp;<span class="op" id="4791490">(</span><span class="builtintype" id="4791491">int</span><span class="op" id="4791494">,</span>&nbsp;<span class="builtintype" id="4791496">error</span><span class="op" id="4791501">)</span>&nbsp;<span class="op" id="4791503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4791506">dec</span><span class="op" id="4791509">.</span><span class="ident" id="4791510">scan</span><span class="op" id="4791514">.</span><span class="ident" id="4791515">reset</span><span class="op" id="4791520">(</span><span class="op" id="4791521">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4791525">scanp</span>&nbsp;<span class="op" id="4791531">:=</span>&nbsp;<span class="num" id="4791534">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4791537">var</span>&nbsp;<span class="ident" id="4791541">err</span>&nbsp;<span class="builtintype" id="4791545">error</span><br>
<span class="lineno">75</span><span class="ident" id="4791551">Input</span><span class="op" id="4791556">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4791559">for</span>&nbsp;<span class="op" id="4791563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4791567">//&nbsp;Look&nbsp;in&nbsp;the&nbsp;buffer&nbsp;for&nbsp;a&nbsp;new&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4791608">for</span>&nbsp;<span class="ident" id="4791612">i</span><span class="op" id="4791613">,</span>&nbsp;<span class="ident" id="4791615">c</span>&nbsp;<span class="op" id="4791617">:=</span>&nbsp;<span class="keyword" id="4791620">range</span>&nbsp;<span class="ident" id="4791626">dec</span><span class="op" id="4791629">.</span><span class="ident" id="4791630">buf</span><span class="op" id="4791633">[</span><span class="ident" id="4791634">scanp</span><span class="op" id="4791639">:</span><span class="op" id="4791640">]</span>&nbsp;<span class="op" id="4791642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4791647">dec</span><span class="op" id="4791650">.</span><span class="ident" id="4791651">scan</span><span class="op" id="4791655">.</span><span class="ident" id="4791656">bytes</span><span class="op" id="4791661">++</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4791667">v</span>&nbsp;<span class="op" id="4791669">:=</span>&nbsp;<span class="ident" id="4791672">dec</span><span class="op" id="4791675">.</span><span class="ident" id="4791676">scan</span><span class="op" id="4791680">.</span><span class="ident" id="4791681">step</span><span class="op" id="4791685">(</span><span class="op" id="4791686">&amp;</span><span class="ident" id="4791687">dec</span><span class="op" id="4791690">.</span><span class="ident" id="4791691">scan</span><span class="op" id="4791695">,</span>&nbsp;<span class="builtintype" id="4791697">int</span><span class="op" id="4791700">(</span><span class="ident" id="4791701">c</span><span class="op" id="4791702">)</span><span class="op" id="4791703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4791708">if</span>&nbsp;<span class="ident" id="4791711">v</span>&nbsp;<span class="op" id="4791713">==</span>&nbsp;<span class="ident" id="4791716">scanEnd</span>&nbsp;<span class="op" id="4791724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4791730">scanp</span>&nbsp;<span class="op" id="4791736">+=</span>&nbsp;<span class="ident" id="4791739">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4791745">break</span>&nbsp;<span class="ident" id="4791751">Input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4791760">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4791765">//&nbsp;scanEnd&nbsp;is&nbsp;delayed&nbsp;one&nbsp;byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4791800">//&nbsp;We&nbsp;might&nbsp;block&nbsp;trying&nbsp;to&nbsp;get&nbsp;that&nbsp;byte&nbsp;from&nbsp;src,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4791855">//&nbsp;so&nbsp;instead&nbsp;invent&nbsp;a&nbsp;space&nbsp;byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4791893">if</span>&nbsp;<span class="op" id="4791896">(</span><span class="ident" id="4791897">v</span>&nbsp;<span class="op" id="4791899">==</span>&nbsp;<span class="ident" id="4791902">scanEndObject</span>&nbsp;<span class="op" id="4791916">||</span>&nbsp;<span class="ident" id="4791919">v</span>&nbsp;<span class="op" id="4791921">==</span>&nbsp;<span class="ident" id="4791924">scanEndArray</span><span class="op" id="4791936">)</span>&nbsp;<span class="op" id="4791938">&amp;&amp;</span>&nbsp;<span class="ident" id="4791941">dec</span><span class="op" id="4791944">.</span><span class="ident" id="4791945">scan</span><span class="op" id="4791949">.</span><span class="ident" id="4791950">step</span><span class="op" id="4791954">(</span><span class="op" id="4791955">&amp;</span><span class="ident" id="4791956">dec</span><span class="op" id="4791959">.</span><span class="ident" id="4791960">scan</span><span class="op" id="4791964">,</span>&nbsp;<span class="string" id="4791966">&#39;&nbsp;&#39;</span><span class="op" id="4791969">)</span>&nbsp;<span class="op" id="4791971">==</span>&nbsp;<span class="ident" id="4791974">scanEnd</span>&nbsp;<span class="op" id="4791982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4791988">scanp</span>&nbsp;<span class="op" id="4791994">+=</span>&nbsp;<span class="ident" id="4791997">i</span>&nbsp;<span class="op" id="4791999">+</span>&nbsp;<span class="num" id="4792001">1</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4792007">break</span>&nbsp;<span class="ident" id="4792013">Input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4792022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4792027">if</span>&nbsp;<span class="ident" id="4792030">v</span>&nbsp;<span class="op" id="4792032">==</span>&nbsp;<span class="ident" id="4792035">scanError</span>&nbsp;<span class="op" id="4792045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4792051">dec</span><span class="op" id="4792054">.</span><span class="ident" id="4792055">err</span>&nbsp;<span class="op" id="4792059">=</span>&nbsp;<span class="ident" id="4792061">dec</span><span class="op" id="4792064">.</span><span class="ident" id="4792065">scan</span><span class="op" id="4792069">.</span><span class="ident" id="4792070">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4792078">return</span>&nbsp;<span class="num" id="4792085">0</span><span class="op" id="4792086">,</span>&nbsp;<span class="ident" id="4792088">dec</span><span class="op" id="4792091">.</span><span class="ident" id="4792092">scan</span><span class="op" id="4792096">.</span><span class="ident" id="4792097">err</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4792104">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4792108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4792112">scanp</span>&nbsp;<span class="op" id="4792118">=</span>&nbsp;<span class="builtinfunc" id="4792120">len</span><span class="op" id="4792123">(</span><span class="ident" id="4792124">dec</span><span class="op" id="4792127">.</span><span class="ident" id="4792128">buf</span><span class="op" id="4792131">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4792136">//&nbsp;Did&nbsp;the&nbsp;last&nbsp;read&nbsp;have&nbsp;an&nbsp;error?</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4792174">//&nbsp;Delayed&nbsp;until&nbsp;now&nbsp;to&nbsp;allow&nbsp;buffer&nbsp;scan.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4792219">if</span>&nbsp;<span class="ident" id="4792222">err</span>&nbsp;<span class="op" id="4792226">!=</span>&nbsp;<span class="ident" id="4792229">nil</span>&nbsp;<span class="op" id="4792233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4792238">if</span>&nbsp;<span class="ident" id="4792241">err</span>&nbsp;<span class="op" id="4792245">==</span>&nbsp;<span class="ident" id="4792248">io</span><span class="op" id="4792250">.</span><span class="ident" id="4792251">EOF</span>&nbsp;<span class="op" id="4792255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4792261">if</span>&nbsp;<span class="ident" id="4792264">dec</span><span class="op" id="4792267">.</span><span class="ident" id="4792268">scan</span><span class="op" id="4792272">.</span><span class="ident" id="4792273">step</span><span class="op" id="4792277">(</span><span class="op" id="4792278">&amp;</span><span class="ident" id="4792279">dec</span><span class="op" id="4792282">.</span><span class="ident" id="4792283">scan</span><span class="op" id="4792287">,</span>&nbsp;<span class="string" id="4792289">&#39;&nbsp;&#39;</span><span class="op" id="4792292">)</span>&nbsp;<span class="op" id="4792294">==</span>&nbsp;<span class="ident" id="4792297">scanEnd</span>&nbsp;<span class="op" id="4792305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4792312">break</span>&nbsp;<span class="ident" id="4792318">Input</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4792328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4792334">if</span>&nbsp;<span class="ident" id="4792337">nonSpace</span><span class="op" id="4792345">(</span><span class="ident" id="4792346">dec</span><span class="op" id="4792349">.</span><span class="ident" id="4792350">buf</span><span class="op" id="4792353">)</span>&nbsp;<span class="op" id="4792355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4792362">err</span>&nbsp;<span class="op" id="4792366">=</span>&nbsp;<span class="ident" id="4792368">io</span><span class="op" id="4792370">.</span><span class="ident" id="4792371">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4792392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4792397">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4792402">dec</span><span class="op" id="4792405">.</span><span class="ident" id="4792406">err</span>&nbsp;<span class="op" id="4792410">=</span>&nbsp;<span class="ident" id="4792412">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4792419">return</span>&nbsp;<span class="num" id="4792426">0</span><span class="op" id="4792427">,</span>&nbsp;<span class="ident" id="4792429">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4792435">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4792440">//&nbsp;Make&nbsp;room&nbsp;to&nbsp;read&nbsp;more&nbsp;into&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4792485">const</span>&nbsp;<span class="ident" id="4792491">minRead</span>&nbsp;<span class="op" id="4792499">=</span>&nbsp;<span class="num" id="4792501">512</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4792507">if</span>&nbsp;<span class="builtinfunc" id="4792510">cap</span><span class="op" id="4792513">(</span><span class="ident" id="4792514">dec</span><span class="op" id="4792517">.</span><span class="ident" id="4792518">buf</span><span class="op" id="4792521">)</span><span class="op" id="4792522">-</span><span class="builtinfunc" id="4792523">len</span><span class="op" id="4792526">(</span><span class="ident" id="4792527">dec</span><span class="op" id="4792530">.</span><span class="ident" id="4792531">buf</span><span class="op" id="4792534">)</span>&nbsp;<span class="op" id="4792536">&lt;</span>&nbsp;<span class="ident" id="4792538">minRead</span>&nbsp;<span class="op" id="4792546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4792551">newBuf</span>&nbsp;<span class="op" id="4792558">:=</span>&nbsp;<span class="builtinfunc" id="4792561">make</span><span class="op" id="4792565">(</span><span class="op" id="4792566">[</span><span class="op" id="4792567">]</span><span class="builtintype" id="4792568">byte</span><span class="op" id="4792572">,</span>&nbsp;<span class="builtinfunc" id="4792574">len</span><span class="op" id="4792577">(</span><span class="ident" id="4792578">dec</span><span class="op" id="4792581">.</span><span class="ident" id="4792582">buf</span><span class="op" id="4792585">)</span><span class="op" id="4792586">,</span>&nbsp;<span class="num" id="4792588">2</span><span class="op" id="4792589">*</span><span class="builtinfunc" id="4792590">cap</span><span class="op" id="4792593">(</span><span class="ident" id="4792594">dec</span><span class="op" id="4792597">.</span><span class="ident" id="4792598">buf</span><span class="op" id="4792601">)</span><span class="op" id="4792602">+</span><span class="ident" id="4792603">minRead</span><span class="op" id="4792610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4792615">copy</span><span class="op" id="4792619">(</span><span class="ident" id="4792620">newBuf</span><span class="op" id="4792626">,</span>&nbsp;<span class="ident" id="4792628">dec</span><span class="op" id="4792631">.</span><span class="ident" id="4792632">buf</span><span class="op" id="4792635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4792640">dec</span><span class="op" id="4792643">.</span><span class="ident" id="4792644">buf</span>&nbsp;<span class="op" id="4792648">=</span>&nbsp;<span class="ident" id="4792650">newBuf</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4792659">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4792664">//&nbsp;Read.&nbsp;&nbsp;Delay&nbsp;error&nbsp;for&nbsp;next&nbsp;iteration&nbsp;(after&nbsp;scan).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4792721">var</span>&nbsp;<span class="ident" id="4792725">n</span>&nbsp;<span class="builtintype" id="4792727">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4792733">n</span><span class="op" id="4792734">,</span>&nbsp;<span class="ident" id="4792736">err</span>&nbsp;<span class="op" id="4792740">=</span>&nbsp;<span class="ident" id="4792742">dec</span><span class="op" id="4792745">.</span><span class="ident" id="4792746">r</span><span class="op" id="4792747">.</span><span class="ident" id="4792748">Read</span><span class="op" id="4792752">(</span><span class="ident" id="4792753">dec</span><span class="op" id="4792756">.</span><span class="ident" id="4792757">buf</span><span class="op" id="4792760">[</span><span class="builtinfunc" id="4792761">len</span><span class="op" id="4792764">(</span><span class="ident" id="4792765">dec</span><span class="op" id="4792768">.</span><span class="ident" id="4792769">buf</span><span class="op" id="4792772">)</span><span class="op" id="4792773">:</span><span class="builtinfunc" id="4792774">cap</span><span class="op" id="4792777">(</span><span class="ident" id="4792778">dec</span><span class="op" id="4792781">.</span><span class="ident" id="4792782">buf</span><span class="op" id="4792785">)</span><span class="op" id="4792786">]</span><span class="op" id="4792787">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4792791">dec</span><span class="op" id="4792794">.</span><span class="ident" id="4792795">buf</span>&nbsp;<span class="op" id="4792799">=</span>&nbsp;<span class="ident" id="4792801">dec</span><span class="op" id="4792804">.</span><span class="ident" id="4792805">buf</span><span class="op" id="4792808">[</span><span class="num" id="4792809">0</span>&nbsp;<span class="op" id="4792811">:</span>&nbsp;<span class="builtinfunc" id="4792813">len</span><span class="op" id="4792816">(</span><span class="ident" id="4792817">dec</span><span class="op" id="4792820">.</span><span class="ident" id="4792821">buf</span><span class="op" id="4792824">)</span><span class="op" id="4792825">+</span><span class="ident" id="4792826">n</span><span class="op" id="4792827">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4792830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4792833">return</span>&nbsp;<span class="ident" id="4792840">scanp</span><span class="op" id="4792845">,</span>&nbsp;<span class="ident" id="4792847">nil</span><br>
<span class="lineno"></span><span class="op" id="4792851">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="4792854">func</span>&nbsp;<span class="ident" id="4792859">nonSpace</span><span class="op" id="4792867">(</span><span class="ident" id="4792868">b</span>&nbsp;<span class="op" id="4792870">[</span><span class="op" id="4792871">]</span><span class="builtintype" id="4792872">byte</span><span class="op" id="4792876">)</span>&nbsp;<span class="builtintype" id="4792878">bool</span>&nbsp;<span class="op" id="4792883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4792886">for</span>&nbsp;<span class="ident" id="4792890">_</span><span class="op" id="4792891">,</span>&nbsp;<span class="ident" id="4792893">c</span>&nbsp;<span class="op" id="4792895">:=</span>&nbsp;<span class="keyword" id="4792898">range</span>&nbsp;<span class="ident" id="4792904">b</span>&nbsp;<span class="op" id="4792906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4792910">if</span>&nbsp;<span class="op" id="4792913">!</span><span class="ident" id="4792914">isSpace</span><span class="op" id="4792921">(</span><span class="builtintype" id="4792922">rune</span><span class="op" id="4792926">(</span><span class="ident" id="4792927">c</span><span class="op" id="4792928">)</span><span class="op" id="4792929">)</span>&nbsp;<span class="op" id="4792931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4792936">return</span>&nbsp;<span class="ident" id="4792943">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4792950">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4792953">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4792956">return</span>&nbsp;<span class="ident" id="4792963">false</span><br>
<span class="lineno"></span><span class="op" id="4792969">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4792972">//&nbsp;An&nbsp;Encoder&nbsp;writes&nbsp;JSON&nbsp;objects&nbsp;to&nbsp;an&nbsp;output&nbsp;stream.</span><br>
<span class="lineno">140</span><span class="keyword" id="4793027">type</span>&nbsp;<span class="ident" id="4793032">Encoder</span>&nbsp;<span class="keyword" id="4793040">struct</span>&nbsp;<span class="op" id="4793047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4793050">w</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4793054">io</span><span class="op" id="4793056">.</span><span class="ident" id="4793057">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4793065">err</span>&nbsp;<span class="builtintype" id="4793069">error</span><br>
<span class="lineno"></span><span class="op" id="4793075">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="comment" id="4793078">//&nbsp;NewEncoder&nbsp;returns&nbsp;a&nbsp;new&nbsp;encoder&nbsp;that&nbsp;writes&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="4793132">func</span>&nbsp;<span class="ident" id="4793137">NewEncoder</span><span class="op" id="4793147">(</span><span class="ident" id="4793148">w</span>&nbsp;<span class="ident" id="4793150">io</span><span class="op" id="4793152">.</span><span class="ident" id="4793153">Writer</span><span class="op" id="4793159">)</span>&nbsp;<span class="op" id="4793161">*</span><span class="ident" id="4793162">Encoder</span>&nbsp;<span class="op" id="4793170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4793173">return</span>&nbsp;<span class="op" id="4793180">&amp;</span><span class="ident" id="4793181">Encoder</span><span class="op" id="4793188">{</span><span class="ident" id="4793189">w</span><span class="op" id="4793190">:</span>&nbsp;<span class="ident" id="4793192">w</span><span class="op" id="4793193">}</span><br>
<span class="lineno"></span><span class="op" id="4793195">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="comment" id="4793198">//&nbsp;Encode&nbsp;writes&nbsp;the&nbsp;JSON&nbsp;encoding&nbsp;of&nbsp;v&nbsp;to&nbsp;the&nbsp;stream,</span><br>
<span class="lineno"></span><span class="comment" id="4793253">//&nbsp;followed&nbsp;by&nbsp;a&nbsp;newline&nbsp;character.</span><br>
<span class="lineno"></span><span class="comment" id="4793289">//</span><br>
<span class="lineno"></span><span class="comment" id="4793292">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;Marshal&nbsp;for&nbsp;details&nbsp;about&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4793351">//&nbsp;conversion&nbsp;of&nbsp;Go&nbsp;values&nbsp;to&nbsp;JSON.</span><br>
<span class="lineno">155</span><span class="keyword" id="4793387">func</span>&nbsp;<span class="op" id="4793392">(</span><span class="ident" id="4793393">enc</span>&nbsp;<span class="op" id="4793397">*</span><span class="ident" id="4793398">Encoder</span><span class="op" id="4793405">)</span>&nbsp;<span class="ident" id="4793407">Encode</span><span class="op" id="4793413">(</span><span class="ident" id="4793414">v</span>&nbsp;<span class="keyword" id="4793416">interface</span><span class="op" id="4793425">{</span><span class="op" id="4793426">}</span><span class="op" id="4793427">)</span>&nbsp;<span class="builtintype" id="4793429">error</span>&nbsp;<span class="op" id="4793435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4793438">if</span>&nbsp;<span class="ident" id="4793441">enc</span><span class="op" id="4793444">.</span><span class="ident" id="4793445">err</span>&nbsp;<span class="op" id="4793449">!=</span>&nbsp;<span class="ident" id="4793452">nil</span>&nbsp;<span class="op" id="4793456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4793460">return</span>&nbsp;<span class="ident" id="4793467">enc</span><span class="op" id="4793470">.</span><span class="ident" id="4793471">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4793476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4793479">e</span>&nbsp;<span class="op" id="4793481">:=</span>&nbsp;<span class="ident" id="4793484">newEncodeState</span><span class="op" id="4793498">(</span><span class="op" id="4793499">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4793502">err</span>&nbsp;<span class="op" id="4793506">:=</span>&nbsp;<span class="ident" id="4793509">e</span><span class="op" id="4793510">.</span><span class="ident" id="4793511">marshal</span><span class="op" id="4793518">(</span><span class="ident" id="4793519">v</span><span class="op" id="4793520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4793523">if</span>&nbsp;<span class="ident" id="4793526">err</span>&nbsp;<span class="op" id="4793530">!=</span>&nbsp;<span class="ident" id="4793533">nil</span>&nbsp;<span class="op" id="4793537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4793541">return</span>&nbsp;<span class="ident" id="4793548">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4793553">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4793557">//&nbsp;Terminate&nbsp;each&nbsp;value&nbsp;with&nbsp;a&nbsp;newline.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4793598">//&nbsp;This&nbsp;makes&nbsp;the&nbsp;output&nbsp;look&nbsp;a&nbsp;little&nbsp;nicer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4793644">//&nbsp;when&nbsp;debugging,&nbsp;and&nbsp;some&nbsp;kind&nbsp;of&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4793687">//&nbsp;is&nbsp;required&nbsp;if&nbsp;the&nbsp;encoded&nbsp;value&nbsp;was&nbsp;a&nbsp;number,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4793738">//&nbsp;so&nbsp;that&nbsp;the&nbsp;reader&nbsp;knows&nbsp;there&nbsp;aren&#39;t&nbsp;more</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4793785">//&nbsp;digits&nbsp;coming.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4793804">e</span><span class="op" id="4793805">.</span><span class="ident" id="4793806">WriteByte</span><span class="op" id="4793815">(</span><span class="string" id="4793816">&#39;\n&#39;</span><span class="op" id="4793820">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4793824">if</span>&nbsp;<span class="ident" id="4793827">_</span><span class="op" id="4793828">,</span>&nbsp;<span class="ident" id="4793830">err</span>&nbsp;<span class="op" id="4793834">=</span>&nbsp;<span class="ident" id="4793836">enc</span><span class="op" id="4793839">.</span><span class="ident" id="4793840">w</span><span class="op" id="4793841">.</span><span class="ident" id="4793842">Write</span><span class="op" id="4793847">(</span><span class="ident" id="4793848">e</span><span class="op" id="4793849">.</span><span class="ident" id="4793850">Bytes</span><span class="op" id="4793855">(</span><span class="op" id="4793856">)</span><span class="op" id="4793857">)</span><span class="op" id="4793858">;</span>&nbsp;<span class="ident" id="4793860">err</span>&nbsp;<span class="op" id="4793864">!=</span>&nbsp;<span class="ident" id="4793867">nil</span>&nbsp;<span class="op" id="4793871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4793875">enc</span><span class="op" id="4793878">.</span><span class="ident" id="4793879">err</span>&nbsp;<span class="op" id="4793883">=</span>&nbsp;<span class="ident" id="4793885">err</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4793890">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4793893">encodeStatePool</span><span class="op" id="4793908">.</span><span class="ident" id="4793909">Put</span><span class="op" id="4793912">(</span><span class="ident" id="4793913">e</span><span class="op" id="4793914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4793917">return</span>&nbsp;<span class="ident" id="4793924">err</span><br>
<span class="lineno"></span><span class="op" id="4793928">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="comment" id="4793931">//&nbsp;RawMessage&nbsp;is&nbsp;a&nbsp;raw&nbsp;encoded&nbsp;JSON&nbsp;object.</span><br>
<span class="lineno"></span><span class="comment" id="4793975">//&nbsp;It&nbsp;implements&nbsp;Marshaler&nbsp;and&nbsp;Unmarshaler&nbsp;and&nbsp;can</span><br>
<span class="lineno"></span><span class="comment" id="4794026">//&nbsp;be&nbsp;used&nbsp;to&nbsp;delay&nbsp;JSON&nbsp;decoding&nbsp;or&nbsp;precompute&nbsp;a&nbsp;JSON&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="4794091">type</span>&nbsp;<span class="ident" id="4794096">RawMessage</span>&nbsp;<span class="op" id="4794107">[</span><span class="op" id="4794108">]</span><span class="builtintype" id="4794109">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="comment" id="4794115">//&nbsp;MarshalJSON&nbsp;returns&nbsp;*m&nbsp;as&nbsp;the&nbsp;JSON&nbsp;encoding&nbsp;of&nbsp;m.</span><br>
<span class="lineno"></span><span class="keyword" id="4794168">func</span>&nbsp;<span class="op" id="4794173">(</span><span class="ident" id="4794174">m</span>&nbsp;<span class="op" id="4794176">*</span><span class="ident" id="4794177">RawMessage</span><span class="op" id="4794187">)</span>&nbsp;<span class="ident" id="4794189">MarshalJSON</span><span class="op" id="4794200">(</span><span class="op" id="4794201">)</span>&nbsp;<span class="op" id="4794203">(</span><span class="op" id="4794204">[</span><span class="op" id="4794205">]</span><span class="builtintype" id="4794206">byte</span><span class="op" id="4794210">,</span>&nbsp;<span class="builtintype" id="4794212">error</span><span class="op" id="4794217">)</span>&nbsp;<span class="op" id="4794219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4794222">return</span>&nbsp;<span class="op" id="4794229">*</span><span class="ident" id="4794230">m</span><span class="op" id="4794231">,</span>&nbsp;<span class="ident" id="4794233">nil</span><br>
<span class="lineno"></span><span class="op" id="4794237">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="comment" id="4794240">//&nbsp;UnmarshalJSON&nbsp;sets&nbsp;*m&nbsp;to&nbsp;a&nbsp;copy&nbsp;of&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="4794284">func</span>&nbsp;<span class="op" id="4794289">(</span><span class="ident" id="4794290">m</span>&nbsp;<span class="op" id="4794292">*</span><span class="ident" id="4794293">RawMessage</span><span class="op" id="4794303">)</span>&nbsp;<span class="ident" id="4794305">UnmarshalJSON</span><span class="op" id="4794318">(</span><span class="ident" id="4794319">data</span>&nbsp;<span class="op" id="4794324">[</span><span class="op" id="4794325">]</span><span class="builtintype" id="4794326">byte</span><span class="op" id="4794330">)</span>&nbsp;<span class="builtintype" id="4794332">error</span>&nbsp;<span class="op" id="4794338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4794341">if</span>&nbsp;<span class="ident" id="4794344">m</span>&nbsp;<span class="op" id="4794346">==</span>&nbsp;<span class="ident" id="4794349">nil</span>&nbsp;<span class="op" id="4794353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4794357">return</span>&nbsp;<span class="ident" id="4794364">errors</span><span class="op" id="4794370">.</span><span class="ident" id="4794371">New</span><span class="op" id="4794374">(</span><span class="string" id="4794375">&#34;json.RawMessage:&nbsp;UnmarshalJSON&nbsp;on&nbsp;nil&nbsp;pointer&#34;</span><span class="op" id="4794422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4794425">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4794428">*</span><span class="ident" id="4794429">m</span>&nbsp;<span class="op" id="4794431">=</span>&nbsp;<span class="builtinfunc" id="4794433">append</span><span class="op" id="4794439">(</span><span class="op" id="4794440">(</span><span class="op" id="4794441">*</span><span class="ident" id="4794442">m</span><span class="op" id="4794443">)</span><span class="op" id="4794444">[</span><span class="num" id="4794445">0</span><span class="op" id="4794446">:</span><span class="num" id="4794447">0</span><span class="op" id="4794448">]</span><span class="op" id="4794449">,</span>&nbsp;<span class="ident" id="4794451">data</span><span class="op" id="4794455">...</span><span class="op" id="4794458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4794461">return</span>&nbsp;<span class="ident" id="4794468">nil</span><br>
<span class="lineno"></span><span class="op" id="4794472">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4794475">var</span>&nbsp;<span class="ident" id="4794479">_</span>&nbsp;<span class="ident" id="4794481">Marshaler</span>&nbsp;<span class="op" id="4794491">=</span>&nbsp;<span class="op" id="4794493">(</span><span class="op" id="4794494">*</span><span class="ident" id="4794495">RawMessage</span><span class="op" id="4794505">)</span><span class="op" id="4794506">(</span><span class="ident" id="4794507">nil</span><span class="op" id="4794510">)</span><br>
<span class="lineno">200</span><span class="keyword" id="4794512">var</span>&nbsp;<span class="ident" id="4794516">_</span>&nbsp;<span class="ident" id="4794518">Unmarshaler</span>&nbsp;<span class="op" id="4794530">=</span>&nbsp;<span class="op" id="4794532">(</span><span class="op" id="4794533">*</span><span class="ident" id="4794534">RawMessage</span><span class="op" id="4794544">)</span><span class="op" id="4794545">(</span><span class="ident" id="4794546">nil</span><span class="op" id="4794549">)</span>
</div>
</body>
</html>
