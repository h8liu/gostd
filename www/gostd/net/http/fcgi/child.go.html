<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/fcgi</h2>
<ul>
<li><a href="/gostd/net/http/fcgi/child.go.html" class="current">child.go</a></li>
<li><a href="/gostd/net/http/fcgi/fcgi.go.html">fcgi.go</a></li>
<li><a href="/gostd/net/http/fcgi/fcgi_test.go.html">fcgi_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6033927">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6033982">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6034036">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6034087">package</span>&nbsp;<span class="ident" id="6034095">fcgi</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6034101">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;FastCGI&nbsp;from&nbsp;the&nbsp;perspective&nbsp;of&nbsp;a&nbsp;child&nbsp;process.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6034175">import</span>&nbsp;<span class="op" id="6034182">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6034185">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6034195">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6034202">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6034208">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6034221">&#34;net&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6034228">&#34;net/http&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6034240">&#34;net/http/cgi&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6034256">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6034262">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6034273">&#34;sync&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6034281">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6034288">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6034291">//&nbsp;request&nbsp;holds&nbsp;the&nbsp;state&nbsp;for&nbsp;an&nbsp;in-progress&nbsp;request.&nbsp;As&nbsp;soon&nbsp;as&nbsp;it&#39;s&nbsp;complete,</span><br>
<span class="lineno"></span><span class="comment" id="6034372">//&nbsp;it&#39;s&nbsp;converted&nbsp;to&nbsp;an&nbsp;http.Request.</span><br>
<span class="lineno">25</span><span class="keyword" id="6034410">type</span>&nbsp;<span class="ident" id="6034415">request</span>&nbsp;<span class="keyword" id="6034423">struct</span>&nbsp;<span class="op" id="6034430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6034433">pw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6034443">*</span><span class="ident" id="6034444"><a href="/gostd/net/http/fcgi/child.go.html#6034202">io</a></span><span class="op" id="6034446">.</span><span class="ident" id="6034447"><a href="/gostd/io/pipe.go.html#1439021">PipeWriter</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6034459">reqId</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6034469">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6034477">params</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6034487">map</span><span class="op" id="6034490">[</span><span class="builtintype" id="6034491">string</span><span class="op" id="6034497">]</span><span class="builtintype" id="6034498">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6034506">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6034516">[</span><span class="num" id="6034517">1024</span><span class="op" id="6034521">]</span><span class="builtintype" id="6034522">byte</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6034528">rawParams</span>&nbsp;<span class="op" id="6034538">[</span><span class="op" id="6034539">]</span><span class="builtintype" id="6034540">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6034546">keepConn</span>&nbsp;&nbsp;<span class="builtintype" id="6034556">bool</span><br>
<span class="lineno"></span><span class="op" id="6034561">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6034564">func</span>&nbsp;<span class="ident" id="6034569">newRequest</span><span class="op" id="6034579">(</span><span class="ident" id="6034580">reqId</span>&nbsp;<span class="builtintype" id="6034586">uint16</span><span class="op" id="6034592">,</span>&nbsp;<span class="ident" id="6034594">flags</span>&nbsp;<span class="builtintype" id="6034600">uint8</span><span class="op" id="6034605">)</span>&nbsp;<span class="op" id="6034607">*</span><span class="ident" id="6034608"><a href="/gostd/net/http/fcgi/child.go.html#6034415">request</a></span>&nbsp;<span class="op" id="6034616">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6034619">r</span>&nbsp;<span class="op" id="6034621">:=</span>&nbsp;<span class="op" id="6034624">&amp;</span><span class="ident" id="6034625"><a href="/gostd/net/http/fcgi/child.go.html#6034415">request</a></span><span class="op" id="6034632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6034636"><a href="/gostd/net/http/fcgi/child.go.html#6034459">reqId</a></span><span class="op" id="6034641">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6034646"><a href="/gostd/net/http/fcgi/child.go.html#6034580">reqId</a></span><span class="op" id="6034651">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6034655"><a href="/gostd/net/http/fcgi/child.go.html#6034477">params</a></span><span class="op" id="6034661">:</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="6034665">map</span><span class="op" id="6034668">[</span><span class="builtintype" id="6034669">string</span><span class="op" id="6034675">]</span><span class="builtintype" id="6034676">string</span><span class="op" id="6034682">{</span><span class="op" id="6034683">}</span><span class="op" id="6034684">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6034688"><a href="/gostd/net/http/fcgi/child.go.html#6034546">keepConn</a></span><span class="op" id="6034696">:</span>&nbsp;<span class="ident" id="6034698"><a href="/gostd/net/http/fcgi/child.go.html#6034594">flags</a></span><span class="op" id="6034703">&amp;</span><span class="ident" id="6034704"><a href="/gostd/net/http/fcgi/fcgi.go.html#6042200">flagKeepConn</a></span>&nbsp;<span class="op" id="6034717">!=</span>&nbsp;<span class="num" id="6034720">0</span><span class="op" id="6034721">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6034724">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6034727"><a href="/gostd/net/http/fcgi/child.go.html#6034619">r</a></span><span class="op" id="6034728">.</span><span class="ident" id="6034729"><a href="/gostd/net/http/fcgi/child.go.html#6034528">rawParams</a></span>&nbsp;<span class="op" id="6034739">=</span>&nbsp;<span class="ident" id="6034741"><a href="/gostd/net/http/fcgi/child.go.html#6034619">r</a></span><span class="op" id="6034742">.</span><span class="ident" id="6034743"><a href="/gostd/net/http/fcgi/child.go.html#6034506">buf</a></span><span class="op" id="6034746">[</span><span class="op" id="6034747">:</span><span class="num" id="6034748">0</span><span class="op" id="6034749">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6034752">return</span>&nbsp;<span class="ident" id="6034759"><a href="/gostd/net/http/fcgi/child.go.html#6034619">r</a></span><br>
<span class="lineno"></span><span class="op" id="6034761">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6034764">//&nbsp;parseParams&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;[]byte&nbsp;into&nbsp;Params.</span><br>
<span class="lineno">45</span><span class="keyword" id="6034816">func</span>&nbsp;<span class="op" id="6034821">(</span><span class="ident" id="6034822">r</span>&nbsp;<span class="op" id="6034824">*</span><span class="ident" id="6034825"><a href="/gostd/net/http/fcgi/child.go.html#6034415">request</a></span><span class="op" id="6034832">)</span>&nbsp;<span class="ident" id="6034834">parseParams</span><span class="op" id="6034845">(</span><span class="op" id="6034846">)</span>&nbsp;<span class="op" id="6034848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6034851">text</span>&nbsp;<span class="op" id="6034856">:=</span>&nbsp;<span class="ident" id="6034859"><a href="/gostd/net/http/fcgi/child.go.html#6034822">r</a></span><span class="op" id="6034860">.</span><span class="ident" id="6034861"><a href="/gostd/net/http/fcgi/child.go.html#6034528">rawParams</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6034872"><a href="/gostd/net/http/fcgi/child.go.html#6034822">r</a></span><span class="op" id="6034873">.</span><span class="ident" id="6034874"><a href="/gostd/net/http/fcgi/child.go.html#6034528">rawParams</a></span>&nbsp;<span class="op" id="6034884">=</span>&nbsp;<span class="builtintype" id="6034886">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6034891">for</span>&nbsp;<span class="builtinfunc" id="6034895">len</span><span class="op" id="6034898">(</span><span class="ident" id="6034899"><a href="/gostd/net/http/fcgi/child.go.html#6034851">text</a></span><span class="op" id="6034903">)</span>&nbsp;<span class="op" id="6034905">&gt;</span>&nbsp;<span class="num" id="6034907">0</span>&nbsp;<span class="op" id="6034909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6034913">keyLen</span><span class="op" id="6034919">,</span>&nbsp;<span class="ident" id="6034921">n</span>&nbsp;<span class="op" id="6034923">:=</span>&nbsp;<span class="ident" id="6034926"><a href="/gostd/net/http/fcgi/fcgi.go.html#6045522">readSize</a></span><span class="op" id="6034934">(</span><span class="ident" id="6034935"><a href="/gostd/net/http/fcgi/child.go.html#6034851">text</a></span><span class="op" id="6034939">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6034943">if</span>&nbsp;<span class="ident" id="6034946"><a href="/gostd/net/http/fcgi/child.go.html#6034921">n</a></span>&nbsp;<span class="op" id="6034948">==</span>&nbsp;<span class="num" id="6034951">0</span>&nbsp;<span class="op" id="6034953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6034958">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6034967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6034971"><a href="/gostd/net/http/fcgi/child.go.html#6034851">text</a></span>&nbsp;<span class="op" id="6034976">=</span>&nbsp;<span class="ident" id="6034978"><a href="/gostd/net/http/fcgi/child.go.html#6034851">text</a></span><span class="op" id="6034982">[</span><span class="ident" id="6034983"><a href="/gostd/net/http/fcgi/child.go.html#6034921">n</a></span><span class="op" id="6034984">:</span><span class="op" id="6034985">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6034989">valLen</span><span class="op" id="6034995">,</span>&nbsp;<span class="ident" id="6034997"><a href="/gostd/net/http/fcgi/child.go.html#6034921">n</a></span>&nbsp;<span class="op" id="6034999">:=</span>&nbsp;<span class="ident" id="6035002"><a href="/gostd/net/http/fcgi/fcgi.go.html#6045522">readSize</a></span><span class="op" id="6035010">(</span><span class="ident" id="6035011"><a href="/gostd/net/http/fcgi/child.go.html#6034851">text</a></span><span class="op" id="6035015">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6035019">if</span>&nbsp;<span class="ident" id="6035022"><a href="/gostd/net/http/fcgi/child.go.html#6034921">n</a></span>&nbsp;<span class="op" id="6035024">==</span>&nbsp;<span class="num" id="6035027">0</span>&nbsp;<span class="op" id="6035029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6035034">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6035043">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6035047"><a href="/gostd/net/http/fcgi/child.go.html#6034851">text</a></span>&nbsp;<span class="op" id="6035052">=</span>&nbsp;<span class="ident" id="6035054"><a href="/gostd/net/http/fcgi/child.go.html#6034851">text</a></span><span class="op" id="6035058">[</span><span class="ident" id="6035059"><a href="/gostd/net/http/fcgi/child.go.html#6034921">n</a></span><span class="op" id="6035060">:</span><span class="op" id="6035061">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6035065">key</span>&nbsp;<span class="op" id="6035069">:=</span>&nbsp;<span class="ident" id="6035072"><a href="/gostd/net/http/fcgi/fcgi.go.html#6045770">readString</a></span><span class="op" id="6035082">(</span><span class="ident" id="6035083"><a href="/gostd/net/http/fcgi/child.go.html#6034851">text</a></span><span class="op" id="6035087">,</span>&nbsp;<span class="ident" id="6035089"><a href="/gostd/net/http/fcgi/child.go.html#6034913">keyLen</a></span><span class="op" id="6035095">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6035099"><a href="/gostd/net/http/fcgi/child.go.html#6034851">text</a></span>&nbsp;<span class="op" id="6035104">=</span>&nbsp;<span class="ident" id="6035106"><a href="/gostd/net/http/fcgi/child.go.html#6034851">text</a></span><span class="op" id="6035110">[</span><span class="ident" id="6035111"><a href="/gostd/net/http/fcgi/child.go.html#6034913">keyLen</a></span><span class="op" id="6035117">:</span><span class="op" id="6035118">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6035122">val</span>&nbsp;<span class="op" id="6035126">:=</span>&nbsp;<span class="ident" id="6035129"><a href="/gostd/net/http/fcgi/fcgi.go.html#6045770">readString</a></span><span class="op" id="6035139">(</span><span class="ident" id="6035140"><a href="/gostd/net/http/fcgi/child.go.html#6034851">text</a></span><span class="op" id="6035144">,</span>&nbsp;<span class="ident" id="6035146"><a href="/gostd/net/http/fcgi/child.go.html#6034989">valLen</a></span><span class="op" id="6035152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6035156"><a href="/gostd/net/http/fcgi/child.go.html#6034851">text</a></span>&nbsp;<span class="op" id="6035161">=</span>&nbsp;<span class="ident" id="6035163"><a href="/gostd/net/http/fcgi/child.go.html#6034851">text</a></span><span class="op" id="6035167">[</span><span class="ident" id="6035168"><a href="/gostd/net/http/fcgi/child.go.html#6034989">valLen</a></span><span class="op" id="6035174">:</span><span class="op" id="6035175">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6035179"><a href="/gostd/net/http/fcgi/child.go.html#6034822">r</a></span><span class="op" id="6035180">.</span><span class="ident" id="6035181"><a href="/gostd/net/http/fcgi/child.go.html#6034477">params</a></span><span class="op" id="6035187">[</span><span class="ident" id="6035188"><a href="/gostd/net/http/fcgi/child.go.html#6035065">key</a></span><span class="op" id="6035191">]</span>&nbsp;<span class="op" id="6035193">=</span>&nbsp;<span class="ident" id="6035195"><a href="/gostd/net/http/fcgi/child.go.html#6035122">val</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6035200">}</span><br>
<span class="lineno">65</span><span class="op" id="6035202">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6035205">//&nbsp;response&nbsp;implements&nbsp;http.ResponseWriter.</span><br>
<span class="lineno"></span><span class="keyword" id="6035249">type</span>&nbsp;<span class="ident" id="6035254">response</span>&nbsp;<span class="keyword" id="6035263">struct</span>&nbsp;<span class="op" id="6035270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6035273">req</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6035285">*</span><span class="ident" id="6035286"><a href="/gostd/net/http/fcgi/child.go.html#6034415">request</a></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6035295">header</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6035307"><a href="/gostd/net/http/fcgi/child.go.html#6034228">http</a></span><span class="op" id="6035311">.</span><span class="ident" id="6035312"><a href="/gostd/net/http/header.go.html#4126117">Header</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6035320">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6035332">*</span><span class="ident" id="6035333"><a href="/gostd/net/http/fcgi/fcgi.go.html#6046146">bufWriter</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6035344">wroteHeader</span>&nbsp;<span class="builtintype" id="6035356">bool</span><br>
<span class="lineno"></span><span class="op" id="6035361">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="6035364">func</span>&nbsp;<span class="ident" id="6035369">newResponse</span><span class="op" id="6035380">(</span><span class="ident" id="6035381">c</span>&nbsp;<span class="op" id="6035383">*</span><span class="ident" id="6035384"><a href="/gostd/net/http/fcgi/child.go.html#6036494">child</a></span><span class="op" id="6035389">,</span>&nbsp;<span class="ident" id="6035391">req</span>&nbsp;<span class="op" id="6035395">*</span><span class="ident" id="6035396"><a href="/gostd/net/http/fcgi/child.go.html#6034415">request</a></span><span class="op" id="6035403">)</span>&nbsp;<span class="op" id="6035405">*</span><span class="ident" id="6035406"><a href="/gostd/net/http/fcgi/child.go.html#6035254">response</a></span>&nbsp;<span class="op" id="6035415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6035418">return</span>&nbsp;<span class="op" id="6035425">&amp;</span><span class="ident" id="6035426"><a href="/gostd/net/http/fcgi/child.go.html#6035254">response</a></span><span class="op" id="6035434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6035438"><a href="/gostd/net/http/fcgi/child.go.html#6035273">req</a></span><span class="op" id="6035441">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6035446"><a href="/gostd/net/http/fcgi/child.go.html#6035391">req</a></span><span class="op" id="6035449">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6035453"><a href="/gostd/net/http/fcgi/child.go.html#6035295">header</a></span><span class="op" id="6035459">:</span>&nbsp;<span class="ident" id="6035461"><a href="/gostd/net/http/fcgi/child.go.html#6034228">http</a></span><span class="op" id="6035465">.</span><span class="ident" id="6035466"><a href="/gostd/net/http/header.go.html#4126117">Header</a></span><span class="op" id="6035472">{</span><span class="op" id="6035473">}</span><span class="op" id="6035474">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6035478"><a href="/gostd/net/http/fcgi/child.go.html#6035320">w</a></span><span class="op" id="6035479">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6035486"><a href="/gostd/net/http/fcgi/fcgi.go.html#6046347">newWriter</a></span><span class="op" id="6035495">(</span><span class="ident" id="6035496"><a href="/gostd/net/http/fcgi/child.go.html#6035381">c</a></span><span class="op" id="6035497">.</span><span class="ident" id="6035498"><a href="/gostd/net/http/fcgi/child.go.html#6036510">conn</a></span><span class="op" id="6035502">,</span>&nbsp;<span class="ident" id="6035504"><a href="/gostd/net/http/fcgi/fcgi.go.html#6041917">typeStdout</a></span><span class="op" id="6035514">,</span>&nbsp;<span class="ident" id="6035516"><a href="/gostd/net/http/fcgi/child.go.html#6035391">req</a></span><span class="op" id="6035519">.</span><span class="ident" id="6035520"><a href="/gostd/net/http/fcgi/child.go.html#6034459">reqId</a></span><span class="op" id="6035525">)</span><span class="op" id="6035526">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6035529">}</span><br>
<span class="lineno"></span><span class="op" id="6035531">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6035534">func</span>&nbsp;<span class="op" id="6035539">(</span><span class="ident" id="6035540">r</span>&nbsp;<span class="op" id="6035542">*</span><span class="ident" id="6035543"><a href="/gostd/net/http/fcgi/child.go.html#6035254">response</a></span><span class="op" id="6035551">)</span>&nbsp;<span class="ident" id="6035553">Header</span><span class="op" id="6035559">(</span><span class="op" id="6035560">)</span>&nbsp;<span class="ident" id="6035562"><a href="/gostd/net/http/fcgi/child.go.html#6034228">http</a></span><span class="op" id="6035566">.</span><span class="ident" id="6035567"><a href="/gostd/net/http/header.go.html#4126117">Header</a></span>&nbsp;<span class="op" id="6035574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6035577">return</span>&nbsp;<span class="ident" id="6035584"><a href="/gostd/net/http/fcgi/child.go.html#6035540">r</a></span><span class="op" id="6035585">.</span><span class="ident" id="6035586"><a href="/gostd/net/http/fcgi/child.go.html#6035295">header</a></span><br>
<span class="lineno">85</span><span class="op" id="6035593">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6035596">func</span>&nbsp;<span class="op" id="6035601">(</span><span class="ident" id="6035602">r</span>&nbsp;<span class="op" id="6035604">*</span><span class="ident" id="6035605"><a href="/gostd/net/http/fcgi/child.go.html#6035254">response</a></span><span class="op" id="6035613">)</span>&nbsp;<span class="ident" id="6035615">Write</span><span class="op" id="6035620">(</span><span class="ident" id="6035621">data</span>&nbsp;<span class="op" id="6035626">[</span><span class="op" id="6035627">]</span><span class="builtintype" id="6035628">byte</span><span class="op" id="6035632">)</span>&nbsp;<span class="op" id="6035634">(</span><span class="builtintype" id="6035635">int</span><span class="op" id="6035638">,</span>&nbsp;<span class="builtintype" id="6035640">error</span><span class="op" id="6035645">)</span>&nbsp;<span class="op" id="6035647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6035650">if</span>&nbsp;<span class="op" id="6035653">!</span><span class="ident" id="6035654"><a href="/gostd/net/http/fcgi/child.go.html#6035602">r</a></span><span class="op" id="6035655">.</span><span class="ident" id="6035656"><a href="/gostd/net/http/fcgi/child.go.html#6035344">wroteHeader</a></span>&nbsp;<span class="op" id="6035668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6035672"><a href="/gostd/net/http/fcgi/child.go.html#6035602">r</a></span><span class="op" id="6035673">.</span><span class="ident" id="6035674"><a href="/gostd/net/http/fcgi/child.go.html#6035750">WriteHeader</a></span><span class="op" id="6035685">(</span><span class="ident" id="6035686"><a href="/gostd/net/http/fcgi/child.go.html#6034228">http</a></span><span class="op" id="6035690">.</span><span class="ident" id="6035691"><a href="/gostd/net/http/status.go.html#4236210">StatusOK</a></span><span class="op" id="6035699">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6035702">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6035705">return</span>&nbsp;<span class="ident" id="6035712"><a href="/gostd/net/http/fcgi/child.go.html#6035602">r</a></span><span class="op" id="6035713">.</span><span class="ident" id="6035714"><a href="/gostd/net/http/fcgi/child.go.html#6035320">w</a></span><span class="op" id="6035715">.</span><span class="ident" id="6035716"><a href="/gostd/bufio/bufio.go.html#1368329">Write</a></span><span class="op" id="6035721">(</span><span class="ident" id="6035722"><a href="/gostd/net/http/fcgi/child.go.html#6035621">data</a></span><span class="op" id="6035726">)</span><br>
<span class="lineno"></span><span class="op" id="6035728">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6035731">func</span>&nbsp;<span class="op" id="6035736">(</span><span class="ident" id="6035737">r</span>&nbsp;<span class="op" id="6035739">*</span><span class="ident" id="6035740"><a href="/gostd/net/http/fcgi/child.go.html#6035254">response</a></span><span class="op" id="6035748">)</span>&nbsp;<span class="ident" id="6035750">WriteHeader</span><span class="op" id="6035761">(</span><span class="ident" id="6035762">code</span>&nbsp;<span class="builtintype" id="6035767">int</span><span class="op" id="6035770">)</span>&nbsp;<span class="op" id="6035772">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6035775">if</span>&nbsp;<span class="ident" id="6035778"><a href="/gostd/net/http/fcgi/child.go.html#6035737">r</a></span><span class="op" id="6035779">.</span><span class="ident" id="6035780"><a href="/gostd/net/http/fcgi/child.go.html#6035344">wroteHeader</a></span>&nbsp;<span class="op" id="6035792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6035796">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6035804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6035807"><a href="/gostd/net/http/fcgi/child.go.html#6035737">r</a></span><span class="op" id="6035808">.</span><span class="ident" id="6035809"><a href="/gostd/net/http/fcgi/child.go.html#6035344">wroteHeader</a></span>&nbsp;<span class="op" id="6035821">=</span>&nbsp;<span class="builtintype" id="6035823">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6035829">if</span>&nbsp;<span class="ident" id="6035832"><a href="/gostd/net/http/fcgi/child.go.html#6035762">code</a></span>&nbsp;<span class="op" id="6035837">==</span>&nbsp;<span class="ident" id="6035840"><a href="/gostd/net/http/fcgi/child.go.html#6034228">http</a></span><span class="op" id="6035844">.</span><span class="ident" id="6035845"><a href="/gostd/net/http/status.go.html#4236573">StatusNotModified</a></span>&nbsp;<span class="op" id="6035863">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6035867">//&nbsp;Must&nbsp;not&nbsp;have&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6035892"><a href="/gostd/net/http/fcgi/child.go.html#6035737">r</a></span><span class="op" id="6035893">.</span><span class="ident" id="6035894"><a href="/gostd/net/http/fcgi/child.go.html#6035295">header</a></span><span class="op" id="6035900">.</span><span class="ident" id="6035901"><a href="/gostd/net/http/header.go.html#4127099">Del</a></span><span class="op" id="6035904">(</span><span class="string" id="6035905">&#34;Content-Type&#34;</span><span class="op" id="6035919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6035923"><a href="/gostd/net/http/fcgi/child.go.html#6035737">r</a></span><span class="op" id="6035924">.</span><span class="ident" id="6035925"><a href="/gostd/net/http/fcgi/child.go.html#6035295">header</a></span><span class="op" id="6035931">.</span><span class="ident" id="6035932"><a href="/gostd/net/http/header.go.html#4127099">Del</a></span><span class="op" id="6035935">(</span><span class="string" id="6035936">&#34;Content-Length&#34;</span><span class="op" id="6035952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6035956"><a href="/gostd/net/http/fcgi/child.go.html#6035737">r</a></span><span class="op" id="6035957">.</span><span class="ident" id="6035958"><a href="/gostd/net/http/fcgi/child.go.html#6035295">header</a></span><span class="op" id="6035964">.</span><span class="ident" id="6035965"><a href="/gostd/net/http/header.go.html#4127099">Del</a></span><span class="op" id="6035968">(</span><span class="string" id="6035969">&#34;Transfer-Encoding&#34;</span><span class="op" id="6035988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6035991">}</span>&nbsp;<span class="keyword" id="6035993">else</span>&nbsp;<span class="keyword" id="6035998">if</span>&nbsp;<span class="ident" id="6036001"><a href="/gostd/net/http/fcgi/child.go.html#6035737">r</a></span><span class="op" id="6036002">.</span><span class="ident" id="6036003"><a href="/gostd/net/http/fcgi/child.go.html#6035295">header</a></span><span class="op" id="6036009">.</span><span class="ident" id="6036010"><a href="/gostd/net/http/header.go.html#4126793">Get</a></span><span class="op" id="6036013">(</span><span class="string" id="6036014">&#34;Content-Type&#34;</span><span class="op" id="6036028">)</span>&nbsp;<span class="op" id="6036030">==</span>&nbsp;<span class="string" id="6036033">&#34;&#34;</span>&nbsp;<span class="op" id="6036036">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6036040"><a href="/gostd/net/http/fcgi/child.go.html#6035737">r</a></span><span class="op" id="6036041">.</span><span class="ident" id="6036042"><a href="/gostd/net/http/fcgi/child.go.html#6035295">header</a></span><span class="op" id="6036048">.</span><span class="ident" id="6036049"><a href="/gostd/net/http/header.go.html#4126491">Set</a></span><span class="op" id="6036052">(</span><span class="string" id="6036053">&#34;Content-Type&#34;</span><span class="op" id="6036067">,</span>&nbsp;<span class="string" id="6036069">&#34;text/html;&nbsp;charset=utf-8&#34;</span><span class="op" id="6036095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6036098">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6036102">if</span>&nbsp;<span class="ident" id="6036105"><a href="/gostd/net/http/fcgi/child.go.html#6035737">r</a></span><span class="op" id="6036106">.</span><span class="ident" id="6036107"><a href="/gostd/net/http/fcgi/child.go.html#6035295">header</a></span><span class="op" id="6036113">.</span><span class="ident" id="6036114"><a href="/gostd/net/http/header.go.html#4126793">Get</a></span><span class="op" id="6036117">(</span><span class="string" id="6036118">&#34;Date&#34;</span><span class="op" id="6036124">)</span>&nbsp;<span class="op" id="6036126">==</span>&nbsp;<span class="string" id="6036129">&#34;&#34;</span>&nbsp;<span class="op" id="6036132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6036136"><a href="/gostd/net/http/fcgi/child.go.html#6035737">r</a></span><span class="op" id="6036137">.</span><span class="ident" id="6036138"><a href="/gostd/net/http/fcgi/child.go.html#6035295">header</a></span><span class="op" id="6036144">.</span><span class="ident" id="6036145"><a href="/gostd/net/http/header.go.html#4126491">Set</a></span><span class="op" id="6036148">(</span><span class="string" id="6036149">&#34;Date&#34;</span><span class="op" id="6036155">,</span>&nbsp;<span class="ident" id="6036157"><a href="/gostd/net/http/fcgi/child.go.html#6034281">time</a></span><span class="op" id="6036161">.</span><span class="ident" id="6036162"><a href="/gostd/time/time.go.html#2743088">Now</a></span><span class="op" id="6036165">(</span><span class="op" id="6036166">)</span><span class="op" id="6036167">.</span><span class="ident" id="6036168"><a href="/gostd/time/time.go.html#2743233">UTC</a></span><span class="op" id="6036171">(</span><span class="op" id="6036172">)</span><span class="op" id="6036173">.</span><span class="ident" id="6036174"><a href="/gostd/time/format.go.html#2690960">Format</a></span><span class="op" id="6036180">(</span><span class="ident" id="6036181"><a href="/gostd/net/http/fcgi/child.go.html#6034228">http</a></span><span class="op" id="6036185">.</span><span class="ident" id="6036186"><a href="/gostd/net/http/server.go.html#4184253">TimeFormat</a></span><span class="op" id="6036196">)</span><span class="op" id="6036197">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6036200">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6036204"><a href="/gostd/net/http/fcgi/child.go.html#6034195">fmt</a></span><span class="op" id="6036207">.</span><span class="ident" id="6036208"><a href="/gostd/fmt/print.go.html#2143118">Fprintf</a></span><span class="op" id="6036215">(</span><span class="ident" id="6036216"><a href="/gostd/net/http/fcgi/child.go.html#6035737">r</a></span><span class="op" id="6036217">.</span><span class="ident" id="6036218"><a href="/gostd/net/http/fcgi/child.go.html#6035320">w</a></span><span class="op" id="6036219">,</span>&nbsp;<span class="string" id="6036221">&#34;Status:&nbsp;%d&nbsp;%s\r\n&#34;</span><span class="op" id="6036240">,</span>&nbsp;<span class="ident" id="6036242"><a href="/gostd/net/http/fcgi/child.go.html#6035762">code</a></span><span class="op" id="6036246">,</span>&nbsp;<span class="ident" id="6036248"><a href="/gostd/net/http/fcgi/child.go.html#6034228">http</a></span><span class="op" id="6036252">.</span><span class="ident" id="6036253"><a href="/gostd/net/http/status.go.html#4240526">StatusText</a></span><span class="op" id="6036263">(</span><span class="ident" id="6036264"><a href="/gostd/net/http/fcgi/child.go.html#6035762">code</a></span><span class="op" id="6036268">)</span><span class="op" id="6036269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6036272"><a href="/gostd/net/http/fcgi/child.go.html#6035737">r</a></span><span class="op" id="6036273">.</span><span class="ident" id="6036274"><a href="/gostd/net/http/fcgi/child.go.html#6035295">header</a></span><span class="op" id="6036280">.</span><span class="ident" id="6036281"><a href="/gostd/net/http/header.go.html#4127211">Write</a></span><span class="op" id="6036286">(</span><span class="ident" id="6036287"><a href="/gostd/net/http/fcgi/child.go.html#6035737">r</a></span><span class="op" id="6036288">.</span><span class="ident" id="6036289"><a href="/gostd/net/http/fcgi/child.go.html#6035320">w</a></span><span class="op" id="6036290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6036293"><a href="/gostd/net/http/fcgi/child.go.html#6035737">r</a></span><span class="op" id="6036294">.</span><span class="ident" id="6036295"><a href="/gostd/net/http/fcgi/child.go.html#6035320">w</a></span><span class="op" id="6036296">.</span><span class="ident" id="6036297"><a href="/gostd/bufio/bufio.go.html#1369779">WriteString</a></span><span class="op" id="6036308">(</span><span class="string" id="6036309">&#34;\r\n&#34;</span><span class="op" id="6036315">)</span><br>
<span class="lineno">115</span><span class="op" id="6036317">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6036320">func</span>&nbsp;<span class="op" id="6036325">(</span><span class="ident" id="6036326">r</span>&nbsp;<span class="op" id="6036328">*</span><span class="ident" id="6036329"><a href="/gostd/net/http/fcgi/child.go.html#6035254">response</a></span><span class="op" id="6036337">)</span>&nbsp;<span class="ident" id="6036339">Flush</span><span class="op" id="6036344">(</span><span class="op" id="6036345">)</span>&nbsp;<span class="op" id="6036347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6036350">if</span>&nbsp;<span class="op" id="6036353">!</span><span class="ident" id="6036354"><a href="/gostd/net/http/fcgi/child.go.html#6036326">r</a></span><span class="op" id="6036355">.</span><span class="ident" id="6036356"><a href="/gostd/net/http/fcgi/child.go.html#6035344">wroteHeader</a></span>&nbsp;<span class="op" id="6036368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6036372"><a href="/gostd/net/http/fcgi/child.go.html#6036326">r</a></span><span class="op" id="6036373">.</span><span class="ident" id="6036374"><a href="/gostd/net/http/fcgi/child.go.html#6035750">WriteHeader</a></span><span class="op" id="6036385">(</span><span class="ident" id="6036386"><a href="/gostd/net/http/fcgi/child.go.html#6034228">http</a></span><span class="op" id="6036390">.</span><span class="ident" id="6036391"><a href="/gostd/net/http/status.go.html#4236210">StatusOK</a></span><span class="op" id="6036399">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6036402">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6036405"><a href="/gostd/net/http/fcgi/child.go.html#6036326">r</a></span><span class="op" id="6036406">.</span><span class="ident" id="6036407"><a href="/gostd/net/http/fcgi/child.go.html#6035320">w</a></span><span class="op" id="6036408">.</span><span class="ident" id="6036409"><a href="/gostd/bufio/bufio.go.html#1367486">Flush</a></span><span class="op" id="6036414">(</span><span class="op" id="6036415">)</span><br>
<span class="lineno"></span><span class="op" id="6036417">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6036420">func</span>&nbsp;<span class="op" id="6036425">(</span><span class="ident" id="6036426">r</span>&nbsp;<span class="op" id="6036428">*</span><span class="ident" id="6036429"><a href="/gostd/net/http/fcgi/child.go.html#6035254">response</a></span><span class="op" id="6036437">)</span>&nbsp;<span class="ident" id="6036439">Close</span><span class="op" id="6036444">(</span><span class="op" id="6036445">)</span>&nbsp;<span class="builtintype" id="6036447">error</span>&nbsp;<span class="op" id="6036453">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6036456"><a href="/gostd/net/http/fcgi/child.go.html#6036426">r</a></span><span class="op" id="6036457">.</span><span class="ident" id="6036458"><a href="/gostd/net/http/fcgi/child.go.html#6036339">Flush</a></span><span class="op" id="6036463">(</span><span class="op" id="6036464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6036467">return</span>&nbsp;<span class="ident" id="6036474"><a href="/gostd/net/http/fcgi/child.go.html#6036426">r</a></span><span class="op" id="6036475">.</span><span class="ident" id="6036476"><a href="/gostd/net/http/fcgi/child.go.html#6035320">w</a></span><span class="op" id="6036477">.</span><span class="ident" id="6036478"><a href="/gostd/net/http/fcgi/fcgi.go.html#6046221">Close</a></span><span class="op" id="6036483">(</span><span class="op" id="6036484">)</span><br>
<span class="lineno"></span><span class="op" id="6036486">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6036489">type</span>&nbsp;<span class="ident" id="6036494">child</span>&nbsp;<span class="keyword" id="6036500">struct</span>&nbsp;<span class="op" id="6036507">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6036510">conn</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6036518">*</span><span class="ident" id="6036519"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043352">conn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6036525">handler</span>&nbsp;<span class="ident" id="6036533"><a href="/gostd/net/http/fcgi/child.go.html#6034228">http</a></span><span class="op" id="6036537">.</span><span class="ident" id="6036538"><a href="/gostd/net/http/server.go.html#4170413">Handler</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6036548">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6036557"><a href="/gostd/net/http/fcgi/child.go.html#6034273">sync</a></span><span class="op" id="6036561">.</span><span class="ident" id="6036562"><a href="/gostd/sync/mutex.go.html#1443974">Mutex</a></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6036577">//&nbsp;protects&nbsp;requests:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6036600">requests</span>&nbsp;<span class="keyword" id="6036609">map</span><span class="op" id="6036612">[</span><span class="builtintype" id="6036613">uint16</span><span class="op" id="6036619">]</span><span class="op" id="6036620">*</span><span class="ident" id="6036621"><a href="/gostd/net/http/fcgi/child.go.html#6034415">request</a></span>&nbsp;<span class="comment" id="6036629">//&nbsp;keyed&nbsp;by&nbsp;request&nbsp;ID</span><br>
<span class="lineno">135</span><span class="op" id="6036652">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6036655">func</span>&nbsp;<span class="ident" id="6036660">newChild</span><span class="op" id="6036668">(</span><span class="ident" id="6036669">rwc</span>&nbsp;<span class="ident" id="6036673"><a href="/gostd/net/http/fcgi/child.go.html#6034202">io</a></span><span class="op" id="6036675">.</span><span class="ident" id="6036676"><a href="/gostd/io/io.go.html#1423677">ReadWriteCloser</a></span><span class="op" id="6036691">,</span>&nbsp;<span class="ident" id="6036693">handler</span>&nbsp;<span class="ident" id="6036701"><a href="/gostd/net/http/fcgi/child.go.html#6034228">http</a></span><span class="op" id="6036705">.</span><span class="ident" id="6036706"><a href="/gostd/net/http/server.go.html#4170413">Handler</a></span><span class="op" id="6036713">)</span>&nbsp;<span class="op" id="6036715">*</span><span class="ident" id="6036716"><a href="/gostd/net/http/fcgi/child.go.html#6036494">child</a></span>&nbsp;<span class="op" id="6036722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6036725">return</span>&nbsp;<span class="op" id="6036732">&amp;</span><span class="ident" id="6036733"><a href="/gostd/net/http/fcgi/child.go.html#6036494">child</a></span><span class="op" id="6036738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6036742"><a href="/gostd/net/http/fcgi/child.go.html#6036510">conn</a></span><span class="op" id="6036746">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6036752"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043474">newConn</a></span><span class="op" id="6036759">(</span><span class="ident" id="6036760"><a href="/gostd/net/http/fcgi/child.go.html#6036669">rwc</a></span><span class="op" id="6036763">)</span><span class="op" id="6036764">,</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6036768"><a href="/gostd/net/http/fcgi/child.go.html#6036525">handler</a></span><span class="op" id="6036775">:</span>&nbsp;&nbsp;<span class="ident" id="6036778"><a href="/gostd/net/http/fcgi/child.go.html#6036693">handler</a></span><span class="op" id="6036785">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6036789"><a href="/gostd/net/http/fcgi/child.go.html#6036600">requests</a></span><span class="op" id="6036797">:</span>&nbsp;<span class="builtinfunc" id="6036799">make</span><span class="op" id="6036803">(</span><span class="keyword" id="6036804">map</span><span class="op" id="6036807">[</span><span class="builtintype" id="6036808">uint16</span><span class="op" id="6036814">]</span><span class="op" id="6036815">*</span><span class="ident" id="6036816"><a href="/gostd/net/http/fcgi/child.go.html#6034415">request</a></span><span class="op" id="6036823">)</span><span class="op" id="6036824">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6036827">}</span><br>
<span class="lineno"></span><span class="op" id="6036829">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="keyword" id="6036832">func</span>&nbsp;<span class="op" id="6036837">(</span><span class="ident" id="6036838">c</span>&nbsp;<span class="op" id="6036840">*</span><span class="ident" id="6036841"><a href="/gostd/net/http/fcgi/child.go.html#6036494">child</a></span><span class="op" id="6036846">)</span>&nbsp;<span class="ident" id="6036848">serve</span><span class="op" id="6036853">(</span><span class="op" id="6036854">)</span>&nbsp;<span class="op" id="6036856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6036859">defer</span>&nbsp;<span class="ident" id="6036865"><a href="/gostd/net/http/fcgi/child.go.html#6036838">c</a></span><span class="op" id="6036866">.</span><span class="ident" id="6036867"><a href="/gostd/net/http/fcgi/child.go.html#6036510">conn</a></span><span class="op" id="6036871">.</span><span class="ident" id="6036872"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043556">Close</a></span><span class="op" id="6036877">(</span><span class="op" id="6036878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6036881">var</span>&nbsp;<span class="ident" id="6036885">rec</span>&nbsp;<span class="ident" id="6036889"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043642">record</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6036897">for</span>&nbsp;<span class="op" id="6036901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6036905">if</span>&nbsp;<span class="ident" id="6036908">err</span>&nbsp;<span class="op" id="6036912">:=</span>&nbsp;<span class="ident" id="6036915"><a href="/gostd/net/http/fcgi/child.go.html#6036885">rec</a></span><span class="op" id="6036918">.</span><span class="ident" id="6036919"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043721">read</a></span><span class="op" id="6036923">(</span><span class="ident" id="6036924"><a href="/gostd/net/http/fcgi/child.go.html#6036838">c</a></span><span class="op" id="6036925">.</span><span class="ident" id="6036926"><a href="/gostd/net/http/fcgi/child.go.html#6036510">conn</a></span><span class="op" id="6036930">.</span><span class="ident" id="6036931"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043385">rwc</a></span><span class="op" id="6036934">)</span><span class="op" id="6036935">;</span>&nbsp;<span class="ident" id="6036937"><a href="/gostd/net/http/fcgi/child.go.html#6036908">err</a></span>&nbsp;<span class="op" id="6036941">!=</span>&nbsp;<span class="builtintype" id="6036944">nil</span>&nbsp;<span class="op" id="6036948">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6036953">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6036962">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6036966">if</span>&nbsp;<span class="ident" id="6036969">err</span>&nbsp;<span class="op" id="6036973">:=</span>&nbsp;<span class="ident" id="6036976"><a href="/gostd/net/http/fcgi/child.go.html#6036838">c</a></span><span class="op" id="6036977">.</span><span class="ident" id="6036978"><a href="/gostd/net/http/fcgi/child.go.html#6037172">handleRecord</a></span><span class="op" id="6036990">(</span><span class="op" id="6036991">&amp;</span><span class="ident" id="6036992"><a href="/gostd/net/http/fcgi/child.go.html#6036885">rec</a></span><span class="op" id="6036995">)</span><span class="op" id="6036996">;</span>&nbsp;<span class="ident" id="6036998"><a href="/gostd/net/http/fcgi/child.go.html#6036969">err</a></span>&nbsp;<span class="op" id="6037002">!=</span>&nbsp;<span class="builtintype" id="6037005">nil</span>&nbsp;<span class="op" id="6037009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6037014">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6037023">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6037026">}</span><br>
<span class="lineno"></span><span class="op" id="6037028">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6037031">var</span>&nbsp;<span class="ident" id="6037035">errCloseConn</span>&nbsp;<span class="op" id="6037048">=</span>&nbsp;<span class="ident" id="6037050"><a href="/gostd/net/http/fcgi/child.go.html#6034185">errors</a></span><span class="op" id="6037056">.</span><span class="ident" id="6037057"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="6037060">(</span><span class="string" id="6037061">&#34;fcgi:&nbsp;connection&nbsp;should&nbsp;be&nbsp;closed&#34;</span><span class="op" id="6037096">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="keyword" id="6037099">var</span>&nbsp;<span class="ident" id="6037103">emptyBody</span>&nbsp;<span class="op" id="6037113">=</span>&nbsp;<span class="ident" id="6037115"><a href="/gostd/net/http/fcgi/child.go.html#6034208">ioutil</a></span><span class="op" id="6037121">.</span><span class="ident" id="6037122"><a href="/gostd/io/ioutil/ioutil.go.html#3767601">NopCloser</a></span><span class="op" id="6037131">(</span><span class="ident" id="6037132"><a href="/gostd/net/http/fcgi/child.go.html#6034262">strings</a></span><span class="op" id="6037139">.</span><span class="ident" id="6037140"><a href="/gostd/strings/reader.go.html#2948317">NewReader</a></span><span class="op" id="6037149">(</span><span class="string" id="6037150">&#34;&#34;</span><span class="op" id="6037152">)</span><span class="op" id="6037153">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6037156">func</span>&nbsp;<span class="op" id="6037161">(</span><span class="ident" id="6037162">c</span>&nbsp;<span class="op" id="6037164">*</span><span class="ident" id="6037165"><a href="/gostd/net/http/fcgi/child.go.html#6036494">child</a></span><span class="op" id="6037170">)</span>&nbsp;<span class="ident" id="6037172">handleRecord</span><span class="op" id="6037184">(</span><span class="ident" id="6037185">rec</span>&nbsp;<span class="op" id="6037189">*</span><span class="ident" id="6037190"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043642">record</a></span><span class="op" id="6037196">)</span>&nbsp;<span class="builtintype" id="6037198">error</span>&nbsp;<span class="op" id="6037204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6037207"><a href="/gostd/net/http/fcgi/child.go.html#6037162">c</a></span><span class="op" id="6037208">.</span><span class="ident" id="6037209"><a href="/gostd/net/http/fcgi/child.go.html#6036548">mu</a></span><span class="op" id="6037211">.</span><span class="ident" id="6037212"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="6037216">(</span><span class="op" id="6037217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6037220">req</span><span class="op" id="6037223">,</span>&nbsp;<span class="ident" id="6037225">ok</span>&nbsp;<span class="op" id="6037228">:=</span>&nbsp;<span class="ident" id="6037231"><a href="/gostd/net/http/fcgi/child.go.html#6037162">c</a></span><span class="op" id="6037232">.</span><span class="ident" id="6037233"><a href="/gostd/net/http/fcgi/child.go.html#6036600">requests</a></span><span class="op" id="6037241">[</span><span class="ident" id="6037242"><a href="/gostd/net/http/fcgi/child.go.html#6037185">rec</a></span><span class="op" id="6037245">.</span><span class="ident" id="6037246"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043659">h</a></span><span class="op" id="6037247">.</span><span class="ident" id="6037248"><a href="/gostd/net/http/fcgi/fcgi.go.html#6042573">Id</a></span><span class="op" id="6037250">]</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6037253"><a href="/gostd/net/http/fcgi/child.go.html#6037162">c</a></span><span class="op" id="6037254">.</span><span class="ident" id="6037255"><a href="/gostd/net/http/fcgi/child.go.html#6036548">mu</a></span><span class="op" id="6037257">.</span><span class="ident" id="6037258"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="6037264">(</span><span class="op" id="6037265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6037268">if</span>&nbsp;<span class="op" id="6037271">!</span><span class="ident" id="6037272"><a href="/gostd/net/http/fcgi/child.go.html#6037225">ok</a></span>&nbsp;<span class="op" id="6037275">&amp;&amp;</span>&nbsp;<span class="ident" id="6037278"><a href="/gostd/net/http/fcgi/child.go.html#6037185">rec</a></span><span class="op" id="6037281">.</span><span class="ident" id="6037282"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043659">h</a></span><span class="op" id="6037283">.</span><span class="ident" id="6037284"><a href="/gostd/net/http/fcgi/fcgi.go.html#6042550">Type</a></span>&nbsp;<span class="op" id="6037289">!=</span>&nbsp;<span class="ident" id="6037292"><a href="/gostd/net/http/fcgi/fcgi.go.html#6041752">typeBeginRequest</a></span>&nbsp;<span class="op" id="6037309">&amp;&amp;</span>&nbsp;<span class="ident" id="6037312"><a href="/gostd/net/http/fcgi/child.go.html#6037185">rec</a></span><span class="op" id="6037315">.</span><span class="ident" id="6037316"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043659">h</a></span><span class="op" id="6037317">.</span><span class="ident" id="6037318"><a href="/gostd/net/http/fcgi/fcgi.go.html#6042550">Type</a></span>&nbsp;<span class="op" id="6037323">!=</span>&nbsp;<span class="ident" id="6037326"><a href="/gostd/net/http/fcgi/fcgi.go.html#6042016">typeGetValues</a></span>&nbsp;<span class="op" id="6037340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6037344">//&nbsp;The&nbsp;spec&nbsp;says&nbsp;to&nbsp;ignore&nbsp;unknown&nbsp;request&nbsp;IDs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6037394">return</span>&nbsp;<span class="builtintype" id="6037401">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6037406">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6037410">switch</span>&nbsp;<span class="ident" id="6037417"><a href="/gostd/net/http/fcgi/child.go.html#6037185">rec</a></span><span class="op" id="6037420">.</span><span class="ident" id="6037421"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043659">h</a></span><span class="op" id="6037422">.</span><span class="ident" id="6037423"><a href="/gostd/net/http/fcgi/fcgi.go.html#6042550">Type</a></span>&nbsp;<span class="op" id="6037428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6037431">case</span>&nbsp;<span class="ident" id="6037436"><a href="/gostd/net/http/fcgi/fcgi.go.html#6041752">typeBeginRequest</a></span><span class="op" id="6037452">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6037456">if</span>&nbsp;<span class="ident" id="6037459"><a href="/gostd/net/http/fcgi/child.go.html#6037220">req</a></span>&nbsp;<span class="op" id="6037463">!=</span>&nbsp;<span class="builtintype" id="6037466">nil</span>&nbsp;<span class="op" id="6037470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6037475">//&nbsp;The&nbsp;server&nbsp;is&nbsp;trying&nbsp;to&nbsp;begin&nbsp;a&nbsp;request&nbsp;with&nbsp;the&nbsp;same&nbsp;ID</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6037538">//&nbsp;as&nbsp;an&nbsp;in-progress&nbsp;request.&nbsp;This&nbsp;is&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6037589">return</span>&nbsp;<span class="ident" id="6037596"><a href="/gostd/net/http/fcgi/child.go.html#6034185">errors</a></span><span class="op" id="6037602">.</span><span class="ident" id="6037603"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="6037606">(</span><span class="string" id="6037607">&#34;fcgi:&nbsp;received&nbsp;ID&nbsp;that&nbsp;is&nbsp;already&nbsp;in-flight&#34;</span><span class="op" id="6037652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6037656">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6037661">var</span>&nbsp;<span class="ident" id="6037665">br</span>&nbsp;<span class="ident" id="6037668"><a href="/gostd/net/http/fcgi/fcgi.go.html#6042666">beginRequest</a></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6037683">if</span>&nbsp;<span class="ident" id="6037686">err</span>&nbsp;<span class="op" id="6037690">:=</span>&nbsp;<span class="ident" id="6037693"><a href="/gostd/net/http/fcgi/child.go.html#6037665">br</a></span><span class="op" id="6037695">.</span><span class="ident" id="6037696"><a href="/gostd/net/http/fcgi/fcgi.go.html#6042767">read</a></span><span class="op" id="6037700">(</span><span class="ident" id="6037701"><a href="/gostd/net/http/fcgi/child.go.html#6037185">rec</a></span><span class="op" id="6037704">.</span><span class="ident" id="6037705"><a href="/gostd/net/http/fcgi/fcgi.go.html#6044075">content</a></span><span class="op" id="6037712">(</span><span class="op" id="6037713">)</span><span class="op" id="6037714">)</span><span class="op" id="6037715">;</span>&nbsp;<span class="ident" id="6037717"><a href="/gostd/net/http/fcgi/child.go.html#6037686">err</a></span>&nbsp;<span class="op" id="6037721">!=</span>&nbsp;<span class="builtintype" id="6037724">nil</span>&nbsp;<span class="op" id="6037728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6037733">return</span>&nbsp;<span class="ident" id="6037740"><a href="/gostd/net/http/fcgi/child.go.html#6037686">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6037746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6037750">if</span>&nbsp;<span class="ident" id="6037753"><a href="/gostd/net/http/fcgi/child.go.html#6037665">br</a></span><span class="op" id="6037755">.</span><span class="ident" id="6037756"><a href="/gostd/net/http/fcgi/fcgi.go.html#6042689">role</a></span>&nbsp;<span class="op" id="6037761">!=</span>&nbsp;<span class="ident" id="6037764"><a href="/gostd/net/http/fcgi/fcgi.go.html#6042295">roleResponder</a></span>&nbsp;<span class="op" id="6037778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6037783"><a href="/gostd/net/http/fcgi/child.go.html#6037162">c</a></span><span class="op" id="6037784">.</span><span class="ident" id="6037785"><a href="/gostd/net/http/fcgi/child.go.html#6036510">conn</a></span><span class="op" id="6037789">.</span><span class="ident" id="6037790"><a href="/gostd/net/http/fcgi/fcgi.go.html#6044825">writeEndRequest</a></span><span class="op" id="6037805">(</span><span class="ident" id="6037806"><a href="/gostd/net/http/fcgi/child.go.html#6037185">rec</a></span><span class="op" id="6037809">.</span><span class="ident" id="6037810"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043659">h</a></span><span class="op" id="6037811">.</span><span class="ident" id="6037812"><a href="/gostd/net/http/fcgi/fcgi.go.html#6042573">Id</a></span><span class="op" id="6037814">,</span>&nbsp;<span class="num" id="6037816">0</span><span class="op" id="6037817">,</span>&nbsp;<span class="ident" id="6037819"><a href="/gostd/net/http/fcgi/fcgi.go.html#6042465">statusUnknownRole</a></span><span class="op" id="6037836">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6037841">return</span>&nbsp;<span class="builtintype" id="6037848">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6037854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6037858"><a href="/gostd/net/http/fcgi/child.go.html#6037220">req</a></span>&nbsp;<span class="op" id="6037862">=</span>&nbsp;<span class="ident" id="6037864"><a href="/gostd/net/http/fcgi/child.go.html#6034569">newRequest</a></span><span class="op" id="6037874">(</span><span class="ident" id="6037875"><a href="/gostd/net/http/fcgi/child.go.html#6037185">rec</a></span><span class="op" id="6037878">.</span><span class="ident" id="6037879"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043659">h</a></span><span class="op" id="6037880">.</span><span class="ident" id="6037881"><a href="/gostd/net/http/fcgi/fcgi.go.html#6042573">Id</a></span><span class="op" id="6037883">,</span>&nbsp;<span class="ident" id="6037885"><a href="/gostd/net/http/fcgi/child.go.html#6037665">br</a></span><span class="op" id="6037887">.</span><span class="ident" id="6037888"><a href="/gostd/net/http/fcgi/fcgi.go.html#6042706">flags</a></span><span class="op" id="6037893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6037897"><a href="/gostd/net/http/fcgi/child.go.html#6037162">c</a></span><span class="op" id="6037898">.</span><span class="ident" id="6037899"><a href="/gostd/net/http/fcgi/child.go.html#6036548">mu</a></span><span class="op" id="6037901">.</span><span class="ident" id="6037902"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="6037906">(</span><span class="op" id="6037907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6037911"><a href="/gostd/net/http/fcgi/child.go.html#6037162">c</a></span><span class="op" id="6037912">.</span><span class="ident" id="6037913"><a href="/gostd/net/http/fcgi/child.go.html#6036600">requests</a></span><span class="op" id="6037921">[</span><span class="ident" id="6037922"><a href="/gostd/net/http/fcgi/child.go.html#6037185">rec</a></span><span class="op" id="6037925">.</span><span class="ident" id="6037926"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043659">h</a></span><span class="op" id="6037927">.</span><span class="ident" id="6037928"><a href="/gostd/net/http/fcgi/fcgi.go.html#6042573">Id</a></span><span class="op" id="6037930">]</span>&nbsp;<span class="op" id="6037932">=</span>&nbsp;<span class="ident" id="6037934"><a href="/gostd/net/http/fcgi/child.go.html#6037220">req</a></span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6037940"><a href="/gostd/net/http/fcgi/child.go.html#6037162">c</a></span><span class="op" id="6037941">.</span><span class="ident" id="6037942"><a href="/gostd/net/http/fcgi/child.go.html#6036548">mu</a></span><span class="op" id="6037944">.</span><span class="ident" id="6037945"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="6037951">(</span><span class="op" id="6037952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6037956">return</span>&nbsp;<span class="builtintype" id="6037963">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6037968">case</span>&nbsp;<span class="ident" id="6037973"><a href="/gostd/net/http/fcgi/fcgi.go.html#6041851">typeParams</a></span><span class="op" id="6037983">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6037987">//&nbsp;NOTE(eds):&nbsp;Technically&nbsp;a&nbsp;key-value&nbsp;pair&nbsp;can&nbsp;straddle&nbsp;the&nbsp;boundary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6038058">//&nbsp;between&nbsp;two&nbsp;packets.&nbsp;We&nbsp;buffer&nbsp;until&nbsp;we&#39;ve&nbsp;received&nbsp;all&nbsp;parameters.</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6038131">if</span>&nbsp;<span class="builtinfunc" id="6038134">len</span><span class="op" id="6038137">(</span><span class="ident" id="6038138"><a href="/gostd/net/http/fcgi/child.go.html#6037185">rec</a></span><span class="op" id="6038141">.</span><span class="ident" id="6038142"><a href="/gostd/net/http/fcgi/fcgi.go.html#6044075">content</a></span><span class="op" id="6038149">(</span><span class="op" id="6038150">)</span><span class="op" id="6038151">)</span>&nbsp;<span class="op" id="6038153">&gt;</span>&nbsp;<span class="num" id="6038155">0</span>&nbsp;<span class="op" id="6038157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6038162"><a href="/gostd/net/http/fcgi/child.go.html#6037220">req</a></span><span class="op" id="6038165">.</span><span class="ident" id="6038166"><a href="/gostd/net/http/fcgi/child.go.html#6034528">rawParams</a></span>&nbsp;<span class="op" id="6038176">=</span>&nbsp;<span class="builtinfunc" id="6038178">append</span><span class="op" id="6038184">(</span><span class="ident" id="6038185"><a href="/gostd/net/http/fcgi/child.go.html#6037220">req</a></span><span class="op" id="6038188">.</span><span class="ident" id="6038189"><a href="/gostd/net/http/fcgi/child.go.html#6034528">rawParams</a></span><span class="op" id="6038198">,</span>&nbsp;<span class="ident" id="6038200"><a href="/gostd/net/http/fcgi/child.go.html#6037185">rec</a></span><span class="op" id="6038203">.</span><span class="ident" id="6038204"><a href="/gostd/net/http/fcgi/fcgi.go.html#6044075">content</a></span><span class="op" id="6038211">(</span><span class="op" id="6038212">)</span><span class="op" id="6038213">...</span><span class="op" id="6038216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6038221">return</span>&nbsp;<span class="builtintype" id="6038228">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6038234">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6038238"><a href="/gostd/net/http/fcgi/child.go.html#6037220">req</a></span><span class="op" id="6038241">.</span><span class="ident" id="6038242"><a href="/gostd/net/http/fcgi/child.go.html#6034834">parseParams</a></span><span class="op" id="6038253">(</span><span class="op" id="6038254">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6038258">return</span>&nbsp;<span class="builtintype" id="6038265">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6038270">case</span>&nbsp;<span class="ident" id="6038275"><a href="/gostd/net/http/fcgi/fcgi.go.html#6041884">typeStdin</a></span><span class="op" id="6038284">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6038288">content</span>&nbsp;<span class="op" id="6038296">:=</span>&nbsp;<span class="ident" id="6038299"><a href="/gostd/net/http/fcgi/child.go.html#6037185">rec</a></span><span class="op" id="6038302">.</span><span class="ident" id="6038303"><a href="/gostd/net/http/fcgi/fcgi.go.html#6044075">content</a></span><span class="op" id="6038310">(</span><span class="op" id="6038311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6038315">if</span>&nbsp;<span class="ident" id="6038318"><a href="/gostd/net/http/fcgi/child.go.html#6037220">req</a></span><span class="op" id="6038321">.</span><span class="ident" id="6038322"><a href="/gostd/net/http/fcgi/child.go.html#6034433">pw</a></span>&nbsp;<span class="op" id="6038325">==</span>&nbsp;<span class="builtintype" id="6038328">nil</span>&nbsp;<span class="op" id="6038332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6038337">var</span>&nbsp;<span class="ident" id="6038341">body</span>&nbsp;<span class="ident" id="6038346"><a href="/gostd/net/http/fcgi/child.go.html#6034202">io</a></span><span class="op" id="6038348">.</span><span class="ident" id="6038349"><a href="/gostd/io/io.go.html#1423414">ReadCloser</a></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6038363">if</span>&nbsp;<span class="builtinfunc" id="6038366">len</span><span class="op" id="6038369">(</span><span class="ident" id="6038370"><a href="/gostd/net/http/fcgi/child.go.html#6038288">content</a></span><span class="op" id="6038377">)</span>&nbsp;<span class="op" id="6038379">&gt;</span>&nbsp;<span class="num" id="6038381">0</span>&nbsp;<span class="op" id="6038383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6038389">//&nbsp;body&nbsp;could&nbsp;be&nbsp;an&nbsp;io.LimitReader,&nbsp;but&nbsp;it&nbsp;shouldn&#39;t&nbsp;matter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6038453">//&nbsp;as&nbsp;long&nbsp;as&nbsp;both&nbsp;sides&nbsp;are&nbsp;behaving.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6038496"><a href="/gostd/net/http/fcgi/child.go.html#6038341">body</a></span><span class="op" id="6038500">,</span>&nbsp;<span class="ident" id="6038502"><a href="/gostd/net/http/fcgi/child.go.html#6037220">req</a></span><span class="op" id="6038505">.</span><span class="ident" id="6038506"><a href="/gostd/net/http/fcgi/child.go.html#6034433">pw</a></span>&nbsp;<span class="op" id="6038509">=</span>&nbsp;<span class="ident" id="6038511"><a href="/gostd/net/http/fcgi/child.go.html#6034202">io</a></span><span class="op" id="6038513">.</span><span class="ident" id="6038514"><a href="/gostd/io/pipe.go.html#1440333">Pipe</a></span><span class="op" id="6038518">(</span><span class="op" id="6038519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6038524">}</span>&nbsp;<span class="keyword" id="6038526">else</span>&nbsp;<span class="op" id="6038531">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6038537"><a href="/gostd/net/http/fcgi/child.go.html#6038341">body</a></span>&nbsp;<span class="op" id="6038542">=</span>&nbsp;<span class="ident" id="6038544"><a href="/gostd/net/http/fcgi/child.go.html#6037103">emptyBody</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6038557">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6038562">go</span>&nbsp;<span class="ident" id="6038565"><a href="/gostd/net/http/fcgi/child.go.html#6037162">c</a></span><span class="op" id="6038566">.</span><span class="ident" id="6038567"><a href="/gostd/net/http/fcgi/child.go.html#6039478">serveRequest</a></span><span class="op" id="6038579">(</span><span class="ident" id="6038580"><a href="/gostd/net/http/fcgi/child.go.html#6037220">req</a></span><span class="op" id="6038583">,</span>&nbsp;<span class="ident" id="6038585"><a href="/gostd/net/http/fcgi/child.go.html#6038341">body</a></span><span class="op" id="6038589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6038593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6038597">if</span>&nbsp;<span class="builtinfunc" id="6038600">len</span><span class="op" id="6038603">(</span><span class="ident" id="6038604"><a href="/gostd/net/http/fcgi/child.go.html#6038288">content</a></span><span class="op" id="6038611">)</span>&nbsp;<span class="op" id="6038613">&gt;</span>&nbsp;<span class="num" id="6038615">0</span>&nbsp;<span class="op" id="6038617">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6038622">//&nbsp;TODO(eds):&nbsp;This&nbsp;blocks&nbsp;until&nbsp;the&nbsp;handler&nbsp;reads&nbsp;from&nbsp;the&nbsp;pipe.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6038690">//&nbsp;If&nbsp;the&nbsp;handler&nbsp;takes&nbsp;a&nbsp;long&nbsp;time,&nbsp;it&nbsp;might&nbsp;be&nbsp;a&nbsp;problem.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6038753"><a href="/gostd/net/http/fcgi/child.go.html#6037220">req</a></span><span class="op" id="6038756">.</span><span class="ident" id="6038757"><a href="/gostd/net/http/fcgi/child.go.html#6034433">pw</a></span><span class="op" id="6038759">.</span><span class="ident" id="6038760"><a href="/gostd/io/pipe.go.html#1439343">Write</a></span><span class="op" id="6038765">(</span><span class="ident" id="6038766"><a href="/gostd/net/http/fcgi/child.go.html#6038288">content</a></span><span class="op" id="6038773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6038777">}</span>&nbsp;<span class="keyword" id="6038779">else</span>&nbsp;<span class="keyword" id="6038784">if</span>&nbsp;<span class="ident" id="6038787"><a href="/gostd/net/http/fcgi/child.go.html#6037220">req</a></span><span class="op" id="6038790">.</span><span class="ident" id="6038791"><a href="/gostd/net/http/fcgi/child.go.html#6034433">pw</a></span>&nbsp;<span class="op" id="6038794">!=</span>&nbsp;<span class="builtintype" id="6038797">nil</span>&nbsp;<span class="op" id="6038801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6038806"><a href="/gostd/net/http/fcgi/child.go.html#6037220">req</a></span><span class="op" id="6038809">.</span><span class="ident" id="6038810"><a href="/gostd/net/http/fcgi/child.go.html#6034433">pw</a></span><span class="op" id="6038812">.</span><span class="ident" id="6038813"><a href="/gostd/io/pipe.go.html#1439540">Close</a></span><span class="op" id="6038818">(</span><span class="op" id="6038819">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6038823">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6038827">return</span>&nbsp;<span class="builtintype" id="6038834">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6038839">case</span>&nbsp;<span class="ident" id="6038844"><a href="/gostd/net/http/fcgi/fcgi.go.html#6042016">typeGetValues</a></span><span class="op" id="6038857">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6038861">values</span>&nbsp;<span class="op" id="6038868">:=</span>&nbsp;<span class="keyword" id="6038871">map</span><span class="op" id="6038874">[</span><span class="builtintype" id="6038875">string</span><span class="op" id="6038881">]</span><span class="builtintype" id="6038882">string</span><span class="op" id="6038888">{</span><span class="string" id="6038889">&#34;FCGI_MPXS_CONNS&#34;</span><span class="op" id="6038906">:</span>&nbsp;<span class="string" id="6038908">&#34;1&#34;</span><span class="op" id="6038911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6038915"><a href="/gostd/net/http/fcgi/child.go.html#6037162">c</a></span><span class="op" id="6038916">.</span><span class="ident" id="6038917"><a href="/gostd/net/http/fcgi/child.go.html#6036510">conn</a></span><span class="op" id="6038921">.</span><span class="ident" id="6038922"><a href="/gostd/net/http/fcgi/fcgi.go.html#6045061">writePairs</a></span><span class="op" id="6038932">(</span><span class="ident" id="6038933"><a href="/gostd/net/http/fcgi/fcgi.go.html#6042049">typeGetValuesResult</a></span><span class="op" id="6038952">,</span>&nbsp;<span class="num" id="6038954">0</span><span class="op" id="6038955">,</span>&nbsp;<span class="ident" id="6038957"><a href="/gostd/net/http/fcgi/child.go.html#6038861">values</a></span><span class="op" id="6038963">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6038967">return</span>&nbsp;<span class="builtintype" id="6038974">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6038979">case</span>&nbsp;<span class="ident" id="6038984"><a href="/gostd/net/http/fcgi/fcgi.go.html#6041983">typeData</a></span><span class="op" id="6038992">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6038996">//&nbsp;If&nbsp;the&nbsp;filter&nbsp;role&nbsp;is&nbsp;implemented,&nbsp;read&nbsp;the&nbsp;data&nbsp;stream&nbsp;here.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6039063">return</span>&nbsp;<span class="builtintype" id="6039070">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6039075">case</span>&nbsp;<span class="ident" id="6039080"><a href="/gostd/net/http/fcgi/fcgi.go.html#6041785">typeAbortRequest</a></span><span class="op" id="6039096">:</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6039100">println</span><span class="op" id="6039107">(</span><span class="string" id="6039108">&#34;abort&#34;</span><span class="op" id="6039115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6039119"><a href="/gostd/net/http/fcgi/child.go.html#6037162">c</a></span><span class="op" id="6039120">.</span><span class="ident" id="6039121"><a href="/gostd/net/http/fcgi/child.go.html#6036548">mu</a></span><span class="op" id="6039123">.</span><span class="ident" id="6039124"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="6039128">(</span><span class="op" id="6039129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6039133">delete</span><span class="op" id="6039139">(</span><span class="ident" id="6039140"><a href="/gostd/net/http/fcgi/child.go.html#6037162">c</a></span><span class="op" id="6039141">.</span><span class="ident" id="6039142"><a href="/gostd/net/http/fcgi/child.go.html#6036600">requests</a></span><span class="op" id="6039150">,</span>&nbsp;<span class="ident" id="6039152"><a href="/gostd/net/http/fcgi/child.go.html#6037185">rec</a></span><span class="op" id="6039155">.</span><span class="ident" id="6039156"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043659">h</a></span><span class="op" id="6039157">.</span><span class="ident" id="6039158"><a href="/gostd/net/http/fcgi/fcgi.go.html#6042573">Id</a></span><span class="op" id="6039160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6039164"><a href="/gostd/net/http/fcgi/child.go.html#6037162">c</a></span><span class="op" id="6039165">.</span><span class="ident" id="6039166"><a href="/gostd/net/http/fcgi/child.go.html#6036548">mu</a></span><span class="op" id="6039168">.</span><span class="ident" id="6039169"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="6039175">(</span><span class="op" id="6039176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6039180"><a href="/gostd/net/http/fcgi/child.go.html#6037162">c</a></span><span class="op" id="6039181">.</span><span class="ident" id="6039182"><a href="/gostd/net/http/fcgi/child.go.html#6036510">conn</a></span><span class="op" id="6039186">.</span><span class="ident" id="6039187"><a href="/gostd/net/http/fcgi/fcgi.go.html#6044825">writeEndRequest</a></span><span class="op" id="6039202">(</span><span class="ident" id="6039203"><a href="/gostd/net/http/fcgi/child.go.html#6037185">rec</a></span><span class="op" id="6039206">.</span><span class="ident" id="6039207"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043659">h</a></span><span class="op" id="6039208">.</span><span class="ident" id="6039209"><a href="/gostd/net/http/fcgi/fcgi.go.html#6042573">Id</a></span><span class="op" id="6039211">,</span>&nbsp;<span class="num" id="6039213">0</span><span class="op" id="6039214">,</span>&nbsp;<span class="ident" id="6039216"><a href="/gostd/net/http/fcgi/fcgi.go.html#6042396">statusRequestComplete</a></span><span class="op" id="6039237">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6039241">if</span>&nbsp;<span class="op" id="6039244">!</span><span class="ident" id="6039245"><a href="/gostd/net/http/fcgi/child.go.html#6037220">req</a></span><span class="op" id="6039248">.</span><span class="ident" id="6039249"><a href="/gostd/net/http/fcgi/child.go.html#6034546">keepConn</a></span>&nbsp;<span class="op" id="6039258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6039263">//&nbsp;connection&nbsp;will&nbsp;close&nbsp;upon&nbsp;return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6039303">return</span>&nbsp;<span class="ident" id="6039310"><a href="/gostd/net/http/fcgi/child.go.html#6037035">errCloseConn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6039325">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6039329">return</span>&nbsp;<span class="builtintype" id="6039336">nil</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6039341">default</span><span class="op" id="6039348">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6039352">b</span>&nbsp;<span class="op" id="6039354">:=</span>&nbsp;<span class="builtinfunc" id="6039357">make</span><span class="op" id="6039361">(</span><span class="op" id="6039362">[</span><span class="op" id="6039363">]</span><span class="builtintype" id="6039364">byte</span><span class="op" id="6039368">,</span>&nbsp;<span class="num" id="6039370">8</span><span class="op" id="6039371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6039375"><a href="/gostd/net/http/fcgi/child.go.html#6039352">b</a></span><span class="op" id="6039376">[</span><span class="num" id="6039377">0</span><span class="op" id="6039378">]</span>&nbsp;<span class="op" id="6039380">=</span>&nbsp;<span class="builtintype" id="6039382">byte</span><span class="op" id="6039386">(</span><span class="ident" id="6039387"><a href="/gostd/net/http/fcgi/child.go.html#6037185">rec</a></span><span class="op" id="6039390">.</span><span class="ident" id="6039391"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043659">h</a></span><span class="op" id="6039392">.</span><span class="ident" id="6039393"><a href="/gostd/net/http/fcgi/fcgi.go.html#6042550">Type</a></span><span class="op" id="6039397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6039401"><a href="/gostd/net/http/fcgi/child.go.html#6037162">c</a></span><span class="op" id="6039402">.</span><span class="ident" id="6039403"><a href="/gostd/net/http/fcgi/child.go.html#6036510">conn</a></span><span class="op" id="6039407">.</span><span class="ident" id="6039408"><a href="/gostd/net/http/fcgi/fcgi.go.html#6044195">writeRecord</a></span><span class="op" id="6039419">(</span><span class="ident" id="6039420"><a href="/gostd/net/http/fcgi/fcgi.go.html#6042083">typeUnknownType</a></span><span class="op" id="6039435">,</span>&nbsp;<span class="num" id="6039437">0</span><span class="op" id="6039438">,</span>&nbsp;<span class="ident" id="6039440"><a href="/gostd/net/http/fcgi/child.go.html#6039352">b</a></span><span class="op" id="6039441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6039445">return</span>&nbsp;<span class="builtintype" id="6039452">nil</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6039457">}</span><br>
<span class="lineno"></span><span class="op" id="6039459">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6039462">func</span>&nbsp;<span class="op" id="6039467">(</span><span class="ident" id="6039468">c</span>&nbsp;<span class="op" id="6039470">*</span><span class="ident" id="6039471"><a href="/gostd/net/http/fcgi/child.go.html#6036494">child</a></span><span class="op" id="6039476">)</span>&nbsp;<span class="ident" id="6039478">serveRequest</span><span class="op" id="6039490">(</span><span class="ident" id="6039491">req</span>&nbsp;<span class="op" id="6039495">*</span><span class="ident" id="6039496"><a href="/gostd/net/http/fcgi/child.go.html#6034415">request</a></span><span class="op" id="6039503">,</span>&nbsp;<span class="ident" id="6039505">body</span>&nbsp;<span class="ident" id="6039510"><a href="/gostd/net/http/fcgi/child.go.html#6034202">io</a></span><span class="op" id="6039512">.</span><span class="ident" id="6039513"><a href="/gostd/io/io.go.html#1423414">ReadCloser</a></span><span class="op" id="6039523">)</span>&nbsp;<span class="op" id="6039525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6039528">r</span>&nbsp;<span class="op" id="6039530">:=</span>&nbsp;<span class="ident" id="6039533"><a href="/gostd/net/http/fcgi/child.go.html#6035369">newResponse</a></span><span class="op" id="6039544">(</span><span class="ident" id="6039545"><a href="/gostd/net/http/fcgi/child.go.html#6039468">c</a></span><span class="op" id="6039546">,</span>&nbsp;<span class="ident" id="6039548"><a href="/gostd/net/http/fcgi/child.go.html#6039491">req</a></span><span class="op" id="6039551">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6039554">httpReq</span><span class="op" id="6039561">,</span>&nbsp;<span class="ident" id="6039563">err</span>&nbsp;<span class="op" id="6039567">:=</span>&nbsp;<span class="ident" id="6039570"><a href="/gostd/net/http/fcgi/child.go.html#6034240">cgi</a></span><span class="op" id="6039573">.</span><span class="ident" id="6039574"><a href="/gostd/net/http/cgi/child.go.html#5690647">RequestFromMap</a></span><span class="op" id="6039588">(</span><span class="ident" id="6039589"><a href="/gostd/net/http/fcgi/child.go.html#6039491">req</a></span><span class="op" id="6039592">.</span><span class="ident" id="6039593"><a href="/gostd/net/http/fcgi/child.go.html#6034477">params</a></span><span class="op" id="6039599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6039602">if</span>&nbsp;<span class="ident" id="6039605"><a href="/gostd/net/http/fcgi/child.go.html#6039563">err</a></span>&nbsp;<span class="op" id="6039609">!=</span>&nbsp;<span class="builtintype" id="6039612">nil</span>&nbsp;<span class="op" id="6039616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6039620">//&nbsp;there&nbsp;was&nbsp;an&nbsp;error&nbsp;reading&nbsp;the&nbsp;request</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6039664"><a href="/gostd/net/http/fcgi/child.go.html#6039528">r</a></span><span class="op" id="6039665">.</span><span class="ident" id="6039666"><a href="/gostd/net/http/fcgi/child.go.html#6035750">WriteHeader</a></span><span class="op" id="6039677">(</span><span class="ident" id="6039678"><a href="/gostd/net/http/fcgi/child.go.html#6034228">http</a></span><span class="op" id="6039682">.</span><span class="ident" id="6039683"><a href="/gostd/net/http/status.go.html#4237466">StatusInternalServerError</a></span><span class="op" id="6039708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6039712"><a href="/gostd/net/http/fcgi/child.go.html#6039468">c</a></span><span class="op" id="6039713">.</span><span class="ident" id="6039714"><a href="/gostd/net/http/fcgi/child.go.html#6036510">conn</a></span><span class="op" id="6039718">.</span><span class="ident" id="6039719"><a href="/gostd/net/http/fcgi/fcgi.go.html#6044195">writeRecord</a></span><span class="op" id="6039730">(</span><span class="ident" id="6039731"><a href="/gostd/net/http/fcgi/fcgi.go.html#6041950">typeStderr</a></span><span class="op" id="6039741">,</span>&nbsp;<span class="ident" id="6039743"><a href="/gostd/net/http/fcgi/child.go.html#6039491">req</a></span><span class="op" id="6039746">.</span><span class="ident" id="6039747"><a href="/gostd/net/http/fcgi/child.go.html#6034459">reqId</a></span><span class="op" id="6039752">,</span>&nbsp;<span class="op" id="6039754">[</span><span class="op" id="6039755">]</span><span class="builtintype" id="6039756">byte</span><span class="op" id="6039760">(</span><span class="ident" id="6039761"><a href="/gostd/net/http/fcgi/child.go.html#6039563">err</a></span><span class="op" id="6039764">.</span><span class="ident" id="6039765">Error</span><span class="op" id="6039770">(</span><span class="op" id="6039771">)</span><span class="op" id="6039772">)</span><span class="op" id="6039773">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6039776">}</span>&nbsp;<span class="keyword" id="6039778">else</span>&nbsp;<span class="op" id="6039783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6039787"><a href="/gostd/net/http/fcgi/child.go.html#6039554">httpReq</a></span><span class="op" id="6039794">.</span><span class="ident" id="6039795"><a href="/gostd/net/http/request.go.html#4137997">Body</a></span>&nbsp;<span class="op" id="6039800">=</span>&nbsp;<span class="ident" id="6039802"><a href="/gostd/net/http/fcgi/child.go.html#6039505">body</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6039809"><a href="/gostd/net/http/fcgi/child.go.html#6039468">c</a></span><span class="op" id="6039810">.</span><span class="ident" id="6039811"><a href="/gostd/net/http/fcgi/child.go.html#6036525">handler</a></span><span class="op" id="6039818">.</span><span class="ident" id="6039819"><a href="/gostd/net/http/server.go.html#4170434">ServeHTTP</a></span><span class="op" id="6039828">(</span><span class="ident" id="6039829"><a href="/gostd/net/http/fcgi/child.go.html#6039528">r</a></span><span class="op" id="6039830">,</span>&nbsp;<span class="ident" id="6039832"><a href="/gostd/net/http/fcgi/child.go.html#6039554">httpReq</a></span><span class="op" id="6039839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6039842">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6039845"><a href="/gostd/net/http/fcgi/child.go.html#6039528">r</a></span><span class="op" id="6039846">.</span><span class="ident" id="6039847"><a href="/gostd/net/http/fcgi/child.go.html#6036439">Close</a></span><span class="op" id="6039852">(</span><span class="op" id="6039853">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6039856"><a href="/gostd/net/http/fcgi/child.go.html#6039468">c</a></span><span class="op" id="6039857">.</span><span class="ident" id="6039858"><a href="/gostd/net/http/fcgi/child.go.html#6036548">mu</a></span><span class="op" id="6039860">.</span><span class="ident" id="6039861"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="6039865">(</span><span class="op" id="6039866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6039869">delete</span><span class="op" id="6039875">(</span><span class="ident" id="6039876"><a href="/gostd/net/http/fcgi/child.go.html#6039468">c</a></span><span class="op" id="6039877">.</span><span class="ident" id="6039878"><a href="/gostd/net/http/fcgi/child.go.html#6036600">requests</a></span><span class="op" id="6039886">,</span>&nbsp;<span class="ident" id="6039888"><a href="/gostd/net/http/fcgi/child.go.html#6039491">req</a></span><span class="op" id="6039891">.</span><span class="ident" id="6039892"><a href="/gostd/net/http/fcgi/child.go.html#6034459">reqId</a></span><span class="op" id="6039897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6039900"><a href="/gostd/net/http/fcgi/child.go.html#6039468">c</a></span><span class="op" id="6039901">.</span><span class="ident" id="6039902"><a href="/gostd/net/http/fcgi/child.go.html#6036548">mu</a></span><span class="op" id="6039904">.</span><span class="ident" id="6039905"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="6039911">(</span><span class="op" id="6039912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6039915"><a href="/gostd/net/http/fcgi/child.go.html#6039468">c</a></span><span class="op" id="6039916">.</span><span class="ident" id="6039917"><a href="/gostd/net/http/fcgi/child.go.html#6036510">conn</a></span><span class="op" id="6039921">.</span><span class="ident" id="6039922"><a href="/gostd/net/http/fcgi/fcgi.go.html#6044825">writeEndRequest</a></span><span class="op" id="6039937">(</span><span class="ident" id="6039938"><a href="/gostd/net/http/fcgi/child.go.html#6039491">req</a></span><span class="op" id="6039941">.</span><span class="ident" id="6039942"><a href="/gostd/net/http/fcgi/child.go.html#6034459">reqId</a></span><span class="op" id="6039947">,</span>&nbsp;<span class="num" id="6039949">0</span><span class="op" id="6039950">,</span>&nbsp;<span class="ident" id="6039952"><a href="/gostd/net/http/fcgi/fcgi.go.html#6042396">statusRequestComplete</a></span><span class="op" id="6039973">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6039977">//&nbsp;Consume&nbsp;the&nbsp;entire&nbsp;body,&nbsp;so&nbsp;the&nbsp;host&nbsp;isn&#39;t&nbsp;still&nbsp;writing&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6040041">//&nbsp;us&nbsp;when&nbsp;we&nbsp;close&nbsp;the&nbsp;socket&nbsp;below&nbsp;in&nbsp;the&nbsp;!keepConn&nbsp;case,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6040102">//&nbsp;otherwise&nbsp;we&#39;d&nbsp;send&nbsp;a&nbsp;RST.&nbsp;(golang.org/issue/4183)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6040157">//&nbsp;TODO(bradfitz):&nbsp;also&nbsp;bound&nbsp;this&nbsp;copy&nbsp;in&nbsp;time.&nbsp;Or&nbsp;send</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6040215">//&nbsp;some&nbsp;sort&nbsp;of&nbsp;abort&nbsp;request&nbsp;to&nbsp;the&nbsp;host,&nbsp;so&nbsp;the&nbsp;host</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6040271">//&nbsp;can&nbsp;properly&nbsp;cut&nbsp;off&nbsp;the&nbsp;client&nbsp;sending&nbsp;all&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6040329">//&nbsp;For&nbsp;now&nbsp;just&nbsp;bound&nbsp;it&nbsp;a&nbsp;little&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6040368"><a href="/gostd/net/http/fcgi/child.go.html#6034202">io</a></span><span class="op" id="6040370">.</span><span class="ident" id="6040371"><a href="/gostd/io/io.go.html#1430100">CopyN</a></span><span class="op" id="6040376">(</span><span class="ident" id="6040377"><a href="/gostd/net/http/fcgi/child.go.html#6034208">ioutil</a></span><span class="op" id="6040383">.</span><span class="ident" id="6040384"><a href="/gostd/io/ioutil/ioutil.go.html#3768458">Discard</a></span><span class="op" id="6040391">,</span>&nbsp;<span class="ident" id="6040393"><a href="/gostd/net/http/fcgi/child.go.html#6039505">body</a></span><span class="op" id="6040397">,</span>&nbsp;<span class="num" id="6040399">100</span><span class="op" id="6040402">&lt;&lt;</span><span class="num" id="6040404">20</span><span class="op" id="6040406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6040409"><a href="/gostd/net/http/fcgi/child.go.html#6039505">body</a></span><span class="op" id="6040413">.</span><span class="ident" id="6040414"><a href="/gostd/io/io.go.html#1422583">Close</a></span><span class="op" id="6040419">(</span><span class="op" id="6040420">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6040424">if</span>&nbsp;<span class="op" id="6040427">!</span><span class="ident" id="6040428"><a href="/gostd/net/http/fcgi/child.go.html#6039491">req</a></span><span class="op" id="6040431">.</span><span class="ident" id="6040432"><a href="/gostd/net/http/fcgi/child.go.html#6034546">keepConn</a></span>&nbsp;<span class="op" id="6040441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6040445"><a href="/gostd/net/http/fcgi/child.go.html#6039468">c</a></span><span class="op" id="6040446">.</span><span class="ident" id="6040447"><a href="/gostd/net/http/fcgi/child.go.html#6036510">conn</a></span><span class="op" id="6040451">.</span><span class="ident" id="6040452"><a href="/gostd/net/http/fcgi/fcgi.go.html#6043556">Close</a></span><span class="op" id="6040457">(</span><span class="op" id="6040458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6040461">}</span><br>
<span class="lineno"></span><span class="op" id="6040463">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span><span class="comment" id="6040466">//&nbsp;Serve&nbsp;accepts&nbsp;incoming&nbsp;FastCGI&nbsp;connections&nbsp;on&nbsp;the&nbsp;listener&nbsp;l,&nbsp;creating&nbsp;a&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="6040546">//&nbsp;goroutine&nbsp;for&nbsp;each.&nbsp;The&nbsp;goroutine&nbsp;reads&nbsp;requests&nbsp;and&nbsp;then&nbsp;calls&nbsp;handler</span><br>
<span class="lineno"></span><span class="comment" id="6040621">//&nbsp;to&nbsp;reply&nbsp;to&nbsp;them.</span><br>
<span class="lineno"></span><span class="comment" id="6040642">//&nbsp;If&nbsp;l&nbsp;is&nbsp;nil,&nbsp;Serve&nbsp;accepts&nbsp;connections&nbsp;from&nbsp;os.Stdin.</span><br>
<span class="lineno"></span><span class="comment" id="6040699">//&nbsp;If&nbsp;handler&nbsp;is&nbsp;nil,&nbsp;http.DefaultServeMux&nbsp;is&nbsp;used.</span><br>
<span class="lineno">285</span><span class="keyword" id="6040751">func</span>&nbsp;<span class="ident" id="6040756">Serve</span><span class="op" id="6040761">(</span><span class="ident" id="6040762">l</span>&nbsp;<span class="ident" id="6040764"><a href="/gostd/net/http/fcgi/child.go.html#6034221">net</a></span><span class="op" id="6040767">.</span><span class="ident" id="6040768"><a href="/gostd/net/net.go.html#3340703">Listener</a></span><span class="op" id="6040776">,</span>&nbsp;<span class="ident" id="6040778">handler</span>&nbsp;<span class="ident" id="6040786"><a href="/gostd/net/http/fcgi/child.go.html#6034228">http</a></span><span class="op" id="6040790">.</span><span class="ident" id="6040791"><a href="/gostd/net/http/server.go.html#4170413">Handler</a></span><span class="op" id="6040798">)</span>&nbsp;<span class="builtintype" id="6040800">error</span>&nbsp;<span class="op" id="6040806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6040809">if</span>&nbsp;<span class="ident" id="6040812"><a href="/gostd/net/http/fcgi/child.go.html#6040762">l</a></span>&nbsp;<span class="op" id="6040814">==</span>&nbsp;<span class="builtintype" id="6040817">nil</span>&nbsp;<span class="op" id="6040821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6040825">var</span>&nbsp;<span class="ident" id="6040829">err</span>&nbsp;<span class="builtintype" id="6040833">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6040841"><a href="/gostd/net/http/fcgi/child.go.html#6040762">l</a></span><span class="op" id="6040842">,</span>&nbsp;<span class="ident" id="6040844"><a href="/gostd/net/http/fcgi/child.go.html#6040829">err</a></span>&nbsp;<span class="op" id="6040848">=</span>&nbsp;<span class="ident" id="6040850"><a href="/gostd/net/http/fcgi/child.go.html#6034221">net</a></span><span class="op" id="6040853">.</span><span class="ident" id="6040854"><a href="/gostd/net/file_unix.go.html#3272009">FileListener</a></span><span class="op" id="6040866">(</span><span class="ident" id="6040867"><a href="/gostd/net/http/fcgi/child.go.html#6034256">os</a></span><span class="op" id="6040869">.</span><span class="ident" id="6040870"><a href="/gostd/os/file.go.html#2441758">Stdin</a></span><span class="op" id="6040875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6040879">if</span>&nbsp;<span class="ident" id="6040882"><a href="/gostd/net/http/fcgi/child.go.html#6040829">err</a></span>&nbsp;<span class="op" id="6040886">!=</span>&nbsp;<span class="builtintype" id="6040889">nil</span>&nbsp;<span class="op" id="6040893">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6040898">return</span>&nbsp;<span class="ident" id="6040905"><a href="/gostd/net/http/fcgi/child.go.html#6040829">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6040911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6040915">defer</span>&nbsp;<span class="ident" id="6040921"><a href="/gostd/net/http/fcgi/child.go.html#6040762">l</a></span><span class="op" id="6040922">.</span><span class="ident" id="6040923"><a href="/gostd/net/net.go.html#3340928">Close</a></span><span class="op" id="6040928">(</span><span class="op" id="6040929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6040932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6040935">if</span>&nbsp;<span class="ident" id="6040938"><a href="/gostd/net/http/fcgi/child.go.html#6040778">handler</a></span>&nbsp;<span class="op" id="6040946">==</span>&nbsp;<span class="builtintype" id="6040949">nil</span>&nbsp;<span class="op" id="6040953">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6040957"><a href="/gostd/net/http/fcgi/child.go.html#6040778">handler</a></span>&nbsp;<span class="op" id="6040965">=</span>&nbsp;<span class="ident" id="6040967"><a href="/gostd/net/http/fcgi/child.go.html#6034228">http</a></span><span class="op" id="6040971">.</span><span class="ident" id="6040972"><a href="/gostd/net/http/server.go.html#4211381">DefaultServeMux</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6040989">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6040992">for</span>&nbsp;<span class="op" id="6040996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6041000">rw</span><span class="op" id="6041002">,</span>&nbsp;<span class="ident" id="6041004">err</span>&nbsp;<span class="op" id="6041008">:=</span>&nbsp;<span class="ident" id="6041011"><a href="/gostd/net/http/fcgi/child.go.html#6040762">l</a></span><span class="op" id="6041012">.</span><span class="ident" id="6041013"><a href="/gostd/net/net.go.html#3340795">Accept</a></span><span class="op" id="6041019">(</span><span class="op" id="6041020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6041024">if</span>&nbsp;<span class="ident" id="6041027"><a href="/gostd/net/http/fcgi/child.go.html#6041004">err</a></span>&nbsp;<span class="op" id="6041031">!=</span>&nbsp;<span class="builtintype" id="6041034">nil</span>&nbsp;<span class="op" id="6041038">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6041043">return</span>&nbsp;<span class="ident" id="6041050"><a href="/gostd/net/http/fcgi/child.go.html#6041004">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6041056">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6041060">c</span>&nbsp;<span class="op" id="6041062">:=</span>&nbsp;<span class="ident" id="6041065"><a href="/gostd/net/http/fcgi/child.go.html#6036660">newChild</a></span><span class="op" id="6041073">(</span><span class="ident" id="6041074"><a href="/gostd/net/http/fcgi/child.go.html#6041000">rw</a></span><span class="op" id="6041076">,</span>&nbsp;<span class="ident" id="6041078"><a href="/gostd/net/http/fcgi/child.go.html#6040778">handler</a></span><span class="op" id="6041085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6041089">go</span>&nbsp;<span class="ident" id="6041092"><a href="/gostd/net/http/fcgi/child.go.html#6041060">c</a></span><span class="op" id="6041093">.</span><span class="ident" id="6041094"><a href="/gostd/net/http/fcgi/child.go.html#6036848">serve</a></span><span class="op" id="6041099">(</span><span class="op" id="6041100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6041103">}</span><br>
<span class="lineno">305</span><span class="op" id="6041105">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
