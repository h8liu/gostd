<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1626682">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1626737">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1626791">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1626842">package</span>&nbsp;<span class="ident" id="1626850">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1626859">import</span>&nbsp;<span class="string" id="1626866">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1626876">func</span>&nbsp;<span class="ident" id="1626881">newsysmon</span><span class="op" id="1626890">(</span><span class="op" id="1626891">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1626894">func</span>&nbsp;<span class="ident" id="1626899">runtime_init</span><span class="op" id="1626911">(</span><span class="op" id="1626912">)</span><br>
<span class="lineno"></span><span class="keyword" id="1626914">func</span>&nbsp;<span class="ident" id="1626919">main_init</span><span class="op" id="1626928">(</span><span class="op" id="1626929">)</span><br>
<span class="lineno"></span><span class="keyword" id="1626931">func</span>&nbsp;<span class="ident" id="1626936">main_main</span><span class="op" id="1626945">(</span><span class="op" id="1626946">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="1626949">//&nbsp;The&nbsp;main&nbsp;goroutine.</span><br>
<span class="lineno"></span><span class="keyword" id="1626972">func</span>&nbsp;<span class="ident" id="1626977">main</span><span class="op" id="1626981">(</span><span class="op" id="1626982">)</span>&nbsp;<span class="op" id="1626984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1626987">g</span>&nbsp;<span class="op" id="1626989">:=</span>&nbsp;<span class="ident" id="1626992">getg</span><span class="op" id="1626996">(</span><span class="op" id="1626997">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1627001">//&nbsp;Racectx&nbsp;of&nbsp;m0-&gt;g0&nbsp;is&nbsp;used&nbsp;only&nbsp;as&nbsp;the&nbsp;parent&nbsp;of&nbsp;the&nbsp;main&nbsp;goroutine.</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1627073">//&nbsp;It&nbsp;must&nbsp;not&nbsp;be&nbsp;used&nbsp;for&nbsp;anything&nbsp;else.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1627116">g</span><span class="op" id="1627117">.</span><span class="ident" id="1627118">m</span><span class="op" id="1627119">.</span><span class="ident" id="1627120">g0</span><span class="op" id="1627122">.</span><span class="ident" id="1627123">racectx</span>&nbsp;<span class="op" id="1627131">=</span>&nbsp;<span class="num" id="1627133">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1627137">//&nbsp;Max&nbsp;stack&nbsp;size&nbsp;is&nbsp;1&nbsp;GB&nbsp;on&nbsp;64-bit,&nbsp;250&nbsp;MB&nbsp;on&nbsp;32-bit.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1627193">//&nbsp;Using&nbsp;decimal&nbsp;instead&nbsp;of&nbsp;binary&nbsp;GB&nbsp;and&nbsp;MB&nbsp;because</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1627247">//&nbsp;they&nbsp;look&nbsp;nicer&nbsp;in&nbsp;the&nbsp;stack&nbsp;overflow&nbsp;failure&nbsp;message.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1627306">if</span>&nbsp;<span class="ident" id="1627309">ptrSize</span>&nbsp;<span class="op" id="1627317">==</span>&nbsp;<span class="num" id="1627320">8</span>&nbsp;<span class="op" id="1627322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1627326">maxstacksize</span>&nbsp;<span class="op" id="1627339">=</span>&nbsp;<span class="num" id="1627341">1000000000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1627353">}</span>&nbsp;<span class="keyword" id="1627355">else</span>&nbsp;<span class="op" id="1627360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1627364">maxstacksize</span>&nbsp;<span class="op" id="1627377">=</span>&nbsp;<span class="num" id="1627379">250000000</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1627390">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1627394">onM</span><span class="op" id="1627397">(</span><span class="ident" id="1627398">newsysmon</span><span class="op" id="1627407">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1627411">//&nbsp;Lock&nbsp;the&nbsp;main&nbsp;goroutine&nbsp;onto&nbsp;this,&nbsp;the&nbsp;main&nbsp;OS&nbsp;thread,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1627470">//&nbsp;during&nbsp;initialization.&nbsp;&nbsp;Most&nbsp;programs&nbsp;won&#39;t&nbsp;care,&nbsp;but&nbsp;a&nbsp;few</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1627534">//&nbsp;do&nbsp;require&nbsp;certain&nbsp;calls&nbsp;to&nbsp;be&nbsp;made&nbsp;by&nbsp;the&nbsp;main&nbsp;thread.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1627594">//&nbsp;Those&nbsp;can&nbsp;arrange&nbsp;for&nbsp;main.main&nbsp;to&nbsp;run&nbsp;in&nbsp;the&nbsp;main&nbsp;thread</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1627656">//&nbsp;by&nbsp;calling&nbsp;runtime.LockOSThread&nbsp;during&nbsp;initialization</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1627714">//&nbsp;to&nbsp;preserve&nbsp;the&nbsp;lock.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1627740">lockOSThread</span><span class="op" id="1627752">(</span><span class="op" id="1627753">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1627757">if</span>&nbsp;<span class="ident" id="1627760">g</span><span class="op" id="1627761">.</span><span class="ident" id="1627762">m</span>&nbsp;<span class="op" id="1627764">!=</span>&nbsp;<span class="op" id="1627767">&amp;</span><span class="ident" id="1627768">m0</span>&nbsp;<span class="op" id="1627771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1627775">gothrow</span><span class="op" id="1627782">(</span><span class="string" id="1627783">&#34;runtime.main&nbsp;not&nbsp;on&nbsp;m0&#34;</span><span class="op" id="1627807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1627810">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1627814">runtime_init</span><span class="op" id="1627826">(</span><span class="op" id="1627827">)</span>&nbsp;<span class="comment" id="1627829">//&nbsp;must&nbsp;be&nbsp;before&nbsp;defer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1627855">//&nbsp;Defer&nbsp;unlock&nbsp;so&nbsp;that&nbsp;runtime.Goexit&nbsp;during&nbsp;init&nbsp;does&nbsp;the&nbsp;unlock&nbsp;too.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1627928">needUnlock</span>&nbsp;<span class="op" id="1627939">:=</span>&nbsp;<span class="builtintype" id="1627942">true</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1627948">defer</span>&nbsp;<span class="keyword" id="1627954">func</span><span class="op" id="1627958">(</span><span class="op" id="1627959">)</span>&nbsp;<span class="op" id="1627961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1627965">if</span>&nbsp;<span class="ident" id="1627968">needUnlock</span>&nbsp;<span class="op" id="1627979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1627984">unlockOSThread</span><span class="op" id="1627998">(</span><span class="op" id="1627999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1628003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1628006">}</span><span class="op" id="1628007">(</span><span class="op" id="1628008">)</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1628012">memstats</span><span class="op" id="1628020">.</span><span class="ident" id="1628021">enablegc</span>&nbsp;<span class="op" id="1628030">=</span>&nbsp;<span class="builtintype" id="1628032">true</span>&nbsp;<span class="comment" id="1628037">//&nbsp;now&nbsp;that&nbsp;runtime&nbsp;is&nbsp;initialized,&nbsp;GC&nbsp;is&nbsp;okay</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1628086">main_init</span><span class="op" id="1628095">(</span><span class="op" id="1628096">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1628100">needUnlock</span>&nbsp;<span class="op" id="1628111">=</span>&nbsp;<span class="builtintype" id="1628113">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1628120">unlockOSThread</span><span class="op" id="1628134">(</span><span class="op" id="1628135">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1628139">main_main</span><span class="op" id="1628148">(</span><span class="op" id="1628149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1628152">if</span>&nbsp;<span class="ident" id="1628155">raceenabled</span>&nbsp;<span class="op" id="1628167">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1628171">racefini</span><span class="op" id="1628179">(</span><span class="op" id="1628180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1628183">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1628187">//&nbsp;Make&nbsp;racy&nbsp;client&nbsp;program&nbsp;work:&nbsp;if&nbsp;panicking&nbsp;on</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1628238">//&nbsp;another&nbsp;goroutine&nbsp;at&nbsp;the&nbsp;same&nbsp;time&nbsp;as&nbsp;main&nbsp;returns,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1628294">//&nbsp;let&nbsp;the&nbsp;other&nbsp;goroutine&nbsp;finish&nbsp;printing&nbsp;the&nbsp;panic&nbsp;trace.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1628355">//&nbsp;Once&nbsp;it&nbsp;does,&nbsp;it&nbsp;will&nbsp;exit.&nbsp;See&nbsp;issue&nbsp;3934.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1628403">if</span>&nbsp;<span class="ident" id="1628406">panicking</span>&nbsp;<span class="op" id="1628416">!=</span>&nbsp;<span class="num" id="1628419">0</span>&nbsp;<span class="op" id="1628421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1628425">gopark</span><span class="op" id="1628431">(</span><span class="ident" id="1628432">nil</span><span class="op" id="1628435">,</span>&nbsp;<span class="ident" id="1628437">nil</span><span class="op" id="1628440">,</span>&nbsp;<span class="string" id="1628442">&#34;panicwait&#34;</span><span class="op" id="1628453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1628456">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1628460">exit</span><span class="op" id="1628464">(</span><span class="num" id="1628465">0</span><span class="op" id="1628466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1628469">for</span>&nbsp;<span class="op" id="1628473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1628477">var</span>&nbsp;<span class="ident" id="1628481">x</span>&nbsp;<span class="op" id="1628483">*</span><span class="builtintype" id="1628484">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1628492">*</span><span class="ident" id="1628493">x</span>&nbsp;<span class="op" id="1628495">=</span>&nbsp;<span class="num" id="1628497">0</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1628500">}</span><br>
<span class="lineno"></span><span class="op" id="1628502">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1628505">var</span>&nbsp;<span class="ident" id="1628509">parkunlock_c</span>&nbsp;<span class="builtintype" id="1628522">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="1628528">//&nbsp;start&nbsp;forcegc&nbsp;helper&nbsp;goroutine</span><br>
<span class="lineno"></span><span class="keyword" id="1628562">func</span>&nbsp;<span class="ident" id="1628567">init</span><span class="op" id="1628571">(</span><span class="op" id="1628572">)</span>&nbsp;<span class="op" id="1628574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1628577">go</span>&nbsp;<span class="ident" id="1628580">forcegchelper</span><span class="op" id="1628593">(</span><span class="op" id="1628594">)</span><br>
<span class="lineno"></span><span class="op" id="1628596">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="1628599">func</span>&nbsp;<span class="ident" id="1628604">forcegchelper</span><span class="op" id="1628617">(</span><span class="op" id="1628618">)</span>&nbsp;<span class="op" id="1628620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1628623">forcegc</span><span class="op" id="1628630">.</span><span class="ident" id="1628631">g</span>&nbsp;<span class="op" id="1628633">=</span>&nbsp;<span class="ident" id="1628635">getg</span><span class="op" id="1628639">(</span><span class="op" id="1628640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1628643">forcegc</span><span class="op" id="1628650">.</span><span class="ident" id="1628651">g</span><span class="op" id="1628652">.</span><span class="ident" id="1628653">issystem</span>&nbsp;<span class="op" id="1628662">=</span>&nbsp;<span class="builtintype" id="1628664">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1628670">for</span>&nbsp;<span class="op" id="1628674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1628678">lock</span><span class="op" id="1628682">(</span><span class="op" id="1628683">&amp;</span><span class="ident" id="1628684">forcegc</span><span class="op" id="1628691">.</span><span class="ident" id="1628692">lock</span><span class="op" id="1628696">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1628700">if</span>&nbsp;<span class="ident" id="1628703">forcegc</span><span class="op" id="1628710">.</span><span class="ident" id="1628711">idle</span>&nbsp;<span class="op" id="1628716">!=</span>&nbsp;<span class="num" id="1628719">0</span>&nbsp;<span class="op" id="1628721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1628726">gothrow</span><span class="op" id="1628733">(</span><span class="string" id="1628734">&#34;forcegc:&nbsp;phase&nbsp;error&#34;</span><span class="op" id="1628756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1628760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1628764">atomicstore</span><span class="op" id="1628775">(</span><span class="op" id="1628776">&amp;</span><span class="ident" id="1628777">forcegc</span><span class="op" id="1628784">.</span><span class="ident" id="1628785">idle</span><span class="op" id="1628789">,</span>&nbsp;<span class="num" id="1628791">1</span><span class="op" id="1628792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1628796">goparkunlock</span><span class="op" id="1628808">(</span><span class="op" id="1628809">&amp;</span><span class="ident" id="1628810">forcegc</span><span class="op" id="1628817">.</span><span class="ident" id="1628818">lock</span><span class="op" id="1628822">,</span>&nbsp;<span class="string" id="1628824">&#34;force&nbsp;gc&nbsp;(idle)&#34;</span><span class="op" id="1628841">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1628845">//&nbsp;this&nbsp;goroutine&nbsp;is&nbsp;explicitly&nbsp;resumed&nbsp;by&nbsp;sysmon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1628897">if</span>&nbsp;<span class="ident" id="1628900">debug</span><span class="op" id="1628905">.</span><span class="ident" id="1628906">gctrace</span>&nbsp;<span class="op" id="1628914">&gt;</span>&nbsp;<span class="num" id="1628916">0</span>&nbsp;<span class="op" id="1628918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1628923">println</span><span class="op" id="1628930">(</span><span class="string" id="1628931">&#34;GC&nbsp;forced&#34;</span><span class="op" id="1628942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1628946">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1628950">gogc</span><span class="op" id="1628954">(</span><span class="num" id="1628955">1</span><span class="op" id="1628956">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1628959">}</span><br>
<span class="lineno"></span><span class="op" id="1628961">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1628964">//go:nosplit</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="1628978">//&nbsp;Gosched&nbsp;yields&nbsp;the&nbsp;processor,&nbsp;allowing&nbsp;other&nbsp;goroutines&nbsp;to&nbsp;run.&nbsp;&nbsp;It&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="1629058">//&nbsp;suspend&nbsp;the&nbsp;current&nbsp;goroutine,&nbsp;so&nbsp;execution&nbsp;resumes&nbsp;automatically.</span><br>
<span class="lineno"></span><span class="keyword" id="1629128">func</span>&nbsp;<span class="ident" id="1629133">Gosched</span><span class="op" id="1629140">(</span><span class="op" id="1629141">)</span>&nbsp;<span class="op" id="1629143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1629146">mcall</span><span class="op" id="1629151">(</span><span class="ident" id="1629152">gosched_m</span><span class="op" id="1629161">)</span><br>
<span class="lineno"></span><span class="op" id="1629163">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="1629166">//&nbsp;Puts&nbsp;the&nbsp;current&nbsp;goroutine&nbsp;into&nbsp;a&nbsp;waiting&nbsp;state&nbsp;and&nbsp;calls&nbsp;unlockf.</span><br>
<span class="lineno"></span><span class="comment" id="1629236">//&nbsp;If&nbsp;unlockf&nbsp;returns&nbsp;false,&nbsp;the&nbsp;goroutine&nbsp;is&nbsp;resumed.</span><br>
<span class="lineno"></span><span class="keyword" id="1629291">func</span>&nbsp;<span class="ident" id="1629296">gopark</span><span class="op" id="1629302">(</span><span class="ident" id="1629303">unlockf</span>&nbsp;<span class="ident" id="1629311">unsafe</span><span class="op" id="1629317">.</span><span class="ident" id="1629318">Pointer</span><span class="op" id="1629325">,</span>&nbsp;<span class="ident" id="1629327">lock</span>&nbsp;<span class="ident" id="1629332">unsafe</span><span class="op" id="1629338">.</span><span class="ident" id="1629339">Pointer</span><span class="op" id="1629346">,</span>&nbsp;<span class="ident" id="1629348">reason</span>&nbsp;<span class="builtintype" id="1629355">string</span><span class="op" id="1629361">)</span>&nbsp;<span class="op" id="1629363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1629366">mp</span>&nbsp;<span class="op" id="1629369">:=</span>&nbsp;<span class="ident" id="1629372">acquirem</span><span class="op" id="1629380">(</span><span class="op" id="1629381">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1629384">gp</span>&nbsp;<span class="op" id="1629387">:=</span>&nbsp;<span class="ident" id="1629390">mp</span><span class="op" id="1629392">.</span><span class="ident" id="1629393">curg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1629399">status</span>&nbsp;<span class="op" id="1629406">:=</span>&nbsp;<span class="ident" id="1629409">readgstatus</span><span class="op" id="1629420">(</span><span class="ident" id="1629421">gp</span><span class="op" id="1629423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1629426">if</span>&nbsp;<span class="ident" id="1629429">status</span>&nbsp;<span class="op" id="1629436">!=</span>&nbsp;<span class="ident" id="1629439">_Grunning</span>&nbsp;<span class="op" id="1629449">&amp;&amp;</span>&nbsp;<span class="ident" id="1629452">status</span>&nbsp;<span class="op" id="1629459">!=</span>&nbsp;<span class="ident" id="1629462">_Gscanrunning</span>&nbsp;<span class="op" id="1629476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1629480">gothrow</span><span class="op" id="1629487">(</span><span class="string" id="1629488">&#34;gopark:&nbsp;bad&nbsp;g&nbsp;status&#34;</span><span class="op" id="1629510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1629513">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1629516">mp</span><span class="op" id="1629518">.</span><span class="ident" id="1629519">waitlock</span>&nbsp;<span class="op" id="1629528">=</span>&nbsp;<span class="ident" id="1629530">lock</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1629536">mp</span><span class="op" id="1629538">.</span><span class="ident" id="1629539">waitunlockf</span>&nbsp;<span class="op" id="1629551">=</span>&nbsp;<span class="ident" id="1629553">unlockf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1629562">gp</span><span class="op" id="1629564">.</span><span class="ident" id="1629565">waitreason</span>&nbsp;<span class="op" id="1629576">=</span>&nbsp;<span class="ident" id="1629578">reason</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1629586">releasem</span><span class="op" id="1629594">(</span><span class="ident" id="1629595">mp</span><span class="op" id="1629597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1629600">//&nbsp;can&#39;t&nbsp;do&nbsp;anything&nbsp;that&nbsp;might&nbsp;move&nbsp;the&nbsp;G&nbsp;between&nbsp;Ms&nbsp;here.</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1629661">mcall</span><span class="op" id="1629666">(</span><span class="ident" id="1629667">park_m</span><span class="op" id="1629673">)</span><br>
<span class="lineno"></span><span class="op" id="1629675">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1629678">//&nbsp;Puts&nbsp;the&nbsp;current&nbsp;goroutine&nbsp;into&nbsp;a&nbsp;waiting&nbsp;state&nbsp;and&nbsp;unlocks&nbsp;the&nbsp;lock.</span><br>
<span class="lineno"></span><span class="comment" id="1629751">//&nbsp;The&nbsp;goroutine&nbsp;can&nbsp;be&nbsp;made&nbsp;runnable&nbsp;again&nbsp;by&nbsp;calling&nbsp;goready(gp).</span><br>
<span class="lineno">135</span><span class="keyword" id="1629819">func</span>&nbsp;<span class="ident" id="1629824">goparkunlock</span><span class="op" id="1629836">(</span><span class="ident" id="1629837">lock</span>&nbsp;<span class="op" id="1629842">*</span><span class="ident" id="1629843">mutex</span><span class="op" id="1629848">,</span>&nbsp;<span class="ident" id="1629850">reason</span>&nbsp;<span class="builtintype" id="1629857">string</span><span class="op" id="1629863">)</span>&nbsp;<span class="op" id="1629865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1629868">gopark</span><span class="op" id="1629874">(</span><span class="ident" id="1629875">unsafe</span><span class="op" id="1629881">.</span><span class="ident" id="1629882">Pointer</span><span class="op" id="1629889">(</span><span class="op" id="1629890">&amp;</span><span class="ident" id="1629891">parkunlock_c</span><span class="op" id="1629903">)</span><span class="op" id="1629904">,</span>&nbsp;<span class="ident" id="1629906">unsafe</span><span class="op" id="1629912">.</span><span class="ident" id="1629913">Pointer</span><span class="op" id="1629920">(</span><span class="ident" id="1629921">lock</span><span class="op" id="1629925">)</span><span class="op" id="1629926">,</span>&nbsp;<span class="ident" id="1629928">reason</span><span class="op" id="1629934">)</span><br>
<span class="lineno"></span><span class="op" id="1629936">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1629939">func</span>&nbsp;<span class="ident" id="1629944">goready</span><span class="op" id="1629951">(</span><span class="ident" id="1629952">gp</span>&nbsp;<span class="op" id="1629955">*</span><span class="ident" id="1629956">g</span><span class="op" id="1629957">)</span>&nbsp;<span class="op" id="1629959">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1629962">mp</span>&nbsp;<span class="op" id="1629965">:=</span>&nbsp;<span class="ident" id="1629968">acquirem</span><span class="op" id="1629976">(</span><span class="op" id="1629977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1629980">mp</span><span class="op" id="1629982">.</span><span class="ident" id="1629983">ptrarg</span><span class="op" id="1629989">[</span><span class="num" id="1629990">0</span><span class="op" id="1629991">]</span>&nbsp;<span class="op" id="1629993">=</span>&nbsp;<span class="ident" id="1629995">unsafe</span><span class="op" id="1630001">.</span><span class="ident" id="1630002">Pointer</span><span class="op" id="1630009">(</span><span class="ident" id="1630010">gp</span><span class="op" id="1630012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1630015">onM</span><span class="op" id="1630018">(</span><span class="ident" id="1630019">ready_m</span><span class="op" id="1630026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1630029">releasem</span><span class="op" id="1630037">(</span><span class="ident" id="1630038">mp</span><span class="op" id="1630040">)</span><br>
<span class="lineno"></span><span class="op" id="1630042">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="comment" id="1630045">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1630058">func</span>&nbsp;<span class="ident" id="1630063">acquireSudog</span><span class="op" id="1630075">(</span><span class="op" id="1630076">)</span>&nbsp;<span class="op" id="1630078">*</span><span class="ident" id="1630079">sudog</span>&nbsp;<span class="op" id="1630085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1630088">c</span>&nbsp;<span class="op" id="1630090">:=</span>&nbsp;<span class="ident" id="1630093">gomcache</span><span class="op" id="1630101">(</span><span class="op" id="1630102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1630105">s</span>&nbsp;<span class="op" id="1630107">:=</span>&nbsp;<span class="ident" id="1630110">c</span><span class="op" id="1630111">.</span><span class="ident" id="1630112">sudogcache</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1630124">if</span>&nbsp;<span class="ident" id="1630127">s</span>&nbsp;<span class="op" id="1630129">!=</span>&nbsp;<span class="ident" id="1630132">nil</span>&nbsp;<span class="op" id="1630136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1630140">if</span>&nbsp;<span class="ident" id="1630143">s</span><span class="op" id="1630144">.</span><span class="ident" id="1630145">elem</span>&nbsp;<span class="op" id="1630150">!=</span>&nbsp;<span class="ident" id="1630153">nil</span>&nbsp;<span class="op" id="1630157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1630162">gothrow</span><span class="op" id="1630169">(</span><span class="string" id="1630170">&#34;acquireSudog:&nbsp;found&nbsp;s.elem&nbsp;!=&nbsp;nil&nbsp;in&nbsp;cache&#34;</span><span class="op" id="1630214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1630218">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1630222">c</span><span class="op" id="1630223">.</span><span class="ident" id="1630224">sudogcache</span>&nbsp;<span class="op" id="1630235">=</span>&nbsp;<span class="ident" id="1630237">s</span><span class="op" id="1630238">.</span><span class="ident" id="1630239">next</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1630246">s</span><span class="op" id="1630247">.</span><span class="ident" id="1630248">next</span>&nbsp;<span class="op" id="1630253">=</span>&nbsp;<span class="ident" id="1630255">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1630261">return</span>&nbsp;<span class="ident" id="1630268">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1630271">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1630275">//&nbsp;Delicate&nbsp;dance:&nbsp;the&nbsp;semaphore&nbsp;implementation&nbsp;calls</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1630330">//&nbsp;acquireSudog,&nbsp;acquireSudog&nbsp;calls&nbsp;new(sudog),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1630379">//&nbsp;new&nbsp;calls&nbsp;malloc,&nbsp;malloc&nbsp;can&nbsp;call&nbsp;the&nbsp;garbage&nbsp;collector,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1630440">//&nbsp;and&nbsp;the&nbsp;garbage&nbsp;collector&nbsp;calls&nbsp;the&nbsp;semaphore&nbsp;implementation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1630505">//&nbsp;in&nbsp;stoptheworld.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1630526">//&nbsp;Break&nbsp;the&nbsp;cycle&nbsp;by&nbsp;doing&nbsp;acquirem/releasem&nbsp;around&nbsp;new(sudog).</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1630592">//&nbsp;The&nbsp;acquirem/releasem&nbsp;increments&nbsp;m.locks&nbsp;during&nbsp;new(sudog),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1630656">//&nbsp;which&nbsp;keeps&nbsp;the&nbsp;garbage&nbsp;collector&nbsp;from&nbsp;being&nbsp;invoked.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1630714">mp</span>&nbsp;<span class="op" id="1630717">:=</span>&nbsp;<span class="ident" id="1630720">acquirem</span><span class="op" id="1630728">(</span><span class="op" id="1630729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1630732">p</span>&nbsp;<span class="op" id="1630734">:=</span>&nbsp;<span class="builtinfunc" id="1630737">new</span><span class="op" id="1630740">(</span><span class="ident" id="1630741">sudog</span><span class="op" id="1630746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1630749">releasem</span><span class="op" id="1630757">(</span><span class="ident" id="1630758">mp</span><span class="op" id="1630760">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1630763">return</span>&nbsp;<span class="ident" id="1630770">p</span><br>
<span class="lineno"></span><span class="op" id="1630772">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1630775">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1630788">func</span>&nbsp;<span class="ident" id="1630793">releaseSudog</span><span class="op" id="1630805">(</span><span class="ident" id="1630806">s</span>&nbsp;<span class="op" id="1630808">*</span><span class="ident" id="1630809">sudog</span><span class="op" id="1630814">)</span>&nbsp;<span class="op" id="1630816">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1630819">if</span>&nbsp;<span class="ident" id="1630822">s</span><span class="op" id="1630823">.</span><span class="ident" id="1630824">elem</span>&nbsp;<span class="op" id="1630829">!=</span>&nbsp;<span class="ident" id="1630832">nil</span>&nbsp;<span class="op" id="1630836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1630840">gothrow</span><span class="op" id="1630847">(</span><span class="string" id="1630848">&#34;runtime:&nbsp;sudog&nbsp;with&nbsp;non-nil&nbsp;elem&#34;</span><span class="op" id="1630882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1630885">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1630888">if</span>&nbsp;<span class="ident" id="1630891">s</span><span class="op" id="1630892">.</span><span class="ident" id="1630893">selectdone</span>&nbsp;<span class="op" id="1630904">!=</span>&nbsp;<span class="ident" id="1630907">nil</span>&nbsp;<span class="op" id="1630911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1630915">gothrow</span><span class="op" id="1630922">(</span><span class="string" id="1630923">&#34;runtime:&nbsp;sudog&nbsp;with&nbsp;non-nil&nbsp;selectdone&#34;</span><span class="op" id="1630963">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1630966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1630969">if</span>&nbsp;<span class="ident" id="1630972">s</span><span class="op" id="1630973">.</span><span class="ident" id="1630974">next</span>&nbsp;<span class="op" id="1630979">!=</span>&nbsp;<span class="ident" id="1630982">nil</span>&nbsp;<span class="op" id="1630986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1630990">gothrow</span><span class="op" id="1630997">(</span><span class="string" id="1630998">&#34;runtime:&nbsp;sudog&nbsp;with&nbsp;non-nil&nbsp;next&#34;</span><span class="op" id="1631032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1631035">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1631038">if</span>&nbsp;<span class="ident" id="1631041">s</span><span class="op" id="1631042">.</span><span class="ident" id="1631043">prev</span>&nbsp;<span class="op" id="1631048">!=</span>&nbsp;<span class="ident" id="1631051">nil</span>&nbsp;<span class="op" id="1631055">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1631059">gothrow</span><span class="op" id="1631066">(</span><span class="string" id="1631067">&#34;runtime:&nbsp;sudog&nbsp;with&nbsp;non-nil&nbsp;prev&#34;</span><span class="op" id="1631101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1631104">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1631107">if</span>&nbsp;<span class="ident" id="1631110">s</span><span class="op" id="1631111">.</span><span class="ident" id="1631112">waitlink</span>&nbsp;<span class="op" id="1631121">!=</span>&nbsp;<span class="ident" id="1631124">nil</span>&nbsp;<span class="op" id="1631128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1631132">gothrow</span><span class="op" id="1631139">(</span><span class="string" id="1631140">&#34;runtime:&nbsp;sudog&nbsp;with&nbsp;non-nil&nbsp;waitlink&#34;</span><span class="op" id="1631178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1631181">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1631184">gp</span>&nbsp;<span class="op" id="1631187">:=</span>&nbsp;<span class="ident" id="1631190">getg</span><span class="op" id="1631194">(</span><span class="op" id="1631195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1631198">if</span>&nbsp;<span class="ident" id="1631201">gp</span><span class="op" id="1631203">.</span><span class="ident" id="1631204">param</span>&nbsp;<span class="op" id="1631210">!=</span>&nbsp;<span class="ident" id="1631213">nil</span>&nbsp;<span class="op" id="1631217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1631221">gothrow</span><span class="op" id="1631228">(</span><span class="string" id="1631229">&#34;runtime:&nbsp;releaseSudog&nbsp;with&nbsp;non-nil&nbsp;gp.param&#34;</span><span class="op" id="1631274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1631277">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1631280">c</span>&nbsp;<span class="op" id="1631282">:=</span>&nbsp;<span class="ident" id="1631285">gomcache</span><span class="op" id="1631293">(</span><span class="op" id="1631294">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1631297">s</span><span class="op" id="1631298">.</span><span class="ident" id="1631299">next</span>&nbsp;<span class="op" id="1631304">=</span>&nbsp;<span class="ident" id="1631306">c</span><span class="op" id="1631307">.</span><span class="ident" id="1631308">sudogcache</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1631320">c</span><span class="op" id="1631321">.</span><span class="ident" id="1631322">sudogcache</span>&nbsp;<span class="op" id="1631333">=</span>&nbsp;<span class="ident" id="1631335">s</span><br>
<span class="lineno"></span><span class="op" id="1631337">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1631340">//&nbsp;funcPC&nbsp;returns&nbsp;the&nbsp;entry&nbsp;PC&nbsp;of&nbsp;the&nbsp;function&nbsp;f.</span><br>
<span class="lineno">200</span><span class="comment" id="1631390">//&nbsp;It&nbsp;assumes&nbsp;that&nbsp;f&nbsp;is&nbsp;a&nbsp;func&nbsp;value.&nbsp;Otherwise&nbsp;the&nbsp;behavior&nbsp;is&nbsp;undefined.</span><br>
<span class="lineno"></span><span class="comment" id="1631465">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1631478">func</span>&nbsp;<span class="ident" id="1631483">funcPC</span><span class="op" id="1631489">(</span><span class="ident" id="1631490">f</span>&nbsp;<span class="keyword" id="1631492">interface</span><span class="op" id="1631501">{</span><span class="op" id="1631502">}</span><span class="op" id="1631503">)</span>&nbsp;<span class="builtintype" id="1631505">uintptr</span>&nbsp;<span class="op" id="1631513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1631516">return</span>&nbsp;<span class="op" id="1631523">*</span><span class="op" id="1631524">*</span><span class="op" id="1631525">(</span><span class="op" id="1631526">*</span><span class="op" id="1631527">*</span><span class="builtintype" id="1631528">uintptr</span><span class="op" id="1631535">)</span><span class="op" id="1631536">(</span><span class="ident" id="1631537">add</span><span class="op" id="1631540">(</span><span class="ident" id="1631541">unsafe</span><span class="op" id="1631547">.</span><span class="ident" id="1631548">Pointer</span><span class="op" id="1631555">(</span><span class="op" id="1631556">&amp;</span><span class="ident" id="1631557">f</span><span class="op" id="1631558">)</span><span class="op" id="1631559">,</span>&nbsp;<span class="ident" id="1631561">ptrSize</span><span class="op" id="1631568">)</span><span class="op" id="1631569">)</span><br>
<span class="lineno"></span><span class="op" id="1631571">}</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span><span class="comment" id="1631574">//&nbsp;called&nbsp;from&nbsp;assembly</span><br>
<span class="lineno"></span><span class="keyword" id="1631598">func</span>&nbsp;<span class="ident" id="1631603">badmcall</span><span class="op" id="1631611">(</span><span class="ident" id="1631612">fn</span>&nbsp;<span class="keyword" id="1631615">func</span><span class="op" id="1631619">(</span><span class="op" id="1631620">*</span><span class="ident" id="1631621">g</span><span class="op" id="1631622">)</span><span class="op" id="1631623">)</span>&nbsp;<span class="op" id="1631625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1631628">gothrow</span><span class="op" id="1631635">(</span><span class="string" id="1631636">&#34;runtime:&nbsp;mcall&nbsp;called&nbsp;on&nbsp;m-&gt;g0&nbsp;stack&#34;</span><span class="op" id="1631674">)</span><br>
<span class="lineno"></span><span class="op" id="1631676">}</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span><span class="keyword" id="1631679">func</span>&nbsp;<span class="ident" id="1631684">badmcall2</span><span class="op" id="1631693">(</span><span class="ident" id="1631694">fn</span>&nbsp;<span class="keyword" id="1631697">func</span><span class="op" id="1631701">(</span><span class="op" id="1631702">*</span><span class="ident" id="1631703">g</span><span class="op" id="1631704">)</span><span class="op" id="1631705">)</span>&nbsp;<span class="op" id="1631707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1631710">gothrow</span><span class="op" id="1631717">(</span><span class="string" id="1631718">&#34;runtime:&nbsp;mcall&nbsp;function&nbsp;returned&#34;</span><span class="op" id="1631752">)</span><br>
<span class="lineno"></span><span class="op" id="1631754">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="1631757">func</span>&nbsp;<span class="ident" id="1631762">badreflectcall</span><span class="op" id="1631776">(</span><span class="op" id="1631777">)</span>&nbsp;<span class="op" id="1631779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1631782">panic</span><span class="op" id="1631787">(</span><span class="string" id="1631788">&#34;runtime:&nbsp;arg&nbsp;size&nbsp;to&nbsp;reflect.call&nbsp;more&nbsp;than&nbsp;1GB&#34;</span><span class="op" id="1631837">)</span><br>
<span class="lineno"></span><span class="op" id="1631839">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1631842">func</span>&nbsp;<span class="ident" id="1631847">lockedOSThread</span><span class="op" id="1631861">(</span><span class="op" id="1631862">)</span>&nbsp;<span class="builtintype" id="1631864">bool</span>&nbsp;<span class="op" id="1631869">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1631872">gp</span>&nbsp;<span class="op" id="1631875">:=</span>&nbsp;<span class="ident" id="1631878">getg</span><span class="op" id="1631882">(</span><span class="op" id="1631883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1631886">return</span>&nbsp;<span class="ident" id="1631893">gp</span><span class="op" id="1631895">.</span><span class="ident" id="1631896">lockedm</span>&nbsp;<span class="op" id="1631904">!=</span>&nbsp;<span class="ident" id="1631907">nil</span>&nbsp;<span class="op" id="1631911">&amp;&amp;</span>&nbsp;<span class="ident" id="1631914">gp</span><span class="op" id="1631916">.</span><span class="ident" id="1631917">m</span><span class="op" id="1631918">.</span><span class="ident" id="1631919">lockedg</span>&nbsp;<span class="op" id="1631927">!=</span>&nbsp;<span class="ident" id="1631930">nil</span><br>
<span class="lineno"></span><span class="op" id="1631934">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1631937">func</span>&nbsp;<span class="ident" id="1631942">newP</span><span class="op" id="1631946">(</span><span class="op" id="1631947">)</span>&nbsp;<span class="op" id="1631949">*</span><span class="ident" id="1631950">p</span>&nbsp;<span class="op" id="1631952">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1631955">return</span>&nbsp;<span class="builtinfunc" id="1631962">new</span><span class="op" id="1631965">(</span><span class="ident" id="1631966">p</span><span class="op" id="1631967">)</span><br>
<span class="lineno"></span><span class="op" id="1631969">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1631972">func</span>&nbsp;<span class="ident" id="1631977">newM</span><span class="op" id="1631981">(</span><span class="op" id="1631982">)</span>&nbsp;<span class="op" id="1631984">*</span><span class="ident" id="1631985">m</span>&nbsp;<span class="op" id="1631987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1631990">return</span>&nbsp;<span class="builtinfunc" id="1631997">new</span><span class="op" id="1632000">(</span><span class="ident" id="1632001">m</span><span class="op" id="1632002">)</span><br>
<span class="lineno">230</span><span class="op" id="1632004">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1632007">func</span>&nbsp;<span class="ident" id="1632012">newG</span><span class="op" id="1632016">(</span><span class="op" id="1632017">)</span>&nbsp;<span class="op" id="1632019">*</span><span class="ident" id="1632020">g</span>&nbsp;<span class="op" id="1632022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1632025">return</span>&nbsp;<span class="builtinfunc" id="1632032">new</span><span class="op" id="1632035">(</span><span class="ident" id="1632036">g</span><span class="op" id="1632037">)</span><br>
<span class="lineno"></span><span class="op" id="1632039">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="keyword" id="1632042">func</span>&nbsp;<span class="ident" id="1632047">allgadd</span><span class="op" id="1632054">(</span><span class="ident" id="1632055">gp</span>&nbsp;<span class="op" id="1632058">*</span><span class="ident" id="1632059">g</span><span class="op" id="1632060">)</span>&nbsp;<span class="op" id="1632062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1632065">if</span>&nbsp;<span class="ident" id="1632068">readgstatus</span><span class="op" id="1632079">(</span><span class="ident" id="1632080">gp</span><span class="op" id="1632082">)</span>&nbsp;<span class="op" id="1632084">==</span>&nbsp;<span class="ident" id="1632087">_Gidle</span>&nbsp;<span class="op" id="1632094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1632098">gothrow</span><span class="op" id="1632105">(</span><span class="string" id="1632106">&#34;allgadd:&nbsp;bad&nbsp;status&nbsp;Gidle&#34;</span><span class="op" id="1632133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1632136">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1632140">lock</span><span class="op" id="1632144">(</span><span class="op" id="1632145">&amp;</span><span class="ident" id="1632146">allglock</span><span class="op" id="1632154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1632157">allgs</span>&nbsp;<span class="op" id="1632163">=</span>&nbsp;<span class="builtinfunc" id="1632165">append</span><span class="op" id="1632171">(</span><span class="ident" id="1632172">allgs</span><span class="op" id="1632177">,</span>&nbsp;<span class="ident" id="1632179">gp</span><span class="op" id="1632181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1632184">allg</span>&nbsp;<span class="op" id="1632189">=</span>&nbsp;<span class="op" id="1632191">&amp;</span><span class="ident" id="1632192">allgs</span><span class="op" id="1632197">[</span><span class="num" id="1632198">0</span><span class="op" id="1632199">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1632202">allglen</span>&nbsp;<span class="op" id="1632210">=</span>&nbsp;<span class="builtintype" id="1632212">uintptr</span><span class="op" id="1632219">(</span><span class="builtinfunc" id="1632220">len</span><span class="op" id="1632223">(</span><span class="ident" id="1632224">allgs</span><span class="op" id="1632229">)</span><span class="op" id="1632230">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1632233">unlock</span><span class="op" id="1632239">(</span><span class="op" id="1632240">&amp;</span><span class="ident" id="1632241">allglock</span><span class="op" id="1632249">)</span><br>
<span class="lineno"></span><span class="op" id="1632251">}</span>
</div>
</body>
</html>
