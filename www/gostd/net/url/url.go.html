<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3205026">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3205081">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3205135">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3205186">//&nbsp;Package&nbsp;url&nbsp;parses&nbsp;URLs&nbsp;and&nbsp;implements&nbsp;query&nbsp;escaping.</span><br>
<span class="lineno"></span><span class="comment" id="3205244">//&nbsp;See&nbsp;RFC&nbsp;3986.</span><br>
<span class="lineno"></span><span class="keyword" id="3205261">package</span>&nbsp;<span class="ident" id="3205269">url</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3205274">import</span>&nbsp;<span class="op" id="3205281">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3205284">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3205293">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3205303">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3205311">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3205322">&#34;strings&#34;</span><br>
<span class="lineno">15</span><span class="op" id="3205332">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3205335">//&nbsp;Error&nbsp;reports&nbsp;an&nbsp;error&nbsp;and&nbsp;the&nbsp;operation&nbsp;and&nbsp;URL&nbsp;that&nbsp;caused&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="3205403">type</span>&nbsp;<span class="ident" id="3205408">Error</span>&nbsp;<span class="keyword" id="3205414">struct</span>&nbsp;<span class="op" id="3205421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3205424">Op</span>&nbsp;&nbsp;<span class="builtintype" id="3205428">string</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3205436">URL</span>&nbsp;<span class="builtintype" id="3205440">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3205448">Err</span>&nbsp;<span class="builtintype" id="3205452">error</span><br>
<span class="lineno"></span><span class="op" id="3205458">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3205461">func</span>&nbsp;<span class="op" id="3205466">(</span><span class="ident" id="3205467">e</span>&nbsp;<span class="op" id="3205469">*</span><span class="ident" id="3205470">Error</span><span class="op" id="3205475">)</span>&nbsp;<span class="ident" id="3205477">Error</span><span class="op" id="3205482">(</span><span class="op" id="3205483">)</span>&nbsp;<span class="builtintype" id="3205485">string</span>&nbsp;<span class="op" id="3205492">{</span>&nbsp;<span class="keyword" id="3205494">return</span>&nbsp;<span class="ident" id="3205501">e</span><span class="op" id="3205502">.</span><span class="ident" id="3205503">Op</span>&nbsp;<span class="op" id="3205506">+</span>&nbsp;<span class="string" id="3205508">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="3205512">+</span>&nbsp;<span class="ident" id="3205514">e</span><span class="op" id="3205515">.</span><span class="ident" id="3205516">URL</span>&nbsp;<span class="op" id="3205520">+</span>&nbsp;<span class="string" id="3205522">&#34;:&nbsp;&#34;</span>&nbsp;<span class="op" id="3205527">+</span>&nbsp;<span class="ident" id="3205529">e</span><span class="op" id="3205530">.</span><span class="ident" id="3205531">Err</span><span class="op" id="3205534">.</span><span class="ident" id="3205535">Error</span><span class="op" id="3205540">(</span><span class="op" id="3205541">)</span>&nbsp;<span class="op" id="3205543">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="3205546">func</span>&nbsp;<span class="ident" id="3205551">ishex</span><span class="op" id="3205556">(</span><span class="ident" id="3205557">c</span>&nbsp;<span class="builtintype" id="3205559">byte</span><span class="op" id="3205563">)</span>&nbsp;<span class="builtintype" id="3205565">bool</span>&nbsp;<span class="op" id="3205570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3205573">switch</span>&nbsp;<span class="op" id="3205580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3205583">case</span>&nbsp;<span class="string" id="3205588">&#39;0&#39;</span>&nbsp;<span class="op" id="3205592">&lt;=</span>&nbsp;<span class="ident" id="3205595">c</span>&nbsp;<span class="op" id="3205597">&amp;&amp;</span>&nbsp;<span class="ident" id="3205600">c</span>&nbsp;<span class="op" id="3205602">&lt;=</span>&nbsp;<span class="string" id="3205605">&#39;9&#39;</span><span class="op" id="3205608">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3205612">return</span>&nbsp;<span class="builtintype" id="3205619">true</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3205625">case</span>&nbsp;<span class="string" id="3205630">&#39;a&#39;</span>&nbsp;<span class="op" id="3205634">&lt;=</span>&nbsp;<span class="ident" id="3205637">c</span>&nbsp;<span class="op" id="3205639">&amp;&amp;</span>&nbsp;<span class="ident" id="3205642">c</span>&nbsp;<span class="op" id="3205644">&lt;=</span>&nbsp;<span class="string" id="3205647">&#39;f&#39;</span><span class="op" id="3205650">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3205654">return</span>&nbsp;<span class="builtintype" id="3205661">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3205667">case</span>&nbsp;<span class="string" id="3205672">&#39;A&#39;</span>&nbsp;<span class="op" id="3205676">&lt;=</span>&nbsp;<span class="ident" id="3205679">c</span>&nbsp;<span class="op" id="3205681">&amp;&amp;</span>&nbsp;<span class="ident" id="3205684">c</span>&nbsp;<span class="op" id="3205686">&lt;=</span>&nbsp;<span class="string" id="3205689">&#39;F&#39;</span><span class="op" id="3205692">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3205696">return</span>&nbsp;<span class="builtintype" id="3205703">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3205709">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3205712">return</span>&nbsp;<span class="builtintype" id="3205719">false</span><br>
<span class="lineno"></span><span class="op" id="3205725">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3205728">func</span>&nbsp;<span class="ident" id="3205733">unhex</span><span class="op" id="3205738">(</span><span class="ident" id="3205739">c</span>&nbsp;<span class="builtintype" id="3205741">byte</span><span class="op" id="3205745">)</span>&nbsp;<span class="builtintype" id="3205747">byte</span>&nbsp;<span class="op" id="3205752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3205755">switch</span>&nbsp;<span class="op" id="3205762">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3205765">case</span>&nbsp;<span class="string" id="3205770">&#39;0&#39;</span>&nbsp;<span class="op" id="3205774">&lt;=</span>&nbsp;<span class="ident" id="3205777">c</span>&nbsp;<span class="op" id="3205779">&amp;&amp;</span>&nbsp;<span class="ident" id="3205782">c</span>&nbsp;<span class="op" id="3205784">&lt;=</span>&nbsp;<span class="string" id="3205787">&#39;9&#39;</span><span class="op" id="3205790">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3205794">return</span>&nbsp;<span class="ident" id="3205801">c</span>&nbsp;<span class="op" id="3205803">-</span>&nbsp;<span class="string" id="3205805">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3205810">case</span>&nbsp;<span class="string" id="3205815">&#39;a&#39;</span>&nbsp;<span class="op" id="3205819">&lt;=</span>&nbsp;<span class="ident" id="3205822">c</span>&nbsp;<span class="op" id="3205824">&amp;&amp;</span>&nbsp;<span class="ident" id="3205827">c</span>&nbsp;<span class="op" id="3205829">&lt;=</span>&nbsp;<span class="string" id="3205832">&#39;f&#39;</span><span class="op" id="3205835">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3205839">return</span>&nbsp;<span class="ident" id="3205846">c</span>&nbsp;<span class="op" id="3205848">-</span>&nbsp;<span class="string" id="3205850">&#39;a&#39;</span>&nbsp;<span class="op" id="3205854">+</span>&nbsp;<span class="num" id="3205856">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3205860">case</span>&nbsp;<span class="string" id="3205865">&#39;A&#39;</span>&nbsp;<span class="op" id="3205869">&lt;=</span>&nbsp;<span class="ident" id="3205872">c</span>&nbsp;<span class="op" id="3205874">&amp;&amp;</span>&nbsp;<span class="ident" id="3205877">c</span>&nbsp;<span class="op" id="3205879">&lt;=</span>&nbsp;<span class="string" id="3205882">&#39;F&#39;</span><span class="op" id="3205885">:</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3205889">return</span>&nbsp;<span class="ident" id="3205896">c</span>&nbsp;<span class="op" id="3205898">-</span>&nbsp;<span class="string" id="3205900">&#39;A&#39;</span>&nbsp;<span class="op" id="3205904">+</span>&nbsp;<span class="num" id="3205906">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3205910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3205913">return</span>&nbsp;<span class="num" id="3205920">0</span><br>
<span class="lineno"></span><span class="op" id="3205922">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="keyword" id="3205925">type</span>&nbsp;<span class="ident" id="3205930">encoding</span>&nbsp;<span class="builtintype" id="3205939">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3205944">const</span>&nbsp;<span class="op" id="3205950">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3205953">encodePath</span>&nbsp;<span class="ident" id="3205964">encoding</span>&nbsp;<span class="op" id="3205973">=</span>&nbsp;<span class="num" id="3205975">1</span>&nbsp;<span class="op" id="3205977">+</span>&nbsp;<span class="ident" id="3205979">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3205985">encodeUserPassword</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3206005">encodeQueryComponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3206027">encodeFragment</span><br>
<span class="lineno"></span><span class="op" id="3206042">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3206045">type</span>&nbsp;<span class="ident" id="3206050">EscapeError</span>&nbsp;<span class="builtintype" id="3206062">string</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="3206070">func</span>&nbsp;<span class="op" id="3206075">(</span><span class="ident" id="3206076">e</span>&nbsp;<span class="ident" id="3206078">EscapeError</span><span class="op" id="3206089">)</span>&nbsp;<span class="ident" id="3206091">Error</span><span class="op" id="3206096">(</span><span class="op" id="3206097">)</span>&nbsp;<span class="builtintype" id="3206099">string</span>&nbsp;<span class="op" id="3206106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3206109">return</span>&nbsp;<span class="string" id="3206116">&#34;invalid&nbsp;URL&nbsp;escape&nbsp;&#34;</span>&nbsp;<span class="op" id="3206138">+</span>&nbsp;<span class="ident" id="3206140">strconv</span><span class="op" id="3206147">.</span><span class="ident" id="3206148">Quote</span><span class="op" id="3206153">(</span><span class="builtintype" id="3206154">string</span><span class="op" id="3206160">(</span><span class="ident" id="3206161">e</span><span class="op" id="3206162">)</span><span class="op" id="3206163">)</span><br>
<span class="lineno"></span><span class="op" id="3206165">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="3206168">//&nbsp;Return&nbsp;true&nbsp;if&nbsp;the&nbsp;specified&nbsp;character&nbsp;should&nbsp;be&nbsp;escaped&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="3206233">//&nbsp;appearing&nbsp;in&nbsp;a&nbsp;URL&nbsp;string,&nbsp;according&nbsp;to&nbsp;RFC&nbsp;3986.</span><br>
<span class="lineno"></span><span class="keyword" id="3206286">func</span>&nbsp;<span class="ident" id="3206291">shouldEscape</span><span class="op" id="3206303">(</span><span class="ident" id="3206304">c</span>&nbsp;<span class="builtintype" id="3206306">byte</span><span class="op" id="3206310">,</span>&nbsp;<span class="ident" id="3206312">mode</span>&nbsp;<span class="ident" id="3206317">encoding</span><span class="op" id="3206325">)</span>&nbsp;<span class="builtintype" id="3206327">bool</span>&nbsp;<span class="op" id="3206332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3206335">//&nbsp;§2.3&nbsp;Unreserved&nbsp;characters&nbsp;(alphanum)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3206378">if</span>&nbsp;<span class="string" id="3206381">&#39;A&#39;</span>&nbsp;<span class="op" id="3206385">&lt;=</span>&nbsp;<span class="ident" id="3206388">c</span>&nbsp;<span class="op" id="3206390">&amp;&amp;</span>&nbsp;<span class="ident" id="3206393">c</span>&nbsp;<span class="op" id="3206395">&lt;=</span>&nbsp;<span class="string" id="3206398">&#39;Z&#39;</span>&nbsp;<span class="op" id="3206402">||</span>&nbsp;<span class="string" id="3206405">&#39;a&#39;</span>&nbsp;<span class="op" id="3206409">&lt;=</span>&nbsp;<span class="ident" id="3206412">c</span>&nbsp;<span class="op" id="3206414">&amp;&amp;</span>&nbsp;<span class="ident" id="3206417">c</span>&nbsp;<span class="op" id="3206419">&lt;=</span>&nbsp;<span class="string" id="3206422">&#39;z&#39;</span>&nbsp;<span class="op" id="3206426">||</span>&nbsp;<span class="string" id="3206429">&#39;0&#39;</span>&nbsp;<span class="op" id="3206433">&lt;=</span>&nbsp;<span class="ident" id="3206436">c</span>&nbsp;<span class="op" id="3206438">&amp;&amp;</span>&nbsp;<span class="ident" id="3206441">c</span>&nbsp;<span class="op" id="3206443">&lt;=</span>&nbsp;<span class="string" id="3206446">&#39;9&#39;</span>&nbsp;<span class="op" id="3206450">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3206454">return</span>&nbsp;<span class="builtintype" id="3206461">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3206468">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3206472">switch</span>&nbsp;<span class="ident" id="3206479">c</span>&nbsp;<span class="op" id="3206481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3206484">case</span>&nbsp;<span class="string" id="3206489">&#39;-&#39;</span><span class="op" id="3206492">,</span>&nbsp;<span class="string" id="3206494">&#39;_&#39;</span><span class="op" id="3206497">,</span>&nbsp;<span class="string" id="3206499">&#39;.&#39;</span><span class="op" id="3206502">,</span>&nbsp;<span class="string" id="3206504">&#39;~&#39;</span><span class="op" id="3206507">:</span>&nbsp;<span class="comment" id="3206509">//&nbsp;§2.3&nbsp;Unreserved&nbsp;characters&nbsp;(mark)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3206549">return</span>&nbsp;<span class="builtintype" id="3206556">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3206564">case</span>&nbsp;<span class="string" id="3206569">&#39;$&#39;</span><span class="op" id="3206572">,</span>&nbsp;<span class="string" id="3206574">&#39;&amp;&#39;</span><span class="op" id="3206577">,</span>&nbsp;<span class="string" id="3206579">&#39;+&#39;</span><span class="op" id="3206582">,</span>&nbsp;<span class="string" id="3206584">&#39;,&#39;</span><span class="op" id="3206587">,</span>&nbsp;<span class="string" id="3206589">&#39;/&#39;</span><span class="op" id="3206592">,</span>&nbsp;<span class="string" id="3206594">&#39;:&#39;</span><span class="op" id="3206597">,</span>&nbsp;<span class="string" id="3206599">&#39;;&#39;</span><span class="op" id="3206602">,</span>&nbsp;<span class="string" id="3206604">&#39;=&#39;</span><span class="op" id="3206607">,</span>&nbsp;<span class="string" id="3206609">&#39;?&#39;</span><span class="op" id="3206612">,</span>&nbsp;<span class="string" id="3206614">&#39;@&#39;</span><span class="op" id="3206617">:</span>&nbsp;<span class="comment" id="3206619">//&nbsp;§2.2&nbsp;Reserved&nbsp;characters&nbsp;(reserved)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3206661">//&nbsp;Different&nbsp;sections&nbsp;of&nbsp;the&nbsp;URL&nbsp;allow&nbsp;a&nbsp;few&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3206711">//&nbsp;the&nbsp;reserved&nbsp;characters&nbsp;to&nbsp;appear&nbsp;unescaped.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3206761">switch</span>&nbsp;<span class="ident" id="3206768">mode</span>&nbsp;<span class="op" id="3206773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3206777">case</span>&nbsp;<span class="ident" id="3206782">encodePath</span><span class="op" id="3206792">:</span>&nbsp;<span class="comment" id="3206794">//&nbsp;§3.3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3206806">//&nbsp;The&nbsp;RFC&nbsp;allows&nbsp;:&nbsp;@&nbsp;&amp;&nbsp;=&nbsp;+&nbsp;$&nbsp;but&nbsp;saves&nbsp;/&nbsp;;&nbsp;,&nbsp;for&nbsp;assigning</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3206869">//&nbsp;meaning&nbsp;to&nbsp;individual&nbsp;path&nbsp;segments.&nbsp;This&nbsp;package</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3206925">//&nbsp;only&nbsp;manipulates&nbsp;the&nbsp;path&nbsp;as&nbsp;a&nbsp;whole,&nbsp;so&nbsp;we&nbsp;allow&nbsp;those</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3206987">//&nbsp;last&nbsp;two&nbsp;as&nbsp;well.&nbsp;That&nbsp;leaves&nbsp;only&nbsp;?&nbsp;to&nbsp;escape.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3207041">return</span>&nbsp;<span class="ident" id="3207048">c</span>&nbsp;<span class="op" id="3207050">==</span>&nbsp;<span class="string" id="3207053">&#39;?&#39;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3207060">case</span>&nbsp;<span class="ident" id="3207065">encodeUserPassword</span><span class="op" id="3207083">:</span>&nbsp;<span class="comment" id="3207085">//&nbsp;§3.2.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3207099">//&nbsp;The&nbsp;RFC&nbsp;allows&nbsp;&#39;;&#39;,&nbsp;&#39;:&#39;,&nbsp;&#39;&amp;&#39;,&nbsp;&#39;=&#39;,&nbsp;&#39;+&#39;,&nbsp;&#39;$&#39;,&nbsp;and&nbsp;&#39;,&#39;&nbsp;in</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3207161">//&nbsp;userinfo,&nbsp;so&nbsp;we&nbsp;must&nbsp;escape&nbsp;only&nbsp;&#39;@&#39;,&nbsp;&#39;/&#39;,&nbsp;and&nbsp;&#39;?&#39;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3207219">//&nbsp;The&nbsp;parsing&nbsp;of&nbsp;userinfo&nbsp;treats&nbsp;&#39;:&#39;&nbsp;as&nbsp;special&nbsp;so&nbsp;we&nbsp;must&nbsp;escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3207289">//&nbsp;that&nbsp;too.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3207305">return</span>&nbsp;<span class="ident" id="3207312">c</span>&nbsp;<span class="op" id="3207314">==</span>&nbsp;<span class="string" id="3207317">&#39;@&#39;</span>&nbsp;<span class="op" id="3207321">||</span>&nbsp;<span class="ident" id="3207324">c</span>&nbsp;<span class="op" id="3207326">==</span>&nbsp;<span class="string" id="3207329">&#39;/&#39;</span>&nbsp;<span class="op" id="3207333">||</span>&nbsp;<span class="ident" id="3207336">c</span>&nbsp;<span class="op" id="3207338">==</span>&nbsp;<span class="string" id="3207341">&#39;?&#39;</span>&nbsp;<span class="op" id="3207345">||</span>&nbsp;<span class="ident" id="3207348">c</span>&nbsp;<span class="op" id="3207350">==</span>&nbsp;<span class="string" id="3207353">&#39;:&#39;</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3207360">case</span>&nbsp;<span class="ident" id="3207365">encodeQueryComponent</span><span class="op" id="3207385">:</span>&nbsp;<span class="comment" id="3207387">//&nbsp;§3.4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3207399">//&nbsp;The&nbsp;RFC&nbsp;reserves&nbsp;(so&nbsp;we&nbsp;must&nbsp;escape)&nbsp;everything.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3207454">return</span>&nbsp;<span class="builtintype" id="3207461">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3207469">case</span>&nbsp;<span class="ident" id="3207474">encodeFragment</span><span class="op" id="3207488">:</span>&nbsp;<span class="comment" id="3207490">//&nbsp;§4.1</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3207502">//&nbsp;The&nbsp;RFC&nbsp;text&nbsp;is&nbsp;silent&nbsp;but&nbsp;the&nbsp;grammar&nbsp;allows</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3207554">//&nbsp;everything,&nbsp;so&nbsp;escape&nbsp;nothing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3207591">return</span>&nbsp;<span class="builtintype" id="3207598">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3207606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3207609">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3207613">//&nbsp;Everything&nbsp;else&nbsp;must&nbsp;be&nbsp;escaped.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3207650">return</span>&nbsp;<span class="builtintype" id="3207657">true</span><br>
<span class="lineno"></span><span class="op" id="3207662">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="3207665">//&nbsp;QueryUnescape&nbsp;does&nbsp;the&nbsp;inverse&nbsp;transformation&nbsp;of&nbsp;QueryEscape,&nbsp;converting</span><br>
<span class="lineno"></span><span class="comment" id="3207741">//&nbsp;%AB&nbsp;into&nbsp;the&nbsp;byte&nbsp;0xAB&nbsp;and&nbsp;&#39;+&#39;&nbsp;into&nbsp;&#39;&nbsp;&#39;&nbsp;(space).&nbsp;It&nbsp;returns&nbsp;an&nbsp;error&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="3207816">//&nbsp;any&nbsp;%&nbsp;is&nbsp;not&nbsp;followed&nbsp;by&nbsp;two&nbsp;hexadecimal&nbsp;digits.</span><br>
<span class="lineno"></span><span class="keyword" id="3207868">func</span>&nbsp;<span class="ident" id="3207873">QueryUnescape</span><span class="op" id="3207886">(</span><span class="ident" id="3207887">s</span>&nbsp;<span class="builtintype" id="3207889">string</span><span class="op" id="3207895">)</span>&nbsp;<span class="op" id="3207897">(</span><span class="builtintype" id="3207898">string</span><span class="op" id="3207904">,</span>&nbsp;<span class="builtintype" id="3207906">error</span><span class="op" id="3207911">)</span>&nbsp;<span class="op" id="3207913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3207916">return</span>&nbsp;<span class="ident" id="3207923">unescape</span><span class="op" id="3207931">(</span><span class="ident" id="3207932">s</span><span class="op" id="3207933">,</span>&nbsp;<span class="ident" id="3207935">encodeQueryComponent</span><span class="op" id="3207955">)</span><br>
<span class="lineno">115</span><span class="op" id="3207957">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3207960">//&nbsp;unescape&nbsp;unescapes&nbsp;a&nbsp;string;&nbsp;the&nbsp;mode&nbsp;specifies</span><br>
<span class="lineno"></span><span class="comment" id="3208011">//&nbsp;which&nbsp;section&nbsp;of&nbsp;the&nbsp;URL&nbsp;string&nbsp;is&nbsp;being&nbsp;unescaped.</span><br>
<span class="lineno"></span><span class="keyword" id="3208066">func</span>&nbsp;<span class="ident" id="3208071">unescape</span><span class="op" id="3208079">(</span><span class="ident" id="3208080">s</span>&nbsp;<span class="builtintype" id="3208082">string</span><span class="op" id="3208088">,</span>&nbsp;<span class="ident" id="3208090">mode</span>&nbsp;<span class="ident" id="3208095">encoding</span><span class="op" id="3208103">)</span>&nbsp;<span class="op" id="3208105">(</span><span class="builtintype" id="3208106">string</span><span class="op" id="3208112">,</span>&nbsp;<span class="builtintype" id="3208114">error</span><span class="op" id="3208119">)</span>&nbsp;<span class="op" id="3208121">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3208124">//&nbsp;Count&nbsp;%,&nbsp;check&nbsp;that&nbsp;they&#39;re&nbsp;well-formed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3208169">n</span>&nbsp;<span class="op" id="3208171">:=</span>&nbsp;<span class="num" id="3208174">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3208177">hasPlus</span>&nbsp;<span class="op" id="3208185">:=</span>&nbsp;<span class="builtintype" id="3208188">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3208195">for</span>&nbsp;<span class="ident" id="3208199">i</span>&nbsp;<span class="op" id="3208201">:=</span>&nbsp;<span class="num" id="3208204">0</span><span class="op" id="3208205">;</span>&nbsp;<span class="ident" id="3208207">i</span>&nbsp;<span class="op" id="3208209">&lt;</span>&nbsp;<span class="builtinfunc" id="3208211">len</span><span class="op" id="3208214">(</span><span class="ident" id="3208215">s</span><span class="op" id="3208216">)</span><span class="op" id="3208217">;</span>&nbsp;<span class="op" id="3208219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3208223">switch</span>&nbsp;<span class="ident" id="3208230">s</span><span class="op" id="3208231">[</span><span class="ident" id="3208232">i</span><span class="op" id="3208233">]</span>&nbsp;<span class="op" id="3208235">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3208239">case</span>&nbsp;<span class="string" id="3208244">&#39;%&#39;</span><span class="op" id="3208247">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3208252">n</span><span class="op" id="3208253">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3208259">if</span>&nbsp;<span class="ident" id="3208262">i</span><span class="op" id="3208263">+</span><span class="num" id="3208264">2</span>&nbsp;<span class="op" id="3208266">&gt;=</span>&nbsp;<span class="builtinfunc" id="3208269">len</span><span class="op" id="3208272">(</span><span class="ident" id="3208273">s</span><span class="op" id="3208274">)</span>&nbsp;<span class="op" id="3208276">||</span>&nbsp;<span class="op" id="3208279">!</span><span class="ident" id="3208280">ishex</span><span class="op" id="3208285">(</span><span class="ident" id="3208286">s</span><span class="op" id="3208287">[</span><span class="ident" id="3208288">i</span><span class="op" id="3208289">+</span><span class="num" id="3208290">1</span><span class="op" id="3208291">]</span><span class="op" id="3208292">)</span>&nbsp;<span class="op" id="3208294">||</span>&nbsp;<span class="op" id="3208297">!</span><span class="ident" id="3208298">ishex</span><span class="op" id="3208303">(</span><span class="ident" id="3208304">s</span><span class="op" id="3208305">[</span><span class="ident" id="3208306">i</span><span class="op" id="3208307">+</span><span class="num" id="3208308">2</span><span class="op" id="3208309">]</span><span class="op" id="3208310">)</span>&nbsp;<span class="op" id="3208312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3208318">s</span>&nbsp;<span class="op" id="3208320">=</span>&nbsp;<span class="ident" id="3208322">s</span><span class="op" id="3208323">[</span><span class="ident" id="3208324">i</span><span class="op" id="3208325">:</span><span class="op" id="3208326">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3208332">if</span>&nbsp;<span class="builtinfunc" id="3208335">len</span><span class="op" id="3208338">(</span><span class="ident" id="3208339">s</span><span class="op" id="3208340">)</span>&nbsp;<span class="op" id="3208342">&gt;</span>&nbsp;<span class="num" id="3208344">3</span>&nbsp;<span class="op" id="3208346">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3208353">s</span>&nbsp;<span class="op" id="3208355">=</span>&nbsp;<span class="ident" id="3208357">s</span><span class="op" id="3208358">[</span><span class="num" id="3208359">0</span><span class="op" id="3208360">:</span><span class="num" id="3208361">3</span><span class="op" id="3208362">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3208368">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3208374">return</span>&nbsp;<span class="string" id="3208381">&#34;&#34;</span><span class="op" id="3208383">,</span>&nbsp;<span class="ident" id="3208385">EscapeError</span><span class="op" id="3208396">(</span><span class="ident" id="3208397">s</span><span class="op" id="3208398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3208403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3208408">i</span>&nbsp;<span class="op" id="3208410">+=</span>&nbsp;<span class="num" id="3208413">3</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3208417">case</span>&nbsp;<span class="string" id="3208422">&#39;+&#39;</span><span class="op" id="3208425">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3208430">hasPlus</span>&nbsp;<span class="op" id="3208438">=</span>&nbsp;<span class="ident" id="3208440">mode</span>&nbsp;<span class="op" id="3208445">==</span>&nbsp;<span class="ident" id="3208448">encodeQueryComponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3208472">i</span><span class="op" id="3208473">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3208478">default</span><span class="op" id="3208485">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3208490">i</span><span class="op" id="3208491">++</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3208496">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3208499">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3208503">if</span>&nbsp;<span class="ident" id="3208506">n</span>&nbsp;<span class="op" id="3208508">==</span>&nbsp;<span class="num" id="3208511">0</span>&nbsp;<span class="op" id="3208513">&amp;&amp;</span>&nbsp;<span class="op" id="3208516">!</span><span class="ident" id="3208517">hasPlus</span>&nbsp;<span class="op" id="3208525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3208529">return</span>&nbsp;<span class="ident" id="3208536">s</span><span class="op" id="3208537">,</span>&nbsp;<span class="ident" id="3208539">nil</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3208544">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3208548">t</span>&nbsp;<span class="op" id="3208550">:=</span>&nbsp;<span class="builtinfunc" id="3208553">make</span><span class="op" id="3208557">(</span><span class="op" id="3208558">[</span><span class="op" id="3208559">]</span><span class="builtintype" id="3208560">byte</span><span class="op" id="3208564">,</span>&nbsp;<span class="builtinfunc" id="3208566">len</span><span class="op" id="3208569">(</span><span class="ident" id="3208570">s</span><span class="op" id="3208571">)</span><span class="op" id="3208572">-</span><span class="num" id="3208573">2</span><span class="op" id="3208574">*</span><span class="ident" id="3208575">n</span><span class="op" id="3208576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3208579">j</span>&nbsp;<span class="op" id="3208581">:=</span>&nbsp;<span class="num" id="3208584">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3208587">for</span>&nbsp;<span class="ident" id="3208591">i</span>&nbsp;<span class="op" id="3208593">:=</span>&nbsp;<span class="num" id="3208596">0</span><span class="op" id="3208597">;</span>&nbsp;<span class="ident" id="3208599">i</span>&nbsp;<span class="op" id="3208601">&lt;</span>&nbsp;<span class="builtinfunc" id="3208603">len</span><span class="op" id="3208606">(</span><span class="ident" id="3208607">s</span><span class="op" id="3208608">)</span><span class="op" id="3208609">;</span>&nbsp;<span class="op" id="3208611">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3208615">switch</span>&nbsp;<span class="ident" id="3208622">s</span><span class="op" id="3208623">[</span><span class="ident" id="3208624">i</span><span class="op" id="3208625">]</span>&nbsp;<span class="op" id="3208627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3208631">case</span>&nbsp;<span class="string" id="3208636">&#39;%&#39;</span><span class="op" id="3208639">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3208644">t</span><span class="op" id="3208645">[</span><span class="ident" id="3208646">j</span><span class="op" id="3208647">]</span>&nbsp;<span class="op" id="3208649">=</span>&nbsp;<span class="ident" id="3208651">unhex</span><span class="op" id="3208656">(</span><span class="ident" id="3208657">s</span><span class="op" id="3208658">[</span><span class="ident" id="3208659">i</span><span class="op" id="3208660">+</span><span class="num" id="3208661">1</span><span class="op" id="3208662">]</span><span class="op" id="3208663">)</span><span class="op" id="3208664">&lt;&lt;</span><span class="num" id="3208666">4</span>&nbsp;<span class="op" id="3208668">|</span>&nbsp;<span class="ident" id="3208670">unhex</span><span class="op" id="3208675">(</span><span class="ident" id="3208676">s</span><span class="op" id="3208677">[</span><span class="ident" id="3208678">i</span><span class="op" id="3208679">+</span><span class="num" id="3208680">2</span><span class="op" id="3208681">]</span><span class="op" id="3208682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3208687">j</span><span class="op" id="3208688">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3208694">i</span>&nbsp;<span class="op" id="3208696">+=</span>&nbsp;<span class="num" id="3208699">3</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3208703">case</span>&nbsp;<span class="string" id="3208708">&#39;+&#39;</span><span class="op" id="3208711">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3208716">if</span>&nbsp;<span class="ident" id="3208719">mode</span>&nbsp;<span class="op" id="3208724">==</span>&nbsp;<span class="ident" id="3208727">encodeQueryComponent</span>&nbsp;<span class="op" id="3208748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3208754">t</span><span class="op" id="3208755">[</span><span class="ident" id="3208756">j</span><span class="op" id="3208757">]</span>&nbsp;<span class="op" id="3208759">=</span>&nbsp;<span class="string" id="3208761">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3208768">}</span>&nbsp;<span class="keyword" id="3208770">else</span>&nbsp;<span class="op" id="3208775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3208781">t</span><span class="op" id="3208782">[</span><span class="ident" id="3208783">j</span><span class="op" id="3208784">]</span>&nbsp;<span class="op" id="3208786">=</span>&nbsp;<span class="string" id="3208788">&#39;+&#39;</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3208795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3208800">j</span><span class="op" id="3208801">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3208807">i</span><span class="op" id="3208808">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3208813">default</span><span class="op" id="3208820">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3208825">t</span><span class="op" id="3208826">[</span><span class="ident" id="3208827">j</span><span class="op" id="3208828">]</span>&nbsp;<span class="op" id="3208830">=</span>&nbsp;<span class="ident" id="3208832">s</span><span class="op" id="3208833">[</span><span class="ident" id="3208834">i</span><span class="op" id="3208835">]</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3208840">j</span><span class="op" id="3208841">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3208847">i</span><span class="op" id="3208848">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3208853">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3208856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3208859">return</span>&nbsp;<span class="builtintype" id="3208866">string</span><span class="op" id="3208872">(</span><span class="ident" id="3208873">t</span><span class="op" id="3208874">)</span><span class="op" id="3208875">,</span>&nbsp;<span class="ident" id="3208877">nil</span><br>
<span class="lineno">170</span><span class="op" id="3208881">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3208884">//&nbsp;QueryEscape&nbsp;escapes&nbsp;the&nbsp;string&nbsp;so&nbsp;it&nbsp;can&nbsp;be&nbsp;safely&nbsp;placed</span><br>
<span class="lineno"></span><span class="comment" id="3208945">//&nbsp;inside&nbsp;a&nbsp;URL&nbsp;query.</span><br>
<span class="lineno"></span><span class="keyword" id="3208968">func</span>&nbsp;<span class="ident" id="3208973">QueryEscape</span><span class="op" id="3208984">(</span><span class="ident" id="3208985">s</span>&nbsp;<span class="builtintype" id="3208987">string</span><span class="op" id="3208993">)</span>&nbsp;<span class="builtintype" id="3208995">string</span>&nbsp;<span class="op" id="3209002">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3209005">return</span>&nbsp;<span class="ident" id="3209012">escape</span><span class="op" id="3209018">(</span><span class="ident" id="3209019">s</span><span class="op" id="3209020">,</span>&nbsp;<span class="ident" id="3209022">encodeQueryComponent</span><span class="op" id="3209042">)</span><br>
<span class="lineno"></span><span class="op" id="3209044">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3209047">func</span>&nbsp;<span class="ident" id="3209052">escape</span><span class="op" id="3209058">(</span><span class="ident" id="3209059">s</span>&nbsp;<span class="builtintype" id="3209061">string</span><span class="op" id="3209067">,</span>&nbsp;<span class="ident" id="3209069">mode</span>&nbsp;<span class="ident" id="3209074">encoding</span><span class="op" id="3209082">)</span>&nbsp;<span class="builtintype" id="3209084">string</span>&nbsp;<span class="op" id="3209091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3209094">spaceCount</span><span class="op" id="3209104">,</span>&nbsp;<span class="ident" id="3209106">hexCount</span>&nbsp;<span class="op" id="3209115">:=</span>&nbsp;<span class="num" id="3209118">0</span><span class="op" id="3209119">,</span>&nbsp;<span class="num" id="3209121">0</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3209124">for</span>&nbsp;<span class="ident" id="3209128">i</span>&nbsp;<span class="op" id="3209130">:=</span>&nbsp;<span class="num" id="3209133">0</span><span class="op" id="3209134">;</span>&nbsp;<span class="ident" id="3209136">i</span>&nbsp;<span class="op" id="3209138">&lt;</span>&nbsp;<span class="builtinfunc" id="3209140">len</span><span class="op" id="3209143">(</span><span class="ident" id="3209144">s</span><span class="op" id="3209145">)</span><span class="op" id="3209146">;</span>&nbsp;<span class="ident" id="3209148">i</span><span class="op" id="3209149">++</span>&nbsp;<span class="op" id="3209152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3209156">c</span>&nbsp;<span class="op" id="3209158">:=</span>&nbsp;<span class="ident" id="3209161">s</span><span class="op" id="3209162">[</span><span class="ident" id="3209163">i</span><span class="op" id="3209164">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3209168">if</span>&nbsp;<span class="ident" id="3209171">shouldEscape</span><span class="op" id="3209183">(</span><span class="ident" id="3209184">c</span><span class="op" id="3209185">,</span>&nbsp;<span class="ident" id="3209187">mode</span><span class="op" id="3209191">)</span>&nbsp;<span class="op" id="3209193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3209198">if</span>&nbsp;<span class="ident" id="3209201">c</span>&nbsp;<span class="op" id="3209203">==</span>&nbsp;<span class="string" id="3209206">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3209210">&amp;&amp;</span>&nbsp;<span class="ident" id="3209213">mode</span>&nbsp;<span class="op" id="3209218">==</span>&nbsp;<span class="ident" id="3209221">encodeQueryComponent</span>&nbsp;<span class="op" id="3209242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3209248">spaceCount</span><span class="op" id="3209258">++</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3209264">}</span>&nbsp;<span class="keyword" id="3209266">else</span>&nbsp;<span class="op" id="3209271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3209277">hexCount</span><span class="op" id="3209285">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3209291">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3209295">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3209298">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3209302">if</span>&nbsp;<span class="ident" id="3209305">spaceCount</span>&nbsp;<span class="op" id="3209316">==</span>&nbsp;<span class="num" id="3209319">0</span>&nbsp;<span class="op" id="3209321">&amp;&amp;</span>&nbsp;<span class="ident" id="3209324">hexCount</span>&nbsp;<span class="op" id="3209333">==</span>&nbsp;<span class="num" id="3209336">0</span>&nbsp;<span class="op" id="3209338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3209342">return</span>&nbsp;<span class="ident" id="3209349">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3209352">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3209356">t</span>&nbsp;<span class="op" id="3209358">:=</span>&nbsp;<span class="builtinfunc" id="3209361">make</span><span class="op" id="3209365">(</span><span class="op" id="3209366">[</span><span class="op" id="3209367">]</span><span class="builtintype" id="3209368">byte</span><span class="op" id="3209372">,</span>&nbsp;<span class="builtinfunc" id="3209374">len</span><span class="op" id="3209377">(</span><span class="ident" id="3209378">s</span><span class="op" id="3209379">)</span><span class="op" id="3209380">+</span><span class="num" id="3209381">2</span><span class="op" id="3209382">*</span><span class="ident" id="3209383">hexCount</span><span class="op" id="3209391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3209394">j</span>&nbsp;<span class="op" id="3209396">:=</span>&nbsp;<span class="num" id="3209399">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3209402">for</span>&nbsp;<span class="ident" id="3209406">i</span>&nbsp;<span class="op" id="3209408">:=</span>&nbsp;<span class="num" id="3209411">0</span><span class="op" id="3209412">;</span>&nbsp;<span class="ident" id="3209414">i</span>&nbsp;<span class="op" id="3209416">&lt;</span>&nbsp;<span class="builtinfunc" id="3209418">len</span><span class="op" id="3209421">(</span><span class="ident" id="3209422">s</span><span class="op" id="3209423">)</span><span class="op" id="3209424">;</span>&nbsp;<span class="ident" id="3209426">i</span><span class="op" id="3209427">++</span>&nbsp;<span class="op" id="3209430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3209434">switch</span>&nbsp;<span class="ident" id="3209441">c</span>&nbsp;<span class="op" id="3209443">:=</span>&nbsp;<span class="ident" id="3209446">s</span><span class="op" id="3209447">[</span><span class="ident" id="3209448">i</span><span class="op" id="3209449">]</span><span class="op" id="3209450">;</span>&nbsp;<span class="op" id="3209452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3209456">case</span>&nbsp;<span class="ident" id="3209461">c</span>&nbsp;<span class="op" id="3209463">==</span>&nbsp;<span class="string" id="3209466">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3209470">&amp;&amp;</span>&nbsp;<span class="ident" id="3209473">mode</span>&nbsp;<span class="op" id="3209478">==</span>&nbsp;<span class="ident" id="3209481">encodeQueryComponent</span><span class="op" id="3209501">:</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3209506">t</span><span class="op" id="3209507">[</span><span class="ident" id="3209508">j</span><span class="op" id="3209509">]</span>&nbsp;<span class="op" id="3209511">=</span>&nbsp;<span class="string" id="3209513">&#39;+&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3209520">j</span><span class="op" id="3209521">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3209526">case</span>&nbsp;<span class="ident" id="3209531">shouldEscape</span><span class="op" id="3209543">(</span><span class="ident" id="3209544">c</span><span class="op" id="3209545">,</span>&nbsp;<span class="ident" id="3209547">mode</span><span class="op" id="3209551">)</span><span class="op" id="3209552">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3209557">t</span><span class="op" id="3209558">[</span><span class="ident" id="3209559">j</span><span class="op" id="3209560">]</span>&nbsp;<span class="op" id="3209562">=</span>&nbsp;<span class="string" id="3209564">&#39;%&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3209571">t</span><span class="op" id="3209572">[</span><span class="ident" id="3209573">j</span><span class="op" id="3209574">+</span><span class="num" id="3209575">1</span><span class="op" id="3209576">]</span>&nbsp;<span class="op" id="3209578">=</span>&nbsp;<span class="string" id="3209580">&#34;0123456789ABCDEF&#34;</span><span class="op" id="3209598">[</span><span class="ident" id="3209599">c</span><span class="op" id="3209600">&gt;&gt;</span><span class="num" id="3209602">4</span><span class="op" id="3209603">]</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3209608">t</span><span class="op" id="3209609">[</span><span class="ident" id="3209610">j</span><span class="op" id="3209611">+</span><span class="num" id="3209612">2</span><span class="op" id="3209613">]</span>&nbsp;<span class="op" id="3209615">=</span>&nbsp;<span class="string" id="3209617">&#34;0123456789ABCDEF&#34;</span><span class="op" id="3209635">[</span><span class="ident" id="3209636">c</span><span class="op" id="3209637">&amp;</span><span class="num" id="3209638">15</span><span class="op" id="3209640">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3209645">j</span>&nbsp;<span class="op" id="3209647">+=</span>&nbsp;<span class="num" id="3209650">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3209654">default</span><span class="op" id="3209661">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3209666">t</span><span class="op" id="3209667">[</span><span class="ident" id="3209668">j</span><span class="op" id="3209669">]</span>&nbsp;<span class="op" id="3209671">=</span>&nbsp;<span class="ident" id="3209673">s</span><span class="op" id="3209674">[</span><span class="ident" id="3209675">i</span><span class="op" id="3209676">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3209681">j</span><span class="op" id="3209682">++</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3209687">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3209690">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3209693">return</span>&nbsp;<span class="builtintype" id="3209700">string</span><span class="op" id="3209706">(</span><span class="ident" id="3209707">t</span><span class="op" id="3209708">)</span><br>
<span class="lineno"></span><span class="op" id="3209710">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="comment" id="3209713">//&nbsp;A&nbsp;URL&nbsp;represents&nbsp;a&nbsp;parsed&nbsp;URL&nbsp;(technically,&nbsp;a&nbsp;URI&nbsp;reference).</span><br>
<span class="lineno"></span><span class="comment" id="3209778">//&nbsp;The&nbsp;general&nbsp;form&nbsp;represented&nbsp;is:</span><br>
<span class="lineno"></span><span class="comment" id="3209814">//</span><br>
<span class="lineno"></span><span class="comment" id="3209817">//&nbsp;&nbsp;&nbsp;&nbspscheme://[userinfo@]host/path[?query][#fragment]</span><br>
<span class="lineno"></span><span class="comment" id="3209869">//</span><br>
<span class="lineno">220</span><span class="comment" id="3209872">//&nbsp;URLs&nbsp;that&nbsp;do&nbsp;not&nbsp;start&nbsp;with&nbsp;a&nbsp;slash&nbsp;after&nbsp;the&nbsp;scheme&nbsp;are&nbsp;interpreted&nbsp;as:</span><br>
<span class="lineno"></span><span class="comment" id="3209948">//</span><br>
<span class="lineno"></span><span class="comment" id="3209951">//&nbsp;&nbsp;&nbsp;&nbspscheme:opaque[?query][#fragment]</span><br>
<span class="lineno"></span><span class="comment" id="3209987">//</span><br>
<span class="lineno"></span><span class="comment" id="3209990">//&nbsp;Note&nbsp;that&nbsp;the&nbsp;Path&nbsp;field&nbsp;is&nbsp;stored&nbsp;in&nbsp;decoded&nbsp;form:&nbsp;/%47%6f%2f&nbsp;becomes&nbsp;/Go/.</span><br>
<span class="lineno">225</span><span class="comment" id="3210070">//&nbsp;A&nbsp;consequence&nbsp;is&nbsp;that&nbsp;it&nbsp;is&nbsp;impossible&nbsp;to&nbsp;tell&nbsp;which&nbsp;slashes&nbsp;in&nbsp;the&nbsp;Path&nbsp;were</span><br>
<span class="lineno"></span><span class="comment" id="3210151">//&nbsp;slashes&nbsp;in&nbsp;the&nbsp;raw&nbsp;URL&nbsp;and&nbsp;which&nbsp;were&nbsp;%2f.&nbsp;This&nbsp;distinction&nbsp;is&nbsp;rarely&nbsp;important,</span><br>
<span class="lineno"></span><span class="comment" id="3210235">//&nbsp;but&nbsp;when&nbsp;it&nbsp;is&nbsp;a&nbsp;client&nbsp;must&nbsp;use&nbsp;other&nbsp;routines&nbsp;to&nbsp;parse&nbsp;the&nbsp;raw&nbsp;URL&nbsp;or&nbsp;construct</span><br>
<span class="lineno"></span><span class="comment" id="3210320">//&nbsp;the&nbsp;parsed&nbsp;URL.&nbsp;For&nbsp;example,&nbsp;an&nbsp;HTTP&nbsp;server&nbsp;can&nbsp;consult&nbsp;req.RequestURI,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3210399">//&nbsp;an&nbsp;HTTP&nbsp;client&nbsp;can&nbsp;use&nbsp;URL{Host:&nbsp;&#34;example.com&#34;,&nbsp;Opaque:&nbsp;&#34;//example.com/Go%2f&#34;}</span><br>
<span class="lineno">230</span><span class="comment" id="3210481">//&nbsp;instead&nbsp;of&nbsp;URL{Host:&nbsp;&#34;example.com&#34;,&nbsp;Path:&nbsp;&#34;/Go/&#34;}.</span><br>
<span class="lineno"></span><span class="keyword" id="3210535">type</span>&nbsp;<span class="ident" id="3210540">URL</span>&nbsp;<span class="keyword" id="3210544">struct</span>&nbsp;<span class="op" id="3210551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3210554">Scheme</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3210563">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3210571">Opaque</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3210580">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3210590">//&nbsp;encoded&nbsp;opaque&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3210614">User</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3210623">*</span><span class="ident" id="3210624">Userinfo</span>&nbsp;<span class="comment" id="3210633">//&nbsp;username&nbsp;and&nbsp;password&nbsp;information</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3210671">Host</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3210680">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3210690">//&nbsp;host&nbsp;or&nbsp;host:port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3210712">Path</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3210721">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3210729">RawQuery</span>&nbsp;<span class="builtintype" id="3210738">string</span>&nbsp;<span class="comment" id="3210745">//&nbsp;encoded&nbsp;query&nbsp;values,&nbsp;without&nbsp;&#39;?&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3210783">Fragment</span>&nbsp;<span class="builtintype" id="3210792">string</span>&nbsp;<span class="comment" id="3210799">//&nbsp;fragment&nbsp;for&nbsp;references,&nbsp;without&nbsp;&#39;#&#39;</span><br>
<span class="lineno"></span><span class="op" id="3210839">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="comment" id="3210842">//&nbsp;User&nbsp;returns&nbsp;a&nbsp;Userinfo&nbsp;containing&nbsp;the&nbsp;provided&nbsp;username</span><br>
<span class="lineno"></span><span class="comment" id="3210902">//&nbsp;and&nbsp;no&nbsp;password&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="3210926">func</span>&nbsp;<span class="ident" id="3210931">User</span><span class="op" id="3210935">(</span><span class="ident" id="3210936">username</span>&nbsp;<span class="builtintype" id="3210945">string</span><span class="op" id="3210951">)</span>&nbsp;<span class="op" id="3210953">*</span><span class="ident" id="3210954">Userinfo</span>&nbsp;<span class="op" id="3210963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3210966">return</span>&nbsp;<span class="op" id="3210973">&amp;</span><span class="ident" id="3210974">Userinfo</span><span class="op" id="3210982">{</span><span class="ident" id="3210983">username</span><span class="op" id="3210991">,</span>&nbsp;<span class="string" id="3210993">&#34;&#34;</span><span class="op" id="3210995">,</span>&nbsp;<span class="builtintype" id="3210997">false</span><span class="op" id="3211002">}</span><br>
<span class="lineno">245</span><span class="op" id="3211004">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3211007">//&nbsp;UserPassword&nbsp;returns&nbsp;a&nbsp;Userinfo&nbsp;containing&nbsp;the&nbsp;provided&nbsp;username</span><br>
<span class="lineno"></span><span class="comment" id="3211075">//&nbsp;and&nbsp;password.</span><br>
<span class="lineno"></span><span class="comment" id="3211092">//&nbsp;This&nbsp;functionality&nbsp;should&nbsp;only&nbsp;be&nbsp;used&nbsp;with&nbsp;legacy&nbsp;web&nbsp;sites.</span><br>
<span class="lineno">250</span><span class="comment" id="3211157">//&nbsp;RFC&nbsp;2396&nbsp;warns&nbsp;that&nbsp;interpreting&nbsp;Userinfo&nbsp;this&nbsp;way</span><br>
<span class="lineno"></span><span class="comment" id="3211211">//&nbsp;``is&nbsp;NOT&nbsp;RECOMMENDED,&nbsp;because&nbsp;the&nbsp;passing&nbsp;of&nbsp;authentication</span><br>
<span class="lineno"></span><span class="comment" id="3211274">//&nbsp;information&nbsp;in&nbsp;clear&nbsp;text&nbsp;(such&nbsp;as&nbsp;URI)&nbsp;has&nbsp;proven&nbsp;to&nbsp;be&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3211336">//&nbsp;security&nbsp;risk&nbsp;in&nbsp;almost&nbsp;every&nbsp;case&nbsp;where&nbsp;it&nbsp;has&nbsp;been&nbsp;used.&#39;&#39;</span><br>
<span class="lineno"></span><span class="keyword" id="3211400">func</span>&nbsp;<span class="ident" id="3211405">UserPassword</span><span class="op" id="3211417">(</span><span class="ident" id="3211418">username</span><span class="op" id="3211426">,</span>&nbsp;<span class="ident" id="3211428">password</span>&nbsp;<span class="builtintype" id="3211437">string</span><span class="op" id="3211443">)</span>&nbsp;<span class="op" id="3211445">*</span><span class="ident" id="3211446">Userinfo</span>&nbsp;<span class="op" id="3211455">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3211458">return</span>&nbsp;<span class="op" id="3211465">&amp;</span><span class="ident" id="3211466">Userinfo</span><span class="op" id="3211474">{</span><span class="ident" id="3211475">username</span><span class="op" id="3211483">,</span>&nbsp;<span class="ident" id="3211485">password</span><span class="op" id="3211493">,</span>&nbsp;<span class="builtintype" id="3211495">true</span><span class="op" id="3211499">}</span><br>
<span class="lineno"></span><span class="op" id="3211501">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3211504">//&nbsp;The&nbsp;Userinfo&nbsp;type&nbsp;is&nbsp;an&nbsp;immutable&nbsp;encapsulation&nbsp;of&nbsp;username&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3211571">//&nbsp;password&nbsp;details&nbsp;for&nbsp;a&nbsp;URL.&nbsp;An&nbsp;existing&nbsp;Userinfo&nbsp;value&nbsp;is&nbsp;guaranteed</span><br>
<span class="lineno">260</span><span class="comment" id="3211643">//&nbsp;to&nbsp;have&nbsp;a&nbsp;username&nbsp;set&nbsp;(potentially&nbsp;empty,&nbsp;as&nbsp;allowed&nbsp;by&nbsp;RFC&nbsp;2396),</span><br>
<span class="lineno"></span><span class="comment" id="3211714">//&nbsp;and&nbsp;optionally&nbsp;a&nbsp;password.</span><br>
<span class="lineno"></span><span class="keyword" id="3211744">type</span>&nbsp;<span class="ident" id="3211749">Userinfo</span>&nbsp;<span class="keyword" id="3211758">struct</span>&nbsp;<span class="op" id="3211765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3211768">username</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3211780">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3211788">password</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3211800">string</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3211808">passwordSet</span>&nbsp;<span class="builtintype" id="3211820">bool</span><br>
<span class="lineno"></span><span class="op" id="3211825">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3211828">//&nbsp;Username&nbsp;returns&nbsp;the&nbsp;username.</span><br>
<span class="lineno"></span><span class="keyword" id="3211862">func</span>&nbsp;<span class="op" id="3211867">(</span><span class="ident" id="3211868">u</span>&nbsp;<span class="op" id="3211870">*</span><span class="ident" id="3211871">Userinfo</span><span class="op" id="3211879">)</span>&nbsp;<span class="ident" id="3211881">Username</span><span class="op" id="3211889">(</span><span class="op" id="3211890">)</span>&nbsp;<span class="builtintype" id="3211892">string</span>&nbsp;<span class="op" id="3211899">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3211902">return</span>&nbsp;<span class="ident" id="3211909">u</span><span class="op" id="3211910">.</span><span class="ident" id="3211911">username</span><br>
<span class="lineno"></span><span class="op" id="3211920">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3211923">//&nbsp;Password&nbsp;returns&nbsp;the&nbsp;password&nbsp;in&nbsp;case&nbsp;it&nbsp;is&nbsp;set,&nbsp;and&nbsp;whether&nbsp;it&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="3211998">func</span>&nbsp;<span class="op" id="3212003">(</span><span class="ident" id="3212004">u</span>&nbsp;<span class="op" id="3212006">*</span><span class="ident" id="3212007">Userinfo</span><span class="op" id="3212015">)</span>&nbsp;<span class="ident" id="3212017">Password</span><span class="op" id="3212025">(</span><span class="op" id="3212026">)</span>&nbsp;<span class="op" id="3212028">(</span><span class="builtintype" id="3212029">string</span><span class="op" id="3212035">,</span>&nbsp;<span class="builtintype" id="3212037">bool</span><span class="op" id="3212041">)</span>&nbsp;<span class="op" id="3212043">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3212046">if</span>&nbsp;<span class="ident" id="3212049">u</span><span class="op" id="3212050">.</span><span class="ident" id="3212051">passwordSet</span>&nbsp;<span class="op" id="3212063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3212067">return</span>&nbsp;<span class="ident" id="3212074">u</span><span class="op" id="3212075">.</span><span class="ident" id="3212076">password</span><span class="op" id="3212084">,</span>&nbsp;<span class="builtintype" id="3212086">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3212092">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3212095">return</span>&nbsp;<span class="string" id="3212102">&#34;&#34;</span><span class="op" id="3212104">,</span>&nbsp;<span class="builtintype" id="3212106">false</span><br>
<span class="lineno"></span><span class="op" id="3212112">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="comment" id="3212115">//&nbsp;String&nbsp;returns&nbsp;the&nbsp;encoded&nbsp;userinfo&nbsp;information&nbsp;in&nbsp;the&nbsp;standard&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="3212187">//&nbsp;of&nbsp;&#34;username[:password]&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3212216">func</span>&nbsp;<span class="op" id="3212221">(</span><span class="ident" id="3212222">u</span>&nbsp;<span class="op" id="3212224">*</span><span class="ident" id="3212225">Userinfo</span><span class="op" id="3212233">)</span>&nbsp;<span class="ident" id="3212235">String</span><span class="op" id="3212241">(</span><span class="op" id="3212242">)</span>&nbsp;<span class="builtintype" id="3212244">string</span>&nbsp;<span class="op" id="3212251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3212254">s</span>&nbsp;<span class="op" id="3212256">:=</span>&nbsp;<span class="ident" id="3212259">escape</span><span class="op" id="3212265">(</span><span class="ident" id="3212266">u</span><span class="op" id="3212267">.</span><span class="ident" id="3212268">username</span><span class="op" id="3212276">,</span>&nbsp;<span class="ident" id="3212278">encodeUserPassword</span><span class="op" id="3212296">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3212299">if</span>&nbsp;<span class="ident" id="3212302">u</span><span class="op" id="3212303">.</span><span class="ident" id="3212304">passwordSet</span>&nbsp;<span class="op" id="3212316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3212320">s</span>&nbsp;<span class="op" id="3212322">+=</span>&nbsp;<span class="string" id="3212325">&#34;:&#34;</span>&nbsp;<span class="op" id="3212329">+</span>&nbsp;<span class="ident" id="3212331">escape</span><span class="op" id="3212337">(</span><span class="ident" id="3212338">u</span><span class="op" id="3212339">.</span><span class="ident" id="3212340">password</span><span class="op" id="3212348">,</span>&nbsp;<span class="ident" id="3212350">encodeUserPassword</span><span class="op" id="3212368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3212371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3212374">return</span>&nbsp;<span class="ident" id="3212381">s</span><br>
<span class="lineno"></span><span class="op" id="3212383">}</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span><span class="comment" id="3212386">//&nbsp;Maybe&nbsp;rawurl&nbsp;is&nbsp;of&nbsp;the&nbsp;form&nbsp;scheme:path.</span><br>
<span class="lineno"></span><span class="comment" id="3212430">//&nbsp;(Scheme&nbsp;must&nbsp;be&nbsp;[a-zA-Z][a-zA-Z0-9+-.]*)</span><br>
<span class="lineno"></span><span class="comment" id="3212474">//&nbsp;If&nbsp;so,&nbsp;return&nbsp;scheme,&nbsp;path;&nbsp;else&nbsp;return&nbsp;&#34;&#34;,&nbsp;rawurl.</span><br>
<span class="lineno"></span><span class="keyword" id="3212529">func</span>&nbsp;<span class="ident" id="3212534">getscheme</span><span class="op" id="3212543">(</span><span class="ident" id="3212544">rawurl</span>&nbsp;<span class="builtintype" id="3212551">string</span><span class="op" id="3212557">)</span>&nbsp;<span class="op" id="3212559">(</span><span class="ident" id="3212560">scheme</span><span class="op" id="3212566">,</span>&nbsp;<span class="ident" id="3212568">path</span>&nbsp;<span class="builtintype" id="3212573">string</span><span class="op" id="3212579">,</span>&nbsp;<span class="ident" id="3212581">err</span>&nbsp;<span class="builtintype" id="3212585">error</span><span class="op" id="3212590">)</span>&nbsp;<span class="op" id="3212592">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3212595">for</span>&nbsp;<span class="ident" id="3212599">i</span>&nbsp;<span class="op" id="3212601">:=</span>&nbsp;<span class="num" id="3212604">0</span><span class="op" id="3212605">;</span>&nbsp;<span class="ident" id="3212607">i</span>&nbsp;<span class="op" id="3212609">&lt;</span>&nbsp;<span class="builtinfunc" id="3212611">len</span><span class="op" id="3212614">(</span><span class="ident" id="3212615">rawurl</span><span class="op" id="3212621">)</span><span class="op" id="3212622">;</span>&nbsp;<span class="ident" id="3212624">i</span><span class="op" id="3212625">++</span>&nbsp;<span class="op" id="3212628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3212632">c</span>&nbsp;<span class="op" id="3212634">:=</span>&nbsp;<span class="ident" id="3212637">rawurl</span><span class="op" id="3212643">[</span><span class="ident" id="3212644">i</span><span class="op" id="3212645">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3212649">switch</span>&nbsp;<span class="op" id="3212656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3212660">case</span>&nbsp;<span class="string" id="3212665">&#39;a&#39;</span>&nbsp;<span class="op" id="3212669">&lt;=</span>&nbsp;<span class="ident" id="3212672">c</span>&nbsp;<span class="op" id="3212674">&amp;&amp;</span>&nbsp;<span class="ident" id="3212677">c</span>&nbsp;<span class="op" id="3212679">&lt;=</span>&nbsp;<span class="string" id="3212682">&#39;z&#39;</span>&nbsp;<span class="op" id="3212686">||</span>&nbsp;<span class="string" id="3212689">&#39;A&#39;</span>&nbsp;<span class="op" id="3212693">&lt;=</span>&nbsp;<span class="ident" id="3212696">c</span>&nbsp;<span class="op" id="3212698">&amp;&amp;</span>&nbsp;<span class="ident" id="3212701">c</span>&nbsp;<span class="op" id="3212703">&lt;=</span>&nbsp;<span class="string" id="3212706">&#39;Z&#39;</span><span class="op" id="3212709">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3212713">//&nbsp;do&nbsp;nothing</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3212729">case</span>&nbsp;<span class="string" id="3212734">&#39;0&#39;</span>&nbsp;<span class="op" id="3212738">&lt;=</span>&nbsp;<span class="ident" id="3212741">c</span>&nbsp;<span class="op" id="3212743">&amp;&amp;</span>&nbsp;<span class="ident" id="3212746">c</span>&nbsp;<span class="op" id="3212748">&lt;=</span>&nbsp;<span class="string" id="3212751">&#39;9&#39;</span>&nbsp;<span class="op" id="3212755">||</span>&nbsp;<span class="ident" id="3212758">c</span>&nbsp;<span class="op" id="3212760">==</span>&nbsp;<span class="string" id="3212763">&#39;+&#39;</span>&nbsp;<span class="op" id="3212767">||</span>&nbsp;<span class="ident" id="3212770">c</span>&nbsp;<span class="op" id="3212772">==</span>&nbsp;<span class="string" id="3212775">&#39;-&#39;</span>&nbsp;<span class="op" id="3212779">||</span>&nbsp;<span class="ident" id="3212782">c</span>&nbsp;<span class="op" id="3212784">==</span>&nbsp;<span class="string" id="3212787">&#39;.&#39;</span><span class="op" id="3212790">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3212795">if</span>&nbsp;<span class="ident" id="3212798">i</span>&nbsp;<span class="op" id="3212800">==</span>&nbsp;<span class="num" id="3212803">0</span>&nbsp;<span class="op" id="3212805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3212811">return</span>&nbsp;<span class="string" id="3212818">&#34;&#34;</span><span class="op" id="3212820">,</span>&nbsp;<span class="ident" id="3212822">rawurl</span><span class="op" id="3212828">,</span>&nbsp;<span class="ident" id="3212830">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3212837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3212841">case</span>&nbsp;<span class="ident" id="3212846">c</span>&nbsp;<span class="op" id="3212848">==</span>&nbsp;<span class="string" id="3212851">&#39;:&#39;</span><span class="op" id="3212854">:</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3212859">if</span>&nbsp;<span class="ident" id="3212862">i</span>&nbsp;<span class="op" id="3212864">==</span>&nbsp;<span class="num" id="3212867">0</span>&nbsp;<span class="op" id="3212869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3212875">return</span>&nbsp;<span class="string" id="3212882">&#34;&#34;</span><span class="op" id="3212884">,</span>&nbsp;<span class="string" id="3212886">&#34;&#34;</span><span class="op" id="3212888">,</span>&nbsp;<span class="ident" id="3212890">errors</span><span class="op" id="3212896">.</span><span class="ident" id="3212897">New</span><span class="op" id="3212900">(</span><span class="string" id="3212901">&#34;missing&nbsp;protocol&nbsp;scheme&#34;</span><span class="op" id="3212926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3212931">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3212936">return</span>&nbsp;<span class="ident" id="3212943">rawurl</span><span class="op" id="3212949">[</span><span class="num" id="3212950">0</span><span class="op" id="3212951">:</span><span class="ident" id="3212952">i</span><span class="op" id="3212953">]</span><span class="op" id="3212954">,</span>&nbsp;<span class="ident" id="3212956">rawurl</span><span class="op" id="3212962">[</span><span class="ident" id="3212963">i</span><span class="op" id="3212964">+</span><span class="num" id="3212965">1</span><span class="op" id="3212966">:</span><span class="op" id="3212967">]</span><span class="op" id="3212968">,</span>&nbsp;<span class="ident" id="3212970">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3212976">default</span><span class="op" id="3212983">:</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3212988">//&nbsp;we&nbsp;have&nbsp;encountered&nbsp;an&nbsp;invalid&nbsp;character,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3213036">//&nbsp;so&nbsp;there&nbsp;is&nbsp;no&nbsp;valid&nbsp;scheme</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3213070">return</span>&nbsp;<span class="string" id="3213077">&#34;&#34;</span><span class="op" id="3213079">,</span>&nbsp;<span class="ident" id="3213081">rawurl</span><span class="op" id="3213087">,</span>&nbsp;<span class="ident" id="3213089">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3213095">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3213098">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3213101">return</span>&nbsp;<span class="string" id="3213108">&#34;&#34;</span><span class="op" id="3213110">,</span>&nbsp;<span class="ident" id="3213112">rawurl</span><span class="op" id="3213118">,</span>&nbsp;<span class="ident" id="3213120">nil</span><br>
<span class="lineno"></span><span class="op" id="3213124">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3213127">//&nbsp;Maybe&nbsp;s&nbsp;is&nbsp;of&nbsp;the&nbsp;form&nbsp;t&nbsp;c&nbsp;u.</span><br>
<span class="lineno"></span><span class="comment" id="3213160">//&nbsp;If&nbsp;so,&nbsp;return&nbsp;t,&nbsp;c&nbsp;u&nbsp;(or&nbsp;t,&nbsp;u&nbsp;if&nbsp;cutc&nbsp;==&nbsp;true).</span><br>
<span class="lineno">320</span><span class="comment" id="3213211">//&nbsp;If&nbsp;not,&nbsp;return&nbsp;s,&nbsp;&#34;&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3213236">func</span>&nbsp;<span class="ident" id="3213241">split</span><span class="op" id="3213246">(</span><span class="ident" id="3213247">s</span>&nbsp;<span class="builtintype" id="3213249">string</span><span class="op" id="3213255">,</span>&nbsp;<span class="ident" id="3213257">c</span>&nbsp;<span class="builtintype" id="3213259">string</span><span class="op" id="3213265">,</span>&nbsp;<span class="ident" id="3213267">cutc</span>&nbsp;<span class="builtintype" id="3213272">bool</span><span class="op" id="3213276">)</span>&nbsp;<span class="op" id="3213278">(</span><span class="builtintype" id="3213279">string</span><span class="op" id="3213285">,</span>&nbsp;<span class="builtintype" id="3213287">string</span><span class="op" id="3213293">)</span>&nbsp;<span class="op" id="3213295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3213298">i</span>&nbsp;<span class="op" id="3213300">:=</span>&nbsp;<span class="ident" id="3213303">strings</span><span class="op" id="3213310">.</span><span class="ident" id="3213311">Index</span><span class="op" id="3213316">(</span><span class="ident" id="3213317">s</span><span class="op" id="3213318">,</span>&nbsp;<span class="ident" id="3213320">c</span><span class="op" id="3213321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3213324">if</span>&nbsp;<span class="ident" id="3213327">i</span>&nbsp;<span class="op" id="3213329">&lt;</span>&nbsp;<span class="num" id="3213331">0</span>&nbsp;<span class="op" id="3213333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3213337">return</span>&nbsp;<span class="ident" id="3213344">s</span><span class="op" id="3213345">,</span>&nbsp;<span class="string" id="3213347">&#34;&#34;</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3213351">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3213354">if</span>&nbsp;<span class="ident" id="3213357">cutc</span>&nbsp;<span class="op" id="3213362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3213366">return</span>&nbsp;<span class="ident" id="3213373">s</span><span class="op" id="3213374">[</span><span class="num" id="3213375">0</span><span class="op" id="3213376">:</span><span class="ident" id="3213377">i</span><span class="op" id="3213378">]</span><span class="op" id="3213379">,</span>&nbsp;<span class="ident" id="3213381">s</span><span class="op" id="3213382">[</span><span class="ident" id="3213383">i</span><span class="op" id="3213384">+</span><span class="builtinfunc" id="3213385">len</span><span class="op" id="3213388">(</span><span class="ident" id="3213389">c</span><span class="op" id="3213390">)</span><span class="op" id="3213391">:</span><span class="op" id="3213392">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3213395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3213398">return</span>&nbsp;<span class="ident" id="3213405">s</span><span class="op" id="3213406">[</span><span class="num" id="3213407">0</span><span class="op" id="3213408">:</span><span class="ident" id="3213409">i</span><span class="op" id="3213410">]</span><span class="op" id="3213411">,</span>&nbsp;<span class="ident" id="3213413">s</span><span class="op" id="3213414">[</span><span class="ident" id="3213415">i</span><span class="op" id="3213416">:</span><span class="op" id="3213417">]</span><br>
<span class="lineno">330</span><span class="op" id="3213419">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3213422">//&nbsp;Parse&nbsp;parses&nbsp;rawurl&nbsp;into&nbsp;a&nbsp;URL&nbsp;structure.</span><br>
<span class="lineno"></span><span class="comment" id="3213467">//&nbsp;The&nbsp;rawurl&nbsp;may&nbsp;be&nbsp;relative&nbsp;or&nbsp;absolute.</span><br>
<span class="lineno"></span><span class="keyword" id="3213510">func</span>&nbsp;<span class="ident" id="3213515">Parse</span><span class="op" id="3213520">(</span><span class="ident" id="3213521">rawurl</span>&nbsp;<span class="builtintype" id="3213528">string</span><span class="op" id="3213534">)</span>&nbsp;<span class="op" id="3213536">(</span><span class="ident" id="3213537">url</span>&nbsp;<span class="op" id="3213541">*</span><span class="ident" id="3213542">URL</span><span class="op" id="3213545">,</span>&nbsp;<span class="ident" id="3213547">err</span>&nbsp;<span class="builtintype" id="3213551">error</span><span class="op" id="3213556">)</span>&nbsp;<span class="op" id="3213558">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3213561">//&nbsp;Cut&nbsp;off&nbsp;#frag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3213579">u</span><span class="op" id="3213580">,</span>&nbsp;<span class="ident" id="3213582">frag</span>&nbsp;<span class="op" id="3213587">:=</span>&nbsp;<span class="ident" id="3213590">split</span><span class="op" id="3213595">(</span><span class="ident" id="3213596">rawurl</span><span class="op" id="3213602">,</span>&nbsp;<span class="string" id="3213604">&#34;#&#34;</span><span class="op" id="3213607">,</span>&nbsp;<span class="builtintype" id="3213609">true</span><span class="op" id="3213613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3213616">if</span>&nbsp;<span class="ident" id="3213619">url</span><span class="op" id="3213622">,</span>&nbsp;<span class="ident" id="3213624">err</span>&nbsp;<span class="op" id="3213628">=</span>&nbsp;<span class="ident" id="3213630">parse</span><span class="op" id="3213635">(</span><span class="ident" id="3213636">u</span><span class="op" id="3213637">,</span>&nbsp;<span class="builtintype" id="3213639">false</span><span class="op" id="3213644">)</span><span class="op" id="3213645">;</span>&nbsp;<span class="ident" id="3213647">err</span>&nbsp;<span class="op" id="3213651">!=</span>&nbsp;<span class="ident" id="3213654">nil</span>&nbsp;<span class="op" id="3213658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3213662">return</span>&nbsp;<span class="ident" id="3213669">nil</span><span class="op" id="3213672">,</span>&nbsp;<span class="ident" id="3213674">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3213679">}</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3213682">if</span>&nbsp;<span class="ident" id="3213685">frag</span>&nbsp;<span class="op" id="3213690">==</span>&nbsp;<span class="string" id="3213693">&#34;&#34;</span>&nbsp;<span class="op" id="3213696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3213700">return</span>&nbsp;<span class="ident" id="3213707">url</span><span class="op" id="3213710">,</span>&nbsp;<span class="ident" id="3213712">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3213717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3213720">if</span>&nbsp;<span class="ident" id="3213723">url</span><span class="op" id="3213726">.</span><span class="ident" id="3213727">Fragment</span><span class="op" id="3213735">,</span>&nbsp;<span class="ident" id="3213737">err</span>&nbsp;<span class="op" id="3213741">=</span>&nbsp;<span class="ident" id="3213743">unescape</span><span class="op" id="3213751">(</span><span class="ident" id="3213752">frag</span><span class="op" id="3213756">,</span>&nbsp;<span class="ident" id="3213758">encodeFragment</span><span class="op" id="3213772">)</span><span class="op" id="3213773">;</span>&nbsp;<span class="ident" id="3213775">err</span>&nbsp;<span class="op" id="3213779">!=</span>&nbsp;<span class="ident" id="3213782">nil</span>&nbsp;<span class="op" id="3213786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3213790">return</span>&nbsp;<span class="ident" id="3213797">nil</span><span class="op" id="3213800">,</span>&nbsp;<span class="op" id="3213802">&amp;</span><span class="ident" id="3213803">Error</span><span class="op" id="3213808">{</span><span class="string" id="3213809">&#34;parse&#34;</span><span class="op" id="3213816">,</span>&nbsp;<span class="ident" id="3213818">rawurl</span><span class="op" id="3213824">,</span>&nbsp;<span class="ident" id="3213826">err</span><span class="op" id="3213829">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3213832">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3213835">return</span>&nbsp;<span class="ident" id="3213842">url</span><span class="op" id="3213845">,</span>&nbsp;<span class="ident" id="3213847">nil</span><br>
<span class="lineno"></span><span class="op" id="3213851">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3213854">//&nbsp;ParseRequestURI&nbsp;parses&nbsp;rawurl&nbsp;into&nbsp;a&nbsp;URL&nbsp;structure.&nbsp;&nbsp;It&nbsp;assumes&nbsp;that</span><br>
<span class="lineno">350</span><span class="comment" id="3213926">//&nbsp;rawurl&nbsp;was&nbsp;received&nbsp;in&nbsp;an&nbsp;HTTP&nbsp;request,&nbsp;so&nbsp;the&nbsp;rawurl&nbsp;is&nbsp;interpreted</span><br>
<span class="lineno"></span><span class="comment" id="3213998">//&nbsp;only&nbsp;as&nbsp;an&nbsp;absolute&nbsp;URI&nbsp;or&nbsp;an&nbsp;absolute&nbsp;path.</span><br>
<span class="lineno"></span><span class="comment" id="3214046">//&nbsp;The&nbsp;string&nbsp;rawurl&nbsp;is&nbsp;assumed&nbsp;not&nbsp;to&nbsp;have&nbsp;a&nbsp;#fragment&nbsp;suffix.</span><br>
<span class="lineno"></span><span class="comment" id="3214110">//&nbsp;(Web&nbsp;browsers&nbsp;strip&nbsp;#fragment&nbsp;before&nbsp;sending&nbsp;the&nbsp;URL&nbsp;to&nbsp;a&nbsp;web&nbsp;server.)</span><br>
<span class="lineno"></span><span class="keyword" id="3214184">func</span>&nbsp;<span class="ident" id="3214189">ParseRequestURI</span><span class="op" id="3214204">(</span><span class="ident" id="3214205">rawurl</span>&nbsp;<span class="builtintype" id="3214212">string</span><span class="op" id="3214218">)</span>&nbsp;<span class="op" id="3214220">(</span><span class="ident" id="3214221">url</span>&nbsp;<span class="op" id="3214225">*</span><span class="ident" id="3214226">URL</span><span class="op" id="3214229">,</span>&nbsp;<span class="ident" id="3214231">err</span>&nbsp;<span class="builtintype" id="3214235">error</span><span class="op" id="3214240">)</span>&nbsp;<span class="op" id="3214242">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3214245">return</span>&nbsp;<span class="ident" id="3214252">parse</span><span class="op" id="3214257">(</span><span class="ident" id="3214258">rawurl</span><span class="op" id="3214264">,</span>&nbsp;<span class="builtintype" id="3214266">true</span><span class="op" id="3214270">)</span><br>
<span class="lineno"></span><span class="op" id="3214272">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3214275">//&nbsp;parse&nbsp;parses&nbsp;a&nbsp;URL&nbsp;from&nbsp;a&nbsp;string&nbsp;in&nbsp;one&nbsp;of&nbsp;two&nbsp;contexts.&nbsp;&nbsp;If</span><br>
<span class="lineno"></span><span class="comment" id="3214339">//&nbsp;viaRequest&nbsp;is&nbsp;true,&nbsp;the&nbsp;URL&nbsp;is&nbsp;assumed&nbsp;to&nbsp;have&nbsp;arrived&nbsp;via&nbsp;an&nbsp;HTTP&nbsp;request,</span><br>
<span class="lineno">360</span><span class="comment" id="3214418">//&nbsp;in&nbsp;which&nbsp;case&nbsp;only&nbsp;absolute&nbsp;URLs&nbsp;or&nbsp;path-absolute&nbsp;relative&nbsp;URLs&nbsp;are&nbsp;allowed.</span><br>
<span class="lineno"></span><span class="comment" id="3214498">//&nbsp;If&nbsp;viaRequest&nbsp;is&nbsp;false,&nbsp;all&nbsp;forms&nbsp;of&nbsp;relative&nbsp;URLs&nbsp;are&nbsp;allowed.</span><br>
<span class="lineno"></span><span class="keyword" id="3214565">func</span>&nbsp;<span class="ident" id="3214570">parse</span><span class="op" id="3214575">(</span><span class="ident" id="3214576">rawurl</span>&nbsp;<span class="builtintype" id="3214583">string</span><span class="op" id="3214589">,</span>&nbsp;<span class="ident" id="3214591">viaRequest</span>&nbsp;<span class="builtintype" id="3214602">bool</span><span class="op" id="3214606">)</span>&nbsp;<span class="op" id="3214608">(</span><span class="ident" id="3214609">url</span>&nbsp;<span class="op" id="3214613">*</span><span class="ident" id="3214614">URL</span><span class="op" id="3214617">,</span>&nbsp;<span class="ident" id="3214619">err</span>&nbsp;<span class="builtintype" id="3214623">error</span><span class="op" id="3214628">)</span>&nbsp;<span class="op" id="3214630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3214633">var</span>&nbsp;<span class="ident" id="3214637">rest</span>&nbsp;<span class="builtintype" id="3214642">string</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3214651">if</span>&nbsp;<span class="ident" id="3214654">rawurl</span>&nbsp;<span class="op" id="3214661">==</span>&nbsp;<span class="string" id="3214664">&#34;&#34;</span>&nbsp;<span class="op" id="3214667">&amp;&amp;</span>&nbsp;<span class="ident" id="3214670">viaRequest</span>&nbsp;<span class="op" id="3214681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3214685">err</span>&nbsp;<span class="op" id="3214689">=</span>&nbsp;<span class="ident" id="3214691">errors</span><span class="op" id="3214697">.</span><span class="ident" id="3214698">New</span><span class="op" id="3214701">(</span><span class="string" id="3214702">&#34;empty&nbsp;url&#34;</span><span class="op" id="3214713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3214717">goto</span>&nbsp;<span class="ident" id="3214722">Error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3214729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3214732">url</span>&nbsp;<span class="op" id="3214736">=</span>&nbsp;<span class="builtinfunc" id="3214738">new</span><span class="op" id="3214741">(</span><span class="ident" id="3214742">URL</span><span class="op" id="3214745">)</span><br>
<span class="lineno">370</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3214749">if</span>&nbsp;<span class="ident" id="3214752">rawurl</span>&nbsp;<span class="op" id="3214759">==</span>&nbsp;<span class="string" id="3214762">&#34;*&#34;</span>&nbsp;<span class="op" id="3214766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3214770">url</span><span class="op" id="3214773">.</span><span class="ident" id="3214774">Path</span>&nbsp;<span class="op" id="3214779">=</span>&nbsp;<span class="string" id="3214781">&#34;*&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3214787">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3214795">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3214799">//&nbsp;Split&nbsp;off&nbsp;possible&nbsp;leading&nbsp;&#34;http:&#34;,&nbsp;&#34;mailto:&#34;,&nbsp;etc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3214855">//&nbsp;Cannot&nbsp;contain&nbsp;escaped&nbsp;characters.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3214894">if</span>&nbsp;<span class="ident" id="3214897">url</span><span class="op" id="3214900">.</span><span class="ident" id="3214901">Scheme</span><span class="op" id="3214907">,</span>&nbsp;<span class="ident" id="3214909">rest</span><span class="op" id="3214913">,</span>&nbsp;<span class="ident" id="3214915">err</span>&nbsp;<span class="op" id="3214919">=</span>&nbsp;<span class="ident" id="3214921">getscheme</span><span class="op" id="3214930">(</span><span class="ident" id="3214931">rawurl</span><span class="op" id="3214937">)</span><span class="op" id="3214938">;</span>&nbsp;<span class="ident" id="3214940">err</span>&nbsp;<span class="op" id="3214944">!=</span>&nbsp;<span class="ident" id="3214947">nil</span>&nbsp;<span class="op" id="3214951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3214955">goto</span>&nbsp;<span class="ident" id="3214960">Error</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3214967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3214970">url</span><span class="op" id="3214973">.</span><span class="ident" id="3214974">Scheme</span>&nbsp;<span class="op" id="3214981">=</span>&nbsp;<span class="ident" id="3214983">strings</span><span class="op" id="3214990">.</span><span class="ident" id="3214991">ToLower</span><span class="op" id="3214998">(</span><span class="ident" id="3214999">url</span><span class="op" id="3215002">.</span><span class="ident" id="3215003">Scheme</span><span class="op" id="3215009">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3215013">rest</span><span class="op" id="3215017">,</span>&nbsp;<span class="ident" id="3215019">url</span><span class="op" id="3215022">.</span><span class="ident" id="3215023">RawQuery</span>&nbsp;<span class="op" id="3215032">=</span>&nbsp;<span class="ident" id="3215034">split</span><span class="op" id="3215039">(</span><span class="ident" id="3215040">rest</span><span class="op" id="3215044">,</span>&nbsp;<span class="string" id="3215046">&#34;?&#34;</span><span class="op" id="3215049">,</span>&nbsp;<span class="builtintype" id="3215051">true</span><span class="op" id="3215055">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3215059">if</span>&nbsp;<span class="op" id="3215062">!</span><span class="ident" id="3215063">strings</span><span class="op" id="3215070">.</span><span class="ident" id="3215071">HasPrefix</span><span class="op" id="3215080">(</span><span class="ident" id="3215081">rest</span><span class="op" id="3215085">,</span>&nbsp;<span class="string" id="3215087">&#34;/&#34;</span><span class="op" id="3215090">)</span>&nbsp;<span class="op" id="3215092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3215096">if</span>&nbsp;<span class="ident" id="3215099">url</span><span class="op" id="3215102">.</span><span class="ident" id="3215103">Scheme</span>&nbsp;<span class="op" id="3215110">!=</span>&nbsp;<span class="string" id="3215113">&#34;&#34;</span>&nbsp;<span class="op" id="3215116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3215121">//&nbsp;We&nbsp;consider&nbsp;rootless&nbsp;paths&nbsp;per&nbsp;RFC&nbsp;3986&nbsp;as&nbsp;opaque.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3215178">url</span><span class="op" id="3215181">.</span><span class="ident" id="3215182">Opaque</span>&nbsp;<span class="op" id="3215189">=</span>&nbsp;<span class="ident" id="3215191">rest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3215199">return</span>&nbsp;<span class="ident" id="3215206">url</span><span class="op" id="3215209">,</span>&nbsp;<span class="ident" id="3215211">nil</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3215217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3215221">if</span>&nbsp;<span class="ident" id="3215224">viaRequest</span>&nbsp;<span class="op" id="3215235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3215240">err</span>&nbsp;<span class="op" id="3215244">=</span>&nbsp;<span class="ident" id="3215246">errors</span><span class="op" id="3215252">.</span><span class="ident" id="3215253">New</span><span class="op" id="3215256">(</span><span class="string" id="3215257">&#34;invalid&nbsp;URI&nbsp;for&nbsp;request&#34;</span><span class="op" id="3215282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3215287">goto</span>&nbsp;<span class="ident" id="3215292">Error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3215300">}</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3215303">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3215307">if</span>&nbsp;<span class="op" id="3215310">(</span><span class="ident" id="3215311">url</span><span class="op" id="3215314">.</span><span class="ident" id="3215315">Scheme</span>&nbsp;<span class="op" id="3215322">!=</span>&nbsp;<span class="string" id="3215325">&#34;&#34;</span>&nbsp;<span class="op" id="3215328">||</span>&nbsp;<span class="op" id="3215331">!</span><span class="ident" id="3215332">viaRequest</span>&nbsp;<span class="op" id="3215343">&amp;&amp;</span>&nbsp;<span class="op" id="3215346">!</span><span class="ident" id="3215347">strings</span><span class="op" id="3215354">.</span><span class="ident" id="3215355">HasPrefix</span><span class="op" id="3215364">(</span><span class="ident" id="3215365">rest</span><span class="op" id="3215369">,</span>&nbsp;<span class="string" id="3215371">&#34;///&#34;</span><span class="op" id="3215376">)</span><span class="op" id="3215377">)</span>&nbsp;<span class="op" id="3215379">&amp;&amp;</span>&nbsp;<span class="ident" id="3215382">strings</span><span class="op" id="3215389">.</span><span class="ident" id="3215390">HasPrefix</span><span class="op" id="3215399">(</span><span class="ident" id="3215400">rest</span><span class="op" id="3215404">,</span>&nbsp;<span class="string" id="3215406">&#34;//&#34;</span><span class="op" id="3215410">)</span>&nbsp;<span class="op" id="3215412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3215416">var</span>&nbsp;<span class="ident" id="3215420">authority</span>&nbsp;<span class="builtintype" id="3215430">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3215439">authority</span><span class="op" id="3215448">,</span>&nbsp;<span class="ident" id="3215450">rest</span>&nbsp;<span class="op" id="3215455">=</span>&nbsp;<span class="ident" id="3215457">split</span><span class="op" id="3215462">(</span><span class="ident" id="3215463">rest</span><span class="op" id="3215467">[</span><span class="num" id="3215468">2</span><span class="op" id="3215469">:</span><span class="op" id="3215470">]</span><span class="op" id="3215471">,</span>&nbsp;<span class="string" id="3215473">&#34;/&#34;</span><span class="op" id="3215476">,</span>&nbsp;<span class="builtintype" id="3215478">false</span><span class="op" id="3215483">)</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3215487">url</span><span class="op" id="3215490">.</span><span class="ident" id="3215491">User</span><span class="op" id="3215495">,</span>&nbsp;<span class="ident" id="3215497">url</span><span class="op" id="3215500">.</span><span class="ident" id="3215501">Host</span><span class="op" id="3215505">,</span>&nbsp;<span class="ident" id="3215507">err</span>&nbsp;<span class="op" id="3215511">=</span>&nbsp;<span class="ident" id="3215513">parseAuthority</span><span class="op" id="3215527">(</span><span class="ident" id="3215528">authority</span><span class="op" id="3215537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3215541">if</span>&nbsp;<span class="ident" id="3215544">err</span>&nbsp;<span class="op" id="3215548">!=</span>&nbsp;<span class="ident" id="3215551">nil</span>&nbsp;<span class="op" id="3215555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3215560">goto</span>&nbsp;<span class="ident" id="3215565">Error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3215573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3215577">if</span>&nbsp;<span class="ident" id="3215580">strings</span><span class="op" id="3215587">.</span><span class="ident" id="3215588">Contains</span><span class="op" id="3215596">(</span><span class="ident" id="3215597">url</span><span class="op" id="3215600">.</span><span class="ident" id="3215601">Host</span><span class="op" id="3215605">,</span>&nbsp;<span class="string" id="3215607">&#34;%&#34;</span><span class="op" id="3215610">)</span>&nbsp;<span class="op" id="3215612">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3215617">err</span>&nbsp;<span class="op" id="3215621">=</span>&nbsp;<span class="ident" id="3215623">errors</span><span class="op" id="3215629">.</span><span class="ident" id="3215630">New</span><span class="op" id="3215633">(</span><span class="string" id="3215634">&#34;hexadecimal&nbsp;escape&nbsp;in&nbsp;host&#34;</span><span class="op" id="3215662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3215667">goto</span>&nbsp;<span class="ident" id="3215672">Error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3215680">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3215683">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3215686">if</span>&nbsp;<span class="ident" id="3215689">url</span><span class="op" id="3215692">.</span><span class="ident" id="3215693">Path</span><span class="op" id="3215697">,</span>&nbsp;<span class="ident" id="3215699">err</span>&nbsp;<span class="op" id="3215703">=</span>&nbsp;<span class="ident" id="3215705">unescape</span><span class="op" id="3215713">(</span><span class="ident" id="3215714">rest</span><span class="op" id="3215718">,</span>&nbsp;<span class="ident" id="3215720">encodePath</span><span class="op" id="3215730">)</span><span class="op" id="3215731">;</span>&nbsp;<span class="ident" id="3215733">err</span>&nbsp;<span class="op" id="3215737">!=</span>&nbsp;<span class="ident" id="3215740">nil</span>&nbsp;<span class="op" id="3215744">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3215748">goto</span>&nbsp;<span class="ident" id="3215753">Error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3215760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3215763">return</span>&nbsp;<span class="ident" id="3215770">url</span><span class="op" id="3215773">,</span>&nbsp;<span class="ident" id="3215775">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="3215780">Error</span><span class="op" id="3215785">:</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3215788">return</span>&nbsp;<span class="ident" id="3215795">nil</span><span class="op" id="3215798">,</span>&nbsp;<span class="op" id="3215800">&amp;</span><span class="ident" id="3215801">Error</span><span class="op" id="3215806">{</span><span class="string" id="3215807">&#34;parse&#34;</span><span class="op" id="3215814">,</span>&nbsp;<span class="ident" id="3215816">rawurl</span><span class="op" id="3215822">,</span>&nbsp;<span class="ident" id="3215824">err</span><span class="op" id="3215827">}</span><br>
<span class="lineno"></span><span class="op" id="3215829">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3215832">func</span>&nbsp;<span class="ident" id="3215837">parseAuthority</span><span class="op" id="3215851">(</span><span class="ident" id="3215852">authority</span>&nbsp;<span class="builtintype" id="3215862">string</span><span class="op" id="3215868">)</span>&nbsp;<span class="op" id="3215870">(</span><span class="ident" id="3215871">user</span>&nbsp;<span class="op" id="3215876">*</span><span class="ident" id="3215877">Userinfo</span><span class="op" id="3215885">,</span>&nbsp;<span class="ident" id="3215887">host</span>&nbsp;<span class="builtintype" id="3215892">string</span><span class="op" id="3215898">,</span>&nbsp;<span class="ident" id="3215900">err</span>&nbsp;<span class="builtintype" id="3215904">error</span><span class="op" id="3215909">)</span>&nbsp;<span class="op" id="3215911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3215914">i</span>&nbsp;<span class="op" id="3215916">:=</span>&nbsp;<span class="ident" id="3215919">strings</span><span class="op" id="3215926">.</span><span class="ident" id="3215927">LastIndex</span><span class="op" id="3215936">(</span><span class="ident" id="3215937">authority</span><span class="op" id="3215946">,</span>&nbsp;<span class="string" id="3215948">&#34;@&#34;</span><span class="op" id="3215951">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3215954">if</span>&nbsp;<span class="ident" id="3215957">i</span>&nbsp;<span class="op" id="3215959">&lt;</span>&nbsp;<span class="num" id="3215961">0</span>&nbsp;<span class="op" id="3215963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3215967">host</span>&nbsp;<span class="op" id="3215972">=</span>&nbsp;<span class="ident" id="3215974">authority</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3215986">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3215994">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3215997">userinfo</span><span class="op" id="3216005">,</span>&nbsp;<span class="ident" id="3216007">host</span>&nbsp;<span class="op" id="3216012">:=</span>&nbsp;<span class="ident" id="3216015">authority</span><span class="op" id="3216024">[</span><span class="op" id="3216025">:</span><span class="ident" id="3216026">i</span><span class="op" id="3216027">]</span><span class="op" id="3216028">,</span>&nbsp;<span class="ident" id="3216030">authority</span><span class="op" id="3216039">[</span><span class="ident" id="3216040">i</span><span class="op" id="3216041">+</span><span class="num" id="3216042">1</span><span class="op" id="3216043">:</span><span class="op" id="3216044">]</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3216047">if</span>&nbsp;<span class="ident" id="3216050">strings</span><span class="op" id="3216057">.</span><span class="ident" id="3216058">Index</span><span class="op" id="3216063">(</span><span class="ident" id="3216064">userinfo</span><span class="op" id="3216072">,</span>&nbsp;<span class="string" id="3216074">&#34;:&#34;</span><span class="op" id="3216077">)</span>&nbsp;<span class="op" id="3216079">&lt;</span>&nbsp;<span class="num" id="3216081">0</span>&nbsp;<span class="op" id="3216083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3216087">if</span>&nbsp;<span class="ident" id="3216090">userinfo</span><span class="op" id="3216098">,</span>&nbsp;<span class="ident" id="3216100">err</span>&nbsp;<span class="op" id="3216104">=</span>&nbsp;<span class="ident" id="3216106">unescape</span><span class="op" id="3216114">(</span><span class="ident" id="3216115">userinfo</span><span class="op" id="3216123">,</span>&nbsp;<span class="ident" id="3216125">encodeUserPassword</span><span class="op" id="3216143">)</span><span class="op" id="3216144">;</span>&nbsp;<span class="ident" id="3216146">err</span>&nbsp;<span class="op" id="3216150">!=</span>&nbsp;<span class="ident" id="3216153">nil</span>&nbsp;<span class="op" id="3216157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3216162">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3216171">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3216175">user</span>&nbsp;<span class="op" id="3216180">=</span>&nbsp;<span class="ident" id="3216182">User</span><span class="op" id="3216186">(</span><span class="ident" id="3216187">userinfo</span><span class="op" id="3216195">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3216198">}</span>&nbsp;<span class="keyword" id="3216200">else</span>&nbsp;<span class="op" id="3216205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3216209">username</span><span class="op" id="3216217">,</span>&nbsp;<span class="ident" id="3216219">password</span>&nbsp;<span class="op" id="3216228">:=</span>&nbsp;<span class="ident" id="3216231">split</span><span class="op" id="3216236">(</span><span class="ident" id="3216237">userinfo</span><span class="op" id="3216245">,</span>&nbsp;<span class="string" id="3216247">&#34;:&#34;</span><span class="op" id="3216250">,</span>&nbsp;<span class="builtintype" id="3216252">true</span><span class="op" id="3216256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3216260">if</span>&nbsp;<span class="ident" id="3216263">username</span><span class="op" id="3216271">,</span>&nbsp;<span class="ident" id="3216273">err</span>&nbsp;<span class="op" id="3216277">=</span>&nbsp;<span class="ident" id="3216279">unescape</span><span class="op" id="3216287">(</span><span class="ident" id="3216288">username</span><span class="op" id="3216296">,</span>&nbsp;<span class="ident" id="3216298">encodeUserPassword</span><span class="op" id="3216316">)</span><span class="op" id="3216317">;</span>&nbsp;<span class="ident" id="3216319">err</span>&nbsp;<span class="op" id="3216323">!=</span>&nbsp;<span class="ident" id="3216326">nil</span>&nbsp;<span class="op" id="3216330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3216335">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3216344">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3216348">if</span>&nbsp;<span class="ident" id="3216351">password</span><span class="op" id="3216359">,</span>&nbsp;<span class="ident" id="3216361">err</span>&nbsp;<span class="op" id="3216365">=</span>&nbsp;<span class="ident" id="3216367">unescape</span><span class="op" id="3216375">(</span><span class="ident" id="3216376">password</span><span class="op" id="3216384">,</span>&nbsp;<span class="ident" id="3216386">encodeUserPassword</span><span class="op" id="3216404">)</span><span class="op" id="3216405">;</span>&nbsp;<span class="ident" id="3216407">err</span>&nbsp;<span class="op" id="3216411">!=</span>&nbsp;<span class="ident" id="3216414">nil</span>&nbsp;<span class="op" id="3216418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3216423">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3216432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3216436">user</span>&nbsp;<span class="op" id="3216441">=</span>&nbsp;<span class="ident" id="3216443">UserPassword</span><span class="op" id="3216455">(</span><span class="ident" id="3216456">username</span><span class="op" id="3216464">,</span>&nbsp;<span class="ident" id="3216466">password</span><span class="op" id="3216474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3216477">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3216480">return</span><br>
<span class="lineno"></span><span class="op" id="3216487">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3216490">//&nbsp;String&nbsp;reassembles&nbsp;the&nbsp;URL&nbsp;into&nbsp;a&nbsp;valid&nbsp;URL&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="3216545">//&nbsp;The&nbsp;general&nbsp;form&nbsp;of&nbsp;the&nbsp;result&nbsp;is&nbsp;one&nbsp;of:</span><br>
<span class="lineno">445</span><span class="comment" id="3216590">//</span><br>
<span class="lineno"></span><span class="comment" id="3216593">//&nbsp;&nbsp;&nbsp;&nbspscheme:opaque</span><br>
<span class="lineno"></span><span class="comment" id="3216610">//&nbsp;&nbsp;&nbsp;&nbspscheme://userinfo@host/path?query#fragment</span><br>
<span class="lineno"></span><span class="comment" id="3216656">//</span><br>
<span class="lineno"></span><span class="comment" id="3216659">//&nbsp;If&nbsp;u.Opaque&nbsp;is&nbsp;non-empty,&nbsp;String&nbsp;uses&nbsp;the&nbsp;first&nbsp;form;</span><br>
<span class="lineno">450</span><span class="comment" id="3216716">//&nbsp;otherwise&nbsp;it&nbsp;uses&nbsp;the&nbsp;second&nbsp;form.</span><br>
<span class="lineno"></span><span class="comment" id="3216754">//</span><br>
<span class="lineno"></span><span class="comment" id="3216757">//&nbsp;In&nbsp;the&nbsp;second&nbsp;form,&nbsp;the&nbsp;following&nbsp;rules&nbsp;apply:</span><br>
<span class="lineno"></span><span class="comment" id="3216807">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;if&nbsp;u.Scheme&nbsp;is&nbsp;empty,&nbsp;scheme:&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="comment" id="3216854">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;if&nbsp;u.User&nbsp;is&nbsp;nil,&nbsp;userinfo@&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno">455</span><span class="comment" id="3216899">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;if&nbsp;u.Host&nbsp;is&nbsp;empty,&nbsp;host/&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="comment" id="3216942">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;if&nbsp;u.Scheme&nbsp;and&nbsp;u.Host&nbsp;are&nbsp;empty&nbsp;and&nbsp;u.User&nbsp;is&nbsp;nil,</span><br>
<span class="lineno"></span><span class="comment" id="3216999">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;the&nbsp;entire&nbsp;scheme://userinfo@host/&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="comment" id="3217052">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;if&nbsp;u.Host&nbsp;is&nbsp;non-empty&nbsp;and&nbsp;u.Path&nbsp;begins&nbsp;with&nbsp;a&nbsp;/,</span><br>
<span class="lineno"></span><span class="comment" id="3217108">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;the&nbsp;form&nbsp;host/path&nbsp;does&nbsp;not&nbsp;add&nbsp;its&nbsp;own&nbsp;/.</span><br>
<span class="lineno">460</span><span class="comment" id="3217157">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;if&nbsp;u.RawQuery&nbsp;is&nbsp;empty,&nbsp;?query&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="comment" id="3217205">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;if&nbsp;u.Fragment&nbsp;is&nbsp;empty,&nbsp;#fragment&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="keyword" id="3217256">func</span>&nbsp;<span class="op" id="3217261">(</span><span class="ident" id="3217262">u</span>&nbsp;<span class="op" id="3217264">*</span><span class="ident" id="3217265">URL</span><span class="op" id="3217268">)</span>&nbsp;<span class="ident" id="3217270">String</span><span class="op" id="3217276">(</span><span class="op" id="3217277">)</span>&nbsp;<span class="builtintype" id="3217279">string</span>&nbsp;<span class="op" id="3217286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3217289">var</span>&nbsp;<span class="ident" id="3217293">buf</span>&nbsp;<span class="ident" id="3217297">bytes</span><span class="op" id="3217302">.</span><span class="ident" id="3217303">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3217311">if</span>&nbsp;<span class="ident" id="3217314">u</span><span class="op" id="3217315">.</span><span class="ident" id="3217316">Scheme</span>&nbsp;<span class="op" id="3217323">!=</span>&nbsp;<span class="string" id="3217326">&#34;&#34;</span>&nbsp;<span class="op" id="3217329">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3217333">buf</span><span class="op" id="3217336">.</span><span class="ident" id="3217337">WriteString</span><span class="op" id="3217348">(</span><span class="ident" id="3217349">u</span><span class="op" id="3217350">.</span><span class="ident" id="3217351">Scheme</span><span class="op" id="3217357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3217361">buf</span><span class="op" id="3217364">.</span><span class="ident" id="3217365">WriteByte</span><span class="op" id="3217374">(</span><span class="string" id="3217375">&#39;:&#39;</span><span class="op" id="3217378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3217381">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3217384">if</span>&nbsp;<span class="ident" id="3217387">u</span><span class="op" id="3217388">.</span><span class="ident" id="3217389">Opaque</span>&nbsp;<span class="op" id="3217396">!=</span>&nbsp;<span class="string" id="3217399">&#34;&#34;</span>&nbsp;<span class="op" id="3217402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3217406">buf</span><span class="op" id="3217409">.</span><span class="ident" id="3217410">WriteString</span><span class="op" id="3217421">(</span><span class="ident" id="3217422">u</span><span class="op" id="3217423">.</span><span class="ident" id="3217424">Opaque</span><span class="op" id="3217430">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3217433">}</span>&nbsp;<span class="keyword" id="3217435">else</span>&nbsp;<span class="op" id="3217440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3217444">if</span>&nbsp;<span class="ident" id="3217447">u</span><span class="op" id="3217448">.</span><span class="ident" id="3217449">Scheme</span>&nbsp;<span class="op" id="3217456">!=</span>&nbsp;<span class="string" id="3217459">&#34;&#34;</span>&nbsp;<span class="op" id="3217462">||</span>&nbsp;<span class="ident" id="3217465">u</span><span class="op" id="3217466">.</span><span class="ident" id="3217467">Host</span>&nbsp;<span class="op" id="3217472">!=</span>&nbsp;<span class="string" id="3217475">&#34;&#34;</span>&nbsp;<span class="op" id="3217478">||</span>&nbsp;<span class="ident" id="3217481">u</span><span class="op" id="3217482">.</span><span class="ident" id="3217483">User</span>&nbsp;<span class="op" id="3217488">!=</span>&nbsp;<span class="ident" id="3217491">nil</span>&nbsp;<span class="op" id="3217495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3217500">buf</span><span class="op" id="3217503">.</span><span class="ident" id="3217504">WriteString</span><span class="op" id="3217515">(</span><span class="string" id="3217516">&#34;//&#34;</span><span class="op" id="3217520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3217525">if</span>&nbsp;<span class="ident" id="3217528">ui</span>&nbsp;<span class="op" id="3217531">:=</span>&nbsp;<span class="ident" id="3217534">u</span><span class="op" id="3217535">.</span><span class="ident" id="3217536">User</span><span class="op" id="3217540">;</span>&nbsp;<span class="ident" id="3217542">ui</span>&nbsp;<span class="op" id="3217545">!=</span>&nbsp;<span class="ident" id="3217548">nil</span>&nbsp;<span class="op" id="3217552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3217558">buf</span><span class="op" id="3217561">.</span><span class="ident" id="3217562">WriteString</span><span class="op" id="3217573">(</span><span class="ident" id="3217574">ui</span><span class="op" id="3217576">.</span><span class="ident" id="3217577">String</span><span class="op" id="3217583">(</span><span class="op" id="3217584">)</span><span class="op" id="3217585">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3217591">buf</span><span class="op" id="3217594">.</span><span class="ident" id="3217595">WriteByte</span><span class="op" id="3217604">(</span><span class="string" id="3217605">&#39;@&#39;</span><span class="op" id="3217608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3217613">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3217618">if</span>&nbsp;<span class="ident" id="3217621">h</span>&nbsp;<span class="op" id="3217623">:=</span>&nbsp;<span class="ident" id="3217626">u</span><span class="op" id="3217627">.</span><span class="ident" id="3217628">Host</span><span class="op" id="3217632">;</span>&nbsp;<span class="ident" id="3217634">h</span>&nbsp;<span class="op" id="3217636">!=</span>&nbsp;<span class="string" id="3217639">&#34;&#34;</span>&nbsp;<span class="op" id="3217642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3217648">buf</span><span class="op" id="3217651">.</span><span class="ident" id="3217652">WriteString</span><span class="op" id="3217663">(</span><span class="ident" id="3217664">h</span><span class="op" id="3217665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3217670">}</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3217674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3217678">if</span>&nbsp;<span class="ident" id="3217681">u</span><span class="op" id="3217682">.</span><span class="ident" id="3217683">Path</span>&nbsp;<span class="op" id="3217688">!=</span>&nbsp;<span class="string" id="3217691">&#34;&#34;</span>&nbsp;<span class="op" id="3217694">&amp;&amp;</span>&nbsp;<span class="ident" id="3217697">u</span><span class="op" id="3217698">.</span><span class="ident" id="3217699">Path</span><span class="op" id="3217703">[</span><span class="num" id="3217704">0</span><span class="op" id="3217705">]</span>&nbsp;<span class="op" id="3217707">!=</span>&nbsp;<span class="string" id="3217710">&#39;/&#39;</span>&nbsp;<span class="op" id="3217714">&amp;&amp;</span>&nbsp;<span class="ident" id="3217717">u</span><span class="op" id="3217718">.</span><span class="ident" id="3217719">Host</span>&nbsp;<span class="op" id="3217724">!=</span>&nbsp;<span class="string" id="3217727">&#34;&#34;</span>&nbsp;<span class="op" id="3217730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3217735">buf</span><span class="op" id="3217738">.</span><span class="ident" id="3217739">WriteByte</span><span class="op" id="3217748">(</span><span class="string" id="3217749">&#39;/&#39;</span><span class="op" id="3217752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3217756">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3217760">buf</span><span class="op" id="3217763">.</span><span class="ident" id="3217764">WriteString</span><span class="op" id="3217775">(</span><span class="ident" id="3217776">escape</span><span class="op" id="3217782">(</span><span class="ident" id="3217783">u</span><span class="op" id="3217784">.</span><span class="ident" id="3217785">Path</span><span class="op" id="3217789">,</span>&nbsp;<span class="ident" id="3217791">encodePath</span><span class="op" id="3217801">)</span><span class="op" id="3217802">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3217805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3217808">if</span>&nbsp;<span class="ident" id="3217811">u</span><span class="op" id="3217812">.</span><span class="ident" id="3217813">RawQuery</span>&nbsp;<span class="op" id="3217822">!=</span>&nbsp;<span class="string" id="3217825">&#34;&#34;</span>&nbsp;<span class="op" id="3217828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3217832">buf</span><span class="op" id="3217835">.</span><span class="ident" id="3217836">WriteByte</span><span class="op" id="3217845">(</span><span class="string" id="3217846">&#39;?&#39;</span><span class="op" id="3217849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3217853">buf</span><span class="op" id="3217856">.</span><span class="ident" id="3217857">WriteString</span><span class="op" id="3217868">(</span><span class="ident" id="3217869">u</span><span class="op" id="3217870">.</span><span class="ident" id="3217871">RawQuery</span><span class="op" id="3217879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3217882">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3217885">if</span>&nbsp;<span class="ident" id="3217888">u</span><span class="op" id="3217889">.</span><span class="ident" id="3217890">Fragment</span>&nbsp;<span class="op" id="3217899">!=</span>&nbsp;<span class="string" id="3217902">&#34;&#34;</span>&nbsp;<span class="op" id="3217905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3217909">buf</span><span class="op" id="3217912">.</span><span class="ident" id="3217913">WriteByte</span><span class="op" id="3217922">(</span><span class="string" id="3217923">&#39;#&#39;</span><span class="op" id="3217926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3217930">buf</span><span class="op" id="3217933">.</span><span class="ident" id="3217934">WriteString</span><span class="op" id="3217945">(</span><span class="ident" id="3217946">escape</span><span class="op" id="3217952">(</span><span class="ident" id="3217953">u</span><span class="op" id="3217954">.</span><span class="ident" id="3217955">Fragment</span><span class="op" id="3217963">,</span>&nbsp;<span class="ident" id="3217965">encodeFragment</span><span class="op" id="3217979">)</span><span class="op" id="3217980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3217983">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3217986">return</span>&nbsp;<span class="ident" id="3217993">buf</span><span class="op" id="3217996">.</span><span class="ident" id="3217997">String</span><span class="op" id="3218003">(</span><span class="op" id="3218004">)</span><br>
<span class="lineno">495</span><span class="op" id="3218006">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3218009">//&nbsp;Values&nbsp;maps&nbsp;a&nbsp;string&nbsp;key&nbsp;to&nbsp;a&nbsp;list&nbsp;of&nbsp;values.</span><br>
<span class="lineno"></span><span class="comment" id="3218058">//&nbsp;It&nbsp;is&nbsp;typically&nbsp;used&nbsp;for&nbsp;query&nbsp;parameters&nbsp;and&nbsp;form&nbsp;values.</span><br>
<span class="lineno"></span><span class="comment" id="3218120">//&nbsp;Unlike&nbsp;in&nbsp;the&nbsp;http.Header&nbsp;map,&nbsp;the&nbsp;keys&nbsp;in&nbsp;a&nbsp;Values&nbsp;map</span><br>
<span class="lineno">500</span><span class="comment" id="3218179">//&nbsp;are&nbsp;case-sensitive.</span><br>
<span class="lineno"></span><span class="keyword" id="3218202">type</span>&nbsp;<span class="ident" id="3218207">Values</span>&nbsp;<span class="keyword" id="3218214">map</span><span class="op" id="3218217">[</span><span class="builtintype" id="3218218">string</span><span class="op" id="3218224">]</span><span class="op" id="3218225">[</span><span class="op" id="3218226">]</span><span class="builtintype" id="3218227">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3218235">//&nbsp;Get&nbsp;gets&nbsp;the&nbsp;first&nbsp;value&nbsp;associated&nbsp;with&nbsp;the&nbsp;given&nbsp;key.</span><br>
<span class="lineno"></span><span class="comment" id="3218294">//&nbsp;If&nbsp;there&nbsp;are&nbsp;no&nbsp;values&nbsp;associated&nbsp;with&nbsp;the&nbsp;key,&nbsp;Get&nbsp;returns</span><br>
<span class="lineno">505</span><span class="comment" id="3218357">//&nbsp;the&nbsp;empty&nbsp;string.&nbsp;To&nbsp;access&nbsp;multiple&nbsp;values,&nbsp;use&nbsp;the&nbsp;map</span><br>
<span class="lineno"></span><span class="comment" id="3218417">//&nbsp;directly.</span><br>
<span class="lineno"></span><span class="keyword" id="3218430">func</span>&nbsp;<span class="op" id="3218435">(</span><span class="ident" id="3218436">v</span>&nbsp;<span class="ident" id="3218438">Values</span><span class="op" id="3218444">)</span>&nbsp;<span class="ident" id="3218446">Get</span><span class="op" id="3218449">(</span><span class="ident" id="3218450">key</span>&nbsp;<span class="builtintype" id="3218454">string</span><span class="op" id="3218460">)</span>&nbsp;<span class="builtintype" id="3218462">string</span>&nbsp;<span class="op" id="3218469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3218472">if</span>&nbsp;<span class="ident" id="3218475">v</span>&nbsp;<span class="op" id="3218477">==</span>&nbsp;<span class="ident" id="3218480">nil</span>&nbsp;<span class="op" id="3218484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3218488">return</span>&nbsp;<span class="string" id="3218495">&#34;&#34;</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3218499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3218502">vs</span><span class="op" id="3218504">,</span>&nbsp;<span class="ident" id="3218506">ok</span>&nbsp;<span class="op" id="3218509">:=</span>&nbsp;<span class="ident" id="3218512">v</span><span class="op" id="3218513">[</span><span class="ident" id="3218514">key</span><span class="op" id="3218517">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3218520">if</span>&nbsp;<span class="op" id="3218523">!</span><span class="ident" id="3218524">ok</span>&nbsp;<span class="op" id="3218527">||</span>&nbsp;<span class="builtinfunc" id="3218530">len</span><span class="op" id="3218533">(</span><span class="ident" id="3218534">vs</span><span class="op" id="3218536">)</span>&nbsp;<span class="op" id="3218538">==</span>&nbsp;<span class="num" id="3218541">0</span>&nbsp;<span class="op" id="3218543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3218547">return</span>&nbsp;<span class="string" id="3218554">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3218558">}</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3218561">return</span>&nbsp;<span class="ident" id="3218568">vs</span><span class="op" id="3218570">[</span><span class="num" id="3218571">0</span><span class="op" id="3218572">]</span><br>
<span class="lineno"></span><span class="op" id="3218574">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3218577">//&nbsp;Set&nbsp;sets&nbsp;the&nbsp;key&nbsp;to&nbsp;value.&nbsp;It&nbsp;replaces&nbsp;any&nbsp;existing</span><br>
<span class="lineno"></span><span class="comment" id="3218632">//&nbsp;values.</span><br>
<span class="lineno">520</span><span class="keyword" id="3218643">func</span>&nbsp;<span class="op" id="3218648">(</span><span class="ident" id="3218649">v</span>&nbsp;<span class="ident" id="3218651">Values</span><span class="op" id="3218657">)</span>&nbsp;<span class="ident" id="3218659">Set</span><span class="op" id="3218662">(</span><span class="ident" id="3218663">key</span><span class="op" id="3218666">,</span>&nbsp;<span class="ident" id="3218668">value</span>&nbsp;<span class="builtintype" id="3218674">string</span><span class="op" id="3218680">)</span>&nbsp;<span class="op" id="3218682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3218685">v</span><span class="op" id="3218686">[</span><span class="ident" id="3218687">key</span><span class="op" id="3218690">]</span>&nbsp;<span class="op" id="3218692">=</span>&nbsp;<span class="op" id="3218694">[</span><span class="op" id="3218695">]</span><span class="builtintype" id="3218696">string</span><span class="op" id="3218702">{</span><span class="ident" id="3218703">value</span><span class="op" id="3218708">}</span><br>
<span class="lineno"></span><span class="op" id="3218710">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3218713">//&nbsp;Add&nbsp;adds&nbsp;the&nbsp;value&nbsp;to&nbsp;key.&nbsp;It&nbsp;appends&nbsp;to&nbsp;any&nbsp;existing</span><br>
<span class="lineno">525</span><span class="comment" id="3218770">//&nbsp;values&nbsp;associated&nbsp;with&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="3218801">func</span>&nbsp;<span class="op" id="3218806">(</span><span class="ident" id="3218807">v</span>&nbsp;<span class="ident" id="3218809">Values</span><span class="op" id="3218815">)</span>&nbsp;<span class="ident" id="3218817">Add</span><span class="op" id="3218820">(</span><span class="ident" id="3218821">key</span><span class="op" id="3218824">,</span>&nbsp;<span class="ident" id="3218826">value</span>&nbsp;<span class="builtintype" id="3218832">string</span><span class="op" id="3218838">)</span>&nbsp;<span class="op" id="3218840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3218843">v</span><span class="op" id="3218844">[</span><span class="ident" id="3218845">key</span><span class="op" id="3218848">]</span>&nbsp;<span class="op" id="3218850">=</span>&nbsp;<span class="builtinfunc" id="3218852">append</span><span class="op" id="3218858">(</span><span class="ident" id="3218859">v</span><span class="op" id="3218860">[</span><span class="ident" id="3218861">key</span><span class="op" id="3218864">]</span><span class="op" id="3218865">,</span>&nbsp;<span class="ident" id="3218867">value</span><span class="op" id="3218872">)</span><br>
<span class="lineno"></span><span class="op" id="3218874">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span><span class="comment" id="3218877">//&nbsp;Del&nbsp;deletes&nbsp;the&nbsp;values&nbsp;associated&nbsp;with&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="3218924">func</span>&nbsp;<span class="op" id="3218929">(</span><span class="ident" id="3218930">v</span>&nbsp;<span class="ident" id="3218932">Values</span><span class="op" id="3218938">)</span>&nbsp;<span class="ident" id="3218940">Del</span><span class="op" id="3218943">(</span><span class="ident" id="3218944">key</span>&nbsp;<span class="builtintype" id="3218948">string</span><span class="op" id="3218954">)</span>&nbsp;<span class="op" id="3218956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3218959">delete</span><span class="op" id="3218965">(</span><span class="ident" id="3218966">v</span><span class="op" id="3218967">,</span>&nbsp;<span class="ident" id="3218969">key</span><span class="op" id="3218972">)</span><br>
<span class="lineno"></span><span class="op" id="3218974">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span><span class="comment" id="3218977">//&nbsp;ParseQuery&nbsp;parses&nbsp;the&nbsp;URL-encoded&nbsp;query&nbsp;string&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="3219039">//&nbsp;a&nbsp;map&nbsp;listing&nbsp;the&nbsp;values&nbsp;specified&nbsp;for&nbsp;each&nbsp;key.</span><br>
<span class="lineno"></span><span class="comment" id="3219091">//&nbsp;ParseQuery&nbsp;always&nbsp;returns&nbsp;a&nbsp;non-nil&nbsp;map&nbsp;containing&nbsp;all&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3219153">//&nbsp;valid&nbsp;query&nbsp;parameters&nbsp;found;&nbsp;err&nbsp;describes&nbsp;the&nbsp;first&nbsp;decoding&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="3219225">//&nbsp;encountered,&nbsp;if&nbsp;any.</span><br>
<span class="lineno">540</span><span class="keyword" id="3219249">func</span>&nbsp;<span class="ident" id="3219254">ParseQuery</span><span class="op" id="3219264">(</span><span class="ident" id="3219265">query</span>&nbsp;<span class="builtintype" id="3219271">string</span><span class="op" id="3219277">)</span>&nbsp;<span class="op" id="3219279">(</span><span class="ident" id="3219280">m</span>&nbsp;<span class="ident" id="3219282">Values</span><span class="op" id="3219288">,</span>&nbsp;<span class="ident" id="3219290">err</span>&nbsp;<span class="builtintype" id="3219294">error</span><span class="op" id="3219299">)</span>&nbsp;<span class="op" id="3219301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3219304">m</span>&nbsp;<span class="op" id="3219306">=</span>&nbsp;<span class="builtinfunc" id="3219308">make</span><span class="op" id="3219312">(</span><span class="ident" id="3219313">Values</span><span class="op" id="3219319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3219322">err</span>&nbsp;<span class="op" id="3219326">=</span>&nbsp;<span class="ident" id="3219328">parseQuery</span><span class="op" id="3219338">(</span><span class="ident" id="3219339">m</span><span class="op" id="3219340">,</span>&nbsp;<span class="ident" id="3219342">query</span><span class="op" id="3219347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3219350">return</span><br>
<span class="lineno"></span><span class="op" id="3219357">}</span><br>
<span class="lineno">545</span><br>
<span class="lineno"></span><span class="keyword" id="3219360">func</span>&nbsp;<span class="ident" id="3219365">parseQuery</span><span class="op" id="3219375">(</span><span class="ident" id="3219376">m</span>&nbsp;<span class="ident" id="3219378">Values</span><span class="op" id="3219384">,</span>&nbsp;<span class="ident" id="3219386">query</span>&nbsp;<span class="builtintype" id="3219392">string</span><span class="op" id="3219398">)</span>&nbsp;<span class="op" id="3219400">(</span><span class="ident" id="3219401">err</span>&nbsp;<span class="builtintype" id="3219405">error</span><span class="op" id="3219410">)</span>&nbsp;<span class="op" id="3219412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3219415">for</span>&nbsp;<span class="ident" id="3219419">query</span>&nbsp;<span class="op" id="3219425">!=</span>&nbsp;<span class="string" id="3219428">&#34;&#34;</span>&nbsp;<span class="op" id="3219431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3219435">key</span>&nbsp;<span class="op" id="3219439">:=</span>&nbsp;<span class="ident" id="3219442">query</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3219450">if</span>&nbsp;<span class="ident" id="3219453">i</span>&nbsp;<span class="op" id="3219455">:=</span>&nbsp;<span class="ident" id="3219458">strings</span><span class="op" id="3219465">.</span><span class="ident" id="3219466">IndexAny</span><span class="op" id="3219474">(</span><span class="ident" id="3219475">key</span><span class="op" id="3219478">,</span>&nbsp;<span class="string" id="3219480">&#34;&amp;;&#34;</span><span class="op" id="3219484">)</span><span class="op" id="3219485">;</span>&nbsp;<span class="ident" id="3219487">i</span>&nbsp;<span class="op" id="3219489">&gt;=</span>&nbsp;<span class="num" id="3219492">0</span>&nbsp;<span class="op" id="3219494">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3219499">key</span><span class="op" id="3219502">,</span>&nbsp;<span class="ident" id="3219504">query</span>&nbsp;<span class="op" id="3219510">=</span>&nbsp;<span class="ident" id="3219512">key</span><span class="op" id="3219515">[</span><span class="op" id="3219516">:</span><span class="ident" id="3219517">i</span><span class="op" id="3219518">]</span><span class="op" id="3219519">,</span>&nbsp;<span class="ident" id="3219521">key</span><span class="op" id="3219524">[</span><span class="ident" id="3219525">i</span><span class="op" id="3219526">+</span><span class="num" id="3219527">1</span><span class="op" id="3219528">:</span><span class="op" id="3219529">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3219533">}</span>&nbsp;<span class="keyword" id="3219535">else</span>&nbsp;<span class="op" id="3219540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3219545">query</span>&nbsp;<span class="op" id="3219551">=</span>&nbsp;<span class="string" id="3219553">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3219558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3219562">if</span>&nbsp;<span class="ident" id="3219565">key</span>&nbsp;<span class="op" id="3219569">==</span>&nbsp;<span class="string" id="3219572">&#34;&#34;</span>&nbsp;<span class="op" id="3219575">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3219580">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3219591">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3219595">value</span>&nbsp;<span class="op" id="3219601">:=</span>&nbsp;<span class="string" id="3219604">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3219609">if</span>&nbsp;<span class="ident" id="3219612">i</span>&nbsp;<span class="op" id="3219614">:=</span>&nbsp;<span class="ident" id="3219617">strings</span><span class="op" id="3219624">.</span><span class="ident" id="3219625">Index</span><span class="op" id="3219630">(</span><span class="ident" id="3219631">key</span><span class="op" id="3219634">,</span>&nbsp;<span class="string" id="3219636">&#34;=&#34;</span><span class="op" id="3219639">)</span><span class="op" id="3219640">;</span>&nbsp;<span class="ident" id="3219642">i</span>&nbsp;<span class="op" id="3219644">&gt;=</span>&nbsp;<span class="num" id="3219647">0</span>&nbsp;<span class="op" id="3219649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3219654">key</span><span class="op" id="3219657">,</span>&nbsp;<span class="ident" id="3219659">value</span>&nbsp;<span class="op" id="3219665">=</span>&nbsp;<span class="ident" id="3219667">key</span><span class="op" id="3219670">[</span><span class="op" id="3219671">:</span><span class="ident" id="3219672">i</span><span class="op" id="3219673">]</span><span class="op" id="3219674">,</span>&nbsp;<span class="ident" id="3219676">key</span><span class="op" id="3219679">[</span><span class="ident" id="3219680">i</span><span class="op" id="3219681">+</span><span class="num" id="3219682">1</span><span class="op" id="3219683">:</span><span class="op" id="3219684">]</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3219688">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3219692">key</span><span class="op" id="3219695">,</span>&nbsp;<span class="ident" id="3219697">err1</span>&nbsp;<span class="op" id="3219702">:=</span>&nbsp;<span class="ident" id="3219705">QueryUnescape</span><span class="op" id="3219718">(</span><span class="ident" id="3219719">key</span><span class="op" id="3219722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3219726">if</span>&nbsp;<span class="ident" id="3219729">err1</span>&nbsp;<span class="op" id="3219734">!=</span>&nbsp;<span class="ident" id="3219737">nil</span>&nbsp;<span class="op" id="3219741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3219746">if</span>&nbsp;<span class="ident" id="3219749">err</span>&nbsp;<span class="op" id="3219753">==</span>&nbsp;<span class="ident" id="3219756">nil</span>&nbsp;<span class="op" id="3219760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3219766">err</span>&nbsp;<span class="op" id="3219770">=</span>&nbsp;<span class="ident" id="3219772">err1</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3219780">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3219785">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3219796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3219800">value</span><span class="op" id="3219805">,</span>&nbsp;<span class="ident" id="3219807">err1</span>&nbsp;<span class="op" id="3219812">=</span>&nbsp;<span class="ident" id="3219814">QueryUnescape</span><span class="op" id="3219827">(</span><span class="ident" id="3219828">value</span><span class="op" id="3219833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3219837">if</span>&nbsp;<span class="ident" id="3219840">err1</span>&nbsp;<span class="op" id="3219845">!=</span>&nbsp;<span class="ident" id="3219848">nil</span>&nbsp;<span class="op" id="3219852">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3219857">if</span>&nbsp;<span class="ident" id="3219860">err</span>&nbsp;<span class="op" id="3219864">==</span>&nbsp;<span class="ident" id="3219867">nil</span>&nbsp;<span class="op" id="3219871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3219877">err</span>&nbsp;<span class="op" id="3219881">=</span>&nbsp;<span class="ident" id="3219883">err1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3219891">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3219896">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3219907">}</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3219911">m</span><span class="op" id="3219912">[</span><span class="ident" id="3219913">key</span><span class="op" id="3219916">]</span>&nbsp;<span class="op" id="3219918">=</span>&nbsp;<span class="builtinfunc" id="3219920">append</span><span class="op" id="3219926">(</span><span class="ident" id="3219927">m</span><span class="op" id="3219928">[</span><span class="ident" id="3219929">key</span><span class="op" id="3219932">]</span><span class="op" id="3219933">,</span>&nbsp;<span class="ident" id="3219935">value</span><span class="op" id="3219940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3219943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3219946">return</span>&nbsp;<span class="ident" id="3219953">err</span><br>
<span class="lineno"></span><span class="op" id="3219957">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">580</span><span class="comment" id="3219960">//&nbsp;Encode&nbsp;encodes&nbsp;the&nbsp;values&nbsp;into&nbsp;``URL&nbsp;encoded&#39;&#39;&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="3220015">//&nbsp;(&#34;bar=baz&amp;foo=quux&#34;)&nbsp;sorted&nbsp;by&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="3220054">func</span>&nbsp;<span class="op" id="3220059">(</span><span class="ident" id="3220060">v</span>&nbsp;<span class="ident" id="3220062">Values</span><span class="op" id="3220068">)</span>&nbsp;<span class="ident" id="3220070">Encode</span><span class="op" id="3220076">(</span><span class="op" id="3220077">)</span>&nbsp;<span class="builtintype" id="3220079">string</span>&nbsp;<span class="op" id="3220086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3220089">if</span>&nbsp;<span class="ident" id="3220092">v</span>&nbsp;<span class="op" id="3220094">==</span>&nbsp;<span class="ident" id="3220097">nil</span>&nbsp;<span class="op" id="3220101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3220105">return</span>&nbsp;<span class="string" id="3220112">&#34;&#34;</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3220116">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3220119">var</span>&nbsp;<span class="ident" id="3220123">buf</span>&nbsp;<span class="ident" id="3220127">bytes</span><span class="op" id="3220132">.</span><span class="ident" id="3220133">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3220141">keys</span>&nbsp;<span class="op" id="3220146">:=</span>&nbsp;<span class="builtinfunc" id="3220149">make</span><span class="op" id="3220153">(</span><span class="op" id="3220154">[</span><span class="op" id="3220155">]</span><span class="builtintype" id="3220156">string</span><span class="op" id="3220162">,</span>&nbsp;<span class="num" id="3220164">0</span><span class="op" id="3220165">,</span>&nbsp;<span class="builtinfunc" id="3220167">len</span><span class="op" id="3220170">(</span><span class="ident" id="3220171">v</span><span class="op" id="3220172">)</span><span class="op" id="3220173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3220176">for</span>&nbsp;<span class="ident" id="3220180">k</span>&nbsp;<span class="op" id="3220182">:=</span>&nbsp;<span class="keyword" id="3220185">range</span>&nbsp;<span class="ident" id="3220191">v</span>&nbsp;<span class="op" id="3220193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3220197">keys</span>&nbsp;<span class="op" id="3220202">=</span>&nbsp;<span class="builtinfunc" id="3220204">append</span><span class="op" id="3220210">(</span><span class="ident" id="3220211">keys</span><span class="op" id="3220215">,</span>&nbsp;<span class="ident" id="3220217">k</span><span class="op" id="3220218">)</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3220221">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3220224">sort</span><span class="op" id="3220228">.</span><span class="ident" id="3220229">Strings</span><span class="op" id="3220236">(</span><span class="ident" id="3220237">keys</span><span class="op" id="3220241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3220244">for</span>&nbsp;<span class="ident" id="3220248">_</span><span class="op" id="3220249">,</span>&nbsp;<span class="ident" id="3220251">k</span>&nbsp;<span class="op" id="3220253">:=</span>&nbsp;<span class="keyword" id="3220256">range</span>&nbsp;<span class="ident" id="3220262">keys</span>&nbsp;<span class="op" id="3220267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3220271">vs</span>&nbsp;<span class="op" id="3220274">:=</span>&nbsp;<span class="ident" id="3220277">v</span><span class="op" id="3220278">[</span><span class="ident" id="3220279">k</span><span class="op" id="3220280">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3220284">prefix</span>&nbsp;<span class="op" id="3220291">:=</span>&nbsp;<span class="ident" id="3220294">QueryEscape</span><span class="op" id="3220305">(</span><span class="ident" id="3220306">k</span><span class="op" id="3220307">)</span>&nbsp;<span class="op" id="3220309">+</span>&nbsp;<span class="string" id="3220311">&#34;=&#34;</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3220317">for</span>&nbsp;<span class="ident" id="3220321">_</span><span class="op" id="3220322">,</span>&nbsp;<span class="ident" id="3220324">v</span>&nbsp;<span class="op" id="3220326">:=</span>&nbsp;<span class="keyword" id="3220329">range</span>&nbsp;<span class="ident" id="3220335">vs</span>&nbsp;<span class="op" id="3220338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3220343">if</span>&nbsp;<span class="ident" id="3220346">buf</span><span class="op" id="3220349">.</span><span class="ident" id="3220350">Len</span><span class="op" id="3220353">(</span><span class="op" id="3220354">)</span>&nbsp;<span class="op" id="3220356">&gt;</span>&nbsp;<span class="num" id="3220358">0</span>&nbsp;<span class="op" id="3220360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3220366">buf</span><span class="op" id="3220369">.</span><span class="ident" id="3220370">WriteByte</span><span class="op" id="3220379">(</span><span class="string" id="3220380">&#39;&amp;&#39;</span><span class="op" id="3220383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3220388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3220393">buf</span><span class="op" id="3220396">.</span><span class="ident" id="3220397">WriteString</span><span class="op" id="3220408">(</span><span class="ident" id="3220409">prefix</span><span class="op" id="3220415">)</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3220420">buf</span><span class="op" id="3220423">.</span><span class="ident" id="3220424">WriteString</span><span class="op" id="3220435">(</span><span class="ident" id="3220436">QueryEscape</span><span class="op" id="3220447">(</span><span class="ident" id="3220448">v</span><span class="op" id="3220449">)</span><span class="op" id="3220450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3220454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3220457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3220460">return</span>&nbsp;<span class="ident" id="3220467">buf</span><span class="op" id="3220470">.</span><span class="ident" id="3220471">String</span><span class="op" id="3220477">(</span><span class="op" id="3220478">)</span><br>
<span class="lineno"></span><span class="op" id="3220480">}</span><br>
<span class="lineno">605</span><br>
<span class="lineno"></span><span class="comment" id="3220483">//&nbsp;resolvePath&nbsp;applies&nbsp;special&nbsp;path&nbsp;segments&nbsp;from&nbsp;refs&nbsp;and&nbsp;applies</span><br>
<span class="lineno"></span><span class="comment" id="3220550">//&nbsp;them&nbsp;to&nbsp;base,&nbsp;per&nbsp;RFC&nbsp;3986.</span><br>
<span class="lineno"></span><span class="keyword" id="3220581">func</span>&nbsp;<span class="ident" id="3220586">resolvePath</span><span class="op" id="3220597">(</span><span class="ident" id="3220598">base</span><span class="op" id="3220602">,</span>&nbsp;<span class="ident" id="3220604">ref</span>&nbsp;<span class="builtintype" id="3220608">string</span><span class="op" id="3220614">)</span>&nbsp;<span class="builtintype" id="3220616">string</span>&nbsp;<span class="op" id="3220623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3220626">var</span>&nbsp;<span class="ident" id="3220630">full</span>&nbsp;<span class="builtintype" id="3220635">string</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3220643">if</span>&nbsp;<span class="ident" id="3220646">ref</span>&nbsp;<span class="op" id="3220650">==</span>&nbsp;<span class="string" id="3220653">&#34;&#34;</span>&nbsp;<span class="op" id="3220656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3220660">full</span>&nbsp;<span class="op" id="3220665">=</span>&nbsp;<span class="ident" id="3220667">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3220673">}</span>&nbsp;<span class="keyword" id="3220675">else</span>&nbsp;<span class="keyword" id="3220680">if</span>&nbsp;<span class="ident" id="3220683">ref</span><span class="op" id="3220686">[</span><span class="num" id="3220687">0</span><span class="op" id="3220688">]</span>&nbsp;<span class="op" id="3220690">!=</span>&nbsp;<span class="string" id="3220693">&#39;/&#39;</span>&nbsp;<span class="op" id="3220697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3220701">i</span>&nbsp;<span class="op" id="3220703">:=</span>&nbsp;<span class="ident" id="3220706">strings</span><span class="op" id="3220713">.</span><span class="ident" id="3220714">LastIndex</span><span class="op" id="3220723">(</span><span class="ident" id="3220724">base</span><span class="op" id="3220728">,</span>&nbsp;<span class="string" id="3220730">&#34;/&#34;</span><span class="op" id="3220733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3220737">full</span>&nbsp;<span class="op" id="3220742">=</span>&nbsp;<span class="ident" id="3220744">base</span><span class="op" id="3220748">[</span><span class="op" id="3220749">:</span><span class="ident" id="3220750">i</span><span class="op" id="3220751">+</span><span class="num" id="3220752">1</span><span class="op" id="3220753">]</span>&nbsp;<span class="op" id="3220755">+</span>&nbsp;<span class="ident" id="3220757">ref</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3220762">}</span>&nbsp;<span class="keyword" id="3220764">else</span>&nbsp;<span class="op" id="3220769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3220773">full</span>&nbsp;<span class="op" id="3220778">=</span>&nbsp;<span class="ident" id="3220780">ref</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3220785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3220788">if</span>&nbsp;<span class="ident" id="3220791">full</span>&nbsp;<span class="op" id="3220796">==</span>&nbsp;<span class="string" id="3220799">&#34;&#34;</span>&nbsp;<span class="op" id="3220802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3220806">return</span>&nbsp;<span class="string" id="3220813">&#34;&#34;</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3220817">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3220820">var</span>&nbsp;<span class="ident" id="3220824">dst</span>&nbsp;<span class="op" id="3220828">[</span><span class="op" id="3220829">]</span><span class="builtintype" id="3220830">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3220838">src</span>&nbsp;<span class="op" id="3220842">:=</span>&nbsp;<span class="ident" id="3220845">strings</span><span class="op" id="3220852">.</span><span class="ident" id="3220853">Split</span><span class="op" id="3220858">(</span><span class="ident" id="3220859">full</span><span class="op" id="3220863">,</span>&nbsp;<span class="string" id="3220865">&#34;/&#34;</span><span class="op" id="3220868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3220871">for</span>&nbsp;<span class="ident" id="3220875">_</span><span class="op" id="3220876">,</span>&nbsp;<span class="ident" id="3220878">elem</span>&nbsp;<span class="op" id="3220883">:=</span>&nbsp;<span class="keyword" id="3220886">range</span>&nbsp;<span class="ident" id="3220892">src</span>&nbsp;<span class="op" id="3220896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3220900">switch</span>&nbsp;<span class="ident" id="3220907">elem</span>&nbsp;<span class="op" id="3220912">{</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3220916">case</span>&nbsp;<span class="string" id="3220921">&#34;.&#34;</span><span class="op" id="3220924">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3220929">//&nbsp;drop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3220939">case</span>&nbsp;<span class="string" id="3220944">&#34;..&#34;</span><span class="op" id="3220948">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3220953">if</span>&nbsp;<span class="builtinfunc" id="3220956">len</span><span class="op" id="3220959">(</span><span class="ident" id="3220960">dst</span><span class="op" id="3220963">)</span>&nbsp;<span class="op" id="3220965">&gt;</span>&nbsp;<span class="num" id="3220967">0</span>&nbsp;<span class="op" id="3220969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3220975">dst</span>&nbsp;<span class="op" id="3220979">=</span>&nbsp;<span class="ident" id="3220981">dst</span><span class="op" id="3220984">[</span><span class="op" id="3220985">:</span><span class="builtinfunc" id="3220986">len</span><span class="op" id="3220989">(</span><span class="ident" id="3220990">dst</span><span class="op" id="3220993">)</span><span class="op" id="3220994">-</span><span class="num" id="3220995">1</span><span class="op" id="3220996">]</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3221001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3221005">default</span><span class="op" id="3221012">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3221017">dst</span>&nbsp;<span class="op" id="3221021">=</span>&nbsp;<span class="builtinfunc" id="3221023">append</span><span class="op" id="3221029">(</span><span class="ident" id="3221030">dst</span><span class="op" id="3221033">,</span>&nbsp;<span class="ident" id="3221035">elem</span><span class="op" id="3221039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3221043">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3221046">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3221049">if</span>&nbsp;<span class="ident" id="3221052">last</span>&nbsp;<span class="op" id="3221057">:=</span>&nbsp;<span class="ident" id="3221060">src</span><span class="op" id="3221063">[</span><span class="builtinfunc" id="3221064">len</span><span class="op" id="3221067">(</span><span class="ident" id="3221068">src</span><span class="op" id="3221071">)</span><span class="op" id="3221072">-</span><span class="num" id="3221073">1</span><span class="op" id="3221074">]</span><span class="op" id="3221075">;</span>&nbsp;<span class="ident" id="3221077">last</span>&nbsp;<span class="op" id="3221082">==</span>&nbsp;<span class="string" id="3221085">&#34;.&#34;</span>&nbsp;<span class="op" id="3221089">||</span>&nbsp;<span class="ident" id="3221092">last</span>&nbsp;<span class="op" id="3221097">==</span>&nbsp;<span class="string" id="3221100">&#34;..&#34;</span>&nbsp;<span class="op" id="3221105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3221109">//&nbsp;Add&nbsp;final&nbsp;slash&nbsp;to&nbsp;the&nbsp;joined&nbsp;path.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3221150">dst</span>&nbsp;<span class="op" id="3221154">=</span>&nbsp;<span class="builtinfunc" id="3221156">append</span><span class="op" id="3221162">(</span><span class="ident" id="3221163">dst</span><span class="op" id="3221166">,</span>&nbsp;<span class="string" id="3221168">&#34;&#34;</span><span class="op" id="3221170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3221173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3221176">return</span>&nbsp;<span class="string" id="3221183">&#34;/&#34;</span>&nbsp;<span class="op" id="3221187">+</span>&nbsp;<span class="ident" id="3221189">strings</span><span class="op" id="3221196">.</span><span class="ident" id="3221197">TrimLeft</span><span class="op" id="3221205">(</span><span class="ident" id="3221206">strings</span><span class="op" id="3221213">.</span><span class="ident" id="3221214">Join</span><span class="op" id="3221218">(</span><span class="ident" id="3221219">dst</span><span class="op" id="3221222">,</span>&nbsp;<span class="string" id="3221224">&#34;/&#34;</span><span class="op" id="3221227">)</span><span class="op" id="3221228">,</span>&nbsp;<span class="string" id="3221230">&#34;/&#34;</span><span class="op" id="3221233">)</span><br>
<span class="lineno">640</span><span class="op" id="3221235">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3221238">//&nbsp;IsAbs&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;URL&nbsp;is&nbsp;absolute.</span><br>
<span class="lineno"></span><span class="keyword" id="3221284">func</span>&nbsp;<span class="op" id="3221289">(</span><span class="ident" id="3221290">u</span>&nbsp;<span class="op" id="3221292">*</span><span class="ident" id="3221293">URL</span><span class="op" id="3221296">)</span>&nbsp;<span class="ident" id="3221298">IsAbs</span><span class="op" id="3221303">(</span><span class="op" id="3221304">)</span>&nbsp;<span class="builtintype" id="3221306">bool</span>&nbsp;<span class="op" id="3221311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3221314">return</span>&nbsp;<span class="ident" id="3221321">u</span><span class="op" id="3221322">.</span><span class="ident" id="3221323">Scheme</span>&nbsp;<span class="op" id="3221330">!=</span>&nbsp;<span class="string" id="3221333">&#34;&#34;</span><br>
<span class="lineno">645</span><span class="op" id="3221336">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3221339">//&nbsp;Parse&nbsp;parses&nbsp;a&nbsp;URL&nbsp;in&nbsp;the&nbsp;context&nbsp;of&nbsp;the&nbsp;receiver.&nbsp;&nbsp;The&nbsp;provided&nbsp;URL</span><br>
<span class="lineno"></span><span class="comment" id="3221411">//&nbsp;may&nbsp;be&nbsp;relative&nbsp;or&nbsp;absolute.&nbsp;&nbsp;Parse&nbsp;returns&nbsp;nil,&nbsp;err&nbsp;on&nbsp;parse</span><br>
<span class="lineno"></span><span class="comment" id="3221476">//&nbsp;failure,&nbsp;otherwise&nbsp;its&nbsp;return&nbsp;value&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;ResolveReference.</span><br>
<span class="lineno">650</span><span class="keyword" id="3221548">func</span>&nbsp;<span class="op" id="3221553">(</span><span class="ident" id="3221554">u</span>&nbsp;<span class="op" id="3221556">*</span><span class="ident" id="3221557">URL</span><span class="op" id="3221560">)</span>&nbsp;<span class="ident" id="3221562">Parse</span><span class="op" id="3221567">(</span><span class="ident" id="3221568">ref</span>&nbsp;<span class="builtintype" id="3221572">string</span><span class="op" id="3221578">)</span>&nbsp;<span class="op" id="3221580">(</span><span class="op" id="3221581">*</span><span class="ident" id="3221582">URL</span><span class="op" id="3221585">,</span>&nbsp;<span class="builtintype" id="3221587">error</span><span class="op" id="3221592">)</span>&nbsp;<span class="op" id="3221594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3221597">refurl</span><span class="op" id="3221603">,</span>&nbsp;<span class="ident" id="3221605">err</span>&nbsp;<span class="op" id="3221609">:=</span>&nbsp;<span class="ident" id="3221612">Parse</span><span class="op" id="3221617">(</span><span class="ident" id="3221618">ref</span><span class="op" id="3221621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3221624">if</span>&nbsp;<span class="ident" id="3221627">err</span>&nbsp;<span class="op" id="3221631">!=</span>&nbsp;<span class="ident" id="3221634">nil</span>&nbsp;<span class="op" id="3221638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3221642">return</span>&nbsp;<span class="ident" id="3221649">nil</span><span class="op" id="3221652">,</span>&nbsp;<span class="ident" id="3221654">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3221659">}</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3221662">return</span>&nbsp;<span class="ident" id="3221669">u</span><span class="op" id="3221670">.</span><span class="ident" id="3221671">ResolveReference</span><span class="op" id="3221687">(</span><span class="ident" id="3221688">refurl</span><span class="op" id="3221694">)</span><span class="op" id="3221695">,</span>&nbsp;<span class="ident" id="3221697">nil</span><br>
<span class="lineno"></span><span class="op" id="3221701">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3221704">//&nbsp;ResolveReference&nbsp;resolves&nbsp;a&nbsp;URI&nbsp;reference&nbsp;to&nbsp;an&nbsp;absolute&nbsp;URI&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="3221773">//&nbsp;an&nbsp;absolute&nbsp;base&nbsp;URI,&nbsp;per&nbsp;RFC&nbsp;3986&nbsp;Section&nbsp;5.2.&nbsp;&nbsp;The&nbsp;URI&nbsp;reference</span><br>
<span class="lineno">660</span><span class="comment" id="3221843">//&nbsp;may&nbsp;be&nbsp;relative&nbsp;or&nbsp;absolute.&nbsp;&nbsp;ResolveReference&nbsp;always&nbsp;returns&nbsp;a&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="3221914">//&nbsp;URL&nbsp;instance,&nbsp;even&nbsp;if&nbsp;the&nbsp;returned&nbsp;URL&nbsp;is&nbsp;identical&nbsp;to&nbsp;either&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3221983">//&nbsp;base&nbsp;or&nbsp;reference.&nbsp;If&nbsp;ref&nbsp;is&nbsp;an&nbsp;absolute&nbsp;URL,&nbsp;then&nbsp;ResolveReference</span><br>
<span class="lineno"></span><span class="comment" id="3222054">//&nbsp;ignores&nbsp;base&nbsp;and&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;ref.</span><br>
<span class="lineno"></span><span class="keyword" id="3222097">func</span>&nbsp;<span class="op" id="3222102">(</span><span class="ident" id="3222103">u</span>&nbsp;<span class="op" id="3222105">*</span><span class="ident" id="3222106">URL</span><span class="op" id="3222109">)</span>&nbsp;<span class="ident" id="3222111">ResolveReference</span><span class="op" id="3222127">(</span><span class="ident" id="3222128">ref</span>&nbsp;<span class="op" id="3222132">*</span><span class="ident" id="3222133">URL</span><span class="op" id="3222136">)</span>&nbsp;<span class="op" id="3222138">*</span><span class="ident" id="3222139">URL</span>&nbsp;<span class="op" id="3222143">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3222146">url</span>&nbsp;<span class="op" id="3222150">:=</span>&nbsp;<span class="op" id="3222153">*</span><span class="ident" id="3222154">ref</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3222159">if</span>&nbsp;<span class="ident" id="3222162">ref</span><span class="op" id="3222165">.</span><span class="ident" id="3222166">Scheme</span>&nbsp;<span class="op" id="3222173">==</span>&nbsp;<span class="string" id="3222176">&#34;&#34;</span>&nbsp;<span class="op" id="3222179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3222183">url</span><span class="op" id="3222186">.</span><span class="ident" id="3222187">Scheme</span>&nbsp;<span class="op" id="3222194">=</span>&nbsp;<span class="ident" id="3222196">u</span><span class="op" id="3222197">.</span><span class="ident" id="3222198">Scheme</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3222206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3222209">if</span>&nbsp;<span class="ident" id="3222212">ref</span><span class="op" id="3222215">.</span><span class="ident" id="3222216">Scheme</span>&nbsp;<span class="op" id="3222223">!=</span>&nbsp;<span class="string" id="3222226">&#34;&#34;</span>&nbsp;<span class="op" id="3222229">||</span>&nbsp;<span class="ident" id="3222232">ref</span><span class="op" id="3222235">.</span><span class="ident" id="3222236">Host</span>&nbsp;<span class="op" id="3222241">!=</span>&nbsp;<span class="string" id="3222244">&#34;&#34;</span>&nbsp;<span class="op" id="3222247">||</span>&nbsp;<span class="ident" id="3222250">ref</span><span class="op" id="3222253">.</span><span class="ident" id="3222254">User</span>&nbsp;<span class="op" id="3222259">!=</span>&nbsp;<span class="ident" id="3222262">nil</span>&nbsp;<span class="op" id="3222266">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3222270">//&nbsp;The&nbsp;&#34;absoluteURI&#34;&nbsp;or&nbsp;&#34;net_path&#34;&nbsp;cases.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3222314">url</span><span class="op" id="3222317">.</span><span class="ident" id="3222318">Path</span>&nbsp;<span class="op" id="3222323">=</span>&nbsp;<span class="ident" id="3222325">resolvePath</span><span class="op" id="3222336">(</span><span class="ident" id="3222337">ref</span><span class="op" id="3222340">.</span><span class="ident" id="3222341">Path</span><span class="op" id="3222345">,</span>&nbsp;<span class="string" id="3222347">&#34;&#34;</span><span class="op" id="3222349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3222353">return</span>&nbsp;<span class="op" id="3222360">&amp;</span><span class="ident" id="3222361">url</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3222366">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3222369">if</span>&nbsp;<span class="ident" id="3222372">ref</span><span class="op" id="3222375">.</span><span class="ident" id="3222376">Opaque</span>&nbsp;<span class="op" id="3222383">!=</span>&nbsp;<span class="string" id="3222386">&#34;&#34;</span>&nbsp;<span class="op" id="3222389">{</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3222393">url</span><span class="op" id="3222396">.</span><span class="ident" id="3222397">User</span>&nbsp;<span class="op" id="3222402">=</span>&nbsp;<span class="ident" id="3222404">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3222410">url</span><span class="op" id="3222413">.</span><span class="ident" id="3222414">Host</span>&nbsp;<span class="op" id="3222419">=</span>&nbsp;<span class="string" id="3222421">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3222426">url</span><span class="op" id="3222429">.</span><span class="ident" id="3222430">Path</span>&nbsp;<span class="op" id="3222435">=</span>&nbsp;<span class="string" id="3222437">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3222442">return</span>&nbsp;<span class="op" id="3222449">&amp;</span><span class="ident" id="3222450">url</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3222455">}</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3222458">if</span>&nbsp;<span class="ident" id="3222461">ref</span><span class="op" id="3222464">.</span><span class="ident" id="3222465">Path</span>&nbsp;<span class="op" id="3222470">==</span>&nbsp;<span class="string" id="3222473">&#34;&#34;</span>&nbsp;<span class="op" id="3222476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3222480">if</span>&nbsp;<span class="ident" id="3222483">ref</span><span class="op" id="3222486">.</span><span class="ident" id="3222487">RawQuery</span>&nbsp;<span class="op" id="3222496">==</span>&nbsp;<span class="string" id="3222499">&#34;&#34;</span>&nbsp;<span class="op" id="3222502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3222507">url</span><span class="op" id="3222510">.</span><span class="ident" id="3222511">RawQuery</span>&nbsp;<span class="op" id="3222520">=</span>&nbsp;<span class="ident" id="3222522">u</span><span class="op" id="3222523">.</span><span class="ident" id="3222524">RawQuery</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3222536">if</span>&nbsp;<span class="ident" id="3222539">ref</span><span class="op" id="3222542">.</span><span class="ident" id="3222543">Fragment</span>&nbsp;<span class="op" id="3222552">==</span>&nbsp;<span class="string" id="3222555">&#34;&#34;</span>&nbsp;<span class="op" id="3222558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3222564">url</span><span class="op" id="3222567">.</span><span class="ident" id="3222568">Fragment</span>&nbsp;<span class="op" id="3222577">=</span>&nbsp;<span class="ident" id="3222579">u</span><span class="op" id="3222580">.</span><span class="ident" id="3222581">Fragment</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3222593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3222597">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3222600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3222603">//&nbsp;The&nbsp;&#34;abs_path&#34;&nbsp;or&nbsp;&#34;rel_path&#34;&nbsp;cases.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3222643">url</span><span class="op" id="3222646">.</span><span class="ident" id="3222647">Host</span>&nbsp;<span class="op" id="3222652">=</span>&nbsp;<span class="ident" id="3222654">u</span><span class="op" id="3222655">.</span><span class="ident" id="3222656">Host</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3222662">url</span><span class="op" id="3222665">.</span><span class="ident" id="3222666">User</span>&nbsp;<span class="op" id="3222671">=</span>&nbsp;<span class="ident" id="3222673">u</span><span class="op" id="3222674">.</span><span class="ident" id="3222675">User</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3222681">url</span><span class="op" id="3222684">.</span><span class="ident" id="3222685">Path</span>&nbsp;<span class="op" id="3222690">=</span>&nbsp;<span class="ident" id="3222692">resolvePath</span><span class="op" id="3222703">(</span><span class="ident" id="3222704">u</span><span class="op" id="3222705">.</span><span class="ident" id="3222706">Path</span><span class="op" id="3222710">,</span>&nbsp;<span class="ident" id="3222712">ref</span><span class="op" id="3222715">.</span><span class="ident" id="3222716">Path</span><span class="op" id="3222720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3222723">return</span>&nbsp;<span class="op" id="3222730">&amp;</span><span class="ident" id="3222731">url</span><br>
<span class="lineno"></span><span class="op" id="3222735">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">695</span><span class="comment" id="3222738">//&nbsp;Query&nbsp;parses&nbsp;RawQuery&nbsp;and&nbsp;returns&nbsp;the&nbsp;corresponding&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="3222801">func</span>&nbsp;<span class="op" id="3222806">(</span><span class="ident" id="3222807">u</span>&nbsp;<span class="op" id="3222809">*</span><span class="ident" id="3222810">URL</span><span class="op" id="3222813">)</span>&nbsp;<span class="ident" id="3222815">Query</span><span class="op" id="3222820">(</span><span class="op" id="3222821">)</span>&nbsp;<span class="ident" id="3222823">Values</span>&nbsp;<span class="op" id="3222830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3222833">v</span><span class="op" id="3222834">,</span>&nbsp;<span class="ident" id="3222836">_</span>&nbsp;<span class="op" id="3222838">:=</span>&nbsp;<span class="ident" id="3222841">ParseQuery</span><span class="op" id="3222851">(</span><span class="ident" id="3222852">u</span><span class="op" id="3222853">.</span><span class="ident" id="3222854">RawQuery</span><span class="op" id="3222862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3222865">return</span>&nbsp;<span class="ident" id="3222872">v</span><br>
<span class="lineno"></span><span class="op" id="3222874">}</span><br>
<span class="lineno">700</span><br>
<span class="lineno"></span><span class="comment" id="3222877">//&nbsp;RequestURI&nbsp;returns&nbsp;the&nbsp;encoded&nbsp;path?query&nbsp;or&nbsp;opaque?query</span><br>
<span class="lineno"></span><span class="comment" id="3222938">//&nbsp;string&nbsp;that&nbsp;would&nbsp;be&nbsp;used&nbsp;in&nbsp;an&nbsp;HTTP&nbsp;request&nbsp;for&nbsp;u.</span><br>
<span class="lineno"></span><span class="keyword" id="3222993">func</span>&nbsp;<span class="op" id="3222998">(</span><span class="ident" id="3222999">u</span>&nbsp;<span class="op" id="3223001">*</span><span class="ident" id="3223002">URL</span><span class="op" id="3223005">)</span>&nbsp;<span class="ident" id="3223007">RequestURI</span><span class="op" id="3223017">(</span><span class="op" id="3223018">)</span>&nbsp;<span class="builtintype" id="3223020">string</span>&nbsp;<span class="op" id="3223027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3223030">result</span>&nbsp;<span class="op" id="3223037">:=</span>&nbsp;<span class="ident" id="3223040">u</span><span class="op" id="3223041">.</span><span class="ident" id="3223042">Opaque</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3223050">if</span>&nbsp;<span class="ident" id="3223053">result</span>&nbsp;<span class="op" id="3223060">==</span>&nbsp;<span class="string" id="3223063">&#34;&#34;</span>&nbsp;<span class="op" id="3223066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3223070">result</span>&nbsp;<span class="op" id="3223077">=</span>&nbsp;<span class="ident" id="3223079">escape</span><span class="op" id="3223085">(</span><span class="ident" id="3223086">u</span><span class="op" id="3223087">.</span><span class="ident" id="3223088">Path</span><span class="op" id="3223092">,</span>&nbsp;<span class="ident" id="3223094">encodePath</span><span class="op" id="3223104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3223108">if</span>&nbsp;<span class="ident" id="3223111">result</span>&nbsp;<span class="op" id="3223118">==</span>&nbsp;<span class="string" id="3223121">&#34;&#34;</span>&nbsp;<span class="op" id="3223124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3223129">result</span>&nbsp;<span class="op" id="3223136">=</span>&nbsp;<span class="string" id="3223138">&#34;/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3223144">}</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3223147">}</span>&nbsp;<span class="keyword" id="3223149">else</span>&nbsp;<span class="op" id="3223154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3223158">if</span>&nbsp;<span class="ident" id="3223161">strings</span><span class="op" id="3223168">.</span><span class="ident" id="3223169">HasPrefix</span><span class="op" id="3223178">(</span><span class="ident" id="3223179">result</span><span class="op" id="3223185">,</span>&nbsp;<span class="string" id="3223187">&#34;//&#34;</span><span class="op" id="3223191">)</span>&nbsp;<span class="op" id="3223193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3223198">result</span>&nbsp;<span class="op" id="3223205">=</span>&nbsp;<span class="ident" id="3223207">u</span><span class="op" id="3223208">.</span><span class="ident" id="3223209">Scheme</span>&nbsp;<span class="op" id="3223216">+</span>&nbsp;<span class="string" id="3223218">&#34;:&#34;</span>&nbsp;<span class="op" id="3223222">+</span>&nbsp;<span class="ident" id="3223224">result</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3223233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3223236">}</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3223239">if</span>&nbsp;<span class="ident" id="3223242">u</span><span class="op" id="3223243">.</span><span class="ident" id="3223244">RawQuery</span>&nbsp;<span class="op" id="3223253">!=</span>&nbsp;<span class="string" id="3223256">&#34;&#34;</span>&nbsp;<span class="op" id="3223259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3223263">result</span>&nbsp;<span class="op" id="3223270">+=</span>&nbsp;<span class="string" id="3223273">&#34;?&#34;</span>&nbsp;<span class="op" id="3223277">+</span>&nbsp;<span class="ident" id="3223279">u</span><span class="op" id="3223280">.</span><span class="ident" id="3223281">RawQuery</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3223291">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3223294">return</span>&nbsp;<span class="ident" id="3223301">result</span><br>
<span class="lineno"></span><span class="op" id="3223308">}</span>
</div>
</body>
</html>
