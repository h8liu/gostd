<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/base64</h2>
<ul>
<li><a href="/gostd/encoding/base64/base64.go.html" class="current">base64.go</a></li>
<li><a href="/gostd/encoding/base64/base64_test.go.html">base64_test.go</a></li>
<li><a href="/gostd/encoding/base64/example_test.go.html">example_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2871441">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2871496">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2871550">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2871601">//&nbsp;Package&nbsp;base64&nbsp;implements&nbsp;base64&nbsp;encoding&nbsp;as&nbsp;specified&nbsp;by&nbsp;RFC&nbsp;4648.</span><br>
<span class="lineno"></span><span class="keyword" id="2871672">package</span>&nbsp;<span class="ident" id="2871680">base64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2871688">import</span>&nbsp;<span class="op" id="2871695">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2871698">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2871707">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2871713">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2871724">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="2871734">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="2871737">/*<br>
<span class="lineno"></span>&nbsp;*&nbsp;Encodings<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2871758">//&nbsp;An&nbsp;Encoding&nbsp;is&nbsp;a&nbsp;radix&nbsp;64&nbsp;encoding/decoding&nbsp;scheme,&nbsp;defined&nbsp;by&nbsp;a</span><br>
<span class="lineno">20</span><span class="comment" id="2871826">//&nbsp;64-character&nbsp;alphabet.&nbsp;&nbsp;The&nbsp;most&nbsp;common&nbsp;encoding&nbsp;is&nbsp;the&nbsp;&#34;base64&#34;</span><br>
<span class="lineno"></span><span class="comment" id="2871894">//&nbsp;encoding&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;4648&nbsp;and&nbsp;used&nbsp;in&nbsp;MIME&nbsp;(RFC&nbsp;2045)&nbsp;and&nbsp;PEM</span><br>
<span class="lineno"></span><span class="comment" id="2871962">//&nbsp;(RFC&nbsp;1421).&nbsp;&nbsp;RFC&nbsp;4648&nbsp;also&nbsp;defines&nbsp;an&nbsp;alternate&nbsp;encoding,&nbsp;which&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2872032">//&nbsp;the&nbsp;standard&nbsp;encoding&nbsp;with&nbsp;-&nbsp;and&nbsp;_&nbsp;substituted&nbsp;for&nbsp;+&nbsp;and&nbsp;/.</span><br>
<span class="lineno"></span><span class="keyword" id="2872095">type</span>&nbsp;<span class="ident" id="2872100">Encoding</span>&nbsp;<span class="keyword" id="2872109">struct</span>&nbsp;<span class="op" id="2872116">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2872119">encode</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2872129">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2872137">decodeMap</span>&nbsp;<span class="op" id="2872147">[</span><span class="num" id="2872148">256</span><span class="op" id="2872151">]</span><span class="builtintype" id="2872152">byte</span><br>
<span class="lineno"></span><span class="op" id="2872157">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2872160">const</span>&nbsp;<span class="ident" id="2872166">encodeStd</span>&nbsp;<span class="op" id="2872176">=</span>&nbsp;<span class="string" id="2872178">&#34;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#34;</span><br>
<span class="lineno">30</span><span class="keyword" id="2872245">const</span>&nbsp;<span class="ident" id="2872251">encodeURL</span>&nbsp;<span class="op" id="2872261">=</span>&nbsp;<span class="string" id="2872263">&#34;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2872331">//&nbsp;NewEncoding&nbsp;returns&nbsp;a&nbsp;new&nbsp;Encoding&nbsp;defined&nbsp;by&nbsp;the&nbsp;given&nbsp;alphabet,</span><br>
<span class="lineno"></span><span class="comment" id="2872400">//&nbsp;which&nbsp;must&nbsp;be&nbsp;a&nbsp;64-byte&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="2872435">func</span>&nbsp;<span class="ident" id="2872440">NewEncoding</span><span class="op" id="2872451">(</span><span class="ident" id="2872452">encoder</span>&nbsp;<span class="builtintype" id="2872460">string</span><span class="op" id="2872466">)</span>&nbsp;<span class="op" id="2872468">*</span><span class="ident" id="2872469">Encoding</span>&nbsp;<span class="op" id="2872478">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2872481">e</span>&nbsp;<span class="op" id="2872483">:=</span>&nbsp;<span class="builtinfunc" id="2872486">new</span><span class="op" id="2872489">(</span><span class="ident" id="2872490">Encoding</span><span class="op" id="2872498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2872501">e</span><span class="op" id="2872502">.</span><span class="ident" id="2872503">encode</span>&nbsp;<span class="op" id="2872510">=</span>&nbsp;<span class="ident" id="2872512">encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2872521">for</span>&nbsp;<span class="ident" id="2872525">i</span>&nbsp;<span class="op" id="2872527">:=</span>&nbsp;<span class="num" id="2872530">0</span><span class="op" id="2872531">;</span>&nbsp;<span class="ident" id="2872533">i</span>&nbsp;<span class="op" id="2872535">&lt;</span>&nbsp;<span class="builtinfunc" id="2872537">len</span><span class="op" id="2872540">(</span><span class="ident" id="2872541">e</span><span class="op" id="2872542">.</span><span class="ident" id="2872543">decodeMap</span><span class="op" id="2872552">)</span><span class="op" id="2872553">;</span>&nbsp;<span class="ident" id="2872555">i</span><span class="op" id="2872556">++</span>&nbsp;<span class="op" id="2872559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2872563">e</span><span class="op" id="2872564">.</span><span class="ident" id="2872565">decodeMap</span><span class="op" id="2872574">[</span><span class="ident" id="2872575">i</span><span class="op" id="2872576">]</span>&nbsp;<span class="op" id="2872578">=</span>&nbsp;<span class="num" id="2872580">0xFF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2872586">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2872589">for</span>&nbsp;<span class="ident" id="2872593">i</span>&nbsp;<span class="op" id="2872595">:=</span>&nbsp;<span class="num" id="2872598">0</span><span class="op" id="2872599">;</span>&nbsp;<span class="ident" id="2872601">i</span>&nbsp;<span class="op" id="2872603">&lt;</span>&nbsp;<span class="builtinfunc" id="2872605">len</span><span class="op" id="2872608">(</span><span class="ident" id="2872609">encoder</span><span class="op" id="2872616">)</span><span class="op" id="2872617">;</span>&nbsp;<span class="ident" id="2872619">i</span><span class="op" id="2872620">++</span>&nbsp;<span class="op" id="2872623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2872627">e</span><span class="op" id="2872628">.</span><span class="ident" id="2872629">decodeMap</span><span class="op" id="2872638">[</span><span class="ident" id="2872639">encoder</span><span class="op" id="2872646">[</span><span class="ident" id="2872647">i</span><span class="op" id="2872648">]</span><span class="op" id="2872649">]</span>&nbsp;<span class="op" id="2872651">=</span>&nbsp;<span class="builtintype" id="2872653">byte</span><span class="op" id="2872657">(</span><span class="ident" id="2872658">i</span><span class="op" id="2872659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2872662">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2872665">return</span>&nbsp;<span class="ident" id="2872672">e</span><br>
<span class="lineno"></span><span class="op" id="2872674">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="2872677">//&nbsp;StdEncoding&nbsp;is&nbsp;the&nbsp;standard&nbsp;base64&nbsp;encoding,&nbsp;as&nbsp;defined&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="2872739">//&nbsp;RFC&nbsp;4648.</span><br>
<span class="lineno"></span><span class="keyword" id="2872752">var</span>&nbsp;<span class="ident" id="2872756">StdEncoding</span>&nbsp;<span class="op" id="2872768">=</span>&nbsp;<span class="ident" id="2872770">NewEncoding</span><span class="op" id="2872781">(</span><span class="ident" id="2872782">encodeStd</span><span class="op" id="2872791">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="2872794">//&nbsp;URLEncoding&nbsp;is&nbsp;the&nbsp;alternate&nbsp;base64&nbsp;encoding&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;4648.</span><br>
<span class="lineno"></span><span class="comment" id="2872863">//&nbsp;It&nbsp;is&nbsp;typically&nbsp;used&nbsp;in&nbsp;URLs&nbsp;and&nbsp;file&nbsp;names.</span><br>
<span class="lineno"></span><span class="keyword" id="2872911">var</span>&nbsp;<span class="ident" id="2872915">URLEncoding</span>&nbsp;<span class="op" id="2872927">=</span>&nbsp;<span class="ident" id="2872929">NewEncoding</span><span class="op" id="2872940">(</span><span class="ident" id="2872941">encodeURL</span><span class="op" id="2872950">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2872953">var</span>&nbsp;<span class="ident" id="2872957">removeNewlinesMapper</span>&nbsp;<span class="op" id="2872978">=</span>&nbsp;<span class="keyword" id="2872980">func</span><span class="op" id="2872984">(</span><span class="ident" id="2872985">r</span>&nbsp;<span class="builtintype" id="2872987">rune</span><span class="op" id="2872991">)</span>&nbsp;<span class="builtintype" id="2872993">rune</span>&nbsp;<span class="op" id="2872998">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2873001">if</span>&nbsp;<span class="ident" id="2873004">r</span>&nbsp;<span class="op" id="2873006">==</span>&nbsp;<span class="string" id="2873009">&#39;\r&#39;</span>&nbsp;<span class="op" id="2873014">||</span>&nbsp;<span class="ident" id="2873017">r</span>&nbsp;<span class="op" id="2873019">==</span>&nbsp;<span class="string" id="2873022">&#39;\n&#39;</span>&nbsp;<span class="op" id="2873027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2873031">return</span>&nbsp;<span class="op" id="2873038">-</span><span class="num" id="2873039">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2873042">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2873045">return</span>&nbsp;<span class="ident" id="2873052">r</span><br>
<span class="lineno"></span><span class="op" id="2873054">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="comment" id="2873057">/*<br>
<span class="lineno"></span>&nbsp;*&nbsp;Encoder<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="2873076">//&nbsp;Encode&nbsp;encodes&nbsp;src&nbsp;using&nbsp;the&nbsp;encoding&nbsp;enc,&nbsp;writing</span><br>
<span class="lineno"></span><span class="comment" id="2873130">//&nbsp;EncodedLen(len(src))&nbsp;bytes&nbsp;to&nbsp;dst.</span><br>
<span class="lineno"></span><span class="comment" id="2873168">//</span><br>
<span class="lineno"></span><span class="comment" id="2873171">//&nbsp;The&nbsp;encoding&nbsp;pads&nbsp;the&nbsp;output&nbsp;to&nbsp;a&nbsp;multiple&nbsp;of&nbsp;4&nbsp;bytes,</span><br>
<span class="lineno"></span><span class="comment" id="2873229">//&nbsp;so&nbsp;Encode&nbsp;is&nbsp;not&nbsp;appropriate&nbsp;for&nbsp;use&nbsp;on&nbsp;individual&nbsp;blocks</span><br>
<span class="lineno">70</span><span class="comment" id="2873290">//&nbsp;of&nbsp;a&nbsp;large&nbsp;data&nbsp;stream.&nbsp;&nbsp;Use&nbsp;NewEncoder()&nbsp;instead.</span><br>
<span class="lineno"></span><span class="keyword" id="2873344">func</span>&nbsp;<span class="op" id="2873349">(</span><span class="ident" id="2873350">enc</span>&nbsp;<span class="op" id="2873354">*</span><span class="ident" id="2873355">Encoding</span><span class="op" id="2873363">)</span>&nbsp;<span class="ident" id="2873365">Encode</span><span class="op" id="2873371">(</span><span class="ident" id="2873372">dst</span><span class="op" id="2873375">,</span>&nbsp;<span class="ident" id="2873377">src</span>&nbsp;<span class="op" id="2873381">[</span><span class="op" id="2873382">]</span><span class="builtintype" id="2873383">byte</span><span class="op" id="2873387">)</span>&nbsp;<span class="op" id="2873389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2873392">if</span>&nbsp;<span class="builtinfunc" id="2873395">len</span><span class="op" id="2873398">(</span><span class="ident" id="2873399">src</span><span class="op" id="2873402">)</span>&nbsp;<span class="op" id="2873404">==</span>&nbsp;<span class="num" id="2873407">0</span>&nbsp;<span class="op" id="2873409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2873413">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2873421">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2873425">for</span>&nbsp;<span class="builtinfunc" id="2873429">len</span><span class="op" id="2873432">(</span><span class="ident" id="2873433">src</span><span class="op" id="2873436">)</span>&nbsp;<span class="op" id="2873438">&gt;</span>&nbsp;<span class="num" id="2873440">0</span>&nbsp;<span class="op" id="2873442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2873446">var</span>&nbsp;<span class="ident" id="2873450">b0</span><span class="op" id="2873452">,</span>&nbsp;<span class="ident" id="2873454">b1</span><span class="op" id="2873456">,</span>&nbsp;<span class="ident" id="2873458">b2</span><span class="op" id="2873460">,</span>&nbsp;<span class="ident" id="2873462">b3</span>&nbsp;<span class="builtintype" id="2873465">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2873473">//&nbsp;Unpack&nbsp;4x&nbsp;6-bit&nbsp;source&nbsp;blocks&nbsp;into&nbsp;a&nbsp;4&nbsp;byte</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2873522">//&nbsp;destination&nbsp;quantum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2873547">switch</span>&nbsp;<span class="builtinfunc" id="2873554">len</span><span class="op" id="2873557">(</span><span class="ident" id="2873558">src</span><span class="op" id="2873561">)</span>&nbsp;<span class="op" id="2873563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2873567">default</span><span class="op" id="2873574">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2873579">b3</span>&nbsp;<span class="op" id="2873582">=</span>&nbsp;<span class="ident" id="2873584">src</span><span class="op" id="2873587">[</span><span class="num" id="2873588">2</span><span class="op" id="2873589">]</span>&nbsp;<span class="op" id="2873591">&amp;</span>&nbsp;<span class="num" id="2873593">0x3F</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2873601">b2</span>&nbsp;<span class="op" id="2873604">=</span>&nbsp;<span class="ident" id="2873606">src</span><span class="op" id="2873609">[</span><span class="num" id="2873610">2</span><span class="op" id="2873611">]</span>&nbsp;<span class="op" id="2873613">&gt;&gt;</span>&nbsp;<span class="num" id="2873616">6</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2873621">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2873635">case</span>&nbsp;<span class="num" id="2873640">2</span><span class="op" id="2873641">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2873646">b2</span>&nbsp;<span class="op" id="2873649">|=</span>&nbsp;<span class="op" id="2873652">(</span><span class="ident" id="2873653">src</span><span class="op" id="2873656">[</span><span class="num" id="2873657">1</span><span class="op" id="2873658">]</span>&nbsp;<span class="op" id="2873660">&lt;&lt;</span>&nbsp;<span class="num" id="2873663">2</span><span class="op" id="2873664">)</span>&nbsp;<span class="op" id="2873666">&amp;</span>&nbsp;<span class="num" id="2873668">0x3F</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2873676">b1</span>&nbsp;<span class="op" id="2873679">=</span>&nbsp;<span class="ident" id="2873681">src</span><span class="op" id="2873684">[</span><span class="num" id="2873685">1</span><span class="op" id="2873686">]</span>&nbsp;<span class="op" id="2873688">&gt;&gt;</span>&nbsp;<span class="num" id="2873691">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2873696">fallthrough</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2873710">case</span>&nbsp;<span class="num" id="2873715">1</span><span class="op" id="2873716">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2873721">b1</span>&nbsp;<span class="op" id="2873724">|=</span>&nbsp;<span class="op" id="2873727">(</span><span class="ident" id="2873728">src</span><span class="op" id="2873731">[</span><span class="num" id="2873732">0</span><span class="op" id="2873733">]</span>&nbsp;<span class="op" id="2873735">&lt;&lt;</span>&nbsp;<span class="num" id="2873738">4</span><span class="op" id="2873739">)</span>&nbsp;<span class="op" id="2873741">&amp;</span>&nbsp;<span class="num" id="2873743">0x3F</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2873751">b0</span>&nbsp;<span class="op" id="2873754">=</span>&nbsp;<span class="ident" id="2873756">src</span><span class="op" id="2873759">[</span><span class="num" id="2873760">0</span><span class="op" id="2873761">]</span>&nbsp;<span class="op" id="2873763">&gt;&gt;</span>&nbsp;<span class="num" id="2873766">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2873770">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2873775">//&nbsp;Encode&nbsp;6-bit&nbsp;blocks&nbsp;using&nbsp;the&nbsp;base64&nbsp;alphabet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2873826">dst</span><span class="op" id="2873829">[</span><span class="num" id="2873830">0</span><span class="op" id="2873831">]</span>&nbsp;<span class="op" id="2873833">=</span>&nbsp;<span class="ident" id="2873835">enc</span><span class="op" id="2873838">.</span><span class="ident" id="2873839">encode</span><span class="op" id="2873845">[</span><span class="ident" id="2873846">b0</span><span class="op" id="2873848">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2873852">dst</span><span class="op" id="2873855">[</span><span class="num" id="2873856">1</span><span class="op" id="2873857">]</span>&nbsp;<span class="op" id="2873859">=</span>&nbsp;<span class="ident" id="2873861">enc</span><span class="op" id="2873864">.</span><span class="ident" id="2873865">encode</span><span class="op" id="2873871">[</span><span class="ident" id="2873872">b1</span><span class="op" id="2873874">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2873878">dst</span><span class="op" id="2873881">[</span><span class="num" id="2873882">2</span><span class="op" id="2873883">]</span>&nbsp;<span class="op" id="2873885">=</span>&nbsp;<span class="ident" id="2873887">enc</span><span class="op" id="2873890">.</span><span class="ident" id="2873891">encode</span><span class="op" id="2873897">[</span><span class="ident" id="2873898">b2</span><span class="op" id="2873900">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2873904">dst</span><span class="op" id="2873907">[</span><span class="num" id="2873908">3</span><span class="op" id="2873909">]</span>&nbsp;<span class="op" id="2873911">=</span>&nbsp;<span class="ident" id="2873913">enc</span><span class="op" id="2873916">.</span><span class="ident" id="2873917">encode</span><span class="op" id="2873923">[</span><span class="ident" id="2873924">b3</span><span class="op" id="2873926">]</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2873931">//&nbsp;Pad&nbsp;the&nbsp;final&nbsp;quantum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2873958">if</span>&nbsp;<span class="builtinfunc" id="2873961">len</span><span class="op" id="2873964">(</span><span class="ident" id="2873965">src</span><span class="op" id="2873968">)</span>&nbsp;<span class="op" id="2873970">&lt;</span>&nbsp;<span class="num" id="2873972">3</span>&nbsp;<span class="op" id="2873974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2873979">dst</span><span class="op" id="2873982">[</span><span class="num" id="2873983">3</span><span class="op" id="2873984">]</span>&nbsp;<span class="op" id="2873986">=</span>&nbsp;<span class="string" id="2873988">&#39;=&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2873995">if</span>&nbsp;<span class="builtinfunc" id="2873998">len</span><span class="op" id="2874001">(</span><span class="ident" id="2874002">src</span><span class="op" id="2874005">)</span>&nbsp;<span class="op" id="2874007">&lt;</span>&nbsp;<span class="num" id="2874009">2</span>&nbsp;<span class="op" id="2874011">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2874017">dst</span><span class="op" id="2874020">[</span><span class="num" id="2874021">2</span><span class="op" id="2874022">]</span>&nbsp;<span class="op" id="2874024">=</span>&nbsp;<span class="string" id="2874026">&#39;=&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2874033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2874038">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2874046">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2874051">src</span>&nbsp;<span class="op" id="2874055">=</span>&nbsp;<span class="ident" id="2874057">src</span><span class="op" id="2874060">[</span><span class="num" id="2874061">3</span><span class="op" id="2874062">:</span><span class="op" id="2874063">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2874067">dst</span>&nbsp;<span class="op" id="2874071">=</span>&nbsp;<span class="ident" id="2874073">dst</span><span class="op" id="2874076">[</span><span class="num" id="2874077">4</span><span class="op" id="2874078">:</span><span class="op" id="2874079">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2874082">}</span><br>
<span class="lineno"></span><span class="op" id="2874084">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="2874087">//&nbsp;EncodeToString&nbsp;returns&nbsp;the&nbsp;base64&nbsp;encoding&nbsp;of&nbsp;src.</span><br>
<span class="lineno"></span><span class="keyword" id="2874141">func</span>&nbsp;<span class="op" id="2874146">(</span><span class="ident" id="2874147">enc</span>&nbsp;<span class="op" id="2874151">*</span><span class="ident" id="2874152">Encoding</span><span class="op" id="2874160">)</span>&nbsp;<span class="ident" id="2874162">EncodeToString</span><span class="op" id="2874176">(</span><span class="ident" id="2874177">src</span>&nbsp;<span class="op" id="2874181">[</span><span class="op" id="2874182">]</span><span class="builtintype" id="2874183">byte</span><span class="op" id="2874187">)</span>&nbsp;<span class="builtintype" id="2874189">string</span>&nbsp;<span class="op" id="2874196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2874199">buf</span>&nbsp;<span class="op" id="2874203">:=</span>&nbsp;<span class="builtinfunc" id="2874206">make</span><span class="op" id="2874210">(</span><span class="op" id="2874211">[</span><span class="op" id="2874212">]</span><span class="builtintype" id="2874213">byte</span><span class="op" id="2874217">,</span>&nbsp;<span class="ident" id="2874219">enc</span><span class="op" id="2874222">.</span><span class="ident" id="2874223">EncodedLen</span><span class="op" id="2874233">(</span><span class="builtinfunc" id="2874234">len</span><span class="op" id="2874237">(</span><span class="ident" id="2874238">src</span><span class="op" id="2874241">)</span><span class="op" id="2874242">)</span><span class="op" id="2874243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2874246">enc</span><span class="op" id="2874249">.</span><span class="ident" id="2874250">Encode</span><span class="op" id="2874256">(</span><span class="ident" id="2874257">buf</span><span class="op" id="2874260">,</span>&nbsp;<span class="ident" id="2874262">src</span><span class="op" id="2874265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2874268">return</span>&nbsp;<span class="builtintype" id="2874275">string</span><span class="op" id="2874281">(</span><span class="ident" id="2874282">buf</span><span class="op" id="2874285">)</span><br>
<span class="lineno">120</span><span class="op" id="2874287">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2874290">type</span>&nbsp;<span class="ident" id="2874295">encoder</span>&nbsp;<span class="keyword" id="2874303">struct</span>&nbsp;<span class="op" id="2874310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2874313">err</span>&nbsp;&nbsp;<span class="builtintype" id="2874318">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2874325">enc</span>&nbsp;&nbsp;<span class="op" id="2874330">*</span><span class="ident" id="2874331">Encoding</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2874341">w</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2874346">io</span><span class="op" id="2874348">.</span><span class="ident" id="2874349">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2874357">buf</span>&nbsp;&nbsp;<span class="op" id="2874362">[</span><span class="num" id="2874363">3</span><span class="op" id="2874364">]</span><span class="builtintype" id="2874365">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2874373">//&nbsp;buffered&nbsp;data&nbsp;waiting&nbsp;to&nbsp;be&nbsp;encoded</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2874413">nbuf</span>&nbsp;<span class="builtintype" id="2874418">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2874429">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;in&nbsp;buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2874456">out</span>&nbsp;&nbsp;<span class="op" id="2874461">[</span><span class="num" id="2874462">1024</span><span class="op" id="2874466">]</span><span class="builtintype" id="2874467">byte</span>&nbsp;<span class="comment" id="2874472">//&nbsp;output&nbsp;buffer</span><br>
<span class="lineno"></span><span class="op" id="2874489">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="keyword" id="2874492">func</span>&nbsp;<span class="op" id="2874497">(</span><span class="ident" id="2874498">e</span>&nbsp;<span class="op" id="2874500">*</span><span class="ident" id="2874501">encoder</span><span class="op" id="2874508">)</span>&nbsp;<span class="ident" id="2874510">Write</span><span class="op" id="2874515">(</span><span class="ident" id="2874516">p</span>&nbsp;<span class="op" id="2874518">[</span><span class="op" id="2874519">]</span><span class="builtintype" id="2874520">byte</span><span class="op" id="2874524">)</span>&nbsp;<span class="op" id="2874526">(</span><span class="ident" id="2874527">n</span>&nbsp;<span class="builtintype" id="2874529">int</span><span class="op" id="2874532">,</span>&nbsp;<span class="ident" id="2874534">err</span>&nbsp;<span class="builtintype" id="2874538">error</span><span class="op" id="2874543">)</span>&nbsp;<span class="op" id="2874545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2874548">if</span>&nbsp;<span class="ident" id="2874551">e</span><span class="op" id="2874552">.</span><span class="ident" id="2874553">err</span>&nbsp;<span class="op" id="2874557">!=</span>&nbsp;<span class="ident" id="2874560">nil</span>&nbsp;<span class="op" id="2874564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2874568">return</span>&nbsp;<span class="num" id="2874575">0</span><span class="op" id="2874576">,</span>&nbsp;<span class="ident" id="2874578">e</span><span class="op" id="2874579">.</span><span class="ident" id="2874580">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2874585">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2874589">//&nbsp;Leading&nbsp;fringe.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2874609">if</span>&nbsp;<span class="ident" id="2874612">e</span><span class="op" id="2874613">.</span><span class="ident" id="2874614">nbuf</span>&nbsp;<span class="op" id="2874619">&gt;</span>&nbsp;<span class="num" id="2874621">0</span>&nbsp;<span class="op" id="2874623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2874627">var</span>&nbsp;<span class="ident" id="2874631">i</span>&nbsp;<span class="builtintype" id="2874633">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2874639">for</span>&nbsp;<span class="ident" id="2874643">i</span>&nbsp;<span class="op" id="2874645">=</span>&nbsp;<span class="num" id="2874647">0</span><span class="op" id="2874648">;</span>&nbsp;<span class="ident" id="2874650">i</span>&nbsp;<span class="op" id="2874652">&lt;</span>&nbsp;<span class="builtinfunc" id="2874654">len</span><span class="op" id="2874657">(</span><span class="ident" id="2874658">p</span><span class="op" id="2874659">)</span>&nbsp;<span class="op" id="2874661">&amp;&amp;</span>&nbsp;<span class="ident" id="2874664">e</span><span class="op" id="2874665">.</span><span class="ident" id="2874666">nbuf</span>&nbsp;<span class="op" id="2874671">&lt;</span>&nbsp;<span class="num" id="2874673">3</span><span class="op" id="2874674">;</span>&nbsp;<span class="ident" id="2874676">i</span><span class="op" id="2874677">++</span>&nbsp;<span class="op" id="2874680">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2874685">e</span><span class="op" id="2874686">.</span><span class="ident" id="2874687">buf</span><span class="op" id="2874690">[</span><span class="ident" id="2874691">e</span><span class="op" id="2874692">.</span><span class="ident" id="2874693">nbuf</span><span class="op" id="2874697">]</span>&nbsp;<span class="op" id="2874699">=</span>&nbsp;<span class="ident" id="2874701">p</span><span class="op" id="2874702">[</span><span class="ident" id="2874703">i</span><span class="op" id="2874704">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2874709">e</span><span class="op" id="2874710">.</span><span class="ident" id="2874711">nbuf</span><span class="op" id="2874715">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2874720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2874724">n</span>&nbsp;<span class="op" id="2874726">+=</span>&nbsp;<span class="ident" id="2874729">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2874733">p</span>&nbsp;<span class="op" id="2874735">=</span>&nbsp;<span class="ident" id="2874737">p</span><span class="op" id="2874738">[</span><span class="ident" id="2874739">i</span><span class="op" id="2874740">:</span><span class="op" id="2874741">]</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2874745">if</span>&nbsp;<span class="ident" id="2874748">e</span><span class="op" id="2874749">.</span><span class="ident" id="2874750">nbuf</span>&nbsp;<span class="op" id="2874755">&lt;</span>&nbsp;<span class="num" id="2874757">3</span>&nbsp;<span class="op" id="2874759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2874764">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2874773">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2874777">e</span><span class="op" id="2874778">.</span><span class="ident" id="2874779">enc</span><span class="op" id="2874782">.</span><span class="ident" id="2874783">Encode</span><span class="op" id="2874789">(</span><span class="ident" id="2874790">e</span><span class="op" id="2874791">.</span><span class="ident" id="2874792">out</span><span class="op" id="2874795">[</span><span class="num" id="2874796">0</span><span class="op" id="2874797">:</span><span class="op" id="2874798">]</span><span class="op" id="2874799">,</span>&nbsp;<span class="ident" id="2874801">e</span><span class="op" id="2874802">.</span><span class="ident" id="2874803">buf</span><span class="op" id="2874806">[</span><span class="num" id="2874807">0</span><span class="op" id="2874808">:</span><span class="op" id="2874809">]</span><span class="op" id="2874810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2874814">if</span>&nbsp;<span class="ident" id="2874817">_</span><span class="op" id="2874818">,</span>&nbsp;<span class="ident" id="2874820">e</span><span class="op" id="2874821">.</span><span class="ident" id="2874822">err</span>&nbsp;<span class="op" id="2874826">=</span>&nbsp;<span class="ident" id="2874828">e</span><span class="op" id="2874829">.</span><span class="ident" id="2874830">w</span><span class="op" id="2874831">.</span><span class="ident" id="2874832">Write</span><span class="op" id="2874837">(</span><span class="ident" id="2874838">e</span><span class="op" id="2874839">.</span><span class="ident" id="2874840">out</span><span class="op" id="2874843">[</span><span class="num" id="2874844">0</span><span class="op" id="2874845">:</span><span class="num" id="2874846">4</span><span class="op" id="2874847">]</span><span class="op" id="2874848">)</span><span class="op" id="2874849">;</span>&nbsp;<span class="ident" id="2874851">e</span><span class="op" id="2874852">.</span><span class="ident" id="2874853">err</span>&nbsp;<span class="op" id="2874857">!=</span>&nbsp;<span class="ident" id="2874860">nil</span>&nbsp;<span class="op" id="2874864">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2874869">return</span>&nbsp;<span class="ident" id="2874876">n</span><span class="op" id="2874877">,</span>&nbsp;<span class="ident" id="2874879">e</span><span class="op" id="2874880">.</span><span class="ident" id="2874881">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2874887">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2874891">e</span><span class="op" id="2874892">.</span><span class="ident" id="2874893">nbuf</span>&nbsp;<span class="op" id="2874898">=</span>&nbsp;<span class="num" id="2874900">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2874903">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2874907">//&nbsp;Large&nbsp;interior&nbsp;chunks.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2874934">for</span>&nbsp;<span class="builtinfunc" id="2874938">len</span><span class="op" id="2874941">(</span><span class="ident" id="2874942">p</span><span class="op" id="2874943">)</span>&nbsp;<span class="op" id="2874945">&gt;=</span>&nbsp;<span class="num" id="2874948">3</span>&nbsp;<span class="op" id="2874950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2874954">nn</span>&nbsp;<span class="op" id="2874957">:=</span>&nbsp;<span class="builtinfunc" id="2874960">len</span><span class="op" id="2874963">(</span><span class="ident" id="2874964">e</span><span class="op" id="2874965">.</span><span class="ident" id="2874966">out</span><span class="op" id="2874969">)</span>&nbsp;<span class="op" id="2874971">/</span>&nbsp;<span class="num" id="2874973">4</span>&nbsp;<span class="op" id="2874975">*</span>&nbsp;<span class="num" id="2874977">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2874981">if</span>&nbsp;<span class="ident" id="2874984">nn</span>&nbsp;<span class="op" id="2874987">&gt;</span>&nbsp;<span class="builtinfunc" id="2874989">len</span><span class="op" id="2874992">(</span><span class="ident" id="2874993">p</span><span class="op" id="2874994">)</span>&nbsp;<span class="op" id="2874996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2875001">nn</span>&nbsp;<span class="op" id="2875004">=</span>&nbsp;<span class="builtinfunc" id="2875006">len</span><span class="op" id="2875009">(</span><span class="ident" id="2875010">p</span><span class="op" id="2875011">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2875016">nn</span>&nbsp;<span class="op" id="2875019">-=</span>&nbsp;<span class="ident" id="2875022">nn</span>&nbsp;<span class="op" id="2875025">%</span>&nbsp;<span class="num" id="2875027">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2875031">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2875035">e</span><span class="op" id="2875036">.</span><span class="ident" id="2875037">enc</span><span class="op" id="2875040">.</span><span class="ident" id="2875041">Encode</span><span class="op" id="2875047">(</span><span class="ident" id="2875048">e</span><span class="op" id="2875049">.</span><span class="ident" id="2875050">out</span><span class="op" id="2875053">[</span><span class="num" id="2875054">0</span><span class="op" id="2875055">:</span><span class="op" id="2875056">]</span><span class="op" id="2875057">,</span>&nbsp;<span class="ident" id="2875059">p</span><span class="op" id="2875060">[</span><span class="num" id="2875061">0</span><span class="op" id="2875062">:</span><span class="ident" id="2875063">nn</span><span class="op" id="2875065">]</span><span class="op" id="2875066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2875070">if</span>&nbsp;<span class="ident" id="2875073">_</span><span class="op" id="2875074">,</span>&nbsp;<span class="ident" id="2875076">e</span><span class="op" id="2875077">.</span><span class="ident" id="2875078">err</span>&nbsp;<span class="op" id="2875082">=</span>&nbsp;<span class="ident" id="2875084">e</span><span class="op" id="2875085">.</span><span class="ident" id="2875086">w</span><span class="op" id="2875087">.</span><span class="ident" id="2875088">Write</span><span class="op" id="2875093">(</span><span class="ident" id="2875094">e</span><span class="op" id="2875095">.</span><span class="ident" id="2875096">out</span><span class="op" id="2875099">[</span><span class="num" id="2875100">0</span>&nbsp;<span class="op" id="2875102">:</span>&nbsp;<span class="ident" id="2875104">nn</span><span class="op" id="2875106">/</span><span class="num" id="2875107">3</span><span class="op" id="2875108">*</span><span class="num" id="2875109">4</span><span class="op" id="2875110">]</span><span class="op" id="2875111">)</span><span class="op" id="2875112">;</span>&nbsp;<span class="ident" id="2875114">e</span><span class="op" id="2875115">.</span><span class="ident" id="2875116">err</span>&nbsp;<span class="op" id="2875120">!=</span>&nbsp;<span class="ident" id="2875123">nil</span>&nbsp;<span class="op" id="2875127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2875132">return</span>&nbsp;<span class="ident" id="2875139">n</span><span class="op" id="2875140">,</span>&nbsp;<span class="ident" id="2875142">e</span><span class="op" id="2875143">.</span><span class="ident" id="2875144">err</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2875150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2875154">n</span>&nbsp;<span class="op" id="2875156">+=</span>&nbsp;<span class="ident" id="2875159">nn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2875164">p</span>&nbsp;<span class="op" id="2875166">=</span>&nbsp;<span class="ident" id="2875168">p</span><span class="op" id="2875169">[</span><span class="ident" id="2875170">nn</span><span class="op" id="2875172">:</span><span class="op" id="2875173">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2875176">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2875180">//&nbsp;Trailing&nbsp;fringe.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2875201">for</span>&nbsp;<span class="ident" id="2875205">i</span>&nbsp;<span class="op" id="2875207">:=</span>&nbsp;<span class="num" id="2875210">0</span><span class="op" id="2875211">;</span>&nbsp;<span class="ident" id="2875213">i</span>&nbsp;<span class="op" id="2875215">&lt;</span>&nbsp;<span class="builtinfunc" id="2875217">len</span><span class="op" id="2875220">(</span><span class="ident" id="2875221">p</span><span class="op" id="2875222">)</span><span class="op" id="2875223">;</span>&nbsp;<span class="ident" id="2875225">i</span><span class="op" id="2875226">++</span>&nbsp;<span class="op" id="2875229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2875233">e</span><span class="op" id="2875234">.</span><span class="ident" id="2875235">buf</span><span class="op" id="2875238">[</span><span class="ident" id="2875239">i</span><span class="op" id="2875240">]</span>&nbsp;<span class="op" id="2875242">=</span>&nbsp;<span class="ident" id="2875244">p</span><span class="op" id="2875245">[</span><span class="ident" id="2875246">i</span><span class="op" id="2875247">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2875250">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2875253">e</span><span class="op" id="2875254">.</span><span class="ident" id="2875255">nbuf</span>&nbsp;<span class="op" id="2875260">=</span>&nbsp;<span class="builtinfunc" id="2875262">len</span><span class="op" id="2875265">(</span><span class="ident" id="2875266">p</span><span class="op" id="2875267">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2875270">n</span>&nbsp;<span class="op" id="2875272">+=</span>&nbsp;<span class="builtinfunc" id="2875275">len</span><span class="op" id="2875278">(</span><span class="ident" id="2875279">p</span><span class="op" id="2875280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2875283">return</span><br>
<span class="lineno"></span><span class="op" id="2875290">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2875293">//&nbsp;Close&nbsp;flushes&nbsp;any&nbsp;pending&nbsp;output&nbsp;from&nbsp;the&nbsp;encoder.</span><br>
<span class="lineno">180</span><span class="comment" id="2875347">//&nbsp;It&nbsp;is&nbsp;an&nbsp;error&nbsp;to&nbsp;call&nbsp;Write&nbsp;after&nbsp;calling&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="2875400">func</span>&nbsp;<span class="op" id="2875405">(</span><span class="ident" id="2875406">e</span>&nbsp;<span class="op" id="2875408">*</span><span class="ident" id="2875409">encoder</span><span class="op" id="2875416">)</span>&nbsp;<span class="ident" id="2875418">Close</span><span class="op" id="2875423">(</span><span class="op" id="2875424">)</span>&nbsp;<span class="builtintype" id="2875426">error</span>&nbsp;<span class="op" id="2875432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2875435">//&nbsp;If&nbsp;there&#39;s&nbsp;anything&nbsp;left&nbsp;in&nbsp;the&nbsp;buffer,&nbsp;flush&nbsp;it&nbsp;out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2875492">if</span>&nbsp;<span class="ident" id="2875495">e</span><span class="op" id="2875496">.</span><span class="ident" id="2875497">err</span>&nbsp;<span class="op" id="2875501">==</span>&nbsp;<span class="ident" id="2875504">nil</span>&nbsp;<span class="op" id="2875508">&amp;&amp;</span>&nbsp;<span class="ident" id="2875511">e</span><span class="op" id="2875512">.</span><span class="ident" id="2875513">nbuf</span>&nbsp;<span class="op" id="2875518">&gt;</span>&nbsp;<span class="num" id="2875520">0</span>&nbsp;<span class="op" id="2875522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2875526">e</span><span class="op" id="2875527">.</span><span class="ident" id="2875528">enc</span><span class="op" id="2875531">.</span><span class="ident" id="2875532">Encode</span><span class="op" id="2875538">(</span><span class="ident" id="2875539">e</span><span class="op" id="2875540">.</span><span class="ident" id="2875541">out</span><span class="op" id="2875544">[</span><span class="num" id="2875545">0</span><span class="op" id="2875546">:</span><span class="op" id="2875547">]</span><span class="op" id="2875548">,</span>&nbsp;<span class="ident" id="2875550">e</span><span class="op" id="2875551">.</span><span class="ident" id="2875552">buf</span><span class="op" id="2875555">[</span><span class="num" id="2875556">0</span><span class="op" id="2875557">:</span><span class="ident" id="2875558">e</span><span class="op" id="2875559">.</span><span class="ident" id="2875560">nbuf</span><span class="op" id="2875564">]</span><span class="op" id="2875565">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2875569">e</span><span class="op" id="2875570">.</span><span class="ident" id="2875571">nbuf</span>&nbsp;<span class="op" id="2875576">=</span>&nbsp;<span class="num" id="2875578">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2875582">_</span><span class="op" id="2875583">,</span>&nbsp;<span class="ident" id="2875585">e</span><span class="op" id="2875586">.</span><span class="ident" id="2875587">err</span>&nbsp;<span class="op" id="2875591">=</span>&nbsp;<span class="ident" id="2875593">e</span><span class="op" id="2875594">.</span><span class="ident" id="2875595">w</span><span class="op" id="2875596">.</span><span class="ident" id="2875597">Write</span><span class="op" id="2875602">(</span><span class="ident" id="2875603">e</span><span class="op" id="2875604">.</span><span class="ident" id="2875605">out</span><span class="op" id="2875608">[</span><span class="num" id="2875609">0</span><span class="op" id="2875610">:</span><span class="num" id="2875611">4</span><span class="op" id="2875612">]</span><span class="op" id="2875613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2875616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2875619">return</span>&nbsp;<span class="ident" id="2875626">e</span><span class="op" id="2875627">.</span><span class="ident" id="2875628">err</span><br>
<span class="lineno"></span><span class="op" id="2875632">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="comment" id="2875635">//&nbsp;NewEncoder&nbsp;returns&nbsp;a&nbsp;new&nbsp;base64&nbsp;stream&nbsp;encoder.&nbsp;&nbsp;Data&nbsp;written&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="2875703">//&nbsp;the&nbsp;returned&nbsp;writer&nbsp;will&nbsp;be&nbsp;encoded&nbsp;using&nbsp;enc&nbsp;and&nbsp;then&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="2875775">//&nbsp;Base64&nbsp;encodings&nbsp;operate&nbsp;in&nbsp;4-byte&nbsp;blocks;&nbsp;when&nbsp;finished</span><br>
<span class="lineno"></span><span class="comment" id="2875835">//&nbsp;writing,&nbsp;the&nbsp;caller&nbsp;must&nbsp;Close&nbsp;the&nbsp;returned&nbsp;encoder&nbsp;to&nbsp;flush&nbsp;any</span><br>
<span class="lineno">195</span><span class="comment" id="2875903">//&nbsp;partially&nbsp;written&nbsp;blocks.</span><br>
<span class="lineno"></span><span class="keyword" id="2875932">func</span>&nbsp;<span class="ident" id="2875937">NewEncoder</span><span class="op" id="2875947">(</span><span class="ident" id="2875948">enc</span>&nbsp;<span class="op" id="2875952">*</span><span class="ident" id="2875953">Encoding</span><span class="op" id="2875961">,</span>&nbsp;<span class="ident" id="2875963">w</span>&nbsp;<span class="ident" id="2875965">io</span><span class="op" id="2875967">.</span><span class="ident" id="2875968">Writer</span><span class="op" id="2875974">)</span>&nbsp;<span class="ident" id="2875976">io</span><span class="op" id="2875978">.</span><span class="ident" id="2875979">WriteCloser</span>&nbsp;<span class="op" id="2875991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2875994">return</span>&nbsp;<span class="op" id="2876001">&amp;</span><span class="ident" id="2876002">encoder</span><span class="op" id="2876009">{</span><span class="ident" id="2876010">enc</span><span class="op" id="2876013">:</span>&nbsp;<span class="ident" id="2876015">enc</span><span class="op" id="2876018">,</span>&nbsp;<span class="ident" id="2876020">w</span><span class="op" id="2876021">:</span>&nbsp;<span class="ident" id="2876023">w</span><span class="op" id="2876024">}</span><br>
<span class="lineno"></span><span class="op" id="2876026">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="comment" id="2876029">//&nbsp;EncodedLen&nbsp;returns&nbsp;the&nbsp;length&nbsp;in&nbsp;bytes&nbsp;of&nbsp;the&nbsp;base64&nbsp;encoding</span><br>
<span class="lineno"></span><span class="comment" id="2876094">//&nbsp;of&nbsp;an&nbsp;input&nbsp;buffer&nbsp;of&nbsp;length&nbsp;n.</span><br>
<span class="lineno"></span><span class="keyword" id="2876129">func</span>&nbsp;<span class="op" id="2876134">(</span><span class="ident" id="2876135">enc</span>&nbsp;<span class="op" id="2876139">*</span><span class="ident" id="2876140">Encoding</span><span class="op" id="2876148">)</span>&nbsp;<span class="ident" id="2876150">EncodedLen</span><span class="op" id="2876160">(</span><span class="ident" id="2876161">n</span>&nbsp;<span class="builtintype" id="2876163">int</span><span class="op" id="2876166">)</span>&nbsp;<span class="builtintype" id="2876168">int</span>&nbsp;<span class="op" id="2876172">{</span>&nbsp;<span class="keyword" id="2876174">return</span>&nbsp;<span class="op" id="2876181">(</span><span class="ident" id="2876182">n</span>&nbsp;<span class="op" id="2876184">+</span>&nbsp;<span class="num" id="2876186">2</span><span class="op" id="2876187">)</span>&nbsp;<span class="op" id="2876189">/</span>&nbsp;<span class="num" id="2876191">3</span>&nbsp;<span class="op" id="2876193">*</span>&nbsp;<span class="num" id="2876195">4</span>&nbsp;<span class="op" id="2876197">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2876200">/*<br>
<span class="lineno">205</span>&nbsp;*&nbsp;Decoder<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2876219">type</span>&nbsp;<span class="ident" id="2876224">CorruptInputError</span>&nbsp;<span class="ident" id="2876242">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="keyword" id="2876249">func</span>&nbsp;<span class="op" id="2876254">(</span><span class="ident" id="2876255">e</span>&nbsp;<span class="ident" id="2876257">CorruptInputError</span><span class="op" id="2876274">)</span>&nbsp;<span class="ident" id="2876276">Error</span><span class="op" id="2876281">(</span><span class="op" id="2876282">)</span>&nbsp;<span class="builtintype" id="2876284">string</span>&nbsp;<span class="op" id="2876291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2876294">return</span>&nbsp;<span class="string" id="2876301">&#34;illegal&nbsp;base64&nbsp;data&nbsp;at&nbsp;input&nbsp;byte&nbsp;&#34;</span>&nbsp;<span class="op" id="2876338">+</span>&nbsp;<span class="ident" id="2876340">strconv</span><span class="op" id="2876347">.</span><span class="ident" id="2876348">FormatInt</span><span class="op" id="2876357">(</span><span class="ident" id="2876358">int64</span><span class="op" id="2876363">(</span><span class="ident" id="2876364">e</span><span class="op" id="2876365">)</span><span class="op" id="2876366">,</span>&nbsp;<span class="num" id="2876368">10</span><span class="op" id="2876370">)</span><br>
<span class="lineno"></span><span class="op" id="2876372">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2876375">//&nbsp;decode&nbsp;is&nbsp;like&nbsp;Decode&nbsp;but&nbsp;returns&nbsp;an&nbsp;additional&nbsp;&#39;end&#39;&nbsp;value,&nbsp;which</span><br>
<span class="lineno">215</span><span class="comment" id="2876445">//&nbsp;indicates&nbsp;if&nbsp;end-of-message&nbsp;padding&nbsp;was&nbsp;encountered&nbsp;and&nbsp;thus&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="2876513">//&nbsp;additional&nbsp;data&nbsp;is&nbsp;an&nbsp;error.&nbsp;This&nbsp;method&nbsp;assumes&nbsp;that&nbsp;src&nbsp;has&nbsp;been</span><br>
<span class="lineno"></span><span class="comment" id="2876583">//&nbsp;stripped&nbsp;of&nbsp;all&nbsp;supported&nbsp;whitespace&nbsp;(&#39;\r&#39;&nbsp;and&nbsp;&#39;\n&#39;).</span><br>
<span class="lineno"></span><span class="keyword" id="2876640">func</span>&nbsp;<span class="op" id="2876645">(</span><span class="ident" id="2876646">enc</span>&nbsp;<span class="op" id="2876650">*</span><span class="ident" id="2876651">Encoding</span><span class="op" id="2876659">)</span>&nbsp;<span class="ident" id="2876661">decode</span><span class="op" id="2876667">(</span><span class="ident" id="2876668">dst</span><span class="op" id="2876671">,</span>&nbsp;<span class="ident" id="2876673">src</span>&nbsp;<span class="op" id="2876677">[</span><span class="op" id="2876678">]</span><span class="builtintype" id="2876679">byte</span><span class="op" id="2876683">)</span>&nbsp;<span class="op" id="2876685">(</span><span class="ident" id="2876686">n</span>&nbsp;<span class="builtintype" id="2876688">int</span><span class="op" id="2876691">,</span>&nbsp;<span class="ident" id="2876693">end</span>&nbsp;<span class="builtintype" id="2876697">bool</span><span class="op" id="2876701">,</span>&nbsp;<span class="ident" id="2876703">err</span>&nbsp;<span class="builtintype" id="2876707">error</span><span class="op" id="2876712">)</span>&nbsp;<span class="op" id="2876714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2876717">olen</span>&nbsp;<span class="op" id="2876722">:=</span>&nbsp;<span class="builtinfunc" id="2876725">len</span><span class="op" id="2876728">(</span><span class="ident" id="2876729">src</span><span class="op" id="2876732">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2876735">for</span>&nbsp;<span class="builtinfunc" id="2876739">len</span><span class="op" id="2876742">(</span><span class="ident" id="2876743">src</span><span class="op" id="2876746">)</span>&nbsp;<span class="op" id="2876748">&gt;</span>&nbsp;<span class="num" id="2876750">0</span>&nbsp;<span class="op" id="2876752">&amp;&amp;</span>&nbsp;<span class="op" id="2876755">!</span><span class="ident" id="2876756">end</span>&nbsp;<span class="op" id="2876760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2876764">//&nbsp;Decode&nbsp;quantum&nbsp;using&nbsp;the&nbsp;base64&nbsp;alphabet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2876810">var</span>&nbsp;<span class="ident" id="2876814">dbuf</span>&nbsp;<span class="op" id="2876819">[</span><span class="num" id="2876820">4</span><span class="op" id="2876821">]</span><span class="builtintype" id="2876822">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2876829">dlen</span>&nbsp;<span class="op" id="2876834">:=</span>&nbsp;<span class="num" id="2876837">4</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2876842">for</span>&nbsp;<span class="ident" id="2876846">j</span>&nbsp;<span class="op" id="2876848">:=</span>&nbsp;<span class="keyword" id="2876851">range</span>&nbsp;<span class="ident" id="2876857">dbuf</span>&nbsp;<span class="op" id="2876862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2876867">if</span>&nbsp;<span class="builtinfunc" id="2876870">len</span><span class="op" id="2876873">(</span><span class="ident" id="2876874">src</span><span class="op" id="2876877">)</span>&nbsp;<span class="op" id="2876879">==</span>&nbsp;<span class="num" id="2876882">0</span>&nbsp;<span class="op" id="2876884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2876890">return</span>&nbsp;<span class="ident" id="2876897">n</span><span class="op" id="2876898">,</span>&nbsp;<span class="builtintype" id="2876900">false</span><span class="op" id="2876905">,</span>&nbsp;<span class="ident" id="2876907">CorruptInputError</span><span class="op" id="2876924">(</span><span class="ident" id="2876925">olen</span>&nbsp;<span class="op" id="2876930">-</span>&nbsp;<span class="builtinfunc" id="2876932">len</span><span class="op" id="2876935">(</span><span class="ident" id="2876936">src</span><span class="op" id="2876939">)</span>&nbsp;<span class="op" id="2876941">-</span>&nbsp;<span class="ident" id="2876943">j</span><span class="op" id="2876944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2876949">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2876954">in</span>&nbsp;<span class="op" id="2876957">:=</span>&nbsp;<span class="ident" id="2876960">src</span><span class="op" id="2876963">[</span><span class="num" id="2876964">0</span><span class="op" id="2876965">]</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2876970">src</span>&nbsp;<span class="op" id="2876974">=</span>&nbsp;<span class="ident" id="2876976">src</span><span class="op" id="2876979">[</span><span class="num" id="2876980">1</span><span class="op" id="2876981">:</span><span class="op" id="2876982">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2876987">if</span>&nbsp;<span class="ident" id="2876990">in</span>&nbsp;<span class="op" id="2876993">==</span>&nbsp;<span class="string" id="2876996">&#39;=&#39;</span>&nbsp;<span class="op" id="2877000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2877006">//&nbsp;We&#39;ve&nbsp;reached&nbsp;the&nbsp;end&nbsp;and&nbsp;there&#39;s&nbsp;padding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2877055">switch</span>&nbsp;<span class="ident" id="2877062">j</span>&nbsp;<span class="op" id="2877064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2877070">case</span>&nbsp;<span class="num" id="2877075">0</span><span class="op" id="2877076">,</span>&nbsp;<span class="num" id="2877078">1</span><span class="op" id="2877079">:</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2877086">//&nbsp;incorrect&nbsp;padding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2877112">return</span>&nbsp;<span class="ident" id="2877119">n</span><span class="op" id="2877120">,</span>&nbsp;<span class="builtintype" id="2877122">false</span><span class="op" id="2877127">,</span>&nbsp;<span class="ident" id="2877129">CorruptInputError</span><span class="op" id="2877146">(</span><span class="ident" id="2877147">olen</span>&nbsp;<span class="op" id="2877152">-</span>&nbsp;<span class="builtinfunc" id="2877154">len</span><span class="op" id="2877157">(</span><span class="ident" id="2877158">src</span><span class="op" id="2877161">)</span>&nbsp;<span class="op" id="2877163">-</span>&nbsp;<span class="num" id="2877165">1</span><span class="op" id="2877166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2877172">case</span>&nbsp;<span class="num" id="2877177">2</span><span class="op" id="2877178">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2877185">//&nbsp;&#34;==&#34;&nbsp;is&nbsp;expected,&nbsp;the&nbsp;first&nbsp;&#34;=&#34;&nbsp;is&nbsp;already&nbsp;consumed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2877246">if</span>&nbsp;<span class="builtinfunc" id="2877249">len</span><span class="op" id="2877252">(</span><span class="ident" id="2877253">src</span><span class="op" id="2877256">)</span>&nbsp;<span class="op" id="2877258">==</span>&nbsp;<span class="num" id="2877261">0</span>&nbsp;<span class="op" id="2877263">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2877271">//&nbsp;not&nbsp;enough&nbsp;padding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2877299">return</span>&nbsp;<span class="ident" id="2877306">n</span><span class="op" id="2877307">,</span>&nbsp;<span class="builtintype" id="2877309">false</span><span class="op" id="2877314">,</span>&nbsp;<span class="ident" id="2877316">CorruptInputError</span><span class="op" id="2877333">(</span><span class="ident" id="2877334">olen</span><span class="op" id="2877338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2877345">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2877352">if</span>&nbsp;<span class="ident" id="2877355">src</span><span class="op" id="2877358">[</span><span class="num" id="2877359">0</span><span class="op" id="2877360">]</span>&nbsp;<span class="op" id="2877362">!=</span>&nbsp;<span class="string" id="2877365">&#39;=&#39;</span>&nbsp;<span class="op" id="2877369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2877377">//&nbsp;incorrect&nbsp;padding</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2877404">return</span>&nbsp;<span class="ident" id="2877411">n</span><span class="op" id="2877412">,</span>&nbsp;<span class="builtintype" id="2877414">false</span><span class="op" id="2877419">,</span>&nbsp;<span class="ident" id="2877421">CorruptInputError</span><span class="op" id="2877438">(</span><span class="ident" id="2877439">olen</span>&nbsp;<span class="op" id="2877444">-</span>&nbsp;<span class="builtinfunc" id="2877446">len</span><span class="op" id="2877449">(</span><span class="ident" id="2877450">src</span><span class="op" id="2877453">)</span>&nbsp;<span class="op" id="2877455">-</span>&nbsp;<span class="num" id="2877457">1</span><span class="op" id="2877458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2877465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2877472">src</span>&nbsp;<span class="op" id="2877476">=</span>&nbsp;<span class="ident" id="2877478">src</span><span class="op" id="2877481">[</span><span class="num" id="2877482">1</span><span class="op" id="2877483">:</span><span class="op" id="2877484">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2877490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2877496">if</span>&nbsp;<span class="builtinfunc" id="2877499">len</span><span class="op" id="2877502">(</span><span class="ident" id="2877503">src</span><span class="op" id="2877506">)</span>&nbsp;<span class="op" id="2877508">&gt;</span>&nbsp;<span class="num" id="2877510">0</span>&nbsp;<span class="op" id="2877512">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2877519">//&nbsp;trailing&nbsp;garbage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2877544">err</span>&nbsp;<span class="op" id="2877548">=</span>&nbsp;<span class="ident" id="2877550">CorruptInputError</span><span class="op" id="2877567">(</span><span class="ident" id="2877568">olen</span>&nbsp;<span class="op" id="2877573">-</span>&nbsp;<span class="builtinfunc" id="2877575">len</span><span class="op" id="2877578">(</span><span class="ident" id="2877579">src</span><span class="op" id="2877582">)</span><span class="op" id="2877583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2877589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2877595">dlen</span><span class="op" id="2877599">,</span>&nbsp;<span class="ident" id="2877601">end</span>&nbsp;<span class="op" id="2877605">=</span>&nbsp;<span class="ident" id="2877607">j</span><span class="op" id="2877608">,</span>&nbsp;<span class="builtintype" id="2877610">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2877619">break</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2877628">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2877633">dbuf</span><span class="op" id="2877637">[</span><span class="ident" id="2877638">j</span><span class="op" id="2877639">]</span>&nbsp;<span class="op" id="2877641">=</span>&nbsp;<span class="ident" id="2877643">enc</span><span class="op" id="2877646">.</span><span class="ident" id="2877647">decodeMap</span><span class="op" id="2877656">[</span><span class="ident" id="2877657">in</span><span class="op" id="2877659">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2877664">if</span>&nbsp;<span class="ident" id="2877667">dbuf</span><span class="op" id="2877671">[</span><span class="ident" id="2877672">j</span><span class="op" id="2877673">]</span>&nbsp;<span class="op" id="2877675">==</span>&nbsp;<span class="num" id="2877678">0xFF</span>&nbsp;<span class="op" id="2877683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2877689">return</span>&nbsp;<span class="ident" id="2877696">n</span><span class="op" id="2877697">,</span>&nbsp;<span class="builtintype" id="2877699">false</span><span class="op" id="2877704">,</span>&nbsp;<span class="ident" id="2877706">CorruptInputError</span><span class="op" id="2877723">(</span><span class="ident" id="2877724">olen</span>&nbsp;<span class="op" id="2877729">-</span>&nbsp;<span class="builtinfunc" id="2877731">len</span><span class="op" id="2877734">(</span><span class="ident" id="2877735">src</span><span class="op" id="2877738">)</span>&nbsp;<span class="op" id="2877740">-</span>&nbsp;<span class="num" id="2877742">1</span><span class="op" id="2877743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2877748">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2877752">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2877757">//&nbsp;Pack&nbsp;4x&nbsp;6-bit&nbsp;source&nbsp;blocks&nbsp;into&nbsp;3&nbsp;byte&nbsp;destination</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2877814">//&nbsp;quantum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2877827">switch</span>&nbsp;<span class="ident" id="2877834">dlen</span>&nbsp;<span class="op" id="2877839">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2877843">case</span>&nbsp;<span class="num" id="2877848">4</span><span class="op" id="2877849">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2877854">dst</span><span class="op" id="2877857">[</span><span class="num" id="2877858">2</span><span class="op" id="2877859">]</span>&nbsp;<span class="op" id="2877861">=</span>&nbsp;<span class="ident" id="2877863">dbuf</span><span class="op" id="2877867">[</span><span class="num" id="2877868">2</span><span class="op" id="2877869">]</span><span class="op" id="2877870">&lt;&lt;</span><span class="num" id="2877872">6</span>&nbsp;<span class="op" id="2877874">|</span>&nbsp;<span class="ident" id="2877876">dbuf</span><span class="op" id="2877880">[</span><span class="num" id="2877881">3</span><span class="op" id="2877882">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2877887">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2877901">case</span>&nbsp;<span class="num" id="2877906">3</span><span class="op" id="2877907">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2877912">dst</span><span class="op" id="2877915">[</span><span class="num" id="2877916">1</span><span class="op" id="2877917">]</span>&nbsp;<span class="op" id="2877919">=</span>&nbsp;<span class="ident" id="2877921">dbuf</span><span class="op" id="2877925">[</span><span class="num" id="2877926">1</span><span class="op" id="2877927">]</span><span class="op" id="2877928">&lt;&lt;</span><span class="num" id="2877930">4</span>&nbsp;<span class="op" id="2877932">|</span>&nbsp;<span class="ident" id="2877934">dbuf</span><span class="op" id="2877938">[</span><span class="num" id="2877939">2</span><span class="op" id="2877940">]</span><span class="op" id="2877941">&gt;&gt;</span><span class="num" id="2877943">2</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2877948">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2877962">case</span>&nbsp;<span class="num" id="2877967">2</span><span class="op" id="2877968">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2877973">dst</span><span class="op" id="2877976">[</span><span class="num" id="2877977">0</span><span class="op" id="2877978">]</span>&nbsp;<span class="op" id="2877980">=</span>&nbsp;<span class="ident" id="2877982">dbuf</span><span class="op" id="2877986">[</span><span class="num" id="2877987">0</span><span class="op" id="2877988">]</span><span class="op" id="2877989">&lt;&lt;</span><span class="num" id="2877991">2</span>&nbsp;<span class="op" id="2877993">|</span>&nbsp;<span class="ident" id="2877995">dbuf</span><span class="op" id="2877999">[</span><span class="num" id="2878000">1</span><span class="op" id="2878001">]</span><span class="op" id="2878002">&gt;&gt;</span><span class="num" id="2878004">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2878008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2878012">dst</span>&nbsp;<span class="op" id="2878016">=</span>&nbsp;<span class="ident" id="2878018">dst</span><span class="op" id="2878021">[</span><span class="num" id="2878022">3</span><span class="op" id="2878023">:</span><span class="op" id="2878024">]</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2878028">n</span>&nbsp;<span class="op" id="2878030">+=</span>&nbsp;<span class="ident" id="2878033">dlen</span>&nbsp;<span class="op" id="2878038">-</span>&nbsp;<span class="num" id="2878040">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2878043">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2878047">return</span>&nbsp;<span class="ident" id="2878054">n</span><span class="op" id="2878055">,</span>&nbsp;<span class="ident" id="2878057">end</span><span class="op" id="2878060">,</span>&nbsp;<span class="ident" id="2878062">err</span><br>
<span class="lineno"></span><span class="op" id="2878066">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="comment" id="2878069">//&nbsp;Decode&nbsp;decodes&nbsp;src&nbsp;using&nbsp;the&nbsp;encoding&nbsp;enc.&nbsp;&nbsp;It&nbsp;writes&nbsp;at&nbsp;most</span><br>
<span class="lineno"></span><span class="comment" id="2878134">//&nbsp;DecodedLen(len(src))&nbsp;bytes&nbsp;to&nbsp;dst&nbsp;and&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes</span><br>
<span class="lineno"></span><span class="comment" id="2878203">//&nbsp;written.&nbsp;&nbsp;If&nbsp;src&nbsp;contains&nbsp;invalid&nbsp;base64&nbsp;data,&nbsp;it&nbsp;will&nbsp;return&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2878272">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;successfully&nbsp;written&nbsp;and&nbsp;CorruptInputError.</span><br>
<span class="lineno">285</span><span class="comment" id="2878335">//&nbsp;New&nbsp;line&nbsp;characters&nbsp;(\r&nbsp;and&nbsp;\n)&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="keyword" id="2878383">func</span>&nbsp;<span class="op" id="2878388">(</span><span class="ident" id="2878389">enc</span>&nbsp;<span class="op" id="2878393">*</span><span class="ident" id="2878394">Encoding</span><span class="op" id="2878402">)</span>&nbsp;<span class="ident" id="2878404">Decode</span><span class="op" id="2878410">(</span><span class="ident" id="2878411">dst</span><span class="op" id="2878414">,</span>&nbsp;<span class="ident" id="2878416">src</span>&nbsp;<span class="op" id="2878420">[</span><span class="op" id="2878421">]</span><span class="builtintype" id="2878422">byte</span><span class="op" id="2878426">)</span>&nbsp;<span class="op" id="2878428">(</span><span class="ident" id="2878429">n</span>&nbsp;<span class="builtintype" id="2878431">int</span><span class="op" id="2878434">,</span>&nbsp;<span class="ident" id="2878436">err</span>&nbsp;<span class="builtintype" id="2878440">error</span><span class="op" id="2878445">)</span>&nbsp;<span class="op" id="2878447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2878450">src</span>&nbsp;<span class="op" id="2878454">=</span>&nbsp;<span class="ident" id="2878456">bytes</span><span class="op" id="2878461">.</span><span class="ident" id="2878462">Map</span><span class="op" id="2878465">(</span><span class="ident" id="2878466">removeNewlinesMapper</span><span class="op" id="2878486">,</span>&nbsp;<span class="ident" id="2878488">src</span><span class="op" id="2878491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2878494">n</span><span class="op" id="2878495">,</span>&nbsp;<span class="ident" id="2878497">_</span><span class="op" id="2878498">,</span>&nbsp;<span class="ident" id="2878500">err</span>&nbsp;<span class="op" id="2878504">=</span>&nbsp;<span class="ident" id="2878506">enc</span><span class="op" id="2878509">.</span><span class="ident" id="2878510">decode</span><span class="op" id="2878516">(</span><span class="ident" id="2878517">dst</span><span class="op" id="2878520">,</span>&nbsp;<span class="ident" id="2878522">src</span><span class="op" id="2878525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2878528">return</span><br>
<span class="lineno">290</span><span class="op" id="2878535">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2878538">//&nbsp;DecodeString&nbsp;returns&nbsp;the&nbsp;bytes&nbsp;represented&nbsp;by&nbsp;the&nbsp;base64&nbsp;string&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2878608">func</span>&nbsp;<span class="op" id="2878613">(</span><span class="ident" id="2878614">enc</span>&nbsp;<span class="op" id="2878618">*</span><span class="ident" id="2878619">Encoding</span><span class="op" id="2878627">)</span>&nbsp;<span class="ident" id="2878629">DecodeString</span><span class="op" id="2878641">(</span><span class="ident" id="2878642">s</span>&nbsp;<span class="builtintype" id="2878644">string</span><span class="op" id="2878650">)</span>&nbsp;<span class="op" id="2878652">(</span><span class="op" id="2878653">[</span><span class="op" id="2878654">]</span><span class="builtintype" id="2878655">byte</span><span class="op" id="2878659">,</span>&nbsp;<span class="builtintype" id="2878661">error</span><span class="op" id="2878666">)</span>&nbsp;<span class="op" id="2878668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2878671">s</span>&nbsp;<span class="op" id="2878673">=</span>&nbsp;<span class="ident" id="2878675">strings</span><span class="op" id="2878682">.</span><span class="ident" id="2878683">Map</span><span class="op" id="2878686">(</span><span class="ident" id="2878687">removeNewlinesMapper</span><span class="op" id="2878707">,</span>&nbsp;<span class="ident" id="2878709">s</span><span class="op" id="2878710">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2878713">dbuf</span>&nbsp;<span class="op" id="2878718">:=</span>&nbsp;<span class="builtinfunc" id="2878721">make</span><span class="op" id="2878725">(</span><span class="op" id="2878726">[</span><span class="op" id="2878727">]</span><span class="builtintype" id="2878728">byte</span><span class="op" id="2878732">,</span>&nbsp;<span class="ident" id="2878734">enc</span><span class="op" id="2878737">.</span><span class="ident" id="2878738">DecodedLen</span><span class="op" id="2878748">(</span><span class="builtinfunc" id="2878749">len</span><span class="op" id="2878752">(</span><span class="ident" id="2878753">s</span><span class="op" id="2878754">)</span><span class="op" id="2878755">)</span><span class="op" id="2878756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2878759">n</span><span class="op" id="2878760">,</span>&nbsp;<span class="ident" id="2878762">_</span><span class="op" id="2878763">,</span>&nbsp;<span class="ident" id="2878765">err</span>&nbsp;<span class="op" id="2878769">:=</span>&nbsp;<span class="ident" id="2878772">enc</span><span class="op" id="2878775">.</span><span class="ident" id="2878776">decode</span><span class="op" id="2878782">(</span><span class="ident" id="2878783">dbuf</span><span class="op" id="2878787">,</span>&nbsp;<span class="op" id="2878789">[</span><span class="op" id="2878790">]</span><span class="builtintype" id="2878791">byte</span><span class="op" id="2878795">(</span><span class="ident" id="2878796">s</span><span class="op" id="2878797">)</span><span class="op" id="2878798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2878801">return</span>&nbsp;<span class="ident" id="2878808">dbuf</span><span class="op" id="2878812">[</span><span class="op" id="2878813">:</span><span class="ident" id="2878814">n</span><span class="op" id="2878815">]</span><span class="op" id="2878816">,</span>&nbsp;<span class="ident" id="2878818">err</span><br>
<span class="lineno"></span><span class="op" id="2878822">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="keyword" id="2878825">type</span>&nbsp;<span class="ident" id="2878830">decoder</span>&nbsp;<span class="keyword" id="2878838">struct</span>&nbsp;<span class="op" id="2878845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2878848">err</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2878855">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2878862">enc</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2878869">*</span><span class="ident" id="2878870">Encoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2878880">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2878887">io</span><span class="op" id="2878889">.</span><span class="ident" id="2878890">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2878898">end</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2878905">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2878916">//&nbsp;saw&nbsp;end&nbsp;of&nbsp;message</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2878939">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2878946">[</span><span class="num" id="2878947">1024</span><span class="op" id="2878951">]</span><span class="builtintype" id="2878952">byte</span>&nbsp;<span class="comment" id="2878957">//&nbsp;leftover&nbsp;input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2878976">nbuf</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2878983">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2878988">out</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2878995">[</span><span class="op" id="2878996">]</span><span class="builtintype" id="2878997">byte</span>&nbsp;<span class="comment" id="2879002">//&nbsp;leftover&nbsp;decoded&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2879030">outbuf</span>&nbsp;<span class="op" id="2879037">[</span><span class="num" id="2879038">1024</span>&nbsp;<span class="op" id="2879043">/</span>&nbsp;<span class="num" id="2879045">4</span>&nbsp;<span class="op" id="2879047">*</span>&nbsp;<span class="num" id="2879049">3</span><span class="op" id="2879050">]</span><span class="builtintype" id="2879051">byte</span><br>
<span class="lineno"></span><span class="op" id="2879056">}</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span><span class="keyword" id="2879059">func</span>&nbsp;<span class="op" id="2879064">(</span><span class="ident" id="2879065">d</span>&nbsp;<span class="op" id="2879067">*</span><span class="ident" id="2879068">decoder</span><span class="op" id="2879075">)</span>&nbsp;<span class="ident" id="2879077">Read</span><span class="op" id="2879081">(</span><span class="ident" id="2879082">p</span>&nbsp;<span class="op" id="2879084">[</span><span class="op" id="2879085">]</span><span class="builtintype" id="2879086">byte</span><span class="op" id="2879090">)</span>&nbsp;<span class="op" id="2879092">(</span><span class="ident" id="2879093">n</span>&nbsp;<span class="builtintype" id="2879095">int</span><span class="op" id="2879098">,</span>&nbsp;<span class="ident" id="2879100">err</span>&nbsp;<span class="builtintype" id="2879104">error</span><span class="op" id="2879109">)</span>&nbsp;<span class="op" id="2879111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2879114">if</span>&nbsp;<span class="ident" id="2879117">d</span><span class="op" id="2879118">.</span><span class="ident" id="2879119">err</span>&nbsp;<span class="op" id="2879123">!=</span>&nbsp;<span class="ident" id="2879126">nil</span>&nbsp;<span class="op" id="2879130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2879134">return</span>&nbsp;<span class="num" id="2879141">0</span><span class="op" id="2879142">,</span>&nbsp;<span class="ident" id="2879144">d</span><span class="op" id="2879145">.</span><span class="ident" id="2879146">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2879151">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2879155">//&nbsp;Use&nbsp;leftover&nbsp;decoded&nbsp;output&nbsp;from&nbsp;last&nbsp;read.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2879203">if</span>&nbsp;<span class="builtinfunc" id="2879206">len</span><span class="op" id="2879209">(</span><span class="ident" id="2879210">d</span><span class="op" id="2879211">.</span><span class="ident" id="2879212">out</span><span class="op" id="2879215">)</span>&nbsp;<span class="op" id="2879217">&gt;</span>&nbsp;<span class="num" id="2879219">0</span>&nbsp;<span class="op" id="2879221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2879225">n</span>&nbsp;<span class="op" id="2879227">=</span>&nbsp;<span class="builtinfunc" id="2879229">copy</span><span class="op" id="2879233">(</span><span class="ident" id="2879234">p</span><span class="op" id="2879235">,</span>&nbsp;<span class="ident" id="2879237">d</span><span class="op" id="2879238">.</span><span class="ident" id="2879239">out</span><span class="op" id="2879242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2879246">d</span><span class="op" id="2879247">.</span><span class="ident" id="2879248">out</span>&nbsp;<span class="op" id="2879252">=</span>&nbsp;<span class="ident" id="2879254">d</span><span class="op" id="2879255">.</span><span class="ident" id="2879256">out</span><span class="op" id="2879259">[</span><span class="ident" id="2879260">n</span><span class="op" id="2879261">:</span><span class="op" id="2879262">]</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2879266">return</span>&nbsp;<span class="ident" id="2879273">n</span><span class="op" id="2879274">,</span>&nbsp;<span class="ident" id="2879276">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2879281">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2879285">//&nbsp;Read&nbsp;a&nbsp;chunk.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2879303">nn</span>&nbsp;<span class="op" id="2879306">:=</span>&nbsp;<span class="builtinfunc" id="2879309">len</span><span class="op" id="2879312">(</span><span class="ident" id="2879313">p</span><span class="op" id="2879314">)</span>&nbsp;<span class="op" id="2879316">/</span>&nbsp;<span class="num" id="2879318">3</span>&nbsp;<span class="op" id="2879320">*</span>&nbsp;<span class="num" id="2879322">4</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2879325">if</span>&nbsp;<span class="ident" id="2879328">nn</span>&nbsp;<span class="op" id="2879331">&lt;</span>&nbsp;<span class="num" id="2879333">4</span>&nbsp;<span class="op" id="2879335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2879339">nn</span>&nbsp;<span class="op" id="2879342">=</span>&nbsp;<span class="num" id="2879344">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2879347">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2879350">if</span>&nbsp;<span class="ident" id="2879353">nn</span>&nbsp;<span class="op" id="2879356">&gt;</span>&nbsp;<span class="builtinfunc" id="2879358">len</span><span class="op" id="2879361">(</span><span class="ident" id="2879362">d</span><span class="op" id="2879363">.</span><span class="ident" id="2879364">buf</span><span class="op" id="2879367">)</span>&nbsp;<span class="op" id="2879369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2879373">nn</span>&nbsp;<span class="op" id="2879376">=</span>&nbsp;<span class="builtinfunc" id="2879378">len</span><span class="op" id="2879381">(</span><span class="ident" id="2879382">d</span><span class="op" id="2879383">.</span><span class="ident" id="2879384">buf</span><span class="op" id="2879387">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2879390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2879393">nn</span><span class="op" id="2879395">,</span>&nbsp;<span class="ident" id="2879397">d</span><span class="op" id="2879398">.</span><span class="ident" id="2879399">err</span>&nbsp;<span class="op" id="2879403">=</span>&nbsp;<span class="ident" id="2879405">io</span><span class="op" id="2879407">.</span><span class="ident" id="2879408">ReadAtLeast</span><span class="op" id="2879419">(</span><span class="ident" id="2879420">d</span><span class="op" id="2879421">.</span><span class="ident" id="2879422">r</span><span class="op" id="2879423">,</span>&nbsp;<span class="ident" id="2879425">d</span><span class="op" id="2879426">.</span><span class="ident" id="2879427">buf</span><span class="op" id="2879430">[</span><span class="ident" id="2879431">d</span><span class="op" id="2879432">.</span><span class="ident" id="2879433">nbuf</span><span class="op" id="2879437">:</span><span class="ident" id="2879438">nn</span><span class="op" id="2879440">]</span><span class="op" id="2879441">,</span>&nbsp;<span class="num" id="2879443">4</span><span class="op" id="2879444">-</span><span class="ident" id="2879445">d</span><span class="op" id="2879446">.</span><span class="ident" id="2879447">nbuf</span><span class="op" id="2879451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2879454">d</span><span class="op" id="2879455">.</span><span class="ident" id="2879456">nbuf</span>&nbsp;<span class="op" id="2879461">+=</span>&nbsp;<span class="ident" id="2879464">nn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2879468">if</span>&nbsp;<span class="ident" id="2879471">d</span><span class="op" id="2879472">.</span><span class="ident" id="2879473">err</span>&nbsp;<span class="op" id="2879477">!=</span>&nbsp;<span class="ident" id="2879480">nil</span>&nbsp;<span class="op" id="2879484">||</span>&nbsp;<span class="ident" id="2879487">d</span><span class="op" id="2879488">.</span><span class="ident" id="2879489">nbuf</span>&nbsp;<span class="op" id="2879494">&lt;</span>&nbsp;<span class="num" id="2879496">4</span>&nbsp;<span class="op" id="2879498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2879502">return</span>&nbsp;<span class="num" id="2879509">0</span><span class="op" id="2879510">,</span>&nbsp;<span class="ident" id="2879512">d</span><span class="op" id="2879513">.</span><span class="ident" id="2879514">err</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2879519">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2879523">//&nbsp;Decode&nbsp;chunk&nbsp;into&nbsp;p,&nbsp;or&nbsp;d.out&nbsp;and&nbsp;then&nbsp;p&nbsp;if&nbsp;p&nbsp;is&nbsp;too&nbsp;small.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2879587">nr</span>&nbsp;<span class="op" id="2879590">:=</span>&nbsp;<span class="ident" id="2879593">d</span><span class="op" id="2879594">.</span><span class="ident" id="2879595">nbuf</span>&nbsp;<span class="op" id="2879600">/</span>&nbsp;<span class="num" id="2879602">4</span>&nbsp;<span class="op" id="2879604">*</span>&nbsp;<span class="num" id="2879606">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2879609">nw</span>&nbsp;<span class="op" id="2879612">:=</span>&nbsp;<span class="ident" id="2879615">d</span><span class="op" id="2879616">.</span><span class="ident" id="2879617">nbuf</span>&nbsp;<span class="op" id="2879622">/</span>&nbsp;<span class="num" id="2879624">4</span>&nbsp;<span class="op" id="2879626">*</span>&nbsp;<span class="num" id="2879628">3</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2879631">if</span>&nbsp;<span class="ident" id="2879634">nw</span>&nbsp;<span class="op" id="2879637">&gt;</span>&nbsp;<span class="builtinfunc" id="2879639">len</span><span class="op" id="2879642">(</span><span class="ident" id="2879643">p</span><span class="op" id="2879644">)</span>&nbsp;<span class="op" id="2879646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2879650">nw</span><span class="op" id="2879652">,</span>&nbsp;<span class="ident" id="2879654">d</span><span class="op" id="2879655">.</span><span class="ident" id="2879656">end</span><span class="op" id="2879659">,</span>&nbsp;<span class="ident" id="2879661">d</span><span class="op" id="2879662">.</span><span class="ident" id="2879663">err</span>&nbsp;<span class="op" id="2879667">=</span>&nbsp;<span class="ident" id="2879669">d</span><span class="op" id="2879670">.</span><span class="ident" id="2879671">enc</span><span class="op" id="2879674">.</span><span class="ident" id="2879675">decode</span><span class="op" id="2879681">(</span><span class="ident" id="2879682">d</span><span class="op" id="2879683">.</span><span class="ident" id="2879684">outbuf</span><span class="op" id="2879690">[</span><span class="num" id="2879691">0</span><span class="op" id="2879692">:</span><span class="op" id="2879693">]</span><span class="op" id="2879694">,</span>&nbsp;<span class="ident" id="2879696">d</span><span class="op" id="2879697">.</span><span class="ident" id="2879698">buf</span><span class="op" id="2879701">[</span><span class="num" id="2879702">0</span><span class="op" id="2879703">:</span><span class="ident" id="2879704">nr</span><span class="op" id="2879706">]</span><span class="op" id="2879707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2879711">d</span><span class="op" id="2879712">.</span><span class="ident" id="2879713">out</span>&nbsp;<span class="op" id="2879717">=</span>&nbsp;<span class="ident" id="2879719">d</span><span class="op" id="2879720">.</span><span class="ident" id="2879721">outbuf</span><span class="op" id="2879727">[</span><span class="num" id="2879728">0</span><span class="op" id="2879729">:</span><span class="ident" id="2879730">nw</span><span class="op" id="2879732">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2879736">n</span>&nbsp;<span class="op" id="2879738">=</span>&nbsp;<span class="builtinfunc" id="2879740">copy</span><span class="op" id="2879744">(</span><span class="ident" id="2879745">p</span><span class="op" id="2879746">,</span>&nbsp;<span class="ident" id="2879748">d</span><span class="op" id="2879749">.</span><span class="ident" id="2879750">out</span><span class="op" id="2879753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2879757">d</span><span class="op" id="2879758">.</span><span class="ident" id="2879759">out</span>&nbsp;<span class="op" id="2879763">=</span>&nbsp;<span class="ident" id="2879765">d</span><span class="op" id="2879766">.</span><span class="ident" id="2879767">out</span><span class="op" id="2879770">[</span><span class="ident" id="2879771">n</span><span class="op" id="2879772">:</span><span class="op" id="2879773">]</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2879776">}</span>&nbsp;<span class="keyword" id="2879778">else</span>&nbsp;<span class="op" id="2879783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2879787">n</span><span class="op" id="2879788">,</span>&nbsp;<span class="ident" id="2879790">d</span><span class="op" id="2879791">.</span><span class="ident" id="2879792">end</span><span class="op" id="2879795">,</span>&nbsp;<span class="ident" id="2879797">d</span><span class="op" id="2879798">.</span><span class="ident" id="2879799">err</span>&nbsp;<span class="op" id="2879803">=</span>&nbsp;<span class="ident" id="2879805">d</span><span class="op" id="2879806">.</span><span class="ident" id="2879807">enc</span><span class="op" id="2879810">.</span><span class="ident" id="2879811">decode</span><span class="op" id="2879817">(</span><span class="ident" id="2879818">p</span><span class="op" id="2879819">,</span>&nbsp;<span class="ident" id="2879821">d</span><span class="op" id="2879822">.</span><span class="ident" id="2879823">buf</span><span class="op" id="2879826">[</span><span class="num" id="2879827">0</span><span class="op" id="2879828">:</span><span class="ident" id="2879829">nr</span><span class="op" id="2879831">]</span><span class="op" id="2879832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2879835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2879838">d</span><span class="op" id="2879839">.</span><span class="ident" id="2879840">nbuf</span>&nbsp;<span class="op" id="2879845">-=</span>&nbsp;<span class="ident" id="2879848">nr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2879852">for</span>&nbsp;<span class="ident" id="2879856">i</span>&nbsp;<span class="op" id="2879858">:=</span>&nbsp;<span class="num" id="2879861">0</span><span class="op" id="2879862">;</span>&nbsp;<span class="ident" id="2879864">i</span>&nbsp;<span class="op" id="2879866">&lt;</span>&nbsp;<span class="ident" id="2879868">d</span><span class="op" id="2879869">.</span><span class="ident" id="2879870">nbuf</span><span class="op" id="2879874">;</span>&nbsp;<span class="ident" id="2879876">i</span><span class="op" id="2879877">++</span>&nbsp;<span class="op" id="2879880">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2879884">d</span><span class="op" id="2879885">.</span><span class="ident" id="2879886">buf</span><span class="op" id="2879889">[</span><span class="ident" id="2879890">i</span><span class="op" id="2879891">]</span>&nbsp;<span class="op" id="2879893">=</span>&nbsp;<span class="ident" id="2879895">d</span><span class="op" id="2879896">.</span><span class="ident" id="2879897">buf</span><span class="op" id="2879900">[</span><span class="ident" id="2879901">i</span><span class="op" id="2879902">+</span><span class="ident" id="2879903">nr</span><span class="op" id="2879905">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2879908">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2879912">if</span>&nbsp;<span class="ident" id="2879915">d</span><span class="op" id="2879916">.</span><span class="ident" id="2879917">err</span>&nbsp;<span class="op" id="2879921">==</span>&nbsp;<span class="ident" id="2879924">nil</span>&nbsp;<span class="op" id="2879928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2879932">d</span><span class="op" id="2879933">.</span><span class="ident" id="2879934">err</span>&nbsp;<span class="op" id="2879938">=</span>&nbsp;<span class="ident" id="2879940">err</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2879945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2879948">return</span>&nbsp;<span class="ident" id="2879955">n</span><span class="op" id="2879956">,</span>&nbsp;<span class="ident" id="2879958">d</span><span class="op" id="2879959">.</span><span class="ident" id="2879960">err</span><br>
<span class="lineno"></span><span class="op" id="2879964">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2879967">type</span>&nbsp;<span class="ident" id="2879972">newlineFilteringReader</span>&nbsp;<span class="keyword" id="2879995">struct</span>&nbsp;<span class="op" id="2880002">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2880005">wrapped</span>&nbsp;<span class="ident" id="2880013">io</span><span class="op" id="2880015">.</span><span class="ident" id="2880016">Reader</span><br>
<span class="lineno"></span><span class="op" id="2880023">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2880026">func</span>&nbsp;<span class="op" id="2880031">(</span><span class="ident" id="2880032">r</span>&nbsp;<span class="op" id="2880034">*</span><span class="ident" id="2880035">newlineFilteringReader</span><span class="op" id="2880057">)</span>&nbsp;<span class="ident" id="2880059">Read</span><span class="op" id="2880063">(</span><span class="ident" id="2880064">p</span>&nbsp;<span class="op" id="2880066">[</span><span class="op" id="2880067">]</span><span class="builtintype" id="2880068">byte</span><span class="op" id="2880072">)</span>&nbsp;<span class="op" id="2880074">(</span><span class="builtintype" id="2880075">int</span><span class="op" id="2880078">,</span>&nbsp;<span class="builtintype" id="2880080">error</span><span class="op" id="2880085">)</span>&nbsp;<span class="op" id="2880087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2880090">n</span><span class="op" id="2880091">,</span>&nbsp;<span class="ident" id="2880093">err</span>&nbsp;<span class="op" id="2880097">:=</span>&nbsp;<span class="ident" id="2880100">r</span><span class="op" id="2880101">.</span><span class="ident" id="2880102">wrapped</span><span class="op" id="2880109">.</span><span class="ident" id="2880110">Read</span><span class="op" id="2880114">(</span><span class="ident" id="2880115">p</span><span class="op" id="2880116">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2880119">for</span>&nbsp;<span class="ident" id="2880123">n</span>&nbsp;<span class="op" id="2880125">&gt;</span>&nbsp;<span class="num" id="2880127">0</span>&nbsp;<span class="op" id="2880129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2880133">offset</span>&nbsp;<span class="op" id="2880140">:=</span>&nbsp;<span class="num" id="2880143">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2880147">for</span>&nbsp;<span class="ident" id="2880151">i</span><span class="op" id="2880152">,</span>&nbsp;<span class="ident" id="2880154">b</span>&nbsp;<span class="op" id="2880156">:=</span>&nbsp;<span class="keyword" id="2880159">range</span>&nbsp;<span class="ident" id="2880165">p</span><span class="op" id="2880166">[</span><span class="num" id="2880167">0</span><span class="op" id="2880168">:</span><span class="ident" id="2880169">n</span><span class="op" id="2880170">]</span>&nbsp;<span class="op" id="2880172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2880177">if</span>&nbsp;<span class="ident" id="2880180">b</span>&nbsp;<span class="op" id="2880182">!=</span>&nbsp;<span class="string" id="2880185">&#39;\r&#39;</span>&nbsp;<span class="op" id="2880190">&amp;&amp;</span>&nbsp;<span class="ident" id="2880193">b</span>&nbsp;<span class="op" id="2880195">!=</span>&nbsp;<span class="string" id="2880198">&#39;\n&#39;</span>&nbsp;<span class="op" id="2880203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2880209">if</span>&nbsp;<span class="ident" id="2880212">i</span>&nbsp;<span class="op" id="2880214">!=</span>&nbsp;<span class="ident" id="2880217">offset</span>&nbsp;<span class="op" id="2880224">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2880231">p</span><span class="op" id="2880232">[</span><span class="ident" id="2880233">offset</span><span class="op" id="2880239">]</span>&nbsp;<span class="op" id="2880241">=</span>&nbsp;<span class="ident" id="2880243">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2880249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2880255">offset</span><span class="op" id="2880261">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2880267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2880271">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2880275">if</span>&nbsp;<span class="ident" id="2880278">offset</span>&nbsp;<span class="op" id="2880285">&gt;</span>&nbsp;<span class="num" id="2880287">0</span>&nbsp;<span class="op" id="2880289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2880294">return</span>&nbsp;<span class="ident" id="2880301">offset</span><span class="op" id="2880307">,</span>&nbsp;<span class="ident" id="2880309">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2880315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2880319">//&nbsp;Previous&nbsp;buffer&nbsp;entirely&nbsp;whitespace,&nbsp;read&nbsp;again</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2880372">n</span><span class="op" id="2880373">,</span>&nbsp;<span class="ident" id="2880375">err</span>&nbsp;<span class="op" id="2880379">=</span>&nbsp;<span class="ident" id="2880381">r</span><span class="op" id="2880382">.</span><span class="ident" id="2880383">wrapped</span><span class="op" id="2880390">.</span><span class="ident" id="2880391">Read</span><span class="op" id="2880395">(</span><span class="ident" id="2880396">p</span><span class="op" id="2880397">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2880400">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2880403">return</span>&nbsp;<span class="ident" id="2880410">n</span><span class="op" id="2880411">,</span>&nbsp;<span class="ident" id="2880413">err</span><br>
<span class="lineno"></span><span class="op" id="2880417">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2880420">//&nbsp;NewDecoder&nbsp;constructs&nbsp;a&nbsp;new&nbsp;base64&nbsp;stream&nbsp;decoder.</span><br>
<span class="lineno">385</span><span class="keyword" id="2880474">func</span>&nbsp;<span class="ident" id="2880479">NewDecoder</span><span class="op" id="2880489">(</span><span class="ident" id="2880490">enc</span>&nbsp;<span class="op" id="2880494">*</span><span class="ident" id="2880495">Encoding</span><span class="op" id="2880503">,</span>&nbsp;<span class="ident" id="2880505">r</span>&nbsp;<span class="ident" id="2880507">io</span><span class="op" id="2880509">.</span><span class="ident" id="2880510">Reader</span><span class="op" id="2880516">)</span>&nbsp;<span class="ident" id="2880518">io</span><span class="op" id="2880520">.</span><span class="ident" id="2880521">Reader</span>&nbsp;<span class="op" id="2880528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2880531">return</span>&nbsp;<span class="op" id="2880538">&amp;</span><span class="ident" id="2880539">decoder</span><span class="op" id="2880546">{</span><span class="ident" id="2880547">enc</span><span class="op" id="2880550">:</span>&nbsp;<span class="ident" id="2880552">enc</span><span class="op" id="2880555">,</span>&nbsp;<span class="ident" id="2880557">r</span><span class="op" id="2880558">:</span>&nbsp;<span class="op" id="2880560">&amp;</span><span class="ident" id="2880561">newlineFilteringReader</span><span class="op" id="2880583">{</span><span class="ident" id="2880584">r</span><span class="op" id="2880585">}</span><span class="op" id="2880586">}</span><br>
<span class="lineno"></span><span class="op" id="2880588">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2880591">//&nbsp;DecodedLen&nbsp;returns&nbsp;the&nbsp;maximum&nbsp;length&nbsp;in&nbsp;bytes&nbsp;of&nbsp;the&nbsp;decoded&nbsp;data</span><br>
<span class="lineno">390</span><span class="comment" id="2880661">//&nbsp;corresponding&nbsp;to&nbsp;n&nbsp;bytes&nbsp;of&nbsp;base64-encoded&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="2880713">func</span>&nbsp;<span class="op" id="2880718">(</span><span class="ident" id="2880719">enc</span>&nbsp;<span class="op" id="2880723">*</span><span class="ident" id="2880724">Encoding</span><span class="op" id="2880732">)</span>&nbsp;<span class="ident" id="2880734">DecodedLen</span><span class="op" id="2880744">(</span><span class="ident" id="2880745">n</span>&nbsp;<span class="builtintype" id="2880747">int</span><span class="op" id="2880750">)</span>&nbsp;<span class="builtintype" id="2880752">int</span>&nbsp;<span class="op" id="2880756">{</span>&nbsp;<span class="keyword" id="2880758">return</span>&nbsp;<span class="ident" id="2880765">n</span>&nbsp;<span class="op" id="2880767">/</span>&nbsp;<span class="num" id="2880769">4</span>&nbsp;<span class="op" id="2880771">*</span>&nbsp;<span class="num" id="2880773">3</span>&nbsp;<span class="op" id="2880775">}</span>
</div>
</body>
</html>
