<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3633424">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3633480">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3633534">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3633585">package</span>&nbsp;<span class="ident" id="3633593">http</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3633599">import</span>&nbsp;<span class="op" id="3633606">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3633609">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3633618">&#34;encoding/binary&#34;</span><br>
<span class="lineno">10</span><span class="op" id="3633636">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3633639">//&nbsp;The&nbsp;algorithm&nbsp;uses&nbsp;at&nbsp;most&nbsp;sniffLen&nbsp;bytes&nbsp;to&nbsp;make&nbsp;its&nbsp;decision.</span><br>
<span class="lineno"></span><span class="keyword" id="3633706">const</span>&nbsp;<span class="ident" id="3633712">sniffLen</span>&nbsp;<span class="op" id="3633721">=</span>&nbsp;<span class="num" id="3633723">512</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="3633728">//&nbsp;DetectContentType&nbsp;implements&nbsp;the&nbsp;algorithm&nbsp;described</span><br>
<span class="lineno"></span><span class="comment" id="3633784">//&nbsp;at&nbsp;http://mimesniff.spec.whatwg.org/&nbsp;to&nbsp;determine&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3633841">//&nbsp;Content-Type&nbsp;of&nbsp;the&nbsp;given&nbsp;data.&nbsp;&nbsp;It&nbsp;considers&nbsp;at&nbsp;most&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3633902">//&nbsp;first&nbsp;512&nbsp;bytes&nbsp;of&nbsp;data.&nbsp;&nbsp;DetectContentType&nbsp;always&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="3633964">//&nbsp;a&nbsp;valid&nbsp;MIME&nbsp;type:&nbsp;if&nbsp;it&nbsp;cannot&nbsp;determine&nbsp;a&nbsp;more&nbsp;specific&nbsp;one,&nbsp;it</span><br>
<span class="lineno">20</span><span class="comment" id="3634033">//&nbsp;returns&nbsp;&#34;application/octet-stream&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3634072">func</span>&nbsp;<span class="ident" id="3634077">DetectContentType</span><span class="op" id="3634094">(</span><span class="ident" id="3634095">data</span>&nbsp;<span class="op" id="3634100">[</span><span class="op" id="3634101">]</span><span class="builtintype" id="3634102">byte</span><span class="op" id="3634106">)</span>&nbsp;<span class="builtintype" id="3634108">string</span>&nbsp;<span class="op" id="3634115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3634118">if</span>&nbsp;<span class="builtinfunc" id="3634121">len</span><span class="op" id="3634124">(</span><span class="ident" id="3634125">data</span><span class="op" id="3634129">)</span>&nbsp;<span class="op" id="3634131">&gt;</span>&nbsp;<span class="ident" id="3634133">sniffLen</span>&nbsp;<span class="op" id="3634142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3634146">data</span>&nbsp;<span class="op" id="3634151">=</span>&nbsp;<span class="ident" id="3634153">data</span><span class="op" id="3634157">[</span><span class="op" id="3634158">:</span><span class="ident" id="3634159">sniffLen</span><span class="op" id="3634167">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3634170">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3634174">//&nbsp;Index&nbsp;of&nbsp;the&nbsp;first&nbsp;non-whitespace&nbsp;byte&nbsp;in&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3634226">firstNonWS</span>&nbsp;<span class="op" id="3634237">:=</span>&nbsp;<span class="num" id="3634240">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3634243">for</span>&nbsp;<span class="op" id="3634247">;</span>&nbsp;<span class="ident" id="3634249">firstNonWS</span>&nbsp;<span class="op" id="3634260">&lt;</span>&nbsp;<span class="builtinfunc" id="3634262">len</span><span class="op" id="3634265">(</span><span class="ident" id="3634266">data</span><span class="op" id="3634270">)</span>&nbsp;<span class="op" id="3634272">&amp;&amp;</span>&nbsp;<span class="ident" id="3634275">isWS</span><span class="op" id="3634279">(</span><span class="ident" id="3634280">data</span><span class="op" id="3634284">[</span><span class="ident" id="3634285">firstNonWS</span><span class="op" id="3634295">]</span><span class="op" id="3634296">)</span><span class="op" id="3634297">;</span>&nbsp;<span class="ident" id="3634299">firstNonWS</span><span class="op" id="3634309">++</span>&nbsp;<span class="op" id="3634312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3634315">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3634319">for</span>&nbsp;<span class="ident" id="3634323">_</span><span class="op" id="3634324">,</span>&nbsp;<span class="ident" id="3634326">sig</span>&nbsp;<span class="op" id="3634330">:=</span>&nbsp;<span class="keyword" id="3634333">range</span>&nbsp;<span class="ident" id="3634339">sniffSignatures</span>&nbsp;<span class="op" id="3634355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3634359">if</span>&nbsp;<span class="ident" id="3634362">ct</span>&nbsp;<span class="op" id="3634365">:=</span>&nbsp;<span class="ident" id="3634368">sig</span><span class="op" id="3634371">.</span><span class="ident" id="3634372">match</span><span class="op" id="3634377">(</span><span class="ident" id="3634378">data</span><span class="op" id="3634382">,</span>&nbsp;<span class="ident" id="3634384">firstNonWS</span><span class="op" id="3634394">)</span><span class="op" id="3634395">;</span>&nbsp;<span class="ident" id="3634397">ct</span>&nbsp;<span class="op" id="3634400">!=</span>&nbsp;<span class="string" id="3634403">&#34;&#34;</span>&nbsp;<span class="op" id="3634406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3634411">return</span>&nbsp;<span class="ident" id="3634418">ct</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3634423">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3634426">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3634430">return</span>&nbsp;<span class="string" id="3634437">&#34;application/octet-stream&#34;</span>&nbsp;<span class="comment" id="3634464">//&nbsp;fallback</span><br>
<span class="lineno"></span><span class="op" id="3634476">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="3634479">func</span>&nbsp;<span class="ident" id="3634484">isWS</span><span class="op" id="3634488">(</span><span class="ident" id="3634489">b</span>&nbsp;<span class="builtintype" id="3634491">byte</span><span class="op" id="3634495">)</span>&nbsp;<span class="builtintype" id="3634497">bool</span>&nbsp;<span class="op" id="3634502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3634505">return</span>&nbsp;<span class="ident" id="3634512">bytes</span><span class="op" id="3634517">.</span><span class="ident" id="3634518">IndexByte</span><span class="op" id="3634527">(</span><span class="op" id="3634528">[</span><span class="op" id="3634529">]</span><span class="builtintype" id="3634530">byte</span><span class="op" id="3634534">(</span><span class="string" id="3634535">&#34;\t\n\x0C\r&nbsp;&#34;</span><span class="op" id="3634548">)</span><span class="op" id="3634549">,</span>&nbsp;<span class="ident" id="3634551">b</span><span class="op" id="3634552">)</span>&nbsp;<span class="op" id="3634554">!=</span>&nbsp;<span class="op" id="3634557">-</span><span class="num" id="3634558">1</span><br>
<span class="lineno"></span><span class="op" id="3634560">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3634563">type</span>&nbsp;<span class="ident" id="3634568">sniffSig</span>&nbsp;<span class="keyword" id="3634577">interface</span>&nbsp;<span class="op" id="3634587">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3634590">//&nbsp;match&nbsp;returns&nbsp;the&nbsp;MIME&nbsp;type&nbsp;of&nbsp;the&nbsp;data,&nbsp;or&nbsp;&#34;&#34;&nbsp;if&nbsp;unknown.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3634653">match</span><span class="op" id="3634658">(</span><span class="ident" id="3634659">data</span>&nbsp;<span class="op" id="3634664">[</span><span class="op" id="3634665">]</span><span class="builtintype" id="3634666">byte</span><span class="op" id="3634670">,</span>&nbsp;<span class="ident" id="3634672">firstNonWS</span>&nbsp;<span class="builtintype" id="3634683">int</span><span class="op" id="3634686">)</span>&nbsp;<span class="builtintype" id="3634688">string</span><br>
<span class="lineno"></span><span class="op" id="3634695">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3634698">//&nbsp;Data&nbsp;matching&nbsp;the&nbsp;table&nbsp;in&nbsp;section&nbsp;6.</span><br>
<span class="lineno">50</span><span class="keyword" id="3634739">var</span>&nbsp;<span class="ident" id="3634743">sniffSignatures</span>&nbsp;<span class="op" id="3634759">=</span>&nbsp;<span class="op" id="3634761">[</span><span class="op" id="3634762">]</span><span class="ident" id="3634763">sniffSig</span><span class="op" id="3634771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3634774">htmlSig</span><span class="op" id="3634781">(</span><span class="string" id="3634782">&#34;&lt;!DOCTYPE&nbsp;HTML&#34;</span><span class="op" id="3634798">)</span><span class="op" id="3634799">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3634802">htmlSig</span><span class="op" id="3634809">(</span><span class="string" id="3634810">&#34;&lt;HTML&#34;</span><span class="op" id="3634817">)</span><span class="op" id="3634818">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3634821">htmlSig</span><span class="op" id="3634828">(</span><span class="string" id="3634829">&#34;&lt;HEAD&#34;</span><span class="op" id="3634836">)</span><span class="op" id="3634837">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3634840">htmlSig</span><span class="op" id="3634847">(</span><span class="string" id="3634848">&#34;&lt;SCRIPT&#34;</span><span class="op" id="3634857">)</span><span class="op" id="3634858">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3634861">htmlSig</span><span class="op" id="3634868">(</span><span class="string" id="3634869">&#34;&lt;IFRAME&#34;</span><span class="op" id="3634878">)</span><span class="op" id="3634879">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3634882">htmlSig</span><span class="op" id="3634889">(</span><span class="string" id="3634890">&#34;&lt;H1&#34;</span><span class="op" id="3634895">)</span><span class="op" id="3634896">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3634899">htmlSig</span><span class="op" id="3634906">(</span><span class="string" id="3634907">&#34;&lt;DIV&#34;</span><span class="op" id="3634913">)</span><span class="op" id="3634914">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3634917">htmlSig</span><span class="op" id="3634924">(</span><span class="string" id="3634925">&#34;&lt;FONT&#34;</span><span class="op" id="3634932">)</span><span class="op" id="3634933">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3634936">htmlSig</span><span class="op" id="3634943">(</span><span class="string" id="3634944">&#34;&lt;TABLE&#34;</span><span class="op" id="3634952">)</span><span class="op" id="3634953">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3634956">htmlSig</span><span class="op" id="3634963">(</span><span class="string" id="3634964">&#34;&lt;A&#34;</span><span class="op" id="3634968">)</span><span class="op" id="3634969">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3634972">htmlSig</span><span class="op" id="3634979">(</span><span class="string" id="3634980">&#34;&lt;STYLE&#34;</span><span class="op" id="3634988">)</span><span class="op" id="3634989">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3634992">htmlSig</span><span class="op" id="3634999">(</span><span class="string" id="3635000">&#34;&lt;TITLE&#34;</span><span class="op" id="3635008">)</span><span class="op" id="3635009">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3635012">htmlSig</span><span class="op" id="3635019">(</span><span class="string" id="3635020">&#34;&lt;B&#34;</span><span class="op" id="3635024">)</span><span class="op" id="3635025">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3635028">htmlSig</span><span class="op" id="3635035">(</span><span class="string" id="3635036">&#34;&lt;BODY&#34;</span><span class="op" id="3635043">)</span><span class="op" id="3635044">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3635047">htmlSig</span><span class="op" id="3635054">(</span><span class="string" id="3635055">&#34;&lt;BR&#34;</span><span class="op" id="3635060">)</span><span class="op" id="3635061">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3635064">htmlSig</span><span class="op" id="3635071">(</span><span class="string" id="3635072">&#34;&lt;P&#34;</span><span class="op" id="3635076">)</span><span class="op" id="3635077">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3635080">htmlSig</span><span class="op" id="3635087">(</span><span class="string" id="3635088">&#34;&lt;!--&#34;</span><span class="op" id="3635094">)</span><span class="op" id="3635095">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3635099">&amp;</span><span class="ident" id="3635100">maskedSig</span><span class="op" id="3635109">{</span><span class="ident" id="3635110">mask</span><span class="op" id="3635114">:</span>&nbsp;<span class="op" id="3635116">[</span><span class="op" id="3635117">]</span><span class="builtintype" id="3635118">byte</span><span class="op" id="3635122">(</span><span class="string" id="3635123">&#34;\xFF\xFF\xFF\xFF\xFF&#34;</span><span class="op" id="3635145">)</span><span class="op" id="3635146">,</span>&nbsp;<span class="ident" id="3635148">pat</span><span class="op" id="3635151">:</span>&nbsp;<span class="op" id="3635153">[</span><span class="op" id="3635154">]</span><span class="builtintype" id="3635155">byte</span><span class="op" id="3635159">(</span><span class="string" id="3635160">&#34;&lt;?xml&#34;</span><span class="op" id="3635167">)</span><span class="op" id="3635168">,</span>&nbsp;<span class="ident" id="3635170">skipWS</span><span class="op" id="3635176">:</span>&nbsp;<span class="ident" id="3635178">true</span><span class="op" id="3635182">,</span>&nbsp;<span class="ident" id="3635184">ct</span><span class="op" id="3635186">:</span>&nbsp;<span class="string" id="3635188">&#34;text/xml;&nbsp;charset=utf-8&#34;</span><span class="op" id="3635213">}</span><span class="op" id="3635214">,</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3635218">&amp;</span><span class="ident" id="3635219">exactSig</span><span class="op" id="3635227">{</span><span class="op" id="3635228">[</span><span class="op" id="3635229">]</span><span class="builtintype" id="3635230">byte</span><span class="op" id="3635234">(</span><span class="string" id="3635235">&#34;%PDF-&#34;</span><span class="op" id="3635242">)</span><span class="op" id="3635243">,</span>&nbsp;<span class="string" id="3635245">&#34;application/pdf&#34;</span><span class="op" id="3635262">}</span><span class="op" id="3635263">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3635266">&amp;</span><span class="ident" id="3635267">exactSig</span><span class="op" id="3635275">{</span><span class="op" id="3635276">[</span><span class="op" id="3635277">]</span><span class="builtintype" id="3635278">byte</span><span class="op" id="3635282">(</span><span class="string" id="3635283">&#34;%!PS-Adobe-&#34;</span><span class="op" id="3635296">)</span><span class="op" id="3635297">,</span>&nbsp;<span class="string" id="3635299">&#34;application/postscript&#34;</span><span class="op" id="3635323">}</span><span class="op" id="3635324">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3635328">//&nbsp;UTF&nbsp;BOMs.</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3635342">&amp;</span><span class="ident" id="3635343">maskedSig</span><span class="op" id="3635352">{</span><span class="ident" id="3635353">mask</span><span class="op" id="3635357">:</span>&nbsp;<span class="op" id="3635359">[</span><span class="op" id="3635360">]</span><span class="builtintype" id="3635361">byte</span><span class="op" id="3635365">(</span><span class="string" id="3635366">&#34;\xFF\xFF\x00\x00&#34;</span><span class="op" id="3635384">)</span><span class="op" id="3635385">,</span>&nbsp;<span class="ident" id="3635387">pat</span><span class="op" id="3635390">:</span>&nbsp;<span class="op" id="3635392">[</span><span class="op" id="3635393">]</span><span class="builtintype" id="3635394">byte</span><span class="op" id="3635398">(</span><span class="string" id="3635399">&#34;\xFE\xFF\x00\x00&#34;</span><span class="op" id="3635417">)</span><span class="op" id="3635418">,</span>&nbsp;<span class="ident" id="3635420">ct</span><span class="op" id="3635422">:</span>&nbsp;<span class="string" id="3635424">&#34;text/plain;&nbsp;charset=utf-16be&#34;</span><span class="op" id="3635454">}</span><span class="op" id="3635455">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3635458">&amp;</span><span class="ident" id="3635459">maskedSig</span><span class="op" id="3635468">{</span><span class="ident" id="3635469">mask</span><span class="op" id="3635473">:</span>&nbsp;<span class="op" id="3635475">[</span><span class="op" id="3635476">]</span><span class="builtintype" id="3635477">byte</span><span class="op" id="3635481">(</span><span class="string" id="3635482">&#34;\xFF\xFF\x00\x00&#34;</span><span class="op" id="3635500">)</span><span class="op" id="3635501">,</span>&nbsp;<span class="ident" id="3635503">pat</span><span class="op" id="3635506">:</span>&nbsp;<span class="op" id="3635508">[</span><span class="op" id="3635509">]</span><span class="builtintype" id="3635510">byte</span><span class="op" id="3635514">(</span><span class="string" id="3635515">&#34;\xFF\xFE\x00\x00&#34;</span><span class="op" id="3635533">)</span><span class="op" id="3635534">,</span>&nbsp;<span class="ident" id="3635536">ct</span><span class="op" id="3635538">:</span>&nbsp;<span class="string" id="3635540">&#34;text/plain;&nbsp;charset=utf-16le&#34;</span><span class="op" id="3635570">}</span><span class="op" id="3635571">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3635574">&amp;</span><span class="ident" id="3635575">maskedSig</span><span class="op" id="3635584">{</span><span class="ident" id="3635585">mask</span><span class="op" id="3635589">:</span>&nbsp;<span class="op" id="3635591">[</span><span class="op" id="3635592">]</span><span class="builtintype" id="3635593">byte</span><span class="op" id="3635597">(</span><span class="string" id="3635598">&#34;\xFF\xFF\xFF\x00&#34;</span><span class="op" id="3635616">)</span><span class="op" id="3635617">,</span>&nbsp;<span class="ident" id="3635619">pat</span><span class="op" id="3635622">:</span>&nbsp;<span class="op" id="3635624">[</span><span class="op" id="3635625">]</span><span class="builtintype" id="3635626">byte</span><span class="op" id="3635630">(</span><span class="string" id="3635631">&#34;\xEF\xBB\xBF\x00&#34;</span><span class="op" id="3635649">)</span><span class="op" id="3635650">,</span>&nbsp;<span class="ident" id="3635652">ct</span><span class="op" id="3635654">:</span>&nbsp;<span class="string" id="3635656">&#34;text/plain;&nbsp;charset=utf-8&#34;</span><span class="op" id="3635683">}</span><span class="op" id="3635684">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3635688">&amp;</span><span class="ident" id="3635689">exactSig</span><span class="op" id="3635697">{</span><span class="op" id="3635698">[</span><span class="op" id="3635699">]</span><span class="builtintype" id="3635700">byte</span><span class="op" id="3635704">(</span><span class="string" id="3635705">&#34;GIF87a&#34;</span><span class="op" id="3635713">)</span><span class="op" id="3635714">,</span>&nbsp;<span class="string" id="3635716">&#34;image/gif&#34;</span><span class="op" id="3635727">}</span><span class="op" id="3635728">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3635731">&amp;</span><span class="ident" id="3635732">exactSig</span><span class="op" id="3635740">{</span><span class="op" id="3635741">[</span><span class="op" id="3635742">]</span><span class="builtintype" id="3635743">byte</span><span class="op" id="3635747">(</span><span class="string" id="3635748">&#34;GIF89a&#34;</span><span class="op" id="3635756">)</span><span class="op" id="3635757">,</span>&nbsp;<span class="string" id="3635759">&#34;image/gif&#34;</span><span class="op" id="3635770">}</span><span class="op" id="3635771">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3635774">&amp;</span><span class="ident" id="3635775">exactSig</span><span class="op" id="3635783">{</span><span class="op" id="3635784">[</span><span class="op" id="3635785">]</span><span class="builtintype" id="3635786">byte</span><span class="op" id="3635790">(</span><span class="string" id="3635791">&#34;\x89\x50\x4E\x47\x0D\x0A\x1A\x0A&#34;</span><span class="op" id="3635825">)</span><span class="op" id="3635826">,</span>&nbsp;<span class="string" id="3635828">&#34;image/png&#34;</span><span class="op" id="3635839">}</span><span class="op" id="3635840">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3635843">&amp;</span><span class="ident" id="3635844">exactSig</span><span class="op" id="3635852">{</span><span class="op" id="3635853">[</span><span class="op" id="3635854">]</span><span class="builtintype" id="3635855">byte</span><span class="op" id="3635859">(</span><span class="string" id="3635860">&#34;\xFF\xD8\xFF&#34;</span><span class="op" id="3635874">)</span><span class="op" id="3635875">,</span>&nbsp;<span class="string" id="3635877">&#34;image/jpeg&#34;</span><span class="op" id="3635889">}</span><span class="op" id="3635890">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3635893">&amp;</span><span class="ident" id="3635894">exactSig</span><span class="op" id="3635902">{</span><span class="op" id="3635903">[</span><span class="op" id="3635904">]</span><span class="builtintype" id="3635905">byte</span><span class="op" id="3635909">(</span><span class="string" id="3635910">&#34;BM&#34;</span><span class="op" id="3635914">)</span><span class="op" id="3635915">,</span>&nbsp;<span class="string" id="3635917">&#34;image/bmp&#34;</span><span class="op" id="3635928">}</span><span class="op" id="3635929">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3635932">&amp;</span><span class="ident" id="3635933">maskedSig</span><span class="op" id="3635942">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3635946">mask</span><span class="op" id="3635950">:</span>&nbsp;<span class="op" id="3635952">[</span><span class="op" id="3635953">]</span><span class="builtintype" id="3635954">byte</span><span class="op" id="3635958">(</span><span class="string" id="3635959">&#34;\xFF\xFF\xFF\xFF\x00\x00\x00\x00\xFF\xFF\xFF\xFF\xFF\xFF&#34;</span><span class="op" id="3636017">)</span><span class="op" id="3636018">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3636022">pat</span><span class="op" id="3636025">:</span>&nbsp;&nbsp;<span class="op" id="3636028">[</span><span class="op" id="3636029">]</span><span class="builtintype" id="3636030">byte</span><span class="op" id="3636034">(</span><span class="string" id="3636035">&#34;RIFF\x00\x00\x00\x00WEBPVP&#34;</span><span class="op" id="3636063">)</span><span class="op" id="3636064">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3636068">ct</span><span class="op" id="3636070">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="3636074">&#34;image/webp&#34;</span><span class="op" id="3636086">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3636089">}</span><span class="op" id="3636090">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3636093">&amp;</span><span class="ident" id="3636094">exactSig</span><span class="op" id="3636102">{</span><span class="op" id="3636103">[</span><span class="op" id="3636104">]</span><span class="builtintype" id="3636105">byte</span><span class="op" id="3636109">(</span><span class="string" id="3636110">&#34;\x00\x00\x01\x00&#34;</span><span class="op" id="3636128">)</span><span class="op" id="3636129">,</span>&nbsp;<span class="string" id="3636131">&#34;image/vnd.microsoft.icon&#34;</span><span class="op" id="3636157">}</span><span class="op" id="3636158">,</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3636161">&amp;</span><span class="ident" id="3636162">exactSig</span><span class="op" id="3636170">{</span><span class="op" id="3636171">[</span><span class="op" id="3636172">]</span><span class="builtintype" id="3636173">byte</span><span class="op" id="3636177">(</span><span class="string" id="3636178">&#34;\x4F\x67\x67\x53\x00&#34;</span><span class="op" id="3636200">)</span><span class="op" id="3636201">,</span>&nbsp;<span class="string" id="3636203">&#34;application/ogg&#34;</span><span class="op" id="3636220">}</span><span class="op" id="3636221">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3636224">&amp;</span><span class="ident" id="3636225">maskedSig</span><span class="op" id="3636234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3636238">mask</span><span class="op" id="3636242">:</span>&nbsp;<span class="op" id="3636244">[</span><span class="op" id="3636245">]</span><span class="builtintype" id="3636246">byte</span><span class="op" id="3636250">(</span><span class="string" id="3636251">&#34;\xFF\xFF\xFF\xFF\x00\x00\x00\x00\xFF\xFF\xFF\xFF&#34;</span><span class="op" id="3636301">)</span><span class="op" id="3636302">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3636306">pat</span><span class="op" id="3636309">:</span>&nbsp;&nbsp;<span class="op" id="3636312">[</span><span class="op" id="3636313">]</span><span class="builtintype" id="3636314">byte</span><span class="op" id="3636318">(</span><span class="string" id="3636319">&#34;RIFF\x00\x00\x00\x00WAVE&#34;</span><span class="op" id="3636345">)</span><span class="op" id="3636346">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3636350">ct</span><span class="op" id="3636352">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="3636356">&#34;audio/wave&#34;</span><span class="op" id="3636368">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3636371">}</span><span class="op" id="3636372">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3636375">&amp;</span><span class="ident" id="3636376">exactSig</span><span class="op" id="3636384">{</span><span class="op" id="3636385">[</span><span class="op" id="3636386">]</span><span class="builtintype" id="3636387">byte</span><span class="op" id="3636391">(</span><span class="string" id="3636392">&#34;\x1A\x45\xDF\xA3&#34;</span><span class="op" id="3636410">)</span><span class="op" id="3636411">,</span>&nbsp;<span class="string" id="3636413">&#34;video/webm&#34;</span><span class="op" id="3636425">}</span><span class="op" id="3636426">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3636429">&amp;</span><span class="ident" id="3636430">exactSig</span><span class="op" id="3636438">{</span><span class="op" id="3636439">[</span><span class="op" id="3636440">]</span><span class="builtintype" id="3636441">byte</span><span class="op" id="3636445">(</span><span class="string" id="3636446">&#34;\x52\x61\x72\x20\x1A\x07\x00&#34;</span><span class="op" id="3636476">)</span><span class="op" id="3636477">,</span>&nbsp;<span class="string" id="3636479">&#34;application/x-rar-compressed&#34;</span><span class="op" id="3636509">}</span><span class="op" id="3636510">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3636513">&amp;</span><span class="ident" id="3636514">exactSig</span><span class="op" id="3636522">{</span><span class="op" id="3636523">[</span><span class="op" id="3636524">]</span><span class="builtintype" id="3636525">byte</span><span class="op" id="3636529">(</span><span class="string" id="3636530">&#34;\x50\x4B\x03\x04&#34;</span><span class="op" id="3636548">)</span><span class="op" id="3636549">,</span>&nbsp;<span class="string" id="3636551">&#34;application/zip&#34;</span><span class="op" id="3636568">}</span><span class="op" id="3636569">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3636572">&amp;</span><span class="ident" id="3636573">exactSig</span><span class="op" id="3636581">{</span><span class="op" id="3636582">[</span><span class="op" id="3636583">]</span><span class="builtintype" id="3636584">byte</span><span class="op" id="3636588">(</span><span class="string" id="3636589">&#34;\x1F\x8B\x08&#34;</span><span class="op" id="3636603">)</span><span class="op" id="3636604">,</span>&nbsp;<span class="string" id="3636606">&#34;application/x-gzip&#34;</span><span class="op" id="3636626">}</span><span class="op" id="3636627">,</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3636631">//&nbsp;TODO(dsymonds):&nbsp;Re-enable&nbsp;this&nbsp;when&nbsp;the&nbsp;spec&nbsp;is&nbsp;sorted&nbsp;w.r.t.&nbsp;MP4.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3636702">//mp4Sig(0),</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3636717">textSig</span><span class="op" id="3636724">(</span><span class="num" id="3636725">0</span><span class="op" id="3636726">)</span><span class="op" id="3636727">,</span>&nbsp;<span class="comment" id="3636729">//&nbsp;should&nbsp;be&nbsp;last</span><br>
<span class="lineno">105</span><span class="op" id="3636747">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3636750">type</span>&nbsp;<span class="ident" id="3636755">exactSig</span>&nbsp;<span class="keyword" id="3636764">struct</span>&nbsp;<span class="op" id="3636771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3636774">sig</span>&nbsp;<span class="op" id="3636778">[</span><span class="op" id="3636779">]</span><span class="builtintype" id="3636780">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3636786">ct</span>&nbsp;&nbsp;<span class="builtintype" id="3636790">string</span><br>
<span class="lineno">110</span><span class="op" id="3636797">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3636800">func</span>&nbsp;<span class="op" id="3636805">(</span><span class="ident" id="3636806">e</span>&nbsp;<span class="op" id="3636808">*</span><span class="ident" id="3636809">exactSig</span><span class="op" id="3636817">)</span>&nbsp;<span class="ident" id="3636819">match</span><span class="op" id="3636824">(</span><span class="ident" id="3636825">data</span>&nbsp;<span class="op" id="3636830">[</span><span class="op" id="3636831">]</span><span class="builtintype" id="3636832">byte</span><span class="op" id="3636836">,</span>&nbsp;<span class="ident" id="3636838">firstNonWS</span>&nbsp;<span class="builtintype" id="3636849">int</span><span class="op" id="3636852">)</span>&nbsp;<span class="builtintype" id="3636854">string</span>&nbsp;<span class="op" id="3636861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3636864">if</span>&nbsp;<span class="ident" id="3636867">bytes</span><span class="op" id="3636872">.</span><span class="ident" id="3636873">HasPrefix</span><span class="op" id="3636882">(</span><span class="ident" id="3636883">data</span><span class="op" id="3636887">,</span>&nbsp;<span class="ident" id="3636889">e</span><span class="op" id="3636890">.</span><span class="ident" id="3636891">sig</span><span class="op" id="3636894">)</span>&nbsp;<span class="op" id="3636896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3636900">return</span>&nbsp;<span class="ident" id="3636907">e</span><span class="op" id="3636908">.</span><span class="ident" id="3636909">ct</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3636913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3636916">return</span>&nbsp;<span class="string" id="3636923">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="3636926">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3636929">type</span>&nbsp;<span class="ident" id="3636934">maskedSig</span>&nbsp;<span class="keyword" id="3636944">struct</span>&nbsp;<span class="op" id="3636951">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3636954">mask</span><span class="op" id="3636958">,</span>&nbsp;<span class="ident" id="3636960">pat</span>&nbsp;<span class="op" id="3636964">[</span><span class="op" id="3636965">]</span><span class="builtintype" id="3636966">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3636972">skipWS</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3636982">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3636988">ct</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3636998">string</span><br>
<span class="lineno"></span><span class="op" id="3637005">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="3637008">func</span>&nbsp;<span class="op" id="3637013">(</span><span class="ident" id="3637014">m</span>&nbsp;<span class="op" id="3637016">*</span><span class="ident" id="3637017">maskedSig</span><span class="op" id="3637026">)</span>&nbsp;<span class="ident" id="3637028">match</span><span class="op" id="3637033">(</span><span class="ident" id="3637034">data</span>&nbsp;<span class="op" id="3637039">[</span><span class="op" id="3637040">]</span><span class="builtintype" id="3637041">byte</span><span class="op" id="3637045">,</span>&nbsp;<span class="ident" id="3637047">firstNonWS</span>&nbsp;<span class="builtintype" id="3637058">int</span><span class="op" id="3637061">)</span>&nbsp;<span class="builtintype" id="3637063">string</span>&nbsp;<span class="op" id="3637070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3637073">if</span>&nbsp;<span class="ident" id="3637076">m</span><span class="op" id="3637077">.</span><span class="ident" id="3637078">skipWS</span>&nbsp;<span class="op" id="3637085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3637089">data</span>&nbsp;<span class="op" id="3637094">=</span>&nbsp;<span class="ident" id="3637096">data</span><span class="op" id="3637100">[</span><span class="ident" id="3637101">firstNonWS</span><span class="op" id="3637111">:</span><span class="op" id="3637112">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3637115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3637118">if</span>&nbsp;<span class="builtinfunc" id="3637121">len</span><span class="op" id="3637124">(</span><span class="ident" id="3637125">data</span><span class="op" id="3637129">)</span>&nbsp;<span class="op" id="3637131">&lt;</span>&nbsp;<span class="builtinfunc" id="3637133">len</span><span class="op" id="3637136">(</span><span class="ident" id="3637137">m</span><span class="op" id="3637138">.</span><span class="ident" id="3637139">mask</span><span class="op" id="3637143">)</span>&nbsp;<span class="op" id="3637145">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3637149">return</span>&nbsp;<span class="string" id="3637156">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3637160">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3637163">for</span>&nbsp;<span class="ident" id="3637167">i</span><span class="op" id="3637168">,</span>&nbsp;<span class="ident" id="3637170">mask</span>&nbsp;<span class="op" id="3637175">:=</span>&nbsp;<span class="keyword" id="3637178">range</span>&nbsp;<span class="ident" id="3637184">m</span><span class="op" id="3637185">.</span><span class="ident" id="3637186">mask</span>&nbsp;<span class="op" id="3637191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3637195">db</span>&nbsp;<span class="op" id="3637198">:=</span>&nbsp;<span class="ident" id="3637201">data</span><span class="op" id="3637205">[</span><span class="ident" id="3637206">i</span><span class="op" id="3637207">]</span>&nbsp;<span class="op" id="3637209">&amp;</span>&nbsp;<span class="ident" id="3637211">mask</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3637218">if</span>&nbsp;<span class="ident" id="3637221">db</span>&nbsp;<span class="op" id="3637224">!=</span>&nbsp;<span class="ident" id="3637227">m</span><span class="op" id="3637228">.</span><span class="ident" id="3637229">pat</span><span class="op" id="3637232">[</span><span class="ident" id="3637233">i</span><span class="op" id="3637234">]</span>&nbsp;<span class="op" id="3637236">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3637241">return</span>&nbsp;<span class="string" id="3637248">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3637253">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3637256">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3637259">return</span>&nbsp;<span class="ident" id="3637266">m</span><span class="op" id="3637267">.</span><span class="ident" id="3637268">ct</span><br>
<span class="lineno"></span><span class="op" id="3637271">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="keyword" id="3637274">type</span>&nbsp;<span class="ident" id="3637279">htmlSig</span>&nbsp;<span class="op" id="3637287">[</span><span class="op" id="3637288">]</span><span class="builtintype" id="3637289">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3637295">func</span>&nbsp;<span class="op" id="3637300">(</span><span class="ident" id="3637301">h</span>&nbsp;<span class="ident" id="3637303">htmlSig</span><span class="op" id="3637310">)</span>&nbsp;<span class="ident" id="3637312">match</span><span class="op" id="3637317">(</span><span class="ident" id="3637318">data</span>&nbsp;<span class="op" id="3637323">[</span><span class="op" id="3637324">]</span><span class="builtintype" id="3637325">byte</span><span class="op" id="3637329">,</span>&nbsp;<span class="ident" id="3637331">firstNonWS</span>&nbsp;<span class="builtintype" id="3637342">int</span><span class="op" id="3637345">)</span>&nbsp;<span class="builtintype" id="3637347">string</span>&nbsp;<span class="op" id="3637354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3637357">data</span>&nbsp;<span class="op" id="3637362">=</span>&nbsp;<span class="ident" id="3637364">data</span><span class="op" id="3637368">[</span><span class="ident" id="3637369">firstNonWS</span><span class="op" id="3637379">:</span><span class="op" id="3637380">]</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3637383">if</span>&nbsp;<span class="builtinfunc" id="3637386">len</span><span class="op" id="3637389">(</span><span class="ident" id="3637390">data</span><span class="op" id="3637394">)</span>&nbsp;<span class="op" id="3637396">&lt;</span>&nbsp;<span class="builtinfunc" id="3637398">len</span><span class="op" id="3637401">(</span><span class="ident" id="3637402">h</span><span class="op" id="3637403">)</span><span class="op" id="3637404">+</span><span class="num" id="3637405">1</span>&nbsp;<span class="op" id="3637407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3637411">return</span>&nbsp;<span class="string" id="3637418">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3637422">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3637425">for</span>&nbsp;<span class="ident" id="3637429">i</span><span class="op" id="3637430">,</span>&nbsp;<span class="ident" id="3637432">b</span>&nbsp;<span class="op" id="3637434">:=</span>&nbsp;<span class="keyword" id="3637437">range</span>&nbsp;<span class="ident" id="3637443">h</span>&nbsp;<span class="op" id="3637445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3637449">db</span>&nbsp;<span class="op" id="3637452">:=</span>&nbsp;<span class="ident" id="3637455">data</span><span class="op" id="3637459">[</span><span class="ident" id="3637460">i</span><span class="op" id="3637461">]</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3637465">if</span>&nbsp;<span class="string" id="3637468">&#39;A&#39;</span>&nbsp;<span class="op" id="3637472">&lt;=</span>&nbsp;<span class="ident" id="3637475">b</span>&nbsp;<span class="op" id="3637477">&amp;&amp;</span>&nbsp;<span class="ident" id="3637480">b</span>&nbsp;<span class="op" id="3637482">&lt;=</span>&nbsp;<span class="string" id="3637485">&#39;Z&#39;</span>&nbsp;<span class="op" id="3637489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3637494">db</span>&nbsp;<span class="op" id="3637497">&amp;=</span>&nbsp;<span class="num" id="3637500">0xDF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3637507">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3637511">if</span>&nbsp;<span class="ident" id="3637514">b</span>&nbsp;<span class="op" id="3637516">!=</span>&nbsp;<span class="ident" id="3637519">db</span>&nbsp;<span class="op" id="3637522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3637527">return</span>&nbsp;<span class="string" id="3637534">&#34;&#34;</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3637539">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3637542">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3637545">//&nbsp;Next&nbsp;byte&nbsp;must&nbsp;be&nbsp;space&nbsp;or&nbsp;right&nbsp;angle&nbsp;bracket.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3637597">if</span>&nbsp;<span class="ident" id="3637600">db</span>&nbsp;<span class="op" id="3637603">:=</span>&nbsp;<span class="ident" id="3637606">data</span><span class="op" id="3637610">[</span><span class="builtinfunc" id="3637611">len</span><span class="op" id="3637614">(</span><span class="ident" id="3637615">h</span><span class="op" id="3637616">)</span><span class="op" id="3637617">]</span><span class="op" id="3637618">;</span>&nbsp;<span class="ident" id="3637620">db</span>&nbsp;<span class="op" id="3637623">!=</span>&nbsp;<span class="string" id="3637626">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3637630">&amp;&amp;</span>&nbsp;<span class="ident" id="3637633">db</span>&nbsp;<span class="op" id="3637636">!=</span>&nbsp;<span class="string" id="3637639">&#39;&gt;&#39;</span>&nbsp;<span class="op" id="3637643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3637647">return</span>&nbsp;<span class="string" id="3637654">&#34;&#34;</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3637658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3637661">return</span>&nbsp;<span class="string" id="3637668">&#34;text/html;&nbsp;charset=utf-8&#34;</span><br>
<span class="lineno"></span><span class="op" id="3637695">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3637698">type</span>&nbsp;<span class="ident" id="3637703">mp4Sig</span>&nbsp;<span class="builtintype" id="3637710">int</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="keyword" id="3637715">func</span>&nbsp;<span class="op" id="3637720">(</span><span class="ident" id="3637721">mp4Sig</span><span class="op" id="3637727">)</span>&nbsp;<span class="ident" id="3637729">match</span><span class="op" id="3637734">(</span><span class="ident" id="3637735">data</span>&nbsp;<span class="op" id="3637740">[</span><span class="op" id="3637741">]</span><span class="builtintype" id="3637742">byte</span><span class="op" id="3637746">,</span>&nbsp;<span class="ident" id="3637748">firstNonWS</span>&nbsp;<span class="builtintype" id="3637759">int</span><span class="op" id="3637762">)</span>&nbsp;<span class="builtintype" id="3637764">string</span>&nbsp;<span class="op" id="3637771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3637774">//&nbsp;c.f.&nbsp;section&nbsp;6.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3637796">if</span>&nbsp;<span class="builtinfunc" id="3637799">len</span><span class="op" id="3637802">(</span><span class="ident" id="3637803">data</span><span class="op" id="3637807">)</span>&nbsp;<span class="op" id="3637809">&lt;</span>&nbsp;<span class="num" id="3637811">8</span>&nbsp;<span class="op" id="3637813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3637817">return</span>&nbsp;<span class="string" id="3637824">&#34;&#34;</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3637828">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3637831">boxSize</span>&nbsp;<span class="op" id="3637839">:=</span>&nbsp;<span class="builtintype" id="3637842">int</span><span class="op" id="3637845">(</span><span class="ident" id="3637846">binary</span><span class="op" id="3637852">.</span><span class="ident" id="3637853">BigEndian</span><span class="op" id="3637862">.</span><span class="ident" id="3637863">Uint32</span><span class="op" id="3637869">(</span><span class="ident" id="3637870">data</span><span class="op" id="3637874">[</span><span class="op" id="3637875">:</span><span class="num" id="3637876">4</span><span class="op" id="3637877">]</span><span class="op" id="3637878">)</span><span class="op" id="3637879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3637882">if</span>&nbsp;<span class="ident" id="3637885">boxSize</span><span class="op" id="3637892">%</span><span class="num" id="3637893">4</span>&nbsp;<span class="op" id="3637895">!=</span>&nbsp;<span class="num" id="3637898">0</span>&nbsp;<span class="op" id="3637900">||</span>&nbsp;<span class="builtinfunc" id="3637903">len</span><span class="op" id="3637906">(</span><span class="ident" id="3637907">data</span><span class="op" id="3637911">)</span>&nbsp;<span class="op" id="3637913">&lt;</span>&nbsp;<span class="ident" id="3637915">boxSize</span>&nbsp;<span class="op" id="3637923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3637927">return</span>&nbsp;<span class="string" id="3637934">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3637938">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3637941">if</span>&nbsp;<span class="op" id="3637944">!</span><span class="ident" id="3637945">bytes</span><span class="op" id="3637950">.</span><span class="ident" id="3637951">Equal</span><span class="op" id="3637956">(</span><span class="ident" id="3637957">data</span><span class="op" id="3637961">[</span><span class="num" id="3637962">4</span><span class="op" id="3637963">:</span><span class="num" id="3637964">8</span><span class="op" id="3637965">]</span><span class="op" id="3637966">,</span>&nbsp;<span class="op" id="3637968">[</span><span class="op" id="3637969">]</span><span class="builtintype" id="3637970">byte</span><span class="op" id="3637974">(</span><span class="string" id="3637975">&#34;ftyp&#34;</span><span class="op" id="3637981">)</span><span class="op" id="3637982">)</span>&nbsp;<span class="op" id="3637984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3637988">return</span>&nbsp;<span class="string" id="3637995">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3637999">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3638002">for</span>&nbsp;<span class="ident" id="3638006">st</span>&nbsp;<span class="op" id="3638009">:=</span>&nbsp;<span class="num" id="3638012">8</span><span class="op" id="3638013">;</span>&nbsp;<span class="ident" id="3638015">st</span>&nbsp;<span class="op" id="3638018">&lt;</span>&nbsp;<span class="ident" id="3638020">boxSize</span><span class="op" id="3638027">;</span>&nbsp;<span class="ident" id="3638029">st</span>&nbsp;<span class="op" id="3638032">+=</span>&nbsp;<span class="num" id="3638035">4</span>&nbsp;<span class="op" id="3638037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3638041">if</span>&nbsp;<span class="ident" id="3638044">st</span>&nbsp;<span class="op" id="3638047">==</span>&nbsp;<span class="num" id="3638050">12</span>&nbsp;<span class="op" id="3638053">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3638058">//&nbsp;minor&nbsp;version&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3638085">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3638096">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3638100">seg</span>&nbsp;<span class="op" id="3638104">:=</span>&nbsp;<span class="builtintype" id="3638107">string</span><span class="op" id="3638113">(</span><span class="ident" id="3638114">data</span><span class="op" id="3638118">[</span><span class="ident" id="3638119">st</span>&nbsp;<span class="op" id="3638122">:</span>&nbsp;<span class="ident" id="3638124">st</span><span class="op" id="3638126">+</span><span class="num" id="3638127">3</span><span class="op" id="3638128">]</span><span class="op" id="3638129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3638133">switch</span>&nbsp;<span class="ident" id="3638140">seg</span>&nbsp;<span class="op" id="3638144">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3638148">case</span>&nbsp;<span class="string" id="3638153">&#34;mp4&#34;</span><span class="op" id="3638158">,</span>&nbsp;<span class="string" id="3638160">&#34;iso&#34;</span><span class="op" id="3638165">,</span>&nbsp;<span class="string" id="3638167">&#34;M4V&#34;</span><span class="op" id="3638172">,</span>&nbsp;<span class="string" id="3638174">&#34;M4P&#34;</span><span class="op" id="3638179">,</span>&nbsp;<span class="string" id="3638181">&#34;M4B&#34;</span><span class="op" id="3638186">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3638191">return</span>&nbsp;<span class="string" id="3638198">&#34;video/mp4&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3638213">/*&nbsp;The&nbsp;remainder&nbsp;are&nbsp;not&nbsp;in&nbsp;the&nbsp;spec.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspcase&nbsp;&#34;M4A&#34;:<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;&#34;audio/mp4&#34;<br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspcase&nbsp;&#34;3gp&#34;:<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;&#34;video/3gpp&#34;<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspcase&nbsp;&#34;jp2&#34;:<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;&#34;image/jp2&#34;&nbsp;//&nbsp;JPEG&nbsp;2000<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp*/</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3638387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3638390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3638393">return</span>&nbsp;<span class="string" id="3638400">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="3638403">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="keyword" id="3638406">type</span>&nbsp;<span class="ident" id="3638411">textSig</span>&nbsp;<span class="builtintype" id="3638419">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3638424">func</span>&nbsp;<span class="op" id="3638429">(</span><span class="ident" id="3638430">textSig</span><span class="op" id="3638437">)</span>&nbsp;<span class="ident" id="3638439">match</span><span class="op" id="3638444">(</span><span class="ident" id="3638445">data</span>&nbsp;<span class="op" id="3638450">[</span><span class="op" id="3638451">]</span><span class="builtintype" id="3638452">byte</span><span class="op" id="3638456">,</span>&nbsp;<span class="ident" id="3638458">firstNonWS</span>&nbsp;<span class="builtintype" id="3638469">int</span><span class="op" id="3638472">)</span>&nbsp;<span class="builtintype" id="3638474">string</span>&nbsp;<span class="op" id="3638481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3638484">//&nbsp;c.f.&nbsp;section&nbsp;5,&nbsp;step&nbsp;4.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3638512">for</span>&nbsp;<span class="ident" id="3638516">_</span><span class="op" id="3638517">,</span>&nbsp;<span class="ident" id="3638519">b</span>&nbsp;<span class="op" id="3638521">:=</span>&nbsp;<span class="keyword" id="3638524">range</span>&nbsp;<span class="ident" id="3638530">data</span><span class="op" id="3638534">[</span><span class="ident" id="3638535">firstNonWS</span><span class="op" id="3638545">:</span><span class="op" id="3638546">]</span>&nbsp;<span class="op" id="3638548">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3638552">switch</span>&nbsp;<span class="op" id="3638559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3638563">case</span>&nbsp;<span class="num" id="3638568">0x00</span>&nbsp;<span class="op" id="3638573">&lt;=</span>&nbsp;<span class="ident" id="3638576">b</span>&nbsp;<span class="op" id="3638578">&amp;&amp;</span>&nbsp;<span class="ident" id="3638581">b</span>&nbsp;<span class="op" id="3638583">&lt;=</span>&nbsp;<span class="num" id="3638586">0x08</span><span class="op" id="3638590">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3638595">b</span>&nbsp;<span class="op" id="3638597">==</span>&nbsp;<span class="num" id="3638600">0x0B</span><span class="op" id="3638604">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3638609">0x0E</span>&nbsp;<span class="op" id="3638614">&lt;=</span>&nbsp;<span class="ident" id="3638617">b</span>&nbsp;<span class="op" id="3638619">&amp;&amp;</span>&nbsp;<span class="ident" id="3638622">b</span>&nbsp;<span class="op" id="3638624">&lt;=</span>&nbsp;<span class="num" id="3638627">0x1A</span><span class="op" id="3638631">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3638636">0x1C</span>&nbsp;<span class="op" id="3638641">&lt;=</span>&nbsp;<span class="ident" id="3638644">b</span>&nbsp;<span class="op" id="3638646">&amp;&amp;</span>&nbsp;<span class="ident" id="3638649">b</span>&nbsp;<span class="op" id="3638651">&lt;=</span>&nbsp;<span class="num" id="3638654">0x1F</span><span class="op" id="3638658">:</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3638663">return</span>&nbsp;<span class="string" id="3638670">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3638675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3638678">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3638681">return</span>&nbsp;<span class="string" id="3638688">&#34;text/plain;&nbsp;charset=utf-8&#34;</span><br>
<span class="lineno"></span><span class="op" id="3638716">}</span>
</div>
</body>
</html>
