<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>os</h2>
<ul>
<li><a href="/gostd/os/dir_unix.go.html">dir_unix.go</a></li>
<li><a href="/gostd/os/doc.go.html">doc.go</a></li>
<li><a href="/gostd/os/env.go.html">env.go</a></li>
<li><a href="/gostd/os/env_test.go.html">env_test.go</a></li>
<li><a href="/gostd/os/env_unix_test.go.html">env_unix_test.go</a></li>
<li><a href="/gostd/os/error.go.html">error.go</a></li>
<li><a href="/gostd/os/error_test.go.html">error_test.go</a></li>
<li><a href="/gostd/os/error_unix.go.html">error_unix.go</a></li>
<li><a href="/gostd/os/exec.go.html">exec.go</a></li>
<li><a href="/gostd/os/exec_posix.go.html">exec_posix.go</a></li>
<li><a href="/gostd/os/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/os/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/os/file.go.html">file.go</a></li>
<li><a href="/gostd/os/file_posix.go.html">file_posix.go</a></li>
<li><a href="/gostd/os/file_unix.go.html" class="current">file_unix.go</a></li>
<li><a href="/gostd/os/getwd.go.html">getwd.go</a></li>
<li><a href="/gostd/os/os_test.go.html">os_test.go</a></li>
<li><a href="/gostd/os/os_unix_test.go.html">os_unix_test.go</a></li>
<li><a href="/gostd/os/path.go.html">path.go</a></li>
<li><a href="/gostd/os/path_test.go.html">path_test.go</a></li>
<li><a href="/gostd/os/path_unix.go.html">path_unix.go</a></li>
<li><a href="/gostd/os/pipe_linux.go.html">pipe_linux.go</a></li>
<li><a href="/gostd/os/proc.go.html">proc.go</a></li>
<li><a href="/gostd/os/stat_linux.go.html">stat_linux.go</a></li>
<li><a href="/gostd/os/sys_linux.go.html">sys_linux.go</a></li>
<li><a href="/gostd/os/sys_unix.go.html">sys_unix.go</a></li>
<li><a href="/gostd/os/types.go.html">types.go</a></li>
<li><a href="/gostd/os/types_notwin.go.html">types_notwin.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2555365">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2555420">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2555474">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2555525">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2555595">package</span>&nbsp;<span class="ident" id="2555603">os</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2555607">import</span>&nbsp;<span class="op" id="2555614">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2555617">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2555628">&#34;sync/atomic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2555643">&#34;syscall&#34;</span><br>
<span class="lineno"></span><span class="op" id="2555653">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="2555656">//&nbsp;File&nbsp;represents&nbsp;an&nbsp;open&nbsp;file&nbsp;descriptor.</span><br>
<span class="lineno"></span><span class="keyword" id="2555700">type</span>&nbsp;<span class="ident" id="2555705">File</span>&nbsp;<span class="keyword" id="2555710">struct</span>&nbsp;<span class="op" id="2555717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2555720">*</span><span class="ident" id="2555721">file</span><br>
<span class="lineno"></span><span class="op" id="2555726">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="2555729">//&nbsp;file&nbsp;is&nbsp;the&nbsp;real&nbsp;representation&nbsp;of&nbsp;*File.</span><br>
<span class="lineno"></span><span class="comment" id="2555774">//&nbsp;The&nbsp;extra&nbsp;level&nbsp;of&nbsp;indirection&nbsp;ensures&nbsp;that&nbsp;no&nbsp;clients&nbsp;of&nbsp;os</span><br>
<span class="lineno"></span><span class="comment" id="2555838">//&nbsp;can&nbsp;overwrite&nbsp;this&nbsp;data,&nbsp;which&nbsp;could&nbsp;cause&nbsp;the&nbsp;finalizer</span><br>
<span class="lineno"></span><span class="comment" id="2555898">//&nbsp;to&nbsp;close&nbsp;the&nbsp;wrong&nbsp;file&nbsp;descriptor.</span><br>
<span class="lineno"></span><span class="keyword" id="2555937">type</span>&nbsp;<span class="ident" id="2555942">file</span>&nbsp;<span class="keyword" id="2555947">struct</span>&nbsp;<span class="op" id="2555954">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2555957">fd</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2555965">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2555970">name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2555978">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2555986">dirinfo</span>&nbsp;<span class="op" id="2555994">*</span><span class="ident" id="2555995">dirInfo</span>&nbsp;<span class="comment" id="2556003">//&nbsp;nil&nbsp;unless&nbsp;directory&nbsp;being&nbsp;read</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2556039">nepipe</span>&nbsp;&nbsp;<span class="builtintype" id="2556047">int32</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2556056">//&nbsp;number&nbsp;of&nbsp;consecutive&nbsp;EPIPE&nbsp;in&nbsp;Write</span><br>
<span class="lineno"></span><span class="op" id="2556096">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="2556099">//&nbsp;Fd&nbsp;returns&nbsp;the&nbsp;integer&nbsp;Unix&nbsp;file&nbsp;descriptor&nbsp;referencing&nbsp;the&nbsp;open&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2556173">//&nbsp;The&nbsp;file&nbsp;descriptor&nbsp;is&nbsp;valid&nbsp;only&nbsp;until&nbsp;f.Close&nbsp;is&nbsp;called&nbsp;or&nbsp;f&nbsp;is&nbsp;garbage&nbsp;collected.</span><br>
<span class="lineno"></span><span class="keyword" id="2556261">func</span>&nbsp;<span class="op" id="2556266">(</span><span class="ident" id="2556267">f</span>&nbsp;<span class="op" id="2556269">*</span><span class="ident" id="2556270">File</span><span class="op" id="2556274">)</span>&nbsp;<span class="ident" id="2556276">Fd</span><span class="op" id="2556278">(</span><span class="op" id="2556279">)</span>&nbsp;<span class="builtintype" id="2556281">uintptr</span>&nbsp;<span class="op" id="2556289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2556292">if</span>&nbsp;<span class="ident" id="2556295">f</span>&nbsp;<span class="op" id="2556297">==</span>&nbsp;<span class="ident" id="2556300">nil</span>&nbsp;<span class="op" id="2556304">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2556308">return</span>&nbsp;<span class="op" id="2556315">^</span><span class="op" id="2556316">(</span><span class="builtintype" id="2556317">uintptr</span><span class="op" id="2556324">(</span><span class="num" id="2556325">0</span><span class="op" id="2556326">)</span><span class="op" id="2556327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2556330">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2556333">return</span>&nbsp;<span class="builtintype" id="2556340">uintptr</span><span class="op" id="2556347">(</span><span class="ident" id="2556348">f</span><span class="op" id="2556349">.</span><span class="ident" id="2556350">fd</span><span class="op" id="2556352">)</span><br>
<span class="lineno"></span><span class="op" id="2556354">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="2556357">//&nbsp;NewFile&nbsp;returns&nbsp;a&nbsp;new&nbsp;File&nbsp;with&nbsp;the&nbsp;given&nbsp;file&nbsp;descriptor&nbsp;and&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="2556428">func</span>&nbsp;<span class="ident" id="2556433">NewFile</span><span class="op" id="2556440">(</span><span class="ident" id="2556441">fd</span>&nbsp;<span class="builtintype" id="2556444">uintptr</span><span class="op" id="2556451">,</span>&nbsp;<span class="ident" id="2556453">name</span>&nbsp;<span class="builtintype" id="2556458">string</span><span class="op" id="2556464">)</span>&nbsp;<span class="op" id="2556466">*</span><span class="ident" id="2556467">File</span>&nbsp;<span class="op" id="2556472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2556475">fdi</span>&nbsp;<span class="op" id="2556479">:=</span>&nbsp;<span class="builtintype" id="2556482">int</span><span class="op" id="2556485">(</span><span class="ident" id="2556486">fd</span><span class="op" id="2556488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2556491">if</span>&nbsp;<span class="ident" id="2556494">fdi</span>&nbsp;<span class="op" id="2556498">&lt;</span>&nbsp;<span class="num" id="2556500">0</span>&nbsp;<span class="op" id="2556502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2556506">return</span>&nbsp;<span class="ident" id="2556513">nil</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2556518">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2556521">f</span>&nbsp;<span class="op" id="2556523">:=</span>&nbsp;<span class="op" id="2556526">&amp;</span><span class="ident" id="2556527">File</span><span class="op" id="2556531">{</span><span class="op" id="2556532">&amp;</span><span class="ident" id="2556533">file</span><span class="op" id="2556537">{</span><span class="ident" id="2556538">fd</span><span class="op" id="2556540">:</span>&nbsp;<span class="ident" id="2556542">fdi</span><span class="op" id="2556545">,</span>&nbsp;<span class="ident" id="2556547">name</span><span class="op" id="2556551">:</span>&nbsp;<span class="ident" id="2556553">name</span><span class="op" id="2556557">}</span><span class="op" id="2556558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2556561">runtime</span><span class="op" id="2556568">.</span><span class="ident" id="2556569">SetFinalizer</span><span class="op" id="2556581">(</span><span class="ident" id="2556582">f</span><span class="op" id="2556583">.</span><span class="ident" id="2556584">file</span><span class="op" id="2556588">,</span>&nbsp;<span class="op" id="2556590">(</span><span class="op" id="2556591">*</span><span class="ident" id="2556592">file</span><span class="op" id="2556596">)</span><span class="op" id="2556597">.</span><span class="builtinfunc" id="2556598">close</span><span class="op" id="2556603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2556606">return</span>&nbsp;<span class="ident" id="2556613">f</span><br>
<span class="lineno"></span><span class="op" id="2556615">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="comment" id="2556618">//&nbsp;Auxiliary&nbsp;information&nbsp;if&nbsp;the&nbsp;File&nbsp;describes&nbsp;a&nbsp;directory</span><br>
<span class="lineno"></span><span class="keyword" id="2556677">type</span>&nbsp;<span class="ident" id="2556682">dirInfo</span>&nbsp;<span class="keyword" id="2556690">struct</span>&nbsp;<span class="op" id="2556697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2556700">buf</span>&nbsp;&nbsp;<span class="op" id="2556705">[</span><span class="op" id="2556706">]</span><span class="builtintype" id="2556707">byte</span>&nbsp;<span class="comment" id="2556712">//&nbsp;buffer&nbsp;for&nbsp;directory&nbsp;I/O</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2556741">nbuf</span>&nbsp;<span class="builtintype" id="2556746">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2556753">//&nbsp;length&nbsp;of&nbsp;buf;&nbsp;return&nbsp;value&nbsp;from&nbsp;Getdirentries</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2556804">bufp</span>&nbsp;<span class="builtintype" id="2556809">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2556816">//&nbsp;location&nbsp;of&nbsp;next&nbsp;record&nbsp;in&nbsp;buf.</span><br>
<span class="lineno"></span><span class="op" id="2556851">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2556854">func</span>&nbsp;<span class="ident" id="2556859">epipecheck</span><span class="op" id="2556869">(</span><span class="ident" id="2556870">file</span>&nbsp;<span class="op" id="2556875">*</span><span class="ident" id="2556876">File</span><span class="op" id="2556880">,</span>&nbsp;<span class="ident" id="2556882">e</span>&nbsp;<span class="builtintype" id="2556884">error</span><span class="op" id="2556889">)</span>&nbsp;<span class="op" id="2556891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2556894">if</span>&nbsp;<span class="ident" id="2556897">e</span>&nbsp;<span class="op" id="2556899">==</span>&nbsp;<span class="ident" id="2556902">syscall</span><span class="op" id="2556909">.</span><span class="ident" id="2556910">EPIPE</span>&nbsp;<span class="op" id="2556916">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2556920">if</span>&nbsp;<span class="ident" id="2556923">atomic</span><span class="op" id="2556929">.</span><span class="ident" id="2556930">AddInt32</span><span class="op" id="2556938">(</span><span class="op" id="2556939">&amp;</span><span class="ident" id="2556940">file</span><span class="op" id="2556944">.</span><span class="ident" id="2556945">nepipe</span><span class="op" id="2556951">,</span>&nbsp;<span class="num" id="2556953">1</span><span class="op" id="2556954">)</span>&nbsp;<span class="op" id="2556956">&gt;=</span>&nbsp;<span class="num" id="2556959">10</span>&nbsp;<span class="op" id="2556962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2556967">sigpipe</span><span class="op" id="2556974">(</span><span class="op" id="2556975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2556979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2556982">}</span>&nbsp;<span class="keyword" id="2556984">else</span>&nbsp;<span class="op" id="2556989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2556993">atomic</span><span class="op" id="2556999">.</span><span class="ident" id="2557000">StoreInt32</span><span class="op" id="2557010">(</span><span class="op" id="2557011">&amp;</span><span class="ident" id="2557012">file</span><span class="op" id="2557016">.</span><span class="ident" id="2557017">nepipe</span><span class="op" id="2557023">,</span>&nbsp;<span class="num" id="2557025">0</span><span class="op" id="2557026">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2557029">}</span><br>
<span class="lineno"></span><span class="op" id="2557031">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2557034">//&nbsp;DevNull&nbsp;is&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;operating&nbsp;system&#39;s&nbsp;``null&nbsp;device.&#39;&#39;</span><br>
<span class="lineno"></span><span class="comment" id="2557100">//&nbsp;On&nbsp;Unix-like&nbsp;systems,&nbsp;it&nbsp;is&nbsp;&#34;/dev/null&#34;;&nbsp;on&nbsp;Windows,&nbsp;&#34;NUL&#34;.</span><br>
<span class="lineno">70</span><span class="keyword" id="2557163">const</span>&nbsp;<span class="ident" id="2557169">DevNull</span>&nbsp;<span class="op" id="2557177">=</span>&nbsp;<span class="string" id="2557179">&#34;/dev/null&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2557192">//&nbsp;OpenFile&nbsp;is&nbsp;the&nbsp;generalized&nbsp;open&nbsp;call;&nbsp;most&nbsp;users&nbsp;will&nbsp;use&nbsp;Open</span><br>
<span class="lineno"></span><span class="comment" id="2557259">//&nbsp;or&nbsp;Create&nbsp;instead.&nbsp;&nbsp;It&nbsp;opens&nbsp;the&nbsp;named&nbsp;file&nbsp;with&nbsp;specified&nbsp;flag</span><br>
<span class="lineno"></span><span class="comment" id="2557326">//&nbsp;(O_RDONLY&nbsp;etc.)&nbsp;and&nbsp;perm,&nbsp;(0666&nbsp;etc.)&nbsp;if&nbsp;applicable.&nbsp;&nbsp;If&nbsp;successful,</span><br>
<span class="lineno">75</span><span class="comment" id="2557398">//&nbsp;methods&nbsp;on&nbsp;the&nbsp;returned&nbsp;File&nbsp;can&nbsp;be&nbsp;used&nbsp;for&nbsp;I/O.</span><br>
<span class="lineno"></span><span class="comment" id="2557451">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2557507">func</span>&nbsp;<span class="ident" id="2557512">OpenFile</span><span class="op" id="2557520">(</span><span class="ident" id="2557521">name</span>&nbsp;<span class="builtintype" id="2557526">string</span><span class="op" id="2557532">,</span>&nbsp;<span class="ident" id="2557534">flag</span>&nbsp;<span class="builtintype" id="2557539">int</span><span class="op" id="2557542">,</span>&nbsp;<span class="ident" id="2557544">perm</span>&nbsp;<span class="ident" id="2557549">FileMode</span><span class="op" id="2557557">)</span>&nbsp;<span class="op" id="2557559">(</span><span class="ident" id="2557560">file</span>&nbsp;<span class="op" id="2557565">*</span><span class="ident" id="2557566">File</span><span class="op" id="2557570">,</span>&nbsp;<span class="ident" id="2557572">err</span>&nbsp;<span class="builtintype" id="2557576">error</span><span class="op" id="2557581">)</span>&nbsp;<span class="op" id="2557583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2557586">r</span><span class="op" id="2557587">,</span>&nbsp;<span class="ident" id="2557589">e</span>&nbsp;<span class="op" id="2557591">:=</span>&nbsp;<span class="ident" id="2557594">syscall</span><span class="op" id="2557601">.</span><span class="ident" id="2557602">Open</span><span class="op" id="2557606">(</span><span class="ident" id="2557607">name</span><span class="op" id="2557611">,</span>&nbsp;<span class="ident" id="2557613">flag</span><span class="op" id="2557617">|</span><span class="ident" id="2557618">syscall</span><span class="op" id="2557625">.</span><span class="ident" id="2557626">O_CLOEXEC</span><span class="op" id="2557635">,</span>&nbsp;<span class="ident" id="2557637">syscallMode</span><span class="op" id="2557648">(</span><span class="ident" id="2557649">perm</span><span class="op" id="2557653">)</span><span class="op" id="2557654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2557657">if</span>&nbsp;<span class="ident" id="2557660">e</span>&nbsp;<span class="op" id="2557662">!=</span>&nbsp;<span class="ident" id="2557665">nil</span>&nbsp;<span class="op" id="2557669">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2557673">return</span>&nbsp;<span class="ident" id="2557680">nil</span><span class="op" id="2557683">,</span>&nbsp;<span class="op" id="2557685">&amp;</span><span class="ident" id="2557686">PathError</span><span class="op" id="2557695">{</span><span class="string" id="2557696">&#34;open&#34;</span><span class="op" id="2557702">,</span>&nbsp;<span class="ident" id="2557704">name</span><span class="op" id="2557708">,</span>&nbsp;<span class="ident" id="2557710">e</span><span class="op" id="2557711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2557714">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2557718">//&nbsp;There&#39;s&nbsp;a&nbsp;race&nbsp;here&nbsp;with&nbsp;fork/exec,&nbsp;which&nbsp;we&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2557771">//&nbsp;content&nbsp;to&nbsp;live&nbsp;with.&nbsp;&nbsp;See&nbsp;../syscall/exec_unix.go.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2557827">if</span>&nbsp;<span class="op" id="2557830">!</span><span class="ident" id="2557831">supportsCloseOnExec</span>&nbsp;<span class="op" id="2557851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2557855">syscall</span><span class="op" id="2557862">.</span><span class="ident" id="2557863">CloseOnExec</span><span class="op" id="2557874">(</span><span class="ident" id="2557875">r</span><span class="op" id="2557876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2557879">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2557883">return</span>&nbsp;<span class="ident" id="2557890">NewFile</span><span class="op" id="2557897">(</span><span class="builtintype" id="2557898">uintptr</span><span class="op" id="2557905">(</span><span class="ident" id="2557906">r</span><span class="op" id="2557907">)</span><span class="op" id="2557908">,</span>&nbsp;<span class="ident" id="2557910">name</span><span class="op" id="2557914">)</span><span class="op" id="2557915">,</span>&nbsp;<span class="ident" id="2557917">nil</span><br>
<span class="lineno">90</span><span class="op" id="2557921">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2557924">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;File,&nbsp;rendering&nbsp;it&nbsp;unusable&nbsp;for&nbsp;I/O.</span><br>
<span class="lineno"></span><span class="comment" id="2557981">//&nbsp;It&nbsp;returns&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2558013">func</span>&nbsp;<span class="op" id="2558018">(</span><span class="ident" id="2558019">f</span>&nbsp;<span class="op" id="2558021">*</span><span class="ident" id="2558022">File</span><span class="op" id="2558026">)</span>&nbsp;<span class="ident" id="2558028">Close</span><span class="op" id="2558033">(</span><span class="op" id="2558034">)</span>&nbsp;<span class="builtintype" id="2558036">error</span>&nbsp;<span class="op" id="2558042">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2558045">if</span>&nbsp;<span class="ident" id="2558048">f</span>&nbsp;<span class="op" id="2558050">==</span>&nbsp;<span class="ident" id="2558053">nil</span>&nbsp;<span class="op" id="2558057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2558061">return</span>&nbsp;<span class="ident" id="2558068">ErrInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2558080">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2558083">return</span>&nbsp;<span class="ident" id="2558090">f</span><span class="op" id="2558091">.</span><span class="ident" id="2558092">file</span><span class="op" id="2558096">.</span><span class="builtinfunc" id="2558097">close</span><span class="op" id="2558102">(</span><span class="op" id="2558103">)</span><br>
<span class="lineno"></span><span class="op" id="2558105">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="keyword" id="2558108">func</span>&nbsp;<span class="op" id="2558113">(</span><span class="ident" id="2558114">file</span>&nbsp;<span class="op" id="2558119">*</span><span class="ident" id="2558120">file</span><span class="op" id="2558124">)</span>&nbsp;<span class="builtinfunc" id="2558126">close</span><span class="op" id="2558131">(</span><span class="op" id="2558132">)</span>&nbsp;<span class="builtintype" id="2558134">error</span>&nbsp;<span class="op" id="2558140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2558143">if</span>&nbsp;<span class="ident" id="2558146">file</span>&nbsp;<span class="op" id="2558151">==</span>&nbsp;<span class="ident" id="2558154">nil</span>&nbsp;<span class="op" id="2558158">||</span>&nbsp;<span class="ident" id="2558161">file</span><span class="op" id="2558165">.</span><span class="ident" id="2558166">fd</span>&nbsp;<span class="op" id="2558169">&lt;</span>&nbsp;<span class="num" id="2558171">0</span>&nbsp;<span class="op" id="2558173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2558177">return</span>&nbsp;<span class="ident" id="2558184">syscall</span><span class="op" id="2558191">.</span><span class="ident" id="2558192">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2558200">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2558203">var</span>&nbsp;<span class="ident" id="2558207">err</span>&nbsp;<span class="builtintype" id="2558211">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2558218">if</span>&nbsp;<span class="ident" id="2558221">e</span>&nbsp;<span class="op" id="2558223">:=</span>&nbsp;<span class="ident" id="2558226">syscall</span><span class="op" id="2558233">.</span><span class="ident" id="2558234">Close</span><span class="op" id="2558239">(</span><span class="ident" id="2558240">file</span><span class="op" id="2558244">.</span><span class="ident" id="2558245">fd</span><span class="op" id="2558247">)</span><span class="op" id="2558248">;</span>&nbsp;<span class="ident" id="2558250">e</span>&nbsp;<span class="op" id="2558252">!=</span>&nbsp;<span class="ident" id="2558255">nil</span>&nbsp;<span class="op" id="2558259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2558263">err</span>&nbsp;<span class="op" id="2558267">=</span>&nbsp;<span class="op" id="2558269">&amp;</span><span class="ident" id="2558270">PathError</span><span class="op" id="2558279">{</span><span class="string" id="2558280">&#34;close&#34;</span><span class="op" id="2558287">,</span>&nbsp;<span class="ident" id="2558289">file</span><span class="op" id="2558293">.</span><span class="ident" id="2558294">name</span><span class="op" id="2558298">,</span>&nbsp;<span class="ident" id="2558300">e</span><span class="op" id="2558301">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2558304">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2558307">file</span><span class="op" id="2558311">.</span><span class="ident" id="2558312">fd</span>&nbsp;<span class="op" id="2558315">=</span>&nbsp;<span class="op" id="2558317">-</span><span class="num" id="2558318">1</span>&nbsp;<span class="comment" id="2558320">//&nbsp;so&nbsp;it&nbsp;can&#39;t&nbsp;be&nbsp;closed&nbsp;again</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2558353">//&nbsp;no&nbsp;need&nbsp;for&nbsp;a&nbsp;finalizer&nbsp;anymore</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2558389">runtime</span><span class="op" id="2558396">.</span><span class="ident" id="2558397">SetFinalizer</span><span class="op" id="2558409">(</span><span class="ident" id="2558410">file</span><span class="op" id="2558414">,</span>&nbsp;<span class="ident" id="2558416">nil</span><span class="op" id="2558419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2558422">return</span>&nbsp;<span class="ident" id="2558429">err</span><br>
<span class="lineno"></span><span class="op" id="2558433">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="2558436">//&nbsp;Stat&nbsp;returns&nbsp;the&nbsp;FileInfo&nbsp;structure&nbsp;describing&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2558492">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2558548">func</span>&nbsp;<span class="op" id="2558553">(</span><span class="ident" id="2558554">f</span>&nbsp;<span class="op" id="2558556">*</span><span class="ident" id="2558557">File</span><span class="op" id="2558561">)</span>&nbsp;<span class="ident" id="2558563">Stat</span><span class="op" id="2558567">(</span><span class="op" id="2558568">)</span>&nbsp;<span class="op" id="2558570">(</span><span class="ident" id="2558571">fi</span>&nbsp;<span class="ident" id="2558574">FileInfo</span><span class="op" id="2558582">,</span>&nbsp;<span class="ident" id="2558584">err</span>&nbsp;<span class="builtintype" id="2558588">error</span><span class="op" id="2558593">)</span>&nbsp;<span class="op" id="2558595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2558598">if</span>&nbsp;<span class="ident" id="2558601">f</span>&nbsp;<span class="op" id="2558603">==</span>&nbsp;<span class="ident" id="2558606">nil</span>&nbsp;<span class="op" id="2558610">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2558614">return</span>&nbsp;<span class="ident" id="2558621">nil</span><span class="op" id="2558624">,</span>&nbsp;<span class="ident" id="2558626">ErrInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2558638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2558641">var</span>&nbsp;<span class="ident" id="2558645">stat</span>&nbsp;<span class="ident" id="2558650">syscall</span><span class="op" id="2558657">.</span><span class="ident" id="2558658">Stat_t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2558666">err</span>&nbsp;<span class="op" id="2558670">=</span>&nbsp;<span class="ident" id="2558672">syscall</span><span class="op" id="2558679">.</span><span class="ident" id="2558680">Fstat</span><span class="op" id="2558685">(</span><span class="ident" id="2558686">f</span><span class="op" id="2558687">.</span><span class="ident" id="2558688">fd</span><span class="op" id="2558690">,</span>&nbsp;<span class="op" id="2558692">&amp;</span><span class="ident" id="2558693">stat</span><span class="op" id="2558697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2558700">if</span>&nbsp;<span class="ident" id="2558703">err</span>&nbsp;<span class="op" id="2558707">!=</span>&nbsp;<span class="ident" id="2558710">nil</span>&nbsp;<span class="op" id="2558714">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2558718">return</span>&nbsp;<span class="ident" id="2558725">nil</span><span class="op" id="2558728">,</span>&nbsp;<span class="op" id="2558730">&amp;</span><span class="ident" id="2558731">PathError</span><span class="op" id="2558740">{</span><span class="string" id="2558741">&#34;stat&#34;</span><span class="op" id="2558747">,</span>&nbsp;<span class="ident" id="2558749">f</span><span class="op" id="2558750">.</span><span class="ident" id="2558751">name</span><span class="op" id="2558755">,</span>&nbsp;<span class="ident" id="2558757">err</span><span class="op" id="2558760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2558763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2558766">return</span>&nbsp;<span class="ident" id="2558773">fileInfoFromStat</span><span class="op" id="2558789">(</span><span class="op" id="2558790">&amp;</span><span class="ident" id="2558791">stat</span><span class="op" id="2558795">,</span>&nbsp;<span class="ident" id="2558797">f</span><span class="op" id="2558798">.</span><span class="ident" id="2558799">name</span><span class="op" id="2558803">)</span><span class="op" id="2558804">,</span>&nbsp;<span class="ident" id="2558806">nil</span><br>
<span class="lineno"></span><span class="op" id="2558810">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="2558813">//&nbsp;Stat&nbsp;returns&nbsp;a&nbsp;FileInfo&nbsp;describing&nbsp;the&nbsp;named&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2558867">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2558923">func</span>&nbsp;<span class="ident" id="2558928">Stat</span><span class="op" id="2558932">(</span><span class="ident" id="2558933">name</span>&nbsp;<span class="builtintype" id="2558938">string</span><span class="op" id="2558944">)</span>&nbsp;<span class="op" id="2558946">(</span><span class="ident" id="2558947">fi</span>&nbsp;<span class="ident" id="2558950">FileInfo</span><span class="op" id="2558958">,</span>&nbsp;<span class="ident" id="2558960">err</span>&nbsp;<span class="builtintype" id="2558964">error</span><span class="op" id="2558969">)</span>&nbsp;<span class="op" id="2558971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2558974">var</span>&nbsp;<span class="ident" id="2558978">stat</span>&nbsp;<span class="ident" id="2558983">syscall</span><span class="op" id="2558990">.</span><span class="ident" id="2558991">Stat_t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2558999">err</span>&nbsp;<span class="op" id="2559003">=</span>&nbsp;<span class="ident" id="2559005">syscall</span><span class="op" id="2559012">.</span><span class="ident" id="2559013">Stat</span><span class="op" id="2559017">(</span><span class="ident" id="2559018">name</span><span class="op" id="2559022">,</span>&nbsp;<span class="op" id="2559024">&amp;</span><span class="ident" id="2559025">stat</span><span class="op" id="2559029">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2559032">if</span>&nbsp;<span class="ident" id="2559035">err</span>&nbsp;<span class="op" id="2559039">!=</span>&nbsp;<span class="ident" id="2559042">nil</span>&nbsp;<span class="op" id="2559046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2559050">return</span>&nbsp;<span class="ident" id="2559057">nil</span><span class="op" id="2559060">,</span>&nbsp;<span class="op" id="2559062">&amp;</span><span class="ident" id="2559063">PathError</span><span class="op" id="2559072">{</span><span class="string" id="2559073">&#34;stat&#34;</span><span class="op" id="2559079">,</span>&nbsp;<span class="ident" id="2559081">name</span><span class="op" id="2559085">,</span>&nbsp;<span class="ident" id="2559087">err</span><span class="op" id="2559090">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2559093">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2559096">return</span>&nbsp;<span class="ident" id="2559103">fileInfoFromStat</span><span class="op" id="2559119">(</span><span class="op" id="2559120">&amp;</span><span class="ident" id="2559121">stat</span><span class="op" id="2559125">,</span>&nbsp;<span class="ident" id="2559127">name</span><span class="op" id="2559131">)</span><span class="op" id="2559132">,</span>&nbsp;<span class="ident" id="2559134">nil</span><br>
<span class="lineno"></span><span class="op" id="2559138">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="comment" id="2559141">//&nbsp;Lstat&nbsp;returns&nbsp;a&nbsp;FileInfo&nbsp;describing&nbsp;the&nbsp;named&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2559196">//&nbsp;If&nbsp;the&nbsp;file&nbsp;is&nbsp;a&nbsp;symbolic&nbsp;link,&nbsp;the&nbsp;returned&nbsp;FileInfo</span><br>
<span class="lineno"></span><span class="comment" id="2559253">//&nbsp;describes&nbsp;the&nbsp;symbolic&nbsp;link.&nbsp;&nbsp;Lstat&nbsp;makes&nbsp;no&nbsp;attempt&nbsp;to&nbsp;follow&nbsp;the&nbsp;link.</span><br>
<span class="lineno"></span><span class="comment" id="2559329">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno">145</span><span class="keyword" id="2559385">func</span>&nbsp;<span class="ident" id="2559390">Lstat</span><span class="op" id="2559395">(</span><span class="ident" id="2559396">name</span>&nbsp;<span class="builtintype" id="2559401">string</span><span class="op" id="2559407">)</span>&nbsp;<span class="op" id="2559409">(</span><span class="ident" id="2559410">fi</span>&nbsp;<span class="ident" id="2559413">FileInfo</span><span class="op" id="2559421">,</span>&nbsp;<span class="ident" id="2559423">err</span>&nbsp;<span class="builtintype" id="2559427">error</span><span class="op" id="2559432">)</span>&nbsp;<span class="op" id="2559434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2559437">var</span>&nbsp;<span class="ident" id="2559441">stat</span>&nbsp;<span class="ident" id="2559446">syscall</span><span class="op" id="2559453">.</span><span class="ident" id="2559454">Stat_t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2559462">err</span>&nbsp;<span class="op" id="2559466">=</span>&nbsp;<span class="ident" id="2559468">syscall</span><span class="op" id="2559475">.</span><span class="ident" id="2559476">Lstat</span><span class="op" id="2559481">(</span><span class="ident" id="2559482">name</span><span class="op" id="2559486">,</span>&nbsp;<span class="op" id="2559488">&amp;</span><span class="ident" id="2559489">stat</span><span class="op" id="2559493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2559496">if</span>&nbsp;<span class="ident" id="2559499">err</span>&nbsp;<span class="op" id="2559503">!=</span>&nbsp;<span class="ident" id="2559506">nil</span>&nbsp;<span class="op" id="2559510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2559514">return</span>&nbsp;<span class="ident" id="2559521">nil</span><span class="op" id="2559524">,</span>&nbsp;<span class="op" id="2559526">&amp;</span><span class="ident" id="2559527">PathError</span><span class="op" id="2559536">{</span><span class="string" id="2559537">&#34;lstat&#34;</span><span class="op" id="2559544">,</span>&nbsp;<span class="ident" id="2559546">name</span><span class="op" id="2559550">,</span>&nbsp;<span class="ident" id="2559552">err</span><span class="op" id="2559555">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2559558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2559561">return</span>&nbsp;<span class="ident" id="2559568">fileInfoFromStat</span><span class="op" id="2559584">(</span><span class="op" id="2559585">&amp;</span><span class="ident" id="2559586">stat</span><span class="op" id="2559590">,</span>&nbsp;<span class="ident" id="2559592">name</span><span class="op" id="2559596">)</span><span class="op" id="2559597">,</span>&nbsp;<span class="ident" id="2559599">nil</span><br>
<span class="lineno"></span><span class="op" id="2559603">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2559606">func</span>&nbsp;<span class="op" id="2559611">(</span><span class="ident" id="2559612">f</span>&nbsp;<span class="op" id="2559614">*</span><span class="ident" id="2559615">File</span><span class="op" id="2559619">)</span>&nbsp;<span class="ident" id="2559621">readdir</span><span class="op" id="2559628">(</span><span class="ident" id="2559629">n</span>&nbsp;<span class="builtintype" id="2559631">int</span><span class="op" id="2559634">)</span>&nbsp;<span class="op" id="2559636">(</span><span class="ident" id="2559637">fi</span>&nbsp;<span class="op" id="2559640">[</span><span class="op" id="2559641">]</span><span class="ident" id="2559642">FileInfo</span><span class="op" id="2559650">,</span>&nbsp;<span class="ident" id="2559652">err</span>&nbsp;<span class="builtintype" id="2559656">error</span><span class="op" id="2559661">)</span>&nbsp;<span class="op" id="2559663">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2559666">dirname</span>&nbsp;<span class="op" id="2559674">:=</span>&nbsp;<span class="ident" id="2559677">f</span><span class="op" id="2559678">.</span><span class="ident" id="2559679">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2559685">if</span>&nbsp;<span class="ident" id="2559688">dirname</span>&nbsp;<span class="op" id="2559696">==</span>&nbsp;<span class="string" id="2559699">&#34;&#34;</span>&nbsp;<span class="op" id="2559702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2559706">dirname</span>&nbsp;<span class="op" id="2559714">=</span>&nbsp;<span class="string" id="2559716">&#34;.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2559721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2559724">names</span><span class="op" id="2559729">,</span>&nbsp;<span class="ident" id="2559731">err</span>&nbsp;<span class="op" id="2559735">:=</span>&nbsp;<span class="ident" id="2559738">f</span><span class="op" id="2559739">.</span><span class="ident" id="2559740">Readdirnames</span><span class="op" id="2559752">(</span><span class="ident" id="2559753">n</span><span class="op" id="2559754">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2559757">fi</span>&nbsp;<span class="op" id="2559760">=</span>&nbsp;<span class="builtinfunc" id="2559762">make</span><span class="op" id="2559766">(</span><span class="op" id="2559767">[</span><span class="op" id="2559768">]</span><span class="ident" id="2559769">FileInfo</span><span class="op" id="2559777">,</span>&nbsp;<span class="num" id="2559779">0</span><span class="op" id="2559780">,</span>&nbsp;<span class="builtinfunc" id="2559782">len</span><span class="op" id="2559785">(</span><span class="ident" id="2559786">names</span><span class="op" id="2559791">)</span><span class="op" id="2559792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2559795">for</span>&nbsp;<span class="ident" id="2559799">_</span><span class="op" id="2559800">,</span>&nbsp;<span class="ident" id="2559802">filename</span>&nbsp;<span class="op" id="2559811">:=</span>&nbsp;<span class="keyword" id="2559814">range</span>&nbsp;<span class="ident" id="2559820">names</span>&nbsp;<span class="op" id="2559826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2559830">fip</span><span class="op" id="2559833">,</span>&nbsp;<span class="ident" id="2559835">lerr</span>&nbsp;<span class="op" id="2559840">:=</span>&nbsp;<span class="ident" id="2559843">lstat</span><span class="op" id="2559848">(</span><span class="ident" id="2559849">dirname</span>&nbsp;<span class="op" id="2559857">+</span>&nbsp;<span class="string" id="2559859">&#34;/&#34;</span>&nbsp;<span class="op" id="2559863">+</span>&nbsp;<span class="ident" id="2559865">filename</span><span class="op" id="2559873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2559877">if</span>&nbsp;<span class="ident" id="2559880">IsNotExist</span><span class="op" id="2559890">(</span><span class="ident" id="2559891">lerr</span><span class="op" id="2559895">)</span>&nbsp;<span class="op" id="2559897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2559902">//&nbsp;File&nbsp;disappeared&nbsp;between&nbsp;readdir&nbsp;+&nbsp;stat.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2559949">//&nbsp;Just&nbsp;treat&nbsp;it&nbsp;as&nbsp;if&nbsp;it&nbsp;didn&#39;t&nbsp;exist.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2559992">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2560003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2560007">if</span>&nbsp;<span class="ident" id="2560010">lerr</span>&nbsp;<span class="op" id="2560015">!=</span>&nbsp;<span class="ident" id="2560018">nil</span>&nbsp;<span class="op" id="2560022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2560027">return</span>&nbsp;<span class="ident" id="2560034">fi</span><span class="op" id="2560036">,</span>&nbsp;<span class="ident" id="2560038">lerr</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2560045">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2560049">fi</span>&nbsp;<span class="op" id="2560052">=</span>&nbsp;<span class="builtinfunc" id="2560054">append</span><span class="op" id="2560060">(</span><span class="ident" id="2560061">fi</span><span class="op" id="2560063">,</span>&nbsp;<span class="ident" id="2560065">fip</span><span class="op" id="2560068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2560071">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2560074">return</span>&nbsp;<span class="ident" id="2560081">fi</span><span class="op" id="2560083">,</span>&nbsp;<span class="ident" id="2560085">err</span><br>
<span class="lineno"></span><span class="op" id="2560089">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="comment" id="2560092">//&nbsp;Darwin&nbsp;and&nbsp;FreeBSD&nbsp;can&#39;t&nbsp;read&nbsp;or&nbsp;write&nbsp;2GB+&nbsp;at&nbsp;a&nbsp;time,</span><br>
<span class="lineno"></span><span class="comment" id="2560150">//&nbsp;even&nbsp;on&nbsp;64-bit&nbsp;systems.&nbsp;See&nbsp;golang.org/issue/7812.</span><br>
<span class="lineno"></span><span class="comment" id="2560204">//&nbsp;Use&nbsp;1GB&nbsp;instead&nbsp;of,&nbsp;say,&nbsp;2GB-1,&nbsp;to&nbsp;keep&nbsp;subsequent</span><br>
<span class="lineno"></span><span class="comment" id="2560258">//&nbsp;reads&nbsp;aligned.</span><br>
<span class="lineno">180</span><span class="keyword" id="2560276">const</span>&nbsp;<span class="op" id="2560282">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2560285">needsMaxRW</span>&nbsp;<span class="op" id="2560296">=</span>&nbsp;<span class="ident" id="2560298">runtime</span><span class="op" id="2560305">.</span><span class="ident" id="2560306">GOOS</span>&nbsp;<span class="op" id="2560311">==</span>&nbsp;<span class="string" id="2560314">&#34;darwin&#34;</span>&nbsp;<span class="op" id="2560323">||</span>&nbsp;<span class="ident" id="2560326">runtime</span><span class="op" id="2560333">.</span><span class="ident" id="2560334">GOOS</span>&nbsp;<span class="op" id="2560339">==</span>&nbsp;<span class="string" id="2560342">&#34;freebsd&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2560353">maxRW</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2560364">=</span>&nbsp;<span class="num" id="2560366">1</span>&nbsp;<span class="op" id="2560368">&lt;&lt;</span>&nbsp;<span class="num" id="2560371">30</span><br>
<span class="lineno"></span><span class="op" id="2560374">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="comment" id="2560377">//&nbsp;read&nbsp;reads&nbsp;up&nbsp;to&nbsp;len(b)&nbsp;bytes&nbsp;from&nbsp;the&nbsp;File.</span><br>
<span class="lineno"></span><span class="comment" id="2560425">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2560486">func</span>&nbsp;<span class="op" id="2560491">(</span><span class="ident" id="2560492">f</span>&nbsp;<span class="op" id="2560494">*</span><span class="ident" id="2560495">File</span><span class="op" id="2560499">)</span>&nbsp;<span class="ident" id="2560501">read</span><span class="op" id="2560505">(</span><span class="ident" id="2560506">b</span>&nbsp;<span class="op" id="2560508">[</span><span class="op" id="2560509">]</span><span class="builtintype" id="2560510">byte</span><span class="op" id="2560514">)</span>&nbsp;<span class="op" id="2560516">(</span><span class="ident" id="2560517">n</span>&nbsp;<span class="builtintype" id="2560519">int</span><span class="op" id="2560522">,</span>&nbsp;<span class="ident" id="2560524">err</span>&nbsp;<span class="builtintype" id="2560528">error</span><span class="op" id="2560533">)</span>&nbsp;<span class="op" id="2560535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2560538">if</span>&nbsp;<span class="ident" id="2560541">needsMaxRW</span>&nbsp;<span class="op" id="2560552">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2560555">len</span><span class="op" id="2560558">(</span><span class="ident" id="2560559">b</span><span class="op" id="2560560">)</span>&nbsp;<span class="op" id="2560562">&gt;</span>&nbsp;<span class="ident" id="2560564">maxRW</span>&nbsp;<span class="op" id="2560570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2560574">b</span>&nbsp;<span class="op" id="2560576">=</span>&nbsp;<span class="ident" id="2560578">b</span><span class="op" id="2560579">[</span><span class="op" id="2560580">:</span><span class="ident" id="2560581">maxRW</span><span class="op" id="2560586">]</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2560589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2560592">return</span>&nbsp;<span class="ident" id="2560599">fixCount</span><span class="op" id="2560607">(</span><span class="ident" id="2560608">syscall</span><span class="op" id="2560615">.</span><span class="ident" id="2560616">Read</span><span class="op" id="2560620">(</span><span class="ident" id="2560621">f</span><span class="op" id="2560622">.</span><span class="ident" id="2560623">fd</span><span class="op" id="2560625">,</span>&nbsp;<span class="ident" id="2560627">b</span><span class="op" id="2560628">)</span><span class="op" id="2560629">)</span><br>
<span class="lineno"></span><span class="op" id="2560631">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2560634">//&nbsp;pread&nbsp;reads&nbsp;len(b)&nbsp;bytes&nbsp;from&nbsp;the&nbsp;File&nbsp;starting&nbsp;at&nbsp;byte&nbsp;offset&nbsp;off.</span><br>
<span class="lineno">195</span><span class="comment" id="2560705">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;and&nbsp;the&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="comment" id="2560767">//&nbsp;EOF&nbsp;is&nbsp;signaled&nbsp;by&nbsp;a&nbsp;zero&nbsp;count&nbsp;with&nbsp;err&nbsp;set&nbsp;to&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="2560823">func</span>&nbsp;<span class="op" id="2560828">(</span><span class="ident" id="2560829">f</span>&nbsp;<span class="op" id="2560831">*</span><span class="ident" id="2560832">File</span><span class="op" id="2560836">)</span>&nbsp;<span class="ident" id="2560838">pread</span><span class="op" id="2560843">(</span><span class="ident" id="2560844">b</span>&nbsp;<span class="op" id="2560846">[</span><span class="op" id="2560847">]</span><span class="builtintype" id="2560848">byte</span><span class="op" id="2560852">,</span>&nbsp;<span class="ident" id="2560854">off</span>&nbsp;<span class="ident" id="2560858">int64</span><span class="op" id="2560863">)</span>&nbsp;<span class="op" id="2560865">(</span><span class="ident" id="2560866">n</span>&nbsp;<span class="builtintype" id="2560868">int</span><span class="op" id="2560871">,</span>&nbsp;<span class="ident" id="2560873">err</span>&nbsp;<span class="builtintype" id="2560877">error</span><span class="op" id="2560882">)</span>&nbsp;<span class="op" id="2560884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2560887">if</span>&nbsp;<span class="ident" id="2560890">needsMaxRW</span>&nbsp;<span class="op" id="2560901">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2560904">len</span><span class="op" id="2560907">(</span><span class="ident" id="2560908">b</span><span class="op" id="2560909">)</span>&nbsp;<span class="op" id="2560911">&gt;</span>&nbsp;<span class="ident" id="2560913">maxRW</span>&nbsp;<span class="op" id="2560919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2560923">b</span>&nbsp;<span class="op" id="2560925">=</span>&nbsp;<span class="ident" id="2560927">b</span><span class="op" id="2560928">[</span><span class="op" id="2560929">:</span><span class="ident" id="2560930">maxRW</span><span class="op" id="2560935">]</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2560938">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2560941">return</span>&nbsp;<span class="ident" id="2560948">fixCount</span><span class="op" id="2560956">(</span><span class="ident" id="2560957">syscall</span><span class="op" id="2560964">.</span><span class="ident" id="2560965">Pread</span><span class="op" id="2560970">(</span><span class="ident" id="2560971">f</span><span class="op" id="2560972">.</span><span class="ident" id="2560973">fd</span><span class="op" id="2560975">,</span>&nbsp;<span class="ident" id="2560977">b</span><span class="op" id="2560978">,</span>&nbsp;<span class="ident" id="2560980">off</span><span class="op" id="2560983">)</span><span class="op" id="2560984">)</span><br>
<span class="lineno"></span><span class="op" id="2560986">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2560989">//&nbsp;write&nbsp;writes&nbsp;len(b)&nbsp;bytes&nbsp;to&nbsp;the&nbsp;File.</span><br>
<span class="lineno">205</span><span class="comment" id="2561031">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2561095">func</span>&nbsp;<span class="op" id="2561100">(</span><span class="ident" id="2561101">f</span>&nbsp;<span class="op" id="2561103">*</span><span class="ident" id="2561104">File</span><span class="op" id="2561108">)</span>&nbsp;<span class="ident" id="2561110">write</span><span class="op" id="2561115">(</span><span class="ident" id="2561116">b</span>&nbsp;<span class="op" id="2561118">[</span><span class="op" id="2561119">]</span><span class="builtintype" id="2561120">byte</span><span class="op" id="2561124">)</span>&nbsp;<span class="op" id="2561126">(</span><span class="ident" id="2561127">n</span>&nbsp;<span class="builtintype" id="2561129">int</span><span class="op" id="2561132">,</span>&nbsp;<span class="ident" id="2561134">err</span>&nbsp;<span class="builtintype" id="2561138">error</span><span class="op" id="2561143">)</span>&nbsp;<span class="op" id="2561145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2561148">for</span>&nbsp;<span class="op" id="2561152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2561156">bcap</span>&nbsp;<span class="op" id="2561161">:=</span>&nbsp;<span class="ident" id="2561164">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2561168">if</span>&nbsp;<span class="ident" id="2561171">needsMaxRW</span>&nbsp;<span class="op" id="2561182">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2561185">len</span><span class="op" id="2561188">(</span><span class="ident" id="2561189">bcap</span><span class="op" id="2561193">)</span>&nbsp;<span class="op" id="2561195">&gt;</span>&nbsp;<span class="ident" id="2561197">maxRW</span>&nbsp;<span class="op" id="2561203">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2561208">bcap</span>&nbsp;<span class="op" id="2561213">=</span>&nbsp;<span class="ident" id="2561215">bcap</span><span class="op" id="2561219">[</span><span class="op" id="2561220">:</span><span class="ident" id="2561221">maxRW</span><span class="op" id="2561226">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2561230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2561234">m</span><span class="op" id="2561235">,</span>&nbsp;<span class="ident" id="2561237">err</span>&nbsp;<span class="op" id="2561241">:=</span>&nbsp;<span class="ident" id="2561244">fixCount</span><span class="op" id="2561252">(</span><span class="ident" id="2561253">syscall</span><span class="op" id="2561260">.</span><span class="ident" id="2561261">Write</span><span class="op" id="2561266">(</span><span class="ident" id="2561267">f</span><span class="op" id="2561268">.</span><span class="ident" id="2561269">fd</span><span class="op" id="2561271">,</span>&nbsp;<span class="ident" id="2561273">bcap</span><span class="op" id="2561277">)</span><span class="op" id="2561278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2561282">n</span>&nbsp;<span class="op" id="2561284">+=</span>&nbsp;<span class="ident" id="2561287">m</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2561292">//&nbsp;If&nbsp;the&nbsp;syscall&nbsp;wrote&nbsp;some&nbsp;data&nbsp;but&nbsp;not&nbsp;all&nbsp;(short&nbsp;write)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2561354">//&nbsp;or&nbsp;it&nbsp;returned&nbsp;EINTR,&nbsp;then&nbsp;assume&nbsp;it&nbsp;stopped&nbsp;early&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2561414">//&nbsp;reasons&nbsp;that&nbsp;are&nbsp;uninteresting&nbsp;to&nbsp;the&nbsp;caller,&nbsp;and&nbsp;try&nbsp;again.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2561480">if</span>&nbsp;<span class="num" id="2561483">0</span>&nbsp;<span class="op" id="2561485">&lt;</span>&nbsp;<span class="ident" id="2561487">m</span>&nbsp;<span class="op" id="2561489">&amp;&amp;</span>&nbsp;<span class="ident" id="2561492">m</span>&nbsp;<span class="op" id="2561494">&lt;</span>&nbsp;<span class="builtinfunc" id="2561496">len</span><span class="op" id="2561499">(</span><span class="ident" id="2561500">bcap</span><span class="op" id="2561504">)</span>&nbsp;<span class="op" id="2561506">||</span>&nbsp;<span class="ident" id="2561509">err</span>&nbsp;<span class="op" id="2561513">==</span>&nbsp;<span class="ident" id="2561516">syscall</span><span class="op" id="2561523">.</span><span class="ident" id="2561524">EINTR</span>&nbsp;<span class="op" id="2561530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2561535">b</span>&nbsp;<span class="op" id="2561537">=</span>&nbsp;<span class="ident" id="2561539">b</span><span class="op" id="2561540">[</span><span class="ident" id="2561541">m</span><span class="op" id="2561542">:</span><span class="op" id="2561543">]</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2561548">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2561559">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2561564">if</span>&nbsp;<span class="ident" id="2561567">needsMaxRW</span>&nbsp;<span class="op" id="2561578">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2561581">len</span><span class="op" id="2561584">(</span><span class="ident" id="2561585">bcap</span><span class="op" id="2561589">)</span>&nbsp;<span class="op" id="2561591">!=</span>&nbsp;<span class="builtinfunc" id="2561594">len</span><span class="op" id="2561597">(</span><span class="ident" id="2561598">b</span><span class="op" id="2561599">)</span>&nbsp;<span class="op" id="2561601">&amp;&amp;</span>&nbsp;<span class="ident" id="2561604">err</span>&nbsp;<span class="op" id="2561608">==</span>&nbsp;<span class="ident" id="2561611">nil</span>&nbsp;<span class="op" id="2561615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2561620">b</span>&nbsp;<span class="op" id="2561622">=</span>&nbsp;<span class="ident" id="2561624">b</span><span class="op" id="2561625">[</span><span class="ident" id="2561626">m</span><span class="op" id="2561627">:</span><span class="op" id="2561628">]</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2561633">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2561644">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2561649">return</span>&nbsp;<span class="ident" id="2561656">n</span><span class="op" id="2561657">,</span>&nbsp;<span class="ident" id="2561659">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2561664">}</span><br>
<span class="lineno">230</span><span class="op" id="2561666">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2561669">//&nbsp;pwrite&nbsp;writes&nbsp;len(b)&nbsp;bytes&nbsp;to&nbsp;the&nbsp;File&nbsp;starting&nbsp;at&nbsp;byte&nbsp;offset&nbsp;off.</span><br>
<span class="lineno"></span><span class="comment" id="2561740">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2561804">func</span>&nbsp;<span class="op" id="2561809">(</span><span class="ident" id="2561810">f</span>&nbsp;<span class="op" id="2561812">*</span><span class="ident" id="2561813">File</span><span class="op" id="2561817">)</span>&nbsp;<span class="ident" id="2561819">pwrite</span><span class="op" id="2561825">(</span><span class="ident" id="2561826">b</span>&nbsp;<span class="op" id="2561828">[</span><span class="op" id="2561829">]</span><span class="builtintype" id="2561830">byte</span><span class="op" id="2561834">,</span>&nbsp;<span class="ident" id="2561836">off</span>&nbsp;<span class="ident" id="2561840">int64</span><span class="op" id="2561845">)</span>&nbsp;<span class="op" id="2561847">(</span><span class="ident" id="2561848">n</span>&nbsp;<span class="builtintype" id="2561850">int</span><span class="op" id="2561853">,</span>&nbsp;<span class="ident" id="2561855">err</span>&nbsp;<span class="builtintype" id="2561859">error</span><span class="op" id="2561864">)</span>&nbsp;<span class="op" id="2561866">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2561869">if</span>&nbsp;<span class="ident" id="2561872">needsMaxRW</span>&nbsp;<span class="op" id="2561883">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2561886">len</span><span class="op" id="2561889">(</span><span class="ident" id="2561890">b</span><span class="op" id="2561891">)</span>&nbsp;<span class="op" id="2561893">&gt;</span>&nbsp;<span class="ident" id="2561895">maxRW</span>&nbsp;<span class="op" id="2561901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2561905">b</span>&nbsp;<span class="op" id="2561907">=</span>&nbsp;<span class="ident" id="2561909">b</span><span class="op" id="2561910">[</span><span class="op" id="2561911">:</span><span class="ident" id="2561912">maxRW</span><span class="op" id="2561917">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2561920">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2561923">return</span>&nbsp;<span class="ident" id="2561930">fixCount</span><span class="op" id="2561938">(</span><span class="ident" id="2561939">syscall</span><span class="op" id="2561946">.</span><span class="ident" id="2561947">Pwrite</span><span class="op" id="2561953">(</span><span class="ident" id="2561954">f</span><span class="op" id="2561955">.</span><span class="ident" id="2561956">fd</span><span class="op" id="2561958">,</span>&nbsp;<span class="ident" id="2561960">b</span><span class="op" id="2561961">,</span>&nbsp;<span class="ident" id="2561963">off</span><span class="op" id="2561966">)</span><span class="op" id="2561967">)</span><br>
<span class="lineno"></span><span class="op" id="2561969">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="comment" id="2561972">//&nbsp;seek&nbsp;sets&nbsp;the&nbsp;offset&nbsp;for&nbsp;the&nbsp;next&nbsp;Read&nbsp;or&nbsp;Write&nbsp;on&nbsp;file&nbsp;to&nbsp;offset,&nbsp;interpreted</span><br>
<span class="lineno"></span><span class="comment" id="2562054">//&nbsp;according&nbsp;to&nbsp;whence:&nbsp;0&nbsp;means&nbsp;relative&nbsp;to&nbsp;the&nbsp;origin&nbsp;of&nbsp;the&nbsp;file,&nbsp;1&nbsp;means</span><br>
<span class="lineno"></span><span class="comment" id="2562130">//&nbsp;relative&nbsp;to&nbsp;the&nbsp;current&nbsp;offset,&nbsp;and&nbsp;2&nbsp;means&nbsp;relative&nbsp;to&nbsp;the&nbsp;end.</span><br>
<span class="lineno"></span><span class="comment" id="2562198">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;new&nbsp;offset&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno">245</span><span class="keyword" id="2562249">func</span>&nbsp;<span class="op" id="2562254">(</span><span class="ident" id="2562255">f</span>&nbsp;<span class="op" id="2562257">*</span><span class="ident" id="2562258">File</span><span class="op" id="2562262">)</span>&nbsp;<span class="ident" id="2562264">seek</span><span class="op" id="2562268">(</span><span class="ident" id="2562269">offset</span>&nbsp;<span class="ident" id="2562276">int64</span><span class="op" id="2562281">,</span>&nbsp;<span class="ident" id="2562283">whence</span>&nbsp;<span class="builtintype" id="2562290">int</span><span class="op" id="2562293">)</span>&nbsp;<span class="op" id="2562295">(</span><span class="ident" id="2562296">ret</span>&nbsp;<span class="ident" id="2562300">int64</span><span class="op" id="2562305">,</span>&nbsp;<span class="ident" id="2562307">err</span>&nbsp;<span class="builtintype" id="2562311">error</span><span class="op" id="2562316">)</span>&nbsp;<span class="op" id="2562318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2562321">return</span>&nbsp;<span class="ident" id="2562328">syscall</span><span class="op" id="2562335">.</span><span class="ident" id="2562336">Seek</span><span class="op" id="2562340">(</span><span class="ident" id="2562341">f</span><span class="op" id="2562342">.</span><span class="ident" id="2562343">fd</span><span class="op" id="2562345">,</span>&nbsp;<span class="ident" id="2562347">offset</span><span class="op" id="2562353">,</span>&nbsp;<span class="ident" id="2562355">whence</span><span class="op" id="2562361">)</span><br>
<span class="lineno"></span><span class="op" id="2562363">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2562366">//&nbsp;Truncate&nbsp;changes&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;named&nbsp;file.</span><br>
<span class="lineno">250</span><span class="comment" id="2562414">//&nbsp;If&nbsp;the&nbsp;file&nbsp;is&nbsp;a&nbsp;symbolic&nbsp;link,&nbsp;it&nbsp;changes&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;link&#39;s&nbsp;target.</span><br>
<span class="lineno"></span><span class="comment" id="2562491">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2562547">func</span>&nbsp;<span class="ident" id="2562552">Truncate</span><span class="op" id="2562560">(</span><span class="ident" id="2562561">name</span>&nbsp;<span class="builtintype" id="2562566">string</span><span class="op" id="2562572">,</span>&nbsp;<span class="ident" id="2562574">size</span>&nbsp;<span class="ident" id="2562579">int64</span><span class="op" id="2562584">)</span>&nbsp;<span class="builtintype" id="2562586">error</span>&nbsp;<span class="op" id="2562592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2562595">if</span>&nbsp;<span class="ident" id="2562598">e</span>&nbsp;<span class="op" id="2562600">:=</span>&nbsp;<span class="ident" id="2562603">syscall</span><span class="op" id="2562610">.</span><span class="ident" id="2562611">Truncate</span><span class="op" id="2562619">(</span><span class="ident" id="2562620">name</span><span class="op" id="2562624">,</span>&nbsp;<span class="ident" id="2562626">size</span><span class="op" id="2562630">)</span><span class="op" id="2562631">;</span>&nbsp;<span class="ident" id="2562633">e</span>&nbsp;<span class="op" id="2562635">!=</span>&nbsp;<span class="ident" id="2562638">nil</span>&nbsp;<span class="op" id="2562642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2562646">return</span>&nbsp;<span class="op" id="2562653">&amp;</span><span class="ident" id="2562654">PathError</span><span class="op" id="2562663">{</span><span class="string" id="2562664">&#34;truncate&#34;</span><span class="op" id="2562674">,</span>&nbsp;<span class="ident" id="2562676">name</span><span class="op" id="2562680">,</span>&nbsp;<span class="ident" id="2562682">e</span><span class="op" id="2562683">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2562686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2562689">return</span>&nbsp;<span class="ident" id="2562696">nil</span><br>
<span class="lineno"></span><span class="op" id="2562700">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2562703">//&nbsp;Remove&nbsp;removes&nbsp;the&nbsp;named&nbsp;file&nbsp;or&nbsp;directory.</span><br>
<span class="lineno">260</span><span class="comment" id="2562750">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*PathError.</span><br>
<span class="lineno"></span><span class="keyword" id="2562806">func</span>&nbsp;<span class="ident" id="2562811">Remove</span><span class="op" id="2562817">(</span><span class="ident" id="2562818">name</span>&nbsp;<span class="builtintype" id="2562823">string</span><span class="op" id="2562829">)</span>&nbsp;<span class="builtintype" id="2562831">error</span>&nbsp;<span class="op" id="2562837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2562840">//&nbsp;System&nbsp;call&nbsp;interface&nbsp;forces&nbsp;us&nbsp;to&nbsp;know</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2562884">//&nbsp;whether&nbsp;name&nbsp;is&nbsp;a&nbsp;file&nbsp;or&nbsp;directory.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2562925">//&nbsp;Try&nbsp;both:&nbsp;it&nbsp;is&nbsp;cheaper&nbsp;on&nbsp;average&nbsp;than</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2562969">//&nbsp;doing&nbsp;a&nbsp;Stat&nbsp;plus&nbsp;the&nbsp;right&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2563006">e</span>&nbsp;<span class="op" id="2563008">:=</span>&nbsp;<span class="ident" id="2563011">syscall</span><span class="op" id="2563018">.</span><span class="ident" id="2563019">Unlink</span><span class="op" id="2563025">(</span><span class="ident" id="2563026">name</span><span class="op" id="2563030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2563033">if</span>&nbsp;<span class="ident" id="2563036">e</span>&nbsp;<span class="op" id="2563038">==</span>&nbsp;<span class="ident" id="2563041">nil</span>&nbsp;<span class="op" id="2563045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2563049">return</span>&nbsp;<span class="ident" id="2563056">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2563061">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2563064">e1</span>&nbsp;<span class="op" id="2563067">:=</span>&nbsp;<span class="ident" id="2563070">syscall</span><span class="op" id="2563077">.</span><span class="ident" id="2563078">Rmdir</span><span class="op" id="2563083">(</span><span class="ident" id="2563084">name</span><span class="op" id="2563088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2563091">if</span>&nbsp;<span class="ident" id="2563094">e1</span>&nbsp;<span class="op" id="2563097">==</span>&nbsp;<span class="ident" id="2563100">nil</span>&nbsp;<span class="op" id="2563104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2563108">return</span>&nbsp;<span class="ident" id="2563115">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2563120">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2563124">//&nbsp;Both&nbsp;failed:&nbsp;figure&nbsp;out&nbsp;which&nbsp;error&nbsp;to&nbsp;return.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2563175">//&nbsp;OS&nbsp;X&nbsp;and&nbsp;Linux&nbsp;differ&nbsp;on&nbsp;whether&nbsp;unlink(dir)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2563224">//&nbsp;returns&nbsp;EISDIR,&nbsp;so&nbsp;can&#39;t&nbsp;use&nbsp;that.&nbsp;&nbsp;However,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2563273">//&nbsp;both&nbsp;agree&nbsp;that&nbsp;rmdir(file)&nbsp;returns&nbsp;ENOTDIR,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2563322">//&nbsp;so&nbsp;we&nbsp;can&nbsp;use&nbsp;that&nbsp;to&nbsp;decide&nbsp;which&nbsp;error&nbsp;is&nbsp;real.</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2563376">//&nbsp;Rmdir&nbsp;might&nbsp;also&nbsp;return&nbsp;ENOTDIR&nbsp;if&nbsp;given&nbsp;a&nbsp;bad</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2563427">//&nbsp;file&nbsp;path,&nbsp;like&nbsp;/etc/passwd/foo,&nbsp;but&nbsp;in&nbsp;that&nbsp;case,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2563482">//&nbsp;both&nbsp;errors&nbsp;will&nbsp;be&nbsp;ENOTDIR,&nbsp;so&nbsp;it&#39;s&nbsp;okay&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2563531">//&nbsp;use&nbsp;the&nbsp;error&nbsp;from&nbsp;unlink.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2563562">if</span>&nbsp;<span class="ident" id="2563565">e1</span>&nbsp;<span class="op" id="2563568">!=</span>&nbsp;<span class="ident" id="2563571">syscall</span><span class="op" id="2563578">.</span><span class="ident" id="2563579">ENOTDIR</span>&nbsp;<span class="op" id="2563587">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2563591">e</span>&nbsp;<span class="op" id="2563593">=</span>&nbsp;<span class="ident" id="2563595">e1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2563599">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2563602">return</span>&nbsp;<span class="op" id="2563609">&amp;</span><span class="ident" id="2563610">PathError</span><span class="op" id="2563619">{</span><span class="string" id="2563620">&#34;remove&#34;</span><span class="op" id="2563628">,</span>&nbsp;<span class="ident" id="2563630">name</span><span class="op" id="2563634">,</span>&nbsp;<span class="ident" id="2563636">e</span><span class="op" id="2563637">}</span><br>
<span class="lineno"></span><span class="op" id="2563639">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="comment" id="2563642">//&nbsp;basename&nbsp;removes&nbsp;trailing&nbsp;slashes&nbsp;and&nbsp;the&nbsp;leading&nbsp;directory&nbsp;name&nbsp;from&nbsp;path&nbsp;name</span><br>
<span class="lineno"></span><span class="keyword" id="2563725">func</span>&nbsp;<span class="ident" id="2563730">basename</span><span class="op" id="2563738">(</span><span class="ident" id="2563739">name</span>&nbsp;<span class="builtintype" id="2563744">string</span><span class="op" id="2563750">)</span>&nbsp;<span class="builtintype" id="2563752">string</span>&nbsp;<span class="op" id="2563759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2563762">i</span>&nbsp;<span class="op" id="2563764">:=</span>&nbsp;<span class="builtinfunc" id="2563767">len</span><span class="op" id="2563770">(</span><span class="ident" id="2563771">name</span><span class="op" id="2563775">)</span>&nbsp;<span class="op" id="2563777">-</span>&nbsp;<span class="num" id="2563779">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2563782">//&nbsp;Remove&nbsp;trailing&nbsp;slashes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2563810">for</span>&nbsp;<span class="op" id="2563814">;</span>&nbsp;<span class="ident" id="2563816">i</span>&nbsp;<span class="op" id="2563818">&gt;</span>&nbsp;<span class="num" id="2563820">0</span>&nbsp;<span class="op" id="2563822">&amp;&amp;</span>&nbsp;<span class="ident" id="2563825">name</span><span class="op" id="2563829">[</span><span class="ident" id="2563830">i</span><span class="op" id="2563831">]</span>&nbsp;<span class="op" id="2563833">==</span>&nbsp;<span class="string" id="2563836">&#39;/&#39;</span><span class="op" id="2563839">;</span>&nbsp;<span class="ident" id="2563841">i</span><span class="op" id="2563842">--</span>&nbsp;<span class="op" id="2563845">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2563849">name</span>&nbsp;<span class="op" id="2563854">=</span>&nbsp;<span class="ident" id="2563856">name</span><span class="op" id="2563860">[</span><span class="op" id="2563861">:</span><span class="ident" id="2563862">i</span><span class="op" id="2563863">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2563866">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2563869">//&nbsp;Remove&nbsp;leading&nbsp;directory&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2563903">for</span>&nbsp;<span class="ident" id="2563907">i</span><span class="op" id="2563908">--</span><span class="op" id="2563910">;</span>&nbsp;<span class="ident" id="2563912">i</span>&nbsp;<span class="op" id="2563914">&gt;=</span>&nbsp;<span class="num" id="2563917">0</span><span class="op" id="2563918">;</span>&nbsp;<span class="ident" id="2563920">i</span><span class="op" id="2563921">--</span>&nbsp;<span class="op" id="2563924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2563928">if</span>&nbsp;<span class="ident" id="2563931">name</span><span class="op" id="2563935">[</span><span class="ident" id="2563936">i</span><span class="op" id="2563937">]</span>&nbsp;<span class="op" id="2563939">==</span>&nbsp;<span class="string" id="2563942">&#39;/&#39;</span>&nbsp;<span class="op" id="2563946">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2563951">name</span>&nbsp;<span class="op" id="2563956">=</span>&nbsp;<span class="ident" id="2563958">name</span><span class="op" id="2563962">[</span><span class="ident" id="2563963">i</span><span class="op" id="2563964">+</span><span class="num" id="2563965">1</span><span class="op" id="2563966">:</span><span class="op" id="2563967">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2563972">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2563980">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2563983">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2563987">return</span>&nbsp;<span class="ident" id="2563994">name</span><br>
<span class="lineno"></span><span class="op" id="2563999">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2564002">//&nbsp;TempDir&nbsp;returns&nbsp;the&nbsp;default&nbsp;directory&nbsp;to&nbsp;use&nbsp;for&nbsp;temporary&nbsp;files.</span><br>
<span class="lineno"></span><span class="keyword" id="2564071">func</span>&nbsp;<span class="ident" id="2564076">TempDir</span><span class="op" id="2564083">(</span><span class="op" id="2564084">)</span>&nbsp;<span class="builtintype" id="2564086">string</span>&nbsp;<span class="op" id="2564093">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2564096">dir</span>&nbsp;<span class="op" id="2564100">:=</span>&nbsp;<span class="ident" id="2564103">Getenv</span><span class="op" id="2564109">(</span><span class="string" id="2564110">&#34;TMPDIR&#34;</span><span class="op" id="2564118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2564121">if</span>&nbsp;<span class="ident" id="2564124">dir</span>&nbsp;<span class="op" id="2564128">==</span>&nbsp;<span class="string" id="2564131">&#34;&#34;</span>&nbsp;<span class="op" id="2564134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2564138">if</span>&nbsp;<span class="ident" id="2564141">runtime</span><span class="op" id="2564148">.</span><span class="ident" id="2564149">GOOS</span>&nbsp;<span class="op" id="2564154">==</span>&nbsp;<span class="string" id="2564157">&#34;android&#34;</span>&nbsp;<span class="op" id="2564167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2564172">dir</span>&nbsp;<span class="op" id="2564176">=</span>&nbsp;<span class="string" id="2564178">&#34;/data/local/tmp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2564198">}</span>&nbsp;<span class="keyword" id="2564200">else</span>&nbsp;<span class="op" id="2564205">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2564210">dir</span>&nbsp;<span class="op" id="2564214">=</span>&nbsp;<span class="string" id="2564216">&#34;/tmp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2564225">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2564228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2564231">return</span>&nbsp;<span class="ident" id="2564238">dir</span><br>
<span class="lineno"></span><span class="op" id="2564242">}</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span><span class="comment" id="2564245">//&nbsp;Link&nbsp;creates&nbsp;newname&nbsp;as&nbsp;a&nbsp;hard&nbsp;link&nbsp;to&nbsp;the&nbsp;oldname&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="2564305">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*LinkError.</span><br>
<span class="lineno"></span><span class="keyword" id="2564361">func</span>&nbsp;<span class="ident" id="2564366">Link</span><span class="op" id="2564370">(</span><span class="ident" id="2564371">oldname</span><span class="op" id="2564378">,</span>&nbsp;<span class="ident" id="2564380">newname</span>&nbsp;<span class="builtintype" id="2564388">string</span><span class="op" id="2564394">)</span>&nbsp;<span class="builtintype" id="2564396">error</span>&nbsp;<span class="op" id="2564402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2564405">e</span>&nbsp;<span class="op" id="2564407">:=</span>&nbsp;<span class="ident" id="2564410">syscall</span><span class="op" id="2564417">.</span><span class="ident" id="2564418">Link</span><span class="op" id="2564422">(</span><span class="ident" id="2564423">oldname</span><span class="op" id="2564430">,</span>&nbsp;<span class="ident" id="2564432">newname</span><span class="op" id="2564439">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2564442">if</span>&nbsp;<span class="ident" id="2564445">e</span>&nbsp;<span class="op" id="2564447">!=</span>&nbsp;<span class="ident" id="2564450">nil</span>&nbsp;<span class="op" id="2564454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2564458">return</span>&nbsp;<span class="op" id="2564465">&amp;</span><span class="ident" id="2564466">LinkError</span><span class="op" id="2564475">{</span><span class="string" id="2564476">&#34;link&#34;</span><span class="op" id="2564482">,</span>&nbsp;<span class="ident" id="2564484">oldname</span><span class="op" id="2564491">,</span>&nbsp;<span class="ident" id="2564493">newname</span><span class="op" id="2564500">,</span>&nbsp;<span class="ident" id="2564502">e</span><span class="op" id="2564503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2564506">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2564509">return</span>&nbsp;<span class="ident" id="2564516">nil</span><br>
<span class="lineno"></span><span class="op" id="2564520">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="comment" id="2564523">//&nbsp;Symlink&nbsp;creates&nbsp;newname&nbsp;as&nbsp;a&nbsp;symbolic&nbsp;link&nbsp;to&nbsp;oldname.</span><br>
<span class="lineno"></span><span class="comment" id="2564581">//&nbsp;If&nbsp;there&nbsp;is&nbsp;an&nbsp;error,&nbsp;it&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;*LinkError.</span><br>
<span class="lineno"></span><span class="keyword" id="2564637">func</span>&nbsp;<span class="ident" id="2564642">Symlink</span><span class="op" id="2564649">(</span><span class="ident" id="2564650">oldname</span><span class="op" id="2564657">,</span>&nbsp;<span class="ident" id="2564659">newname</span>&nbsp;<span class="builtintype" id="2564667">string</span><span class="op" id="2564673">)</span>&nbsp;<span class="builtintype" id="2564675">error</span>&nbsp;<span class="op" id="2564681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2564684">e</span>&nbsp;<span class="op" id="2564686">:=</span>&nbsp;<span class="ident" id="2564689">syscall</span><span class="op" id="2564696">.</span><span class="ident" id="2564697">Symlink</span><span class="op" id="2564704">(</span><span class="ident" id="2564705">oldname</span><span class="op" id="2564712">,</span>&nbsp;<span class="ident" id="2564714">newname</span><span class="op" id="2564721">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2564724">if</span>&nbsp;<span class="ident" id="2564727">e</span>&nbsp;<span class="op" id="2564729">!=</span>&nbsp;<span class="ident" id="2564732">nil</span>&nbsp;<span class="op" id="2564736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2564740">return</span>&nbsp;<span class="op" id="2564747">&amp;</span><span class="ident" id="2564748">LinkError</span><span class="op" id="2564757">{</span><span class="string" id="2564758">&#34;symlink&#34;</span><span class="op" id="2564767">,</span>&nbsp;<span class="ident" id="2564769">oldname</span><span class="op" id="2564776">,</span>&nbsp;<span class="ident" id="2564778">newname</span><span class="op" id="2564785">,</span>&nbsp;<span class="ident" id="2564787">e</span><span class="op" id="2564788">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2564791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2564794">return</span>&nbsp;<span class="ident" id="2564801">nil</span><br>
<span class="lineno"></span><span class="op" id="2564805">}</span>
</div>
</body>
</html>
