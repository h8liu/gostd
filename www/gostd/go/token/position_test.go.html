<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/token</h2>
<ul>
<li><a href="/gostd/go/token/position.go.html">position.go</a></li>
<li><a href="/gostd/go/token/position_test.go.html">position_test.go</a></li>
<li><a href="/gostd/go/token/serialize.go.html">serialize.go</a></li>
<li><a href="/gostd/go/token/serialize_test.go.html">serialize_test.go</a></li>
<li><a href="/gostd/go/token/token.go.html">token.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7173226">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7173281">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7173335">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7173386">package</span>&nbsp;<span class="ident" id="7173394">token</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7173401">import</span>&nbsp;<span class="op" id="7173408">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7173411">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7173418">&#34;math/rand&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7173431">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7173439">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7173449">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7173452">func</span>&nbsp;<span class="ident" id="7173457">checkPos</span><span class="op" id="7173465">(</span><span class="ident" id="7173466">t</span>&nbsp;<span class="op" id="7173468">*</span><span class="ident" id="7173469">testing</span><span class="op" id="7173476">.</span><span class="ident" id="7173477">T</span><span class="op" id="7173478">,</span>&nbsp;<span class="ident" id="7173480">msg</span>&nbsp;<span class="builtintype" id="7173484">string</span><span class="op" id="7173490">,</span>&nbsp;<span class="ident" id="7173492">got</span><span class="op" id="7173495">,</span>&nbsp;<span class="ident" id="7173497">want</span>&nbsp;<span class="ident" id="7173502">Position</span><span class="op" id="7173510">)</span>&nbsp;<span class="op" id="7173512">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7173515">if</span>&nbsp;<span class="ident" id="7173518">got</span><span class="op" id="7173521">.</span><span class="ident" id="7173522">Filename</span>&nbsp;<span class="op" id="7173531">!=</span>&nbsp;<span class="ident" id="7173534">want</span><span class="op" id="7173538">.</span><span class="ident" id="7173539">Filename</span>&nbsp;<span class="op" id="7173548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7173552">t</span><span class="op" id="7173553">.</span><span class="ident" id="7173554">Errorf</span><span class="op" id="7173560">(</span><span class="string" id="7173561">&#34;%s:&nbsp;got&nbsp;filename&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7173593">,</span>&nbsp;<span class="ident" id="7173595">msg</span><span class="op" id="7173598">,</span>&nbsp;<span class="ident" id="7173600">got</span><span class="op" id="7173603">.</span><span class="ident" id="7173604">Filename</span><span class="op" id="7173612">,</span>&nbsp;<span class="ident" id="7173614">want</span><span class="op" id="7173618">.</span><span class="ident" id="7173619">Filename</span><span class="op" id="7173627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7173630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7173633">if</span>&nbsp;<span class="ident" id="7173636">got</span><span class="op" id="7173639">.</span><span class="ident" id="7173640">Offset</span>&nbsp;<span class="op" id="7173647">!=</span>&nbsp;<span class="ident" id="7173650">want</span><span class="op" id="7173654">.</span><span class="ident" id="7173655">Offset</span>&nbsp;<span class="op" id="7173662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7173666">t</span><span class="op" id="7173667">.</span><span class="ident" id="7173668">Errorf</span><span class="op" id="7173674">(</span><span class="string" id="7173675">&#34;%s:&nbsp;got&nbsp;offset&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7173705">,</span>&nbsp;<span class="ident" id="7173707">msg</span><span class="op" id="7173710">,</span>&nbsp;<span class="ident" id="7173712">got</span><span class="op" id="7173715">.</span><span class="ident" id="7173716">Offset</span><span class="op" id="7173722">,</span>&nbsp;<span class="ident" id="7173724">want</span><span class="op" id="7173728">.</span><span class="ident" id="7173729">Offset</span><span class="op" id="7173735">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7173738">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7173741">if</span>&nbsp;<span class="ident" id="7173744">got</span><span class="op" id="7173747">.</span><span class="ident" id="7173748">Line</span>&nbsp;<span class="op" id="7173753">!=</span>&nbsp;<span class="ident" id="7173756">want</span><span class="op" id="7173760">.</span><span class="ident" id="7173761">Line</span>&nbsp;<span class="op" id="7173766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7173770">t</span><span class="op" id="7173771">.</span><span class="ident" id="7173772">Errorf</span><span class="op" id="7173778">(</span><span class="string" id="7173779">&#34;%s:&nbsp;got&nbsp;line&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7173807">,</span>&nbsp;<span class="ident" id="7173809">msg</span><span class="op" id="7173812">,</span>&nbsp;<span class="ident" id="7173814">got</span><span class="op" id="7173817">.</span><span class="ident" id="7173818">Line</span><span class="op" id="7173822">,</span>&nbsp;<span class="ident" id="7173824">want</span><span class="op" id="7173828">.</span><span class="ident" id="7173829">Line</span><span class="op" id="7173833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7173836">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7173839">if</span>&nbsp;<span class="ident" id="7173842">got</span><span class="op" id="7173845">.</span><span class="ident" id="7173846">Column</span>&nbsp;<span class="op" id="7173853">!=</span>&nbsp;<span class="ident" id="7173856">want</span><span class="op" id="7173860">.</span><span class="ident" id="7173861">Column</span>&nbsp;<span class="op" id="7173868">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7173872">t</span><span class="op" id="7173873">.</span><span class="ident" id="7173874">Errorf</span><span class="op" id="7173880">(</span><span class="string" id="7173881">&#34;%s:&nbsp;got&nbsp;column&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7173911">,</span>&nbsp;<span class="ident" id="7173913">msg</span><span class="op" id="7173916">,</span>&nbsp;<span class="ident" id="7173918">got</span><span class="op" id="7173921">.</span><span class="ident" id="7173922">Column</span><span class="op" id="7173928">,</span>&nbsp;<span class="ident" id="7173930">want</span><span class="op" id="7173934">.</span><span class="ident" id="7173935">Column</span><span class="op" id="7173941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7173944">}</span><br>
<span class="lineno"></span><span class="op" id="7173946">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7173949">func</span>&nbsp;<span class="ident" id="7173954">TestNoPos</span><span class="op" id="7173963">(</span><span class="ident" id="7173964">t</span>&nbsp;<span class="op" id="7173966">*</span><span class="ident" id="7173967">testing</span><span class="op" id="7173974">.</span><span class="ident" id="7173975">T</span><span class="op" id="7173976">)</span>&nbsp;<span class="op" id="7173978">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7173981">if</span>&nbsp;<span class="ident" id="7173984">NoPos</span><span class="op" id="7173989">.</span><span class="ident" id="7173990">IsValid</span><span class="op" id="7173997">(</span><span class="op" id="7173998">)</span>&nbsp;<span class="op" id="7174000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7174004">t</span><span class="op" id="7174005">.</span><span class="ident" id="7174006">Errorf</span><span class="op" id="7174012">(</span><span class="string" id="7174013">&#34;NoPos&nbsp;should&nbsp;not&nbsp;be&nbsp;valid&#34;</span><span class="op" id="7174040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7174043">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7174046">var</span>&nbsp;<span class="ident" id="7174050">fset</span>&nbsp;<span class="op" id="7174055">*</span><span class="ident" id="7174056">FileSet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7174065">checkPos</span><span class="op" id="7174073">(</span><span class="ident" id="7174074">t</span><span class="op" id="7174075">,</span>&nbsp;<span class="string" id="7174077">&#34;nil&nbsp;NoPos&#34;</span><span class="op" id="7174088">,</span>&nbsp;<span class="ident" id="7174090">fset</span><span class="op" id="7174094">.</span><span class="ident" id="7174095">Position</span><span class="op" id="7174103">(</span><span class="ident" id="7174104">NoPos</span><span class="op" id="7174109">)</span><span class="op" id="7174110">,</span>&nbsp;<span class="ident" id="7174112">Position</span><span class="op" id="7174120">{</span><span class="op" id="7174121">}</span><span class="op" id="7174122">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7174125">fset</span>&nbsp;<span class="op" id="7174130">=</span>&nbsp;<span class="ident" id="7174132">NewFileSet</span><span class="op" id="7174142">(</span><span class="op" id="7174143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7174146">checkPos</span><span class="op" id="7174154">(</span><span class="ident" id="7174155">t</span><span class="op" id="7174156">,</span>&nbsp;<span class="string" id="7174158">&#34;fset&nbsp;NoPos&#34;</span><span class="op" id="7174170">,</span>&nbsp;<span class="ident" id="7174172">fset</span><span class="op" id="7174176">.</span><span class="ident" id="7174177">Position</span><span class="op" id="7174185">(</span><span class="ident" id="7174186">NoPos</span><span class="op" id="7174191">)</span><span class="op" id="7174192">,</span>&nbsp;<span class="ident" id="7174194">Position</span><span class="op" id="7174202">{</span><span class="op" id="7174203">}</span><span class="op" id="7174204">)</span><br>
<span class="lineno"></span><span class="op" id="7174206">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7174209">var</span>&nbsp;<span class="ident" id="7174213">tests</span>&nbsp;<span class="op" id="7174219">=</span>&nbsp;<span class="op" id="7174221">[</span><span class="op" id="7174222">]</span><span class="keyword" id="7174223">struct</span>&nbsp;<span class="op" id="7174230">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7174233">filename</span>&nbsp;<span class="builtintype" id="7174242">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7174250">source</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7174259">[</span><span class="op" id="7174260">]</span><span class="builtintype" id="7174261">byte</span>&nbsp;<span class="comment" id="7174266">//&nbsp;may&nbsp;be&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7174281">size</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7174290">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7174295">lines</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7174304">[</span><span class="op" id="7174305">]</span><span class="builtintype" id="7174306">int</span><br>
<span class="lineno"></span><span class="op" id="7174310">}</span><span class="op" id="7174311">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7174314">{</span><span class="string" id="7174315">&#34;a&#34;</span><span class="op" id="7174318">,</span>&nbsp;<span class="op" id="7174320">[</span><span class="op" id="7174321">]</span><span class="builtintype" id="7174322">byte</span><span class="op" id="7174326">{</span><span class="op" id="7174327">}</span><span class="op" id="7174328">,</span>&nbsp;<span class="num" id="7174330">0</span><span class="op" id="7174331">,</span>&nbsp;<span class="op" id="7174333">[</span><span class="op" id="7174334">]</span><span class="builtintype" id="7174335">int</span><span class="op" id="7174338">{</span><span class="op" id="7174339">}</span><span class="op" id="7174340">}</span><span class="op" id="7174341">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7174344">{</span><span class="string" id="7174345">&#34;b&#34;</span><span class="op" id="7174348">,</span>&nbsp;<span class="op" id="7174350">[</span><span class="op" id="7174351">]</span><span class="builtintype" id="7174352">byte</span><span class="op" id="7174356">(</span><span class="string" id="7174357">&#34;01234&#34;</span><span class="op" id="7174364">)</span><span class="op" id="7174365">,</span>&nbsp;<span class="num" id="7174367">5</span><span class="op" id="7174368">,</span>&nbsp;<span class="op" id="7174370">[</span><span class="op" id="7174371">]</span><span class="builtintype" id="7174372">int</span><span class="op" id="7174375">{</span><span class="num" id="7174376">0</span><span class="op" id="7174377">}</span><span class="op" id="7174378">}</span><span class="op" id="7174379">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7174382">{</span><span class="string" id="7174383">&#34;c&#34;</span><span class="op" id="7174386">,</span>&nbsp;<span class="op" id="7174388">[</span><span class="op" id="7174389">]</span><span class="builtintype" id="7174390">byte</span><span class="op" id="7174394">(</span><span class="string" id="7174395">&#34;\n\n\n\n\n\n\n\n\n&#34;</span><span class="op" id="7174415">)</span><span class="op" id="7174416">,</span>&nbsp;<span class="num" id="7174418">9</span><span class="op" id="7174419">,</span>&nbsp;<span class="op" id="7174421">[</span><span class="op" id="7174422">]</span><span class="builtintype" id="7174423">int</span><span class="op" id="7174426">{</span><span class="num" id="7174427">0</span><span class="op" id="7174428">,</span>&nbsp;<span class="num" id="7174430">1</span><span class="op" id="7174431">,</span>&nbsp;<span class="num" id="7174433">2</span><span class="op" id="7174434">,</span>&nbsp;<span class="num" id="7174436">3</span><span class="op" id="7174437">,</span>&nbsp;<span class="num" id="7174439">4</span><span class="op" id="7174440">,</span>&nbsp;<span class="num" id="7174442">5</span><span class="op" id="7174443">,</span>&nbsp;<span class="num" id="7174445">6</span><span class="op" id="7174446">,</span>&nbsp;<span class="num" id="7174448">7</span><span class="op" id="7174449">,</span>&nbsp;<span class="num" id="7174451">8</span><span class="op" id="7174452">}</span><span class="op" id="7174453">}</span><span class="op" id="7174454">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7174457">{</span><span class="string" id="7174458">&#34;d&#34;</span><span class="op" id="7174461">,</span>&nbsp;<span class="ident" id="7174463">nil</span><span class="op" id="7174466">,</span>&nbsp;<span class="num" id="7174468">100</span><span class="op" id="7174471">,</span>&nbsp;<span class="op" id="7174473">[</span><span class="op" id="7174474">]</span><span class="builtintype" id="7174475">int</span><span class="op" id="7174478">{</span><span class="num" id="7174479">0</span><span class="op" id="7174480">,</span>&nbsp;<span class="num" id="7174482">5</span><span class="op" id="7174483">,</span>&nbsp;<span class="num" id="7174485">10</span><span class="op" id="7174487">,</span>&nbsp;<span class="num" id="7174489">20</span><span class="op" id="7174491">,</span>&nbsp;<span class="num" id="7174493">30</span><span class="op" id="7174495">,</span>&nbsp;<span class="num" id="7174497">70</span><span class="op" id="7174499">,</span>&nbsp;<span class="num" id="7174501">71</span><span class="op" id="7174503">,</span>&nbsp;<span class="num" id="7174505">72</span><span class="op" id="7174507">,</span>&nbsp;<span class="num" id="7174509">80</span><span class="op" id="7174511">,</span>&nbsp;<span class="num" id="7174513">85</span><span class="op" id="7174515">,</span>&nbsp;<span class="num" id="7174517">90</span><span class="op" id="7174519">,</span>&nbsp;<span class="num" id="7174521">99</span><span class="op" id="7174523">}</span><span class="op" id="7174524">}</span><span class="op" id="7174525">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7174528">{</span><span class="string" id="7174529">&#34;e&#34;</span><span class="op" id="7174532">,</span>&nbsp;<span class="ident" id="7174534">nil</span><span class="op" id="7174537">,</span>&nbsp;<span class="num" id="7174539">777</span><span class="op" id="7174542">,</span>&nbsp;<span class="op" id="7174544">[</span><span class="op" id="7174545">]</span><span class="builtintype" id="7174546">int</span><span class="op" id="7174549">{</span><span class="num" id="7174550">0</span><span class="op" id="7174551">,</span>&nbsp;<span class="num" id="7174553">80</span><span class="op" id="7174555">,</span>&nbsp;<span class="num" id="7174557">100</span><span class="op" id="7174560">,</span>&nbsp;<span class="num" id="7174562">120</span><span class="op" id="7174565">,</span>&nbsp;<span class="num" id="7174567">130</span><span class="op" id="7174570">,</span>&nbsp;<span class="num" id="7174572">180</span><span class="op" id="7174575">,</span>&nbsp;<span class="num" id="7174577">267</span><span class="op" id="7174580">,</span>&nbsp;<span class="num" id="7174582">455</span><span class="op" id="7174585">,</span>&nbsp;<span class="num" id="7174587">500</span><span class="op" id="7174590">,</span>&nbsp;<span class="num" id="7174592">567</span><span class="op" id="7174595">,</span>&nbsp;<span class="num" id="7174597">620</span><span class="op" id="7174600">}</span><span class="op" id="7174601">}</span><span class="op" id="7174602">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7174605">{</span><span class="string" id="7174606">&#34;f&#34;</span><span class="op" id="7174609">,</span>&nbsp;<span class="op" id="7174611">[</span><span class="op" id="7174612">]</span><span class="builtintype" id="7174613">byte</span><span class="op" id="7174617">(</span><span class="string" id="7174618">&#34;package&nbsp;p\n\nimport&nbsp;\&#34;fmt\&#34;&#34;</span><span class="op" id="7174647">)</span><span class="op" id="7174648">,</span>&nbsp;<span class="num" id="7174650">23</span><span class="op" id="7174652">,</span>&nbsp;<span class="op" id="7174654">[</span><span class="op" id="7174655">]</span><span class="builtintype" id="7174656">int</span><span class="op" id="7174659">{</span><span class="num" id="7174660">0</span><span class="op" id="7174661">,</span>&nbsp;<span class="num" id="7174663">10</span><span class="op" id="7174665">,</span>&nbsp;<span class="num" id="7174667">11</span><span class="op" id="7174669">}</span><span class="op" id="7174670">}</span><span class="op" id="7174671">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7174674">{</span><span class="string" id="7174675">&#34;g&#34;</span><span class="op" id="7174678">,</span>&nbsp;<span class="op" id="7174680">[</span><span class="op" id="7174681">]</span><span class="builtintype" id="7174682">byte</span><span class="op" id="7174686">(</span><span class="string" id="7174687">&#34;package&nbsp;p\n\nimport&nbsp;\&#34;fmt\&#34;\n&#34;</span><span class="op" id="7174718">)</span><span class="op" id="7174719">,</span>&nbsp;<span class="num" id="7174721">24</span><span class="op" id="7174723">,</span>&nbsp;<span class="op" id="7174725">[</span><span class="op" id="7174726">]</span><span class="builtintype" id="7174727">int</span><span class="op" id="7174730">{</span><span class="num" id="7174731">0</span><span class="op" id="7174732">,</span>&nbsp;<span class="num" id="7174734">10</span><span class="op" id="7174736">,</span>&nbsp;<span class="num" id="7174738">11</span><span class="op" id="7174740">}</span><span class="op" id="7174741">}</span><span class="op" id="7174742">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7174745">{</span><span class="string" id="7174746">&#34;h&#34;</span><span class="op" id="7174749">,</span>&nbsp;<span class="op" id="7174751">[</span><span class="op" id="7174752">]</span><span class="builtintype" id="7174753">byte</span><span class="op" id="7174757">(</span><span class="string" id="7174758">&#34;package&nbsp;p\n\nimport&nbsp;\&#34;fmt\&#34;\n&nbsp;&#34;</span><span class="op" id="7174790">)</span><span class="op" id="7174791">,</span>&nbsp;<span class="num" id="7174793">25</span><span class="op" id="7174795">,</span>&nbsp;<span class="op" id="7174797">[</span><span class="op" id="7174798">]</span><span class="builtintype" id="7174799">int</span><span class="op" id="7174802">{</span><span class="num" id="7174803">0</span><span class="op" id="7174804">,</span>&nbsp;<span class="num" id="7174806">10</span><span class="op" id="7174808">,</span>&nbsp;<span class="num" id="7174810">11</span><span class="op" id="7174812">,</span>&nbsp;<span class="num" id="7174814">24</span><span class="op" id="7174816">}</span><span class="op" id="7174817">}</span><span class="op" id="7174818">,</span><br>
<span class="lineno"></span><span class="op" id="7174820">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="7174823">func</span>&nbsp;<span class="ident" id="7174828">linecol</span><span class="op" id="7174835">(</span><span class="ident" id="7174836">lines</span>&nbsp;<span class="op" id="7174842">[</span><span class="op" id="7174843">]</span><span class="builtintype" id="7174844">int</span><span class="op" id="7174847">,</span>&nbsp;<span class="ident" id="7174849">offs</span>&nbsp;<span class="builtintype" id="7174854">int</span><span class="op" id="7174857">)</span>&nbsp;<span class="op" id="7174859">(</span><span class="builtintype" id="7174860">int</span><span class="op" id="7174863">,</span>&nbsp;<span class="builtintype" id="7174865">int</span><span class="op" id="7174868">)</span>&nbsp;<span class="op" id="7174870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7174873">prevLineOffs</span>&nbsp;<span class="op" id="7174886">:=</span>&nbsp;<span class="num" id="7174889">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7174892">for</span>&nbsp;<span class="ident" id="7174896">line</span><span class="op" id="7174900">,</span>&nbsp;<span class="ident" id="7174902">lineOffs</span>&nbsp;<span class="op" id="7174911">:=</span>&nbsp;<span class="keyword" id="7174914">range</span>&nbsp;<span class="ident" id="7174920">lines</span>&nbsp;<span class="op" id="7174926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7174930">if</span>&nbsp;<span class="ident" id="7174933">offs</span>&nbsp;<span class="op" id="7174938">&lt;</span>&nbsp;<span class="ident" id="7174940">lineOffs</span>&nbsp;<span class="op" id="7174949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7174954">return</span>&nbsp;<span class="ident" id="7174961">line</span><span class="op" id="7174965">,</span>&nbsp;<span class="ident" id="7174967">offs</span>&nbsp;<span class="op" id="7174972">-</span>&nbsp;<span class="ident" id="7174974">prevLineOffs</span>&nbsp;<span class="op" id="7174987">+</span>&nbsp;<span class="num" id="7174989">1</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7174993">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7174997">prevLineOffs</span>&nbsp;<span class="op" id="7175010">=</span>&nbsp;<span class="ident" id="7175012">lineOffs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7175022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7175025">return</span>&nbsp;<span class="builtinfunc" id="7175032">len</span><span class="op" id="7175035">(</span><span class="ident" id="7175036">lines</span><span class="op" id="7175041">)</span><span class="op" id="7175042">,</span>&nbsp;<span class="ident" id="7175044">offs</span>&nbsp;<span class="op" id="7175049">-</span>&nbsp;<span class="ident" id="7175051">prevLineOffs</span>&nbsp;<span class="op" id="7175064">+</span>&nbsp;<span class="num" id="7175066">1</span><br>
<span class="lineno"></span><span class="op" id="7175068">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="7175071">func</span>&nbsp;<span class="ident" id="7175076">verifyPositions</span><span class="op" id="7175091">(</span><span class="ident" id="7175092">t</span>&nbsp;<span class="op" id="7175094">*</span><span class="ident" id="7175095">testing</span><span class="op" id="7175102">.</span><span class="ident" id="7175103">T</span><span class="op" id="7175104">,</span>&nbsp;<span class="ident" id="7175106">fset</span>&nbsp;<span class="op" id="7175111">*</span><span class="ident" id="7175112">FileSet</span><span class="op" id="7175119">,</span>&nbsp;<span class="ident" id="7175121">f</span>&nbsp;<span class="op" id="7175123">*</span><span class="ident" id="7175124">File</span><span class="op" id="7175128">,</span>&nbsp;<span class="ident" id="7175130">lines</span>&nbsp;<span class="op" id="7175136">[</span><span class="op" id="7175137">]</span><span class="builtintype" id="7175138">int</span><span class="op" id="7175141">)</span>&nbsp;<span class="op" id="7175143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7175146">for</span>&nbsp;<span class="ident" id="7175150">offs</span>&nbsp;<span class="op" id="7175155">:=</span>&nbsp;<span class="num" id="7175158">0</span><span class="op" id="7175159">;</span>&nbsp;<span class="ident" id="7175161">offs</span>&nbsp;<span class="op" id="7175166">&lt;</span>&nbsp;<span class="ident" id="7175168">f</span><span class="op" id="7175169">.</span><span class="ident" id="7175170">Size</span><span class="op" id="7175174">(</span><span class="op" id="7175175">)</span><span class="op" id="7175176">;</span>&nbsp;<span class="ident" id="7175178">offs</span><span class="op" id="7175182">++</span>&nbsp;<span class="op" id="7175185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175189">p</span>&nbsp;<span class="op" id="7175191">:=</span>&nbsp;<span class="ident" id="7175194">f</span><span class="op" id="7175195">.</span><span class="ident" id="7175196">Pos</span><span class="op" id="7175199">(</span><span class="ident" id="7175200">offs</span><span class="op" id="7175204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175208">offs2</span>&nbsp;<span class="op" id="7175214">:=</span>&nbsp;<span class="ident" id="7175217">f</span><span class="op" id="7175218">.</span><span class="ident" id="7175219">Offset</span><span class="op" id="7175225">(</span><span class="ident" id="7175226">p</span><span class="op" id="7175227">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7175231">if</span>&nbsp;<span class="ident" id="7175234">offs2</span>&nbsp;<span class="op" id="7175240">!=</span>&nbsp;<span class="ident" id="7175243">offs</span>&nbsp;<span class="op" id="7175248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175253">t</span><span class="op" id="7175254">.</span><span class="ident" id="7175255">Errorf</span><span class="op" id="7175261">(</span><span class="string" id="7175262">&#34;%s,&nbsp;Offset:&nbsp;got&nbsp;offset&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7175298">,</span>&nbsp;<span class="ident" id="7175300">f</span><span class="op" id="7175301">.</span><span class="ident" id="7175302">Name</span><span class="op" id="7175306">(</span><span class="op" id="7175307">)</span><span class="op" id="7175308">,</span>&nbsp;<span class="ident" id="7175310">offs2</span><span class="op" id="7175315">,</span>&nbsp;<span class="ident" id="7175317">offs</span><span class="op" id="7175321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7175325">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175329">line</span><span class="op" id="7175333">,</span>&nbsp;<span class="ident" id="7175335">col</span>&nbsp;<span class="op" id="7175339">:=</span>&nbsp;<span class="ident" id="7175342">linecol</span><span class="op" id="7175349">(</span><span class="ident" id="7175350">lines</span><span class="op" id="7175355">,</span>&nbsp;<span class="ident" id="7175357">offs</span><span class="op" id="7175361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175365">msg</span>&nbsp;<span class="op" id="7175369">:=</span>&nbsp;<span class="ident" id="7175372">fmt</span><span class="op" id="7175375">.</span><span class="ident" id="7175376">Sprintf</span><span class="op" id="7175383">(</span><span class="string" id="7175384">&#34;%s&nbsp;(offs&nbsp;=&nbsp;%d,&nbsp;p&nbsp;=&nbsp;%d)&#34;</span><span class="op" id="7175408">,</span>&nbsp;<span class="ident" id="7175410">f</span><span class="op" id="7175411">.</span><span class="ident" id="7175412">Name</span><span class="op" id="7175416">(</span><span class="op" id="7175417">)</span><span class="op" id="7175418">,</span>&nbsp;<span class="ident" id="7175420">offs</span><span class="op" id="7175424">,</span>&nbsp;<span class="ident" id="7175426">p</span><span class="op" id="7175427">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175431">checkPos</span><span class="op" id="7175439">(</span><span class="ident" id="7175440">t</span><span class="op" id="7175441">,</span>&nbsp;<span class="ident" id="7175443">msg</span><span class="op" id="7175446">,</span>&nbsp;<span class="ident" id="7175448">f</span><span class="op" id="7175449">.</span><span class="ident" id="7175450">Position</span><span class="op" id="7175458">(</span><span class="ident" id="7175459">f</span><span class="op" id="7175460">.</span><span class="ident" id="7175461">Pos</span><span class="op" id="7175464">(</span><span class="ident" id="7175465">offs</span><span class="op" id="7175469">)</span><span class="op" id="7175470">)</span><span class="op" id="7175471">,</span>&nbsp;<span class="ident" id="7175473">Position</span><span class="op" id="7175481">{</span><span class="ident" id="7175482">f</span><span class="op" id="7175483">.</span><span class="ident" id="7175484">Name</span><span class="op" id="7175488">(</span><span class="op" id="7175489">)</span><span class="op" id="7175490">,</span>&nbsp;<span class="ident" id="7175492">offs</span><span class="op" id="7175496">,</span>&nbsp;<span class="ident" id="7175498">line</span><span class="op" id="7175502">,</span>&nbsp;<span class="ident" id="7175504">col</span><span class="op" id="7175507">}</span><span class="op" id="7175508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175512">checkPos</span><span class="op" id="7175520">(</span><span class="ident" id="7175521">t</span><span class="op" id="7175522">,</span>&nbsp;<span class="ident" id="7175524">msg</span><span class="op" id="7175527">,</span>&nbsp;<span class="ident" id="7175529">fset</span><span class="op" id="7175533">.</span><span class="ident" id="7175534">Position</span><span class="op" id="7175542">(</span><span class="ident" id="7175543">p</span><span class="op" id="7175544">)</span><span class="op" id="7175545">,</span>&nbsp;<span class="ident" id="7175547">Position</span><span class="op" id="7175555">{</span><span class="ident" id="7175556">f</span><span class="op" id="7175557">.</span><span class="ident" id="7175558">Name</span><span class="op" id="7175562">(</span><span class="op" id="7175563">)</span><span class="op" id="7175564">,</span>&nbsp;<span class="ident" id="7175566">offs</span><span class="op" id="7175570">,</span>&nbsp;<span class="ident" id="7175572">line</span><span class="op" id="7175576">,</span>&nbsp;<span class="ident" id="7175578">col</span><span class="op" id="7175581">}</span><span class="op" id="7175582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7175585">}</span><br>
<span class="lineno"></span><span class="op" id="7175587">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="7175590">func</span>&nbsp;<span class="ident" id="7175595">makeTestSource</span><span class="op" id="7175609">(</span><span class="ident" id="7175610">size</span>&nbsp;<span class="builtintype" id="7175615">int</span><span class="op" id="7175618">,</span>&nbsp;<span class="ident" id="7175620">lines</span>&nbsp;<span class="op" id="7175626">[</span><span class="op" id="7175627">]</span><span class="builtintype" id="7175628">int</span><span class="op" id="7175631">)</span>&nbsp;<span class="op" id="7175633">[</span><span class="op" id="7175634">]</span><span class="builtintype" id="7175635">byte</span>&nbsp;<span class="op" id="7175640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175643">src</span>&nbsp;<span class="op" id="7175647">:=</span>&nbsp;<span class="builtinfunc" id="7175650">make</span><span class="op" id="7175654">(</span><span class="op" id="7175655">[</span><span class="op" id="7175656">]</span><span class="builtintype" id="7175657">byte</span><span class="op" id="7175661">,</span>&nbsp;<span class="ident" id="7175663">size</span><span class="op" id="7175667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7175670">for</span>&nbsp;<span class="ident" id="7175674">_</span><span class="op" id="7175675">,</span>&nbsp;<span class="ident" id="7175677">offs</span>&nbsp;<span class="op" id="7175682">:=</span>&nbsp;<span class="keyword" id="7175685">range</span>&nbsp;<span class="ident" id="7175691">lines</span>&nbsp;<span class="op" id="7175697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7175701">if</span>&nbsp;<span class="ident" id="7175704">offs</span>&nbsp;<span class="op" id="7175709">&gt;</span>&nbsp;<span class="num" id="7175711">0</span>&nbsp;<span class="op" id="7175713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175718">src</span><span class="op" id="7175721">[</span><span class="ident" id="7175722">offs</span><span class="op" id="7175726">-</span><span class="num" id="7175727">1</span><span class="op" id="7175728">]</span>&nbsp;<span class="op" id="7175730">=</span>&nbsp;<span class="string" id="7175732">&#39;\n&#39;</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7175739">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7175742">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7175745">return</span>&nbsp;<span class="ident" id="7175752">src</span><br>
<span class="lineno"></span><span class="op" id="7175756">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="7175759">func</span>&nbsp;<span class="ident" id="7175764">TestPositions</span><span class="op" id="7175777">(</span><span class="ident" id="7175778">t</span>&nbsp;<span class="op" id="7175780">*</span><span class="ident" id="7175781">testing</span><span class="op" id="7175788">.</span><span class="ident" id="7175789">T</span><span class="op" id="7175790">)</span>&nbsp;<span class="op" id="7175792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7175795">const</span>&nbsp;<span class="ident" id="7175801">delta</span>&nbsp;<span class="op" id="7175807">=</span>&nbsp;<span class="num" id="7175809">7</span>&nbsp;<span class="comment" id="7175811">//&nbsp;a&nbsp;non-zero&nbsp;base&nbsp;offset&nbsp;increment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175848">fset</span>&nbsp;<span class="op" id="7175853">:=</span>&nbsp;<span class="ident" id="7175856">NewFileSet</span><span class="op" id="7175866">(</span><span class="op" id="7175867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7175870">for</span>&nbsp;<span class="ident" id="7175874">_</span><span class="op" id="7175875">,</span>&nbsp;<span class="ident" id="7175877">test</span>&nbsp;<span class="op" id="7175882">:=</span>&nbsp;<span class="keyword" id="7175885">range</span>&nbsp;<span class="ident" id="7175891">tests</span>&nbsp;<span class="op" id="7175897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7175901">//&nbsp;verify&nbsp;consistency&nbsp;of&nbsp;test&nbsp;case</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7175938">if</span>&nbsp;<span class="ident" id="7175941">test</span><span class="op" id="7175945">.</span><span class="ident" id="7175946">source</span>&nbsp;<span class="op" id="7175953">!=</span>&nbsp;<span class="ident" id="7175956">nil</span>&nbsp;<span class="op" id="7175960">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="7175963">len</span><span class="op" id="7175966">(</span><span class="ident" id="7175967">test</span><span class="op" id="7175971">.</span><span class="ident" id="7175972">source</span><span class="op" id="7175978">)</span>&nbsp;<span class="op" id="7175980">!=</span>&nbsp;<span class="ident" id="7175983">test</span><span class="op" id="7175987">.</span><span class="ident" id="7175988">size</span>&nbsp;<span class="op" id="7175993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7175998">t</span><span class="op" id="7175999">.</span><span class="ident" id="7176000">Errorf</span><span class="op" id="7176006">(</span><span class="string" id="7176007">&#34;%s:&nbsp;inconsistent&nbsp;test&nbsp;case:&nbsp;got&nbsp;file&nbsp;size&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7176062">,</span>&nbsp;<span class="ident" id="7176064">test</span><span class="op" id="7176068">.</span><span class="ident" id="7176069">filename</span><span class="op" id="7176077">,</span>&nbsp;<span class="builtinfunc" id="7176079">len</span><span class="op" id="7176082">(</span><span class="ident" id="7176083">test</span><span class="op" id="7176087">.</span><span class="ident" id="7176088">source</span><span class="op" id="7176094">)</span><span class="op" id="7176095">,</span>&nbsp;<span class="ident" id="7176097">test</span><span class="op" id="7176101">.</span><span class="ident" id="7176102">size</span><span class="op" id="7176106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7176110">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7176115">//&nbsp;add&nbsp;file&nbsp;and&nbsp;verify&nbsp;name&nbsp;and&nbsp;size</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176154">f</span>&nbsp;<span class="op" id="7176156">:=</span>&nbsp;<span class="ident" id="7176159">fset</span><span class="op" id="7176163">.</span><span class="ident" id="7176164">AddFile</span><span class="op" id="7176171">(</span><span class="ident" id="7176172">test</span><span class="op" id="7176176">.</span><span class="ident" id="7176177">filename</span><span class="op" id="7176185">,</span>&nbsp;<span class="ident" id="7176187">fset</span><span class="op" id="7176191">.</span><span class="ident" id="7176192">Base</span><span class="op" id="7176196">(</span><span class="op" id="7176197">)</span><span class="op" id="7176198">+</span><span class="ident" id="7176199">delta</span><span class="op" id="7176204">,</span>&nbsp;<span class="ident" id="7176206">test</span><span class="op" id="7176210">.</span><span class="ident" id="7176211">size</span><span class="op" id="7176215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7176219">if</span>&nbsp;<span class="ident" id="7176222">f</span><span class="op" id="7176223">.</span><span class="ident" id="7176224">Name</span><span class="op" id="7176228">(</span><span class="op" id="7176229">)</span>&nbsp;<span class="op" id="7176231">!=</span>&nbsp;<span class="ident" id="7176234">test</span><span class="op" id="7176238">.</span><span class="ident" id="7176239">filename</span>&nbsp;<span class="op" id="7176248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176253">t</span><span class="op" id="7176254">.</span><span class="ident" id="7176255">Errorf</span><span class="op" id="7176261">(</span><span class="string" id="7176262">&#34;got&nbsp;filename&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7176288">,</span>&nbsp;<span class="ident" id="7176290">f</span><span class="op" id="7176291">.</span><span class="ident" id="7176292">Name</span><span class="op" id="7176296">(</span><span class="op" id="7176297">)</span><span class="op" id="7176298">,</span>&nbsp;<span class="ident" id="7176300">test</span><span class="op" id="7176304">.</span><span class="ident" id="7176305">filename</span><span class="op" id="7176313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7176317">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7176321">if</span>&nbsp;<span class="ident" id="7176324">f</span><span class="op" id="7176325">.</span><span class="ident" id="7176326">Size</span><span class="op" id="7176330">(</span><span class="op" id="7176331">)</span>&nbsp;<span class="op" id="7176333">!=</span>&nbsp;<span class="ident" id="7176336">test</span><span class="op" id="7176340">.</span><span class="ident" id="7176341">size</span>&nbsp;<span class="op" id="7176346">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176351">t</span><span class="op" id="7176352">.</span><span class="ident" id="7176353">Errorf</span><span class="op" id="7176359">(</span><span class="string" id="7176360">&#34;%s:&nbsp;got&nbsp;file&nbsp;size&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7176391">,</span>&nbsp;<span class="ident" id="7176393">f</span><span class="op" id="7176394">.</span><span class="ident" id="7176395">Name</span><span class="op" id="7176399">(</span><span class="op" id="7176400">)</span><span class="op" id="7176401">,</span>&nbsp;<span class="ident" id="7176403">f</span><span class="op" id="7176404">.</span><span class="ident" id="7176405">Size</span><span class="op" id="7176409">(</span><span class="op" id="7176410">)</span><span class="op" id="7176411">,</span>&nbsp;<span class="ident" id="7176413">test</span><span class="op" id="7176417">.</span><span class="ident" id="7176418">size</span><span class="op" id="7176422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7176426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7176430">if</span>&nbsp;<span class="ident" id="7176433">fset</span><span class="op" id="7176437">.</span><span class="ident" id="7176438">File</span><span class="op" id="7176442">(</span><span class="ident" id="7176443">f</span><span class="op" id="7176444">.</span><span class="ident" id="7176445">Pos</span><span class="op" id="7176448">(</span><span class="num" id="7176449">0</span><span class="op" id="7176450">)</span><span class="op" id="7176451">)</span>&nbsp;<span class="op" id="7176453">!=</span>&nbsp;<span class="ident" id="7176456">f</span>&nbsp;<span class="op" id="7176458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176463">t</span><span class="op" id="7176464">.</span><span class="ident" id="7176465">Errorf</span><span class="op" id="7176471">(</span><span class="string" id="7176472">&#34;%s:&nbsp;f.Pos(0)&nbsp;was&nbsp;not&nbsp;found&nbsp;in&nbsp;f&#34;</span><span class="op" id="7176505">,</span>&nbsp;<span class="ident" id="7176507">f</span><span class="op" id="7176508">.</span><span class="ident" id="7176509">Name</span><span class="op" id="7176513">(</span><span class="op" id="7176514">)</span><span class="op" id="7176515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7176519">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7176524">//&nbsp;add&nbsp;lines&nbsp;individually&nbsp;and&nbsp;verify&nbsp;all&nbsp;positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7176577">for</span>&nbsp;<span class="ident" id="7176581">i</span><span class="op" id="7176582">,</span>&nbsp;<span class="ident" id="7176584">offset</span>&nbsp;<span class="op" id="7176591">:=</span>&nbsp;<span class="keyword" id="7176594">range</span>&nbsp;<span class="ident" id="7176600">test</span><span class="op" id="7176604">.</span><span class="ident" id="7176605">lines</span>&nbsp;<span class="op" id="7176611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176616">f</span><span class="op" id="7176617">.</span><span class="ident" id="7176618">AddLine</span><span class="op" id="7176625">(</span><span class="ident" id="7176626">offset</span><span class="op" id="7176632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7176637">if</span>&nbsp;<span class="ident" id="7176640">f</span><span class="op" id="7176641">.</span><span class="ident" id="7176642">LineCount</span><span class="op" id="7176651">(</span><span class="op" id="7176652">)</span>&nbsp;<span class="op" id="7176654">!=</span>&nbsp;<span class="ident" id="7176657">i</span><span class="op" id="7176658">+</span><span class="num" id="7176659">1</span>&nbsp;<span class="op" id="7176661">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176667">t</span><span class="op" id="7176668">.</span><span class="ident" id="7176669">Errorf</span><span class="op" id="7176675">(</span><span class="string" id="7176676">&#34;%s,&nbsp;AddLine:&nbsp;got&nbsp;line&nbsp;count&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7176717">,</span>&nbsp;<span class="ident" id="7176719">f</span><span class="op" id="7176720">.</span><span class="ident" id="7176721">Name</span><span class="op" id="7176725">(</span><span class="op" id="7176726">)</span><span class="op" id="7176727">,</span>&nbsp;<span class="ident" id="7176729">f</span><span class="op" id="7176730">.</span><span class="ident" id="7176731">LineCount</span><span class="op" id="7176740">(</span><span class="op" id="7176741">)</span><span class="op" id="7176742">,</span>&nbsp;<span class="ident" id="7176744">i</span><span class="op" id="7176745">+</span><span class="num" id="7176746">1</span><span class="op" id="7176747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7176752">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7176757">//&nbsp;adding&nbsp;the&nbsp;same&nbsp;offset&nbsp;again&nbsp;should&nbsp;be&nbsp;ignored</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176810">f</span><span class="op" id="7176811">.</span><span class="ident" id="7176812">AddLine</span><span class="op" id="7176819">(</span><span class="ident" id="7176820">offset</span><span class="op" id="7176826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7176831">if</span>&nbsp;<span class="ident" id="7176834">f</span><span class="op" id="7176835">.</span><span class="ident" id="7176836">LineCount</span><span class="op" id="7176845">(</span><span class="op" id="7176846">)</span>&nbsp;<span class="op" id="7176848">!=</span>&nbsp;<span class="ident" id="7176851">i</span><span class="op" id="7176852">+</span><span class="num" id="7176853">1</span>&nbsp;<span class="op" id="7176855">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176861">t</span><span class="op" id="7176862">.</span><span class="ident" id="7176863">Errorf</span><span class="op" id="7176869">(</span><span class="string" id="7176870">&#34;%s,&nbsp;AddLine:&nbsp;got&nbsp;unchanged&nbsp;line&nbsp;count&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7176921">,</span>&nbsp;<span class="ident" id="7176923">f</span><span class="op" id="7176924">.</span><span class="ident" id="7176925">Name</span><span class="op" id="7176929">(</span><span class="op" id="7176930">)</span><span class="op" id="7176931">,</span>&nbsp;<span class="ident" id="7176933">f</span><span class="op" id="7176934">.</span><span class="ident" id="7176935">LineCount</span><span class="op" id="7176944">(</span><span class="op" id="7176945">)</span><span class="op" id="7176946">,</span>&nbsp;<span class="ident" id="7176948">i</span><span class="op" id="7176949">+</span><span class="num" id="7176950">1</span><span class="op" id="7176951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7176956">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7176961">verifyPositions</span><span class="op" id="7176976">(</span><span class="ident" id="7176977">t</span><span class="op" id="7176978">,</span>&nbsp;<span class="ident" id="7176980">fset</span><span class="op" id="7176984">,</span>&nbsp;<span class="ident" id="7176986">f</span><span class="op" id="7176987">,</span>&nbsp;<span class="ident" id="7176989">test</span><span class="op" id="7176993">.</span><span class="ident" id="7176994">lines</span><span class="op" id="7176999">[</span><span class="num" id="7177000">0</span><span class="op" id="7177001">:</span><span class="ident" id="7177002">i</span><span class="op" id="7177003">+</span><span class="num" id="7177004">1</span><span class="op" id="7177005">]</span><span class="op" id="7177006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7177010">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7177015">//&nbsp;add&nbsp;lines&nbsp;with&nbsp;SetLines&nbsp;and&nbsp;verify&nbsp;all&nbsp;positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7177069">if</span>&nbsp;<span class="ident" id="7177072">ok</span>&nbsp;<span class="op" id="7177075">:=</span>&nbsp;<span class="ident" id="7177078">f</span><span class="op" id="7177079">.</span><span class="ident" id="7177080">SetLines</span><span class="op" id="7177088">(</span><span class="ident" id="7177089">test</span><span class="op" id="7177093">.</span><span class="ident" id="7177094">lines</span><span class="op" id="7177099">)</span><span class="op" id="7177100">;</span>&nbsp;<span class="op" id="7177102">!</span><span class="ident" id="7177103">ok</span>&nbsp;<span class="op" id="7177106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7177111">t</span><span class="op" id="7177112">.</span><span class="ident" id="7177113">Errorf</span><span class="op" id="7177119">(</span><span class="string" id="7177120">&#34;%s:&nbsp;SetLines&nbsp;failed&#34;</span><span class="op" id="7177141">,</span>&nbsp;<span class="ident" id="7177143">f</span><span class="op" id="7177144">.</span><span class="ident" id="7177145">Name</span><span class="op" id="7177149">(</span><span class="op" id="7177150">)</span><span class="op" id="7177151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7177155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7177159">if</span>&nbsp;<span class="ident" id="7177162">f</span><span class="op" id="7177163">.</span><span class="ident" id="7177164">LineCount</span><span class="op" id="7177173">(</span><span class="op" id="7177174">)</span>&nbsp;<span class="op" id="7177176">!=</span>&nbsp;<span class="builtinfunc" id="7177179">len</span><span class="op" id="7177182">(</span><span class="ident" id="7177183">test</span><span class="op" id="7177187">.</span><span class="ident" id="7177188">lines</span><span class="op" id="7177193">)</span>&nbsp;<span class="op" id="7177195">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7177200">t</span><span class="op" id="7177201">.</span><span class="ident" id="7177202">Errorf</span><span class="op" id="7177208">(</span><span class="string" id="7177209">&#34;%s,&nbsp;SetLines:&nbsp;got&nbsp;line&nbsp;count&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7177251">,</span>&nbsp;<span class="ident" id="7177253">f</span><span class="op" id="7177254">.</span><span class="ident" id="7177255">Name</span><span class="op" id="7177259">(</span><span class="op" id="7177260">)</span><span class="op" id="7177261">,</span>&nbsp;<span class="ident" id="7177263">f</span><span class="op" id="7177264">.</span><span class="ident" id="7177265">LineCount</span><span class="op" id="7177274">(</span><span class="op" id="7177275">)</span><span class="op" id="7177276">,</span>&nbsp;<span class="builtinfunc" id="7177278">len</span><span class="op" id="7177281">(</span><span class="ident" id="7177282">test</span><span class="op" id="7177286">.</span><span class="ident" id="7177287">lines</span><span class="op" id="7177292">)</span><span class="op" id="7177293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7177297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7177301">verifyPositions</span><span class="op" id="7177316">(</span><span class="ident" id="7177317">t</span><span class="op" id="7177318">,</span>&nbsp;<span class="ident" id="7177320">fset</span><span class="op" id="7177324">,</span>&nbsp;<span class="ident" id="7177326">f</span><span class="op" id="7177327">,</span>&nbsp;<span class="ident" id="7177329">test</span><span class="op" id="7177333">.</span><span class="ident" id="7177334">lines</span><span class="op" id="7177339">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7177344">//&nbsp;add&nbsp;lines&nbsp;with&nbsp;SetLinesForContent&nbsp;and&nbsp;verify&nbsp;all&nbsp;positions</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7177408">src</span>&nbsp;<span class="op" id="7177412">:=</span>&nbsp;<span class="ident" id="7177415">test</span><span class="op" id="7177419">.</span><span class="ident" id="7177420">source</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7177429">if</span>&nbsp;<span class="ident" id="7177432">src</span>&nbsp;<span class="op" id="7177436">==</span>&nbsp;<span class="ident" id="7177439">nil</span>&nbsp;<span class="op" id="7177443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7177448">//&nbsp;no&nbsp;test&nbsp;source&nbsp;available&nbsp;-&nbsp;create&nbsp;one&nbsp;from&nbsp;scratch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7177505">src</span>&nbsp;<span class="op" id="7177509">=</span>&nbsp;<span class="ident" id="7177511">makeTestSource</span><span class="op" id="7177525">(</span><span class="ident" id="7177526">test</span><span class="op" id="7177530">.</span><span class="ident" id="7177531">size</span><span class="op" id="7177535">,</span>&nbsp;<span class="ident" id="7177537">test</span><span class="op" id="7177541">.</span><span class="ident" id="7177542">lines</span><span class="op" id="7177547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7177551">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7177555">f</span><span class="op" id="7177556">.</span><span class="ident" id="7177557">SetLinesForContent</span><span class="op" id="7177575">(</span><span class="ident" id="7177576">src</span><span class="op" id="7177579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7177583">if</span>&nbsp;<span class="ident" id="7177586">f</span><span class="op" id="7177587">.</span><span class="ident" id="7177588">LineCount</span><span class="op" id="7177597">(</span><span class="op" id="7177598">)</span>&nbsp;<span class="op" id="7177600">!=</span>&nbsp;<span class="builtinfunc" id="7177603">len</span><span class="op" id="7177606">(</span><span class="ident" id="7177607">test</span><span class="op" id="7177611">.</span><span class="ident" id="7177612">lines</span><span class="op" id="7177617">)</span>&nbsp;<span class="op" id="7177619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7177624">t</span><span class="op" id="7177625">.</span><span class="ident" id="7177626">Errorf</span><span class="op" id="7177632">(</span><span class="string" id="7177633">&#34;%s,&nbsp;SetLinesForContent:&nbsp;got&nbsp;line&nbsp;count&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7177685">,</span>&nbsp;<span class="ident" id="7177687">f</span><span class="op" id="7177688">.</span><span class="ident" id="7177689">Name</span><span class="op" id="7177693">(</span><span class="op" id="7177694">)</span><span class="op" id="7177695">,</span>&nbsp;<span class="ident" id="7177697">f</span><span class="op" id="7177698">.</span><span class="ident" id="7177699">LineCount</span><span class="op" id="7177708">(</span><span class="op" id="7177709">)</span><span class="op" id="7177710">,</span>&nbsp;<span class="builtinfunc" id="7177712">len</span><span class="op" id="7177715">(</span><span class="ident" id="7177716">test</span><span class="op" id="7177720">.</span><span class="ident" id="7177721">lines</span><span class="op" id="7177726">)</span><span class="op" id="7177727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7177731">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7177735">verifyPositions</span><span class="op" id="7177750">(</span><span class="ident" id="7177751">t</span><span class="op" id="7177752">,</span>&nbsp;<span class="ident" id="7177754">fset</span><span class="op" id="7177758">,</span>&nbsp;<span class="ident" id="7177760">f</span><span class="op" id="7177761">,</span>&nbsp;<span class="ident" id="7177763">test</span><span class="op" id="7177767">.</span><span class="ident" id="7177768">lines</span><span class="op" id="7177773">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7177776">}</span><br>
<span class="lineno"></span><span class="op" id="7177778">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7177781">func</span>&nbsp;<span class="ident" id="7177786">TestLineInfo</span><span class="op" id="7177798">(</span><span class="ident" id="7177799">t</span>&nbsp;<span class="op" id="7177801">*</span><span class="ident" id="7177802">testing</span><span class="op" id="7177809">.</span><span class="ident" id="7177810">T</span><span class="op" id="7177811">)</span>&nbsp;<span class="op" id="7177813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7177816">fset</span>&nbsp;<span class="op" id="7177821">:=</span>&nbsp;<span class="ident" id="7177824">NewFileSet</span><span class="op" id="7177834">(</span><span class="op" id="7177835">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7177838">f</span>&nbsp;<span class="op" id="7177840">:=</span>&nbsp;<span class="ident" id="7177843">fset</span><span class="op" id="7177847">.</span><span class="ident" id="7177848">AddFile</span><span class="op" id="7177855">(</span><span class="string" id="7177856">&#34;foo&#34;</span><span class="op" id="7177861">,</span>&nbsp;<span class="ident" id="7177863">fset</span><span class="op" id="7177867">.</span><span class="ident" id="7177868">Base</span><span class="op" id="7177872">(</span><span class="op" id="7177873">)</span><span class="op" id="7177874">,</span>&nbsp;<span class="num" id="7177876">500</span><span class="op" id="7177879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7177882">lines</span>&nbsp;<span class="op" id="7177888">:=</span>&nbsp;<span class="op" id="7177891">[</span><span class="op" id="7177892">]</span><span class="builtintype" id="7177893">int</span><span class="op" id="7177896">{</span><span class="num" id="7177897">0</span><span class="op" id="7177898">,</span>&nbsp;<span class="num" id="7177900">42</span><span class="op" id="7177902">,</span>&nbsp;<span class="num" id="7177904">77</span><span class="op" id="7177906">,</span>&nbsp;<span class="num" id="7177908">100</span><span class="op" id="7177911">,</span>&nbsp;<span class="num" id="7177913">210</span><span class="op" id="7177916">,</span>&nbsp;<span class="num" id="7177918">220</span><span class="op" id="7177921">,</span>&nbsp;<span class="num" id="7177923">277</span><span class="op" id="7177926">,</span>&nbsp;<span class="num" id="7177928">300</span><span class="op" id="7177931">,</span>&nbsp;<span class="num" id="7177933">333</span><span class="op" id="7177936">,</span>&nbsp;<span class="num" id="7177938">401</span><span class="op" id="7177941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7177944">//&nbsp;add&nbsp;lines&nbsp;individually&nbsp;and&nbsp;provide&nbsp;alternative&nbsp;line&nbsp;information</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7178012">for</span>&nbsp;<span class="ident" id="7178016">_</span><span class="op" id="7178017">,</span>&nbsp;<span class="ident" id="7178019">offs</span>&nbsp;<span class="op" id="7178024">:=</span>&nbsp;<span class="keyword" id="7178027">range</span>&nbsp;<span class="ident" id="7178033">lines</span>&nbsp;<span class="op" id="7178039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178043">f</span><span class="op" id="7178044">.</span><span class="ident" id="7178045">AddLine</span><span class="op" id="7178052">(</span><span class="ident" id="7178053">offs</span><span class="op" id="7178057">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178061">f</span><span class="op" id="7178062">.</span><span class="ident" id="7178063">AddLineInfo</span><span class="op" id="7178074">(</span><span class="ident" id="7178075">offs</span><span class="op" id="7178079">,</span>&nbsp;<span class="string" id="7178081">&#34;bar&#34;</span><span class="op" id="7178086">,</span>&nbsp;<span class="num" id="7178088">42</span><span class="op" id="7178090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7178093">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7178096">//&nbsp;verify&nbsp;positions&nbsp;for&nbsp;all&nbsp;offsets</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7178133">for</span>&nbsp;<span class="ident" id="7178137">offs</span>&nbsp;<span class="op" id="7178142">:=</span>&nbsp;<span class="num" id="7178145">0</span><span class="op" id="7178146">;</span>&nbsp;<span class="ident" id="7178148">offs</span>&nbsp;<span class="op" id="7178153">&lt;=</span>&nbsp;<span class="ident" id="7178156">f</span><span class="op" id="7178157">.</span><span class="ident" id="7178158">Size</span><span class="op" id="7178162">(</span><span class="op" id="7178163">)</span><span class="op" id="7178164">;</span>&nbsp;<span class="ident" id="7178166">offs</span><span class="op" id="7178170">++</span>&nbsp;<span class="op" id="7178173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178177">p</span>&nbsp;<span class="op" id="7178179">:=</span>&nbsp;<span class="ident" id="7178182">f</span><span class="op" id="7178183">.</span><span class="ident" id="7178184">Pos</span><span class="op" id="7178187">(</span><span class="ident" id="7178188">offs</span><span class="op" id="7178192">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178196">_</span><span class="op" id="7178197">,</span>&nbsp;<span class="ident" id="7178199">col</span>&nbsp;<span class="op" id="7178203">:=</span>&nbsp;<span class="ident" id="7178206">linecol</span><span class="op" id="7178213">(</span><span class="ident" id="7178214">lines</span><span class="op" id="7178219">,</span>&nbsp;<span class="ident" id="7178221">offs</span><span class="op" id="7178225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178229">msg</span>&nbsp;<span class="op" id="7178233">:=</span>&nbsp;<span class="ident" id="7178236">fmt</span><span class="op" id="7178239">.</span><span class="ident" id="7178240">Sprintf</span><span class="op" id="7178247">(</span><span class="string" id="7178248">&#34;%s&nbsp;(offs&nbsp;=&nbsp;%d,&nbsp;p&nbsp;=&nbsp;%d)&#34;</span><span class="op" id="7178272">,</span>&nbsp;<span class="ident" id="7178274">f</span><span class="op" id="7178275">.</span><span class="ident" id="7178276">Name</span><span class="op" id="7178280">(</span><span class="op" id="7178281">)</span><span class="op" id="7178282">,</span>&nbsp;<span class="ident" id="7178284">offs</span><span class="op" id="7178288">,</span>&nbsp;<span class="ident" id="7178290">p</span><span class="op" id="7178291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178295">checkPos</span><span class="op" id="7178303">(</span><span class="ident" id="7178304">t</span><span class="op" id="7178305">,</span>&nbsp;<span class="ident" id="7178307">msg</span><span class="op" id="7178310">,</span>&nbsp;<span class="ident" id="7178312">f</span><span class="op" id="7178313">.</span><span class="ident" id="7178314">Position</span><span class="op" id="7178322">(</span><span class="ident" id="7178323">f</span><span class="op" id="7178324">.</span><span class="ident" id="7178325">Pos</span><span class="op" id="7178328">(</span><span class="ident" id="7178329">offs</span><span class="op" id="7178333">)</span><span class="op" id="7178334">)</span><span class="op" id="7178335">,</span>&nbsp;<span class="ident" id="7178337">Position</span><span class="op" id="7178345">{</span><span class="string" id="7178346">&#34;bar&#34;</span><span class="op" id="7178351">,</span>&nbsp;<span class="ident" id="7178353">offs</span><span class="op" id="7178357">,</span>&nbsp;<span class="num" id="7178359">42</span><span class="op" id="7178361">,</span>&nbsp;<span class="ident" id="7178363">col</span><span class="op" id="7178366">}</span><span class="op" id="7178367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178371">checkPos</span><span class="op" id="7178379">(</span><span class="ident" id="7178380">t</span><span class="op" id="7178381">,</span>&nbsp;<span class="ident" id="7178383">msg</span><span class="op" id="7178386">,</span>&nbsp;<span class="ident" id="7178388">fset</span><span class="op" id="7178392">.</span><span class="ident" id="7178393">Position</span><span class="op" id="7178401">(</span><span class="ident" id="7178402">p</span><span class="op" id="7178403">)</span><span class="op" id="7178404">,</span>&nbsp;<span class="ident" id="7178406">Position</span><span class="op" id="7178414">{</span><span class="string" id="7178415">&#34;bar&#34;</span><span class="op" id="7178420">,</span>&nbsp;<span class="ident" id="7178422">offs</span><span class="op" id="7178426">,</span>&nbsp;<span class="num" id="7178428">42</span><span class="op" id="7178430">,</span>&nbsp;<span class="ident" id="7178432">col</span><span class="op" id="7178435">}</span><span class="op" id="7178436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7178439">}</span><br>
<span class="lineno">165</span><span class="op" id="7178441">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7178444">func</span>&nbsp;<span class="ident" id="7178449">TestFiles</span><span class="op" id="7178458">(</span><span class="ident" id="7178459">t</span>&nbsp;<span class="op" id="7178461">*</span><span class="ident" id="7178462">testing</span><span class="op" id="7178469">.</span><span class="ident" id="7178470">T</span><span class="op" id="7178471">)</span>&nbsp;<span class="op" id="7178473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178476">fset</span>&nbsp;<span class="op" id="7178481">:=</span>&nbsp;<span class="ident" id="7178484">NewFileSet</span><span class="op" id="7178494">(</span><span class="op" id="7178495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7178498">for</span>&nbsp;<span class="ident" id="7178502">i</span><span class="op" id="7178503">,</span>&nbsp;<span class="ident" id="7178505">test</span>&nbsp;<span class="op" id="7178510">:=</span>&nbsp;<span class="keyword" id="7178513">range</span>&nbsp;<span class="ident" id="7178519">tests</span>&nbsp;<span class="op" id="7178525">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178529">base</span>&nbsp;<span class="op" id="7178534">:=</span>&nbsp;<span class="ident" id="7178537">fset</span><span class="op" id="7178541">.</span><span class="ident" id="7178542">Base</span><span class="op" id="7178546">(</span><span class="op" id="7178547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7178551">if</span>&nbsp;<span class="ident" id="7178554">i</span><span class="op" id="7178555">%</span><span class="num" id="7178556">2</span>&nbsp;<span class="op" id="7178558">==</span>&nbsp;<span class="num" id="7178561">1</span>&nbsp;<span class="op" id="7178563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7178568">//&nbsp;Setting&nbsp;a&nbsp;negative&nbsp;base&nbsp;is&nbsp;equivalent&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7178615">//&nbsp;fset.Base(),&nbsp;so&nbsp;test&nbsp;some&nbsp;of&nbsp;each.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178656">base</span>&nbsp;<span class="op" id="7178661">=</span>&nbsp;<span class="op" id="7178663">-</span><span class="num" id="7178664">1</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7178668">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178672">fset</span><span class="op" id="7178676">.</span><span class="ident" id="7178677">AddFile</span><span class="op" id="7178684">(</span><span class="ident" id="7178685">test</span><span class="op" id="7178689">.</span><span class="ident" id="7178690">filename</span><span class="op" id="7178698">,</span>&nbsp;<span class="ident" id="7178700">base</span><span class="op" id="7178704">,</span>&nbsp;<span class="ident" id="7178706">test</span><span class="op" id="7178710">.</span><span class="ident" id="7178711">size</span><span class="op" id="7178715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178719">j</span>&nbsp;<span class="op" id="7178721">:=</span>&nbsp;<span class="num" id="7178724">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178728">fset</span><span class="op" id="7178732">.</span><span class="ident" id="7178733">Iterate</span><span class="op" id="7178740">(</span><span class="keyword" id="7178741">func</span><span class="op" id="7178745">(</span><span class="ident" id="7178746">f</span>&nbsp;<span class="op" id="7178748">*</span><span class="ident" id="7178749">File</span><span class="op" id="7178753">)</span>&nbsp;<span class="builtintype" id="7178755">bool</span>&nbsp;<span class="op" id="7178760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7178765">if</span>&nbsp;<span class="ident" id="7178768">f</span><span class="op" id="7178769">.</span><span class="ident" id="7178770">Name</span><span class="op" id="7178774">(</span><span class="op" id="7178775">)</span>&nbsp;<span class="op" id="7178777">!=</span>&nbsp;<span class="ident" id="7178780">tests</span><span class="op" id="7178785">[</span><span class="ident" id="7178786">j</span><span class="op" id="7178787">]</span><span class="op" id="7178788">.</span><span class="ident" id="7178789">filename</span>&nbsp;<span class="op" id="7178798">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178804">t</span><span class="op" id="7178805">.</span><span class="ident" id="7178806">Errorf</span><span class="op" id="7178812">(</span><span class="string" id="7178813">&#34;got&nbsp;filename&nbsp;=&nbsp;%s;&nbsp;want&nbsp;%s&#34;</span><span class="op" id="7178841">,</span>&nbsp;<span class="ident" id="7178843">f</span><span class="op" id="7178844">.</span><span class="ident" id="7178845">Name</span><span class="op" id="7178849">(</span><span class="op" id="7178850">)</span><span class="op" id="7178851">,</span>&nbsp;<span class="ident" id="7178853">tests</span><span class="op" id="7178858">[</span><span class="ident" id="7178859">j</span><span class="op" id="7178860">]</span><span class="op" id="7178861">.</span><span class="ident" id="7178862">filename</span><span class="op" id="7178870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7178875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178880">j</span><span class="op" id="7178881">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7178887">return</span>&nbsp;<span class="builtintype" id="7178894">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7178901">}</span><span class="op" id="7178902">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7178906">if</span>&nbsp;<span class="ident" id="7178909">j</span>&nbsp;<span class="op" id="7178911">!=</span>&nbsp;<span class="ident" id="7178914">i</span><span class="op" id="7178915">+</span><span class="num" id="7178916">1</span>&nbsp;<span class="op" id="7178918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7178923">t</span><span class="op" id="7178924">.</span><span class="ident" id="7178925">Errorf</span><span class="op" id="7178931">(</span><span class="string" id="7178932">&#34;got&nbsp;%d&nbsp;files;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7178955">,</span>&nbsp;<span class="ident" id="7178957">j</span><span class="op" id="7178958">,</span>&nbsp;<span class="ident" id="7178960">i</span><span class="op" id="7178961">+</span><span class="num" id="7178962">1</span><span class="op" id="7178963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7178967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7178970">}</span><br>
<span class="lineno"></span><span class="op" id="7178972">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="comment" id="7178975">//&nbsp;FileSet.File&nbsp;should&nbsp;return&nbsp;nil&nbsp;if&nbsp;Pos&nbsp;is&nbsp;past&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;FileSet.</span><br>
<span class="lineno"></span><span class="keyword" id="7179048">func</span>&nbsp;<span class="ident" id="7179053">TestFileSetPastEnd</span><span class="op" id="7179071">(</span><span class="ident" id="7179072">t</span>&nbsp;<span class="op" id="7179074">*</span><span class="ident" id="7179075">testing</span><span class="op" id="7179082">.</span><span class="ident" id="7179083">T</span><span class="op" id="7179084">)</span>&nbsp;<span class="op" id="7179086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7179089">fset</span>&nbsp;<span class="op" id="7179094">:=</span>&nbsp;<span class="ident" id="7179097">NewFileSet</span><span class="op" id="7179107">(</span><span class="op" id="7179108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7179111">for</span>&nbsp;<span class="ident" id="7179115">_</span><span class="op" id="7179116">,</span>&nbsp;<span class="ident" id="7179118">test</span>&nbsp;<span class="op" id="7179123">:=</span>&nbsp;<span class="keyword" id="7179126">range</span>&nbsp;<span class="ident" id="7179132">tests</span>&nbsp;<span class="op" id="7179138">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7179142">fset</span><span class="op" id="7179146">.</span><span class="ident" id="7179147">AddFile</span><span class="op" id="7179154">(</span><span class="ident" id="7179155">test</span><span class="op" id="7179159">.</span><span class="ident" id="7179160">filename</span><span class="op" id="7179168">,</span>&nbsp;<span class="ident" id="7179170">fset</span><span class="op" id="7179174">.</span><span class="ident" id="7179175">Base</span><span class="op" id="7179179">(</span><span class="op" id="7179180">)</span><span class="op" id="7179181">,</span>&nbsp;<span class="ident" id="7179183">test</span><span class="op" id="7179187">.</span><span class="ident" id="7179188">size</span><span class="op" id="7179192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7179195">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7179198">if</span>&nbsp;<span class="ident" id="7179201">f</span>&nbsp;<span class="op" id="7179203">:=</span>&nbsp;<span class="ident" id="7179206">fset</span><span class="op" id="7179210">.</span><span class="ident" id="7179211">File</span><span class="op" id="7179215">(</span><span class="ident" id="7179216">Pos</span><span class="op" id="7179219">(</span><span class="ident" id="7179220">fset</span><span class="op" id="7179224">.</span><span class="ident" id="7179225">Base</span><span class="op" id="7179229">(</span><span class="op" id="7179230">)</span><span class="op" id="7179231">)</span><span class="op" id="7179232">)</span><span class="op" id="7179233">;</span>&nbsp;<span class="ident" id="7179235">f</span>&nbsp;<span class="op" id="7179237">!=</span>&nbsp;<span class="ident" id="7179240">nil</span>&nbsp;<span class="op" id="7179244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7179248">t</span><span class="op" id="7179249">.</span><span class="ident" id="7179250">Errorf</span><span class="op" id="7179256">(</span><span class="string" id="7179257">&#34;got&nbsp;%v,&nbsp;want&nbsp;nil&#34;</span><span class="op" id="7179275">,</span>&nbsp;<span class="ident" id="7179277">f</span><span class="op" id="7179278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7179281">}</span><br>
<span class="lineno">200</span><span class="op" id="7179283">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7179286">func</span>&nbsp;<span class="ident" id="7179291">TestFileSetCacheUnlikely</span><span class="op" id="7179315">(</span><span class="ident" id="7179316">t</span>&nbsp;<span class="op" id="7179318">*</span><span class="ident" id="7179319">testing</span><span class="op" id="7179326">.</span><span class="ident" id="7179327">T</span><span class="op" id="7179328">)</span>&nbsp;<span class="op" id="7179330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7179333">fset</span>&nbsp;<span class="op" id="7179338">:=</span>&nbsp;<span class="ident" id="7179341">NewFileSet</span><span class="op" id="7179351">(</span><span class="op" id="7179352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7179355">offsets</span>&nbsp;<span class="op" id="7179363">:=</span>&nbsp;<span class="builtinfunc" id="7179366">make</span><span class="op" id="7179370">(</span><span class="keyword" id="7179371">map</span><span class="op" id="7179374">[</span><span class="builtintype" id="7179375">string</span><span class="op" id="7179381">]</span><span class="builtintype" id="7179382">int</span><span class="op" id="7179385">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7179388">for</span>&nbsp;<span class="ident" id="7179392">_</span><span class="op" id="7179393">,</span>&nbsp;<span class="ident" id="7179395">test</span>&nbsp;<span class="op" id="7179400">:=</span>&nbsp;<span class="keyword" id="7179403">range</span>&nbsp;<span class="ident" id="7179409">tests</span>&nbsp;<span class="op" id="7179415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7179419">offsets</span><span class="op" id="7179426">[</span><span class="ident" id="7179427">test</span><span class="op" id="7179431">.</span><span class="ident" id="7179432">filename</span><span class="op" id="7179440">]</span>&nbsp;<span class="op" id="7179442">=</span>&nbsp;<span class="ident" id="7179444">fset</span><span class="op" id="7179448">.</span><span class="ident" id="7179449">Base</span><span class="op" id="7179453">(</span><span class="op" id="7179454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7179458">fset</span><span class="op" id="7179462">.</span><span class="ident" id="7179463">AddFile</span><span class="op" id="7179470">(</span><span class="ident" id="7179471">test</span><span class="op" id="7179475">.</span><span class="ident" id="7179476">filename</span><span class="op" id="7179484">,</span>&nbsp;<span class="ident" id="7179486">fset</span><span class="op" id="7179490">.</span><span class="ident" id="7179491">Base</span><span class="op" id="7179495">(</span><span class="op" id="7179496">)</span><span class="op" id="7179497">,</span>&nbsp;<span class="ident" id="7179499">test</span><span class="op" id="7179503">.</span><span class="ident" id="7179504">size</span><span class="op" id="7179508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7179511">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7179514">for</span>&nbsp;<span class="ident" id="7179518">file</span><span class="op" id="7179522">,</span>&nbsp;<span class="ident" id="7179524">pos</span>&nbsp;<span class="op" id="7179528">:=</span>&nbsp;<span class="keyword" id="7179531">range</span>&nbsp;<span class="ident" id="7179537">offsets</span>&nbsp;<span class="op" id="7179545">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7179549">f</span>&nbsp;<span class="op" id="7179551">:=</span>&nbsp;<span class="ident" id="7179554">fset</span><span class="op" id="7179558">.</span><span class="ident" id="7179559">File</span><span class="op" id="7179563">(</span><span class="ident" id="7179564">Pos</span><span class="op" id="7179567">(</span><span class="ident" id="7179568">pos</span><span class="op" id="7179571">)</span><span class="op" id="7179572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7179576">if</span>&nbsp;<span class="ident" id="7179579">f</span><span class="op" id="7179580">.</span><span class="ident" id="7179581">Name</span><span class="op" id="7179585">(</span><span class="op" id="7179586">)</span>&nbsp;<span class="op" id="7179588">!=</span>&nbsp;<span class="ident" id="7179591">file</span>&nbsp;<span class="op" id="7179596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7179601">t</span><span class="op" id="7179602">.</span><span class="ident" id="7179603">Errorf</span><span class="op" id="7179609">(</span><span class="string" id="7179610">&#34;got&nbsp;%q&nbsp;at&nbsp;position&nbsp;%d,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7179642">,</span>&nbsp;<span class="ident" id="7179644">f</span><span class="op" id="7179645">.</span><span class="ident" id="7179646">Name</span><span class="op" id="7179650">(</span><span class="op" id="7179651">)</span><span class="op" id="7179652">,</span>&nbsp;<span class="ident" id="7179654">pos</span><span class="op" id="7179657">,</span>&nbsp;<span class="ident" id="7179659">file</span><span class="op" id="7179663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7179667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7179670">}</span><br>
<span class="lineno">215</span><span class="op" id="7179672">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7179675">//&nbsp;issue&nbsp;4345.&nbsp;Test&nbsp;concurrent&nbsp;use&nbsp;of&nbsp;FileSet.Pos&nbsp;does&nbsp;not&nbsp;trigger&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="7179744">//&nbsp;race&nbsp;in&nbsp;the&nbsp;FileSet&nbsp;position&nbsp;cache.</span><br>
<span class="lineno"></span><span class="keyword" id="7179783">func</span>&nbsp;<span class="ident" id="7179788">TestFileSetRace</span><span class="op" id="7179803">(</span><span class="ident" id="7179804">t</span>&nbsp;<span class="op" id="7179806">*</span><span class="ident" id="7179807">testing</span><span class="op" id="7179814">.</span><span class="ident" id="7179815">T</span><span class="op" id="7179816">)</span>&nbsp;<span class="op" id="7179818">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7179821">fset</span>&nbsp;<span class="op" id="7179826">:=</span>&nbsp;<span class="ident" id="7179829">NewFileSet</span><span class="op" id="7179839">(</span><span class="op" id="7179840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7179843">for</span>&nbsp;<span class="ident" id="7179847">i</span>&nbsp;<span class="op" id="7179849">:=</span>&nbsp;<span class="num" id="7179852">0</span><span class="op" id="7179853">;</span>&nbsp;<span class="ident" id="7179855">i</span>&nbsp;<span class="op" id="7179857">&lt;</span>&nbsp;<span class="num" id="7179859">100</span><span class="op" id="7179862">;</span>&nbsp;<span class="ident" id="7179864">i</span><span class="op" id="7179865">++</span>&nbsp;<span class="op" id="7179868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7179872">fset</span><span class="op" id="7179876">.</span><span class="ident" id="7179877">AddFile</span><span class="op" id="7179884">(</span><span class="ident" id="7179885">fmt</span><span class="op" id="7179888">.</span><span class="ident" id="7179889">Sprintf</span><span class="op" id="7179896">(</span><span class="string" id="7179897">&#34;file-%d&#34;</span><span class="op" id="7179906">,</span>&nbsp;<span class="ident" id="7179908">i</span><span class="op" id="7179909">)</span><span class="op" id="7179910">,</span>&nbsp;<span class="ident" id="7179912">fset</span><span class="op" id="7179916">.</span><span class="ident" id="7179917">Base</span><span class="op" id="7179921">(</span><span class="op" id="7179922">)</span><span class="op" id="7179923">,</span>&nbsp;<span class="num" id="7179925">1031</span><span class="op" id="7179929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7179932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7179935">max</span>&nbsp;<span class="op" id="7179939">:=</span>&nbsp;<span class="builtintype" id="7179942">int32</span><span class="op" id="7179947">(</span><span class="ident" id="7179948">fset</span><span class="op" id="7179952">.</span><span class="ident" id="7179953">Base</span><span class="op" id="7179957">(</span><span class="op" id="7179958">)</span><span class="op" id="7179959">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7179962">var</span>&nbsp;<span class="ident" id="7179966">stop</span>&nbsp;<span class="ident" id="7179971">sync</span><span class="op" id="7179975">.</span><span class="ident" id="7179976">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7179987">r</span>&nbsp;<span class="op" id="7179989">:=</span>&nbsp;<span class="ident" id="7179992">rand</span><span class="op" id="7179996">.</span><span class="ident" id="7179997">New</span><span class="op" id="7180000">(</span><span class="ident" id="7180001">rand</span><span class="op" id="7180005">.</span><span class="ident" id="7180006">NewSource</span><span class="op" id="7180015">(</span><span class="num" id="7180016">7</span><span class="op" id="7180017">)</span><span class="op" id="7180018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7180021">for</span>&nbsp;<span class="ident" id="7180025">i</span>&nbsp;<span class="op" id="7180027">:=</span>&nbsp;<span class="num" id="7180030">0</span><span class="op" id="7180031">;</span>&nbsp;<span class="ident" id="7180033">i</span>&nbsp;<span class="op" id="7180035">&lt;</span>&nbsp;<span class="num" id="7180037">2</span><span class="op" id="7180038">;</span>&nbsp;<span class="ident" id="7180040">i</span><span class="op" id="7180041">++</span>&nbsp;<span class="op" id="7180044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7180048">r</span>&nbsp;<span class="op" id="7180050">:=</span>&nbsp;<span class="ident" id="7180053">rand</span><span class="op" id="7180057">.</span><span class="ident" id="7180058">New</span><span class="op" id="7180061">(</span><span class="ident" id="7180062">rand</span><span class="op" id="7180066">.</span><span class="ident" id="7180067">NewSource</span><span class="op" id="7180076">(</span><span class="ident" id="7180077">r</span><span class="op" id="7180078">.</span><span class="ident" id="7180079">Int63</span><span class="op" id="7180084">(</span><span class="op" id="7180085">)</span><span class="op" id="7180086">)</span><span class="op" id="7180087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7180091">stop</span><span class="op" id="7180095">.</span><span class="ident" id="7180096">Add</span><span class="op" id="7180099">(</span><span class="num" id="7180100">1</span><span class="op" id="7180101">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7180105">go</span>&nbsp;<span class="keyword" id="7180108">func</span><span class="op" id="7180112">(</span><span class="op" id="7180113">)</span>&nbsp;<span class="op" id="7180115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7180120">for</span>&nbsp;<span class="ident" id="7180124">i</span>&nbsp;<span class="op" id="7180126">:=</span>&nbsp;<span class="num" id="7180129">0</span><span class="op" id="7180130">;</span>&nbsp;<span class="ident" id="7180132">i</span>&nbsp;<span class="op" id="7180134">&lt;</span>&nbsp;<span class="num" id="7180136">1000</span><span class="op" id="7180140">;</span>&nbsp;<span class="ident" id="7180142">i</span><span class="op" id="7180143">++</span>&nbsp;<span class="op" id="7180146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7180152">fset</span><span class="op" id="7180156">.</span><span class="ident" id="7180157">Position</span><span class="op" id="7180165">(</span><span class="ident" id="7180166">Pos</span><span class="op" id="7180169">(</span><span class="ident" id="7180170">r</span><span class="op" id="7180171">.</span><span class="ident" id="7180172">Int31n</span><span class="op" id="7180178">(</span><span class="ident" id="7180179">max</span><span class="op" id="7180182">)</span><span class="op" id="7180183">)</span><span class="op" id="7180184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7180189">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7180194">stop</span><span class="op" id="7180198">.</span><span class="ident" id="7180199">Done</span><span class="op" id="7180203">(</span><span class="op" id="7180204">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7180208">}</span><span class="op" id="7180209">(</span><span class="op" id="7180210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7180213">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7180216">stop</span><span class="op" id="7180220">.</span><span class="ident" id="7180221">Wait</span><span class="op" id="7180225">(</span><span class="op" id="7180226">)</span><br>
<span class="lineno"></span><span class="op" id="7180228">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="keyword" id="7180231">func</span>&nbsp;<span class="ident" id="7180236">TestPositionFor</span><span class="op" id="7180251">(</span><span class="ident" id="7180252">t</span>&nbsp;<span class="op" id="7180254">*</span><span class="ident" id="7180255">testing</span><span class="op" id="7180262">.</span><span class="ident" id="7180263">T</span><span class="op" id="7180264">)</span>&nbsp;<span class="op" id="7180266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7180269">src</span>&nbsp;<span class="op" id="7180273">:=</span>&nbsp;<span class="op" id="7180276">[</span><span class="op" id="7180277">]</span><span class="builtintype" id="7180278">byte</span><span class="op" id="7180282">(</span><span class="string" id="7180283">`<br>
<span class="lineno"></span>foo<br>
<span class="lineno"></span>b<br>
<span class="lineno"></span>ar<br>
<span class="lineno">245</span>//line&nbsp;:100<br>
<span class="lineno"></span>foobar<br>
<span class="lineno"></span>//line&nbsp;bar:3<br>
<span class="lineno"></span>done<br>
<span class="lineno"></span>`</span><span class="op" id="7180332">)</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7180336">const</span>&nbsp;<span class="ident" id="7180342">filename</span>&nbsp;<span class="op" id="7180351">=</span>&nbsp;<span class="string" id="7180353">&#34;foo&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7180360">fset</span>&nbsp;<span class="op" id="7180365">:=</span>&nbsp;<span class="ident" id="7180368">NewFileSet</span><span class="op" id="7180378">(</span><span class="op" id="7180379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7180382">f</span>&nbsp;<span class="op" id="7180384">:=</span>&nbsp;<span class="ident" id="7180387">fset</span><span class="op" id="7180391">.</span><span class="ident" id="7180392">AddFile</span><span class="op" id="7180399">(</span><span class="ident" id="7180400">filename</span><span class="op" id="7180408">,</span>&nbsp;<span class="ident" id="7180410">fset</span><span class="op" id="7180414">.</span><span class="ident" id="7180415">Base</span><span class="op" id="7180419">(</span><span class="op" id="7180420">)</span><span class="op" id="7180421">,</span>&nbsp;<span class="builtinfunc" id="7180423">len</span><span class="op" id="7180426">(</span><span class="ident" id="7180427">src</span><span class="op" id="7180430">)</span><span class="op" id="7180431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7180434">f</span><span class="op" id="7180435">.</span><span class="ident" id="7180436">SetLinesForContent</span><span class="op" id="7180454">(</span><span class="ident" id="7180455">src</span><span class="op" id="7180458">)</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7180462">//&nbsp;verify&nbsp;position&nbsp;info</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7180487">for</span>&nbsp;<span class="ident" id="7180491">i</span><span class="op" id="7180492">,</span>&nbsp;<span class="ident" id="7180494">offs</span>&nbsp;<span class="op" id="7180499">:=</span>&nbsp;<span class="keyword" id="7180502">range</span>&nbsp;<span class="ident" id="7180508">f</span><span class="op" id="7180509">.</span><span class="ident" id="7180510">lines</span>&nbsp;<span class="op" id="7180516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7180520">got1</span>&nbsp;<span class="op" id="7180525">:=</span>&nbsp;<span class="ident" id="7180528">f</span><span class="op" id="7180529">.</span><span class="ident" id="7180530">PositionFor</span><span class="op" id="7180541">(</span><span class="ident" id="7180542">f</span><span class="op" id="7180543">.</span><span class="ident" id="7180544">Pos</span><span class="op" id="7180547">(</span><span class="ident" id="7180548">offs</span><span class="op" id="7180552">)</span><span class="op" id="7180553">,</span>&nbsp;<span class="builtintype" id="7180555">false</span><span class="op" id="7180560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7180564">got2</span>&nbsp;<span class="op" id="7180569">:=</span>&nbsp;<span class="ident" id="7180572">f</span><span class="op" id="7180573">.</span><span class="ident" id="7180574">PositionFor</span><span class="op" id="7180585">(</span><span class="ident" id="7180586">f</span><span class="op" id="7180587">.</span><span class="ident" id="7180588">Pos</span><span class="op" id="7180591">(</span><span class="ident" id="7180592">offs</span><span class="op" id="7180596">)</span><span class="op" id="7180597">,</span>&nbsp;<span class="builtintype" id="7180599">true</span><span class="op" id="7180603">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7180607">got3</span>&nbsp;<span class="op" id="7180612">:=</span>&nbsp;<span class="ident" id="7180615">f</span><span class="op" id="7180616">.</span><span class="ident" id="7180617">Position</span><span class="op" id="7180625">(</span><span class="ident" id="7180626">f</span><span class="op" id="7180627">.</span><span class="ident" id="7180628">Pos</span><span class="op" id="7180631">(</span><span class="ident" id="7180632">offs</span><span class="op" id="7180636">)</span><span class="op" id="7180637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7180641">want</span>&nbsp;<span class="op" id="7180646">:=</span>&nbsp;<span class="ident" id="7180649">Position</span><span class="op" id="7180657">{</span><span class="ident" id="7180658">filename</span><span class="op" id="7180666">,</span>&nbsp;<span class="ident" id="7180668">offs</span><span class="op" id="7180672">,</span>&nbsp;<span class="ident" id="7180674">i</span>&nbsp;<span class="op" id="7180676">+</span>&nbsp;<span class="num" id="7180678">1</span><span class="op" id="7180679">,</span>&nbsp;<span class="num" id="7180681">1</span><span class="op" id="7180682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7180686">checkPos</span><span class="op" id="7180694">(</span><span class="ident" id="7180695">t</span><span class="op" id="7180696">,</span>&nbsp;<span class="string" id="7180698">&#34;1.&nbsp;PositionFor&nbsp;unadjusted&#34;</span><span class="op" id="7180725">,</span>&nbsp;<span class="ident" id="7180727">got1</span><span class="op" id="7180731">,</span>&nbsp;<span class="ident" id="7180733">want</span><span class="op" id="7180737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7180741">checkPos</span><span class="op" id="7180749">(</span><span class="ident" id="7180750">t</span><span class="op" id="7180751">,</span>&nbsp;<span class="string" id="7180753">&#34;1.&nbsp;PositionFor&nbsp;adjusted&#34;</span><span class="op" id="7180778">,</span>&nbsp;<span class="ident" id="7180780">got2</span><span class="op" id="7180784">,</span>&nbsp;<span class="ident" id="7180786">want</span><span class="op" id="7180790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7180794">checkPos</span><span class="op" id="7180802">(</span><span class="ident" id="7180803">t</span><span class="op" id="7180804">,</span>&nbsp;<span class="string" id="7180806">&#34;1.&nbsp;Position&#34;</span><span class="op" id="7180819">,</span>&nbsp;<span class="ident" id="7180821">got3</span><span class="op" id="7180825">,</span>&nbsp;<span class="ident" id="7180827">want</span><span class="op" id="7180831">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7180834">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7180838">//&nbsp;manually&nbsp;add&nbsp;//line&nbsp;info&nbsp;on&nbsp;lines&nbsp;l1,&nbsp;l2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7180883">const</span>&nbsp;<span class="ident" id="7180889">l1</span><span class="op" id="7180891">,</span>&nbsp;<span class="ident" id="7180893">l2</span>&nbsp;<span class="op" id="7180896">=</span>&nbsp;<span class="num" id="7180898">5</span><span class="op" id="7180899">,</span>&nbsp;<span class="num" id="7180901">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7180904">f</span><span class="op" id="7180905">.</span><span class="ident" id="7180906">AddLineInfo</span><span class="op" id="7180917">(</span><span class="ident" id="7180918">f</span><span class="op" id="7180919">.</span><span class="ident" id="7180920">lines</span><span class="op" id="7180925">[</span><span class="ident" id="7180926">l1</span><span class="op" id="7180928">-</span><span class="num" id="7180929">1</span><span class="op" id="7180930">]</span><span class="op" id="7180931">,</span>&nbsp;<span class="string" id="7180933">&#34;&#34;</span><span class="op" id="7180935">,</span>&nbsp;<span class="num" id="7180937">100</span><span class="op" id="7180940">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7180943">f</span><span class="op" id="7180944">.</span><span class="ident" id="7180945">AddLineInfo</span><span class="op" id="7180956">(</span><span class="ident" id="7180957">f</span><span class="op" id="7180958">.</span><span class="ident" id="7180959">lines</span><span class="op" id="7180964">[</span><span class="ident" id="7180965">l2</span><span class="op" id="7180967">-</span><span class="num" id="7180968">1</span><span class="op" id="7180969">]</span><span class="op" id="7180970">,</span>&nbsp;<span class="string" id="7180972">&#34;bar&#34;</span><span class="op" id="7180977">,</span>&nbsp;<span class="num" id="7180979">3</span><span class="op" id="7180980">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7180984">//&nbsp;unadjusted&nbsp;position&nbsp;info&nbsp;must&nbsp;remain&nbsp;unchanged</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7181035">for</span>&nbsp;<span class="ident" id="7181039">i</span><span class="op" id="7181040">,</span>&nbsp;<span class="ident" id="7181042">offs</span>&nbsp;<span class="op" id="7181047">:=</span>&nbsp;<span class="keyword" id="7181050">range</span>&nbsp;<span class="ident" id="7181056">f</span><span class="op" id="7181057">.</span><span class="ident" id="7181058">lines</span>&nbsp;<span class="op" id="7181064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7181068">got1</span>&nbsp;<span class="op" id="7181073">:=</span>&nbsp;<span class="ident" id="7181076">f</span><span class="op" id="7181077">.</span><span class="ident" id="7181078">PositionFor</span><span class="op" id="7181089">(</span><span class="ident" id="7181090">f</span><span class="op" id="7181091">.</span><span class="ident" id="7181092">Pos</span><span class="op" id="7181095">(</span><span class="ident" id="7181096">offs</span><span class="op" id="7181100">)</span><span class="op" id="7181101">,</span>&nbsp;<span class="builtintype" id="7181103">false</span><span class="op" id="7181108">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7181112">want</span>&nbsp;<span class="op" id="7181117">:=</span>&nbsp;<span class="ident" id="7181120">Position</span><span class="op" id="7181128">{</span><span class="ident" id="7181129">filename</span><span class="op" id="7181137">,</span>&nbsp;<span class="ident" id="7181139">offs</span><span class="op" id="7181143">,</span>&nbsp;<span class="ident" id="7181145">i</span>&nbsp;<span class="op" id="7181147">+</span>&nbsp;<span class="num" id="7181149">1</span><span class="op" id="7181150">,</span>&nbsp;<span class="num" id="7181152">1</span><span class="op" id="7181153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7181157">checkPos</span><span class="op" id="7181165">(</span><span class="ident" id="7181166">t</span><span class="op" id="7181167">,</span>&nbsp;<span class="string" id="7181169">&#34;2.&nbsp;PositionFor&nbsp;unadjusted&#34;</span><span class="op" id="7181196">,</span>&nbsp;<span class="ident" id="7181198">got1</span><span class="op" id="7181202">,</span>&nbsp;<span class="ident" id="7181204">want</span><span class="op" id="7181208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7181211">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7181215">//&nbsp;adjusted&nbsp;position&nbsp;info&nbsp;should&nbsp;have&nbsp;changed</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7181262">for</span>&nbsp;<span class="ident" id="7181266">i</span><span class="op" id="7181267">,</span>&nbsp;<span class="ident" id="7181269">offs</span>&nbsp;<span class="op" id="7181274">:=</span>&nbsp;<span class="keyword" id="7181277">range</span>&nbsp;<span class="ident" id="7181283">f</span><span class="op" id="7181284">.</span><span class="ident" id="7181285">lines</span>&nbsp;<span class="op" id="7181291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7181295">got2</span>&nbsp;<span class="op" id="7181300">:=</span>&nbsp;<span class="ident" id="7181303">f</span><span class="op" id="7181304">.</span><span class="ident" id="7181305">PositionFor</span><span class="op" id="7181316">(</span><span class="ident" id="7181317">f</span><span class="op" id="7181318">.</span><span class="ident" id="7181319">Pos</span><span class="op" id="7181322">(</span><span class="ident" id="7181323">offs</span><span class="op" id="7181327">)</span><span class="op" id="7181328">,</span>&nbsp;<span class="builtintype" id="7181330">true</span><span class="op" id="7181334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7181338">got3</span>&nbsp;<span class="op" id="7181343">:=</span>&nbsp;<span class="ident" id="7181346">f</span><span class="op" id="7181347">.</span><span class="ident" id="7181348">Position</span><span class="op" id="7181356">(</span><span class="ident" id="7181357">f</span><span class="op" id="7181358">.</span><span class="ident" id="7181359">Pos</span><span class="op" id="7181362">(</span><span class="ident" id="7181363">offs</span><span class="op" id="7181367">)</span><span class="op" id="7181368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7181372">want</span>&nbsp;<span class="op" id="7181377">:=</span>&nbsp;<span class="ident" id="7181380">Position</span><span class="op" id="7181388">{</span><span class="ident" id="7181389">filename</span><span class="op" id="7181397">,</span>&nbsp;<span class="ident" id="7181399">offs</span><span class="op" id="7181403">,</span>&nbsp;<span class="ident" id="7181405">i</span>&nbsp;<span class="op" id="7181407">+</span>&nbsp;<span class="num" id="7181409">1</span><span class="op" id="7181410">,</span>&nbsp;<span class="num" id="7181412">1</span><span class="op" id="7181413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7181417">//&nbsp;manually&nbsp;compute&nbsp;wanted&nbsp;filename&nbsp;and&nbsp;line</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7181464">line</span>&nbsp;<span class="op" id="7181469">:=</span>&nbsp;<span class="ident" id="7181472">want</span><span class="op" id="7181476">.</span><span class="ident" id="7181477">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7181484">if</span>&nbsp;<span class="ident" id="7181487">i</span><span class="op" id="7181488">+</span><span class="num" id="7181489">1</span>&nbsp;<span class="op" id="7181491">&gt;=</span>&nbsp;<span class="ident" id="7181494">l1</span>&nbsp;<span class="op" id="7181497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7181502">want</span><span class="op" id="7181506">.</span><span class="ident" id="7181507">Filename</span>&nbsp;<span class="op" id="7181516">=</span>&nbsp;<span class="string" id="7181518">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7181524">want</span><span class="op" id="7181528">.</span><span class="ident" id="7181529">Line</span>&nbsp;<span class="op" id="7181534">=</span>&nbsp;<span class="ident" id="7181536">line</span>&nbsp;<span class="op" id="7181541">-</span>&nbsp;<span class="ident" id="7181543">l1</span>&nbsp;<span class="op" id="7181546">+</span>&nbsp;<span class="num" id="7181548">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7181554">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7181558">if</span>&nbsp;<span class="ident" id="7181561">i</span><span class="op" id="7181562">+</span><span class="num" id="7181563">1</span>&nbsp;<span class="op" id="7181565">&gt;=</span>&nbsp;<span class="ident" id="7181568">l2</span>&nbsp;<span class="op" id="7181571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7181576">want</span><span class="op" id="7181580">.</span><span class="ident" id="7181581">Filename</span>&nbsp;<span class="op" id="7181590">=</span>&nbsp;<span class="string" id="7181592">&#34;bar&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7181601">want</span><span class="op" id="7181605">.</span><span class="ident" id="7181606">Line</span>&nbsp;<span class="op" id="7181611">=</span>&nbsp;<span class="ident" id="7181613">line</span>&nbsp;<span class="op" id="7181618">-</span>&nbsp;<span class="ident" id="7181620">l2</span>&nbsp;<span class="op" id="7181623">+</span>&nbsp;<span class="num" id="7181625">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7181629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7181633">checkPos</span><span class="op" id="7181641">(</span><span class="ident" id="7181642">t</span><span class="op" id="7181643">,</span>&nbsp;<span class="string" id="7181645">&#34;3.&nbsp;PositionFor&nbsp;adjusted&#34;</span><span class="op" id="7181670">,</span>&nbsp;<span class="ident" id="7181672">got2</span><span class="op" id="7181676">,</span>&nbsp;<span class="ident" id="7181678">want</span><span class="op" id="7181682">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7181686">checkPos</span><span class="op" id="7181694">(</span><span class="ident" id="7181695">t</span><span class="op" id="7181696">,</span>&nbsp;<span class="string" id="7181698">&#34;3.&nbsp;Position&#34;</span><span class="op" id="7181711">,</span>&nbsp;<span class="ident" id="7181713">got3</span><span class="op" id="7181717">,</span>&nbsp;<span class="ident" id="7181719">want</span><span class="op" id="7181723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7181726">}</span><br>
<span class="lineno"></span><span class="op" id="7181728">}</span>
</div>
</body>
</html>
