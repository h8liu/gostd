<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/zip</h2>
<ul>
<li><a href="/gostd/archive/zip/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/zip/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/zip/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/zip/register.go.html" class="current">register.go</a></li>
<li><a href="/gostd/archive/zip/struct.go.html">struct.go</a></li>
<li><a href="/gostd/archive/zip/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/zip/writer_test.go.html">writer_test.go</a></li>
<li><a href="/gostd/archive/zip/zip_test.go.html">zip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6041381">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6041436">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6041490">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6041541">package</span>&nbsp;<span class="ident" id="6041549">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6041554">import</span>&nbsp;<span class="op" id="6041561">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6041564">&#34;compress/flate&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6041582">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6041592">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6041598">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6041611">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="6041618">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="6041621">//&nbsp;A&nbsp;Compressor&nbsp;returns&nbsp;a&nbsp;compressing&nbsp;writer,&nbsp;writing&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6041682">//&nbsp;provided&nbsp;writer.&nbsp;On&nbsp;Close,&nbsp;any&nbsp;pending&nbsp;data&nbsp;should&nbsp;be&nbsp;flushed.</span><br>
<span class="lineno"></span><span class="keyword" id="6041748">type</span>&nbsp;<span class="ident" id="6041753">Compressor</span>&nbsp;<span class="keyword" id="6041764">func</span><span class="op" id="6041768">(</span><span class="ident" id="6041769">io</span><span class="op" id="6041771">.</span><span class="ident" id="6041772">Writer</span><span class="op" id="6041778">)</span>&nbsp;<span class="op" id="6041780">(</span><span class="ident" id="6041781">io</span><span class="op" id="6041783">.</span><span class="ident" id="6041784">WriteCloser</span><span class="op" id="6041795">,</span>&nbsp;<span class="builtintype" id="6041797">error</span><span class="op" id="6041802">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6041805">//&nbsp;Decompressor&nbsp;is&nbsp;a&nbsp;function&nbsp;that&nbsp;wraps&nbsp;a&nbsp;Reader&nbsp;with&nbsp;a&nbsp;decompressing&nbsp;Reader.</span><br>
<span class="lineno">20</span><span class="comment" id="6041884">//&nbsp;The&nbsp;decompressed&nbsp;ReadCloser&nbsp;is&nbsp;returned&nbsp;to&nbsp;callers&nbsp;who&nbsp;open&nbsp;files&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="6041958">//&nbsp;within&nbsp;the&nbsp;archive.&nbsp;&nbsp;These&nbsp;callers&nbsp;are&nbsp;responsible&nbsp;for&nbsp;closing&nbsp;this&nbsp;reader</span><br>
<span class="lineno"></span><span class="comment" id="6042036">//&nbsp;when&nbsp;they&#39;re&nbsp;finished&nbsp;reading.</span><br>
<span class="lineno"></span><span class="keyword" id="6042070">type</span>&nbsp;<span class="ident" id="6042075">Decompressor</span>&nbsp;<span class="keyword" id="6042088">func</span><span class="op" id="6042092">(</span><span class="ident" id="6042093">io</span><span class="op" id="6042095">.</span><span class="ident" id="6042096">Reader</span><span class="op" id="6042102">)</span>&nbsp;<span class="ident" id="6042104">io</span><span class="op" id="6042106">.</span><span class="ident" id="6042107">ReadCloser</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="6042119">var</span>&nbsp;<span class="ident" id="6042123">flateWriterPool</span>&nbsp;<span class="ident" id="6042139">sync</span><span class="op" id="6042143">.</span><span class="ident" id="6042144">Pool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6042150">func</span>&nbsp;<span class="ident" id="6042155">newFlateWriter</span><span class="op" id="6042169">(</span><span class="ident" id="6042170">w</span>&nbsp;<span class="ident" id="6042172">io</span><span class="op" id="6042174">.</span><span class="ident" id="6042175">Writer</span><span class="op" id="6042181">)</span>&nbsp;<span class="ident" id="6042183">io</span><span class="op" id="6042185">.</span><span class="ident" id="6042186">WriteCloser</span>&nbsp;<span class="op" id="6042198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6042201">fw</span><span class="op" id="6042203">,</span>&nbsp;<span class="ident" id="6042205">ok</span>&nbsp;<span class="op" id="6042208">:=</span>&nbsp;<span class="ident" id="6042211">flateWriterPool</span><span class="op" id="6042226">.</span><span class="ident" id="6042227">Get</span><span class="op" id="6042230">(</span><span class="op" id="6042231">)</span><span class="op" id="6042232">.</span><span class="op" id="6042233">(</span><span class="op" id="6042234">*</span><span class="ident" id="6042235">flate</span><span class="op" id="6042240">.</span><span class="ident" id="6042241">Writer</span><span class="op" id="6042247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6042250">if</span>&nbsp;<span class="ident" id="6042253">ok</span>&nbsp;<span class="op" id="6042256">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6042260">fw</span><span class="op" id="6042262">.</span><span class="ident" id="6042263">Reset</span><span class="op" id="6042268">(</span><span class="ident" id="6042269">w</span><span class="op" id="6042270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6042273">}</span>&nbsp;<span class="keyword" id="6042275">else</span>&nbsp;<span class="op" id="6042280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6042284">fw</span><span class="op" id="6042286">,</span>&nbsp;<span class="ident" id="6042288">_</span>&nbsp;<span class="op" id="6042290">=</span>&nbsp;<span class="ident" id="6042292">flate</span><span class="op" id="6042297">.</span><span class="ident" id="6042298">NewWriter</span><span class="op" id="6042307">(</span><span class="ident" id="6042308">w</span><span class="op" id="6042309">,</span>&nbsp;<span class="num" id="6042311">5</span><span class="op" id="6042312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6042315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6042318">return</span>&nbsp;<span class="op" id="6042325">&amp;</span><span class="ident" id="6042326">pooledFlateWriter</span><span class="op" id="6042343">{</span><span class="ident" id="6042344">fw</span><span class="op" id="6042346">:</span>&nbsp;<span class="ident" id="6042348">fw</span><span class="op" id="6042350">}</span><br>
<span class="lineno">35</span><span class="op" id="6042352">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6042355">type</span>&nbsp;<span class="ident" id="6042360">pooledFlateWriter</span>&nbsp;<span class="keyword" id="6042378">struct</span>&nbsp;<span class="op" id="6042385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6042388">mu</span>&nbsp;<span class="ident" id="6042391">sync</span><span class="op" id="6042395">.</span><span class="ident" id="6042396">Mutex</span>&nbsp;<span class="comment" id="6042402">//&nbsp;guards&nbsp;Close&nbsp;and&nbsp;Write</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6042429">fw</span>&nbsp;<span class="op" id="6042432">*</span><span class="ident" id="6042433">flate</span><span class="op" id="6042438">.</span><span class="ident" id="6042439">Writer</span><br>
<span class="lineno">40</span><span class="op" id="6042446">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6042449">func</span>&nbsp;<span class="op" id="6042454">(</span><span class="ident" id="6042455">w</span>&nbsp;<span class="op" id="6042457">*</span><span class="ident" id="6042458">pooledFlateWriter</span><span class="op" id="6042475">)</span>&nbsp;<span class="ident" id="6042477">Write</span><span class="op" id="6042482">(</span><span class="ident" id="6042483">p</span>&nbsp;<span class="op" id="6042485">[</span><span class="op" id="6042486">]</span><span class="builtintype" id="6042487">byte</span><span class="op" id="6042491">)</span>&nbsp;<span class="op" id="6042493">(</span><span class="ident" id="6042494">n</span>&nbsp;<span class="builtintype" id="6042496">int</span><span class="op" id="6042499">,</span>&nbsp;<span class="ident" id="6042501">err</span>&nbsp;<span class="builtintype" id="6042505">error</span><span class="op" id="6042510">)</span>&nbsp;<span class="op" id="6042512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6042515">w</span><span class="op" id="6042516">.</span><span class="ident" id="6042517">mu</span><span class="op" id="6042519">.</span><span class="ident" id="6042520">Lock</span><span class="op" id="6042524">(</span><span class="op" id="6042525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6042528">defer</span>&nbsp;<span class="ident" id="6042534">w</span><span class="op" id="6042535">.</span><span class="ident" id="6042536">mu</span><span class="op" id="6042538">.</span><span class="ident" id="6042539">Unlock</span><span class="op" id="6042545">(</span><span class="op" id="6042546">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6042549">if</span>&nbsp;<span class="ident" id="6042552">w</span><span class="op" id="6042553">.</span><span class="ident" id="6042554">fw</span>&nbsp;<span class="op" id="6042557">==</span>&nbsp;<span class="builtintype" id="6042560">nil</span>&nbsp;<span class="op" id="6042564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6042568">return</span>&nbsp;<span class="num" id="6042575">0</span><span class="op" id="6042576">,</span>&nbsp;<span class="ident" id="6042578">errors</span><span class="op" id="6042584">.</span><span class="ident" id="6042585">New</span><span class="op" id="6042588">(</span><span class="string" id="6042589">&#34;Write&nbsp;after&nbsp;Close&#34;</span><span class="op" id="6042608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6042611">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6042614">return</span>&nbsp;<span class="ident" id="6042621">w</span><span class="op" id="6042622">.</span><span class="ident" id="6042623">fw</span><span class="op" id="6042625">.</span><span class="ident" id="6042626">Write</span><span class="op" id="6042631">(</span><span class="ident" id="6042632">p</span><span class="op" id="6042633">)</span><br>
<span class="lineno"></span><span class="op" id="6042635">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="6042638">func</span>&nbsp;<span class="op" id="6042643">(</span><span class="ident" id="6042644">w</span>&nbsp;<span class="op" id="6042646">*</span><span class="ident" id="6042647">pooledFlateWriter</span><span class="op" id="6042664">)</span>&nbsp;<span class="ident" id="6042666">Close</span><span class="op" id="6042671">(</span><span class="op" id="6042672">)</span>&nbsp;<span class="builtintype" id="6042674">error</span>&nbsp;<span class="op" id="6042680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6042683">w</span><span class="op" id="6042684">.</span><span class="ident" id="6042685">mu</span><span class="op" id="6042687">.</span><span class="ident" id="6042688">Lock</span><span class="op" id="6042692">(</span><span class="op" id="6042693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6042696">defer</span>&nbsp;<span class="ident" id="6042702">w</span><span class="op" id="6042703">.</span><span class="ident" id="6042704">mu</span><span class="op" id="6042706">.</span><span class="ident" id="6042707">Unlock</span><span class="op" id="6042713">(</span><span class="op" id="6042714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6042717">var</span>&nbsp;<span class="ident" id="6042721">err</span>&nbsp;<span class="builtintype" id="6042725">error</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6042732">if</span>&nbsp;<span class="ident" id="6042735">w</span><span class="op" id="6042736">.</span><span class="ident" id="6042737">fw</span>&nbsp;<span class="op" id="6042740">!=</span>&nbsp;<span class="builtintype" id="6042743">nil</span>&nbsp;<span class="op" id="6042747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6042751">err</span>&nbsp;<span class="op" id="6042755">=</span>&nbsp;<span class="ident" id="6042757">w</span><span class="op" id="6042758">.</span><span class="ident" id="6042759">fw</span><span class="op" id="6042761">.</span><span class="ident" id="6042762">Close</span><span class="op" id="6042767">(</span><span class="op" id="6042768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6042772">flateWriterPool</span><span class="op" id="6042787">.</span><span class="ident" id="6042788">Put</span><span class="op" id="6042791">(</span><span class="ident" id="6042792">w</span><span class="op" id="6042793">.</span><span class="ident" id="6042794">fw</span><span class="op" id="6042796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6042800">w</span><span class="op" id="6042801">.</span><span class="ident" id="6042802">fw</span>&nbsp;<span class="op" id="6042805">=</span>&nbsp;<span class="builtintype" id="6042807">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6042812">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6042815">return</span>&nbsp;<span class="ident" id="6042822">err</span><br>
<span class="lineno"></span><span class="op" id="6042826">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6042829">var</span>&nbsp;<span class="op" id="6042833">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6042836">mu</span>&nbsp;<span class="ident" id="6042839">sync</span><span class="op" id="6042843">.</span><span class="ident" id="6042844">RWMutex</span>&nbsp;<span class="comment" id="6042852">//&nbsp;guards&nbsp;compressor&nbsp;and&nbsp;decompressor&nbsp;maps</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6042897">compressors</span>&nbsp;<span class="op" id="6042909">=</span>&nbsp;<span class="keyword" id="6042911">map</span><span class="op" id="6042914">[</span><span class="builtintype" id="6042915">uint16</span><span class="op" id="6042921">]</span><span class="ident" id="6042922">Compressor</span><span class="op" id="6042932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6042936">Store</span><span class="op" id="6042941">:</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="6042945">func</span><span class="op" id="6042949">(</span><span class="ident" id="6042950">w</span>&nbsp;<span class="ident" id="6042952">io</span><span class="op" id="6042954">.</span><span class="ident" id="6042955">Writer</span><span class="op" id="6042961">)</span>&nbsp;<span class="op" id="6042963">(</span><span class="ident" id="6042964">io</span><span class="op" id="6042966">.</span><span class="ident" id="6042967">WriteCloser</span><span class="op" id="6042978">,</span>&nbsp;<span class="builtintype" id="6042980">error</span><span class="op" id="6042985">)</span>&nbsp;<span class="op" id="6042987">{</span>&nbsp;<span class="keyword" id="6042989">return</span>&nbsp;<span class="op" id="6042996">&amp;</span><span class="ident" id="6042997">nopCloser</span><span class="op" id="6043006">{</span><span class="ident" id="6043007">w</span><span class="op" id="6043008">}</span><span class="op" id="6043009">,</span>&nbsp;<span class="builtintype" id="6043011">nil</span>&nbsp;<span class="op" id="6043015">}</span><span class="op" id="6043016">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6043020">Deflate</span><span class="op" id="6043027">:</span>&nbsp;<span class="keyword" id="6043029">func</span><span class="op" id="6043033">(</span><span class="ident" id="6043034">w</span>&nbsp;<span class="ident" id="6043036">io</span><span class="op" id="6043038">.</span><span class="ident" id="6043039">Writer</span><span class="op" id="6043045">)</span>&nbsp;<span class="op" id="6043047">(</span><span class="ident" id="6043048">io</span><span class="op" id="6043050">.</span><span class="ident" id="6043051">WriteCloser</span><span class="op" id="6043062">,</span>&nbsp;<span class="builtintype" id="6043064">error</span><span class="op" id="6043069">)</span>&nbsp;<span class="op" id="6043071">{</span>&nbsp;<span class="keyword" id="6043073">return</span>&nbsp;<span class="ident" id="6043080">newFlateWriter</span><span class="op" id="6043094">(</span><span class="ident" id="6043095">w</span><span class="op" id="6043096">)</span><span class="op" id="6043097">,</span>&nbsp;<span class="builtintype" id="6043099">nil</span>&nbsp;<span class="op" id="6043103">}</span><span class="op" id="6043104">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6043107">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6043111">decompressors</span>&nbsp;<span class="op" id="6043125">=</span>&nbsp;<span class="keyword" id="6043127">map</span><span class="op" id="6043130">[</span><span class="builtintype" id="6043131">uint16</span><span class="op" id="6043137">]</span><span class="ident" id="6043138">Decompressor</span><span class="op" id="6043150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6043154">Store</span><span class="op" id="6043159">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6043163">ioutil</span><span class="op" id="6043169">.</span><span class="ident" id="6043170">NopCloser</span><span class="op" id="6043179">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6043183">Deflate</span><span class="op" id="6043190">:</span>&nbsp;<span class="ident" id="6043192">flate</span><span class="op" id="6043197">.</span><span class="ident" id="6043198">NewReader</span><span class="op" id="6043207">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6043210">}</span><br>
<span class="lineno">75</span><span class="op" id="6043212">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6043215">//&nbsp;RegisterDecompressor&nbsp;allows&nbsp;custom&nbsp;decompressors&nbsp;for&nbsp;a&nbsp;specified&nbsp;method&nbsp;ID.</span><br>
<span class="lineno"></span><span class="keyword" id="6043294">func</span>&nbsp;<span class="ident" id="6043299">RegisterDecompressor</span><span class="op" id="6043319">(</span><span class="ident" id="6043320">method</span>&nbsp;<span class="builtintype" id="6043327">uint16</span><span class="op" id="6043333">,</span>&nbsp;<span class="ident" id="6043335">d</span>&nbsp;<span class="ident" id="6043337">Decompressor</span><span class="op" id="6043349">)</span>&nbsp;<span class="op" id="6043351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6043354">mu</span><span class="op" id="6043356">.</span><span class="ident" id="6043357">Lock</span><span class="op" id="6043361">(</span><span class="op" id="6043362">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6043365">defer</span>&nbsp;<span class="ident" id="6043371">mu</span><span class="op" id="6043373">.</span><span class="ident" id="6043374">Unlock</span><span class="op" id="6043380">(</span><span class="op" id="6043381">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6043385">if</span>&nbsp;<span class="ident" id="6043388">_</span><span class="op" id="6043389">,</span>&nbsp;<span class="ident" id="6043391">ok</span>&nbsp;<span class="op" id="6043394">:=</span>&nbsp;<span class="ident" id="6043397">decompressors</span><span class="op" id="6043410">[</span><span class="ident" id="6043411">method</span><span class="op" id="6043417">]</span><span class="op" id="6043418">;</span>&nbsp;<span class="ident" id="6043420">ok</span>&nbsp;<span class="op" id="6043423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6043427">panic</span><span class="op" id="6043432">(</span><span class="string" id="6043433">&#34;decompressor&nbsp;already&nbsp;registered&#34;</span><span class="op" id="6043466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6043469">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6043472">decompressors</span><span class="op" id="6043485">[</span><span class="ident" id="6043486">method</span><span class="op" id="6043492">]</span>&nbsp;<span class="op" id="6043494">=</span>&nbsp;<span class="ident" id="6043496">d</span><br>
<span class="lineno"></span><span class="op" id="6043498">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6043501">//&nbsp;RegisterCompressor&nbsp;registers&nbsp;custom&nbsp;compressors&nbsp;for&nbsp;a&nbsp;specified&nbsp;method&nbsp;ID.</span><br>
<span class="lineno"></span><span class="comment" id="6043579">//&nbsp;The&nbsp;common&nbsp;methods&nbsp;Store&nbsp;and&nbsp;Deflate&nbsp;are&nbsp;built&nbsp;in.</span><br>
<span class="lineno">90</span><span class="keyword" id="6043633">func</span>&nbsp;<span class="ident" id="6043638">RegisterCompressor</span><span class="op" id="6043656">(</span><span class="ident" id="6043657">method</span>&nbsp;<span class="builtintype" id="6043664">uint16</span><span class="op" id="6043670">,</span>&nbsp;<span class="ident" id="6043672">comp</span>&nbsp;<span class="ident" id="6043677">Compressor</span><span class="op" id="6043687">)</span>&nbsp;<span class="op" id="6043689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6043692">mu</span><span class="op" id="6043694">.</span><span class="ident" id="6043695">Lock</span><span class="op" id="6043699">(</span><span class="op" id="6043700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6043703">defer</span>&nbsp;<span class="ident" id="6043709">mu</span><span class="op" id="6043711">.</span><span class="ident" id="6043712">Unlock</span><span class="op" id="6043718">(</span><span class="op" id="6043719">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6043723">if</span>&nbsp;<span class="ident" id="6043726">_</span><span class="op" id="6043727">,</span>&nbsp;<span class="ident" id="6043729">ok</span>&nbsp;<span class="op" id="6043732">:=</span>&nbsp;<span class="ident" id="6043735">compressors</span><span class="op" id="6043746">[</span><span class="ident" id="6043747">method</span><span class="op" id="6043753">]</span><span class="op" id="6043754">;</span>&nbsp;<span class="ident" id="6043756">ok</span>&nbsp;<span class="op" id="6043759">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6043763">panic</span><span class="op" id="6043768">(</span><span class="string" id="6043769">&#34;compressor&nbsp;already&nbsp;registered&#34;</span><span class="op" id="6043800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6043803">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6043806">compressors</span><span class="op" id="6043817">[</span><span class="ident" id="6043818">method</span><span class="op" id="6043824">]</span>&nbsp;<span class="op" id="6043826">=</span>&nbsp;<span class="ident" id="6043828">comp</span><br>
<span class="lineno"></span><span class="op" id="6043833">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="6043836">func</span>&nbsp;<span class="ident" id="6043841">compressor</span><span class="op" id="6043851">(</span><span class="ident" id="6043852">method</span>&nbsp;<span class="builtintype" id="6043859">uint16</span><span class="op" id="6043865">)</span>&nbsp;<span class="ident" id="6043867">Compressor</span>&nbsp;<span class="op" id="6043878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6043881">mu</span><span class="op" id="6043883">.</span><span class="ident" id="6043884">RLock</span><span class="op" id="6043889">(</span><span class="op" id="6043890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6043893">defer</span>&nbsp;<span class="ident" id="6043899">mu</span><span class="op" id="6043901">.</span><span class="ident" id="6043902">RUnlock</span><span class="op" id="6043909">(</span><span class="op" id="6043910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6043913">return</span>&nbsp;<span class="ident" id="6043920">compressors</span><span class="op" id="6043931">[</span><span class="ident" id="6043932">method</span><span class="op" id="6043938">]</span><br>
<span class="lineno"></span><span class="op" id="6043940">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="6043943">func</span>&nbsp;<span class="ident" id="6043948">decompressor</span><span class="op" id="6043960">(</span><span class="ident" id="6043961">method</span>&nbsp;<span class="builtintype" id="6043968">uint16</span><span class="op" id="6043974">)</span>&nbsp;<span class="ident" id="6043976">Decompressor</span>&nbsp;<span class="op" id="6043989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6043992">mu</span><span class="op" id="6043994">.</span><span class="ident" id="6043995">RLock</span><span class="op" id="6044000">(</span><span class="op" id="6044001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6044004">defer</span>&nbsp;<span class="ident" id="6044010">mu</span><span class="op" id="6044012">.</span><span class="ident" id="6044013">RUnlock</span><span class="op" id="6044020">(</span><span class="op" id="6044021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6044024">return</span>&nbsp;<span class="ident" id="6044031">decompressors</span><span class="op" id="6044044">[</span><span class="ident" id="6044045">method</span><span class="op" id="6044051">]</span><br>
<span class="lineno">110</span><span class="op" id="6044053">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
