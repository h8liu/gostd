<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/dsa</h2>
<ul>
<li><a href="/gostd/crypto/dsa/dsa.go.html" class="current">dsa.go</a></li>
<li><a href="/gostd/crypto/dsa/dsa_test.go.html">dsa_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4950902">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4950957">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4951011">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4951062">//&nbsp;Package&nbsp;dsa&nbsp;implements&nbsp;the&nbsp;Digital&nbsp;Signature&nbsp;Algorithm,&nbsp;as&nbsp;defined&nbsp;in&nbsp;FIPS&nbsp;186-3.</span><br>
<span class="lineno"></span><span class="keyword" id="4951147">package</span>&nbsp;<span class="ident" id="4951155">dsa</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4951160">import</span>&nbsp;<span class="op" id="4951167">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4951170">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4951180">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4951186">&#34;math/big&#34;</span><br>
<span class="lineno"></span><span class="op" id="4951197">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4951200">//&nbsp;Parameters&nbsp;represents&nbsp;the&nbsp;domain&nbsp;parameters&nbsp;for&nbsp;a&nbsp;key.&nbsp;These&nbsp;parameters&nbsp;can</span><br>
<span class="lineno">15</span><span class="comment" id="4951279">//&nbsp;be&nbsp;shared&nbsp;across&nbsp;many&nbsp;keys.&nbsp;The&nbsp;bit&nbsp;length&nbsp;of&nbsp;Q&nbsp;must&nbsp;be&nbsp;a&nbsp;multiple&nbsp;of&nbsp;8.</span><br>
<span class="lineno"></span><span class="keyword" id="4951355">type</span>&nbsp;<span class="ident" id="4951360">Parameters</span>&nbsp;<span class="keyword" id="4951371">struct</span>&nbsp;<span class="op" id="4951378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4951381">P</span><span class="op" id="4951382">,</span>&nbsp;<span class="ident" id="4951384">Q</span><span class="op" id="4951385">,</span>&nbsp;<span class="ident" id="4951387">G</span>&nbsp;<span class="op" id="4951389">*</span><span class="ident" id="4951390">big</span><span class="op" id="4951393">.</span><span class="ident" id="4951394">Int</span><br>
<span class="lineno"></span><span class="op" id="4951398">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="4951401">//&nbsp;PublicKey&nbsp;represents&nbsp;a&nbsp;DSA&nbsp;public&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4951443">type</span>&nbsp;<span class="ident" id="4951448">PublicKey</span>&nbsp;<span class="keyword" id="4951458">struct</span>&nbsp;<span class="op" id="4951465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4951468">Parameters</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4951480">Y</span>&nbsp;<span class="op" id="4951482">*</span><span class="ident" id="4951483">big</span><span class="op" id="4951486">.</span><span class="ident" id="4951487">Int</span><br>
<span class="lineno"></span><span class="op" id="4951491">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="4951494">//&nbsp;PrivateKey&nbsp;represents&nbsp;a&nbsp;DSA&nbsp;private&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4951538">type</span>&nbsp;<span class="ident" id="4951543">PrivateKey</span>&nbsp;<span class="keyword" id="4951554">struct</span>&nbsp;<span class="op" id="4951561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4951564">PublicKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4951575">X</span>&nbsp;<span class="op" id="4951577">*</span><span class="ident" id="4951578">big</span><span class="op" id="4951581">.</span><span class="ident" id="4951582">Int</span><br>
<span class="lineno">30</span><span class="op" id="4951586">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4951589">//&nbsp;ErrInvalidPublicKey&nbsp;results&nbsp;when&nbsp;a&nbsp;public&nbsp;key&nbsp;is&nbsp;not&nbsp;usable&nbsp;by&nbsp;this&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="4951666">//&nbsp;FIPS&nbsp;is&nbsp;quite&nbsp;strict&nbsp;about&nbsp;the&nbsp;format&nbsp;of&nbsp;DSA&nbsp;keys,&nbsp;but&nbsp;other&nbsp;code&nbsp;may&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="4951742">//&nbsp;less&nbsp;so.&nbsp;Thus,&nbsp;when&nbsp;using&nbsp;keys&nbsp;which&nbsp;may&nbsp;have&nbsp;been&nbsp;generated&nbsp;by&nbsp;other&nbsp;code,</span><br>
<span class="lineno">35</span><span class="comment" id="4951821">//&nbsp;this&nbsp;error&nbsp;must&nbsp;be&nbsp;handled.</span><br>
<span class="lineno"></span><span class="keyword" id="4951852">var</span>&nbsp;<span class="ident" id="4951856">ErrInvalidPublicKey</span>&nbsp;<span class="op" id="4951876">=</span>&nbsp;<span class="ident" id="4951878">errors</span><span class="op" id="4951884">.</span><span class="ident" id="4951885">New</span><span class="op" id="4951888">(</span><span class="string" id="4951889">&#34;crypto/dsa:&nbsp;invalid&nbsp;public&nbsp;key&#34;</span><span class="op" id="4951921">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4951924">//&nbsp;ParameterSizes&nbsp;is&nbsp;a&nbsp;enumeration&nbsp;of&nbsp;the&nbsp;acceptable&nbsp;bit&nbsp;lengths&nbsp;of&nbsp;the&nbsp;primes</span><br>
<span class="lineno"></span><span class="comment" id="4952003">//&nbsp;in&nbsp;a&nbsp;set&nbsp;of&nbsp;DSA&nbsp;parameters.&nbsp;See&nbsp;FIPS&nbsp;186-3,&nbsp;section&nbsp;4.2.</span><br>
<span class="lineno">40</span><span class="keyword" id="4952063">type</span>&nbsp;<span class="ident" id="4952068">ParameterSizes</span>&nbsp;<span class="builtintype" id="4952083">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4952088">const</span>&nbsp;<span class="op" id="4952094">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4952097">L1024N160</span>&nbsp;<span class="ident" id="4952107">ParameterSizes</span>&nbsp;<span class="op" id="4952122">=</span>&nbsp;<span class="ident" id="4952124">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4952130">L2048N224</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4952141">L2048N256</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4952152">L3072N256</span><br>
<span class="lineno"></span><span class="op" id="4952162">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4952165">//&nbsp;numMRTests&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;Miller-Rabin&nbsp;primality&nbsp;tests&nbsp;that&nbsp;we&nbsp;perform.&nbsp;We</span><br>
<span class="lineno">50</span><span class="comment" id="4952245">//&nbsp;pick&nbsp;the&nbsp;largest&nbsp;recommended&nbsp;number&nbsp;from&nbsp;table&nbsp;C.1&nbsp;of&nbsp;FIPS&nbsp;186-3.</span><br>
<span class="lineno"></span><span class="keyword" id="4952314">const</span>&nbsp;<span class="ident" id="4952320">numMRTests</span>&nbsp;<span class="op" id="4952331">=</span>&nbsp;<span class="num" id="4952333">64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4952337">//&nbsp;GenerateParameters&nbsp;puts&nbsp;a&nbsp;random,&nbsp;valid&nbsp;set&nbsp;of&nbsp;DSA&nbsp;parameters&nbsp;into&nbsp;params.</span><br>
<span class="lineno"></span><span class="comment" id="4952415">//&nbsp;This&nbsp;function&nbsp;takes&nbsp;many&nbsp;seconds,&nbsp;even&nbsp;on&nbsp;fast&nbsp;machines.</span><br>
<span class="lineno">55</span><span class="keyword" id="4952475">func</span>&nbsp;<span class="ident" id="4952480">GenerateParameters</span><span class="op" id="4952498">(</span><span class="ident" id="4952499">params</span>&nbsp;<span class="op" id="4952506">*</span><span class="ident" id="4952507">Parameters</span><span class="op" id="4952517">,</span>&nbsp;<span class="ident" id="4952519">rand</span>&nbsp;<span class="ident" id="4952524">io</span><span class="op" id="4952526">.</span><span class="ident" id="4952527">Reader</span><span class="op" id="4952533">,</span>&nbsp;<span class="ident" id="4952535">sizes</span>&nbsp;<span class="ident" id="4952541">ParameterSizes</span><span class="op" id="4952555">)</span>&nbsp;<span class="op" id="4952557">(</span><span class="ident" id="4952558">err</span>&nbsp;<span class="builtintype" id="4952562">error</span><span class="op" id="4952567">)</span>&nbsp;<span class="op" id="4952569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4952572">//&nbsp;This&nbsp;function&nbsp;doesn&#39;t&nbsp;follow&nbsp;FIPS&nbsp;186-3&nbsp;exactly&nbsp;in&nbsp;that&nbsp;it&nbsp;doesn&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4952643">//&nbsp;use&nbsp;a&nbsp;verification&nbsp;seed&nbsp;to&nbsp;generate&nbsp;the&nbsp;primes.&nbsp;The&nbsp;verification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4952712">//&nbsp;seed&nbsp;doesn&#39;t&nbsp;appear&nbsp;to&nbsp;be&nbsp;exported&nbsp;or&nbsp;used&nbsp;by&nbsp;other&nbsp;code&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4952777">//&nbsp;omitting&nbsp;it&nbsp;makes&nbsp;the&nbsp;code&nbsp;cleaner.</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4952818">var</span>&nbsp;<span class="ident" id="4952822">L</span><span class="op" id="4952823">,</span>&nbsp;<span class="ident" id="4952825">N</span>&nbsp;<span class="builtintype" id="4952827">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4952832">switch</span>&nbsp;<span class="ident" id="4952839">sizes</span>&nbsp;<span class="op" id="4952845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4952848">case</span>&nbsp;<span class="ident" id="4952853">L1024N160</span><span class="op" id="4952862">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4952866">L</span>&nbsp;<span class="op" id="4952868">=</span>&nbsp;<span class="num" id="4952870">1024</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4952877">N</span>&nbsp;<span class="op" id="4952879">=</span>&nbsp;<span class="num" id="4952881">160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4952886">case</span>&nbsp;<span class="ident" id="4952891">L2048N224</span><span class="op" id="4952900">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4952904">L</span>&nbsp;<span class="op" id="4952906">=</span>&nbsp;<span class="num" id="4952908">2048</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4952915">N</span>&nbsp;<span class="op" id="4952917">=</span>&nbsp;<span class="num" id="4952919">224</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4952924">case</span>&nbsp;<span class="ident" id="4952929">L2048N256</span><span class="op" id="4952938">:</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4952942">L</span>&nbsp;<span class="op" id="4952944">=</span>&nbsp;<span class="num" id="4952946">2048</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4952953">N</span>&nbsp;<span class="op" id="4952955">=</span>&nbsp;<span class="num" id="4952957">256</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4952962">case</span>&nbsp;<span class="ident" id="4952967">L3072N256</span><span class="op" id="4952976">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4952980">L</span>&nbsp;<span class="op" id="4952982">=</span>&nbsp;<span class="num" id="4952984">3072</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4952991">N</span>&nbsp;<span class="op" id="4952993">=</span>&nbsp;<span class="num" id="4952995">256</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4953000">default</span><span class="op" id="4953007">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4953011">return</span>&nbsp;<span class="ident" id="4953018">errors</span><span class="op" id="4953024">.</span><span class="ident" id="4953025">New</span><span class="op" id="4953028">(</span><span class="string" id="4953029">&#34;crypto/dsa:&nbsp;invalid&nbsp;ParameterSizes&#34;</span><span class="op" id="4953065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4953068">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953072">qBytes</span>&nbsp;<span class="op" id="4953079">:=</span>&nbsp;<span class="builtinfunc" id="4953082">make</span><span class="op" id="4953086">(</span><span class="op" id="4953087">[</span><span class="op" id="4953088">]</span><span class="builtintype" id="4953089">byte</span><span class="op" id="4953093">,</span>&nbsp;<span class="ident" id="4953095">N</span><span class="op" id="4953096">/</span><span class="num" id="4953097">8</span><span class="op" id="4953098">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953101">pBytes</span>&nbsp;<span class="op" id="4953108">:=</span>&nbsp;<span class="builtinfunc" id="4953111">make</span><span class="op" id="4953115">(</span><span class="op" id="4953116">[</span><span class="op" id="4953117">]</span><span class="builtintype" id="4953118">byte</span><span class="op" id="4953122">,</span>&nbsp;<span class="ident" id="4953124">L</span><span class="op" id="4953125">/</span><span class="num" id="4953126">8</span><span class="op" id="4953127">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953131">q</span>&nbsp;<span class="op" id="4953133">:=</span>&nbsp;<span class="builtinfunc" id="4953136">new</span><span class="op" id="4953139">(</span><span class="ident" id="4953140">big</span><span class="op" id="4953143">.</span><span class="ident" id="4953144">Int</span><span class="op" id="4953147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953150">p</span>&nbsp;<span class="op" id="4953152">:=</span>&nbsp;<span class="builtinfunc" id="4953155">new</span><span class="op" id="4953158">(</span><span class="ident" id="4953159">big</span><span class="op" id="4953162">.</span><span class="ident" id="4953163">Int</span><span class="op" id="4953166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953169">rem</span>&nbsp;<span class="op" id="4953173">:=</span>&nbsp;<span class="builtinfunc" id="4953176">new</span><span class="op" id="4953179">(</span><span class="ident" id="4953180">big</span><span class="op" id="4953183">.</span><span class="ident" id="4953184">Int</span><span class="op" id="4953187">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953190">one</span>&nbsp;<span class="op" id="4953194">:=</span>&nbsp;<span class="builtinfunc" id="4953197">new</span><span class="op" id="4953200">(</span><span class="ident" id="4953201">big</span><span class="op" id="4953204">.</span><span class="ident" id="4953205">Int</span><span class="op" id="4953208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953211">one</span><span class="op" id="4953214">.</span><span class="ident" id="4953215">SetInt64</span><span class="op" id="4953223">(</span><span class="num" id="4953224">1</span><span class="op" id="4953225">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="4953228">GeneratePrimes</span><span class="op" id="4953242">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4953245">for</span>&nbsp;<span class="op" id="4953249">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953253">_</span><span class="op" id="4953254">,</span>&nbsp;<span class="ident" id="4953256">err</span>&nbsp;<span class="op" id="4953260">=</span>&nbsp;<span class="ident" id="4953262">io</span><span class="op" id="4953264">.</span><span class="ident" id="4953265">ReadFull</span><span class="op" id="4953273">(</span><span class="ident" id="4953274">rand</span><span class="op" id="4953278">,</span>&nbsp;<span class="ident" id="4953280">qBytes</span><span class="op" id="4953286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4953290">if</span>&nbsp;<span class="ident" id="4953293">err</span>&nbsp;<span class="op" id="4953297">!=</span>&nbsp;<span class="ident" id="4953300">nil</span>&nbsp;<span class="op" id="4953304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4953309">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4953318">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953323">qBytes</span><span class="op" id="4953329">[</span><span class="builtinfunc" id="4953330">len</span><span class="op" id="4953333">(</span><span class="ident" id="4953334">qBytes</span><span class="op" id="4953340">)</span><span class="op" id="4953341">-</span><span class="num" id="4953342">1</span><span class="op" id="4953343">]</span>&nbsp;<span class="op" id="4953345">|=</span>&nbsp;<span class="num" id="4953348">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953352">qBytes</span><span class="op" id="4953358">[</span><span class="num" id="4953359">0</span><span class="op" id="4953360">]</span>&nbsp;<span class="op" id="4953362">|=</span>&nbsp;<span class="num" id="4953365">0x80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953372">q</span><span class="op" id="4953373">.</span><span class="ident" id="4953374">SetBytes</span><span class="op" id="4953382">(</span><span class="ident" id="4953383">qBytes</span><span class="op" id="4953389">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4953394">if</span>&nbsp;<span class="op" id="4953397">!</span><span class="ident" id="4953398">q</span><span class="op" id="4953399">.</span><span class="ident" id="4953400">ProbablyPrime</span><span class="op" id="4953413">(</span><span class="ident" id="4953414">numMRTests</span><span class="op" id="4953424">)</span>&nbsp;<span class="op" id="4953426">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4953431">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4953442">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4953447">for</span>&nbsp;<span class="ident" id="4953451">i</span>&nbsp;<span class="op" id="4953453">:=</span>&nbsp;<span class="num" id="4953456">0</span><span class="op" id="4953457">;</span>&nbsp;<span class="ident" id="4953459">i</span>&nbsp;<span class="op" id="4953461">&lt;</span>&nbsp;<span class="num" id="4953463">4</span><span class="op" id="4953464">*</span><span class="ident" id="4953465">L</span><span class="op" id="4953466">;</span>&nbsp;<span class="ident" id="4953468">i</span><span class="op" id="4953469">++</span>&nbsp;<span class="op" id="4953472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953477">_</span><span class="op" id="4953478">,</span>&nbsp;<span class="ident" id="4953480">err</span>&nbsp;<span class="op" id="4953484">=</span>&nbsp;<span class="ident" id="4953486">io</span><span class="op" id="4953488">.</span><span class="ident" id="4953489">ReadFull</span><span class="op" id="4953497">(</span><span class="ident" id="4953498">rand</span><span class="op" id="4953502">,</span>&nbsp;<span class="ident" id="4953504">pBytes</span><span class="op" id="4953510">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4953515">if</span>&nbsp;<span class="ident" id="4953518">err</span>&nbsp;<span class="op" id="4953522">!=</span>&nbsp;<span class="ident" id="4953525">nil</span>&nbsp;<span class="op" id="4953529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4953535">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4953545">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953551">pBytes</span><span class="op" id="4953557">[</span><span class="builtinfunc" id="4953558">len</span><span class="op" id="4953561">(</span><span class="ident" id="4953562">pBytes</span><span class="op" id="4953568">)</span><span class="op" id="4953569">-</span><span class="num" id="4953570">1</span><span class="op" id="4953571">]</span>&nbsp;<span class="op" id="4953573">|=</span>&nbsp;<span class="num" id="4953576">1</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953581">pBytes</span><span class="op" id="4953587">[</span><span class="num" id="4953588">0</span><span class="op" id="4953589">]</span>&nbsp;<span class="op" id="4953591">|=</span>&nbsp;<span class="num" id="4953594">0x80</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953603">p</span><span class="op" id="4953604">.</span><span class="ident" id="4953605">SetBytes</span><span class="op" id="4953613">(</span><span class="ident" id="4953614">pBytes</span><span class="op" id="4953620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953625">rem</span><span class="op" id="4953628">.</span><span class="ident" id="4953629">Mod</span><span class="op" id="4953632">(</span><span class="ident" id="4953633">p</span><span class="op" id="4953634">,</span>&nbsp;<span class="ident" id="4953636">q</span><span class="op" id="4953637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953642">rem</span><span class="op" id="4953645">.</span><span class="ident" id="4953646">Sub</span><span class="op" id="4953649">(</span><span class="ident" id="4953650">rem</span><span class="op" id="4953653">,</span>&nbsp;<span class="ident" id="4953655">one</span><span class="op" id="4953658">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953663">p</span><span class="op" id="4953664">.</span><span class="ident" id="4953665">Sub</span><span class="op" id="4953668">(</span><span class="ident" id="4953669">p</span><span class="op" id="4953670">,</span>&nbsp;<span class="ident" id="4953672">rem</span><span class="op" id="4953675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4953680">if</span>&nbsp;<span class="ident" id="4953683">p</span><span class="op" id="4953684">.</span><span class="ident" id="4953685">BitLen</span><span class="op" id="4953691">(</span><span class="op" id="4953692">)</span>&nbsp;<span class="op" id="4953694">&lt;</span>&nbsp;<span class="ident" id="4953696">L</span>&nbsp;<span class="op" id="4953698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4953704">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4953716">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4953722">if</span>&nbsp;<span class="op" id="4953725">!</span><span class="ident" id="4953726">p</span><span class="op" id="4953727">.</span><span class="ident" id="4953728">ProbablyPrime</span><span class="op" id="4953741">(</span><span class="ident" id="4953742">numMRTests</span><span class="op" id="4953752">)</span>&nbsp;<span class="op" id="4953754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4953760">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4953772">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953778">params</span><span class="op" id="4953784">.</span><span class="ident" id="4953785">P</span>&nbsp;<span class="op" id="4953787">=</span>&nbsp;<span class="ident" id="4953789">p</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953794">params</span><span class="op" id="4953800">.</span><span class="ident" id="4953801">Q</span>&nbsp;<span class="op" id="4953803">=</span>&nbsp;<span class="ident" id="4953805">q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4953810">break</span>&nbsp;<span class="ident" id="4953816">GeneratePrimes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4953833">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4953836">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953840">h</span>&nbsp;<span class="op" id="4953842">:=</span>&nbsp;<span class="builtinfunc" id="4953845">new</span><span class="op" id="4953848">(</span><span class="ident" id="4953849">big</span><span class="op" id="4953852">.</span><span class="ident" id="4953853">Int</span><span class="op" id="4953856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953859">h</span><span class="op" id="4953860">.</span><span class="ident" id="4953861">SetInt64</span><span class="op" id="4953869">(</span><span class="num" id="4953870">2</span><span class="op" id="4953871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953874">g</span>&nbsp;<span class="op" id="4953876">:=</span>&nbsp;<span class="builtinfunc" id="4953879">new</span><span class="op" id="4953882">(</span><span class="ident" id="4953883">big</span><span class="op" id="4953886">.</span><span class="ident" id="4953887">Int</span><span class="op" id="4953890">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953894">pm1</span>&nbsp;<span class="op" id="4953898">:=</span>&nbsp;<span class="builtinfunc" id="4953901">new</span><span class="op" id="4953904">(</span><span class="ident" id="4953905">big</span><span class="op" id="4953908">.</span><span class="ident" id="4953909">Int</span><span class="op" id="4953912">)</span><span class="op" id="4953913">.</span><span class="ident" id="4953914">Sub</span><span class="op" id="4953917">(</span><span class="ident" id="4953918">p</span><span class="op" id="4953919">,</span>&nbsp;<span class="ident" id="4953921">one</span><span class="op" id="4953924">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953927">e</span>&nbsp;<span class="op" id="4953929">:=</span>&nbsp;<span class="builtinfunc" id="4953932">new</span><span class="op" id="4953935">(</span><span class="ident" id="4953936">big</span><span class="op" id="4953939">.</span><span class="ident" id="4953940">Int</span><span class="op" id="4953943">)</span><span class="op" id="4953944">.</span><span class="ident" id="4953945">Div</span><span class="op" id="4953948">(</span><span class="ident" id="4953949">pm1</span><span class="op" id="4953952">,</span>&nbsp;<span class="ident" id="4953954">q</span><span class="op" id="4953955">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4953959">for</span>&nbsp;<span class="op" id="4953963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953967">g</span><span class="op" id="4953968">.</span><span class="ident" id="4953969">Exp</span><span class="op" id="4953972">(</span><span class="ident" id="4953973">h</span><span class="op" id="4953974">,</span>&nbsp;<span class="ident" id="4953976">e</span><span class="op" id="4953977">,</span>&nbsp;<span class="ident" id="4953979">p</span><span class="op" id="4953980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4953984">if</span>&nbsp;<span class="ident" id="4953987">g</span><span class="op" id="4953988">.</span><span class="ident" id="4953989">Cmp</span><span class="op" id="4953992">(</span><span class="ident" id="4953993">one</span><span class="op" id="4953996">)</span>&nbsp;<span class="op" id="4953998">==</span>&nbsp;<span class="num" id="4954001">0</span>&nbsp;<span class="op" id="4954003">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4954008">h</span><span class="op" id="4954009">.</span><span class="ident" id="4954010">Add</span><span class="op" id="4954013">(</span><span class="ident" id="4954014">h</span><span class="op" id="4954015">,</span>&nbsp;<span class="ident" id="4954017">one</span><span class="op" id="4954020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4954025">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4954036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4954041">params</span><span class="op" id="4954047">.</span><span class="ident" id="4954048">G</span>&nbsp;<span class="op" id="4954050">=</span>&nbsp;<span class="ident" id="4954052">g</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4954056">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4954064">}</span><br>
<span class="lineno"></span><span class="op" id="4954066">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4954069">//&nbsp;GenerateKey&nbsp;generates&nbsp;a&nbsp;public&amp;private&nbsp;key&nbsp;pair.&nbsp;The&nbsp;Parameters&nbsp;of&nbsp;the</span><br>
<span class="lineno">150</span><span class="comment" id="4954143">//&nbsp;PrivateKey&nbsp;must&nbsp;already&nbsp;be&nbsp;valid&nbsp;(see&nbsp;GenerateParameters).</span><br>
<span class="lineno"></span><span class="keyword" id="4954205">func</span>&nbsp;<span class="ident" id="4954210">GenerateKey</span><span class="op" id="4954221">(</span><span class="ident" id="4954222">priv</span>&nbsp;<span class="op" id="4954227">*</span><span class="ident" id="4954228">PrivateKey</span><span class="op" id="4954238">,</span>&nbsp;<span class="ident" id="4954240">rand</span>&nbsp;<span class="ident" id="4954245">io</span><span class="op" id="4954247">.</span><span class="ident" id="4954248">Reader</span><span class="op" id="4954254">)</span>&nbsp;<span class="builtintype" id="4954256">error</span>&nbsp;<span class="op" id="4954262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4954265">if</span>&nbsp;<span class="ident" id="4954268">priv</span><span class="op" id="4954272">.</span><span class="ident" id="4954273">P</span>&nbsp;<span class="op" id="4954275">==</span>&nbsp;<span class="ident" id="4954278">nil</span>&nbsp;<span class="op" id="4954282">||</span>&nbsp;<span class="ident" id="4954285">priv</span><span class="op" id="4954289">.</span><span class="ident" id="4954290">Q</span>&nbsp;<span class="op" id="4954292">==</span>&nbsp;<span class="ident" id="4954295">nil</span>&nbsp;<span class="op" id="4954299">||</span>&nbsp;<span class="ident" id="4954302">priv</span><span class="op" id="4954306">.</span><span class="ident" id="4954307">G</span>&nbsp;<span class="op" id="4954309">==</span>&nbsp;<span class="ident" id="4954312">nil</span>&nbsp;<span class="op" id="4954316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4954320">return</span>&nbsp;<span class="ident" id="4954327">errors</span><span class="op" id="4954333">.</span><span class="ident" id="4954334">New</span><span class="op" id="4954337">(</span><span class="string" id="4954338">&#34;crypto/dsa:&nbsp;parameters&nbsp;not&nbsp;set&nbsp;up&nbsp;before&nbsp;generating&nbsp;key&#34;</span><span class="op" id="4954395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4954398">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4954402">x</span>&nbsp;<span class="op" id="4954404">:=</span>&nbsp;<span class="builtinfunc" id="4954407">new</span><span class="op" id="4954410">(</span><span class="ident" id="4954411">big</span><span class="op" id="4954414">.</span><span class="ident" id="4954415">Int</span><span class="op" id="4954418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4954421">xBytes</span>&nbsp;<span class="op" id="4954428">:=</span>&nbsp;<span class="builtinfunc" id="4954431">make</span><span class="op" id="4954435">(</span><span class="op" id="4954436">[</span><span class="op" id="4954437">]</span><span class="builtintype" id="4954438">byte</span><span class="op" id="4954442">,</span>&nbsp;<span class="ident" id="4954444">priv</span><span class="op" id="4954448">.</span><span class="ident" id="4954449">Q</span><span class="op" id="4954450">.</span><span class="ident" id="4954451">BitLen</span><span class="op" id="4954457">(</span><span class="op" id="4954458">)</span><span class="op" id="4954459">/</span><span class="num" id="4954460">8</span><span class="op" id="4954461">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4954465">for</span>&nbsp;<span class="op" id="4954469">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4954473">_</span><span class="op" id="4954474">,</span>&nbsp;<span class="ident" id="4954476">err</span>&nbsp;<span class="op" id="4954480">:=</span>&nbsp;<span class="ident" id="4954483">io</span><span class="op" id="4954485">.</span><span class="ident" id="4954486">ReadFull</span><span class="op" id="4954494">(</span><span class="ident" id="4954495">rand</span><span class="op" id="4954499">,</span>&nbsp;<span class="ident" id="4954501">xBytes</span><span class="op" id="4954507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4954511">if</span>&nbsp;<span class="ident" id="4954514">err</span>&nbsp;<span class="op" id="4954518">!=</span>&nbsp;<span class="ident" id="4954521">nil</span>&nbsp;<span class="op" id="4954525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4954530">return</span>&nbsp;<span class="ident" id="4954537">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4954543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4954547">x</span><span class="op" id="4954548">.</span><span class="ident" id="4954549">SetBytes</span><span class="op" id="4954557">(</span><span class="ident" id="4954558">xBytes</span><span class="op" id="4954564">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4954568">if</span>&nbsp;<span class="ident" id="4954571">x</span><span class="op" id="4954572">.</span><span class="ident" id="4954573">Sign</span><span class="op" id="4954577">(</span><span class="op" id="4954578">)</span>&nbsp;<span class="op" id="4954580">!=</span>&nbsp;<span class="num" id="4954583">0</span>&nbsp;<span class="op" id="4954585">&amp;&amp;</span>&nbsp;<span class="ident" id="4954588">x</span><span class="op" id="4954589">.</span><span class="ident" id="4954590">Cmp</span><span class="op" id="4954593">(</span><span class="ident" id="4954594">priv</span><span class="op" id="4954598">.</span><span class="ident" id="4954599">Q</span><span class="op" id="4954600">)</span>&nbsp;<span class="op" id="4954602">&lt;</span>&nbsp;<span class="num" id="4954604">0</span>&nbsp;<span class="op" id="4954606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4954611">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4954619">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4954622">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4954626">priv</span><span class="op" id="4954630">.</span><span class="ident" id="4954631">X</span>&nbsp;<span class="op" id="4954633">=</span>&nbsp;<span class="ident" id="4954635">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4954638">priv</span><span class="op" id="4954642">.</span><span class="ident" id="4954643">Y</span>&nbsp;<span class="op" id="4954645">=</span>&nbsp;<span class="builtinfunc" id="4954647">new</span><span class="op" id="4954650">(</span><span class="ident" id="4954651">big</span><span class="op" id="4954654">.</span><span class="ident" id="4954655">Int</span><span class="op" id="4954658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4954661">priv</span><span class="op" id="4954665">.</span><span class="ident" id="4954666">Y</span><span class="op" id="4954667">.</span><span class="ident" id="4954668">Exp</span><span class="op" id="4954671">(</span><span class="ident" id="4954672">priv</span><span class="op" id="4954676">.</span><span class="ident" id="4954677">G</span><span class="op" id="4954678">,</span>&nbsp;<span class="ident" id="4954680">x</span><span class="op" id="4954681">,</span>&nbsp;<span class="ident" id="4954683">priv</span><span class="op" id="4954687">.</span><span class="ident" id="4954688">P</span><span class="op" id="4954689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4954692">return</span>&nbsp;<span class="ident" id="4954699">nil</span><br>
<span class="lineno"></span><span class="op" id="4954703">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="comment" id="4954706">//&nbsp;fermatInverse&nbsp;calculates&nbsp;the&nbsp;inverse&nbsp;of&nbsp;k&nbsp;in&nbsp;GF(P)&nbsp;using&nbsp;Fermat&#39;s&nbsp;method.</span><br>
<span class="lineno"></span><span class="comment" id="4954783">//&nbsp;This&nbsp;has&nbsp;better&nbsp;constant-time&nbsp;properties&nbsp;than&nbsp;Euclid&#39;s&nbsp;method&nbsp;(implemented</span><br>
<span class="lineno"></span><span class="comment" id="4954861">//&nbsp;in&nbsp;math/big.Int.ModInverse)&nbsp;although&nbsp;math/big&nbsp;itself&nbsp;isn&#39;t&nbsp;strictly</span><br>
<span class="lineno"></span><span class="comment" id="4954932">//&nbsp;constant-time&nbsp;so&nbsp;it&#39;s&nbsp;not&nbsp;perfect.</span><br>
<span class="lineno">180</span><span class="keyword" id="4954970">func</span>&nbsp;<span class="ident" id="4954975">fermatInverse</span><span class="op" id="4954988">(</span><span class="ident" id="4954989">k</span><span class="op" id="4954990">,</span>&nbsp;<span class="ident" id="4954992">P</span>&nbsp;<span class="op" id="4954994">*</span><span class="ident" id="4954995">big</span><span class="op" id="4954998">.</span><span class="ident" id="4954999">Int</span><span class="op" id="4955002">)</span>&nbsp;<span class="op" id="4955004">*</span><span class="ident" id="4955005">big</span><span class="op" id="4955008">.</span><span class="ident" id="4955009">Int</span>&nbsp;<span class="op" id="4955013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4955016">two</span>&nbsp;<span class="op" id="4955020">:=</span>&nbsp;<span class="ident" id="4955023">big</span><span class="op" id="4955026">.</span><span class="ident" id="4955027">NewInt</span><span class="op" id="4955033">(</span><span class="num" id="4955034">2</span><span class="op" id="4955035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4955038">pMinus2</span>&nbsp;<span class="op" id="4955046">:=</span>&nbsp;<span class="builtinfunc" id="4955049">new</span><span class="op" id="4955052">(</span><span class="ident" id="4955053">big</span><span class="op" id="4955056">.</span><span class="ident" id="4955057">Int</span><span class="op" id="4955060">)</span><span class="op" id="4955061">.</span><span class="ident" id="4955062">Sub</span><span class="op" id="4955065">(</span><span class="ident" id="4955066">P</span><span class="op" id="4955067">,</span>&nbsp;<span class="ident" id="4955069">two</span><span class="op" id="4955072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4955075">return</span>&nbsp;<span class="builtinfunc" id="4955082">new</span><span class="op" id="4955085">(</span><span class="ident" id="4955086">big</span><span class="op" id="4955089">.</span><span class="ident" id="4955090">Int</span><span class="op" id="4955093">)</span><span class="op" id="4955094">.</span><span class="ident" id="4955095">Exp</span><span class="op" id="4955098">(</span><span class="ident" id="4955099">k</span><span class="op" id="4955100">,</span>&nbsp;<span class="ident" id="4955102">pMinus2</span><span class="op" id="4955109">,</span>&nbsp;<span class="ident" id="4955111">P</span><span class="op" id="4955112">)</span><br>
<span class="lineno"></span><span class="op" id="4955114">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span><span class="comment" id="4955117">//&nbsp;Sign&nbsp;signs&nbsp;an&nbsp;arbitrary&nbsp;length&nbsp;hash&nbsp;(which&nbsp;should&nbsp;be&nbsp;the&nbsp;result&nbsp;of&nbsp;hashing&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4955197">//&nbsp;larger&nbsp;message)&nbsp;using&nbsp;the&nbsp;private&nbsp;key,&nbsp;priv.&nbsp;It&nbsp;returns&nbsp;the&nbsp;signature&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4955275">//&nbsp;pair&nbsp;of&nbsp;integers.&nbsp;The&nbsp;security&nbsp;of&nbsp;the&nbsp;private&nbsp;key&nbsp;depends&nbsp;on&nbsp;the&nbsp;entropy&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4955354">//&nbsp;rand.</span><br>
<span class="lineno">190</span><span class="comment" id="4955363">//</span><br>
<span class="lineno"></span><span class="comment" id="4955366">//&nbsp;Note&nbsp;that&nbsp;FIPS&nbsp;186-3&nbsp;section&nbsp;4.6&nbsp;specifies&nbsp;that&nbsp;the&nbsp;hash&nbsp;should&nbsp;be&nbsp;truncated</span><br>
<span class="lineno"></span><span class="comment" id="4955446">//&nbsp;to&nbsp;the&nbsp;byte-length&nbsp;of&nbsp;the&nbsp;subgroup.&nbsp;This&nbsp;function&nbsp;does&nbsp;not&nbsp;perform&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4955521">//&nbsp;truncation&nbsp;itself.</span><br>
<span class="lineno"></span><span class="keyword" id="4955543">func</span>&nbsp;<span class="ident" id="4955548">Sign</span><span class="op" id="4955552">(</span><span class="ident" id="4955553">rand</span>&nbsp;<span class="ident" id="4955558">io</span><span class="op" id="4955560">.</span><span class="ident" id="4955561">Reader</span><span class="op" id="4955567">,</span>&nbsp;<span class="ident" id="4955569">priv</span>&nbsp;<span class="op" id="4955574">*</span><span class="ident" id="4955575">PrivateKey</span><span class="op" id="4955585">,</span>&nbsp;<span class="ident" id="4955587">hash</span>&nbsp;<span class="op" id="4955592">[</span><span class="op" id="4955593">]</span><span class="builtintype" id="4955594">byte</span><span class="op" id="4955598">)</span>&nbsp;<span class="op" id="4955600">(</span><span class="ident" id="4955601">r</span><span class="op" id="4955602">,</span>&nbsp;<span class="ident" id="4955604">s</span>&nbsp;<span class="op" id="4955606">*</span><span class="ident" id="4955607">big</span><span class="op" id="4955610">.</span><span class="ident" id="4955611">Int</span><span class="op" id="4955614">,</span>&nbsp;<span class="ident" id="4955616">err</span>&nbsp;<span class="builtintype" id="4955620">error</span><span class="op" id="4955625">)</span>&nbsp;<span class="op" id="4955627">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4955630">//&nbsp;FIPS&nbsp;186-3,&nbsp;section&nbsp;4.6</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4955659">n</span>&nbsp;<span class="op" id="4955661">:=</span>&nbsp;<span class="ident" id="4955664">priv</span><span class="op" id="4955668">.</span><span class="ident" id="4955669">Q</span><span class="op" id="4955670">.</span><span class="ident" id="4955671">BitLen</span><span class="op" id="4955677">(</span><span class="op" id="4955678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4955681">if</span>&nbsp;<span class="ident" id="4955684">n</span><span class="op" id="4955685">&amp;</span><span class="num" id="4955686">7</span>&nbsp;<span class="op" id="4955688">!=</span>&nbsp;<span class="num" id="4955691">0</span>&nbsp;<span class="op" id="4955693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4955697">err</span>&nbsp;<span class="op" id="4955701">=</span>&nbsp;<span class="ident" id="4955703">ErrInvalidPublicKey</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4955725">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4955733">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4955736">n</span>&nbsp;<span class="op" id="4955738">&gt;&gt;=</span>&nbsp;<span class="num" id="4955742">3</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4955746">for</span>&nbsp;<span class="op" id="4955750">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4955754">k</span>&nbsp;<span class="op" id="4955756">:=</span>&nbsp;<span class="builtinfunc" id="4955759">new</span><span class="op" id="4955762">(</span><span class="ident" id="4955763">big</span><span class="op" id="4955766">.</span><span class="ident" id="4955767">Int</span><span class="op" id="4955770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4955774">buf</span>&nbsp;<span class="op" id="4955778">:=</span>&nbsp;<span class="builtinfunc" id="4955781">make</span><span class="op" id="4955785">(</span><span class="op" id="4955786">[</span><span class="op" id="4955787">]</span><span class="builtintype" id="4955788">byte</span><span class="op" id="4955792">,</span>&nbsp;<span class="ident" id="4955794">n</span><span class="op" id="4955795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4955799">for</span>&nbsp;<span class="op" id="4955803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4955808">_</span><span class="op" id="4955809">,</span>&nbsp;<span class="ident" id="4955811">err</span>&nbsp;<span class="op" id="4955815">=</span>&nbsp;<span class="ident" id="4955817">io</span><span class="op" id="4955819">.</span><span class="ident" id="4955820">ReadFull</span><span class="op" id="4955828">(</span><span class="ident" id="4955829">rand</span><span class="op" id="4955833">,</span>&nbsp;<span class="ident" id="4955835">buf</span><span class="op" id="4955838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4955843">if</span>&nbsp;<span class="ident" id="4955846">err</span>&nbsp;<span class="op" id="4955850">!=</span>&nbsp;<span class="ident" id="4955853">nil</span>&nbsp;<span class="op" id="4955857">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4955863">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4955873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4955878">k</span><span class="op" id="4955879">.</span><span class="ident" id="4955880">SetBytes</span><span class="op" id="4955888">(</span><span class="ident" id="4955889">buf</span><span class="op" id="4955892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4955897">if</span>&nbsp;<span class="ident" id="4955900">k</span><span class="op" id="4955901">.</span><span class="ident" id="4955902">Sign</span><span class="op" id="4955906">(</span><span class="op" id="4955907">)</span>&nbsp;<span class="op" id="4955909">&gt;</span>&nbsp;<span class="num" id="4955911">0</span>&nbsp;<span class="op" id="4955913">&amp;&amp;</span>&nbsp;<span class="ident" id="4955916">k</span><span class="op" id="4955917">.</span><span class="ident" id="4955918">Cmp</span><span class="op" id="4955921">(</span><span class="ident" id="4955922">priv</span><span class="op" id="4955926">.</span><span class="ident" id="4955927">Q</span><span class="op" id="4955928">)</span>&nbsp;<span class="op" id="4955930">&lt;</span>&nbsp;<span class="num" id="4955932">0</span>&nbsp;<span class="op" id="4955934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4955940">break</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4955949">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4955953">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4955958">kInv</span>&nbsp;<span class="op" id="4955963">:=</span>&nbsp;<span class="ident" id="4955966">fermatInverse</span><span class="op" id="4955979">(</span><span class="ident" id="4955980">k</span><span class="op" id="4955981">,</span>&nbsp;<span class="ident" id="4955983">priv</span><span class="op" id="4955987">.</span><span class="ident" id="4955988">Q</span><span class="op" id="4955989">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4955994">r</span>&nbsp;<span class="op" id="4955996">=</span>&nbsp;<span class="builtinfunc" id="4955998">new</span><span class="op" id="4956001">(</span><span class="ident" id="4956002">big</span><span class="op" id="4956005">.</span><span class="ident" id="4956006">Int</span><span class="op" id="4956009">)</span><span class="op" id="4956010">.</span><span class="ident" id="4956011">Exp</span><span class="op" id="4956014">(</span><span class="ident" id="4956015">priv</span><span class="op" id="4956019">.</span><span class="ident" id="4956020">G</span><span class="op" id="4956021">,</span>&nbsp;<span class="ident" id="4956023">k</span><span class="op" id="4956024">,</span>&nbsp;<span class="ident" id="4956026">priv</span><span class="op" id="4956030">.</span><span class="ident" id="4956031">P</span><span class="op" id="4956032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4956036">r</span><span class="op" id="4956037">.</span><span class="ident" id="4956038">Mod</span><span class="op" id="4956041">(</span><span class="ident" id="4956042">r</span><span class="op" id="4956043">,</span>&nbsp;<span class="ident" id="4956045">priv</span><span class="op" id="4956049">.</span><span class="ident" id="4956050">Q</span><span class="op" id="4956051">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4956056">if</span>&nbsp;<span class="ident" id="4956059">r</span><span class="op" id="4956060">.</span><span class="ident" id="4956061">Sign</span><span class="op" id="4956065">(</span><span class="op" id="4956066">)</span>&nbsp;<span class="op" id="4956068">==</span>&nbsp;<span class="num" id="4956071">0</span>&nbsp;<span class="op" id="4956073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4956078">continue</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4956089">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4956094">z</span>&nbsp;<span class="op" id="4956096">:=</span>&nbsp;<span class="ident" id="4956099">k</span><span class="op" id="4956100">.</span><span class="ident" id="4956101">SetBytes</span><span class="op" id="4956109">(</span><span class="ident" id="4956110">hash</span><span class="op" id="4956114">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4956119">s</span>&nbsp;<span class="op" id="4956121">=</span>&nbsp;<span class="builtinfunc" id="4956123">new</span><span class="op" id="4956126">(</span><span class="ident" id="4956127">big</span><span class="op" id="4956130">.</span><span class="ident" id="4956131">Int</span><span class="op" id="4956134">)</span><span class="op" id="4956135">.</span><span class="ident" id="4956136">Mul</span><span class="op" id="4956139">(</span><span class="ident" id="4956140">priv</span><span class="op" id="4956144">.</span><span class="ident" id="4956145">X</span><span class="op" id="4956146">,</span>&nbsp;<span class="ident" id="4956148">r</span><span class="op" id="4956149">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4956153">s</span><span class="op" id="4956154">.</span><span class="ident" id="4956155">Add</span><span class="op" id="4956158">(</span><span class="ident" id="4956159">s</span><span class="op" id="4956160">,</span>&nbsp;<span class="ident" id="4956162">z</span><span class="op" id="4956163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4956167">s</span><span class="op" id="4956168">.</span><span class="ident" id="4956169">Mod</span><span class="op" id="4956172">(</span><span class="ident" id="4956173">s</span><span class="op" id="4956174">,</span>&nbsp;<span class="ident" id="4956176">priv</span><span class="op" id="4956180">.</span><span class="ident" id="4956181">Q</span><span class="op" id="4956182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4956186">s</span><span class="op" id="4956187">.</span><span class="ident" id="4956188">Mul</span><span class="op" id="4956191">(</span><span class="ident" id="4956192">s</span><span class="op" id="4956193">,</span>&nbsp;<span class="ident" id="4956195">kInv</span><span class="op" id="4956199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4956203">s</span><span class="op" id="4956204">.</span><span class="ident" id="4956205">Mod</span><span class="op" id="4956208">(</span><span class="ident" id="4956209">s</span><span class="op" id="4956210">,</span>&nbsp;<span class="ident" id="4956212">priv</span><span class="op" id="4956216">.</span><span class="ident" id="4956217">Q</span><span class="op" id="4956218">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4956223">if</span>&nbsp;<span class="ident" id="4956226">s</span><span class="op" id="4956227">.</span><span class="ident" id="4956228">Sign</span><span class="op" id="4956232">(</span><span class="op" id="4956233">)</span>&nbsp;<span class="op" id="4956235">!=</span>&nbsp;<span class="num" id="4956238">0</span>&nbsp;<span class="op" id="4956240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4956245">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4956253">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4956256">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4956260">return</span><br>
<span class="lineno"></span><span class="op" id="4956267">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4956270">//&nbsp;Verify&nbsp;verifies&nbsp;the&nbsp;signature&nbsp;in&nbsp;r,&nbsp;s&nbsp;of&nbsp;hash&nbsp;using&nbsp;the&nbsp;public&nbsp;key,&nbsp;pub.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="4956349">//&nbsp;reports&nbsp;whether&nbsp;the&nbsp;signature&nbsp;is&nbsp;valid.</span><br>
<span class="lineno">245</span><span class="comment" id="4956392">//</span><br>
<span class="lineno"></span><span class="comment" id="4956395">//&nbsp;Note&nbsp;that&nbsp;FIPS&nbsp;186-3&nbsp;section&nbsp;4.6&nbsp;specifies&nbsp;that&nbsp;the&nbsp;hash&nbsp;should&nbsp;be&nbsp;truncated</span><br>
<span class="lineno"></span><span class="comment" id="4956475">//&nbsp;to&nbsp;the&nbsp;byte-length&nbsp;of&nbsp;the&nbsp;subgroup.&nbsp;This&nbsp;function&nbsp;does&nbsp;not&nbsp;perform&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4956550">//&nbsp;truncation&nbsp;itself.</span><br>
<span class="lineno"></span><span class="keyword" id="4956572">func</span>&nbsp;<span class="ident" id="4956577">Verify</span><span class="op" id="4956583">(</span><span class="ident" id="4956584">pub</span>&nbsp;<span class="op" id="4956588">*</span><span class="ident" id="4956589">PublicKey</span><span class="op" id="4956598">,</span>&nbsp;<span class="ident" id="4956600">hash</span>&nbsp;<span class="op" id="4956605">[</span><span class="op" id="4956606">]</span><span class="builtintype" id="4956607">byte</span><span class="op" id="4956611">,</span>&nbsp;<span class="ident" id="4956613">r</span><span class="op" id="4956614">,</span>&nbsp;<span class="ident" id="4956616">s</span>&nbsp;<span class="op" id="4956618">*</span><span class="ident" id="4956619">big</span><span class="op" id="4956622">.</span><span class="ident" id="4956623">Int</span><span class="op" id="4956626">)</span>&nbsp;<span class="builtintype" id="4956628">bool</span>&nbsp;<span class="op" id="4956633">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4956636">//&nbsp;FIPS&nbsp;186-3,&nbsp;section&nbsp;4.7</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4956665">if</span>&nbsp;<span class="ident" id="4956668">r</span><span class="op" id="4956669">.</span><span class="ident" id="4956670">Sign</span><span class="op" id="4956674">(</span><span class="op" id="4956675">)</span>&nbsp;<span class="op" id="4956677">&lt;</span>&nbsp;<span class="num" id="4956679">1</span>&nbsp;<span class="op" id="4956681">||</span>&nbsp;<span class="ident" id="4956684">r</span><span class="op" id="4956685">.</span><span class="ident" id="4956686">Cmp</span><span class="op" id="4956689">(</span><span class="ident" id="4956690">pub</span><span class="op" id="4956693">.</span><span class="ident" id="4956694">Q</span><span class="op" id="4956695">)</span>&nbsp;<span class="op" id="4956697">&gt;=</span>&nbsp;<span class="num" id="4956700">0</span>&nbsp;<span class="op" id="4956702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4956706">return</span>&nbsp;<span class="builtintype" id="4956713">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4956720">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4956723">if</span>&nbsp;<span class="ident" id="4956726">s</span><span class="op" id="4956727">.</span><span class="ident" id="4956728">Sign</span><span class="op" id="4956732">(</span><span class="op" id="4956733">)</span>&nbsp;<span class="op" id="4956735">&lt;</span>&nbsp;<span class="num" id="4956737">1</span>&nbsp;<span class="op" id="4956739">||</span>&nbsp;<span class="ident" id="4956742">s</span><span class="op" id="4956743">.</span><span class="ident" id="4956744">Cmp</span><span class="op" id="4956747">(</span><span class="ident" id="4956748">pub</span><span class="op" id="4956751">.</span><span class="ident" id="4956752">Q</span><span class="op" id="4956753">)</span>&nbsp;<span class="op" id="4956755">&gt;=</span>&nbsp;<span class="num" id="4956758">0</span>&nbsp;<span class="op" id="4956760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4956764">return</span>&nbsp;<span class="builtintype" id="4956771">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4956778">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4956782">w</span>&nbsp;<span class="op" id="4956784">:=</span>&nbsp;<span class="builtinfunc" id="4956787">new</span><span class="op" id="4956790">(</span><span class="ident" id="4956791">big</span><span class="op" id="4956794">.</span><span class="ident" id="4956795">Int</span><span class="op" id="4956798">)</span><span class="op" id="4956799">.</span><span class="ident" id="4956800">ModInverse</span><span class="op" id="4956810">(</span><span class="ident" id="4956811">s</span><span class="op" id="4956812">,</span>&nbsp;<span class="ident" id="4956814">pub</span><span class="op" id="4956817">.</span><span class="ident" id="4956818">Q</span><span class="op" id="4956819">)</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4956823">n</span>&nbsp;<span class="op" id="4956825">:=</span>&nbsp;<span class="ident" id="4956828">pub</span><span class="op" id="4956831">.</span><span class="ident" id="4956832">Q</span><span class="op" id="4956833">.</span><span class="ident" id="4956834">BitLen</span><span class="op" id="4956840">(</span><span class="op" id="4956841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4956844">if</span>&nbsp;<span class="ident" id="4956847">n</span><span class="op" id="4956848">&amp;</span><span class="num" id="4956849">7</span>&nbsp;<span class="op" id="4956851">!=</span>&nbsp;<span class="num" id="4956854">0</span>&nbsp;<span class="op" id="4956856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4956860">return</span>&nbsp;<span class="builtintype" id="4956867">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4956874">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4956877">z</span>&nbsp;<span class="op" id="4956879">:=</span>&nbsp;<span class="builtinfunc" id="4956882">new</span><span class="op" id="4956885">(</span><span class="ident" id="4956886">big</span><span class="op" id="4956889">.</span><span class="ident" id="4956890">Int</span><span class="op" id="4956893">)</span><span class="op" id="4956894">.</span><span class="ident" id="4956895">SetBytes</span><span class="op" id="4956903">(</span><span class="ident" id="4956904">hash</span><span class="op" id="4956908">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4956912">u1</span>&nbsp;<span class="op" id="4956915">:=</span>&nbsp;<span class="builtinfunc" id="4956918">new</span><span class="op" id="4956921">(</span><span class="ident" id="4956922">big</span><span class="op" id="4956925">.</span><span class="ident" id="4956926">Int</span><span class="op" id="4956929">)</span><span class="op" id="4956930">.</span><span class="ident" id="4956931">Mul</span><span class="op" id="4956934">(</span><span class="ident" id="4956935">z</span><span class="op" id="4956936">,</span>&nbsp;<span class="ident" id="4956938">w</span><span class="op" id="4956939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4956942">u1</span><span class="op" id="4956944">.</span><span class="ident" id="4956945">Mod</span><span class="op" id="4956948">(</span><span class="ident" id="4956949">u1</span><span class="op" id="4956951">,</span>&nbsp;<span class="ident" id="4956953">pub</span><span class="op" id="4956956">.</span><span class="ident" id="4956957">Q</span><span class="op" id="4956958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4956961">u2</span>&nbsp;<span class="op" id="4956964">:=</span>&nbsp;<span class="ident" id="4956967">w</span><span class="op" id="4956968">.</span><span class="ident" id="4956969">Mul</span><span class="op" id="4956972">(</span><span class="ident" id="4956973">r</span><span class="op" id="4956974">,</span>&nbsp;<span class="ident" id="4956976">w</span><span class="op" id="4956977">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4956980">u2</span><span class="op" id="4956982">.</span><span class="ident" id="4956983">Mod</span><span class="op" id="4956986">(</span><span class="ident" id="4956987">u2</span><span class="op" id="4956989">,</span>&nbsp;<span class="ident" id="4956991">pub</span><span class="op" id="4956994">.</span><span class="ident" id="4956995">Q</span><span class="op" id="4956996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4956999">v</span>&nbsp;<span class="op" id="4957001">:=</span>&nbsp;<span class="ident" id="4957004">u1</span><span class="op" id="4957006">.</span><span class="ident" id="4957007">Exp</span><span class="op" id="4957010">(</span><span class="ident" id="4957011">pub</span><span class="op" id="4957014">.</span><span class="ident" id="4957015">G</span><span class="op" id="4957016">,</span>&nbsp;<span class="ident" id="4957018">u1</span><span class="op" id="4957020">,</span>&nbsp;<span class="ident" id="4957022">pub</span><span class="op" id="4957025">.</span><span class="ident" id="4957026">P</span><span class="op" id="4957027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4957030">u2</span><span class="op" id="4957032">.</span><span class="ident" id="4957033">Exp</span><span class="op" id="4957036">(</span><span class="ident" id="4957037">pub</span><span class="op" id="4957040">.</span><span class="ident" id="4957041">Y</span><span class="op" id="4957042">,</span>&nbsp;<span class="ident" id="4957044">u2</span><span class="op" id="4957046">,</span>&nbsp;<span class="ident" id="4957048">pub</span><span class="op" id="4957051">.</span><span class="ident" id="4957052">P</span><span class="op" id="4957053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4957056">v</span><span class="op" id="4957057">.</span><span class="ident" id="4957058">Mul</span><span class="op" id="4957061">(</span><span class="ident" id="4957062">v</span><span class="op" id="4957063">,</span>&nbsp;<span class="ident" id="4957065">u2</span><span class="op" id="4957067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4957070">v</span><span class="op" id="4957071">.</span><span class="ident" id="4957072">Mod</span><span class="op" id="4957075">(</span><span class="ident" id="4957076">v</span><span class="op" id="4957077">,</span>&nbsp;<span class="ident" id="4957079">pub</span><span class="op" id="4957082">.</span><span class="ident" id="4957083">P</span><span class="op" id="4957084">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4957087">v</span><span class="op" id="4957088">.</span><span class="ident" id="4957089">Mod</span><span class="op" id="4957092">(</span><span class="ident" id="4957093">v</span><span class="op" id="4957094">,</span>&nbsp;<span class="ident" id="4957096">pub</span><span class="op" id="4957099">.</span><span class="ident" id="4957100">Q</span><span class="op" id="4957101">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4957105">return</span>&nbsp;<span class="ident" id="4957112">v</span><span class="op" id="4957113">.</span><span class="ident" id="4957114">Cmp</span><span class="op" id="4957117">(</span><span class="ident" id="4957118">r</span><span class="op" id="4957119">)</span>&nbsp;<span class="op" id="4957121">==</span>&nbsp;<span class="num" id="4957124">0</span><br>
<span class="lineno"></span><span class="op" id="4957126">}</span>
</div>
</body>
</html>
