<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3460731">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3460787">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3460841">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3460892">//&nbsp;+build&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3460932">package</span>&nbsp;<span class="ident" id="3460940">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3460945">import</span>&nbsp;<span class="op" id="3460952">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3460955">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3460961">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3460972">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3460979">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="3460982">func</span>&nbsp;<span class="ident" id="3460987">setKeepAlivePeriod</span><span class="op" id="3461005">(</span><span class="ident" id="3461006">fd</span>&nbsp;<span class="op" id="3461009">*</span><span class="ident" id="3461010">netFD</span><span class="op" id="3461015">,</span>&nbsp;<span class="ident" id="3461017">d</span>&nbsp;<span class="ident" id="3461019">time</span><span class="op" id="3461023">.</span><span class="ident" id="3461024">Duration</span><span class="op" id="3461032">)</span>&nbsp;<span class="builtintype" id="3461034">error</span>&nbsp;<span class="op" id="3461040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3461043">if</span>&nbsp;<span class="ident" id="3461046">err</span>&nbsp;<span class="op" id="3461050">:=</span>&nbsp;<span class="ident" id="3461053">fd</span><span class="op" id="3461055">.</span><span class="ident" id="3461056">incref</span><span class="op" id="3461062">(</span><span class="op" id="3461063">)</span><span class="op" id="3461064">;</span>&nbsp;<span class="ident" id="3461066">err</span>&nbsp;<span class="op" id="3461070">!=</span>&nbsp;<span class="ident" id="3461073">nil</span>&nbsp;<span class="op" id="3461077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3461081">return</span>&nbsp;<span class="ident" id="3461088">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3461093">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3461096">defer</span>&nbsp;<span class="ident" id="3461102">fd</span><span class="op" id="3461104">.</span><span class="ident" id="3461105">decref</span><span class="op" id="3461111">(</span><span class="op" id="3461112">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3461115">//&nbsp;The&nbsp;kernel&nbsp;expects&nbsp;seconds&nbsp;so&nbsp;round&nbsp;to&nbsp;next&nbsp;highest&nbsp;second.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3461179">d</span>&nbsp;<span class="op" id="3461181">+=</span>&nbsp;<span class="op" id="3461184">(</span><span class="ident" id="3461185">time</span><span class="op" id="3461189">.</span><span class="ident" id="3461190">Second</span>&nbsp;<span class="op" id="3461197">-</span>&nbsp;<span class="ident" id="3461199">time</span><span class="op" id="3461203">.</span><span class="ident" id="3461204">Nanosecond</span><span class="op" id="3461214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3461217">secs</span>&nbsp;<span class="op" id="3461222">:=</span>&nbsp;<span class="builtintype" id="3461225">int</span><span class="op" id="3461228">(</span><span class="ident" id="3461229">d</span><span class="op" id="3461230">.</span><span class="ident" id="3461231">Seconds</span><span class="op" id="3461238">(</span><span class="op" id="3461239">)</span><span class="op" id="3461240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3461243">if</span>&nbsp;<span class="ident" id="3461246">err</span>&nbsp;<span class="op" id="3461250">:=</span>&nbsp;<span class="ident" id="3461253">syscall</span><span class="op" id="3461260">.</span><span class="ident" id="3461261">SetsockoptInt</span><span class="op" id="3461274">(</span><span class="ident" id="3461275">fd</span><span class="op" id="3461277">.</span><span class="ident" id="3461278">sysfd</span><span class="op" id="3461283">,</span>&nbsp;<span class="ident" id="3461285">syscall</span><span class="op" id="3461292">.</span><span class="ident" id="3461293">IPPROTO_TCP</span><span class="op" id="3461304">,</span>&nbsp;<span class="ident" id="3461306">syscall</span><span class="op" id="3461313">.</span><span class="ident" id="3461314">TCP_KEEPINTVL</span><span class="op" id="3461327">,</span>&nbsp;<span class="ident" id="3461329">secs</span><span class="op" id="3461333">)</span><span class="op" id="3461334">;</span>&nbsp;<span class="ident" id="3461336">err</span>&nbsp;<span class="op" id="3461340">!=</span>&nbsp;<span class="ident" id="3461343">nil</span>&nbsp;<span class="op" id="3461347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3461351">return</span>&nbsp;<span class="ident" id="3461358">os</span><span class="op" id="3461360">.</span><span class="ident" id="3461361">NewSyscallError</span><span class="op" id="3461376">(</span><span class="string" id="3461377">&#34;setsockopt&#34;</span><span class="op" id="3461389">,</span>&nbsp;<span class="ident" id="3461391">err</span><span class="op" id="3461394">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3461397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3461400">return</span>&nbsp;<span class="ident" id="3461407">os</span><span class="op" id="3461409">.</span><span class="ident" id="3461410">NewSyscallError</span><span class="op" id="3461425">(</span><span class="string" id="3461426">&#34;setsockopt&#34;</span><span class="op" id="3461438">,</span>&nbsp;<span class="ident" id="3461440">syscall</span><span class="op" id="3461447">.</span><span class="ident" id="3461448">SetsockoptInt</span><span class="op" id="3461461">(</span><span class="ident" id="3461462">fd</span><span class="op" id="3461464">.</span><span class="ident" id="3461465">sysfd</span><span class="op" id="3461470">,</span>&nbsp;<span class="ident" id="3461472">syscall</span><span class="op" id="3461479">.</span><span class="ident" id="3461480">IPPROTO_TCP</span><span class="op" id="3461491">,</span>&nbsp;<span class="ident" id="3461493">syscall</span><span class="op" id="3461500">.</span><span class="ident" id="3461501">TCP_KEEPIDLE</span><span class="op" id="3461513">,</span>&nbsp;<span class="ident" id="3461515">secs</span><span class="op" id="3461519">)</span><span class="op" id="3461520">)</span><br>
<span class="lineno"></span><span class="op" id="3461522">}</span>
</div>
</body>
</html>
