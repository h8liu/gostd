<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>syscall</h2>
<ul>
<li><a href="/gostd/syscall/creds_test.go.html">creds_test.go</a></li>
<li><a href="/gostd/syscall/env_unix.go.html">env_unix.go</a></li>
<li><a href="/gostd/syscall/exec_linux.go.html">exec_linux.go</a></li>
<li><a href="/gostd/syscall/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/syscall/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/syscall/flock.go.html">flock.go</a></li>
<li><a href="/gostd/syscall/lsf_linux.go.html">lsf_linux.go</a></li>
<li><a href="/gostd/syscall/mmap_unix_test.go.html">mmap_unix_test.go</a></li>
<li><a href="/gostd/syscall/netlink_linux.go.html">netlink_linux.go</a></li>
<li><a href="/gostd/syscall/race0.go.html">race0.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_linux.go.html">sockcmsg_linux.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_unix.go.html">sockcmsg_unix.go</a></li>
<li><a href="/gostd/syscall/str.go.html">str.go</a></li>
<li><a href="/gostd/syscall/syscall.go.html">syscall.go</a></li>
<li><a href="/gostd/syscall/syscall_linux.go.html">syscall_linux.go</a></li>
<li><a href="/gostd/syscall/syscall_linux_amd64.go.html">syscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/syscall_test.go.html">syscall_test.go</a></li>
<li><a href="/gostd/syscall/syscall_unix.go.html">syscall_unix.go</a></li>
<li><a href="/gostd/syscall/syscall_unix_test.go.html">syscall_unix_test.go</a></li>
<li><a href="/gostd/syscall/zerrors_linux_amd64.go.html">zerrors_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsyscall_linux_amd64.go.html">zsyscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsysnum_linux_amd64.go.html">zsysnum_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/ztypes_linux_amd64.go.html">ztypes_linux_amd64.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2388148">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2388204">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2388258">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2388309">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2388374">//&nbsp;Socket&nbsp;control&nbsp;messages</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2388402">package</span>&nbsp;<span class="ident" id="2388410">syscall</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="2388419">import</span>&nbsp;<span class="string" id="2388426">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2388436">//&nbsp;Round&nbsp;the&nbsp;length&nbsp;of&nbsp;a&nbsp;raw&nbsp;sockaddr&nbsp;up&nbsp;to&nbsp;align&nbsp;it&nbsp;properly.</span><br>
<span class="lineno"></span><span class="keyword" id="2388499">func</span>&nbsp;<span class="ident" id="2388504">cmsgAlignOf</span><span class="op" id="2388515">(</span><span class="ident" id="2388516">salen</span>&nbsp;<span class="builtintype" id="2388522">int</span><span class="op" id="2388525">)</span>&nbsp;<span class="builtintype" id="2388527">int</span>&nbsp;<span class="op" id="2388531">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2388534">salign</span>&nbsp;<span class="op" id="2388541">:=</span>&nbsp;<span class="ident" id="2388544">sizeofPtr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2388555">//&nbsp;NOTE:&nbsp;It&nbsp;seems&nbsp;like&nbsp;64-bit&nbsp;Darwin&nbsp;and&nbsp;DragonFly&nbsp;BSD&nbsp;kernels</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2388619">//&nbsp;still&nbsp;require&nbsp;32-bit&nbsp;aligned&nbsp;access&nbsp;to&nbsp;network&nbsp;subsystem.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2388681">if</span>&nbsp;<span class="ident" id="2388684">darwin64Bit</span>&nbsp;<span class="op" id="2388696">||</span>&nbsp;<span class="ident" id="2388699">dragonfly64Bit</span>&nbsp;<span class="op" id="2388714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2388718">salign</span>&nbsp;<span class="op" id="2388725">=</span>&nbsp;<span class="num" id="2388727">4</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2388730">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2388733">return</span>&nbsp;<span class="op" id="2388740">(</span><span class="ident" id="2388741">salen</span>&nbsp;<span class="op" id="2388747">+</span>&nbsp;<span class="ident" id="2388749">salign</span>&nbsp;<span class="op" id="2388756">-</span>&nbsp;<span class="num" id="2388758">1</span><span class="op" id="2388759">)</span>&nbsp;<span class="op" id="2388761">&amp;</span>&nbsp;<span class="op" id="2388763">^</span><span class="op" id="2388764">(</span><span class="ident" id="2388765">salign</span>&nbsp;<span class="op" id="2388772">-</span>&nbsp;<span class="num" id="2388774">1</span><span class="op" id="2388775">)</span><br>
<span class="lineno"></span><span class="op" id="2388777">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2388780">//&nbsp;CmsgLen&nbsp;returns&nbsp;the&nbsp;value&nbsp;to&nbsp;store&nbsp;in&nbsp;the&nbsp;Len&nbsp;field&nbsp;of&nbsp;the&nbsp;Cmsghdr</span><br>
<span class="lineno">25</span><span class="comment" id="2388850">//&nbsp;structure,&nbsp;taking&nbsp;into&nbsp;account&nbsp;any&nbsp;necessary&nbsp;alignment.</span><br>
<span class="lineno"></span><span class="keyword" id="2388909">func</span>&nbsp;<span class="ident" id="2388914">CmsgLen</span><span class="op" id="2388921">(</span><span class="ident" id="2388922">datalen</span>&nbsp;<span class="builtintype" id="2388930">int</span><span class="op" id="2388933">)</span>&nbsp;<span class="builtintype" id="2388935">int</span>&nbsp;<span class="op" id="2388939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2388942">return</span>&nbsp;<span class="ident" id="2388949">cmsgAlignOf</span><span class="op" id="2388960">(</span><span class="ident" id="2388961">SizeofCmsghdr</span><span class="op" id="2388974">)</span>&nbsp;<span class="op" id="2388976">+</span>&nbsp;<span class="ident" id="2388978">datalen</span><br>
<span class="lineno"></span><span class="op" id="2388986">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="2388989">//&nbsp;CmsgSpace&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;an&nbsp;ancillary&nbsp;element&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="2389056">//&nbsp;payload&nbsp;of&nbsp;the&nbsp;passed&nbsp;data&nbsp;length&nbsp;occupies.</span><br>
<span class="lineno"></span><span class="keyword" id="2389103">func</span>&nbsp;<span class="ident" id="2389108">CmsgSpace</span><span class="op" id="2389117">(</span><span class="ident" id="2389118">datalen</span>&nbsp;<span class="builtintype" id="2389126">int</span><span class="op" id="2389129">)</span>&nbsp;<span class="builtintype" id="2389131">int</span>&nbsp;<span class="op" id="2389135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2389138">return</span>&nbsp;<span class="ident" id="2389145">cmsgAlignOf</span><span class="op" id="2389156">(</span><span class="ident" id="2389157">SizeofCmsghdr</span><span class="op" id="2389170">)</span>&nbsp;<span class="op" id="2389172">+</span>&nbsp;<span class="ident" id="2389174">cmsgAlignOf</span><span class="op" id="2389185">(</span><span class="ident" id="2389186">datalen</span><span class="op" id="2389193">)</span><br>
<span class="lineno"></span><span class="op" id="2389195">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="2389198">func</span>&nbsp;<span class="ident" id="2389203">cmsgData</span><span class="op" id="2389211">(</span><span class="ident" id="2389212">h</span>&nbsp;<span class="op" id="2389214">*</span><span class="ident" id="2389215">Cmsghdr</span><span class="op" id="2389222">)</span>&nbsp;<span class="ident" id="2389224">unsafe</span><span class="op" id="2389230">.</span><span class="ident" id="2389231">Pointer</span>&nbsp;<span class="op" id="2389239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2389242">return</span>&nbsp;<span class="ident" id="2389249">unsafe</span><span class="op" id="2389255">.</span><span class="ident" id="2389256">Pointer</span><span class="op" id="2389263">(</span><span class="builtintype" id="2389264">uintptr</span><span class="op" id="2389271">(</span><span class="ident" id="2389272">unsafe</span><span class="op" id="2389278">.</span><span class="ident" id="2389279">Pointer</span><span class="op" id="2389286">(</span><span class="ident" id="2389287">h</span><span class="op" id="2389288">)</span><span class="op" id="2389289">)</span>&nbsp;<span class="op" id="2389291">+</span>&nbsp;<span class="builtintype" id="2389293">uintptr</span><span class="op" id="2389300">(</span><span class="ident" id="2389301">cmsgAlignOf</span><span class="op" id="2389312">(</span><span class="ident" id="2389313">SizeofCmsghdr</span><span class="op" id="2389326">)</span><span class="op" id="2389327">)</span><span class="op" id="2389328">)</span><br>
<span class="lineno"></span><span class="op" id="2389330">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="2389333">//&nbsp;SocketControlMessage&nbsp;represents&nbsp;a&nbsp;socket&nbsp;control&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="2389394">type</span>&nbsp;<span class="ident" id="2389399">SocketControlMessage</span>&nbsp;<span class="keyword" id="2389420">struct</span>&nbsp;<span class="op" id="2389427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2389430">Header</span>&nbsp;<span class="ident" id="2389437">Cmsghdr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2389446">Data</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2389453">[</span><span class="op" id="2389454">]</span><span class="builtintype" id="2389455">byte</span><br>
<span class="lineno"></span><span class="op" id="2389460">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="2389463">//&nbsp;ParseSocketControlMessage&nbsp;parses&nbsp;b&nbsp;as&nbsp;an&nbsp;array&nbsp;of&nbsp;socket&nbsp;control</span><br>
<span class="lineno"></span><span class="comment" id="2389531">//&nbsp;messages.</span><br>
<span class="lineno"></span><span class="keyword" id="2389544">func</span>&nbsp;<span class="ident" id="2389549">ParseSocketControlMessage</span><span class="op" id="2389574">(</span><span class="ident" id="2389575">b</span>&nbsp;<span class="op" id="2389577">[</span><span class="op" id="2389578">]</span><span class="builtintype" id="2389579">byte</span><span class="op" id="2389583">)</span>&nbsp;<span class="op" id="2389585">(</span><span class="op" id="2389586">[</span><span class="op" id="2389587">]</span><span class="ident" id="2389588">SocketControlMessage</span><span class="op" id="2389608">,</span>&nbsp;<span class="builtintype" id="2389610">error</span><span class="op" id="2389615">)</span>&nbsp;<span class="op" id="2389617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2389620">var</span>&nbsp;<span class="ident" id="2389624">msgs</span>&nbsp;<span class="op" id="2389629">[</span><span class="op" id="2389630">]</span><span class="ident" id="2389631">SocketControlMessage</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2389653">i</span>&nbsp;<span class="op" id="2389655">:=</span>&nbsp;<span class="num" id="2389658">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2389661">for</span>&nbsp;<span class="ident" id="2389665">i</span><span class="op" id="2389666">+</span><span class="ident" id="2389667">CmsgLen</span><span class="op" id="2389674">(</span><span class="num" id="2389675">0</span><span class="op" id="2389676">)</span>&nbsp;<span class="op" id="2389678">&lt;=</span>&nbsp;<span class="builtinfunc" id="2389681">len</span><span class="op" id="2389684">(</span><span class="ident" id="2389685">b</span><span class="op" id="2389686">)</span>&nbsp;<span class="op" id="2389688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2389692">h</span><span class="op" id="2389693">,</span>&nbsp;<span class="ident" id="2389695">dbuf</span><span class="op" id="2389699">,</span>&nbsp;<span class="ident" id="2389701">err</span>&nbsp;<span class="op" id="2389705">:=</span>&nbsp;<span class="ident" id="2389708">socketControlMessageHeaderAndData</span><span class="op" id="2389741">(</span><span class="ident" id="2389742">b</span><span class="op" id="2389743">[</span><span class="ident" id="2389744">i</span><span class="op" id="2389745">:</span><span class="op" id="2389746">]</span><span class="op" id="2389747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2389751">if</span>&nbsp;<span class="ident" id="2389754">err</span>&nbsp;<span class="op" id="2389758">!=</span>&nbsp;<span class="ident" id="2389761">nil</span>&nbsp;<span class="op" id="2389765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2389770">return</span>&nbsp;<span class="ident" id="2389777">nil</span><span class="op" id="2389780">,</span>&nbsp;<span class="ident" id="2389782">err</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2389788">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2389792">m</span>&nbsp;<span class="op" id="2389794">:=</span>&nbsp;<span class="ident" id="2389797">SocketControlMessage</span><span class="op" id="2389817">{</span><span class="ident" id="2389818">Header</span><span class="op" id="2389824">:</span>&nbsp;<span class="op" id="2389826">*</span><span class="ident" id="2389827">h</span><span class="op" id="2389828">,</span>&nbsp;<span class="ident" id="2389830">Data</span><span class="op" id="2389834">:</span>&nbsp;<span class="ident" id="2389836">dbuf</span><span class="op" id="2389840">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2389844">msgs</span>&nbsp;<span class="op" id="2389849">=</span>&nbsp;<span class="builtinfunc" id="2389851">append</span><span class="op" id="2389857">(</span><span class="ident" id="2389858">msgs</span><span class="op" id="2389862">,</span>&nbsp;<span class="ident" id="2389864">m</span><span class="op" id="2389865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2389869">i</span>&nbsp;<span class="op" id="2389871">+=</span>&nbsp;<span class="ident" id="2389874">cmsgAlignOf</span><span class="op" id="2389885">(</span><span class="builtintype" id="2389886">int</span><span class="op" id="2389889">(</span><span class="ident" id="2389890">h</span><span class="op" id="2389891">.</span><span class="ident" id="2389892">Len</span><span class="op" id="2389895">)</span><span class="op" id="2389896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2389899">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2389902">return</span>&nbsp;<span class="ident" id="2389909">msgs</span><span class="op" id="2389913">,</span>&nbsp;<span class="ident" id="2389915">nil</span><br>
<span class="lineno"></span><span class="op" id="2389919">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2389922">func</span>&nbsp;<span class="ident" id="2389927">socketControlMessageHeaderAndData</span><span class="op" id="2389960">(</span><span class="ident" id="2389961">b</span>&nbsp;<span class="op" id="2389963">[</span><span class="op" id="2389964">]</span><span class="builtintype" id="2389965">byte</span><span class="op" id="2389969">)</span>&nbsp;<span class="op" id="2389971">(</span><span class="op" id="2389972">*</span><span class="ident" id="2389973">Cmsghdr</span><span class="op" id="2389980">,</span>&nbsp;<span class="op" id="2389982">[</span><span class="op" id="2389983">]</span><span class="builtintype" id="2389984">byte</span><span class="op" id="2389988">,</span>&nbsp;<span class="builtintype" id="2389990">error</span><span class="op" id="2389995">)</span>&nbsp;<span class="op" id="2389997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2390000">h</span>&nbsp;<span class="op" id="2390002">:=</span>&nbsp;<span class="op" id="2390005">(</span><span class="op" id="2390006">*</span><span class="ident" id="2390007">Cmsghdr</span><span class="op" id="2390014">)</span><span class="op" id="2390015">(</span><span class="ident" id="2390016">unsafe</span><span class="op" id="2390022">.</span><span class="ident" id="2390023">Pointer</span><span class="op" id="2390030">(</span><span class="op" id="2390031">&amp;</span><span class="ident" id="2390032">b</span><span class="op" id="2390033">[</span><span class="num" id="2390034">0</span><span class="op" id="2390035">]</span><span class="op" id="2390036">)</span><span class="op" id="2390037">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2390040">if</span>&nbsp;<span class="ident" id="2390043">h</span><span class="op" id="2390044">.</span><span class="ident" id="2390045">Len</span>&nbsp;<span class="op" id="2390049">&lt;</span>&nbsp;<span class="ident" id="2390051">SizeofCmsghdr</span>&nbsp;<span class="op" id="2390065">||</span>&nbsp;<span class="builtintype" id="2390068">int</span><span class="op" id="2390071">(</span><span class="ident" id="2390072">h</span><span class="op" id="2390073">.</span><span class="ident" id="2390074">Len</span><span class="op" id="2390077">)</span>&nbsp;<span class="op" id="2390079">&gt;</span>&nbsp;<span class="builtinfunc" id="2390081">len</span><span class="op" id="2390084">(</span><span class="ident" id="2390085">b</span><span class="op" id="2390086">)</span>&nbsp;<span class="op" id="2390088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2390092">return</span>&nbsp;<span class="ident" id="2390099">nil</span><span class="op" id="2390102">,</span>&nbsp;<span class="ident" id="2390104">nil</span><span class="op" id="2390107">,</span>&nbsp;<span class="ident" id="2390109">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2390117">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2390120">return</span>&nbsp;<span class="ident" id="2390127">h</span><span class="op" id="2390128">,</span>&nbsp;<span class="ident" id="2390130">b</span><span class="op" id="2390131">[</span><span class="ident" id="2390132">cmsgAlignOf</span><span class="op" id="2390143">(</span><span class="ident" id="2390144">SizeofCmsghdr</span><span class="op" id="2390157">)</span><span class="op" id="2390158">:</span><span class="ident" id="2390159">h</span><span class="op" id="2390160">.</span><span class="ident" id="2390161">Len</span><span class="op" id="2390164">]</span><span class="op" id="2390165">,</span>&nbsp;<span class="ident" id="2390167">nil</span><br>
<span class="lineno"></span><span class="op" id="2390171">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="2390174">//&nbsp;UnixRights&nbsp;encodes&nbsp;a&nbsp;set&nbsp;of&nbsp;open&nbsp;file&nbsp;descriptors&nbsp;into&nbsp;a&nbsp;socket</span><br>
<span class="lineno"></span><span class="comment" id="2390241">//&nbsp;control&nbsp;message&nbsp;for&nbsp;sending&nbsp;to&nbsp;another&nbsp;process.</span><br>
<span class="lineno"></span><span class="keyword" id="2390292">func</span>&nbsp;<span class="ident" id="2390297">UnixRights</span><span class="op" id="2390307">(</span><span class="ident" id="2390308">fds</span>&nbsp;<span class="op" id="2390312">...</span><span class="builtintype" id="2390315">int</span><span class="op" id="2390318">)</span>&nbsp;<span class="op" id="2390320">[</span><span class="op" id="2390321">]</span><span class="builtintype" id="2390322">byte</span>&nbsp;<span class="op" id="2390327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2390330">datalen</span>&nbsp;<span class="op" id="2390338">:=</span>&nbsp;<span class="builtinfunc" id="2390341">len</span><span class="op" id="2390344">(</span><span class="ident" id="2390345">fds</span><span class="op" id="2390348">)</span>&nbsp;<span class="op" id="2390350">*</span>&nbsp;<span class="num" id="2390352">4</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2390355">b</span>&nbsp;<span class="op" id="2390357">:=</span>&nbsp;<span class="builtinfunc" id="2390360">make</span><span class="op" id="2390364">(</span><span class="op" id="2390365">[</span><span class="op" id="2390366">]</span><span class="builtintype" id="2390367">byte</span><span class="op" id="2390371">,</span>&nbsp;<span class="ident" id="2390373">CmsgSpace</span><span class="op" id="2390382">(</span><span class="ident" id="2390383">datalen</span><span class="op" id="2390390">)</span><span class="op" id="2390391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2390394">h</span>&nbsp;<span class="op" id="2390396">:=</span>&nbsp;<span class="op" id="2390399">(</span><span class="op" id="2390400">*</span><span class="ident" id="2390401">Cmsghdr</span><span class="op" id="2390408">)</span><span class="op" id="2390409">(</span><span class="ident" id="2390410">unsafe</span><span class="op" id="2390416">.</span><span class="ident" id="2390417">Pointer</span><span class="op" id="2390424">(</span><span class="op" id="2390425">&amp;</span><span class="ident" id="2390426">b</span><span class="op" id="2390427">[</span><span class="num" id="2390428">0</span><span class="op" id="2390429">]</span><span class="op" id="2390430">)</span><span class="op" id="2390431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2390434">h</span><span class="op" id="2390435">.</span><span class="ident" id="2390436">Level</span>&nbsp;<span class="op" id="2390442">=</span>&nbsp;<span class="ident" id="2390444">SOL_SOCKET</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2390456">h</span><span class="op" id="2390457">.</span><span class="ident" id="2390458">Type</span>&nbsp;<span class="op" id="2390463">=</span>&nbsp;<span class="ident" id="2390465">SCM_RIGHTS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2390477">h</span><span class="op" id="2390478">.</span><span class="ident" id="2390479">SetLen</span><span class="op" id="2390485">(</span><span class="ident" id="2390486">CmsgLen</span><span class="op" id="2390493">(</span><span class="ident" id="2390494">datalen</span><span class="op" id="2390501">)</span><span class="op" id="2390502">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2390505">data</span>&nbsp;<span class="op" id="2390510">:=</span>&nbsp;<span class="builtintype" id="2390513">uintptr</span><span class="op" id="2390520">(</span><span class="ident" id="2390521">cmsgData</span><span class="op" id="2390529">(</span><span class="ident" id="2390530">h</span><span class="op" id="2390531">)</span><span class="op" id="2390532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2390535">for</span>&nbsp;<span class="ident" id="2390539">_</span><span class="op" id="2390540">,</span>&nbsp;<span class="ident" id="2390542">fd</span>&nbsp;<span class="op" id="2390545">:=</span>&nbsp;<span class="keyword" id="2390548">range</span>&nbsp;<span class="ident" id="2390554">fds</span>&nbsp;<span class="op" id="2390558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2390562">*</span><span class="op" id="2390563">(</span><span class="op" id="2390564">*</span><span class="builtintype" id="2390565">int32</span><span class="op" id="2390570">)</span><span class="op" id="2390571">(</span><span class="ident" id="2390572">unsafe</span><span class="op" id="2390578">.</span><span class="ident" id="2390579">Pointer</span><span class="op" id="2390586">(</span><span class="ident" id="2390587">data</span><span class="op" id="2390591">)</span><span class="op" id="2390592">)</span>&nbsp;<span class="op" id="2390594">=</span>&nbsp;<span class="builtintype" id="2390596">int32</span><span class="op" id="2390601">(</span><span class="ident" id="2390602">fd</span><span class="op" id="2390604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2390608">data</span>&nbsp;<span class="op" id="2390613">+=</span>&nbsp;<span class="num" id="2390616">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2390619">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2390622">return</span>&nbsp;<span class="ident" id="2390629">b</span><br>
<span class="lineno"></span><span class="op" id="2390631">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2390634">//&nbsp;ParseUnixRights&nbsp;decodes&nbsp;a&nbsp;socket&nbsp;control&nbsp;message&nbsp;that&nbsp;contains&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="2390703">//&nbsp;integer&nbsp;array&nbsp;of&nbsp;open&nbsp;file&nbsp;descriptors&nbsp;from&nbsp;another&nbsp;process.</span><br>
<span class="lineno">90</span><span class="keyword" id="2390767">func</span>&nbsp;<span class="ident" id="2390772">ParseUnixRights</span><span class="op" id="2390787">(</span><span class="ident" id="2390788">m</span>&nbsp;<span class="op" id="2390790">*</span><span class="ident" id="2390791">SocketControlMessage</span><span class="op" id="2390811">)</span>&nbsp;<span class="op" id="2390813">(</span><span class="op" id="2390814">[</span><span class="op" id="2390815">]</span><span class="builtintype" id="2390816">int</span><span class="op" id="2390819">,</span>&nbsp;<span class="builtintype" id="2390821">error</span><span class="op" id="2390826">)</span>&nbsp;<span class="op" id="2390828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2390831">if</span>&nbsp;<span class="ident" id="2390834">m</span><span class="op" id="2390835">.</span><span class="ident" id="2390836">Header</span><span class="op" id="2390842">.</span><span class="ident" id="2390843">Level</span>&nbsp;<span class="op" id="2390849">!=</span>&nbsp;<span class="ident" id="2390852">SOL_SOCKET</span>&nbsp;<span class="op" id="2390863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2390867">return</span>&nbsp;<span class="ident" id="2390874">nil</span><span class="op" id="2390877">,</span>&nbsp;<span class="ident" id="2390879">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2390887">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2390890">if</span>&nbsp;<span class="ident" id="2390893">m</span><span class="op" id="2390894">.</span><span class="ident" id="2390895">Header</span><span class="op" id="2390901">.</span><span class="ident" id="2390902">Type</span>&nbsp;<span class="op" id="2390907">!=</span>&nbsp;<span class="ident" id="2390910">SCM_RIGHTS</span>&nbsp;<span class="op" id="2390921">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2390925">return</span>&nbsp;<span class="ident" id="2390932">nil</span><span class="op" id="2390935">,</span>&nbsp;<span class="ident" id="2390937">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2390945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2390948">fds</span>&nbsp;<span class="op" id="2390952">:=</span>&nbsp;<span class="builtinfunc" id="2390955">make</span><span class="op" id="2390959">(</span><span class="op" id="2390960">[</span><span class="op" id="2390961">]</span><span class="builtintype" id="2390962">int</span><span class="op" id="2390965">,</span>&nbsp;<span class="builtinfunc" id="2390967">len</span><span class="op" id="2390970">(</span><span class="ident" id="2390971">m</span><span class="op" id="2390972">.</span><span class="ident" id="2390973">Data</span><span class="op" id="2390977">)</span><span class="op" id="2390978">&gt;&gt;</span><span class="num" id="2390980">2</span><span class="op" id="2390981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2390984">for</span>&nbsp;<span class="ident" id="2390988">i</span><span class="op" id="2390989">,</span>&nbsp;<span class="ident" id="2390991">j</span>&nbsp;<span class="op" id="2390993">:=</span>&nbsp;<span class="num" id="2390996">0</span><span class="op" id="2390997">,</span>&nbsp;<span class="num" id="2390999">0</span><span class="op" id="2391000">;</span>&nbsp;<span class="ident" id="2391002">i</span>&nbsp;<span class="op" id="2391004">&lt;</span>&nbsp;<span class="builtinfunc" id="2391006">len</span><span class="op" id="2391009">(</span><span class="ident" id="2391010">m</span><span class="op" id="2391011">.</span><span class="ident" id="2391012">Data</span><span class="op" id="2391016">)</span><span class="op" id="2391017">;</span>&nbsp;<span class="ident" id="2391019">i</span>&nbsp;<span class="op" id="2391021">+=</span>&nbsp;<span class="num" id="2391024">4</span>&nbsp;<span class="op" id="2391026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2391030">fds</span><span class="op" id="2391033">[</span><span class="ident" id="2391034">j</span><span class="op" id="2391035">]</span>&nbsp;<span class="op" id="2391037">=</span>&nbsp;<span class="builtintype" id="2391039">int</span><span class="op" id="2391042">(</span><span class="op" id="2391043">*</span><span class="op" id="2391044">(</span><span class="op" id="2391045">*</span><span class="builtintype" id="2391046">int32</span><span class="op" id="2391051">)</span><span class="op" id="2391052">(</span><span class="ident" id="2391053">unsafe</span><span class="op" id="2391059">.</span><span class="ident" id="2391060">Pointer</span><span class="op" id="2391067">(</span><span class="op" id="2391068">&amp;</span><span class="ident" id="2391069">m</span><span class="op" id="2391070">.</span><span class="ident" id="2391071">Data</span><span class="op" id="2391075">[</span><span class="ident" id="2391076">i</span><span class="op" id="2391077">]</span><span class="op" id="2391078">)</span><span class="op" id="2391079">)</span><span class="op" id="2391080">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2391084">j</span><span class="op" id="2391085">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2391089">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2391092">return</span>&nbsp;<span class="ident" id="2391099">fds</span><span class="op" id="2391102">,</span>&nbsp;<span class="ident" id="2391104">nil</span><br>
<span class="lineno"></span><span class="op" id="2391108">}</span>
</div>
</body>
</html>
