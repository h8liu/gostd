<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>log/syslog</h2>
<ul>
<li><a href="/gostd/log/syslog/syslog.go.html" class="current">syslog.go</a></li>
<li><a href="/gostd/log/syslog/syslog_test.go.html">syslog_test.go</a></li>
<li><a href="/gostd/log/syslog/syslog_unix.go.html">syslog_unix.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5257633">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5257688">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5257742">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5257793">//&nbsp;+build&nbsp;!windows,!nacl,!plan9</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5257826">//&nbsp;Package&nbsp;syslog&nbsp;provides&nbsp;a&nbsp;simple&nbsp;interface&nbsp;to&nbsp;the&nbsp;system&nbsp;log</span><br>
<span class="lineno"></span><span class="comment" id="5257890">//&nbsp;service.&nbsp;It&nbsp;can&nbsp;send&nbsp;messages&nbsp;to&nbsp;the&nbsp;syslog&nbsp;daemon&nbsp;using&nbsp;UNIX</span><br>
<span class="lineno"></span><span class="comment" id="5257955">//&nbsp;domain&nbsp;sockets,&nbsp;UDP&nbsp;or&nbsp;TCP.</span><br>
<span class="lineno">10</span><span class="comment" id="5257986">//</span><br>
<span class="lineno"></span><span class="comment" id="5257989">//&nbsp;Only&nbsp;one&nbsp;call&nbsp;to&nbsp;Dial&nbsp;is&nbsp;necessary.&nbsp;On&nbsp;write&nbsp;failures,</span><br>
<span class="lineno"></span><span class="comment" id="5258047">//&nbsp;the&nbsp;syslog&nbsp;client&nbsp;will&nbsp;attempt&nbsp;to&nbsp;reconnect&nbsp;to&nbsp;the&nbsp;server</span><br>
<span class="lineno"></span><span class="comment" id="5258108">//&nbsp;and&nbsp;write&nbsp;again.</span><br>
<span class="lineno"></span><span class="keyword" id="5258128">package</span>&nbsp;<span class="ident" id="5258136">syslog</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="5258144">import</span>&nbsp;<span class="op" id="5258151">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5258154">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5258164">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5258171">&#34;log&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5258178">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5258185">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5258191">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5258202">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5258210">&#34;time&#34;</span><br>
<span class="lineno">25</span><span class="op" id="5258217">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5258220">//&nbsp;The&nbsp;Priority&nbsp;is&nbsp;a&nbsp;combination&nbsp;of&nbsp;the&nbsp;syslog&nbsp;facility&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5258280">//&nbsp;severity.&nbsp;For&nbsp;example,&nbsp;LOG_ALERT&nbsp;|&nbsp;LOG_FTP&nbsp;sends&nbsp;an&nbsp;alert&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="5258350">//&nbsp;message&nbsp;from&nbsp;the&nbsp;FTP&nbsp;facility.&nbsp;The&nbsp;default&nbsp;severity&nbsp;is&nbsp;LOG_EMERG;</span><br>
<span class="lineno">30</span><span class="comment" id="5258419">//&nbsp;the&nbsp;default&nbsp;facility&nbsp;is&nbsp;LOG_KERN.</span><br>
<span class="lineno"></span><span class="keyword" id="5258456">type</span>&nbsp;<span class="ident" id="5258461">Priority</span>&nbsp;<span class="builtintype" id="5258470">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5258475">const</span>&nbsp;<span class="ident" id="5258481">severityMask</span>&nbsp;<span class="op" id="5258494">=</span>&nbsp;<span class="num" id="5258496">0x07</span><br>
<span class="lineno"></span><span class="keyword" id="5258501">const</span>&nbsp;<span class="ident" id="5258507">facilityMask</span>&nbsp;<span class="op" id="5258520">=</span>&nbsp;<span class="num" id="5258522">0xf8</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="5258528">const</span>&nbsp;<span class="op" id="5258534">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5258537">//&nbsp;Severity.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5258552">//&nbsp;From&nbsp;/usr/include/sys/syslog.h.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5258588">//&nbsp;These&nbsp;are&nbsp;the&nbsp;same&nbsp;on&nbsp;Linux,&nbsp;BSD,&nbsp;and&nbsp;OS&nbsp;X.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5258636">LOG_EMERG</span>&nbsp;<span class="ident" id="5258646">Priority</span>&nbsp;<span class="op" id="5258655">=</span>&nbsp;<span class="ident" id="5258657">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5258663">LOG_ALERT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5258674">LOG_CRIT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5258684">LOG_ERR</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5258693">LOG_WARNING</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5258706">LOG_NOTICE</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5258718">LOG_INFO</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5258728">LOG_DEBUG</span><br>
<span class="lineno"></span><span class="op" id="5258738">)</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="5258741">const</span>&nbsp;<span class="op" id="5258747">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5258750">//&nbsp;Facility.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5258765">//&nbsp;From&nbsp;/usr/include/sys/syslog.h.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5258801">//&nbsp;These&nbsp;are&nbsp;the&nbsp;same&nbsp;up&nbsp;to&nbsp;LOG_FTP&nbsp;on&nbsp;Linux,&nbsp;BSD,&nbsp;and&nbsp;OS&nbsp;X.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5258863">LOG_KERN</span>&nbsp;<span class="ident" id="5258872">Priority</span>&nbsp;<span class="op" id="5258881">=</span>&nbsp;<span class="ident" id="5258883">iota</span>&nbsp;<span class="op" id="5258888">&lt;&lt;</span>&nbsp;<span class="num" id="5258891">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5258894">LOG_USER</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5258904">LOG_MAIL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5258914">LOG_DAEMON</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5258926">LOG_AUTH</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5258936">LOG_SYSLOG</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5258948">LOG_LPR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5258957">LOG_NEWS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5258967">LOG_UUCP</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5258977">LOG_CRON</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5258987">LOG_AUTHPRIV</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5259001">LOG_FTP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5259010">_</span>&nbsp;<span class="comment" id="5259012">//&nbsp;unused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5259023">_</span>&nbsp;<span class="comment" id="5259025">//&nbsp;unused</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5259036">_</span>&nbsp;<span class="comment" id="5259038">//&nbsp;unused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5259049">_</span>&nbsp;<span class="comment" id="5259051">//&nbsp;unused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5259062">LOG_LOCAL0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5259074">LOG_LOCAL1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5259086">LOG_LOCAL2</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5259098">LOG_LOCAL3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5259110">LOG_LOCAL4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5259122">LOG_LOCAL5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5259134">LOG_LOCAL6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5259146">LOG_LOCAL7</span><br>
<span class="lineno">80</span><span class="op" id="5259157">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5259160">//&nbsp;A&nbsp;Writer&nbsp;is&nbsp;a&nbsp;connection&nbsp;to&nbsp;a&nbsp;syslog&nbsp;server.</span><br>
<span class="lineno"></span><span class="keyword" id="5259208">type</span>&nbsp;<span class="ident" id="5259213">Writer</span>&nbsp;<span class="keyword" id="5259220">struct</span>&nbsp;<span class="op" id="5259227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5259230">priority</span>&nbsp;<span class="ident" id="5259239">Priority</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5259249">tag</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5259258">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5259266">hostname</span>&nbsp;<span class="builtintype" id="5259275">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5259283">network</span>&nbsp;&nbsp;<span class="builtintype" id="5259292">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5259300">raddr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5259309">string</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5259318">mu</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5259323">sync</span><span class="op" id="5259327">.</span><span class="ident" id="5259328">Mutex</span>&nbsp;<span class="comment" id="5259334">//&nbsp;guards&nbsp;conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5259350">conn</span>&nbsp;<span class="ident" id="5259355">serverConn</span><br>
<span class="lineno"></span><span class="op" id="5259366">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5259369">//&nbsp;This&nbsp;interface&nbsp;and&nbsp;the&nbsp;separate&nbsp;syslog_unix.go&nbsp;file&nbsp;exist&nbsp;for</span><br>
<span class="lineno">95</span><span class="comment" id="5259434">//&nbsp;Solaris&nbsp;support&nbsp;as&nbsp;implemented&nbsp;by&nbsp;gccgo.&nbsp;&nbsp;On&nbsp;Solaris&nbsp;you&nbsp;can&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="5259502">//&nbsp;simply&nbsp;open&nbsp;a&nbsp;TCP&nbsp;connection&nbsp;to&nbsp;the&nbsp;syslog&nbsp;daemon.&nbsp;&nbsp;The&nbsp;gccgo</span><br>
<span class="lineno"></span><span class="comment" id="5259567">//&nbsp;sources&nbsp;have&nbsp;a&nbsp;syslog_solaris.go&nbsp;file&nbsp;that&nbsp;implements&nbsp;unixSyslog&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5259638">//&nbsp;return&nbsp;a&nbsp;type&nbsp;that&nbsp;satisfies&nbsp;this&nbsp;interface&nbsp;and&nbsp;simply&nbsp;calls&nbsp;the&nbsp;C</span><br>
<span class="lineno"></span><span class="comment" id="5259708">//&nbsp;library&nbsp;syslog&nbsp;function.</span><br>
<span class="lineno">100</span><span class="keyword" id="5259736">type</span>&nbsp;<span class="ident" id="5259741">serverConn</span>&nbsp;<span class="keyword" id="5259752">interface</span>&nbsp;<span class="op" id="5259762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5259765">writeString</span><span class="op" id="5259776">(</span><span class="ident" id="5259777">p</span>&nbsp;<span class="ident" id="5259779">Priority</span><span class="op" id="5259787">,</span>&nbsp;<span class="ident" id="5259789">hostname</span><span class="op" id="5259797">,</span>&nbsp;<span class="ident" id="5259799">tag</span><span class="op" id="5259802">,</span>&nbsp;<span class="ident" id="5259804">s</span><span class="op" id="5259805">,</span>&nbsp;<span class="ident" id="5259807">nl</span>&nbsp;<span class="builtintype" id="5259810">string</span><span class="op" id="5259816">)</span>&nbsp;<span class="builtintype" id="5259818">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5259825">close</span><span class="op" id="5259830">(</span><span class="op" id="5259831">)</span>&nbsp;<span class="builtintype" id="5259833">error</span><br>
<span class="lineno"></span><span class="op" id="5259839">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="keyword" id="5259842">type</span>&nbsp;<span class="ident" id="5259847">netConn</span>&nbsp;<span class="keyword" id="5259855">struct</span>&nbsp;<span class="op" id="5259862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5259865">local</span>&nbsp;<span class="builtintype" id="5259871">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5259877">conn</span>&nbsp;&nbsp;<span class="ident" id="5259883">net</span><span class="op" id="5259886">.</span><span class="ident" id="5259887">Conn</span><br>
<span class="lineno"></span><span class="op" id="5259892">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="5259895">//&nbsp;New&nbsp;establishes&nbsp;a&nbsp;new&nbsp;connection&nbsp;to&nbsp;the&nbsp;system&nbsp;log&nbsp;daemon.&nbsp;&nbsp;Each</span><br>
<span class="lineno"></span><span class="comment" id="5259963">//&nbsp;write&nbsp;to&nbsp;the&nbsp;returned&nbsp;writer&nbsp;sends&nbsp;a&nbsp;log&nbsp;message&nbsp;with&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span><span class="comment" id="5260030">//&nbsp;priority&nbsp;and&nbsp;prefix.</span><br>
<span class="lineno"></span><span class="keyword" id="5260054">func</span>&nbsp;<span class="ident" id="5260059">New</span><span class="op" id="5260062">(</span><span class="ident" id="5260063">priority</span>&nbsp;<span class="ident" id="5260072">Priority</span><span class="op" id="5260080">,</span>&nbsp;<span class="ident" id="5260082">tag</span>&nbsp;<span class="builtintype" id="5260086">string</span><span class="op" id="5260092">)</span>&nbsp;<span class="op" id="5260094">(</span><span class="ident" id="5260095">w</span>&nbsp;<span class="op" id="5260097">*</span><span class="ident" id="5260098">Writer</span><span class="op" id="5260104">,</span>&nbsp;<span class="ident" id="5260106">err</span>&nbsp;<span class="builtintype" id="5260110">error</span><span class="op" id="5260115">)</span>&nbsp;<span class="op" id="5260117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5260120">return</span>&nbsp;<span class="ident" id="5260127">Dial</span><span class="op" id="5260131">(</span><span class="string" id="5260132">&#34;&#34;</span><span class="op" id="5260134">,</span>&nbsp;<span class="string" id="5260136">&#34;&#34;</span><span class="op" id="5260138">,</span>&nbsp;<span class="ident" id="5260140">priority</span><span class="op" id="5260148">,</span>&nbsp;<span class="ident" id="5260150">tag</span><span class="op" id="5260153">)</span><br>
<span class="lineno">115</span><span class="op" id="5260155">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5260158">//&nbsp;Dial&nbsp;establishes&nbsp;a&nbsp;connection&nbsp;to&nbsp;a&nbsp;log&nbsp;daemon&nbsp;by&nbsp;connecting&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5260224">//&nbsp;address&nbsp;raddr&nbsp;on&nbsp;the&nbsp;specified&nbsp;network.&nbsp;&nbsp;Each&nbsp;write&nbsp;to&nbsp;the&nbsp;returned</span><br>
<span class="lineno"></span><span class="comment" id="5260295">//&nbsp;writer&nbsp;sends&nbsp;a&nbsp;log&nbsp;message&nbsp;with&nbsp;the&nbsp;given&nbsp;facility,&nbsp;severity&nbsp;and</span><br>
<span class="lineno">120</span><span class="comment" id="5260363">//&nbsp;tag.</span><br>
<span class="lineno"></span><span class="comment" id="5260371">//&nbsp;If&nbsp;network&nbsp;is&nbsp;empty,&nbsp;Dial&nbsp;will&nbsp;connect&nbsp;to&nbsp;the&nbsp;local&nbsp;syslog&nbsp;server.</span><br>
<span class="lineno"></span><span class="keyword" id="5260441">func</span>&nbsp;<span class="ident" id="5260446">Dial</span><span class="op" id="5260450">(</span><span class="ident" id="5260451">network</span><span class="op" id="5260458">,</span>&nbsp;<span class="ident" id="5260460">raddr</span>&nbsp;<span class="builtintype" id="5260466">string</span><span class="op" id="5260472">,</span>&nbsp;<span class="ident" id="5260474">priority</span>&nbsp;<span class="ident" id="5260483">Priority</span><span class="op" id="5260491">,</span>&nbsp;<span class="ident" id="5260493">tag</span>&nbsp;<span class="builtintype" id="5260497">string</span><span class="op" id="5260503">)</span>&nbsp;<span class="op" id="5260505">(</span><span class="op" id="5260506">*</span><span class="ident" id="5260507">Writer</span><span class="op" id="5260513">,</span>&nbsp;<span class="builtintype" id="5260515">error</span><span class="op" id="5260520">)</span>&nbsp;<span class="op" id="5260522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5260525">if</span>&nbsp;<span class="ident" id="5260528">priority</span>&nbsp;<span class="op" id="5260537">&lt;</span>&nbsp;<span class="num" id="5260539">0</span>&nbsp;<span class="op" id="5260541">||</span>&nbsp;<span class="ident" id="5260544">priority</span>&nbsp;<span class="op" id="5260553">&gt;</span>&nbsp;<span class="ident" id="5260555">LOG_LOCAL7</span><span class="op" id="5260565">|</span><span class="ident" id="5260566">LOG_DEBUG</span>&nbsp;<span class="op" id="5260576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5260580">return</span>&nbsp;<span class="builtintype" id="5260587">nil</span><span class="op" id="5260590">,</span>&nbsp;<span class="ident" id="5260592">errors</span><span class="op" id="5260598">.</span><span class="ident" id="5260599">New</span><span class="op" id="5260602">(</span><span class="string" id="5260603">&#34;log/syslog:&nbsp;invalid&nbsp;priority&#34;</span><span class="op" id="5260633">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5260636">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5260640">if</span>&nbsp;<span class="ident" id="5260643">tag</span>&nbsp;<span class="op" id="5260647">==</span>&nbsp;<span class="string" id="5260650">&#34;&#34;</span>&nbsp;<span class="op" id="5260653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5260657">tag</span>&nbsp;<span class="op" id="5260661">=</span>&nbsp;<span class="ident" id="5260663">os</span><span class="op" id="5260665">.</span><span class="ident" id="5260666">Args</span><span class="op" id="5260670">[</span><span class="num" id="5260671">0</span><span class="op" id="5260672">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5260675">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5260678">hostname</span><span class="op" id="5260686">,</span>&nbsp;<span class="ident" id="5260688">_</span>&nbsp;<span class="op" id="5260690">:=</span>&nbsp;<span class="ident" id="5260693">os</span><span class="op" id="5260695">.</span><span class="ident" id="5260696">Hostname</span><span class="op" id="5260704">(</span><span class="op" id="5260705">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5260709">w</span>&nbsp;<span class="op" id="5260711">:=</span>&nbsp;<span class="op" id="5260714">&amp;</span><span class="ident" id="5260715">Writer</span><span class="op" id="5260721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5260725">priority</span><span class="op" id="5260733">:</span>&nbsp;<span class="ident" id="5260735">priority</span><span class="op" id="5260743">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5260747">tag</span><span class="op" id="5260750">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5260757">tag</span><span class="op" id="5260760">,</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5260764">hostname</span><span class="op" id="5260772">:</span>&nbsp;<span class="ident" id="5260774">hostname</span><span class="op" id="5260782">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5260786">network</span><span class="op" id="5260793">:</span>&nbsp;&nbsp;<span class="ident" id="5260796">network</span><span class="op" id="5260803">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5260807">raddr</span><span class="op" id="5260812">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5260817">raddr</span><span class="op" id="5260822">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5260825">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5260829">w</span><span class="op" id="5260830">.</span><span class="ident" id="5260831">mu</span><span class="op" id="5260833">.</span><span class="ident" id="5260834">Lock</span><span class="op" id="5260838">(</span><span class="op" id="5260839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5260842">defer</span>&nbsp;<span class="ident" id="5260848">w</span><span class="op" id="5260849">.</span><span class="ident" id="5260850">mu</span><span class="op" id="5260852">.</span><span class="ident" id="5260853">Unlock</span><span class="op" id="5260859">(</span><span class="op" id="5260860">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5260864">err</span>&nbsp;<span class="op" id="5260868">:=</span>&nbsp;<span class="ident" id="5260871">w</span><span class="op" id="5260872">.</span><span class="ident" id="5260873">connect</span><span class="op" id="5260880">(</span><span class="op" id="5260881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5260884">if</span>&nbsp;<span class="ident" id="5260887">err</span>&nbsp;<span class="op" id="5260891">!=</span>&nbsp;<span class="builtintype" id="5260894">nil</span>&nbsp;<span class="op" id="5260898">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5260902">return</span>&nbsp;<span class="builtintype" id="5260909">nil</span><span class="op" id="5260912">,</span>&nbsp;<span class="ident" id="5260914">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5260919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5260922">return</span>&nbsp;<span class="ident" id="5260929">w</span><span class="op" id="5260930">,</span>&nbsp;<span class="ident" id="5260932">err</span><br>
<span class="lineno"></span><span class="op" id="5260936">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="comment" id="5260939">//&nbsp;connect&nbsp;makes&nbsp;a&nbsp;connection&nbsp;to&nbsp;the&nbsp;syslog&nbsp;server.</span><br>
<span class="lineno"></span><span class="comment" id="5260991">//&nbsp;It&nbsp;must&nbsp;be&nbsp;called&nbsp;with&nbsp;w.mu&nbsp;held.</span><br>
<span class="lineno"></span><span class="keyword" id="5261028">func</span>&nbsp;<span class="op" id="5261033">(</span><span class="ident" id="5261034">w</span>&nbsp;<span class="op" id="5261036">*</span><span class="ident" id="5261037">Writer</span><span class="op" id="5261043">)</span>&nbsp;<span class="ident" id="5261045">connect</span><span class="op" id="5261052">(</span><span class="op" id="5261053">)</span>&nbsp;<span class="op" id="5261055">(</span><span class="ident" id="5261056">err</span>&nbsp;<span class="builtintype" id="5261060">error</span><span class="op" id="5261065">)</span>&nbsp;<span class="op" id="5261067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5261070">if</span>&nbsp;<span class="ident" id="5261073">w</span><span class="op" id="5261074">.</span><span class="ident" id="5261075">conn</span>&nbsp;<span class="op" id="5261080">!=</span>&nbsp;<span class="builtintype" id="5261083">nil</span>&nbsp;<span class="op" id="5261087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5261091">//&nbsp;ignore&nbsp;err&nbsp;from&nbsp;close,&nbsp;it&nbsp;makes&nbsp;sense&nbsp;to&nbsp;continue&nbsp;anyway</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5261153">w</span><span class="op" id="5261154">.</span><span class="ident" id="5261155">conn</span><span class="op" id="5261159">.</span><span class="builtinfunc" id="5261160">close</span><span class="op" id="5261165">(</span><span class="op" id="5261166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5261170">w</span><span class="op" id="5261171">.</span><span class="ident" id="5261172">conn</span>&nbsp;<span class="op" id="5261177">=</span>&nbsp;<span class="builtintype" id="5261179">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5261184">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5261188">if</span>&nbsp;<span class="ident" id="5261191">w</span><span class="op" id="5261192">.</span><span class="ident" id="5261193">network</span>&nbsp;<span class="op" id="5261201">==</span>&nbsp;<span class="string" id="5261204">&#34;&#34;</span>&nbsp;<span class="op" id="5261207">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5261211">w</span><span class="op" id="5261212">.</span><span class="ident" id="5261213">conn</span><span class="op" id="5261217">,</span>&nbsp;<span class="ident" id="5261219">err</span>&nbsp;<span class="op" id="5261223">=</span>&nbsp;<span class="ident" id="5261225">unixSyslog</span><span class="op" id="5261235">(</span><span class="op" id="5261236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5261240">if</span>&nbsp;<span class="ident" id="5261243">w</span><span class="op" id="5261244">.</span><span class="ident" id="5261245">hostname</span>&nbsp;<span class="op" id="5261254">==</span>&nbsp;<span class="string" id="5261257">&#34;&#34;</span>&nbsp;<span class="op" id="5261260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5261265">w</span><span class="op" id="5261266">.</span><span class="ident" id="5261267">hostname</span>&nbsp;<span class="op" id="5261276">=</span>&nbsp;<span class="string" id="5261278">&#34;localhost&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5261292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5261295">}</span>&nbsp;<span class="keyword" id="5261297">else</span>&nbsp;<span class="op" id="5261302">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5261306">var</span>&nbsp;<span class="ident" id="5261310">c</span>&nbsp;<span class="ident" id="5261312">net</span><span class="op" id="5261315">.</span><span class="ident" id="5261316">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5261323">c</span><span class="op" id="5261324">,</span>&nbsp;<span class="ident" id="5261326">err</span>&nbsp;<span class="op" id="5261330">=</span>&nbsp;<span class="ident" id="5261332">net</span><span class="op" id="5261335">.</span><span class="ident" id="5261336">Dial</span><span class="op" id="5261340">(</span><span class="ident" id="5261341">w</span><span class="op" id="5261342">.</span><span class="ident" id="5261343">network</span><span class="op" id="5261350">,</span>&nbsp;<span class="ident" id="5261352">w</span><span class="op" id="5261353">.</span><span class="ident" id="5261354">raddr</span><span class="op" id="5261359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5261363">if</span>&nbsp;<span class="ident" id="5261366">err</span>&nbsp;<span class="op" id="5261370">==</span>&nbsp;<span class="builtintype" id="5261373">nil</span>&nbsp;<span class="op" id="5261377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5261382">w</span><span class="op" id="5261383">.</span><span class="ident" id="5261384">conn</span>&nbsp;<span class="op" id="5261389">=</span>&nbsp;<span class="op" id="5261391">&amp;</span><span class="ident" id="5261392">netConn</span><span class="op" id="5261399">{</span><span class="ident" id="5261400">conn</span><span class="op" id="5261404">:</span>&nbsp;<span class="ident" id="5261406">c</span><span class="op" id="5261407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5261412">if</span>&nbsp;<span class="ident" id="5261415">w</span><span class="op" id="5261416">.</span><span class="ident" id="5261417">hostname</span>&nbsp;<span class="op" id="5261426">==</span>&nbsp;<span class="string" id="5261429">&#34;&#34;</span>&nbsp;<span class="op" id="5261432">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5261438">w</span><span class="op" id="5261439">.</span><span class="ident" id="5261440">hostname</span>&nbsp;<span class="op" id="5261449">=</span>&nbsp;<span class="ident" id="5261451">c</span><span class="op" id="5261452">.</span><span class="ident" id="5261453">LocalAddr</span><span class="op" id="5261462">(</span><span class="op" id="5261463">)</span><span class="op" id="5261464">.</span><span class="ident" id="5261465">String</span><span class="op" id="5261471">(</span><span class="op" id="5261472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5261477">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5261481">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5261484">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5261487">return</span><br>
<span class="lineno">175</span><span class="op" id="5261494">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5261497">//&nbsp;Write&nbsp;sends&nbsp;a&nbsp;log&nbsp;message&nbsp;to&nbsp;the&nbsp;syslog&nbsp;daemon.</span><br>
<span class="lineno"></span><span class="keyword" id="5261548">func</span>&nbsp;<span class="op" id="5261553">(</span><span class="ident" id="5261554">w</span>&nbsp;<span class="op" id="5261556">*</span><span class="ident" id="5261557">Writer</span><span class="op" id="5261563">)</span>&nbsp;<span class="ident" id="5261565">Write</span><span class="op" id="5261570">(</span><span class="ident" id="5261571">b</span>&nbsp;<span class="op" id="5261573">[</span><span class="op" id="5261574">]</span><span class="builtintype" id="5261575">byte</span><span class="op" id="5261579">)</span>&nbsp;<span class="op" id="5261581">(</span><span class="builtintype" id="5261582">int</span><span class="op" id="5261585">,</span>&nbsp;<span class="builtintype" id="5261587">error</span><span class="op" id="5261592">)</span>&nbsp;<span class="op" id="5261594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5261597">return</span>&nbsp;<span class="ident" id="5261604">w</span><span class="op" id="5261605">.</span><span class="ident" id="5261606">writeAndRetry</span><span class="op" id="5261619">(</span><span class="ident" id="5261620">w</span><span class="op" id="5261621">.</span><span class="ident" id="5261622">priority</span><span class="op" id="5261630">,</span>&nbsp;<span class="builtintype" id="5261632">string</span><span class="op" id="5261638">(</span><span class="ident" id="5261639">b</span><span class="op" id="5261640">)</span><span class="op" id="5261641">)</span><br>
<span class="lineno">180</span><span class="op" id="5261643">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5261646">//&nbsp;Close&nbsp;closes&nbsp;a&nbsp;connection&nbsp;to&nbsp;the&nbsp;syslog&nbsp;daemon.</span><br>
<span class="lineno"></span><span class="keyword" id="5261697">func</span>&nbsp;<span class="op" id="5261702">(</span><span class="ident" id="5261703">w</span>&nbsp;<span class="op" id="5261705">*</span><span class="ident" id="5261706">Writer</span><span class="op" id="5261712">)</span>&nbsp;<span class="ident" id="5261714">Close</span><span class="op" id="5261719">(</span><span class="op" id="5261720">)</span>&nbsp;<span class="builtintype" id="5261722">error</span>&nbsp;<span class="op" id="5261728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5261731">w</span><span class="op" id="5261732">.</span><span class="ident" id="5261733">mu</span><span class="op" id="5261735">.</span><span class="ident" id="5261736">Lock</span><span class="op" id="5261740">(</span><span class="op" id="5261741">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5261744">defer</span>&nbsp;<span class="ident" id="5261750">w</span><span class="op" id="5261751">.</span><span class="ident" id="5261752">mu</span><span class="op" id="5261754">.</span><span class="ident" id="5261755">Unlock</span><span class="op" id="5261761">(</span><span class="op" id="5261762">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5261766">if</span>&nbsp;<span class="ident" id="5261769">w</span><span class="op" id="5261770">.</span><span class="ident" id="5261771">conn</span>&nbsp;<span class="op" id="5261776">!=</span>&nbsp;<span class="builtintype" id="5261779">nil</span>&nbsp;<span class="op" id="5261783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5261787">err</span>&nbsp;<span class="op" id="5261791">:=</span>&nbsp;<span class="ident" id="5261794">w</span><span class="op" id="5261795">.</span><span class="ident" id="5261796">conn</span><span class="op" id="5261800">.</span><span class="builtinfunc" id="5261801">close</span><span class="op" id="5261806">(</span><span class="op" id="5261807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5261811">w</span><span class="op" id="5261812">.</span><span class="ident" id="5261813">conn</span>&nbsp;<span class="op" id="5261818">=</span>&nbsp;<span class="builtintype" id="5261820">nil</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5261826">return</span>&nbsp;<span class="ident" id="5261833">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5261838">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5261841">return</span>&nbsp;<span class="builtintype" id="5261848">nil</span><br>
<span class="lineno"></span><span class="op" id="5261852">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span><span class="comment" id="5261855">//&nbsp;Emerg&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_EMERG,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="5261926">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="5261944">func</span>&nbsp;<span class="op" id="5261949">(</span><span class="ident" id="5261950">w</span>&nbsp;<span class="op" id="5261952">*</span><span class="ident" id="5261953">Writer</span><span class="op" id="5261959">)</span>&nbsp;<span class="ident" id="5261961">Emerg</span><span class="op" id="5261966">(</span><span class="ident" id="5261967">m</span>&nbsp;<span class="builtintype" id="5261969">string</span><span class="op" id="5261975">)</span>&nbsp;<span class="op" id="5261977">(</span><span class="ident" id="5261978">err</span>&nbsp;<span class="builtintype" id="5261982">error</span><span class="op" id="5261987">)</span>&nbsp;<span class="op" id="5261989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5261992">_</span><span class="op" id="5261993">,</span>&nbsp;<span class="ident" id="5261995">err</span>&nbsp;<span class="op" id="5261999">=</span>&nbsp;<span class="ident" id="5262001">w</span><span class="op" id="5262002">.</span><span class="ident" id="5262003">writeAndRetry</span><span class="op" id="5262016">(</span><span class="ident" id="5262017">LOG_EMERG</span><span class="op" id="5262026">,</span>&nbsp;<span class="ident" id="5262028">m</span><span class="op" id="5262029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5262032">return</span>&nbsp;<span class="ident" id="5262039">err</span><br>
<span class="lineno">200</span><span class="op" id="5262043">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5262046">//&nbsp;Alert&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_ALERT,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="5262117">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="5262135">func</span>&nbsp;<span class="op" id="5262140">(</span><span class="ident" id="5262141">w</span>&nbsp;<span class="op" id="5262143">*</span><span class="ident" id="5262144">Writer</span><span class="op" id="5262150">)</span>&nbsp;<span class="ident" id="5262152">Alert</span><span class="op" id="5262157">(</span><span class="ident" id="5262158">m</span>&nbsp;<span class="builtintype" id="5262160">string</span><span class="op" id="5262166">)</span>&nbsp;<span class="op" id="5262168">(</span><span class="ident" id="5262169">err</span>&nbsp;<span class="builtintype" id="5262173">error</span><span class="op" id="5262178">)</span>&nbsp;<span class="op" id="5262180">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5262183">_</span><span class="op" id="5262184">,</span>&nbsp;<span class="ident" id="5262186">err</span>&nbsp;<span class="op" id="5262190">=</span>&nbsp;<span class="ident" id="5262192">w</span><span class="op" id="5262193">.</span><span class="ident" id="5262194">writeAndRetry</span><span class="op" id="5262207">(</span><span class="ident" id="5262208">LOG_ALERT</span><span class="op" id="5262217">,</span>&nbsp;<span class="ident" id="5262219">m</span><span class="op" id="5262220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5262223">return</span>&nbsp;<span class="ident" id="5262230">err</span><br>
<span class="lineno"></span><span class="op" id="5262234">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5262237">//&nbsp;Crit&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_CRIT,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno">210</span><span class="comment" id="5262306">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="5262324">func</span>&nbsp;<span class="op" id="5262329">(</span><span class="ident" id="5262330">w</span>&nbsp;<span class="op" id="5262332">*</span><span class="ident" id="5262333">Writer</span><span class="op" id="5262339">)</span>&nbsp;<span class="ident" id="5262341">Crit</span><span class="op" id="5262345">(</span><span class="ident" id="5262346">m</span>&nbsp;<span class="builtintype" id="5262348">string</span><span class="op" id="5262354">)</span>&nbsp;<span class="op" id="5262356">(</span><span class="ident" id="5262357">err</span>&nbsp;<span class="builtintype" id="5262361">error</span><span class="op" id="5262366">)</span>&nbsp;<span class="op" id="5262368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5262371">_</span><span class="op" id="5262372">,</span>&nbsp;<span class="ident" id="5262374">err</span>&nbsp;<span class="op" id="5262378">=</span>&nbsp;<span class="ident" id="5262380">w</span><span class="op" id="5262381">.</span><span class="ident" id="5262382">writeAndRetry</span><span class="op" id="5262395">(</span><span class="ident" id="5262396">LOG_CRIT</span><span class="op" id="5262404">,</span>&nbsp;<span class="ident" id="5262406">m</span><span class="op" id="5262407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5262410">return</span>&nbsp;<span class="ident" id="5262417">err</span><br>
<span class="lineno"></span><span class="op" id="5262421">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span><span class="comment" id="5262424">//&nbsp;Err&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_ERR,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="5262491">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="5262509">func</span>&nbsp;<span class="op" id="5262514">(</span><span class="ident" id="5262515">w</span>&nbsp;<span class="op" id="5262517">*</span><span class="ident" id="5262518">Writer</span><span class="op" id="5262524">)</span>&nbsp;<span class="ident" id="5262526">Err</span><span class="op" id="5262529">(</span><span class="ident" id="5262530">m</span>&nbsp;<span class="builtintype" id="5262532">string</span><span class="op" id="5262538">)</span>&nbsp;<span class="op" id="5262540">(</span><span class="ident" id="5262541">err</span>&nbsp;<span class="builtintype" id="5262545">error</span><span class="op" id="5262550">)</span>&nbsp;<span class="op" id="5262552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5262555">_</span><span class="op" id="5262556">,</span>&nbsp;<span class="ident" id="5262558">err</span>&nbsp;<span class="op" id="5262562">=</span>&nbsp;<span class="ident" id="5262564">w</span><span class="op" id="5262565">.</span><span class="ident" id="5262566">writeAndRetry</span><span class="op" id="5262579">(</span><span class="ident" id="5262580">LOG_ERR</span><span class="op" id="5262587">,</span>&nbsp;<span class="ident" id="5262589">m</span><span class="op" id="5262590">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5262593">return</span>&nbsp;<span class="ident" id="5262600">err</span><br>
<span class="lineno"></span><span class="op" id="5262604">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5262607">//&nbsp;Warning&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_WARNING,&nbsp;ignoring&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5262673">//&nbsp;severity&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno">225</span><span class="keyword" id="5262700">func</span>&nbsp;<span class="op" id="5262705">(</span><span class="ident" id="5262706">w</span>&nbsp;<span class="op" id="5262708">*</span><span class="ident" id="5262709">Writer</span><span class="op" id="5262715">)</span>&nbsp;<span class="ident" id="5262717">Warning</span><span class="op" id="5262724">(</span><span class="ident" id="5262725">m</span>&nbsp;<span class="builtintype" id="5262727">string</span><span class="op" id="5262733">)</span>&nbsp;<span class="op" id="5262735">(</span><span class="ident" id="5262736">err</span>&nbsp;<span class="builtintype" id="5262740">error</span><span class="op" id="5262745">)</span>&nbsp;<span class="op" id="5262747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5262750">_</span><span class="op" id="5262751">,</span>&nbsp;<span class="ident" id="5262753">err</span>&nbsp;<span class="op" id="5262757">=</span>&nbsp;<span class="ident" id="5262759">w</span><span class="op" id="5262760">.</span><span class="ident" id="5262761">writeAndRetry</span><span class="op" id="5262774">(</span><span class="ident" id="5262775">LOG_WARNING</span><span class="op" id="5262786">,</span>&nbsp;<span class="ident" id="5262788">m</span><span class="op" id="5262789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5262792">return</span>&nbsp;<span class="ident" id="5262799">err</span><br>
<span class="lineno"></span><span class="op" id="5262803">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="comment" id="5262806">//&nbsp;Notice&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_NOTICE,&nbsp;ignoring&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5262870">//&nbsp;severity&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="5262897">func</span>&nbsp;<span class="op" id="5262902">(</span><span class="ident" id="5262903">w</span>&nbsp;<span class="op" id="5262905">*</span><span class="ident" id="5262906">Writer</span><span class="op" id="5262912">)</span>&nbsp;<span class="ident" id="5262914">Notice</span><span class="op" id="5262920">(</span><span class="ident" id="5262921">m</span>&nbsp;<span class="builtintype" id="5262923">string</span><span class="op" id="5262929">)</span>&nbsp;<span class="op" id="5262931">(</span><span class="ident" id="5262932">err</span>&nbsp;<span class="builtintype" id="5262936">error</span><span class="op" id="5262941">)</span>&nbsp;<span class="op" id="5262943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5262946">_</span><span class="op" id="5262947">,</span>&nbsp;<span class="ident" id="5262949">err</span>&nbsp;<span class="op" id="5262953">=</span>&nbsp;<span class="ident" id="5262955">w</span><span class="op" id="5262956">.</span><span class="ident" id="5262957">writeAndRetry</span><span class="op" id="5262970">(</span><span class="ident" id="5262971">LOG_NOTICE</span><span class="op" id="5262981">,</span>&nbsp;<span class="ident" id="5262983">m</span><span class="op" id="5262984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5262987">return</span>&nbsp;<span class="ident" id="5262994">err</span><br>
<span class="lineno">235</span><span class="op" id="5262998">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5263001">//&nbsp;Info&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_INFO,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="5263070">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="5263088">func</span>&nbsp;<span class="op" id="5263093">(</span><span class="ident" id="5263094">w</span>&nbsp;<span class="op" id="5263096">*</span><span class="ident" id="5263097">Writer</span><span class="op" id="5263103">)</span>&nbsp;<span class="ident" id="5263105">Info</span><span class="op" id="5263109">(</span><span class="ident" id="5263110">m</span>&nbsp;<span class="builtintype" id="5263112">string</span><span class="op" id="5263118">)</span>&nbsp;<span class="op" id="5263120">(</span><span class="ident" id="5263121">err</span>&nbsp;<span class="builtintype" id="5263125">error</span><span class="op" id="5263130">)</span>&nbsp;<span class="op" id="5263132">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5263135">_</span><span class="op" id="5263136">,</span>&nbsp;<span class="ident" id="5263138">err</span>&nbsp;<span class="op" id="5263142">=</span>&nbsp;<span class="ident" id="5263144">w</span><span class="op" id="5263145">.</span><span class="ident" id="5263146">writeAndRetry</span><span class="op" id="5263159">(</span><span class="ident" id="5263160">LOG_INFO</span><span class="op" id="5263168">,</span>&nbsp;<span class="ident" id="5263170">m</span><span class="op" id="5263171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5263174">return</span>&nbsp;<span class="ident" id="5263181">err</span><br>
<span class="lineno"></span><span class="op" id="5263185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5263188">//&nbsp;Debug&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_DEBUG,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno">245</span><span class="comment" id="5263259">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="5263277">func</span>&nbsp;<span class="op" id="5263282">(</span><span class="ident" id="5263283">w</span>&nbsp;<span class="op" id="5263285">*</span><span class="ident" id="5263286">Writer</span><span class="op" id="5263292">)</span>&nbsp;<span class="ident" id="5263294">Debug</span><span class="op" id="5263299">(</span><span class="ident" id="5263300">m</span>&nbsp;<span class="builtintype" id="5263302">string</span><span class="op" id="5263308">)</span>&nbsp;<span class="op" id="5263310">(</span><span class="ident" id="5263311">err</span>&nbsp;<span class="builtintype" id="5263315">error</span><span class="op" id="5263320">)</span>&nbsp;<span class="op" id="5263322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5263325">_</span><span class="op" id="5263326">,</span>&nbsp;<span class="ident" id="5263328">err</span>&nbsp;<span class="op" id="5263332">=</span>&nbsp;<span class="ident" id="5263334">w</span><span class="op" id="5263335">.</span><span class="ident" id="5263336">writeAndRetry</span><span class="op" id="5263349">(</span><span class="ident" id="5263350">LOG_DEBUG</span><span class="op" id="5263359">,</span>&nbsp;<span class="ident" id="5263361">m</span><span class="op" id="5263362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5263365">return</span>&nbsp;<span class="ident" id="5263372">err</span><br>
<span class="lineno"></span><span class="op" id="5263376">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span><span class="keyword" id="5263379">func</span>&nbsp;<span class="op" id="5263384">(</span><span class="ident" id="5263385">w</span>&nbsp;<span class="op" id="5263387">*</span><span class="ident" id="5263388">Writer</span><span class="op" id="5263394">)</span>&nbsp;<span class="ident" id="5263396">writeAndRetry</span><span class="op" id="5263409">(</span><span class="ident" id="5263410">p</span>&nbsp;<span class="ident" id="5263412">Priority</span><span class="op" id="5263420">,</span>&nbsp;<span class="ident" id="5263422">s</span>&nbsp;<span class="builtintype" id="5263424">string</span><span class="op" id="5263430">)</span>&nbsp;<span class="op" id="5263432">(</span><span class="builtintype" id="5263433">int</span><span class="op" id="5263436">,</span>&nbsp;<span class="builtintype" id="5263438">error</span><span class="op" id="5263443">)</span>&nbsp;<span class="op" id="5263445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5263448">pr</span>&nbsp;<span class="op" id="5263451">:=</span>&nbsp;<span class="op" id="5263454">(</span><span class="ident" id="5263455">w</span><span class="op" id="5263456">.</span><span class="ident" id="5263457">priority</span>&nbsp;<span class="op" id="5263466">&amp;</span>&nbsp;<span class="ident" id="5263468">facilityMask</span><span class="op" id="5263480">)</span>&nbsp;<span class="op" id="5263482">|</span>&nbsp;<span class="op" id="5263484">(</span><span class="ident" id="5263485">p</span>&nbsp;<span class="op" id="5263487">&amp;</span>&nbsp;<span class="ident" id="5263489">severityMask</span><span class="op" id="5263501">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5263505">w</span><span class="op" id="5263506">.</span><span class="ident" id="5263507">mu</span><span class="op" id="5263509">.</span><span class="ident" id="5263510">Lock</span><span class="op" id="5263514">(</span><span class="op" id="5263515">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5263518">defer</span>&nbsp;<span class="ident" id="5263524">w</span><span class="op" id="5263525">.</span><span class="ident" id="5263526">mu</span><span class="op" id="5263528">.</span><span class="ident" id="5263529">Unlock</span><span class="op" id="5263535">(</span><span class="op" id="5263536">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5263540">if</span>&nbsp;<span class="ident" id="5263543">w</span><span class="op" id="5263544">.</span><span class="ident" id="5263545">conn</span>&nbsp;<span class="op" id="5263550">!=</span>&nbsp;<span class="builtintype" id="5263553">nil</span>&nbsp;<span class="op" id="5263557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5263561">if</span>&nbsp;<span class="ident" id="5263564">n</span><span class="op" id="5263565">,</span>&nbsp;<span class="ident" id="5263567">err</span>&nbsp;<span class="op" id="5263571">:=</span>&nbsp;<span class="ident" id="5263574">w</span><span class="op" id="5263575">.</span><span class="ident" id="5263576">write</span><span class="op" id="5263581">(</span><span class="ident" id="5263582">pr</span><span class="op" id="5263584">,</span>&nbsp;<span class="ident" id="5263586">s</span><span class="op" id="5263587">)</span><span class="op" id="5263588">;</span>&nbsp;<span class="ident" id="5263590">err</span>&nbsp;<span class="op" id="5263594">==</span>&nbsp;<span class="builtintype" id="5263597">nil</span>&nbsp;<span class="op" id="5263601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5263606">return</span>&nbsp;<span class="ident" id="5263613">n</span><span class="op" id="5263614">,</span>&nbsp;<span class="ident" id="5263616">err</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5263622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5263625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5263628">if</span>&nbsp;<span class="ident" id="5263631">err</span>&nbsp;<span class="op" id="5263635">:=</span>&nbsp;<span class="ident" id="5263638">w</span><span class="op" id="5263639">.</span><span class="ident" id="5263640">connect</span><span class="op" id="5263647">(</span><span class="op" id="5263648">)</span><span class="op" id="5263649">;</span>&nbsp;<span class="ident" id="5263651">err</span>&nbsp;<span class="op" id="5263655">!=</span>&nbsp;<span class="builtintype" id="5263658">nil</span>&nbsp;<span class="op" id="5263662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5263666">return</span>&nbsp;<span class="num" id="5263673">0</span><span class="op" id="5263674">,</span>&nbsp;<span class="ident" id="5263676">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5263681">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5263684">return</span>&nbsp;<span class="ident" id="5263691">w</span><span class="op" id="5263692">.</span><span class="ident" id="5263693">write</span><span class="op" id="5263698">(</span><span class="ident" id="5263699">pr</span><span class="op" id="5263701">,</span>&nbsp;<span class="ident" id="5263703">s</span><span class="op" id="5263704">)</span><br>
<span class="lineno"></span><span class="op" id="5263706">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5263709">//&nbsp;write&nbsp;generates&nbsp;and&nbsp;writes&nbsp;a&nbsp;syslog&nbsp;formatted&nbsp;string.&nbsp;The</span><br>
<span class="lineno"></span><span class="comment" id="5263770">//&nbsp;format&nbsp;is&nbsp;as&nbsp;follows:&nbsp;&lt;PRI&gt;TIMESTAMP&nbsp;HOSTNAME&nbsp;TAG[PID]:&nbsp;MSG</span><br>
<span class="lineno">270</span><span class="keyword" id="5263833">func</span>&nbsp;<span class="op" id="5263838">(</span><span class="ident" id="5263839">w</span>&nbsp;<span class="op" id="5263841">*</span><span class="ident" id="5263842">Writer</span><span class="op" id="5263848">)</span>&nbsp;<span class="ident" id="5263850">write</span><span class="op" id="5263855">(</span><span class="ident" id="5263856">p</span>&nbsp;<span class="ident" id="5263858">Priority</span><span class="op" id="5263866">,</span>&nbsp;<span class="ident" id="5263868">msg</span>&nbsp;<span class="builtintype" id="5263872">string</span><span class="op" id="5263878">)</span>&nbsp;<span class="op" id="5263880">(</span><span class="builtintype" id="5263881">int</span><span class="op" id="5263884">,</span>&nbsp;<span class="builtintype" id="5263886">error</span><span class="op" id="5263891">)</span>&nbsp;<span class="op" id="5263893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5263896">//&nbsp;ensure&nbsp;it&nbsp;ends&nbsp;in&nbsp;a&nbsp;\n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5263923">nl</span>&nbsp;<span class="op" id="5263926">:=</span>&nbsp;<span class="string" id="5263929">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5263933">if</span>&nbsp;<span class="op" id="5263936">!</span><span class="ident" id="5263937">strings</span><span class="op" id="5263944">.</span><span class="ident" id="5263945">HasSuffix</span><span class="op" id="5263954">(</span><span class="ident" id="5263955">msg</span><span class="op" id="5263958">,</span>&nbsp;<span class="string" id="5263960">&#34;\n&#34;</span><span class="op" id="5263964">)</span>&nbsp;<span class="op" id="5263966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5263970">nl</span>&nbsp;<span class="op" id="5263973">=</span>&nbsp;<span class="string" id="5263975">&#34;\n&#34;</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5263981">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5263985">err</span>&nbsp;<span class="op" id="5263989">:=</span>&nbsp;<span class="ident" id="5263992">w</span><span class="op" id="5263993">.</span><span class="ident" id="5263994">conn</span><span class="op" id="5263998">.</span><span class="ident" id="5263999">writeString</span><span class="op" id="5264010">(</span><span class="ident" id="5264011">p</span><span class="op" id="5264012">,</span>&nbsp;<span class="ident" id="5264014">w</span><span class="op" id="5264015">.</span><span class="ident" id="5264016">hostname</span><span class="op" id="5264024">,</span>&nbsp;<span class="ident" id="5264026">w</span><span class="op" id="5264027">.</span><span class="ident" id="5264028">tag</span><span class="op" id="5264031">,</span>&nbsp;<span class="ident" id="5264033">msg</span><span class="op" id="5264036">,</span>&nbsp;<span class="ident" id="5264038">nl</span><span class="op" id="5264040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5264043">if</span>&nbsp;<span class="ident" id="5264046">err</span>&nbsp;<span class="op" id="5264050">!=</span>&nbsp;<span class="builtintype" id="5264053">nil</span>&nbsp;<span class="op" id="5264057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5264061">return</span>&nbsp;<span class="num" id="5264068">0</span><span class="op" id="5264069">,</span>&nbsp;<span class="ident" id="5264071">err</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5264076">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5264079">//&nbsp;Note:&nbsp;return&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;input,&nbsp;not&nbsp;the&nbsp;number&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5264139">//&nbsp;bytes&nbsp;printed&nbsp;by&nbsp;Fprintf,&nbsp;because&nbsp;this&nbsp;must&nbsp;behave&nbsp;like</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5264199">//&nbsp;an&nbsp;io.Writer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5264217">return</span>&nbsp;<span class="builtinfunc" id="5264224">len</span><span class="op" id="5264227">(</span><span class="ident" id="5264228">msg</span><span class="op" id="5264231">)</span><span class="op" id="5264232">,</span>&nbsp;<span class="builtintype" id="5264234">nil</span><br>
<span class="lineno">285</span><span class="op" id="5264238">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5264241">func</span>&nbsp;<span class="op" id="5264246">(</span><span class="ident" id="5264247">n</span>&nbsp;<span class="op" id="5264249">*</span><span class="ident" id="5264250">netConn</span><span class="op" id="5264257">)</span>&nbsp;<span class="ident" id="5264259">writeString</span><span class="op" id="5264270">(</span><span class="ident" id="5264271">p</span>&nbsp;<span class="ident" id="5264273">Priority</span><span class="op" id="5264281">,</span>&nbsp;<span class="ident" id="5264283">hostname</span><span class="op" id="5264291">,</span>&nbsp;<span class="ident" id="5264293">tag</span><span class="op" id="5264296">,</span>&nbsp;<span class="ident" id="5264298">msg</span><span class="op" id="5264301">,</span>&nbsp;<span class="ident" id="5264303">nl</span>&nbsp;<span class="builtintype" id="5264306">string</span><span class="op" id="5264312">)</span>&nbsp;<span class="builtintype" id="5264314">error</span>&nbsp;<span class="op" id="5264320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5264323">if</span>&nbsp;<span class="ident" id="5264326">n</span><span class="op" id="5264327">.</span><span class="ident" id="5264328">local</span>&nbsp;<span class="op" id="5264334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5264338">//&nbsp;Compared&nbsp;to&nbsp;the&nbsp;network&nbsp;form&nbsp;below,&nbsp;the&nbsp;changes&nbsp;are:</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5264396">//&nbsp;&nbsp;&nbsp;&nbsp;1.&nbsp;Use&nbsp;time.Stamp&nbsp;instead&nbsp;of&nbsp;time.RFC3339.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5264444">//&nbsp;&nbsp;&nbsp;&nbsp;2.&nbsp;Drop&nbsp;the&nbsp;hostname&nbsp;field&nbsp;from&nbsp;the&nbsp;Fprintf.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5264494">timestamp</span>&nbsp;<span class="op" id="5264504">:=</span>&nbsp;<span class="ident" id="5264507">time</span><span class="op" id="5264511">.</span><span class="ident" id="5264512">Now</span><span class="op" id="5264515">(</span><span class="op" id="5264516">)</span><span class="op" id="5264517">.</span><span class="ident" id="5264518">Format</span><span class="op" id="5264524">(</span><span class="ident" id="5264525">time</span><span class="op" id="5264529">.</span><span class="ident" id="5264530">Stamp</span><span class="op" id="5264535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5264539">_</span><span class="op" id="5264540">,</span>&nbsp;<span class="ident" id="5264542">err</span>&nbsp;<span class="op" id="5264546">:=</span>&nbsp;<span class="ident" id="5264549">fmt</span><span class="op" id="5264552">.</span><span class="ident" id="5264553">Fprintf</span><span class="op" id="5264560">(</span><span class="ident" id="5264561">n</span><span class="op" id="5264562">.</span><span class="ident" id="5264563">conn</span><span class="op" id="5264567">,</span>&nbsp;<span class="string" id="5264569">&#34;&lt;%d&gt;%s&nbsp;%s[%d]:&nbsp;%s%s&#34;</span><span class="op" id="5264590">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5264595">p</span><span class="op" id="5264596">,</span>&nbsp;<span class="ident" id="5264598">timestamp</span><span class="op" id="5264607">,</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5264612">tag</span><span class="op" id="5264615">,</span>&nbsp;<span class="ident" id="5264617">os</span><span class="op" id="5264619">.</span><span class="ident" id="5264620">Getpid</span><span class="op" id="5264626">(</span><span class="op" id="5264627">)</span><span class="op" id="5264628">,</span>&nbsp;<span class="ident" id="5264630">msg</span><span class="op" id="5264633">,</span>&nbsp;<span class="ident" id="5264635">nl</span><span class="op" id="5264637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5264641">return</span>&nbsp;<span class="ident" id="5264648">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5264653">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5264656">timestamp</span>&nbsp;<span class="op" id="5264666">:=</span>&nbsp;<span class="ident" id="5264669">time</span><span class="op" id="5264673">.</span><span class="ident" id="5264674">Now</span><span class="op" id="5264677">(</span><span class="op" id="5264678">)</span><span class="op" id="5264679">.</span><span class="ident" id="5264680">Format</span><span class="op" id="5264686">(</span><span class="ident" id="5264687">time</span><span class="op" id="5264691">.</span><span class="ident" id="5264692">RFC3339</span><span class="op" id="5264699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5264702">_</span><span class="op" id="5264703">,</span>&nbsp;<span class="ident" id="5264705">err</span>&nbsp;<span class="op" id="5264709">:=</span>&nbsp;<span class="ident" id="5264712">fmt</span><span class="op" id="5264715">.</span><span class="ident" id="5264716">Fprintf</span><span class="op" id="5264723">(</span><span class="ident" id="5264724">n</span><span class="op" id="5264725">.</span><span class="ident" id="5264726">conn</span><span class="op" id="5264730">,</span>&nbsp;<span class="string" id="5264732">&#34;&lt;%d&gt;%s&nbsp;%s&nbsp;%s[%d]:&nbsp;%s%s&#34;</span><span class="op" id="5264756">,</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5264760">p</span><span class="op" id="5264761">,</span>&nbsp;<span class="ident" id="5264763">timestamp</span><span class="op" id="5264772">,</span>&nbsp;<span class="ident" id="5264774">hostname</span><span class="op" id="5264782">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5264786">tag</span><span class="op" id="5264789">,</span>&nbsp;<span class="ident" id="5264791">os</span><span class="op" id="5264793">.</span><span class="ident" id="5264794">Getpid</span><span class="op" id="5264800">(</span><span class="op" id="5264801">)</span><span class="op" id="5264802">,</span>&nbsp;<span class="ident" id="5264804">msg</span><span class="op" id="5264807">,</span>&nbsp;<span class="ident" id="5264809">nl</span><span class="op" id="5264811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5264814">return</span>&nbsp;<span class="ident" id="5264821">err</span><br>
<span class="lineno"></span><span class="op" id="5264825">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span><span class="keyword" id="5264828">func</span>&nbsp;<span class="op" id="5264833">(</span><span class="ident" id="5264834">n</span>&nbsp;<span class="op" id="5264836">*</span><span class="ident" id="5264837">netConn</span><span class="op" id="5264844">)</span>&nbsp;<span class="builtinfunc" id="5264846">close</span><span class="op" id="5264851">(</span><span class="op" id="5264852">)</span>&nbsp;<span class="builtintype" id="5264854">error</span>&nbsp;<span class="op" id="5264860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5264863">return</span>&nbsp;<span class="ident" id="5264870">n</span><span class="op" id="5264871">.</span><span class="ident" id="5264872">conn</span><span class="op" id="5264876">.</span><span class="ident" id="5264877">Close</span><span class="op" id="5264882">(</span><span class="op" id="5264883">)</span><br>
<span class="lineno"></span><span class="op" id="5264885">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5264888">//&nbsp;NewLogger&nbsp;creates&nbsp;a&nbsp;log.Logger&nbsp;whose&nbsp;output&nbsp;is&nbsp;written&nbsp;to</span><br>
<span class="lineno">310</span><span class="comment" id="5264949">//&nbsp;the&nbsp;system&nbsp;log&nbsp;service&nbsp;with&nbsp;the&nbsp;specified&nbsp;priority.&nbsp;The&nbsp;logFlag</span><br>
<span class="lineno"></span><span class="comment" id="5265016">//&nbsp;argument&nbsp;is&nbsp;the&nbsp;flag&nbsp;set&nbsp;passed&nbsp;through&nbsp;to&nbsp;log.New&nbsp;to&nbsp;create</span><br>
<span class="lineno"></span><span class="comment" id="5265080">//&nbsp;the&nbsp;Logger.</span><br>
<span class="lineno"></span><span class="keyword" id="5265095">func</span>&nbsp;<span class="ident" id="5265100">NewLogger</span><span class="op" id="5265109">(</span><span class="ident" id="5265110">p</span>&nbsp;<span class="ident" id="5265112">Priority</span><span class="op" id="5265120">,</span>&nbsp;<span class="ident" id="5265122">logFlag</span>&nbsp;<span class="builtintype" id="5265130">int</span><span class="op" id="5265133">)</span>&nbsp;<span class="op" id="5265135">(</span><span class="op" id="5265136">*</span><span class="ident" id="5265137">log</span><span class="op" id="5265140">.</span><span class="ident" id="5265141">Logger</span><span class="op" id="5265147">,</span>&nbsp;<span class="builtintype" id="5265149">error</span><span class="op" id="5265154">)</span>&nbsp;<span class="op" id="5265156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5265159">s</span><span class="op" id="5265160">,</span>&nbsp;<span class="ident" id="5265162">err</span>&nbsp;<span class="op" id="5265166">:=</span>&nbsp;<span class="ident" id="5265169">New</span><span class="op" id="5265172">(</span><span class="ident" id="5265173">p</span><span class="op" id="5265174">,</span>&nbsp;<span class="string" id="5265176">&#34;&#34;</span><span class="op" id="5265178">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5265181">if</span>&nbsp;<span class="ident" id="5265184">err</span>&nbsp;<span class="op" id="5265188">!=</span>&nbsp;<span class="builtintype" id="5265191">nil</span>&nbsp;<span class="op" id="5265195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5265199">return</span>&nbsp;<span class="builtintype" id="5265206">nil</span><span class="op" id="5265209">,</span>&nbsp;<span class="ident" id="5265211">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5265216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5265219">return</span>&nbsp;<span class="ident" id="5265226">log</span><span class="op" id="5265229">.</span><span class="ident" id="5265230">New</span><span class="op" id="5265233">(</span><span class="ident" id="5265234">s</span><span class="op" id="5265235">,</span>&nbsp;<span class="string" id="5265237">&#34;&#34;</span><span class="op" id="5265239">,</span>&nbsp;<span class="ident" id="5265241">logFlag</span><span class="op" id="5265248">)</span><span class="op" id="5265249">,</span>&nbsp;<span class="builtintype" id="5265251">nil</span><br>
<span class="lineno"></span><span class="op" id="5265255">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
