<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>mime/multipart</h2>
<ul>
<li><a href="/gostd/mime/multipart/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/mime/multipart/formdata.go.html">formdata.go</a></li>
<li><a href="/gostd/mime/multipart/formdata_test.go.html">formdata_test.go</a></li>
<li><a href="/gostd/mime/multipart/multipart.go.html">multipart.go</a></li>
<li><a href="/gostd/mime/multipart/multipart_test.go.html">multipart_test.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable.go.html">quotedprintable.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable_test.go.html">quotedprintable_test.go</a></li>
<li><a href="/gostd/mime/multipart/writer.go.html">writer.go</a></li>
<li><a href="/gostd/mime/multipart/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6789661">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6789716">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6789770">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6789821">package</span>&nbsp;<span class="ident" id="6789829">multipart</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6789840">import</span>&nbsp;<span class="op" id="6789847">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6789850">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6789859">&#34;io/ioutil&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6789872">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6789883">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6789893">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6789896">func</span>&nbsp;<span class="ident" id="6789901">TestWriter</span><span class="op" id="6789911">(</span><span class="ident" id="6789912">t</span>&nbsp;<span class="op" id="6789914">*</span><span class="ident" id="6789915">testing</span><span class="op" id="6789922">.</span><span class="ident" id="6789923">T</span><span class="op" id="6789924">)</span>&nbsp;<span class="op" id="6789926">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6789929">fileContents</span>&nbsp;<span class="op" id="6789942">:=</span>&nbsp;<span class="op" id="6789945">[</span><span class="op" id="6789946">]</span><span class="builtintype" id="6789947">byte</span><span class="op" id="6789951">(</span><span class="string" id="6789952">&#34;my&nbsp;file&nbsp;contents&#34;</span><span class="op" id="6789970">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6789974">var</span>&nbsp;<span class="ident" id="6789978">b</span>&nbsp;<span class="ident" id="6789980">bytes</span><span class="op" id="6789985">.</span><span class="ident" id="6789986">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6789994">w</span>&nbsp;<span class="op" id="6789996">:=</span>&nbsp;<span class="ident" id="6789999">NewWriter</span><span class="op" id="6790008">(</span><span class="op" id="6790009">&amp;</span><span class="ident" id="6790010">b</span><span class="op" id="6790011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6790014">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6790018">part</span><span class="op" id="6790022">,</span>&nbsp;<span class="ident" id="6790024">err</span>&nbsp;<span class="op" id="6790028">:=</span>&nbsp;<span class="ident" id="6790031">w</span><span class="op" id="6790032">.</span><span class="ident" id="6790033">CreateFormFile</span><span class="op" id="6790047">(</span><span class="string" id="6790048">&#34;myfile&#34;</span><span class="op" id="6790056">,</span>&nbsp;<span class="string" id="6790058">&#34;my-file.txt&#34;</span><span class="op" id="6790071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6790075">if</span>&nbsp;<span class="ident" id="6790078">err</span>&nbsp;<span class="op" id="6790082">!=</span>&nbsp;<span class="ident" id="6790085">nil</span>&nbsp;<span class="op" id="6790089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6790094">t</span><span class="op" id="6790095">.</span><span class="ident" id="6790096">Fatalf</span><span class="op" id="6790102">(</span><span class="string" id="6790103">&#34;CreateFormFile:&nbsp;%v&#34;</span><span class="op" id="6790123">,</span>&nbsp;<span class="ident" id="6790125">err</span><span class="op" id="6790128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6790132">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6790136">part</span><span class="op" id="6790140">.</span><span class="ident" id="6790141">Write</span><span class="op" id="6790146">(</span><span class="ident" id="6790147">fileContents</span><span class="op" id="6790159">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6790163">err</span>&nbsp;<span class="op" id="6790167">=</span>&nbsp;<span class="ident" id="6790169">w</span><span class="op" id="6790170">.</span><span class="ident" id="6790171">WriteField</span><span class="op" id="6790181">(</span><span class="string" id="6790182">&#34;key&#34;</span><span class="op" id="6790187">,</span>&nbsp;<span class="string" id="6790189">&#34;val&#34;</span><span class="op" id="6790194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6790198">if</span>&nbsp;<span class="ident" id="6790201">err</span>&nbsp;<span class="op" id="6790205">!=</span>&nbsp;<span class="ident" id="6790208">nil</span>&nbsp;<span class="op" id="6790212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6790217">t</span><span class="op" id="6790218">.</span><span class="ident" id="6790219">Fatalf</span><span class="op" id="6790225">(</span><span class="string" id="6790226">&#34;WriteField:&nbsp;%v&#34;</span><span class="op" id="6790242">,</span>&nbsp;<span class="ident" id="6790244">err</span><span class="op" id="6790247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6790251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6790255">part</span><span class="op" id="6790259">.</span><span class="ident" id="6790260">Write</span><span class="op" id="6790265">(</span><span class="op" id="6790266">[</span><span class="op" id="6790267">]</span><span class="builtintype" id="6790268">byte</span><span class="op" id="6790272">(</span><span class="string" id="6790273">&#34;val&#34;</span><span class="op" id="6790278">)</span><span class="op" id="6790279">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6790283">err</span>&nbsp;<span class="op" id="6790287">=</span>&nbsp;<span class="ident" id="6790289">w</span><span class="op" id="6790290">.</span><span class="ident" id="6790291">Close</span><span class="op" id="6790296">(</span><span class="op" id="6790297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6790301">if</span>&nbsp;<span class="ident" id="6790304">err</span>&nbsp;<span class="op" id="6790308">!=</span>&nbsp;<span class="ident" id="6790311">nil</span>&nbsp;<span class="op" id="6790315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6790320">t</span><span class="op" id="6790321">.</span><span class="ident" id="6790322">Fatalf</span><span class="op" id="6790328">(</span><span class="string" id="6790329">&#34;Close:&nbsp;%v&#34;</span><span class="op" id="6790340">,</span>&nbsp;<span class="ident" id="6790342">err</span><span class="op" id="6790345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6790349">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6790353">s</span>&nbsp;<span class="op" id="6790355">:=</span>&nbsp;<span class="ident" id="6790358">b</span><span class="op" id="6790359">.</span><span class="ident" id="6790360">String</span><span class="op" id="6790366">(</span><span class="op" id="6790367">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6790371">if</span>&nbsp;<span class="builtinfunc" id="6790374">len</span><span class="op" id="6790377">(</span><span class="ident" id="6790378">s</span><span class="op" id="6790379">)</span>&nbsp;<span class="op" id="6790381">==</span>&nbsp;<span class="num" id="6790384">0</span>&nbsp;<span class="op" id="6790386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6790391">t</span><span class="op" id="6790392">.</span><span class="ident" id="6790393">Fatal</span><span class="op" id="6790398">(</span><span class="string" id="6790399">&#34;String:&nbsp;unexpected&nbsp;empty&nbsp;result&#34;</span><span class="op" id="6790432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6790436">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6790440">if</span>&nbsp;<span class="ident" id="6790443">s</span><span class="op" id="6790444">[</span><span class="num" id="6790445">0</span><span class="op" id="6790446">]</span>&nbsp;<span class="op" id="6790448">==</span>&nbsp;<span class="string" id="6790451">&#39;\r&#39;</span>&nbsp;<span class="op" id="6790456">||</span>&nbsp;<span class="ident" id="6790459">s</span><span class="op" id="6790460">[</span><span class="num" id="6790461">0</span><span class="op" id="6790462">]</span>&nbsp;<span class="op" id="6790464">==</span>&nbsp;<span class="string" id="6790467">&#39;\n&#39;</span>&nbsp;<span class="op" id="6790472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6790477">t</span><span class="op" id="6790478">.</span><span class="ident" id="6790479">Fatal</span><span class="op" id="6790484">(</span><span class="string" id="6790485">&#34;String:&nbsp;unexpected&nbsp;newline&#34;</span><span class="op" id="6790513">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6790517">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6790520">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6790524">r</span>&nbsp;<span class="op" id="6790526">:=</span>&nbsp;<span class="ident" id="6790529">NewReader</span><span class="op" id="6790538">(</span><span class="op" id="6790539">&amp;</span><span class="ident" id="6790540">b</span><span class="op" id="6790541">,</span>&nbsp;<span class="ident" id="6790543">w</span><span class="op" id="6790544">.</span><span class="ident" id="6790545">Boundary</span><span class="op" id="6790553">(</span><span class="op" id="6790554">)</span><span class="op" id="6790555">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6790559">part</span><span class="op" id="6790563">,</span>&nbsp;<span class="ident" id="6790565">err</span>&nbsp;<span class="op" id="6790569">:=</span>&nbsp;<span class="ident" id="6790572">r</span><span class="op" id="6790573">.</span><span class="ident" id="6790574">NextPart</span><span class="op" id="6790582">(</span><span class="op" id="6790583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6790586">if</span>&nbsp;<span class="ident" id="6790589">err</span>&nbsp;<span class="op" id="6790593">!=</span>&nbsp;<span class="ident" id="6790596">nil</span>&nbsp;<span class="op" id="6790600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6790604">t</span><span class="op" id="6790605">.</span><span class="ident" id="6790606">Fatalf</span><span class="op" id="6790612">(</span><span class="string" id="6790613">&#34;part&nbsp;1:&nbsp;%v&#34;</span><span class="op" id="6790625">,</span>&nbsp;<span class="ident" id="6790627">err</span><span class="op" id="6790630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6790633">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6790636">if</span>&nbsp;<span class="ident" id="6790639">g</span><span class="op" id="6790640">,</span>&nbsp;<span class="ident" id="6790642">e</span>&nbsp;<span class="op" id="6790644">:=</span>&nbsp;<span class="ident" id="6790647">part</span><span class="op" id="6790651">.</span><span class="ident" id="6790652">FormName</span><span class="op" id="6790660">(</span><span class="op" id="6790661">)</span><span class="op" id="6790662">,</span>&nbsp;<span class="string" id="6790664">&#34;myfile&#34;</span><span class="op" id="6790672">;</span>&nbsp;<span class="ident" id="6790674">g</span>&nbsp;<span class="op" id="6790676">!=</span>&nbsp;<span class="ident" id="6790679">e</span>&nbsp;<span class="op" id="6790681">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6790685">t</span><span class="op" id="6790686">.</span><span class="ident" id="6790687">Errorf</span><span class="op" id="6790693">(</span><span class="string" id="6790694">&#34;part&nbsp;1:&nbsp;want&nbsp;form&nbsp;name&nbsp;%q,&nbsp;got&nbsp;%q&#34;</span><span class="op" id="6790729">,</span>&nbsp;<span class="ident" id="6790731">e</span><span class="op" id="6790732">,</span>&nbsp;<span class="ident" id="6790734">g</span><span class="op" id="6790735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6790738">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6790741">slurp</span><span class="op" id="6790746">,</span>&nbsp;<span class="ident" id="6790748">err</span>&nbsp;<span class="op" id="6790752">:=</span>&nbsp;<span class="ident" id="6790755">ioutil</span><span class="op" id="6790761">.</span><span class="ident" id="6790762">ReadAll</span><span class="op" id="6790769">(</span><span class="ident" id="6790770">part</span><span class="op" id="6790774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6790777">if</span>&nbsp;<span class="ident" id="6790780">err</span>&nbsp;<span class="op" id="6790784">!=</span>&nbsp;<span class="ident" id="6790787">nil</span>&nbsp;<span class="op" id="6790791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6790795">t</span><span class="op" id="6790796">.</span><span class="ident" id="6790797">Fatalf</span><span class="op" id="6790803">(</span><span class="string" id="6790804">&#34;part&nbsp;1:&nbsp;ReadAll:&nbsp;%v&#34;</span><span class="op" id="6790825">,</span>&nbsp;<span class="ident" id="6790827">err</span><span class="op" id="6790830">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6790833">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6790836">if</span>&nbsp;<span class="ident" id="6790839">e</span><span class="op" id="6790840">,</span>&nbsp;<span class="ident" id="6790842">g</span>&nbsp;<span class="op" id="6790844">:=</span>&nbsp;<span class="builtintype" id="6790847">string</span><span class="op" id="6790853">(</span><span class="ident" id="6790854">fileContents</span><span class="op" id="6790866">)</span><span class="op" id="6790867">,</span>&nbsp;<span class="builtintype" id="6790869">string</span><span class="op" id="6790875">(</span><span class="ident" id="6790876">slurp</span><span class="op" id="6790881">)</span><span class="op" id="6790882">;</span>&nbsp;<span class="ident" id="6790884">e</span>&nbsp;<span class="op" id="6790886">!=</span>&nbsp;<span class="ident" id="6790889">g</span>&nbsp;<span class="op" id="6790891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6790895">t</span><span class="op" id="6790896">.</span><span class="ident" id="6790897">Errorf</span><span class="op" id="6790903">(</span><span class="string" id="6790904">&#34;part&nbsp;1:&nbsp;want&nbsp;contents&nbsp;%q,&nbsp;got&nbsp;%q&#34;</span><span class="op" id="6790938">,</span>&nbsp;<span class="ident" id="6790940">e</span><span class="op" id="6790941">,</span>&nbsp;<span class="ident" id="6790943">g</span><span class="op" id="6790944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6790947">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6790951">part</span><span class="op" id="6790955">,</span>&nbsp;<span class="ident" id="6790957">err</span>&nbsp;<span class="op" id="6790961">=</span>&nbsp;<span class="ident" id="6790963">r</span><span class="op" id="6790964">.</span><span class="ident" id="6790965">NextPart</span><span class="op" id="6790973">(</span><span class="op" id="6790974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6790977">if</span>&nbsp;<span class="ident" id="6790980">err</span>&nbsp;<span class="op" id="6790984">!=</span>&nbsp;<span class="ident" id="6790987">nil</span>&nbsp;<span class="op" id="6790991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6790995">t</span><span class="op" id="6790996">.</span><span class="ident" id="6790997">Fatalf</span><span class="op" id="6791003">(</span><span class="string" id="6791004">&#34;part&nbsp;2:&nbsp;%v&#34;</span><span class="op" id="6791016">,</span>&nbsp;<span class="ident" id="6791018">err</span><span class="op" id="6791021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6791024">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6791027">if</span>&nbsp;<span class="ident" id="6791030">g</span><span class="op" id="6791031">,</span>&nbsp;<span class="ident" id="6791033">e</span>&nbsp;<span class="op" id="6791035">:=</span>&nbsp;<span class="ident" id="6791038">part</span><span class="op" id="6791042">.</span><span class="ident" id="6791043">FormName</span><span class="op" id="6791051">(</span><span class="op" id="6791052">)</span><span class="op" id="6791053">,</span>&nbsp;<span class="string" id="6791055">&#34;key&#34;</span><span class="op" id="6791060">;</span>&nbsp;<span class="ident" id="6791062">g</span>&nbsp;<span class="op" id="6791064">!=</span>&nbsp;<span class="ident" id="6791067">e</span>&nbsp;<span class="op" id="6791069">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6791073">t</span><span class="op" id="6791074">.</span><span class="ident" id="6791075">Errorf</span><span class="op" id="6791081">(</span><span class="string" id="6791082">&#34;part&nbsp;2:&nbsp;want&nbsp;form&nbsp;name&nbsp;%q,&nbsp;got&nbsp;%q&#34;</span><span class="op" id="6791117">,</span>&nbsp;<span class="ident" id="6791119">e</span><span class="op" id="6791120">,</span>&nbsp;<span class="ident" id="6791122">g</span><span class="op" id="6791123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6791126">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6791129">slurp</span><span class="op" id="6791134">,</span>&nbsp;<span class="ident" id="6791136">err</span>&nbsp;<span class="op" id="6791140">=</span>&nbsp;<span class="ident" id="6791142">ioutil</span><span class="op" id="6791148">.</span><span class="ident" id="6791149">ReadAll</span><span class="op" id="6791156">(</span><span class="ident" id="6791157">part</span><span class="op" id="6791161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6791164">if</span>&nbsp;<span class="ident" id="6791167">err</span>&nbsp;<span class="op" id="6791171">!=</span>&nbsp;<span class="ident" id="6791174">nil</span>&nbsp;<span class="op" id="6791178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6791182">t</span><span class="op" id="6791183">.</span><span class="ident" id="6791184">Fatalf</span><span class="op" id="6791190">(</span><span class="string" id="6791191">&#34;part&nbsp;2:&nbsp;ReadAll:&nbsp;%v&#34;</span><span class="op" id="6791212">,</span>&nbsp;<span class="ident" id="6791214">err</span><span class="op" id="6791217">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6791220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6791223">if</span>&nbsp;<span class="ident" id="6791226">e</span><span class="op" id="6791227">,</span>&nbsp;<span class="ident" id="6791229">g</span>&nbsp;<span class="op" id="6791231">:=</span>&nbsp;<span class="string" id="6791234">&#34;val&#34;</span><span class="op" id="6791239">,</span>&nbsp;<span class="builtintype" id="6791241">string</span><span class="op" id="6791247">(</span><span class="ident" id="6791248">slurp</span><span class="op" id="6791253">)</span><span class="op" id="6791254">;</span>&nbsp;<span class="ident" id="6791256">e</span>&nbsp;<span class="op" id="6791258">!=</span>&nbsp;<span class="ident" id="6791261">g</span>&nbsp;<span class="op" id="6791263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6791267">t</span><span class="op" id="6791268">.</span><span class="ident" id="6791269">Errorf</span><span class="op" id="6791275">(</span><span class="string" id="6791276">&#34;part&nbsp;2:&nbsp;want&nbsp;contents&nbsp;%q,&nbsp;got&nbsp;%q&#34;</span><span class="op" id="6791310">,</span>&nbsp;<span class="ident" id="6791312">e</span><span class="op" id="6791313">,</span>&nbsp;<span class="ident" id="6791315">g</span><span class="op" id="6791316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6791319">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6791323">part</span><span class="op" id="6791327">,</span>&nbsp;<span class="ident" id="6791329">err</span>&nbsp;<span class="op" id="6791333">=</span>&nbsp;<span class="ident" id="6791335">r</span><span class="op" id="6791336">.</span><span class="ident" id="6791337">NextPart</span><span class="op" id="6791345">(</span><span class="op" id="6791346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6791349">if</span>&nbsp;<span class="ident" id="6791352">part</span>&nbsp;<span class="op" id="6791357">!=</span>&nbsp;<span class="ident" id="6791360">nil</span>&nbsp;<span class="op" id="6791364">||</span>&nbsp;<span class="ident" id="6791367">err</span>&nbsp;<span class="op" id="6791371">==</span>&nbsp;<span class="ident" id="6791374">nil</span>&nbsp;<span class="op" id="6791378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6791382">t</span><span class="op" id="6791383">.</span><span class="ident" id="6791384">Fatalf</span><span class="op" id="6791390">(</span><span class="string" id="6791391">&#34;expected&nbsp;end&nbsp;of&nbsp;parts;&nbsp;got&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="6791426">,</span>&nbsp;<span class="ident" id="6791428">part</span><span class="op" id="6791432">,</span>&nbsp;<span class="ident" id="6791434">err</span><span class="op" id="6791437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6791440">}</span><br>
<span class="lineno"></span><span class="op" id="6791442">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="keyword" id="6791445">func</span>&nbsp;<span class="ident" id="6791450">TestWriterSetBoundary</span><span class="op" id="6791471">(</span><span class="ident" id="6791472">t</span>&nbsp;<span class="op" id="6791474">*</span><span class="ident" id="6791475">testing</span><span class="op" id="6791482">.</span><span class="ident" id="6791483">T</span><span class="op" id="6791484">)</span>&nbsp;<span class="op" id="6791486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6791489">var</span>&nbsp;<span class="ident" id="6791493">b</span>&nbsp;<span class="ident" id="6791495">bytes</span><span class="op" id="6791500">.</span><span class="ident" id="6791501">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6791509">w</span>&nbsp;<span class="op" id="6791511">:=</span>&nbsp;<span class="ident" id="6791514">NewWriter</span><span class="op" id="6791523">(</span><span class="op" id="6791524">&amp;</span><span class="ident" id="6791525">b</span><span class="op" id="6791526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6791529">tests</span>&nbsp;<span class="op" id="6791535">:=</span>&nbsp;<span class="op" id="6791538">[</span><span class="op" id="6791539">]</span><span class="keyword" id="6791540">struct</span>&nbsp;<span class="op" id="6791547">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6791551">b</span>&nbsp;&nbsp;<span class="builtintype" id="6791554">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6791563">ok</span>&nbsp;<span class="builtintype" id="6791566">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6791572">}</span><span class="op" id="6791573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6791577">{</span><span class="string" id="6791578">&#34;abc&#34;</span><span class="op" id="6791583">,</span>&nbsp;<span class="builtintype" id="6791585">true</span><span class="op" id="6791589">}</span><span class="op" id="6791590">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6791594">{</span><span class="string" id="6791595">&#34;&#34;</span><span class="op" id="6791597">,</span>&nbsp;<span class="builtintype" id="6791599">false</span><span class="op" id="6791604">}</span><span class="op" id="6791605">,</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6791609">{</span><span class="string" id="6791610">&#34;ungültig&#34;</span><span class="op" id="6791621">,</span>&nbsp;<span class="builtintype" id="6791623">false</span><span class="op" id="6791628">}</span><span class="op" id="6791629">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6791633">{</span><span class="string" id="6791634">&#34;!&#34;</span><span class="op" id="6791637">,</span>&nbsp;<span class="builtintype" id="6791639">false</span><span class="op" id="6791644">}</span><span class="op" id="6791645">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6791649">{</span><span class="ident" id="6791650">strings</span><span class="op" id="6791657">.</span><span class="ident" id="6791658">Repeat</span><span class="op" id="6791664">(</span><span class="string" id="6791665">&#34;x&#34;</span><span class="op" id="6791668">,</span>&nbsp;<span class="num" id="6791670">69</span><span class="op" id="6791672">)</span><span class="op" id="6791673">,</span>&nbsp;<span class="builtintype" id="6791675">true</span><span class="op" id="6791679">}</span><span class="op" id="6791680">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6791684">{</span><span class="ident" id="6791685">strings</span><span class="op" id="6791692">.</span><span class="ident" id="6791693">Repeat</span><span class="op" id="6791699">(</span><span class="string" id="6791700">&#34;x&#34;</span><span class="op" id="6791703">,</span>&nbsp;<span class="num" id="6791705">70</span><span class="op" id="6791707">)</span><span class="op" id="6791708">,</span>&nbsp;<span class="builtintype" id="6791710">false</span><span class="op" id="6791715">}</span><span class="op" id="6791716">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6791720">{</span><span class="string" id="6791721">&#34;bad!ascii!&#34;</span><span class="op" id="6791733">,</span>&nbsp;<span class="builtintype" id="6791735">false</span><span class="op" id="6791740">}</span><span class="op" id="6791741">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6791745">{</span><span class="string" id="6791746">&#34;my-separator&#34;</span><span class="op" id="6791760">,</span>&nbsp;<span class="builtintype" id="6791762">true</span><span class="op" id="6791766">}</span><span class="op" id="6791767">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6791770">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6791773">for</span>&nbsp;<span class="ident" id="6791777">i</span><span class="op" id="6791778">,</span>&nbsp;<span class="ident" id="6791780">tt</span>&nbsp;<span class="op" id="6791783">:=</span>&nbsp;<span class="keyword" id="6791786">range</span>&nbsp;<span class="ident" id="6791792">tests</span>&nbsp;<span class="op" id="6791798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6791802">err</span>&nbsp;<span class="op" id="6791806">:=</span>&nbsp;<span class="ident" id="6791809">w</span><span class="op" id="6791810">.</span><span class="ident" id="6791811">SetBoundary</span><span class="op" id="6791822">(</span><span class="ident" id="6791823">tt</span><span class="op" id="6791825">.</span><span class="ident" id="6791826">b</span><span class="op" id="6791827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6791831">got</span>&nbsp;<span class="op" id="6791835">:=</span>&nbsp;<span class="ident" id="6791838">err</span>&nbsp;<span class="op" id="6791842">==</span>&nbsp;<span class="ident" id="6791845">nil</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6791851">if</span>&nbsp;<span class="ident" id="6791854">got</span>&nbsp;<span class="op" id="6791858">!=</span>&nbsp;<span class="ident" id="6791861">tt</span><span class="op" id="6791863">.</span><span class="ident" id="6791864">ok</span>&nbsp;<span class="op" id="6791867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6791872">t</span><span class="op" id="6791873">.</span><span class="ident" id="6791874">Errorf</span><span class="op" id="6791880">(</span><span class="string" id="6791881">&#34;%d.&nbsp;boundary&nbsp;%q&nbsp;=&nbsp;%v&nbsp;(%v);&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6791917">,</span>&nbsp;<span class="ident" id="6791919">i</span><span class="op" id="6791920">,</span>&nbsp;<span class="ident" id="6791922">tt</span><span class="op" id="6791924">.</span><span class="ident" id="6791925">b</span><span class="op" id="6791926">,</span>&nbsp;<span class="ident" id="6791928">got</span><span class="op" id="6791931">,</span>&nbsp;<span class="ident" id="6791933">err</span><span class="op" id="6791936">,</span>&nbsp;<span class="ident" id="6791938">tt</span><span class="op" id="6791940">.</span><span class="ident" id="6791941">ok</span><span class="op" id="6791943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6791947">}</span>&nbsp;<span class="keyword" id="6791949">else</span>&nbsp;<span class="keyword" id="6791954">if</span>&nbsp;<span class="ident" id="6791957">tt</span><span class="op" id="6791959">.</span><span class="ident" id="6791960">ok</span>&nbsp;<span class="op" id="6791963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6791968">got</span>&nbsp;<span class="op" id="6791972">:=</span>&nbsp;<span class="ident" id="6791975">w</span><span class="op" id="6791976">.</span><span class="ident" id="6791977">Boundary</span><span class="op" id="6791985">(</span><span class="op" id="6791986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6791991">if</span>&nbsp;<span class="ident" id="6791994">got</span>&nbsp;<span class="op" id="6791998">!=</span>&nbsp;<span class="ident" id="6792001">tt</span><span class="op" id="6792003">.</span><span class="ident" id="6792004">b</span>&nbsp;<span class="op" id="6792006">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6792012">t</span><span class="op" id="6792013">.</span><span class="ident" id="6792014">Errorf</span><span class="op" id="6792020">(</span><span class="string" id="6792021">&#34;boundary&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6792045">,</span>&nbsp;<span class="ident" id="6792047">got</span><span class="op" id="6792050">,</span>&nbsp;<span class="ident" id="6792052">tt</span><span class="op" id="6792054">.</span><span class="ident" id="6792055">b</span><span class="op" id="6792056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6792061">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6792065">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6792068">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6792071">w</span><span class="op" id="6792072">.</span><span class="ident" id="6792073">Close</span><span class="op" id="6792078">(</span><span class="op" id="6792079">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6792082">if</span>&nbsp;<span class="ident" id="6792085">got</span>&nbsp;<span class="op" id="6792089">:=</span>&nbsp;<span class="ident" id="6792092">b</span><span class="op" id="6792093">.</span><span class="ident" id="6792094">String</span><span class="op" id="6792100">(</span><span class="op" id="6792101">)</span><span class="op" id="6792102">;</span>&nbsp;<span class="op" id="6792104">!</span><span class="ident" id="6792105">strings</span><span class="op" id="6792112">.</span><span class="ident" id="6792113">Contains</span><span class="op" id="6792121">(</span><span class="ident" id="6792122">got</span><span class="op" id="6792125">,</span>&nbsp;<span class="string" id="6792127">&#34;\r\n--my-separator--\r\n&#34;</span><span class="op" id="6792153">)</span>&nbsp;<span class="op" id="6792155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6792159">t</span><span class="op" id="6792160">.</span><span class="ident" id="6792161">Errorf</span><span class="op" id="6792167">(</span><span class="string" id="6792168">&#34;expected&nbsp;my-separator&nbsp;in&nbsp;output.&nbsp;got:&nbsp;%q&#34;</span><span class="op" id="6792210">,</span>&nbsp;<span class="ident" id="6792212">got</span><span class="op" id="6792215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6792218">}</span><br>
<span class="lineno"></span><span class="op" id="6792220">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="6792223">func</span>&nbsp;<span class="ident" id="6792228">TestWriterBoundaryGoroutines</span><span class="op" id="6792256">(</span><span class="ident" id="6792257">t</span>&nbsp;<span class="op" id="6792259">*</span><span class="ident" id="6792260">testing</span><span class="op" id="6792267">.</span><span class="ident" id="6792268">T</span><span class="op" id="6792269">)</span>&nbsp;<span class="op" id="6792271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6792274">//&nbsp;Verify&nbsp;there&#39;s&nbsp;no&nbsp;data&nbsp;race&nbsp;accessing&nbsp;any&nbsp;lazy&nbsp;boundary&nbsp;if&nbsp;it&#39;s&nbsp;used&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6792350">//&nbsp;different&nbsp;goroutines.&nbsp;This&nbsp;was&nbsp;previously&nbsp;broken&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6792406">//&nbsp;https://codereview.appspot.com/95760043/&nbsp;and&nbsp;reverted&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6792467">//&nbsp;https://codereview.appspot.com/117600043/</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6792513">w</span>&nbsp;<span class="op" id="6792515">:=</span>&nbsp;<span class="ident" id="6792518">NewWriter</span><span class="op" id="6792527">(</span><span class="ident" id="6792528">ioutil</span><span class="op" id="6792534">.</span><span class="ident" id="6792535">Discard</span><span class="op" id="6792542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6792545">done</span>&nbsp;<span class="op" id="6792550">:=</span>&nbsp;<span class="builtinfunc" id="6792553">make</span><span class="op" id="6792557">(</span><span class="keyword" id="6792558">chan</span>&nbsp;<span class="builtintype" id="6792563">int</span><span class="op" id="6792566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6792569">go</span>&nbsp;<span class="keyword" id="6792572">func</span><span class="op" id="6792576">(</span><span class="op" id="6792577">)</span>&nbsp;<span class="op" id="6792579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6792583">w</span><span class="op" id="6792584">.</span><span class="ident" id="6792585">CreateFormField</span><span class="op" id="6792600">(</span><span class="string" id="6792601">&#34;foo&#34;</span><span class="op" id="6792606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6792610">done</span>&nbsp;<span class="op" id="6792615">&lt;-</span>&nbsp;<span class="num" id="6792618">1</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6792621">}</span><span class="op" id="6792622">(</span><span class="op" id="6792623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6792626">w</span><span class="op" id="6792627">.</span><span class="ident" id="6792628">Boundary</span><span class="op" id="6792636">(</span><span class="op" id="6792637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6792640">&lt;-</span><span class="ident" id="6792642">done</span><br>
<span class="lineno"></span><span class="op" id="6792647">}</span>
</div>
</body>
</html>
