<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/ast</h2>
<ul>
<li><a href="/gostd/go/ast/ast.go.html">ast.go</a></li>
<li><a href="/gostd/go/ast/ast_test.go.html">ast_test.go</a></li>
<li><a href="/gostd/go/ast/commentmap.go.html">commentmap.go</a></li>
<li><a href="/gostd/go/ast/commentmap_test.go.html">commentmap_test.go</a></li>
<li><a href="/gostd/go/ast/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/ast/filter.go.html" class="current">filter.go</a></li>
<li><a href="/gostd/go/ast/filter_test.go.html">filter_test.go</a></li>
<li><a href="/gostd/go/ast/import.go.html">import.go</a></li>
<li><a href="/gostd/go/ast/print.go.html">print.go</a></li>
<li><a href="/gostd/go/ast/print_test.go.html">print_test.go</a></li>
<li><a href="/gostd/go/ast/resolve.go.html">resolve.go</a></li>
<li><a href="/gostd/go/ast/scope.go.html">scope.go</a></li>
<li><a href="/gostd/go/ast/walk.go.html">walk.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2833485">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2833540">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2833594">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2833645">package</span>&nbsp;<span class="ident" id="2833653">ast</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2833658">import</span>&nbsp;<span class="op" id="2833665">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2833668">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2833680">&#34;sort&#34;</span><br>
<span class="lineno">10</span><span class="op" id="2833687">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2833690">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="2833770">//&nbsp;Export&nbsp;filtering</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="2833791">//&nbsp;exportFilter&nbsp;is&nbsp;a&nbsp;special&nbsp;filter&nbsp;function&nbsp;to&nbsp;extract&nbsp;exported&nbsp;nodes.</span><br>
<span class="lineno"></span><span class="keyword" id="2833863">func</span>&nbsp;<span class="ident" id="2833868">exportFilter</span><span class="op" id="2833880">(</span><span class="ident" id="2833881">name</span>&nbsp;<span class="builtintype" id="2833886">string</span><span class="op" id="2833892">)</span>&nbsp;<span class="builtintype" id="2833894">bool</span>&nbsp;<span class="op" id="2833899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2833902">return</span>&nbsp;<span class="ident" id="2833909">IsExported</span><span class="op" id="2833919">(</span><span class="ident" id="2833920">name</span><span class="op" id="2833924">)</span><br>
<span class="lineno"></span><span class="op" id="2833926">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="2833929">//&nbsp;FileExports&nbsp;trims&nbsp;the&nbsp;AST&nbsp;for&nbsp;a&nbsp;Go&nbsp;source&nbsp;file&nbsp;in&nbsp;place&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="2833998">//&nbsp;only&nbsp;exported&nbsp;nodes&nbsp;remain:&nbsp;all&nbsp;top-level&nbsp;identifiers&nbsp;which&nbsp;are&nbsp;not&nbsp;exported</span><br>
<span class="lineno"></span><span class="comment" id="2834078">//&nbsp;and&nbsp;their&nbsp;associated&nbsp;information&nbsp;(such&nbsp;as&nbsp;type,&nbsp;initial&nbsp;value,&nbsp;or&nbsp;function</span><br>
<span class="lineno"></span><span class="comment" id="2834156">//&nbsp;body)&nbsp;are&nbsp;removed.&nbsp;Non-exported&nbsp;fields&nbsp;and&nbsp;methods&nbsp;of&nbsp;exported&nbsp;types&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="2834232">//&nbsp;stripped.&nbsp;The&nbsp;File.Comments&nbsp;list&nbsp;is&nbsp;not&nbsp;changed.</span><br>
<span class="lineno">25</span><span class="comment" id="2834284">//</span><br>
<span class="lineno"></span><span class="comment" id="2834287">//&nbsp;FileExports&nbsp;returns&nbsp;true&nbsp;if&nbsp;there&nbsp;are&nbsp;exported&nbsp;declarations;</span><br>
<span class="lineno"></span><span class="comment" id="2834351">//&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="2834382">//</span><br>
<span class="lineno"></span><span class="keyword" id="2834385">func</span>&nbsp;<span class="ident" id="2834390">FileExports</span><span class="op" id="2834401">(</span><span class="ident" id="2834402">src</span>&nbsp;<span class="op" id="2834406">*</span><span class="ident" id="2834407">File</span><span class="op" id="2834411">)</span>&nbsp;<span class="builtintype" id="2834413">bool</span>&nbsp;<span class="op" id="2834418">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2834421">return</span>&nbsp;<span class="ident" id="2834428">filterFile</span><span class="op" id="2834438">(</span><span class="ident" id="2834439">src</span><span class="op" id="2834442">,</span>&nbsp;<span class="ident" id="2834444">exportFilter</span><span class="op" id="2834456">,</span>&nbsp;<span class="builtintype" id="2834458">true</span><span class="op" id="2834462">)</span><br>
<span class="lineno"></span><span class="op" id="2834464">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2834467">//&nbsp;PackageExports&nbsp;trims&nbsp;the&nbsp;AST&nbsp;for&nbsp;a&nbsp;Go&nbsp;package&nbsp;in&nbsp;place&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="2834535">//&nbsp;only&nbsp;exported&nbsp;nodes&nbsp;remain.&nbsp;The&nbsp;pkg.Files&nbsp;list&nbsp;is&nbsp;not&nbsp;changed,&nbsp;so&nbsp;that</span><br>
<span class="lineno">35</span><span class="comment" id="2834609">//&nbsp;file&nbsp;names&nbsp;and&nbsp;top-level&nbsp;package&nbsp;comments&nbsp;don&#39;t&nbsp;get&nbsp;lost.</span><br>
<span class="lineno"></span><span class="comment" id="2834670">//</span><br>
<span class="lineno"></span><span class="comment" id="2834673">//&nbsp;PackageExports&nbsp;returns&nbsp;true&nbsp;if&nbsp;there&nbsp;are&nbsp;exported&nbsp;declarations;</span><br>
<span class="lineno"></span><span class="comment" id="2834740">//&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="2834771">//</span><br>
<span class="lineno">40</span><span class="keyword" id="2834774">func</span>&nbsp;<span class="ident" id="2834779">PackageExports</span><span class="op" id="2834793">(</span><span class="ident" id="2834794">pkg</span>&nbsp;<span class="op" id="2834798">*</span><span class="ident" id="2834799">Package</span><span class="op" id="2834806">)</span>&nbsp;<span class="builtintype" id="2834808">bool</span>&nbsp;<span class="op" id="2834813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2834816">return</span>&nbsp;<span class="ident" id="2834823">filterPackage</span><span class="op" id="2834836">(</span><span class="ident" id="2834837">pkg</span><span class="op" id="2834840">,</span>&nbsp;<span class="ident" id="2834842">exportFilter</span><span class="op" id="2834854">,</span>&nbsp;<span class="builtintype" id="2834856">true</span><span class="op" id="2834860">)</span><br>
<span class="lineno"></span><span class="op" id="2834862">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2834865">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno">45</span><span class="comment" id="2834945">//&nbsp;General&nbsp;filtering</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2834967">type</span>&nbsp;<span class="ident" id="2834972">Filter</span>&nbsp;<span class="keyword" id="2834979">func</span><span class="op" id="2834983">(</span><span class="builtintype" id="2834984">string</span><span class="op" id="2834990">)</span>&nbsp;<span class="builtintype" id="2834992">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2834998">func</span>&nbsp;<span class="ident" id="2835003">filterIdentList</span><span class="op" id="2835018">(</span><span class="ident" id="2835019">list</span>&nbsp;<span class="op" id="2835024">[</span><span class="op" id="2835025">]</span><span class="op" id="2835026">*</span><span class="ident" id="2835027">Ident</span><span class="op" id="2835032">,</span>&nbsp;<span class="ident" id="2835034">f</span>&nbsp;<span class="ident" id="2835036">Filter</span><span class="op" id="2835042">)</span>&nbsp;<span class="op" id="2835044">[</span><span class="op" id="2835045">]</span><span class="op" id="2835046">*</span><span class="ident" id="2835047">Ident</span>&nbsp;<span class="op" id="2835053">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2835056">j</span>&nbsp;<span class="op" id="2835058">:=</span>&nbsp;<span class="num" id="2835061">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2835064">for</span>&nbsp;<span class="ident" id="2835068">_</span><span class="op" id="2835069">,</span>&nbsp;<span class="ident" id="2835071">x</span>&nbsp;<span class="op" id="2835073">:=</span>&nbsp;<span class="keyword" id="2835076">range</span>&nbsp;<span class="ident" id="2835082">list</span>&nbsp;<span class="op" id="2835087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2835091">if</span>&nbsp;<span class="ident" id="2835094">f</span><span class="op" id="2835095">(</span><span class="ident" id="2835096">x</span><span class="op" id="2835097">.</span><span class="ident" id="2835098">Name</span><span class="op" id="2835102">)</span>&nbsp;<span class="op" id="2835104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2835109">list</span><span class="op" id="2835113">[</span><span class="ident" id="2835114">j</span><span class="op" id="2835115">]</span>&nbsp;<span class="op" id="2835117">=</span>&nbsp;<span class="ident" id="2835119">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2835124">j</span><span class="op" id="2835125">++</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2835130">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2835133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2835136">return</span>&nbsp;<span class="ident" id="2835143">list</span><span class="op" id="2835147">[</span><span class="num" id="2835148">0</span><span class="op" id="2835149">:</span><span class="ident" id="2835150">j</span><span class="op" id="2835151">]</span><br>
<span class="lineno"></span><span class="op" id="2835153">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="2835156">//&nbsp;fieldName&nbsp;assumes&nbsp;that&nbsp;x&nbsp;is&nbsp;the&nbsp;type&nbsp;of&nbsp;an&nbsp;anonymous&nbsp;field&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2835222">//&nbsp;returns&nbsp;the&nbsp;corresponding&nbsp;field&nbsp;name.&nbsp;If&nbsp;x&nbsp;is&nbsp;not&nbsp;an&nbsp;acceptable</span><br>
<span class="lineno"></span><span class="comment" id="2835289">//&nbsp;anonymous&nbsp;field,&nbsp;the&nbsp;result&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="comment" id="2835328">//</span><br>
<span class="lineno"></span><span class="keyword" id="2835331">func</span>&nbsp;<span class="ident" id="2835336">fieldName</span><span class="op" id="2835345">(</span><span class="ident" id="2835346">x</span>&nbsp;<span class="ident" id="2835348">Expr</span><span class="op" id="2835352">)</span>&nbsp;<span class="op" id="2835354">*</span><span class="ident" id="2835355">Ident</span>&nbsp;<span class="op" id="2835361">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2835364">switch</span>&nbsp;<span class="ident" id="2835371">t</span>&nbsp;<span class="op" id="2835373">:=</span>&nbsp;<span class="ident" id="2835376">x</span><span class="op" id="2835377">.</span><span class="op" id="2835378">(</span><span class="keyword" id="2835379">type</span><span class="op" id="2835383">)</span>&nbsp;<span class="op" id="2835385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2835388">case</span>&nbsp;<span class="op" id="2835393">*</span><span class="ident" id="2835394">Ident</span><span class="op" id="2835399">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2835403">return</span>&nbsp;<span class="ident" id="2835410">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2835413">case</span>&nbsp;<span class="op" id="2835418">*</span><span class="ident" id="2835419">SelectorExpr</span><span class="op" id="2835431">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2835435">if</span>&nbsp;<span class="ident" id="2835438">_</span><span class="op" id="2835439">,</span>&nbsp;<span class="ident" id="2835441">ok</span>&nbsp;<span class="op" id="2835444">:=</span>&nbsp;<span class="ident" id="2835447">t</span><span class="op" id="2835448">.</span><span class="ident" id="2835449">X</span><span class="op" id="2835450">.</span><span class="op" id="2835451">(</span><span class="op" id="2835452">*</span><span class="ident" id="2835453">Ident</span><span class="op" id="2835458">)</span><span class="op" id="2835459">;</span>&nbsp;<span class="ident" id="2835461">ok</span>&nbsp;<span class="op" id="2835464">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2835469">return</span>&nbsp;<span class="ident" id="2835476">t</span><span class="op" id="2835477">.</span><span class="ident" id="2835478">Sel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2835484">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2835487">case</span>&nbsp;<span class="op" id="2835492">*</span><span class="ident" id="2835493">StarExpr</span><span class="op" id="2835501">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2835505">return</span>&nbsp;<span class="ident" id="2835512">fieldName</span><span class="op" id="2835521">(</span><span class="ident" id="2835522">t</span><span class="op" id="2835523">.</span><span class="ident" id="2835524">X</span><span class="op" id="2835525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2835528">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2835531">return</span>&nbsp;<span class="ident" id="2835538">nil</span><br>
<span class="lineno"></span><span class="op" id="2835542">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2835545">func</span>&nbsp;<span class="ident" id="2835550">filterFieldList</span><span class="op" id="2835565">(</span><span class="ident" id="2835566">fields</span>&nbsp;<span class="op" id="2835573">*</span><span class="ident" id="2835574">FieldList</span><span class="op" id="2835583">,</span>&nbsp;<span class="ident" id="2835585">filter</span>&nbsp;<span class="ident" id="2835592">Filter</span><span class="op" id="2835598">,</span>&nbsp;<span class="ident" id="2835600">export</span>&nbsp;<span class="builtintype" id="2835607">bool</span><span class="op" id="2835611">)</span>&nbsp;<span class="op" id="2835613">(</span><span class="ident" id="2835614">removedFields</span>&nbsp;<span class="builtintype" id="2835628">bool</span><span class="op" id="2835632">)</span>&nbsp;<span class="op" id="2835634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2835637">if</span>&nbsp;<span class="ident" id="2835640">fields</span>&nbsp;<span class="op" id="2835647">==</span>&nbsp;<span class="ident" id="2835650">nil</span>&nbsp;<span class="op" id="2835654">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2835658">return</span>&nbsp;<span class="builtintype" id="2835665">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2835672">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2835675">list</span>&nbsp;<span class="op" id="2835680">:=</span>&nbsp;<span class="ident" id="2835683">fields</span><span class="op" id="2835689">.</span><span class="ident" id="2835690">List</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2835696">j</span>&nbsp;<span class="op" id="2835698">:=</span>&nbsp;<span class="num" id="2835701">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2835704">for</span>&nbsp;<span class="ident" id="2835708">_</span><span class="op" id="2835709">,</span>&nbsp;<span class="ident" id="2835711">f</span>&nbsp;<span class="op" id="2835713">:=</span>&nbsp;<span class="keyword" id="2835716">range</span>&nbsp;<span class="ident" id="2835722">list</span>&nbsp;<span class="op" id="2835727">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2835731">keepField</span>&nbsp;<span class="op" id="2835741">:=</span>&nbsp;<span class="builtintype" id="2835744">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2835752">if</span>&nbsp;<span class="builtinfunc" id="2835755">len</span><span class="op" id="2835758">(</span><span class="ident" id="2835759">f</span><span class="op" id="2835760">.</span><span class="ident" id="2835761">Names</span><span class="op" id="2835766">)</span>&nbsp;<span class="op" id="2835768">==</span>&nbsp;<span class="num" id="2835771">0</span>&nbsp;<span class="op" id="2835773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2835778">//&nbsp;anonymous&nbsp;field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2835800">name</span>&nbsp;<span class="op" id="2835805">:=</span>&nbsp;<span class="ident" id="2835808">fieldName</span><span class="op" id="2835817">(</span><span class="ident" id="2835818">f</span><span class="op" id="2835819">.</span><span class="ident" id="2835820">Type</span><span class="op" id="2835824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2835829">keepField</span>&nbsp;<span class="op" id="2835839">=</span>&nbsp;<span class="ident" id="2835841">name</span>&nbsp;<span class="op" id="2835846">!=</span>&nbsp;<span class="ident" id="2835849">nil</span>&nbsp;<span class="op" id="2835853">&amp;&amp;</span>&nbsp;<span class="ident" id="2835856">filter</span><span class="op" id="2835862">(</span><span class="ident" id="2835863">name</span><span class="op" id="2835867">.</span><span class="ident" id="2835868">Name</span><span class="op" id="2835872">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2835876">}</span>&nbsp;<span class="keyword" id="2835878">else</span>&nbsp;<span class="op" id="2835883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2835888">n</span>&nbsp;<span class="op" id="2835890">:=</span>&nbsp;<span class="builtinfunc" id="2835893">len</span><span class="op" id="2835896">(</span><span class="ident" id="2835897">f</span><span class="op" id="2835898">.</span><span class="ident" id="2835899">Names</span><span class="op" id="2835904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2835909">f</span><span class="op" id="2835910">.</span><span class="ident" id="2835911">Names</span>&nbsp;<span class="op" id="2835917">=</span>&nbsp;<span class="ident" id="2835919">filterIdentList</span><span class="op" id="2835934">(</span><span class="ident" id="2835935">f</span><span class="op" id="2835936">.</span><span class="ident" id="2835937">Names</span><span class="op" id="2835942">,</span>&nbsp;<span class="ident" id="2835944">filter</span><span class="op" id="2835950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2835955">if</span>&nbsp;<span class="builtinfunc" id="2835958">len</span><span class="op" id="2835961">(</span><span class="ident" id="2835962">f</span><span class="op" id="2835963">.</span><span class="ident" id="2835964">Names</span><span class="op" id="2835969">)</span>&nbsp;<span class="op" id="2835971">&lt;</span>&nbsp;<span class="ident" id="2835973">n</span>&nbsp;<span class="op" id="2835975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2835981">removedFields</span>&nbsp;<span class="op" id="2835995">=</span>&nbsp;<span class="builtintype" id="2835997">true</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2836005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2836010">keepField</span>&nbsp;<span class="op" id="2836020">=</span>&nbsp;<span class="builtinfunc" id="2836022">len</span><span class="op" id="2836025">(</span><span class="ident" id="2836026">f</span><span class="op" id="2836027">.</span><span class="ident" id="2836028">Names</span><span class="op" id="2836033">)</span>&nbsp;<span class="op" id="2836035">&gt;</span>&nbsp;<span class="num" id="2836037">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2836041">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2836045">if</span>&nbsp;<span class="ident" id="2836048">keepField</span>&nbsp;<span class="op" id="2836058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2836063">if</span>&nbsp;<span class="ident" id="2836066">export</span>&nbsp;<span class="op" id="2836073">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2836079">filterType</span><span class="op" id="2836089">(</span><span class="ident" id="2836090">f</span><span class="op" id="2836091">.</span><span class="ident" id="2836092">Type</span><span class="op" id="2836096">,</span>&nbsp;<span class="ident" id="2836098">filter</span><span class="op" id="2836104">,</span>&nbsp;<span class="ident" id="2836106">export</span><span class="op" id="2836112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2836117">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2836122">list</span><span class="op" id="2836126">[</span><span class="ident" id="2836127">j</span><span class="op" id="2836128">]</span>&nbsp;<span class="op" id="2836130">=</span>&nbsp;<span class="ident" id="2836132">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2836137">j</span><span class="op" id="2836138">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2836143">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2836146">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2836149">if</span>&nbsp;<span class="ident" id="2836152">j</span>&nbsp;<span class="op" id="2836154">&lt;</span>&nbsp;<span class="builtinfunc" id="2836156">len</span><span class="op" id="2836159">(</span><span class="ident" id="2836160">list</span><span class="op" id="2836164">)</span>&nbsp;<span class="op" id="2836166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2836170">removedFields</span>&nbsp;<span class="op" id="2836184">=</span>&nbsp;<span class="builtintype" id="2836186">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2836192">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2836195">fields</span><span class="op" id="2836201">.</span><span class="ident" id="2836202">List</span>&nbsp;<span class="op" id="2836207">=</span>&nbsp;<span class="ident" id="2836209">list</span><span class="op" id="2836213">[</span><span class="num" id="2836214">0</span><span class="op" id="2836215">:</span><span class="ident" id="2836216">j</span><span class="op" id="2836217">]</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2836220">return</span><br>
<span class="lineno"></span><span class="op" id="2836227">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2836230">func</span>&nbsp;<span class="ident" id="2836235">filterParamList</span><span class="op" id="2836250">(</span><span class="ident" id="2836251">fields</span>&nbsp;<span class="op" id="2836258">*</span><span class="ident" id="2836259">FieldList</span><span class="op" id="2836268">,</span>&nbsp;<span class="ident" id="2836270">filter</span>&nbsp;<span class="ident" id="2836277">Filter</span><span class="op" id="2836283">,</span>&nbsp;<span class="ident" id="2836285">export</span>&nbsp;<span class="builtintype" id="2836292">bool</span><span class="op" id="2836296">)</span>&nbsp;<span class="builtintype" id="2836298">bool</span>&nbsp;<span class="op" id="2836303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2836306">if</span>&nbsp;<span class="ident" id="2836309">fields</span>&nbsp;<span class="op" id="2836316">==</span>&nbsp;<span class="ident" id="2836319">nil</span>&nbsp;<span class="op" id="2836323">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2836327">return</span>&nbsp;<span class="builtintype" id="2836334">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2836341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2836344">var</span>&nbsp;<span class="ident" id="2836348">b</span>&nbsp;<span class="builtintype" id="2836350">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2836356">for</span>&nbsp;<span class="ident" id="2836360">_</span><span class="op" id="2836361">,</span>&nbsp;<span class="ident" id="2836363">f</span>&nbsp;<span class="op" id="2836365">:=</span>&nbsp;<span class="keyword" id="2836368">range</span>&nbsp;<span class="ident" id="2836374">fields</span><span class="op" id="2836380">.</span><span class="ident" id="2836381">List</span>&nbsp;<span class="op" id="2836386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2836390">if</span>&nbsp;<span class="ident" id="2836393">filterType</span><span class="op" id="2836403">(</span><span class="ident" id="2836404">f</span><span class="op" id="2836405">.</span><span class="ident" id="2836406">Type</span><span class="op" id="2836410">,</span>&nbsp;<span class="ident" id="2836412">filter</span><span class="op" id="2836418">,</span>&nbsp;<span class="ident" id="2836420">export</span><span class="op" id="2836426">)</span>&nbsp;<span class="op" id="2836428">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2836433">b</span>&nbsp;<span class="op" id="2836435">=</span>&nbsp;<span class="builtintype" id="2836437">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2836444">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2836447">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2836450">return</span>&nbsp;<span class="ident" id="2836457">b</span><br>
<span class="lineno"></span><span class="op" id="2836459">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="2836462">func</span>&nbsp;<span class="ident" id="2836467">filterType</span><span class="op" id="2836477">(</span><span class="ident" id="2836478">typ</span>&nbsp;<span class="ident" id="2836482">Expr</span><span class="op" id="2836486">,</span>&nbsp;<span class="ident" id="2836488">f</span>&nbsp;<span class="ident" id="2836490">Filter</span><span class="op" id="2836496">,</span>&nbsp;<span class="ident" id="2836498">export</span>&nbsp;<span class="builtintype" id="2836505">bool</span><span class="op" id="2836509">)</span>&nbsp;<span class="builtintype" id="2836511">bool</span>&nbsp;<span class="op" id="2836516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2836519">switch</span>&nbsp;<span class="ident" id="2836526">t</span>&nbsp;<span class="op" id="2836528">:=</span>&nbsp;<span class="ident" id="2836531">typ</span><span class="op" id="2836534">.</span><span class="op" id="2836535">(</span><span class="keyword" id="2836536">type</span><span class="op" id="2836540">)</span>&nbsp;<span class="op" id="2836542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2836545">case</span>&nbsp;<span class="op" id="2836550">*</span><span class="ident" id="2836551">Ident</span><span class="op" id="2836556">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2836560">return</span>&nbsp;<span class="ident" id="2836567">f</span><span class="op" id="2836568">(</span><span class="ident" id="2836569">t</span><span class="op" id="2836570">.</span><span class="ident" id="2836571">Name</span><span class="op" id="2836575">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2836578">case</span>&nbsp;<span class="op" id="2836583">*</span><span class="ident" id="2836584">ParenExpr</span><span class="op" id="2836593">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2836597">return</span>&nbsp;<span class="ident" id="2836604">filterType</span><span class="op" id="2836614">(</span><span class="ident" id="2836615">t</span><span class="op" id="2836616">.</span><span class="ident" id="2836617">X</span><span class="op" id="2836618">,</span>&nbsp;<span class="ident" id="2836620">f</span><span class="op" id="2836621">,</span>&nbsp;<span class="ident" id="2836623">export</span><span class="op" id="2836629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2836632">case</span>&nbsp;<span class="op" id="2836637">*</span><span class="ident" id="2836638">ArrayType</span><span class="op" id="2836647">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2836651">return</span>&nbsp;<span class="ident" id="2836658">filterType</span><span class="op" id="2836668">(</span><span class="ident" id="2836669">t</span><span class="op" id="2836670">.</span><span class="ident" id="2836671">Elt</span><span class="op" id="2836674">,</span>&nbsp;<span class="ident" id="2836676">f</span><span class="op" id="2836677">,</span>&nbsp;<span class="ident" id="2836679">export</span><span class="op" id="2836685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2836688">case</span>&nbsp;<span class="op" id="2836693">*</span><span class="ident" id="2836694">StructType</span><span class="op" id="2836704">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2836708">if</span>&nbsp;<span class="ident" id="2836711">filterFieldList</span><span class="op" id="2836726">(</span><span class="ident" id="2836727">t</span><span class="op" id="2836728">.</span><span class="ident" id="2836729">Fields</span><span class="op" id="2836735">,</span>&nbsp;<span class="ident" id="2836737">f</span><span class="op" id="2836738">,</span>&nbsp;<span class="ident" id="2836740">export</span><span class="op" id="2836746">)</span>&nbsp;<span class="op" id="2836748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2836753">t</span><span class="op" id="2836754">.</span><span class="ident" id="2836755">Incomplete</span>&nbsp;<span class="op" id="2836766">=</span>&nbsp;<span class="builtintype" id="2836768">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2836775">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2836779">return</span>&nbsp;<span class="builtinfunc" id="2836786">len</span><span class="op" id="2836789">(</span><span class="ident" id="2836790">t</span><span class="op" id="2836791">.</span><span class="ident" id="2836792">Fields</span><span class="op" id="2836798">.</span><span class="ident" id="2836799">List</span><span class="op" id="2836803">)</span>&nbsp;<span class="op" id="2836805">&gt;</span>&nbsp;<span class="num" id="2836807">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2836810">case</span>&nbsp;<span class="op" id="2836815">*</span><span class="ident" id="2836816">FuncType</span><span class="op" id="2836824">:</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2836828">b1</span>&nbsp;<span class="op" id="2836831">:=</span>&nbsp;<span class="ident" id="2836834">filterParamList</span><span class="op" id="2836849">(</span><span class="ident" id="2836850">t</span><span class="op" id="2836851">.</span><span class="ident" id="2836852">Params</span><span class="op" id="2836858">,</span>&nbsp;<span class="ident" id="2836860">f</span><span class="op" id="2836861">,</span>&nbsp;<span class="ident" id="2836863">export</span><span class="op" id="2836869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2836873">b2</span>&nbsp;<span class="op" id="2836876">:=</span>&nbsp;<span class="ident" id="2836879">filterParamList</span><span class="op" id="2836894">(</span><span class="ident" id="2836895">t</span><span class="op" id="2836896">.</span><span class="ident" id="2836897">Results</span><span class="op" id="2836904">,</span>&nbsp;<span class="ident" id="2836906">f</span><span class="op" id="2836907">,</span>&nbsp;<span class="ident" id="2836909">export</span><span class="op" id="2836915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2836919">return</span>&nbsp;<span class="ident" id="2836926">b1</span>&nbsp;<span class="op" id="2836929">||</span>&nbsp;<span class="ident" id="2836932">b2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2836936">case</span>&nbsp;<span class="op" id="2836941">*</span><span class="ident" id="2836942">InterfaceType</span><span class="op" id="2836955">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2836959">if</span>&nbsp;<span class="ident" id="2836962">filterFieldList</span><span class="op" id="2836977">(</span><span class="ident" id="2836978">t</span><span class="op" id="2836979">.</span><span class="ident" id="2836980">Methods</span><span class="op" id="2836987">,</span>&nbsp;<span class="ident" id="2836989">f</span><span class="op" id="2836990">,</span>&nbsp;<span class="ident" id="2836992">export</span><span class="op" id="2836998">)</span>&nbsp;<span class="op" id="2837000">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2837005">t</span><span class="op" id="2837006">.</span><span class="ident" id="2837007">Incomplete</span>&nbsp;<span class="op" id="2837018">=</span>&nbsp;<span class="builtintype" id="2837020">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2837027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2837031">return</span>&nbsp;<span class="builtinfunc" id="2837038">len</span><span class="op" id="2837041">(</span><span class="ident" id="2837042">t</span><span class="op" id="2837043">.</span><span class="ident" id="2837044">Methods</span><span class="op" id="2837051">.</span><span class="ident" id="2837052">List</span><span class="op" id="2837056">)</span>&nbsp;<span class="op" id="2837058">&gt;</span>&nbsp;<span class="num" id="2837060">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2837063">case</span>&nbsp;<span class="op" id="2837068">*</span><span class="ident" id="2837069">MapType</span><span class="op" id="2837076">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2837080">b1</span>&nbsp;<span class="op" id="2837083">:=</span>&nbsp;<span class="ident" id="2837086">filterType</span><span class="op" id="2837096">(</span><span class="ident" id="2837097">t</span><span class="op" id="2837098">.</span><span class="ident" id="2837099">Key</span><span class="op" id="2837102">,</span>&nbsp;<span class="ident" id="2837104">f</span><span class="op" id="2837105">,</span>&nbsp;<span class="ident" id="2837107">export</span><span class="op" id="2837113">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2837117">b2</span>&nbsp;<span class="op" id="2837120">:=</span>&nbsp;<span class="ident" id="2837123">filterType</span><span class="op" id="2837133">(</span><span class="ident" id="2837134">t</span><span class="op" id="2837135">.</span><span class="ident" id="2837136">Value</span><span class="op" id="2837141">,</span>&nbsp;<span class="ident" id="2837143">f</span><span class="op" id="2837144">,</span>&nbsp;<span class="ident" id="2837146">export</span><span class="op" id="2837152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2837156">return</span>&nbsp;<span class="ident" id="2837163">b1</span>&nbsp;<span class="op" id="2837166">||</span>&nbsp;<span class="ident" id="2837169">b2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2837173">case</span>&nbsp;<span class="op" id="2837178">*</span><span class="ident" id="2837179">ChanType</span><span class="op" id="2837187">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2837191">return</span>&nbsp;<span class="ident" id="2837198">filterType</span><span class="op" id="2837208">(</span><span class="ident" id="2837209">t</span><span class="op" id="2837210">.</span><span class="ident" id="2837211">Value</span><span class="op" id="2837216">,</span>&nbsp;<span class="ident" id="2837218">f</span><span class="op" id="2837219">,</span>&nbsp;<span class="ident" id="2837221">export</span><span class="op" id="2837227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2837230">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2837233">return</span>&nbsp;<span class="builtintype" id="2837240">false</span><br>
<span class="lineno"></span><span class="op" id="2837246">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2837249">func</span>&nbsp;<span class="ident" id="2837254">filterSpec</span><span class="op" id="2837264">(</span><span class="ident" id="2837265">spec</span>&nbsp;<span class="ident" id="2837270">Spec</span><span class="op" id="2837274">,</span>&nbsp;<span class="ident" id="2837276">f</span>&nbsp;<span class="ident" id="2837278">Filter</span><span class="op" id="2837284">,</span>&nbsp;<span class="ident" id="2837286">export</span>&nbsp;<span class="builtintype" id="2837293">bool</span><span class="op" id="2837297">)</span>&nbsp;<span class="builtintype" id="2837299">bool</span>&nbsp;<span class="op" id="2837304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2837307">switch</span>&nbsp;<span class="ident" id="2837314">s</span>&nbsp;<span class="op" id="2837316">:=</span>&nbsp;<span class="ident" id="2837319">spec</span><span class="op" id="2837323">.</span><span class="op" id="2837324">(</span><span class="keyword" id="2837325">type</span><span class="op" id="2837329">)</span>&nbsp;<span class="op" id="2837331">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2837334">case</span>&nbsp;<span class="op" id="2837339">*</span><span class="ident" id="2837340">ValueSpec</span><span class="op" id="2837349">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2837353">s</span><span class="op" id="2837354">.</span><span class="ident" id="2837355">Names</span>&nbsp;<span class="op" id="2837361">=</span>&nbsp;<span class="ident" id="2837363">filterIdentList</span><span class="op" id="2837378">(</span><span class="ident" id="2837379">s</span><span class="op" id="2837380">.</span><span class="ident" id="2837381">Names</span><span class="op" id="2837386">,</span>&nbsp;<span class="ident" id="2837388">f</span><span class="op" id="2837389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2837393">if</span>&nbsp;<span class="builtinfunc" id="2837396">len</span><span class="op" id="2837399">(</span><span class="ident" id="2837400">s</span><span class="op" id="2837401">.</span><span class="ident" id="2837402">Names</span><span class="op" id="2837407">)</span>&nbsp;<span class="op" id="2837409">&gt;</span>&nbsp;<span class="num" id="2837411">0</span>&nbsp;<span class="op" id="2837413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2837418">if</span>&nbsp;<span class="ident" id="2837421">export</span>&nbsp;<span class="op" id="2837428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2837434">filterType</span><span class="op" id="2837444">(</span><span class="ident" id="2837445">s</span><span class="op" id="2837446">.</span><span class="ident" id="2837447">Type</span><span class="op" id="2837451">,</span>&nbsp;<span class="ident" id="2837453">f</span><span class="op" id="2837454">,</span>&nbsp;<span class="ident" id="2837456">export</span><span class="op" id="2837462">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2837467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2837472">return</span>&nbsp;<span class="builtintype" id="2837479">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2837486">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2837489">case</span>&nbsp;<span class="op" id="2837494">*</span><span class="ident" id="2837495">TypeSpec</span><span class="op" id="2837503">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2837507">if</span>&nbsp;<span class="ident" id="2837510">f</span><span class="op" id="2837511">(</span><span class="ident" id="2837512">s</span><span class="op" id="2837513">.</span><span class="ident" id="2837514">Name</span><span class="op" id="2837518">.</span><span class="ident" id="2837519">Name</span><span class="op" id="2837523">)</span>&nbsp;<span class="op" id="2837525">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2837530">if</span>&nbsp;<span class="ident" id="2837533">export</span>&nbsp;<span class="op" id="2837540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2837546">filterType</span><span class="op" id="2837556">(</span><span class="ident" id="2837557">s</span><span class="op" id="2837558">.</span><span class="ident" id="2837559">Type</span><span class="op" id="2837563">,</span>&nbsp;<span class="ident" id="2837565">f</span><span class="op" id="2837566">,</span>&nbsp;<span class="ident" id="2837568">export</span><span class="op" id="2837574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2837579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2837584">return</span>&nbsp;<span class="builtintype" id="2837591">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2837598">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2837602">if</span>&nbsp;<span class="op" id="2837605">!</span><span class="ident" id="2837606">export</span>&nbsp;<span class="op" id="2837613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2837618">//&nbsp;For&nbsp;general&nbsp;filtering&nbsp;(not&nbsp;just&nbsp;exports),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2837666">//&nbsp;filter&nbsp;type&nbsp;even&nbsp;if&nbsp;name&nbsp;is&nbsp;not&nbsp;filtered</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2837713">//&nbsp;out.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2837724">//&nbsp;If&nbsp;the&nbsp;type&nbsp;contains&nbsp;filtered&nbsp;elements,</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2837770">//&nbsp;keep&nbsp;the&nbsp;declaration.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2837798">return</span>&nbsp;<span class="ident" id="2837805">filterType</span><span class="op" id="2837815">(</span><span class="ident" id="2837816">s</span><span class="op" id="2837817">.</span><span class="ident" id="2837818">Type</span><span class="op" id="2837822">,</span>&nbsp;<span class="ident" id="2837824">f</span><span class="op" id="2837825">,</span>&nbsp;<span class="ident" id="2837827">export</span><span class="op" id="2837833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2837837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2837840">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2837843">return</span>&nbsp;<span class="builtintype" id="2837850">false</span><br>
<span class="lineno">185</span><span class="op" id="2837856">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2837859">func</span>&nbsp;<span class="ident" id="2837864">filterSpecList</span><span class="op" id="2837878">(</span><span class="ident" id="2837879">list</span>&nbsp;<span class="op" id="2837884">[</span><span class="op" id="2837885">]</span><span class="ident" id="2837886">Spec</span><span class="op" id="2837890">,</span>&nbsp;<span class="ident" id="2837892">f</span>&nbsp;<span class="ident" id="2837894">Filter</span><span class="op" id="2837900">,</span>&nbsp;<span class="ident" id="2837902">export</span>&nbsp;<span class="builtintype" id="2837909">bool</span><span class="op" id="2837913">)</span>&nbsp;<span class="op" id="2837915">[</span><span class="op" id="2837916">]</span><span class="ident" id="2837917">Spec</span>&nbsp;<span class="op" id="2837922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2837925">j</span>&nbsp;<span class="op" id="2837927">:=</span>&nbsp;<span class="num" id="2837930">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2837933">for</span>&nbsp;<span class="ident" id="2837937">_</span><span class="op" id="2837938">,</span>&nbsp;<span class="ident" id="2837940">s</span>&nbsp;<span class="op" id="2837942">:=</span>&nbsp;<span class="keyword" id="2837945">range</span>&nbsp;<span class="ident" id="2837951">list</span>&nbsp;<span class="op" id="2837956">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2837960">if</span>&nbsp;<span class="ident" id="2837963">filterSpec</span><span class="op" id="2837973">(</span><span class="ident" id="2837974">s</span><span class="op" id="2837975">,</span>&nbsp;<span class="ident" id="2837977">f</span><span class="op" id="2837978">,</span>&nbsp;<span class="ident" id="2837980">export</span><span class="op" id="2837986">)</span>&nbsp;<span class="op" id="2837988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2837993">list</span><span class="op" id="2837997">[</span><span class="ident" id="2837998">j</span><span class="op" id="2837999">]</span>&nbsp;<span class="op" id="2838001">=</span>&nbsp;<span class="ident" id="2838003">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2838008">j</span><span class="op" id="2838009">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2838014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2838017">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2838020">return</span>&nbsp;<span class="ident" id="2838027">list</span><span class="op" id="2838031">[</span><span class="num" id="2838032">0</span><span class="op" id="2838033">:</span><span class="ident" id="2838034">j</span><span class="op" id="2838035">]</span><br>
<span class="lineno"></span><span class="op" id="2838037">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2838040">//&nbsp;FilterDecl&nbsp;trims&nbsp;the&nbsp;AST&nbsp;for&nbsp;a&nbsp;Go&nbsp;declaration&nbsp;in&nbsp;place&nbsp;by&nbsp;removing</span><br>
<span class="lineno"></span><span class="comment" id="2838110">//&nbsp;all&nbsp;names&nbsp;(including&nbsp;struct&nbsp;field&nbsp;and&nbsp;interface&nbsp;method&nbsp;names,&nbsp;but</span><br>
<span class="lineno">200</span><span class="comment" id="2838179">//&nbsp;not&nbsp;from&nbsp;parameter&nbsp;lists)&nbsp;that&nbsp;don&#39;t&nbsp;pass&nbsp;through&nbsp;the&nbsp;filter&nbsp;f.</span><br>
<span class="lineno"></span><span class="comment" id="2838246">//</span><br>
<span class="lineno"></span><span class="comment" id="2838249">//&nbsp;FilterDecl&nbsp;returns&nbsp;true&nbsp;if&nbsp;there&nbsp;are&nbsp;any&nbsp;declared&nbsp;names&nbsp;left&nbsp;after</span><br>
<span class="lineno"></span><span class="comment" id="2838319">//&nbsp;filtering;&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="2838361">//</span><br>
<span class="lineno">205</span><span class="keyword" id="2838364">func</span>&nbsp;<span class="ident" id="2838369">FilterDecl</span><span class="op" id="2838379">(</span><span class="ident" id="2838380">decl</span>&nbsp;<span class="ident" id="2838385">Decl</span><span class="op" id="2838389">,</span>&nbsp;<span class="ident" id="2838391">f</span>&nbsp;<span class="ident" id="2838393">Filter</span><span class="op" id="2838399">)</span>&nbsp;<span class="builtintype" id="2838401">bool</span>&nbsp;<span class="op" id="2838406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2838409">return</span>&nbsp;<span class="ident" id="2838416">filterDecl</span><span class="op" id="2838426">(</span><span class="ident" id="2838427">decl</span><span class="op" id="2838431">,</span>&nbsp;<span class="ident" id="2838433">f</span><span class="op" id="2838434">,</span>&nbsp;<span class="builtintype" id="2838436">false</span><span class="op" id="2838441">)</span><br>
<span class="lineno"></span><span class="op" id="2838443">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2838446">func</span>&nbsp;<span class="ident" id="2838451">filterDecl</span><span class="op" id="2838461">(</span><span class="ident" id="2838462">decl</span>&nbsp;<span class="ident" id="2838467">Decl</span><span class="op" id="2838471">,</span>&nbsp;<span class="ident" id="2838473">f</span>&nbsp;<span class="ident" id="2838475">Filter</span><span class="op" id="2838481">,</span>&nbsp;<span class="ident" id="2838483">export</span>&nbsp;<span class="builtintype" id="2838490">bool</span><span class="op" id="2838494">)</span>&nbsp;<span class="builtintype" id="2838496">bool</span>&nbsp;<span class="op" id="2838501">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2838504">switch</span>&nbsp;<span class="ident" id="2838511">d</span>&nbsp;<span class="op" id="2838513">:=</span>&nbsp;<span class="ident" id="2838516">decl</span><span class="op" id="2838520">.</span><span class="op" id="2838521">(</span><span class="keyword" id="2838522">type</span><span class="op" id="2838526">)</span>&nbsp;<span class="op" id="2838528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2838531">case</span>&nbsp;<span class="op" id="2838536">*</span><span class="ident" id="2838537">GenDecl</span><span class="op" id="2838544">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2838548">d</span><span class="op" id="2838549">.</span><span class="ident" id="2838550">Specs</span>&nbsp;<span class="op" id="2838556">=</span>&nbsp;<span class="ident" id="2838558">filterSpecList</span><span class="op" id="2838572">(</span><span class="ident" id="2838573">d</span><span class="op" id="2838574">.</span><span class="ident" id="2838575">Specs</span><span class="op" id="2838580">,</span>&nbsp;<span class="ident" id="2838582">f</span><span class="op" id="2838583">,</span>&nbsp;<span class="ident" id="2838585">export</span><span class="op" id="2838591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2838595">return</span>&nbsp;<span class="builtinfunc" id="2838602">len</span><span class="op" id="2838605">(</span><span class="ident" id="2838606">d</span><span class="op" id="2838607">.</span><span class="ident" id="2838608">Specs</span><span class="op" id="2838613">)</span>&nbsp;<span class="op" id="2838615">&gt;</span>&nbsp;<span class="num" id="2838617">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2838620">case</span>&nbsp;<span class="op" id="2838625">*</span><span class="ident" id="2838626">FuncDecl</span><span class="op" id="2838634">:</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2838638">return</span>&nbsp;<span class="ident" id="2838645">f</span><span class="op" id="2838646">(</span><span class="ident" id="2838647">d</span><span class="op" id="2838648">.</span><span class="ident" id="2838649">Name</span><span class="op" id="2838653">.</span><span class="ident" id="2838654">Name</span><span class="op" id="2838658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2838661">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2838664">return</span>&nbsp;<span class="builtintype" id="2838671">false</span><br>
<span class="lineno"></span><span class="op" id="2838677">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span><span class="comment" id="2838680">//&nbsp;FilterFile&nbsp;trims&nbsp;the&nbsp;AST&nbsp;for&nbsp;a&nbsp;Go&nbsp;file&nbsp;in&nbsp;place&nbsp;by&nbsp;removing&nbsp;all</span><br>
<span class="lineno"></span><span class="comment" id="2838747">//&nbsp;names&nbsp;from&nbsp;top-level&nbsp;declarations&nbsp;(including&nbsp;struct&nbsp;field&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2838812">//&nbsp;interface&nbsp;method&nbsp;names,&nbsp;but&nbsp;not&nbsp;from&nbsp;parameter&nbsp;lists)&nbsp;that&nbsp;don&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="2838880">//&nbsp;pass&nbsp;through&nbsp;the&nbsp;filter&nbsp;f.&nbsp;If&nbsp;the&nbsp;declaration&nbsp;is&nbsp;empty&nbsp;afterwards,</span><br>
<span class="lineno"></span><span class="comment" id="2838950">//&nbsp;the&nbsp;declaration&nbsp;is&nbsp;removed&nbsp;from&nbsp;the&nbsp;AST.&nbsp;The&nbsp;File.Comments&nbsp;list</span><br>
<span class="lineno">225</span><span class="comment" id="2839017">//&nbsp;is&nbsp;not&nbsp;changed.</span><br>
<span class="lineno"></span><span class="comment" id="2839036">//</span><br>
<span class="lineno"></span><span class="comment" id="2839039">//&nbsp;FilterFile&nbsp;returns&nbsp;true&nbsp;if&nbsp;there&nbsp;are&nbsp;any&nbsp;top-level&nbsp;declarations</span><br>
<span class="lineno"></span><span class="comment" id="2839106">//&nbsp;left&nbsp;after&nbsp;filtering;&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="2839159">//</span><br>
<span class="lineno">230</span><span class="keyword" id="2839162">func</span>&nbsp;<span class="ident" id="2839167">FilterFile</span><span class="op" id="2839177">(</span><span class="ident" id="2839178">src</span>&nbsp;<span class="op" id="2839182">*</span><span class="ident" id="2839183">File</span><span class="op" id="2839187">,</span>&nbsp;<span class="ident" id="2839189">f</span>&nbsp;<span class="ident" id="2839191">Filter</span><span class="op" id="2839197">)</span>&nbsp;<span class="builtintype" id="2839199">bool</span>&nbsp;<span class="op" id="2839204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2839207">return</span>&nbsp;<span class="ident" id="2839214">filterFile</span><span class="op" id="2839224">(</span><span class="ident" id="2839225">src</span><span class="op" id="2839228">,</span>&nbsp;<span class="ident" id="2839230">f</span><span class="op" id="2839231">,</span>&nbsp;<span class="builtintype" id="2839233">false</span><span class="op" id="2839238">)</span><br>
<span class="lineno"></span><span class="op" id="2839240">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2839243">func</span>&nbsp;<span class="ident" id="2839248">filterFile</span><span class="op" id="2839258">(</span><span class="ident" id="2839259">src</span>&nbsp;<span class="op" id="2839263">*</span><span class="ident" id="2839264">File</span><span class="op" id="2839268">,</span>&nbsp;<span class="ident" id="2839270">f</span>&nbsp;<span class="ident" id="2839272">Filter</span><span class="op" id="2839278">,</span>&nbsp;<span class="ident" id="2839280">export</span>&nbsp;<span class="builtintype" id="2839287">bool</span><span class="op" id="2839291">)</span>&nbsp;<span class="builtintype" id="2839293">bool</span>&nbsp;<span class="op" id="2839298">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2839301">j</span>&nbsp;<span class="op" id="2839303">:=</span>&nbsp;<span class="num" id="2839306">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2839309">for</span>&nbsp;<span class="ident" id="2839313">_</span><span class="op" id="2839314">,</span>&nbsp;<span class="ident" id="2839316">d</span>&nbsp;<span class="op" id="2839318">:=</span>&nbsp;<span class="keyword" id="2839321">range</span>&nbsp;<span class="ident" id="2839327">src</span><span class="op" id="2839330">.</span><span class="ident" id="2839331">Decls</span>&nbsp;<span class="op" id="2839337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2839341">if</span>&nbsp;<span class="ident" id="2839344">filterDecl</span><span class="op" id="2839354">(</span><span class="ident" id="2839355">d</span><span class="op" id="2839356">,</span>&nbsp;<span class="ident" id="2839358">f</span><span class="op" id="2839359">,</span>&nbsp;<span class="ident" id="2839361">export</span><span class="op" id="2839367">)</span>&nbsp;<span class="op" id="2839369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2839374">src</span><span class="op" id="2839377">.</span><span class="ident" id="2839378">Decls</span><span class="op" id="2839383">[</span><span class="ident" id="2839384">j</span><span class="op" id="2839385">]</span>&nbsp;<span class="op" id="2839387">=</span>&nbsp;<span class="ident" id="2839389">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2839394">j</span><span class="op" id="2839395">++</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2839400">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2839403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2839406">src</span><span class="op" id="2839409">.</span><span class="ident" id="2839410">Decls</span>&nbsp;<span class="op" id="2839416">=</span>&nbsp;<span class="ident" id="2839418">src</span><span class="op" id="2839421">.</span><span class="ident" id="2839422">Decls</span><span class="op" id="2839427">[</span><span class="num" id="2839428">0</span><span class="op" id="2839429">:</span><span class="ident" id="2839430">j</span><span class="op" id="2839431">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2839434">return</span>&nbsp;<span class="ident" id="2839441">j</span>&nbsp;<span class="op" id="2839443">&gt;</span>&nbsp;<span class="num" id="2839445">0</span><br>
<span class="lineno"></span><span class="op" id="2839447">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="comment" id="2839450">//&nbsp;FilterPackage&nbsp;trims&nbsp;the&nbsp;AST&nbsp;for&nbsp;a&nbsp;Go&nbsp;package&nbsp;in&nbsp;place&nbsp;by&nbsp;removing</span><br>
<span class="lineno"></span><span class="comment" id="2839519">//&nbsp;all&nbsp;names&nbsp;from&nbsp;top-level&nbsp;declarations&nbsp;(including&nbsp;struct&nbsp;field&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2839588">//&nbsp;interface&nbsp;method&nbsp;names,&nbsp;but&nbsp;not&nbsp;from&nbsp;parameter&nbsp;lists)&nbsp;that&nbsp;don&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="2839656">//&nbsp;pass&nbsp;through&nbsp;the&nbsp;filter&nbsp;f.&nbsp;If&nbsp;the&nbsp;declaration&nbsp;is&nbsp;empty&nbsp;afterwards,</span><br>
<span class="lineno">250</span><span class="comment" id="2839726">//&nbsp;the&nbsp;declaration&nbsp;is&nbsp;removed&nbsp;from&nbsp;the&nbsp;AST.&nbsp;The&nbsp;pkg.Files&nbsp;list&nbsp;is&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="2839796">//&nbsp;changed,&nbsp;so&nbsp;that&nbsp;file&nbsp;names&nbsp;and&nbsp;top-level&nbsp;package&nbsp;comments&nbsp;don&#39;t&nbsp;get</span><br>
<span class="lineno"></span><span class="comment" id="2839868">//&nbsp;lost.</span><br>
<span class="lineno"></span><span class="comment" id="2839877">//</span><br>
<span class="lineno"></span><span class="comment" id="2839880">//&nbsp;FilterPackage&nbsp;returns&nbsp;true&nbsp;if&nbsp;there&nbsp;are&nbsp;any&nbsp;top-level&nbsp;declarations</span><br>
<span class="lineno">255</span><span class="comment" id="2839950">//&nbsp;left&nbsp;after&nbsp;filtering;&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="2840003">//</span><br>
<span class="lineno"></span><span class="keyword" id="2840006">func</span>&nbsp;<span class="ident" id="2840011">FilterPackage</span><span class="op" id="2840024">(</span><span class="ident" id="2840025">pkg</span>&nbsp;<span class="op" id="2840029">*</span><span class="ident" id="2840030">Package</span><span class="op" id="2840037">,</span>&nbsp;<span class="ident" id="2840039">f</span>&nbsp;<span class="ident" id="2840041">Filter</span><span class="op" id="2840047">)</span>&nbsp;<span class="builtintype" id="2840049">bool</span>&nbsp;<span class="op" id="2840054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2840057">return</span>&nbsp;<span class="ident" id="2840064">filterPackage</span><span class="op" id="2840077">(</span><span class="ident" id="2840078">pkg</span><span class="op" id="2840081">,</span>&nbsp;<span class="ident" id="2840083">f</span><span class="op" id="2840084">,</span>&nbsp;<span class="builtintype" id="2840086">false</span><span class="op" id="2840091">)</span><br>
<span class="lineno"></span><span class="op" id="2840093">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span><span class="keyword" id="2840096">func</span>&nbsp;<span class="ident" id="2840101">filterPackage</span><span class="op" id="2840114">(</span><span class="ident" id="2840115">pkg</span>&nbsp;<span class="op" id="2840119">*</span><span class="ident" id="2840120">Package</span><span class="op" id="2840127">,</span>&nbsp;<span class="ident" id="2840129">f</span>&nbsp;<span class="ident" id="2840131">Filter</span><span class="op" id="2840137">,</span>&nbsp;<span class="ident" id="2840139">export</span>&nbsp;<span class="builtintype" id="2840146">bool</span><span class="op" id="2840150">)</span>&nbsp;<span class="builtintype" id="2840152">bool</span>&nbsp;<span class="op" id="2840157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2840160">hasDecls</span>&nbsp;<span class="op" id="2840169">:=</span>&nbsp;<span class="builtintype" id="2840172">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2840179">for</span>&nbsp;<span class="ident" id="2840183">_</span><span class="op" id="2840184">,</span>&nbsp;<span class="ident" id="2840186">src</span>&nbsp;<span class="op" id="2840190">:=</span>&nbsp;<span class="keyword" id="2840193">range</span>&nbsp;<span class="ident" id="2840199">pkg</span><span class="op" id="2840202">.</span><span class="ident" id="2840203">Files</span>&nbsp;<span class="op" id="2840209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2840213">if</span>&nbsp;<span class="ident" id="2840216">filterFile</span><span class="op" id="2840226">(</span><span class="ident" id="2840227">src</span><span class="op" id="2840230">,</span>&nbsp;<span class="ident" id="2840232">f</span><span class="op" id="2840233">,</span>&nbsp;<span class="ident" id="2840235">export</span><span class="op" id="2840241">)</span>&nbsp;<span class="op" id="2840243">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2840248">hasDecls</span>&nbsp;<span class="op" id="2840257">=</span>&nbsp;<span class="builtintype" id="2840259">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2840266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2840269">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2840272">return</span>&nbsp;<span class="ident" id="2840279">hasDecls</span><br>
<span class="lineno"></span><span class="op" id="2840288">}</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span><span class="comment" id="2840291">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="2840371">//&nbsp;Merging&nbsp;of&nbsp;package&nbsp;files</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2840400">//&nbsp;The&nbsp;MergeMode&nbsp;flags&nbsp;control&nbsp;the&nbsp;behavior&nbsp;of&nbsp;MergePackageFiles.</span><br>
<span class="lineno">275</span><span class="keyword" id="2840466">type</span>&nbsp;<span class="ident" id="2840471">MergeMode</span>&nbsp;<span class="builtintype" id="2840481">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2840487">const</span>&nbsp;<span class="op" id="2840493">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2840496">//&nbsp;If&nbsp;set,&nbsp;duplicate&nbsp;function&nbsp;declarations&nbsp;are&nbsp;excluded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2840554">FilterFuncDuplicates</span>&nbsp;<span class="ident" id="2840575">MergeMode</span>&nbsp;<span class="op" id="2840585">=</span>&nbsp;<span class="num" id="2840587">1</span>&nbsp;<span class="op" id="2840589">&lt;&lt;</span>&nbsp;<span class="ident" id="2840592">iota</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2840598">//&nbsp;If&nbsp;set,&nbsp;comments&nbsp;that&nbsp;are&nbsp;not&nbsp;associated&nbsp;with&nbsp;a&nbsp;specific</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2840659">//&nbsp;AST&nbsp;node&nbsp;(as&nbsp;Doc&nbsp;or&nbsp;Comment)&nbsp;are&nbsp;excluded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2840706">FilterUnassociatedComments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2840734">//&nbsp;If&nbsp;set,&nbsp;duplicate&nbsp;import&nbsp;declarations&nbsp;are&nbsp;excluded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2840790">FilterImportDuplicates</span><br>
<span class="lineno">285</span><span class="op" id="2840813">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2840816">//&nbsp;nameOf&nbsp;returns&nbsp;the&nbsp;function&nbsp;(foo)&nbsp;or&nbsp;method&nbsp;name&nbsp;(foo.bar)&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="2840882">//&nbsp;the&nbsp;given&nbsp;function&nbsp;declaration.&nbsp;If&nbsp;the&nbsp;AST&nbsp;is&nbsp;incorrect&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2840949">//&nbsp;receiver,&nbsp;it&nbsp;assumes&nbsp;a&nbsp;function&nbsp;instead.</span><br>
<span class="lineno">290</span><span class="comment" id="2840993">//</span><br>
<span class="lineno"></span><span class="keyword" id="2840996">func</span>&nbsp;<span class="ident" id="2841001">nameOf</span><span class="op" id="2841007">(</span><span class="ident" id="2841008">f</span>&nbsp;<span class="op" id="2841010">*</span><span class="ident" id="2841011">FuncDecl</span><span class="op" id="2841019">)</span>&nbsp;<span class="builtintype" id="2841021">string</span>&nbsp;<span class="op" id="2841028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2841031">if</span>&nbsp;<span class="ident" id="2841034">r</span>&nbsp;<span class="op" id="2841036">:=</span>&nbsp;<span class="ident" id="2841039">f</span><span class="op" id="2841040">.</span><span class="ident" id="2841041">Recv</span><span class="op" id="2841045">;</span>&nbsp;<span class="ident" id="2841047">r</span>&nbsp;<span class="op" id="2841049">!=</span>&nbsp;<span class="ident" id="2841052">nil</span>&nbsp;<span class="op" id="2841056">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2841059">len</span><span class="op" id="2841062">(</span><span class="ident" id="2841063">r</span><span class="op" id="2841064">.</span><span class="ident" id="2841065">List</span><span class="op" id="2841069">)</span>&nbsp;<span class="op" id="2841071">==</span>&nbsp;<span class="num" id="2841074">1</span>&nbsp;<span class="op" id="2841076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2841080">//&nbsp;looks&nbsp;like&nbsp;a&nbsp;correct&nbsp;receiver&nbsp;declaration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2841127">t</span>&nbsp;<span class="op" id="2841129">:=</span>&nbsp;<span class="ident" id="2841132">r</span><span class="op" id="2841133">.</span><span class="ident" id="2841134">List</span><span class="op" id="2841138">[</span><span class="num" id="2841139">0</span><span class="op" id="2841140">]</span><span class="op" id="2841141">.</span><span class="ident" id="2841142">Type</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2841149">//&nbsp;dereference&nbsp;pointer&nbsp;receiver&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2841189">if</span>&nbsp;<span class="ident" id="2841192">p</span><span class="op" id="2841193">,</span>&nbsp;<span class="ident" id="2841195">_</span>&nbsp;<span class="op" id="2841197">:=</span>&nbsp;<span class="ident" id="2841200">t</span><span class="op" id="2841201">.</span><span class="op" id="2841202">(</span><span class="op" id="2841203">*</span><span class="ident" id="2841204">StarExpr</span><span class="op" id="2841212">)</span><span class="op" id="2841213">;</span>&nbsp;<span class="ident" id="2841215">p</span>&nbsp;<span class="op" id="2841217">!=</span>&nbsp;<span class="ident" id="2841220">nil</span>&nbsp;<span class="op" id="2841224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2841229">t</span>&nbsp;<span class="op" id="2841231">=</span>&nbsp;<span class="ident" id="2841233">p</span><span class="op" id="2841234">.</span><span class="ident" id="2841235">X</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2841239">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2841243">//&nbsp;the&nbsp;receiver&nbsp;type&nbsp;must&nbsp;be&nbsp;a&nbsp;type&nbsp;name</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2841286">if</span>&nbsp;<span class="ident" id="2841289">p</span><span class="op" id="2841290">,</span>&nbsp;<span class="ident" id="2841292">_</span>&nbsp;<span class="op" id="2841294">:=</span>&nbsp;<span class="ident" id="2841297">t</span><span class="op" id="2841298">.</span><span class="op" id="2841299">(</span><span class="op" id="2841300">*</span><span class="ident" id="2841301">Ident</span><span class="op" id="2841306">)</span><span class="op" id="2841307">;</span>&nbsp;<span class="ident" id="2841309">p</span>&nbsp;<span class="op" id="2841311">!=</span>&nbsp;<span class="ident" id="2841314">nil</span>&nbsp;<span class="op" id="2841318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2841323">return</span>&nbsp;<span class="ident" id="2841330">p</span><span class="op" id="2841331">.</span><span class="ident" id="2841332">Name</span>&nbsp;<span class="op" id="2841337">+</span>&nbsp;<span class="string" id="2841339">&#34;.&#34;</span>&nbsp;<span class="op" id="2841343">+</span>&nbsp;<span class="ident" id="2841345">f</span><span class="op" id="2841346">.</span><span class="ident" id="2841347">Name</span><span class="op" id="2841351">.</span><span class="ident" id="2841352">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2841359">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2841363">//&nbsp;otherwise&nbsp;assume&nbsp;a&nbsp;function&nbsp;instead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2841403">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2841406">return</span>&nbsp;<span class="ident" id="2841413">f</span><span class="op" id="2841414">.</span><span class="ident" id="2841415">Name</span><span class="op" id="2841419">.</span><span class="ident" id="2841420">Name</span><br>
<span class="lineno"></span><span class="op" id="2841425">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2841428">//&nbsp;separator&nbsp;is&nbsp;an&nbsp;empty&nbsp;//-style&nbsp;comment&nbsp;that&nbsp;is&nbsp;interspersed&nbsp;between</span><br>
<span class="lineno"></span><span class="comment" id="2841499">//&nbsp;different&nbsp;comment&nbsp;groups&nbsp;when&nbsp;they&nbsp;are&nbsp;concatenated&nbsp;into&nbsp;a&nbsp;single&nbsp;group</span><br>
<span class="lineno">310</span><span class="comment" id="2841574">//</span><br>
<span class="lineno"></span><span class="keyword" id="2841577">var</span>&nbsp;<span class="ident" id="2841581">separator</span>&nbsp;<span class="op" id="2841591">=</span>&nbsp;<span class="op" id="2841593">&amp;</span><span class="ident" id="2841594">Comment</span><span class="op" id="2841601">{</span><span class="ident" id="2841602">token</span><span class="op" id="2841607">.</span><span class="ident" id="2841608">NoPos</span><span class="op" id="2841613">,</span>&nbsp;<span class="string" id="2841615">&#34;//&#34;</span><span class="op" id="2841619">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2841622">//&nbsp;MergePackageFiles&nbsp;creates&nbsp;a&nbsp;file&nbsp;AST&nbsp;by&nbsp;merging&nbsp;the&nbsp;ASTs&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2841689">//&nbsp;files&nbsp;belonging&nbsp;to&nbsp;a&nbsp;package.&nbsp;The&nbsp;mode&nbsp;flags&nbsp;control&nbsp;merging&nbsp;behavior.</span><br>
<span class="lineno">315</span><span class="comment" id="2841763">//</span><br>
<span class="lineno"></span><span class="keyword" id="2841766">func</span>&nbsp;<span class="ident" id="2841771">MergePackageFiles</span><span class="op" id="2841788">(</span><span class="ident" id="2841789">pkg</span>&nbsp;<span class="op" id="2841793">*</span><span class="ident" id="2841794">Package</span><span class="op" id="2841801">,</span>&nbsp;<span class="ident" id="2841803">mode</span>&nbsp;<span class="ident" id="2841808">MergeMode</span><span class="op" id="2841817">)</span>&nbsp;<span class="op" id="2841819">*</span><span class="ident" id="2841820">File</span>&nbsp;<span class="op" id="2841825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2841828">//&nbsp;Count&nbsp;the&nbsp;number&nbsp;of&nbsp;package&nbsp;docs,&nbsp;comments&nbsp;and&nbsp;declarations&nbsp;across</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2841899">//&nbsp;all&nbsp;package&nbsp;files.&nbsp;Also,&nbsp;compute&nbsp;sorted&nbsp;list&nbsp;of&nbsp;filenames,&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2841970">//&nbsp;subsequent&nbsp;iterations&nbsp;can&nbsp;always&nbsp;iterate&nbsp;in&nbsp;the&nbsp;same&nbsp;order.</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2842034">ndocs</span>&nbsp;<span class="op" id="2842040">:=</span>&nbsp;<span class="num" id="2842043">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2842046">ncomments</span>&nbsp;<span class="op" id="2842056">:=</span>&nbsp;<span class="num" id="2842059">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2842062">ndecls</span>&nbsp;<span class="op" id="2842069">:=</span>&nbsp;<span class="num" id="2842072">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2842075">filenames</span>&nbsp;<span class="op" id="2842085">:=</span>&nbsp;<span class="builtinfunc" id="2842088">make</span><span class="op" id="2842092">(</span><span class="op" id="2842093">[</span><span class="op" id="2842094">]</span><span class="builtintype" id="2842095">string</span><span class="op" id="2842101">,</span>&nbsp;<span class="builtinfunc" id="2842103">len</span><span class="op" id="2842106">(</span><span class="ident" id="2842107">pkg</span><span class="op" id="2842110">.</span><span class="ident" id="2842111">Files</span><span class="op" id="2842116">)</span><span class="op" id="2842117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2842120">i</span>&nbsp;<span class="op" id="2842122">:=</span>&nbsp;<span class="num" id="2842125">0</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2842128">for</span>&nbsp;<span class="ident" id="2842132">filename</span><span class="op" id="2842140">,</span>&nbsp;<span class="ident" id="2842142">f</span>&nbsp;<span class="op" id="2842144">:=</span>&nbsp;<span class="keyword" id="2842147">range</span>&nbsp;<span class="ident" id="2842153">pkg</span><span class="op" id="2842156">.</span><span class="ident" id="2842157">Files</span>&nbsp;<span class="op" id="2842163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2842167">filenames</span><span class="op" id="2842176">[</span><span class="ident" id="2842177">i</span><span class="op" id="2842178">]</span>&nbsp;<span class="op" id="2842180">=</span>&nbsp;<span class="ident" id="2842182">filename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2842193">i</span><span class="op" id="2842194">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2842199">if</span>&nbsp;<span class="ident" id="2842202">f</span><span class="op" id="2842203">.</span><span class="ident" id="2842204">Doc</span>&nbsp;<span class="op" id="2842208">!=</span>&nbsp;<span class="ident" id="2842211">nil</span>&nbsp;<span class="op" id="2842215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2842220">ndocs</span>&nbsp;<span class="op" id="2842226">+=</span>&nbsp;<span class="builtinfunc" id="2842229">len</span><span class="op" id="2842232">(</span><span class="ident" id="2842233">f</span><span class="op" id="2842234">.</span><span class="ident" id="2842235">Doc</span><span class="op" id="2842238">.</span><span class="ident" id="2842239">List</span><span class="op" id="2842243">)</span>&nbsp;<span class="op" id="2842245">+</span>&nbsp;<span class="num" id="2842247">1</span>&nbsp;<span class="comment" id="2842249">//&nbsp;+1&nbsp;for&nbsp;separator</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2842271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2842275">ncomments</span>&nbsp;<span class="op" id="2842285">+=</span>&nbsp;<span class="builtinfunc" id="2842288">len</span><span class="op" id="2842291">(</span><span class="ident" id="2842292">f</span><span class="op" id="2842293">.</span><span class="ident" id="2842294">Comments</span><span class="op" id="2842302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2842306">ndecls</span>&nbsp;<span class="op" id="2842313">+=</span>&nbsp;<span class="builtinfunc" id="2842316">len</span><span class="op" id="2842319">(</span><span class="ident" id="2842320">f</span><span class="op" id="2842321">.</span><span class="ident" id="2842322">Decls</span><span class="op" id="2842327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2842330">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2842333">sort</span><span class="op" id="2842337">.</span><span class="ident" id="2842338">Strings</span><span class="op" id="2842345">(</span><span class="ident" id="2842346">filenames</span><span class="op" id="2842355">)</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2842359">//&nbsp;Collect&nbsp;package&nbsp;comments&nbsp;from&nbsp;all&nbsp;package&nbsp;files&nbsp;into&nbsp;a&nbsp;single</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2842425">//&nbsp;CommentGroup&nbsp;-&nbsp;the&nbsp;collected&nbsp;package&nbsp;documentation.&nbsp;In&nbsp;general</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2842492">//&nbsp;there&nbsp;should&nbsp;be&nbsp;only&nbsp;one&nbsp;file&nbsp;with&nbsp;a&nbsp;package&nbsp;comment;&nbsp;but&nbsp;it&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2842559">//&nbsp;better&nbsp;to&nbsp;collect&nbsp;extra&nbsp;comments&nbsp;than&nbsp;drop&nbsp;them&nbsp;on&nbsp;the&nbsp;floor.</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2842625">var</span>&nbsp;<span class="ident" id="2842629">doc</span>&nbsp;<span class="op" id="2842633">*</span><span class="ident" id="2842634">CommentGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2842648">var</span>&nbsp;<span class="ident" id="2842652">pos</span>&nbsp;<span class="ident" id="2842656">token</span><span class="op" id="2842661">.</span><span class="ident" id="2842662">Pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2842667">if</span>&nbsp;<span class="ident" id="2842670">ndocs</span>&nbsp;<span class="op" id="2842676">&gt;</span>&nbsp;<span class="num" id="2842678">0</span>&nbsp;<span class="op" id="2842680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2842684">list</span>&nbsp;<span class="op" id="2842689">:=</span>&nbsp;<span class="builtinfunc" id="2842692">make</span><span class="op" id="2842696">(</span><span class="op" id="2842697">[</span><span class="op" id="2842698">]</span><span class="op" id="2842699">*</span><span class="ident" id="2842700">Comment</span><span class="op" id="2842707">,</span>&nbsp;<span class="ident" id="2842709">ndocs</span><span class="op" id="2842714">-</span><span class="num" id="2842715">1</span><span class="op" id="2842716">)</span>&nbsp;<span class="comment" id="2842718">//&nbsp;-1:&nbsp;no&nbsp;separator&nbsp;before&nbsp;first&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2842759">i</span>&nbsp;<span class="op" id="2842761">:=</span>&nbsp;<span class="num" id="2842764">0</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2842768">for</span>&nbsp;<span class="ident" id="2842772">_</span><span class="op" id="2842773">,</span>&nbsp;<span class="ident" id="2842775">filename</span>&nbsp;<span class="op" id="2842784">:=</span>&nbsp;<span class="keyword" id="2842787">range</span>&nbsp;<span class="ident" id="2842793">filenames</span>&nbsp;<span class="op" id="2842803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2842808">f</span>&nbsp;<span class="op" id="2842810">:=</span>&nbsp;<span class="ident" id="2842813">pkg</span><span class="op" id="2842816">.</span><span class="ident" id="2842817">Files</span><span class="op" id="2842822">[</span><span class="ident" id="2842823">filename</span><span class="op" id="2842831">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2842836">if</span>&nbsp;<span class="ident" id="2842839">f</span><span class="op" id="2842840">.</span><span class="ident" id="2842841">Doc</span>&nbsp;<span class="op" id="2842845">!=</span>&nbsp;<span class="ident" id="2842848">nil</span>&nbsp;<span class="op" id="2842852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2842858">if</span>&nbsp;<span class="ident" id="2842861">i</span>&nbsp;<span class="op" id="2842863">&gt;</span>&nbsp;<span class="num" id="2842865">0</span>&nbsp;<span class="op" id="2842867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2842874">//&nbsp;not&nbsp;the&nbsp;first&nbsp;group&nbsp;-&nbsp;add&nbsp;separator</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2842918">list</span><span class="op" id="2842922">[</span><span class="ident" id="2842923">i</span><span class="op" id="2842924">]</span>&nbsp;<span class="op" id="2842926">=</span>&nbsp;<span class="ident" id="2842928">separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2842943">i</span><span class="op" id="2842944">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2842951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2842957">for</span>&nbsp;<span class="ident" id="2842961">_</span><span class="op" id="2842962">,</span>&nbsp;<span class="ident" id="2842964">c</span>&nbsp;<span class="op" id="2842966">:=</span>&nbsp;<span class="keyword" id="2842969">range</span>&nbsp;<span class="ident" id="2842975">f</span><span class="op" id="2842976">.</span><span class="ident" id="2842977">Doc</span><span class="op" id="2842980">.</span><span class="ident" id="2842981">List</span>&nbsp;<span class="op" id="2842986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2842993">list</span><span class="op" id="2842997">[</span><span class="ident" id="2842998">i</span><span class="op" id="2842999">]</span>&nbsp;<span class="op" id="2843001">=</span>&nbsp;<span class="ident" id="2843003">c</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2843010">i</span><span class="op" id="2843011">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2843018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2843024">if</span>&nbsp;<span class="ident" id="2843027">f</span><span class="op" id="2843028">.</span><span class="ident" id="2843029">Package</span>&nbsp;<span class="op" id="2843037">&gt;</span>&nbsp;<span class="ident" id="2843039">pos</span>&nbsp;<span class="op" id="2843043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2843050">//&nbsp;Keep&nbsp;the&nbsp;maximum&nbsp;package&nbsp;clause&nbsp;position&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2843102">//&nbsp;position&nbsp;for&nbsp;the&nbsp;package&nbsp;clause&nbsp;of&nbsp;the&nbsp;merged</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2843156">//&nbsp;files.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2843171">pos</span>&nbsp;<span class="op" id="2843175">=</span>&nbsp;<span class="ident" id="2843177">f</span><span class="op" id="2843178">.</span><span class="ident" id="2843179">Package</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2843191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2843196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2843200">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2843204">doc</span>&nbsp;<span class="op" id="2843208">=</span>&nbsp;<span class="op" id="2843210">&amp;</span><span class="ident" id="2843211">CommentGroup</span><span class="op" id="2843223">{</span><span class="ident" id="2843224">list</span><span class="op" id="2843228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2843231">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2843235">//&nbsp;Collect&nbsp;declarations&nbsp;from&nbsp;all&nbsp;package&nbsp;files.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2843284">var</span>&nbsp;<span class="ident" id="2843288">decls</span>&nbsp;<span class="op" id="2843294">[</span><span class="op" id="2843295">]</span><span class="ident" id="2843296">Decl</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2843302">if</span>&nbsp;<span class="ident" id="2843305">ndecls</span>&nbsp;<span class="op" id="2843312">&gt;</span>&nbsp;<span class="num" id="2843314">0</span>&nbsp;<span class="op" id="2843316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2843320">decls</span>&nbsp;<span class="op" id="2843326">=</span>&nbsp;<span class="builtinfunc" id="2843328">make</span><span class="op" id="2843332">(</span><span class="op" id="2843333">[</span><span class="op" id="2843334">]</span><span class="ident" id="2843335">Decl</span><span class="op" id="2843339">,</span>&nbsp;<span class="ident" id="2843341">ndecls</span><span class="op" id="2843347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2843351">funcs</span>&nbsp;<span class="op" id="2843357">:=</span>&nbsp;<span class="builtinfunc" id="2843360">make</span><span class="op" id="2843364">(</span><span class="keyword" id="2843365">map</span><span class="op" id="2843368">[</span><span class="builtintype" id="2843369">string</span><span class="op" id="2843375">]</span><span class="builtintype" id="2843376">int</span><span class="op" id="2843379">)</span>&nbsp;<span class="comment" id="2843381">//&nbsp;map&nbsp;of&nbsp;func&nbsp;name&nbsp;-&gt;&nbsp;decls&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2843418">i</span>&nbsp;<span class="op" id="2843420">:=</span>&nbsp;<span class="num" id="2843423">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2843448">//&nbsp;current&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2843467">n</span>&nbsp;<span class="op" id="2843469">:=</span>&nbsp;<span class="num" id="2843472">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2843497">//&nbsp;number&nbsp;of&nbsp;filtered&nbsp;entries</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2843529">for</span>&nbsp;<span class="ident" id="2843533">_</span><span class="op" id="2843534">,</span>&nbsp;<span class="ident" id="2843536">filename</span>&nbsp;<span class="op" id="2843545">:=</span>&nbsp;<span class="keyword" id="2843548">range</span>&nbsp;<span class="ident" id="2843554">filenames</span>&nbsp;<span class="op" id="2843564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2843569">f</span>&nbsp;<span class="op" id="2843571">:=</span>&nbsp;<span class="ident" id="2843574">pkg</span><span class="op" id="2843577">.</span><span class="ident" id="2843578">Files</span><span class="op" id="2843583">[</span><span class="ident" id="2843584">filename</span><span class="op" id="2843592">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2843597">for</span>&nbsp;<span class="ident" id="2843601">_</span><span class="op" id="2843602">,</span>&nbsp;<span class="ident" id="2843604">d</span>&nbsp;<span class="op" id="2843606">:=</span>&nbsp;<span class="keyword" id="2843609">range</span>&nbsp;<span class="ident" id="2843615">f</span><span class="op" id="2843616">.</span><span class="ident" id="2843617">Decls</span>&nbsp;<span class="op" id="2843623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2843629">if</span>&nbsp;<span class="ident" id="2843632">mode</span><span class="op" id="2843636">&amp;</span><span class="ident" id="2843637">FilterFuncDuplicates</span>&nbsp;<span class="op" id="2843658">!=</span>&nbsp;<span class="num" id="2843661">0</span>&nbsp;<span class="op" id="2843663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2843670">//&nbsp;A&nbsp;language&nbsp;entity&nbsp;may&nbsp;be&nbsp;declared&nbsp;multiple</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2843721">//&nbsp;times&nbsp;in&nbsp;different&nbsp;package&nbsp;files;&nbsp;only&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2843771">//&nbsp;build&nbsp;time&nbsp;declarations&nbsp;must&nbsp;be&nbsp;unique.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2843819">//&nbsp;For&nbsp;now,&nbsp;exclude&nbsp;multiple&nbsp;declarations&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2843869">//&nbsp;functions&nbsp;-&nbsp;keep&nbsp;the&nbsp;one&nbsp;with&nbsp;documentation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2843922">//</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2843930">//&nbsp;TODO(gri):&nbsp;Expand&nbsp;this&nbsp;filtering&nbsp;to&nbsp;other</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2843980">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;entities&nbsp;(const,&nbsp;type,&nbsp;vars)&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2844031">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;multiple&nbsp;declarations&nbsp;are&nbsp;common.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2844084">if</span>&nbsp;<span class="ident" id="2844087">f</span><span class="op" id="2844088">,</span>&nbsp;<span class="ident" id="2844090">isFun</span>&nbsp;<span class="op" id="2844096">:=</span>&nbsp;<span class="ident" id="2844099">d</span><span class="op" id="2844100">.</span><span class="op" id="2844101">(</span><span class="op" id="2844102">*</span><span class="ident" id="2844103">FuncDecl</span><span class="op" id="2844111">)</span><span class="op" id="2844112">;</span>&nbsp;<span class="ident" id="2844114">isFun</span>&nbsp;<span class="op" id="2844120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2844128">name</span>&nbsp;<span class="op" id="2844133">:=</span>&nbsp;<span class="ident" id="2844136">nameOf</span><span class="op" id="2844142">(</span><span class="ident" id="2844143">f</span><span class="op" id="2844144">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2844152">if</span>&nbsp;<span class="ident" id="2844155">j</span><span class="op" id="2844156">,</span>&nbsp;<span class="ident" id="2844158">exists</span>&nbsp;<span class="op" id="2844165">:=</span>&nbsp;<span class="ident" id="2844168">funcs</span><span class="op" id="2844173">[</span><span class="ident" id="2844174">name</span><span class="op" id="2844178">]</span><span class="op" id="2844179">;</span>&nbsp;<span class="ident" id="2844181">exists</span>&nbsp;<span class="op" id="2844188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2844197">//&nbsp;function&nbsp;declared&nbsp;already</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2844233">if</span>&nbsp;<span class="ident" id="2844236">decls</span><span class="op" id="2844241">[</span><span class="ident" id="2844242">j</span><span class="op" id="2844243">]</span>&nbsp;<span class="op" id="2844245">!=</span>&nbsp;<span class="ident" id="2844248">nil</span>&nbsp;<span class="op" id="2844252">&amp;&amp;</span>&nbsp;<span class="ident" id="2844255">decls</span><span class="op" id="2844260">[</span><span class="ident" id="2844261">j</span><span class="op" id="2844262">]</span><span class="op" id="2844263">.</span><span class="op" id="2844264">(</span><span class="op" id="2844265">*</span><span class="ident" id="2844266">FuncDecl</span><span class="op" id="2844274">)</span><span class="op" id="2844275">.</span><span class="ident" id="2844276">Doc</span>&nbsp;<span class="op" id="2844280">==</span>&nbsp;<span class="ident" id="2844283">nil</span>&nbsp;<span class="op" id="2844287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2844297">//&nbsp;existing&nbsp;declaration&nbsp;has&nbsp;no&nbsp;documentation;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2844351">//&nbsp;ignore&nbsp;the&nbsp;existing&nbsp;declaration</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2844394">decls</span><span class="op" id="2844399">[</span><span class="ident" id="2844400">j</span><span class="op" id="2844401">]</span>&nbsp;<span class="op" id="2844403">=</span>&nbsp;<span class="ident" id="2844405">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2844416">}</span>&nbsp;<span class="keyword" id="2844418">else</span>&nbsp;<span class="op" id="2844423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2844433">//&nbsp;ignore&nbsp;the&nbsp;new&nbsp;declaration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2844471">d</span>&nbsp;<span class="op" id="2844473">=</span>&nbsp;<span class="ident" id="2844475">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2844486">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2844495">n</span><span class="op" id="2844496">++</span>&nbsp;<span class="comment" id="2844499">//&nbsp;filtered&nbsp;an&nbsp;entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2844526">}</span>&nbsp;<span class="keyword" id="2844528">else</span>&nbsp;<span class="op" id="2844533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2844542">funcs</span><span class="op" id="2844547">[</span><span class="ident" id="2844548">name</span><span class="op" id="2844552">]</span>&nbsp;<span class="op" id="2844554">=</span>&nbsp;<span class="ident" id="2844556">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2844564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2844571">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2844577">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2844583">decls</span><span class="op" id="2844588">[</span><span class="ident" id="2844589">i</span><span class="op" id="2844590">]</span>&nbsp;<span class="op" id="2844592">=</span>&nbsp;<span class="ident" id="2844594">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2844600">i</span><span class="op" id="2844601">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2844607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2844611">}</span><br>
<span class="lineno">410</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2844616">//&nbsp;Eliminate&nbsp;nil&nbsp;entries&nbsp;from&nbsp;the&nbsp;decls&nbsp;list&nbsp;if&nbsp;entries&nbsp;were</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2844679">//&nbsp;filtered.&nbsp;We&nbsp;do&nbsp;this&nbsp;using&nbsp;a&nbsp;2nd&nbsp;pass&nbsp;in&nbsp;order&nbsp;to&nbsp;not&nbsp;disturb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2844746">//&nbsp;the&nbsp;original&nbsp;declaration&nbsp;order&nbsp;in&nbsp;the&nbsp;source&nbsp;(otherwise,&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2844813">//&nbsp;would&nbsp;also&nbsp;invalidate&nbsp;the&nbsp;monotonically&nbsp;increasing&nbsp;position</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2844878">//&nbsp;info&nbsp;within&nbsp;a&nbsp;single&nbsp;file).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2844911">if</span>&nbsp;<span class="ident" id="2844914">n</span>&nbsp;<span class="op" id="2844916">&gt;</span>&nbsp;<span class="num" id="2844918">0</span>&nbsp;<span class="op" id="2844920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2844925">i</span>&nbsp;<span class="op" id="2844927">=</span>&nbsp;<span class="num" id="2844929">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2844934">for</span>&nbsp;<span class="ident" id="2844938">_</span><span class="op" id="2844939">,</span>&nbsp;<span class="ident" id="2844941">d</span>&nbsp;<span class="op" id="2844943">:=</span>&nbsp;<span class="keyword" id="2844946">range</span>&nbsp;<span class="ident" id="2844952">decls</span>&nbsp;<span class="op" id="2844958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2844964">if</span>&nbsp;<span class="ident" id="2844967">d</span>&nbsp;<span class="op" id="2844969">!=</span>&nbsp;<span class="ident" id="2844972">nil</span>&nbsp;<span class="op" id="2844976">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2844983">decls</span><span class="op" id="2844988">[</span><span class="ident" id="2844989">i</span><span class="op" id="2844990">]</span>&nbsp;<span class="op" id="2844992">=</span>&nbsp;<span class="ident" id="2844994">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2845001">i</span><span class="op" id="2845002">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2845009">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2845014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2845019">decls</span>&nbsp;<span class="op" id="2845025">=</span>&nbsp;<span class="ident" id="2845027">decls</span><span class="op" id="2845032">[</span><span class="num" id="2845033">0</span><span class="op" id="2845034">:</span><span class="ident" id="2845035">i</span><span class="op" id="2845036">]</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2845040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2845043">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2845047">//&nbsp;Collect&nbsp;import&nbsp;specs&nbsp;from&nbsp;all&nbsp;package&nbsp;files.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2845096">var</span>&nbsp;<span class="ident" id="2845100">imports</span>&nbsp;<span class="op" id="2845108">[</span><span class="op" id="2845109">]</span><span class="op" id="2845110">*</span><span class="ident" id="2845111">ImportSpec</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2845123">if</span>&nbsp;<span class="ident" id="2845126">mode</span><span class="op" id="2845130">&amp;</span><span class="ident" id="2845131">FilterImportDuplicates</span>&nbsp;<span class="op" id="2845154">!=</span>&nbsp;<span class="num" id="2845157">0</span>&nbsp;<span class="op" id="2845159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2845163">seen</span>&nbsp;<span class="op" id="2845168">:=</span>&nbsp;<span class="builtinfunc" id="2845171">make</span><span class="op" id="2845175">(</span><span class="keyword" id="2845176">map</span><span class="op" id="2845179">[</span><span class="builtintype" id="2845180">string</span><span class="op" id="2845186">]</span><span class="builtintype" id="2845187">bool</span><span class="op" id="2845191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2845195">for</span>&nbsp;<span class="ident" id="2845199">_</span><span class="op" id="2845200">,</span>&nbsp;<span class="ident" id="2845202">filename</span>&nbsp;<span class="op" id="2845211">:=</span>&nbsp;<span class="keyword" id="2845214">range</span>&nbsp;<span class="ident" id="2845220">filenames</span>&nbsp;<span class="op" id="2845230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2845235">f</span>&nbsp;<span class="op" id="2845237">:=</span>&nbsp;<span class="ident" id="2845240">pkg</span><span class="op" id="2845243">.</span><span class="ident" id="2845244">Files</span><span class="op" id="2845249">[</span><span class="ident" id="2845250">filename</span><span class="op" id="2845258">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2845263">for</span>&nbsp;<span class="ident" id="2845267">_</span><span class="op" id="2845268">,</span>&nbsp;<span class="ident" id="2845270">imp</span>&nbsp;<span class="op" id="2845274">:=</span>&nbsp;<span class="keyword" id="2845277">range</span>&nbsp;<span class="ident" id="2845283">f</span><span class="op" id="2845284">.</span><span class="ident" id="2845285">Imports</span>&nbsp;<span class="op" id="2845293">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2845299">if</span>&nbsp;<span class="ident" id="2845302">path</span>&nbsp;<span class="op" id="2845307">:=</span>&nbsp;<span class="ident" id="2845310">imp</span><span class="op" id="2845313">.</span><span class="ident" id="2845314">Path</span><span class="op" id="2845318">.</span><span class="ident" id="2845319">Value</span><span class="op" id="2845324">;</span>&nbsp;<span class="op" id="2845326">!</span><span class="ident" id="2845327">seen</span><span class="op" id="2845331">[</span><span class="ident" id="2845332">path</span><span class="op" id="2845336">]</span>&nbsp;<span class="op" id="2845338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2845345">//&nbsp;TODO:&nbsp;consider&nbsp;handling&nbsp;cases&nbsp;where:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2845390">//&nbsp;-&nbsp;2&nbsp;imports&nbsp;exist&nbsp;with&nbsp;the&nbsp;same&nbsp;import&nbsp;path&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2845446">//&nbsp;&nbsp;&nbsp;have&nbsp;different&nbsp;local&nbsp;names&nbsp;(one&nbsp;should&nbsp;probably</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2845504">//&nbsp;&nbsp;&nbsp;keep&nbsp;both&nbsp;of&nbsp;them)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2845533">//&nbsp;-&nbsp;2&nbsp;imports&nbsp;exist&nbsp;but&nbsp;only&nbsp;one&nbsp;has&nbsp;a&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2845586">//&nbsp;-&nbsp;2&nbsp;imports&nbsp;exist&nbsp;and&nbsp;they&nbsp;both&nbsp;have&nbsp;(possibly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2845641">//&nbsp;&nbsp;&nbsp;different)&nbsp;comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2845671">imports</span>&nbsp;<span class="op" id="2845679">=</span>&nbsp;<span class="builtinfunc" id="2845681">append</span><span class="op" id="2845687">(</span><span class="ident" id="2845688">imports</span><span class="op" id="2845695">,</span>&nbsp;<span class="ident" id="2845697">imp</span><span class="op" id="2845700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2845707">seen</span><span class="op" id="2845711">[</span><span class="ident" id="2845712">path</span><span class="op" id="2845716">]</span>&nbsp;<span class="op" id="2845718">=</span>&nbsp;<span class="builtintype" id="2845720">true</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2845729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2845734">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2845738">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2845741">}</span>&nbsp;<span class="keyword" id="2845743">else</span>&nbsp;<span class="op" id="2845748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2845752">for</span>&nbsp;<span class="ident" id="2845756">_</span><span class="op" id="2845757">,</span>&nbsp;<span class="ident" id="2845759">f</span>&nbsp;<span class="op" id="2845761">:=</span>&nbsp;<span class="keyword" id="2845764">range</span>&nbsp;<span class="ident" id="2845770">pkg</span><span class="op" id="2845773">.</span><span class="ident" id="2845774">Files</span>&nbsp;<span class="op" id="2845780">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2845785">imports</span>&nbsp;<span class="op" id="2845793">=</span>&nbsp;<span class="builtinfunc" id="2845795">append</span><span class="op" id="2845801">(</span><span class="ident" id="2845802">imports</span><span class="op" id="2845809">,</span>&nbsp;<span class="ident" id="2845811">f</span><span class="op" id="2845812">.</span><span class="ident" id="2845813">Imports</span><span class="op" id="2845820">...</span><span class="op" id="2845823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2845827">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2845830">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2845834">//&nbsp;Collect&nbsp;comments&nbsp;from&nbsp;all&nbsp;package&nbsp;files.</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2845879">var</span>&nbsp;<span class="ident" id="2845883">comments</span>&nbsp;<span class="op" id="2845892">[</span><span class="op" id="2845893">]</span><span class="op" id="2845894">*</span><span class="ident" id="2845895">CommentGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2845909">if</span>&nbsp;<span class="ident" id="2845912">mode</span><span class="op" id="2845916">&amp;</span><span class="ident" id="2845917">FilterUnassociatedComments</span>&nbsp;<span class="op" id="2845944">==</span>&nbsp;<span class="num" id="2845947">0</span>&nbsp;<span class="op" id="2845949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2845953">comments</span>&nbsp;<span class="op" id="2845962">=</span>&nbsp;<span class="builtinfunc" id="2845964">make</span><span class="op" id="2845968">(</span><span class="op" id="2845969">[</span><span class="op" id="2845970">]</span><span class="op" id="2845971">*</span><span class="ident" id="2845972">CommentGroup</span><span class="op" id="2845984">,</span>&nbsp;<span class="ident" id="2845986">ncomments</span><span class="op" id="2845995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2845999">i</span>&nbsp;<span class="op" id="2846001">:=</span>&nbsp;<span class="num" id="2846004">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2846008">for</span>&nbsp;<span class="ident" id="2846012">_</span><span class="op" id="2846013">,</span>&nbsp;<span class="ident" id="2846015">f</span>&nbsp;<span class="op" id="2846017">:=</span>&nbsp;<span class="keyword" id="2846020">range</span>&nbsp;<span class="ident" id="2846026">pkg</span><span class="op" id="2846029">.</span><span class="ident" id="2846030">Files</span>&nbsp;<span class="op" id="2846036">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2846041">i</span>&nbsp;<span class="op" id="2846043">+=</span>&nbsp;<span class="builtinfunc" id="2846046">copy</span><span class="op" id="2846050">(</span><span class="ident" id="2846051">comments</span><span class="op" id="2846059">[</span><span class="ident" id="2846060">i</span><span class="op" id="2846061">:</span><span class="op" id="2846062">]</span><span class="op" id="2846063">,</span>&nbsp;<span class="ident" id="2846065">f</span><span class="op" id="2846066">.</span><span class="ident" id="2846067">Comments</span><span class="op" id="2846075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2846079">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2846082">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2846086">//&nbsp;TODO(gri)&nbsp;need&nbsp;to&nbsp;compute&nbsp;unresolved&nbsp;identifiers!</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2846140">return</span>&nbsp;<span class="op" id="2846147">&amp;</span><span class="ident" id="2846148">File</span><span class="op" id="2846152">{</span><span class="ident" id="2846153">doc</span><span class="op" id="2846156">,</span>&nbsp;<span class="ident" id="2846158">pos</span><span class="op" id="2846161">,</span>&nbsp;<span class="ident" id="2846163">NewIdent</span><span class="op" id="2846171">(</span><span class="ident" id="2846172">pkg</span><span class="op" id="2846175">.</span><span class="ident" id="2846176">Name</span><span class="op" id="2846180">)</span><span class="op" id="2846181">,</span>&nbsp;<span class="ident" id="2846183">decls</span><span class="op" id="2846188">,</span>&nbsp;<span class="ident" id="2846190">pkg</span><span class="op" id="2846193">.</span><span class="ident" id="2846194">Scope</span><span class="op" id="2846199">,</span>&nbsp;<span class="ident" id="2846201">imports</span><span class="op" id="2846208">,</span>&nbsp;<span class="ident" id="2846210">nil</span><span class="op" id="2846213">,</span>&nbsp;<span class="ident" id="2846215">comments</span><span class="op" id="2846223">}</span><br>
<span class="lineno"></span><span class="op" id="2846225">}</span>
</div>
</body>
</html>
