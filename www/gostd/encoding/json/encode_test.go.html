<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/json</h2>
<ul>
<li><a href="/gostd/encoding/json/bench_test.go.html">bench_test.go</a></li>
<li><a href="/gostd/encoding/json/decode.go.html">decode.go</a></li>
<li><a href="/gostd/encoding/json/decode_test.go.html">decode_test.go</a></li>
<li><a href="/gostd/encoding/json/encode.go.html">encode.go</a></li>
<li><a href="/gostd/encoding/json/encode_test.go.html">encode_test.go</a></li>
<li><a href="/gostd/encoding/json/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/json/fold.go.html">fold.go</a></li>
<li><a href="/gostd/encoding/json/fold_test.go.html">fold_test.go</a></li>
<li><a href="/gostd/encoding/json/indent.go.html">indent.go</a></li>
<li><a href="/gostd/encoding/json/scanner.go.html">scanner.go</a></li>
<li><a href="/gostd/encoding/json/scanner_test.go.html">scanner_test.go</a></li>
<li><a href="/gostd/encoding/json/stream.go.html">stream.go</a></li>
<li><a href="/gostd/encoding/json/stream_test.go.html">stream_test.go</a></li>
<li><a href="/gostd/encoding/json/tagkey_test.go.html">tagkey_test.go</a></li>
<li><a href="/gostd/encoding/json/tags.go.html">tags.go</a></li>
<li><a href="/gostd/encoding/json/tags_test.go.html">tags_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7627354">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7627409">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7627463">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7627514">package</span>&nbsp;<span class="ident" id="7627522">json</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7627528">import</span>&nbsp;<span class="op" id="7627535">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7627538">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7627547">&#34;math&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7627555">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7627566">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7627577">&#34;unicode&#34;</span><br>
<span class="lineno"></span><span class="op" id="7627587">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="7627590">type</span>&nbsp;<span class="ident" id="7627595">Optionals</span>&nbsp;<span class="keyword" id="7627605">struct</span>&nbsp;<span class="op" id="7627612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7627615">Sr</span>&nbsp;<span class="builtintype" id="7627618">string</span>&nbsp;<span class="string" id="7627625">`json:&#34;sr&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7627638">So</span>&nbsp;<span class="builtintype" id="7627641">string</span>&nbsp;<span class="string" id="7627648">`json:&#34;so,omitempty&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7627671">Sw</span>&nbsp;<span class="builtintype" id="7627674">string</span>&nbsp;<span class="string" id="7627681">`json:&#34;-&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7627694">Ir</span>&nbsp;<span class="builtintype" id="7627697">int</span>&nbsp;<span class="string" id="7627701">`json:&#34;omitempty&#34;`</span>&nbsp;<span class="comment" id="7627720">//&nbsp;actually&nbsp;named&nbsp;omitempty,&nbsp;not&nbsp;an&nbsp;option</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7627764">Io</span>&nbsp;<span class="builtintype" id="7627767">int</span>&nbsp;<span class="string" id="7627771">`json:&#34;io,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7627795">Slr</span>&nbsp;<span class="op" id="7627799">[</span><span class="op" id="7627800">]</span><span class="builtintype" id="7627801">string</span>&nbsp;<span class="string" id="7627808">`json:&#34;slr,random&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7627829">Slo</span>&nbsp;<span class="op" id="7627833">[</span><span class="op" id="7627834">]</span><span class="builtintype" id="7627835">string</span>&nbsp;<span class="string" id="7627842">`json:&#34;slo,omitempty&#34;`</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7627867">Mr</span>&nbsp;<span class="keyword" id="7627870">map</span><span class="op" id="7627873">[</span><span class="builtintype" id="7627874">string</span><span class="op" id="7627880">]</span><span class="keyword" id="7627881">interface</span><span class="op" id="7627890">{</span><span class="op" id="7627891">}</span>&nbsp;<span class="string" id="7627893">`json:&#34;mr&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7627906">Mo</span>&nbsp;<span class="keyword" id="7627909">map</span><span class="op" id="7627912">[</span><span class="builtintype" id="7627913">string</span><span class="op" id="7627919">]</span><span class="keyword" id="7627920">interface</span><span class="op" id="7627929">{</span><span class="op" id="7627930">}</span>&nbsp;<span class="string" id="7627932">`json:&#34;,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7627954">Fr</span>&nbsp;<span class="builtintype" id="7627957">float64</span>&nbsp;<span class="string" id="7627965">`json:&#34;fr&#34;`</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7627978">Fo</span>&nbsp;<span class="builtintype" id="7627981">float64</span>&nbsp;<span class="string" id="7627989">`json:&#34;fo,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7628013">Br</span>&nbsp;<span class="builtintype" id="7628016">bool</span>&nbsp;<span class="string" id="7628021">`json:&#34;br&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7628034">Bo</span>&nbsp;<span class="builtintype" id="7628037">bool</span>&nbsp;<span class="string" id="7628042">`json:&#34;bo,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7628066">Ur</span>&nbsp;<span class="builtintype" id="7628069">uint</span>&nbsp;<span class="string" id="7628074">`json:&#34;ur&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7628087">Uo</span>&nbsp;<span class="builtintype" id="7628090">uint</span>&nbsp;<span class="string" id="7628095">`json:&#34;uo,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7628119">Str</span>&nbsp;<span class="keyword" id="7628123">struct</span><span class="op" id="7628129">{</span><span class="op" id="7628130">}</span>&nbsp;<span class="string" id="7628132">`json:&#34;str&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7628146">Sto</span>&nbsp;<span class="keyword" id="7628150">struct</span><span class="op" id="7628156">{</span><span class="op" id="7628157">}</span>&nbsp;<span class="string" id="7628159">`json:&#34;sto,omitempty&#34;`</span><br>
<span class="lineno">40</span><span class="op" id="7628182">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7628185">var</span>&nbsp;<span class="ident" id="7628189">optionalsExpected</span>&nbsp;<span class="op" id="7628207">=</span>&nbsp;<span class="string" id="7628209">`{<br>
<span class="lineno"></span>&nbsp;&#34;sr&#34;:&nbsp;&#34;&#34;,<br>
<span class="lineno"></span>&nbsp;&#34;omitempty&#34;:&nbsp;0,<br>
<span class="lineno">45</span>&nbsp;&#34;slr&#34;:&nbsp;null,<br>
<span class="lineno"></span>&nbsp;&#34;mr&#34;:&nbsp;{},<br>
<span class="lineno"></span>&nbsp;&#34;fr&#34;:&nbsp;0,<br>
<span class="lineno"></span>&nbsp;&#34;br&#34;:&nbsp;false,<br>
<span class="lineno"></span>&nbsp;&#34;ur&#34;:&nbsp;0,<br>
<span class="lineno">50</span>&nbsp;&#34;str&#34;:&nbsp;{},<br>
<span class="lineno"></span>&nbsp;&#34;sto&#34;:&nbsp;{}<br>
<span class="lineno"></span>}`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7628326">func</span>&nbsp;<span class="ident" id="7628331">TestOmitEmpty</span><span class="op" id="7628344">(</span><span class="ident" id="7628345">t</span>&nbsp;<span class="op" id="7628347">*</span><span class="ident" id="7628348">testing</span><span class="op" id="7628355">.</span><span class="ident" id="7628356">T</span><span class="op" id="7628357">)</span>&nbsp;<span class="op" id="7628359">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7628362">var</span>&nbsp;<span class="ident" id="7628366">o</span>&nbsp;<span class="ident" id="7628368">Optionals</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7628379">o</span><span class="op" id="7628380">.</span><span class="ident" id="7628381">Sw</span>&nbsp;<span class="op" id="7628384">=</span>&nbsp;<span class="string" id="7628386">&#34;something&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7628399">o</span><span class="op" id="7628400">.</span><span class="ident" id="7628401">Mr</span>&nbsp;<span class="op" id="7628404">=</span>&nbsp;<span class="keyword" id="7628406">map</span><span class="op" id="7628409">[</span><span class="builtintype" id="7628410">string</span><span class="op" id="7628416">]</span><span class="keyword" id="7628417">interface</span><span class="op" id="7628426">{</span><span class="op" id="7628427">}</span><span class="op" id="7628428">{</span><span class="op" id="7628429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7628432">o</span><span class="op" id="7628433">.</span><span class="ident" id="7628434">Mo</span>&nbsp;<span class="op" id="7628437">=</span>&nbsp;<span class="keyword" id="7628439">map</span><span class="op" id="7628442">[</span><span class="builtintype" id="7628443">string</span><span class="op" id="7628449">]</span><span class="keyword" id="7628450">interface</span><span class="op" id="7628459">{</span><span class="op" id="7628460">}</span><span class="op" id="7628461">{</span><span class="op" id="7628462">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7628466">got</span><span class="op" id="7628469">,</span>&nbsp;<span class="ident" id="7628471">err</span>&nbsp;<span class="op" id="7628475">:=</span>&nbsp;<span class="ident" id="7628478">MarshalIndent</span><span class="op" id="7628491">(</span><span class="op" id="7628492">&amp;</span><span class="ident" id="7628493">o</span><span class="op" id="7628494">,</span>&nbsp;<span class="string" id="7628496">&#34;&#34;</span><span class="op" id="7628498">,</span>&nbsp;<span class="string" id="7628500">&#34;&nbsp;&#34;</span><span class="op" id="7628503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7628506">if</span>&nbsp;<span class="ident" id="7628509">err</span>&nbsp;<span class="op" id="7628513">!=</span>&nbsp;<span class="ident" id="7628516">nil</span>&nbsp;<span class="op" id="7628520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7628524">t</span><span class="op" id="7628525">.</span><span class="ident" id="7628526">Fatal</span><span class="op" id="7628531">(</span><span class="ident" id="7628532">err</span><span class="op" id="7628535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7628538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7628541">if</span>&nbsp;<span class="ident" id="7628544">got</span>&nbsp;<span class="op" id="7628548">:=</span>&nbsp;<span class="builtintype" id="7628551">string</span><span class="op" id="7628557">(</span><span class="ident" id="7628558">got</span><span class="op" id="7628561">)</span><span class="op" id="7628562">;</span>&nbsp;<span class="ident" id="7628564">got</span>&nbsp;<span class="op" id="7628568">!=</span>&nbsp;<span class="ident" id="7628571">optionalsExpected</span>&nbsp;<span class="op" id="7628589">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7628593">t</span><span class="op" id="7628594">.</span><span class="ident" id="7628595">Errorf</span><span class="op" id="7628601">(</span><span class="string" id="7628602">&#34;&nbsp;got:&nbsp;%s\nwant:&nbsp;%s\n&#34;</span><span class="op" id="7628624">,</span>&nbsp;<span class="ident" id="7628626">got</span><span class="op" id="7628629">,</span>&nbsp;<span class="ident" id="7628631">optionalsExpected</span><span class="op" id="7628648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7628651">}</span><br>
<span class="lineno"></span><span class="op" id="7628653">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7628656">type</span>&nbsp;<span class="ident" id="7628661">StringTag</span>&nbsp;<span class="keyword" id="7628671">struct</span>&nbsp;<span class="op" id="7628678">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7628681">BoolStr</span>&nbsp;<span class="builtintype" id="7628689">bool</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7628696">`json:&#34;,string&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7628714">IntStr</span>&nbsp;&nbsp;<span class="ident" id="7628722">int64</span>&nbsp;&nbsp;<span class="string" id="7628729">`json:&#34;,string&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7628747">StrStr</span>&nbsp;&nbsp;<span class="builtintype" id="7628755">string</span>&nbsp;<span class="string" id="7628762">`json:&#34;,string&#34;`</span><br>
<span class="lineno"></span><span class="op" id="7628779">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="7628782">var</span>&nbsp;<span class="ident" id="7628786">stringTagExpected</span>&nbsp;<span class="op" id="7628804">=</span>&nbsp;<span class="string" id="7628806">`{<br>
<span class="lineno"></span>&nbsp;&#34;BoolStr&#34;:&nbsp;&#34;true&#34;,<br>
<span class="lineno"></span>&nbsp;&#34;IntStr&#34;:&nbsp;&#34;42&#34;,<br>
<span class="lineno"></span>&nbsp;&#34;StrStr&#34;:&nbsp;&#34;\&#34;xzbit\&#34;&#34;<br>
<span class="lineno"></span>}`</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="keyword" id="7628873">func</span>&nbsp;<span class="ident" id="7628878">TestStringTag</span><span class="op" id="7628891">(</span><span class="ident" id="7628892">t</span>&nbsp;<span class="op" id="7628894">*</span><span class="ident" id="7628895">testing</span><span class="op" id="7628902">.</span><span class="ident" id="7628903">T</span><span class="op" id="7628904">)</span>&nbsp;<span class="op" id="7628906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7628909">var</span>&nbsp;<span class="ident" id="7628913">s</span>&nbsp;<span class="ident" id="7628915">StringTag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7628926">s</span><span class="op" id="7628927">.</span><span class="ident" id="7628928">BoolStr</span>&nbsp;<span class="op" id="7628936">=</span>&nbsp;<span class="builtintype" id="7628938">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7628944">s</span><span class="op" id="7628945">.</span><span class="ident" id="7628946">IntStr</span>&nbsp;<span class="op" id="7628953">=</span>&nbsp;<span class="num" id="7628955">42</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7628959">s</span><span class="op" id="7628960">.</span><span class="ident" id="7628961">StrStr</span>&nbsp;<span class="op" id="7628968">=</span>&nbsp;<span class="string" id="7628970">&#34;xzbit&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7628979">got</span><span class="op" id="7628982">,</span>&nbsp;<span class="ident" id="7628984">err</span>&nbsp;<span class="op" id="7628988">:=</span>&nbsp;<span class="ident" id="7628991">MarshalIndent</span><span class="op" id="7629004">(</span><span class="op" id="7629005">&amp;</span><span class="ident" id="7629006">s</span><span class="op" id="7629007">,</span>&nbsp;<span class="string" id="7629009">&#34;&#34;</span><span class="op" id="7629011">,</span>&nbsp;<span class="string" id="7629013">&#34;&nbsp;&#34;</span><span class="op" id="7629016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7629019">if</span>&nbsp;<span class="ident" id="7629022">err</span>&nbsp;<span class="op" id="7629026">!=</span>&nbsp;<span class="ident" id="7629029">nil</span>&nbsp;<span class="op" id="7629033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7629037">t</span><span class="op" id="7629038">.</span><span class="ident" id="7629039">Fatal</span><span class="op" id="7629044">(</span><span class="ident" id="7629045">err</span><span class="op" id="7629048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7629051">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7629054">if</span>&nbsp;<span class="ident" id="7629057">got</span>&nbsp;<span class="op" id="7629061">:=</span>&nbsp;<span class="builtintype" id="7629064">string</span><span class="op" id="7629070">(</span><span class="ident" id="7629071">got</span><span class="op" id="7629074">)</span><span class="op" id="7629075">;</span>&nbsp;<span class="ident" id="7629077">got</span>&nbsp;<span class="op" id="7629081">!=</span>&nbsp;<span class="ident" id="7629084">stringTagExpected</span>&nbsp;<span class="op" id="7629102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7629106">t</span><span class="op" id="7629107">.</span><span class="ident" id="7629108">Fatalf</span><span class="op" id="7629114">(</span><span class="string" id="7629115">&#34;&nbsp;got:&nbsp;%s\nwant:&nbsp;%s\n&#34;</span><span class="op" id="7629137">,</span>&nbsp;<span class="ident" id="7629139">got</span><span class="op" id="7629142">,</span>&nbsp;<span class="ident" id="7629144">stringTagExpected</span><span class="op" id="7629161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7629164">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7629168">//&nbsp;Verify&nbsp;that&nbsp;it&nbsp;round-trips.</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7629200">var</span>&nbsp;<span class="ident" id="7629204">s2</span>&nbsp;<span class="ident" id="7629207">StringTag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7629218">err</span>&nbsp;<span class="op" id="7629222">=</span>&nbsp;<span class="ident" id="7629224">NewDecoder</span><span class="op" id="7629234">(</span><span class="ident" id="7629235">bytes</span><span class="op" id="7629240">.</span><span class="ident" id="7629241">NewReader</span><span class="op" id="7629250">(</span><span class="ident" id="7629251">got</span><span class="op" id="7629254">)</span><span class="op" id="7629255">)</span><span class="op" id="7629256">.</span><span class="ident" id="7629257">Decode</span><span class="op" id="7629263">(</span><span class="op" id="7629264">&amp;</span><span class="ident" id="7629265">s2</span><span class="op" id="7629267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7629270">if</span>&nbsp;<span class="ident" id="7629273">err</span>&nbsp;<span class="op" id="7629277">!=</span>&nbsp;<span class="ident" id="7629280">nil</span>&nbsp;<span class="op" id="7629284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7629288">t</span><span class="op" id="7629289">.</span><span class="ident" id="7629290">Fatalf</span><span class="op" id="7629296">(</span><span class="string" id="7629297">&#34;Decode:&nbsp;%v&#34;</span><span class="op" id="7629309">,</span>&nbsp;<span class="ident" id="7629311">err</span><span class="op" id="7629314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7629317">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7629320">if</span>&nbsp;<span class="op" id="7629323">!</span><span class="ident" id="7629324">reflect</span><span class="op" id="7629331">.</span><span class="ident" id="7629332">DeepEqual</span><span class="op" id="7629341">(</span><span class="ident" id="7629342">s</span><span class="op" id="7629343">,</span>&nbsp;<span class="ident" id="7629345">s2</span><span class="op" id="7629347">)</span>&nbsp;<span class="op" id="7629349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7629353">t</span><span class="op" id="7629354">.</span><span class="ident" id="7629355">Fatalf</span><span class="op" id="7629361">(</span><span class="string" id="7629362">&#34;decode&nbsp;didn&#39;t&nbsp;match.\nsource:&nbsp;%#v\nEncoded&nbsp;as:\n%s\ndecode:&nbsp;%#v&#34;</span><span class="op" id="7629427">,</span>&nbsp;<span class="ident" id="7629429">s</span><span class="op" id="7629430">,</span>&nbsp;<span class="builtintype" id="7629432">string</span><span class="op" id="7629438">(</span><span class="ident" id="7629439">got</span><span class="op" id="7629442">)</span><span class="op" id="7629443">,</span>&nbsp;<span class="ident" id="7629445">s2</span><span class="op" id="7629447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7629450">}</span><br>
<span class="lineno"></span><span class="op" id="7629452">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="7629455">//&nbsp;byte&nbsp;slices&nbsp;are&nbsp;special&nbsp;even&nbsp;if&nbsp;they&#39;re&nbsp;renamed&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="7629513">type</span>&nbsp;<span class="ident" id="7629518">renamedByte</span>&nbsp;<span class="builtintype" id="7629530">byte</span><br>
<span class="lineno"></span><span class="keyword" id="7629535">type</span>&nbsp;<span class="ident" id="7629540">renamedByteSlice</span>&nbsp;<span class="op" id="7629557">[</span><span class="op" id="7629558">]</span><span class="builtintype" id="7629559">byte</span><br>
<span class="lineno"></span><span class="keyword" id="7629564">type</span>&nbsp;<span class="ident" id="7629569">renamedRenamedByteSlice</span>&nbsp;<span class="op" id="7629593">[</span><span class="op" id="7629594">]</span><span class="ident" id="7629595">renamedByte</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="7629608">func</span>&nbsp;<span class="ident" id="7629613">TestEncodeRenamedByteSlice</span><span class="op" id="7629639">(</span><span class="ident" id="7629640">t</span>&nbsp;<span class="op" id="7629642">*</span><span class="ident" id="7629643">testing</span><span class="op" id="7629650">.</span><span class="ident" id="7629651">T</span><span class="op" id="7629652">)</span>&nbsp;<span class="op" id="7629654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7629657">s</span>&nbsp;<span class="op" id="7629659">:=</span>&nbsp;<span class="ident" id="7629662">renamedByteSlice</span><span class="op" id="7629678">(</span><span class="string" id="7629679">&#34;abc&#34;</span><span class="op" id="7629684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7629687">result</span><span class="op" id="7629693">,</span>&nbsp;<span class="ident" id="7629695">err</span>&nbsp;<span class="op" id="7629699">:=</span>&nbsp;<span class="ident" id="7629702">Marshal</span><span class="op" id="7629709">(</span><span class="ident" id="7629710">s</span><span class="op" id="7629711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7629714">if</span>&nbsp;<span class="ident" id="7629717">err</span>&nbsp;<span class="op" id="7629721">!=</span>&nbsp;<span class="ident" id="7629724">nil</span>&nbsp;<span class="op" id="7629728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7629732">t</span><span class="op" id="7629733">.</span><span class="ident" id="7629734">Fatal</span><span class="op" id="7629739">(</span><span class="ident" id="7629740">err</span><span class="op" id="7629743">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7629746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7629749">expect</span>&nbsp;<span class="op" id="7629756">:=</span>&nbsp;<span class="string" id="7629759">`&#34;YWJj&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7629769">if</span>&nbsp;<span class="builtintype" id="7629772">string</span><span class="op" id="7629778">(</span><span class="ident" id="7629779">result</span><span class="op" id="7629785">)</span>&nbsp;<span class="op" id="7629787">!=</span>&nbsp;<span class="ident" id="7629790">expect</span>&nbsp;<span class="op" id="7629797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7629801">t</span><span class="op" id="7629802">.</span><span class="ident" id="7629803">Errorf</span><span class="op" id="7629809">(</span><span class="string" id="7629810">&#34;&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="7629827">,</span>&nbsp;<span class="ident" id="7629829">result</span><span class="op" id="7629835">,</span>&nbsp;<span class="ident" id="7629837">expect</span><span class="op" id="7629843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7629846">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7629849">r</span>&nbsp;<span class="op" id="7629851">:=</span>&nbsp;<span class="ident" id="7629854">renamedRenamedByteSlice</span><span class="op" id="7629877">(</span><span class="string" id="7629878">&#34;abc&#34;</span><span class="op" id="7629883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7629886">result</span><span class="op" id="7629892">,</span>&nbsp;<span class="ident" id="7629894">err</span>&nbsp;<span class="op" id="7629898">=</span>&nbsp;<span class="ident" id="7629900">Marshal</span><span class="op" id="7629907">(</span><span class="ident" id="7629908">r</span><span class="op" id="7629909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7629912">if</span>&nbsp;<span class="ident" id="7629915">err</span>&nbsp;<span class="op" id="7629919">!=</span>&nbsp;<span class="ident" id="7629922">nil</span>&nbsp;<span class="op" id="7629926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7629930">t</span><span class="op" id="7629931">.</span><span class="ident" id="7629932">Fatal</span><span class="op" id="7629937">(</span><span class="ident" id="7629938">err</span><span class="op" id="7629941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7629944">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7629947">if</span>&nbsp;<span class="builtintype" id="7629950">string</span><span class="op" id="7629956">(</span><span class="ident" id="7629957">result</span><span class="op" id="7629963">)</span>&nbsp;<span class="op" id="7629965">!=</span>&nbsp;<span class="ident" id="7629968">expect</span>&nbsp;<span class="op" id="7629975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7629979">t</span><span class="op" id="7629980">.</span><span class="ident" id="7629981">Errorf</span><span class="op" id="7629987">(</span><span class="string" id="7629988">&#34;&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="7630005">,</span>&nbsp;<span class="ident" id="7630007">result</span><span class="op" id="7630013">,</span>&nbsp;<span class="ident" id="7630015">expect</span><span class="op" id="7630021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7630024">}</span><br>
<span class="lineno"></span><span class="op" id="7630026">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="7630029">var</span>&nbsp;<span class="ident" id="7630033">unsupportedValues</span>&nbsp;<span class="op" id="7630051">=</span>&nbsp;<span class="op" id="7630053">[</span><span class="op" id="7630054">]</span><span class="keyword" id="7630055">interface</span><span class="op" id="7630064">{</span><span class="op" id="7630065">}</span><span class="op" id="7630066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7630069">math</span><span class="op" id="7630073">.</span><span class="ident" id="7630074">NaN</span><span class="op" id="7630077">(</span><span class="op" id="7630078">)</span><span class="op" id="7630079">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7630082">math</span><span class="op" id="7630086">.</span><span class="ident" id="7630087">Inf</span><span class="op" id="7630090">(</span><span class="op" id="7630091">-</span><span class="num" id="7630092">1</span><span class="op" id="7630093">)</span><span class="op" id="7630094">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7630097">math</span><span class="op" id="7630101">.</span><span class="ident" id="7630102">Inf</span><span class="op" id="7630105">(</span><span class="num" id="7630106">1</span><span class="op" id="7630107">)</span><span class="op" id="7630108">,</span><br>
<span class="lineno"></span><span class="op" id="7630110">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="keyword" id="7630113">func</span>&nbsp;<span class="ident" id="7630118">TestUnsupportedValues</span><span class="op" id="7630139">(</span><span class="ident" id="7630140">t</span>&nbsp;<span class="op" id="7630142">*</span><span class="ident" id="7630143">testing</span><span class="op" id="7630150">.</span><span class="ident" id="7630151">T</span><span class="op" id="7630152">)</span>&nbsp;<span class="op" id="7630154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7630157">for</span>&nbsp;<span class="ident" id="7630161">_</span><span class="op" id="7630162">,</span>&nbsp;<span class="ident" id="7630164">v</span>&nbsp;<span class="op" id="7630166">:=</span>&nbsp;<span class="keyword" id="7630169">range</span>&nbsp;<span class="ident" id="7630175">unsupportedValues</span>&nbsp;<span class="op" id="7630193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7630197">if</span>&nbsp;<span class="ident" id="7630200">_</span><span class="op" id="7630201">,</span>&nbsp;<span class="ident" id="7630203">err</span>&nbsp;<span class="op" id="7630207">:=</span>&nbsp;<span class="ident" id="7630210">Marshal</span><span class="op" id="7630217">(</span><span class="ident" id="7630218">v</span><span class="op" id="7630219">)</span><span class="op" id="7630220">;</span>&nbsp;<span class="ident" id="7630222">err</span>&nbsp;<span class="op" id="7630226">!=</span>&nbsp;<span class="ident" id="7630229">nil</span>&nbsp;<span class="op" id="7630233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7630238">if</span>&nbsp;<span class="ident" id="7630241">_</span><span class="op" id="7630242">,</span>&nbsp;<span class="ident" id="7630244">ok</span>&nbsp;<span class="op" id="7630247">:=</span>&nbsp;<span class="ident" id="7630250">err</span><span class="op" id="7630253">.</span><span class="op" id="7630254">(</span><span class="op" id="7630255">*</span><span class="ident" id="7630256">UnsupportedValueError</span><span class="op" id="7630277">)</span><span class="op" id="7630278">;</span>&nbsp;<span class="op" id="7630280">!</span><span class="ident" id="7630281">ok</span>&nbsp;<span class="op" id="7630284">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7630290">t</span><span class="op" id="7630291">.</span><span class="ident" id="7630292">Errorf</span><span class="op" id="7630298">(</span><span class="string" id="7630299">&#34;for&nbsp;%v,&nbsp;got&nbsp;%T&nbsp;want&nbsp;UnsupportedValueError&#34;</span><span class="op" id="7630342">,</span>&nbsp;<span class="ident" id="7630344">v</span><span class="op" id="7630345">,</span>&nbsp;<span class="ident" id="7630347">err</span><span class="op" id="7630350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7630355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7630359">}</span>&nbsp;<span class="keyword" id="7630361">else</span>&nbsp;<span class="op" id="7630366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7630371">t</span><span class="op" id="7630372">.</span><span class="ident" id="7630373">Errorf</span><span class="op" id="7630379">(</span><span class="string" id="7630380">&#34;for&nbsp;%v,&nbsp;expected&nbsp;error&#34;</span><span class="op" id="7630404">,</span>&nbsp;<span class="ident" id="7630406">v</span><span class="op" id="7630407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7630411">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7630414">}</span><br>
<span class="lineno"></span><span class="op" id="7630416">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7630419">//&nbsp;Ref&nbsp;has&nbsp;Marshaler&nbsp;and&nbsp;Unmarshaler&nbsp;methods&nbsp;with&nbsp;pointer&nbsp;receiver.</span><br>
<span class="lineno"></span><span class="keyword" id="7630487">type</span>&nbsp;<span class="ident" id="7630492">Ref</span>&nbsp;<span class="builtintype" id="7630496">int</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="keyword" id="7630501">func</span>&nbsp;<span class="op" id="7630506">(</span><span class="op" id="7630507">*</span><span class="ident" id="7630508">Ref</span><span class="op" id="7630511">)</span>&nbsp;<span class="ident" id="7630513">MarshalJSON</span><span class="op" id="7630524">(</span><span class="op" id="7630525">)</span>&nbsp;<span class="op" id="7630527">(</span><span class="op" id="7630528">[</span><span class="op" id="7630529">]</span><span class="builtintype" id="7630530">byte</span><span class="op" id="7630534">,</span>&nbsp;<span class="builtintype" id="7630536">error</span><span class="op" id="7630541">)</span>&nbsp;<span class="op" id="7630543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7630546">return</span>&nbsp;<span class="op" id="7630553">[</span><span class="op" id="7630554">]</span><span class="builtintype" id="7630555">byte</span><span class="op" id="7630559">(</span><span class="string" id="7630560">`&#34;ref&#34;`</span><span class="op" id="7630567">)</span><span class="op" id="7630568">,</span>&nbsp;<span class="ident" id="7630570">nil</span><br>
<span class="lineno"></span><span class="op" id="7630574">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="keyword" id="7630577">func</span>&nbsp;<span class="op" id="7630582">(</span><span class="ident" id="7630583">r</span>&nbsp;<span class="op" id="7630585">*</span><span class="ident" id="7630586">Ref</span><span class="op" id="7630589">)</span>&nbsp;<span class="ident" id="7630591">UnmarshalJSON</span><span class="op" id="7630604">(</span><span class="op" id="7630605">[</span><span class="op" id="7630606">]</span><span class="builtintype" id="7630607">byte</span><span class="op" id="7630611">)</span>&nbsp;<span class="builtintype" id="7630613">error</span>&nbsp;<span class="op" id="7630619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7630622">*</span><span class="ident" id="7630623">r</span>&nbsp;<span class="op" id="7630625">=</span>&nbsp;<span class="num" id="7630627">12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7630631">return</span>&nbsp;<span class="ident" id="7630638">nil</span><br>
<span class="lineno"></span><span class="op" id="7630642">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="7630645">//&nbsp;Val&nbsp;has&nbsp;Marshaler&nbsp;methods&nbsp;with&nbsp;value&nbsp;receiver.</span><br>
<span class="lineno"></span><span class="keyword" id="7630695">type</span>&nbsp;<span class="ident" id="7630700">Val</span>&nbsp;<span class="builtintype" id="7630704">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7630709">func</span>&nbsp;<span class="op" id="7630714">(</span><span class="ident" id="7630715">Val</span><span class="op" id="7630718">)</span>&nbsp;<span class="ident" id="7630720">MarshalJSON</span><span class="op" id="7630731">(</span><span class="op" id="7630732">)</span>&nbsp;<span class="op" id="7630734">(</span><span class="op" id="7630735">[</span><span class="op" id="7630736">]</span><span class="builtintype" id="7630737">byte</span><span class="op" id="7630741">,</span>&nbsp;<span class="builtintype" id="7630743">error</span><span class="op" id="7630748">)</span>&nbsp;<span class="op" id="7630750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7630753">return</span>&nbsp;<span class="op" id="7630760">[</span><span class="op" id="7630761">]</span><span class="builtintype" id="7630762">byte</span><span class="op" id="7630766">(</span><span class="string" id="7630767">`&#34;val&#34;`</span><span class="op" id="7630774">)</span><span class="op" id="7630775">,</span>&nbsp;<span class="ident" id="7630777">nil</span><br>
<span class="lineno">165</span><span class="op" id="7630781">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7630784">//&nbsp;RefText&nbsp;has&nbsp;Marshaler&nbsp;and&nbsp;Unmarshaler&nbsp;methods&nbsp;with&nbsp;pointer&nbsp;receiver.</span><br>
<span class="lineno"></span><span class="keyword" id="7630856">type</span>&nbsp;<span class="ident" id="7630861">RefText</span>&nbsp;<span class="builtintype" id="7630869">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="7630874">func</span>&nbsp;<span class="op" id="7630879">(</span><span class="op" id="7630880">*</span><span class="ident" id="7630881">RefText</span><span class="op" id="7630888">)</span>&nbsp;<span class="ident" id="7630890">MarshalText</span><span class="op" id="7630901">(</span><span class="op" id="7630902">)</span>&nbsp;<span class="op" id="7630904">(</span><span class="op" id="7630905">[</span><span class="op" id="7630906">]</span><span class="builtintype" id="7630907">byte</span><span class="op" id="7630911">,</span>&nbsp;<span class="builtintype" id="7630913">error</span><span class="op" id="7630918">)</span>&nbsp;<span class="op" id="7630920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7630923">return</span>&nbsp;<span class="op" id="7630930">[</span><span class="op" id="7630931">]</span><span class="builtintype" id="7630932">byte</span><span class="op" id="7630936">(</span><span class="string" id="7630937">`&#34;ref&#34;`</span><span class="op" id="7630944">)</span><span class="op" id="7630945">,</span>&nbsp;<span class="ident" id="7630947">nil</span><br>
<span class="lineno"></span><span class="op" id="7630951">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7630954">func</span>&nbsp;<span class="op" id="7630959">(</span><span class="ident" id="7630960">r</span>&nbsp;<span class="op" id="7630962">*</span><span class="ident" id="7630963">RefText</span><span class="op" id="7630970">)</span>&nbsp;<span class="ident" id="7630972">UnmarshalText</span><span class="op" id="7630985">(</span><span class="op" id="7630986">[</span><span class="op" id="7630987">]</span><span class="builtintype" id="7630988">byte</span><span class="op" id="7630992">)</span>&nbsp;<span class="builtintype" id="7630994">error</span>&nbsp;<span class="op" id="7631000">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7631003">*</span><span class="ident" id="7631004">r</span>&nbsp;<span class="op" id="7631006">=</span>&nbsp;<span class="num" id="7631008">13</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7631012">return</span>&nbsp;<span class="ident" id="7631019">nil</span><br>
<span class="lineno"></span><span class="op" id="7631023">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7631026">//&nbsp;ValText&nbsp;has&nbsp;Marshaler&nbsp;methods&nbsp;with&nbsp;value&nbsp;receiver.</span><br>
<span class="lineno">180</span><span class="keyword" id="7631080">type</span>&nbsp;<span class="ident" id="7631085">ValText</span>&nbsp;<span class="builtintype" id="7631093">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7631098">func</span>&nbsp;<span class="op" id="7631103">(</span><span class="ident" id="7631104">ValText</span><span class="op" id="7631111">)</span>&nbsp;<span class="ident" id="7631113">MarshalText</span><span class="op" id="7631124">(</span><span class="op" id="7631125">)</span>&nbsp;<span class="op" id="7631127">(</span><span class="op" id="7631128">[</span><span class="op" id="7631129">]</span><span class="builtintype" id="7631130">byte</span><span class="op" id="7631134">,</span>&nbsp;<span class="builtintype" id="7631136">error</span><span class="op" id="7631141">)</span>&nbsp;<span class="op" id="7631143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7631146">return</span>&nbsp;<span class="op" id="7631153">[</span><span class="op" id="7631154">]</span><span class="builtintype" id="7631155">byte</span><span class="op" id="7631159">(</span><span class="string" id="7631160">`&#34;val&#34;`</span><span class="op" id="7631167">)</span><span class="op" id="7631168">,</span>&nbsp;<span class="ident" id="7631170">nil</span><br>
<span class="lineno"></span><span class="op" id="7631174">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span><span class="keyword" id="7631177">func</span>&nbsp;<span class="ident" id="7631182">TestRefValMarshal</span><span class="op" id="7631199">(</span><span class="ident" id="7631200">t</span>&nbsp;<span class="op" id="7631202">*</span><span class="ident" id="7631203">testing</span><span class="op" id="7631210">.</span><span class="ident" id="7631211">T</span><span class="op" id="7631212">)</span>&nbsp;<span class="op" id="7631214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7631217">var</span>&nbsp;<span class="ident" id="7631221">s</span>&nbsp;<span class="op" id="7631223">=</span>&nbsp;<span class="keyword" id="7631225">struct</span>&nbsp;<span class="op" id="7631232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7631236">R0</span>&nbsp;<span class="ident" id="7631239">Ref</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7631245">R1</span>&nbsp;<span class="op" id="7631248">*</span><span class="ident" id="7631249">Ref</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7631255">R2</span>&nbsp;<span class="ident" id="7631258">RefText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7631268">R3</span>&nbsp;<span class="op" id="7631271">*</span><span class="ident" id="7631272">RefText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7631282">V0</span>&nbsp;<span class="ident" id="7631285">Val</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7631291">V1</span>&nbsp;<span class="op" id="7631294">*</span><span class="ident" id="7631295">Val</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7631301">V2</span>&nbsp;<span class="ident" id="7631304">ValText</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7631314">V3</span>&nbsp;<span class="op" id="7631317">*</span><span class="ident" id="7631318">ValText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7631327">}</span><span class="op" id="7631328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7631332">R0</span><span class="op" id="7631334">:</span>&nbsp;<span class="num" id="7631336">12</span><span class="op" id="7631338">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7631342">R1</span><span class="op" id="7631344">:</span>&nbsp;<span class="builtinfunc" id="7631346">new</span><span class="op" id="7631349">(</span><span class="ident" id="7631350">Ref</span><span class="op" id="7631353">)</span><span class="op" id="7631354">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7631358">R2</span><span class="op" id="7631360">:</span>&nbsp;<span class="num" id="7631362">14</span><span class="op" id="7631364">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7631368">R3</span><span class="op" id="7631370">:</span>&nbsp;<span class="builtinfunc" id="7631372">new</span><span class="op" id="7631375">(</span><span class="ident" id="7631376">RefText</span><span class="op" id="7631383">)</span><span class="op" id="7631384">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7631388">V0</span><span class="op" id="7631390">:</span>&nbsp;<span class="num" id="7631392">13</span><span class="op" id="7631394">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7631398">V1</span><span class="op" id="7631400">:</span>&nbsp;<span class="builtinfunc" id="7631402">new</span><span class="op" id="7631405">(</span><span class="ident" id="7631406">Val</span><span class="op" id="7631409">)</span><span class="op" id="7631410">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7631414">V2</span><span class="op" id="7631416">:</span>&nbsp;<span class="num" id="7631418">15</span><span class="op" id="7631420">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7631424">V3</span><span class="op" id="7631426">:</span>&nbsp;<span class="builtinfunc" id="7631428">new</span><span class="op" id="7631431">(</span><span class="ident" id="7631432">ValText</span><span class="op" id="7631439">)</span><span class="op" id="7631440">,</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7631443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7631446">const</span>&nbsp;<span class="ident" id="7631452">want</span>&nbsp;<span class="op" id="7631457">=</span>&nbsp;<span class="string" id="7631459">`{&#34;R0&#34;:&#34;ref&#34;,&#34;R1&#34;:&#34;ref&#34;,&#34;R2&#34;:&#34;\&#34;ref\&#34;&#34;,&#34;R3&#34;:&#34;\&#34;ref\&#34;&#34;,&#34;V0&#34;:&#34;val&#34;,&#34;V1&#34;:&#34;val&#34;,&#34;V2&#34;:&#34;\&#34;val\&#34;&#34;,&#34;V3&#34;:&#34;\&#34;val\&#34;&#34;}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7631568">b</span><span class="op" id="7631569">,</span>&nbsp;<span class="ident" id="7631571">err</span>&nbsp;<span class="op" id="7631575">:=</span>&nbsp;<span class="ident" id="7631578">Marshal</span><span class="op" id="7631585">(</span><span class="op" id="7631586">&amp;</span><span class="ident" id="7631587">s</span><span class="op" id="7631588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7631591">if</span>&nbsp;<span class="ident" id="7631594">err</span>&nbsp;<span class="op" id="7631598">!=</span>&nbsp;<span class="ident" id="7631601">nil</span>&nbsp;<span class="op" id="7631605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7631609">t</span><span class="op" id="7631610">.</span><span class="ident" id="7631611">Fatalf</span><span class="op" id="7631617">(</span><span class="string" id="7631618">&#34;Marshal:&nbsp;%v&#34;</span><span class="op" id="7631631">,</span>&nbsp;<span class="ident" id="7631633">err</span><span class="op" id="7631636">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7631639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7631642">if</span>&nbsp;<span class="ident" id="7631645">got</span>&nbsp;<span class="op" id="7631649">:=</span>&nbsp;<span class="builtintype" id="7631652">string</span><span class="op" id="7631658">(</span><span class="ident" id="7631659">b</span><span class="op" id="7631660">)</span><span class="op" id="7631661">;</span>&nbsp;<span class="ident" id="7631663">got</span>&nbsp;<span class="op" id="7631667">!=</span>&nbsp;<span class="ident" id="7631670">want</span>&nbsp;<span class="op" id="7631675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7631679">t</span><span class="op" id="7631680">.</span><span class="ident" id="7631681">Errorf</span><span class="op" id="7631687">(</span><span class="string" id="7631688">&#34;got&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7631705">,</span>&nbsp;<span class="ident" id="7631707">got</span><span class="op" id="7631710">,</span>&nbsp;<span class="ident" id="7631712">want</span><span class="op" id="7631716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7631719">}</span><br>
<span class="lineno"></span><span class="op" id="7631721">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span><span class="comment" id="7631724">//&nbsp;C&nbsp;implements&nbsp;Marshaler&nbsp;and&nbsp;returns&nbsp;unescaped&nbsp;JSON.</span><br>
<span class="lineno"></span><span class="keyword" id="7631778">type</span>&nbsp;<span class="ident" id="7631783">C</span>&nbsp;<span class="builtintype" id="7631785">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7631790">func</span>&nbsp;<span class="op" id="7631795">(</span><span class="ident" id="7631796">C</span><span class="op" id="7631797">)</span>&nbsp;<span class="ident" id="7631799">MarshalJSON</span><span class="op" id="7631810">(</span><span class="op" id="7631811">)</span>&nbsp;<span class="op" id="7631813">(</span><span class="op" id="7631814">[</span><span class="op" id="7631815">]</span><span class="builtintype" id="7631816">byte</span><span class="op" id="7631820">,</span>&nbsp;<span class="builtintype" id="7631822">error</span><span class="op" id="7631827">)</span>&nbsp;<span class="op" id="7631829">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7631832">return</span>&nbsp;<span class="op" id="7631839">[</span><span class="op" id="7631840">]</span><span class="builtintype" id="7631841">byte</span><span class="op" id="7631845">(</span><span class="string" id="7631846">`&#34;&lt;&amp;&gt;&#34;`</span><span class="op" id="7631853">)</span><span class="op" id="7631854">,</span>&nbsp;<span class="ident" id="7631856">nil</span><br>
<span class="lineno"></span><span class="op" id="7631860">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7631863">//&nbsp;CText&nbsp;implements&nbsp;Marshaler&nbsp;and&nbsp;returns&nbsp;unescaped&nbsp;text.</span><br>
<span class="lineno"></span><span class="keyword" id="7631921">type</span>&nbsp;<span class="ident" id="7631926">CText</span>&nbsp;<span class="builtintype" id="7631932">int</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="keyword" id="7631937">func</span>&nbsp;<span class="op" id="7631942">(</span><span class="ident" id="7631943">CText</span><span class="op" id="7631948">)</span>&nbsp;<span class="ident" id="7631950">MarshalText</span><span class="op" id="7631961">(</span><span class="op" id="7631962">)</span>&nbsp;<span class="op" id="7631964">(</span><span class="op" id="7631965">[</span><span class="op" id="7631966">]</span><span class="builtintype" id="7631967">byte</span><span class="op" id="7631971">,</span>&nbsp;<span class="builtintype" id="7631973">error</span><span class="op" id="7631978">)</span>&nbsp;<span class="op" id="7631980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7631983">return</span>&nbsp;<span class="op" id="7631990">[</span><span class="op" id="7631991">]</span><span class="builtintype" id="7631992">byte</span><span class="op" id="7631996">(</span><span class="string" id="7631997">`&#34;&lt;&amp;&gt;&#34;`</span><span class="op" id="7632004">)</span><span class="op" id="7632005">,</span>&nbsp;<span class="ident" id="7632007">nil</span><br>
<span class="lineno"></span><span class="op" id="7632011">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="7632014">func</span>&nbsp;<span class="ident" id="7632019">TestMarshalerEscaping</span><span class="op" id="7632040">(</span><span class="ident" id="7632041">t</span>&nbsp;<span class="op" id="7632043">*</span><span class="ident" id="7632044">testing</span><span class="op" id="7632051">.</span><span class="ident" id="7632052">T</span><span class="op" id="7632053">)</span>&nbsp;<span class="op" id="7632055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7632058">var</span>&nbsp;<span class="ident" id="7632062">c</span>&nbsp;<span class="ident" id="7632064">C</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7632067">want</span>&nbsp;<span class="op" id="7632072">:=</span>&nbsp;<span class="string" id="7632075">`&#34;\u003c\u0026\u003e&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7632099">b</span><span class="op" id="7632100">,</span>&nbsp;<span class="ident" id="7632102">err</span>&nbsp;<span class="op" id="7632106">:=</span>&nbsp;<span class="ident" id="7632109">Marshal</span><span class="op" id="7632116">(</span><span class="ident" id="7632117">c</span><span class="op" id="7632118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7632121">if</span>&nbsp;<span class="ident" id="7632124">err</span>&nbsp;<span class="op" id="7632128">!=</span>&nbsp;<span class="ident" id="7632131">nil</span>&nbsp;<span class="op" id="7632135">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7632139">t</span><span class="op" id="7632140">.</span><span class="ident" id="7632141">Fatalf</span><span class="op" id="7632147">(</span><span class="string" id="7632148">&#34;Marshal(c):&nbsp;%v&#34;</span><span class="op" id="7632164">,</span>&nbsp;<span class="ident" id="7632166">err</span><span class="op" id="7632169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7632172">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7632175">if</span>&nbsp;<span class="ident" id="7632178">got</span>&nbsp;<span class="op" id="7632182">:=</span>&nbsp;<span class="builtintype" id="7632185">string</span><span class="op" id="7632191">(</span><span class="ident" id="7632192">b</span><span class="op" id="7632193">)</span><span class="op" id="7632194">;</span>&nbsp;<span class="ident" id="7632196">got</span>&nbsp;<span class="op" id="7632200">!=</span>&nbsp;<span class="ident" id="7632203">want</span>&nbsp;<span class="op" id="7632208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7632212">t</span><span class="op" id="7632213">.</span><span class="ident" id="7632214">Errorf</span><span class="op" id="7632220">(</span><span class="string" id="7632221">&#34;Marshal(c)&nbsp;=&nbsp;%#q,&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="7632249">,</span>&nbsp;<span class="ident" id="7632251">got</span><span class="op" id="7632254">,</span>&nbsp;<span class="ident" id="7632256">want</span><span class="op" id="7632260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7632263">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7632267">var</span>&nbsp;<span class="ident" id="7632271">ct</span>&nbsp;<span class="ident" id="7632274">CText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7632281">want</span>&nbsp;<span class="op" id="7632286">=</span>&nbsp;<span class="string" id="7632288">`&#34;\&#34;\u003c\u0026\u003e\&#34;&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7632316">b</span><span class="op" id="7632317">,</span>&nbsp;<span class="ident" id="7632319">err</span>&nbsp;<span class="op" id="7632323">=</span>&nbsp;<span class="ident" id="7632325">Marshal</span><span class="op" id="7632332">(</span><span class="ident" id="7632333">ct</span><span class="op" id="7632335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7632338">if</span>&nbsp;<span class="ident" id="7632341">err</span>&nbsp;<span class="op" id="7632345">!=</span>&nbsp;<span class="ident" id="7632348">nil</span>&nbsp;<span class="op" id="7632352">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7632356">t</span><span class="op" id="7632357">.</span><span class="ident" id="7632358">Fatalf</span><span class="op" id="7632364">(</span><span class="string" id="7632365">&#34;Marshal(ct):&nbsp;%v&#34;</span><span class="op" id="7632382">,</span>&nbsp;<span class="ident" id="7632384">err</span><span class="op" id="7632387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7632390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7632393">if</span>&nbsp;<span class="ident" id="7632396">got</span>&nbsp;<span class="op" id="7632400">:=</span>&nbsp;<span class="builtintype" id="7632403">string</span><span class="op" id="7632409">(</span><span class="ident" id="7632410">b</span><span class="op" id="7632411">)</span><span class="op" id="7632412">;</span>&nbsp;<span class="ident" id="7632414">got</span>&nbsp;<span class="op" id="7632418">!=</span>&nbsp;<span class="ident" id="7632421">want</span>&nbsp;<span class="op" id="7632426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7632430">t</span><span class="op" id="7632431">.</span><span class="ident" id="7632432">Errorf</span><span class="op" id="7632438">(</span><span class="string" id="7632439">&#34;Marshal(ct)&nbsp;=&nbsp;%#q,&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="7632468">,</span>&nbsp;<span class="ident" id="7632470">got</span><span class="op" id="7632473">,</span>&nbsp;<span class="ident" id="7632475">want</span><span class="op" id="7632479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7632482">}</span><br>
<span class="lineno">250</span><span class="op" id="7632484">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7632487">type</span>&nbsp;<span class="ident" id="7632492">IntType</span>&nbsp;<span class="builtintype" id="7632500">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7632505">type</span>&nbsp;<span class="ident" id="7632510">MyStruct</span>&nbsp;<span class="keyword" id="7632519">struct</span>&nbsp;<span class="op" id="7632526">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7632529">IntType</span><br>
<span class="lineno"></span><span class="op" id="7632537">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7632540">func</span>&nbsp;<span class="ident" id="7632545">TestAnonymousNonstruct</span><span class="op" id="7632567">(</span><span class="ident" id="7632568">t</span>&nbsp;<span class="op" id="7632570">*</span><span class="ident" id="7632571">testing</span><span class="op" id="7632578">.</span><span class="ident" id="7632579">T</span><span class="op" id="7632580">)</span>&nbsp;<span class="op" id="7632582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7632585">var</span>&nbsp;<span class="ident" id="7632589">i</span>&nbsp;<span class="ident" id="7632591">IntType</span>&nbsp;<span class="op" id="7632599">=</span>&nbsp;<span class="num" id="7632601">11</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7632605">a</span>&nbsp;<span class="op" id="7632607">:=</span>&nbsp;<span class="ident" id="7632610">MyStruct</span><span class="op" id="7632618">{</span><span class="ident" id="7632619">i</span><span class="op" id="7632620">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7632623">const</span>&nbsp;<span class="ident" id="7632629">want</span>&nbsp;<span class="op" id="7632634">=</span>&nbsp;<span class="string" id="7632636">`{&#34;IntType&#34;:11}`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7632655">b</span><span class="op" id="7632656">,</span>&nbsp;<span class="ident" id="7632658">err</span>&nbsp;<span class="op" id="7632662">:=</span>&nbsp;<span class="ident" id="7632665">Marshal</span><span class="op" id="7632672">(</span><span class="ident" id="7632673">a</span><span class="op" id="7632674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7632677">if</span>&nbsp;<span class="ident" id="7632680">err</span>&nbsp;<span class="op" id="7632684">!=</span>&nbsp;<span class="ident" id="7632687">nil</span>&nbsp;<span class="op" id="7632691">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7632695">t</span><span class="op" id="7632696">.</span><span class="ident" id="7632697">Fatalf</span><span class="op" id="7632703">(</span><span class="string" id="7632704">&#34;Marshal:&nbsp;%v&#34;</span><span class="op" id="7632717">,</span>&nbsp;<span class="ident" id="7632719">err</span><span class="op" id="7632722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7632725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7632728">if</span>&nbsp;<span class="ident" id="7632731">got</span>&nbsp;<span class="op" id="7632735">:=</span>&nbsp;<span class="builtintype" id="7632738">string</span><span class="op" id="7632744">(</span><span class="ident" id="7632745">b</span><span class="op" id="7632746">)</span><span class="op" id="7632747">;</span>&nbsp;<span class="ident" id="7632749">got</span>&nbsp;<span class="op" id="7632753">!=</span>&nbsp;<span class="ident" id="7632756">want</span>&nbsp;<span class="op" id="7632761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7632765">t</span><span class="op" id="7632766">.</span><span class="ident" id="7632767">Errorf</span><span class="op" id="7632773">(</span><span class="string" id="7632774">&#34;got&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7632791">,</span>&nbsp;<span class="ident" id="7632793">got</span><span class="op" id="7632796">,</span>&nbsp;<span class="ident" id="7632798">want</span><span class="op" id="7632802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7632805">}</span><br>
<span class="lineno">270</span><span class="op" id="7632807">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7632810">type</span>&nbsp;<span class="ident" id="7632815">BugA</span>&nbsp;<span class="keyword" id="7632820">struct</span>&nbsp;<span class="op" id="7632827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7632830">S</span>&nbsp;<span class="builtintype" id="7632832">string</span><br>
<span class="lineno"></span><span class="op" id="7632839">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="keyword" id="7632842">type</span>&nbsp;<span class="ident" id="7632847">BugB</span>&nbsp;<span class="keyword" id="7632852">struct</span>&nbsp;<span class="op" id="7632859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7632862">BugA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7632868">S</span>&nbsp;<span class="builtintype" id="7632870">string</span><br>
<span class="lineno"></span><span class="op" id="7632877">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="keyword" id="7632880">type</span>&nbsp;<span class="ident" id="7632885">BugC</span>&nbsp;<span class="keyword" id="7632890">struct</span>&nbsp;<span class="op" id="7632897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7632900">S</span>&nbsp;<span class="builtintype" id="7632902">string</span><br>
<span class="lineno"></span><span class="op" id="7632909">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="comment" id="7632912">//&nbsp;Legal&nbsp;Go:&nbsp;We&nbsp;never&nbsp;use&nbsp;the&nbsp;repeated&nbsp;embedded&nbsp;field&nbsp;(S).</span><br>
<span class="lineno"></span><span class="keyword" id="7632971">type</span>&nbsp;<span class="ident" id="7632976">BugX</span>&nbsp;<span class="keyword" id="7632981">struct</span>&nbsp;<span class="op" id="7632988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7632991">A</span>&nbsp;<span class="builtintype" id="7632993">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7632998">BugA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7633004">BugB</span><br>
<span class="lineno">290</span><span class="op" id="7633009">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7633012">//&nbsp;Issue&nbsp;5245.</span><br>
<span class="lineno"></span><span class="keyword" id="7633027">func</span>&nbsp;<span class="ident" id="7633032">TestEmbeddedBug</span><span class="op" id="7633047">(</span><span class="ident" id="7633048">t</span>&nbsp;<span class="op" id="7633050">*</span><span class="ident" id="7633051">testing</span><span class="op" id="7633058">.</span><span class="ident" id="7633059">T</span><span class="op" id="7633060">)</span>&nbsp;<span class="op" id="7633062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7633065">v</span>&nbsp;<span class="op" id="7633067">:=</span>&nbsp;<span class="ident" id="7633070">BugB</span><span class="op" id="7633074">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7633078">BugA</span><span class="op" id="7633082">{</span><span class="string" id="7633083">&#34;A&#34;</span><span class="op" id="7633086">}</span><span class="op" id="7633087">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7633091">&#34;B&#34;</span><span class="op" id="7633094">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7633097">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7633100">b</span><span class="op" id="7633101">,</span>&nbsp;<span class="ident" id="7633103">err</span>&nbsp;<span class="op" id="7633107">:=</span>&nbsp;<span class="ident" id="7633110">Marshal</span><span class="op" id="7633117">(</span><span class="ident" id="7633118">v</span><span class="op" id="7633119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7633122">if</span>&nbsp;<span class="ident" id="7633125">err</span>&nbsp;<span class="op" id="7633129">!=</span>&nbsp;<span class="ident" id="7633132">nil</span>&nbsp;<span class="op" id="7633136">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7633140">t</span><span class="op" id="7633141">.</span><span class="ident" id="7633142">Fatal</span><span class="op" id="7633147">(</span><span class="string" id="7633148">&#34;Marshal:&#34;</span><span class="op" id="7633158">,</span>&nbsp;<span class="ident" id="7633160">err</span><span class="op" id="7633163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7633166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7633169">want</span>&nbsp;<span class="op" id="7633174">:=</span>&nbsp;<span class="string" id="7633177">`{&#34;S&#34;:&#34;B&#34;}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7633190">got</span>&nbsp;<span class="op" id="7633194">:=</span>&nbsp;<span class="builtintype" id="7633197">string</span><span class="op" id="7633203">(</span><span class="ident" id="7633204">b</span><span class="op" id="7633205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7633208">if</span>&nbsp;<span class="ident" id="7633211">got</span>&nbsp;<span class="op" id="7633215">!=</span>&nbsp;<span class="ident" id="7633218">want</span>&nbsp;<span class="op" id="7633223">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7633227">t</span><span class="op" id="7633228">.</span><span class="ident" id="7633229">Fatalf</span><span class="op" id="7633235">(</span><span class="string" id="7633236">&#34;Marshal:&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="7633261">,</span>&nbsp;<span class="ident" id="7633263">got</span><span class="op" id="7633266">,</span>&nbsp;<span class="ident" id="7633268">want</span><span class="op" id="7633272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7633275">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7633278">//&nbsp;Now&nbsp;check&nbsp;that&nbsp;the&nbsp;duplicate&nbsp;field,&nbsp;S,&nbsp;does&nbsp;not&nbsp;appear.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7633338">x</span>&nbsp;<span class="op" id="7633340">:=</span>&nbsp;<span class="ident" id="7633343">BugX</span><span class="op" id="7633347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7633351">A</span><span class="op" id="7633352">:</span>&nbsp;<span class="num" id="7633354">23</span><span class="op" id="7633356">,</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7633359">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7633362">b</span><span class="op" id="7633363">,</span>&nbsp;<span class="ident" id="7633365">err</span>&nbsp;<span class="op" id="7633369">=</span>&nbsp;<span class="ident" id="7633371">Marshal</span><span class="op" id="7633378">(</span><span class="ident" id="7633379">x</span><span class="op" id="7633380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7633383">if</span>&nbsp;<span class="ident" id="7633386">err</span>&nbsp;<span class="op" id="7633390">!=</span>&nbsp;<span class="ident" id="7633393">nil</span>&nbsp;<span class="op" id="7633397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7633401">t</span><span class="op" id="7633402">.</span><span class="ident" id="7633403">Fatal</span><span class="op" id="7633408">(</span><span class="string" id="7633409">&#34;Marshal:&#34;</span><span class="op" id="7633419">,</span>&nbsp;<span class="ident" id="7633421">err</span><span class="op" id="7633424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7633427">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7633430">want</span>&nbsp;<span class="op" id="7633435">=</span>&nbsp;<span class="string" id="7633437">`{&#34;A&#34;:23}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7633449">got</span>&nbsp;<span class="op" id="7633453">=</span>&nbsp;<span class="builtintype" id="7633455">string</span><span class="op" id="7633461">(</span><span class="ident" id="7633462">b</span><span class="op" id="7633463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7633466">if</span>&nbsp;<span class="ident" id="7633469">got</span>&nbsp;<span class="op" id="7633473">!=</span>&nbsp;<span class="ident" id="7633476">want</span>&nbsp;<span class="op" id="7633481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7633485">t</span><span class="op" id="7633486">.</span><span class="ident" id="7633487">Fatalf</span><span class="op" id="7633493">(</span><span class="string" id="7633494">&#34;Marshal:&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="7633519">,</span>&nbsp;<span class="ident" id="7633521">got</span><span class="op" id="7633524">,</span>&nbsp;<span class="ident" id="7633526">want</span><span class="op" id="7633530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7633533">}</span><br>
<span class="lineno">320</span><span class="op" id="7633535">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7633538">type</span>&nbsp;<span class="ident" id="7633543">BugD</span>&nbsp;<span class="keyword" id="7633548">struct</span>&nbsp;<span class="op" id="7633555">{</span>&nbsp;<span class="comment" id="7633557">//&nbsp;Same&nbsp;as&nbsp;BugA&nbsp;after&nbsp;tagging.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7633589">XXX</span>&nbsp;<span class="builtintype" id="7633593">string</span>&nbsp;<span class="string" id="7633600">`json:&#34;S&#34;`</span><br>
<span class="lineno"></span><span class="op" id="7633611">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="comment" id="7633614">//&nbsp;BugD&#39;s&nbsp;tagged&nbsp;S&nbsp;field&nbsp;should&nbsp;dominate&nbsp;BugA&#39;s.</span><br>
<span class="lineno"></span><span class="keyword" id="7633663">type</span>&nbsp;<span class="ident" id="7633668">BugY</span>&nbsp;<span class="keyword" id="7633673">struct</span>&nbsp;<span class="op" id="7633680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7633683">BugA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7633689">BugD</span><br>
<span class="lineno">330</span><span class="op" id="7633694">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7633697">//&nbsp;Test&nbsp;that&nbsp;a&nbsp;field&nbsp;with&nbsp;a&nbsp;tag&nbsp;dominates&nbsp;untagged&nbsp;fields.</span><br>
<span class="lineno"></span><span class="keyword" id="7633756">func</span>&nbsp;<span class="ident" id="7633761">TestTaggedFieldDominates</span><span class="op" id="7633785">(</span><span class="ident" id="7633786">t</span>&nbsp;<span class="op" id="7633788">*</span><span class="ident" id="7633789">testing</span><span class="op" id="7633796">.</span><span class="ident" id="7633797">T</span><span class="op" id="7633798">)</span>&nbsp;<span class="op" id="7633800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7633803">v</span>&nbsp;<span class="op" id="7633805">:=</span>&nbsp;<span class="ident" id="7633808">BugY</span><span class="op" id="7633812">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7633816">BugA</span><span class="op" id="7633820">{</span><span class="string" id="7633821">&#34;BugA&#34;</span><span class="op" id="7633827">}</span><span class="op" id="7633828">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7633832">BugD</span><span class="op" id="7633836">{</span><span class="string" id="7633837">&#34;BugD&#34;</span><span class="op" id="7633843">}</span><span class="op" id="7633844">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7633847">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7633850">b</span><span class="op" id="7633851">,</span>&nbsp;<span class="ident" id="7633853">err</span>&nbsp;<span class="op" id="7633857">:=</span>&nbsp;<span class="ident" id="7633860">Marshal</span><span class="op" id="7633867">(</span><span class="ident" id="7633868">v</span><span class="op" id="7633869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7633872">if</span>&nbsp;<span class="ident" id="7633875">err</span>&nbsp;<span class="op" id="7633879">!=</span>&nbsp;<span class="ident" id="7633882">nil</span>&nbsp;<span class="op" id="7633886">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7633890">t</span><span class="op" id="7633891">.</span><span class="ident" id="7633892">Fatal</span><span class="op" id="7633897">(</span><span class="string" id="7633898">&#34;Marshal:&#34;</span><span class="op" id="7633908">,</span>&nbsp;<span class="ident" id="7633910">err</span><span class="op" id="7633913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7633916">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7633919">want</span>&nbsp;<span class="op" id="7633924">:=</span>&nbsp;<span class="string" id="7633927">`{&#34;S&#34;:&#34;BugD&#34;}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7633943">got</span>&nbsp;<span class="op" id="7633947">:=</span>&nbsp;<span class="builtintype" id="7633950">string</span><span class="op" id="7633956">(</span><span class="ident" id="7633957">b</span><span class="op" id="7633958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7633961">if</span>&nbsp;<span class="ident" id="7633964">got</span>&nbsp;<span class="op" id="7633968">!=</span>&nbsp;<span class="ident" id="7633971">want</span>&nbsp;<span class="op" id="7633976">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7633980">t</span><span class="op" id="7633981">.</span><span class="ident" id="7633982">Fatalf</span><span class="op" id="7633988">(</span><span class="string" id="7633989">&#34;Marshal:&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="7634014">,</span>&nbsp;<span class="ident" id="7634016">got</span><span class="op" id="7634019">,</span>&nbsp;<span class="ident" id="7634021">want</span><span class="op" id="7634025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7634028">}</span><br>
<span class="lineno"></span><span class="op" id="7634030">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7634033">//&nbsp;There&nbsp;are&nbsp;no&nbsp;tags&nbsp;here,&nbsp;so&nbsp;S&nbsp;should&nbsp;not&nbsp;appear.</span><br>
<span class="lineno">350</span><span class="keyword" id="7634084">type</span>&nbsp;<span class="ident" id="7634089">BugZ</span>&nbsp;<span class="keyword" id="7634094">struct</span>&nbsp;<span class="op" id="7634101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7634104">BugA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7634110">BugC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7634116">BugY</span>&nbsp;<span class="comment" id="7634121">//&nbsp;Contains&nbsp;a&nbsp;tagged&nbsp;S&nbsp;field&nbsp;through&nbsp;BugD;&nbsp;should&nbsp;not&nbsp;dominate.</span><br>
<span class="lineno"></span><span class="op" id="7634185">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span><span class="keyword" id="7634188">func</span>&nbsp;<span class="ident" id="7634193">TestDuplicatedFieldDisappears</span><span class="op" id="7634222">(</span><span class="ident" id="7634223">t</span>&nbsp;<span class="op" id="7634225">*</span><span class="ident" id="7634226">testing</span><span class="op" id="7634233">.</span><span class="ident" id="7634234">T</span><span class="op" id="7634235">)</span>&nbsp;<span class="op" id="7634237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7634240">v</span>&nbsp;<span class="op" id="7634242">:=</span>&nbsp;<span class="ident" id="7634245">BugZ</span><span class="op" id="7634249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7634253">BugA</span><span class="op" id="7634257">{</span><span class="string" id="7634258">&#34;BugA&#34;</span><span class="op" id="7634264">}</span><span class="op" id="7634265">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7634269">BugC</span><span class="op" id="7634273">{</span><span class="string" id="7634274">&#34;BugC&#34;</span><span class="op" id="7634280">}</span><span class="op" id="7634281">,</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7634285">BugY</span><span class="op" id="7634289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7634294">BugA</span><span class="op" id="7634298">{</span><span class="string" id="7634299">&#34;nested&nbsp;BugA&#34;</span><span class="op" id="7634312">}</span><span class="op" id="7634313">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7634318">BugD</span><span class="op" id="7634322">{</span><span class="string" id="7634323">&#34;nested&nbsp;BugD&#34;</span><span class="op" id="7634336">}</span><span class="op" id="7634337">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7634341">}</span><span class="op" id="7634342">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7634345">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7634348">b</span><span class="op" id="7634349">,</span>&nbsp;<span class="ident" id="7634351">err</span>&nbsp;<span class="op" id="7634355">:=</span>&nbsp;<span class="ident" id="7634358">Marshal</span><span class="op" id="7634365">(</span><span class="ident" id="7634366">v</span><span class="op" id="7634367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7634370">if</span>&nbsp;<span class="ident" id="7634373">err</span>&nbsp;<span class="op" id="7634377">!=</span>&nbsp;<span class="ident" id="7634380">nil</span>&nbsp;<span class="op" id="7634384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7634388">t</span><span class="op" id="7634389">.</span><span class="ident" id="7634390">Fatal</span><span class="op" id="7634395">(</span><span class="string" id="7634396">&#34;Marshal:&#34;</span><span class="op" id="7634406">,</span>&nbsp;<span class="ident" id="7634408">err</span><span class="op" id="7634411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7634414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7634417">want</span>&nbsp;<span class="op" id="7634422">:=</span>&nbsp;<span class="string" id="7634425">`{}`</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7634431">got</span>&nbsp;<span class="op" id="7634435">:=</span>&nbsp;<span class="builtintype" id="7634438">string</span><span class="op" id="7634444">(</span><span class="ident" id="7634445">b</span><span class="op" id="7634446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7634449">if</span>&nbsp;<span class="ident" id="7634452">got</span>&nbsp;<span class="op" id="7634456">!=</span>&nbsp;<span class="ident" id="7634459">want</span>&nbsp;<span class="op" id="7634464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7634468">t</span><span class="op" id="7634469">.</span><span class="ident" id="7634470">Fatalf</span><span class="op" id="7634476">(</span><span class="string" id="7634477">&#34;Marshal:&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="7634502">,</span>&nbsp;<span class="ident" id="7634504">got</span><span class="op" id="7634507">,</span>&nbsp;<span class="ident" id="7634509">want</span><span class="op" id="7634513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7634516">}</span><br>
<span class="lineno"></span><span class="op" id="7634518">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span><span class="keyword" id="7634521">func</span>&nbsp;<span class="ident" id="7634526">TestStringBytes</span><span class="op" id="7634541">(</span><span class="ident" id="7634542">t</span>&nbsp;<span class="op" id="7634544">*</span><span class="ident" id="7634545">testing</span><span class="op" id="7634552">.</span><span class="ident" id="7634553">T</span><span class="op" id="7634554">)</span>&nbsp;<span class="op" id="7634556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7634559">//&nbsp;Test&nbsp;that&nbsp;encodeState.stringBytes&nbsp;and&nbsp;encodeState.string&nbsp;use&nbsp;the&nbsp;same&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7634643">es</span>&nbsp;<span class="op" id="7634646">:=</span>&nbsp;<span class="op" id="7634649">&amp;</span><span class="ident" id="7634650">encodeState</span><span class="op" id="7634661">{</span><span class="op" id="7634662">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7634665">var</span>&nbsp;<span class="ident" id="7634669">r</span>&nbsp;<span class="op" id="7634671">[</span><span class="op" id="7634672">]</span><span class="builtintype" id="7634673">rune</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7634679">for</span>&nbsp;<span class="ident" id="7634683">i</span>&nbsp;<span class="op" id="7634685">:=</span>&nbsp;<span class="string" id="7634688">&#39;\u0000&#39;</span><span class="op" id="7634696">;</span>&nbsp;<span class="ident" id="7634698">i</span>&nbsp;<span class="op" id="7634700">&lt;=</span>&nbsp;<span class="ident" id="7634703">unicode</span><span class="op" id="7634710">.</span><span class="ident" id="7634711">MaxRune</span><span class="op" id="7634718">;</span>&nbsp;<span class="ident" id="7634720">i</span><span class="op" id="7634721">++</span>&nbsp;<span class="op" id="7634724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7634728">r</span>&nbsp;<span class="op" id="7634730">=</span>&nbsp;<span class="builtinfunc" id="7634732">append</span><span class="op" id="7634738">(</span><span class="ident" id="7634739">r</span><span class="op" id="7634740">,</span>&nbsp;<span class="ident" id="7634742">i</span><span class="op" id="7634743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7634746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7634749">s</span>&nbsp;<span class="op" id="7634751">:=</span>&nbsp;<span class="builtintype" id="7634754">string</span><span class="op" id="7634760">(</span><span class="ident" id="7634761">r</span><span class="op" id="7634762">)</span>&nbsp;<span class="op" id="7634764">+</span>&nbsp;<span class="string" id="7634766">&#34;\xff\xff\xffhello&#34;</span>&nbsp;<span class="comment" id="7634786">//&nbsp;some&nbsp;invalid&nbsp;UTF-8&nbsp;too</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7634813">_</span><span class="op" id="7634814">,</span>&nbsp;<span class="ident" id="7634816">err</span>&nbsp;<span class="op" id="7634820">:=</span>&nbsp;<span class="ident" id="7634823">es</span><span class="op" id="7634825">.</span><span class="builtintype" id="7634826">string</span><span class="op" id="7634832">(</span><span class="ident" id="7634833">s</span><span class="op" id="7634834">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7634837">if</span>&nbsp;<span class="ident" id="7634840">err</span>&nbsp;<span class="op" id="7634844">!=</span>&nbsp;<span class="ident" id="7634847">nil</span>&nbsp;<span class="op" id="7634851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7634855">t</span><span class="op" id="7634856">.</span><span class="ident" id="7634857">Fatal</span><span class="op" id="7634862">(</span><span class="ident" id="7634863">err</span><span class="op" id="7634866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7634869">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7634873">esBytes</span>&nbsp;<span class="op" id="7634881">:=</span>&nbsp;<span class="op" id="7634884">&amp;</span><span class="ident" id="7634885">encodeState</span><span class="op" id="7634896">{</span><span class="op" id="7634897">}</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7634900">_</span><span class="op" id="7634901">,</span>&nbsp;<span class="ident" id="7634903">err</span>&nbsp;<span class="op" id="7634907">=</span>&nbsp;<span class="ident" id="7634909">esBytes</span><span class="op" id="7634916">.</span><span class="ident" id="7634917">stringBytes</span><span class="op" id="7634928">(</span><span class="op" id="7634929">[</span><span class="op" id="7634930">]</span><span class="builtintype" id="7634931">byte</span><span class="op" id="7634935">(</span><span class="ident" id="7634936">s</span><span class="op" id="7634937">)</span><span class="op" id="7634938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7634941">if</span>&nbsp;<span class="ident" id="7634944">err</span>&nbsp;<span class="op" id="7634948">!=</span>&nbsp;<span class="ident" id="7634951">nil</span>&nbsp;<span class="op" id="7634955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7634959">t</span><span class="op" id="7634960">.</span><span class="ident" id="7634961">Fatal</span><span class="op" id="7634966">(</span><span class="ident" id="7634967">err</span><span class="op" id="7634970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7634973">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7634977">enc</span>&nbsp;<span class="op" id="7634981">:=</span>&nbsp;<span class="ident" id="7634984">es</span><span class="op" id="7634986">.</span><span class="ident" id="7634987">Buffer</span><span class="op" id="7634993">.</span><span class="ident" id="7634994">String</span><span class="op" id="7635000">(</span><span class="op" id="7635001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7635004">encBytes</span>&nbsp;<span class="op" id="7635013">:=</span>&nbsp;<span class="ident" id="7635016">esBytes</span><span class="op" id="7635023">.</span><span class="ident" id="7635024">Buffer</span><span class="op" id="7635030">.</span><span class="ident" id="7635031">String</span><span class="op" id="7635037">(</span><span class="op" id="7635038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7635041">if</span>&nbsp;<span class="ident" id="7635044">enc</span>&nbsp;<span class="op" id="7635048">!=</span>&nbsp;<span class="ident" id="7635051">encBytes</span>&nbsp;<span class="op" id="7635060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7635064">i</span>&nbsp;<span class="op" id="7635066">:=</span>&nbsp;<span class="num" id="7635069">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7635073">for</span>&nbsp;<span class="ident" id="7635077">i</span>&nbsp;<span class="op" id="7635079">&lt;</span>&nbsp;<span class="builtinfunc" id="7635081">len</span><span class="op" id="7635084">(</span><span class="ident" id="7635085">enc</span><span class="op" id="7635088">)</span>&nbsp;<span class="op" id="7635090">&amp;&amp;</span>&nbsp;<span class="ident" id="7635093">i</span>&nbsp;<span class="op" id="7635095">&lt;</span>&nbsp;<span class="builtinfunc" id="7635097">len</span><span class="op" id="7635100">(</span><span class="ident" id="7635101">encBytes</span><span class="op" id="7635109">)</span>&nbsp;<span class="op" id="7635111">&amp;&amp;</span>&nbsp;<span class="ident" id="7635114">enc</span><span class="op" id="7635117">[</span><span class="ident" id="7635118">i</span><span class="op" id="7635119">]</span>&nbsp;<span class="op" id="7635121">==</span>&nbsp;<span class="ident" id="7635124">encBytes</span><span class="op" id="7635132">[</span><span class="ident" id="7635133">i</span><span class="op" id="7635134">]</span>&nbsp;<span class="op" id="7635136">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7635141">i</span><span class="op" id="7635142">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7635147">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7635151">enc</span>&nbsp;<span class="op" id="7635155">=</span>&nbsp;<span class="ident" id="7635157">enc</span><span class="op" id="7635160">[</span><span class="ident" id="7635161">i</span><span class="op" id="7635162">:</span><span class="op" id="7635163">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7635167">encBytes</span>&nbsp;<span class="op" id="7635176">=</span>&nbsp;<span class="ident" id="7635178">encBytes</span><span class="op" id="7635186">[</span><span class="ident" id="7635187">i</span><span class="op" id="7635188">:</span><span class="op" id="7635189">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7635193">i</span>&nbsp;<span class="op" id="7635195">=</span>&nbsp;<span class="num" id="7635197">0</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7635201">for</span>&nbsp;<span class="ident" id="7635205">i</span>&nbsp;<span class="op" id="7635207">&lt;</span>&nbsp;<span class="builtinfunc" id="7635209">len</span><span class="op" id="7635212">(</span><span class="ident" id="7635213">enc</span><span class="op" id="7635216">)</span>&nbsp;<span class="op" id="7635218">&amp;&amp;</span>&nbsp;<span class="ident" id="7635221">i</span>&nbsp;<span class="op" id="7635223">&lt;</span>&nbsp;<span class="builtinfunc" id="7635225">len</span><span class="op" id="7635228">(</span><span class="ident" id="7635229">encBytes</span><span class="op" id="7635237">)</span>&nbsp;<span class="op" id="7635239">&amp;&amp;</span>&nbsp;<span class="ident" id="7635242">enc</span><span class="op" id="7635245">[</span><span class="builtinfunc" id="7635246">len</span><span class="op" id="7635249">(</span><span class="ident" id="7635250">enc</span><span class="op" id="7635253">)</span><span class="op" id="7635254">-</span><span class="ident" id="7635255">i</span><span class="op" id="7635256">-</span><span class="num" id="7635257">1</span><span class="op" id="7635258">]</span>&nbsp;<span class="op" id="7635260">==</span>&nbsp;<span class="ident" id="7635263">encBytes</span><span class="op" id="7635271">[</span><span class="builtinfunc" id="7635272">len</span><span class="op" id="7635275">(</span><span class="ident" id="7635276">encBytes</span><span class="op" id="7635284">)</span><span class="op" id="7635285">-</span><span class="ident" id="7635286">i</span><span class="op" id="7635287">-</span><span class="num" id="7635288">1</span><span class="op" id="7635289">]</span>&nbsp;<span class="op" id="7635291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7635296">i</span><span class="op" id="7635297">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7635302">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7635306">enc</span>&nbsp;<span class="op" id="7635310">=</span>&nbsp;<span class="ident" id="7635312">enc</span><span class="op" id="7635315">[</span><span class="op" id="7635316">:</span><span class="builtinfunc" id="7635317">len</span><span class="op" id="7635320">(</span><span class="ident" id="7635321">enc</span><span class="op" id="7635324">)</span><span class="op" id="7635325">-</span><span class="ident" id="7635326">i</span><span class="op" id="7635327">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7635331">encBytes</span>&nbsp;<span class="op" id="7635340">=</span>&nbsp;<span class="ident" id="7635342">encBytes</span><span class="op" id="7635350">[</span><span class="op" id="7635351">:</span><span class="builtinfunc" id="7635352">len</span><span class="op" id="7635355">(</span><span class="ident" id="7635356">encBytes</span><span class="op" id="7635364">)</span><span class="op" id="7635365">-</span><span class="ident" id="7635366">i</span><span class="op" id="7635367">]</span><br>
<span class="lineno">410</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7635372">if</span>&nbsp;<span class="builtinfunc" id="7635375">len</span><span class="op" id="7635378">(</span><span class="ident" id="7635379">enc</span><span class="op" id="7635382">)</span>&nbsp;<span class="op" id="7635384">&gt;</span>&nbsp;<span class="num" id="7635386">20</span>&nbsp;<span class="op" id="7635389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7635394">enc</span>&nbsp;<span class="op" id="7635398">=</span>&nbsp;<span class="ident" id="7635400">enc</span><span class="op" id="7635403">[</span><span class="op" id="7635404">:</span><span class="num" id="7635405">20</span><span class="op" id="7635407">]</span>&nbsp;<span class="op" id="7635409">+</span>&nbsp;<span class="string" id="7635411">&#34;...&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7635419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7635423">if</span>&nbsp;<span class="builtinfunc" id="7635426">len</span><span class="op" id="7635429">(</span><span class="ident" id="7635430">encBytes</span><span class="op" id="7635438">)</span>&nbsp;<span class="op" id="7635440">&gt;</span>&nbsp;<span class="num" id="7635442">20</span>&nbsp;<span class="op" id="7635445">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7635450">encBytes</span>&nbsp;<span class="op" id="7635459">=</span>&nbsp;<span class="ident" id="7635461">encBytes</span><span class="op" id="7635469">[</span><span class="op" id="7635470">:</span><span class="num" id="7635471">20</span><span class="op" id="7635473">]</span>&nbsp;<span class="op" id="7635475">+</span>&nbsp;<span class="string" id="7635477">&#34;...&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7635485">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7635490">t</span><span class="op" id="7635491">.</span><span class="ident" id="7635492">Errorf</span><span class="op" id="7635498">(</span><span class="string" id="7635499">&#34;encodings&nbsp;differ&nbsp;at&nbsp;%#q&nbsp;vs&nbsp;%#q&#34;</span><span class="op" id="7635531">,</span>&nbsp;<span class="ident" id="7635533">enc</span><span class="op" id="7635536">,</span>&nbsp;<span class="ident" id="7635538">encBytes</span><span class="op" id="7635546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7635549">}</span><br>
<span class="lineno">420</span><span class="op" id="7635551">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7635554">func</span>&nbsp;<span class="ident" id="7635559">TestIssue6458</span><span class="op" id="7635572">(</span><span class="ident" id="7635573">t</span>&nbsp;<span class="op" id="7635575">*</span><span class="ident" id="7635576">testing</span><span class="op" id="7635583">.</span><span class="ident" id="7635584">T</span><span class="op" id="7635585">)</span>&nbsp;<span class="op" id="7635587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7635590">type</span>&nbsp;<span class="ident" id="7635595">Foo</span>&nbsp;<span class="keyword" id="7635599">struct</span>&nbsp;<span class="op" id="7635606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7635610">M</span>&nbsp;<span class="ident" id="7635612">RawMessage</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7635624">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7635627">x</span>&nbsp;<span class="op" id="7635629">:=</span>&nbsp;<span class="ident" id="7635632">Foo</span><span class="op" id="7635635">{</span><span class="ident" id="7635636">RawMessage</span><span class="op" id="7635646">(</span><span class="string" id="7635647">`&#34;foo&#34;`</span><span class="op" id="7635654">)</span><span class="op" id="7635655">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7635659">b</span><span class="op" id="7635660">,</span>&nbsp;<span class="ident" id="7635662">err</span>&nbsp;<span class="op" id="7635666">:=</span>&nbsp;<span class="ident" id="7635669">Marshal</span><span class="op" id="7635676">(</span><span class="op" id="7635677">&amp;</span><span class="ident" id="7635678">x</span><span class="op" id="7635679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7635682">if</span>&nbsp;<span class="ident" id="7635685">err</span>&nbsp;<span class="op" id="7635689">!=</span>&nbsp;<span class="ident" id="7635692">nil</span>&nbsp;<span class="op" id="7635696">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7635700">t</span><span class="op" id="7635701">.</span><span class="ident" id="7635702">Fatal</span><span class="op" id="7635707">(</span><span class="ident" id="7635708">err</span><span class="op" id="7635711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7635714">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7635717">if</span>&nbsp;<span class="ident" id="7635720">want</span>&nbsp;<span class="op" id="7635725">:=</span>&nbsp;<span class="string" id="7635728">`{&#34;M&#34;:&#34;foo&#34;}`</span><span class="op" id="7635741">;</span>&nbsp;<span class="builtintype" id="7635743">string</span><span class="op" id="7635749">(</span><span class="ident" id="7635750">b</span><span class="op" id="7635751">)</span>&nbsp;<span class="op" id="7635753">!=</span>&nbsp;<span class="ident" id="7635756">want</span>&nbsp;<span class="op" id="7635761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7635765">t</span><span class="op" id="7635766">.</span><span class="ident" id="7635767">Errorf</span><span class="op" id="7635773">(</span><span class="string" id="7635774">&#34;Marshal(&amp;x)&nbsp;=&nbsp;%#q;&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="7635803">,</span>&nbsp;<span class="ident" id="7635805">b</span><span class="op" id="7635806">,</span>&nbsp;<span class="ident" id="7635808">want</span><span class="op" id="7635812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7635815">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7635819">b</span><span class="op" id="7635820">,</span>&nbsp;<span class="ident" id="7635822">err</span>&nbsp;<span class="op" id="7635826">=</span>&nbsp;<span class="ident" id="7635828">Marshal</span><span class="op" id="7635835">(</span><span class="ident" id="7635836">x</span><span class="op" id="7635837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7635840">if</span>&nbsp;<span class="ident" id="7635843">err</span>&nbsp;<span class="op" id="7635847">!=</span>&nbsp;<span class="ident" id="7635850">nil</span>&nbsp;<span class="op" id="7635854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7635858">t</span><span class="op" id="7635859">.</span><span class="ident" id="7635860">Fatal</span><span class="op" id="7635865">(</span><span class="ident" id="7635866">err</span><span class="op" id="7635869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7635872">}</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7635876">if</span>&nbsp;<span class="ident" id="7635879">want</span>&nbsp;<span class="op" id="7635884">:=</span>&nbsp;<span class="string" id="7635887">`{&#34;M&#34;:&#34;ImZvbyI=&#34;}`</span><span class="op" id="7635905">;</span>&nbsp;<span class="builtintype" id="7635907">string</span><span class="op" id="7635913">(</span><span class="ident" id="7635914">b</span><span class="op" id="7635915">)</span>&nbsp;<span class="op" id="7635917">!=</span>&nbsp;<span class="ident" id="7635920">want</span>&nbsp;<span class="op" id="7635925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7635929">t</span><span class="op" id="7635930">.</span><span class="ident" id="7635931">Errorf</span><span class="op" id="7635937">(</span><span class="string" id="7635938">&#34;Marshal(x)&nbsp;=&nbsp;%#q;&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="7635966">,</span>&nbsp;<span class="ident" id="7635968">b</span><span class="op" id="7635969">,</span>&nbsp;<span class="ident" id="7635971">want</span><span class="op" id="7635975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7635978">}</span><br>
<span class="lineno"></span><span class="op" id="7635980">}</span><br>
<span class="lineno">445</span><br>
<span class="lineno"></span><span class="keyword" id="7635983">func</span>&nbsp;<span class="ident" id="7635988">TestHTMLEscape</span><span class="op" id="7636002">(</span><span class="ident" id="7636003">t</span>&nbsp;<span class="op" id="7636005">*</span><span class="ident" id="7636006">testing</span><span class="op" id="7636013">.</span><span class="ident" id="7636014">T</span><span class="op" id="7636015">)</span>&nbsp;<span class="op" id="7636017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7636020">var</span>&nbsp;<span class="ident" id="7636024">b</span><span class="op" id="7636025">,</span>&nbsp;<span class="ident" id="7636027">want</span>&nbsp;<span class="ident" id="7636032">bytes</span><span class="op" id="7636037">.</span><span class="ident" id="7636038">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7636046">m</span>&nbsp;<span class="op" id="7636048">:=</span>&nbsp;<span class="string" id="7636051">`{&#34;M&#34;:&#34;&lt;html&gt;foo&nbsp;&amp;`</span>&nbsp;<span class="op" id="7636071">+</span>&nbsp;<span class="string" id="7636073">&#34;\xe2\x80\xa8&nbsp;\xe2\x80\xa9&#34;</span>&nbsp;<span class="op" id="7636101">+</span>&nbsp;<span class="string" id="7636103">`&lt;/html&gt;&#34;}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7636116">want</span><span class="op" id="7636120">.</span><span class="ident" id="7636121">Write</span><span class="op" id="7636126">(</span><span class="op" id="7636127">[</span><span class="op" id="7636128">]</span><span class="builtintype" id="7636129">byte</span><span class="op" id="7636133">(</span><span class="string" id="7636134">`{&#34;M&#34;:&#34;\u003chtml\u003efoo&nbsp;\u0026\u2028&nbsp;\u2029\u003c/html\u003e&#34;}`</span><span class="op" id="7636200">)</span><span class="op" id="7636201">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7636204">HTMLEscape</span><span class="op" id="7636214">(</span><span class="op" id="7636215">&amp;</span><span class="ident" id="7636216">b</span><span class="op" id="7636217">,</span>&nbsp;<span class="op" id="7636219">[</span><span class="op" id="7636220">]</span><span class="builtintype" id="7636221">byte</span><span class="op" id="7636225">(</span><span class="ident" id="7636226">m</span><span class="op" id="7636227">)</span><span class="op" id="7636228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7636231">if</span>&nbsp;<span class="op" id="7636234">!</span><span class="ident" id="7636235">bytes</span><span class="op" id="7636240">.</span><span class="ident" id="7636241">Equal</span><span class="op" id="7636246">(</span><span class="ident" id="7636247">b</span><span class="op" id="7636248">.</span><span class="ident" id="7636249">Bytes</span><span class="op" id="7636254">(</span><span class="op" id="7636255">)</span><span class="op" id="7636256">,</span>&nbsp;<span class="ident" id="7636258">want</span><span class="op" id="7636262">.</span><span class="ident" id="7636263">Bytes</span><span class="op" id="7636268">(</span><span class="op" id="7636269">)</span><span class="op" id="7636270">)</span>&nbsp;<span class="op" id="7636272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7636276">t</span><span class="op" id="7636277">.</span><span class="ident" id="7636278">Errorf</span><span class="op" id="7636284">(</span><span class="string" id="7636285">&#34;HTMLEscape(&amp;b,&nbsp;[]byte(m))&nbsp;=&nbsp;%s;&nbsp;want&nbsp;%s&#34;</span><span class="op" id="7636326">,</span>&nbsp;<span class="ident" id="7636328">b</span><span class="op" id="7636329">.</span><span class="ident" id="7636330">Bytes</span><span class="op" id="7636335">(</span><span class="op" id="7636336">)</span><span class="op" id="7636337">,</span>&nbsp;<span class="ident" id="7636339">want</span><span class="op" id="7636343">.</span><span class="ident" id="7636344">Bytes</span><span class="op" id="7636349">(</span><span class="op" id="7636350">)</span><span class="op" id="7636351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7636354">}</span><br>
<span class="lineno"></span><span class="op" id="7636356">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="comment" id="7636359">//&nbsp;golang.org/issue/8582</span><br>
<span class="lineno"></span><span class="keyword" id="7636384">func</span>&nbsp;<span class="ident" id="7636389">TestEncodePointerString</span><span class="op" id="7636412">(</span><span class="ident" id="7636413">t</span>&nbsp;<span class="op" id="7636415">*</span><span class="ident" id="7636416">testing</span><span class="op" id="7636423">.</span><span class="ident" id="7636424">T</span><span class="op" id="7636425">)</span>&nbsp;<span class="op" id="7636427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7636430">type</span>&nbsp;<span class="ident" id="7636435">stringPointer</span>&nbsp;<span class="keyword" id="7636449">struct</span>&nbsp;<span class="op" id="7636456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7636460">N</span>&nbsp;<span class="op" id="7636462">*</span><span class="ident" id="7636463">int64</span>&nbsp;<span class="string" id="7636469">`json:&#34;n,string&#34;`</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7636488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7636491">var</span>&nbsp;<span class="ident" id="7636495">n</span>&nbsp;<span class="ident" id="7636497">int64</span>&nbsp;<span class="op" id="7636503">=</span>&nbsp;<span class="num" id="7636505">42</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7636509">b</span><span class="op" id="7636510">,</span>&nbsp;<span class="ident" id="7636512">err</span>&nbsp;<span class="op" id="7636516">:=</span>&nbsp;<span class="ident" id="7636519">Marshal</span><span class="op" id="7636526">(</span><span class="ident" id="7636527">stringPointer</span><span class="op" id="7636540">{</span><span class="ident" id="7636541">N</span><span class="op" id="7636542">:</span>&nbsp;<span class="op" id="7636544">&amp;</span><span class="ident" id="7636545">n</span><span class="op" id="7636546">}</span><span class="op" id="7636547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7636550">if</span>&nbsp;<span class="ident" id="7636553">err</span>&nbsp;<span class="op" id="7636557">!=</span>&nbsp;<span class="ident" id="7636560">nil</span>&nbsp;<span class="op" id="7636564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7636568">t</span><span class="op" id="7636569">.</span><span class="ident" id="7636570">Fatalf</span><span class="op" id="7636576">(</span><span class="string" id="7636577">&#34;Marshal:&nbsp;%v&#34;</span><span class="op" id="7636590">,</span>&nbsp;<span class="ident" id="7636592">err</span><span class="op" id="7636595">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7636598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7636601">if</span>&nbsp;<span class="ident" id="7636604">got</span><span class="op" id="7636607">,</span>&nbsp;<span class="ident" id="7636609">want</span>&nbsp;<span class="op" id="7636614">:=</span>&nbsp;<span class="builtintype" id="7636617">string</span><span class="op" id="7636623">(</span><span class="ident" id="7636624">b</span><span class="op" id="7636625">)</span><span class="op" id="7636626">,</span>&nbsp;<span class="string" id="7636628">`{&#34;n&#34;:&#34;42&#34;}`</span><span class="op" id="7636640">;</span>&nbsp;<span class="ident" id="7636642">got</span>&nbsp;<span class="op" id="7636646">!=</span>&nbsp;<span class="ident" id="7636649">want</span>&nbsp;<span class="op" id="7636654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7636658">t</span><span class="op" id="7636659">.</span><span class="ident" id="7636660">Errorf</span><span class="op" id="7636666">(</span><span class="string" id="7636667">&#34;Marshal&nbsp;=&nbsp;%s,&nbsp;want&nbsp;%s&#34;</span><span class="op" id="7636690">,</span>&nbsp;<span class="ident" id="7636692">got</span><span class="op" id="7636695">,</span>&nbsp;<span class="ident" id="7636697">want</span><span class="op" id="7636701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7636704">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7636707">var</span>&nbsp;<span class="ident" id="7636711">back</span>&nbsp;<span class="ident" id="7636716">stringPointer</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7636731">err</span>&nbsp;<span class="op" id="7636735">=</span>&nbsp;<span class="ident" id="7636737">Unmarshal</span><span class="op" id="7636746">(</span><span class="ident" id="7636747">b</span><span class="op" id="7636748">,</span>&nbsp;<span class="op" id="7636750">&amp;</span><span class="ident" id="7636751">back</span><span class="op" id="7636755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7636758">if</span>&nbsp;<span class="ident" id="7636761">err</span>&nbsp;<span class="op" id="7636765">!=</span>&nbsp;<span class="ident" id="7636768">nil</span>&nbsp;<span class="op" id="7636772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7636776">t</span><span class="op" id="7636777">.</span><span class="ident" id="7636778">Fatalf</span><span class="op" id="7636784">(</span><span class="string" id="7636785">&#34;Unmarshal:&nbsp;%v&#34;</span><span class="op" id="7636800">,</span>&nbsp;<span class="ident" id="7636802">err</span><span class="op" id="7636805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7636808">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7636811">if</span>&nbsp;<span class="ident" id="7636814">back</span><span class="op" id="7636818">.</span><span class="ident" id="7636819">N</span>&nbsp;<span class="op" id="7636821">==</span>&nbsp;<span class="ident" id="7636824">nil</span>&nbsp;<span class="op" id="7636828">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7636832">t</span><span class="op" id="7636833">.</span><span class="ident" id="7636834">Fatalf</span><span class="op" id="7636840">(</span><span class="string" id="7636841">&#34;Unmarshalled&nbsp;nil&nbsp;N&nbsp;field&#34;</span><span class="op" id="7636867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7636870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7636873">if</span>&nbsp;<span class="op" id="7636876">*</span><span class="ident" id="7636877">back</span><span class="op" id="7636881">.</span><span class="ident" id="7636882">N</span>&nbsp;<span class="op" id="7636884">!=</span>&nbsp;<span class="num" id="7636887">42</span>&nbsp;<span class="op" id="7636890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7636894">t</span><span class="op" id="7636895">.</span><span class="ident" id="7636896">Fatalf</span><span class="op" id="7636902">(</span><span class="string" id="7636903">&#34;*N&nbsp;=&nbsp;%d;&nbsp;want&nbsp;42&#34;</span><span class="op" id="7636921">,</span>&nbsp;<span class="op" id="7636923">*</span><span class="ident" id="7636924">back</span><span class="op" id="7636928">.</span><span class="ident" id="7636929">N</span><span class="op" id="7636930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7636933">}</span><br>
<span class="lineno">480</span><span class="op" id="7636935">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7636938">var</span>&nbsp;<span class="ident" id="7636942">encodeStringTests</span>&nbsp;<span class="op" id="7636960">=</span>&nbsp;<span class="op" id="7636962">[</span><span class="op" id="7636963">]</span><span class="keyword" id="7636964">struct</span>&nbsp;<span class="op" id="7636971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7636974">in</span>&nbsp;&nbsp;<span class="builtintype" id="7636978">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7636986">out</span>&nbsp;<span class="builtintype" id="7636990">string</span><br>
<span class="lineno">485</span><span class="op" id="7636997">}</span><span class="op" id="7636998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7637001">{</span><span class="string" id="7637002">&#34;\x00&#34;</span><span class="op" id="7637008">,</span>&nbsp;<span class="string" id="7637010">`&#34;\u0000&#34;`</span><span class="op" id="7637020">}</span><span class="op" id="7637021">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7637024">{</span><span class="string" id="7637025">&#34;\x01&#34;</span><span class="op" id="7637031">,</span>&nbsp;<span class="string" id="7637033">`&#34;\u0001&#34;`</span><span class="op" id="7637043">}</span><span class="op" id="7637044">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7637047">{</span><span class="string" id="7637048">&#34;\x02&#34;</span><span class="op" id="7637054">,</span>&nbsp;<span class="string" id="7637056">`&#34;\u0002&#34;`</span><span class="op" id="7637066">}</span><span class="op" id="7637067">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7637070">{</span><span class="string" id="7637071">&#34;\x03&#34;</span><span class="op" id="7637077">,</span>&nbsp;<span class="string" id="7637079">`&#34;\u0003&#34;`</span><span class="op" id="7637089">}</span><span class="op" id="7637090">,</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7637093">{</span><span class="string" id="7637094">&#34;\x04&#34;</span><span class="op" id="7637100">,</span>&nbsp;<span class="string" id="7637102">`&#34;\u0004&#34;`</span><span class="op" id="7637112">}</span><span class="op" id="7637113">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7637116">{</span><span class="string" id="7637117">&#34;\x05&#34;</span><span class="op" id="7637123">,</span>&nbsp;<span class="string" id="7637125">`&#34;\u0005&#34;`</span><span class="op" id="7637135">}</span><span class="op" id="7637136">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7637139">{</span><span class="string" id="7637140">&#34;\x06&#34;</span><span class="op" id="7637146">,</span>&nbsp;<span class="string" id="7637148">`&#34;\u0006&#34;`</span><span class="op" id="7637158">}</span><span class="op" id="7637159">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7637162">{</span><span class="string" id="7637163">&#34;\x07&#34;</span><span class="op" id="7637169">,</span>&nbsp;<span class="string" id="7637171">`&#34;\u0007&#34;`</span><span class="op" id="7637181">}</span><span class="op" id="7637182">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7637185">{</span><span class="string" id="7637186">&#34;\x08&#34;</span><span class="op" id="7637192">,</span>&nbsp;<span class="string" id="7637194">`&#34;\u0008&#34;`</span><span class="op" id="7637204">}</span><span class="op" id="7637205">,</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7637208">{</span><span class="string" id="7637209">&#34;\x09&#34;</span><span class="op" id="7637215">,</span>&nbsp;<span class="string" id="7637217">`&#34;\t&#34;`</span><span class="op" id="7637223">}</span><span class="op" id="7637224">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7637227">{</span><span class="string" id="7637228">&#34;\x0a&#34;</span><span class="op" id="7637234">,</span>&nbsp;<span class="string" id="7637236">`&#34;\n&#34;`</span><span class="op" id="7637242">}</span><span class="op" id="7637243">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7637246">{</span><span class="string" id="7637247">&#34;\x0b&#34;</span><span class="op" id="7637253">,</span>&nbsp;<span class="string" id="7637255">`&#34;\u000b&#34;`</span><span class="op" id="7637265">}</span><span class="op" id="7637266">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7637269">{</span><span class="string" id="7637270">&#34;\x0c&#34;</span><span class="op" id="7637276">,</span>&nbsp;<span class="string" id="7637278">`&#34;\u000c&#34;`</span><span class="op" id="7637288">}</span><span class="op" id="7637289">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7637292">{</span><span class="string" id="7637293">&#34;\x0d&#34;</span><span class="op" id="7637299">,</span>&nbsp;<span class="string" id="7637301">`&#34;\r&#34;`</span><span class="op" id="7637307">}</span><span class="op" id="7637308">,</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7637311">{</span><span class="string" id="7637312">&#34;\x0e&#34;</span><span class="op" id="7637318">,</span>&nbsp;<span class="string" id="7637320">`&#34;\u000e&#34;`</span><span class="op" id="7637330">}</span><span class="op" id="7637331">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7637334">{</span><span class="string" id="7637335">&#34;\x0f&#34;</span><span class="op" id="7637341">,</span>&nbsp;<span class="string" id="7637343">`&#34;\u000f&#34;`</span><span class="op" id="7637353">}</span><span class="op" id="7637354">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7637357">{</span><span class="string" id="7637358">&#34;\x10&#34;</span><span class="op" id="7637364">,</span>&nbsp;<span class="string" id="7637366">`&#34;\u0010&#34;`</span><span class="op" id="7637376">}</span><span class="op" id="7637377">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7637380">{</span><span class="string" id="7637381">&#34;\x11&#34;</span><span class="op" id="7637387">,</span>&nbsp;<span class="string" id="7637389">`&#34;\u0011&#34;`</span><span class="op" id="7637399">}</span><span class="op" id="7637400">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7637403">{</span><span class="string" id="7637404">&#34;\x12&#34;</span><span class="op" id="7637410">,</span>&nbsp;<span class="string" id="7637412">`&#34;\u0012&#34;`</span><span class="op" id="7637422">}</span><span class="op" id="7637423">,</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7637426">{</span><span class="string" id="7637427">&#34;\x13&#34;</span><span class="op" id="7637433">,</span>&nbsp;<span class="string" id="7637435">`&#34;\u0013&#34;`</span><span class="op" id="7637445">}</span><span class="op" id="7637446">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7637449">{</span><span class="string" id="7637450">&#34;\x14&#34;</span><span class="op" id="7637456">,</span>&nbsp;<span class="string" id="7637458">`&#34;\u0014&#34;`</span><span class="op" id="7637468">}</span><span class="op" id="7637469">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7637472">{</span><span class="string" id="7637473">&#34;\x15&#34;</span><span class="op" id="7637479">,</span>&nbsp;<span class="string" id="7637481">`&#34;\u0015&#34;`</span><span class="op" id="7637491">}</span><span class="op" id="7637492">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7637495">{</span><span class="string" id="7637496">&#34;\x16&#34;</span><span class="op" id="7637502">,</span>&nbsp;<span class="string" id="7637504">`&#34;\u0016&#34;`</span><span class="op" id="7637514">}</span><span class="op" id="7637515">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7637518">{</span><span class="string" id="7637519">&#34;\x17&#34;</span><span class="op" id="7637525">,</span>&nbsp;<span class="string" id="7637527">`&#34;\u0017&#34;`</span><span class="op" id="7637537">}</span><span class="op" id="7637538">,</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7637541">{</span><span class="string" id="7637542">&#34;\x18&#34;</span><span class="op" id="7637548">,</span>&nbsp;<span class="string" id="7637550">`&#34;\u0018&#34;`</span><span class="op" id="7637560">}</span><span class="op" id="7637561">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7637564">{</span><span class="string" id="7637565">&#34;\x19&#34;</span><span class="op" id="7637571">,</span>&nbsp;<span class="string" id="7637573">`&#34;\u0019&#34;`</span><span class="op" id="7637583">}</span><span class="op" id="7637584">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7637587">{</span><span class="string" id="7637588">&#34;\x1a&#34;</span><span class="op" id="7637594">,</span>&nbsp;<span class="string" id="7637596">`&#34;\u001a&#34;`</span><span class="op" id="7637606">}</span><span class="op" id="7637607">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7637610">{</span><span class="string" id="7637611">&#34;\x1b&#34;</span><span class="op" id="7637617">,</span>&nbsp;<span class="string" id="7637619">`&#34;\u001b&#34;`</span><span class="op" id="7637629">}</span><span class="op" id="7637630">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7637633">{</span><span class="string" id="7637634">&#34;\x1c&#34;</span><span class="op" id="7637640">,</span>&nbsp;<span class="string" id="7637642">`&#34;\u001c&#34;`</span><span class="op" id="7637652">}</span><span class="op" id="7637653">,</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7637656">{</span><span class="string" id="7637657">&#34;\x1d&#34;</span><span class="op" id="7637663">,</span>&nbsp;<span class="string" id="7637665">`&#34;\u001d&#34;`</span><span class="op" id="7637675">}</span><span class="op" id="7637676">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7637679">{</span><span class="string" id="7637680">&#34;\x1e&#34;</span><span class="op" id="7637686">,</span>&nbsp;<span class="string" id="7637688">`&#34;\u001e&#34;`</span><span class="op" id="7637698">}</span><span class="op" id="7637699">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7637702">{</span><span class="string" id="7637703">&#34;\x1f&#34;</span><span class="op" id="7637709">,</span>&nbsp;<span class="string" id="7637711">`&#34;\u001f&#34;`</span><span class="op" id="7637721">}</span><span class="op" id="7637722">,</span><br>
<span class="lineno"></span><span class="op" id="7637724">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">520</span><span class="keyword" id="7637727">func</span>&nbsp;<span class="ident" id="7637732">TestEncodeString</span><span class="op" id="7637748">(</span><span class="ident" id="7637749">t</span>&nbsp;<span class="op" id="7637751">*</span><span class="ident" id="7637752">testing</span><span class="op" id="7637759">.</span><span class="ident" id="7637760">T</span><span class="op" id="7637761">)</span>&nbsp;<span class="op" id="7637763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7637766">for</span>&nbsp;<span class="ident" id="7637770">_</span><span class="op" id="7637771">,</span>&nbsp;<span class="ident" id="7637773">tt</span>&nbsp;<span class="op" id="7637776">:=</span>&nbsp;<span class="keyword" id="7637779">range</span>&nbsp;<span class="ident" id="7637785">encodeStringTests</span>&nbsp;<span class="op" id="7637803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7637807">b</span><span class="op" id="7637808">,</span>&nbsp;<span class="ident" id="7637810">err</span>&nbsp;<span class="op" id="7637814">:=</span>&nbsp;<span class="ident" id="7637817">Marshal</span><span class="op" id="7637824">(</span><span class="ident" id="7637825">tt</span><span class="op" id="7637827">.</span><span class="ident" id="7637828">in</span><span class="op" id="7637830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7637834">if</span>&nbsp;<span class="ident" id="7637837">err</span>&nbsp;<span class="op" id="7637841">!=</span>&nbsp;<span class="ident" id="7637844">nil</span>&nbsp;<span class="op" id="7637848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7637853">t</span><span class="op" id="7637854">.</span><span class="ident" id="7637855">Errorf</span><span class="op" id="7637861">(</span><span class="string" id="7637862">&#34;Marshal(%q):&nbsp;%v&#34;</span><span class="op" id="7637879">,</span>&nbsp;<span class="ident" id="7637881">tt</span><span class="op" id="7637883">.</span><span class="ident" id="7637884">in</span><span class="op" id="7637886">,</span>&nbsp;<span class="ident" id="7637888">err</span><span class="op" id="7637891">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7637896">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7637907">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7637911">out</span>&nbsp;<span class="op" id="7637915">:=</span>&nbsp;<span class="builtintype" id="7637918">string</span><span class="op" id="7637924">(</span><span class="ident" id="7637925">b</span><span class="op" id="7637926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7637930">if</span>&nbsp;<span class="ident" id="7637933">out</span>&nbsp;<span class="op" id="7637937">!=</span>&nbsp;<span class="ident" id="7637940">tt</span><span class="op" id="7637942">.</span><span class="ident" id="7637943">out</span>&nbsp;<span class="op" id="7637947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7637952">t</span><span class="op" id="7637953">.</span><span class="ident" id="7637954">Errorf</span><span class="op" id="7637960">(</span><span class="string" id="7637961">&#34;Marshal(%q)&nbsp;=&nbsp;%#q,&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="7637990">,</span>&nbsp;<span class="ident" id="7637992">tt</span><span class="op" id="7637994">.</span><span class="ident" id="7637995">in</span><span class="op" id="7637997">,</span>&nbsp;<span class="ident" id="7637999">out</span><span class="op" id="7638002">,</span>&nbsp;<span class="ident" id="7638004">tt</span><span class="op" id="7638006">.</span><span class="ident" id="7638007">out</span><span class="op" id="7638010">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7638014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7638017">}</span><br>
<span class="lineno"></span><span class="op" id="7638019">}</span>
</div>
</body>
</html>
