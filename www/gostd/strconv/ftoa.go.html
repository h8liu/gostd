<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="1704246">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1704301">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1704355">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1704406">//&nbsp;Binary&nbsp;to&nbsp;decimal&nbsp;floating&nbsp;point&nbsp;conversion.</span><br>
<span class="lineno"></span><span class="comment" id="1704454">//&nbsp;Algorithm:</span><br>
<span class="lineno"></span><span class="comment" id="1704468">//&nbsp;&nbsp;&nbsp;1)&nbsp;store&nbsp;mantissa&nbsp;in&nbsp;multiprecision&nbsp;decimal</span><br>
<span class="lineno"></span><span class="comment" id="1704517">//&nbsp;&nbsp;&nbsp;2)&nbsp;shift&nbsp;decimal&nbsp;by&nbsp;exponent</span><br>
<span class="lineno"></span><span class="comment" id="1704551">//&nbsp;&nbsp;&nbsp;3)&nbsp;read&nbsp;digits&nbsp;out&nbsp;&amp;&nbsp;format</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1704585">package</span>&nbsp;<span class="ident" id="1704593">strconv</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1704602">import</span>&nbsp;<span class="string" id="1704609">&#34;math&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="1704617">//&nbsp;TODO:&nbsp;move&nbsp;elsewhere?</span><br>
<span class="lineno"></span><span class="keyword" id="1704642">type</span>&nbsp;<span class="ident" id="1704647">floatInfo</span>&nbsp;<span class="keyword" id="1704657">struct</span>&nbsp;<span class="op" id="1704664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1704667">mantbits</span>&nbsp;<span class="builtintype" id="1704676">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1704682">expbits</span>&nbsp;&nbsp;<span class="builtintype" id="1704691">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1704697">bias</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1704706">int</span><br>
<span class="lineno">20</span><span class="op" id="1704710">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1704713">var</span>&nbsp;<span class="ident" id="1704717">float32info</span>&nbsp;<span class="op" id="1704729">=</span>&nbsp;<span class="ident" id="1704731">floatInfo</span><span class="op" id="1704740">{</span><span class="num" id="1704741">23</span><span class="op" id="1704743">,</span>&nbsp;<span class="num" id="1704745">8</span><span class="op" id="1704746">,</span>&nbsp;<span class="op" id="1704748">-</span><span class="num" id="1704749">127</span><span class="op" id="1704752">}</span><br>
<span class="lineno"></span><span class="keyword" id="1704754">var</span>&nbsp;<span class="ident" id="1704758">float64info</span>&nbsp;<span class="op" id="1704770">=</span>&nbsp;<span class="ident" id="1704772">floatInfo</span><span class="op" id="1704781">{</span><span class="num" id="1704782">52</span><span class="op" id="1704784">,</span>&nbsp;<span class="num" id="1704786">11</span><span class="op" id="1704788">,</span>&nbsp;<span class="op" id="1704790">-</span><span class="num" id="1704791">1023</span><span class="op" id="1704795">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="1704798">//&nbsp;FormatFloat&nbsp;converts&nbsp;the&nbsp;floating-point&nbsp;number&nbsp;f&nbsp;to&nbsp;a&nbsp;string,</span><br>
<span class="lineno"></span><span class="comment" id="1704863">//&nbsp;according&nbsp;to&nbsp;the&nbsp;format&nbsp;fmt&nbsp;and&nbsp;precision&nbsp;prec.&nbsp;&nbsp;It&nbsp;rounds&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1704929">//&nbsp;result&nbsp;assuming&nbsp;that&nbsp;the&nbsp;original&nbsp;was&nbsp;obtained&nbsp;from&nbsp;a&nbsp;floating-point</span><br>
<span class="lineno"></span><span class="comment" id="1705001">//&nbsp;value&nbsp;of&nbsp;bitSize&nbsp;bits&nbsp;(32&nbsp;for&nbsp;float32,&nbsp;64&nbsp;for&nbsp;float64).</span><br>
<span class="lineno"></span><span class="comment" id="1705060">//</span><br>
<span class="lineno">30</span><span class="comment" id="1705063">//&nbsp;The&nbsp;format&nbsp;fmt&nbsp;is&nbsp;one&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="1705091">//&nbsp;&#39;b&#39;&nbsp;(-ddddp±ddd,&nbsp;a&nbsp;binary&nbsp;exponent),</span><br>
<span class="lineno"></span><span class="comment" id="1705132">//&nbsp;&#39;e&#39;&nbsp;(-d.dddde±dd,&nbsp;a&nbsp;decimal&nbsp;exponent),</span><br>
<span class="lineno"></span><span class="comment" id="1705175">//&nbsp;&#39;E&#39;&nbsp;(-d.ddddE±dd,&nbsp;a&nbsp;decimal&nbsp;exponent),</span><br>
<span class="lineno"></span><span class="comment" id="1705218">//&nbsp;&#39;f&#39;&nbsp;(-ddd.dddd,&nbsp;no&nbsp;exponent),</span><br>
<span class="lineno">35</span><span class="comment" id="1705251">//&nbsp;&#39;g&#39;&nbsp;(&#39;e&#39;&nbsp;for&nbsp;large&nbsp;exponents,&nbsp;&#39;f&#39;&nbsp;otherwise),&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="1705303">//&nbsp;&#39;G&#39;&nbsp;(&#39;E&#39;&nbsp;for&nbsp;large&nbsp;exponents,&nbsp;&#39;f&#39;&nbsp;otherwise).</span><br>
<span class="lineno"></span><span class="comment" id="1705352">//</span><br>
<span class="lineno"></span><span class="comment" id="1705355">//&nbsp;The&nbsp;precision&nbsp;prec&nbsp;controls&nbsp;the&nbsp;number&nbsp;of&nbsp;digits</span><br>
<span class="lineno"></span><span class="comment" id="1705407">//&nbsp;(excluding&nbsp;the&nbsp;exponent)&nbsp;printed&nbsp;by&nbsp;the&nbsp;&#39;e&#39;,&nbsp;&#39;E&#39;,&nbsp;&#39;f&#39;,&nbsp;&#39;g&#39;,&nbsp;and&nbsp;&#39;G&#39;&nbsp;formats.</span><br>
<span class="lineno">40</span><span class="comment" id="1705487">//&nbsp;For&nbsp;&#39;e&#39;,&nbsp;&#39;E&#39;,&nbsp;and&nbsp;&#39;f&#39;&nbsp;it&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;digits&nbsp;after&nbsp;the&nbsp;decimal&nbsp;point.</span><br>
<span class="lineno"></span><span class="comment" id="1705564">//&nbsp;For&nbsp;&#39;g&#39;&nbsp;and&nbsp;&#39;G&#39;&nbsp;it&nbsp;is&nbsp;the&nbsp;total&nbsp;number&nbsp;of&nbsp;digits.</span><br>
<span class="lineno"></span><span class="comment" id="1705617">//&nbsp;The&nbsp;special&nbsp;precision&nbsp;-1&nbsp;uses&nbsp;the&nbsp;smallest&nbsp;number&nbsp;of&nbsp;digits</span><br>
<span class="lineno"></span><span class="comment" id="1705680">//&nbsp;necessary&nbsp;such&nbsp;that&nbsp;ParseFloat&nbsp;will&nbsp;return&nbsp;f&nbsp;exactly.</span><br>
<span class="lineno"></span><span class="keyword" id="1705737">func</span>&nbsp;<span class="ident" id="1705742">FormatFloat</span><span class="op" id="1705753">(</span><span class="ident" id="1705754">f</span>&nbsp;<span class="builtintype" id="1705756">float64</span><span class="op" id="1705763">,</span>&nbsp;<span class="ident" id="1705765">fmt</span>&nbsp;<span class="builtintype" id="1705769">byte</span><span class="op" id="1705773">,</span>&nbsp;<span class="ident" id="1705775">prec</span><span class="op" id="1705779">,</span>&nbsp;<span class="ident" id="1705781">bitSize</span>&nbsp;<span class="builtintype" id="1705789">int</span><span class="op" id="1705792">)</span>&nbsp;<span class="builtintype" id="1705794">string</span>&nbsp;<span class="op" id="1705801">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1705804">return</span>&nbsp;<span class="builtintype" id="1705811">string</span><span class="op" id="1705817">(</span><span class="ident" id="1705818">genericFtoa</span><span class="op" id="1705829">(</span><span class="builtinfunc" id="1705830">make</span><span class="op" id="1705834">(</span><span class="op" id="1705835">[</span><span class="op" id="1705836">]</span><span class="builtintype" id="1705837">byte</span><span class="op" id="1705841">,</span>&nbsp;<span class="num" id="1705843">0</span><span class="op" id="1705844">,</span>&nbsp;<span class="ident" id="1705846">max</span><span class="op" id="1705849">(</span><span class="ident" id="1705850">prec</span><span class="op" id="1705854">+</span><span class="num" id="1705855">4</span><span class="op" id="1705856">,</span>&nbsp;<span class="num" id="1705858">24</span><span class="op" id="1705860">)</span><span class="op" id="1705861">)</span><span class="op" id="1705862">,</span>&nbsp;<span class="ident" id="1705864">f</span><span class="op" id="1705865">,</span>&nbsp;<span class="ident" id="1705867">fmt</span><span class="op" id="1705870">,</span>&nbsp;<span class="ident" id="1705872">prec</span><span class="op" id="1705876">,</span>&nbsp;<span class="ident" id="1705878">bitSize</span><span class="op" id="1705885">)</span><span class="op" id="1705886">)</span><br>
<span class="lineno"></span><span class="op" id="1705888">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1705891">//&nbsp;AppendFloat&nbsp;appends&nbsp;the&nbsp;string&nbsp;form&nbsp;of&nbsp;the&nbsp;floating-point&nbsp;number&nbsp;f,</span><br>
<span class="lineno"></span><span class="comment" id="1705962">//&nbsp;as&nbsp;generated&nbsp;by&nbsp;FormatFloat,&nbsp;to&nbsp;dst&nbsp;and&nbsp;returns&nbsp;the&nbsp;extended&nbsp;buffer.</span><br>
<span class="lineno">50</span><span class="keyword" id="1706034">func</span>&nbsp;<span class="ident" id="1706039">AppendFloat</span><span class="op" id="1706050">(</span><span class="ident" id="1706051">dst</span>&nbsp;<span class="op" id="1706055">[</span><span class="op" id="1706056">]</span><span class="builtintype" id="1706057">byte</span><span class="op" id="1706061">,</span>&nbsp;<span class="ident" id="1706063">f</span>&nbsp;<span class="builtintype" id="1706065">float64</span><span class="op" id="1706072">,</span>&nbsp;<span class="ident" id="1706074">fmt</span>&nbsp;<span class="builtintype" id="1706078">byte</span><span class="op" id="1706082">,</span>&nbsp;<span class="ident" id="1706084">prec</span>&nbsp;<span class="builtintype" id="1706089">int</span><span class="op" id="1706092">,</span>&nbsp;<span class="ident" id="1706094">bitSize</span>&nbsp;<span class="builtintype" id="1706102">int</span><span class="op" id="1706105">)</span>&nbsp;<span class="op" id="1706107">[</span><span class="op" id="1706108">]</span><span class="builtintype" id="1706109">byte</span>&nbsp;<span class="op" id="1706114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1706117">return</span>&nbsp;<span class="ident" id="1706124">genericFtoa</span><span class="op" id="1706135">(</span><span class="ident" id="1706136">dst</span><span class="op" id="1706139">,</span>&nbsp;<span class="ident" id="1706141">f</span><span class="op" id="1706142">,</span>&nbsp;<span class="ident" id="1706144">fmt</span><span class="op" id="1706147">,</span>&nbsp;<span class="ident" id="1706149">prec</span><span class="op" id="1706153">,</span>&nbsp;<span class="ident" id="1706155">bitSize</span><span class="op" id="1706162">)</span><br>
<span class="lineno"></span><span class="op" id="1706164">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1706167">func</span>&nbsp;<span class="ident" id="1706172">genericFtoa</span><span class="op" id="1706183">(</span><span class="ident" id="1706184">dst</span>&nbsp;<span class="op" id="1706188">[</span><span class="op" id="1706189">]</span><span class="builtintype" id="1706190">byte</span><span class="op" id="1706194">,</span>&nbsp;<span class="ident" id="1706196">val</span>&nbsp;<span class="builtintype" id="1706200">float64</span><span class="op" id="1706207">,</span>&nbsp;<span class="ident" id="1706209">fmt</span>&nbsp;<span class="builtintype" id="1706213">byte</span><span class="op" id="1706217">,</span>&nbsp;<span class="ident" id="1706219">prec</span><span class="op" id="1706223">,</span>&nbsp;<span class="ident" id="1706225">bitSize</span>&nbsp;<span class="builtintype" id="1706233">int</span><span class="op" id="1706236">)</span>&nbsp;<span class="op" id="1706238">[</span><span class="op" id="1706239">]</span><span class="builtintype" id="1706240">byte</span>&nbsp;<span class="op" id="1706245">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1706248">var</span>&nbsp;<span class="ident" id="1706252">bits</span>&nbsp;<span class="ident" id="1706257">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1706265">var</span>&nbsp;<span class="ident" id="1706269">flt</span>&nbsp;<span class="op" id="1706273">*</span><span class="ident" id="1706274">floatInfo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1706285">switch</span>&nbsp;<span class="ident" id="1706292">bitSize</span>&nbsp;<span class="op" id="1706300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1706303">case</span>&nbsp;<span class="num" id="1706308">32</span><span class="op" id="1706310">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1706314">bits</span>&nbsp;<span class="op" id="1706319">=</span>&nbsp;<span class="ident" id="1706321">uint64</span><span class="op" id="1706327">(</span><span class="ident" id="1706328">math</span><span class="op" id="1706332">.</span><span class="ident" id="1706333">Float32bits</span><span class="op" id="1706344">(</span><span class="builtintype" id="1706345">float32</span><span class="op" id="1706352">(</span><span class="ident" id="1706353">val</span><span class="op" id="1706356">)</span><span class="op" id="1706357">)</span><span class="op" id="1706358">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1706362">flt</span>&nbsp;<span class="op" id="1706366">=</span>&nbsp;<span class="op" id="1706368">&amp;</span><span class="ident" id="1706369">float32info</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1706382">case</span>&nbsp;<span class="num" id="1706387">64</span><span class="op" id="1706389">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1706393">bits</span>&nbsp;<span class="op" id="1706398">=</span>&nbsp;<span class="ident" id="1706400">math</span><span class="op" id="1706404">.</span><span class="ident" id="1706405">Float64bits</span><span class="op" id="1706416">(</span><span class="ident" id="1706417">val</span><span class="op" id="1706420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1706424">flt</span>&nbsp;<span class="op" id="1706428">=</span>&nbsp;<span class="op" id="1706430">&amp;</span><span class="ident" id="1706431">float64info</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1706444">default</span><span class="op" id="1706451">:</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1706455">panic</span><span class="op" id="1706460">(</span><span class="string" id="1706461">&#34;strconv:&nbsp;illegal&nbsp;AppendFloat/FormatFloat&nbsp;bitSize&#34;</span><span class="op" id="1706511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1706514">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1706518">neg</span>&nbsp;<span class="op" id="1706522">:=</span>&nbsp;<span class="ident" id="1706525">bits</span><span class="op" id="1706529">&gt;&gt;</span><span class="op" id="1706531">(</span><span class="ident" id="1706532">flt</span><span class="op" id="1706535">.</span><span class="ident" id="1706536">expbits</span><span class="op" id="1706543">+</span><span class="ident" id="1706544">flt</span><span class="op" id="1706547">.</span><span class="ident" id="1706548">mantbits</span><span class="op" id="1706556">)</span>&nbsp;<span class="op" id="1706558">!=</span>&nbsp;<span class="num" id="1706561">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1706564">exp</span>&nbsp;<span class="op" id="1706568">:=</span>&nbsp;<span class="builtintype" id="1706571">int</span><span class="op" id="1706574">(</span><span class="ident" id="1706575">bits</span><span class="op" id="1706579">&gt;&gt;</span><span class="ident" id="1706581">flt</span><span class="op" id="1706584">.</span><span class="ident" id="1706585">mantbits</span><span class="op" id="1706593">)</span>&nbsp;<span class="op" id="1706595">&amp;</span>&nbsp;<span class="op" id="1706597">(</span><span class="num" id="1706598">1</span><span class="op" id="1706599">&lt;&lt;</span><span class="ident" id="1706601">flt</span><span class="op" id="1706604">.</span><span class="ident" id="1706605">expbits</span>&nbsp;<span class="op" id="1706613">-</span>&nbsp;<span class="num" id="1706615">1</span><span class="op" id="1706616">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1706619">mant</span>&nbsp;<span class="op" id="1706624">:=</span>&nbsp;<span class="ident" id="1706627">bits</span>&nbsp;<span class="op" id="1706632">&amp;</span>&nbsp;<span class="op" id="1706634">(</span><span class="ident" id="1706635">uint64</span><span class="op" id="1706641">(</span><span class="num" id="1706642">1</span><span class="op" id="1706643">)</span><span class="op" id="1706644">&lt;&lt;</span><span class="ident" id="1706646">flt</span><span class="op" id="1706649">.</span><span class="ident" id="1706650">mantbits</span>&nbsp;<span class="op" id="1706659">-</span>&nbsp;<span class="num" id="1706661">1</span><span class="op" id="1706662">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1706666">switch</span>&nbsp;<span class="ident" id="1706673">exp</span>&nbsp;<span class="op" id="1706677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1706680">case</span>&nbsp;<span class="num" id="1706685">1</span><span class="op" id="1706686">&lt;&lt;</span><span class="ident" id="1706688">flt</span><span class="op" id="1706691">.</span><span class="ident" id="1706692">expbits</span>&nbsp;<span class="op" id="1706700">-</span>&nbsp;<span class="num" id="1706702">1</span><span class="op" id="1706703">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1706707">//&nbsp;Inf,&nbsp;NaN</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1706721">var</span>&nbsp;<span class="ident" id="1706725">s</span>&nbsp;<span class="builtintype" id="1706727">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1706736">switch</span>&nbsp;<span class="op" id="1706743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1706747">case</span>&nbsp;<span class="ident" id="1706752">mant</span>&nbsp;<span class="op" id="1706757">!=</span>&nbsp;<span class="num" id="1706760">0</span><span class="op" id="1706761">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1706766">s</span>&nbsp;<span class="op" id="1706768">=</span>&nbsp;<span class="string" id="1706770">&#34;NaN&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1706778">case</span>&nbsp;<span class="ident" id="1706783">neg</span><span class="op" id="1706786">:</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1706791">s</span>&nbsp;<span class="op" id="1706793">=</span>&nbsp;<span class="string" id="1706795">&#34;-Inf&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1706804">default</span><span class="op" id="1706811">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1706816">s</span>&nbsp;<span class="op" id="1706818">=</span>&nbsp;<span class="string" id="1706820">&#34;+Inf&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1706829">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1706833">return</span>&nbsp;<span class="builtinfunc" id="1706840">append</span><span class="op" id="1706846">(</span><span class="ident" id="1706847">dst</span><span class="op" id="1706850">,</span>&nbsp;<span class="ident" id="1706852">s</span><span class="op" id="1706853">...</span><span class="op" id="1706856">)</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1706860">case</span>&nbsp;<span class="num" id="1706865">0</span><span class="op" id="1706866">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1706870">//&nbsp;denormalized</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1706888">exp</span><span class="op" id="1706891">++</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1706896">default</span><span class="op" id="1706903">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1706907">//&nbsp;add&nbsp;implicit&nbsp;top&nbsp;bit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1706933">mant</span>&nbsp;<span class="op" id="1706938">|=</span>&nbsp;<span class="ident" id="1706941">uint64</span><span class="op" id="1706947">(</span><span class="num" id="1706948">1</span><span class="op" id="1706949">)</span>&nbsp;<span class="op" id="1706951">&lt;&lt;</span>&nbsp;<span class="ident" id="1706954">flt</span><span class="op" id="1706957">.</span><span class="ident" id="1706958">mantbits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1706968">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1706971">exp</span>&nbsp;<span class="op" id="1706975">+=</span>&nbsp;<span class="ident" id="1706978">flt</span><span class="op" id="1706981">.</span><span class="ident" id="1706982">bias</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1706989">//&nbsp;Pick&nbsp;off&nbsp;easy&nbsp;binary&nbsp;format.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1707022">if</span>&nbsp;<span class="ident" id="1707025">fmt</span>&nbsp;<span class="op" id="1707029">==</span>&nbsp;<span class="string" id="1707032">&#39;b&#39;</span>&nbsp;<span class="op" id="1707036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1707040">return</span>&nbsp;<span class="ident" id="1707047">fmtB</span><span class="op" id="1707051">(</span><span class="ident" id="1707052">dst</span><span class="op" id="1707055">,</span>&nbsp;<span class="ident" id="1707057">neg</span><span class="op" id="1707060">,</span>&nbsp;<span class="ident" id="1707062">mant</span><span class="op" id="1707066">,</span>&nbsp;<span class="ident" id="1707068">exp</span><span class="op" id="1707071">,</span>&nbsp;<span class="ident" id="1707073">flt</span><span class="op" id="1707076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1707079">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1707083">if</span>&nbsp;<span class="op" id="1707086">!</span><span class="ident" id="1707087">optimize</span>&nbsp;<span class="op" id="1707096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1707100">return</span>&nbsp;<span class="ident" id="1707107">bigFtoa</span><span class="op" id="1707114">(</span><span class="ident" id="1707115">dst</span><span class="op" id="1707118">,</span>&nbsp;<span class="ident" id="1707120">prec</span><span class="op" id="1707124">,</span>&nbsp;<span class="ident" id="1707126">fmt</span><span class="op" id="1707129">,</span>&nbsp;<span class="ident" id="1707131">neg</span><span class="op" id="1707134">,</span>&nbsp;<span class="ident" id="1707136">mant</span><span class="op" id="1707140">,</span>&nbsp;<span class="ident" id="1707142">exp</span><span class="op" id="1707145">,</span>&nbsp;<span class="ident" id="1707147">flt</span><span class="op" id="1707150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1707153">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1707157">var</span>&nbsp;<span class="ident" id="1707161">digs</span>&nbsp;<span class="ident" id="1707166">decimalSlice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1707180">ok</span>&nbsp;<span class="op" id="1707183">:=</span>&nbsp;<span class="builtintype" id="1707186">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1707193">//&nbsp;Negative&nbsp;precision&nbsp;means&nbsp;&#34;only&nbsp;as&nbsp;much&nbsp;as&nbsp;needed&nbsp;to&nbsp;be&nbsp;exact.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1707260">shortest</span>&nbsp;<span class="op" id="1707269">:=</span>&nbsp;<span class="ident" id="1707272">prec</span>&nbsp;<span class="op" id="1707277">&lt;</span>&nbsp;<span class="num" id="1707279">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1707282">if</span>&nbsp;<span class="ident" id="1707285">shortest</span>&nbsp;<span class="op" id="1707294">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1707298">//&nbsp;Try&nbsp;Grisu3&nbsp;algorithm.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1707325">f</span>&nbsp;<span class="op" id="1707327">:=</span>&nbsp;<span class="builtinfunc" id="1707330">new</span><span class="op" id="1707333">(</span><span class="ident" id="1707334">extFloat</span><span class="op" id="1707342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1707346">lower</span><span class="op" id="1707351">,</span>&nbsp;<span class="ident" id="1707353">upper</span>&nbsp;<span class="op" id="1707359">:=</span>&nbsp;<span class="ident" id="1707362">f</span><span class="op" id="1707363">.</span><span class="ident" id="1707364">AssignComputeBounds</span><span class="op" id="1707383">(</span><span class="ident" id="1707384">mant</span><span class="op" id="1707388">,</span>&nbsp;<span class="ident" id="1707390">exp</span><span class="op" id="1707393">,</span>&nbsp;<span class="ident" id="1707395">neg</span><span class="op" id="1707398">,</span>&nbsp;<span class="ident" id="1707400">flt</span><span class="op" id="1707403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1707407">var</span>&nbsp;<span class="ident" id="1707411">buf</span>&nbsp;<span class="op" id="1707415">[</span><span class="num" id="1707416">32</span><span class="op" id="1707418">]</span><span class="builtintype" id="1707419">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1707426">digs</span><span class="op" id="1707430">.</span><span class="ident" id="1707431">d</span>&nbsp;<span class="op" id="1707433">=</span>&nbsp;<span class="ident" id="1707435">buf</span><span class="op" id="1707438">[</span><span class="op" id="1707439">:</span><span class="op" id="1707440">]</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1707444">ok</span>&nbsp;<span class="op" id="1707447">=</span>&nbsp;<span class="ident" id="1707449">f</span><span class="op" id="1707450">.</span><span class="ident" id="1707451">ShortestDecimal</span><span class="op" id="1707466">(</span><span class="op" id="1707467">&amp;</span><span class="ident" id="1707468">digs</span><span class="op" id="1707472">,</span>&nbsp;<span class="op" id="1707474">&amp;</span><span class="ident" id="1707475">lower</span><span class="op" id="1707480">,</span>&nbsp;<span class="op" id="1707482">&amp;</span><span class="ident" id="1707483">upper</span><span class="op" id="1707488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1707492">if</span>&nbsp;<span class="op" id="1707495">!</span><span class="ident" id="1707496">ok</span>&nbsp;<span class="op" id="1707499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1707504">return</span>&nbsp;<span class="ident" id="1707511">bigFtoa</span><span class="op" id="1707518">(</span><span class="ident" id="1707519">dst</span><span class="op" id="1707522">,</span>&nbsp;<span class="ident" id="1707524">prec</span><span class="op" id="1707528">,</span>&nbsp;<span class="ident" id="1707530">fmt</span><span class="op" id="1707533">,</span>&nbsp;<span class="ident" id="1707535">neg</span><span class="op" id="1707538">,</span>&nbsp;<span class="ident" id="1707540">mant</span><span class="op" id="1707544">,</span>&nbsp;<span class="ident" id="1707546">exp</span><span class="op" id="1707549">,</span>&nbsp;<span class="ident" id="1707551">flt</span><span class="op" id="1707554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1707558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1707562">//&nbsp;Precision&nbsp;for&nbsp;shortest&nbsp;representation&nbsp;mode.</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1707611">switch</span>&nbsp;<span class="ident" id="1707618">fmt</span>&nbsp;<span class="op" id="1707622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1707626">case</span>&nbsp;<span class="string" id="1707631">&#39;e&#39;</span><span class="op" id="1707634">,</span>&nbsp;<span class="string" id="1707636">&#39;E&#39;</span><span class="op" id="1707639">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1707644">prec</span>&nbsp;<span class="op" id="1707649">=</span>&nbsp;<span class="ident" id="1707651">digs</span><span class="op" id="1707655">.</span><span class="ident" id="1707656">nd</span>&nbsp;<span class="op" id="1707659">-</span>&nbsp;<span class="num" id="1707661">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1707665">case</span>&nbsp;<span class="string" id="1707670">&#39;f&#39;</span><span class="op" id="1707673">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1707678">prec</span>&nbsp;<span class="op" id="1707683">=</span>&nbsp;<span class="ident" id="1707685">max</span><span class="op" id="1707688">(</span><span class="ident" id="1707689">digs</span><span class="op" id="1707693">.</span><span class="ident" id="1707694">nd</span><span class="op" id="1707696">-</span><span class="ident" id="1707697">digs</span><span class="op" id="1707701">.</span><span class="ident" id="1707702">dp</span><span class="op" id="1707704">,</span>&nbsp;<span class="num" id="1707706">0</span><span class="op" id="1707707">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1707711">case</span>&nbsp;<span class="string" id="1707716">&#39;g&#39;</span><span class="op" id="1707719">,</span>&nbsp;<span class="string" id="1707721">&#39;G&#39;</span><span class="op" id="1707724">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1707729">prec</span>&nbsp;<span class="op" id="1707734">=</span>&nbsp;<span class="ident" id="1707736">digs</span><span class="op" id="1707740">.</span><span class="ident" id="1707741">nd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1707746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1707749">}</span>&nbsp;<span class="keyword" id="1707751">else</span>&nbsp;<span class="keyword" id="1707756">if</span>&nbsp;<span class="ident" id="1707759">fmt</span>&nbsp;<span class="op" id="1707763">!=</span>&nbsp;<span class="string" id="1707766">&#39;f&#39;</span>&nbsp;<span class="op" id="1707770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1707774">//&nbsp;Fixed&nbsp;number&nbsp;of&nbsp;digits.</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1707803">digits</span>&nbsp;<span class="op" id="1707810">:=</span>&nbsp;<span class="ident" id="1707813">prec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1707820">switch</span>&nbsp;<span class="ident" id="1707827">fmt</span>&nbsp;<span class="op" id="1707831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1707835">case</span>&nbsp;<span class="string" id="1707840">&#39;e&#39;</span><span class="op" id="1707843">,</span>&nbsp;<span class="string" id="1707845">&#39;E&#39;</span><span class="op" id="1707848">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1707853">digits</span><span class="op" id="1707859">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1707864">case</span>&nbsp;<span class="string" id="1707869">&#39;g&#39;</span><span class="op" id="1707872">,</span>&nbsp;<span class="string" id="1707874">&#39;G&#39;</span><span class="op" id="1707877">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1707882">if</span>&nbsp;<span class="ident" id="1707885">prec</span>&nbsp;<span class="op" id="1707890">==</span>&nbsp;<span class="num" id="1707893">0</span>&nbsp;<span class="op" id="1707895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1707901">prec</span>&nbsp;<span class="op" id="1707906">=</span>&nbsp;<span class="num" id="1707908">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1707913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1707918">digits</span>&nbsp;<span class="op" id="1707925">=</span>&nbsp;<span class="ident" id="1707927">prec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1707934">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1707938">if</span>&nbsp;<span class="ident" id="1707941">digits</span>&nbsp;<span class="op" id="1707948">&lt;=</span>&nbsp;<span class="num" id="1707951">15</span>&nbsp;<span class="op" id="1707954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1707959">//&nbsp;try&nbsp;fast&nbsp;algorithm&nbsp;when&nbsp;the&nbsp;number&nbsp;of&nbsp;digits&nbsp;is&nbsp;reasonable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1708025">var</span>&nbsp;<span class="ident" id="1708029">buf</span>&nbsp;<span class="op" id="1708033">[</span><span class="num" id="1708034">24</span><span class="op" id="1708036">]</span><span class="builtintype" id="1708037">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1708045">digs</span><span class="op" id="1708049">.</span><span class="ident" id="1708050">d</span>&nbsp;<span class="op" id="1708052">=</span>&nbsp;<span class="ident" id="1708054">buf</span><span class="op" id="1708057">[</span><span class="op" id="1708058">:</span><span class="op" id="1708059">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1708064">f</span>&nbsp;<span class="op" id="1708066">:=</span>&nbsp;<span class="ident" id="1708069">extFloat</span><span class="op" id="1708077">{</span><span class="ident" id="1708078">mant</span><span class="op" id="1708082">,</span>&nbsp;<span class="ident" id="1708084">exp</span>&nbsp;<span class="op" id="1708088">-</span>&nbsp;<span class="builtintype" id="1708090">int</span><span class="op" id="1708093">(</span><span class="ident" id="1708094">flt</span><span class="op" id="1708097">.</span><span class="ident" id="1708098">mantbits</span><span class="op" id="1708106">)</span><span class="op" id="1708107">,</span>&nbsp;<span class="ident" id="1708109">neg</span><span class="op" id="1708112">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1708117">ok</span>&nbsp;<span class="op" id="1708120">=</span>&nbsp;<span class="ident" id="1708122">f</span><span class="op" id="1708123">.</span><span class="ident" id="1708124">FixedDecimal</span><span class="op" id="1708136">(</span><span class="op" id="1708137">&amp;</span><span class="ident" id="1708138">digs</span><span class="op" id="1708142">,</span>&nbsp;<span class="ident" id="1708144">digits</span><span class="op" id="1708150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1708154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1708157">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1708160">if</span>&nbsp;<span class="op" id="1708163">!</span><span class="ident" id="1708164">ok</span>&nbsp;<span class="op" id="1708167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1708171">return</span>&nbsp;<span class="ident" id="1708178">bigFtoa</span><span class="op" id="1708185">(</span><span class="ident" id="1708186">dst</span><span class="op" id="1708189">,</span>&nbsp;<span class="ident" id="1708191">prec</span><span class="op" id="1708195">,</span>&nbsp;<span class="ident" id="1708197">fmt</span><span class="op" id="1708200">,</span>&nbsp;<span class="ident" id="1708202">neg</span><span class="op" id="1708205">,</span>&nbsp;<span class="ident" id="1708207">mant</span><span class="op" id="1708211">,</span>&nbsp;<span class="ident" id="1708213">exp</span><span class="op" id="1708216">,</span>&nbsp;<span class="ident" id="1708218">flt</span><span class="op" id="1708221">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1708224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1708227">return</span>&nbsp;<span class="ident" id="1708234">formatDigits</span><span class="op" id="1708246">(</span><span class="ident" id="1708247">dst</span><span class="op" id="1708250">,</span>&nbsp;<span class="ident" id="1708252">shortest</span><span class="op" id="1708260">,</span>&nbsp;<span class="ident" id="1708262">neg</span><span class="op" id="1708265">,</span>&nbsp;<span class="ident" id="1708267">digs</span><span class="op" id="1708271">,</span>&nbsp;<span class="ident" id="1708273">prec</span><span class="op" id="1708277">,</span>&nbsp;<span class="ident" id="1708279">fmt</span><span class="op" id="1708282">)</span><br>
<span class="lineno"></span><span class="op" id="1708284">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1708287">//&nbsp;bigFtoa&nbsp;uses&nbsp;multiprecision&nbsp;computations&nbsp;to&nbsp;format&nbsp;a&nbsp;float.</span><br>
<span class="lineno">155</span><span class="keyword" id="1708350">func</span>&nbsp;<span class="ident" id="1708355">bigFtoa</span><span class="op" id="1708362">(</span><span class="ident" id="1708363">dst</span>&nbsp;<span class="op" id="1708367">[</span><span class="op" id="1708368">]</span><span class="builtintype" id="1708369">byte</span><span class="op" id="1708373">,</span>&nbsp;<span class="ident" id="1708375">prec</span>&nbsp;<span class="builtintype" id="1708380">int</span><span class="op" id="1708383">,</span>&nbsp;<span class="ident" id="1708385">fmt</span>&nbsp;<span class="builtintype" id="1708389">byte</span><span class="op" id="1708393">,</span>&nbsp;<span class="ident" id="1708395">neg</span>&nbsp;<span class="builtintype" id="1708399">bool</span><span class="op" id="1708403">,</span>&nbsp;<span class="ident" id="1708405">mant</span>&nbsp;<span class="ident" id="1708410">uint64</span><span class="op" id="1708416">,</span>&nbsp;<span class="ident" id="1708418">exp</span>&nbsp;<span class="builtintype" id="1708422">int</span><span class="op" id="1708425">,</span>&nbsp;<span class="ident" id="1708427">flt</span>&nbsp;<span class="op" id="1708431">*</span><span class="ident" id="1708432">floatInfo</span><span class="op" id="1708441">)</span>&nbsp;<span class="op" id="1708443">[</span><span class="op" id="1708444">]</span><span class="builtintype" id="1708445">byte</span>&nbsp;<span class="op" id="1708450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1708453">d</span>&nbsp;<span class="op" id="1708455">:=</span>&nbsp;<span class="builtinfunc" id="1708458">new</span><span class="op" id="1708461">(</span><span class="ident" id="1708462">decimal</span><span class="op" id="1708469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1708472">d</span><span class="op" id="1708473">.</span><span class="ident" id="1708474">Assign</span><span class="op" id="1708480">(</span><span class="ident" id="1708481">mant</span><span class="op" id="1708485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1708488">d</span><span class="op" id="1708489">.</span><span class="ident" id="1708490">Shift</span><span class="op" id="1708495">(</span><span class="ident" id="1708496">exp</span>&nbsp;<span class="op" id="1708500">-</span>&nbsp;<span class="builtintype" id="1708502">int</span><span class="op" id="1708505">(</span><span class="ident" id="1708506">flt</span><span class="op" id="1708509">.</span><span class="ident" id="1708510">mantbits</span><span class="op" id="1708518">)</span><span class="op" id="1708519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1708522">var</span>&nbsp;<span class="ident" id="1708526">digs</span>&nbsp;<span class="ident" id="1708531">decimalSlice</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1708545">shortest</span>&nbsp;<span class="op" id="1708554">:=</span>&nbsp;<span class="ident" id="1708557">prec</span>&nbsp;<span class="op" id="1708562">&lt;</span>&nbsp;<span class="num" id="1708564">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1708567">if</span>&nbsp;<span class="ident" id="1708570">shortest</span>&nbsp;<span class="op" id="1708579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1708583">roundShortest</span><span class="op" id="1708596">(</span><span class="ident" id="1708597">d</span><span class="op" id="1708598">,</span>&nbsp;<span class="ident" id="1708600">mant</span><span class="op" id="1708604">,</span>&nbsp;<span class="ident" id="1708606">exp</span><span class="op" id="1708609">,</span>&nbsp;<span class="ident" id="1708611">flt</span><span class="op" id="1708614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1708618">digs</span>&nbsp;<span class="op" id="1708623">=</span>&nbsp;<span class="ident" id="1708625">decimalSlice</span><span class="op" id="1708637">{</span><span class="ident" id="1708638">d</span><span class="op" id="1708639">:</span>&nbsp;<span class="ident" id="1708641">d</span><span class="op" id="1708642">.</span><span class="ident" id="1708643">d</span><span class="op" id="1708644">[</span><span class="op" id="1708645">:</span><span class="op" id="1708646">]</span><span class="op" id="1708647">,</span>&nbsp;<span class="ident" id="1708649">nd</span><span class="op" id="1708651">:</span>&nbsp;<span class="ident" id="1708653">d</span><span class="op" id="1708654">.</span><span class="ident" id="1708655">nd</span><span class="op" id="1708657">,</span>&nbsp;<span class="ident" id="1708659">dp</span><span class="op" id="1708661">:</span>&nbsp;<span class="ident" id="1708663">d</span><span class="op" id="1708664">.</span><span class="ident" id="1708665">dp</span><span class="op" id="1708667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1708671">//&nbsp;Precision&nbsp;for&nbsp;shortest&nbsp;representation&nbsp;mode.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1708720">switch</span>&nbsp;<span class="ident" id="1708727">fmt</span>&nbsp;<span class="op" id="1708731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1708735">case</span>&nbsp;<span class="string" id="1708740">&#39;e&#39;</span><span class="op" id="1708743">,</span>&nbsp;<span class="string" id="1708745">&#39;E&#39;</span><span class="op" id="1708748">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1708753">prec</span>&nbsp;<span class="op" id="1708758">=</span>&nbsp;<span class="ident" id="1708760">digs</span><span class="op" id="1708764">.</span><span class="ident" id="1708765">nd</span>&nbsp;<span class="op" id="1708768">-</span>&nbsp;<span class="num" id="1708770">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1708774">case</span>&nbsp;<span class="string" id="1708779">&#39;f&#39;</span><span class="op" id="1708782">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1708787">prec</span>&nbsp;<span class="op" id="1708792">=</span>&nbsp;<span class="ident" id="1708794">max</span><span class="op" id="1708797">(</span><span class="ident" id="1708798">digs</span><span class="op" id="1708802">.</span><span class="ident" id="1708803">nd</span><span class="op" id="1708805">-</span><span class="ident" id="1708806">digs</span><span class="op" id="1708810">.</span><span class="ident" id="1708811">dp</span><span class="op" id="1708813">,</span>&nbsp;<span class="num" id="1708815">0</span><span class="op" id="1708816">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1708820">case</span>&nbsp;<span class="string" id="1708825">&#39;g&#39;</span><span class="op" id="1708828">,</span>&nbsp;<span class="string" id="1708830">&#39;G&#39;</span><span class="op" id="1708833">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1708838">prec</span>&nbsp;<span class="op" id="1708843">=</span>&nbsp;<span class="ident" id="1708845">digs</span><span class="op" id="1708849">.</span><span class="ident" id="1708850">nd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1708855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1708858">}</span>&nbsp;<span class="keyword" id="1708860">else</span>&nbsp;<span class="op" id="1708865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1708869">//&nbsp;Round&nbsp;appropriately.</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1708895">switch</span>&nbsp;<span class="ident" id="1708902">fmt</span>&nbsp;<span class="op" id="1708906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1708910">case</span>&nbsp;<span class="string" id="1708915">&#39;e&#39;</span><span class="op" id="1708918">,</span>&nbsp;<span class="string" id="1708920">&#39;E&#39;</span><span class="op" id="1708923">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1708928">d</span><span class="op" id="1708929">.</span><span class="ident" id="1708930">Round</span><span class="op" id="1708935">(</span><span class="ident" id="1708936">prec</span>&nbsp;<span class="op" id="1708941">+</span>&nbsp;<span class="num" id="1708943">1</span><span class="op" id="1708944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1708948">case</span>&nbsp;<span class="string" id="1708953">&#39;f&#39;</span><span class="op" id="1708956">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1708961">d</span><span class="op" id="1708962">.</span><span class="ident" id="1708963">Round</span><span class="op" id="1708968">(</span><span class="ident" id="1708969">d</span><span class="op" id="1708970">.</span><span class="ident" id="1708971">dp</span>&nbsp;<span class="op" id="1708974">+</span>&nbsp;<span class="ident" id="1708976">prec</span><span class="op" id="1708980">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1708984">case</span>&nbsp;<span class="string" id="1708989">&#39;g&#39;</span><span class="op" id="1708992">,</span>&nbsp;<span class="string" id="1708994">&#39;G&#39;</span><span class="op" id="1708997">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1709002">if</span>&nbsp;<span class="ident" id="1709005">prec</span>&nbsp;<span class="op" id="1709010">==</span>&nbsp;<span class="num" id="1709013">0</span>&nbsp;<span class="op" id="1709015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1709021">prec</span>&nbsp;<span class="op" id="1709026">=</span>&nbsp;<span class="num" id="1709028">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1709033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1709038">d</span><span class="op" id="1709039">.</span><span class="ident" id="1709040">Round</span><span class="op" id="1709045">(</span><span class="ident" id="1709046">prec</span><span class="op" id="1709050">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1709054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1709058">digs</span>&nbsp;<span class="op" id="1709063">=</span>&nbsp;<span class="ident" id="1709065">decimalSlice</span><span class="op" id="1709077">{</span><span class="ident" id="1709078">d</span><span class="op" id="1709079">:</span>&nbsp;<span class="ident" id="1709081">d</span><span class="op" id="1709082">.</span><span class="ident" id="1709083">d</span><span class="op" id="1709084">[</span><span class="op" id="1709085">:</span><span class="op" id="1709086">]</span><span class="op" id="1709087">,</span>&nbsp;<span class="ident" id="1709089">nd</span><span class="op" id="1709091">:</span>&nbsp;<span class="ident" id="1709093">d</span><span class="op" id="1709094">.</span><span class="ident" id="1709095">nd</span><span class="op" id="1709097">,</span>&nbsp;<span class="ident" id="1709099">dp</span><span class="op" id="1709101">:</span>&nbsp;<span class="ident" id="1709103">d</span><span class="op" id="1709104">.</span><span class="ident" id="1709105">dp</span><span class="op" id="1709107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1709110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1709113">return</span>&nbsp;<span class="ident" id="1709120">formatDigits</span><span class="op" id="1709132">(</span><span class="ident" id="1709133">dst</span><span class="op" id="1709136">,</span>&nbsp;<span class="ident" id="1709138">shortest</span><span class="op" id="1709146">,</span>&nbsp;<span class="ident" id="1709148">neg</span><span class="op" id="1709151">,</span>&nbsp;<span class="ident" id="1709153">digs</span><span class="op" id="1709157">,</span>&nbsp;<span class="ident" id="1709159">prec</span><span class="op" id="1709163">,</span>&nbsp;<span class="ident" id="1709165">fmt</span><span class="op" id="1709168">)</span><br>
<span class="lineno"></span><span class="op" id="1709170">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="keyword" id="1709173">func</span>&nbsp;<span class="ident" id="1709178">formatDigits</span><span class="op" id="1709190">(</span><span class="ident" id="1709191">dst</span>&nbsp;<span class="op" id="1709195">[</span><span class="op" id="1709196">]</span><span class="builtintype" id="1709197">byte</span><span class="op" id="1709201">,</span>&nbsp;<span class="ident" id="1709203">shortest</span>&nbsp;<span class="builtintype" id="1709212">bool</span><span class="op" id="1709216">,</span>&nbsp;<span class="ident" id="1709218">neg</span>&nbsp;<span class="builtintype" id="1709222">bool</span><span class="op" id="1709226">,</span>&nbsp;<span class="ident" id="1709228">digs</span>&nbsp;<span class="ident" id="1709233">decimalSlice</span><span class="op" id="1709245">,</span>&nbsp;<span class="ident" id="1709247">prec</span>&nbsp;<span class="builtintype" id="1709252">int</span><span class="op" id="1709255">,</span>&nbsp;<span class="ident" id="1709257">fmt</span>&nbsp;<span class="builtintype" id="1709261">byte</span><span class="op" id="1709265">)</span>&nbsp;<span class="op" id="1709267">[</span><span class="op" id="1709268">]</span><span class="builtintype" id="1709269">byte</span>&nbsp;<span class="op" id="1709274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1709277">switch</span>&nbsp;<span class="ident" id="1709284">fmt</span>&nbsp;<span class="op" id="1709288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1709291">case</span>&nbsp;<span class="string" id="1709296">&#39;e&#39;</span><span class="op" id="1709299">,</span>&nbsp;<span class="string" id="1709301">&#39;E&#39;</span><span class="op" id="1709304">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1709308">return</span>&nbsp;<span class="ident" id="1709315">fmtE</span><span class="op" id="1709319">(</span><span class="ident" id="1709320">dst</span><span class="op" id="1709323">,</span>&nbsp;<span class="ident" id="1709325">neg</span><span class="op" id="1709328">,</span>&nbsp;<span class="ident" id="1709330">digs</span><span class="op" id="1709334">,</span>&nbsp;<span class="ident" id="1709336">prec</span><span class="op" id="1709340">,</span>&nbsp;<span class="ident" id="1709342">fmt</span><span class="op" id="1709345">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1709348">case</span>&nbsp;<span class="string" id="1709353">&#39;f&#39;</span><span class="op" id="1709356">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1709360">return</span>&nbsp;<span class="ident" id="1709367">fmtF</span><span class="op" id="1709371">(</span><span class="ident" id="1709372">dst</span><span class="op" id="1709375">,</span>&nbsp;<span class="ident" id="1709377">neg</span><span class="op" id="1709380">,</span>&nbsp;<span class="ident" id="1709382">digs</span><span class="op" id="1709386">,</span>&nbsp;<span class="ident" id="1709388">prec</span><span class="op" id="1709392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1709395">case</span>&nbsp;<span class="string" id="1709400">&#39;g&#39;</span><span class="op" id="1709403">,</span>&nbsp;<span class="string" id="1709405">&#39;G&#39;</span><span class="op" id="1709408">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1709412">//&nbsp;trailing&nbsp;fractional&nbsp;zeros&nbsp;in&nbsp;&#39;e&#39;&nbsp;form&nbsp;will&nbsp;be&nbsp;trimmed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1709472">eprec</span>&nbsp;<span class="op" id="1709478">:=</span>&nbsp;<span class="ident" id="1709481">prec</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1709488">if</span>&nbsp;<span class="ident" id="1709491">eprec</span>&nbsp;<span class="op" id="1709497">&gt;</span>&nbsp;<span class="ident" id="1709499">digs</span><span class="op" id="1709503">.</span><span class="ident" id="1709504">nd</span>&nbsp;<span class="op" id="1709507">&amp;&amp;</span>&nbsp;<span class="ident" id="1709510">digs</span><span class="op" id="1709514">.</span><span class="ident" id="1709515">nd</span>&nbsp;<span class="op" id="1709518">&gt;=</span>&nbsp;<span class="ident" id="1709521">digs</span><span class="op" id="1709525">.</span><span class="ident" id="1709526">dp</span>&nbsp;<span class="op" id="1709529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1709534">eprec</span>&nbsp;<span class="op" id="1709540">=</span>&nbsp;<span class="ident" id="1709542">digs</span><span class="op" id="1709546">.</span><span class="ident" id="1709547">nd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1709552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1709556">//&nbsp;%e&nbsp;is&nbsp;used&nbsp;if&nbsp;the&nbsp;exponent&nbsp;from&nbsp;the&nbsp;conversion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1709608">//&nbsp;is&nbsp;less&nbsp;than&nbsp;-4&nbsp;or&nbsp;greater&nbsp;than&nbsp;or&nbsp;equal&nbsp;to&nbsp;the&nbsp;precision.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1709672">//&nbsp;if&nbsp;precision&nbsp;was&nbsp;the&nbsp;shortest&nbsp;possible,&nbsp;use&nbsp;precision&nbsp;6&nbsp;for&nbsp;this&nbsp;decision.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1709752">if</span>&nbsp;<span class="ident" id="1709755">shortest</span>&nbsp;<span class="op" id="1709764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1709769">eprec</span>&nbsp;<span class="op" id="1709775">=</span>&nbsp;<span class="num" id="1709777">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1709781">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1709785">exp</span>&nbsp;<span class="op" id="1709789">:=</span>&nbsp;<span class="ident" id="1709792">digs</span><span class="op" id="1709796">.</span><span class="ident" id="1709797">dp</span>&nbsp;<span class="op" id="1709800">-</span>&nbsp;<span class="num" id="1709802">1</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1709806">if</span>&nbsp;<span class="ident" id="1709809">exp</span>&nbsp;<span class="op" id="1709813">&lt;</span>&nbsp;<span class="op" id="1709815">-</span><span class="num" id="1709816">4</span>&nbsp;<span class="op" id="1709818">||</span>&nbsp;<span class="ident" id="1709821">exp</span>&nbsp;<span class="op" id="1709825">&gt;=</span>&nbsp;<span class="ident" id="1709828">eprec</span>&nbsp;<span class="op" id="1709834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1709839">if</span>&nbsp;<span class="ident" id="1709842">prec</span>&nbsp;<span class="op" id="1709847">&gt;</span>&nbsp;<span class="ident" id="1709849">digs</span><span class="op" id="1709853">.</span><span class="ident" id="1709854">nd</span>&nbsp;<span class="op" id="1709857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1709863">prec</span>&nbsp;<span class="op" id="1709868">=</span>&nbsp;<span class="ident" id="1709870">digs</span><span class="op" id="1709874">.</span><span class="ident" id="1709875">nd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1709881">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1709886">return</span>&nbsp;<span class="ident" id="1709893">fmtE</span><span class="op" id="1709897">(</span><span class="ident" id="1709898">dst</span><span class="op" id="1709901">,</span>&nbsp;<span class="ident" id="1709903">neg</span><span class="op" id="1709906">,</span>&nbsp;<span class="ident" id="1709908">digs</span><span class="op" id="1709912">,</span>&nbsp;<span class="ident" id="1709914">prec</span><span class="op" id="1709918">-</span><span class="num" id="1709919">1</span><span class="op" id="1709920">,</span>&nbsp;<span class="ident" id="1709922">fmt</span><span class="op" id="1709925">+</span><span class="string" id="1709926">&#39;e&#39;</span><span class="op" id="1709929">-</span><span class="string" id="1709930">&#39;g&#39;</span><span class="op" id="1709933">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1709937">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1709941">if</span>&nbsp;<span class="ident" id="1709944">prec</span>&nbsp;<span class="op" id="1709949">&gt;</span>&nbsp;<span class="ident" id="1709951">digs</span><span class="op" id="1709955">.</span><span class="ident" id="1709956">dp</span>&nbsp;<span class="op" id="1709959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1709964">prec</span>&nbsp;<span class="op" id="1709969">=</span>&nbsp;<span class="ident" id="1709971">digs</span><span class="op" id="1709975">.</span><span class="ident" id="1709976">nd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1709981">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1709985">return</span>&nbsp;<span class="ident" id="1709992">fmtF</span><span class="op" id="1709996">(</span><span class="ident" id="1709997">dst</span><span class="op" id="1710000">,</span>&nbsp;<span class="ident" id="1710002">neg</span><span class="op" id="1710005">,</span>&nbsp;<span class="ident" id="1710007">digs</span><span class="op" id="1710011">,</span>&nbsp;<span class="ident" id="1710013">max</span><span class="op" id="1710016">(</span><span class="ident" id="1710017">prec</span><span class="op" id="1710021">-</span><span class="ident" id="1710022">digs</span><span class="op" id="1710026">.</span><span class="ident" id="1710027">dp</span><span class="op" id="1710029">,</span>&nbsp;<span class="num" id="1710031">0</span><span class="op" id="1710032">)</span><span class="op" id="1710033">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1710036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1710040">//&nbsp;unknown&nbsp;format</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1710059">return</span>&nbsp;<span class="builtinfunc" id="1710066">append</span><span class="op" id="1710072">(</span><span class="ident" id="1710073">dst</span><span class="op" id="1710076">,</span>&nbsp;<span class="string" id="1710078">&#39;%&#39;</span><span class="op" id="1710081">,</span>&nbsp;<span class="ident" id="1710083">fmt</span><span class="op" id="1710086">)</span><br>
<span class="lineno"></span><span class="op" id="1710088">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="comment" id="1710091">//&nbsp;Round&nbsp;d&nbsp;(=&nbsp;mant&nbsp;*&nbsp;2^exp)&nbsp;to&nbsp;the&nbsp;shortest&nbsp;number&nbsp;of&nbsp;digits</span><br>
<span class="lineno"></span><span class="comment" id="1710152">//&nbsp;that&nbsp;will&nbsp;let&nbsp;the&nbsp;original&nbsp;floating&nbsp;point&nbsp;value&nbsp;be&nbsp;precisely</span><br>
<span class="lineno"></span><span class="comment" id="1710216">//&nbsp;reconstructed.&nbsp;&nbsp;Size&nbsp;is&nbsp;original&nbsp;floating&nbsp;point&nbsp;size&nbsp;(64&nbsp;or&nbsp;32).</span><br>
<span class="lineno"></span><span class="keyword" id="1710284">func</span>&nbsp;<span class="ident" id="1710289">roundShortest</span><span class="op" id="1710302">(</span><span class="ident" id="1710303">d</span>&nbsp;<span class="op" id="1710305">*</span><span class="ident" id="1710306">decimal</span><span class="op" id="1710313">,</span>&nbsp;<span class="ident" id="1710315">mant</span>&nbsp;<span class="ident" id="1710320">uint64</span><span class="op" id="1710326">,</span>&nbsp;<span class="ident" id="1710328">exp</span>&nbsp;<span class="builtintype" id="1710332">int</span><span class="op" id="1710335">,</span>&nbsp;<span class="ident" id="1710337">flt</span>&nbsp;<span class="op" id="1710341">*</span><span class="ident" id="1710342">floatInfo</span><span class="op" id="1710351">)</span>&nbsp;<span class="op" id="1710353">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1710356">//&nbsp;If&nbsp;mantissa&nbsp;is&nbsp;zero,&nbsp;the&nbsp;number&nbsp;is&nbsp;zero;&nbsp;stop&nbsp;now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1710411">if</span>&nbsp;<span class="ident" id="1710414">mant</span>&nbsp;<span class="op" id="1710419">==</span>&nbsp;<span class="num" id="1710422">0</span>&nbsp;<span class="op" id="1710424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1710428">d</span><span class="op" id="1710429">.</span><span class="ident" id="1710430">nd</span>&nbsp;<span class="op" id="1710433">=</span>&nbsp;<span class="num" id="1710435">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1710439">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1710447">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1710451">//&nbsp;Compute&nbsp;upper&nbsp;and&nbsp;lower&nbsp;such&nbsp;that&nbsp;any&nbsp;decimal&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1710508">//&nbsp;between&nbsp;upper&nbsp;and&nbsp;lower&nbsp;(possibly&nbsp;inclusive)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1710557">//&nbsp;will&nbsp;round&nbsp;to&nbsp;the&nbsp;original&nbsp;floating&nbsp;point&nbsp;number.</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1710612">//&nbsp;We&nbsp;may&nbsp;see&nbsp;at&nbsp;once&nbsp;that&nbsp;the&nbsp;number&nbsp;is&nbsp;already&nbsp;shortest.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1710672">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1710676">//&nbsp;Suppose&nbsp;d&nbsp;is&nbsp;not&nbsp;denormal,&nbsp;so&nbsp;that&nbsp;2^exp&nbsp;&lt;=&nbsp;d&nbsp;&lt;&nbsp;10^dp.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1710735">//&nbsp;The&nbsp;closest&nbsp;shorter&nbsp;number&nbsp;is&nbsp;at&nbsp;least&nbsp;10^(dp-nd)&nbsp;away.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1710795">//&nbsp;The&nbsp;lower/upper&nbsp;bounds&nbsp;computed&nbsp;below&nbsp;are&nbsp;at&nbsp;distance</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1710853">//&nbsp;at&nbsp;most&nbsp;2^(exp-mantbits).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1710883">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1710887">//&nbsp;So&nbsp;the&nbsp;number&nbsp;is&nbsp;already&nbsp;shortest&nbsp;if&nbsp;10^(dp-nd)&nbsp;&gt;&nbsp;2^(exp-mantbits),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1710959">//&nbsp;or&nbsp;equivalently&nbsp;log2(10)*(dp-nd)&nbsp;&gt;&nbsp;exp-mantbits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1711012">//&nbsp;It&nbsp;is&nbsp;true&nbsp;if&nbsp;332/100*(dp-nd)&nbsp;&gt;=&nbsp;exp-mantbits&nbsp;(log2(10)&nbsp;&gt;&nbsp;3.32).</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1711081">minexp</span>&nbsp;<span class="op" id="1711088">:=</span>&nbsp;<span class="ident" id="1711091">flt</span><span class="op" id="1711094">.</span><span class="ident" id="1711095">bias</span>&nbsp;<span class="op" id="1711100">+</span>&nbsp;<span class="num" id="1711102">1</span>&nbsp;<span class="comment" id="1711104">//&nbsp;minimum&nbsp;possible&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1711134">if</span>&nbsp;<span class="ident" id="1711137">exp</span>&nbsp;<span class="op" id="1711141">&gt;</span>&nbsp;<span class="ident" id="1711143">minexp</span>&nbsp;<span class="op" id="1711150">&amp;&amp;</span>&nbsp;<span class="num" id="1711153">332</span><span class="op" id="1711156">*</span><span class="op" id="1711157">(</span><span class="ident" id="1711158">d</span><span class="op" id="1711159">.</span><span class="ident" id="1711160">dp</span><span class="op" id="1711162">-</span><span class="ident" id="1711163">d</span><span class="op" id="1711164">.</span><span class="ident" id="1711165">nd</span><span class="op" id="1711167">)</span>&nbsp;<span class="op" id="1711169">&gt;=</span>&nbsp;<span class="num" id="1711172">100</span><span class="op" id="1711175">*</span><span class="op" id="1711176">(</span><span class="ident" id="1711177">exp</span><span class="op" id="1711180">-</span><span class="builtintype" id="1711181">int</span><span class="op" id="1711184">(</span><span class="ident" id="1711185">flt</span><span class="op" id="1711188">.</span><span class="ident" id="1711189">mantbits</span><span class="op" id="1711197">)</span><span class="op" id="1711198">)</span>&nbsp;<span class="op" id="1711200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1711204">//&nbsp;The&nbsp;number&nbsp;is&nbsp;already&nbsp;shortest.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1711241">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1711249">}</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1711253">//&nbsp;d&nbsp;=&nbsp;mant&nbsp;&lt;&lt;&nbsp;(exp&nbsp;-&nbsp;mantbits)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1711286">//&nbsp;Next&nbsp;highest&nbsp;floating&nbsp;point&nbsp;number&nbsp;is&nbsp;mant+1&nbsp;&lt;&lt;&nbsp;exp-mantbits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1711352">//&nbsp;Our&nbsp;upper&nbsp;bound&nbsp;is&nbsp;halfway&nbsp;between,&nbsp;mant*2+1&nbsp;&lt;&lt;&nbsp;exp-mantbits-1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1711420">upper</span>&nbsp;<span class="op" id="1711426">:=</span>&nbsp;<span class="builtinfunc" id="1711429">new</span><span class="op" id="1711432">(</span><span class="ident" id="1711433">decimal</span><span class="op" id="1711440">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1711443">upper</span><span class="op" id="1711448">.</span><span class="ident" id="1711449">Assign</span><span class="op" id="1711455">(</span><span class="ident" id="1711456">mant</span><span class="op" id="1711460">*</span><span class="num" id="1711461">2</span>&nbsp;<span class="op" id="1711463">+</span>&nbsp;<span class="num" id="1711465">1</span><span class="op" id="1711466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1711469">upper</span><span class="op" id="1711474">.</span><span class="ident" id="1711475">Shift</span><span class="op" id="1711480">(</span><span class="ident" id="1711481">exp</span>&nbsp;<span class="op" id="1711485">-</span>&nbsp;<span class="builtintype" id="1711487">int</span><span class="op" id="1711490">(</span><span class="ident" id="1711491">flt</span><span class="op" id="1711494">.</span><span class="ident" id="1711495">mantbits</span><span class="op" id="1711503">)</span>&nbsp;<span class="op" id="1711505">-</span>&nbsp;<span class="num" id="1711507">1</span><span class="op" id="1711508">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1711512">//&nbsp;d&nbsp;=&nbsp;mant&nbsp;&lt;&lt;&nbsp;(exp&nbsp;-&nbsp;mantbits)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1711545">//&nbsp;Next&nbsp;lowest&nbsp;floating&nbsp;point&nbsp;number&nbsp;is&nbsp;mant-1&nbsp;&lt;&lt;&nbsp;exp-mantbits,</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1711610">//&nbsp;unless&nbsp;mant-1&nbsp;drops&nbsp;the&nbsp;significant&nbsp;bit&nbsp;and&nbsp;exp&nbsp;is&nbsp;not&nbsp;the&nbsp;minimum&nbsp;exp,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1711686">//&nbsp;in&nbsp;which&nbsp;case&nbsp;the&nbsp;next&nbsp;lowest&nbsp;is&nbsp;mant*2-1&nbsp;&lt;&lt;&nbsp;exp-mantbits-1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1711751">//&nbsp;Either&nbsp;way,&nbsp;call&nbsp;it&nbsp;mantlo&nbsp;&lt;&lt;&nbsp;explo-mantbits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1711801">//&nbsp;Our&nbsp;lower&nbsp;bound&nbsp;is&nbsp;halfway&nbsp;between,&nbsp;mantlo*2+1&nbsp;&lt;&lt;&nbsp;explo-mantbits-1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1711873">var</span>&nbsp;<span class="ident" id="1711877">mantlo</span>&nbsp;<span class="ident" id="1711884">uint64</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1711892">var</span>&nbsp;<span class="ident" id="1711896">explo</span>&nbsp;<span class="builtintype" id="1711902">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1711907">if</span>&nbsp;<span class="ident" id="1711910">mant</span>&nbsp;<span class="op" id="1711915">&gt;</span>&nbsp;<span class="num" id="1711917">1</span><span class="op" id="1711918">&lt;&lt;</span><span class="ident" id="1711920">flt</span><span class="op" id="1711923">.</span><span class="ident" id="1711924">mantbits</span>&nbsp;<span class="op" id="1711933">||</span>&nbsp;<span class="ident" id="1711936">exp</span>&nbsp;<span class="op" id="1711940">==</span>&nbsp;<span class="ident" id="1711943">minexp</span>&nbsp;<span class="op" id="1711950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1711954">mantlo</span>&nbsp;<span class="op" id="1711961">=</span>&nbsp;<span class="ident" id="1711963">mant</span>&nbsp;<span class="op" id="1711968">-</span>&nbsp;<span class="num" id="1711970">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1711974">explo</span>&nbsp;<span class="op" id="1711980">=</span>&nbsp;<span class="ident" id="1711982">exp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1711987">}</span>&nbsp;<span class="keyword" id="1711989">else</span>&nbsp;<span class="op" id="1711994">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1711998">mantlo</span>&nbsp;<span class="op" id="1712005">=</span>&nbsp;<span class="ident" id="1712007">mant</span><span class="op" id="1712011">*</span><span class="num" id="1712012">2</span>&nbsp;<span class="op" id="1712014">-</span>&nbsp;<span class="num" id="1712016">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1712020">explo</span>&nbsp;<span class="op" id="1712026">=</span>&nbsp;<span class="ident" id="1712028">exp</span>&nbsp;<span class="op" id="1712032">-</span>&nbsp;<span class="num" id="1712034">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1712037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1712040">lower</span>&nbsp;<span class="op" id="1712046">:=</span>&nbsp;<span class="builtinfunc" id="1712049">new</span><span class="op" id="1712052">(</span><span class="ident" id="1712053">decimal</span><span class="op" id="1712060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1712063">lower</span><span class="op" id="1712068">.</span><span class="ident" id="1712069">Assign</span><span class="op" id="1712075">(</span><span class="ident" id="1712076">mantlo</span><span class="op" id="1712082">*</span><span class="num" id="1712083">2</span>&nbsp;<span class="op" id="1712085">+</span>&nbsp;<span class="num" id="1712087">1</span><span class="op" id="1712088">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1712091">lower</span><span class="op" id="1712096">.</span><span class="ident" id="1712097">Shift</span><span class="op" id="1712102">(</span><span class="ident" id="1712103">explo</span>&nbsp;<span class="op" id="1712109">-</span>&nbsp;<span class="builtintype" id="1712111">int</span><span class="op" id="1712114">(</span><span class="ident" id="1712115">flt</span><span class="op" id="1712118">.</span><span class="ident" id="1712119">mantbits</span><span class="op" id="1712127">)</span>&nbsp;<span class="op" id="1712129">-</span>&nbsp;<span class="num" id="1712131">1</span><span class="op" id="1712132">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1712136">//&nbsp;The&nbsp;upper&nbsp;and&nbsp;lower&nbsp;bounds&nbsp;are&nbsp;possible&nbsp;outputs&nbsp;only&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1712196">//&nbsp;the&nbsp;original&nbsp;mantissa&nbsp;is&nbsp;even,&nbsp;so&nbsp;that&nbsp;IEEE&nbsp;round-to-even</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1712258">//&nbsp;would&nbsp;round&nbsp;to&nbsp;the&nbsp;original&nbsp;mantissa&nbsp;and&nbsp;not&nbsp;the&nbsp;neighbors.</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1712322">inclusive</span>&nbsp;<span class="op" id="1712332">:=</span>&nbsp;<span class="ident" id="1712335">mant</span><span class="op" id="1712339">%</span><span class="num" id="1712340">2</span>&nbsp;<span class="op" id="1712342">==</span>&nbsp;<span class="num" id="1712345">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1712349">//&nbsp;Now&nbsp;we&nbsp;can&nbsp;figure&nbsp;out&nbsp;the&nbsp;minimum&nbsp;number&nbsp;of&nbsp;digits&nbsp;required.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1712414">//&nbsp;Walk&nbsp;along&nbsp;until&nbsp;d&nbsp;has&nbsp;distinguished&nbsp;itself&nbsp;from&nbsp;upper&nbsp;and&nbsp;lower.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1712484">for</span>&nbsp;<span class="ident" id="1712488">i</span>&nbsp;<span class="op" id="1712490">:=</span>&nbsp;<span class="num" id="1712493">0</span><span class="op" id="1712494">;</span>&nbsp;<span class="ident" id="1712496">i</span>&nbsp;<span class="op" id="1712498">&lt;</span>&nbsp;<span class="ident" id="1712500">d</span><span class="op" id="1712501">.</span><span class="ident" id="1712502">nd</span><span class="op" id="1712504">;</span>&nbsp;<span class="ident" id="1712506">i</span><span class="op" id="1712507">++</span>&nbsp;<span class="op" id="1712510">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1712514">var</span>&nbsp;<span class="ident" id="1712518">l</span><span class="op" id="1712519">,</span>&nbsp;<span class="ident" id="1712521">m</span><span class="op" id="1712522">,</span>&nbsp;<span class="ident" id="1712524">u</span>&nbsp;<span class="builtintype" id="1712526">byte</span>&nbsp;<span class="comment" id="1712531">//&nbsp;lower,&nbsp;middle,&nbsp;upper&nbsp;digits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1712564">if</span>&nbsp;<span class="ident" id="1712567">i</span>&nbsp;<span class="op" id="1712569">&lt;</span>&nbsp;<span class="ident" id="1712571">lower</span><span class="op" id="1712576">.</span><span class="ident" id="1712577">nd</span>&nbsp;<span class="op" id="1712580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1712585">l</span>&nbsp;<span class="op" id="1712587">=</span>&nbsp;<span class="ident" id="1712589">lower</span><span class="op" id="1712594">.</span><span class="ident" id="1712595">d</span><span class="op" id="1712596">[</span><span class="ident" id="1712597">i</span><span class="op" id="1712598">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1712602">}</span>&nbsp;<span class="keyword" id="1712604">else</span>&nbsp;<span class="op" id="1712609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1712614">l</span>&nbsp;<span class="op" id="1712616">=</span>&nbsp;<span class="string" id="1712618">&#39;0&#39;</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1712624">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1712628">m</span>&nbsp;<span class="op" id="1712630">=</span>&nbsp;<span class="ident" id="1712632">d</span><span class="op" id="1712633">.</span><span class="ident" id="1712634">d</span><span class="op" id="1712635">[</span><span class="ident" id="1712636">i</span><span class="op" id="1712637">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1712641">if</span>&nbsp;<span class="ident" id="1712644">i</span>&nbsp;<span class="op" id="1712646">&lt;</span>&nbsp;<span class="ident" id="1712648">upper</span><span class="op" id="1712653">.</span><span class="ident" id="1712654">nd</span>&nbsp;<span class="op" id="1712657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1712662">u</span>&nbsp;<span class="op" id="1712664">=</span>&nbsp;<span class="ident" id="1712666">upper</span><span class="op" id="1712671">.</span><span class="ident" id="1712672">d</span><span class="op" id="1712673">[</span><span class="ident" id="1712674">i</span><span class="op" id="1712675">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1712679">}</span>&nbsp;<span class="keyword" id="1712681">else</span>&nbsp;<span class="op" id="1712686">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1712691">u</span>&nbsp;<span class="op" id="1712693">=</span>&nbsp;<span class="string" id="1712695">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1712701">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1712706">//&nbsp;Okay&nbsp;to&nbsp;round&nbsp;down&nbsp;(truncate)&nbsp;if&nbsp;lower&nbsp;has&nbsp;a&nbsp;different&nbsp;digit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1712772">//&nbsp;or&nbsp;if&nbsp;lower&nbsp;is&nbsp;inclusive&nbsp;and&nbsp;is&nbsp;exactly&nbsp;the&nbsp;result&nbsp;of&nbsp;rounding&nbsp;down.</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1712846">okdown</span>&nbsp;<span class="op" id="1712853">:=</span>&nbsp;<span class="ident" id="1712856">l</span>&nbsp;<span class="op" id="1712858">!=</span>&nbsp;<span class="ident" id="1712861">m</span>&nbsp;<span class="op" id="1712863">||</span>&nbsp;<span class="op" id="1712866">(</span><span class="ident" id="1712867">inclusive</span>&nbsp;<span class="op" id="1712877">&amp;&amp;</span>&nbsp;<span class="ident" id="1712880">l</span>&nbsp;<span class="op" id="1712882">==</span>&nbsp;<span class="ident" id="1712885">m</span>&nbsp;<span class="op" id="1712887">&amp;&amp;</span>&nbsp;<span class="ident" id="1712890">i</span><span class="op" id="1712891">+</span><span class="num" id="1712892">1</span>&nbsp;<span class="op" id="1712894">==</span>&nbsp;<span class="ident" id="1712897">lower</span><span class="op" id="1712902">.</span><span class="ident" id="1712903">nd</span><span class="op" id="1712905">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1712910">//&nbsp;Okay&nbsp;to&nbsp;round&nbsp;up&nbsp;if&nbsp;upper&nbsp;has&nbsp;a&nbsp;different&nbsp;digit&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1712967">//&nbsp;either&nbsp;upper&nbsp;is&nbsp;inclusive&nbsp;or&nbsp;upper&nbsp;is&nbsp;bigger&nbsp;than&nbsp;the&nbsp;result&nbsp;of&nbsp;rounding&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1713049">okup</span>&nbsp;<span class="op" id="1713054">:=</span>&nbsp;<span class="ident" id="1713057">m</span>&nbsp;<span class="op" id="1713059">!=</span>&nbsp;<span class="ident" id="1713062">u</span>&nbsp;<span class="op" id="1713064">&amp;&amp;</span>&nbsp;<span class="op" id="1713067">(</span><span class="ident" id="1713068">inclusive</span>&nbsp;<span class="op" id="1713078">||</span>&nbsp;<span class="ident" id="1713081">m</span><span class="op" id="1713082">+</span><span class="num" id="1713083">1</span>&nbsp;<span class="op" id="1713085">&lt;</span>&nbsp;<span class="ident" id="1713087">u</span>&nbsp;<span class="op" id="1713089">||</span>&nbsp;<span class="ident" id="1713092">i</span><span class="op" id="1713093">+</span><span class="num" id="1713094">1</span>&nbsp;<span class="op" id="1713096">&lt;</span>&nbsp;<span class="ident" id="1713098">upper</span><span class="op" id="1713103">.</span><span class="ident" id="1713104">nd</span><span class="op" id="1713106">)</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1713111">//&nbsp;If&nbsp;it&#39;s&nbsp;okay&nbsp;to&nbsp;do&nbsp;either,&nbsp;then&nbsp;round&nbsp;to&nbsp;the&nbsp;nearest&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1713174">//&nbsp;If&nbsp;it&#39;s&nbsp;okay&nbsp;to&nbsp;do&nbsp;only&nbsp;one,&nbsp;do&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1713215">switch</span>&nbsp;<span class="op" id="1713222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1713226">case</span>&nbsp;<span class="ident" id="1713231">okdown</span>&nbsp;<span class="op" id="1713238">&amp;&amp;</span>&nbsp;<span class="ident" id="1713241">okup</span><span class="op" id="1713245">:</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1713250">d</span><span class="op" id="1713251">.</span><span class="ident" id="1713252">Round</span><span class="op" id="1713257">(</span><span class="ident" id="1713258">i</span>&nbsp;<span class="op" id="1713260">+</span>&nbsp;<span class="num" id="1713262">1</span><span class="op" id="1713263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1713268">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1713277">case</span>&nbsp;<span class="ident" id="1713282">okdown</span><span class="op" id="1713288">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1713293">d</span><span class="op" id="1713294">.</span><span class="ident" id="1713295">RoundDown</span><span class="op" id="1713304">(</span><span class="ident" id="1713305">i</span>&nbsp;<span class="op" id="1713307">+</span>&nbsp;<span class="num" id="1713309">1</span><span class="op" id="1713310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1713315">return</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1713324">case</span>&nbsp;<span class="ident" id="1713329">okup</span><span class="op" id="1713333">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1713338">d</span><span class="op" id="1713339">.</span><span class="ident" id="1713340">RoundUp</span><span class="op" id="1713347">(</span><span class="ident" id="1713348">i</span>&nbsp;<span class="op" id="1713350">+</span>&nbsp;<span class="num" id="1713352">1</span><span class="op" id="1713353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1713358">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1713367">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1713370">}</span><br>
<span class="lineno">325</span><span class="op" id="1713372">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1713375">type</span>&nbsp;<span class="ident" id="1713380">decimalSlice</span>&nbsp;<span class="keyword" id="1713393">struct</span>&nbsp;<span class="op" id="1713400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1713403">d</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1713410">[</span><span class="op" id="1713411">]</span><span class="builtintype" id="1713412">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1713418">nd</span><span class="op" id="1713420">,</span>&nbsp;<span class="ident" id="1713422">dp</span>&nbsp;<span class="builtintype" id="1713425">int</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1713430">neg</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1713437">bool</span><br>
<span class="lineno"></span><span class="op" id="1713442">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1713445">//&nbsp;%e:&nbsp;-d.ddddde±dd</span><br>
<span class="lineno"></span><span class="keyword" id="1713466">func</span>&nbsp;<span class="ident" id="1713471">fmtE</span><span class="op" id="1713475">(</span><span class="ident" id="1713476">dst</span>&nbsp;<span class="op" id="1713480">[</span><span class="op" id="1713481">]</span><span class="builtintype" id="1713482">byte</span><span class="op" id="1713486">,</span>&nbsp;<span class="ident" id="1713488">neg</span>&nbsp;<span class="builtintype" id="1713492">bool</span><span class="op" id="1713496">,</span>&nbsp;<span class="ident" id="1713498">d</span>&nbsp;<span class="ident" id="1713500">decimalSlice</span><span class="op" id="1713512">,</span>&nbsp;<span class="ident" id="1713514">prec</span>&nbsp;<span class="builtintype" id="1713519">int</span><span class="op" id="1713522">,</span>&nbsp;<span class="ident" id="1713524">fmt</span>&nbsp;<span class="builtintype" id="1713528">byte</span><span class="op" id="1713532">)</span>&nbsp;<span class="op" id="1713534">[</span><span class="op" id="1713535">]</span><span class="builtintype" id="1713536">byte</span>&nbsp;<span class="op" id="1713541">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1713544">//&nbsp;sign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1713553">if</span>&nbsp;<span class="ident" id="1713556">neg</span>&nbsp;<span class="op" id="1713560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1713564">dst</span>&nbsp;<span class="op" id="1713568">=</span>&nbsp;<span class="builtinfunc" id="1713570">append</span><span class="op" id="1713576">(</span><span class="ident" id="1713577">dst</span><span class="op" id="1713580">,</span>&nbsp;<span class="string" id="1713582">&#39;-&#39;</span><span class="op" id="1713585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1713588">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1713592">//&nbsp;first&nbsp;digit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1713608">ch</span>&nbsp;<span class="op" id="1713611">:=</span>&nbsp;<span class="builtintype" id="1713614">byte</span><span class="op" id="1713618">(</span><span class="string" id="1713619">&#39;0&#39;</span><span class="op" id="1713622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1713625">if</span>&nbsp;<span class="ident" id="1713628">d</span><span class="op" id="1713629">.</span><span class="ident" id="1713630">nd</span>&nbsp;<span class="op" id="1713633">!=</span>&nbsp;<span class="num" id="1713636">0</span>&nbsp;<span class="op" id="1713638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1713642">ch</span>&nbsp;<span class="op" id="1713645">=</span>&nbsp;<span class="ident" id="1713647">d</span><span class="op" id="1713648">.</span><span class="ident" id="1713649">d</span><span class="op" id="1713650">[</span><span class="num" id="1713651">0</span><span class="op" id="1713652">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1713655">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1713658">dst</span>&nbsp;<span class="op" id="1713662">=</span>&nbsp;<span class="builtinfunc" id="1713664">append</span><span class="op" id="1713670">(</span><span class="ident" id="1713671">dst</span><span class="op" id="1713674">,</span>&nbsp;<span class="ident" id="1713676">ch</span><span class="op" id="1713678">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1713682">//&nbsp;.moredigits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1713698">if</span>&nbsp;<span class="ident" id="1713701">prec</span>&nbsp;<span class="op" id="1713706">&gt;</span>&nbsp;<span class="num" id="1713708">0</span>&nbsp;<span class="op" id="1713710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1713714">dst</span>&nbsp;<span class="op" id="1713718">=</span>&nbsp;<span class="builtinfunc" id="1713720">append</span><span class="op" id="1713726">(</span><span class="ident" id="1713727">dst</span><span class="op" id="1713730">,</span>&nbsp;<span class="string" id="1713732">&#39;.&#39;</span><span class="op" id="1713735">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1713739">i</span>&nbsp;<span class="op" id="1713741">:=</span>&nbsp;<span class="num" id="1713744">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1713748">m</span>&nbsp;<span class="op" id="1713750">:=</span>&nbsp;<span class="ident" id="1713753">d</span><span class="op" id="1713754">.</span><span class="ident" id="1713755">nd</span>&nbsp;<span class="op" id="1713758">+</span>&nbsp;<span class="ident" id="1713760">prec</span>&nbsp;<span class="op" id="1713765">+</span>&nbsp;<span class="num" id="1713767">1</span>&nbsp;<span class="op" id="1713769">-</span>&nbsp;<span class="ident" id="1713771">max</span><span class="op" id="1713774">(</span><span class="ident" id="1713775">d</span><span class="op" id="1713776">.</span><span class="ident" id="1713777">nd</span><span class="op" id="1713779">,</span>&nbsp;<span class="ident" id="1713781">prec</span><span class="op" id="1713785">+</span><span class="num" id="1713786">1</span><span class="op" id="1713787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1713791">for</span>&nbsp;<span class="ident" id="1713795">i</span>&nbsp;<span class="op" id="1713797">&lt;</span>&nbsp;<span class="ident" id="1713799">m</span>&nbsp;<span class="op" id="1713801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1713806">dst</span>&nbsp;<span class="op" id="1713810">=</span>&nbsp;<span class="builtinfunc" id="1713812">append</span><span class="op" id="1713818">(</span><span class="ident" id="1713819">dst</span><span class="op" id="1713822">,</span>&nbsp;<span class="ident" id="1713824">d</span><span class="op" id="1713825">.</span><span class="ident" id="1713826">d</span><span class="op" id="1713827">[</span><span class="ident" id="1713828">i</span><span class="op" id="1713829">]</span><span class="op" id="1713830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1713835">i</span><span class="op" id="1713836">++</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1713841">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1713845">for</span>&nbsp;<span class="ident" id="1713849">i</span>&nbsp;<span class="op" id="1713851">&lt;=</span>&nbsp;<span class="ident" id="1713854">prec</span>&nbsp;<span class="op" id="1713859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1713864">dst</span>&nbsp;<span class="op" id="1713868">=</span>&nbsp;<span class="builtinfunc" id="1713870">append</span><span class="op" id="1713876">(</span><span class="ident" id="1713877">dst</span><span class="op" id="1713880">,</span>&nbsp;<span class="string" id="1713882">&#39;0&#39;</span><span class="op" id="1713885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1713890">i</span><span class="op" id="1713891">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1713896">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1713899">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1713903">//&nbsp;e±</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1713911">dst</span>&nbsp;<span class="op" id="1713915">=</span>&nbsp;<span class="builtinfunc" id="1713917">append</span><span class="op" id="1713923">(</span><span class="ident" id="1713924">dst</span><span class="op" id="1713927">,</span>&nbsp;<span class="ident" id="1713929">fmt</span><span class="op" id="1713932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1713935">exp</span>&nbsp;<span class="op" id="1713939">:=</span>&nbsp;<span class="ident" id="1713942">d</span><span class="op" id="1713943">.</span><span class="ident" id="1713944">dp</span>&nbsp;<span class="op" id="1713947">-</span>&nbsp;<span class="num" id="1713949">1</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1713952">if</span>&nbsp;<span class="ident" id="1713955">d</span><span class="op" id="1713956">.</span><span class="ident" id="1713957">nd</span>&nbsp;<span class="op" id="1713960">==</span>&nbsp;<span class="num" id="1713963">0</span>&nbsp;<span class="op" id="1713965">{</span>&nbsp;<span class="comment" id="1713967">//&nbsp;special&nbsp;case:&nbsp;0&nbsp;has&nbsp;exponent&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1714003">exp</span>&nbsp;<span class="op" id="1714007">=</span>&nbsp;<span class="num" id="1714009">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1714012">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1714015">if</span>&nbsp;<span class="ident" id="1714018">exp</span>&nbsp;<span class="op" id="1714022">&lt;</span>&nbsp;<span class="num" id="1714024">0</span>&nbsp;<span class="op" id="1714026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1714030">ch</span>&nbsp;<span class="op" id="1714033">=</span>&nbsp;<span class="string" id="1714035">&#39;-&#39;</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1714041">exp</span>&nbsp;<span class="op" id="1714045">=</span>&nbsp;<span class="op" id="1714047">-</span><span class="ident" id="1714048">exp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1714053">}</span>&nbsp;<span class="keyword" id="1714055">else</span>&nbsp;<span class="op" id="1714060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1714064">ch</span>&nbsp;<span class="op" id="1714067">=</span>&nbsp;<span class="string" id="1714069">&#39;+&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1714074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1714077">dst</span>&nbsp;<span class="op" id="1714081">=</span>&nbsp;<span class="builtinfunc" id="1714083">append</span><span class="op" id="1714089">(</span><span class="ident" id="1714090">dst</span><span class="op" id="1714093">,</span>&nbsp;<span class="ident" id="1714095">ch</span><span class="op" id="1714097">)</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1714101">//&nbsp;dddd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1714110">var</span>&nbsp;<span class="ident" id="1714114">buf</span>&nbsp;<span class="op" id="1714118">[</span><span class="num" id="1714119">3</span><span class="op" id="1714120">]</span><span class="builtintype" id="1714121">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1714127">i</span>&nbsp;<span class="op" id="1714129">:=</span>&nbsp;<span class="builtinfunc" id="1714132">len</span><span class="op" id="1714135">(</span><span class="ident" id="1714136">buf</span><span class="op" id="1714139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1714142">for</span>&nbsp;<span class="ident" id="1714146">exp</span>&nbsp;<span class="op" id="1714150">&gt;=</span>&nbsp;<span class="num" id="1714153">10</span>&nbsp;<span class="op" id="1714156">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1714160">i</span><span class="op" id="1714161">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1714166">buf</span><span class="op" id="1714169">[</span><span class="ident" id="1714170">i</span><span class="op" id="1714171">]</span>&nbsp;<span class="op" id="1714173">=</span>&nbsp;<span class="builtintype" id="1714175">byte</span><span class="op" id="1714179">(</span><span class="ident" id="1714180">exp</span><span class="op" id="1714183">%</span><span class="num" id="1714184">10</span>&nbsp;<span class="op" id="1714187">+</span>&nbsp;<span class="string" id="1714189">&#39;0&#39;</span><span class="op" id="1714192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1714196">exp</span>&nbsp;<span class="op" id="1714200">/=</span>&nbsp;<span class="num" id="1714203">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1714207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1714210">//&nbsp;exp&nbsp;&lt;&nbsp;10</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1714223">i</span><span class="op" id="1714224">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1714228">buf</span><span class="op" id="1714231">[</span><span class="ident" id="1714232">i</span><span class="op" id="1714233">]</span>&nbsp;<span class="op" id="1714235">=</span>&nbsp;<span class="builtintype" id="1714237">byte</span><span class="op" id="1714241">(</span><span class="ident" id="1714242">exp</span>&nbsp;<span class="op" id="1714246">+</span>&nbsp;<span class="string" id="1714248">&#39;0&#39;</span><span class="op" id="1714251">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1714255">switch</span>&nbsp;<span class="ident" id="1714262">i</span>&nbsp;<span class="op" id="1714264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1714267">case</span>&nbsp;<span class="num" id="1714272">0</span><span class="op" id="1714273">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1714277">dst</span>&nbsp;<span class="op" id="1714281">=</span>&nbsp;<span class="builtinfunc" id="1714283">append</span><span class="op" id="1714289">(</span><span class="ident" id="1714290">dst</span><span class="op" id="1714293">,</span>&nbsp;<span class="ident" id="1714295">buf</span><span class="op" id="1714298">[</span><span class="num" id="1714299">0</span><span class="op" id="1714300">]</span><span class="op" id="1714301">,</span>&nbsp;<span class="ident" id="1714303">buf</span><span class="op" id="1714306">[</span><span class="num" id="1714307">1</span><span class="op" id="1714308">]</span><span class="op" id="1714309">,</span>&nbsp;<span class="ident" id="1714311">buf</span><span class="op" id="1714314">[</span><span class="num" id="1714315">2</span><span class="op" id="1714316">]</span><span class="op" id="1714317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1714320">case</span>&nbsp;<span class="num" id="1714325">1</span><span class="op" id="1714326">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1714330">dst</span>&nbsp;<span class="op" id="1714334">=</span>&nbsp;<span class="builtinfunc" id="1714336">append</span><span class="op" id="1714342">(</span><span class="ident" id="1714343">dst</span><span class="op" id="1714346">,</span>&nbsp;<span class="ident" id="1714348">buf</span><span class="op" id="1714351">[</span><span class="num" id="1714352">1</span><span class="op" id="1714353">]</span><span class="op" id="1714354">,</span>&nbsp;<span class="ident" id="1714356">buf</span><span class="op" id="1714359">[</span><span class="num" id="1714360">2</span><span class="op" id="1714361">]</span><span class="op" id="1714362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1714365">case</span>&nbsp;<span class="num" id="1714370">2</span><span class="op" id="1714371">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1714375">//&nbsp;leading&nbsp;zeroes</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1714395">dst</span>&nbsp;<span class="op" id="1714399">=</span>&nbsp;<span class="builtinfunc" id="1714401">append</span><span class="op" id="1714407">(</span><span class="ident" id="1714408">dst</span><span class="op" id="1714411">,</span>&nbsp;<span class="string" id="1714413">&#39;0&#39;</span><span class="op" id="1714416">,</span>&nbsp;<span class="ident" id="1714418">buf</span><span class="op" id="1714421">[</span><span class="num" id="1714422">2</span><span class="op" id="1714423">]</span><span class="op" id="1714424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1714427">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1714430">return</span>&nbsp;<span class="ident" id="1714437">dst</span><br>
<span class="lineno"></span><span class="op" id="1714441">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span><span class="comment" id="1714444">//&nbsp;%f:&nbsp;-ddddddd.ddddd</span><br>
<span class="lineno"></span><span class="keyword" id="1714466">func</span>&nbsp;<span class="ident" id="1714471">fmtF</span><span class="op" id="1714475">(</span><span class="ident" id="1714476">dst</span>&nbsp;<span class="op" id="1714480">[</span><span class="op" id="1714481">]</span><span class="builtintype" id="1714482">byte</span><span class="op" id="1714486">,</span>&nbsp;<span class="ident" id="1714488">neg</span>&nbsp;<span class="builtintype" id="1714492">bool</span><span class="op" id="1714496">,</span>&nbsp;<span class="ident" id="1714498">d</span>&nbsp;<span class="ident" id="1714500">decimalSlice</span><span class="op" id="1714512">,</span>&nbsp;<span class="ident" id="1714514">prec</span>&nbsp;<span class="builtintype" id="1714519">int</span><span class="op" id="1714522">)</span>&nbsp;<span class="op" id="1714524">[</span><span class="op" id="1714525">]</span><span class="builtintype" id="1714526">byte</span>&nbsp;<span class="op" id="1714531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1714534">//&nbsp;sign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1714543">if</span>&nbsp;<span class="ident" id="1714546">neg</span>&nbsp;<span class="op" id="1714550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1714554">dst</span>&nbsp;<span class="op" id="1714558">=</span>&nbsp;<span class="builtinfunc" id="1714560">append</span><span class="op" id="1714566">(</span><span class="ident" id="1714567">dst</span><span class="op" id="1714570">,</span>&nbsp;<span class="string" id="1714572">&#39;-&#39;</span><span class="op" id="1714575">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1714578">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1714582">//&nbsp;integer,&nbsp;padded&nbsp;with&nbsp;zeros&nbsp;as&nbsp;needed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1714624">if</span>&nbsp;<span class="ident" id="1714627">d</span><span class="op" id="1714628">.</span><span class="ident" id="1714629">dp</span>&nbsp;<span class="op" id="1714632">&gt;</span>&nbsp;<span class="num" id="1714634">0</span>&nbsp;<span class="op" id="1714636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1714640">var</span>&nbsp;<span class="ident" id="1714644">i</span>&nbsp;<span class="builtintype" id="1714646">int</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1714652">for</span>&nbsp;<span class="ident" id="1714656">i</span>&nbsp;<span class="op" id="1714658">=</span>&nbsp;<span class="num" id="1714660">0</span><span class="op" id="1714661">;</span>&nbsp;<span class="ident" id="1714663">i</span>&nbsp;<span class="op" id="1714665">&lt;</span>&nbsp;<span class="ident" id="1714667">d</span><span class="op" id="1714668">.</span><span class="ident" id="1714669">dp</span>&nbsp;<span class="op" id="1714672">&amp;&amp;</span>&nbsp;<span class="ident" id="1714675">i</span>&nbsp;<span class="op" id="1714677">&lt;</span>&nbsp;<span class="ident" id="1714679">d</span><span class="op" id="1714680">.</span><span class="ident" id="1714681">nd</span><span class="op" id="1714683">;</span>&nbsp;<span class="ident" id="1714685">i</span><span class="op" id="1714686">++</span>&nbsp;<span class="op" id="1714689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1714694">dst</span>&nbsp;<span class="op" id="1714698">=</span>&nbsp;<span class="builtinfunc" id="1714700">append</span><span class="op" id="1714706">(</span><span class="ident" id="1714707">dst</span><span class="op" id="1714710">,</span>&nbsp;<span class="ident" id="1714712">d</span><span class="op" id="1714713">.</span><span class="ident" id="1714714">d</span><span class="op" id="1714715">[</span><span class="ident" id="1714716">i</span><span class="op" id="1714717">]</span><span class="op" id="1714718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1714722">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1714726">for</span>&nbsp;<span class="op" id="1714730">;</span>&nbsp;<span class="ident" id="1714732">i</span>&nbsp;<span class="op" id="1714734">&lt;</span>&nbsp;<span class="ident" id="1714736">d</span><span class="op" id="1714737">.</span><span class="ident" id="1714738">dp</span><span class="op" id="1714740">;</span>&nbsp;<span class="ident" id="1714742">i</span><span class="op" id="1714743">++</span>&nbsp;<span class="op" id="1714746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1714751">dst</span>&nbsp;<span class="op" id="1714755">=</span>&nbsp;<span class="builtinfunc" id="1714757">append</span><span class="op" id="1714763">(</span><span class="ident" id="1714764">dst</span><span class="op" id="1714767">,</span>&nbsp;<span class="string" id="1714769">&#39;0&#39;</span><span class="op" id="1714772">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1714776">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1714779">}</span>&nbsp;<span class="keyword" id="1714781">else</span>&nbsp;<span class="op" id="1714786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1714790">dst</span>&nbsp;<span class="op" id="1714794">=</span>&nbsp;<span class="builtinfunc" id="1714796">append</span><span class="op" id="1714802">(</span><span class="ident" id="1714803">dst</span><span class="op" id="1714806">,</span>&nbsp;<span class="string" id="1714808">&#39;0&#39;</span><span class="op" id="1714811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1714814">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1714818">//&nbsp;fraction</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1714831">if</span>&nbsp;<span class="ident" id="1714834">prec</span>&nbsp;<span class="op" id="1714839">&gt;</span>&nbsp;<span class="num" id="1714841">0</span>&nbsp;<span class="op" id="1714843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1714847">dst</span>&nbsp;<span class="op" id="1714851">=</span>&nbsp;<span class="builtinfunc" id="1714853">append</span><span class="op" id="1714859">(</span><span class="ident" id="1714860">dst</span><span class="op" id="1714863">,</span>&nbsp;<span class="string" id="1714865">&#39;.&#39;</span><span class="op" id="1714868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1714872">for</span>&nbsp;<span class="ident" id="1714876">i</span>&nbsp;<span class="op" id="1714878">:=</span>&nbsp;<span class="num" id="1714881">0</span><span class="op" id="1714882">;</span>&nbsp;<span class="ident" id="1714884">i</span>&nbsp;<span class="op" id="1714886">&lt;</span>&nbsp;<span class="ident" id="1714888">prec</span><span class="op" id="1714892">;</span>&nbsp;<span class="ident" id="1714894">i</span><span class="op" id="1714895">++</span>&nbsp;<span class="op" id="1714898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1714903">ch</span>&nbsp;<span class="op" id="1714906">:=</span>&nbsp;<span class="builtintype" id="1714909">byte</span><span class="op" id="1714913">(</span><span class="string" id="1714914">&#39;0&#39;</span><span class="op" id="1714917">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1714922">if</span>&nbsp;<span class="ident" id="1714925">j</span>&nbsp;<span class="op" id="1714927">:=</span>&nbsp;<span class="ident" id="1714930">d</span><span class="op" id="1714931">.</span><span class="ident" id="1714932">dp</span>&nbsp;<span class="op" id="1714935">+</span>&nbsp;<span class="ident" id="1714937">i</span><span class="op" id="1714938">;</span>&nbsp;<span class="num" id="1714940">0</span>&nbsp;<span class="op" id="1714942">&lt;=</span>&nbsp;<span class="ident" id="1714945">j</span>&nbsp;<span class="op" id="1714947">&amp;&amp;</span>&nbsp;<span class="ident" id="1714950">j</span>&nbsp;<span class="op" id="1714952">&lt;</span>&nbsp;<span class="ident" id="1714954">d</span><span class="op" id="1714955">.</span><span class="ident" id="1714956">nd</span>&nbsp;<span class="op" id="1714959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1714965">ch</span>&nbsp;<span class="op" id="1714968">=</span>&nbsp;<span class="ident" id="1714970">d</span><span class="op" id="1714971">.</span><span class="ident" id="1714972">d</span><span class="op" id="1714973">[</span><span class="ident" id="1714974">j</span><span class="op" id="1714975">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1714980">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1714985">dst</span>&nbsp;<span class="op" id="1714989">=</span>&nbsp;<span class="builtinfunc" id="1714991">append</span><span class="op" id="1714997">(</span><span class="ident" id="1714998">dst</span><span class="op" id="1715001">,</span>&nbsp;<span class="ident" id="1715003">ch</span><span class="op" id="1715005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1715009">}</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1715012">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1715016">return</span>&nbsp;<span class="ident" id="1715023">dst</span><br>
<span class="lineno"></span><span class="op" id="1715027">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span><span class="comment" id="1715030">//&nbsp;%b:&nbsp;-ddddddddp+ddd</span><br>
<span class="lineno"></span><span class="keyword" id="1715052">func</span>&nbsp;<span class="ident" id="1715057">fmtB</span><span class="op" id="1715061">(</span><span class="ident" id="1715062">dst</span>&nbsp;<span class="op" id="1715066">[</span><span class="op" id="1715067">]</span><span class="builtintype" id="1715068">byte</span><span class="op" id="1715072">,</span>&nbsp;<span class="ident" id="1715074">neg</span>&nbsp;<span class="builtintype" id="1715078">bool</span><span class="op" id="1715082">,</span>&nbsp;<span class="ident" id="1715084">mant</span>&nbsp;<span class="ident" id="1715089">uint64</span><span class="op" id="1715095">,</span>&nbsp;<span class="ident" id="1715097">exp</span>&nbsp;<span class="builtintype" id="1715101">int</span><span class="op" id="1715104">,</span>&nbsp;<span class="ident" id="1715106">flt</span>&nbsp;<span class="op" id="1715110">*</span><span class="ident" id="1715111">floatInfo</span><span class="op" id="1715120">)</span>&nbsp;<span class="op" id="1715122">[</span><span class="op" id="1715123">]</span><span class="builtintype" id="1715124">byte</span>&nbsp;<span class="op" id="1715129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1715132">var</span>&nbsp;<span class="ident" id="1715136">buf</span>&nbsp;<span class="op" id="1715140">[</span><span class="num" id="1715141">50</span><span class="op" id="1715143">]</span><span class="builtintype" id="1715144">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1715150">w</span>&nbsp;<span class="op" id="1715152">:=</span>&nbsp;<span class="builtinfunc" id="1715155">len</span><span class="op" id="1715158">(</span><span class="ident" id="1715159">buf</span><span class="op" id="1715162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1715165">exp</span>&nbsp;<span class="op" id="1715169">-=</span>&nbsp;<span class="builtintype" id="1715172">int</span><span class="op" id="1715175">(</span><span class="ident" id="1715176">flt</span><span class="op" id="1715179">.</span><span class="ident" id="1715180">mantbits</span><span class="op" id="1715188">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1715191">esign</span>&nbsp;<span class="op" id="1715197">:=</span>&nbsp;<span class="builtintype" id="1715200">byte</span><span class="op" id="1715204">(</span><span class="string" id="1715205">&#39;+&#39;</span><span class="op" id="1715208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1715211">if</span>&nbsp;<span class="ident" id="1715214">exp</span>&nbsp;<span class="op" id="1715218">&lt;</span>&nbsp;<span class="num" id="1715220">0</span>&nbsp;<span class="op" id="1715222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1715226">esign</span>&nbsp;<span class="op" id="1715232">=</span>&nbsp;<span class="string" id="1715234">&#39;-&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1715240">exp</span>&nbsp;<span class="op" id="1715244">=</span>&nbsp;<span class="op" id="1715246">-</span><span class="ident" id="1715247">exp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1715252">}</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1715255">n</span>&nbsp;<span class="op" id="1715257">:=</span>&nbsp;<span class="num" id="1715260">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1715263">for</span>&nbsp;<span class="ident" id="1715267">exp</span>&nbsp;<span class="op" id="1715271">&gt;</span>&nbsp;<span class="num" id="1715273">0</span>&nbsp;<span class="op" id="1715275">||</span>&nbsp;<span class="ident" id="1715278">n</span>&nbsp;<span class="op" id="1715280">&lt;</span>&nbsp;<span class="num" id="1715282">1</span>&nbsp;<span class="op" id="1715284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1715288">n</span><span class="op" id="1715289">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1715294">w</span><span class="op" id="1715295">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1715300">buf</span><span class="op" id="1715303">[</span><span class="ident" id="1715304">w</span><span class="op" id="1715305">]</span>&nbsp;<span class="op" id="1715307">=</span>&nbsp;<span class="builtintype" id="1715309">byte</span><span class="op" id="1715313">(</span><span class="ident" id="1715314">exp</span><span class="op" id="1715317">%</span><span class="num" id="1715318">10</span>&nbsp;<span class="op" id="1715321">+</span>&nbsp;<span class="string" id="1715323">&#39;0&#39;</span><span class="op" id="1715326">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1715330">exp</span>&nbsp;<span class="op" id="1715334">/=</span>&nbsp;<span class="num" id="1715337">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1715341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1715344">w</span><span class="op" id="1715345">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1715349">buf</span><span class="op" id="1715352">[</span><span class="ident" id="1715353">w</span><span class="op" id="1715354">]</span>&nbsp;<span class="op" id="1715356">=</span>&nbsp;<span class="ident" id="1715358">esign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1715365">w</span><span class="op" id="1715366">--</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1715370">buf</span><span class="op" id="1715373">[</span><span class="ident" id="1715374">w</span><span class="op" id="1715375">]</span>&nbsp;<span class="op" id="1715377">=</span>&nbsp;<span class="string" id="1715379">&#39;p&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1715384">n</span>&nbsp;<span class="op" id="1715386">=</span>&nbsp;<span class="num" id="1715388">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1715391">for</span>&nbsp;<span class="ident" id="1715395">mant</span>&nbsp;<span class="op" id="1715400">&gt;</span>&nbsp;<span class="num" id="1715402">0</span>&nbsp;<span class="op" id="1715404">||</span>&nbsp;<span class="ident" id="1715407">n</span>&nbsp;<span class="op" id="1715409">&lt;</span>&nbsp;<span class="num" id="1715411">1</span>&nbsp;<span class="op" id="1715413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1715417">n</span><span class="op" id="1715418">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1715423">w</span><span class="op" id="1715424">--</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1715429">buf</span><span class="op" id="1715432">[</span><span class="ident" id="1715433">w</span><span class="op" id="1715434">]</span>&nbsp;<span class="op" id="1715436">=</span>&nbsp;<span class="builtintype" id="1715438">byte</span><span class="op" id="1715442">(</span><span class="ident" id="1715443">mant</span><span class="op" id="1715447">%</span><span class="num" id="1715448">10</span>&nbsp;<span class="op" id="1715451">+</span>&nbsp;<span class="string" id="1715453">&#39;0&#39;</span><span class="op" id="1715456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1715460">mant</span>&nbsp;<span class="op" id="1715465">/=</span>&nbsp;<span class="num" id="1715468">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1715472">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1715475">if</span>&nbsp;<span class="ident" id="1715478">neg</span>&nbsp;<span class="op" id="1715482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1715486">w</span><span class="op" id="1715487">--</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1715492">buf</span><span class="op" id="1715495">[</span><span class="ident" id="1715496">w</span><span class="op" id="1715497">]</span>&nbsp;<span class="op" id="1715499">=</span>&nbsp;<span class="string" id="1715501">&#39;-&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1715506">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1715509">return</span>&nbsp;<span class="builtinfunc" id="1715516">append</span><span class="op" id="1715522">(</span><span class="ident" id="1715523">dst</span><span class="op" id="1715526">,</span>&nbsp;<span class="ident" id="1715528">buf</span><span class="op" id="1715531">[</span><span class="ident" id="1715532">w</span><span class="op" id="1715533">:</span><span class="op" id="1715534">]</span><span class="op" id="1715535">...</span><span class="op" id="1715538">)</span><br>
<span class="lineno"></span><span class="op" id="1715540">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">470</span><span class="keyword" id="1715543">func</span>&nbsp;<span class="ident" id="1715548">max</span><span class="op" id="1715551">(</span><span class="ident" id="1715552">a</span><span class="op" id="1715553">,</span>&nbsp;<span class="ident" id="1715555">b</span>&nbsp;<span class="builtintype" id="1715557">int</span><span class="op" id="1715560">)</span>&nbsp;<span class="builtintype" id="1715562">int</span>&nbsp;<span class="op" id="1715566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1715569">if</span>&nbsp;<span class="ident" id="1715572">a</span>&nbsp;<span class="op" id="1715574">&gt;</span>&nbsp;<span class="ident" id="1715576">b</span>&nbsp;<span class="op" id="1715578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1715582">return</span>&nbsp;<span class="ident" id="1715589">a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1715592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1715595">return</span>&nbsp;<span class="ident" id="1715602">b</span><br>
<span class="lineno">475</span><span class="op" id="1715604">}</span>
</div>
</body>
</html>
