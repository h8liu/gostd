<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>lonnie.io/e8vm/link8</h2>
<ul>
<li><a href="/gostd/lonnie.io/e8vm/link8/func.go.html">func.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/layout.go.html">layout.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/link.go.html">link.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/linker.go.html">linker.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/package.go.html">package.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/pkg_sym.go.html">pkg_sym.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/symbol.go.html">symbol.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/trace_used.go.html">trace_used.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/var.go.html">var.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/writer.go.html">writer.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="keyword" id="3677012">package</span>&nbsp;<span class="ident" id="3677020">link8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3677027">import</span>&nbsp;<span class="op" id="3677034">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3677037">&#34;path&#34;</span><br>
<span class="lineno">5</span><span class="op" id="3677044">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3677047">//&nbsp;Package&nbsp;is&nbsp;the&nbsp;compiling&nbsp;object&nbsp;of&nbsp;a&nbsp;package.&nbsp;It&nbsp;is&nbsp;the&nbsp;linking</span><br>
<span class="lineno"></span><span class="comment" id="3677114">//&nbsp;unit&nbsp;for&nbsp;programs.</span><br>
<span class="lineno"></span><span class="keyword" id="3677136">type</span>&nbsp;<span class="ident" id="3677141">Package</span>&nbsp;<span class="keyword" id="3677149">struct</span>&nbsp;<span class="op" id="3677156">{</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3677159">path</span>&nbsp;<span class="builtintype" id="3677164">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3677173">requires</span>&nbsp;<span class="op" id="3677182">[</span><span class="op" id="3677183">]</span><span class="op" id="3677184">*</span><span class="ident" id="3677185">Package</span>&nbsp;<span class="comment" id="3677193">//&nbsp;all&nbsp;the&nbsp;packages&nbsp;that&nbsp;requires&nbsp;for&nbsp;building</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3677241">symbols</span>&nbsp;&nbsp;<span class="op" id="3677250">[</span><span class="op" id="3677251">]</span><span class="op" id="3677252">*</span><span class="ident" id="3677253">Symbol</span>&nbsp;&nbsp;<span class="comment" id="3677261">//&nbsp;all&nbsp;the&nbsp;symbol&nbsp;objects</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3677289">symIndex</span>&nbsp;<span class="keyword" id="3677298">map</span><span class="op" id="3677301">[</span><span class="builtintype" id="3677302">string</span><span class="op" id="3677308">]</span><span class="builtintype" id="3677309">uint32</span>&nbsp;<span class="comment" id="3677316">//&nbsp;map&nbsp;from&nbsp;symbol&nbsp;names&nbsp;to&nbsp;index&nbsp;in&nbsp;symNames</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3677363">pkgIndex</span>&nbsp;<span class="keyword" id="3677372">map</span><span class="op" id="3677375">[</span><span class="builtintype" id="3677376">string</span><span class="op" id="3677382">]</span><span class="builtintype" id="3677383">uint32</span>&nbsp;<span class="comment" id="3677390">//&nbsp;map&nbsp;from&nbsp;package&nbsp;path&nbsp;to&nbsp;index&nbsp;in&nbsp;imports</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3677437">funcs</span>&nbsp;<span class="keyword" id="3677443">map</span><span class="op" id="3677446">[</span><span class="builtintype" id="3677447">uint32</span><span class="op" id="3677453">]</span><span class="op" id="3677454">*</span><span class="ident" id="3677455">Func</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3677461">vars</span>&nbsp;&nbsp;<span class="keyword" id="3677467">map</span><span class="op" id="3677470">[</span><span class="builtintype" id="3677471">uint32</span><span class="op" id="3677477">]</span><span class="op" id="3677478">*</span><span class="ident" id="3677479">Var</span><br>
<span class="lineno">20</span><span class="op" id="3677483">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3677486">//&nbsp;NewPackage&nbsp;creates&nbsp;a&nbsp;new&nbsp;package&nbsp;of&nbsp;path&nbsp;p.</span><br>
<span class="lineno"></span><span class="keyword" id="3677533">func</span>&nbsp;<span class="ident" id="3677538">NewPackage</span><span class="op" id="3677548">(</span><span class="ident" id="3677549">p</span>&nbsp;<span class="builtintype" id="3677551">string</span><span class="op" id="3677557">)</span>&nbsp;<span class="op" id="3677559">*</span><span class="ident" id="3677560">Package</span>&nbsp;<span class="op" id="3677568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3677571">ret</span>&nbsp;<span class="op" id="3677575">:=</span>&nbsp;<span class="builtinfunc" id="3677578">new</span><span class="op" id="3677581">(</span><span class="ident" id="3677582">Package</span><span class="op" id="3677589">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3677592">ret</span><span class="op" id="3677595">.</span><span class="ident" id="3677596">path</span>&nbsp;<span class="op" id="3677601">=</span>&nbsp;<span class="ident" id="3677603">p</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3677607">ret</span><span class="op" id="3677610">.</span><span class="ident" id="3677611">symIndex</span>&nbsp;<span class="op" id="3677620">=</span>&nbsp;<span class="builtinfunc" id="3677622">make</span><span class="op" id="3677626">(</span><span class="keyword" id="3677627">map</span><span class="op" id="3677630">[</span><span class="builtintype" id="3677631">string</span><span class="op" id="3677637">]</span><span class="builtintype" id="3677638">uint32</span><span class="op" id="3677644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3677647">ret</span><span class="op" id="3677650">.</span><span class="ident" id="3677651">pkgIndex</span>&nbsp;<span class="op" id="3677660">=</span>&nbsp;<span class="builtinfunc" id="3677662">make</span><span class="op" id="3677666">(</span><span class="keyword" id="3677667">map</span><span class="op" id="3677670">[</span><span class="builtintype" id="3677671">string</span><span class="op" id="3677677">]</span><span class="builtintype" id="3677678">uint32</span><span class="op" id="3677684">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3677688">ret</span><span class="op" id="3677691">.</span><span class="ident" id="3677692">funcs</span>&nbsp;<span class="op" id="3677698">=</span>&nbsp;<span class="builtinfunc" id="3677700">make</span><span class="op" id="3677704">(</span><span class="keyword" id="3677705">map</span><span class="op" id="3677708">[</span><span class="builtintype" id="3677709">uint32</span><span class="op" id="3677715">]</span><span class="op" id="3677716">*</span><span class="ident" id="3677717">Func</span><span class="op" id="3677721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3677724">ret</span><span class="op" id="3677727">.</span><span class="ident" id="3677728">vars</span>&nbsp;<span class="op" id="3677733">=</span>&nbsp;<span class="builtinfunc" id="3677735">make</span><span class="op" id="3677739">(</span><span class="keyword" id="3677740">map</span><span class="op" id="3677743">[</span><span class="builtintype" id="3677744">uint32</span><span class="op" id="3677750">]</span><span class="op" id="3677751">*</span><span class="ident" id="3677752">Var</span><span class="op" id="3677755">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3677759">index</span>&nbsp;<span class="op" id="3677765">:=</span>&nbsp;<span class="ident" id="3677768">ret</span><span class="op" id="3677771">.</span><span class="ident" id="3677772">Require</span><span class="op" id="3677779">(</span><span class="ident" id="3677780">ret</span><span class="op" id="3677783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3677786">if</span>&nbsp;<span class="ident" id="3677789">index</span>&nbsp;<span class="op" id="3677795">!=</span>&nbsp;<span class="num" id="3677798">0</span>&nbsp;<span class="op" id="3677800">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3677804">panic</span><span class="op" id="3677809">(</span><span class="string" id="3677810">&#34;bug&#34;</span><span class="op" id="3677815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3677818">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3677822">return</span>&nbsp;<span class="ident" id="3677829">ret</span><br>
<span class="lineno"></span><span class="op" id="3677833">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="3677836">//&nbsp;Name&nbsp;returns&nbsp;the&nbsp;package&#39;s&nbsp;default&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="3677880">func</span>&nbsp;<span class="op" id="3677885">(</span><span class="ident" id="3677886">p</span>&nbsp;<span class="op" id="3677888">*</span><span class="ident" id="3677889">Package</span><span class="op" id="3677896">)</span>&nbsp;<span class="ident" id="3677898">Name</span><span class="op" id="3677902">(</span><span class="op" id="3677903">)</span>&nbsp;<span class="builtintype" id="3677905">string</span>&nbsp;<span class="op" id="3677912">{</span>&nbsp;<span class="keyword" id="3677914">return</span>&nbsp;<span class="ident" id="3677921">path</span><span class="op" id="3677925">.</span><span class="ident" id="3677926">Base</span><span class="op" id="3677930">(</span><span class="ident" id="3677931">p</span><span class="op" id="3677932">.</span><span class="ident" id="3677933">path</span><span class="op" id="3677937">)</span>&nbsp;<span class="op" id="3677939">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3677942">//&nbsp;Path&nbsp;returns&nbsp;the&nbsp;package&#39;s&nbsp;path&nbsp;string.</span><br>
<span class="lineno">45</span><span class="keyword" id="3677985">func</span>&nbsp;<span class="op" id="3677990">(</span><span class="ident" id="3677991">p</span>&nbsp;<span class="op" id="3677993">*</span><span class="ident" id="3677994">Package</span><span class="op" id="3678001">)</span>&nbsp;<span class="ident" id="3678003">Path</span><span class="op" id="3678007">(</span><span class="op" id="3678008">)</span>&nbsp;<span class="builtintype" id="3678010">string</span>&nbsp;<span class="op" id="3678017">{</span>&nbsp;<span class="keyword" id="3678019">return</span>&nbsp;<span class="ident" id="3678026">p</span><span class="op" id="3678027">.</span><span class="ident" id="3678028">path</span>&nbsp;<span class="op" id="3678033">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3678036">//&nbsp;Require&nbsp;assigns&nbsp;a&nbsp;relative&nbsp;index&nbsp;for&nbsp;the&nbsp;required&nbsp;package.</span><br>
<span class="lineno"></span><span class="keyword" id="3678098">func</span>&nbsp;<span class="op" id="3678103">(</span><span class="ident" id="3678104">p</span>&nbsp;<span class="op" id="3678106">*</span><span class="ident" id="3678107">Package</span><span class="op" id="3678114">)</span>&nbsp;<span class="ident" id="3678116">Require</span><span class="op" id="3678123">(</span><span class="ident" id="3678124">req</span>&nbsp;<span class="op" id="3678128">*</span><span class="ident" id="3678129">Package</span><span class="op" id="3678136">)</span>&nbsp;<span class="builtintype" id="3678138">uint32</span>&nbsp;<span class="op" id="3678145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3678148">if</span>&nbsp;<span class="ident" id="3678151">index</span><span class="op" id="3678156">,</span>&nbsp;<span class="ident" id="3678158">found</span>&nbsp;<span class="op" id="3678164">:=</span>&nbsp;<span class="ident" id="3678167">p</span><span class="op" id="3678168">.</span><span class="ident" id="3678169">pkgIndex</span><span class="op" id="3678177">[</span><span class="ident" id="3678178">req</span><span class="op" id="3678181">.</span><span class="ident" id="3678182">path</span><span class="op" id="3678186">]</span><span class="op" id="3678187">;</span>&nbsp;<span class="ident" id="3678189">found</span>&nbsp;<span class="op" id="3678195">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3678199">return</span>&nbsp;<span class="ident" id="3678206">index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3678213">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3678217">index</span>&nbsp;<span class="op" id="3678223">:=</span>&nbsp;<span class="builtintype" id="3678226">uint32</span><span class="op" id="3678232">(</span><span class="builtinfunc" id="3678233">len</span><span class="op" id="3678236">(</span><span class="ident" id="3678237">p</span><span class="op" id="3678238">.</span><span class="ident" id="3678239">requires</span><span class="op" id="3678247">)</span><span class="op" id="3678248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3678251">p</span><span class="op" id="3678252">.</span><span class="ident" id="3678253">pkgIndex</span><span class="op" id="3678261">[</span><span class="ident" id="3678262">req</span><span class="op" id="3678265">.</span><span class="ident" id="3678266">path</span><span class="op" id="3678270">]</span>&nbsp;<span class="op" id="3678272">=</span>&nbsp;<span class="ident" id="3678274">index</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3678281">p</span><span class="op" id="3678282">.</span><span class="ident" id="3678283">requires</span>&nbsp;<span class="op" id="3678292">=</span>&nbsp;<span class="builtinfunc" id="3678294">append</span><span class="op" id="3678300">(</span><span class="ident" id="3678301">p</span><span class="op" id="3678302">.</span><span class="ident" id="3678303">requires</span><span class="op" id="3678311">,</span>&nbsp;<span class="ident" id="3678313">req</span><span class="op" id="3678316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3678319">return</span>&nbsp;<span class="ident" id="3678326">index</span><br>
<span class="lineno"></span><span class="op" id="3678332">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3678335">//&nbsp;PkgIndex&nbsp;returns&nbsp;the&nbsp;package&nbsp;imported&nbsp;and&nbsp;also&nbsp;its&nbsp;import</span><br>
<span class="lineno">60</span><span class="comment" id="3678396">//&nbsp;index.</span><br>
<span class="lineno"></span><span class="keyword" id="3678406">func</span>&nbsp;<span class="op" id="3678411">(</span><span class="ident" id="3678412">p</span>&nbsp;<span class="op" id="3678414">*</span><span class="ident" id="3678415">Package</span><span class="op" id="3678422">)</span>&nbsp;<span class="ident" id="3678424">PkgIndex</span><span class="op" id="3678432">(</span><span class="ident" id="3678433">name</span>&nbsp;<span class="builtintype" id="3678438">string</span><span class="op" id="3678444">)</span>&nbsp;<span class="op" id="3678446">(</span><span class="op" id="3678447">*</span><span class="ident" id="3678448">Package</span><span class="op" id="3678455">,</span>&nbsp;<span class="builtintype" id="3678457">uint32</span><span class="op" id="3678463">)</span>&nbsp;<span class="op" id="3678465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3678468">index</span><span class="op" id="3678473">,</span>&nbsp;<span class="ident" id="3678475">found</span>&nbsp;<span class="op" id="3678481">:=</span>&nbsp;<span class="ident" id="3678484">p</span><span class="op" id="3678485">.</span><span class="ident" id="3678486">pkgIndex</span><span class="op" id="3678494">[</span><span class="ident" id="3678495">name</span><span class="op" id="3678499">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3678502">if</span>&nbsp;<span class="op" id="3678505">!</span><span class="ident" id="3678506">found</span>&nbsp;<span class="op" id="3678512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3678516">return</span>&nbsp;<span class="ident" id="3678523">nil</span><span class="op" id="3678526">,</span>&nbsp;<span class="num" id="3678528">0</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3678531">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3678535">return</span>&nbsp;<span class="ident" id="3678542">p</span><span class="op" id="3678543">.</span><span class="ident" id="3678544">requires</span><span class="op" id="3678552">[</span><span class="ident" id="3678553">index</span><span class="op" id="3678558">]</span><span class="op" id="3678559">,</span>&nbsp;<span class="ident" id="3678561">index</span><br>
<span class="lineno"></span><span class="op" id="3678567">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="comment" id="3678570">//&nbsp;SymIndex&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;a&nbsp;symbol&nbsp;in&nbsp;the&nbsp;package.</span><br>
<span class="lineno"></span><span class="comment" id="3678628">//&nbsp;It&nbsp;panics&nbsp;when&nbsp;the&nbsp;symbol&nbsp;is&nbsp;not&nbsp;Declare()&#39;d&nbsp;yet.</span><br>
<span class="lineno"></span><span class="keyword" id="3678681">func</span>&nbsp;<span class="op" id="3678686">(</span><span class="ident" id="3678687">p</span>&nbsp;<span class="op" id="3678689">*</span><span class="ident" id="3678690">Package</span><span class="op" id="3678697">)</span>&nbsp;<span class="ident" id="3678699">SymIndex</span><span class="op" id="3678707">(</span><span class="ident" id="3678708">name</span>&nbsp;<span class="builtintype" id="3678713">string</span><span class="op" id="3678719">)</span>&nbsp;<span class="builtintype" id="3678721">uint32</span>&nbsp;<span class="op" id="3678728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3678731">ret</span><span class="op" id="3678734">,</span>&nbsp;<span class="ident" id="3678736">found</span>&nbsp;<span class="op" id="3678742">:=</span>&nbsp;<span class="ident" id="3678745">p</span><span class="op" id="3678746">.</span><span class="ident" id="3678747">symIndex</span><span class="op" id="3678755">[</span><span class="ident" id="3678756">name</span><span class="op" id="3678760">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3678763">if</span>&nbsp;<span class="op" id="3678766">!</span><span class="ident" id="3678767">found</span>&nbsp;<span class="op" id="3678773">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3678777">panic</span><span class="op" id="3678782">(</span><span class="string" id="3678783">&#34;not&nbsp;found&#34;</span><span class="op" id="3678794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3678797">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3678800">return</span>&nbsp;<span class="ident" id="3678807">ret</span><br>
<span class="lineno"></span><span class="op" id="3678811">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="3678814">//&nbsp;Declare&nbsp;declares&nbsp;a&nbsp;symbol&nbsp;and&nbsp;assigns&nbsp;a&nbsp;symbol&nbsp;index.</span><br>
<span class="lineno"></span><span class="keyword" id="3678871">func</span>&nbsp;<span class="op" id="3678876">(</span><span class="ident" id="3678877">p</span>&nbsp;<span class="op" id="3678879">*</span><span class="ident" id="3678880">Package</span><span class="op" id="3678887">)</span>&nbsp;<span class="ident" id="3678889">Declare</span><span class="op" id="3678896">(</span><span class="ident" id="3678897">s</span>&nbsp;<span class="op" id="3678899">*</span><span class="ident" id="3678900">Symbol</span><span class="op" id="3678906">)</span>&nbsp;<span class="builtintype" id="3678908">uint32</span>&nbsp;<span class="op" id="3678915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3678918">_</span><span class="op" id="3678919">,</span>&nbsp;<span class="ident" id="3678921">found</span>&nbsp;<span class="op" id="3678927">:=</span>&nbsp;<span class="ident" id="3678930">p</span><span class="op" id="3678931">.</span><span class="ident" id="3678932">symIndex</span><span class="op" id="3678940">[</span><span class="ident" id="3678941">s</span><span class="op" id="3678942">.</span><span class="ident" id="3678943">Name</span><span class="op" id="3678947">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3678950">if</span>&nbsp;<span class="ident" id="3678953">found</span>&nbsp;<span class="op" id="3678959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3678963">panic</span><span class="op" id="3678968">(</span><span class="string" id="3678969">&#34;redeclaring&#34;</span><span class="op" id="3678982">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3678985">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3678989">index</span>&nbsp;<span class="op" id="3678995">:=</span>&nbsp;<span class="builtintype" id="3678998">uint32</span><span class="op" id="3679004">(</span><span class="builtinfunc" id="3679005">len</span><span class="op" id="3679008">(</span><span class="ident" id="3679009">p</span><span class="op" id="3679010">.</span><span class="ident" id="3679011">symbols</span><span class="op" id="3679018">)</span><span class="op" id="3679019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3679022">p</span><span class="op" id="3679023">.</span><span class="ident" id="3679024">symIndex</span><span class="op" id="3679032">[</span><span class="ident" id="3679033">s</span><span class="op" id="3679034">.</span><span class="ident" id="3679035">Name</span><span class="op" id="3679039">]</span>&nbsp;<span class="op" id="3679041">=</span>&nbsp;<span class="ident" id="3679043">index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3679050">p</span><span class="op" id="3679051">.</span><span class="ident" id="3679052">symbols</span>&nbsp;<span class="op" id="3679060">=</span>&nbsp;<span class="builtinfunc" id="3679062">append</span><span class="op" id="3679068">(</span><span class="ident" id="3679069">p</span><span class="op" id="3679070">.</span><span class="ident" id="3679071">symbols</span><span class="op" id="3679078">,</span>&nbsp;<span class="ident" id="3679080">s</span><span class="op" id="3679081">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3679084">return</span>&nbsp;<span class="ident" id="3679091">index</span><br>
<span class="lineno"></span><span class="op" id="3679097">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3679100">//&nbsp;Query&nbsp;returns&nbsp;the&nbsp;symbol&nbsp;with&nbsp;the&nbsp;particular&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="3679154">func</span>&nbsp;<span class="op" id="3679159">(</span><span class="ident" id="3679160">p</span>&nbsp;<span class="op" id="3679162">*</span><span class="ident" id="3679163">Package</span><span class="op" id="3679170">)</span>&nbsp;<span class="ident" id="3679172">Query</span><span class="op" id="3679177">(</span><span class="ident" id="3679178">name</span>&nbsp;<span class="builtintype" id="3679183">string</span><span class="op" id="3679189">)</span>&nbsp;<span class="op" id="3679191">(</span><span class="op" id="3679192">*</span><span class="ident" id="3679193">Symbol</span><span class="op" id="3679199">,</span>&nbsp;<span class="builtintype" id="3679201">uint32</span><span class="op" id="3679207">)</span>&nbsp;<span class="op" id="3679209">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3679212">index</span><span class="op" id="3679217">,</span>&nbsp;<span class="ident" id="3679219">found</span>&nbsp;<span class="op" id="3679225">:=</span>&nbsp;<span class="ident" id="3679228">p</span><span class="op" id="3679229">.</span><span class="ident" id="3679230">symIndex</span><span class="op" id="3679238">[</span><span class="ident" id="3679239">name</span><span class="op" id="3679243">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3679246">if</span>&nbsp;<span class="op" id="3679249">!</span><span class="ident" id="3679250">found</span>&nbsp;<span class="op" id="3679256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3679260">return</span>&nbsp;<span class="ident" id="3679267">nil</span><span class="op" id="3679270">,</span>&nbsp;<span class="num" id="3679272">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3679275">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3679279">return</span>&nbsp;<span class="ident" id="3679286">p</span><span class="op" id="3679287">.</span><span class="ident" id="3679288">symbols</span><span class="op" id="3679295">[</span><span class="ident" id="3679296">index</span><span class="op" id="3679301">]</span><span class="op" id="3679302">,</span>&nbsp;<span class="ident" id="3679304">index</span><br>
<span class="lineno"></span><span class="op" id="3679310">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3679313">//&nbsp;DefineFunc&nbsp;instantiates&nbsp;a&nbsp;function&nbsp;object&nbsp;for&nbsp;a&nbsp;particular&nbsp;index.</span><br>
<span class="lineno"></span><span class="keyword" id="3679382">func</span>&nbsp;<span class="op" id="3679387">(</span><span class="ident" id="3679388">p</span>&nbsp;<span class="op" id="3679390">*</span><span class="ident" id="3679391">Package</span><span class="op" id="3679398">)</span>&nbsp;<span class="ident" id="3679400">DefineFunc</span><span class="op" id="3679410">(</span><span class="ident" id="3679411">index</span>&nbsp;<span class="builtintype" id="3679417">uint32</span><span class="op" id="3679423">,</span>&nbsp;<span class="ident" id="3679425">f</span>&nbsp;<span class="op" id="3679427">*</span><span class="ident" id="3679428">Func</span><span class="op" id="3679432">)</span>&nbsp;<span class="op" id="3679434">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3679437">sym</span>&nbsp;<span class="op" id="3679441">:=</span>&nbsp;<span class="ident" id="3679444">p</span><span class="op" id="3679445">.</span><span class="ident" id="3679446">symbols</span><span class="op" id="3679453">[</span><span class="ident" id="3679454">index</span><span class="op" id="3679459">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3679462">if</span>&nbsp;<span class="ident" id="3679465">sym</span><span class="op" id="3679468">.</span><span class="ident" id="3679469">Type</span>&nbsp;<span class="op" id="3679474">!=</span>&nbsp;<span class="ident" id="3679477">SymFunc</span>&nbsp;<span class="op" id="3679485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3679489">panic</span><span class="op" id="3679494">(</span><span class="string" id="3679495">&#34;not&nbsp;a&nbsp;function&#34;</span><span class="op" id="3679511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3679514">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3679518">p</span><span class="op" id="3679519">.</span><span class="ident" id="3679520">funcs</span><span class="op" id="3679525">[</span><span class="ident" id="3679526">index</span><span class="op" id="3679531">]</span>&nbsp;<span class="op" id="3679533">=</span>&nbsp;<span class="ident" id="3679535">f</span><br>
<span class="lineno"></span><span class="op" id="3679537">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3679540">//&nbsp;DefineVar&nbsp;instantiates&nbsp;a&nbsp;variable&nbsp;object&nbsp;for&nbsp;a&nbsp;particular&nbsp;index.</span><br>
<span class="lineno"></span><span class="keyword" id="3679608">func</span>&nbsp;<span class="op" id="3679613">(</span><span class="ident" id="3679614">p</span>&nbsp;<span class="op" id="3679616">*</span><span class="ident" id="3679617">Package</span><span class="op" id="3679624">)</span>&nbsp;<span class="ident" id="3679626">DefineVar</span><span class="op" id="3679635">(</span><span class="ident" id="3679636">index</span>&nbsp;<span class="builtintype" id="3679642">uint32</span><span class="op" id="3679648">,</span>&nbsp;<span class="ident" id="3679650">v</span>&nbsp;<span class="op" id="3679652">*</span><span class="ident" id="3679653">Var</span><span class="op" id="3679656">)</span>&nbsp;<span class="op" id="3679658">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3679661">sym</span>&nbsp;<span class="op" id="3679665">:=</span>&nbsp;<span class="ident" id="3679668">p</span><span class="op" id="3679669">.</span><span class="ident" id="3679670">symbols</span><span class="op" id="3679677">[</span><span class="ident" id="3679678">index</span><span class="op" id="3679683">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3679686">if</span>&nbsp;<span class="ident" id="3679689">sym</span><span class="op" id="3679692">.</span><span class="ident" id="3679693">Type</span>&nbsp;<span class="op" id="3679698">!=</span>&nbsp;<span class="ident" id="3679701">SymVar</span>&nbsp;<span class="op" id="3679708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3679712">panic</span><span class="op" id="3679717">(</span><span class="string" id="3679718">&#34;not&nbsp;a&nbsp;var&#34;</span><span class="op" id="3679729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3679732">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3679736">p</span><span class="op" id="3679737">.</span><span class="ident" id="3679738">vars</span><span class="op" id="3679742">[</span><span class="ident" id="3679743">index</span><span class="op" id="3679748">]</span>&nbsp;<span class="op" id="3679750">=</span>&nbsp;<span class="ident" id="3679752">v</span><br>
<span class="lineno"></span><span class="op" id="3679754">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3679757">//&nbsp;Func&nbsp;returns&nbsp;the&nbsp;function&nbsp;of&nbsp;index.</span><br>
<span class="lineno"></span><span class="keyword" id="3679796">func</span>&nbsp;<span class="op" id="3679801">(</span><span class="ident" id="3679802">p</span>&nbsp;<span class="op" id="3679804">*</span><span class="ident" id="3679805">Package</span><span class="op" id="3679812">)</span>&nbsp;<span class="ident" id="3679814">Func</span><span class="op" id="3679818">(</span><span class="ident" id="3679819">index</span>&nbsp;<span class="builtintype" id="3679825">uint32</span><span class="op" id="3679831">)</span>&nbsp;<span class="op" id="3679833">*</span><span class="ident" id="3679834">Func</span>&nbsp;<span class="op" id="3679839">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3679842">ret</span><span class="op" id="3679845">,</span>&nbsp;<span class="ident" id="3679847">found</span>&nbsp;<span class="op" id="3679853">:=</span>&nbsp;<span class="ident" id="3679856">p</span><span class="op" id="3679857">.</span><span class="ident" id="3679858">funcs</span><span class="op" id="3679863">[</span><span class="ident" id="3679864">index</span><span class="op" id="3679869">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3679872">if</span>&nbsp;<span class="op" id="3679875">!</span><span class="ident" id="3679876">found</span>&nbsp;<span class="op" id="3679882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3679886">panic</span><span class="op" id="3679891">(</span><span class="string" id="3679892">&#34;not&nbsp;found&#34;</span><span class="op" id="3679903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3679906">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3679909">return</span>&nbsp;<span class="ident" id="3679916">ret</span><br>
<span class="lineno">130</span><span class="op" id="3679920">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3679923">//&nbsp;Var&nbsp;returns&nbsp;the&nbsp;variable&nbsp;of&nbsp;index.</span><br>
<span class="lineno"></span><span class="keyword" id="3679961">func</span>&nbsp;<span class="op" id="3679966">(</span><span class="ident" id="3679967">p</span>&nbsp;<span class="op" id="3679969">*</span><span class="ident" id="3679970">Package</span><span class="op" id="3679977">)</span>&nbsp;<span class="ident" id="3679979">Var</span><span class="op" id="3679982">(</span><span class="ident" id="3679983">index</span>&nbsp;<span class="builtintype" id="3679989">uint32</span><span class="op" id="3679995">)</span>&nbsp;<span class="op" id="3679997">*</span><span class="ident" id="3679998">Var</span>&nbsp;<span class="op" id="3680002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3680005">ret</span><span class="op" id="3680008">,</span>&nbsp;<span class="ident" id="3680010">found</span>&nbsp;<span class="op" id="3680016">:=</span>&nbsp;<span class="ident" id="3680019">p</span><span class="op" id="3680020">.</span><span class="ident" id="3680021">vars</span><span class="op" id="3680025">[</span><span class="ident" id="3680026">index</span><span class="op" id="3680031">]</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3680034">if</span>&nbsp;<span class="op" id="3680037">!</span><span class="ident" id="3680038">found</span>&nbsp;<span class="op" id="3680044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3680048">panic</span><span class="op" id="3680053">(</span><span class="string" id="3680054">&#34;not&nbsp;found&#34;</span><span class="op" id="3680065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3680068">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3680071">return</span>&nbsp;<span class="ident" id="3680078">ret</span><br>
<span class="lineno"></span><span class="op" id="3680082">}</span>
</div>
</body>
</html>
