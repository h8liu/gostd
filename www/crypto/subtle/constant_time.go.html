<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3858487">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3858542">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3858596">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3858647">//&nbsp;Package&nbsp;subtle&nbsp;implements&nbsp;functions&nbsp;that&nbsp;are&nbsp;often&nbsp;useful&nbsp;in&nbsp;cryptographic</span><br>
<span class="lineno"></span><span class="comment" id="3858725">//&nbsp;code&nbsp;but&nbsp;require&nbsp;careful&nbsp;thought&nbsp;to&nbsp;use&nbsp;correctly.</span><br>
<span class="lineno"></span><span class="keyword" id="3858779">package</span>&nbsp;<span class="ident" id="3858787">subtle</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3858795">//&nbsp;ConstantTimeCompare&nbsp;returns&nbsp;1&nbsp;iff&nbsp;the&nbsp;two&nbsp;slices,&nbsp;x</span><br>
<span class="lineno">10</span><span class="comment" id="3858850">//&nbsp;and&nbsp;y,&nbsp;have&nbsp;equal&nbsp;contents.&nbsp;The&nbsp;time&nbsp;taken&nbsp;is&nbsp;a&nbsp;function&nbsp;of&nbsp;the&nbsp;length&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3858927">//&nbsp;the&nbsp;slices&nbsp;and&nbsp;is&nbsp;independent&nbsp;of&nbsp;the&nbsp;contents.</span><br>
<span class="lineno"></span><span class="keyword" id="3858977">func</span>&nbsp;<span class="ident" id="3858982">ConstantTimeCompare</span><span class="op" id="3859001">(</span><span class="ident" id="3859002">x</span><span class="op" id="3859003">,</span>&nbsp;<span class="ident" id="3859005">y</span>&nbsp;<span class="op" id="3859007">[</span><span class="op" id="3859008">]</span><span class="builtintype" id="3859009">byte</span><span class="op" id="3859013">)</span>&nbsp;<span class="builtintype" id="3859015">int</span>&nbsp;<span class="op" id="3859019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3859022">if</span>&nbsp;<span class="builtinfunc" id="3859025">len</span><span class="op" id="3859028">(</span><span class="ident" id="3859029">x</span><span class="op" id="3859030">)</span>&nbsp;<span class="op" id="3859032">!=</span>&nbsp;<span class="builtinfunc" id="3859035">len</span><span class="op" id="3859038">(</span><span class="ident" id="3859039">y</span><span class="op" id="3859040">)</span>&nbsp;<span class="op" id="3859042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3859046">return</span>&nbsp;<span class="num" id="3859053">0</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3859056">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3859060">var</span>&nbsp;<span class="ident" id="3859064">v</span>&nbsp;<span class="builtintype" id="3859066">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3859073">for</span>&nbsp;<span class="ident" id="3859077">i</span>&nbsp;<span class="op" id="3859079">:=</span>&nbsp;<span class="num" id="3859082">0</span><span class="op" id="3859083">;</span>&nbsp;<span class="ident" id="3859085">i</span>&nbsp;<span class="op" id="3859087">&lt;</span>&nbsp;<span class="builtinfunc" id="3859089">len</span><span class="op" id="3859092">(</span><span class="ident" id="3859093">x</span><span class="op" id="3859094">)</span><span class="op" id="3859095">;</span>&nbsp;<span class="ident" id="3859097">i</span><span class="op" id="3859098">++</span>&nbsp;<span class="op" id="3859101">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3859105">v</span>&nbsp;<span class="op" id="3859107">|=</span>&nbsp;<span class="ident" id="3859110">x</span><span class="op" id="3859111">[</span><span class="ident" id="3859112">i</span><span class="op" id="3859113">]</span>&nbsp;<span class="op" id="3859115">^</span>&nbsp;<span class="ident" id="3859117">y</span><span class="op" id="3859118">[</span><span class="ident" id="3859119">i</span><span class="op" id="3859120">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3859123">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3859127">return</span>&nbsp;<span class="ident" id="3859134">ConstantTimeByteEq</span><span class="op" id="3859152">(</span><span class="ident" id="3859153">v</span><span class="op" id="3859154">,</span>&nbsp;<span class="num" id="3859156">0</span><span class="op" id="3859157">)</span><br>
<span class="lineno"></span><span class="op" id="3859159">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="3859162">//&nbsp;ConstantTimeSelect&nbsp;returns&nbsp;x&nbsp;if&nbsp;v&nbsp;is&nbsp;1&nbsp;and&nbsp;y&nbsp;if&nbsp;v&nbsp;is&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="3859221">//&nbsp;Its&nbsp;behavior&nbsp;is&nbsp;undefined&nbsp;if&nbsp;v&nbsp;takes&nbsp;any&nbsp;other&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="3859278">func</span>&nbsp;<span class="ident" id="3859283">ConstantTimeSelect</span><span class="op" id="3859301">(</span><span class="ident" id="3859302">v</span><span class="op" id="3859303">,</span>&nbsp;<span class="ident" id="3859305">x</span><span class="op" id="3859306">,</span>&nbsp;<span class="ident" id="3859308">y</span>&nbsp;<span class="builtintype" id="3859310">int</span><span class="op" id="3859313">)</span>&nbsp;<span class="builtintype" id="3859315">int</span>&nbsp;<span class="op" id="3859319">{</span>&nbsp;<span class="keyword" id="3859321">return</span>&nbsp;<span class="op" id="3859328">^</span><span class="op" id="3859329">(</span><span class="ident" id="3859330">v</span><span class="op" id="3859331">-</span><span class="num" id="3859332">1</span><span class="op" id="3859333">)</span><span class="op" id="3859334">&amp;</span><span class="ident" id="3859335">x</span>&nbsp;<span class="op" id="3859337">|</span>&nbsp;<span class="op" id="3859339">(</span><span class="ident" id="3859340">v</span><span class="op" id="3859341">-</span><span class="num" id="3859342">1</span><span class="op" id="3859343">)</span><span class="op" id="3859344">&amp;</span><span class="ident" id="3859345">y</span>&nbsp;<span class="op" id="3859347">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="3859350">//&nbsp;ConstantTimeByteEq&nbsp;returns&nbsp;1&nbsp;if&nbsp;x&nbsp;==&nbsp;y&nbsp;and&nbsp;0&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="keyword" id="3859409">func</span>&nbsp;<span class="ident" id="3859414">ConstantTimeByteEq</span><span class="op" id="3859432">(</span><span class="ident" id="3859433">x</span><span class="op" id="3859434">,</span>&nbsp;<span class="ident" id="3859436">y</span>&nbsp;<span class="builtintype" id="3859438">uint8</span><span class="op" id="3859443">)</span>&nbsp;<span class="builtintype" id="3859445">int</span>&nbsp;<span class="op" id="3859449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3859452">z</span>&nbsp;<span class="op" id="3859454">:=</span>&nbsp;<span class="op" id="3859457">^</span><span class="op" id="3859458">(</span><span class="ident" id="3859459">x</span>&nbsp;<span class="op" id="3859461">^</span>&nbsp;<span class="ident" id="3859463">y</span><span class="op" id="3859464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3859467">z</span>&nbsp;<span class="op" id="3859469">&amp;=</span>&nbsp;<span class="ident" id="3859472">z</span>&nbsp;<span class="op" id="3859474">&gt;&gt;</span>&nbsp;<span class="num" id="3859477">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3859480">z</span>&nbsp;<span class="op" id="3859482">&amp;=</span>&nbsp;<span class="ident" id="3859485">z</span>&nbsp;<span class="op" id="3859487">&gt;&gt;</span>&nbsp;<span class="num" id="3859490">2</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3859493">z</span>&nbsp;<span class="op" id="3859495">&amp;=</span>&nbsp;<span class="ident" id="3859498">z</span>&nbsp;<span class="op" id="3859500">&gt;&gt;</span>&nbsp;<span class="num" id="3859503">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3859507">return</span>&nbsp;<span class="builtintype" id="3859514">int</span><span class="op" id="3859517">(</span><span class="ident" id="3859518">z</span><span class="op" id="3859519">)</span><br>
<span class="lineno"></span><span class="op" id="3859521">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="3859524">//&nbsp;ConstantTimeEq&nbsp;returns&nbsp;1&nbsp;if&nbsp;x&nbsp;==&nbsp;y&nbsp;and&nbsp;0&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="keyword" id="3859579">func</span>&nbsp;<span class="ident" id="3859584">ConstantTimeEq</span><span class="op" id="3859598">(</span><span class="ident" id="3859599">x</span><span class="op" id="3859600">,</span>&nbsp;<span class="ident" id="3859602">y</span>&nbsp;<span class="builtintype" id="3859604">int32</span><span class="op" id="3859609">)</span>&nbsp;<span class="builtintype" id="3859611">int</span>&nbsp;<span class="op" id="3859615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3859618">z</span>&nbsp;<span class="op" id="3859620">:=</span>&nbsp;<span class="op" id="3859623">^</span><span class="op" id="3859624">(</span><span class="ident" id="3859625">x</span>&nbsp;<span class="op" id="3859627">^</span>&nbsp;<span class="ident" id="3859629">y</span><span class="op" id="3859630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3859633">z</span>&nbsp;<span class="op" id="3859635">&amp;=</span>&nbsp;<span class="ident" id="3859638">z</span>&nbsp;<span class="op" id="3859640">&gt;&gt;</span>&nbsp;<span class="num" id="3859643">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3859647">z</span>&nbsp;<span class="op" id="3859649">&amp;=</span>&nbsp;<span class="ident" id="3859652">z</span>&nbsp;<span class="op" id="3859654">&gt;&gt;</span>&nbsp;<span class="num" id="3859657">8</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3859660">z</span>&nbsp;<span class="op" id="3859662">&amp;=</span>&nbsp;<span class="ident" id="3859665">z</span>&nbsp;<span class="op" id="3859667">&gt;&gt;</span>&nbsp;<span class="num" id="3859670">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3859673">z</span>&nbsp;<span class="op" id="3859675">&amp;=</span>&nbsp;<span class="ident" id="3859678">z</span>&nbsp;<span class="op" id="3859680">&gt;&gt;</span>&nbsp;<span class="num" id="3859683">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3859686">z</span>&nbsp;<span class="op" id="3859688">&amp;=</span>&nbsp;<span class="ident" id="3859691">z</span>&nbsp;<span class="op" id="3859693">&gt;&gt;</span>&nbsp;<span class="num" id="3859696">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3859700">return</span>&nbsp;<span class="builtintype" id="3859707">int</span><span class="op" id="3859710">(</span><span class="ident" id="3859711">z</span>&nbsp;<span class="op" id="3859713">&amp;</span>&nbsp;<span class="num" id="3859715">1</span><span class="op" id="3859716">)</span><br>
<span class="lineno">50</span><span class="op" id="3859718">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3859721">//&nbsp;ConstantTimeCopy&nbsp;copies&nbsp;the&nbsp;contents&nbsp;of&nbsp;y&nbsp;into&nbsp;x&nbsp;(a&nbsp;slice&nbsp;of&nbsp;equal&nbsp;length)</span><br>
<span class="lineno"></span><span class="comment" id="3859799">//&nbsp;if&nbsp;v&nbsp;==&nbsp;1.&nbsp;If&nbsp;v&nbsp;==&nbsp;0,&nbsp;x&nbsp;is&nbsp;left&nbsp;unchanged.&nbsp;Its&nbsp;behavior&nbsp;is&nbsp;undefined&nbsp;if&nbsp;v</span><br>
<span class="lineno"></span><span class="comment" id="3859876">//&nbsp;takes&nbsp;any&nbsp;other&nbsp;value.</span><br>
<span class="lineno">55</span><span class="keyword" id="3859902">func</span>&nbsp;<span class="ident" id="3859907">ConstantTimeCopy</span><span class="op" id="3859923">(</span><span class="ident" id="3859924">v</span>&nbsp;<span class="builtintype" id="3859926">int</span><span class="op" id="3859929">,</span>&nbsp;<span class="ident" id="3859931">x</span><span class="op" id="3859932">,</span>&nbsp;<span class="ident" id="3859934">y</span>&nbsp;<span class="op" id="3859936">[</span><span class="op" id="3859937">]</span><span class="builtintype" id="3859938">byte</span><span class="op" id="3859942">)</span>&nbsp;<span class="op" id="3859944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3859947">if</span>&nbsp;<span class="builtinfunc" id="3859950">len</span><span class="op" id="3859953">(</span><span class="ident" id="3859954">x</span><span class="op" id="3859955">)</span>&nbsp;<span class="op" id="3859957">!=</span>&nbsp;<span class="builtinfunc" id="3859960">len</span><span class="op" id="3859963">(</span><span class="ident" id="3859964">y</span><span class="op" id="3859965">)</span>&nbsp;<span class="op" id="3859967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3859971">panic</span><span class="op" id="3859976">(</span><span class="string" id="3859977">&#34;subtle:&nbsp;slices&nbsp;have&nbsp;different&nbsp;lengths&#34;</span><span class="op" id="3860016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3860019">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3860023">xmask</span>&nbsp;<span class="op" id="3860029">:=</span>&nbsp;<span class="builtintype" id="3860032">byte</span><span class="op" id="3860036">(</span><span class="ident" id="3860037">v</span>&nbsp;<span class="op" id="3860039">-</span>&nbsp;<span class="num" id="3860041">1</span><span class="op" id="3860042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3860045">ymask</span>&nbsp;<span class="op" id="3860051">:=</span>&nbsp;<span class="builtintype" id="3860054">byte</span><span class="op" id="3860058">(</span><span class="op" id="3860059">^</span><span class="op" id="3860060">(</span><span class="ident" id="3860061">v</span>&nbsp;<span class="op" id="3860063">-</span>&nbsp;<span class="num" id="3860065">1</span><span class="op" id="3860066">)</span><span class="op" id="3860067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3860070">for</span>&nbsp;<span class="ident" id="3860074">i</span>&nbsp;<span class="op" id="3860076">:=</span>&nbsp;<span class="num" id="3860079">0</span><span class="op" id="3860080">;</span>&nbsp;<span class="ident" id="3860082">i</span>&nbsp;<span class="op" id="3860084">&lt;</span>&nbsp;<span class="builtinfunc" id="3860086">len</span><span class="op" id="3860089">(</span><span class="ident" id="3860090">x</span><span class="op" id="3860091">)</span><span class="op" id="3860092">;</span>&nbsp;<span class="ident" id="3860094">i</span><span class="op" id="3860095">++</span>&nbsp;<span class="op" id="3860098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3860102">x</span><span class="op" id="3860103">[</span><span class="ident" id="3860104">i</span><span class="op" id="3860105">]</span>&nbsp;<span class="op" id="3860107">=</span>&nbsp;<span class="ident" id="3860109">x</span><span class="op" id="3860110">[</span><span class="ident" id="3860111">i</span><span class="op" id="3860112">]</span><span class="op" id="3860113">&amp;</span><span class="ident" id="3860114">xmask</span>&nbsp;<span class="op" id="3860120">|</span>&nbsp;<span class="ident" id="3860122">y</span><span class="op" id="3860123">[</span><span class="ident" id="3860124">i</span><span class="op" id="3860125">]</span><span class="op" id="3860126">&amp;</span><span class="ident" id="3860127">ymask</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3860134">}</span><br>
<span class="lineno">65</span><span class="op" id="3860136">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3860139">//&nbsp;ConstantTimeLessOrEq&nbsp;returns&nbsp;1&nbsp;if&nbsp;x&nbsp;&lt;=&nbsp;y&nbsp;and&nbsp;0&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="3860200">//&nbsp;Its&nbsp;behavior&nbsp;is&nbsp;undefined&nbsp;if&nbsp;x&nbsp;or&nbsp;y&nbsp;are&nbsp;negative&nbsp;or&nbsp;&gt;&nbsp;2**31&nbsp;-&nbsp;1.</span><br>
<span class="lineno"></span><span class="keyword" id="3860268">func</span>&nbsp;<span class="ident" id="3860273">ConstantTimeLessOrEq</span><span class="op" id="3860293">(</span><span class="ident" id="3860294">x</span><span class="op" id="3860295">,</span>&nbsp;<span class="ident" id="3860297">y</span>&nbsp;<span class="builtintype" id="3860299">int</span><span class="op" id="3860302">)</span>&nbsp;<span class="builtintype" id="3860304">int</span>&nbsp;<span class="op" id="3860308">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3860311">x32</span>&nbsp;<span class="op" id="3860315">:=</span>&nbsp;<span class="builtintype" id="3860318">int32</span><span class="op" id="3860323">(</span><span class="ident" id="3860324">x</span><span class="op" id="3860325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3860328">y32</span>&nbsp;<span class="op" id="3860332">:=</span>&nbsp;<span class="builtintype" id="3860335">int32</span><span class="op" id="3860340">(</span><span class="ident" id="3860341">y</span><span class="op" id="3860342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3860345">return</span>&nbsp;<span class="builtintype" id="3860352">int</span><span class="op" id="3860355">(</span><span class="op" id="3860356">(</span><span class="op" id="3860357">(</span><span class="ident" id="3860358">x32</span>&nbsp;<span class="op" id="3860362">-</span>&nbsp;<span class="ident" id="3860364">y32</span>&nbsp;<span class="op" id="3860368">-</span>&nbsp;<span class="num" id="3860370">1</span><span class="op" id="3860371">)</span>&nbsp;<span class="op" id="3860373">&gt;&gt;</span>&nbsp;<span class="num" id="3860376">31</span><span class="op" id="3860378">)</span>&nbsp;<span class="op" id="3860380">&amp;</span>&nbsp;<span class="num" id="3860382">1</span><span class="op" id="3860383">)</span><br>
<span class="lineno"></span><span class="op" id="3860385">}</span>
</div>
</body>
</html>
