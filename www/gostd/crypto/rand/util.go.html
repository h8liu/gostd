<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/rand</h2>
<ul>
<li><a href="/gostd/crypto/rand/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/rand/rand.go.html">rand.go</a></li>
<li><a href="/gostd/crypto/rand/rand_linux.go.html">rand_linux.go</a></li>
<li><a href="/gostd/crypto/rand/rand_test.go.html">rand_test.go</a></li>
<li><a href="/gostd/crypto/rand/rand_unix.go.html">rand_unix.go</a></li>
<li><a href="/gostd/crypto/rand/util.go.html" class="current">util.go</a></li>
<li><a href="/gostd/crypto/rand/util_test.go.html">util_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4360344">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4360400">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4360454">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4360505">package</span>&nbsp;<span class="ident" id="4360513">rand</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4360519">import</span>&nbsp;<span class="op" id="4360526">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4360529">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4360539">&#34;io&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4360545">&#34;math/big&#34;</span><br>
<span class="lineno"></span><span class="op" id="4360556">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4360559">//&nbsp;smallPrimes&nbsp;is&nbsp;a&nbsp;list&nbsp;of&nbsp;small,&nbsp;prime&nbsp;numbers&nbsp;that&nbsp;allows&nbsp;us&nbsp;to&nbsp;rapidly</span><br>
<span class="lineno"></span><span class="comment" id="4360634">//&nbsp;exclude&nbsp;some&nbsp;fraction&nbsp;of&nbsp;composite&nbsp;candidates&nbsp;when&nbsp;searching&nbsp;for&nbsp;a&nbsp;random</span><br>
<span class="lineno">15</span><span class="comment" id="4360711">//&nbsp;prime.&nbsp;This&nbsp;list&nbsp;is&nbsp;truncated&nbsp;at&nbsp;the&nbsp;point&nbsp;where&nbsp;smallPrimesProduct&nbsp;exceeds</span><br>
<span class="lineno"></span><span class="comment" id="4360790">//&nbsp;a&nbsp;uint64.&nbsp;It&nbsp;does&nbsp;not&nbsp;include&nbsp;two&nbsp;because&nbsp;we&nbsp;ensure&nbsp;that&nbsp;the&nbsp;candidates&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="4360869">//&nbsp;odd&nbsp;by&nbsp;construction.</span><br>
<span class="lineno"></span><span class="keyword" id="4360893">var</span>&nbsp;<span class="ident" id="4360897">smallPrimes</span>&nbsp;<span class="op" id="4360909">=</span>&nbsp;<span class="op" id="4360911">[</span><span class="op" id="4360912">]</span><span class="builtintype" id="4360913">uint8</span><span class="op" id="4360918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4360921">3</span><span class="op" id="4360922">,</span>&nbsp;<span class="num" id="4360924">5</span><span class="op" id="4360925">,</span>&nbsp;<span class="num" id="4360927">7</span><span class="op" id="4360928">,</span>&nbsp;<span class="num" id="4360930">11</span><span class="op" id="4360932">,</span>&nbsp;<span class="num" id="4360934">13</span><span class="op" id="4360936">,</span>&nbsp;<span class="num" id="4360938">17</span><span class="op" id="4360940">,</span>&nbsp;<span class="num" id="4360942">19</span><span class="op" id="4360944">,</span>&nbsp;<span class="num" id="4360946">23</span><span class="op" id="4360948">,</span>&nbsp;<span class="num" id="4360950">29</span><span class="op" id="4360952">,</span>&nbsp;<span class="num" id="4360954">31</span><span class="op" id="4360956">,</span>&nbsp;<span class="num" id="4360958">37</span><span class="op" id="4360960">,</span>&nbsp;<span class="num" id="4360962">41</span><span class="op" id="4360964">,</span>&nbsp;<span class="num" id="4360966">43</span><span class="op" id="4360968">,</span>&nbsp;<span class="num" id="4360970">47</span><span class="op" id="4360972">,</span>&nbsp;<span class="num" id="4360974">53</span><span class="op" id="4360976">,</span><br>
<span class="lineno">20</span><span class="op" id="4360978">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4360981">//&nbsp;smallPrimesProduct&nbsp;is&nbsp;the&nbsp;product&nbsp;of&nbsp;the&nbsp;values&nbsp;in&nbsp;smallPrimes&nbsp;and&nbsp;allows&nbsp;us</span><br>
<span class="lineno"></span><span class="comment" id="4361061">//&nbsp;to&nbsp;reduce&nbsp;a&nbsp;candidate&nbsp;prime&nbsp;by&nbsp;this&nbsp;number&nbsp;and&nbsp;then&nbsp;determine&nbsp;whether&nbsp;it&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="4361139">//&nbsp;coprime&nbsp;to&nbsp;all&nbsp;the&nbsp;elements&nbsp;of&nbsp;smallPrimes&nbsp;without&nbsp;further&nbsp;big.Int</span><br>
<span class="lineno">25</span><span class="comment" id="4361209">//&nbsp;operations.</span><br>
<span class="lineno"></span><span class="keyword" id="4361224">var</span>&nbsp;<span class="ident" id="4361228">smallPrimesProduct</span>&nbsp;<span class="op" id="4361247">=</span>&nbsp;<span class="builtinfunc" id="4361249">new</span><span class="op" id="4361252">(</span><span class="ident" id="4361253"><a href="/gostd/crypto/rand/util.go.html#4360545">big</a></span><span class="op" id="4361256">.</span><span class="ident" id="4361257"><a href="/gostd/math/big/int.go.html#2035985">Int</a></span><span class="op" id="4361260">)</span><span class="op" id="4361261">.</span><span class="ident" id="4361262"><a href="/gostd/math/big/int.go.html#2036515">SetUint64</a></span><span class="op" id="4361271">(</span><span class="num" id="4361272">16294579238595022365</span><span class="op" id="4361292">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4361295">//&nbsp;Prime&nbsp;returns&nbsp;a&nbsp;number,&nbsp;p,&nbsp;of&nbsp;the&nbsp;given&nbsp;size,&nbsp;such&nbsp;that&nbsp;p&nbsp;is&nbsp;prime</span><br>
<span class="lineno"></span><span class="comment" id="4361365">//&nbsp;with&nbsp;high&nbsp;probability.</span><br>
<span class="lineno">30</span><span class="comment" id="4361391">//&nbsp;Prime&nbsp;will&nbsp;return&nbsp;error&nbsp;for&nbsp;any&nbsp;error&nbsp;returned&nbsp;by&nbsp;rand.Read&nbsp;or&nbsp;if&nbsp;bits&nbsp;&lt;&nbsp;2.</span><br>
<span class="lineno"></span><span class="keyword" id="4361470">func</span>&nbsp;<span class="ident" id="4361475">Prime</span><span class="op" id="4361480">(</span><span class="ident" id="4361481">rand</span>&nbsp;<span class="ident" id="4361486"><a href="/gostd/crypto/rand/util.go.html#4360539">io</a></span><span class="op" id="4361488">.</span><span class="ident" id="4361489"><a href="/gostd/io/io.go.html#1421823">Reader</a></span><span class="op" id="4361495">,</span>&nbsp;<span class="ident" id="4361497">bits</span>&nbsp;<span class="builtintype" id="4361502">int</span><span class="op" id="4361505">)</span>&nbsp;<span class="op" id="4361507">(</span><span class="ident" id="4361508">p</span>&nbsp;<span class="op" id="4361510">*</span><span class="ident" id="4361511"><a href="/gostd/crypto/rand/util.go.html#4360545">big</a></span><span class="op" id="4361514">.</span><span class="ident" id="4361515"><a href="/gostd/math/big/int.go.html#2035985">Int</a></span><span class="op" id="4361518">,</span>&nbsp;<span class="ident" id="4361520">err</span>&nbsp;<span class="builtintype" id="4361524">error</span><span class="op" id="4361529">)</span>&nbsp;<span class="op" id="4361531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4361534">if</span>&nbsp;<span class="ident" id="4361537"><a href="/gostd/crypto/rand/util.go.html#4361497">bits</a></span>&nbsp;<span class="op" id="4361542">&lt;</span>&nbsp;<span class="num" id="4361544">2</span>&nbsp;<span class="op" id="4361546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4361550"><a href="/gostd/crypto/rand/util.go.html#4361520">err</a></span>&nbsp;<span class="op" id="4361554">=</span>&nbsp;<span class="ident" id="4361556"><a href="/gostd/crypto/rand/util.go.html#4360529">errors</a></span><span class="op" id="4361562">.</span><span class="ident" id="4361563"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4361566">(</span><span class="string" id="4361567">&#34;crypto/rand:&nbsp;prime&nbsp;size&nbsp;must&nbsp;be&nbsp;at&nbsp;least&nbsp;2-bit&#34;</span><span class="op" id="4361615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4361619">return</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4361627">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4361631">b</span>&nbsp;<span class="op" id="4361633">:=</span>&nbsp;<span class="builtintype" id="4361636">uint</span><span class="op" id="4361640">(</span><span class="ident" id="4361641"><a href="/gostd/crypto/rand/util.go.html#4361497">bits</a></span>&nbsp;<span class="op" id="4361646">%</span>&nbsp;<span class="num" id="4361648">8</span><span class="op" id="4361649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4361652">if</span>&nbsp;<span class="ident" id="4361655"><a href="/gostd/crypto/rand/util.go.html#4361631">b</a></span>&nbsp;<span class="op" id="4361657">==</span>&nbsp;<span class="num" id="4361660">0</span>&nbsp;<span class="op" id="4361662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4361666"><a href="/gostd/crypto/rand/util.go.html#4361631">b</a></span>&nbsp;<span class="op" id="4361668">=</span>&nbsp;<span class="num" id="4361670">8</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4361673">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4361677">bytes</span>&nbsp;<span class="op" id="4361683">:=</span>&nbsp;<span class="builtinfunc" id="4361686">make</span><span class="op" id="4361690">(</span><span class="op" id="4361691">[</span><span class="op" id="4361692">]</span><span class="builtintype" id="4361693">byte</span><span class="op" id="4361697">,</span>&nbsp;<span class="op" id="4361699">(</span><span class="ident" id="4361700"><a href="/gostd/crypto/rand/util.go.html#4361497">bits</a></span><span class="op" id="4361704">+</span><span class="num" id="4361705">7</span><span class="op" id="4361706">)</span><span class="op" id="4361707">/</span><span class="num" id="4361708">8</span><span class="op" id="4361709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4361712"><a href="/gostd/crypto/rand/util.go.html#4361508">p</a></span>&nbsp;<span class="op" id="4361714">=</span>&nbsp;<span class="builtinfunc" id="4361716">new</span><span class="op" id="4361719">(</span><span class="ident" id="4361720"><a href="/gostd/crypto/rand/util.go.html#4360545">big</a></span><span class="op" id="4361723">.</span><span class="ident" id="4361724"><a href="/gostd/math/big/int.go.html#2035985">Int</a></span><span class="op" id="4361727">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4361731">bigMod</span>&nbsp;<span class="op" id="4361738">:=</span>&nbsp;<span class="builtinfunc" id="4361741">new</span><span class="op" id="4361744">(</span><span class="ident" id="4361745"><a href="/gostd/crypto/rand/util.go.html#4360545">big</a></span><span class="op" id="4361748">.</span><span class="ident" id="4361749"><a href="/gostd/math/big/int.go.html#2035985">Int</a></span><span class="op" id="4361752">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4361756">for</span>&nbsp;<span class="op" id="4361760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4361764">_</span><span class="op" id="4361765">,</span>&nbsp;<span class="ident" id="4361767"><a href="/gostd/crypto/rand/util.go.html#4361520">err</a></span>&nbsp;<span class="op" id="4361771">=</span>&nbsp;<span class="ident" id="4361773"><a href="/gostd/crypto/rand/util.go.html#4360539">io</a></span><span class="op" id="4361775">.</span><span class="ident" id="4361776"><a href="/gostd/io/io.go.html#1429706">ReadFull</a></span><span class="op" id="4361784">(</span><span class="ident" id="4361785"><a href="/gostd/crypto/rand/util.go.html#4361481">rand</a></span><span class="op" id="4361789">,</span>&nbsp;<span class="ident" id="4361791"><a href="/gostd/crypto/rand/util.go.html#4361677">bytes</a></span><span class="op" id="4361796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4361800">if</span>&nbsp;<span class="ident" id="4361803"><a href="/gostd/crypto/rand/util.go.html#4361520">err</a></span>&nbsp;<span class="op" id="4361807">!=</span>&nbsp;<span class="builtintype" id="4361810">nil</span>&nbsp;<span class="op" id="4361814">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4361819">return</span>&nbsp;<span class="builtintype" id="4361826">nil</span><span class="op" id="4361829">,</span>&nbsp;<span class="ident" id="4361831"><a href="/gostd/crypto/rand/util.go.html#4361520">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4361837">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4361842">//&nbsp;Clear&nbsp;bits&nbsp;in&nbsp;the&nbsp;first&nbsp;byte&nbsp;to&nbsp;make&nbsp;sure&nbsp;the&nbsp;candidate&nbsp;has&nbsp;a&nbsp;size&nbsp;&lt;=&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4361923"><a href="/gostd/crypto/rand/util.go.html#4361677">bytes</a></span><span class="op" id="4361928">[</span><span class="num" id="4361929">0</span><span class="op" id="4361930">]</span>&nbsp;<span class="op" id="4361932">&amp;=</span>&nbsp;<span class="builtintype" id="4361935">uint8</span><span class="op" id="4361940">(</span><span class="builtintype" id="4361941">int</span><span class="op" id="4361944">(</span><span class="num" id="4361945">1</span><span class="op" id="4361946">&lt;&lt;</span><span class="ident" id="4361948"><a href="/gostd/crypto/rand/util.go.html#4361631">b</a></span><span class="op" id="4361949">)</span>&nbsp;<span class="op" id="4361951">-</span>&nbsp;<span class="num" id="4361953">1</span><span class="op" id="4361954">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4361958">//&nbsp;Don&#39;t&nbsp;let&nbsp;the&nbsp;value&nbsp;be&nbsp;too&nbsp;small,&nbsp;i.e,&nbsp;set&nbsp;the&nbsp;most&nbsp;significant&nbsp;two&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4362037">//&nbsp;Setting&nbsp;the&nbsp;top&nbsp;two&nbsp;bits,&nbsp;rather&nbsp;than&nbsp;just&nbsp;the&nbsp;top&nbsp;bit,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4362098">//&nbsp;means&nbsp;that&nbsp;when&nbsp;two&nbsp;of&nbsp;these&nbsp;values&nbsp;are&nbsp;multiplied&nbsp;together,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4362164">//&nbsp;the&nbsp;result&nbsp;isn&#39;t&nbsp;ever&nbsp;one&nbsp;bit&nbsp;short.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4362206">if</span>&nbsp;<span class="ident" id="4362209"><a href="/gostd/crypto/rand/util.go.html#4361631">b</a></span>&nbsp;<span class="op" id="4362211">&gt;=</span>&nbsp;<span class="num" id="4362214">2</span>&nbsp;<span class="op" id="4362216">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4362221"><a href="/gostd/crypto/rand/util.go.html#4361677">bytes</a></span><span class="op" id="4362226">[</span><span class="num" id="4362227">0</span><span class="op" id="4362228">]</span>&nbsp;<span class="op" id="4362230">|=</span>&nbsp;<span class="num" id="4362233">3</span>&nbsp;<span class="op" id="4362235">&lt;&lt;</span>&nbsp;<span class="op" id="4362238">(</span><span class="ident" id="4362239"><a href="/gostd/crypto/rand/util.go.html#4361631">b</a></span>&nbsp;<span class="op" id="4362241">-</span>&nbsp;<span class="num" id="4362243">2</span><span class="op" id="4362244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4362248">}</span>&nbsp;<span class="keyword" id="4362250">else</span>&nbsp;<span class="op" id="4362255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4362260">//&nbsp;Here&nbsp;b==1,&nbsp;because&nbsp;b&nbsp;cannot&nbsp;be&nbsp;zero.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4362303"><a href="/gostd/crypto/rand/util.go.html#4361677">bytes</a></span><span class="op" id="4362308">[</span><span class="num" id="4362309">0</span><span class="op" id="4362310">]</span>&nbsp;<span class="op" id="4362312">|=</span>&nbsp;<span class="num" id="4362315">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4362320">if</span>&nbsp;<span class="builtinfunc" id="4362323">len</span><span class="op" id="4362326">(</span><span class="ident" id="4362327"><a href="/gostd/crypto/rand/util.go.html#4361677">bytes</a></span><span class="op" id="4362332">)</span>&nbsp;<span class="op" id="4362334">&gt;</span>&nbsp;<span class="num" id="4362336">1</span>&nbsp;<span class="op" id="4362338">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4362344"><a href="/gostd/crypto/rand/util.go.html#4361677">bytes</a></span><span class="op" id="4362349">[</span><span class="num" id="4362350">1</span><span class="op" id="4362351">]</span>&nbsp;<span class="op" id="4362353">|=</span>&nbsp;<span class="num" id="4362356">0x80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4362364">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4362368">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4362372">//&nbsp;Make&nbsp;the&nbsp;value&nbsp;odd&nbsp;since&nbsp;an&nbsp;even&nbsp;number&nbsp;this&nbsp;large&nbsp;certainly&nbsp;isn&#39;t&nbsp;prime.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4362451"><a href="/gostd/crypto/rand/util.go.html#4361677">bytes</a></span><span class="op" id="4362456">[</span><span class="builtinfunc" id="4362457">len</span><span class="op" id="4362460">(</span><span class="ident" id="4362461"><a href="/gostd/crypto/rand/util.go.html#4361677">bytes</a></span><span class="op" id="4362466">)</span><span class="op" id="4362467">-</span><span class="num" id="4362468">1</span><span class="op" id="4362469">]</span>&nbsp;<span class="op" id="4362471">|=</span>&nbsp;<span class="num" id="4362474">1</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4362479"><a href="/gostd/crypto/rand/util.go.html#4361508">p</a></span><span class="op" id="4362480">.</span><span class="ident" id="4362481"><a href="/gostd/math/big/int.go.html#2050026">SetBytes</a></span><span class="op" id="4362489">(</span><span class="ident" id="4362490"><a href="/gostd/crypto/rand/util.go.html#4361677">bytes</a></span><span class="op" id="4362495">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4362500">//&nbsp;Calculate&nbsp;the&nbsp;value&nbsp;mod&nbsp;the&nbsp;product&nbsp;of&nbsp;smallPrimes.&nbsp;&nbsp;If&nbsp;it&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4362566">//&nbsp;a&nbsp;multiple&nbsp;of&nbsp;any&nbsp;of&nbsp;these&nbsp;primes&nbsp;we&nbsp;add&nbsp;two&nbsp;until&nbsp;it&nbsp;isn&#39;t.</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4362632">//&nbsp;The&nbsp;probability&nbsp;of&nbsp;overflowing&nbsp;is&nbsp;minimal&nbsp;and&nbsp;can&nbsp;be&nbsp;ignored</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4362698">//&nbsp;because&nbsp;we&nbsp;still&nbsp;perform&nbsp;Miller-Rabin&nbsp;tests&nbsp;on&nbsp;the&nbsp;result.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4362762"><a href="/gostd/crypto/rand/util.go.html#4361731">bigMod</a></span><span class="op" id="4362768">.</span><span class="ident" id="4362769"><a href="/gostd/math/big/int.go.html#2041761">Mod</a></span><span class="op" id="4362772">(</span><span class="ident" id="4362773"><a href="/gostd/crypto/rand/util.go.html#4361508">p</a></span><span class="op" id="4362774">,</span>&nbsp;<span class="ident" id="4362776"><a href="/gostd/crypto/rand/util.go.html#4361228">smallPrimesProduct</a></span><span class="op" id="4362794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4362798">mod</span>&nbsp;<span class="op" id="4362802">:=</span>&nbsp;<span class="ident" id="4362805"><a href="/gostd/crypto/rand/util.go.html#4361731">bigMod</a></span><span class="op" id="4362811">.</span><span class="ident" id="4362812"><a href="/gostd/math/big/int.go.html#2049050">Uint64</a></span><span class="op" id="4362818">(</span><span class="op" id="4362819">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4362823">NextDelta</span><span class="op" id="4362832">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4362836">for</span>&nbsp;<span class="ident" id="4362840">delta</span>&nbsp;<span class="op" id="4362846">:=</span>&nbsp;<span class="builtintype" id="4362849">uint64</span><span class="op" id="4362855">(</span><span class="num" id="4362856">0</span><span class="op" id="4362857">)</span><span class="op" id="4362858">;</span>&nbsp;<span class="ident" id="4362860"><a href="/gostd/crypto/rand/util.go.html#4362840">delta</a></span>&nbsp;<span class="op" id="4362866">&lt;</span>&nbsp;<span class="num" id="4362868">1</span><span class="op" id="4362869">&lt;&lt;</span><span class="num" id="4362871">20</span><span class="op" id="4362873">;</span>&nbsp;<span class="ident" id="4362875"><a href="/gostd/crypto/rand/util.go.html#4362840">delta</a></span>&nbsp;<span class="op" id="4362881">+=</span>&nbsp;<span class="num" id="4362884">2</span>&nbsp;<span class="op" id="4362886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4362891">m</span>&nbsp;<span class="op" id="4362893">:=</span>&nbsp;<span class="ident" id="4362896"><a href="/gostd/crypto/rand/util.go.html#4362798">mod</a></span>&nbsp;<span class="op" id="4362900">+</span>&nbsp;<span class="ident" id="4362902"><a href="/gostd/crypto/rand/util.go.html#4362840">delta</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4362911">for</span>&nbsp;<span class="ident" id="4362915">_</span><span class="op" id="4362916">,</span>&nbsp;<span class="ident" id="4362918">prime</span>&nbsp;<span class="op" id="4362924">:=</span>&nbsp;<span class="keyword" id="4362927">range</span>&nbsp;<span class="ident" id="4362933"><a href="/gostd/crypto/rand/util.go.html#4360897">smallPrimes</a></span>&nbsp;<span class="op" id="4362945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4362951">if</span>&nbsp;<span class="ident" id="4362954"><a href="/gostd/crypto/rand/util.go.html#4362891">m</a></span><span class="op" id="4362955">%</span><span class="builtintype" id="4362956">uint64</span><span class="op" id="4362962">(</span><span class="ident" id="4362963"><a href="/gostd/crypto/rand/util.go.html#4362918">prime</a></span><span class="op" id="4362968">)</span>&nbsp;<span class="op" id="4362970">==</span>&nbsp;<span class="num" id="4362973">0</span>&nbsp;<span class="op" id="4362975">&amp;&amp;</span>&nbsp;<span class="op" id="4362978">(</span><span class="ident" id="4362979"><a href="/gostd/crypto/rand/util.go.html#4361497">bits</a></span>&nbsp;<span class="op" id="4362984">&gt;</span>&nbsp;<span class="num" id="4362986">6</span>&nbsp;<span class="op" id="4362988">||</span>&nbsp;<span class="ident" id="4362991"><a href="/gostd/crypto/rand/util.go.html#4362891">m</a></span>&nbsp;<span class="op" id="4362993">!=</span>&nbsp;<span class="builtintype" id="4362996">uint64</span><span class="op" id="4363002">(</span><span class="ident" id="4363003"><a href="/gostd/crypto/rand/util.go.html#4362918">prime</a></span><span class="op" id="4363008">)</span><span class="op" id="4363009">)</span>&nbsp;<span class="op" id="4363011">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4363018">continue</span>&nbsp;<span class="ident" id="4363027"><a href="/gostd/crypto/rand/util.go.html#4362823">NextDelta</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4363041">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4363046">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4363052">if</span>&nbsp;<span class="ident" id="4363055"><a href="/gostd/crypto/rand/util.go.html#4362840">delta</a></span>&nbsp;<span class="op" id="4363061">&gt;</span>&nbsp;<span class="num" id="4363063">0</span>&nbsp;<span class="op" id="4363065">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4363071"><a href="/gostd/crypto/rand/util.go.html#4361731">bigMod</a></span><span class="op" id="4363077">.</span><span class="ident" id="4363078"><a href="/gostd/math/big/int.go.html#2036515">SetUint64</a></span><span class="op" id="4363087">(</span><span class="ident" id="4363088"><a href="/gostd/crypto/rand/util.go.html#4362840">delta</a></span><span class="op" id="4363093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4363099"><a href="/gostd/crypto/rand/util.go.html#4361508">p</a></span><span class="op" id="4363100">.</span><span class="ident" id="4363101"><a href="/gostd/math/big/int.go.html#2037987">Add</a></span><span class="op" id="4363104">(</span><span class="ident" id="4363105"><a href="/gostd/crypto/rand/util.go.html#4361508">p</a></span><span class="op" id="4363106">,</span>&nbsp;<span class="ident" id="4363108"><a href="/gostd/crypto/rand/util.go.html#4361731">bigMod</a></span><span class="op" id="4363114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4363119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4363124">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4363132">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4363137">//&nbsp;There&nbsp;is&nbsp;a&nbsp;tiny&nbsp;possibility&nbsp;that,&nbsp;by&nbsp;adding&nbsp;delta,&nbsp;we&nbsp;caused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4363203">//&nbsp;the&nbsp;number&nbsp;to&nbsp;be&nbsp;one&nbsp;bit&nbsp;too&nbsp;long.&nbsp;Thus&nbsp;we&nbsp;check&nbsp;BitLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4363264">//&nbsp;here.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4363275">if</span>&nbsp;<span class="ident" id="4363278"><a href="/gostd/crypto/rand/util.go.html#4361508">p</a></span><span class="op" id="4363279">.</span><span class="ident" id="4363280"><a href="/gostd/math/big/int.go.html#2053360">ProbablyPrime</a></span><span class="op" id="4363293">(</span><span class="num" id="4363294">20</span><span class="op" id="4363296">)</span>&nbsp;<span class="op" id="4363298">&amp;&amp;</span>&nbsp;<span class="ident" id="4363301"><a href="/gostd/crypto/rand/util.go.html#4361508">p</a></span><span class="op" id="4363302">.</span><span class="ident" id="4363303"><a href="/gostd/math/big/int.go.html#2050389">BitLen</a></span><span class="op" id="4363309">(</span><span class="op" id="4363310">)</span>&nbsp;<span class="op" id="4363312">==</span>&nbsp;<span class="ident" id="4363315"><a href="/gostd/crypto/rand/util.go.html#4361497">bits</a></span>&nbsp;<span class="op" id="4363320">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4363325">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4363334">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4363337">}</span><br>
<span class="lineno"></span><span class="op" id="4363339">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="4363342">//&nbsp;Int&nbsp;returns&nbsp;a&nbsp;uniform&nbsp;random&nbsp;value&nbsp;in&nbsp;[0,&nbsp;max).&nbsp;It&nbsp;panics&nbsp;if&nbsp;max&nbsp;&lt;=&nbsp;0.</span><br>
<span class="lineno"></span><span class="keyword" id="4363416">func</span>&nbsp;<span class="ident" id="4363421">Int</span><span class="op" id="4363424">(</span><span class="ident" id="4363425">rand</span>&nbsp;<span class="ident" id="4363430"><a href="/gostd/crypto/rand/util.go.html#4360539">io</a></span><span class="op" id="4363432">.</span><span class="ident" id="4363433"><a href="/gostd/io/io.go.html#1421823">Reader</a></span><span class="op" id="4363439">,</span>&nbsp;<span class="ident" id="4363441">max</span>&nbsp;<span class="op" id="4363445">*</span><span class="ident" id="4363446"><a href="/gostd/crypto/rand/util.go.html#4360545">big</a></span><span class="op" id="4363449">.</span><span class="ident" id="4363450"><a href="/gostd/math/big/int.go.html#2035985">Int</a></span><span class="op" id="4363453">)</span>&nbsp;<span class="op" id="4363455">(</span><span class="ident" id="4363456">n</span>&nbsp;<span class="op" id="4363458">*</span><span class="ident" id="4363459"><a href="/gostd/crypto/rand/util.go.html#4360545">big</a></span><span class="op" id="4363462">.</span><span class="ident" id="4363463"><a href="/gostd/math/big/int.go.html#2035985">Int</a></span><span class="op" id="4363466">,</span>&nbsp;<span class="ident" id="4363468">err</span>&nbsp;<span class="builtintype" id="4363472">error</span><span class="op" id="4363477">)</span>&nbsp;<span class="op" id="4363479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4363482">if</span>&nbsp;<span class="ident" id="4363485"><a href="/gostd/crypto/rand/util.go.html#4363441">max</a></span><span class="op" id="4363488">.</span><span class="ident" id="4363489"><a href="/gostd/math/big/int.go.html#2036181">Sign</a></span><span class="op" id="4363493">(</span><span class="op" id="4363494">)</span>&nbsp;<span class="op" id="4363496">&lt;=</span>&nbsp;<span class="num" id="4363499">0</span>&nbsp;<span class="op" id="4363501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4363505">panic</span><span class="op" id="4363510">(</span><span class="string" id="4363511">&#34;crypto/rand:&nbsp;argument&nbsp;to&nbsp;Int&nbsp;is&nbsp;&lt;=&nbsp;0&#34;</span><span class="op" id="4363549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4363552">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4363555">k</span>&nbsp;<span class="op" id="4363557">:=</span>&nbsp;<span class="op" id="4363560">(</span><span class="ident" id="4363561"><a href="/gostd/crypto/rand/util.go.html#4363441">max</a></span><span class="op" id="4363564">.</span><span class="ident" id="4363565"><a href="/gostd/math/big/int.go.html#2050389">BitLen</a></span><span class="op" id="4363571">(</span><span class="op" id="4363572">)</span>&nbsp;<span class="op" id="4363574">+</span>&nbsp;<span class="num" id="4363576">7</span><span class="op" id="4363577">)</span>&nbsp;<span class="op" id="4363579">/</span>&nbsp;<span class="num" id="4363581">8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4363585">//&nbsp;b&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bits&nbsp;in&nbsp;the&nbsp;most&nbsp;significant&nbsp;byte&nbsp;of&nbsp;max.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4363650">b</span>&nbsp;<span class="op" id="4363652">:=</span>&nbsp;<span class="builtintype" id="4363655">uint</span><span class="op" id="4363659">(</span><span class="ident" id="4363660"><a href="/gostd/crypto/rand/util.go.html#4363441">max</a></span><span class="op" id="4363663">.</span><span class="ident" id="4363664"><a href="/gostd/math/big/int.go.html#2050389">BitLen</a></span><span class="op" id="4363670">(</span><span class="op" id="4363671">)</span>&nbsp;<span class="op" id="4363673">%</span>&nbsp;<span class="num" id="4363675">8</span><span class="op" id="4363676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4363679">if</span>&nbsp;<span class="ident" id="4363682"><a href="/gostd/crypto/rand/util.go.html#4363650">b</a></span>&nbsp;<span class="op" id="4363684">==</span>&nbsp;<span class="num" id="4363687">0</span>&nbsp;<span class="op" id="4363689">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4363693"><a href="/gostd/crypto/rand/util.go.html#4363650">b</a></span>&nbsp;<span class="op" id="4363695">=</span>&nbsp;<span class="num" id="4363697">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4363700">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4363704">bytes</span>&nbsp;<span class="op" id="4363710">:=</span>&nbsp;<span class="builtinfunc" id="4363713">make</span><span class="op" id="4363717">(</span><span class="op" id="4363718">[</span><span class="op" id="4363719">]</span><span class="builtintype" id="4363720">byte</span><span class="op" id="4363724">,</span>&nbsp;<span class="ident" id="4363726"><a href="/gostd/crypto/rand/util.go.html#4363555">k</a></span><span class="op" id="4363727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4363730"><a href="/gostd/crypto/rand/util.go.html#4363456">n</a></span>&nbsp;<span class="op" id="4363732">=</span>&nbsp;<span class="builtinfunc" id="4363734">new</span><span class="op" id="4363737">(</span><span class="ident" id="4363738"><a href="/gostd/crypto/rand/util.go.html#4360545">big</a></span><span class="op" id="4363741">.</span><span class="ident" id="4363742"><a href="/gostd/math/big/int.go.html#2035985">Int</a></span><span class="op" id="4363745">)</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4363749">for</span>&nbsp;<span class="op" id="4363753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4363757">_</span><span class="op" id="4363758">,</span>&nbsp;<span class="ident" id="4363760"><a href="/gostd/crypto/rand/util.go.html#4363468">err</a></span>&nbsp;<span class="op" id="4363764">=</span>&nbsp;<span class="ident" id="4363766"><a href="/gostd/crypto/rand/util.go.html#4360539">io</a></span><span class="op" id="4363768">.</span><span class="ident" id="4363769"><a href="/gostd/io/io.go.html#1429706">ReadFull</a></span><span class="op" id="4363777">(</span><span class="ident" id="4363778"><a href="/gostd/crypto/rand/util.go.html#4363425">rand</a></span><span class="op" id="4363782">,</span>&nbsp;<span class="ident" id="4363784"><a href="/gostd/crypto/rand/util.go.html#4363704">bytes</a></span><span class="op" id="4363789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4363793">if</span>&nbsp;<span class="ident" id="4363796"><a href="/gostd/crypto/rand/util.go.html#4363468">err</a></span>&nbsp;<span class="op" id="4363800">!=</span>&nbsp;<span class="builtintype" id="4363803">nil</span>&nbsp;<span class="op" id="4363807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4363812">return</span>&nbsp;<span class="builtintype" id="4363819">nil</span><span class="op" id="4363822">,</span>&nbsp;<span class="ident" id="4363824"><a href="/gostd/crypto/rand/util.go.html#4363468">err</a></span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4363830">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4363835">//&nbsp;Clear&nbsp;bits&nbsp;in&nbsp;the&nbsp;first&nbsp;byte&nbsp;to&nbsp;increase&nbsp;the&nbsp;probability</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4363897">//&nbsp;that&nbsp;the&nbsp;candidate&nbsp;is&nbsp;&lt;&nbsp;max.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4363931"><a href="/gostd/crypto/rand/util.go.html#4363704">bytes</a></span><span class="op" id="4363936">[</span><span class="num" id="4363937">0</span><span class="op" id="4363938">]</span>&nbsp;<span class="op" id="4363940">&amp;=</span>&nbsp;<span class="builtintype" id="4363943">uint8</span><span class="op" id="4363948">(</span><span class="builtintype" id="4363949">int</span><span class="op" id="4363952">(</span><span class="num" id="4363953">1</span><span class="op" id="4363954">&lt;&lt;</span><span class="ident" id="4363956"><a href="/gostd/crypto/rand/util.go.html#4363650">b</a></span><span class="op" id="4363957">)</span>&nbsp;<span class="op" id="4363959">-</span>&nbsp;<span class="num" id="4363961">1</span><span class="op" id="4363962">)</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4363967"><a href="/gostd/crypto/rand/util.go.html#4363456">n</a></span><span class="op" id="4363968">.</span><span class="ident" id="4363969"><a href="/gostd/math/big/int.go.html#2050026">SetBytes</a></span><span class="op" id="4363977">(</span><span class="ident" id="4363978"><a href="/gostd/crypto/rand/util.go.html#4363704">bytes</a></span><span class="op" id="4363983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4363987">if</span>&nbsp;<span class="ident" id="4363990"><a href="/gostd/crypto/rand/util.go.html#4363456">n</a></span><span class="op" id="4363991">.</span><span class="ident" id="4363992"><a href="/gostd/math/big/int.go.html#2042946">Cmp</a></span><span class="op" id="4363995">(</span><span class="ident" id="4363996"><a href="/gostd/crypto/rand/util.go.html#4363441">max</a></span><span class="op" id="4363999">)</span>&nbsp;<span class="op" id="4364001">&lt;</span>&nbsp;<span class="num" id="4364003">0</span>&nbsp;<span class="op" id="4364005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4364010">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4364019">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4364022">}</span><br>
<span class="lineno"></span><span class="op" id="4364024">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
