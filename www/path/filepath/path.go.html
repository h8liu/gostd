<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3044921">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3044976">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3045030">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3045081">//&nbsp;Package&nbsp;filepath&nbsp;implements&nbsp;utility&nbsp;routines&nbsp;for&nbsp;manipulating&nbsp;filename&nbsp;paths</span><br>
<span class="lineno"></span><span class="comment" id="3045161">//&nbsp;in&nbsp;a&nbsp;way&nbsp;compatible&nbsp;with&nbsp;the&nbsp;target&nbsp;operating&nbsp;system-defined&nbsp;file&nbsp;paths.</span><br>
<span class="lineno"></span><span class="keyword" id="3045237">package</span>&nbsp;<span class="ident" id="3045245">filepath</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3045255">import</span>&nbsp;<span class="op" id="3045262">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3045265">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3045275">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3045281">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3045289">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="3045299">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="3045302">//&nbsp;A&nbsp;lazybuf&nbsp;is&nbsp;a&nbsp;lazily&nbsp;constructed&nbsp;path&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="3045352">//&nbsp;It&nbsp;supports&nbsp;append,&nbsp;reading&nbsp;previously&nbsp;appended&nbsp;bytes,</span><br>
<span class="lineno"></span><span class="comment" id="3045410">//&nbsp;and&nbsp;retrieving&nbsp;the&nbsp;final&nbsp;string.&nbsp;It&nbsp;does&nbsp;not&nbsp;allocate&nbsp;a&nbsp;buffer</span><br>
<span class="lineno"></span><span class="comment" id="3045476">//&nbsp;to&nbsp;hold&nbsp;the&nbsp;output&nbsp;until&nbsp;that&nbsp;output&nbsp;diverges&nbsp;from&nbsp;s.</span><br>
<span class="lineno">20</span><span class="keyword" id="3045533">type</span>&nbsp;<span class="ident" id="3045538">lazybuf</span>&nbsp;<span class="keyword" id="3045546">struct</span>&nbsp;<span class="op" id="3045553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3045556">path</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3045567">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3045575">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3045586">[</span><span class="op" id="3045587">]</span><span class="builtintype" id="3045588">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3045594">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3045605">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3045610">volAndPath</span>&nbsp;<span class="builtintype" id="3045621">string</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3045629">volLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3045640">int</span><br>
<span class="lineno"></span><span class="op" id="3045644">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3045647">func</span>&nbsp;<span class="op" id="3045652">(</span><span class="ident" id="3045653">b</span>&nbsp;<span class="op" id="3045655">*</span><span class="ident" id="3045656">lazybuf</span><span class="op" id="3045663">)</span>&nbsp;<span class="ident" id="3045665">index</span><span class="op" id="3045670">(</span><span class="ident" id="3045671">i</span>&nbsp;<span class="builtintype" id="3045673">int</span><span class="op" id="3045676">)</span>&nbsp;<span class="builtintype" id="3045678">byte</span>&nbsp;<span class="op" id="3045683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3045686">if</span>&nbsp;<span class="ident" id="3045689">b</span><span class="op" id="3045690">.</span><span class="ident" id="3045691">buf</span>&nbsp;<span class="op" id="3045695">!=</span>&nbsp;<span class="ident" id="3045698">nil</span>&nbsp;<span class="op" id="3045702">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3045706">return</span>&nbsp;<span class="ident" id="3045713">b</span><span class="op" id="3045714">.</span><span class="ident" id="3045715">buf</span><span class="op" id="3045718">[</span><span class="ident" id="3045719">i</span><span class="op" id="3045720">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3045723">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3045726">return</span>&nbsp;<span class="ident" id="3045733">b</span><span class="op" id="3045734">.</span><span class="ident" id="3045735">path</span><span class="op" id="3045739">[</span><span class="ident" id="3045740">i</span><span class="op" id="3045741">]</span><br>
<span class="lineno"></span><span class="op" id="3045743">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="keyword" id="3045746">func</span>&nbsp;<span class="op" id="3045751">(</span><span class="ident" id="3045752">b</span>&nbsp;<span class="op" id="3045754">*</span><span class="ident" id="3045755">lazybuf</span><span class="op" id="3045762">)</span>&nbsp;<span class="builtinfunc" id="3045764">append</span><span class="op" id="3045770">(</span><span class="ident" id="3045771">c</span>&nbsp;<span class="builtintype" id="3045773">byte</span><span class="op" id="3045777">)</span>&nbsp;<span class="op" id="3045779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3045782">if</span>&nbsp;<span class="ident" id="3045785">b</span><span class="op" id="3045786">.</span><span class="ident" id="3045787">buf</span>&nbsp;<span class="op" id="3045791">==</span>&nbsp;<span class="ident" id="3045794">nil</span>&nbsp;<span class="op" id="3045798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3045802">if</span>&nbsp;<span class="ident" id="3045805">b</span><span class="op" id="3045806">.</span><span class="ident" id="3045807">w</span>&nbsp;<span class="op" id="3045809">&lt;</span>&nbsp;<span class="builtinfunc" id="3045811">len</span><span class="op" id="3045814">(</span><span class="ident" id="3045815">b</span><span class="op" id="3045816">.</span><span class="ident" id="3045817">path</span><span class="op" id="3045821">)</span>&nbsp;<span class="op" id="3045823">&amp;&amp;</span>&nbsp;<span class="ident" id="3045826">b</span><span class="op" id="3045827">.</span><span class="ident" id="3045828">path</span><span class="op" id="3045832">[</span><span class="ident" id="3045833">b</span><span class="op" id="3045834">.</span><span class="ident" id="3045835">w</span><span class="op" id="3045836">]</span>&nbsp;<span class="op" id="3045838">==</span>&nbsp;<span class="ident" id="3045841">c</span>&nbsp;<span class="op" id="3045843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3045848">b</span><span class="op" id="3045849">.</span><span class="ident" id="3045850">w</span><span class="op" id="3045851">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3045857">return</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3045866">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3045870">b</span><span class="op" id="3045871">.</span><span class="ident" id="3045872">buf</span>&nbsp;<span class="op" id="3045876">=</span>&nbsp;<span class="builtinfunc" id="3045878">make</span><span class="op" id="3045882">(</span><span class="op" id="3045883">[</span><span class="op" id="3045884">]</span><span class="builtintype" id="3045885">byte</span><span class="op" id="3045889">,</span>&nbsp;<span class="builtinfunc" id="3045891">len</span><span class="op" id="3045894">(</span><span class="ident" id="3045895">b</span><span class="op" id="3045896">.</span><span class="ident" id="3045897">path</span><span class="op" id="3045901">)</span><span class="op" id="3045902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3045906">copy</span><span class="op" id="3045910">(</span><span class="ident" id="3045911">b</span><span class="op" id="3045912">.</span><span class="ident" id="3045913">buf</span><span class="op" id="3045916">,</span>&nbsp;<span class="ident" id="3045918">b</span><span class="op" id="3045919">.</span><span class="ident" id="3045920">path</span><span class="op" id="3045924">[</span><span class="op" id="3045925">:</span><span class="ident" id="3045926">b</span><span class="op" id="3045927">.</span><span class="ident" id="3045928">w</span><span class="op" id="3045929">]</span><span class="op" id="3045930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3045933">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3045936">b</span><span class="op" id="3045937">.</span><span class="ident" id="3045938">buf</span><span class="op" id="3045941">[</span><span class="ident" id="3045942">b</span><span class="op" id="3045943">.</span><span class="ident" id="3045944">w</span><span class="op" id="3045945">]</span>&nbsp;<span class="op" id="3045947">=</span>&nbsp;<span class="ident" id="3045949">c</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3045952">b</span><span class="op" id="3045953">.</span><span class="ident" id="3045954">w</span><span class="op" id="3045955">++</span><br>
<span class="lineno"></span><span class="op" id="3045958">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3045961">func</span>&nbsp;<span class="op" id="3045966">(</span><span class="ident" id="3045967">b</span>&nbsp;<span class="op" id="3045969">*</span><span class="ident" id="3045970">lazybuf</span><span class="op" id="3045977">)</span>&nbsp;<span class="builtintype" id="3045979">string</span><span class="op" id="3045985">(</span><span class="op" id="3045986">)</span>&nbsp;<span class="builtintype" id="3045988">string</span>&nbsp;<span class="op" id="3045995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3045998">if</span>&nbsp;<span class="ident" id="3046001">b</span><span class="op" id="3046002">.</span><span class="ident" id="3046003">buf</span>&nbsp;<span class="op" id="3046007">==</span>&nbsp;<span class="ident" id="3046010">nil</span>&nbsp;<span class="op" id="3046014">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3046018">return</span>&nbsp;<span class="ident" id="3046025">b</span><span class="op" id="3046026">.</span><span class="ident" id="3046027">volAndPath</span><span class="op" id="3046037">[</span><span class="op" id="3046038">:</span><span class="ident" id="3046039">b</span><span class="op" id="3046040">.</span><span class="ident" id="3046041">volLen</span><span class="op" id="3046047">+</span><span class="ident" id="3046048">b</span><span class="op" id="3046049">.</span><span class="ident" id="3046050">w</span><span class="op" id="3046051">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3046054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3046057">return</span>&nbsp;<span class="ident" id="3046064">b</span><span class="op" id="3046065">.</span><span class="ident" id="3046066">volAndPath</span><span class="op" id="3046076">[</span><span class="op" id="3046077">:</span><span class="ident" id="3046078">b</span><span class="op" id="3046079">.</span><span class="ident" id="3046080">volLen</span><span class="op" id="3046086">]</span>&nbsp;<span class="op" id="3046088">+</span>&nbsp;<span class="builtintype" id="3046090">string</span><span class="op" id="3046096">(</span><span class="ident" id="3046097">b</span><span class="op" id="3046098">.</span><span class="ident" id="3046099">buf</span><span class="op" id="3046102">[</span><span class="op" id="3046103">:</span><span class="ident" id="3046104">b</span><span class="op" id="3046105">.</span><span class="ident" id="3046106">w</span><span class="op" id="3046107">]</span><span class="op" id="3046108">)</span><br>
<span class="lineno"></span><span class="op" id="3046110">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="3046113">const</span>&nbsp;<span class="op" id="3046119">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3046122">Separator</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3046136">=</span>&nbsp;<span class="ident" id="3046138">os</span><span class="op" id="3046140">.</span><span class="ident" id="3046141">PathSeparator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3046156">ListSeparator</span>&nbsp;<span class="op" id="3046170">=</span>&nbsp;<span class="ident" id="3046172">os</span><span class="op" id="3046174">.</span><span class="ident" id="3046175">PathListSeparator</span><br>
<span class="lineno"></span><span class="op" id="3046193">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="3046196">//&nbsp;Clean&nbsp;returns&nbsp;the&nbsp;shortest&nbsp;path&nbsp;name&nbsp;equivalent&nbsp;to&nbsp;path</span><br>
<span class="lineno"></span><span class="comment" id="3046255">//&nbsp;by&nbsp;purely&nbsp;lexical&nbsp;processing.&nbsp;&nbsp;It&nbsp;applies&nbsp;the&nbsp;following&nbsp;rules</span><br>
<span class="lineno"></span><span class="comment" id="3046320">//&nbsp;iteratively&nbsp;until&nbsp;no&nbsp;further&nbsp;processing&nbsp;can&nbsp;be&nbsp;done:</span><br>
<span class="lineno"></span><span class="comment" id="3046376">//</span><br>
<span class="lineno"></span><span class="comment" id="3046379">//&nbsp;&nbsp;&nbsp;&nbsp1.&nbsp;Replace&nbsp;multiple&nbsp;Separator&nbsp;elements&nbsp;with&nbsp;a&nbsp;single&nbsp;one.</span><br>
<span class="lineno">65</span><span class="comment" id="3046440">//&nbsp;&nbsp;&nbsp;&nbsp2.&nbsp;Eliminate&nbsp;each&nbsp;.&nbsp;path&nbsp;name&nbsp;element&nbsp;(the&nbsp;current&nbsp;directory).</span><br>
<span class="lineno"></span><span class="comment" id="3046506">//&nbsp;&nbsp;&nbsp;&nbsp3.&nbsp;Eliminate&nbsp;each&nbsp;inner&nbsp;..&nbsp;path&nbsp;name&nbsp;element&nbsp;(the&nbsp;parent&nbsp;directory)</span><br>
<span class="lineno"></span><span class="comment" id="3046577">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;along&nbsp;with&nbsp;the&nbsp;non-..&nbsp;element&nbsp;that&nbsp;precedes&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="3046631">//&nbsp;&nbsp;&nbsp;&nbsp4.&nbsp;Eliminate&nbsp;..&nbsp;elements&nbsp;that&nbsp;begin&nbsp;a&nbsp;rooted&nbsp;path:</span><br>
<span class="lineno"></span><span class="comment" id="3046685">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;that&nbsp;is,&nbsp;replace&nbsp;&#34;/..&#34;&nbsp;by&nbsp;&#34;/&#34;&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;a&nbsp;path,</span><br>
<span class="lineno">70</span><span class="comment" id="3046749">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;assuming&nbsp;Separator&nbsp;is&nbsp;&#39;/&#39;.</span><br>
<span class="lineno"></span><span class="comment" id="3046782">//</span><br>
<span class="lineno"></span><span class="comment" id="3046785">//&nbsp;The&nbsp;returned&nbsp;path&nbsp;ends&nbsp;in&nbsp;a&nbsp;slash&nbsp;only&nbsp;if&nbsp;it&nbsp;represents&nbsp;a&nbsp;root&nbsp;directory,</span><br>
<span class="lineno"></span><span class="comment" id="3046862">//&nbsp;such&nbsp;as&nbsp;&#34;/&#34;&nbsp;on&nbsp;Unix&nbsp;or&nbsp;`C:\`&nbsp;on&nbsp;Windows.</span><br>
<span class="lineno"></span><span class="comment" id="3046906">//</span><br>
<span class="lineno">75</span><span class="comment" id="3046909">//&nbsp;If&nbsp;the&nbsp;result&nbsp;of&nbsp;this&nbsp;process&nbsp;is&nbsp;an&nbsp;empty&nbsp;string,&nbsp;Clean</span><br>
<span class="lineno"></span><span class="comment" id="3046968">//&nbsp;returns&nbsp;the&nbsp;string&nbsp;&#34;.&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3046995">//</span><br>
<span class="lineno"></span><span class="comment" id="3046998">//&nbsp;See&nbsp;also&nbsp;Rob&nbsp;Pike,&nbsp;``Lexical&nbsp;File&nbsp;Names&nbsp;in&nbsp;Plan&nbsp;9&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="3047054">//&nbsp;Getting&nbsp;Dot-Dot&nbsp;Right,&#39;&#39;</span><br>
<span class="lineno">80</span><span class="comment" id="3047082">//&nbsp;http://plan9.bell-labs.com/sys/doc/lexnames.html</span><br>
<span class="lineno"></span><span class="keyword" id="3047134">func</span>&nbsp;<span class="ident" id="3047139">Clean</span><span class="op" id="3047144">(</span><span class="ident" id="3047145">path</span>&nbsp;<span class="builtintype" id="3047150">string</span><span class="op" id="3047156">)</span>&nbsp;<span class="builtintype" id="3047158">string</span>&nbsp;<span class="op" id="3047165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3047168">originalPath</span>&nbsp;<span class="op" id="3047181">:=</span>&nbsp;<span class="ident" id="3047184">path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3047190">volLen</span>&nbsp;<span class="op" id="3047197">:=</span>&nbsp;<span class="ident" id="3047200">volumeNameLen</span><span class="op" id="3047213">(</span><span class="ident" id="3047214">path</span><span class="op" id="3047218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3047221">path</span>&nbsp;<span class="op" id="3047226">=</span>&nbsp;<span class="ident" id="3047228">path</span><span class="op" id="3047232">[</span><span class="ident" id="3047233">volLen</span><span class="op" id="3047239">:</span><span class="op" id="3047240">]</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3047243">if</span>&nbsp;<span class="ident" id="3047246">path</span>&nbsp;<span class="op" id="3047251">==</span>&nbsp;<span class="string" id="3047254">&#34;&#34;</span>&nbsp;<span class="op" id="3047257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3047261">if</span>&nbsp;<span class="ident" id="3047264">volLen</span>&nbsp;<span class="op" id="3047271">&gt;</span>&nbsp;<span class="num" id="3047273">1</span>&nbsp;<span class="op" id="3047275">&amp;&amp;</span>&nbsp;<span class="ident" id="3047278">originalPath</span><span class="op" id="3047290">[</span><span class="num" id="3047291">1</span><span class="op" id="3047292">]</span>&nbsp;<span class="op" id="3047294">!=</span>&nbsp;<span class="string" id="3047297">&#39;:&#39;</span>&nbsp;<span class="op" id="3047301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3047306">//&nbsp;should&nbsp;be&nbsp;UNC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3047326">return</span>&nbsp;<span class="ident" id="3047333">FromSlash</span><span class="op" id="3047342">(</span><span class="ident" id="3047343">originalPath</span><span class="op" id="3047355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3047359">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3047363">return</span>&nbsp;<span class="ident" id="3047370">originalPath</span>&nbsp;<span class="op" id="3047383">+</span>&nbsp;<span class="string" id="3047385">&#34;.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3047390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3047393">rooted</span>&nbsp;<span class="op" id="3047400">:=</span>&nbsp;<span class="ident" id="3047403">os</span><span class="op" id="3047405">.</span><span class="ident" id="3047406">IsPathSeparator</span><span class="op" id="3047421">(</span><span class="ident" id="3047422">path</span><span class="op" id="3047426">[</span><span class="num" id="3047427">0</span><span class="op" id="3047428">]</span><span class="op" id="3047429">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3047433">//&nbsp;Invariants:</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3047449">//&nbsp;&nbsp;&nbsp;&nbspreading&nbsp;from&nbsp;path;&nbsp;r&nbsp;is&nbsp;index&nbsp;of&nbsp;next&nbsp;byte&nbsp;to&nbsp;process.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3047508">//&nbsp;&nbsp;&nbsp;&nbspwriting&nbsp;to&nbsp;buf;&nbsp;w&nbsp;is&nbsp;index&nbsp;of&nbsp;next&nbsp;byte&nbsp;to&nbsp;write.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3047562">//&nbsp;&nbsp;&nbsp;&nbspdotdot&nbsp;is&nbsp;index&nbsp;in&nbsp;buf&nbsp;where&nbsp;..&nbsp;must&nbsp;stop,&nbsp;either&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3047624">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspit&nbsp;is&nbsp;the&nbsp;leading&nbsp;slash&nbsp;or&nbsp;it&nbsp;is&nbsp;a&nbsp;leading&nbsp;../../..&nbsp;prefix.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3047689">n</span>&nbsp;<span class="op" id="3047691">:=</span>&nbsp;<span class="builtinfunc" id="3047694">len</span><span class="op" id="3047697">(</span><span class="ident" id="3047698">path</span><span class="op" id="3047702">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3047705">out</span>&nbsp;<span class="op" id="3047709">:=</span>&nbsp;<span class="ident" id="3047712">lazybuf</span><span class="op" id="3047719">{</span><span class="ident" id="3047720">path</span><span class="op" id="3047724">:</span>&nbsp;<span class="ident" id="3047726">path</span><span class="op" id="3047730">,</span>&nbsp;<span class="ident" id="3047732">volAndPath</span><span class="op" id="3047742">:</span>&nbsp;<span class="ident" id="3047744">originalPath</span><span class="op" id="3047756">,</span>&nbsp;<span class="ident" id="3047758">volLen</span><span class="op" id="3047764">:</span>&nbsp;<span class="ident" id="3047766">volLen</span><span class="op" id="3047772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3047775">r</span><span class="op" id="3047776">,</span>&nbsp;<span class="ident" id="3047778">dotdot</span>&nbsp;<span class="op" id="3047785">:=</span>&nbsp;<span class="num" id="3047788">0</span><span class="op" id="3047789">,</span>&nbsp;<span class="num" id="3047791">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3047794">if</span>&nbsp;<span class="ident" id="3047797">rooted</span>&nbsp;<span class="op" id="3047804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3047808">out</span><span class="op" id="3047811">.</span><span class="builtinfunc" id="3047812">append</span><span class="op" id="3047818">(</span><span class="ident" id="3047819">Separator</span><span class="op" id="3047828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3047832">r</span><span class="op" id="3047833">,</span>&nbsp;<span class="ident" id="3047835">dotdot</span>&nbsp;<span class="op" id="3047842">=</span>&nbsp;<span class="num" id="3047844">1</span><span class="op" id="3047845">,</span>&nbsp;<span class="num" id="3047847">1</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3047850">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3047854">for</span>&nbsp;<span class="ident" id="3047858">r</span>&nbsp;<span class="op" id="3047860">&lt;</span>&nbsp;<span class="ident" id="3047862">n</span>&nbsp;<span class="op" id="3047864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3047868">switch</span>&nbsp;<span class="op" id="3047875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3047879">case</span>&nbsp;<span class="ident" id="3047884">os</span><span class="op" id="3047886">.</span><span class="ident" id="3047887">IsPathSeparator</span><span class="op" id="3047902">(</span><span class="ident" id="3047903">path</span><span class="op" id="3047907">[</span><span class="ident" id="3047908">r</span><span class="op" id="3047909">]</span><span class="op" id="3047910">)</span><span class="op" id="3047911">:</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3047916">//&nbsp;empty&nbsp;path&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3047941">r</span><span class="op" id="3047942">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3047947">case</span>&nbsp;<span class="ident" id="3047952">path</span><span class="op" id="3047956">[</span><span class="ident" id="3047957">r</span><span class="op" id="3047958">]</span>&nbsp;<span class="op" id="3047960">==</span>&nbsp;<span class="string" id="3047963">&#39;.&#39;</span>&nbsp;<span class="op" id="3047967">&amp;&amp;</span>&nbsp;<span class="op" id="3047970">(</span><span class="ident" id="3047971">r</span><span class="op" id="3047972">+</span><span class="num" id="3047973">1</span>&nbsp;<span class="op" id="3047975">==</span>&nbsp;<span class="ident" id="3047978">n</span>&nbsp;<span class="op" id="3047980">||</span>&nbsp;<span class="ident" id="3047983">os</span><span class="op" id="3047985">.</span><span class="ident" id="3047986">IsPathSeparator</span><span class="op" id="3048001">(</span><span class="ident" id="3048002">path</span><span class="op" id="3048006">[</span><span class="ident" id="3048007">r</span><span class="op" id="3048008">+</span><span class="num" id="3048009">1</span><span class="op" id="3048010">]</span><span class="op" id="3048011">)</span><span class="op" id="3048012">)</span><span class="op" id="3048013">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3048018">//&nbsp;.&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3048034">r</span><span class="op" id="3048035">++</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3048040">case</span>&nbsp;<span class="ident" id="3048045">path</span><span class="op" id="3048049">[</span><span class="ident" id="3048050">r</span><span class="op" id="3048051">]</span>&nbsp;<span class="op" id="3048053">==</span>&nbsp;<span class="string" id="3048056">&#39;.&#39;</span>&nbsp;<span class="op" id="3048060">&amp;&amp;</span>&nbsp;<span class="ident" id="3048063">path</span><span class="op" id="3048067">[</span><span class="ident" id="3048068">r</span><span class="op" id="3048069">+</span><span class="num" id="3048070">1</span><span class="op" id="3048071">]</span>&nbsp;<span class="op" id="3048073">==</span>&nbsp;<span class="string" id="3048076">&#39;.&#39;</span>&nbsp;<span class="op" id="3048080">&amp;&amp;</span>&nbsp;<span class="op" id="3048083">(</span><span class="ident" id="3048084">r</span><span class="op" id="3048085">+</span><span class="num" id="3048086">2</span>&nbsp;<span class="op" id="3048088">==</span>&nbsp;<span class="ident" id="3048091">n</span>&nbsp;<span class="op" id="3048093">||</span>&nbsp;<span class="ident" id="3048096">os</span><span class="op" id="3048098">.</span><span class="ident" id="3048099">IsPathSeparator</span><span class="op" id="3048114">(</span><span class="ident" id="3048115">path</span><span class="op" id="3048119">[</span><span class="ident" id="3048120">r</span><span class="op" id="3048121">+</span><span class="num" id="3048122">2</span><span class="op" id="3048123">]</span><span class="op" id="3048124">)</span><span class="op" id="3048125">)</span><span class="op" id="3048126">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3048131">//&nbsp;..&nbsp;element:&nbsp;remove&nbsp;to&nbsp;last&nbsp;separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3048174">r</span>&nbsp;<span class="op" id="3048176">+=</span>&nbsp;<span class="num" id="3048179">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3048184">switch</span>&nbsp;<span class="op" id="3048191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3048196">case</span>&nbsp;<span class="ident" id="3048201">out</span><span class="op" id="3048204">.</span><span class="ident" id="3048205">w</span>&nbsp;<span class="op" id="3048207">&gt;</span>&nbsp;<span class="ident" id="3048209">dotdot</span><span class="op" id="3048215">:</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3048221">//&nbsp;can&nbsp;backtrack</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3048242">out</span><span class="op" id="3048245">.</span><span class="ident" id="3048246">w</span><span class="op" id="3048247">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3048254">for</span>&nbsp;<span class="ident" id="3048258">out</span><span class="op" id="3048261">.</span><span class="ident" id="3048262">w</span>&nbsp;<span class="op" id="3048264">&gt;</span>&nbsp;<span class="ident" id="3048266">dotdot</span>&nbsp;<span class="op" id="3048273">&amp;&amp;</span>&nbsp;<span class="op" id="3048276">!</span><span class="ident" id="3048277">os</span><span class="op" id="3048279">.</span><span class="ident" id="3048280">IsPathSeparator</span><span class="op" id="3048295">(</span><span class="ident" id="3048296">out</span><span class="op" id="3048299">.</span><span class="ident" id="3048300">index</span><span class="op" id="3048305">(</span><span class="ident" id="3048306">out</span><span class="op" id="3048309">.</span><span class="ident" id="3048310">w</span><span class="op" id="3048311">)</span><span class="op" id="3048312">)</span>&nbsp;<span class="op" id="3048314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3048321">out</span><span class="op" id="3048324">.</span><span class="ident" id="3048325">w</span><span class="op" id="3048326">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3048333">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3048338">case</span>&nbsp;<span class="op" id="3048343">!</span><span class="ident" id="3048344">rooted</span><span class="op" id="3048350">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3048356">//&nbsp;cannot&nbsp;backtrack,&nbsp;but&nbsp;not&nbsp;rooted,&nbsp;so&nbsp;append&nbsp;..&nbsp;element.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3048419">if</span>&nbsp;<span class="ident" id="3048422">out</span><span class="op" id="3048425">.</span><span class="ident" id="3048426">w</span>&nbsp;<span class="op" id="3048428">&gt;</span>&nbsp;<span class="num" id="3048430">0</span>&nbsp;<span class="op" id="3048432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3048439">out</span><span class="op" id="3048442">.</span><span class="builtinfunc" id="3048443">append</span><span class="op" id="3048449">(</span><span class="ident" id="3048450">Separator</span><span class="op" id="3048459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3048465">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3048471">out</span><span class="op" id="3048474">.</span><span class="builtinfunc" id="3048475">append</span><span class="op" id="3048481">(</span><span class="string" id="3048482">&#39;.&#39;</span><span class="op" id="3048485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3048491">out</span><span class="op" id="3048494">.</span><span class="builtinfunc" id="3048495">append</span><span class="op" id="3048501">(</span><span class="string" id="3048502">&#39;.&#39;</span><span class="op" id="3048505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3048511">dotdot</span>&nbsp;<span class="op" id="3048518">=</span>&nbsp;<span class="ident" id="3048520">out</span><span class="op" id="3048523">.</span><span class="ident" id="3048524">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3048529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3048533">default</span><span class="op" id="3048540">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3048545">//&nbsp;real&nbsp;path&nbsp;element.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3048570">//&nbsp;add&nbsp;slash&nbsp;if&nbsp;needed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3048596">if</span>&nbsp;<span class="ident" id="3048599">rooted</span>&nbsp;<span class="op" id="3048606">&amp;&amp;</span>&nbsp;<span class="ident" id="3048609">out</span><span class="op" id="3048612">.</span><span class="ident" id="3048613">w</span>&nbsp;<span class="op" id="3048615">!=</span>&nbsp;<span class="num" id="3048618">1</span>&nbsp;<span class="op" id="3048620">||</span>&nbsp;<span class="op" id="3048623">!</span><span class="ident" id="3048624">rooted</span>&nbsp;<span class="op" id="3048631">&amp;&amp;</span>&nbsp;<span class="ident" id="3048634">out</span><span class="op" id="3048637">.</span><span class="ident" id="3048638">w</span>&nbsp;<span class="op" id="3048640">!=</span>&nbsp;<span class="num" id="3048643">0</span>&nbsp;<span class="op" id="3048645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3048651">out</span><span class="op" id="3048654">.</span><span class="builtinfunc" id="3048655">append</span><span class="op" id="3048661">(</span><span class="ident" id="3048662">Separator</span><span class="op" id="3048671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3048676">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3048681">//&nbsp;copy&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3048700">for</span>&nbsp;<span class="op" id="3048704">;</span>&nbsp;<span class="ident" id="3048706">r</span>&nbsp;<span class="op" id="3048708">&lt;</span>&nbsp;<span class="ident" id="3048710">n</span>&nbsp;<span class="op" id="3048712">&amp;&amp;</span>&nbsp;<span class="op" id="3048715">!</span><span class="ident" id="3048716">os</span><span class="op" id="3048718">.</span><span class="ident" id="3048719">IsPathSeparator</span><span class="op" id="3048734">(</span><span class="ident" id="3048735">path</span><span class="op" id="3048739">[</span><span class="ident" id="3048740">r</span><span class="op" id="3048741">]</span><span class="op" id="3048742">)</span><span class="op" id="3048743">;</span>&nbsp;<span class="ident" id="3048745">r</span><span class="op" id="3048746">++</span>&nbsp;<span class="op" id="3048749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3048755">out</span><span class="op" id="3048758">.</span><span class="builtinfunc" id="3048759">append</span><span class="op" id="3048765">(</span><span class="ident" id="3048766">path</span><span class="op" id="3048770">[</span><span class="ident" id="3048771">r</span><span class="op" id="3048772">]</span><span class="op" id="3048773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3048778">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3048782">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3048785">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3048789">//&nbsp;Turn&nbsp;empty&nbsp;string&nbsp;into&nbsp;&#34;.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3048820">if</span>&nbsp;<span class="ident" id="3048823">out</span><span class="op" id="3048826">.</span><span class="ident" id="3048827">w</span>&nbsp;<span class="op" id="3048829">==</span>&nbsp;<span class="num" id="3048832">0</span>&nbsp;<span class="op" id="3048834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3048838">out</span><span class="op" id="3048841">.</span><span class="builtinfunc" id="3048842">append</span><span class="op" id="3048848">(</span><span class="string" id="3048849">&#39;.&#39;</span><span class="op" id="3048852">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3048855">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3048859">return</span>&nbsp;<span class="ident" id="3048866">FromSlash</span><span class="op" id="3048875">(</span><span class="ident" id="3048876">out</span><span class="op" id="3048879">.</span><span class="builtintype" id="3048880">string</span><span class="op" id="3048886">(</span><span class="op" id="3048887">)</span><span class="op" id="3048888">)</span><br>
<span class="lineno"></span><span class="op" id="3048890">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="comment" id="3048893">//&nbsp;ToSlash&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;replacing&nbsp;each&nbsp;separator&nbsp;character</span><br>
<span class="lineno"></span><span class="comment" id="3048961">//&nbsp;in&nbsp;path&nbsp;with&nbsp;a&nbsp;slash&nbsp;(&#39;/&#39;)&nbsp;character.&nbsp;Multiple&nbsp;separators&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="3049026">//&nbsp;replaced&nbsp;by&nbsp;multiple&nbsp;slashes.</span><br>
<span class="lineno"></span><span class="keyword" id="3049059">func</span>&nbsp;<span class="ident" id="3049064">ToSlash</span><span class="op" id="3049071">(</span><span class="ident" id="3049072">path</span>&nbsp;<span class="builtintype" id="3049077">string</span><span class="op" id="3049083">)</span>&nbsp;<span class="builtintype" id="3049085">string</span>&nbsp;<span class="op" id="3049092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3049095">if</span>&nbsp;<span class="ident" id="3049098">Separator</span>&nbsp;<span class="op" id="3049108">==</span>&nbsp;<span class="string" id="3049111">&#39;/&#39;</span>&nbsp;<span class="op" id="3049115">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3049119">return</span>&nbsp;<span class="ident" id="3049126">path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3049132">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3049135">return</span>&nbsp;<span class="ident" id="3049142">strings</span><span class="op" id="3049149">.</span><span class="ident" id="3049150">Replace</span><span class="op" id="3049157">(</span><span class="ident" id="3049158">path</span><span class="op" id="3049162">,</span>&nbsp;<span class="builtintype" id="3049164">string</span><span class="op" id="3049170">(</span><span class="ident" id="3049171">Separator</span><span class="op" id="3049180">)</span><span class="op" id="3049181">,</span>&nbsp;<span class="string" id="3049183">&#34;/&#34;</span><span class="op" id="3049186">,</span>&nbsp;<span class="op" id="3049188">-</span><span class="num" id="3049189">1</span><span class="op" id="3049190">)</span><br>
<span class="lineno"></span><span class="op" id="3049192">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="3049195">//&nbsp;FromSlash&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;replacing&nbsp;each&nbsp;slash&nbsp;(&#39;/&#39;)&nbsp;character</span><br>
<span class="lineno"></span><span class="comment" id="3049267">//&nbsp;in&nbsp;path&nbsp;with&nbsp;a&nbsp;separator&nbsp;character.&nbsp;Multiple&nbsp;slashes&nbsp;are&nbsp;replaced</span><br>
<span class="lineno"></span><span class="comment" id="3049336">//&nbsp;by&nbsp;multiple&nbsp;separators.</span><br>
<span class="lineno"></span><span class="keyword" id="3049363">func</span>&nbsp;<span class="ident" id="3049368">FromSlash</span><span class="op" id="3049377">(</span><span class="ident" id="3049378">path</span>&nbsp;<span class="builtintype" id="3049383">string</span><span class="op" id="3049389">)</span>&nbsp;<span class="builtintype" id="3049391">string</span>&nbsp;<span class="op" id="3049398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3049401">if</span>&nbsp;<span class="ident" id="3049404">Separator</span>&nbsp;<span class="op" id="3049414">==</span>&nbsp;<span class="string" id="3049417">&#39;/&#39;</span>&nbsp;<span class="op" id="3049421">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3049425">return</span>&nbsp;<span class="ident" id="3049432">path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3049438">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3049441">return</span>&nbsp;<span class="ident" id="3049448">strings</span><span class="op" id="3049455">.</span><span class="ident" id="3049456">Replace</span><span class="op" id="3049463">(</span><span class="ident" id="3049464">path</span><span class="op" id="3049468">,</span>&nbsp;<span class="string" id="3049470">&#34;/&#34;</span><span class="op" id="3049473">,</span>&nbsp;<span class="builtintype" id="3049475">string</span><span class="op" id="3049481">(</span><span class="ident" id="3049482">Separator</span><span class="op" id="3049491">)</span><span class="op" id="3049492">,</span>&nbsp;<span class="op" id="3049494">-</span><span class="num" id="3049495">1</span><span class="op" id="3049496">)</span><br>
<span class="lineno"></span><span class="op" id="3049498">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="3049501">//&nbsp;SplitList&nbsp;splits&nbsp;a&nbsp;list&nbsp;of&nbsp;paths&nbsp;joined&nbsp;by&nbsp;the&nbsp;OS-specific&nbsp;ListSeparator,</span><br>
<span class="lineno"></span><span class="comment" id="3049578">//&nbsp;usually&nbsp;found&nbsp;in&nbsp;PATH&nbsp;or&nbsp;GOPATH&nbsp;environment&nbsp;variables.</span><br>
<span class="lineno"></span><span class="comment" id="3049636">//&nbsp;Unlike&nbsp;strings.Split,&nbsp;SplitList&nbsp;returns&nbsp;an&nbsp;empty&nbsp;slice&nbsp;when&nbsp;passed&nbsp;an&nbsp;empty&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="3049723">func</span>&nbsp;<span class="ident" id="3049728">SplitList</span><span class="op" id="3049737">(</span><span class="ident" id="3049738">path</span>&nbsp;<span class="builtintype" id="3049743">string</span><span class="op" id="3049749">)</span>&nbsp;<span class="op" id="3049751">[</span><span class="op" id="3049752">]</span><span class="builtintype" id="3049753">string</span>&nbsp;<span class="op" id="3049760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3049763">return</span>&nbsp;<span class="ident" id="3049770">splitList</span><span class="op" id="3049779">(</span><span class="ident" id="3049780">path</span><span class="op" id="3049784">)</span><br>
<span class="lineno">180</span><span class="op" id="3049786">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3049789">//&nbsp;Split&nbsp;splits&nbsp;path&nbsp;immediately&nbsp;following&nbsp;the&nbsp;final&nbsp;Separator,</span><br>
<span class="lineno"></span><span class="comment" id="3049853">//&nbsp;separating&nbsp;it&nbsp;into&nbsp;a&nbsp;directory&nbsp;and&nbsp;file&nbsp;name&nbsp;component.</span><br>
<span class="lineno"></span><span class="comment" id="3049912">//&nbsp;If&nbsp;there&nbsp;is&nbsp;no&nbsp;Separator&nbsp;in&nbsp;path,&nbsp;Split&nbsp;returns&nbsp;an&nbsp;empty&nbsp;dir</span><br>
<span class="lineno">185</span><span class="comment" id="3049976">//&nbsp;and&nbsp;file&nbsp;set&nbsp;to&nbsp;path.</span><br>
<span class="lineno"></span><span class="comment" id="3050001">//&nbsp;The&nbsp;returned&nbsp;values&nbsp;have&nbsp;the&nbsp;property&nbsp;that&nbsp;path&nbsp;=&nbsp;dir+file.</span><br>
<span class="lineno"></span><span class="keyword" id="3050064">func</span>&nbsp;<span class="ident" id="3050069">Split</span><span class="op" id="3050074">(</span><span class="ident" id="3050075">path</span>&nbsp;<span class="builtintype" id="3050080">string</span><span class="op" id="3050086">)</span>&nbsp;<span class="op" id="3050088">(</span><span class="ident" id="3050089">dir</span><span class="op" id="3050092">,</span>&nbsp;<span class="ident" id="3050094">file</span>&nbsp;<span class="builtintype" id="3050099">string</span><span class="op" id="3050105">)</span>&nbsp;<span class="op" id="3050107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3050110">vol</span>&nbsp;<span class="op" id="3050114">:=</span>&nbsp;<span class="ident" id="3050117">VolumeName</span><span class="op" id="3050127">(</span><span class="ident" id="3050128">path</span><span class="op" id="3050132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3050135">i</span>&nbsp;<span class="op" id="3050137">:=</span>&nbsp;<span class="builtinfunc" id="3050140">len</span><span class="op" id="3050143">(</span><span class="ident" id="3050144">path</span><span class="op" id="3050148">)</span>&nbsp;<span class="op" id="3050150">-</span>&nbsp;<span class="num" id="3050152">1</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3050155">for</span>&nbsp;<span class="ident" id="3050159">i</span>&nbsp;<span class="op" id="3050161">&gt;=</span>&nbsp;<span class="builtinfunc" id="3050164">len</span><span class="op" id="3050167">(</span><span class="ident" id="3050168">vol</span><span class="op" id="3050171">)</span>&nbsp;<span class="op" id="3050173">&amp;&amp;</span>&nbsp;<span class="op" id="3050176">!</span><span class="ident" id="3050177">os</span><span class="op" id="3050179">.</span><span class="ident" id="3050180">IsPathSeparator</span><span class="op" id="3050195">(</span><span class="ident" id="3050196">path</span><span class="op" id="3050200">[</span><span class="ident" id="3050201">i</span><span class="op" id="3050202">]</span><span class="op" id="3050203">)</span>&nbsp;<span class="op" id="3050205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3050209">i</span><span class="op" id="3050210">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3050214">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3050217">return</span>&nbsp;<span class="ident" id="3050224">path</span><span class="op" id="3050228">[</span><span class="op" id="3050229">:</span><span class="ident" id="3050230">i</span><span class="op" id="3050231">+</span><span class="num" id="3050232">1</span><span class="op" id="3050233">]</span><span class="op" id="3050234">,</span>&nbsp;<span class="ident" id="3050236">path</span><span class="op" id="3050240">[</span><span class="ident" id="3050241">i</span><span class="op" id="3050242">+</span><span class="num" id="3050243">1</span><span class="op" id="3050244">:</span><span class="op" id="3050245">]</span><br>
<span class="lineno"></span><span class="op" id="3050247">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="comment" id="3050250">//&nbsp;Join&nbsp;joins&nbsp;any&nbsp;number&nbsp;of&nbsp;path&nbsp;elements&nbsp;into&nbsp;a&nbsp;single&nbsp;path,&nbsp;adding</span><br>
<span class="lineno"></span><span class="comment" id="3050319">//&nbsp;a&nbsp;Separator&nbsp;if&nbsp;necessary.&nbsp;The&nbsp;result&nbsp;is&nbsp;Cleaned,&nbsp;in&nbsp;particular</span><br>
<span class="lineno"></span><span class="comment" id="3050385">//&nbsp;all&nbsp;empty&nbsp;strings&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="keyword" id="3050419">func</span>&nbsp;<span class="ident" id="3050424">Join</span><span class="op" id="3050428">(</span><span class="ident" id="3050429">elem</span>&nbsp;<span class="op" id="3050434">...</span><span class="builtintype" id="3050437">string</span><span class="op" id="3050443">)</span>&nbsp;<span class="builtintype" id="3050445">string</span>&nbsp;<span class="op" id="3050452">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3050455">for</span>&nbsp;<span class="ident" id="3050459">i</span><span class="op" id="3050460">,</span>&nbsp;<span class="ident" id="3050462">e</span>&nbsp;<span class="op" id="3050464">:=</span>&nbsp;<span class="keyword" id="3050467">range</span>&nbsp;<span class="ident" id="3050473">elem</span>&nbsp;<span class="op" id="3050478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3050482">if</span>&nbsp;<span class="ident" id="3050485">e</span>&nbsp;<span class="op" id="3050487">!=</span>&nbsp;<span class="string" id="3050490">&#34;&#34;</span>&nbsp;<span class="op" id="3050493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3050498">return</span>&nbsp;<span class="ident" id="3050505">Clean</span><span class="op" id="3050510">(</span><span class="ident" id="3050511">strings</span><span class="op" id="3050518">.</span><span class="ident" id="3050519">Join</span><span class="op" id="3050523">(</span><span class="ident" id="3050524">elem</span><span class="op" id="3050528">[</span><span class="ident" id="3050529">i</span><span class="op" id="3050530">:</span><span class="op" id="3050531">]</span><span class="op" id="3050532">,</span>&nbsp;<span class="builtintype" id="3050534">string</span><span class="op" id="3050540">(</span><span class="ident" id="3050541">Separator</span><span class="op" id="3050550">)</span><span class="op" id="3050551">)</span><span class="op" id="3050552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3050556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3050559">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3050562">return</span>&nbsp;<span class="string" id="3050569">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="3050572">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3050575">//&nbsp;Ext&nbsp;returns&nbsp;the&nbsp;file&nbsp;name&nbsp;extension&nbsp;used&nbsp;by&nbsp;path.</span><br>
<span class="lineno"></span><span class="comment" id="3050628">//&nbsp;The&nbsp;extension&nbsp;is&nbsp;the&nbsp;suffix&nbsp;beginning&nbsp;at&nbsp;the&nbsp;final&nbsp;dot</span><br>
<span class="lineno">210</span><span class="comment" id="3050686">//&nbsp;in&nbsp;the&nbsp;final&nbsp;element&nbsp;of&nbsp;path;&nbsp;it&nbsp;is&nbsp;empty&nbsp;if&nbsp;there&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3050743">//&nbsp;no&nbsp;dot.</span><br>
<span class="lineno"></span><span class="keyword" id="3050754">func</span>&nbsp;<span class="ident" id="3050759">Ext</span><span class="op" id="3050762">(</span><span class="ident" id="3050763">path</span>&nbsp;<span class="builtintype" id="3050768">string</span><span class="op" id="3050774">)</span>&nbsp;<span class="builtintype" id="3050776">string</span>&nbsp;<span class="op" id="3050783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3050786">for</span>&nbsp;<span class="ident" id="3050790">i</span>&nbsp;<span class="op" id="3050792">:=</span>&nbsp;<span class="builtinfunc" id="3050795">len</span><span class="op" id="3050798">(</span><span class="ident" id="3050799">path</span><span class="op" id="3050803">)</span>&nbsp;<span class="op" id="3050805">-</span>&nbsp;<span class="num" id="3050807">1</span><span class="op" id="3050808">;</span>&nbsp;<span class="ident" id="3050810">i</span>&nbsp;<span class="op" id="3050812">&gt;=</span>&nbsp;<span class="num" id="3050815">0</span>&nbsp;<span class="op" id="3050817">&amp;&amp;</span>&nbsp;<span class="op" id="3050820">!</span><span class="ident" id="3050821">os</span><span class="op" id="3050823">.</span><span class="ident" id="3050824">IsPathSeparator</span><span class="op" id="3050839">(</span><span class="ident" id="3050840">path</span><span class="op" id="3050844">[</span><span class="ident" id="3050845">i</span><span class="op" id="3050846">]</span><span class="op" id="3050847">)</span><span class="op" id="3050848">;</span>&nbsp;<span class="ident" id="3050850">i</span><span class="op" id="3050851">--</span>&nbsp;<span class="op" id="3050854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3050858">if</span>&nbsp;<span class="ident" id="3050861">path</span><span class="op" id="3050865">[</span><span class="ident" id="3050866">i</span><span class="op" id="3050867">]</span>&nbsp;<span class="op" id="3050869">==</span>&nbsp;<span class="string" id="3050872">&#39;.&#39;</span>&nbsp;<span class="op" id="3050876">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3050881">return</span>&nbsp;<span class="ident" id="3050888">path</span><span class="op" id="3050892">[</span><span class="ident" id="3050893">i</span><span class="op" id="3050894">:</span><span class="op" id="3050895">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3050899">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3050902">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3050905">return</span>&nbsp;<span class="string" id="3050912">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="3050915">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="3050918">//&nbsp;EvalSymlinks&nbsp;returns&nbsp;the&nbsp;path&nbsp;name&nbsp;after&nbsp;the&nbsp;evaluation&nbsp;of&nbsp;any&nbsp;symbolic</span><br>
<span class="lineno"></span><span class="comment" id="3050993">//&nbsp;links.</span><br>
<span class="lineno"></span><span class="comment" id="3051003">//&nbsp;If&nbsp;path&nbsp;is&nbsp;relative&nbsp;the&nbsp;result&nbsp;will&nbsp;be&nbsp;relative&nbsp;to&nbsp;the&nbsp;current&nbsp;directory,</span><br>
<span class="lineno"></span><span class="comment" id="3051080">//&nbsp;unless&nbsp;one&nbsp;of&nbsp;the&nbsp;components&nbsp;is&nbsp;an&nbsp;absolute&nbsp;symbolic&nbsp;link.</span><br>
<span class="lineno">225</span><span class="keyword" id="3051142">func</span>&nbsp;<span class="ident" id="3051147">EvalSymlinks</span><span class="op" id="3051159">(</span><span class="ident" id="3051160">path</span>&nbsp;<span class="builtintype" id="3051165">string</span><span class="op" id="3051171">)</span>&nbsp;<span class="op" id="3051173">(</span><span class="builtintype" id="3051174">string</span><span class="op" id="3051180">,</span>&nbsp;<span class="builtintype" id="3051182">error</span><span class="op" id="3051187">)</span>&nbsp;<span class="op" id="3051189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3051192">return</span>&nbsp;<span class="ident" id="3051199">evalSymlinks</span><span class="op" id="3051211">(</span><span class="ident" id="3051212">path</span><span class="op" id="3051216">)</span><br>
<span class="lineno"></span><span class="op" id="3051218">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3051221">//&nbsp;Abs&nbsp;returns&nbsp;an&nbsp;absolute&nbsp;representation&nbsp;of&nbsp;path.</span><br>
<span class="lineno">230</span><span class="comment" id="3051272">//&nbsp;If&nbsp;the&nbsp;path&nbsp;is&nbsp;not&nbsp;absolute&nbsp;it&nbsp;will&nbsp;be&nbsp;joined&nbsp;with&nbsp;the&nbsp;current</span><br>
<span class="lineno"></span><span class="comment" id="3051338">//&nbsp;working&nbsp;directory&nbsp;to&nbsp;turn&nbsp;it&nbsp;into&nbsp;an&nbsp;absolute&nbsp;path.&nbsp;&nbsp;The&nbsp;absolute</span><br>
<span class="lineno"></span><span class="comment" id="3051407">//&nbsp;path&nbsp;name&nbsp;for&nbsp;a&nbsp;given&nbsp;file&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;unique.</span><br>
<span class="lineno"></span><span class="keyword" id="3051469">func</span>&nbsp;<span class="ident" id="3051474">Abs</span><span class="op" id="3051477">(</span><span class="ident" id="3051478">path</span>&nbsp;<span class="builtintype" id="3051483">string</span><span class="op" id="3051489">)</span>&nbsp;<span class="op" id="3051491">(</span><span class="builtintype" id="3051492">string</span><span class="op" id="3051498">,</span>&nbsp;<span class="builtintype" id="3051500">error</span><span class="op" id="3051505">)</span>&nbsp;<span class="op" id="3051507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3051510">return</span>&nbsp;<span class="ident" id="3051517">abs</span><span class="op" id="3051520">(</span><span class="ident" id="3051521">path</span><span class="op" id="3051525">)</span><br>
<span class="lineno">235</span><span class="op" id="3051527">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3051530">func</span>&nbsp;<span class="ident" id="3051535">unixAbs</span><span class="op" id="3051542">(</span><span class="ident" id="3051543">path</span>&nbsp;<span class="builtintype" id="3051548">string</span><span class="op" id="3051554">)</span>&nbsp;<span class="op" id="3051556">(</span><span class="builtintype" id="3051557">string</span><span class="op" id="3051563">,</span>&nbsp;<span class="builtintype" id="3051565">error</span><span class="op" id="3051570">)</span>&nbsp;<span class="op" id="3051572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3051575">if</span>&nbsp;<span class="ident" id="3051578">IsAbs</span><span class="op" id="3051583">(</span><span class="ident" id="3051584">path</span><span class="op" id="3051588">)</span>&nbsp;<span class="op" id="3051590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3051594">return</span>&nbsp;<span class="ident" id="3051601">Clean</span><span class="op" id="3051606">(</span><span class="ident" id="3051607">path</span><span class="op" id="3051611">)</span><span class="op" id="3051612">,</span>&nbsp;<span class="ident" id="3051614">nil</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3051619">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3051622">wd</span><span class="op" id="3051624">,</span>&nbsp;<span class="ident" id="3051626">err</span>&nbsp;<span class="op" id="3051630">:=</span>&nbsp;<span class="ident" id="3051633">os</span><span class="op" id="3051635">.</span><span class="ident" id="3051636">Getwd</span><span class="op" id="3051641">(</span><span class="op" id="3051642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3051645">if</span>&nbsp;<span class="ident" id="3051648">err</span>&nbsp;<span class="op" id="3051652">!=</span>&nbsp;<span class="ident" id="3051655">nil</span>&nbsp;<span class="op" id="3051659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3051663">return</span>&nbsp;<span class="string" id="3051670">&#34;&#34;</span><span class="op" id="3051672">,</span>&nbsp;<span class="ident" id="3051674">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3051679">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3051682">return</span>&nbsp;<span class="ident" id="3051689">Join</span><span class="op" id="3051693">(</span><span class="ident" id="3051694">wd</span><span class="op" id="3051696">,</span>&nbsp;<span class="ident" id="3051698">path</span><span class="op" id="3051702">)</span><span class="op" id="3051703">,</span>&nbsp;<span class="ident" id="3051705">nil</span><br>
<span class="lineno"></span><span class="op" id="3051709">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3051712">//&nbsp;Rel&nbsp;returns&nbsp;a&nbsp;relative&nbsp;path&nbsp;that&nbsp;is&nbsp;lexically&nbsp;equivalent&nbsp;to&nbsp;targpath&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="3051789">//&nbsp;joined&nbsp;to&nbsp;basepath&nbsp;with&nbsp;an&nbsp;intervening&nbsp;separator.&nbsp;That&nbsp;is,</span><br>
<span class="lineno">250</span><span class="comment" id="3051851">//&nbsp;Join(basepath,&nbsp;Rel(basepath,&nbsp;targpath))&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;targpath&nbsp;itself.</span><br>
<span class="lineno"></span><span class="comment" id="3051928">//&nbsp;On&nbsp;success,&nbsp;the&nbsp;returned&nbsp;path&nbsp;will&nbsp;always&nbsp;be&nbsp;relative&nbsp;to&nbsp;basepath,</span><br>
<span class="lineno"></span><span class="comment" id="3051998">//&nbsp;even&nbsp;if&nbsp;basepath&nbsp;and&nbsp;targpath&nbsp;share&nbsp;no&nbsp;elements.</span><br>
<span class="lineno"></span><span class="comment" id="3052050">//&nbsp;An&nbsp;error&nbsp;is&nbsp;returned&nbsp;if&nbsp;targpath&nbsp;can&#39;t&nbsp;be&nbsp;made&nbsp;relative&nbsp;to&nbsp;basepath&nbsp;or&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="3052127">//&nbsp;knowing&nbsp;the&nbsp;current&nbsp;working&nbsp;directory&nbsp;would&nbsp;be&nbsp;necessary&nbsp;to&nbsp;compute&nbsp;it.</span><br>
<span class="lineno">255</span><span class="keyword" id="3052202">func</span>&nbsp;<span class="ident" id="3052207">Rel</span><span class="op" id="3052210">(</span><span class="ident" id="3052211">basepath</span><span class="op" id="3052219">,</span>&nbsp;<span class="ident" id="3052221">targpath</span>&nbsp;<span class="builtintype" id="3052230">string</span><span class="op" id="3052236">)</span>&nbsp;<span class="op" id="3052238">(</span><span class="builtintype" id="3052239">string</span><span class="op" id="3052245">,</span>&nbsp;<span class="builtintype" id="3052247">error</span><span class="op" id="3052252">)</span>&nbsp;<span class="op" id="3052254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3052257">baseVol</span>&nbsp;<span class="op" id="3052265">:=</span>&nbsp;<span class="ident" id="3052268">VolumeName</span><span class="op" id="3052278">(</span><span class="ident" id="3052279">basepath</span><span class="op" id="3052287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3052290">targVol</span>&nbsp;<span class="op" id="3052298">:=</span>&nbsp;<span class="ident" id="3052301">VolumeName</span><span class="op" id="3052311">(</span><span class="ident" id="3052312">targpath</span><span class="op" id="3052320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3052323">base</span>&nbsp;<span class="op" id="3052328">:=</span>&nbsp;<span class="ident" id="3052331">Clean</span><span class="op" id="3052336">(</span><span class="ident" id="3052337">basepath</span><span class="op" id="3052345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3052348">targ</span>&nbsp;<span class="op" id="3052353">:=</span>&nbsp;<span class="ident" id="3052356">Clean</span><span class="op" id="3052361">(</span><span class="ident" id="3052362">targpath</span><span class="op" id="3052370">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3052373">if</span>&nbsp;<span class="ident" id="3052376">targ</span>&nbsp;<span class="op" id="3052381">==</span>&nbsp;<span class="ident" id="3052384">base</span>&nbsp;<span class="op" id="3052389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3052393">return</span>&nbsp;<span class="string" id="3052400">&#34;.&#34;</span><span class="op" id="3052403">,</span>&nbsp;<span class="ident" id="3052405">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3052410">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3052413">base</span>&nbsp;<span class="op" id="3052418">=</span>&nbsp;<span class="ident" id="3052420">base</span><span class="op" id="3052424">[</span><span class="builtinfunc" id="3052425">len</span><span class="op" id="3052428">(</span><span class="ident" id="3052429">baseVol</span><span class="op" id="3052436">)</span><span class="op" id="3052437">:</span><span class="op" id="3052438">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3052441">targ</span>&nbsp;<span class="op" id="3052446">=</span>&nbsp;<span class="ident" id="3052448">targ</span><span class="op" id="3052452">[</span><span class="builtinfunc" id="3052453">len</span><span class="op" id="3052456">(</span><span class="ident" id="3052457">targVol</span><span class="op" id="3052464">)</span><span class="op" id="3052465">:</span><span class="op" id="3052466">]</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3052469">if</span>&nbsp;<span class="ident" id="3052472">base</span>&nbsp;<span class="op" id="3052477">==</span>&nbsp;<span class="string" id="3052480">&#34;.&#34;</span>&nbsp;<span class="op" id="3052484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3052488">base</span>&nbsp;<span class="op" id="3052493">=</span>&nbsp;<span class="string" id="3052495">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3052499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3052502">//&nbsp;Can&#39;t&nbsp;use&nbsp;IsAbs&nbsp;-&nbsp;`\a`&nbsp;and&nbsp;`a`&nbsp;are&nbsp;both&nbsp;relative&nbsp;in&nbsp;Windows.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3052567">baseSlashed</span>&nbsp;<span class="op" id="3052579">:=</span>&nbsp;<span class="builtinfunc" id="3052582">len</span><span class="op" id="3052585">(</span><span class="ident" id="3052586">base</span><span class="op" id="3052590">)</span>&nbsp;<span class="op" id="3052592">&gt;</span>&nbsp;<span class="num" id="3052594">0</span>&nbsp;<span class="op" id="3052596">&amp;&amp;</span>&nbsp;<span class="ident" id="3052599">base</span><span class="op" id="3052603">[</span><span class="num" id="3052604">0</span><span class="op" id="3052605">]</span>&nbsp;<span class="op" id="3052607">==</span>&nbsp;<span class="ident" id="3052610">Separator</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3052621">targSlashed</span>&nbsp;<span class="op" id="3052633">:=</span>&nbsp;<span class="builtinfunc" id="3052636">len</span><span class="op" id="3052639">(</span><span class="ident" id="3052640">targ</span><span class="op" id="3052644">)</span>&nbsp;<span class="op" id="3052646">&gt;</span>&nbsp;<span class="num" id="3052648">0</span>&nbsp;<span class="op" id="3052650">&amp;&amp;</span>&nbsp;<span class="ident" id="3052653">targ</span><span class="op" id="3052657">[</span><span class="num" id="3052658">0</span><span class="op" id="3052659">]</span>&nbsp;<span class="op" id="3052661">==</span>&nbsp;<span class="ident" id="3052664">Separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3052675">if</span>&nbsp;<span class="ident" id="3052678">baseSlashed</span>&nbsp;<span class="op" id="3052690">!=</span>&nbsp;<span class="ident" id="3052693">targSlashed</span>&nbsp;<span class="op" id="3052705">||</span>&nbsp;<span class="ident" id="3052708">baseVol</span>&nbsp;<span class="op" id="3052716">!=</span>&nbsp;<span class="ident" id="3052719">targVol</span>&nbsp;<span class="op" id="3052727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3052731">return</span>&nbsp;<span class="string" id="3052738">&#34;&#34;</span><span class="op" id="3052740">,</span>&nbsp;<span class="ident" id="3052742">errors</span><span class="op" id="3052748">.</span><span class="ident" id="3052749">New</span><span class="op" id="3052752">(</span><span class="string" id="3052753">&#34;Rel:&nbsp;can&#39;t&nbsp;make&nbsp;&#34;</span>&nbsp;<span class="op" id="3052772">+</span>&nbsp;<span class="ident" id="3052774">targ</span>&nbsp;<span class="op" id="3052779">+</span>&nbsp;<span class="string" id="3052781">&#34;&nbsp;relative&nbsp;to&nbsp;&#34;</span>&nbsp;<span class="op" id="3052797">+</span>&nbsp;<span class="ident" id="3052799">base</span><span class="op" id="3052803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3052806">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3052809">//&nbsp;Position&nbsp;base[b0:bi]&nbsp;and&nbsp;targ[t0:ti]&nbsp;at&nbsp;the&nbsp;first&nbsp;differing&nbsp;elements.</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3052883">bl</span>&nbsp;<span class="op" id="3052886">:=</span>&nbsp;<span class="builtinfunc" id="3052889">len</span><span class="op" id="3052892">(</span><span class="ident" id="3052893">base</span><span class="op" id="3052897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3052900">tl</span>&nbsp;<span class="op" id="3052903">:=</span>&nbsp;<span class="builtinfunc" id="3052906">len</span><span class="op" id="3052909">(</span><span class="ident" id="3052910">targ</span><span class="op" id="3052914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3052917">var</span>&nbsp;<span class="ident" id="3052921">b0</span><span class="op" id="3052923">,</span>&nbsp;<span class="ident" id="3052925">bi</span><span class="op" id="3052927">,</span>&nbsp;<span class="ident" id="3052929">t0</span><span class="op" id="3052931">,</span>&nbsp;<span class="ident" id="3052933">ti</span>&nbsp;<span class="builtintype" id="3052936">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3052941">for</span>&nbsp;<span class="op" id="3052945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3052949">for</span>&nbsp;<span class="ident" id="3052953">bi</span>&nbsp;<span class="op" id="3052956">&lt;</span>&nbsp;<span class="ident" id="3052958">bl</span>&nbsp;<span class="op" id="3052961">&amp;&amp;</span>&nbsp;<span class="ident" id="3052964">base</span><span class="op" id="3052968">[</span><span class="ident" id="3052969">bi</span><span class="op" id="3052971">]</span>&nbsp;<span class="op" id="3052973">!=</span>&nbsp;<span class="ident" id="3052976">Separator</span>&nbsp;<span class="op" id="3052986">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3052991">bi</span><span class="op" id="3052993">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3052998">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3053002">for</span>&nbsp;<span class="ident" id="3053006">ti</span>&nbsp;<span class="op" id="3053009">&lt;</span>&nbsp;<span class="ident" id="3053011">tl</span>&nbsp;<span class="op" id="3053014">&amp;&amp;</span>&nbsp;<span class="ident" id="3053017">targ</span><span class="op" id="3053021">[</span><span class="ident" id="3053022">ti</span><span class="op" id="3053024">]</span>&nbsp;<span class="op" id="3053026">!=</span>&nbsp;<span class="ident" id="3053029">Separator</span>&nbsp;<span class="op" id="3053039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3053044">ti</span><span class="op" id="3053046">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3053051">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3053055">if</span>&nbsp;<span class="ident" id="3053058">targ</span><span class="op" id="3053062">[</span><span class="ident" id="3053063">t0</span><span class="op" id="3053065">:</span><span class="ident" id="3053066">ti</span><span class="op" id="3053068">]</span>&nbsp;<span class="op" id="3053070">!=</span>&nbsp;<span class="ident" id="3053073">base</span><span class="op" id="3053077">[</span><span class="ident" id="3053078">b0</span><span class="op" id="3053080">:</span><span class="ident" id="3053081">bi</span><span class="op" id="3053083">]</span>&nbsp;<span class="op" id="3053085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3053090">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3053098">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3053102">if</span>&nbsp;<span class="ident" id="3053105">bi</span>&nbsp;<span class="op" id="3053108">&lt;</span>&nbsp;<span class="ident" id="3053110">bl</span>&nbsp;<span class="op" id="3053113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3053118">bi</span><span class="op" id="3053120">++</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3053125">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3053129">if</span>&nbsp;<span class="ident" id="3053132">ti</span>&nbsp;<span class="op" id="3053135">&lt;</span>&nbsp;<span class="ident" id="3053137">tl</span>&nbsp;<span class="op" id="3053140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3053145">ti</span><span class="op" id="3053147">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3053152">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3053156">b0</span>&nbsp;<span class="op" id="3053159">=</span>&nbsp;<span class="ident" id="3053161">bi</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3053166">t0</span>&nbsp;<span class="op" id="3053169">=</span>&nbsp;<span class="ident" id="3053171">ti</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3053175">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3053178">if</span>&nbsp;<span class="ident" id="3053181">base</span><span class="op" id="3053185">[</span><span class="ident" id="3053186">b0</span><span class="op" id="3053188">:</span><span class="ident" id="3053189">bi</span><span class="op" id="3053191">]</span>&nbsp;<span class="op" id="3053193">==</span>&nbsp;<span class="string" id="3053196">&#34;..&#34;</span>&nbsp;<span class="op" id="3053201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3053205">return</span>&nbsp;<span class="string" id="3053212">&#34;&#34;</span><span class="op" id="3053214">,</span>&nbsp;<span class="ident" id="3053216">errors</span><span class="op" id="3053222">.</span><span class="ident" id="3053223">New</span><span class="op" id="3053226">(</span><span class="string" id="3053227">&#34;Rel:&nbsp;can&#39;t&nbsp;make&nbsp;&#34;</span>&nbsp;<span class="op" id="3053246">+</span>&nbsp;<span class="ident" id="3053248">targ</span>&nbsp;<span class="op" id="3053253">+</span>&nbsp;<span class="string" id="3053255">&#34;&nbsp;relative&nbsp;to&nbsp;&#34;</span>&nbsp;<span class="op" id="3053271">+</span>&nbsp;<span class="ident" id="3053273">base</span><span class="op" id="3053277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3053280">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3053283">if</span>&nbsp;<span class="ident" id="3053286">b0</span>&nbsp;<span class="op" id="3053289">!=</span>&nbsp;<span class="ident" id="3053292">bl</span>&nbsp;<span class="op" id="3053295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3053299">//&nbsp;Base&nbsp;elements&nbsp;left.&nbsp;Must&nbsp;go&nbsp;up&nbsp;before&nbsp;going&nbsp;down.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3053354">seps</span>&nbsp;<span class="op" id="3053359">:=</span>&nbsp;<span class="ident" id="3053362">strings</span><span class="op" id="3053369">.</span><span class="ident" id="3053370">Count</span><span class="op" id="3053375">(</span><span class="ident" id="3053376">base</span><span class="op" id="3053380">[</span><span class="ident" id="3053381">b0</span><span class="op" id="3053383">:</span><span class="ident" id="3053384">bl</span><span class="op" id="3053386">]</span><span class="op" id="3053387">,</span>&nbsp;<span class="builtintype" id="3053389">string</span><span class="op" id="3053395">(</span><span class="ident" id="3053396">Separator</span><span class="op" id="3053405">)</span><span class="op" id="3053406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3053410">size</span>&nbsp;<span class="op" id="3053415">:=</span>&nbsp;<span class="num" id="3053418">2</span>&nbsp;<span class="op" id="3053420">+</span>&nbsp;<span class="ident" id="3053422">seps</span><span class="op" id="3053426">*</span><span class="num" id="3053427">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3053431">if</span>&nbsp;<span class="ident" id="3053434">tl</span>&nbsp;<span class="op" id="3053437">!=</span>&nbsp;<span class="ident" id="3053440">t0</span>&nbsp;<span class="op" id="3053443">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3053448">size</span>&nbsp;<span class="op" id="3053453">+=</span>&nbsp;<span class="num" id="3053456">1</span>&nbsp;<span class="op" id="3053458">+</span>&nbsp;<span class="ident" id="3053460">tl</span>&nbsp;<span class="op" id="3053463">-</span>&nbsp;<span class="ident" id="3053465">t0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3053470">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3053474">buf</span>&nbsp;<span class="op" id="3053478">:=</span>&nbsp;<span class="builtinfunc" id="3053481">make</span><span class="op" id="3053485">(</span><span class="op" id="3053486">[</span><span class="op" id="3053487">]</span><span class="builtintype" id="3053488">byte</span><span class="op" id="3053492">,</span>&nbsp;<span class="ident" id="3053494">size</span><span class="op" id="3053498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3053502">n</span>&nbsp;<span class="op" id="3053504">:=</span>&nbsp;<span class="builtinfunc" id="3053507">copy</span><span class="op" id="3053511">(</span><span class="ident" id="3053512">buf</span><span class="op" id="3053515">,</span>&nbsp;<span class="string" id="3053517">&#34;..&#34;</span><span class="op" id="3053521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3053525">for</span>&nbsp;<span class="ident" id="3053529">i</span>&nbsp;<span class="op" id="3053531">:=</span>&nbsp;<span class="num" id="3053534">0</span><span class="op" id="3053535">;</span>&nbsp;<span class="ident" id="3053537">i</span>&nbsp;<span class="op" id="3053539">&lt;</span>&nbsp;<span class="ident" id="3053541">seps</span><span class="op" id="3053545">;</span>&nbsp;<span class="ident" id="3053547">i</span><span class="op" id="3053548">++</span>&nbsp;<span class="op" id="3053551">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3053556">buf</span><span class="op" id="3053559">[</span><span class="ident" id="3053560">n</span><span class="op" id="3053561">]</span>&nbsp;<span class="op" id="3053563">=</span>&nbsp;<span class="ident" id="3053565">Separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3053578">copy</span><span class="op" id="3053582">(</span><span class="ident" id="3053583">buf</span><span class="op" id="3053586">[</span><span class="ident" id="3053587">n</span><span class="op" id="3053588">+</span><span class="num" id="3053589">1</span><span class="op" id="3053590">:</span><span class="op" id="3053591">]</span><span class="op" id="3053592">,</span>&nbsp;<span class="string" id="3053594">&#34;..&#34;</span><span class="op" id="3053598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3053603">n</span>&nbsp;<span class="op" id="3053605">+=</span>&nbsp;<span class="num" id="3053608">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3053612">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3053616">if</span>&nbsp;<span class="ident" id="3053619">t0</span>&nbsp;<span class="op" id="3053622">!=</span>&nbsp;<span class="ident" id="3053625">tl</span>&nbsp;<span class="op" id="3053628">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3053633">buf</span><span class="op" id="3053636">[</span><span class="ident" id="3053637">n</span><span class="op" id="3053638">]</span>&nbsp;<span class="op" id="3053640">=</span>&nbsp;<span class="ident" id="3053642">Separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3053655">copy</span><span class="op" id="3053659">(</span><span class="ident" id="3053660">buf</span><span class="op" id="3053663">[</span><span class="ident" id="3053664">n</span><span class="op" id="3053665">+</span><span class="num" id="3053666">1</span><span class="op" id="3053667">:</span><span class="op" id="3053668">]</span><span class="op" id="3053669">,</span>&nbsp;<span class="ident" id="3053671">targ</span><span class="op" id="3053675">[</span><span class="ident" id="3053676">t0</span><span class="op" id="3053678">:</span><span class="op" id="3053679">]</span><span class="op" id="3053680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3053684">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3053688">return</span>&nbsp;<span class="builtintype" id="3053695">string</span><span class="op" id="3053701">(</span><span class="ident" id="3053702">buf</span><span class="op" id="3053705">)</span><span class="op" id="3053706">,</span>&nbsp;<span class="ident" id="3053708">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3053713">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3053716">return</span>&nbsp;<span class="ident" id="3053723">targ</span><span class="op" id="3053727">[</span><span class="ident" id="3053728">t0</span><span class="op" id="3053730">:</span><span class="op" id="3053731">]</span><span class="op" id="3053732">,</span>&nbsp;<span class="ident" id="3053734">nil</span><br>
<span class="lineno"></span><span class="op" id="3053738">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3053741">//&nbsp;SkipDir&nbsp;is&nbsp;used&nbsp;as&nbsp;a&nbsp;return&nbsp;value&nbsp;from&nbsp;WalkFuncs&nbsp;to&nbsp;indicate&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="3053810">//&nbsp;the&nbsp;directory&nbsp;named&nbsp;in&nbsp;the&nbsp;call&nbsp;is&nbsp;to&nbsp;be&nbsp;skipped.&nbsp;It&nbsp;is&nbsp;not&nbsp;returned</span><br>
<span class="lineno">325</span><span class="comment" id="3053882">//&nbsp;as&nbsp;an&nbsp;error&nbsp;by&nbsp;any&nbsp;function.</span><br>
<span class="lineno"></span><span class="keyword" id="3053914">var</span>&nbsp;<span class="ident" id="3053918">SkipDir</span>&nbsp;<span class="op" id="3053926">=</span>&nbsp;<span class="ident" id="3053928">errors</span><span class="op" id="3053934">.</span><span class="ident" id="3053935">New</span><span class="op" id="3053938">(</span><span class="string" id="3053939">&#34;skip&nbsp;this&nbsp;directory&#34;</span><span class="op" id="3053960">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3053963">//&nbsp;WalkFunc&nbsp;is&nbsp;the&nbsp;type&nbsp;of&nbsp;the&nbsp;function&nbsp;called&nbsp;for&nbsp;each&nbsp;file&nbsp;or&nbsp;directory</span><br>
<span class="lineno"></span><span class="comment" id="3054037">//&nbsp;visited&nbsp;by&nbsp;Walk.&nbsp;The&nbsp;path&nbsp;argument&nbsp;contains&nbsp;the&nbsp;argument&nbsp;to&nbsp;Walk&nbsp;as&nbsp;a</span><br>
<span class="lineno">330</span><span class="comment" id="3054110">//&nbsp;prefix;&nbsp;that&nbsp;is,&nbsp;if&nbsp;Walk&nbsp;is&nbsp;called&nbsp;with&nbsp;&#34;dir&#34;,&nbsp;which&nbsp;is&nbsp;a&nbsp;directory</span><br>
<span class="lineno"></span><span class="comment" id="3054181">//&nbsp;containing&nbsp;the&nbsp;file&nbsp;&#34;a&#34;,&nbsp;the&nbsp;walk&nbsp;function&nbsp;will&nbsp;be&nbsp;called&nbsp;with&nbsp;argument</span><br>
<span class="lineno"></span><span class="comment" id="3054256">//&nbsp;&#34;dir/a&#34;.&nbsp;The&nbsp;info&nbsp;argument&nbsp;is&nbsp;the&nbsp;os.FileInfo&nbsp;for&nbsp;the&nbsp;named&nbsp;path.</span><br>
<span class="lineno"></span><span class="comment" id="3054325">//</span><br>
<span class="lineno"></span><span class="comment" id="3054328">//&nbsp;If&nbsp;there&nbsp;was&nbsp;a&nbsp;problem&nbsp;walking&nbsp;to&nbsp;the&nbsp;file&nbsp;or&nbsp;directory&nbsp;named&nbsp;by&nbsp;path,&nbsp;the</span><br>
<span class="lineno">335</span><span class="comment" id="3054406">//&nbsp;incoming&nbsp;error&nbsp;will&nbsp;describe&nbsp;the&nbsp;problem&nbsp;and&nbsp;the&nbsp;function&nbsp;can&nbsp;decide&nbsp;how</span><br>
<span class="lineno"></span><span class="comment" id="3054482">//&nbsp;to&nbsp;handle&nbsp;that&nbsp;error&nbsp;(and&nbsp;Walk&nbsp;will&nbsp;not&nbsp;descend&nbsp;into&nbsp;that&nbsp;directory).&nbsp;If</span><br>
<span class="lineno"></span><span class="comment" id="3054558">//&nbsp;an&nbsp;error&nbsp;is&nbsp;returned,&nbsp;processing&nbsp;stops.&nbsp;The&nbsp;sole&nbsp;exception&nbsp;is&nbsp;that&nbsp;if&nbsp;path</span><br>
<span class="lineno"></span><span class="comment" id="3054636">//&nbsp;is&nbsp;a&nbsp;directory&nbsp;and&nbsp;the&nbsp;function&nbsp;returns&nbsp;the&nbsp;special&nbsp;value&nbsp;SkipDir,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3054710">//&nbsp;contents&nbsp;of&nbsp;the&nbsp;directory&nbsp;are&nbsp;skipped&nbsp;and&nbsp;processing&nbsp;continues&nbsp;as&nbsp;usual&nbsp;on</span><br>
<span class="lineno">340</span><span class="comment" id="3054788">//&nbsp;the&nbsp;next&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="3054806">type</span>&nbsp;<span class="ident" id="3054811">WalkFunc</span>&nbsp;<span class="keyword" id="3054820">func</span><span class="op" id="3054824">(</span><span class="ident" id="3054825">path</span>&nbsp;<span class="builtintype" id="3054830">string</span><span class="op" id="3054836">,</span>&nbsp;<span class="ident" id="3054838">info</span>&nbsp;<span class="ident" id="3054843">os</span><span class="op" id="3054845">.</span><span class="ident" id="3054846">FileInfo</span><span class="op" id="3054854">,</span>&nbsp;<span class="ident" id="3054856">err</span>&nbsp;<span class="builtintype" id="3054860">error</span><span class="op" id="3054865">)</span>&nbsp;<span class="builtintype" id="3054867">error</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3054874">var</span>&nbsp;<span class="ident" id="3054878">lstat</span>&nbsp;<span class="op" id="3054884">=</span>&nbsp;<span class="ident" id="3054886">os</span><span class="op" id="3054888">.</span><span class="ident" id="3054889">Lstat</span>&nbsp;<span class="comment" id="3054895">//&nbsp;for&nbsp;testing</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span><span class="comment" id="3054911">//&nbsp;walk&nbsp;recursively&nbsp;descends&nbsp;path,&nbsp;calling&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="3054957">func</span>&nbsp;<span class="ident" id="3054962">walk</span><span class="op" id="3054966">(</span><span class="ident" id="3054967">path</span>&nbsp;<span class="builtintype" id="3054972">string</span><span class="op" id="3054978">,</span>&nbsp;<span class="ident" id="3054980">info</span>&nbsp;<span class="ident" id="3054985">os</span><span class="op" id="3054987">.</span><span class="ident" id="3054988">FileInfo</span><span class="op" id="3054996">,</span>&nbsp;<span class="ident" id="3054998">walkFn</span>&nbsp;<span class="ident" id="3055005">WalkFunc</span><span class="op" id="3055013">)</span>&nbsp;<span class="builtintype" id="3055015">error</span>&nbsp;<span class="op" id="3055021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3055024">err</span>&nbsp;<span class="op" id="3055028">:=</span>&nbsp;<span class="ident" id="3055031">walkFn</span><span class="op" id="3055037">(</span><span class="ident" id="3055038">path</span><span class="op" id="3055042">,</span>&nbsp;<span class="ident" id="3055044">info</span><span class="op" id="3055048">,</span>&nbsp;<span class="ident" id="3055050">nil</span><span class="op" id="3055053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3055056">if</span>&nbsp;<span class="ident" id="3055059">err</span>&nbsp;<span class="op" id="3055063">!=</span>&nbsp;<span class="ident" id="3055066">nil</span>&nbsp;<span class="op" id="3055070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3055074">if</span>&nbsp;<span class="ident" id="3055077">info</span><span class="op" id="3055081">.</span><span class="ident" id="3055082">IsDir</span><span class="op" id="3055087">(</span><span class="op" id="3055088">)</span>&nbsp;<span class="op" id="3055090">&amp;&amp;</span>&nbsp;<span class="ident" id="3055093">err</span>&nbsp;<span class="op" id="3055097">==</span>&nbsp;<span class="ident" id="3055100">SkipDir</span>&nbsp;<span class="op" id="3055108">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3055113">return</span>&nbsp;<span class="ident" id="3055120">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3055126">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3055130">return</span>&nbsp;<span class="ident" id="3055137">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3055142">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3055146">if</span>&nbsp;<span class="op" id="3055149">!</span><span class="ident" id="3055150">info</span><span class="op" id="3055154">.</span><span class="ident" id="3055155">IsDir</span><span class="op" id="3055160">(</span><span class="op" id="3055161">)</span>&nbsp;<span class="op" id="3055163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3055167">return</span>&nbsp;<span class="ident" id="3055174">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3055179">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3055183">names</span><span class="op" id="3055188">,</span>&nbsp;<span class="ident" id="3055190">err</span>&nbsp;<span class="op" id="3055194">:=</span>&nbsp;<span class="ident" id="3055197">readDirNames</span><span class="op" id="3055209">(</span><span class="ident" id="3055210">path</span><span class="op" id="3055214">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3055217">if</span>&nbsp;<span class="ident" id="3055220">err</span>&nbsp;<span class="op" id="3055224">!=</span>&nbsp;<span class="ident" id="3055227">nil</span>&nbsp;<span class="op" id="3055231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3055235">return</span>&nbsp;<span class="ident" id="3055242">walkFn</span><span class="op" id="3055248">(</span><span class="ident" id="3055249">path</span><span class="op" id="3055253">,</span>&nbsp;<span class="ident" id="3055255">info</span><span class="op" id="3055259">,</span>&nbsp;<span class="ident" id="3055261">err</span><span class="op" id="3055264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3055267">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3055271">for</span>&nbsp;<span class="ident" id="3055275">_</span><span class="op" id="3055276">,</span>&nbsp;<span class="ident" id="3055278">name</span>&nbsp;<span class="op" id="3055283">:=</span>&nbsp;<span class="keyword" id="3055286">range</span>&nbsp;<span class="ident" id="3055292">names</span>&nbsp;<span class="op" id="3055298">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3055302">filename</span>&nbsp;<span class="op" id="3055311">:=</span>&nbsp;<span class="ident" id="3055314">Join</span><span class="op" id="3055318">(</span><span class="ident" id="3055319">path</span><span class="op" id="3055323">,</span>&nbsp;<span class="ident" id="3055325">name</span><span class="op" id="3055329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3055333">fileInfo</span><span class="op" id="3055341">,</span>&nbsp;<span class="ident" id="3055343">err</span>&nbsp;<span class="op" id="3055347">:=</span>&nbsp;<span class="ident" id="3055350">lstat</span><span class="op" id="3055355">(</span><span class="ident" id="3055356">filename</span><span class="op" id="3055364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3055368">if</span>&nbsp;<span class="ident" id="3055371">err</span>&nbsp;<span class="op" id="3055375">!=</span>&nbsp;<span class="ident" id="3055378">nil</span>&nbsp;<span class="op" id="3055382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3055387">if</span>&nbsp;<span class="ident" id="3055390">err</span>&nbsp;<span class="op" id="3055394">:=</span>&nbsp;<span class="ident" id="3055397">walkFn</span><span class="op" id="3055403">(</span><span class="ident" id="3055404">filename</span><span class="op" id="3055412">,</span>&nbsp;<span class="ident" id="3055414">fileInfo</span><span class="op" id="3055422">,</span>&nbsp;<span class="ident" id="3055424">err</span><span class="op" id="3055427">)</span><span class="op" id="3055428">;</span>&nbsp;<span class="ident" id="3055430">err</span>&nbsp;<span class="op" id="3055434">!=</span>&nbsp;<span class="ident" id="3055437">nil</span>&nbsp;<span class="op" id="3055441">&amp;&amp;</span>&nbsp;<span class="ident" id="3055444">err</span>&nbsp;<span class="op" id="3055448">!=</span>&nbsp;<span class="ident" id="3055451">SkipDir</span>&nbsp;<span class="op" id="3055459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3055465">return</span>&nbsp;<span class="ident" id="3055472">err</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3055479">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3055483">}</span>&nbsp;<span class="keyword" id="3055485">else</span>&nbsp;<span class="op" id="3055490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3055495">err</span>&nbsp;<span class="op" id="3055499">=</span>&nbsp;<span class="ident" id="3055501">walk</span><span class="op" id="3055505">(</span><span class="ident" id="3055506">filename</span><span class="op" id="3055514">,</span>&nbsp;<span class="ident" id="3055516">fileInfo</span><span class="op" id="3055524">,</span>&nbsp;<span class="ident" id="3055526">walkFn</span><span class="op" id="3055532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3055537">if</span>&nbsp;<span class="ident" id="3055540">err</span>&nbsp;<span class="op" id="3055544">!=</span>&nbsp;<span class="ident" id="3055547">nil</span>&nbsp;<span class="op" id="3055551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3055557">if</span>&nbsp;<span class="op" id="3055560">!</span><span class="ident" id="3055561">fileInfo</span><span class="op" id="3055569">.</span><span class="ident" id="3055570">IsDir</span><span class="op" id="3055575">(</span><span class="op" id="3055576">)</span>&nbsp;<span class="op" id="3055578">||</span>&nbsp;<span class="ident" id="3055581">err</span>&nbsp;<span class="op" id="3055585">!=</span>&nbsp;<span class="ident" id="3055588">SkipDir</span>&nbsp;<span class="op" id="3055596">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3055603">return</span>&nbsp;<span class="ident" id="3055610">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3055618">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3055623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3055627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3055630">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3055633">return</span>&nbsp;<span class="ident" id="3055640">nil</span><br>
<span class="lineno"></span><span class="op" id="3055644">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3055647">//&nbsp;Walk&nbsp;walks&nbsp;the&nbsp;file&nbsp;tree&nbsp;rooted&nbsp;at&nbsp;root,&nbsp;calling&nbsp;walkFn&nbsp;for&nbsp;each&nbsp;file&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="3055723">//&nbsp;directory&nbsp;in&nbsp;the&nbsp;tree,&nbsp;including&nbsp;root.&nbsp;All&nbsp;errors&nbsp;that&nbsp;arise&nbsp;visiting&nbsp;files</span><br>
<span class="lineno">385</span><span class="comment" id="3055802">//&nbsp;and&nbsp;directories&nbsp;are&nbsp;filtered&nbsp;by&nbsp;walkFn.&nbsp;The&nbsp;files&nbsp;are&nbsp;walked&nbsp;in&nbsp;lexical</span><br>
<span class="lineno"></span><span class="comment" id="3055877">//&nbsp;order,&nbsp;which&nbsp;makes&nbsp;the&nbsp;output&nbsp;deterministic&nbsp;but&nbsp;means&nbsp;that&nbsp;for&nbsp;very</span><br>
<span class="lineno"></span><span class="comment" id="3055948">//&nbsp;large&nbsp;directories&nbsp;Walk&nbsp;can&nbsp;be&nbsp;inefficient.</span><br>
<span class="lineno"></span><span class="comment" id="3055994">//&nbsp;Walk&nbsp;does&nbsp;not&nbsp;follow&nbsp;symbolic&nbsp;links.</span><br>
<span class="lineno"></span><span class="keyword" id="3056034">func</span>&nbsp;<span class="ident" id="3056039">Walk</span><span class="op" id="3056043">(</span><span class="ident" id="3056044">root</span>&nbsp;<span class="builtintype" id="3056049">string</span><span class="op" id="3056055">,</span>&nbsp;<span class="ident" id="3056057">walkFn</span>&nbsp;<span class="ident" id="3056064">WalkFunc</span><span class="op" id="3056072">)</span>&nbsp;<span class="builtintype" id="3056074">error</span>&nbsp;<span class="op" id="3056080">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3056083">info</span><span class="op" id="3056087">,</span>&nbsp;<span class="ident" id="3056089">err</span>&nbsp;<span class="op" id="3056093">:=</span>&nbsp;<span class="ident" id="3056096">os</span><span class="op" id="3056098">.</span><span class="ident" id="3056099">Lstat</span><span class="op" id="3056104">(</span><span class="ident" id="3056105">root</span><span class="op" id="3056109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3056112">if</span>&nbsp;<span class="ident" id="3056115">err</span>&nbsp;<span class="op" id="3056119">!=</span>&nbsp;<span class="ident" id="3056122">nil</span>&nbsp;<span class="op" id="3056126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3056130">return</span>&nbsp;<span class="ident" id="3056137">walkFn</span><span class="op" id="3056143">(</span><span class="ident" id="3056144">root</span><span class="op" id="3056148">,</span>&nbsp;<span class="ident" id="3056150">nil</span><span class="op" id="3056153">,</span>&nbsp;<span class="ident" id="3056155">err</span><span class="op" id="3056158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3056161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3056164">return</span>&nbsp;<span class="ident" id="3056171">walk</span><span class="op" id="3056175">(</span><span class="ident" id="3056176">root</span><span class="op" id="3056180">,</span>&nbsp;<span class="ident" id="3056182">info</span><span class="op" id="3056186">,</span>&nbsp;<span class="ident" id="3056188">walkFn</span><span class="op" id="3056194">)</span><br>
<span class="lineno">395</span><span class="op" id="3056196">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3056199">//&nbsp;readDirNames&nbsp;reads&nbsp;the&nbsp;directory&nbsp;named&nbsp;by&nbsp;dirname&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="3056264">//&nbsp;a&nbsp;sorted&nbsp;list&nbsp;of&nbsp;directory&nbsp;entries.</span><br>
<span class="lineno"></span><span class="keyword" id="3056303">func</span>&nbsp;<span class="ident" id="3056308">readDirNames</span><span class="op" id="3056320">(</span><span class="ident" id="3056321">dirname</span>&nbsp;<span class="builtintype" id="3056329">string</span><span class="op" id="3056335">)</span>&nbsp;<span class="op" id="3056337">(</span><span class="op" id="3056338">[</span><span class="op" id="3056339">]</span><span class="builtintype" id="3056340">string</span><span class="op" id="3056346">,</span>&nbsp;<span class="builtintype" id="3056348">error</span><span class="op" id="3056353">)</span>&nbsp;<span class="op" id="3056355">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3056358">f</span><span class="op" id="3056359">,</span>&nbsp;<span class="ident" id="3056361">err</span>&nbsp;<span class="op" id="3056365">:=</span>&nbsp;<span class="ident" id="3056368">os</span><span class="op" id="3056370">.</span><span class="ident" id="3056371">Open</span><span class="op" id="3056375">(</span><span class="ident" id="3056376">dirname</span><span class="op" id="3056383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3056386">if</span>&nbsp;<span class="ident" id="3056389">err</span>&nbsp;<span class="op" id="3056393">!=</span>&nbsp;<span class="ident" id="3056396">nil</span>&nbsp;<span class="op" id="3056400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3056404">return</span>&nbsp;<span class="ident" id="3056411">nil</span><span class="op" id="3056414">,</span>&nbsp;<span class="ident" id="3056416">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3056421">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3056424">names</span><span class="op" id="3056429">,</span>&nbsp;<span class="ident" id="3056431">err</span>&nbsp;<span class="op" id="3056435">:=</span>&nbsp;<span class="ident" id="3056438">f</span><span class="op" id="3056439">.</span><span class="ident" id="3056440">Readdirnames</span><span class="op" id="3056452">(</span><span class="op" id="3056453">-</span><span class="num" id="3056454">1</span><span class="op" id="3056455">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3056458">f</span><span class="op" id="3056459">.</span><span class="ident" id="3056460">Close</span><span class="op" id="3056465">(</span><span class="op" id="3056466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3056469">if</span>&nbsp;<span class="ident" id="3056472">err</span>&nbsp;<span class="op" id="3056476">!=</span>&nbsp;<span class="ident" id="3056479">nil</span>&nbsp;<span class="op" id="3056483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3056487">return</span>&nbsp;<span class="ident" id="3056494">nil</span><span class="op" id="3056497">,</span>&nbsp;<span class="ident" id="3056499">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3056504">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3056507">sort</span><span class="op" id="3056511">.</span><span class="ident" id="3056512">Strings</span><span class="op" id="3056519">(</span><span class="ident" id="3056520">names</span><span class="op" id="3056525">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3056528">return</span>&nbsp;<span class="ident" id="3056535">names</span><span class="op" id="3056540">,</span>&nbsp;<span class="ident" id="3056542">nil</span><br>
<span class="lineno"></span><span class="op" id="3056546">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3056549">//&nbsp;Base&nbsp;returns&nbsp;the&nbsp;last&nbsp;element&nbsp;of&nbsp;path.</span><br>
<span class="lineno"></span><span class="comment" id="3056591">//&nbsp;Trailing&nbsp;path&nbsp;separators&nbsp;are&nbsp;removed&nbsp;before&nbsp;extracting&nbsp;the&nbsp;last&nbsp;element.</span><br>
<span class="lineno">415</span><span class="comment" id="3056667">//&nbsp;If&nbsp;the&nbsp;path&nbsp;is&nbsp;empty,&nbsp;Base&nbsp;returns&nbsp;&#34;.&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3056710">//&nbsp;If&nbsp;the&nbsp;path&nbsp;consists&nbsp;entirely&nbsp;of&nbsp;separators,&nbsp;Base&nbsp;returns&nbsp;a&nbsp;single&nbsp;separator.</span><br>
<span class="lineno"></span><span class="keyword" id="3056791">func</span>&nbsp;<span class="ident" id="3056796">Base</span><span class="op" id="3056800">(</span><span class="ident" id="3056801">path</span>&nbsp;<span class="builtintype" id="3056806">string</span><span class="op" id="3056812">)</span>&nbsp;<span class="builtintype" id="3056814">string</span>&nbsp;<span class="op" id="3056821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3056824">if</span>&nbsp;<span class="ident" id="3056827">path</span>&nbsp;<span class="op" id="3056832">==</span>&nbsp;<span class="string" id="3056835">&#34;&#34;</span>&nbsp;<span class="op" id="3056838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3056842">return</span>&nbsp;<span class="string" id="3056849">&#34;.&#34;</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3056854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3056857">//&nbsp;Strip&nbsp;trailing&nbsp;slashes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3056885">for</span>&nbsp;<span class="builtinfunc" id="3056889">len</span><span class="op" id="3056892">(</span><span class="ident" id="3056893">path</span><span class="op" id="3056897">)</span>&nbsp;<span class="op" id="3056899">&gt;</span>&nbsp;<span class="num" id="3056901">0</span>&nbsp;<span class="op" id="3056903">&amp;&amp;</span>&nbsp;<span class="ident" id="3056906">os</span><span class="op" id="3056908">.</span><span class="ident" id="3056909">IsPathSeparator</span><span class="op" id="3056924">(</span><span class="ident" id="3056925">path</span><span class="op" id="3056929">[</span><span class="builtinfunc" id="3056930">len</span><span class="op" id="3056933">(</span><span class="ident" id="3056934">path</span><span class="op" id="3056938">)</span><span class="op" id="3056939">-</span><span class="num" id="3056940">1</span><span class="op" id="3056941">]</span><span class="op" id="3056942">)</span>&nbsp;<span class="op" id="3056944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3056948">path</span>&nbsp;<span class="op" id="3056953">=</span>&nbsp;<span class="ident" id="3056955">path</span><span class="op" id="3056959">[</span><span class="num" id="3056960">0</span>&nbsp;<span class="op" id="3056962">:</span>&nbsp;<span class="builtinfunc" id="3056964">len</span><span class="op" id="3056967">(</span><span class="ident" id="3056968">path</span><span class="op" id="3056972">)</span><span class="op" id="3056973">-</span><span class="num" id="3056974">1</span><span class="op" id="3056975">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3056978">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3056981">//&nbsp;Throw&nbsp;away&nbsp;volume&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3057008">path</span>&nbsp;<span class="op" id="3057013">=</span>&nbsp;<span class="ident" id="3057015">path</span><span class="op" id="3057019">[</span><span class="builtinfunc" id="3057020">len</span><span class="op" id="3057023">(</span><span class="ident" id="3057024">VolumeName</span><span class="op" id="3057034">(</span><span class="ident" id="3057035">path</span><span class="op" id="3057039">)</span><span class="op" id="3057040">)</span><span class="op" id="3057041">:</span><span class="op" id="3057042">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3057045">//&nbsp;Find&nbsp;the&nbsp;last&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3057071">i</span>&nbsp;<span class="op" id="3057073">:=</span>&nbsp;<span class="builtinfunc" id="3057076">len</span><span class="op" id="3057079">(</span><span class="ident" id="3057080">path</span><span class="op" id="3057084">)</span>&nbsp;<span class="op" id="3057086">-</span>&nbsp;<span class="num" id="3057088">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3057091">for</span>&nbsp;<span class="ident" id="3057095">i</span>&nbsp;<span class="op" id="3057097">&gt;=</span>&nbsp;<span class="num" id="3057100">0</span>&nbsp;<span class="op" id="3057102">&amp;&amp;</span>&nbsp;<span class="op" id="3057105">!</span><span class="ident" id="3057106">os</span><span class="op" id="3057108">.</span><span class="ident" id="3057109">IsPathSeparator</span><span class="op" id="3057124">(</span><span class="ident" id="3057125">path</span><span class="op" id="3057129">[</span><span class="ident" id="3057130">i</span><span class="op" id="3057131">]</span><span class="op" id="3057132">)</span>&nbsp;<span class="op" id="3057134">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3057138">i</span><span class="op" id="3057139">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3057143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3057146">if</span>&nbsp;<span class="ident" id="3057149">i</span>&nbsp;<span class="op" id="3057151">&gt;=</span>&nbsp;<span class="num" id="3057154">0</span>&nbsp;<span class="op" id="3057156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3057160">path</span>&nbsp;<span class="op" id="3057165">=</span>&nbsp;<span class="ident" id="3057167">path</span><span class="op" id="3057171">[</span><span class="ident" id="3057172">i</span><span class="op" id="3057173">+</span><span class="num" id="3057174">1</span><span class="op" id="3057175">:</span><span class="op" id="3057176">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3057179">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3057182">//&nbsp;If&nbsp;empty&nbsp;now,&nbsp;it&nbsp;had&nbsp;only&nbsp;slashes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3057221">if</span>&nbsp;<span class="ident" id="3057224">path</span>&nbsp;<span class="op" id="3057229">==</span>&nbsp;<span class="string" id="3057232">&#34;&#34;</span>&nbsp;<span class="op" id="3057235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3057239">return</span>&nbsp;<span class="builtintype" id="3057246">string</span><span class="op" id="3057252">(</span><span class="ident" id="3057253">Separator</span><span class="op" id="3057262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3057265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3057268">return</span>&nbsp;<span class="ident" id="3057275">path</span><br>
<span class="lineno">440</span><span class="op" id="3057280">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3057283">//&nbsp;Dir&nbsp;returns&nbsp;all&nbsp;but&nbsp;the&nbsp;last&nbsp;element&nbsp;of&nbsp;path,&nbsp;typically&nbsp;the&nbsp;path&#39;s&nbsp;directory.</span><br>
<span class="lineno"></span><span class="comment" id="3057364">//&nbsp;After&nbsp;dropping&nbsp;the&nbsp;final&nbsp;element,&nbsp;the&nbsp;path&nbsp;is&nbsp;Cleaned&nbsp;and&nbsp;trailing</span><br>
<span class="lineno"></span><span class="comment" id="3057434">//&nbsp;slashes&nbsp;are&nbsp;removed.</span><br>
<span class="lineno">445</span><span class="comment" id="3057458">//&nbsp;If&nbsp;the&nbsp;path&nbsp;is&nbsp;empty,&nbsp;Dir&nbsp;returns&nbsp;&#34;.&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3057500">//&nbsp;If&nbsp;the&nbsp;path&nbsp;consists&nbsp;entirely&nbsp;of&nbsp;separators,&nbsp;Dir&nbsp;returns&nbsp;a&nbsp;single&nbsp;separator.</span><br>
<span class="lineno"></span><span class="comment" id="3057580">//&nbsp;The&nbsp;returned&nbsp;path&nbsp;does&nbsp;not&nbsp;end&nbsp;in&nbsp;a&nbsp;separator&nbsp;unless&nbsp;it&nbsp;is&nbsp;the&nbsp;root&nbsp;directory.</span><br>
<span class="lineno"></span><span class="keyword" id="3057662">func</span>&nbsp;<span class="ident" id="3057667">Dir</span><span class="op" id="3057670">(</span><span class="ident" id="3057671">path</span>&nbsp;<span class="builtintype" id="3057676">string</span><span class="op" id="3057682">)</span>&nbsp;<span class="builtintype" id="3057684">string</span>&nbsp;<span class="op" id="3057691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3057694">vol</span>&nbsp;<span class="op" id="3057698">:=</span>&nbsp;<span class="ident" id="3057701">VolumeName</span><span class="op" id="3057711">(</span><span class="ident" id="3057712">path</span><span class="op" id="3057716">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3057719">i</span>&nbsp;<span class="op" id="3057721">:=</span>&nbsp;<span class="builtinfunc" id="3057724">len</span><span class="op" id="3057727">(</span><span class="ident" id="3057728">path</span><span class="op" id="3057732">)</span>&nbsp;<span class="op" id="3057734">-</span>&nbsp;<span class="num" id="3057736">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3057739">for</span>&nbsp;<span class="ident" id="3057743">i</span>&nbsp;<span class="op" id="3057745">&gt;=</span>&nbsp;<span class="builtinfunc" id="3057748">len</span><span class="op" id="3057751">(</span><span class="ident" id="3057752">vol</span><span class="op" id="3057755">)</span>&nbsp;<span class="op" id="3057757">&amp;&amp;</span>&nbsp;<span class="op" id="3057760">!</span><span class="ident" id="3057761">os</span><span class="op" id="3057763">.</span><span class="ident" id="3057764">IsPathSeparator</span><span class="op" id="3057779">(</span><span class="ident" id="3057780">path</span><span class="op" id="3057784">[</span><span class="ident" id="3057785">i</span><span class="op" id="3057786">]</span><span class="op" id="3057787">)</span>&nbsp;<span class="op" id="3057789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3057793">i</span><span class="op" id="3057794">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3057798">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3057801">dir</span>&nbsp;<span class="op" id="3057805">:=</span>&nbsp;<span class="ident" id="3057808">Clean</span><span class="op" id="3057813">(</span><span class="ident" id="3057814">path</span><span class="op" id="3057818">[</span><span class="builtinfunc" id="3057819">len</span><span class="op" id="3057822">(</span><span class="ident" id="3057823">vol</span><span class="op" id="3057826">)</span>&nbsp;<span class="op" id="3057828">:</span>&nbsp;<span class="ident" id="3057830">i</span><span class="op" id="3057831">+</span><span class="num" id="3057832">1</span><span class="op" id="3057833">]</span><span class="op" id="3057834">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3057837">return</span>&nbsp;<span class="ident" id="3057844">vol</span>&nbsp;<span class="op" id="3057848">+</span>&nbsp;<span class="ident" id="3057850">dir</span><br>
<span class="lineno"></span><span class="op" id="3057854">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3057857">//&nbsp;VolumeName&nbsp;returns&nbsp;leading&nbsp;volume&nbsp;name.</span><br>
<span class="lineno"></span><span class="comment" id="3057900">//&nbsp;Given&nbsp;&#34;C:\foo\bar&#34;&nbsp;it&nbsp;returns&nbsp;&#34;C:&#34;&nbsp;under&nbsp;windows.</span><br>
<span class="lineno">460</span><span class="comment" id="3057953">//&nbsp;Given&nbsp;&#34;\\host\share\foo&#34;&nbsp;it&nbsp;returns&nbsp;&#34;\\host\share&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3058008">//&nbsp;On&nbsp;other&nbsp;platforms&nbsp;it&nbsp;returns&nbsp;&#34;&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3058045">func</span>&nbsp;<span class="ident" id="3058050">VolumeName</span><span class="op" id="3058060">(</span><span class="ident" id="3058061">path</span>&nbsp;<span class="builtintype" id="3058066">string</span><span class="op" id="3058072">)</span>&nbsp;<span class="op" id="3058074">(</span><span class="ident" id="3058075">v</span>&nbsp;<span class="builtintype" id="3058077">string</span><span class="op" id="3058083">)</span>&nbsp;<span class="op" id="3058085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3058088">return</span>&nbsp;<span class="ident" id="3058095">path</span><span class="op" id="3058099">[</span><span class="op" id="3058100">:</span><span class="ident" id="3058101">volumeNameLen</span><span class="op" id="3058114">(</span><span class="ident" id="3058115">path</span><span class="op" id="3058119">)</span><span class="op" id="3058120">]</span><br>
<span class="lineno"></span><span class="op" id="3058122">}</span>
</div>
</body>
</html>
