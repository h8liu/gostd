<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4011367">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4011423">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4011477">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4011528">package</span>&nbsp;<span class="ident" id="4011536">rand</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4011542">import</span>&nbsp;<span class="op" id="4011549">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4011552">&#34;internal/syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4011572">&#34;sync&#34;</span><br>
<span class="lineno">10</span><span class="op" id="4011579">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4011582">func</span>&nbsp;<span class="ident" id="4011587">init</span><span class="op" id="4011591">(</span><span class="op" id="4011592">)</span>&nbsp;<span class="op" id="4011594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4011597"><a href="/crypto/rand/rand_unix.go.html#4013172">altGetRandom</a></span>&nbsp;<span class="op" id="4011610">=</span>&nbsp;<span class="ident" id="4011612"><a href="/crypto/rand/rand_linux.go.html#4012090">getRandomLinux</a></span><br>
<span class="lineno"></span><span class="op" id="4011627">}</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="4011630">var</span>&nbsp;<span class="op" id="4011634">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4011637">once</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4011648"><a href="/crypto/rand/rand_linux.go.html#4011572">sync</a></span><span class="op" id="4011652">.</span><span class="ident" id="4011653">Once</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4011659">useSyscall</span>&nbsp;<span class="builtintype" id="4011670">bool</span><br>
<span class="lineno"></span><span class="op" id="4011675">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="4011678">func</span>&nbsp;<span class="ident" id="4011683">pickStrategy</span><span class="op" id="4011695">(</span><span class="op" id="4011696">)</span>&nbsp;<span class="op" id="4011698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4011701">//&nbsp;Test&nbsp;whether&nbsp;we&nbsp;should&nbsp;use&nbsp;the&nbsp;system&nbsp;call&nbsp;or&nbsp;/dev/urandom.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4011765">//&nbsp;We&#39;ll&nbsp;fall&nbsp;back&nbsp;to&nbsp;urandom&nbsp;if:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4011800">//&nbsp;-&nbsp;the&nbsp;kernel&nbsp;is&nbsp;too&nbsp;old&nbsp;(before&nbsp;3.17)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4011842">//&nbsp;-&nbsp;the&nbsp;machine&nbsp;has&nbsp;no&nbsp;entropy&nbsp;available&nbsp;(early&nbsp;boot&nbsp;+&nbsp;no&nbsp;hardware</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4011911">//&nbsp;&nbsp;&nbsp;entropy&nbsp;source?)&nbsp;and&nbsp;we&nbsp;want&nbsp;to&nbsp;avoid&nbsp;blocking&nbsp;later.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4011971">var</span>&nbsp;<span class="ident" id="4011975">buf</span>&nbsp;<span class="op" id="4011979">[</span><span class="num" id="4011980">1</span><span class="op" id="4011981">]</span><span class="builtintype" id="4011982">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4011988">n</span><span class="op" id="4011989">,</span>&nbsp;<span class="ident" id="4011991">err</span>&nbsp;<span class="op" id="4011995">:=</span>&nbsp;<span class="ident" id="4011998"><a href="/crypto/rand/rand_linux.go.html#4011552">syscall</a></span><span class="op" id="4012005">.</span><span class="ident" id="4012006">GetRandom</span><span class="op" id="4012015">(</span><span class="ident" id="4012016"><a href="/crypto/rand/rand_linux.go.html#4011975">buf</a></span><span class="op" id="4012019">[</span><span class="op" id="4012020">:</span><span class="op" id="4012021">]</span><span class="op" id="4012022">,</span>&nbsp;<span class="ident" id="4012024"><a href="/crypto/rand/rand_linux.go.html#4011552">syscall</a></span><span class="op" id="4012031">.</span><span class="ident" id="4012032">GRND_NONBLOCK</span><span class="op" id="4012045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4012048"><a href="/crypto/rand/rand_linux.go.html#4011659">useSyscall</a></span>&nbsp;<span class="op" id="4012059">=</span>&nbsp;<span class="ident" id="4012061"><a href="/crypto/rand/rand_linux.go.html#4011988">n</a></span>&nbsp;<span class="op" id="4012063">==</span>&nbsp;<span class="num" id="4012066">1</span>&nbsp;<span class="op" id="4012068">&amp;&amp;</span>&nbsp;<span class="ident" id="4012071"><a href="/crypto/rand/rand_linux.go.html#4011991">err</a></span>&nbsp;<span class="op" id="4012075">==</span>&nbsp;<span class="ident" id="4012078">nil</span><br>
<span class="lineno">30</span><span class="op" id="4012082">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4012085">func</span>&nbsp;<span class="ident" id="4012090">getRandomLinux</span><span class="op" id="4012104">(</span><span class="ident" id="4012105">p</span>&nbsp;<span class="op" id="4012107">[</span><span class="op" id="4012108">]</span><span class="builtintype" id="4012109">byte</span><span class="op" id="4012113">)</span>&nbsp;<span class="op" id="4012115">(</span><span class="ident" id="4012116">ok</span>&nbsp;<span class="builtintype" id="4012119">bool</span><span class="op" id="4012123">)</span>&nbsp;<span class="op" id="4012125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4012128"><a href="/crypto/rand/rand_linux.go.html#4011637">once</a></span><span class="op" id="4012132">.</span><span class="ident" id="4012133">Do</span><span class="op" id="4012135">(</span><span class="ident" id="4012136"><a href="/crypto/rand/rand_linux.go.html#4011683">pickStrategy</a></span><span class="op" id="4012148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4012151">if</span>&nbsp;<span class="op" id="4012154">!</span><span class="ident" id="4012155"><a href="/crypto/rand/rand_linux.go.html#4011659">useSyscall</a></span>&nbsp;<span class="op" id="4012166">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4012170">return</span>&nbsp;<span class="ident" id="4012177">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4012184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4012187">n</span><span class="op" id="4012188">,</span>&nbsp;<span class="ident" id="4012190">err</span>&nbsp;<span class="op" id="4012194">:=</span>&nbsp;<span class="ident" id="4012197"><a href="/crypto/rand/rand_linux.go.html#4011552">syscall</a></span><span class="op" id="4012204">.</span><span class="ident" id="4012205">GetRandom</span><span class="op" id="4012214">(</span><span class="ident" id="4012215"><a href="/crypto/rand/rand_linux.go.html#4012105">p</a></span><span class="op" id="4012216">,</span>&nbsp;<span class="num" id="4012218">0</span><span class="op" id="4012219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4012222">return</span>&nbsp;<span class="ident" id="4012229"><a href="/crypto/rand/rand_linux.go.html#4012187">n</a></span>&nbsp;<span class="op" id="4012231">==</span>&nbsp;<span class="builtinfunc" id="4012234">len</span><span class="op" id="4012237">(</span><span class="ident" id="4012238"><a href="/crypto/rand/rand_linux.go.html#4012105">p</a></span><span class="op" id="4012239">)</span>&nbsp;<span class="op" id="4012241">&amp;&amp;</span>&nbsp;<span class="ident" id="4012244"><a href="/crypto/rand/rand_linux.go.html#4012190">err</a></span>&nbsp;<span class="op" id="4012248">==</span>&nbsp;<span class="ident" id="4012251">nil</span><br>
<span class="lineno"></span><span class="op" id="4012255">}</span>
</div>
</body>
</html>
