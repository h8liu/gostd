<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="8053655">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8053710">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8053764">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8053815">package</span>&nbsp;<span class="ident" id="8053823">fcgi</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8053829">import</span>&nbsp;<span class="op" id="8053836">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8053839">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8053848">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8053858">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8053864">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8053874">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8053877">var</span>&nbsp;<span class="ident" id="8053881">sizeTests</span>&nbsp;<span class="op" id="8053891">=</span>&nbsp;<span class="op" id="8053893">[</span><span class="op" id="8053894">]</span><span class="keyword" id="8053895">struct</span>&nbsp;<span class="op" id="8053902">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8053905">size</span>&nbsp;&nbsp;<span class="builtintype" id="8053911">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8053919">bytes</span>&nbsp;<span class="op" id="8053925">[</span><span class="op" id="8053926">]</span><span class="builtintype" id="8053927">byte</span><br>
<span class="lineno"></span><span class="op" id="8053932">}</span><span class="op" id="8053933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8053936">{</span><span class="num" id="8053937">0</span><span class="op" id="8053938">,</span>&nbsp;<span class="op" id="8053940">[</span><span class="op" id="8053941">]</span><span class="builtintype" id="8053942">byte</span><span class="op" id="8053946">{</span><span class="num" id="8053947">0x00</span><span class="op" id="8053951">}</span><span class="op" id="8053952">}</span><span class="op" id="8053953">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8053956">{</span><span class="num" id="8053957">127</span><span class="op" id="8053960">,</span>&nbsp;<span class="op" id="8053962">[</span><span class="op" id="8053963">]</span><span class="builtintype" id="8053964">byte</span><span class="op" id="8053968">{</span><span class="num" id="8053969">0x7F</span><span class="op" id="8053973">}</span><span class="op" id="8053974">}</span><span class="op" id="8053975">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8053978">{</span><span class="num" id="8053979">128</span><span class="op" id="8053982">,</span>&nbsp;<span class="op" id="8053984">[</span><span class="op" id="8053985">]</span><span class="builtintype" id="8053986">byte</span><span class="op" id="8053990">{</span><span class="num" id="8053991">0x80</span><span class="op" id="8053995">,</span>&nbsp;<span class="num" id="8053997">0x00</span><span class="op" id="8054001">,</span>&nbsp;<span class="num" id="8054003">0x00</span><span class="op" id="8054007">,</span>&nbsp;<span class="num" id="8054009">0x80</span><span class="op" id="8054013">}</span><span class="op" id="8054014">}</span><span class="op" id="8054015">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8054018">{</span><span class="num" id="8054019">1000</span><span class="op" id="8054023">,</span>&nbsp;<span class="op" id="8054025">[</span><span class="op" id="8054026">]</span><span class="builtintype" id="8054027">byte</span><span class="op" id="8054031">{</span><span class="num" id="8054032">0x80</span><span class="op" id="8054036">,</span>&nbsp;<span class="num" id="8054038">0x00</span><span class="op" id="8054042">,</span>&nbsp;<span class="num" id="8054044">0x03</span><span class="op" id="8054048">,</span>&nbsp;<span class="num" id="8054050">0xE8</span><span class="op" id="8054054">}</span><span class="op" id="8054055">}</span><span class="op" id="8054056">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8054059">{</span><span class="num" id="8054060">33554431</span><span class="op" id="8054068">,</span>&nbsp;<span class="op" id="8054070">[</span><span class="op" id="8054071">]</span><span class="builtintype" id="8054072">byte</span><span class="op" id="8054076">{</span><span class="num" id="8054077">0x81</span><span class="op" id="8054081">,</span>&nbsp;<span class="num" id="8054083">0xFF</span><span class="op" id="8054087">,</span>&nbsp;<span class="num" id="8054089">0xFF</span><span class="op" id="8054093">,</span>&nbsp;<span class="num" id="8054095">0xFF</span><span class="op" id="8054099">}</span><span class="op" id="8054100">}</span><span class="op" id="8054101">,</span><br>
<span class="lineno"></span><span class="op" id="8054103">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="8054106">func</span>&nbsp;<span class="ident" id="8054111">TestSize</span><span class="op" id="8054119">(</span><span class="ident" id="8054120">t</span>&nbsp;<span class="op" id="8054122">*</span><span class="ident" id="8054123"><a href="/net/http/fcgi/fcgi_test.go.html#8053864">testing</a></span><span class="op" id="8054130">.</span><span class="ident" id="8054131">T</span><span class="op" id="8054132">)</span>&nbsp;<span class="op" id="8054134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8054137">b</span>&nbsp;<span class="op" id="8054139">:=</span>&nbsp;<span class="builtinfunc" id="8054142">make</span><span class="op" id="8054146">(</span><span class="op" id="8054147">[</span><span class="op" id="8054148">]</span><span class="builtintype" id="8054149">byte</span><span class="op" id="8054153">,</span>&nbsp;<span class="num" id="8054155">4</span><span class="op" id="8054156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8054159">for</span>&nbsp;<span class="ident" id="8054163">i</span><span class="op" id="8054164">,</span>&nbsp;<span class="ident" id="8054166">test</span>&nbsp;<span class="op" id="8054171">:=</span>&nbsp;<span class="keyword" id="8054174">range</span>&nbsp;<span class="ident" id="8054180"><a href="/net/http/fcgi/fcgi_test.go.html#8053881">sizeTests</a></span>&nbsp;<span class="op" id="8054190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8054194">n</span>&nbsp;<span class="op" id="8054196">:=</span>&nbsp;<span class="ident" id="8054199"><a href="/net/http/fcgi/fcgi.go.html#6111711">encodeSize</a></span><span class="op" id="8054209">(</span><span class="ident" id="8054210"><a href="/net/http/fcgi/fcgi_test.go.html#8054137">b</a></span><span class="op" id="8054211">,</span>&nbsp;<span class="ident" id="8054213"><a href="/net/http/fcgi/fcgi_test.go.html#8054166">test</a></span><span class="op" id="8054217">.</span><span class="ident" id="8054218">size</span><span class="op" id="8054222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8054226">if</span>&nbsp;<span class="op" id="8054229">!</span><span class="ident" id="8054230"><a href="/net/http/fcgi/fcgi_test.go.html#8053839">bytes</a></span><span class="op" id="8054235">.</span><span class="ident" id="8054236">Equal</span><span class="op" id="8054241">(</span><span class="ident" id="8054242"><a href="/net/http/fcgi/fcgi_test.go.html#8054137">b</a></span><span class="op" id="8054243">[</span><span class="op" id="8054244">:</span><span class="ident" id="8054245"><a href="/net/http/fcgi/fcgi_test.go.html#8054194">n</a></span><span class="op" id="8054246">]</span><span class="op" id="8054247">,</span>&nbsp;<span class="ident" id="8054249"><a href="/net/http/fcgi/fcgi_test.go.html#8054166">test</a></span><span class="op" id="8054253">.</span><span class="ident" id="8054254">bytes</span><span class="op" id="8054259">)</span>&nbsp;<span class="op" id="8054261">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8054266"><a href="/net/http/fcgi/fcgi_test.go.html#8054120">t</a></span><span class="op" id="8054267">.</span><span class="ident" id="8054268">Errorf</span><span class="op" id="8054274">(</span><span class="string" id="8054275">&#34;%d&nbsp;expected&nbsp;%x,&nbsp;encoded&nbsp;%x&#34;</span><span class="op" id="8054303">,</span>&nbsp;<span class="ident" id="8054305"><a href="/net/http/fcgi/fcgi_test.go.html#8054163">i</a></span><span class="op" id="8054306">,</span>&nbsp;<span class="ident" id="8054308"><a href="/net/http/fcgi/fcgi_test.go.html#8054166">test</a></span><span class="op" id="8054312">.</span><span class="ident" id="8054313">bytes</span><span class="op" id="8054318">,</span>&nbsp;<span class="ident" id="8054320"><a href="/net/http/fcgi/fcgi_test.go.html#8054137">b</a></span><span class="op" id="8054321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8054325">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8054329">size</span><span class="op" id="8054333">,</span>&nbsp;<span class="ident" id="8054335"><a href="/net/http/fcgi/fcgi_test.go.html#8054194">n</a></span>&nbsp;<span class="op" id="8054337">:=</span>&nbsp;<span class="ident" id="8054340"><a href="/net/http/fcgi/fcgi.go.html#6111344">readSize</a></span><span class="op" id="8054348">(</span><span class="ident" id="8054349"><a href="/net/http/fcgi/fcgi_test.go.html#8054166">test</a></span><span class="op" id="8054353">.</span><span class="ident" id="8054354">bytes</span><span class="op" id="8054359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8054363">if</span>&nbsp;<span class="ident" id="8054366"><a href="/net/http/fcgi/fcgi_test.go.html#8054329">size</a></span>&nbsp;<span class="op" id="8054371">!=</span>&nbsp;<span class="ident" id="8054374"><a href="/net/http/fcgi/fcgi_test.go.html#8054166">test</a></span><span class="op" id="8054378">.</span><span class="ident" id="8054379">size</span>&nbsp;<span class="op" id="8054384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8054389"><a href="/net/http/fcgi/fcgi_test.go.html#8054120">t</a></span><span class="op" id="8054390">.</span><span class="ident" id="8054391">Errorf</span><span class="op" id="8054397">(</span><span class="string" id="8054398">&#34;%d&nbsp;expected&nbsp;%d,&nbsp;read&nbsp;%d&#34;</span><span class="op" id="8054423">,</span>&nbsp;<span class="ident" id="8054425"><a href="/net/http/fcgi/fcgi_test.go.html#8054163">i</a></span><span class="op" id="8054426">,</span>&nbsp;<span class="ident" id="8054428"><a href="/net/http/fcgi/fcgi_test.go.html#8054166">test</a></span><span class="op" id="8054432">.</span><span class="ident" id="8054433">size</span><span class="op" id="8054437">,</span>&nbsp;<span class="ident" id="8054439"><a href="/net/http/fcgi/fcgi_test.go.html#8054329">size</a></span><span class="op" id="8054443">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8054447">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8054451">if</span>&nbsp;<span class="builtinfunc" id="8054454">len</span><span class="op" id="8054457">(</span><span class="ident" id="8054458"><a href="/net/http/fcgi/fcgi_test.go.html#8054166">test</a></span><span class="op" id="8054462">.</span><span class="ident" id="8054463">bytes</span><span class="op" id="8054468">)</span>&nbsp;<span class="op" id="8054470">!=</span>&nbsp;<span class="ident" id="8054473"><a href="/net/http/fcgi/fcgi_test.go.html#8054194">n</a></span>&nbsp;<span class="op" id="8054475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8054480"><a href="/net/http/fcgi/fcgi_test.go.html#8054120">t</a></span><span class="op" id="8054481">.</span><span class="ident" id="8054482">Errorf</span><span class="op" id="8054488">(</span><span class="string" id="8054489">&#34;%d&nbsp;did&nbsp;not&nbsp;consume&nbsp;all&nbsp;the&nbsp;bytes&#34;</span><span class="op" id="8054523">,</span>&nbsp;<span class="ident" id="8054525"><a href="/net/http/fcgi/fcgi_test.go.html#8054163">i</a></span><span class="op" id="8054526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8054530">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8054533">}</span><br>
<span class="lineno">40</span><span class="op" id="8054535">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8054538">var</span>&nbsp;<span class="ident" id="8054542">streamTests</span>&nbsp;<span class="op" id="8054554">=</span>&nbsp;<span class="op" id="8054556">[</span><span class="op" id="8054557">]</span><span class="keyword" id="8054558">struct</span>&nbsp;<span class="op" id="8054565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8054568">desc</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8054576">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8054584">recType</span>&nbsp;<span class="ident" id="8054592"><a href="/net/http/fcgi/fcgi.go.html#6107550">recType</a></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8054601">reqId</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8054609">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8054617">content</span>&nbsp;<span class="op" id="8054625">[</span><span class="op" id="8054626">]</span><span class="builtintype" id="8054627">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8054633">raw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8054641">[</span><span class="op" id="8054642">]</span><span class="builtintype" id="8054643">byte</span><br>
<span class="lineno"></span><span class="op" id="8054648">}</span><span class="op" id="8054649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8054652">{</span><span class="string" id="8054653">&#34;single&nbsp;record&#34;</span><span class="op" id="8054668">,</span>&nbsp;<span class="ident" id="8054670"><a href="/net/http/fcgi/fcgi.go.html#6107739">typeStdout</a></span><span class="op" id="8054680">,</span>&nbsp;<span class="num" id="8054682">1</span><span class="op" id="8054683">,</span>&nbsp;<span class="ident" id="8054685">nil</span><span class="op" id="8054688">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8054692">[</span><span class="op" id="8054693">]</span><span class="builtintype" id="8054694">byte</span><span class="op" id="8054698">{</span><span class="num" id="8054699">1</span><span class="op" id="8054700">,</span>&nbsp;<span class="builtintype" id="8054702">byte</span><span class="op" id="8054706">(</span><span class="ident" id="8054707"><a href="/net/http/fcgi/fcgi.go.html#6107739">typeStdout</a></span><span class="op" id="8054717">)</span><span class="op" id="8054718">,</span>&nbsp;<span class="num" id="8054720">0</span><span class="op" id="8054721">,</span>&nbsp;<span class="num" id="8054723">1</span><span class="op" id="8054724">,</span>&nbsp;<span class="num" id="8054726">0</span><span class="op" id="8054727">,</span>&nbsp;<span class="num" id="8054729">0</span><span class="op" id="8054730">,</span>&nbsp;<span class="num" id="8054732">0</span><span class="op" id="8054733">,</span>&nbsp;<span class="num" id="8054735">0</span><span class="op" id="8054736">}</span><span class="op" id="8054737">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8054740">}</span><span class="op" id="8054741">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8054744">//&nbsp;this&nbsp;data&nbsp;will&nbsp;have&nbsp;to&nbsp;be&nbsp;split&nbsp;into&nbsp;two&nbsp;records</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8054797">{</span><span class="string" id="8054798">&#34;two&nbsp;records&#34;</span><span class="op" id="8054811">,</span>&nbsp;<span class="ident" id="8054813"><a href="/net/http/fcgi/fcgi.go.html#6107706">typeStdin</a></span><span class="op" id="8054822">,</span>&nbsp;<span class="num" id="8054824">300</span><span class="op" id="8054827">,</span>&nbsp;<span class="builtinfunc" id="8054829">make</span><span class="op" id="8054833">(</span><span class="op" id="8054834">[</span><span class="op" id="8054835">]</span><span class="builtintype" id="8054836">byte</span><span class="op" id="8054840">,</span>&nbsp;<span class="num" id="8054842">66000</span><span class="op" id="8054847">)</span><span class="op" id="8054848">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8054852"><a href="/net/http/fcgi/fcgi_test.go.html#8053839">bytes</a></span><span class="op" id="8054857">.</span><span class="ident" id="8054858">Join</span><span class="op" id="8054862">(</span><span class="op" id="8054863">[</span><span class="op" id="8054864">]</span><span class="op" id="8054865">[</span><span class="op" id="8054866">]</span><span class="builtintype" id="8054867">byte</span><span class="op" id="8054871">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8054876">//&nbsp;header&nbsp;for&nbsp;the&nbsp;first&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8054910">{</span><span class="num" id="8054911">1</span><span class="op" id="8054912">,</span>&nbsp;<span class="builtintype" id="8054914">byte</span><span class="op" id="8054918">(</span><span class="ident" id="8054919"><a href="/net/http/fcgi/fcgi.go.html#6107706">typeStdin</a></span><span class="op" id="8054928">)</span><span class="op" id="8054929">,</span>&nbsp;<span class="num" id="8054931">0x01</span><span class="op" id="8054935">,</span>&nbsp;<span class="num" id="8054937">0x2C</span><span class="op" id="8054941">,</span>&nbsp;<span class="num" id="8054943">0xFF</span><span class="op" id="8054947">,</span>&nbsp;<span class="num" id="8054949">0xFF</span><span class="op" id="8054953">,</span>&nbsp;<span class="num" id="8054955">1</span><span class="op" id="8054956">,</span>&nbsp;<span class="num" id="8054958">0</span><span class="op" id="8054959">}</span><span class="op" id="8054960">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8054965">make</span><span class="op" id="8054969">(</span><span class="op" id="8054970">[</span><span class="op" id="8054971">]</span><span class="builtintype" id="8054972">byte</span><span class="op" id="8054976">,</span>&nbsp;<span class="num" id="8054978">65536</span><span class="op" id="8054983">)</span><span class="op" id="8054984">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8054989">//&nbsp;header&nbsp;for&nbsp;the&nbsp;second</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8055017">{</span><span class="num" id="8055018">1</span><span class="op" id="8055019">,</span>&nbsp;<span class="builtintype" id="8055021">byte</span><span class="op" id="8055025">(</span><span class="ident" id="8055026"><a href="/net/http/fcgi/fcgi.go.html#6107706">typeStdin</a></span><span class="op" id="8055035">)</span><span class="op" id="8055036">,</span>&nbsp;<span class="num" id="8055038">0x01</span><span class="op" id="8055042">,</span>&nbsp;<span class="num" id="8055044">0x2C</span><span class="op" id="8055048">,</span>&nbsp;<span class="num" id="8055050">0x01</span><span class="op" id="8055054">,</span>&nbsp;<span class="num" id="8055056">0xD1</span><span class="op" id="8055060">,</span>&nbsp;<span class="num" id="8055062">7</span><span class="op" id="8055063">,</span>&nbsp;<span class="num" id="8055065">0</span><span class="op" id="8055066">}</span><span class="op" id="8055067">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8055072">make</span><span class="op" id="8055076">(</span><span class="op" id="8055077">[</span><span class="op" id="8055078">]</span><span class="builtintype" id="8055079">byte</span><span class="op" id="8055083">,</span>&nbsp;<span class="num" id="8055085">472</span><span class="op" id="8055088">)</span><span class="op" id="8055089">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8055094">//&nbsp;header&nbsp;for&nbsp;the&nbsp;empty&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8055128">{</span><span class="num" id="8055129">1</span><span class="op" id="8055130">,</span>&nbsp;<span class="builtintype" id="8055132">byte</span><span class="op" id="8055136">(</span><span class="ident" id="8055137"><a href="/net/http/fcgi/fcgi.go.html#6107706">typeStdin</a></span><span class="op" id="8055146">)</span><span class="op" id="8055147">,</span>&nbsp;<span class="num" id="8055149">0x01</span><span class="op" id="8055153">,</span>&nbsp;<span class="num" id="8055155">0x2C</span><span class="op" id="8055159">,</span>&nbsp;<span class="num" id="8055161">0</span><span class="op" id="8055162">,</span>&nbsp;<span class="num" id="8055164">0</span><span class="op" id="8055165">,</span>&nbsp;<span class="num" id="8055167">0</span><span class="op" id="8055168">,</span>&nbsp;<span class="num" id="8055170">0</span><span class="op" id="8055171">}</span><span class="op" id="8055172">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8055176">}</span><span class="op" id="8055177">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8055182">nil</span><span class="op" id="8055185">)</span><span class="op" id="8055186">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8055189">}</span><span class="op" id="8055190">,</span><br>
<span class="lineno"></span><span class="op" id="8055192">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8055195">type</span>&nbsp;<span class="ident" id="8055200">nilCloser</span>&nbsp;<span class="keyword" id="8055210">struct</span>&nbsp;<span class="op" id="8055217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8055220"><a href="/net/http/fcgi/fcgi_test.go.html#8053858">io</a></span><span class="op" id="8055222">.</span><span class="ident" id="8055223">ReadWriter</span><br>
<span class="lineno">70</span><span class="op" id="8055234">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8055237">func</span>&nbsp;<span class="op" id="8055242">(</span><span class="ident" id="8055243">c</span>&nbsp;<span class="op" id="8055245">*</span><span class="ident" id="8055246"><a href="/net/http/fcgi/fcgi_test.go.html#8055200">nilCloser</a></span><span class="op" id="8055255">)</span>&nbsp;<span class="ident" id="8055257">Close</span><span class="op" id="8055262">(</span><span class="op" id="8055263">)</span>&nbsp;<span class="builtintype" id="8055265">error</span>&nbsp;<span class="op" id="8055271">{</span>&nbsp;<span class="keyword" id="8055273">return</span>&nbsp;<span class="ident" id="8055280">nil</span>&nbsp;<span class="op" id="8055284">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8055287">func</span>&nbsp;<span class="ident" id="8055292">TestStreams</span><span class="op" id="8055303">(</span><span class="ident" id="8055304">t</span>&nbsp;<span class="op" id="8055306">*</span><span class="ident" id="8055307"><a href="/net/http/fcgi/fcgi_test.go.html#8053864">testing</a></span><span class="op" id="8055314">.</span><span class="ident" id="8055315">T</span><span class="op" id="8055316">)</span>&nbsp;<span class="op" id="8055318">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8055321">var</span>&nbsp;<span class="ident" id="8055325">rec</span>&nbsp;<span class="ident" id="8055329"><a href="/net/http/fcgi/fcgi.go.html#6109464">record</a></span><br>
<span class="lineno"></span><span class="ident" id="8055336">outer</span><span class="op" id="8055341">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8055344">for</span>&nbsp;<span class="ident" id="8055348">_</span><span class="op" id="8055349">,</span>&nbsp;<span class="ident" id="8055351">test</span>&nbsp;<span class="op" id="8055356">:=</span>&nbsp;<span class="keyword" id="8055359">range</span>&nbsp;<span class="ident" id="8055365"><a href="/net/http/fcgi/fcgi_test.go.html#8054542">streamTests</a></span>&nbsp;<span class="op" id="8055377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8055381">buf</span>&nbsp;<span class="op" id="8055385">:=</span>&nbsp;<span class="ident" id="8055388"><a href="/net/http/fcgi/fcgi_test.go.html#8053839">bytes</a></span><span class="op" id="8055393">.</span><span class="ident" id="8055394">NewBuffer</span><span class="op" id="8055403">(</span><span class="ident" id="8055404"><a href="/net/http/fcgi/fcgi_test.go.html#8055351">test</a></span><span class="op" id="8055408">.</span><span class="ident" id="8055409">raw</span><span class="op" id="8055412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8055416">var</span>&nbsp;<span class="ident" id="8055420">content</span>&nbsp;<span class="op" id="8055428">[</span><span class="op" id="8055429">]</span><span class="builtintype" id="8055430">byte</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8055437">for</span>&nbsp;<span class="ident" id="8055441"><a href="/net/http/fcgi/fcgi_test.go.html#8055381">buf</a></span><span class="op" id="8055444">.</span><span class="ident" id="8055445">Len</span><span class="op" id="8055448">(</span><span class="op" id="8055449">)</span>&nbsp;<span class="op" id="8055451">&gt;</span>&nbsp;<span class="num" id="8055453">0</span>&nbsp;<span class="op" id="8055455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8055460">if</span>&nbsp;<span class="ident" id="8055463">err</span>&nbsp;<span class="op" id="8055467">:=</span>&nbsp;<span class="ident" id="8055470"><a href="/net/http/fcgi/fcgi_test.go.html#8055325">rec</a></span><span class="op" id="8055473">.</span><span class="ident" id="8055474">read</span><span class="op" id="8055478">(</span><span class="ident" id="8055479"><a href="/net/http/fcgi/fcgi_test.go.html#8055381">buf</a></span><span class="op" id="8055482">)</span><span class="op" id="8055483">;</span>&nbsp;<span class="ident" id="8055485"><a href="/net/http/fcgi/fcgi_test.go.html#8055463">err</a></span>&nbsp;<span class="op" id="8055489">!=</span>&nbsp;<span class="ident" id="8055492">nil</span>&nbsp;<span class="op" id="8055496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8055502"><a href="/net/http/fcgi/fcgi_test.go.html#8055304">t</a></span><span class="op" id="8055503">.</span><span class="ident" id="8055504">Errorf</span><span class="op" id="8055510">(</span><span class="string" id="8055511">&#34;%s:&nbsp;error&nbsp;reading&nbsp;record:&nbsp;%v&#34;</span><span class="op" id="8055541">,</span>&nbsp;<span class="ident" id="8055543"><a href="/net/http/fcgi/fcgi_test.go.html#8055351">test</a></span><span class="op" id="8055547">.</span><span class="ident" id="8055548">desc</span><span class="op" id="8055552">,</span>&nbsp;<span class="ident" id="8055554"><a href="/net/http/fcgi/fcgi_test.go.html#8055463">err</a></span><span class="op" id="8055557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8055563">continue</span>&nbsp;<span class="ident" id="8055572">outer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8055581">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8055586"><a href="/net/http/fcgi/fcgi_test.go.html#8055420">content</a></span>&nbsp;<span class="op" id="8055594">=</span>&nbsp;<span class="builtinfunc" id="8055596">append</span><span class="op" id="8055602">(</span><span class="ident" id="8055603"><a href="/net/http/fcgi/fcgi_test.go.html#8055420">content</a></span><span class="op" id="8055610">,</span>&nbsp;<span class="ident" id="8055612"><a href="/net/http/fcgi/fcgi_test.go.html#8055325">rec</a></span><span class="op" id="8055615">.</span><span class="ident" id="8055616">content</span><span class="op" id="8055623">(</span><span class="op" id="8055624">)</span><span class="op" id="8055625">...</span><span class="op" id="8055628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8055632">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8055636">if</span>&nbsp;<span class="ident" id="8055639"><a href="/net/http/fcgi/fcgi_test.go.html#8055325">rec</a></span><span class="op" id="8055642">.</span><span class="ident" id="8055643">h</span><span class="op" id="8055644">.</span><span class="ident" id="8055645">Type</span>&nbsp;<span class="op" id="8055650">!=</span>&nbsp;<span class="ident" id="8055653"><a href="/net/http/fcgi/fcgi_test.go.html#8055351">test</a></span><span class="op" id="8055657">.</span><span class="ident" id="8055658">recType</span>&nbsp;<span class="op" id="8055666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8055671"><a href="/net/http/fcgi/fcgi_test.go.html#8055304">t</a></span><span class="op" id="8055672">.</span><span class="ident" id="8055673">Errorf</span><span class="op" id="8055679">(</span><span class="string" id="8055680">&#34;%s:&nbsp;got&nbsp;type&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="8055709">,</span>&nbsp;<span class="ident" id="8055711"><a href="/net/http/fcgi/fcgi_test.go.html#8055351">test</a></span><span class="op" id="8055715">.</span><span class="ident" id="8055716">desc</span><span class="op" id="8055720">,</span>&nbsp;<span class="ident" id="8055722"><a href="/net/http/fcgi/fcgi_test.go.html#8055325">rec</a></span><span class="op" id="8055725">.</span><span class="ident" id="8055726">h</span><span class="op" id="8055727">.</span><span class="ident" id="8055728">Type</span><span class="op" id="8055732">,</span>&nbsp;<span class="ident" id="8055734"><a href="/net/http/fcgi/fcgi_test.go.html#8055351">test</a></span><span class="op" id="8055738">.</span><span class="ident" id="8055739">recType</span><span class="op" id="8055746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8055751">continue</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8055762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8055766">if</span>&nbsp;<span class="ident" id="8055769"><a href="/net/http/fcgi/fcgi_test.go.html#8055325">rec</a></span><span class="op" id="8055772">.</span><span class="ident" id="8055773">h</span><span class="op" id="8055774">.</span><span class="ident" id="8055775">Id</span>&nbsp;<span class="op" id="8055778">!=</span>&nbsp;<span class="ident" id="8055781"><a href="/net/http/fcgi/fcgi_test.go.html#8055351">test</a></span><span class="op" id="8055785">.</span><span class="ident" id="8055786">reqId</span>&nbsp;<span class="op" id="8055792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8055797"><a href="/net/http/fcgi/fcgi_test.go.html#8055304">t</a></span><span class="op" id="8055798">.</span><span class="ident" id="8055799">Errorf</span><span class="op" id="8055805">(</span><span class="string" id="8055806">&#34;%s:&nbsp;got&nbsp;request&nbsp;ID&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="8055841">,</span>&nbsp;<span class="ident" id="8055843"><a href="/net/http/fcgi/fcgi_test.go.html#8055351">test</a></span><span class="op" id="8055847">.</span><span class="ident" id="8055848">desc</span><span class="op" id="8055852">,</span>&nbsp;<span class="ident" id="8055854"><a href="/net/http/fcgi/fcgi_test.go.html#8055325">rec</a></span><span class="op" id="8055857">.</span><span class="ident" id="8055858">h</span><span class="op" id="8055859">.</span><span class="ident" id="8055860">Id</span><span class="op" id="8055862">,</span>&nbsp;<span class="ident" id="8055864"><a href="/net/http/fcgi/fcgi_test.go.html#8055351">test</a></span><span class="op" id="8055868">.</span><span class="ident" id="8055869">reqId</span><span class="op" id="8055874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8055879">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8055890">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8055894">if</span>&nbsp;<span class="op" id="8055897">!</span><span class="ident" id="8055898"><a href="/net/http/fcgi/fcgi_test.go.html#8053839">bytes</a></span><span class="op" id="8055903">.</span><span class="ident" id="8055904">Equal</span><span class="op" id="8055909">(</span><span class="ident" id="8055910"><a href="/net/http/fcgi/fcgi_test.go.html#8055420">content</a></span><span class="op" id="8055917">,</span>&nbsp;<span class="ident" id="8055919"><a href="/net/http/fcgi/fcgi_test.go.html#8055351">test</a></span><span class="op" id="8055923">.</span><span class="ident" id="8055924">content</span><span class="op" id="8055931">)</span>&nbsp;<span class="op" id="8055933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8055938"><a href="/net/http/fcgi/fcgi_test.go.html#8055304">t</a></span><span class="op" id="8055939">.</span><span class="ident" id="8055940">Errorf</span><span class="op" id="8055946">(</span><span class="string" id="8055947">&#34;%s:&nbsp;read&nbsp;wrong&nbsp;content&#34;</span><span class="op" id="8055971">,</span>&nbsp;<span class="ident" id="8055973"><a href="/net/http/fcgi/fcgi_test.go.html#8055351">test</a></span><span class="op" id="8055977">.</span><span class="ident" id="8055978">desc</span><span class="op" id="8055982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8055987">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8055998">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8056002"><a href="/net/http/fcgi/fcgi_test.go.html#8055381">buf</a></span><span class="op" id="8056005">.</span><span class="ident" id="8056006">Reset</span><span class="op" id="8056011">(</span><span class="op" id="8056012">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8056016">c</span>&nbsp;<span class="op" id="8056018">:=</span>&nbsp;<span class="ident" id="8056021"><a href="/net/http/fcgi/fcgi.go.html#6109296">newConn</a></span><span class="op" id="8056028">(</span><span class="op" id="8056029">&amp;</span><span class="ident" id="8056030"><a href="/net/http/fcgi/fcgi_test.go.html#8055200">nilCloser</a></span><span class="op" id="8056039">{</span><span class="ident" id="8056040"><a href="/net/http/fcgi/fcgi_test.go.html#8055381">buf</a></span><span class="op" id="8056043">}</span><span class="op" id="8056044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8056048">w</span>&nbsp;<span class="op" id="8056050">:=</span>&nbsp;<span class="ident" id="8056053"><a href="/net/http/fcgi/fcgi.go.html#6112169">newWriter</a></span><span class="op" id="8056062">(</span><span class="ident" id="8056063"><a href="/net/http/fcgi/fcgi_test.go.html#8056016">c</a></span><span class="op" id="8056064">,</span>&nbsp;<span class="ident" id="8056066"><a href="/net/http/fcgi/fcgi_test.go.html#8055351">test</a></span><span class="op" id="8056070">.</span><span class="ident" id="8056071">recType</span><span class="op" id="8056078">,</span>&nbsp;<span class="ident" id="8056080"><a href="/net/http/fcgi/fcgi_test.go.html#8055351">test</a></span><span class="op" id="8056084">.</span><span class="ident" id="8056085">reqId</span><span class="op" id="8056090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8056094">if</span>&nbsp;<span class="ident" id="8056097">_</span><span class="op" id="8056098">,</span>&nbsp;<span class="ident" id="8056100">err</span>&nbsp;<span class="op" id="8056104">:=</span>&nbsp;<span class="ident" id="8056107"><a href="/net/http/fcgi/fcgi_test.go.html#8056048">w</a></span><span class="op" id="8056108">.</span><span class="ident" id="8056109">Write</span><span class="op" id="8056114">(</span><span class="ident" id="8056115"><a href="/net/http/fcgi/fcgi_test.go.html#8055351">test</a></span><span class="op" id="8056119">.</span><span class="ident" id="8056120">content</span><span class="op" id="8056127">)</span><span class="op" id="8056128">;</span>&nbsp;<span class="ident" id="8056130"><a href="/net/http/fcgi/fcgi_test.go.html#8056100">err</a></span>&nbsp;<span class="op" id="8056134">!=</span>&nbsp;<span class="ident" id="8056137">nil</span>&nbsp;<span class="op" id="8056141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8056146"><a href="/net/http/fcgi/fcgi_test.go.html#8055304">t</a></span><span class="op" id="8056147">.</span><span class="ident" id="8056148">Errorf</span><span class="op" id="8056154">(</span><span class="string" id="8056155">&#34;%s:&nbsp;error&nbsp;writing&nbsp;record:&nbsp;%v&#34;</span><span class="op" id="8056185">,</span>&nbsp;<span class="ident" id="8056187"><a href="/net/http/fcgi/fcgi_test.go.html#8055351">test</a></span><span class="op" id="8056191">.</span><span class="ident" id="8056192">desc</span><span class="op" id="8056196">,</span>&nbsp;<span class="ident" id="8056198"><a href="/net/http/fcgi/fcgi_test.go.html#8056100">err</a></span><span class="op" id="8056201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8056206">continue</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8056217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8056221">if</span>&nbsp;<span class="ident" id="8056224">err</span>&nbsp;<span class="op" id="8056228">:=</span>&nbsp;<span class="ident" id="8056231"><a href="/net/http/fcgi/fcgi_test.go.html#8056048">w</a></span><span class="op" id="8056232">.</span><span class="ident" id="8056233">Close</span><span class="op" id="8056238">(</span><span class="op" id="8056239">)</span><span class="op" id="8056240">;</span>&nbsp;<span class="ident" id="8056242"><a href="/net/http/fcgi/fcgi_test.go.html#8056224">err</a></span>&nbsp;<span class="op" id="8056246">!=</span>&nbsp;<span class="ident" id="8056249">nil</span>&nbsp;<span class="op" id="8056253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8056258"><a href="/net/http/fcgi/fcgi_test.go.html#8055304">t</a></span><span class="op" id="8056259">.</span><span class="ident" id="8056260">Errorf</span><span class="op" id="8056266">(</span><span class="string" id="8056267">&#34;%s:&nbsp;error&nbsp;closing&nbsp;stream:&nbsp;%v&#34;</span><span class="op" id="8056297">,</span>&nbsp;<span class="ident" id="8056299"><a href="/net/http/fcgi/fcgi_test.go.html#8055351">test</a></span><span class="op" id="8056303">.</span><span class="ident" id="8056304">desc</span><span class="op" id="8056308">,</span>&nbsp;<span class="ident" id="8056310"><a href="/net/http/fcgi/fcgi_test.go.html#8056224">err</a></span><span class="op" id="8056313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8056318">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8056329">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8056333">if</span>&nbsp;<span class="op" id="8056336">!</span><span class="ident" id="8056337"><a href="/net/http/fcgi/fcgi_test.go.html#8053839">bytes</a></span><span class="op" id="8056342">.</span><span class="ident" id="8056343">Equal</span><span class="op" id="8056348">(</span><span class="ident" id="8056349"><a href="/net/http/fcgi/fcgi_test.go.html#8055381">buf</a></span><span class="op" id="8056352">.</span><span class="ident" id="8056353">Bytes</span><span class="op" id="8056358">(</span><span class="op" id="8056359">)</span><span class="op" id="8056360">,</span>&nbsp;<span class="ident" id="8056362"><a href="/net/http/fcgi/fcgi_test.go.html#8055351">test</a></span><span class="op" id="8056366">.</span><span class="ident" id="8056367">raw</span><span class="op" id="8056370">)</span>&nbsp;<span class="op" id="8056372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8056377"><a href="/net/http/fcgi/fcgi_test.go.html#8055304">t</a></span><span class="op" id="8056378">.</span><span class="ident" id="8056379">Errorf</span><span class="op" id="8056385">(</span><span class="string" id="8056386">&#34;%s:&nbsp;wrote&nbsp;wrong&nbsp;content&#34;</span><span class="op" id="8056411">,</span>&nbsp;<span class="ident" id="8056413"><a href="/net/http/fcgi/fcgi_test.go.html#8055351">test</a></span><span class="op" id="8056417">.</span><span class="ident" id="8056418">desc</span><span class="op" id="8056422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8056426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8056429">}</span><br>
<span class="lineno"></span><span class="op" id="8056431">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="keyword" id="8056434">type</span>&nbsp;<span class="ident" id="8056439">writeOnlyConn</span>&nbsp;<span class="keyword" id="8056453">struct</span>&nbsp;<span class="op" id="8056460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8056463">buf</span>&nbsp;<span class="op" id="8056467">[</span><span class="op" id="8056468">]</span><span class="builtintype" id="8056469">byte</span><br>
<span class="lineno"></span><span class="op" id="8056474">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="8056477">func</span>&nbsp;<span class="op" id="8056482">(</span><span class="ident" id="8056483">c</span>&nbsp;<span class="op" id="8056485">*</span><span class="ident" id="8056486"><a href="/net/http/fcgi/fcgi_test.go.html#8056439">writeOnlyConn</a></span><span class="op" id="8056499">)</span>&nbsp;<span class="ident" id="8056501">Write</span><span class="op" id="8056506">(</span><span class="ident" id="8056507">p</span>&nbsp;<span class="op" id="8056509">[</span><span class="op" id="8056510">]</span><span class="builtintype" id="8056511">byte</span><span class="op" id="8056515">)</span>&nbsp;<span class="op" id="8056517">(</span><span class="builtintype" id="8056518">int</span><span class="op" id="8056521">,</span>&nbsp;<span class="builtintype" id="8056523">error</span><span class="op" id="8056528">)</span>&nbsp;<span class="op" id="8056530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8056533"><a href="/net/http/fcgi/fcgi_test.go.html#8056483">c</a></span><span class="op" id="8056534">.</span><span class="ident" id="8056535">buf</span>&nbsp;<span class="op" id="8056539">=</span>&nbsp;<span class="builtinfunc" id="8056541">append</span><span class="op" id="8056547">(</span><span class="ident" id="8056548"><a href="/net/http/fcgi/fcgi_test.go.html#8056483">c</a></span><span class="op" id="8056549">.</span><span class="ident" id="8056550">buf</span><span class="op" id="8056553">,</span>&nbsp;<span class="ident" id="8056555"><a href="/net/http/fcgi/fcgi_test.go.html#8056507">p</a></span><span class="op" id="8056556">...</span><span class="op" id="8056559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8056562">return</span>&nbsp;<span class="builtinfunc" id="8056569">len</span><span class="op" id="8056572">(</span><span class="ident" id="8056573"><a href="/net/http/fcgi/fcgi_test.go.html#8056507">p</a></span><span class="op" id="8056574">)</span><span class="op" id="8056575">,</span>&nbsp;<span class="ident" id="8056577">nil</span><br>
<span class="lineno"></span><span class="op" id="8056581">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="8056584">func</span>&nbsp;<span class="op" id="8056589">(</span><span class="ident" id="8056590">c</span>&nbsp;<span class="op" id="8056592">*</span><span class="ident" id="8056593"><a href="/net/http/fcgi/fcgi_test.go.html#8056439">writeOnlyConn</a></span><span class="op" id="8056606">)</span>&nbsp;<span class="ident" id="8056608">Read</span><span class="op" id="8056612">(</span><span class="ident" id="8056613">p</span>&nbsp;<span class="op" id="8056615">[</span><span class="op" id="8056616">]</span><span class="builtintype" id="8056617">byte</span><span class="op" id="8056621">)</span>&nbsp;<span class="op" id="8056623">(</span><span class="builtintype" id="8056624">int</span><span class="op" id="8056627">,</span>&nbsp;<span class="builtintype" id="8056629">error</span><span class="op" id="8056634">)</span>&nbsp;<span class="op" id="8056636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8056639">return</span>&nbsp;<span class="num" id="8056646">0</span><span class="op" id="8056647">,</span>&nbsp;<span class="ident" id="8056649"><a href="/net/http/fcgi/fcgi_test.go.html#8053848">errors</a></span><span class="op" id="8056655">.</span><span class="ident" id="8056656">New</span><span class="op" id="8056659">(</span><span class="string" id="8056660">&#34;conn&nbsp;is&nbsp;write-only&#34;</span><span class="op" id="8056680">)</span><br>
<span class="lineno"></span><span class="op" id="8056682">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8056685">func</span>&nbsp;<span class="op" id="8056690">(</span><span class="ident" id="8056691">c</span>&nbsp;<span class="op" id="8056693">*</span><span class="ident" id="8056694"><a href="/net/http/fcgi/fcgi_test.go.html#8056439">writeOnlyConn</a></span><span class="op" id="8056707">)</span>&nbsp;<span class="ident" id="8056709">Close</span><span class="op" id="8056714">(</span><span class="op" id="8056715">)</span>&nbsp;<span class="builtintype" id="8056717">error</span>&nbsp;<span class="op" id="8056723">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8056726">return</span>&nbsp;<span class="ident" id="8056733">nil</span><br>
<span class="lineno"></span><span class="op" id="8056737">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8056740">func</span>&nbsp;<span class="ident" id="8056745">TestGetValues</span><span class="op" id="8056758">(</span><span class="ident" id="8056759">t</span>&nbsp;<span class="op" id="8056761">*</span><span class="ident" id="8056762"><a href="/net/http/fcgi/fcgi_test.go.html#8053864">testing</a></span><span class="op" id="8056769">.</span><span class="ident" id="8056770">T</span><span class="op" id="8056771">)</span>&nbsp;<span class="op" id="8056773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8056776">var</span>&nbsp;<span class="ident" id="8056780">rec</span>&nbsp;<span class="ident" id="8056784"><a href="/net/http/fcgi/fcgi.go.html#6109464">record</a></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8056792"><a href="/net/http/fcgi/fcgi_test.go.html#8056780">rec</a></span><span class="op" id="8056795">.</span><span class="ident" id="8056796">h</span><span class="op" id="8056797">.</span><span class="ident" id="8056798">Type</span>&nbsp;<span class="op" id="8056803">=</span>&nbsp;<span class="ident" id="8056805"><a href="/net/http/fcgi/fcgi.go.html#6107838">typeGetValues</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8056821">wc</span>&nbsp;<span class="op" id="8056824">:=</span>&nbsp;<span class="builtinfunc" id="8056827">new</span><span class="op" id="8056830">(</span><span class="ident" id="8056831"><a href="/net/http/fcgi/fcgi_test.go.html#8056439">writeOnlyConn</a></span><span class="op" id="8056844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8056847">c</span>&nbsp;<span class="op" id="8056849">:=</span>&nbsp;<span class="ident" id="8056852"><a href="/net/http/fcgi/child.go.html#6102482">newChild</a></span><span class="op" id="8056860">(</span><span class="ident" id="8056861"><a href="/net/http/fcgi/fcgi_test.go.html#8056821">wc</a></span><span class="op" id="8056863">,</span>&nbsp;<span class="ident" id="8056865">nil</span><span class="op" id="8056868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8056871">err</span>&nbsp;<span class="op" id="8056875">:=</span>&nbsp;<span class="ident" id="8056878"><a href="/net/http/fcgi/fcgi_test.go.html#8056847">c</a></span><span class="op" id="8056879">.</span><span class="ident" id="8056880">handleRecord</span><span class="op" id="8056892">(</span><span class="op" id="8056893">&amp;</span><span class="ident" id="8056894"><a href="/net/http/fcgi/fcgi_test.go.html#8056780">rec</a></span><span class="op" id="8056897">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8056900">if</span>&nbsp;<span class="ident" id="8056903"><a href="/net/http/fcgi/fcgi_test.go.html#8056871">err</a></span>&nbsp;<span class="op" id="8056907">!=</span>&nbsp;<span class="ident" id="8056910">nil</span>&nbsp;<span class="op" id="8056914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8056918"><a href="/net/http/fcgi/fcgi_test.go.html#8056759">t</a></span><span class="op" id="8056919">.</span><span class="ident" id="8056920">Fatalf</span><span class="op" id="8056926">(</span><span class="string" id="8056927">&#34;handleRecord:&nbsp;%v&#34;</span><span class="op" id="8056945">,</span>&nbsp;<span class="ident" id="8056947"><a href="/net/http/fcgi/fcgi_test.go.html#8056871">err</a></span><span class="op" id="8056950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8056953">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8056957">const</span>&nbsp;<span class="ident" id="8056963">want</span>&nbsp;<span class="op" id="8056968">=</span>&nbsp;<span class="string" id="8056970">&#34;\x01\n\x00\x00\x00\x12\x06\x00&#34;</span>&nbsp;<span class="op" id="8057003">+</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8057007">&#34;\x0f\x01FCGI_MPXS_CONNS1&#34;</span>&nbsp;<span class="op" id="8057034">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8057038">&#34;\x00\x00\x00\x00\x00\x00\x01\n\x00\x00\x00\x00\x00\x00&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8057096">if</span>&nbsp;<span class="ident" id="8057099">got</span>&nbsp;<span class="op" id="8057103">:=</span>&nbsp;<span class="builtintype" id="8057106">string</span><span class="op" id="8057112">(</span><span class="ident" id="8057113"><a href="/net/http/fcgi/fcgi_test.go.html#8056821">wc</a></span><span class="op" id="8057115">.</span><span class="ident" id="8057116">buf</span><span class="op" id="8057119">)</span><span class="op" id="8057120">;</span>&nbsp;<span class="ident" id="8057122"><a href="/net/http/fcgi/fcgi_test.go.html#8057099">got</a></span>&nbsp;<span class="op" id="8057126">!=</span>&nbsp;<span class="ident" id="8057129"><a href="/net/http/fcgi/fcgi_test.go.html#8056963">want</a></span>&nbsp;<span class="op" id="8057134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8057138"><a href="/net/http/fcgi/fcgi_test.go.html#8056759">t</a></span><span class="op" id="8057139">.</span><span class="ident" id="8057140">Errorf</span><span class="op" id="8057146">(</span><span class="string" id="8057147">&#34;&nbsp;got:&nbsp;%q\nwant:&nbsp;%q\n&#34;</span><span class="op" id="8057169">,</span>&nbsp;<span class="ident" id="8057171"><a href="/net/http/fcgi/fcgi_test.go.html#8057099">got</a></span><span class="op" id="8057174">,</span>&nbsp;<span class="ident" id="8057176"><a href="/net/http/fcgi/fcgi_test.go.html#8056963">want</a></span><span class="op" id="8057180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8057183">}</span><br>
<span class="lineno">150</span><span class="op" id="8057185">}</span>
</div>
</body>
</html>
