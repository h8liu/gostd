<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>syscall</h2>
<ul>
<li><a href="/gostd/syscall/creds_test.go.html">creds_test.go</a></li>
<li><a href="/gostd/syscall/env_unix.go.html">env_unix.go</a></li>
<li><a href="/gostd/syscall/exec_linux.go.html">exec_linux.go</a></li>
<li><a href="/gostd/syscall/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/syscall/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/syscall/flock.go.html">flock.go</a></li>
<li><a href="/gostd/syscall/lsf_linux.go.html">lsf_linux.go</a></li>
<li><a href="/gostd/syscall/mmap_unix_test.go.html">mmap_unix_test.go</a></li>
<li><a href="/gostd/syscall/netlink_linux.go.html">netlink_linux.go</a></li>
<li><a href="/gostd/syscall/race0.go.html">race0.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_linux.go.html" class="current">sockcmsg_linux.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_unix.go.html">sockcmsg_unix.go</a></li>
<li><a href="/gostd/syscall/str.go.html">str.go</a></li>
<li><a href="/gostd/syscall/syscall.go.html">syscall.go</a></li>
<li><a href="/gostd/syscall/syscall_linux.go.html">syscall_linux.go</a></li>
<li><a href="/gostd/syscall/syscall_linux_amd64.go.html">syscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/syscall_test.go.html">syscall_test.go</a></li>
<li><a href="/gostd/syscall/syscall_unix.go.html">syscall_unix.go</a></li>
<li><a href="/gostd/syscall/syscall_unix_test.go.html">syscall_unix_test.go</a></li>
<li><a href="/gostd/syscall/zerrors_linux_amd64.go.html">zerrors_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsyscall_linux_amd64.go.html">zsyscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsysnum_linux_amd64.go.html">zsysnum_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/ztypes_linux_amd64.go.html">ztypes_linux_amd64.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2494912">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2494968">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2495022">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2495073">//&nbsp;Socket&nbsp;control&nbsp;messages</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2495101">package</span>&nbsp;<span class="ident" id="2495109">syscall</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2495118">import</span>&nbsp;<span class="string" id="2495125">&#34;unsafe&#34;</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="2495135">//&nbsp;UnixCredentials&nbsp;encodes&nbsp;credentials&nbsp;into&nbsp;a&nbsp;socket&nbsp;control&nbsp;message</span><br>
<span class="lineno"></span><span class="comment" id="2495204">//&nbsp;for&nbsp;sending&nbsp;to&nbsp;another&nbsp;process.&nbsp;This&nbsp;can&nbsp;be&nbsp;used&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="2495260">//&nbsp;authentication.</span><br>
<span class="lineno"></span><span class="keyword" id="2495279">func</span>&nbsp;<span class="ident" id="2495284">UnixCredentials</span><span class="op" id="2495299">(</span><span class="ident" id="2495300">ucred</span>&nbsp;<span class="op" id="2495306">*</span><span class="ident" id="2495307">Ucred</span><span class="op" id="2495312">)</span>&nbsp;<span class="op" id="2495314">[</span><span class="op" id="2495315">]</span><span class="builtintype" id="2495316">byte</span>&nbsp;<span class="op" id="2495321">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2495324">b</span>&nbsp;<span class="op" id="2495326">:=</span>&nbsp;<span class="builtinfunc" id="2495329">make</span><span class="op" id="2495333">(</span><span class="op" id="2495334">[</span><span class="op" id="2495335">]</span><span class="builtintype" id="2495336">byte</span><span class="op" id="2495340">,</span>&nbsp;<span class="ident" id="2495342">CmsgSpace</span><span class="op" id="2495351">(</span><span class="ident" id="2495352">SizeofUcred</span><span class="op" id="2495363">)</span><span class="op" id="2495364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2495367">h</span>&nbsp;<span class="op" id="2495369">:=</span>&nbsp;<span class="op" id="2495372">(</span><span class="op" id="2495373">*</span><span class="ident" id="2495374">Cmsghdr</span><span class="op" id="2495381">)</span><span class="op" id="2495382">(</span><span class="ident" id="2495383">unsafe</span><span class="op" id="2495389">.</span><span class="ident" id="2495390">Pointer</span><span class="op" id="2495397">(</span><span class="op" id="2495398">&amp;</span><span class="ident" id="2495399">b</span><span class="op" id="2495400">[</span><span class="num" id="2495401">0</span><span class="op" id="2495402">]</span><span class="op" id="2495403">)</span><span class="op" id="2495404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2495407">h</span><span class="op" id="2495408">.</span><span class="ident" id="2495409">Level</span>&nbsp;<span class="op" id="2495415">=</span>&nbsp;<span class="ident" id="2495417">SOL_SOCKET</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2495429">h</span><span class="op" id="2495430">.</span><span class="ident" id="2495431">Type</span>&nbsp;<span class="op" id="2495436">=</span>&nbsp;<span class="ident" id="2495438">SCM_CREDENTIALS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2495455">h</span><span class="op" id="2495456">.</span><span class="ident" id="2495457">SetLen</span><span class="op" id="2495463">(</span><span class="ident" id="2495464">CmsgLen</span><span class="op" id="2495471">(</span><span class="ident" id="2495472">SizeofUcred</span><span class="op" id="2495483">)</span><span class="op" id="2495484">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2495487">*</span><span class="op" id="2495488">(</span><span class="op" id="2495489">(</span><span class="op" id="2495490">*</span><span class="ident" id="2495491">Ucred</span><span class="op" id="2495496">)</span><span class="op" id="2495497">(</span><span class="ident" id="2495498">cmsgData</span><span class="op" id="2495506">(</span><span class="ident" id="2495507">h</span><span class="op" id="2495508">)</span><span class="op" id="2495509">)</span><span class="op" id="2495510">)</span>&nbsp;<span class="op" id="2495512">=</span>&nbsp;<span class="op" id="2495514">*</span><span class="ident" id="2495515">ucred</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2495522">return</span>&nbsp;<span class="ident" id="2495529">b</span><br>
<span class="lineno"></span><span class="op" id="2495531">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2495534">//&nbsp;ParseUnixCredentials&nbsp;decodes&nbsp;a&nbsp;socket&nbsp;control&nbsp;message&nbsp;that&nbsp;contains</span><br>
<span class="lineno">25</span><span class="comment" id="2495605">//&nbsp;credentials&nbsp;in&nbsp;a&nbsp;Ucred&nbsp;structure.&nbsp;To&nbsp;receive&nbsp;such&nbsp;a&nbsp;message,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2495673">//&nbsp;SO_PASSCRED&nbsp;option&nbsp;must&nbsp;be&nbsp;enabled&nbsp;on&nbsp;the&nbsp;socket.</span><br>
<span class="lineno"></span><span class="keyword" id="2495726">func</span>&nbsp;<span class="ident" id="2495731">ParseUnixCredentials</span><span class="op" id="2495751">(</span><span class="ident" id="2495752">m</span>&nbsp;<span class="op" id="2495754">*</span><span class="ident" id="2495755">SocketControlMessage</span><span class="op" id="2495775">)</span>&nbsp;<span class="op" id="2495777">(</span><span class="op" id="2495778">*</span><span class="ident" id="2495779">Ucred</span><span class="op" id="2495784">,</span>&nbsp;<span class="builtintype" id="2495786">error</span><span class="op" id="2495791">)</span>&nbsp;<span class="op" id="2495793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2495796">if</span>&nbsp;<span class="ident" id="2495799">m</span><span class="op" id="2495800">.</span><span class="ident" id="2495801">Header</span><span class="op" id="2495807">.</span><span class="ident" id="2495808">Level</span>&nbsp;<span class="op" id="2495814">!=</span>&nbsp;<span class="ident" id="2495817">SOL_SOCKET</span>&nbsp;<span class="op" id="2495828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2495832">return</span>&nbsp;<span class="builtintype" id="2495839">nil</span><span class="op" id="2495842">,</span>&nbsp;<span class="ident" id="2495844">EINVAL</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2495852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2495855">if</span>&nbsp;<span class="ident" id="2495858">m</span><span class="op" id="2495859">.</span><span class="ident" id="2495860">Header</span><span class="op" id="2495866">.</span><span class="ident" id="2495867">Type</span>&nbsp;<span class="op" id="2495872">!=</span>&nbsp;<span class="ident" id="2495875">SCM_CREDENTIALS</span>&nbsp;<span class="op" id="2495891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2495895">return</span>&nbsp;<span class="builtintype" id="2495902">nil</span><span class="op" id="2495905">,</span>&nbsp;<span class="ident" id="2495907">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2495915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2495918">ucred</span>&nbsp;<span class="op" id="2495924">:=</span>&nbsp;<span class="op" id="2495927">*</span><span class="op" id="2495928">(</span><span class="op" id="2495929">*</span><span class="ident" id="2495930">Ucred</span><span class="op" id="2495935">)</span><span class="op" id="2495936">(</span><span class="ident" id="2495937">unsafe</span><span class="op" id="2495943">.</span><span class="ident" id="2495944">Pointer</span><span class="op" id="2495951">(</span><span class="op" id="2495952">&amp;</span><span class="ident" id="2495953">m</span><span class="op" id="2495954">.</span><span class="ident" id="2495955">Data</span><span class="op" id="2495959">[</span><span class="num" id="2495960">0</span><span class="op" id="2495961">]</span><span class="op" id="2495962">)</span><span class="op" id="2495963">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2495966">return</span>&nbsp;<span class="op" id="2495973">&amp;</span><span class="ident" id="2495974">ucred</span><span class="op" id="2495979">,</span>&nbsp;<span class="builtintype" id="2495981">nil</span><br>
<span class="lineno"></span><span class="op" id="2495985">}</span>
</div>
</body>
</html>
