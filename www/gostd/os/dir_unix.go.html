<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2137594">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2137649">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2137703">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2137754">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2137824">package</span>&nbsp;<span class="ident" id="2137832">os</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2137836">import</span>&nbsp;<span class="op" id="2137843">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2137846">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2137852">&#34;syscall&#34;</span><br>
<span class="lineno"></span><span class="op" id="2137862">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2137865">const</span>&nbsp;<span class="op" id="2137871">(</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2137874">blockSize</span>&nbsp;<span class="op" id="2137884">=</span>&nbsp;<span class="num" id="2137886">4096</span><br>
<span class="lineno"></span><span class="op" id="2137891">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2137894">func</span>&nbsp;<span class="op" id="2137899">(</span><span class="ident" id="2137900">f</span>&nbsp;<span class="op" id="2137902">*</span><span class="ident" id="2137903">File</span><span class="op" id="2137907">)</span>&nbsp;<span class="ident" id="2137909">readdirnames</span><span class="op" id="2137921">(</span><span class="ident" id="2137922">n</span>&nbsp;<span class="builtintype" id="2137924">int</span><span class="op" id="2137927">)</span>&nbsp;<span class="op" id="2137929">(</span><span class="ident" id="2137930">names</span>&nbsp;<span class="op" id="2137936">[</span><span class="op" id="2137937">]</span><span class="builtintype" id="2137938">string</span><span class="op" id="2137944">,</span>&nbsp;<span class="ident" id="2137946">err</span>&nbsp;<span class="builtintype" id="2137950">error</span><span class="op" id="2137955">)</span>&nbsp;<span class="op" id="2137957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2137960">//&nbsp;If&nbsp;this&nbsp;file&nbsp;has&nbsp;no&nbsp;dirinfo,&nbsp;create&nbsp;one.</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2138005">if</span>&nbsp;<span class="ident" id="2138008">f</span><span class="op" id="2138009">.</span><span class="ident" id="2138010">dirinfo</span>&nbsp;<span class="op" id="2138018">==</span>&nbsp;<span class="ident" id="2138021">nil</span>&nbsp;<span class="op" id="2138025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2138029">f</span><span class="op" id="2138030">.</span><span class="ident" id="2138031">dirinfo</span>&nbsp;<span class="op" id="2138039">=</span>&nbsp;<span class="builtinfunc" id="2138041">new</span><span class="op" id="2138044">(</span><span class="ident" id="2138045">dirInfo</span><span class="op" id="2138052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2138056">//&nbsp;The&nbsp;buffer&nbsp;must&nbsp;be&nbsp;at&nbsp;least&nbsp;a&nbsp;block&nbsp;long.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2138103">f</span><span class="op" id="2138104">.</span><span class="ident" id="2138105">dirinfo</span><span class="op" id="2138112">.</span><span class="ident" id="2138113">buf</span>&nbsp;<span class="op" id="2138117">=</span>&nbsp;<span class="builtinfunc" id="2138119">make</span><span class="op" id="2138123">(</span><span class="op" id="2138124">[</span><span class="op" id="2138125">]</span><span class="builtintype" id="2138126">byte</span><span class="op" id="2138130">,</span>&nbsp;<span class="ident" id="2138132">blockSize</span><span class="op" id="2138141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2138144">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2138147">d</span>&nbsp;<span class="op" id="2138149">:=</span>&nbsp;<span class="ident" id="2138152">f</span><span class="op" id="2138153">.</span><span class="ident" id="2138154">dirinfo</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2138164">size</span>&nbsp;<span class="op" id="2138169">:=</span>&nbsp;<span class="ident" id="2138172">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2138175">if</span>&nbsp;<span class="ident" id="2138178">size</span>&nbsp;<span class="op" id="2138183">&lt;=</span>&nbsp;<span class="num" id="2138186">0</span>&nbsp;<span class="op" id="2138188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2138192">size</span>&nbsp;<span class="op" id="2138197">=</span>&nbsp;<span class="num" id="2138199">100</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2138205">n</span>&nbsp;<span class="op" id="2138207">=</span>&nbsp;<span class="op" id="2138209">-</span><span class="num" id="2138210">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2138213">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2138217">names</span>&nbsp;<span class="op" id="2138223">=</span>&nbsp;<span class="builtinfunc" id="2138225">make</span><span class="op" id="2138229">(</span><span class="op" id="2138230">[</span><span class="op" id="2138231">]</span><span class="builtintype" id="2138232">string</span><span class="op" id="2138238">,</span>&nbsp;<span class="num" id="2138240">0</span><span class="op" id="2138241">,</span>&nbsp;<span class="ident" id="2138243">size</span><span class="op" id="2138247">)</span>&nbsp;<span class="comment" id="2138249">//&nbsp;Empty&nbsp;with&nbsp;room&nbsp;to&nbsp;grow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2138278">for</span>&nbsp;<span class="ident" id="2138282">n</span>&nbsp;<span class="op" id="2138284">!=</span>&nbsp;<span class="num" id="2138287">0</span>&nbsp;<span class="op" id="2138289">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2138293">//&nbsp;Refill&nbsp;the&nbsp;buffer&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2138329">if</span>&nbsp;<span class="ident" id="2138332">d</span><span class="op" id="2138333">.</span><span class="ident" id="2138334">bufp</span>&nbsp;<span class="op" id="2138339">&gt;=</span>&nbsp;<span class="ident" id="2138342">d</span><span class="op" id="2138343">.</span><span class="ident" id="2138344">nbuf</span>&nbsp;<span class="op" id="2138349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2138354">d</span><span class="op" id="2138355">.</span><span class="ident" id="2138356">bufp</span>&nbsp;<span class="op" id="2138361">=</span>&nbsp;<span class="num" id="2138363">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2138368">var</span>&nbsp;<span class="ident" id="2138372">errno</span>&nbsp;<span class="builtintype" id="2138378">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2138387">d</span><span class="op" id="2138388">.</span><span class="ident" id="2138389">nbuf</span><span class="op" id="2138393">,</span>&nbsp;<span class="ident" id="2138395">errno</span>&nbsp;<span class="op" id="2138401">=</span>&nbsp;<span class="ident" id="2138403">fixCount</span><span class="op" id="2138411">(</span><span class="ident" id="2138412">syscall</span><span class="op" id="2138419">.</span><span class="ident" id="2138420">ReadDirent</span><span class="op" id="2138430">(</span><span class="ident" id="2138431">f</span><span class="op" id="2138432">.</span><span class="ident" id="2138433">fd</span><span class="op" id="2138435">,</span>&nbsp;<span class="ident" id="2138437">d</span><span class="op" id="2138438">.</span><span class="ident" id="2138439">buf</span><span class="op" id="2138442">)</span><span class="op" id="2138443">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2138448">if</span>&nbsp;<span class="ident" id="2138451">errno</span>&nbsp;<span class="op" id="2138457">!=</span>&nbsp;<span class="ident" id="2138460">nil</span>&nbsp;<span class="op" id="2138464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2138470">return</span>&nbsp;<span class="ident" id="2138477">names</span><span class="op" id="2138482">,</span>&nbsp;<span class="ident" id="2138484">NewSyscallError</span><span class="op" id="2138499">(</span><span class="string" id="2138500">&#34;readdirent&#34;</span><span class="op" id="2138512">,</span>&nbsp;<span class="ident" id="2138514">errno</span><span class="op" id="2138519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2138524">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2138529">if</span>&nbsp;<span class="ident" id="2138532">d</span><span class="op" id="2138533">.</span><span class="ident" id="2138534">nbuf</span>&nbsp;<span class="op" id="2138539">&lt;=</span>&nbsp;<span class="num" id="2138542">0</span>&nbsp;<span class="op" id="2138544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2138550">break</span>&nbsp;<span class="comment" id="2138556">//&nbsp;EOF</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2138566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2138570">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2138575">//&nbsp;Drain&nbsp;the&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2138597">var</span>&nbsp;<span class="ident" id="2138601">nb</span><span class="op" id="2138603">,</span>&nbsp;<span class="ident" id="2138605">nc</span>&nbsp;<span class="builtintype" id="2138608">int</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2138614">nb</span><span class="op" id="2138616">,</span>&nbsp;<span class="ident" id="2138618">nc</span><span class="op" id="2138620">,</span>&nbsp;<span class="ident" id="2138622">names</span>&nbsp;<span class="op" id="2138628">=</span>&nbsp;<span class="ident" id="2138630">syscall</span><span class="op" id="2138637">.</span><span class="ident" id="2138638">ParseDirent</span><span class="op" id="2138649">(</span><span class="ident" id="2138650">d</span><span class="op" id="2138651">.</span><span class="ident" id="2138652">buf</span><span class="op" id="2138655">[</span><span class="ident" id="2138656">d</span><span class="op" id="2138657">.</span><span class="ident" id="2138658">bufp</span><span class="op" id="2138662">:</span><span class="ident" id="2138663">d</span><span class="op" id="2138664">.</span><span class="ident" id="2138665">nbuf</span><span class="op" id="2138669">]</span><span class="op" id="2138670">,</span>&nbsp;<span class="ident" id="2138672">n</span><span class="op" id="2138673">,</span>&nbsp;<span class="ident" id="2138675">names</span><span class="op" id="2138680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2138684">d</span><span class="op" id="2138685">.</span><span class="ident" id="2138686">bufp</span>&nbsp;<span class="op" id="2138691">+=</span>&nbsp;<span class="ident" id="2138694">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2138699">n</span>&nbsp;<span class="op" id="2138701">-=</span>&nbsp;<span class="ident" id="2138704">nc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2138708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2138711">if</span>&nbsp;<span class="ident" id="2138714">n</span>&nbsp;<span class="op" id="2138716">&gt;=</span>&nbsp;<span class="num" id="2138719">0</span>&nbsp;<span class="op" id="2138721">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2138724">len</span><span class="op" id="2138727">(</span><span class="ident" id="2138728">names</span><span class="op" id="2138733">)</span>&nbsp;<span class="op" id="2138735">==</span>&nbsp;<span class="num" id="2138738">0</span>&nbsp;<span class="op" id="2138740">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2138744">return</span>&nbsp;<span class="ident" id="2138751">names</span><span class="op" id="2138756">,</span>&nbsp;<span class="ident" id="2138758">io</span><span class="op" id="2138760">.</span><span class="ident" id="2138761">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2138766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2138769">return</span>&nbsp;<span class="ident" id="2138776">names</span><span class="op" id="2138781">,</span>&nbsp;<span class="ident" id="2138783">nil</span><br>
<span class="lineno"></span><span class="op" id="2138787">}</span>
</div>
</body>
</html>
