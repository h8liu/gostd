<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>io/ioutil</h2>
<ul>
<li><a href="/gostd/io/ioutil/ioutil.go.html">ioutil.go</a></li>
<li><a href="/gostd/io/ioutil/ioutil_test.go.html">ioutil_test.go</a></li>
<li><a href="/gostd/io/ioutil/tempfile.go.html">tempfile.go</a></li>
<li><a href="/gostd/io/ioutil/tempfile_test.go.html" class="current">tempfile_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7133086">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7133141">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7133195">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7133246">package</span>&nbsp;<span class="ident" id="7133254">ioutil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7133262">import</span>&nbsp;<span class="op" id="7133269">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7133272">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7133278">&#34;path/filepath&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7133295">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7133305">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7133315">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7133318">func</span>&nbsp;<span class="ident" id="7133323">TestTempFile</span><span class="op" id="7133335">(</span><span class="ident" id="7133336">t</span>&nbsp;<span class="op" id="7133338">*</span><span class="ident" id="7133339">testing</span><span class="op" id="7133346">.</span><span class="ident" id="7133347">T</span><span class="op" id="7133348">)</span>&nbsp;<span class="op" id="7133350">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7133353">f</span><span class="op" id="7133354">,</span>&nbsp;<span class="ident" id="7133356">err</span>&nbsp;<span class="op" id="7133360">:=</span>&nbsp;<span class="ident" id="7133363">TempFile</span><span class="op" id="7133371">(</span><span class="string" id="7133372">&#34;/_not_exists_&#34;</span><span class="op" id="7133387">,</span>&nbsp;<span class="string" id="7133389">&#34;foo&#34;</span><span class="op" id="7133394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7133397">if</span>&nbsp;<span class="ident" id="7133400">f</span>&nbsp;<span class="op" id="7133402">!=</span>&nbsp;<span class="ident" id="7133405">nil</span>&nbsp;<span class="op" id="7133409">||</span>&nbsp;<span class="ident" id="7133412">err</span>&nbsp;<span class="op" id="7133416">==</span>&nbsp;<span class="ident" id="7133419">nil</span>&nbsp;<span class="op" id="7133423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7133427">t</span><span class="op" id="7133428">.</span><span class="ident" id="7133429">Errorf</span><span class="op" id="7133435">(</span><span class="string" id="7133436">&#34;TempFile(`/_not_exists_`,&nbsp;`foo`)&nbsp;=&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="7133479">,</span>&nbsp;<span class="ident" id="7133481">f</span><span class="op" id="7133482">,</span>&nbsp;<span class="ident" id="7133484">err</span><span class="op" id="7133487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7133490">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7133494">dir</span>&nbsp;<span class="op" id="7133498">:=</span>&nbsp;<span class="ident" id="7133501">os</span><span class="op" id="7133503">.</span><span class="ident" id="7133504">TempDir</span><span class="op" id="7133511">(</span><span class="op" id="7133512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7133515">f</span><span class="op" id="7133516">,</span>&nbsp;<span class="ident" id="7133518">err</span>&nbsp;<span class="op" id="7133522">=</span>&nbsp;<span class="ident" id="7133524">TempFile</span><span class="op" id="7133532">(</span><span class="ident" id="7133533">dir</span><span class="op" id="7133536">,</span>&nbsp;<span class="string" id="7133538">&#34;ioutil_test&#34;</span><span class="op" id="7133551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7133554">if</span>&nbsp;<span class="ident" id="7133557">f</span>&nbsp;<span class="op" id="7133559">==</span>&nbsp;<span class="ident" id="7133562">nil</span>&nbsp;<span class="op" id="7133566">||</span>&nbsp;<span class="ident" id="7133569">err</span>&nbsp;<span class="op" id="7133573">!=</span>&nbsp;<span class="ident" id="7133576">nil</span>&nbsp;<span class="op" id="7133580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7133584">t</span><span class="op" id="7133585">.</span><span class="ident" id="7133586">Errorf</span><span class="op" id="7133592">(</span><span class="string" id="7133593">&#34;TempFile(dir,&nbsp;`ioutil_test`)&nbsp;=&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="7133632">,</span>&nbsp;<span class="ident" id="7133634">f</span><span class="op" id="7133635">,</span>&nbsp;<span class="ident" id="7133637">err</span><span class="op" id="7133640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7133643">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7133646">if</span>&nbsp;<span class="ident" id="7133649">f</span>&nbsp;<span class="op" id="7133651">!=</span>&nbsp;<span class="ident" id="7133654">nil</span>&nbsp;<span class="op" id="7133658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7133662">f</span><span class="op" id="7133663">.</span><span class="ident" id="7133664">Close</span><span class="op" id="7133669">(</span><span class="op" id="7133670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7133674">os</span><span class="op" id="7133676">.</span><span class="ident" id="7133677">Remove</span><span class="op" id="7133683">(</span><span class="ident" id="7133684">f</span><span class="op" id="7133685">.</span><span class="ident" id="7133686">Name</span><span class="op" id="7133690">(</span><span class="op" id="7133691">)</span><span class="op" id="7133692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7133696">re</span>&nbsp;<span class="op" id="7133699">:=</span>&nbsp;<span class="ident" id="7133702">regexp</span><span class="op" id="7133708">.</span><span class="ident" id="7133709">MustCompile</span><span class="op" id="7133720">(</span><span class="string" id="7133721">&#34;^&#34;</span>&nbsp;<span class="op" id="7133725">+</span>&nbsp;<span class="ident" id="7133727">regexp</span><span class="op" id="7133733">.</span><span class="ident" id="7133734">QuoteMeta</span><span class="op" id="7133743">(</span><span class="ident" id="7133744">filepath</span><span class="op" id="7133752">.</span><span class="ident" id="7133753">Join</span><span class="op" id="7133757">(</span><span class="ident" id="7133758">dir</span><span class="op" id="7133761">,</span>&nbsp;<span class="string" id="7133763">&#34;ioutil_test&#34;</span><span class="op" id="7133776">)</span><span class="op" id="7133777">)</span>&nbsp;<span class="op" id="7133779">+</span>&nbsp;<span class="string" id="7133781">&#34;[0-9]+$&#34;</span><span class="op" id="7133790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7133794">if</span>&nbsp;<span class="op" id="7133797">!</span><span class="ident" id="7133798">re</span><span class="op" id="7133800">.</span><span class="ident" id="7133801">MatchString</span><span class="op" id="7133812">(</span><span class="ident" id="7133813">f</span><span class="op" id="7133814">.</span><span class="ident" id="7133815">Name</span><span class="op" id="7133819">(</span><span class="op" id="7133820">)</span><span class="op" id="7133821">)</span>&nbsp;<span class="op" id="7133823">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7133828">t</span><span class="op" id="7133829">.</span><span class="ident" id="7133830">Errorf</span><span class="op" id="7133836">(</span><span class="string" id="7133837">&#34;TempFile(`&#34;</span><span class="op" id="7133849">+</span><span class="ident" id="7133850">dir</span><span class="op" id="7133853">+</span><span class="string" id="7133854">&#34;`,&nbsp;`ioutil_test`)&nbsp;created&nbsp;bad&nbsp;name&nbsp;%s&#34;</span><span class="op" id="7133893">,</span>&nbsp;<span class="ident" id="7133895">f</span><span class="op" id="7133896">.</span><span class="ident" id="7133897">Name</span><span class="op" id="7133901">(</span><span class="op" id="7133902">)</span><span class="op" id="7133903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7133907">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7133910">}</span><br>
<span class="lineno"></span><span class="op" id="7133912">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="keyword" id="7133915">func</span>&nbsp;<span class="ident" id="7133920">TestTempDir</span><span class="op" id="7133931">(</span><span class="ident" id="7133932">t</span>&nbsp;<span class="op" id="7133934">*</span><span class="ident" id="7133935">testing</span><span class="op" id="7133942">.</span><span class="ident" id="7133943">T</span><span class="op" id="7133944">)</span>&nbsp;<span class="op" id="7133946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7133949">name</span><span class="op" id="7133953">,</span>&nbsp;<span class="ident" id="7133955">err</span>&nbsp;<span class="op" id="7133959">:=</span>&nbsp;<span class="ident" id="7133962">TempDir</span><span class="op" id="7133969">(</span><span class="string" id="7133970">&#34;/_not_exists_&#34;</span><span class="op" id="7133985">,</span>&nbsp;<span class="string" id="7133987">&#34;foo&#34;</span><span class="op" id="7133992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7133995">if</span>&nbsp;<span class="ident" id="7133998">name</span>&nbsp;<span class="op" id="7134003">!=</span>&nbsp;<span class="string" id="7134006">&#34;&#34;</span>&nbsp;<span class="op" id="7134009">||</span>&nbsp;<span class="ident" id="7134012">err</span>&nbsp;<span class="op" id="7134016">==</span>&nbsp;<span class="ident" id="7134019">nil</span>&nbsp;<span class="op" id="7134023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7134027">t</span><span class="op" id="7134028">.</span><span class="ident" id="7134029">Errorf</span><span class="op" id="7134035">(</span><span class="string" id="7134036">&#34;TempDir(`/_not_exists_`,&nbsp;`foo`)&nbsp;=&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="7134078">,</span>&nbsp;<span class="ident" id="7134080">name</span><span class="op" id="7134084">,</span>&nbsp;<span class="ident" id="7134086">err</span><span class="op" id="7134089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7134092">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7134096">dir</span>&nbsp;<span class="op" id="7134100">:=</span>&nbsp;<span class="ident" id="7134103">os</span><span class="op" id="7134105">.</span><span class="ident" id="7134106">TempDir</span><span class="op" id="7134113">(</span><span class="op" id="7134114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7134117">name</span><span class="op" id="7134121">,</span>&nbsp;<span class="ident" id="7134123">err</span>&nbsp;<span class="op" id="7134127">=</span>&nbsp;<span class="ident" id="7134129">TempDir</span><span class="op" id="7134136">(</span><span class="ident" id="7134137">dir</span><span class="op" id="7134140">,</span>&nbsp;<span class="string" id="7134142">&#34;ioutil_test&#34;</span><span class="op" id="7134155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7134158">if</span>&nbsp;<span class="ident" id="7134161">name</span>&nbsp;<span class="op" id="7134166">==</span>&nbsp;<span class="string" id="7134169">&#34;&#34;</span>&nbsp;<span class="op" id="7134172">||</span>&nbsp;<span class="ident" id="7134175">err</span>&nbsp;<span class="op" id="7134179">!=</span>&nbsp;<span class="ident" id="7134182">nil</span>&nbsp;<span class="op" id="7134186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7134190">t</span><span class="op" id="7134191">.</span><span class="ident" id="7134192">Errorf</span><span class="op" id="7134198">(</span><span class="string" id="7134199">&#34;TempDir(dir,&nbsp;`ioutil_test`)&nbsp;=&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="7134237">,</span>&nbsp;<span class="ident" id="7134239">name</span><span class="op" id="7134243">,</span>&nbsp;<span class="ident" id="7134245">err</span><span class="op" id="7134248">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7134251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7134254">if</span>&nbsp;<span class="ident" id="7134257">name</span>&nbsp;<span class="op" id="7134262">!=</span>&nbsp;<span class="string" id="7134265">&#34;&#34;</span>&nbsp;<span class="op" id="7134268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7134272">os</span><span class="op" id="7134274">.</span><span class="ident" id="7134275">Remove</span><span class="op" id="7134281">(</span><span class="ident" id="7134282">name</span><span class="op" id="7134286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7134290">re</span>&nbsp;<span class="op" id="7134293">:=</span>&nbsp;<span class="ident" id="7134296">regexp</span><span class="op" id="7134302">.</span><span class="ident" id="7134303">MustCompile</span><span class="op" id="7134314">(</span><span class="string" id="7134315">&#34;^&#34;</span>&nbsp;<span class="op" id="7134319">+</span>&nbsp;<span class="ident" id="7134321">regexp</span><span class="op" id="7134327">.</span><span class="ident" id="7134328">QuoteMeta</span><span class="op" id="7134337">(</span><span class="ident" id="7134338">filepath</span><span class="op" id="7134346">.</span><span class="ident" id="7134347">Join</span><span class="op" id="7134351">(</span><span class="ident" id="7134352">dir</span><span class="op" id="7134355">,</span>&nbsp;<span class="string" id="7134357">&#34;ioutil_test&#34;</span><span class="op" id="7134370">)</span><span class="op" id="7134371">)</span>&nbsp;<span class="op" id="7134373">+</span>&nbsp;<span class="string" id="7134375">&#34;[0-9]+$&#34;</span><span class="op" id="7134384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7134388">if</span>&nbsp;<span class="op" id="7134391">!</span><span class="ident" id="7134392">re</span><span class="op" id="7134394">.</span><span class="ident" id="7134395">MatchString</span><span class="op" id="7134406">(</span><span class="ident" id="7134407">name</span><span class="op" id="7134411">)</span>&nbsp;<span class="op" id="7134413">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7134418">t</span><span class="op" id="7134419">.</span><span class="ident" id="7134420">Errorf</span><span class="op" id="7134426">(</span><span class="string" id="7134427">&#34;TempDir(`&#34;</span><span class="op" id="7134438">+</span><span class="ident" id="7134439">dir</span><span class="op" id="7134442">+</span><span class="string" id="7134443">&#34;`,&nbsp;`ioutil_test`)&nbsp;created&nbsp;bad&nbsp;name&nbsp;%s&#34;</span><span class="op" id="7134482">,</span>&nbsp;<span class="ident" id="7134484">name</span><span class="op" id="7134488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7134492">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7134495">}</span><br>
<span class="lineno"></span><span class="op" id="7134497">}</span>
</div>
</body>
</html>
