<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5856915">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5856970">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5857024">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5857075">/*<br>
<span class="lineno"></span>Package&nbsp;mail&nbsp;implements&nbsp;parsing&nbsp;of&nbsp;mail&nbsp;messages.<br>
<span class="lineno"></span><br>
<span class="lineno"></span>For&nbsp;the&nbsp;most&nbsp;part,&nbsp;this&nbsp;package&nbsp;follows&nbsp;the&nbsp;syntax&nbsp;as&nbsp;specified&nbsp;by&nbsp;RFC&nbsp;5322.<br>
<span class="lineno"></span>Notable&nbsp;divergences:<br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp*&nbsp;Obsolete&nbsp;address&nbsp;formats&nbsp;are&nbsp;not&nbsp;parsed,&nbsp;including&nbsp;addresses&nbsp;with<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;embedded&nbsp;route&nbsp;information.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp*&nbsp;Group&nbsp;addresses&nbsp;are&nbsp;not&nbsp;parsed.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp*&nbsp;The&nbsp;full&nbsp;range&nbsp;of&nbsp;spacing&nbsp;(the&nbsp;CFWS&nbsp;syntax&nbsp;element)&nbsp;is&nbsp;not&nbsp;supported,<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;such&nbsp;as&nbsp;breaking&nbsp;addresses&nbsp;across&nbsp;lines.<br>
<span class="lineno">15</span>*/</span><br>
<span class="lineno"></span><span class="keyword" id="5857482">package</span>&nbsp;<span class="ident" id="5857490">mail</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5857496">import</span>&nbsp;<span class="op" id="5857503">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5857506">&#34;bufio&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5857515">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5857524">&#34;encoding/base64&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5857543">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5857553">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5857560">&#34;io&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5857566">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5857579">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5857586">&#34;net/textproto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5857603">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5857614">&#34;strings&#34;</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5857625">&#34;time&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5857633">&#34;unicode&#34;</span><br>
<span class="lineno"></span><span class="op" id="5857643">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5857646">var</span>&nbsp;<span class="ident" id="5857650">debug</span>&nbsp;<span class="op" id="5857656">=</span>&nbsp;<span class="ident" id="5857658">debugT</span><span class="op" id="5857664">(</span><span class="ident" id="5857665">false</span><span class="op" id="5857670">)</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="5857673">type</span>&nbsp;<span class="ident" id="5857678">debugT</span>&nbsp;<span class="builtintype" id="5857685">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5857691">func</span>&nbsp;<span class="op" id="5857696">(</span><span class="ident" id="5857697">d</span>&nbsp;<span class="ident" id="5857699">debugT</span><span class="op" id="5857705">)</span>&nbsp;<span class="ident" id="5857707">Printf</span><span class="op" id="5857713">(</span><span class="ident" id="5857714">format</span>&nbsp;<span class="builtintype" id="5857721">string</span><span class="op" id="5857727">,</span>&nbsp;<span class="ident" id="5857729">args</span>&nbsp;<span class="op" id="5857734">...</span><span class="keyword" id="5857737">interface</span><span class="op" id="5857746">{</span><span class="op" id="5857747">}</span><span class="op" id="5857748">)</span>&nbsp;<span class="op" id="5857750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5857753">if</span>&nbsp;<span class="ident" id="5857756">d</span>&nbsp;<span class="op" id="5857758">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5857762">log</span><span class="op" id="5857765">.</span><span class="ident" id="5857766">Printf</span><span class="op" id="5857772">(</span><span class="ident" id="5857773">format</span><span class="op" id="5857779">,</span>&nbsp;<span class="ident" id="5857781">args</span><span class="op" id="5857785">...</span><span class="op" id="5857788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5857791">}</span><br>
<span class="lineno"></span><span class="op" id="5857793">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5857796">//&nbsp;A&nbsp;Message&nbsp;represents&nbsp;a&nbsp;parsed&nbsp;mail&nbsp;message.</span><br>
<span class="lineno">45</span><span class="keyword" id="5857843">type</span>&nbsp;<span class="ident" id="5857848">Message</span>&nbsp;<span class="keyword" id="5857856">struct</span>&nbsp;<span class="op" id="5857863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5857866">Header</span>&nbsp;<span class="ident" id="5857873">Header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5857881">Body</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5857888">io</span><span class="op" id="5857890">.</span><span class="ident" id="5857891">Reader</span><br>
<span class="lineno"></span><span class="op" id="5857898">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="5857901">//&nbsp;ReadMessage&nbsp;reads&nbsp;a&nbsp;message&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="5857940">//&nbsp;The&nbsp;headers&nbsp;are&nbsp;parsed,&nbsp;and&nbsp;the&nbsp;body&nbsp;of&nbsp;the&nbsp;message&nbsp;will&nbsp;be&nbsp;available</span><br>
<span class="lineno"></span><span class="comment" id="5858013">//&nbsp;for&nbsp;reading&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="5858036">func</span>&nbsp;<span class="ident" id="5858041">ReadMessage</span><span class="op" id="5858052">(</span><span class="ident" id="5858053">r</span>&nbsp;<span class="ident" id="5858055">io</span><span class="op" id="5858057">.</span><span class="ident" id="5858058">Reader</span><span class="op" id="5858064">)</span>&nbsp;<span class="op" id="5858066">(</span><span class="ident" id="5858067">msg</span>&nbsp;<span class="op" id="5858071">*</span><span class="ident" id="5858072">Message</span><span class="op" id="5858079">,</span>&nbsp;<span class="ident" id="5858081">err</span>&nbsp;<span class="builtintype" id="5858085">error</span><span class="op" id="5858090">)</span>&nbsp;<span class="op" id="5858092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5858095">tp</span>&nbsp;<span class="op" id="5858098">:=</span>&nbsp;<span class="ident" id="5858101">textproto</span><span class="op" id="5858110">.</span><span class="ident" id="5858111">NewReader</span><span class="op" id="5858120">(</span><span class="ident" id="5858121">bufio</span><span class="op" id="5858126">.</span><span class="ident" id="5858127">NewReader</span><span class="op" id="5858136">(</span><span class="ident" id="5858137">r</span><span class="op" id="5858138">)</span><span class="op" id="5858139">)</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5858143">hdr</span><span class="op" id="5858146">,</span>&nbsp;<span class="ident" id="5858148">err</span>&nbsp;<span class="op" id="5858152">:=</span>&nbsp;<span class="ident" id="5858155">tp</span><span class="op" id="5858157">.</span><span class="ident" id="5858158">ReadMIMEHeader</span><span class="op" id="5858172">(</span><span class="op" id="5858173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5858176">if</span>&nbsp;<span class="ident" id="5858179">err</span>&nbsp;<span class="op" id="5858183">!=</span>&nbsp;<span class="ident" id="5858186">nil</span>&nbsp;<span class="op" id="5858190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5858194">return</span>&nbsp;<span class="ident" id="5858201">nil</span><span class="op" id="5858204">,</span>&nbsp;<span class="ident" id="5858206">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5858211">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5858215">return</span>&nbsp;<span class="op" id="5858222">&amp;</span><span class="ident" id="5858223">Message</span><span class="op" id="5858230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5858234">Header</span><span class="op" id="5858240">:</span>&nbsp;<span class="ident" id="5858242">Header</span><span class="op" id="5858248">(</span><span class="ident" id="5858249">hdr</span><span class="op" id="5858252">)</span><span class="op" id="5858253">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5858257">Body</span><span class="op" id="5858261">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5858265">tp</span><span class="op" id="5858267">.</span><span class="ident" id="5858268">R</span><span class="op" id="5858269">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5858272">}</span><span class="op" id="5858273">,</span>&nbsp;<span class="ident" id="5858275">nil</span><br>
<span class="lineno">65</span><span class="op" id="5858279">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5858282">//&nbsp;Layouts&nbsp;suitable&nbsp;for&nbsp;passing&nbsp;to&nbsp;time.Parse.</span><br>
<span class="lineno"></span><span class="comment" id="5858329">//&nbsp;These&nbsp;are&nbsp;tried&nbsp;in&nbsp;order.</span><br>
<span class="lineno"></span><span class="keyword" id="5858358">var</span>&nbsp;<span class="ident" id="5858362">dateLayouts</span>&nbsp;<span class="op" id="5858374">[</span><span class="op" id="5858375">]</span><span class="builtintype" id="5858376">string</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="5858384">func</span>&nbsp;<span class="ident" id="5858389">init</span><span class="op" id="5858393">(</span><span class="op" id="5858394">)</span>&nbsp;<span class="op" id="5858396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5858399">//&nbsp;Generate&nbsp;layouts&nbsp;based&nbsp;on&nbsp;RFC&nbsp;5322,&nbsp;section&nbsp;3.3.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5858453">dows</span>&nbsp;<span class="op" id="5858458">:=</span>&nbsp;<span class="op" id="5858461">[</span><span class="op" id="5858462">...</span><span class="op" id="5858465">]</span><span class="builtintype" id="5858466">string</span><span class="op" id="5858472">{</span><span class="string" id="5858473">&#34;&#34;</span><span class="op" id="5858475">,</span>&nbsp;<span class="string" id="5858477">&#34;Mon,&nbsp;&#34;</span><span class="op" id="5858484">}</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5858488">//&nbsp;day-of-week</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5858504">days</span>&nbsp;<span class="op" id="5858509">:=</span>&nbsp;<span class="op" id="5858512">[</span><span class="op" id="5858513">...</span><span class="op" id="5858516">]</span><span class="builtintype" id="5858517">string</span><span class="op" id="5858523">{</span><span class="string" id="5858524">&#34;2&#34;</span><span class="op" id="5858527">,</span>&nbsp;<span class="string" id="5858529">&#34;02&#34;</span><span class="op" id="5858533">}</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5858539">//&nbsp;day&nbsp;=&nbsp;1*2DIGIT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5858558">years</span>&nbsp;<span class="op" id="5858564">:=</span>&nbsp;<span class="op" id="5858567">[</span><span class="op" id="5858568">...</span><span class="op" id="5858571">]</span><span class="builtintype" id="5858572">string</span><span class="op" id="5858578">{</span><span class="string" id="5858579">&#34;2006&#34;</span><span class="op" id="5858585">,</span>&nbsp;<span class="string" id="5858587">&#34;06&#34;</span><span class="op" id="5858591">}</span>&nbsp;<span class="comment" id="5858593">//&nbsp;year&nbsp;=&nbsp;4*DIGIT&nbsp;/&nbsp;2*DIGIT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5858622">seconds</span>&nbsp;<span class="op" id="5858630">:=</span>&nbsp;<span class="op" id="5858633">[</span><span class="op" id="5858634">...</span><span class="op" id="5858637">]</span><span class="builtintype" id="5858638">string</span><span class="op" id="5858644">{</span><span class="string" id="5858645">&#34;:05&#34;</span><span class="op" id="5858650">,</span>&nbsp;<span class="string" id="5858652">&#34;&#34;</span><span class="op" id="5858654">}</span>&nbsp;&nbsp;<span class="comment" id="5858657">//&nbsp;second</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5858668">//&nbsp;&#34;-0700&nbsp;(MST)&#34;&nbsp;is&nbsp;not&nbsp;in&nbsp;RFC&nbsp;5322,&nbsp;but&nbsp;is&nbsp;common.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5858721">zones</span>&nbsp;<span class="op" id="5858727">:=</span>&nbsp;<span class="op" id="5858730">[</span><span class="op" id="5858731">...</span><span class="op" id="5858734">]</span><span class="builtintype" id="5858735">string</span><span class="op" id="5858741">{</span><span class="string" id="5858742">&#34;-0700&#34;</span><span class="op" id="5858749">,</span>&nbsp;<span class="string" id="5858751">&#34;MST&#34;</span><span class="op" id="5858756">,</span>&nbsp;<span class="string" id="5858758">&#34;-0700&nbsp;(MST)&#34;</span><span class="op" id="5858771">}</span>&nbsp;<span class="comment" id="5858773">//&nbsp;zone&nbsp;=&nbsp;((&#34;+&#34;&nbsp;/&nbsp;&#34;-&#34;)&nbsp;4DIGIT)&nbsp;/&nbsp;&#34;GMT&#34;&nbsp;/&nbsp;...</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5858820">for</span>&nbsp;<span class="ident" id="5858824">_</span><span class="op" id="5858825">,</span>&nbsp;<span class="ident" id="5858827">dow</span>&nbsp;<span class="op" id="5858831">:=</span>&nbsp;<span class="keyword" id="5858834">range</span>&nbsp;<span class="ident" id="5858840">dows</span>&nbsp;<span class="op" id="5858845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5858849">for</span>&nbsp;<span class="ident" id="5858853">_</span><span class="op" id="5858854">,</span>&nbsp;<span class="ident" id="5858856">day</span>&nbsp;<span class="op" id="5858860">:=</span>&nbsp;<span class="keyword" id="5858863">range</span>&nbsp;<span class="ident" id="5858869">days</span>&nbsp;<span class="op" id="5858874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5858879">for</span>&nbsp;<span class="ident" id="5858883">_</span><span class="op" id="5858884">,</span>&nbsp;<span class="ident" id="5858886">year</span>&nbsp;<span class="op" id="5858891">:=</span>&nbsp;<span class="keyword" id="5858894">range</span>&nbsp;<span class="ident" id="5858900">years</span>&nbsp;<span class="op" id="5858906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5858912">for</span>&nbsp;<span class="ident" id="5858916">_</span><span class="op" id="5858917">,</span>&nbsp;<span class="ident" id="5858919">second</span>&nbsp;<span class="op" id="5858926">:=</span>&nbsp;<span class="keyword" id="5858929">range</span>&nbsp;<span class="ident" id="5858935">seconds</span>&nbsp;<span class="op" id="5858943">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5858950">for</span>&nbsp;<span class="ident" id="5858954">_</span><span class="op" id="5858955">,</span>&nbsp;<span class="ident" id="5858957">zone</span>&nbsp;<span class="op" id="5858962">:=</span>&nbsp;<span class="keyword" id="5858965">range</span>&nbsp;<span class="ident" id="5858971">zones</span>&nbsp;<span class="op" id="5858977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5858985">s</span>&nbsp;<span class="op" id="5858987">:=</span>&nbsp;<span class="ident" id="5858990">dow</span>&nbsp;<span class="op" id="5858994">+</span>&nbsp;<span class="ident" id="5858996">day</span>&nbsp;<span class="op" id="5859000">+</span>&nbsp;<span class="string" id="5859002">&#34;&nbsp;Jan&nbsp;&#34;</span>&nbsp;<span class="op" id="5859010">+</span>&nbsp;<span class="ident" id="5859012">year</span>&nbsp;<span class="op" id="5859017">+</span>&nbsp;<span class="string" id="5859019">&#34;&nbsp;15:04&#34;</span>&nbsp;<span class="op" id="5859028">+</span>&nbsp;<span class="ident" id="5859030">second</span>&nbsp;<span class="op" id="5859037">+</span>&nbsp;<span class="string" id="5859039">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="5859043">+</span>&nbsp;<span class="ident" id="5859045">zone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5859056">dateLayouts</span>&nbsp;<span class="op" id="5859068">=</span>&nbsp;<span class="builtinfunc" id="5859070">append</span><span class="op" id="5859076">(</span><span class="ident" id="5859077">dateLayouts</span><span class="op" id="5859088">,</span>&nbsp;<span class="ident" id="5859090">s</span><span class="op" id="5859091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5859098">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5859104">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5859109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5859113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5859116">}</span><br>
<span class="lineno"></span><span class="op" id="5859118">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="5859121">func</span>&nbsp;<span class="ident" id="5859126">parseDate</span><span class="op" id="5859135">(</span><span class="ident" id="5859136">date</span>&nbsp;<span class="builtintype" id="5859141">string</span><span class="op" id="5859147">)</span>&nbsp;<span class="op" id="5859149">(</span><span class="ident" id="5859150">time</span><span class="op" id="5859154">.</span><span class="ident" id="5859155">Time</span><span class="op" id="5859159">,</span>&nbsp;<span class="builtintype" id="5859161">error</span><span class="op" id="5859166">)</span>&nbsp;<span class="op" id="5859168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5859171">for</span>&nbsp;<span class="ident" id="5859175">_</span><span class="op" id="5859176">,</span>&nbsp;<span class="ident" id="5859178">layout</span>&nbsp;<span class="op" id="5859185">:=</span>&nbsp;<span class="keyword" id="5859188">range</span>&nbsp;<span class="ident" id="5859194">dateLayouts</span>&nbsp;<span class="op" id="5859206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5859210">t</span><span class="op" id="5859211">,</span>&nbsp;<span class="ident" id="5859213">err</span>&nbsp;<span class="op" id="5859217">:=</span>&nbsp;<span class="ident" id="5859220">time</span><span class="op" id="5859224">.</span><span class="ident" id="5859225">Parse</span><span class="op" id="5859230">(</span><span class="ident" id="5859231">layout</span><span class="op" id="5859237">,</span>&nbsp;<span class="ident" id="5859239">date</span><span class="op" id="5859243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5859247">if</span>&nbsp;<span class="ident" id="5859250">err</span>&nbsp;<span class="op" id="5859254">==</span>&nbsp;<span class="ident" id="5859257">nil</span>&nbsp;<span class="op" id="5859261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5859266">return</span>&nbsp;<span class="ident" id="5859273">t</span><span class="op" id="5859274">,</span>&nbsp;<span class="ident" id="5859276">nil</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5859282">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5859285">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5859288">return</span>&nbsp;<span class="ident" id="5859295">time</span><span class="op" id="5859299">.</span><span class="ident" id="5859300">Time</span><span class="op" id="5859304">{</span><span class="op" id="5859305">}</span><span class="op" id="5859306">,</span>&nbsp;<span class="ident" id="5859308">errors</span><span class="op" id="5859314">.</span><span class="ident" id="5859315">New</span><span class="op" id="5859318">(</span><span class="string" id="5859319">&#34;mail:&nbsp;header&nbsp;could&nbsp;not&nbsp;be&nbsp;parsed&#34;</span><span class="op" id="5859353">)</span><br>
<span class="lineno"></span><span class="op" id="5859355">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="5859358">//&nbsp;A&nbsp;Header&nbsp;represents&nbsp;the&nbsp;key-value&nbsp;pairs&nbsp;in&nbsp;a&nbsp;mail&nbsp;message&nbsp;header.</span><br>
<span class="lineno"></span><span class="keyword" id="5859427">type</span>&nbsp;<span class="ident" id="5859432">Header</span>&nbsp;<span class="keyword" id="5859439">map</span><span class="op" id="5859442">[</span><span class="builtintype" id="5859443">string</span><span class="op" id="5859449">]</span><span class="op" id="5859450">[</span><span class="op" id="5859451">]</span><span class="builtintype" id="5859452">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5859460">//&nbsp;Get&nbsp;gets&nbsp;the&nbsp;first&nbsp;value&nbsp;associated&nbsp;with&nbsp;the&nbsp;given&nbsp;key.</span><br>
<span class="lineno"></span><span class="comment" id="5859519">//&nbsp;If&nbsp;there&nbsp;are&nbsp;no&nbsp;values&nbsp;associated&nbsp;with&nbsp;the&nbsp;key,&nbsp;Get&nbsp;returns&nbsp;&#34;&#34;.</span><br>
<span class="lineno">110</span><span class="keyword" id="5859586">func</span>&nbsp;<span class="op" id="5859591">(</span><span class="ident" id="5859592">h</span>&nbsp;<span class="ident" id="5859594">Header</span><span class="op" id="5859600">)</span>&nbsp;<span class="ident" id="5859602">Get</span><span class="op" id="5859605">(</span><span class="ident" id="5859606">key</span>&nbsp;<span class="builtintype" id="5859610">string</span><span class="op" id="5859616">)</span>&nbsp;<span class="builtintype" id="5859618">string</span>&nbsp;<span class="op" id="5859625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5859628">return</span>&nbsp;<span class="ident" id="5859635">textproto</span><span class="op" id="5859644">.</span><span class="ident" id="5859645">MIMEHeader</span><span class="op" id="5859655">(</span><span class="ident" id="5859656">h</span><span class="op" id="5859657">)</span><span class="op" id="5859658">.</span><span class="ident" id="5859659">Get</span><span class="op" id="5859662">(</span><span class="ident" id="5859663">key</span><span class="op" id="5859666">)</span><br>
<span class="lineno"></span><span class="op" id="5859668">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5859671">var</span>&nbsp;<span class="ident" id="5859675">ErrHeaderNotPresent</span>&nbsp;<span class="op" id="5859695">=</span>&nbsp;<span class="ident" id="5859697">errors</span><span class="op" id="5859703">.</span><span class="ident" id="5859704">New</span><span class="op" id="5859707">(</span><span class="string" id="5859708">&#34;mail:&nbsp;header&nbsp;not&nbsp;in&nbsp;message&#34;</span><span class="op" id="5859737">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="5859740">//&nbsp;Date&nbsp;parses&nbsp;the&nbsp;Date&nbsp;header&nbsp;field.</span><br>
<span class="lineno"></span><span class="keyword" id="5859778">func</span>&nbsp;<span class="op" id="5859783">(</span><span class="ident" id="5859784">h</span>&nbsp;<span class="ident" id="5859786">Header</span><span class="op" id="5859792">)</span>&nbsp;<span class="ident" id="5859794">Date</span><span class="op" id="5859798">(</span><span class="op" id="5859799">)</span>&nbsp;<span class="op" id="5859801">(</span><span class="ident" id="5859802">time</span><span class="op" id="5859806">.</span><span class="ident" id="5859807">Time</span><span class="op" id="5859811">,</span>&nbsp;<span class="builtintype" id="5859813">error</span><span class="op" id="5859818">)</span>&nbsp;<span class="op" id="5859820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5859823">hdr</span>&nbsp;<span class="op" id="5859827">:=</span>&nbsp;<span class="ident" id="5859830">h</span><span class="op" id="5859831">.</span><span class="ident" id="5859832">Get</span><span class="op" id="5859835">(</span><span class="string" id="5859836">&#34;Date&#34;</span><span class="op" id="5859842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5859845">if</span>&nbsp;<span class="ident" id="5859848">hdr</span>&nbsp;<span class="op" id="5859852">==</span>&nbsp;<span class="string" id="5859855">&#34;&#34;</span>&nbsp;<span class="op" id="5859858">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5859862">return</span>&nbsp;<span class="ident" id="5859869">time</span><span class="op" id="5859873">.</span><span class="ident" id="5859874">Time</span><span class="op" id="5859878">{</span><span class="op" id="5859879">}</span><span class="op" id="5859880">,</span>&nbsp;<span class="ident" id="5859882">ErrHeaderNotPresent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5859903">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5859906">return</span>&nbsp;<span class="ident" id="5859913">parseDate</span><span class="op" id="5859922">(</span><span class="ident" id="5859923">hdr</span><span class="op" id="5859926">)</span><br>
<span class="lineno"></span><span class="op" id="5859928">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="5859931">//&nbsp;AddressList&nbsp;parses&nbsp;the&nbsp;named&nbsp;header&nbsp;field&nbsp;as&nbsp;a&nbsp;list&nbsp;of&nbsp;addresses.</span><br>
<span class="lineno"></span><span class="keyword" id="5860000">func</span>&nbsp;<span class="op" id="5860005">(</span><span class="ident" id="5860006">h</span>&nbsp;<span class="ident" id="5860008">Header</span><span class="op" id="5860014">)</span>&nbsp;<span class="ident" id="5860016">AddressList</span><span class="op" id="5860027">(</span><span class="ident" id="5860028">key</span>&nbsp;<span class="builtintype" id="5860032">string</span><span class="op" id="5860038">)</span>&nbsp;<span class="op" id="5860040">(</span><span class="op" id="5860041">[</span><span class="op" id="5860042">]</span><span class="op" id="5860043">*</span><span class="ident" id="5860044">Address</span><span class="op" id="5860051">,</span>&nbsp;<span class="builtintype" id="5860053">error</span><span class="op" id="5860058">)</span>&nbsp;<span class="op" id="5860060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5860063">hdr</span>&nbsp;<span class="op" id="5860067">:=</span>&nbsp;<span class="ident" id="5860070">h</span><span class="op" id="5860071">.</span><span class="ident" id="5860072">Get</span><span class="op" id="5860075">(</span><span class="ident" id="5860076">key</span><span class="op" id="5860079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5860082">if</span>&nbsp;<span class="ident" id="5860085">hdr</span>&nbsp;<span class="op" id="5860089">==</span>&nbsp;<span class="string" id="5860092">&#34;&#34;</span>&nbsp;<span class="op" id="5860095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5860099">return</span>&nbsp;<span class="ident" id="5860106">nil</span><span class="op" id="5860109">,</span>&nbsp;<span class="ident" id="5860111">ErrHeaderNotPresent</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5860132">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5860135">return</span>&nbsp;<span class="ident" id="5860142">ParseAddressList</span><span class="op" id="5860158">(</span><span class="ident" id="5860159">hdr</span><span class="op" id="5860162">)</span><br>
<span class="lineno"></span><span class="op" id="5860164">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5860167">//&nbsp;Address&nbsp;represents&nbsp;a&nbsp;single&nbsp;mail&nbsp;address.</span><br>
<span class="lineno">135</span><span class="comment" id="5860212">//&nbsp;An&nbsp;address&nbsp;such&nbsp;as&nbsp;&#34;Barry&nbsp;Gibbs&nbsp;&lt;bg@example.com&gt;&#34;&nbsp;is&nbsp;represented</span><br>
<span class="lineno"></span><span class="comment" id="5860280">//&nbsp;as&nbsp;Address{Name:&nbsp;&#34;Barry&nbsp;Gibbs&#34;,&nbsp;Address:&nbsp;&#34;bg@example.com&#34;}.</span><br>
<span class="lineno"></span><span class="keyword" id="5860343">type</span>&nbsp;<span class="ident" id="5860348">Address</span>&nbsp;<span class="keyword" id="5860356">struct</span>&nbsp;<span class="op" id="5860363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5860366">Name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5860374">string</span>&nbsp;<span class="comment" id="5860381">//&nbsp;Proper&nbsp;name;&nbsp;may&nbsp;be&nbsp;empty.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5860412">Address</span>&nbsp;<span class="builtintype" id="5860420">string</span>&nbsp;<span class="comment" id="5860427">//&nbsp;user@domain</span><br>
<span class="lineno">140</span><span class="op" id="5860442">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5860445">//&nbsp;Parses&nbsp;a&nbsp;single&nbsp;RFC&nbsp;5322&nbsp;address,&nbsp;e.g.&nbsp;&#34;Barry&nbsp;Gibbs&nbsp;&lt;bg@example.com&gt;&#34;</span><br>
<span class="lineno"></span><span class="keyword" id="5860518">func</span>&nbsp;<span class="ident" id="5860523">ParseAddress</span><span class="op" id="5860535">(</span><span class="ident" id="5860536">address</span>&nbsp;<span class="builtintype" id="5860544">string</span><span class="op" id="5860550">)</span>&nbsp;<span class="op" id="5860552">(</span><span class="op" id="5860553">*</span><span class="ident" id="5860554">Address</span><span class="op" id="5860561">,</span>&nbsp;<span class="builtintype" id="5860563">error</span><span class="op" id="5860568">)</span>&nbsp;<span class="op" id="5860570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5860573">return</span>&nbsp;<span class="ident" id="5860580">newAddrParser</span><span class="op" id="5860593">(</span><span class="ident" id="5860594">address</span><span class="op" id="5860601">)</span><span class="op" id="5860602">.</span><span class="ident" id="5860603">parseAddress</span><span class="op" id="5860615">(</span><span class="op" id="5860616">)</span><br>
<span class="lineno">145</span><span class="op" id="5860618">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5860621">//&nbsp;ParseAddressList&nbsp;parses&nbsp;the&nbsp;given&nbsp;string&nbsp;as&nbsp;a&nbsp;list&nbsp;of&nbsp;addresses.</span><br>
<span class="lineno"></span><span class="keyword" id="5860689">func</span>&nbsp;<span class="ident" id="5860694">ParseAddressList</span><span class="op" id="5860710">(</span><span class="ident" id="5860711">list</span>&nbsp;<span class="builtintype" id="5860716">string</span><span class="op" id="5860722">)</span>&nbsp;<span class="op" id="5860724">(</span><span class="op" id="5860725">[</span><span class="op" id="5860726">]</span><span class="op" id="5860727">*</span><span class="ident" id="5860728">Address</span><span class="op" id="5860735">,</span>&nbsp;<span class="builtintype" id="5860737">error</span><span class="op" id="5860742">)</span>&nbsp;<span class="op" id="5860744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5860747">return</span>&nbsp;<span class="ident" id="5860754">newAddrParser</span><span class="op" id="5860767">(</span><span class="ident" id="5860768">list</span><span class="op" id="5860772">)</span><span class="op" id="5860773">.</span><span class="ident" id="5860774">parseAddressList</span><span class="op" id="5860790">(</span><span class="op" id="5860791">)</span><br>
<span class="lineno">150</span><span class="op" id="5860793">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5860796">//&nbsp;String&nbsp;formats&nbsp;the&nbsp;address&nbsp;as&nbsp;a&nbsp;valid&nbsp;RFC&nbsp;5322&nbsp;address.</span><br>
<span class="lineno"></span><span class="comment" id="5860855">//&nbsp;If&nbsp;the&nbsp;address&#39;s&nbsp;name&nbsp;contains&nbsp;non-ASCII&nbsp;characters</span><br>
<span class="lineno"></span><span class="comment" id="5860910">//&nbsp;the&nbsp;name&nbsp;will&nbsp;be&nbsp;rendered&nbsp;according&nbsp;to&nbsp;RFC&nbsp;2047.</span><br>
<span class="lineno">155</span><span class="keyword" id="5860962">func</span>&nbsp;<span class="op" id="5860967">(</span><span class="ident" id="5860968">a</span>&nbsp;<span class="op" id="5860970">*</span><span class="ident" id="5860971">Address</span><span class="op" id="5860978">)</span>&nbsp;<span class="ident" id="5860980">String</span><span class="op" id="5860986">(</span><span class="op" id="5860987">)</span>&nbsp;<span class="builtintype" id="5860989">string</span>&nbsp;<span class="op" id="5860996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5860999">s</span>&nbsp;<span class="op" id="5861001">:=</span>&nbsp;<span class="string" id="5861004">&#34;&lt;&#34;</span>&nbsp;<span class="op" id="5861008">+</span>&nbsp;<span class="ident" id="5861010">a</span><span class="op" id="5861011">.</span><span class="ident" id="5861012">Address</span>&nbsp;<span class="op" id="5861020">+</span>&nbsp;<span class="string" id="5861022">&#34;&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5861027">if</span>&nbsp;<span class="ident" id="5861030">a</span><span class="op" id="5861031">.</span><span class="ident" id="5861032">Name</span>&nbsp;<span class="op" id="5861037">==</span>&nbsp;<span class="string" id="5861040">&#34;&#34;</span>&nbsp;<span class="op" id="5861043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5861047">return</span>&nbsp;<span class="ident" id="5861054">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5861057">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5861060">//&nbsp;If&nbsp;every&nbsp;character&nbsp;is&nbsp;printable&nbsp;ASCII,&nbsp;quoting&nbsp;is&nbsp;simple.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5861122">allPrintable</span>&nbsp;<span class="op" id="5861135">:=</span>&nbsp;<span class="ident" id="5861138">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5861144">for</span>&nbsp;<span class="ident" id="5861148">i</span>&nbsp;<span class="op" id="5861150">:=</span>&nbsp;<span class="num" id="5861153">0</span><span class="op" id="5861154">;</span>&nbsp;<span class="ident" id="5861156">i</span>&nbsp;<span class="op" id="5861158">&lt;</span>&nbsp;<span class="builtinfunc" id="5861160">len</span><span class="op" id="5861163">(</span><span class="ident" id="5861164">a</span><span class="op" id="5861165">.</span><span class="ident" id="5861166">Name</span><span class="op" id="5861170">)</span><span class="op" id="5861171">;</span>&nbsp;<span class="ident" id="5861173">i</span><span class="op" id="5861174">++</span>&nbsp;<span class="op" id="5861177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5861181">//&nbsp;isWSP&nbsp;here&nbsp;should&nbsp;actually&nbsp;be&nbsp;isFWS,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5861223">//&nbsp;but&nbsp;we&nbsp;don&#39;t&nbsp;support&nbsp;folding&nbsp;yet.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5861262">if</span>&nbsp;<span class="op" id="5861265">!</span><span class="ident" id="5861266">isVchar</span><span class="op" id="5861273">(</span><span class="ident" id="5861274">a</span><span class="op" id="5861275">.</span><span class="ident" id="5861276">Name</span><span class="op" id="5861280">[</span><span class="ident" id="5861281">i</span><span class="op" id="5861282">]</span><span class="op" id="5861283">)</span>&nbsp;<span class="op" id="5861285">&amp;&amp;</span>&nbsp;<span class="op" id="5861288">!</span><span class="ident" id="5861289">isWSP</span><span class="op" id="5861294">(</span><span class="ident" id="5861295">a</span><span class="op" id="5861296">.</span><span class="ident" id="5861297">Name</span><span class="op" id="5861301">[</span><span class="ident" id="5861302">i</span><span class="op" id="5861303">]</span><span class="op" id="5861304">)</span>&nbsp;<span class="op" id="5861306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5861311">allPrintable</span>&nbsp;<span class="op" id="5861324">=</span>&nbsp;<span class="ident" id="5861326">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5861335">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5861343">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5861346">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5861349">if</span>&nbsp;<span class="ident" id="5861352">allPrintable</span>&nbsp;<span class="op" id="5861365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5861369">b</span>&nbsp;<span class="op" id="5861371">:=</span>&nbsp;<span class="ident" id="5861374">bytes</span><span class="op" id="5861379">.</span><span class="ident" id="5861380">NewBufferString</span><span class="op" id="5861395">(</span><span class="string" id="5861396">`&#34;`</span><span class="op" id="5861399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5861403">for</span>&nbsp;<span class="ident" id="5861407">i</span>&nbsp;<span class="op" id="5861409">:=</span>&nbsp;<span class="num" id="5861412">0</span><span class="op" id="5861413">;</span>&nbsp;<span class="ident" id="5861415">i</span>&nbsp;<span class="op" id="5861417">&lt;</span>&nbsp;<span class="builtinfunc" id="5861419">len</span><span class="op" id="5861422">(</span><span class="ident" id="5861423">a</span><span class="op" id="5861424">.</span><span class="ident" id="5861425">Name</span><span class="op" id="5861429">)</span><span class="op" id="5861430">;</span>&nbsp;<span class="ident" id="5861432">i</span><span class="op" id="5861433">++</span>&nbsp;<span class="op" id="5861436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5861441">if</span>&nbsp;<span class="op" id="5861444">!</span><span class="ident" id="5861445">isQtext</span><span class="op" id="5861452">(</span><span class="ident" id="5861453">a</span><span class="op" id="5861454">.</span><span class="ident" id="5861455">Name</span><span class="op" id="5861459">[</span><span class="ident" id="5861460">i</span><span class="op" id="5861461">]</span><span class="op" id="5861462">)</span>&nbsp;<span class="op" id="5861464">&amp;&amp;</span>&nbsp;<span class="op" id="5861467">!</span><span class="ident" id="5861468">isWSP</span><span class="op" id="5861473">(</span><span class="ident" id="5861474">a</span><span class="op" id="5861475">.</span><span class="ident" id="5861476">Name</span><span class="op" id="5861480">[</span><span class="ident" id="5861481">i</span><span class="op" id="5861482">]</span><span class="op" id="5861483">)</span>&nbsp;<span class="op" id="5861485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5861491">b</span><span class="op" id="5861492">.</span><span class="ident" id="5861493">WriteByte</span><span class="op" id="5861502">(</span><span class="string" id="5861503">&#39;\\&#39;</span><span class="op" id="5861507">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5861512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5861517">b</span><span class="op" id="5861518">.</span><span class="ident" id="5861519">WriteByte</span><span class="op" id="5861528">(</span><span class="ident" id="5861529">a</span><span class="op" id="5861530">.</span><span class="ident" id="5861531">Name</span><span class="op" id="5861535">[</span><span class="ident" id="5861536">i</span><span class="op" id="5861537">]</span><span class="op" id="5861538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5861542">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5861546">b</span><span class="op" id="5861547">.</span><span class="ident" id="5861548">WriteString</span><span class="op" id="5861559">(</span><span class="string" id="5861560">`&#34;&nbsp;`</span><span class="op" id="5861564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5861568">b</span><span class="op" id="5861569">.</span><span class="ident" id="5861570">WriteString</span><span class="op" id="5861581">(</span><span class="ident" id="5861582">s</span><span class="op" id="5861583">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5861587">return</span>&nbsp;<span class="ident" id="5861594">b</span><span class="op" id="5861595">.</span><span class="ident" id="5861596">String</span><span class="op" id="5861602">(</span><span class="op" id="5861603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5861606">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5861610">//&nbsp;UTF-8&nbsp;&#34;Q&#34;&nbsp;encoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5861633">b</span>&nbsp;<span class="op" id="5861635">:=</span>&nbsp;<span class="ident" id="5861638">bytes</span><span class="op" id="5861643">.</span><span class="ident" id="5861644">NewBufferString</span><span class="op" id="5861659">(</span><span class="string" id="5861660">&#34;=?utf-8?q?&#34;</span><span class="op" id="5861672">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5861675">for</span>&nbsp;<span class="ident" id="5861679">i</span>&nbsp;<span class="op" id="5861681">:=</span>&nbsp;<span class="num" id="5861684">0</span><span class="op" id="5861685">;</span>&nbsp;<span class="ident" id="5861687">i</span>&nbsp;<span class="op" id="5861689">&lt;</span>&nbsp;<span class="builtinfunc" id="5861691">len</span><span class="op" id="5861694">(</span><span class="ident" id="5861695">a</span><span class="op" id="5861696">.</span><span class="ident" id="5861697">Name</span><span class="op" id="5861701">)</span><span class="op" id="5861702">;</span>&nbsp;<span class="ident" id="5861704">i</span><span class="op" id="5861705">++</span>&nbsp;<span class="op" id="5861708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5861712">switch</span>&nbsp;<span class="ident" id="5861719">c</span>&nbsp;<span class="op" id="5861721">:=</span>&nbsp;<span class="ident" id="5861724">a</span><span class="op" id="5861725">.</span><span class="ident" id="5861726">Name</span><span class="op" id="5861730">[</span><span class="ident" id="5861731">i</span><span class="op" id="5861732">]</span><span class="op" id="5861733">;</span>&nbsp;<span class="op" id="5861735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5861739">case</span>&nbsp;<span class="ident" id="5861744">c</span>&nbsp;<span class="op" id="5861746">==</span>&nbsp;<span class="string" id="5861749">&#39;&nbsp;&#39;</span><span class="op" id="5861752">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5861757">b</span><span class="op" id="5861758">.</span><span class="ident" id="5861759">WriteByte</span><span class="op" id="5861768">(</span><span class="string" id="5861769">&#39;_&#39;</span><span class="op" id="5861772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5861776">case</span>&nbsp;<span class="ident" id="5861781">isVchar</span><span class="op" id="5861788">(</span><span class="ident" id="5861789">c</span><span class="op" id="5861790">)</span>&nbsp;<span class="op" id="5861792">&amp;&amp;</span>&nbsp;<span class="ident" id="5861795">c</span>&nbsp;<span class="op" id="5861797">!=</span>&nbsp;<span class="string" id="5861800">&#39;=&#39;</span>&nbsp;<span class="op" id="5861804">&amp;&amp;</span>&nbsp;<span class="ident" id="5861807">c</span>&nbsp;<span class="op" id="5861809">!=</span>&nbsp;<span class="string" id="5861812">&#39;?&#39;</span>&nbsp;<span class="op" id="5861816">&amp;&amp;</span>&nbsp;<span class="ident" id="5861819">c</span>&nbsp;<span class="op" id="5861821">!=</span>&nbsp;<span class="string" id="5861824">&#39;_&#39;</span><span class="op" id="5861827">:</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5861832">b</span><span class="op" id="5861833">.</span><span class="ident" id="5861834">WriteByte</span><span class="op" id="5861843">(</span><span class="ident" id="5861844">c</span><span class="op" id="5861845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5861849">default</span><span class="op" id="5861856">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5861861">fmt</span><span class="op" id="5861864">.</span><span class="ident" id="5861865">Fprintf</span><span class="op" id="5861872">(</span><span class="ident" id="5861873">b</span><span class="op" id="5861874">,</span>&nbsp;<span class="string" id="5861876">&#34;=%02X&#34;</span><span class="op" id="5861883">,</span>&nbsp;<span class="ident" id="5861885">c</span><span class="op" id="5861886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5861890">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5861893">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5861896">b</span><span class="op" id="5861897">.</span><span class="ident" id="5861898">WriteString</span><span class="op" id="5861909">(</span><span class="string" id="5861910">&#34;?=&nbsp;&#34;</span><span class="op" id="5861915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5861918">b</span><span class="op" id="5861919">.</span><span class="ident" id="5861920">WriteString</span><span class="op" id="5861931">(</span><span class="ident" id="5861932">s</span><span class="op" id="5861933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5861936">return</span>&nbsp;<span class="ident" id="5861943">b</span><span class="op" id="5861944">.</span><span class="ident" id="5861945">String</span><span class="op" id="5861951">(</span><span class="op" id="5861952">)</span><br>
<span class="lineno"></span><span class="op" id="5861954">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="keyword" id="5861957">type</span>&nbsp;<span class="ident" id="5861962">addrParser</span>&nbsp;<span class="op" id="5861973">[</span><span class="op" id="5861974">]</span><span class="builtintype" id="5861975">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5861981">func</span>&nbsp;<span class="ident" id="5861986">newAddrParser</span><span class="op" id="5861999">(</span><span class="ident" id="5862000">s</span>&nbsp;<span class="builtintype" id="5862002">string</span><span class="op" id="5862008">)</span>&nbsp;<span class="op" id="5862010">*</span><span class="ident" id="5862011">addrParser</span>&nbsp;<span class="op" id="5862022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5862025">p</span>&nbsp;<span class="op" id="5862027">:=</span>&nbsp;<span class="ident" id="5862030">addrParser</span><span class="op" id="5862040">(</span><span class="ident" id="5862041">s</span><span class="op" id="5862042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5862045">return</span>&nbsp;<span class="op" id="5862052">&amp;</span><span class="ident" id="5862053">p</span><br>
<span class="lineno">205</span><span class="op" id="5862055">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5862058">func</span>&nbsp;<span class="op" id="5862063">(</span><span class="ident" id="5862064">p</span>&nbsp;<span class="op" id="5862066">*</span><span class="ident" id="5862067">addrParser</span><span class="op" id="5862077">)</span>&nbsp;<span class="ident" id="5862079">parseAddressList</span><span class="op" id="5862095">(</span><span class="op" id="5862096">)</span>&nbsp;<span class="op" id="5862098">(</span><span class="op" id="5862099">[</span><span class="op" id="5862100">]</span><span class="op" id="5862101">*</span><span class="ident" id="5862102">Address</span><span class="op" id="5862109">,</span>&nbsp;<span class="builtintype" id="5862111">error</span><span class="op" id="5862116">)</span>&nbsp;<span class="op" id="5862118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5862121">var</span>&nbsp;<span class="ident" id="5862125">list</span>&nbsp;<span class="op" id="5862130">[</span><span class="op" id="5862131">]</span><span class="op" id="5862132">*</span><span class="ident" id="5862133">Address</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5862142">for</span>&nbsp;<span class="op" id="5862146">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5862150">p</span><span class="op" id="5862151">.</span><span class="ident" id="5862152">skipSpace</span><span class="op" id="5862161">(</span><span class="op" id="5862162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5862166">addr</span><span class="op" id="5862170">,</span>&nbsp;<span class="ident" id="5862172">err</span>&nbsp;<span class="op" id="5862176">:=</span>&nbsp;<span class="ident" id="5862179">p</span><span class="op" id="5862180">.</span><span class="ident" id="5862181">parseAddress</span><span class="op" id="5862193">(</span><span class="op" id="5862194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5862198">if</span>&nbsp;<span class="ident" id="5862201">err</span>&nbsp;<span class="op" id="5862205">!=</span>&nbsp;<span class="ident" id="5862208">nil</span>&nbsp;<span class="op" id="5862212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5862217">return</span>&nbsp;<span class="ident" id="5862224">nil</span><span class="op" id="5862227">,</span>&nbsp;<span class="ident" id="5862229">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5862235">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5862239">list</span>&nbsp;<span class="op" id="5862244">=</span>&nbsp;<span class="builtinfunc" id="5862246">append</span><span class="op" id="5862252">(</span><span class="ident" id="5862253">list</span><span class="op" id="5862257">,</span>&nbsp;<span class="ident" id="5862259">addr</span><span class="op" id="5862263">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5862268">p</span><span class="op" id="5862269">.</span><span class="ident" id="5862270">skipSpace</span><span class="op" id="5862279">(</span><span class="op" id="5862280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5862284">if</span>&nbsp;<span class="ident" id="5862287">p</span><span class="op" id="5862288">.</span><span class="ident" id="5862289">empty</span><span class="op" id="5862294">(</span><span class="op" id="5862295">)</span>&nbsp;<span class="op" id="5862297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5862302">break</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5862310">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5862314">if</span>&nbsp;<span class="op" id="5862317">!</span><span class="ident" id="5862318">p</span><span class="op" id="5862319">.</span><span class="ident" id="5862320">consume</span><span class="op" id="5862327">(</span><span class="string" id="5862328">&#39;,&#39;</span><span class="op" id="5862331">)</span>&nbsp;<span class="op" id="5862333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5862338">return</span>&nbsp;<span class="ident" id="5862345">nil</span><span class="op" id="5862348">,</span>&nbsp;<span class="ident" id="5862350">errors</span><span class="op" id="5862356">.</span><span class="ident" id="5862357">New</span><span class="op" id="5862360">(</span><span class="string" id="5862361">&#34;mail:&nbsp;expected&nbsp;comma&#34;</span><span class="op" id="5862383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5862387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5862390">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5862393">return</span>&nbsp;<span class="ident" id="5862400">list</span><span class="op" id="5862404">,</span>&nbsp;<span class="ident" id="5862406">nil</span><br>
<span class="lineno"></span><span class="op" id="5862410">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5862413">//&nbsp;parseAddress&nbsp;parses&nbsp;a&nbsp;single&nbsp;RFC&nbsp;5322&nbsp;address&nbsp;at&nbsp;the&nbsp;start&nbsp;of&nbsp;p.</span><br>
<span class="lineno"></span><span class="keyword" id="5862481">func</span>&nbsp;<span class="op" id="5862486">(</span><span class="ident" id="5862487">p</span>&nbsp;<span class="op" id="5862489">*</span><span class="ident" id="5862490">addrParser</span><span class="op" id="5862500">)</span>&nbsp;<span class="ident" id="5862502">parseAddress</span><span class="op" id="5862514">(</span><span class="op" id="5862515">)</span>&nbsp;<span class="op" id="5862517">(</span><span class="ident" id="5862518">addr</span>&nbsp;<span class="op" id="5862523">*</span><span class="ident" id="5862524">Address</span><span class="op" id="5862531">,</span>&nbsp;<span class="ident" id="5862533">err</span>&nbsp;<span class="builtintype" id="5862537">error</span><span class="op" id="5862542">)</span>&nbsp;<span class="op" id="5862544">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5862547">debug</span><span class="op" id="5862552">.</span><span class="ident" id="5862553">Printf</span><span class="op" id="5862559">(</span><span class="string" id="5862560">&#34;parseAddress:&nbsp;%q&#34;</span><span class="op" id="5862578">,</span>&nbsp;<span class="op" id="5862580">*</span><span class="ident" id="5862581">p</span><span class="op" id="5862582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5862585">p</span><span class="op" id="5862586">.</span><span class="ident" id="5862587">skipSpace</span><span class="op" id="5862596">(</span><span class="op" id="5862597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5862600">if</span>&nbsp;<span class="ident" id="5862603">p</span><span class="op" id="5862604">.</span><span class="ident" id="5862605">empty</span><span class="op" id="5862610">(</span><span class="op" id="5862611">)</span>&nbsp;<span class="op" id="5862613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5862617">return</span>&nbsp;<span class="ident" id="5862624">nil</span><span class="op" id="5862627">,</span>&nbsp;<span class="ident" id="5862629">errors</span><span class="op" id="5862635">.</span><span class="ident" id="5862636">New</span><span class="op" id="5862639">(</span><span class="string" id="5862640">&#34;mail:&nbsp;no&nbsp;address&#34;</span><span class="op" id="5862658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5862661">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5862665">//&nbsp;address&nbsp;=&nbsp;name-addr&nbsp;/&nbsp;addr-spec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5862701">//&nbsp;TODO(dsymonds):&nbsp;Support&nbsp;parsing&nbsp;group&nbsp;address.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5862753">//&nbsp;addr-spec&nbsp;has&nbsp;a&nbsp;more&nbsp;restricted&nbsp;grammar&nbsp;than&nbsp;name-addr,</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5862813">//&nbsp;so&nbsp;try&nbsp;parsing&nbsp;it&nbsp;first,&nbsp;and&nbsp;fallback&nbsp;to&nbsp;name-addr.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5862869">//&nbsp;TODO(dsymonds):&nbsp;Is&nbsp;this&nbsp;really&nbsp;correct?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5862913">spec</span><span class="op" id="5862917">,</span>&nbsp;<span class="ident" id="5862919">err</span>&nbsp;<span class="op" id="5862923">:=</span>&nbsp;<span class="ident" id="5862926">p</span><span class="op" id="5862927">.</span><span class="ident" id="5862928">consumeAddrSpec</span><span class="op" id="5862943">(</span><span class="op" id="5862944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5862947">if</span>&nbsp;<span class="ident" id="5862950">err</span>&nbsp;<span class="op" id="5862954">==</span>&nbsp;<span class="ident" id="5862957">nil</span>&nbsp;<span class="op" id="5862961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5862965">return</span>&nbsp;<span class="op" id="5862972">&amp;</span><span class="ident" id="5862973">Address</span><span class="op" id="5862980">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5862985">Address</span><span class="op" id="5862992">:</span>&nbsp;<span class="ident" id="5862994">spec</span><span class="op" id="5862998">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5863002">}</span><span class="op" id="5863003">,</span>&nbsp;<span class="ident" id="5863005">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5863010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5863013">debug</span><span class="op" id="5863018">.</span><span class="ident" id="5863019">Printf</span><span class="op" id="5863025">(</span><span class="string" id="5863026">&#34;parseAddress:&nbsp;not&nbsp;an&nbsp;addr-spec:&nbsp;%v&#34;</span><span class="op" id="5863062">,</span>&nbsp;<span class="ident" id="5863064">err</span><span class="op" id="5863067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5863070">debug</span><span class="op" id="5863075">.</span><span class="ident" id="5863076">Printf</span><span class="op" id="5863082">(</span><span class="string" id="5863083">&#34;parseAddress:&nbsp;state&nbsp;is&nbsp;now&nbsp;%q&#34;</span><span class="op" id="5863114">,</span>&nbsp;<span class="op" id="5863116">*</span><span class="ident" id="5863117">p</span><span class="op" id="5863118">)</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5863122">//&nbsp;display-name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5863139">var</span>&nbsp;<span class="ident" id="5863143">displayName</span>&nbsp;<span class="builtintype" id="5863155">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5863163">if</span>&nbsp;<span class="ident" id="5863166">p</span><span class="op" id="5863167">.</span><span class="ident" id="5863168">peek</span><span class="op" id="5863172">(</span><span class="op" id="5863173">)</span>&nbsp;<span class="op" id="5863175">!=</span>&nbsp;<span class="string" id="5863178">&#39;&lt;&#39;</span>&nbsp;<span class="op" id="5863182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5863186">displayName</span><span class="op" id="5863197">,</span>&nbsp;<span class="ident" id="5863199">err</span>&nbsp;<span class="op" id="5863203">=</span>&nbsp;<span class="ident" id="5863205">p</span><span class="op" id="5863206">.</span><span class="ident" id="5863207">consumePhrase</span><span class="op" id="5863220">(</span><span class="op" id="5863221">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5863225">if</span>&nbsp;<span class="ident" id="5863228">err</span>&nbsp;<span class="op" id="5863232">!=</span>&nbsp;<span class="ident" id="5863235">nil</span>&nbsp;<span class="op" id="5863239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5863244">return</span>&nbsp;<span class="ident" id="5863251">nil</span><span class="op" id="5863254">,</span>&nbsp;<span class="ident" id="5863256">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5863262">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5863265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5863268">debug</span><span class="op" id="5863273">.</span><span class="ident" id="5863274">Printf</span><span class="op" id="5863280">(</span><span class="string" id="5863281">&#34;parseAddress:&nbsp;displayName=%q&#34;</span><span class="op" id="5863311">,</span>&nbsp;<span class="ident" id="5863313">displayName</span><span class="op" id="5863324">)</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5863328">//&nbsp;angle-addr&nbsp;=&nbsp;&#34;&lt;&#34;&nbsp;addr-spec&nbsp;&#34;&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5863363">p</span><span class="op" id="5863364">.</span><span class="ident" id="5863365">skipSpace</span><span class="op" id="5863374">(</span><span class="op" id="5863375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5863378">if</span>&nbsp;<span class="op" id="5863381">!</span><span class="ident" id="5863382">p</span><span class="op" id="5863383">.</span><span class="ident" id="5863384">consume</span><span class="op" id="5863391">(</span><span class="string" id="5863392">&#39;&lt;&#39;</span><span class="op" id="5863395">)</span>&nbsp;<span class="op" id="5863397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5863401">return</span>&nbsp;<span class="ident" id="5863408">nil</span><span class="op" id="5863411">,</span>&nbsp;<span class="ident" id="5863413">errors</span><span class="op" id="5863419">.</span><span class="ident" id="5863420">New</span><span class="op" id="5863423">(</span><span class="string" id="5863424">&#34;mail:&nbsp;no&nbsp;angle-addr&#34;</span><span class="op" id="5863445">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5863448">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5863451">spec</span><span class="op" id="5863455">,</span>&nbsp;<span class="ident" id="5863457">err</span>&nbsp;<span class="op" id="5863461">=</span>&nbsp;<span class="ident" id="5863463">p</span><span class="op" id="5863464">.</span><span class="ident" id="5863465">consumeAddrSpec</span><span class="op" id="5863480">(</span><span class="op" id="5863481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5863484">if</span>&nbsp;<span class="ident" id="5863487">err</span>&nbsp;<span class="op" id="5863491">!=</span>&nbsp;<span class="ident" id="5863494">nil</span>&nbsp;<span class="op" id="5863498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5863502">return</span>&nbsp;<span class="ident" id="5863509">nil</span><span class="op" id="5863512">,</span>&nbsp;<span class="ident" id="5863514">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5863519">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5863522">if</span>&nbsp;<span class="op" id="5863525">!</span><span class="ident" id="5863526">p</span><span class="op" id="5863527">.</span><span class="ident" id="5863528">consume</span><span class="op" id="5863535">(</span><span class="string" id="5863536">&#39;&gt;&#39;</span><span class="op" id="5863539">)</span>&nbsp;<span class="op" id="5863541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5863545">return</span>&nbsp;<span class="ident" id="5863552">nil</span><span class="op" id="5863555">,</span>&nbsp;<span class="ident" id="5863557">errors</span><span class="op" id="5863563">.</span><span class="ident" id="5863564">New</span><span class="op" id="5863567">(</span><span class="string" id="5863568">&#34;mail:&nbsp;unclosed&nbsp;angle-addr&#34;</span><span class="op" id="5863595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5863598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5863601">debug</span><span class="op" id="5863606">.</span><span class="ident" id="5863607">Printf</span><span class="op" id="5863613">(</span><span class="string" id="5863614">&#34;parseAddress:&nbsp;spec=%q&#34;</span><span class="op" id="5863637">,</span>&nbsp;<span class="ident" id="5863639">spec</span><span class="op" id="5863643">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5863647">return</span>&nbsp;<span class="op" id="5863654">&amp;</span><span class="ident" id="5863655">Address</span><span class="op" id="5863662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5863666">Name</span><span class="op" id="5863670">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5863675">displayName</span><span class="op" id="5863686">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5863690">Address</span><span class="op" id="5863697">:</span>&nbsp;<span class="ident" id="5863699">spec</span><span class="op" id="5863703">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5863706">}</span><span class="op" id="5863707">,</span>&nbsp;<span class="ident" id="5863709">nil</span><br>
<span class="lineno"></span><span class="op" id="5863713">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="comment" id="5863716">//&nbsp;consumeAddrSpec&nbsp;parses&nbsp;a&nbsp;single&nbsp;RFC&nbsp;5322&nbsp;addr-spec&nbsp;at&nbsp;the&nbsp;start&nbsp;of&nbsp;p.</span><br>
<span class="lineno"></span><span class="keyword" id="5863789">func</span>&nbsp;<span class="op" id="5863794">(</span><span class="ident" id="5863795">p</span>&nbsp;<span class="op" id="5863797">*</span><span class="ident" id="5863798">addrParser</span><span class="op" id="5863808">)</span>&nbsp;<span class="ident" id="5863810">consumeAddrSpec</span><span class="op" id="5863825">(</span><span class="op" id="5863826">)</span>&nbsp;<span class="op" id="5863828">(</span><span class="ident" id="5863829">spec</span>&nbsp;<span class="builtintype" id="5863834">string</span><span class="op" id="5863840">,</span>&nbsp;<span class="ident" id="5863842">err</span>&nbsp;<span class="builtintype" id="5863846">error</span><span class="op" id="5863851">)</span>&nbsp;<span class="op" id="5863853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5863856">debug</span><span class="op" id="5863861">.</span><span class="ident" id="5863862">Printf</span><span class="op" id="5863868">(</span><span class="string" id="5863869">&#34;consumeAddrSpec:&nbsp;%q&#34;</span><span class="op" id="5863890">,</span>&nbsp;<span class="op" id="5863892">*</span><span class="ident" id="5863893">p</span><span class="op" id="5863894">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5863898">orig</span>&nbsp;<span class="op" id="5863903">:=</span>&nbsp;<span class="op" id="5863906">*</span><span class="ident" id="5863907">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5863910">defer</span>&nbsp;<span class="keyword" id="5863916">func</span><span class="op" id="5863920">(</span><span class="op" id="5863921">)</span>&nbsp;<span class="op" id="5863923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5863927">if</span>&nbsp;<span class="ident" id="5863930">err</span>&nbsp;<span class="op" id="5863934">!=</span>&nbsp;<span class="ident" id="5863937">nil</span>&nbsp;<span class="op" id="5863941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5863946">*</span><span class="ident" id="5863947">p</span>&nbsp;<span class="op" id="5863949">=</span>&nbsp;<span class="ident" id="5863951">orig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5863958">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5863961">}</span><span class="op" id="5863962">(</span><span class="op" id="5863963">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5863967">//&nbsp;local-part&nbsp;=&nbsp;dot-atom&nbsp;/&nbsp;quoted-string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5864009">var</span>&nbsp;<span class="ident" id="5864013">localPart</span>&nbsp;<span class="builtintype" id="5864023">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5864031">p</span><span class="op" id="5864032">.</span><span class="ident" id="5864033">skipSpace</span><span class="op" id="5864042">(</span><span class="op" id="5864043">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5864046">if</span>&nbsp;<span class="ident" id="5864049">p</span><span class="op" id="5864050">.</span><span class="ident" id="5864051">empty</span><span class="op" id="5864056">(</span><span class="op" id="5864057">)</span>&nbsp;<span class="op" id="5864059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5864063">return</span>&nbsp;<span class="string" id="5864070">&#34;&#34;</span><span class="op" id="5864072">,</span>&nbsp;<span class="ident" id="5864074">errors</span><span class="op" id="5864080">.</span><span class="ident" id="5864081">New</span><span class="op" id="5864084">(</span><span class="string" id="5864085">&#34;mail:&nbsp;no&nbsp;addr-spec&#34;</span><span class="op" id="5864105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5864108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5864111">if</span>&nbsp;<span class="ident" id="5864114">p</span><span class="op" id="5864115">.</span><span class="ident" id="5864116">peek</span><span class="op" id="5864120">(</span><span class="op" id="5864121">)</span>&nbsp;<span class="op" id="5864123">==</span>&nbsp;<span class="string" id="5864126">&#39;&#34;&#39;</span>&nbsp;<span class="op" id="5864130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5864134">//&nbsp;quoted-string</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5864153">debug</span><span class="op" id="5864158">.</span><span class="ident" id="5864159">Printf</span><span class="op" id="5864165">(</span><span class="string" id="5864166">&#34;consumeAddrSpec:&nbsp;parsing&nbsp;quoted-string&#34;</span><span class="op" id="5864206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5864210">localPart</span><span class="op" id="5864219">,</span>&nbsp;<span class="ident" id="5864221">err</span>&nbsp;<span class="op" id="5864225">=</span>&nbsp;<span class="ident" id="5864227">p</span><span class="op" id="5864228">.</span><span class="ident" id="5864229">consumeQuotedString</span><span class="op" id="5864248">(</span><span class="op" id="5864249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5864252">}</span>&nbsp;<span class="keyword" id="5864254">else</span>&nbsp;<span class="op" id="5864259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5864263">//&nbsp;dot-atom</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5864277">debug</span><span class="op" id="5864282">.</span><span class="ident" id="5864283">Printf</span><span class="op" id="5864289">(</span><span class="string" id="5864290">&#34;consumeAddrSpec:&nbsp;parsing&nbsp;dot-atom&#34;</span><span class="op" id="5864325">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5864329">localPart</span><span class="op" id="5864338">,</span>&nbsp;<span class="ident" id="5864340">err</span>&nbsp;<span class="op" id="5864344">=</span>&nbsp;<span class="ident" id="5864346">p</span><span class="op" id="5864347">.</span><span class="ident" id="5864348">consumeAtom</span><span class="op" id="5864359">(</span><span class="ident" id="5864360">true</span><span class="op" id="5864364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5864367">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5864370">if</span>&nbsp;<span class="ident" id="5864373">err</span>&nbsp;<span class="op" id="5864377">!=</span>&nbsp;<span class="ident" id="5864380">nil</span>&nbsp;<span class="op" id="5864384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5864388">debug</span><span class="op" id="5864393">.</span><span class="ident" id="5864394">Printf</span><span class="op" id="5864400">(</span><span class="string" id="5864401">&#34;consumeAddrSpec:&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="5864430">,</span>&nbsp;<span class="ident" id="5864432">err</span><span class="op" id="5864435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5864439">return</span>&nbsp;<span class="string" id="5864446">&#34;&#34;</span><span class="op" id="5864448">,</span>&nbsp;<span class="ident" id="5864450">err</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5864455">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5864459">if</span>&nbsp;<span class="op" id="5864462">!</span><span class="ident" id="5864463">p</span><span class="op" id="5864464">.</span><span class="ident" id="5864465">consume</span><span class="op" id="5864472">(</span><span class="string" id="5864473">&#39;@&#39;</span><span class="op" id="5864476">)</span>&nbsp;<span class="op" id="5864478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5864482">return</span>&nbsp;<span class="string" id="5864489">&#34;&#34;</span><span class="op" id="5864491">,</span>&nbsp;<span class="ident" id="5864493">errors</span><span class="op" id="5864499">.</span><span class="ident" id="5864500">New</span><span class="op" id="5864503">(</span><span class="string" id="5864504">&#34;mail:&nbsp;missing&nbsp;@&nbsp;in&nbsp;addr-spec&#34;</span><span class="op" id="5864534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5864537">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5864541">//&nbsp;domain&nbsp;=&nbsp;dot-atom&nbsp;/&nbsp;domain-literal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5864580">var</span>&nbsp;<span class="ident" id="5864584">domain</span>&nbsp;<span class="builtintype" id="5864591">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5864599">p</span><span class="op" id="5864600">.</span><span class="ident" id="5864601">skipSpace</span><span class="op" id="5864610">(</span><span class="op" id="5864611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5864614">if</span>&nbsp;<span class="ident" id="5864617">p</span><span class="op" id="5864618">.</span><span class="ident" id="5864619">empty</span><span class="op" id="5864624">(</span><span class="op" id="5864625">)</span>&nbsp;<span class="op" id="5864627">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5864631">return</span>&nbsp;<span class="string" id="5864638">&#34;&#34;</span><span class="op" id="5864640">,</span>&nbsp;<span class="ident" id="5864642">errors</span><span class="op" id="5864648">.</span><span class="ident" id="5864649">New</span><span class="op" id="5864652">(</span><span class="string" id="5864653">&#34;mail:&nbsp;no&nbsp;domain&nbsp;in&nbsp;addr-spec&#34;</span><span class="op" id="5864683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5864686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5864689">//&nbsp;TODO(dsymonds):&nbsp;Handle&nbsp;domain-literal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5864731">domain</span><span class="op" id="5864737">,</span>&nbsp;<span class="ident" id="5864739">err</span>&nbsp;<span class="op" id="5864743">=</span>&nbsp;<span class="ident" id="5864745">p</span><span class="op" id="5864746">.</span><span class="ident" id="5864747">consumeAtom</span><span class="op" id="5864758">(</span><span class="ident" id="5864759">true</span><span class="op" id="5864763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5864766">if</span>&nbsp;<span class="ident" id="5864769">err</span>&nbsp;<span class="op" id="5864773">!=</span>&nbsp;<span class="ident" id="5864776">nil</span>&nbsp;<span class="op" id="5864780">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5864784">return</span>&nbsp;<span class="string" id="5864791">&#34;&#34;</span><span class="op" id="5864793">,</span>&nbsp;<span class="ident" id="5864795">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5864800">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5864804">return</span>&nbsp;<span class="ident" id="5864811">localPart</span>&nbsp;<span class="op" id="5864821">+</span>&nbsp;<span class="string" id="5864823">&#34;@&#34;</span>&nbsp;<span class="op" id="5864827">+</span>&nbsp;<span class="ident" id="5864829">domain</span><span class="op" id="5864835">,</span>&nbsp;<span class="ident" id="5864837">nil</span><br>
<span class="lineno"></span><span class="op" id="5864841">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="comment" id="5864844">//&nbsp;consumePhrase&nbsp;parses&nbsp;the&nbsp;RFC&nbsp;5322&nbsp;phrase&nbsp;at&nbsp;the&nbsp;start&nbsp;of&nbsp;p.</span><br>
<span class="lineno"></span><span class="keyword" id="5864907">func</span>&nbsp;<span class="op" id="5864912">(</span><span class="ident" id="5864913">p</span>&nbsp;<span class="op" id="5864915">*</span><span class="ident" id="5864916">addrParser</span><span class="op" id="5864926">)</span>&nbsp;<span class="ident" id="5864928">consumePhrase</span><span class="op" id="5864941">(</span><span class="op" id="5864942">)</span>&nbsp;<span class="op" id="5864944">(</span><span class="ident" id="5864945">phrase</span>&nbsp;<span class="builtintype" id="5864952">string</span><span class="op" id="5864958">,</span>&nbsp;<span class="ident" id="5864960">err</span>&nbsp;<span class="builtintype" id="5864964">error</span><span class="op" id="5864969">)</span>&nbsp;<span class="op" id="5864971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5864974">debug</span><span class="op" id="5864979">.</span><span class="ident" id="5864980">Printf</span><span class="op" id="5864986">(</span><span class="string" id="5864987">&#34;consumePhrase:&nbsp;[%s]&#34;</span><span class="op" id="5865008">,</span>&nbsp;<span class="op" id="5865010">*</span><span class="ident" id="5865011">p</span><span class="op" id="5865012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5865015">//&nbsp;phrase&nbsp;=&nbsp;1*word</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5865035">var</span>&nbsp;<span class="ident" id="5865039">words</span>&nbsp;<span class="op" id="5865045">[</span><span class="op" id="5865046">]</span><span class="builtintype" id="5865047">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5865055">for</span>&nbsp;<span class="op" id="5865059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5865063">//&nbsp;word&nbsp;=&nbsp;atom&nbsp;/&nbsp;quoted-string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5865096">var</span>&nbsp;<span class="ident" id="5865100">word</span>&nbsp;<span class="builtintype" id="5865105">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5865114">p</span><span class="op" id="5865115">.</span><span class="ident" id="5865116">skipSpace</span><span class="op" id="5865125">(</span><span class="op" id="5865126">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5865130">if</span>&nbsp;<span class="ident" id="5865133">p</span><span class="op" id="5865134">.</span><span class="ident" id="5865135">empty</span><span class="op" id="5865140">(</span><span class="op" id="5865141">)</span>&nbsp;<span class="op" id="5865143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5865148">return</span>&nbsp;<span class="string" id="5865155">&#34;&#34;</span><span class="op" id="5865157">,</span>&nbsp;<span class="ident" id="5865159">errors</span><span class="op" id="5865165">.</span><span class="ident" id="5865166">New</span><span class="op" id="5865169">(</span><span class="string" id="5865170">&#34;mail:&nbsp;missing&nbsp;phrase&#34;</span><span class="op" id="5865192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5865196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5865200">if</span>&nbsp;<span class="ident" id="5865203">p</span><span class="op" id="5865204">.</span><span class="ident" id="5865205">peek</span><span class="op" id="5865209">(</span><span class="op" id="5865210">)</span>&nbsp;<span class="op" id="5865212">==</span>&nbsp;<span class="string" id="5865215">&#39;&#34;&#39;</span>&nbsp;<span class="op" id="5865219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5865224">//&nbsp;quoted-string</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5865244">word</span><span class="op" id="5865248">,</span>&nbsp;<span class="ident" id="5865250">err</span>&nbsp;<span class="op" id="5865254">=</span>&nbsp;<span class="ident" id="5865256">p</span><span class="op" id="5865257">.</span><span class="ident" id="5865258">consumeQuotedString</span><span class="op" id="5865277">(</span><span class="op" id="5865278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5865282">}</span>&nbsp;<span class="keyword" id="5865284">else</span>&nbsp;<span class="op" id="5865289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5865294">//&nbsp;atom</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5865305">//&nbsp;We&nbsp;actually&nbsp;parse&nbsp;dot-atom&nbsp;here&nbsp;to&nbsp;be&nbsp;more&nbsp;permissive</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5865365">//&nbsp;than&nbsp;what&nbsp;RFC&nbsp;5322&nbsp;specifies.</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5865401">word</span><span class="op" id="5865405">,</span>&nbsp;<span class="ident" id="5865407">err</span>&nbsp;<span class="op" id="5865411">=</span>&nbsp;<span class="ident" id="5865413">p</span><span class="op" id="5865414">.</span><span class="ident" id="5865415">consumeAtom</span><span class="op" id="5865426">(</span><span class="ident" id="5865427">true</span><span class="op" id="5865431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5865435">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5865440">//&nbsp;RFC&nbsp;2047&nbsp;encoded-word&nbsp;starts&nbsp;with&nbsp;=?,&nbsp;ends&nbsp;with&nbsp;?=,&nbsp;and&nbsp;has&nbsp;two&nbsp;other&nbsp;?s.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5865519">if</span>&nbsp;<span class="ident" id="5865522">err</span>&nbsp;<span class="op" id="5865526">==</span>&nbsp;<span class="ident" id="5865529">nil</span>&nbsp;<span class="op" id="5865533">&amp;&amp;</span>&nbsp;<span class="ident" id="5865536">strings</span><span class="op" id="5865543">.</span><span class="ident" id="5865544">HasPrefix</span><span class="op" id="5865553">(</span><span class="ident" id="5865554">word</span><span class="op" id="5865558">,</span>&nbsp;<span class="string" id="5865560">&#34;=?&#34;</span><span class="op" id="5865564">)</span>&nbsp;<span class="op" id="5865566">&amp;&amp;</span>&nbsp;<span class="ident" id="5865569">strings</span><span class="op" id="5865576">.</span><span class="ident" id="5865577">HasSuffix</span><span class="op" id="5865586">(</span><span class="ident" id="5865587">word</span><span class="op" id="5865591">,</span>&nbsp;<span class="string" id="5865593">&#34;?=&#34;</span><span class="op" id="5865597">)</span>&nbsp;<span class="op" id="5865599">&amp;&amp;</span>&nbsp;<span class="ident" id="5865602">strings</span><span class="op" id="5865609">.</span><span class="ident" id="5865610">Count</span><span class="op" id="5865615">(</span><span class="ident" id="5865616">word</span><span class="op" id="5865620">,</span>&nbsp;<span class="string" id="5865622">&#34;?&#34;</span><span class="op" id="5865625">)</span>&nbsp;<span class="op" id="5865627">==</span>&nbsp;<span class="num" id="5865630">4</span>&nbsp;<span class="op" id="5865632">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5865637">word</span><span class="op" id="5865641">,</span>&nbsp;<span class="ident" id="5865643">err</span>&nbsp;<span class="op" id="5865647">=</span>&nbsp;<span class="ident" id="5865649">decodeRFC2047Word</span><span class="op" id="5865666">(</span><span class="ident" id="5865667">word</span><span class="op" id="5865671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5865675">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5865680">if</span>&nbsp;<span class="ident" id="5865683">err</span>&nbsp;<span class="op" id="5865687">!=</span>&nbsp;<span class="ident" id="5865690">nil</span>&nbsp;<span class="op" id="5865694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5865699">break</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5865707">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5865711">debug</span><span class="op" id="5865716">.</span><span class="ident" id="5865717">Printf</span><span class="op" id="5865723">(</span><span class="string" id="5865724">&#34;consumePhrase:&nbsp;consumed&nbsp;%q&#34;</span><span class="op" id="5865752">,</span>&nbsp;<span class="ident" id="5865754">word</span><span class="op" id="5865758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5865762">words</span>&nbsp;<span class="op" id="5865768">=</span>&nbsp;<span class="builtinfunc" id="5865770">append</span><span class="op" id="5865776">(</span><span class="ident" id="5865777">words</span><span class="op" id="5865782">,</span>&nbsp;<span class="ident" id="5865784">word</span><span class="op" id="5865788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5865791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5865794">//&nbsp;Ignore&nbsp;any&nbsp;error&nbsp;if&nbsp;we&nbsp;got&nbsp;at&nbsp;least&nbsp;one&nbsp;word.</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5865844">if</span>&nbsp;<span class="ident" id="5865847">err</span>&nbsp;<span class="op" id="5865851">!=</span>&nbsp;<span class="ident" id="5865854">nil</span>&nbsp;<span class="op" id="5865858">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5865861">len</span><span class="op" id="5865864">(</span><span class="ident" id="5865865">words</span><span class="op" id="5865870">)</span>&nbsp;<span class="op" id="5865872">==</span>&nbsp;<span class="num" id="5865875">0</span>&nbsp;<span class="op" id="5865877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5865881">debug</span><span class="op" id="5865886">.</span><span class="ident" id="5865887">Printf</span><span class="op" id="5865893">(</span><span class="string" id="5865894">&#34;consumePhrase:&nbsp;hit&nbsp;err:&nbsp;%v&#34;</span><span class="op" id="5865922">,</span>&nbsp;<span class="ident" id="5865924">err</span><span class="op" id="5865927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5865931">return</span>&nbsp;<span class="string" id="5865938">&#34;&#34;</span><span class="op" id="5865940">,</span>&nbsp;<span class="ident" id="5865942">fmt</span><span class="op" id="5865945">.</span><span class="ident" id="5865946">Errorf</span><span class="op" id="5865952">(</span><span class="string" id="5865953">&#34;mail:&nbsp;missing&nbsp;word&nbsp;in&nbsp;phrase:&nbsp;%v&#34;</span><span class="op" id="5865987">,</span>&nbsp;<span class="ident" id="5865989">err</span><span class="op" id="5865992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5865995">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5865998">phrase</span>&nbsp;<span class="op" id="5866005">=</span>&nbsp;<span class="ident" id="5866007">strings</span><span class="op" id="5866014">.</span><span class="ident" id="5866015">Join</span><span class="op" id="5866019">(</span><span class="ident" id="5866020">words</span><span class="op" id="5866025">,</span>&nbsp;<span class="string" id="5866027">&#34;&nbsp;&#34;</span><span class="op" id="5866030">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5866033">return</span>&nbsp;<span class="ident" id="5866040">phrase</span><span class="op" id="5866046">,</span>&nbsp;<span class="ident" id="5866048">nil</span><br>
<span class="lineno"></span><span class="op" id="5866052">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5866055">//&nbsp;consumeQuotedString&nbsp;parses&nbsp;the&nbsp;quoted&nbsp;string&nbsp;at&nbsp;the&nbsp;start&nbsp;of&nbsp;p.</span><br>
<span class="lineno"></span><span class="keyword" id="5866122">func</span>&nbsp;<span class="op" id="5866127">(</span><span class="ident" id="5866128">p</span>&nbsp;<span class="op" id="5866130">*</span><span class="ident" id="5866131">addrParser</span><span class="op" id="5866141">)</span>&nbsp;<span class="ident" id="5866143">consumeQuotedString</span><span class="op" id="5866162">(</span><span class="op" id="5866163">)</span>&nbsp;<span class="op" id="5866165">(</span><span class="ident" id="5866166">qs</span>&nbsp;<span class="builtintype" id="5866169">string</span><span class="op" id="5866175">,</span>&nbsp;<span class="ident" id="5866177">err</span>&nbsp;<span class="builtintype" id="5866181">error</span><span class="op" id="5866186">)</span>&nbsp;<span class="op" id="5866188">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5866191">//&nbsp;Assume&nbsp;first&nbsp;byte&nbsp;is&nbsp;&#39;&#34;&#39;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5866221">i</span>&nbsp;<span class="op" id="5866223">:=</span>&nbsp;<span class="num" id="5866226">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5866229">qsb</span>&nbsp;<span class="op" id="5866233">:=</span>&nbsp;<span class="builtinfunc" id="5866236">make</span><span class="op" id="5866240">(</span><span class="op" id="5866241">[</span><span class="op" id="5866242">]</span><span class="builtintype" id="5866243">byte</span><span class="op" id="5866247">,</span>&nbsp;<span class="num" id="5866249">0</span><span class="op" id="5866250">,</span>&nbsp;<span class="num" id="5866252">10</span><span class="op" id="5866254">)</span><br>
<span class="lineno"></span><span class="ident" id="5866256">Loop</span><span class="op" id="5866260">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5866263">for</span>&nbsp;<span class="op" id="5866267">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5866271">if</span>&nbsp;<span class="ident" id="5866274">i</span>&nbsp;<span class="op" id="5866276">&gt;=</span>&nbsp;<span class="ident" id="5866279">p</span><span class="op" id="5866280">.</span><span class="builtinfunc" id="5866281">len</span><span class="op" id="5866284">(</span><span class="op" id="5866285">)</span>&nbsp;<span class="op" id="5866287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5866292">return</span>&nbsp;<span class="string" id="5866299">&#34;&#34;</span><span class="op" id="5866301">,</span>&nbsp;<span class="ident" id="5866303">errors</span><span class="op" id="5866309">.</span><span class="ident" id="5866310">New</span><span class="op" id="5866313">(</span><span class="string" id="5866314">&#34;mail:&nbsp;unclosed&nbsp;quoted-string&#34;</span><span class="op" id="5866344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5866348">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5866352">switch</span>&nbsp;<span class="ident" id="5866359">c</span>&nbsp;<span class="op" id="5866361">:=</span>&nbsp;<span class="op" id="5866364">(</span><span class="op" id="5866365">*</span><span class="ident" id="5866366">p</span><span class="op" id="5866367">)</span><span class="op" id="5866368">[</span><span class="ident" id="5866369">i</span><span class="op" id="5866370">]</span><span class="op" id="5866371">;</span>&nbsp;<span class="op" id="5866373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5866377">case</span>&nbsp;<span class="ident" id="5866382">c</span>&nbsp;<span class="op" id="5866384">==</span>&nbsp;<span class="string" id="5866387">&#39;&#34;&#39;</span><span class="op" id="5866390">:</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5866395">break</span>&nbsp;<span class="ident" id="5866401">Loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5866408">case</span>&nbsp;<span class="ident" id="5866413">c</span>&nbsp;<span class="op" id="5866415">==</span>&nbsp;<span class="string" id="5866418">&#39;\\&#39;</span><span class="op" id="5866422">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5866427">if</span>&nbsp;<span class="ident" id="5866430">i</span><span class="op" id="5866431">+</span><span class="num" id="5866432">1</span>&nbsp;<span class="op" id="5866434">==</span>&nbsp;<span class="ident" id="5866437">p</span><span class="op" id="5866438">.</span><span class="builtinfunc" id="5866439">len</span><span class="op" id="5866442">(</span><span class="op" id="5866443">)</span>&nbsp;<span class="op" id="5866445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5866451">return</span>&nbsp;<span class="string" id="5866458">&#34;&#34;</span><span class="op" id="5866460">,</span>&nbsp;<span class="ident" id="5866462">errors</span><span class="op" id="5866468">.</span><span class="ident" id="5866469">New</span><span class="op" id="5866472">(</span><span class="string" id="5866473">&#34;mail:&nbsp;unclosed&nbsp;quoted-string&#34;</span><span class="op" id="5866503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5866508">}</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5866513">qsb</span>&nbsp;<span class="op" id="5866517">=</span>&nbsp;<span class="builtinfunc" id="5866519">append</span><span class="op" id="5866525">(</span><span class="ident" id="5866526">qsb</span><span class="op" id="5866529">,</span>&nbsp;<span class="op" id="5866531">(</span><span class="op" id="5866532">*</span><span class="ident" id="5866533">p</span><span class="op" id="5866534">)</span><span class="op" id="5866535">[</span><span class="ident" id="5866536">i</span><span class="op" id="5866537">+</span><span class="num" id="5866538">1</span><span class="op" id="5866539">]</span><span class="op" id="5866540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5866545">i</span>&nbsp;<span class="op" id="5866547">+=</span>&nbsp;<span class="num" id="5866550">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5866554">case</span>&nbsp;<span class="ident" id="5866559">isQtext</span><span class="op" id="5866566">(</span><span class="ident" id="5866567">c</span><span class="op" id="5866568">)</span><span class="op" id="5866569">,</span>&nbsp;<span class="ident" id="5866571">c</span>&nbsp;<span class="op" id="5866573">==</span>&nbsp;<span class="string" id="5866576">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5866580">||</span>&nbsp;<span class="ident" id="5866583">c</span>&nbsp;<span class="op" id="5866585">==</span>&nbsp;<span class="string" id="5866588">&#39;\t&#39;</span><span class="op" id="5866592">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5866597">//&nbsp;qtext&nbsp;(printable&nbsp;US-ASCII&nbsp;excluding&nbsp;&#34;&nbsp;and&nbsp;\),&nbsp;or</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5866652">//&nbsp;FWS&nbsp;(almost;&nbsp;we&#39;re&nbsp;ignoring&nbsp;CRLF)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5866692">qsb</span>&nbsp;<span class="op" id="5866696">=</span>&nbsp;<span class="builtinfunc" id="5866698">append</span><span class="op" id="5866704">(</span><span class="ident" id="5866705">qsb</span><span class="op" id="5866708">,</span>&nbsp;<span class="ident" id="5866710">c</span><span class="op" id="5866711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5866716">i</span><span class="op" id="5866717">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5866722">default</span><span class="op" id="5866729">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5866734">return</span>&nbsp;<span class="string" id="5866741">&#34;&#34;</span><span class="op" id="5866743">,</span>&nbsp;<span class="ident" id="5866745">fmt</span><span class="op" id="5866748">.</span><span class="ident" id="5866749">Errorf</span><span class="op" id="5866755">(</span><span class="string" id="5866756">&#34;mail:&nbsp;bad&nbsp;character&nbsp;in&nbsp;quoted-string:&nbsp;%q&#34;</span><span class="op" id="5866798">,</span>&nbsp;<span class="ident" id="5866800">c</span><span class="op" id="5866801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5866805">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5866808">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5866811">*</span><span class="ident" id="5866812">p</span>&nbsp;<span class="op" id="5866814">=</span>&nbsp;<span class="op" id="5866816">(</span><span class="op" id="5866817">*</span><span class="ident" id="5866818">p</span><span class="op" id="5866819">)</span><span class="op" id="5866820">[</span><span class="ident" id="5866821">i</span><span class="op" id="5866822">+</span><span class="num" id="5866823">1</span><span class="op" id="5866824">:</span><span class="op" id="5866825">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5866828">return</span>&nbsp;<span class="builtintype" id="5866835">string</span><span class="op" id="5866841">(</span><span class="ident" id="5866842">qsb</span><span class="op" id="5866845">)</span><span class="op" id="5866846">,</span>&nbsp;<span class="ident" id="5866848">nil</span><br>
<span class="lineno"></span><span class="op" id="5866852">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span><span class="comment" id="5866855">//&nbsp;consumeAtom&nbsp;parses&nbsp;an&nbsp;RFC&nbsp;5322&nbsp;atom&nbsp;at&nbsp;the&nbsp;start&nbsp;of&nbsp;p.</span><br>
<span class="lineno"></span><span class="comment" id="5866913">//&nbsp;If&nbsp;dot&nbsp;is&nbsp;true,&nbsp;consumeAtom&nbsp;parses&nbsp;an&nbsp;RFC&nbsp;5322&nbsp;dot-atom&nbsp;instead.</span><br>
<span class="lineno"></span><span class="keyword" id="5866981">func</span>&nbsp;<span class="op" id="5866986">(</span><span class="ident" id="5866987">p</span>&nbsp;<span class="op" id="5866989">*</span><span class="ident" id="5866990">addrParser</span><span class="op" id="5867000">)</span>&nbsp;<span class="ident" id="5867002">consumeAtom</span><span class="op" id="5867013">(</span><span class="ident" id="5867014">dot</span>&nbsp;<span class="builtintype" id="5867018">bool</span><span class="op" id="5867022">)</span>&nbsp;<span class="op" id="5867024">(</span><span class="ident" id="5867025">atom</span>&nbsp;<span class="builtintype" id="5867030">string</span><span class="op" id="5867036">,</span>&nbsp;<span class="ident" id="5867038">err</span>&nbsp;<span class="builtintype" id="5867042">error</span><span class="op" id="5867047">)</span>&nbsp;<span class="op" id="5867049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5867052">if</span>&nbsp;<span class="op" id="5867055">!</span><span class="ident" id="5867056">isAtext</span><span class="op" id="5867063">(</span><span class="ident" id="5867064">p</span><span class="op" id="5867065">.</span><span class="ident" id="5867066">peek</span><span class="op" id="5867070">(</span><span class="op" id="5867071">)</span><span class="op" id="5867072">,</span>&nbsp;<span class="ident" id="5867074">false</span><span class="op" id="5867079">)</span>&nbsp;<span class="op" id="5867081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5867085">return</span>&nbsp;<span class="string" id="5867092">&#34;&#34;</span><span class="op" id="5867094">,</span>&nbsp;<span class="ident" id="5867096">errors</span><span class="op" id="5867102">.</span><span class="ident" id="5867103">New</span><span class="op" id="5867106">(</span><span class="string" id="5867107">&#34;mail:&nbsp;invalid&nbsp;string&#34;</span><span class="op" id="5867129">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5867132">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5867135">i</span>&nbsp;<span class="op" id="5867137">:=</span>&nbsp;<span class="num" id="5867140">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5867143">for</span>&nbsp;<span class="op" id="5867147">;</span>&nbsp;<span class="ident" id="5867149">i</span>&nbsp;<span class="op" id="5867151">&lt;</span>&nbsp;<span class="ident" id="5867153">p</span><span class="op" id="5867154">.</span><span class="builtinfunc" id="5867155">len</span><span class="op" id="5867158">(</span><span class="op" id="5867159">)</span>&nbsp;<span class="op" id="5867161">&amp;&amp;</span>&nbsp;<span class="ident" id="5867164">isAtext</span><span class="op" id="5867171">(</span><span class="op" id="5867172">(</span><span class="op" id="5867173">*</span><span class="ident" id="5867174">p</span><span class="op" id="5867175">)</span><span class="op" id="5867176">[</span><span class="ident" id="5867177">i</span><span class="op" id="5867178">]</span><span class="op" id="5867179">,</span>&nbsp;<span class="ident" id="5867181">dot</span><span class="op" id="5867184">)</span><span class="op" id="5867185">;</span>&nbsp;<span class="ident" id="5867187">i</span><span class="op" id="5867188">++</span>&nbsp;<span class="op" id="5867191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5867194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5867197">atom</span><span class="op" id="5867201">,</span>&nbsp;<span class="op" id="5867203">*</span><span class="ident" id="5867204">p</span>&nbsp;<span class="op" id="5867206">=</span>&nbsp;<span class="builtintype" id="5867208">string</span><span class="op" id="5867214">(</span><span class="op" id="5867215">(</span><span class="op" id="5867216">*</span><span class="ident" id="5867217">p</span><span class="op" id="5867218">)</span><span class="op" id="5867219">[</span><span class="op" id="5867220">:</span><span class="ident" id="5867221">i</span><span class="op" id="5867222">]</span><span class="op" id="5867223">)</span><span class="op" id="5867224">,</span>&nbsp;<span class="op" id="5867226">(</span><span class="op" id="5867227">*</span><span class="ident" id="5867228">p</span><span class="op" id="5867229">)</span><span class="op" id="5867230">[</span><span class="ident" id="5867231">i</span><span class="op" id="5867232">:</span><span class="op" id="5867233">]</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5867236">return</span>&nbsp;<span class="ident" id="5867243">atom</span><span class="op" id="5867247">,</span>&nbsp;<span class="ident" id="5867249">nil</span><br>
<span class="lineno"></span><span class="op" id="5867253">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5867256">func</span>&nbsp;<span class="op" id="5867261">(</span><span class="ident" id="5867262">p</span>&nbsp;<span class="op" id="5867264">*</span><span class="ident" id="5867265">addrParser</span><span class="op" id="5867275">)</span>&nbsp;<span class="ident" id="5867277">consume</span><span class="op" id="5867284">(</span><span class="ident" id="5867285">c</span>&nbsp;<span class="builtintype" id="5867287">byte</span><span class="op" id="5867291">)</span>&nbsp;<span class="builtintype" id="5867293">bool</span>&nbsp;<span class="op" id="5867298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5867301">if</span>&nbsp;<span class="ident" id="5867304">p</span><span class="op" id="5867305">.</span><span class="ident" id="5867306">empty</span><span class="op" id="5867311">(</span><span class="op" id="5867312">)</span>&nbsp;<span class="op" id="5867314">||</span>&nbsp;<span class="ident" id="5867317">p</span><span class="op" id="5867318">.</span><span class="ident" id="5867319">peek</span><span class="op" id="5867323">(</span><span class="op" id="5867324">)</span>&nbsp;<span class="op" id="5867326">!=</span>&nbsp;<span class="ident" id="5867329">c</span>&nbsp;<span class="op" id="5867331">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5867335">return</span>&nbsp;<span class="ident" id="5867342">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5867349">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5867352">*</span><span class="ident" id="5867353">p</span>&nbsp;<span class="op" id="5867355">=</span>&nbsp;<span class="op" id="5867357">(</span><span class="op" id="5867358">*</span><span class="ident" id="5867359">p</span><span class="op" id="5867360">)</span><span class="op" id="5867361">[</span><span class="num" id="5867362">1</span><span class="op" id="5867363">:</span><span class="op" id="5867364">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5867367">return</span>&nbsp;<span class="ident" id="5867374">true</span><br>
<span class="lineno"></span><span class="op" id="5867379">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span><span class="comment" id="5867382">//&nbsp;skipSpace&nbsp;skips&nbsp;the&nbsp;leading&nbsp;space&nbsp;and&nbsp;tab&nbsp;characters.</span><br>
<span class="lineno"></span><span class="keyword" id="5867439">func</span>&nbsp;<span class="op" id="5867444">(</span><span class="ident" id="5867445">p</span>&nbsp;<span class="op" id="5867447">*</span><span class="ident" id="5867448">addrParser</span><span class="op" id="5867458">)</span>&nbsp;<span class="ident" id="5867460">skipSpace</span><span class="op" id="5867469">(</span><span class="op" id="5867470">)</span>&nbsp;<span class="op" id="5867472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5867475">*</span><span class="ident" id="5867476">p</span>&nbsp;<span class="op" id="5867478">=</span>&nbsp;<span class="ident" id="5867480">bytes</span><span class="op" id="5867485">.</span><span class="ident" id="5867486">TrimLeft</span><span class="op" id="5867494">(</span><span class="op" id="5867495">*</span><span class="ident" id="5867496">p</span><span class="op" id="5867497">,</span>&nbsp;<span class="string" id="5867499">&#34;&nbsp;\t&#34;</span><span class="op" id="5867504">)</span><br>
<span class="lineno"></span><span class="op" id="5867506">}</span><br>
<span class="lineno">430</span><br>
<span class="lineno"></span><span class="keyword" id="5867509">func</span>&nbsp;<span class="op" id="5867514">(</span><span class="ident" id="5867515">p</span>&nbsp;<span class="op" id="5867517">*</span><span class="ident" id="5867518">addrParser</span><span class="op" id="5867528">)</span>&nbsp;<span class="ident" id="5867530">peek</span><span class="op" id="5867534">(</span><span class="op" id="5867535">)</span>&nbsp;<span class="builtintype" id="5867537">byte</span>&nbsp;<span class="op" id="5867542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5867545">return</span>&nbsp;<span class="op" id="5867552">(</span><span class="op" id="5867553">*</span><span class="ident" id="5867554">p</span><span class="op" id="5867555">)</span><span class="op" id="5867556">[</span><span class="num" id="5867557">0</span><span class="op" id="5867558">]</span><br>
<span class="lineno"></span><span class="op" id="5867560">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span><span class="keyword" id="5867563">func</span>&nbsp;<span class="op" id="5867568">(</span><span class="ident" id="5867569">p</span>&nbsp;<span class="op" id="5867571">*</span><span class="ident" id="5867572">addrParser</span><span class="op" id="5867582">)</span>&nbsp;<span class="ident" id="5867584">empty</span><span class="op" id="5867589">(</span><span class="op" id="5867590">)</span>&nbsp;<span class="builtintype" id="5867592">bool</span>&nbsp;<span class="op" id="5867597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5867600">return</span>&nbsp;<span class="ident" id="5867607">p</span><span class="op" id="5867608">.</span><span class="builtinfunc" id="5867609">len</span><span class="op" id="5867612">(</span><span class="op" id="5867613">)</span>&nbsp;<span class="op" id="5867615">==</span>&nbsp;<span class="num" id="5867618">0</span><br>
<span class="lineno"></span><span class="op" id="5867620">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5867623">func</span>&nbsp;<span class="op" id="5867628">(</span><span class="ident" id="5867629">p</span>&nbsp;<span class="op" id="5867631">*</span><span class="ident" id="5867632">addrParser</span><span class="op" id="5867642">)</span>&nbsp;<span class="builtinfunc" id="5867644">len</span><span class="op" id="5867647">(</span><span class="op" id="5867648">)</span>&nbsp;<span class="builtintype" id="5867650">int</span>&nbsp;<span class="op" id="5867654">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5867657">return</span>&nbsp;<span class="builtinfunc" id="5867664">len</span><span class="op" id="5867667">(</span><span class="op" id="5867668">*</span><span class="ident" id="5867669">p</span><span class="op" id="5867670">)</span><br>
<span class="lineno"></span><span class="op" id="5867672">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5867675">func</span>&nbsp;<span class="ident" id="5867680">decodeRFC2047Word</span><span class="op" id="5867697">(</span><span class="ident" id="5867698">s</span>&nbsp;<span class="builtintype" id="5867700">string</span><span class="op" id="5867706">)</span>&nbsp;<span class="op" id="5867708">(</span><span class="builtintype" id="5867709">string</span><span class="op" id="5867715">,</span>&nbsp;<span class="builtintype" id="5867717">error</span><span class="op" id="5867722">)</span>&nbsp;<span class="op" id="5867724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5867727">fields</span>&nbsp;<span class="op" id="5867734">:=</span>&nbsp;<span class="ident" id="5867737">strings</span><span class="op" id="5867744">.</span><span class="ident" id="5867745">Split</span><span class="op" id="5867750">(</span><span class="ident" id="5867751">s</span><span class="op" id="5867752">,</span>&nbsp;<span class="string" id="5867754">&#34;?&#34;</span><span class="op" id="5867757">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5867760">if</span>&nbsp;<span class="builtinfunc" id="5867763">len</span><span class="op" id="5867766">(</span><span class="ident" id="5867767">fields</span><span class="op" id="5867773">)</span>&nbsp;<span class="op" id="5867775">!=</span>&nbsp;<span class="num" id="5867778">5</span>&nbsp;<span class="op" id="5867780">||</span>&nbsp;<span class="ident" id="5867783">fields</span><span class="op" id="5867789">[</span><span class="num" id="5867790">0</span><span class="op" id="5867791">]</span>&nbsp;<span class="op" id="5867793">!=</span>&nbsp;<span class="string" id="5867796">&#34;=&#34;</span>&nbsp;<span class="op" id="5867800">||</span>&nbsp;<span class="ident" id="5867803">fields</span><span class="op" id="5867809">[</span><span class="num" id="5867810">4</span><span class="op" id="5867811">]</span>&nbsp;<span class="op" id="5867813">!=</span>&nbsp;<span class="string" id="5867816">&#34;=&#34;</span>&nbsp;<span class="op" id="5867820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5867824">return</span>&nbsp;<span class="string" id="5867831">&#34;&#34;</span><span class="op" id="5867833">,</span>&nbsp;<span class="ident" id="5867835">errors</span><span class="op" id="5867841">.</span><span class="ident" id="5867842">New</span><span class="op" id="5867845">(</span><span class="string" id="5867846">&#34;address&nbsp;not&nbsp;RFC&nbsp;2047&nbsp;encoded&#34;</span><span class="op" id="5867876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5867879">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5867882">charset</span><span class="op" id="5867889">,</span>&nbsp;<span class="ident" id="5867891">enc</span>&nbsp;<span class="op" id="5867895">:=</span>&nbsp;<span class="ident" id="5867898">strings</span><span class="op" id="5867905">.</span><span class="ident" id="5867906">ToLower</span><span class="op" id="5867913">(</span><span class="ident" id="5867914">fields</span><span class="op" id="5867920">[</span><span class="num" id="5867921">1</span><span class="op" id="5867922">]</span><span class="op" id="5867923">)</span><span class="op" id="5867924">,</span>&nbsp;<span class="ident" id="5867926">strings</span><span class="op" id="5867933">.</span><span class="ident" id="5867934">ToLower</span><span class="op" id="5867941">(</span><span class="ident" id="5867942">fields</span><span class="op" id="5867948">[</span><span class="num" id="5867949">2</span><span class="op" id="5867950">]</span><span class="op" id="5867951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5867954">if</span>&nbsp;<span class="ident" id="5867957">charset</span>&nbsp;<span class="op" id="5867965">!=</span>&nbsp;<span class="string" id="5867968">&#34;us-ascii&#34;</span>&nbsp;<span class="op" id="5867979">&amp;&amp;</span>&nbsp;<span class="ident" id="5867982">charset</span>&nbsp;<span class="op" id="5867990">!=</span>&nbsp;<span class="string" id="5867993">&#34;iso-8859-1&#34;</span>&nbsp;<span class="op" id="5868006">&amp;&amp;</span>&nbsp;<span class="ident" id="5868009">charset</span>&nbsp;<span class="op" id="5868017">!=</span>&nbsp;<span class="string" id="5868020">&#34;utf-8&#34;</span>&nbsp;<span class="op" id="5868028">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5868032">return</span>&nbsp;<span class="string" id="5868039">&#34;&#34;</span><span class="op" id="5868041">,</span>&nbsp;<span class="ident" id="5868043">fmt</span><span class="op" id="5868046">.</span><span class="ident" id="5868047">Errorf</span><span class="op" id="5868053">(</span><span class="string" id="5868054">&#34;charset&nbsp;not&nbsp;supported:&nbsp;%q&#34;</span><span class="op" id="5868081">,</span>&nbsp;<span class="ident" id="5868083">charset</span><span class="op" id="5868090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5868093">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5868097">in</span>&nbsp;<span class="op" id="5868100">:=</span>&nbsp;<span class="ident" id="5868103">bytes</span><span class="op" id="5868108">.</span><span class="ident" id="5868109">NewBufferString</span><span class="op" id="5868124">(</span><span class="ident" id="5868125">fields</span><span class="op" id="5868131">[</span><span class="num" id="5868132">3</span><span class="op" id="5868133">]</span><span class="op" id="5868134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5868137">var</span>&nbsp;<span class="ident" id="5868141">r</span>&nbsp;<span class="ident" id="5868143">io</span><span class="op" id="5868145">.</span><span class="ident" id="5868146">Reader</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5868154">switch</span>&nbsp;<span class="ident" id="5868161">enc</span>&nbsp;<span class="op" id="5868165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5868168">case</span>&nbsp;<span class="string" id="5868173">&#34;b&#34;</span><span class="op" id="5868176">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5868180">r</span>&nbsp;<span class="op" id="5868182">=</span>&nbsp;<span class="ident" id="5868184">base64</span><span class="op" id="5868190">.</span><span class="ident" id="5868191">NewDecoder</span><span class="op" id="5868201">(</span><span class="ident" id="5868202">base64</span><span class="op" id="5868208">.</span><span class="ident" id="5868209">StdEncoding</span><span class="op" id="5868220">,</span>&nbsp;<span class="ident" id="5868222">in</span><span class="op" id="5868224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5868227">case</span>&nbsp;<span class="string" id="5868232">&#34;q&#34;</span><span class="op" id="5868235">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5868239">r</span>&nbsp;<span class="op" id="5868241">=</span>&nbsp;<span class="ident" id="5868243">qDecoder</span><span class="op" id="5868251">{</span><span class="ident" id="5868252">r</span><span class="op" id="5868253">:</span>&nbsp;<span class="ident" id="5868255">in</span><span class="op" id="5868257">}</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5868260">default</span><span class="op" id="5868267">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5868271">return</span>&nbsp;<span class="string" id="5868278">&#34;&#34;</span><span class="op" id="5868280">,</span>&nbsp;<span class="ident" id="5868282">fmt</span><span class="op" id="5868285">.</span><span class="ident" id="5868286">Errorf</span><span class="op" id="5868292">(</span><span class="string" id="5868293">&#34;RFC&nbsp;2047&nbsp;encoding&nbsp;not&nbsp;supported:&nbsp;%q&#34;</span><span class="op" id="5868330">,</span>&nbsp;<span class="ident" id="5868332">enc</span><span class="op" id="5868335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5868338">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5868342">dec</span><span class="op" id="5868345">,</span>&nbsp;<span class="ident" id="5868347">err</span>&nbsp;<span class="op" id="5868351">:=</span>&nbsp;<span class="ident" id="5868354">ioutil</span><span class="op" id="5868360">.</span><span class="ident" id="5868361">ReadAll</span><span class="op" id="5868368">(</span><span class="ident" id="5868369">r</span><span class="op" id="5868370">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5868373">if</span>&nbsp;<span class="ident" id="5868376">err</span>&nbsp;<span class="op" id="5868380">!=</span>&nbsp;<span class="ident" id="5868383">nil</span>&nbsp;<span class="op" id="5868387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5868391">return</span>&nbsp;<span class="string" id="5868398">&#34;&#34;</span><span class="op" id="5868400">,</span>&nbsp;<span class="ident" id="5868402">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5868407">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5868411">switch</span>&nbsp;<span class="ident" id="5868418">charset</span>&nbsp;<span class="op" id="5868426">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5868429">case</span>&nbsp;<span class="string" id="5868434">&#34;us-ascii&#34;</span><span class="op" id="5868444">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5868448">b</span>&nbsp;<span class="op" id="5868450">:=</span>&nbsp;<span class="builtinfunc" id="5868453">new</span><span class="op" id="5868456">(</span><span class="ident" id="5868457">bytes</span><span class="op" id="5868462">.</span><span class="ident" id="5868463">Buffer</span><span class="op" id="5868469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5868473">for</span>&nbsp;<span class="ident" id="5868477">_</span><span class="op" id="5868478">,</span>&nbsp;<span class="ident" id="5868480">c</span>&nbsp;<span class="op" id="5868482">:=</span>&nbsp;<span class="keyword" id="5868485">range</span>&nbsp;<span class="ident" id="5868491">dec</span>&nbsp;<span class="op" id="5868495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5868500">if</span>&nbsp;<span class="ident" id="5868503">c</span>&nbsp;<span class="op" id="5868505">&gt;=</span>&nbsp;<span class="num" id="5868508">0x80</span>&nbsp;<span class="op" id="5868513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5868519">b</span><span class="op" id="5868520">.</span><span class="ident" id="5868521">WriteRune</span><span class="op" id="5868530">(</span><span class="ident" id="5868531">unicode</span><span class="op" id="5868538">.</span><span class="ident" id="5868539">ReplacementChar</span><span class="op" id="5868554">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5868559">}</span>&nbsp;<span class="keyword" id="5868561">else</span>&nbsp;<span class="op" id="5868566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5868572">b</span><span class="op" id="5868573">.</span><span class="ident" id="5868574">WriteRune</span><span class="op" id="5868583">(</span><span class="builtintype" id="5868584">rune</span><span class="op" id="5868588">(</span><span class="ident" id="5868589">c</span><span class="op" id="5868590">)</span><span class="op" id="5868591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5868596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5868600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5868604">return</span>&nbsp;<span class="ident" id="5868611">b</span><span class="op" id="5868612">.</span><span class="ident" id="5868613">String</span><span class="op" id="5868619">(</span><span class="op" id="5868620">)</span><span class="op" id="5868621">,</span>&nbsp;<span class="ident" id="5868623">nil</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5868628">case</span>&nbsp;<span class="string" id="5868633">&#34;iso-8859-1&#34;</span><span class="op" id="5868645">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5868649">b</span>&nbsp;<span class="op" id="5868651">:=</span>&nbsp;<span class="builtinfunc" id="5868654">new</span><span class="op" id="5868657">(</span><span class="ident" id="5868658">bytes</span><span class="op" id="5868663">.</span><span class="ident" id="5868664">Buffer</span><span class="op" id="5868670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5868674">for</span>&nbsp;<span class="ident" id="5868678">_</span><span class="op" id="5868679">,</span>&nbsp;<span class="ident" id="5868681">c</span>&nbsp;<span class="op" id="5868683">:=</span>&nbsp;<span class="keyword" id="5868686">range</span>&nbsp;<span class="ident" id="5868692">dec</span>&nbsp;<span class="op" id="5868696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5868701">b</span><span class="op" id="5868702">.</span><span class="ident" id="5868703">WriteRune</span><span class="op" id="5868712">(</span><span class="builtintype" id="5868713">rune</span><span class="op" id="5868717">(</span><span class="ident" id="5868718">c</span><span class="op" id="5868719">)</span><span class="op" id="5868720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5868724">}</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5868728">return</span>&nbsp;<span class="ident" id="5868735">b</span><span class="op" id="5868736">.</span><span class="ident" id="5868737">String</span><span class="op" id="5868743">(</span><span class="op" id="5868744">)</span><span class="op" id="5868745">,</span>&nbsp;<span class="ident" id="5868747">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5868752">case</span>&nbsp;<span class="string" id="5868757">&#34;utf-8&#34;</span><span class="op" id="5868764">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5868768">return</span>&nbsp;<span class="builtintype" id="5868775">string</span><span class="op" id="5868781">(</span><span class="ident" id="5868782">dec</span><span class="op" id="5868785">)</span><span class="op" id="5868786">,</span>&nbsp;<span class="ident" id="5868788">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5868793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5868796">panic</span><span class="op" id="5868801">(</span><span class="string" id="5868802">&#34;unreachable&#34;</span><span class="op" id="5868815">)</span><br>
<span class="lineno">490</span><span class="op" id="5868817">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5868820">type</span>&nbsp;<span class="ident" id="5868825">qDecoder</span>&nbsp;<span class="keyword" id="5868834">struct</span>&nbsp;<span class="op" id="5868841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5868844">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5868852">io</span><span class="op" id="5868854">.</span><span class="ident" id="5868855">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5868863">scratch</span>&nbsp;<span class="op" id="5868871">[</span><span class="num" id="5868872">2</span><span class="op" id="5868873">]</span><span class="builtintype" id="5868874">byte</span><br>
<span class="lineno">495</span><span class="op" id="5868879">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5868882">func</span>&nbsp;<span class="op" id="5868887">(</span><span class="ident" id="5868888">qd</span>&nbsp;<span class="ident" id="5868891">qDecoder</span><span class="op" id="5868899">)</span>&nbsp;<span class="ident" id="5868901">Read</span><span class="op" id="5868905">(</span><span class="ident" id="5868906">p</span>&nbsp;<span class="op" id="5868908">[</span><span class="op" id="5868909">]</span><span class="builtintype" id="5868910">byte</span><span class="op" id="5868914">)</span>&nbsp;<span class="op" id="5868916">(</span><span class="ident" id="5868917">n</span>&nbsp;<span class="builtintype" id="5868919">int</span><span class="op" id="5868922">,</span>&nbsp;<span class="ident" id="5868924">err</span>&nbsp;<span class="builtintype" id="5868928">error</span><span class="op" id="5868933">)</span>&nbsp;<span class="op" id="5868935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5868938">//&nbsp;This&nbsp;method&nbsp;writes&nbsp;at&nbsp;most&nbsp;one&nbsp;byte&nbsp;into&nbsp;p.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5868986">if</span>&nbsp;<span class="builtinfunc" id="5868989">len</span><span class="op" id="5868992">(</span><span class="ident" id="5868993">p</span><span class="op" id="5868994">)</span>&nbsp;<span class="op" id="5868996">==</span>&nbsp;<span class="num" id="5868999">0</span>&nbsp;<span class="op" id="5869001">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5869005">return</span>&nbsp;<span class="num" id="5869012">0</span><span class="op" id="5869013">,</span>&nbsp;<span class="ident" id="5869015">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5869020">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5869023">if</span>&nbsp;<span class="ident" id="5869026">_</span><span class="op" id="5869027">,</span>&nbsp;<span class="ident" id="5869029">err</span>&nbsp;<span class="op" id="5869033">:=</span>&nbsp;<span class="ident" id="5869036">qd</span><span class="op" id="5869038">.</span><span class="ident" id="5869039">r</span><span class="op" id="5869040">.</span><span class="ident" id="5869041">Read</span><span class="op" id="5869045">(</span><span class="ident" id="5869046">qd</span><span class="op" id="5869048">.</span><span class="ident" id="5869049">scratch</span><span class="op" id="5869056">[</span><span class="op" id="5869057">:</span><span class="num" id="5869058">1</span><span class="op" id="5869059">]</span><span class="op" id="5869060">)</span><span class="op" id="5869061">;</span>&nbsp;<span class="ident" id="5869063">err</span>&nbsp;<span class="op" id="5869067">!=</span>&nbsp;<span class="ident" id="5869070">nil</span>&nbsp;<span class="op" id="5869074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5869078">return</span>&nbsp;<span class="num" id="5869085">0</span><span class="op" id="5869086">,</span>&nbsp;<span class="ident" id="5869088">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5869093">}</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5869096">switch</span>&nbsp;<span class="ident" id="5869103">c</span>&nbsp;<span class="op" id="5869105">:=</span>&nbsp;<span class="ident" id="5869108">qd</span><span class="op" id="5869110">.</span><span class="ident" id="5869111">scratch</span><span class="op" id="5869118">[</span><span class="num" id="5869119">0</span><span class="op" id="5869120">]</span><span class="op" id="5869121">;</span>&nbsp;<span class="op" id="5869123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5869126">case</span>&nbsp;<span class="ident" id="5869131">c</span>&nbsp;<span class="op" id="5869133">==</span>&nbsp;<span class="string" id="5869136">&#39;=&#39;</span><span class="op" id="5869139">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5869143">if</span>&nbsp;<span class="ident" id="5869146">_</span><span class="op" id="5869147">,</span>&nbsp;<span class="ident" id="5869149">err</span>&nbsp;<span class="op" id="5869153">:=</span>&nbsp;<span class="ident" id="5869156">io</span><span class="op" id="5869158">.</span><span class="ident" id="5869159">ReadFull</span><span class="op" id="5869167">(</span><span class="ident" id="5869168">qd</span><span class="op" id="5869170">.</span><span class="ident" id="5869171">r</span><span class="op" id="5869172">,</span>&nbsp;<span class="ident" id="5869174">qd</span><span class="op" id="5869176">.</span><span class="ident" id="5869177">scratch</span><span class="op" id="5869184">[</span><span class="op" id="5869185">:</span><span class="num" id="5869186">2</span><span class="op" id="5869187">]</span><span class="op" id="5869188">)</span><span class="op" id="5869189">;</span>&nbsp;<span class="ident" id="5869191">err</span>&nbsp;<span class="op" id="5869195">!=</span>&nbsp;<span class="ident" id="5869198">nil</span>&nbsp;<span class="op" id="5869202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5869207">return</span>&nbsp;<span class="num" id="5869214">0</span><span class="op" id="5869215">,</span>&nbsp;<span class="ident" id="5869217">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5869223">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5869227">x</span><span class="op" id="5869228">,</span>&nbsp;<span class="ident" id="5869230">err</span>&nbsp;<span class="op" id="5869234">:=</span>&nbsp;<span class="ident" id="5869237">strconv</span><span class="op" id="5869244">.</span><span class="ident" id="5869245">ParseInt</span><span class="op" id="5869253">(</span><span class="builtintype" id="5869254">string</span><span class="op" id="5869260">(</span><span class="ident" id="5869261">qd</span><span class="op" id="5869263">.</span><span class="ident" id="5869264">scratch</span><span class="op" id="5869271">[</span><span class="op" id="5869272">:</span><span class="num" id="5869273">2</span><span class="op" id="5869274">]</span><span class="op" id="5869275">)</span><span class="op" id="5869276">,</span>&nbsp;<span class="num" id="5869278">16</span><span class="op" id="5869280">,</span>&nbsp;<span class="num" id="5869282">64</span><span class="op" id="5869284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5869288">if</span>&nbsp;<span class="ident" id="5869291">err</span>&nbsp;<span class="op" id="5869295">!=</span>&nbsp;<span class="ident" id="5869298">nil</span>&nbsp;<span class="op" id="5869302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5869307">return</span>&nbsp;<span class="num" id="5869314">0</span><span class="op" id="5869315">,</span>&nbsp;<span class="ident" id="5869317">fmt</span><span class="op" id="5869320">.</span><span class="ident" id="5869321">Errorf</span><span class="op" id="5869327">(</span><span class="string" id="5869328">&#34;mail:&nbsp;invalid&nbsp;RFC&nbsp;2047&nbsp;encoding:&nbsp;%q&#34;</span><span class="op" id="5869365">,</span>&nbsp;<span class="ident" id="5869367">qd</span><span class="op" id="5869369">.</span><span class="ident" id="5869370">scratch</span><span class="op" id="5869377">[</span><span class="op" id="5869378">:</span><span class="num" id="5869379">2</span><span class="op" id="5869380">]</span><span class="op" id="5869381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5869385">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5869389">p</span><span class="op" id="5869390">[</span><span class="num" id="5869391">0</span><span class="op" id="5869392">]</span>&nbsp;<span class="op" id="5869394">=</span>&nbsp;<span class="builtintype" id="5869396">byte</span><span class="op" id="5869400">(</span><span class="ident" id="5869401">x</span><span class="op" id="5869402">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5869405">case</span>&nbsp;<span class="ident" id="5869410">c</span>&nbsp;<span class="op" id="5869412">==</span>&nbsp;<span class="string" id="5869415">&#39;_&#39;</span><span class="op" id="5869418">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5869422">p</span><span class="op" id="5869423">[</span><span class="num" id="5869424">0</span><span class="op" id="5869425">]</span>&nbsp;<span class="op" id="5869427">=</span>&nbsp;<span class="string" id="5869429">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5869434">default</span><span class="op" id="5869441">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5869445">p</span><span class="op" id="5869446">[</span><span class="num" id="5869447">0</span><span class="op" id="5869448">]</span>&nbsp;<span class="op" id="5869450">=</span>&nbsp;<span class="ident" id="5869452">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5869455">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5869458">return</span>&nbsp;<span class="num" id="5869465">1</span><span class="op" id="5869466">,</span>&nbsp;<span class="ident" id="5869468">nil</span><br>
<span class="lineno"></span><span class="op" id="5869472">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5869475">var</span>&nbsp;<span class="ident" id="5869479">atextChars</span>&nbsp;<span class="op" id="5869490">=</span>&nbsp;<span class="op" id="5869492">[</span><span class="op" id="5869493">]</span><span class="builtintype" id="5869494">byte</span><span class="op" id="5869498">(</span><span class="string" id="5869499">&#34;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#34;</span>&nbsp;<span class="op" id="5869528">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5869531">&#34;abcdefghijklmnopqrstuvwxyz&#34;</span>&nbsp;<span class="op" id="5869560">+</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5869563">&#34;0123456789&#34;</span>&nbsp;<span class="op" id="5869576">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5869579">&#34;!#$%&amp;&#39;*+-/=?^_`{|}~&#34;</span><span class="op" id="5869600">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5869603">//&nbsp;isAtext&nbsp;returns&nbsp;true&nbsp;if&nbsp;c&nbsp;is&nbsp;an&nbsp;RFC&nbsp;5322&nbsp;atext&nbsp;character.</span><br>
<span class="lineno"></span><span class="comment" id="5869664">//&nbsp;If&nbsp;dot&nbsp;is&nbsp;true,&nbsp;period&nbsp;is&nbsp;included.</span><br>
<span class="lineno">530</span><span class="keyword" id="5869703">func</span>&nbsp;<span class="ident" id="5869708">isAtext</span><span class="op" id="5869715">(</span><span class="ident" id="5869716">c</span>&nbsp;<span class="builtintype" id="5869718">byte</span><span class="op" id="5869722">,</span>&nbsp;<span class="ident" id="5869724">dot</span>&nbsp;<span class="builtintype" id="5869728">bool</span><span class="op" id="5869732">)</span>&nbsp;<span class="builtintype" id="5869734">bool</span>&nbsp;<span class="op" id="5869739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5869742">if</span>&nbsp;<span class="ident" id="5869745">dot</span>&nbsp;<span class="op" id="5869749">&amp;&amp;</span>&nbsp;<span class="ident" id="5869752">c</span>&nbsp;<span class="op" id="5869754">==</span>&nbsp;<span class="string" id="5869757">&#39;.&#39;</span>&nbsp;<span class="op" id="5869761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5869765">return</span>&nbsp;<span class="ident" id="5869772">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5869778">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5869781">return</span>&nbsp;<span class="ident" id="5869788">bytes</span><span class="op" id="5869793">.</span><span class="ident" id="5869794">IndexByte</span><span class="op" id="5869803">(</span><span class="ident" id="5869804">atextChars</span><span class="op" id="5869814">,</span>&nbsp;<span class="ident" id="5869816">c</span><span class="op" id="5869817">)</span>&nbsp;<span class="op" id="5869819">&gt;=</span>&nbsp;<span class="num" id="5869822">0</span><br>
<span class="lineno">535</span><span class="op" id="5869824">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5869827">//&nbsp;isQtext&nbsp;returns&nbsp;true&nbsp;if&nbsp;c&nbsp;is&nbsp;an&nbsp;RFC&nbsp;5322&nbsp;qtext&nbsp;character.</span><br>
<span class="lineno"></span><span class="keyword" id="5869888">func</span>&nbsp;<span class="ident" id="5869893">isQtext</span><span class="op" id="5869900">(</span><span class="ident" id="5869901">c</span>&nbsp;<span class="builtintype" id="5869903">byte</span><span class="op" id="5869907">)</span>&nbsp;<span class="builtintype" id="5869909">bool</span>&nbsp;<span class="op" id="5869914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5869917">//&nbsp;Printable&nbsp;US-ASCII,&nbsp;excluding&nbsp;backslash&nbsp;or&nbsp;quote.</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5869971">if</span>&nbsp;<span class="ident" id="5869974">c</span>&nbsp;<span class="op" id="5869976">==</span>&nbsp;<span class="string" id="5869979">&#39;\\&#39;</span>&nbsp;<span class="op" id="5869984">||</span>&nbsp;<span class="ident" id="5869987">c</span>&nbsp;<span class="op" id="5869989">==</span>&nbsp;<span class="string" id="5869992">&#39;&#34;&#39;</span>&nbsp;<span class="op" id="5869996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5870000">return</span>&nbsp;<span class="ident" id="5870007">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5870014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5870017">return</span>&nbsp;<span class="string" id="5870024">&#39;!&#39;</span>&nbsp;<span class="op" id="5870028">&lt;=</span>&nbsp;<span class="ident" id="5870031">c</span>&nbsp;<span class="op" id="5870033">&amp;&amp;</span>&nbsp;<span class="ident" id="5870036">c</span>&nbsp;<span class="op" id="5870038">&lt;=</span>&nbsp;<span class="string" id="5870041">&#39;~&#39;</span><br>
<span class="lineno"></span><span class="op" id="5870045">}</span><br>
<span class="lineno">545</span><br>
<span class="lineno"></span><span class="comment" id="5870048">//&nbsp;isVchar&nbsp;returns&nbsp;true&nbsp;if&nbsp;c&nbsp;is&nbsp;an&nbsp;RFC&nbsp;5322&nbsp;VCHAR&nbsp;character.</span><br>
<span class="lineno"></span><span class="keyword" id="5870109">func</span>&nbsp;<span class="ident" id="5870114">isVchar</span><span class="op" id="5870121">(</span><span class="ident" id="5870122">c</span>&nbsp;<span class="builtintype" id="5870124">byte</span><span class="op" id="5870128">)</span>&nbsp;<span class="builtintype" id="5870130">bool</span>&nbsp;<span class="op" id="5870135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5870138">//&nbsp;Visible&nbsp;(printing)&nbsp;characters.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5870173">return</span>&nbsp;<span class="string" id="5870180">&#39;!&#39;</span>&nbsp;<span class="op" id="5870184">&lt;=</span>&nbsp;<span class="ident" id="5870187">c</span>&nbsp;<span class="op" id="5870189">&amp;&amp;</span>&nbsp;<span class="ident" id="5870192">c</span>&nbsp;<span class="op" id="5870194">&lt;=</span>&nbsp;<span class="string" id="5870197">&#39;~&#39;</span><br>
<span class="lineno">550</span><span class="op" id="5870201">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5870204">//&nbsp;isWSP&nbsp;returns&nbsp;true&nbsp;if&nbsp;c&nbsp;is&nbsp;a&nbsp;WSP&nbsp;(white&nbsp;space).</span><br>
<span class="lineno"></span><span class="comment" id="5870255">//&nbsp;WSP&nbsp;is&nbsp;a&nbsp;space&nbsp;or&nbsp;horizontal&nbsp;tab&nbsp;(RFC5234&nbsp;Appendix&nbsp;B).</span><br>
<span class="lineno"></span><span class="keyword" id="5870313">func</span>&nbsp;<span class="ident" id="5870318">isWSP</span><span class="op" id="5870323">(</span><span class="ident" id="5870324">c</span>&nbsp;<span class="builtintype" id="5870326">byte</span><span class="op" id="5870330">)</span>&nbsp;<span class="builtintype" id="5870332">bool</span>&nbsp;<span class="op" id="5870337">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5870340">return</span>&nbsp;<span class="ident" id="5870347">c</span>&nbsp;<span class="op" id="5870349">==</span>&nbsp;<span class="string" id="5870352">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5870356">||</span>&nbsp;<span class="ident" id="5870359">c</span>&nbsp;<span class="op" id="5870361">==</span>&nbsp;<span class="string" id="5870364">&#39;\t&#39;</span><br>
<span class="lineno"></span><span class="op" id="5870369">}</span>
</div>
</body>
</html>
