<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/textproto</h2>
<ul>
<li><a href="/gostd/net/textproto/header.go.html">header.go</a></li>
<li><a href="/gostd/net/textproto/pipeline.go.html">pipeline.go</a></li>
<li><a href="/gostd/net/textproto/reader.go.html">reader.go</a></li>
<li><a href="/gostd/net/textproto/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/net/textproto/textproto.go.html">textproto.go</a></li>
<li><a href="/gostd/net/textproto/writer.go.html">writer.go</a></li>
<li><a href="/gostd/net/textproto/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4550674">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4550730">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4550784">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4550835">package</span>&nbsp;<span class="ident" id="4550843">textproto</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4550854">import</span>&nbsp;<span class="op" id="4550861">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4550864">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4550873">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4550882">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4550888">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4550901">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4550912">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="4550922">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="4550925">//&nbsp;BUG(rsc):&nbsp;To&nbsp;let&nbsp;callers&nbsp;manage&nbsp;exposure&nbsp;to&nbsp;denial&nbsp;of&nbsp;service</span><br>
<span class="lineno"></span><span class="comment" id="4550990">//&nbsp;attacks,&nbsp;Reader&nbsp;should&nbsp;allow&nbsp;them&nbsp;to&nbsp;set&nbsp;and&nbsp;reset&nbsp;a&nbsp;limit&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="4551055">//&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;from&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="4551105">//&nbsp;A&nbsp;Reader&nbsp;implements&nbsp;convenience&nbsp;methods&nbsp;for&nbsp;reading&nbsp;requests</span><br>
<span class="lineno"></span><span class="comment" id="4551169">//&nbsp;or&nbsp;responses&nbsp;from&nbsp;a&nbsp;text&nbsp;protocol&nbsp;network&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="4551226">type</span>&nbsp;<span class="ident" id="4551231">Reader</span>&nbsp;<span class="keyword" id="4551238">struct</span>&nbsp;<span class="op" id="4551245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4551248">R</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4551252">*</span><span class="ident" id="4551253">bufio</span><span class="op" id="4551258">.</span><span class="ident" id="4551259">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4551267">dot</span>&nbsp;<span class="op" id="4551271">*</span><span class="ident" id="4551272">dotReader</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4551283">buf</span>&nbsp;<span class="op" id="4551287">[</span><span class="op" id="4551288">]</span><span class="builtintype" id="4551289">byte</span>&nbsp;<span class="comment" id="4551294">//&nbsp;a&nbsp;re-usable&nbsp;buffer&nbsp;for&nbsp;readContinuedLineSlice</span><br>
<span class="lineno"></span><span class="op" id="4551343">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4551346">//&nbsp;NewReader&nbsp;returns&nbsp;a&nbsp;new&nbsp;Reader&nbsp;reading&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="4551396">func</span>&nbsp;<span class="ident" id="4551401">NewReader</span><span class="op" id="4551410">(</span><span class="ident" id="4551411">r</span>&nbsp;<span class="op" id="4551413">*</span><span class="ident" id="4551414">bufio</span><span class="op" id="4551419">.</span><span class="ident" id="4551420">Reader</span><span class="op" id="4551426">)</span>&nbsp;<span class="op" id="4551428">*</span><span class="ident" id="4551429">Reader</span>&nbsp;<span class="op" id="4551436">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4551439">return</span>&nbsp;<span class="op" id="4551446">&amp;</span><span class="ident" id="4551447">Reader</span><span class="op" id="4551453">{</span><span class="ident" id="4551454">R</span><span class="op" id="4551455">:</span>&nbsp;<span class="ident" id="4551457">r</span><span class="op" id="4551458">}</span><br>
<span class="lineno"></span><span class="op" id="4551460">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4551463">//&nbsp;ReadLine&nbsp;reads&nbsp;a&nbsp;single&nbsp;line&nbsp;from&nbsp;r,</span><br>
<span class="lineno"></span><span class="comment" id="4551503">//&nbsp;eliding&nbsp;the&nbsp;final&nbsp;\n&nbsp;or&nbsp;\r\n&nbsp;from&nbsp;the&nbsp;returned&nbsp;string.</span><br>
<span class="lineno">35</span><span class="keyword" id="4551561">func</span>&nbsp;<span class="op" id="4551566">(</span><span class="ident" id="4551567">r</span>&nbsp;<span class="op" id="4551569">*</span><span class="ident" id="4551570">Reader</span><span class="op" id="4551576">)</span>&nbsp;<span class="ident" id="4551578">ReadLine</span><span class="op" id="4551586">(</span><span class="op" id="4551587">)</span>&nbsp;<span class="op" id="4551589">(</span><span class="builtintype" id="4551590">string</span><span class="op" id="4551596">,</span>&nbsp;<span class="builtintype" id="4551598">error</span><span class="op" id="4551603">)</span>&nbsp;<span class="op" id="4551605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4551608">line</span><span class="op" id="4551612">,</span>&nbsp;<span class="ident" id="4551614">err</span>&nbsp;<span class="op" id="4551618">:=</span>&nbsp;<span class="ident" id="4551621">r</span><span class="op" id="4551622">.</span><span class="ident" id="4551623">readLineSlice</span><span class="op" id="4551636">(</span><span class="op" id="4551637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4551640">return</span>&nbsp;<span class="builtintype" id="4551647">string</span><span class="op" id="4551653">(</span><span class="ident" id="4551654">line</span><span class="op" id="4551658">)</span><span class="op" id="4551659">,</span>&nbsp;<span class="ident" id="4551661">err</span><br>
<span class="lineno"></span><span class="op" id="4551665">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="4551668">//&nbsp;ReadLineBytes&nbsp;is&nbsp;like&nbsp;ReadLine&nbsp;but&nbsp;returns&nbsp;a&nbsp;[]byte&nbsp;instead&nbsp;of&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="4551744">func</span>&nbsp;<span class="op" id="4551749">(</span><span class="ident" id="4551750">r</span>&nbsp;<span class="op" id="4551752">*</span><span class="ident" id="4551753">Reader</span><span class="op" id="4551759">)</span>&nbsp;<span class="ident" id="4551761">ReadLineBytes</span><span class="op" id="4551774">(</span><span class="op" id="4551775">)</span>&nbsp;<span class="op" id="4551777">(</span><span class="op" id="4551778">[</span><span class="op" id="4551779">]</span><span class="builtintype" id="4551780">byte</span><span class="op" id="4551784">,</span>&nbsp;<span class="builtintype" id="4551786">error</span><span class="op" id="4551791">)</span>&nbsp;<span class="op" id="4551793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4551796">line</span><span class="op" id="4551800">,</span>&nbsp;<span class="ident" id="4551802">err</span>&nbsp;<span class="op" id="4551806">:=</span>&nbsp;<span class="ident" id="4551809">r</span><span class="op" id="4551810">.</span><span class="ident" id="4551811">readLineSlice</span><span class="op" id="4551824">(</span><span class="op" id="4551825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4551828">if</span>&nbsp;<span class="ident" id="4551831">line</span>&nbsp;<span class="op" id="4551836">!=</span>&nbsp;<span class="ident" id="4551839">nil</span>&nbsp;<span class="op" id="4551843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4551847">buf</span>&nbsp;<span class="op" id="4551851">:=</span>&nbsp;<span class="builtinfunc" id="4551854">make</span><span class="op" id="4551858">(</span><span class="op" id="4551859">[</span><span class="op" id="4551860">]</span><span class="builtintype" id="4551861">byte</span><span class="op" id="4551865">,</span>&nbsp;<span class="builtinfunc" id="4551867">len</span><span class="op" id="4551870">(</span><span class="ident" id="4551871">line</span><span class="op" id="4551875">)</span><span class="op" id="4551876">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4551880">copy</span><span class="op" id="4551884">(</span><span class="ident" id="4551885">buf</span><span class="op" id="4551888">,</span>&nbsp;<span class="ident" id="4551890">line</span><span class="op" id="4551894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4551898">line</span>&nbsp;<span class="op" id="4551903">=</span>&nbsp;<span class="ident" id="4551905">buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4551910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4551913">return</span>&nbsp;<span class="ident" id="4551920">line</span><span class="op" id="4551924">,</span>&nbsp;<span class="ident" id="4551926">err</span><br>
<span class="lineno"></span><span class="op" id="4551930">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="4551933">func</span>&nbsp;<span class="op" id="4551938">(</span><span class="ident" id="4551939">r</span>&nbsp;<span class="op" id="4551941">*</span><span class="ident" id="4551942">Reader</span><span class="op" id="4551948">)</span>&nbsp;<span class="ident" id="4551950">readLineSlice</span><span class="op" id="4551963">(</span><span class="op" id="4551964">)</span>&nbsp;<span class="op" id="4551966">(</span><span class="op" id="4551967">[</span><span class="op" id="4551968">]</span><span class="builtintype" id="4551969">byte</span><span class="op" id="4551973">,</span>&nbsp;<span class="builtintype" id="4551975">error</span><span class="op" id="4551980">)</span>&nbsp;<span class="op" id="4551982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4551985">r</span><span class="op" id="4551986">.</span><span class="ident" id="4551987">closeDot</span><span class="op" id="4551995">(</span><span class="op" id="4551996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4551999">var</span>&nbsp;<span class="ident" id="4552003">line</span>&nbsp;<span class="op" id="4552008">[</span><span class="op" id="4552009">]</span><span class="builtintype" id="4552010">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4552016">for</span>&nbsp;<span class="op" id="4552020">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4552024">l</span><span class="op" id="4552025">,</span>&nbsp;<span class="ident" id="4552027">more</span><span class="op" id="4552031">,</span>&nbsp;<span class="ident" id="4552033">err</span>&nbsp;<span class="op" id="4552037">:=</span>&nbsp;<span class="ident" id="4552040">r</span><span class="op" id="4552041">.</span><span class="ident" id="4552042">R</span><span class="op" id="4552043">.</span><span class="ident" id="4552044">ReadLine</span><span class="op" id="4552052">(</span><span class="op" id="4552053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4552057">if</span>&nbsp;<span class="ident" id="4552060">err</span>&nbsp;<span class="op" id="4552064">!=</span>&nbsp;<span class="ident" id="4552067">nil</span>&nbsp;<span class="op" id="4552071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4552076">return</span>&nbsp;<span class="ident" id="4552083">nil</span><span class="op" id="4552086">,</span>&nbsp;<span class="ident" id="4552088">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4552094">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4552098">//&nbsp;Avoid&nbsp;the&nbsp;copy&nbsp;if&nbsp;the&nbsp;first&nbsp;call&nbsp;produced&nbsp;a&nbsp;full&nbsp;line.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4552158">if</span>&nbsp;<span class="ident" id="4552161">line</span>&nbsp;<span class="op" id="4552166">==</span>&nbsp;<span class="ident" id="4552169">nil</span>&nbsp;<span class="op" id="4552173">&amp;&amp;</span>&nbsp;<span class="op" id="4552176">!</span><span class="ident" id="4552177">more</span>&nbsp;<span class="op" id="4552182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4552187">return</span>&nbsp;<span class="ident" id="4552194">l</span><span class="op" id="4552195">,</span>&nbsp;<span class="ident" id="4552197">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4552203">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4552207">line</span>&nbsp;<span class="op" id="4552212">=</span>&nbsp;<span class="builtinfunc" id="4552214">append</span><span class="op" id="4552220">(</span><span class="ident" id="4552221">line</span><span class="op" id="4552225">,</span>&nbsp;<span class="ident" id="4552227">l</span><span class="op" id="4552228">...</span><span class="op" id="4552231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4552235">if</span>&nbsp;<span class="op" id="4552238">!</span><span class="ident" id="4552239">more</span>&nbsp;<span class="op" id="4552244">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4552249">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4552257">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4552260">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4552263">return</span>&nbsp;<span class="ident" id="4552270">line</span><span class="op" id="4552274">,</span>&nbsp;<span class="ident" id="4552276">nil</span><br>
<span class="lineno"></span><span class="op" id="4552280">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="4552283">//&nbsp;ReadContinuedLine&nbsp;reads&nbsp;a&nbsp;possibly&nbsp;continued&nbsp;line&nbsp;from&nbsp;r,</span><br>
<span class="lineno"></span><span class="comment" id="4552344">//&nbsp;eliding&nbsp;the&nbsp;final&nbsp;trailing&nbsp;ASCII&nbsp;white&nbsp;space.</span><br>
<span class="lineno"></span><span class="comment" id="4552393">//&nbsp;Lines&nbsp;after&nbsp;the&nbsp;first&nbsp;are&nbsp;considered&nbsp;continuations&nbsp;if&nbsp;they</span><br>
<span class="lineno"></span><span class="comment" id="4552455">//&nbsp;begin&nbsp;with&nbsp;a&nbsp;space&nbsp;or&nbsp;tab&nbsp;character.&nbsp;&nbsp;In&nbsp;the&nbsp;returned&nbsp;data,</span><br>
<span class="lineno">75</span><span class="comment" id="4552518">//&nbsp;continuation&nbsp;lines&nbsp;are&nbsp;separated&nbsp;from&nbsp;the&nbsp;previous&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="4552577">//&nbsp;only&nbsp;by&nbsp;a&nbsp;single&nbsp;space:&nbsp;the&nbsp;newline&nbsp;and&nbsp;leading&nbsp;white&nbsp;space</span><br>
<span class="lineno"></span><span class="comment" id="4552640">//&nbsp;are&nbsp;removed.</span><br>
<span class="lineno"></span><span class="comment" id="4552656">//</span><br>
<span class="lineno"></span><span class="comment" id="4552659">//&nbsp;For&nbsp;example,&nbsp;consider&nbsp;this&nbsp;input:</span><br>
<span class="lineno">80</span><span class="comment" id="4552696">//</span><br>
<span class="lineno"></span><span class="comment" id="4552699">//&nbsp;&nbsp;&nbsp;&nbspLine&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="4552709">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;continued...</span><br>
<span class="lineno"></span><span class="comment" id="4552727">//&nbsp;&nbsp;&nbsp;&nbspLine&nbsp;2</span><br>
<span class="lineno"></span><span class="comment" id="4552737">//</span><br>
<span class="lineno">85</span><span class="comment" id="4552740">//&nbsp;The&nbsp;first&nbsp;call&nbsp;to&nbsp;ReadContinuedLine&nbsp;will&nbsp;return&nbsp;&#34;Line&nbsp;1&nbsp;continued...&#34;</span><br>
<span class="lineno"></span><span class="comment" id="4552813">//&nbsp;and&nbsp;the&nbsp;second&nbsp;will&nbsp;return&nbsp;&#34;Line&nbsp;2&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="4552853">//</span><br>
<span class="lineno"></span><span class="comment" id="4552856">//&nbsp;A&nbsp;line&nbsp;consisting&nbsp;of&nbsp;only&nbsp;white&nbsp;space&nbsp;is&nbsp;never&nbsp;continued.</span><br>
<span class="lineno"></span><span class="comment" id="4552917">//</span><br>
<span class="lineno">90</span><span class="keyword" id="4552920">func</span>&nbsp;<span class="op" id="4552925">(</span><span class="ident" id="4552926">r</span>&nbsp;<span class="op" id="4552928">*</span><span class="ident" id="4552929">Reader</span><span class="op" id="4552935">)</span>&nbsp;<span class="ident" id="4552937">ReadContinuedLine</span><span class="op" id="4552954">(</span><span class="op" id="4552955">)</span>&nbsp;<span class="op" id="4552957">(</span><span class="builtintype" id="4552958">string</span><span class="op" id="4552964">,</span>&nbsp;<span class="builtintype" id="4552966">error</span><span class="op" id="4552971">)</span>&nbsp;<span class="op" id="4552973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4552976">line</span><span class="op" id="4552980">,</span>&nbsp;<span class="ident" id="4552982">err</span>&nbsp;<span class="op" id="4552986">:=</span>&nbsp;<span class="ident" id="4552989">r</span><span class="op" id="4552990">.</span><span class="ident" id="4552991">readContinuedLineSlice</span><span class="op" id="4553013">(</span><span class="op" id="4553014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4553017">return</span>&nbsp;<span class="builtintype" id="4553024">string</span><span class="op" id="4553030">(</span><span class="ident" id="4553031">line</span><span class="op" id="4553035">)</span><span class="op" id="4553036">,</span>&nbsp;<span class="ident" id="4553038">err</span><br>
<span class="lineno"></span><span class="op" id="4553042">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="4553045">//&nbsp;trim&nbsp;returns&nbsp;s&nbsp;with&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;spaces&nbsp;and&nbsp;tabs&nbsp;removed.</span><br>
<span class="lineno"></span><span class="comment" id="4553114">//&nbsp;It&nbsp;does&nbsp;not&nbsp;assume&nbsp;Unicode&nbsp;or&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="keyword" id="4553154">func</span>&nbsp;<span class="ident" id="4553159">trim</span><span class="op" id="4553163">(</span><span class="ident" id="4553164">s</span>&nbsp;<span class="op" id="4553166">[</span><span class="op" id="4553167">]</span><span class="builtintype" id="4553168">byte</span><span class="op" id="4553172">)</span>&nbsp;<span class="op" id="4553174">[</span><span class="op" id="4553175">]</span><span class="builtintype" id="4553176">byte</span>&nbsp;<span class="op" id="4553181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4553184">i</span>&nbsp;<span class="op" id="4553186">:=</span>&nbsp;<span class="num" id="4553189">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4553192">for</span>&nbsp;<span class="ident" id="4553196">i</span>&nbsp;<span class="op" id="4553198">&lt;</span>&nbsp;<span class="builtinfunc" id="4553200">len</span><span class="op" id="4553203">(</span><span class="ident" id="4553204">s</span><span class="op" id="4553205">)</span>&nbsp;<span class="op" id="4553207">&amp;&amp;</span>&nbsp;<span class="op" id="4553210">(</span><span class="ident" id="4553211">s</span><span class="op" id="4553212">[</span><span class="ident" id="4553213">i</span><span class="op" id="4553214">]</span>&nbsp;<span class="op" id="4553216">==</span>&nbsp;<span class="string" id="4553219">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="4553223">||</span>&nbsp;<span class="ident" id="4553226">s</span><span class="op" id="4553227">[</span><span class="ident" id="4553228">i</span><span class="op" id="4553229">]</span>&nbsp;<span class="op" id="4553231">==</span>&nbsp;<span class="string" id="4553234">&#39;\t&#39;</span><span class="op" id="4553238">)</span>&nbsp;<span class="op" id="4553240">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4553244">i</span><span class="op" id="4553245">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4553249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4553252">n</span>&nbsp;<span class="op" id="4553254">:=</span>&nbsp;<span class="builtinfunc" id="4553257">len</span><span class="op" id="4553260">(</span><span class="ident" id="4553261">s</span><span class="op" id="4553262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4553265">for</span>&nbsp;<span class="ident" id="4553269">n</span>&nbsp;<span class="op" id="4553271">&gt;</span>&nbsp;<span class="ident" id="4553273">i</span>&nbsp;<span class="op" id="4553275">&amp;&amp;</span>&nbsp;<span class="op" id="4553278">(</span><span class="ident" id="4553279">s</span><span class="op" id="4553280">[</span><span class="ident" id="4553281">n</span><span class="op" id="4553282">-</span><span class="num" id="4553283">1</span><span class="op" id="4553284">]</span>&nbsp;<span class="op" id="4553286">==</span>&nbsp;<span class="string" id="4553289">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="4553293">||</span>&nbsp;<span class="ident" id="4553296">s</span><span class="op" id="4553297">[</span><span class="ident" id="4553298">n</span><span class="op" id="4553299">-</span><span class="num" id="4553300">1</span><span class="op" id="4553301">]</span>&nbsp;<span class="op" id="4553303">==</span>&nbsp;<span class="string" id="4553306">&#39;\t&#39;</span><span class="op" id="4553310">)</span>&nbsp;<span class="op" id="4553312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4553316">n</span><span class="op" id="4553317">--</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4553321">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4553324">return</span>&nbsp;<span class="ident" id="4553331">s</span><span class="op" id="4553332">[</span><span class="ident" id="4553333">i</span><span class="op" id="4553334">:</span><span class="ident" id="4553335">n</span><span class="op" id="4553336">]</span><br>
<span class="lineno"></span><span class="op" id="4553338">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4553341">//&nbsp;ReadContinuedLineBytes&nbsp;is&nbsp;like&nbsp;ReadContinuedLine&nbsp;but</span><br>
<span class="lineno">110</span><span class="comment" id="4553397">//&nbsp;returns&nbsp;a&nbsp;[]byte&nbsp;instead&nbsp;of&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="4553438">func</span>&nbsp;<span class="op" id="4553443">(</span><span class="ident" id="4553444">r</span>&nbsp;<span class="op" id="4553446">*</span><span class="ident" id="4553447">Reader</span><span class="op" id="4553453">)</span>&nbsp;<span class="ident" id="4553455">ReadContinuedLineBytes</span><span class="op" id="4553477">(</span><span class="op" id="4553478">)</span>&nbsp;<span class="op" id="4553480">(</span><span class="op" id="4553481">[</span><span class="op" id="4553482">]</span><span class="builtintype" id="4553483">byte</span><span class="op" id="4553487">,</span>&nbsp;<span class="builtintype" id="4553489">error</span><span class="op" id="4553494">)</span>&nbsp;<span class="op" id="4553496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4553499">line</span><span class="op" id="4553503">,</span>&nbsp;<span class="ident" id="4553505">err</span>&nbsp;<span class="op" id="4553509">:=</span>&nbsp;<span class="ident" id="4553512">r</span><span class="op" id="4553513">.</span><span class="ident" id="4553514">readContinuedLineSlice</span><span class="op" id="4553536">(</span><span class="op" id="4553537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4553540">if</span>&nbsp;<span class="ident" id="4553543">line</span>&nbsp;<span class="op" id="4553548">!=</span>&nbsp;<span class="ident" id="4553551">nil</span>&nbsp;<span class="op" id="4553555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4553559">buf</span>&nbsp;<span class="op" id="4553563">:=</span>&nbsp;<span class="builtinfunc" id="4553566">make</span><span class="op" id="4553570">(</span><span class="op" id="4553571">[</span><span class="op" id="4553572">]</span><span class="builtintype" id="4553573">byte</span><span class="op" id="4553577">,</span>&nbsp;<span class="builtinfunc" id="4553579">len</span><span class="op" id="4553582">(</span><span class="ident" id="4553583">line</span><span class="op" id="4553587">)</span><span class="op" id="4553588">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4553592">copy</span><span class="op" id="4553596">(</span><span class="ident" id="4553597">buf</span><span class="op" id="4553600">,</span>&nbsp;<span class="ident" id="4553602">line</span><span class="op" id="4553606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4553610">line</span>&nbsp;<span class="op" id="4553615">=</span>&nbsp;<span class="ident" id="4553617">buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4553622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4553625">return</span>&nbsp;<span class="ident" id="4553632">line</span><span class="op" id="4553636">,</span>&nbsp;<span class="ident" id="4553638">err</span><br>
<span class="lineno"></span><span class="op" id="4553642">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="keyword" id="4553645">func</span>&nbsp;<span class="op" id="4553650">(</span><span class="ident" id="4553651">r</span>&nbsp;<span class="op" id="4553653">*</span><span class="ident" id="4553654">Reader</span><span class="op" id="4553660">)</span>&nbsp;<span class="ident" id="4553662">readContinuedLineSlice</span><span class="op" id="4553684">(</span><span class="op" id="4553685">)</span>&nbsp;<span class="op" id="4553687">(</span><span class="op" id="4553688">[</span><span class="op" id="4553689">]</span><span class="builtintype" id="4553690">byte</span><span class="op" id="4553694">,</span>&nbsp;<span class="builtintype" id="4553696">error</span><span class="op" id="4553701">)</span>&nbsp;<span class="op" id="4553703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4553706">//&nbsp;Read&nbsp;the&nbsp;first&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4553731">line</span><span class="op" id="4553735">,</span>&nbsp;<span class="ident" id="4553737">err</span>&nbsp;<span class="op" id="4553741">:=</span>&nbsp;<span class="ident" id="4553744">r</span><span class="op" id="4553745">.</span><span class="ident" id="4553746">readLineSlice</span><span class="op" id="4553759">(</span><span class="op" id="4553760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4553763">if</span>&nbsp;<span class="ident" id="4553766">err</span>&nbsp;<span class="op" id="4553770">!=</span>&nbsp;<span class="ident" id="4553773">nil</span>&nbsp;<span class="op" id="4553777">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4553781">return</span>&nbsp;<span class="ident" id="4553788">nil</span><span class="op" id="4553791">,</span>&nbsp;<span class="ident" id="4553793">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4553798">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4553801">if</span>&nbsp;<span class="builtinfunc" id="4553804">len</span><span class="op" id="4553807">(</span><span class="ident" id="4553808">line</span><span class="op" id="4553812">)</span>&nbsp;<span class="op" id="4553814">==</span>&nbsp;<span class="num" id="4553817">0</span>&nbsp;<span class="op" id="4553819">{</span>&nbsp;<span class="comment" id="4553821">//&nbsp;blank&nbsp;line&nbsp;-&nbsp;no&nbsp;continuation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4553855">return</span>&nbsp;<span class="ident" id="4553862">line</span><span class="op" id="4553866">,</span>&nbsp;<span class="ident" id="4553868">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4553873">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4553877">//&nbsp;Optimistically&nbsp;assume&nbsp;that&nbsp;we&nbsp;have&nbsp;started&nbsp;to&nbsp;buffer&nbsp;the&nbsp;next&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4553948">//&nbsp;and&nbsp;it&nbsp;starts&nbsp;with&nbsp;an&nbsp;ASCII&nbsp;letter&nbsp;(the&nbsp;next&nbsp;header&nbsp;key),&nbsp;so&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4554020">//&nbsp;avoid&nbsp;copying&nbsp;that&nbsp;buffered&nbsp;data&nbsp;around&nbsp;in&nbsp;memory&nbsp;and&nbsp;skipping&nbsp;over</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4554092">//&nbsp;non-existent&nbsp;whitespace.</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4554121">if</span>&nbsp;<span class="ident" id="4554124">r</span><span class="op" id="4554125">.</span><span class="ident" id="4554126">R</span><span class="op" id="4554127">.</span><span class="ident" id="4554128">Buffered</span><span class="op" id="4554136">(</span><span class="op" id="4554137">)</span>&nbsp;<span class="op" id="4554139">&gt;</span>&nbsp;<span class="num" id="4554141">1</span>&nbsp;<span class="op" id="4554143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4554147">peek</span><span class="op" id="4554151">,</span>&nbsp;<span class="ident" id="4554153">err</span>&nbsp;<span class="op" id="4554157">:=</span>&nbsp;<span class="ident" id="4554160">r</span><span class="op" id="4554161">.</span><span class="ident" id="4554162">R</span><span class="op" id="4554163">.</span><span class="ident" id="4554164">Peek</span><span class="op" id="4554168">(</span><span class="num" id="4554169">1</span><span class="op" id="4554170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4554174">if</span>&nbsp;<span class="ident" id="4554177">err</span>&nbsp;<span class="op" id="4554181">==</span>&nbsp;<span class="ident" id="4554184">nil</span>&nbsp;<span class="op" id="4554188">&amp;&amp;</span>&nbsp;<span class="ident" id="4554191">isASCIILetter</span><span class="op" id="4554204">(</span><span class="ident" id="4554205">peek</span><span class="op" id="4554209">[</span><span class="num" id="4554210">0</span><span class="op" id="4554211">]</span><span class="op" id="4554212">)</span>&nbsp;<span class="op" id="4554214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4554219">return</span>&nbsp;<span class="ident" id="4554226">trim</span><span class="op" id="4554230">(</span><span class="ident" id="4554231">line</span><span class="op" id="4554235">)</span><span class="op" id="4554236">,</span>&nbsp;<span class="ident" id="4554238">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4554244">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4554247">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4554251">//&nbsp;ReadByte&nbsp;or&nbsp;the&nbsp;next&nbsp;readLineSlice&nbsp;will&nbsp;flush&nbsp;the&nbsp;read&nbsp;buffer;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4554318">//&nbsp;copy&nbsp;the&nbsp;slice&nbsp;into&nbsp;buf.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4554347">r</span><span class="op" id="4554348">.</span><span class="ident" id="4554349">buf</span>&nbsp;<span class="op" id="4554353">=</span>&nbsp;<span class="builtinfunc" id="4554355">append</span><span class="op" id="4554361">(</span><span class="ident" id="4554362">r</span><span class="op" id="4554363">.</span><span class="ident" id="4554364">buf</span><span class="op" id="4554367">[</span><span class="op" id="4554368">:</span><span class="num" id="4554369">0</span><span class="op" id="4554370">]</span><span class="op" id="4554371">,</span>&nbsp;<span class="ident" id="4554373">trim</span><span class="op" id="4554377">(</span><span class="ident" id="4554378">line</span><span class="op" id="4554382">)</span><span class="op" id="4554383">...</span><span class="op" id="4554386">)</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4554390">//&nbsp;Read&nbsp;continuation&nbsp;lines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4554419">for</span>&nbsp;<span class="ident" id="4554423">r</span><span class="op" id="4554424">.</span><span class="ident" id="4554425">skipSpace</span><span class="op" id="4554434">(</span><span class="op" id="4554435">)</span>&nbsp;<span class="op" id="4554437">&gt;</span>&nbsp;<span class="num" id="4554439">0</span>&nbsp;<span class="op" id="4554441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4554445">line</span><span class="op" id="4554449">,</span>&nbsp;<span class="ident" id="4554451">err</span>&nbsp;<span class="op" id="4554455">:=</span>&nbsp;<span class="ident" id="4554458">r</span><span class="op" id="4554459">.</span><span class="ident" id="4554460">readLineSlice</span><span class="op" id="4554473">(</span><span class="op" id="4554474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4554478">if</span>&nbsp;<span class="ident" id="4554481">err</span>&nbsp;<span class="op" id="4554485">!=</span>&nbsp;<span class="ident" id="4554488">nil</span>&nbsp;<span class="op" id="4554492">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4554497">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4554505">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4554509">r</span><span class="op" id="4554510">.</span><span class="ident" id="4554511">buf</span>&nbsp;<span class="op" id="4554515">=</span>&nbsp;<span class="builtinfunc" id="4554517">append</span><span class="op" id="4554523">(</span><span class="ident" id="4554524">r</span><span class="op" id="4554525">.</span><span class="ident" id="4554526">buf</span><span class="op" id="4554529">,</span>&nbsp;<span class="string" id="4554531">&#39;&nbsp;&#39;</span><span class="op" id="4554534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4554538">r</span><span class="op" id="4554539">.</span><span class="ident" id="4554540">buf</span>&nbsp;<span class="op" id="4554544">=</span>&nbsp;<span class="builtinfunc" id="4554546">append</span><span class="op" id="4554552">(</span><span class="ident" id="4554553">r</span><span class="op" id="4554554">.</span><span class="ident" id="4554555">buf</span><span class="op" id="4554558">,</span>&nbsp;<span class="ident" id="4554560">line</span><span class="op" id="4554564">...</span><span class="op" id="4554567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4554570">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4554573">return</span>&nbsp;<span class="ident" id="4554580">r</span><span class="op" id="4554581">.</span><span class="ident" id="4554582">buf</span><span class="op" id="4554585">,</span>&nbsp;<span class="ident" id="4554587">nil</span><br>
<span class="lineno"></span><span class="op" id="4554591">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4554594">//&nbsp;skipSpace&nbsp;skips&nbsp;R&nbsp;over&nbsp;all&nbsp;spaces&nbsp;and&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;skipped.</span><br>
<span class="lineno"></span><span class="keyword" id="4554672">func</span>&nbsp;<span class="op" id="4554677">(</span><span class="ident" id="4554678">r</span>&nbsp;<span class="op" id="4554680">*</span><span class="ident" id="4554681">Reader</span><span class="op" id="4554687">)</span>&nbsp;<span class="ident" id="4554689">skipSpace</span><span class="op" id="4554698">(</span><span class="op" id="4554699">)</span>&nbsp;<span class="builtintype" id="4554701">int</span>&nbsp;<span class="op" id="4554705">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4554708">n</span>&nbsp;<span class="op" id="4554710">:=</span>&nbsp;<span class="num" id="4554713">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4554716">for</span>&nbsp;<span class="op" id="4554720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4554724">c</span><span class="op" id="4554725">,</span>&nbsp;<span class="ident" id="4554727">err</span>&nbsp;<span class="op" id="4554731">:=</span>&nbsp;<span class="ident" id="4554734">r</span><span class="op" id="4554735">.</span><span class="ident" id="4554736">R</span><span class="op" id="4554737">.</span><span class="ident" id="4554738">ReadByte</span><span class="op" id="4554746">(</span><span class="op" id="4554747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4554751">if</span>&nbsp;<span class="ident" id="4554754">err</span>&nbsp;<span class="op" id="4554758">!=</span>&nbsp;<span class="ident" id="4554761">nil</span>&nbsp;<span class="op" id="4554765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4554770">//&nbsp;Bufio&nbsp;will&nbsp;keep&nbsp;err&nbsp;until&nbsp;next&nbsp;read.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4554813">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4554821">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4554825">if</span>&nbsp;<span class="ident" id="4554828">c</span>&nbsp;<span class="op" id="4554830">!=</span>&nbsp;<span class="string" id="4554833">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="4554837">&amp;&amp;</span>&nbsp;<span class="ident" id="4554840">c</span>&nbsp;<span class="op" id="4554842">!=</span>&nbsp;<span class="string" id="4554845">&#39;\t&#39;</span>&nbsp;<span class="op" id="4554850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4554855">r</span><span class="op" id="4554856">.</span><span class="ident" id="4554857">R</span><span class="op" id="4554858">.</span><span class="ident" id="4554859">UnreadByte</span><span class="op" id="4554869">(</span><span class="op" id="4554870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4554875">break</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4554883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4554887">n</span><span class="op" id="4554888">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4554892">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4554895">return</span>&nbsp;<span class="ident" id="4554902">n</span><br>
<span class="lineno"></span><span class="op" id="4554904">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="keyword" id="4554907">func</span>&nbsp;<span class="op" id="4554912">(</span><span class="ident" id="4554913">r</span>&nbsp;<span class="op" id="4554915">*</span><span class="ident" id="4554916">Reader</span><span class="op" id="4554922">)</span>&nbsp;<span class="ident" id="4554924">readCodeLine</span><span class="op" id="4554936">(</span><span class="ident" id="4554937">expectCode</span>&nbsp;<span class="builtintype" id="4554948">int</span><span class="op" id="4554951">)</span>&nbsp;<span class="op" id="4554953">(</span><span class="ident" id="4554954">code</span>&nbsp;<span class="builtintype" id="4554959">int</span><span class="op" id="4554962">,</span>&nbsp;<span class="ident" id="4554964">continued</span>&nbsp;<span class="builtintype" id="4554974">bool</span><span class="op" id="4554978">,</span>&nbsp;<span class="ident" id="4554980">message</span>&nbsp;<span class="builtintype" id="4554988">string</span><span class="op" id="4554994">,</span>&nbsp;<span class="ident" id="4554996">err</span>&nbsp;<span class="builtintype" id="4555000">error</span><span class="op" id="4555005">)</span>&nbsp;<span class="op" id="4555007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4555010">line</span><span class="op" id="4555014">,</span>&nbsp;<span class="ident" id="4555016">err</span>&nbsp;<span class="op" id="4555020">:=</span>&nbsp;<span class="ident" id="4555023">r</span><span class="op" id="4555024">.</span><span class="ident" id="4555025">ReadLine</span><span class="op" id="4555033">(</span><span class="op" id="4555034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4555037">if</span>&nbsp;<span class="ident" id="4555040">err</span>&nbsp;<span class="op" id="4555044">!=</span>&nbsp;<span class="ident" id="4555047">nil</span>&nbsp;<span class="op" id="4555051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4555055">return</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4555063">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4555066">return</span>&nbsp;<span class="ident" id="4555073">parseCodeLine</span><span class="op" id="4555086">(</span><span class="ident" id="4555087">line</span><span class="op" id="4555091">,</span>&nbsp;<span class="ident" id="4555093">expectCode</span><span class="op" id="4555103">)</span><br>
<span class="lineno"></span><span class="op" id="4555105">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4555108">func</span>&nbsp;<span class="ident" id="4555113">parseCodeLine</span><span class="op" id="4555126">(</span><span class="ident" id="4555127">line</span>&nbsp;<span class="builtintype" id="4555132">string</span><span class="op" id="4555138">,</span>&nbsp;<span class="ident" id="4555140">expectCode</span>&nbsp;<span class="builtintype" id="4555151">int</span><span class="op" id="4555154">)</span>&nbsp;<span class="op" id="4555156">(</span><span class="ident" id="4555157">code</span>&nbsp;<span class="builtintype" id="4555162">int</span><span class="op" id="4555165">,</span>&nbsp;<span class="ident" id="4555167">continued</span>&nbsp;<span class="builtintype" id="4555177">bool</span><span class="op" id="4555181">,</span>&nbsp;<span class="ident" id="4555183">message</span>&nbsp;<span class="builtintype" id="4555191">string</span><span class="op" id="4555197">,</span>&nbsp;<span class="ident" id="4555199">err</span>&nbsp;<span class="builtintype" id="4555203">error</span><span class="op" id="4555208">)</span>&nbsp;<span class="op" id="4555210">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4555213">if</span>&nbsp;<span class="builtinfunc" id="4555216">len</span><span class="op" id="4555219">(</span><span class="ident" id="4555220">line</span><span class="op" id="4555224">)</span>&nbsp;<span class="op" id="4555226">&lt;</span>&nbsp;<span class="num" id="4555228">4</span>&nbsp;<span class="op" id="4555230">||</span>&nbsp;<span class="ident" id="4555233">line</span><span class="op" id="4555237">[</span><span class="num" id="4555238">3</span><span class="op" id="4555239">]</span>&nbsp;<span class="op" id="4555241">!=</span>&nbsp;<span class="string" id="4555244">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="4555248">&amp;&amp;</span>&nbsp;<span class="ident" id="4555251">line</span><span class="op" id="4555255">[</span><span class="num" id="4555256">3</span><span class="op" id="4555257">]</span>&nbsp;<span class="op" id="4555259">!=</span>&nbsp;<span class="string" id="4555262">&#39;-&#39;</span>&nbsp;<span class="op" id="4555266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4555270">err</span>&nbsp;<span class="op" id="4555274">=</span>&nbsp;<span class="ident" id="4555276">ProtocolError</span><span class="op" id="4555289">(</span><span class="string" id="4555290">&#34;short&nbsp;response:&nbsp;&#34;</span>&nbsp;<span class="op" id="4555309">+</span>&nbsp;<span class="ident" id="4555311">line</span><span class="op" id="4555315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4555319">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4555327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4555330">continued</span>&nbsp;<span class="op" id="4555340">=</span>&nbsp;<span class="ident" id="4555342">line</span><span class="op" id="4555346">[</span><span class="num" id="4555347">3</span><span class="op" id="4555348">]</span>&nbsp;<span class="op" id="4555350">==</span>&nbsp;<span class="string" id="4555353">&#39;-&#39;</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4555358">code</span><span class="op" id="4555362">,</span>&nbsp;<span class="ident" id="4555364">err</span>&nbsp;<span class="op" id="4555368">=</span>&nbsp;<span class="ident" id="4555370">strconv</span><span class="op" id="4555377">.</span><span class="ident" id="4555378">Atoi</span><span class="op" id="4555382">(</span><span class="ident" id="4555383">line</span><span class="op" id="4555387">[</span><span class="num" id="4555388">0</span><span class="op" id="4555389">:</span><span class="num" id="4555390">3</span><span class="op" id="4555391">]</span><span class="op" id="4555392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4555395">if</span>&nbsp;<span class="ident" id="4555398">err</span>&nbsp;<span class="op" id="4555402">!=</span>&nbsp;<span class="ident" id="4555405">nil</span>&nbsp;<span class="op" id="4555409">||</span>&nbsp;<span class="ident" id="4555412">code</span>&nbsp;<span class="op" id="4555417">&lt;</span>&nbsp;<span class="num" id="4555419">100</span>&nbsp;<span class="op" id="4555423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4555427">err</span>&nbsp;<span class="op" id="4555431">=</span>&nbsp;<span class="ident" id="4555433">ProtocolError</span><span class="op" id="4555446">(</span><span class="string" id="4555447">&#34;invalid&nbsp;response&nbsp;code:&nbsp;&#34;</span>&nbsp;<span class="op" id="4555473">+</span>&nbsp;<span class="ident" id="4555475">line</span><span class="op" id="4555479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4555483">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4555491">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4555494">message</span>&nbsp;<span class="op" id="4555502">=</span>&nbsp;<span class="ident" id="4555504">line</span><span class="op" id="4555508">[</span><span class="num" id="4555509">4</span><span class="op" id="4555510">:</span><span class="op" id="4555511">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4555514">if</span>&nbsp;<span class="num" id="4555517">1</span>&nbsp;<span class="op" id="4555519">&lt;=</span>&nbsp;<span class="ident" id="4555522">expectCode</span>&nbsp;<span class="op" id="4555533">&amp;&amp;</span>&nbsp;<span class="ident" id="4555536">expectCode</span>&nbsp;<span class="op" id="4555547">&lt;</span>&nbsp;<span class="num" id="4555549">10</span>&nbsp;<span class="op" id="4555552">&amp;&amp;</span>&nbsp;<span class="ident" id="4555555">code</span><span class="op" id="4555559">/</span><span class="num" id="4555560">100</span>&nbsp;<span class="op" id="4555564">!=</span>&nbsp;<span class="ident" id="4555567">expectCode</span>&nbsp;<span class="op" id="4555578">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4555583">10</span>&nbsp;<span class="op" id="4555586">&lt;=</span>&nbsp;<span class="ident" id="4555589">expectCode</span>&nbsp;<span class="op" id="4555600">&amp;&amp;</span>&nbsp;<span class="ident" id="4555603">expectCode</span>&nbsp;<span class="op" id="4555614">&lt;</span>&nbsp;<span class="num" id="4555616">100</span>&nbsp;<span class="op" id="4555620">&amp;&amp;</span>&nbsp;<span class="ident" id="4555623">code</span><span class="op" id="4555627">/</span><span class="num" id="4555628">10</span>&nbsp;<span class="op" id="4555631">!=</span>&nbsp;<span class="ident" id="4555634">expectCode</span>&nbsp;<span class="op" id="4555645">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4555650">100</span>&nbsp;<span class="op" id="4555654">&lt;=</span>&nbsp;<span class="ident" id="4555657">expectCode</span>&nbsp;<span class="op" id="4555668">&amp;&amp;</span>&nbsp;<span class="ident" id="4555671">expectCode</span>&nbsp;<span class="op" id="4555682">&lt;</span>&nbsp;<span class="num" id="4555684">1000</span>&nbsp;<span class="op" id="4555689">&amp;&amp;</span>&nbsp;<span class="ident" id="4555692">code</span>&nbsp;<span class="op" id="4555697">!=</span>&nbsp;<span class="ident" id="4555700">expectCode</span>&nbsp;<span class="op" id="4555711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4555715">err</span>&nbsp;<span class="op" id="4555719">=</span>&nbsp;<span class="op" id="4555721">&amp;</span><span class="ident" id="4555722">Error</span><span class="op" id="4555727">{</span><span class="ident" id="4555728">code</span><span class="op" id="4555732">,</span>&nbsp;<span class="ident" id="4555734">message</span><span class="op" id="4555741">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4555744">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4555747">return</span><br>
<span class="lineno"></span><span class="op" id="4555754">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4555757">//&nbsp;ReadCodeLine&nbsp;reads&nbsp;a&nbsp;response&nbsp;code&nbsp;line&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno">205</span><span class="comment" id="4555812">//&nbsp;&nbsp;&nbsp;&nbspcode&nbsp;message</span><br>
<span class="lineno"></span><span class="comment" id="4555828">//&nbsp;where&nbsp;code&nbsp;is&nbsp;a&nbsp;three-digit&nbsp;status&nbsp;code&nbsp;and&nbsp;the&nbsp;message</span><br>
<span class="lineno"></span><span class="comment" id="4555887">//&nbsp;extends&nbsp;to&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;line.&nbsp;&nbsp;An&nbsp;example&nbsp;of&nbsp;such&nbsp;a&nbsp;line&nbsp;is:</span><br>
<span class="lineno"></span><span class="comment" id="4555954">//&nbsp;&nbsp;&nbsp;&nbsp220&nbsp;plan9.bell-labs.com&nbsp;ESMTP</span><br>
<span class="lineno"></span><span class="comment" id="4555987">//</span><br>
<span class="lineno">210</span><span class="comment" id="4555990">//&nbsp;If&nbsp;the&nbsp;prefix&nbsp;of&nbsp;the&nbsp;status&nbsp;does&nbsp;not&nbsp;match&nbsp;the&nbsp;digits&nbsp;in&nbsp;expectCode,</span><br>
<span class="lineno"></span><span class="comment" id="4556062">//&nbsp;ReadCodeLine&nbsp;returns&nbsp;with&nbsp;err&nbsp;set&nbsp;to&nbsp;&amp;Error{code,&nbsp;message}.</span><br>
<span class="lineno"></span><span class="comment" id="4556125">//&nbsp;For&nbsp;example,&nbsp;if&nbsp;expectCode&nbsp;is&nbsp;31,&nbsp;an&nbsp;error&nbsp;will&nbsp;be&nbsp;returned&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="4556191">//&nbsp;the&nbsp;status&nbsp;is&nbsp;not&nbsp;in&nbsp;the&nbsp;range&nbsp;[310,319].</span><br>
<span class="lineno"></span><span class="comment" id="4556236">//</span><br>
<span class="lineno">215</span><span class="comment" id="4556239">//&nbsp;If&nbsp;the&nbsp;response&nbsp;is&nbsp;multi-line,&nbsp;ReadCodeLine&nbsp;returns&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="4556304">//</span><br>
<span class="lineno"></span><span class="comment" id="4556307">//&nbsp;An&nbsp;expectCode&nbsp;&lt;=&nbsp;0&nbsp;disables&nbsp;the&nbsp;check&nbsp;of&nbsp;the&nbsp;status&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="4556368">//</span><br>
<span class="lineno"></span><span class="keyword" id="4556371">func</span>&nbsp;<span class="op" id="4556376">(</span><span class="ident" id="4556377">r</span>&nbsp;<span class="op" id="4556379">*</span><span class="ident" id="4556380">Reader</span><span class="op" id="4556386">)</span>&nbsp;<span class="ident" id="4556388">ReadCodeLine</span><span class="op" id="4556400">(</span><span class="ident" id="4556401">expectCode</span>&nbsp;<span class="builtintype" id="4556412">int</span><span class="op" id="4556415">)</span>&nbsp;<span class="op" id="4556417">(</span><span class="ident" id="4556418">code</span>&nbsp;<span class="builtintype" id="4556423">int</span><span class="op" id="4556426">,</span>&nbsp;<span class="ident" id="4556428">message</span>&nbsp;<span class="builtintype" id="4556436">string</span><span class="op" id="4556442">,</span>&nbsp;<span class="ident" id="4556444">err</span>&nbsp;<span class="builtintype" id="4556448">error</span><span class="op" id="4556453">)</span>&nbsp;<span class="op" id="4556455">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4556458">code</span><span class="op" id="4556462">,</span>&nbsp;<span class="ident" id="4556464">continued</span><span class="op" id="4556473">,</span>&nbsp;<span class="ident" id="4556475">message</span><span class="op" id="4556482">,</span>&nbsp;<span class="ident" id="4556484">err</span>&nbsp;<span class="op" id="4556488">:=</span>&nbsp;<span class="ident" id="4556491">r</span><span class="op" id="4556492">.</span><span class="ident" id="4556493">readCodeLine</span><span class="op" id="4556505">(</span><span class="ident" id="4556506">expectCode</span><span class="op" id="4556516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4556519">if</span>&nbsp;<span class="ident" id="4556522">err</span>&nbsp;<span class="op" id="4556526">==</span>&nbsp;<span class="ident" id="4556529">nil</span>&nbsp;<span class="op" id="4556533">&amp;&amp;</span>&nbsp;<span class="ident" id="4556536">continued</span>&nbsp;<span class="op" id="4556546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4556550">err</span>&nbsp;<span class="op" id="4556554">=</span>&nbsp;<span class="ident" id="4556556">ProtocolError</span><span class="op" id="4556569">(</span><span class="string" id="4556570">&#34;unexpected&nbsp;multi-line&nbsp;response:&nbsp;&#34;</span>&nbsp;<span class="op" id="4556605">+</span>&nbsp;<span class="ident" id="4556607">message</span><span class="op" id="4556614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4556617">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4556620">return</span><br>
<span class="lineno">225</span><span class="op" id="4556627">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4556630">//&nbsp;ReadResponse&nbsp;reads&nbsp;a&nbsp;multi-line&nbsp;response&nbsp;of&nbsp;the&nbsp;form:</span><br>
<span class="lineno"></span><span class="comment" id="4556687">//</span><br>
<span class="lineno"></span><span class="comment" id="4556690">//&nbsp;&nbsp;&nbsp;&nbspcode-message&nbsp;line&nbsp;1</span><br>
<span class="lineno">230</span><span class="comment" id="4556713">//&nbsp;&nbsp;&nbsp;&nbspcode-message&nbsp;line&nbsp;2</span><br>
<span class="lineno"></span><span class="comment" id="4556736">//&nbsp;&nbsp;&nbsp;&nbsp...</span><br>
<span class="lineno"></span><span class="comment" id="4556743">//&nbsp;&nbsp;&nbsp;&nbspcode&nbsp;message&nbsp;line&nbsp;n</span><br>
<span class="lineno"></span><span class="comment" id="4556766">//</span><br>
<span class="lineno"></span><span class="comment" id="4556769">//&nbsp;where&nbsp;code&nbsp;is&nbsp;a&nbsp;three-digit&nbsp;status&nbsp;code.&nbsp;The&nbsp;first&nbsp;line&nbsp;starts&nbsp;with&nbsp;the</span><br>
<span class="lineno">235</span><span class="comment" id="4556844">//&nbsp;code&nbsp;and&nbsp;a&nbsp;hyphen.&nbsp;The&nbsp;response&nbsp;is&nbsp;terminated&nbsp;by&nbsp;a&nbsp;line&nbsp;that&nbsp;starts</span><br>
<span class="lineno"></span><span class="comment" id="4556915">//&nbsp;with&nbsp;the&nbsp;same&nbsp;code&nbsp;followed&nbsp;by&nbsp;a&nbsp;space.&nbsp;Each&nbsp;line&nbsp;in&nbsp;message&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="4556982">//&nbsp;separated&nbsp;by&nbsp;a&nbsp;newline&nbsp;(\n).</span><br>
<span class="lineno"></span><span class="comment" id="4557014">//</span><br>
<span class="lineno"></span><span class="comment" id="4557017">//&nbsp;See&nbsp;page&nbsp;36&nbsp;of&nbsp;RFC&nbsp;959&nbsp;(http://www.ietf.org/rfc/rfc959.txt)&nbsp;for</span><br>
<span class="lineno">240</span><span class="comment" id="4557084">//&nbsp;details.</span><br>
<span class="lineno"></span><span class="comment" id="4557096">//</span><br>
<span class="lineno"></span><span class="comment" id="4557099">//&nbsp;If&nbsp;the&nbsp;prefix&nbsp;of&nbsp;the&nbsp;status&nbsp;does&nbsp;not&nbsp;match&nbsp;the&nbsp;digits&nbsp;in&nbsp;expectCode,</span><br>
<span class="lineno"></span><span class="comment" id="4557171">//&nbsp;ReadResponse&nbsp;returns&nbsp;with&nbsp;err&nbsp;set&nbsp;to&nbsp;&amp;Error{code,&nbsp;message}.</span><br>
<span class="lineno"></span><span class="comment" id="4557234">//&nbsp;For&nbsp;example,&nbsp;if&nbsp;expectCode&nbsp;is&nbsp;31,&nbsp;an&nbsp;error&nbsp;will&nbsp;be&nbsp;returned&nbsp;if</span><br>
<span class="lineno">245</span><span class="comment" id="4557300">//&nbsp;the&nbsp;status&nbsp;is&nbsp;not&nbsp;in&nbsp;the&nbsp;range&nbsp;[310,319].</span><br>
<span class="lineno"></span><span class="comment" id="4557345">//</span><br>
<span class="lineno"></span><span class="comment" id="4557348">//&nbsp;An&nbsp;expectCode&nbsp;&lt;=&nbsp;0&nbsp;disables&nbsp;the&nbsp;check&nbsp;of&nbsp;the&nbsp;status&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="4557409">//</span><br>
<span class="lineno"></span><span class="keyword" id="4557412">func</span>&nbsp;<span class="op" id="4557417">(</span><span class="ident" id="4557418">r</span>&nbsp;<span class="op" id="4557420">*</span><span class="ident" id="4557421">Reader</span><span class="op" id="4557427">)</span>&nbsp;<span class="ident" id="4557429">ReadResponse</span><span class="op" id="4557441">(</span><span class="ident" id="4557442">expectCode</span>&nbsp;<span class="builtintype" id="4557453">int</span><span class="op" id="4557456">)</span>&nbsp;<span class="op" id="4557458">(</span><span class="ident" id="4557459">code</span>&nbsp;<span class="builtintype" id="4557464">int</span><span class="op" id="4557467">,</span>&nbsp;<span class="ident" id="4557469">message</span>&nbsp;<span class="builtintype" id="4557477">string</span><span class="op" id="4557483">,</span>&nbsp;<span class="ident" id="4557485">err</span>&nbsp;<span class="builtintype" id="4557489">error</span><span class="op" id="4557494">)</span>&nbsp;<span class="op" id="4557496">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4557499">code</span><span class="op" id="4557503">,</span>&nbsp;<span class="ident" id="4557505">continued</span><span class="op" id="4557514">,</span>&nbsp;<span class="ident" id="4557516">message</span><span class="op" id="4557523">,</span>&nbsp;<span class="ident" id="4557525">err</span>&nbsp;<span class="op" id="4557529">:=</span>&nbsp;<span class="ident" id="4557532">r</span><span class="op" id="4557533">.</span><span class="ident" id="4557534">readCodeLine</span><span class="op" id="4557546">(</span><span class="ident" id="4557547">expectCode</span><span class="op" id="4557557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4557560">for</span>&nbsp;<span class="ident" id="4557564">err</span>&nbsp;<span class="op" id="4557568">==</span>&nbsp;<span class="ident" id="4557571">nil</span>&nbsp;<span class="op" id="4557575">&amp;&amp;</span>&nbsp;<span class="ident" id="4557578">continued</span>&nbsp;<span class="op" id="4557588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4557592">line</span><span class="op" id="4557596">,</span>&nbsp;<span class="ident" id="4557598">err</span>&nbsp;<span class="op" id="4557602">:=</span>&nbsp;<span class="ident" id="4557605">r</span><span class="op" id="4557606">.</span><span class="ident" id="4557607">ReadLine</span><span class="op" id="4557615">(</span><span class="op" id="4557616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4557620">if</span>&nbsp;<span class="ident" id="4557623">err</span>&nbsp;<span class="op" id="4557627">!=</span>&nbsp;<span class="ident" id="4557630">nil</span>&nbsp;<span class="op" id="4557634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4557639">return</span>&nbsp;<span class="num" id="4557646">0</span><span class="op" id="4557647">,</span>&nbsp;<span class="string" id="4557649">&#34;&#34;</span><span class="op" id="4557651">,</span>&nbsp;<span class="ident" id="4557653">err</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4557659">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4557664">var</span>&nbsp;<span class="ident" id="4557668">code2</span>&nbsp;<span class="builtintype" id="4557674">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4557680">var</span>&nbsp;<span class="ident" id="4557684">moreMessage</span>&nbsp;<span class="builtintype" id="4557696">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4557705">code2</span><span class="op" id="4557710">,</span>&nbsp;<span class="ident" id="4557712">continued</span><span class="op" id="4557721">,</span>&nbsp;<span class="ident" id="4557723">moreMessage</span><span class="op" id="4557734">,</span>&nbsp;<span class="ident" id="4557736">err</span>&nbsp;<span class="op" id="4557740">=</span>&nbsp;<span class="ident" id="4557742">parseCodeLine</span><span class="op" id="4557755">(</span><span class="ident" id="4557756">line</span><span class="op" id="4557760">,</span>&nbsp;<span class="ident" id="4557762">expectCode</span><span class="op" id="4557772">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4557776">if</span>&nbsp;<span class="ident" id="4557779">err</span>&nbsp;<span class="op" id="4557783">!=</span>&nbsp;<span class="ident" id="4557786">nil</span>&nbsp;<span class="op" id="4557790">||</span>&nbsp;<span class="ident" id="4557793">code2</span>&nbsp;<span class="op" id="4557799">!=</span>&nbsp;<span class="ident" id="4557802">code</span>&nbsp;<span class="op" id="4557807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4557812">message</span>&nbsp;<span class="op" id="4557820">+=</span>&nbsp;<span class="string" id="4557823">&#34;\n&#34;</span>&nbsp;<span class="op" id="4557828">+</span>&nbsp;<span class="ident" id="4557830">strings</span><span class="op" id="4557837">.</span><span class="ident" id="4557838">TrimRight</span><span class="op" id="4557847">(</span><span class="ident" id="4557848">line</span><span class="op" id="4557852">,</span>&nbsp;<span class="string" id="4557854">&#34;\r\n&#34;</span><span class="op" id="4557860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4557865">continued</span>&nbsp;<span class="op" id="4557875">=</span>&nbsp;<span class="builtintype" id="4557877">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4557885">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4557896">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4557900">message</span>&nbsp;<span class="op" id="4557908">+=</span>&nbsp;<span class="string" id="4557911">&#34;\n&#34;</span>&nbsp;<span class="op" id="4557916">+</span>&nbsp;<span class="ident" id="4557918">moreMessage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4557931">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4557934">return</span><br>
<span class="lineno"></span><span class="op" id="4557941">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="4557944">//&nbsp;DotReader&nbsp;returns&nbsp;a&nbsp;new&nbsp;Reader&nbsp;that&nbsp;satisfies&nbsp;Reads&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4558009">//&nbsp;decoded&nbsp;text&nbsp;of&nbsp;a&nbsp;dot-encoded&nbsp;block&nbsp;read&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="4558061">//&nbsp;The&nbsp;returned&nbsp;Reader&nbsp;is&nbsp;only&nbsp;valid&nbsp;until&nbsp;the&nbsp;next&nbsp;call</span><br>
<span class="lineno"></span><span class="comment" id="4558118">//&nbsp;to&nbsp;a&nbsp;method&nbsp;on&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="4558139">//</span><br>
<span class="lineno">275</span><span class="comment" id="4558142">//&nbsp;Dot&nbsp;encoding&nbsp;is&nbsp;a&nbsp;common&nbsp;framing&nbsp;used&nbsp;for&nbsp;data&nbsp;blocks</span><br>
<span class="lineno"></span><span class="comment" id="4558199">//&nbsp;in&nbsp;text&nbsp;protocols&nbsp;such&nbsp;as&nbsp;SMTP.&nbsp;&nbsp;The&nbsp;data&nbsp;consists&nbsp;of&nbsp;a&nbsp;sequence</span><br>
<span class="lineno"></span><span class="comment" id="4558267">//&nbsp;of&nbsp;lines,&nbsp;each&nbsp;of&nbsp;which&nbsp;ends&nbsp;in&nbsp;&#34;\r\n&#34;.&nbsp;&nbsp;The&nbsp;sequence&nbsp;itself</span><br>
<span class="lineno"></span><span class="comment" id="4558331">//&nbsp;ends&nbsp;at&nbsp;a&nbsp;line&nbsp;containing&nbsp;just&nbsp;a&nbsp;dot:&nbsp;&#34;.\r\n&#34;.&nbsp;&nbsp;Lines&nbsp;beginning</span><br>
<span class="lineno"></span><span class="comment" id="4558398">//&nbsp;with&nbsp;a&nbsp;dot&nbsp;are&nbsp;escaped&nbsp;with&nbsp;an&nbsp;additional&nbsp;dot&nbsp;to&nbsp;avoid</span><br>
<span class="lineno">280</span><span class="comment" id="4558456">//&nbsp;looking&nbsp;like&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="comment" id="4558497">//</span><br>
<span class="lineno"></span><span class="comment" id="4558500">//&nbsp;The&nbsp;decoded&nbsp;form&nbsp;returned&nbsp;by&nbsp;the&nbsp;Reader&#39;s&nbsp;Read&nbsp;method</span><br>
<span class="lineno"></span><span class="comment" id="4558557">//&nbsp;rewrites&nbsp;the&nbsp;&#34;\r\n&#34;&nbsp;line&nbsp;endings&nbsp;into&nbsp;the&nbsp;simpler&nbsp;&#34;\n&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="4558616">//&nbsp;removes&nbsp;leading&nbsp;dot&nbsp;escapes&nbsp;if&nbsp;present,&nbsp;and&nbsp;stops&nbsp;with&nbsp;error&nbsp;io.EOF</span><br>
<span class="lineno">285</span><span class="comment" id="4558687">//&nbsp;after&nbsp;consuming&nbsp;(and&nbsp;discarding)&nbsp;the&nbsp;end-of-sequence&nbsp;line.</span><br>
<span class="lineno"></span><span class="keyword" id="4558749">func</span>&nbsp;<span class="op" id="4558754">(</span><span class="ident" id="4558755">r</span>&nbsp;<span class="op" id="4558757">*</span><span class="ident" id="4558758">Reader</span><span class="op" id="4558764">)</span>&nbsp;<span class="ident" id="4558766">DotReader</span><span class="op" id="4558775">(</span><span class="op" id="4558776">)</span>&nbsp;<span class="ident" id="4558778">io</span><span class="op" id="4558780">.</span><span class="ident" id="4558781">Reader</span>&nbsp;<span class="op" id="4558788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4558791">r</span><span class="op" id="4558792">.</span><span class="ident" id="4558793">closeDot</span><span class="op" id="4558801">(</span><span class="op" id="4558802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4558805">r</span><span class="op" id="4558806">.</span><span class="ident" id="4558807">dot</span>&nbsp;<span class="op" id="4558811">=</span>&nbsp;<span class="op" id="4558813">&amp;</span><span class="ident" id="4558814">dotReader</span><span class="op" id="4558823">{</span><span class="ident" id="4558824">r</span><span class="op" id="4558825">:</span>&nbsp;<span class="ident" id="4558827">r</span><span class="op" id="4558828">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4558831">return</span>&nbsp;<span class="ident" id="4558838">r</span><span class="op" id="4558839">.</span><span class="ident" id="4558840">dot</span><br>
<span class="lineno">290</span><span class="op" id="4558844">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4558847">type</span>&nbsp;<span class="ident" id="4558852">dotReader</span>&nbsp;<span class="keyword" id="4558862">struct</span>&nbsp;<span class="op" id="4558869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4558872">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4558878">*</span><span class="ident" id="4558879">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4558887">state</span>&nbsp;<span class="builtintype" id="4558893">int</span><br>
<span class="lineno">295</span><span class="op" id="4558897">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4558900">//&nbsp;Read&nbsp;satisfies&nbsp;reads&nbsp;by&nbsp;decoding&nbsp;dot-encoded&nbsp;data&nbsp;read&nbsp;from&nbsp;d.r.</span><br>
<span class="lineno"></span><span class="keyword" id="4558968">func</span>&nbsp;<span class="op" id="4558973">(</span><span class="ident" id="4558974">d</span>&nbsp;<span class="op" id="4558976">*</span><span class="ident" id="4558977">dotReader</span><span class="op" id="4558986">)</span>&nbsp;<span class="ident" id="4558988">Read</span><span class="op" id="4558992">(</span><span class="ident" id="4558993">b</span>&nbsp;<span class="op" id="4558995">[</span><span class="op" id="4558996">]</span><span class="builtintype" id="4558997">byte</span><span class="op" id="4559001">)</span>&nbsp;<span class="op" id="4559003">(</span><span class="ident" id="4559004">n</span>&nbsp;<span class="builtintype" id="4559006">int</span><span class="op" id="4559009">,</span>&nbsp;<span class="ident" id="4559011">err</span>&nbsp;<span class="builtintype" id="4559015">error</span><span class="op" id="4559020">)</span>&nbsp;<span class="op" id="4559022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4559025">//&nbsp;Run&nbsp;data&nbsp;through&nbsp;a&nbsp;simple&nbsp;state&nbsp;machine&nbsp;to</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4559072">//&nbsp;elide&nbsp;leading&nbsp;dots,&nbsp;rewrite&nbsp;trailing&nbsp;\r\n&nbsp;into&nbsp;\n,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4559127">//&nbsp;and&nbsp;detect&nbsp;ending&nbsp;.\r\n&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4559161">const</span>&nbsp;<span class="op" id="4559167">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4559171">stateBeginLine</span>&nbsp;<span class="op" id="4559186">=</span>&nbsp;<span class="ident" id="4559188">iota</span>&nbsp;<span class="comment" id="4559193">//&nbsp;beginning&nbsp;of&nbsp;line;&nbsp;initial&nbsp;state;&nbsp;must&nbsp;be&nbsp;zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4559245">stateDot</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4559267">//&nbsp;read&nbsp;.&nbsp;at&nbsp;beginning&nbsp;of&nbsp;line</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4559300">stateDotCR</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4559322">//&nbsp;read&nbsp;.\r&nbsp;at&nbsp;beginning&nbsp;of&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4559357">stateCR</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4559379">//&nbsp;read&nbsp;\r&nbsp;(possibly&nbsp;at&nbsp;end&nbsp;of&nbsp;line)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4559418">stateData</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4559440">//&nbsp;reading&nbsp;data&nbsp;in&nbsp;middle&nbsp;of&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4559476">stateEOF</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4559498">//&nbsp;reached&nbsp;.\r\n&nbsp;end&nbsp;marker&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4559532">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4559535">br</span>&nbsp;<span class="op" id="4559538">:=</span>&nbsp;<span class="ident" id="4559541">d</span><span class="op" id="4559542">.</span><span class="ident" id="4559543">r</span><span class="op" id="4559544">.</span><span class="ident" id="4559545">R</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4559548">for</span>&nbsp;<span class="ident" id="4559552">n</span>&nbsp;<span class="op" id="4559554">&lt;</span>&nbsp;<span class="builtinfunc" id="4559556">len</span><span class="op" id="4559559">(</span><span class="ident" id="4559560">b</span><span class="op" id="4559561">)</span>&nbsp;<span class="op" id="4559563">&amp;&amp;</span>&nbsp;<span class="ident" id="4559566">d</span><span class="op" id="4559567">.</span><span class="ident" id="4559568">state</span>&nbsp;<span class="op" id="4559574">!=</span>&nbsp;<span class="ident" id="4559577">stateEOF</span>&nbsp;<span class="op" id="4559586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4559590">var</span>&nbsp;<span class="ident" id="4559594">c</span>&nbsp;<span class="builtintype" id="4559596">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4559603">c</span><span class="op" id="4559604">,</span>&nbsp;<span class="ident" id="4559606">err</span>&nbsp;<span class="op" id="4559610">=</span>&nbsp;<span class="ident" id="4559612">br</span><span class="op" id="4559614">.</span><span class="ident" id="4559615">ReadByte</span><span class="op" id="4559623">(</span><span class="op" id="4559624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4559628">if</span>&nbsp;<span class="ident" id="4559631">err</span>&nbsp;<span class="op" id="4559635">!=</span>&nbsp;<span class="ident" id="4559638">nil</span>&nbsp;<span class="op" id="4559642">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4559647">if</span>&nbsp;<span class="ident" id="4559650">err</span>&nbsp;<span class="op" id="4559654">==</span>&nbsp;<span class="ident" id="4559657">io</span><span class="op" id="4559659">.</span><span class="ident" id="4559660">EOF</span>&nbsp;<span class="op" id="4559664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4559670">err</span>&nbsp;<span class="op" id="4559674">=</span>&nbsp;<span class="ident" id="4559676">io</span><span class="op" id="4559678">.</span><span class="ident" id="4559679">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4559699">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4559704">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4559712">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4559716">switch</span>&nbsp;<span class="ident" id="4559723">d</span><span class="op" id="4559724">.</span><span class="ident" id="4559725">state</span>&nbsp;<span class="op" id="4559731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4559735">case</span>&nbsp;<span class="ident" id="4559740">stateBeginLine</span><span class="op" id="4559754">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4559759">if</span>&nbsp;<span class="ident" id="4559762">c</span>&nbsp;<span class="op" id="4559764">==</span>&nbsp;<span class="string" id="4559767">&#39;.&#39;</span>&nbsp;<span class="op" id="4559771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4559777">d</span><span class="op" id="4559778">.</span><span class="ident" id="4559779">state</span>&nbsp;<span class="op" id="4559785">=</span>&nbsp;<span class="ident" id="4559787">stateDot</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4559800">continue</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4559812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4559817">if</span>&nbsp;<span class="ident" id="4559820">c</span>&nbsp;<span class="op" id="4559822">==</span>&nbsp;<span class="string" id="4559825">&#39;\r&#39;</span>&nbsp;<span class="op" id="4559830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4559836">d</span><span class="op" id="4559837">.</span><span class="ident" id="4559838">state</span>&nbsp;<span class="op" id="4559844">=</span>&nbsp;<span class="ident" id="4559846">stateCR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4559858">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4559870">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4559875">d</span><span class="op" id="4559876">.</span><span class="ident" id="4559877">state</span>&nbsp;<span class="op" id="4559883">=</span>&nbsp;<span class="ident" id="4559885">stateData</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4559898">case</span>&nbsp;<span class="ident" id="4559903">stateDot</span><span class="op" id="4559911">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4559916">if</span>&nbsp;<span class="ident" id="4559919">c</span>&nbsp;<span class="op" id="4559921">==</span>&nbsp;<span class="string" id="4559924">&#39;\r&#39;</span>&nbsp;<span class="op" id="4559929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4559935">d</span><span class="op" id="4559936">.</span><span class="ident" id="4559937">state</span>&nbsp;<span class="op" id="4559943">=</span>&nbsp;<span class="ident" id="4559945">stateDotCR</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4559960">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4559972">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4559977">if</span>&nbsp;<span class="ident" id="4559980">c</span>&nbsp;<span class="op" id="4559982">==</span>&nbsp;<span class="string" id="4559985">&#39;\n&#39;</span>&nbsp;<span class="op" id="4559990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4559996">d</span><span class="op" id="4559997">.</span><span class="ident" id="4559998">state</span>&nbsp;<span class="op" id="4560004">=</span>&nbsp;<span class="ident" id="4560006">stateEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4560019">continue</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4560031">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4560036">d</span><span class="op" id="4560037">.</span><span class="ident" id="4560038">state</span>&nbsp;<span class="op" id="4560044">=</span>&nbsp;<span class="ident" id="4560046">stateData</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4560059">case</span>&nbsp;<span class="ident" id="4560064">stateDotCR</span><span class="op" id="4560074">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4560079">if</span>&nbsp;<span class="ident" id="4560082">c</span>&nbsp;<span class="op" id="4560084">==</span>&nbsp;<span class="string" id="4560087">&#39;\n&#39;</span>&nbsp;<span class="op" id="4560092">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4560098">d</span><span class="op" id="4560099">.</span><span class="ident" id="4560100">state</span>&nbsp;<span class="op" id="4560106">=</span>&nbsp;<span class="ident" id="4560108">stateEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4560121">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4560133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4560138">//&nbsp;Not&nbsp;part&nbsp;of&nbsp;.\r\n.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4560163">//&nbsp;Consume&nbsp;leading&nbsp;dot&nbsp;and&nbsp;emit&nbsp;saved&nbsp;\r.</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4560208">br</span><span class="op" id="4560210">.</span><span class="ident" id="4560211">UnreadByte</span><span class="op" id="4560221">(</span><span class="op" id="4560222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4560227">c</span>&nbsp;<span class="op" id="4560229">=</span>&nbsp;<span class="string" id="4560231">&#39;\r&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4560239">d</span><span class="op" id="4560240">.</span><span class="ident" id="4560241">state</span>&nbsp;<span class="op" id="4560247">=</span>&nbsp;<span class="ident" id="4560249">stateData</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4560262">case</span>&nbsp;<span class="ident" id="4560267">stateCR</span><span class="op" id="4560274">:</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4560279">if</span>&nbsp;<span class="ident" id="4560282">c</span>&nbsp;<span class="op" id="4560284">==</span>&nbsp;<span class="string" id="4560287">&#39;\n&#39;</span>&nbsp;<span class="op" id="4560292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4560298">d</span><span class="op" id="4560299">.</span><span class="ident" id="4560300">state</span>&nbsp;<span class="op" id="4560306">=</span>&nbsp;<span class="ident" id="4560308">stateBeginLine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4560327">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4560336">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4560341">//&nbsp;Not&nbsp;part&nbsp;of&nbsp;\r\n.&nbsp;&nbsp;Emit&nbsp;saved&nbsp;\r</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4560380">br</span><span class="op" id="4560382">.</span><span class="ident" id="4560383">UnreadByte</span><span class="op" id="4560393">(</span><span class="op" id="4560394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4560399">c</span>&nbsp;<span class="op" id="4560401">=</span>&nbsp;<span class="string" id="4560403">&#39;\r&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4560411">d</span><span class="op" id="4560412">.</span><span class="ident" id="4560413">state</span>&nbsp;<span class="op" id="4560419">=</span>&nbsp;<span class="ident" id="4560421">stateData</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4560434">case</span>&nbsp;<span class="ident" id="4560439">stateData</span><span class="op" id="4560448">:</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4560453">if</span>&nbsp;<span class="ident" id="4560456">c</span>&nbsp;<span class="op" id="4560458">==</span>&nbsp;<span class="string" id="4560461">&#39;\r&#39;</span>&nbsp;<span class="op" id="4560466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4560472">d</span><span class="op" id="4560473">.</span><span class="ident" id="4560474">state</span>&nbsp;<span class="op" id="4560480">=</span>&nbsp;<span class="ident" id="4560482">stateCR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4560494">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4560506">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4560511">if</span>&nbsp;<span class="ident" id="4560514">c</span>&nbsp;<span class="op" id="4560516">==</span>&nbsp;<span class="string" id="4560519">&#39;\n&#39;</span>&nbsp;<span class="op" id="4560524">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4560530">d</span><span class="op" id="4560531">.</span><span class="ident" id="4560532">state</span>&nbsp;<span class="op" id="4560538">=</span>&nbsp;<span class="ident" id="4560540">stateBeginLine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4560558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4560562">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4560566">b</span><span class="op" id="4560567">[</span><span class="ident" id="4560568">n</span><span class="op" id="4560569">]</span>&nbsp;<span class="op" id="4560571">=</span>&nbsp;<span class="ident" id="4560573">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4560577">n</span><span class="op" id="4560578">++</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4560582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4560585">if</span>&nbsp;<span class="ident" id="4560588">err</span>&nbsp;<span class="op" id="4560592">==</span>&nbsp;<span class="ident" id="4560595">nil</span>&nbsp;<span class="op" id="4560599">&amp;&amp;</span>&nbsp;<span class="ident" id="4560602">d</span><span class="op" id="4560603">.</span><span class="ident" id="4560604">state</span>&nbsp;<span class="op" id="4560610">==</span>&nbsp;<span class="ident" id="4560613">stateEOF</span>&nbsp;<span class="op" id="4560622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4560626">err</span>&nbsp;<span class="op" id="4560630">=</span>&nbsp;<span class="ident" id="4560632">io</span><span class="op" id="4560634">.</span><span class="ident" id="4560635">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4560640">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4560643">if</span>&nbsp;<span class="ident" id="4560646">err</span>&nbsp;<span class="op" id="4560650">!=</span>&nbsp;<span class="ident" id="4560653">nil</span>&nbsp;<span class="op" id="4560657">&amp;&amp;</span>&nbsp;<span class="ident" id="4560660">d</span><span class="op" id="4560661">.</span><span class="ident" id="4560662">r</span><span class="op" id="4560663">.</span><span class="ident" id="4560664">dot</span>&nbsp;<span class="op" id="4560668">==</span>&nbsp;<span class="ident" id="4560671">d</span>&nbsp;<span class="op" id="4560673">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4560677">d</span><span class="op" id="4560678">.</span><span class="ident" id="4560679">r</span><span class="op" id="4560680">.</span><span class="ident" id="4560681">dot</span>&nbsp;<span class="op" id="4560685">=</span>&nbsp;<span class="ident" id="4560687">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4560692">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4560695">return</span><br>
<span class="lineno"></span><span class="op" id="4560702">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="comment" id="4560705">//&nbsp;closeDot&nbsp;drains&nbsp;the&nbsp;current&nbsp;DotReader&nbsp;if&nbsp;any,</span><br>
<span class="lineno"></span><span class="comment" id="4560754">//&nbsp;making&nbsp;sure&nbsp;that&nbsp;it&nbsp;reads&nbsp;until&nbsp;the&nbsp;ending&nbsp;dot&nbsp;line.</span><br>
<span class="lineno"></span><span class="keyword" id="4560810">func</span>&nbsp;<span class="op" id="4560815">(</span><span class="ident" id="4560816">r</span>&nbsp;<span class="op" id="4560818">*</span><span class="ident" id="4560819">Reader</span><span class="op" id="4560825">)</span>&nbsp;<span class="ident" id="4560827">closeDot</span><span class="op" id="4560835">(</span><span class="op" id="4560836">)</span>&nbsp;<span class="op" id="4560838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4560841">if</span>&nbsp;<span class="ident" id="4560844">r</span><span class="op" id="4560845">.</span><span class="ident" id="4560846">dot</span>&nbsp;<span class="op" id="4560850">==</span>&nbsp;<span class="ident" id="4560853">nil</span>&nbsp;<span class="op" id="4560857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4560861">return</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4560869">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4560872">buf</span>&nbsp;<span class="op" id="4560876">:=</span>&nbsp;<span class="builtinfunc" id="4560879">make</span><span class="op" id="4560883">(</span><span class="op" id="4560884">[</span><span class="op" id="4560885">]</span><span class="builtintype" id="4560886">byte</span><span class="op" id="4560890">,</span>&nbsp;<span class="num" id="4560892">128</span><span class="op" id="4560895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4560898">for</span>&nbsp;<span class="ident" id="4560902">r</span><span class="op" id="4560903">.</span><span class="ident" id="4560904">dot</span>&nbsp;<span class="op" id="4560908">!=</span>&nbsp;<span class="ident" id="4560911">nil</span>&nbsp;<span class="op" id="4560915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4560919">//&nbsp;When&nbsp;Read&nbsp;reaches&nbsp;EOF&nbsp;or&nbsp;an&nbsp;error,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4560959">//&nbsp;it&nbsp;will&nbsp;set&nbsp;r.dot&nbsp;==&nbsp;nil.</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4560990">r</span><span class="op" id="4560991">.</span><span class="ident" id="4560992">dot</span><span class="op" id="4560995">.</span><span class="ident" id="4560996">Read</span><span class="op" id="4561000">(</span><span class="ident" id="4561001">buf</span><span class="op" id="4561004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4561007">}</span><br>
<span class="lineno"></span><span class="op" id="4561009">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4561012">//&nbsp;ReadDotBytes&nbsp;reads&nbsp;a&nbsp;dot-encoding&nbsp;and&nbsp;returns&nbsp;the&nbsp;decoded&nbsp;data.</span><br>
<span class="lineno">400</span><span class="comment" id="4561079">//</span><br>
<span class="lineno"></span><span class="comment" id="4561082">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;the&nbsp;DotReader&nbsp;method&nbsp;for&nbsp;details&nbsp;about&nbsp;dot-encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="4561164">func</span>&nbsp;<span class="op" id="4561169">(</span><span class="ident" id="4561170">r</span>&nbsp;<span class="op" id="4561172">*</span><span class="ident" id="4561173">Reader</span><span class="op" id="4561179">)</span>&nbsp;<span class="ident" id="4561181">ReadDotBytes</span><span class="op" id="4561193">(</span><span class="op" id="4561194">)</span>&nbsp;<span class="op" id="4561196">(</span><span class="op" id="4561197">[</span><span class="op" id="4561198">]</span><span class="builtintype" id="4561199">byte</span><span class="op" id="4561203">,</span>&nbsp;<span class="builtintype" id="4561205">error</span><span class="op" id="4561210">)</span>&nbsp;<span class="op" id="4561212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4561215">return</span>&nbsp;<span class="ident" id="4561222">ioutil</span><span class="op" id="4561228">.</span><span class="ident" id="4561229">ReadAll</span><span class="op" id="4561236">(</span><span class="ident" id="4561237">r</span><span class="op" id="4561238">.</span><span class="ident" id="4561239">DotReader</span><span class="op" id="4561248">(</span><span class="op" id="4561249">)</span><span class="op" id="4561250">)</span><br>
<span class="lineno"></span><span class="op" id="4561252">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="comment" id="4561255">//&nbsp;ReadDotLines&nbsp;reads&nbsp;a&nbsp;dot-encoding&nbsp;and&nbsp;returns&nbsp;a&nbsp;slice</span><br>
<span class="lineno"></span><span class="comment" id="4561312">//&nbsp;containing&nbsp;the&nbsp;decoded&nbsp;lines,&nbsp;with&nbsp;the&nbsp;final&nbsp;\r\n&nbsp;or&nbsp;\n&nbsp;elided&nbsp;from&nbsp;each.</span><br>
<span class="lineno"></span><span class="comment" id="4561389">//</span><br>
<span class="lineno"></span><span class="comment" id="4561392">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;the&nbsp;DotReader&nbsp;method&nbsp;for&nbsp;details&nbsp;about&nbsp;dot-encoding.</span><br>
<span class="lineno">410</span><span class="keyword" id="4561474">func</span>&nbsp;<span class="op" id="4561479">(</span><span class="ident" id="4561480">r</span>&nbsp;<span class="op" id="4561482">*</span><span class="ident" id="4561483">Reader</span><span class="op" id="4561489">)</span>&nbsp;<span class="ident" id="4561491">ReadDotLines</span><span class="op" id="4561503">(</span><span class="op" id="4561504">)</span>&nbsp;<span class="op" id="4561506">(</span><span class="op" id="4561507">[</span><span class="op" id="4561508">]</span><span class="builtintype" id="4561509">string</span><span class="op" id="4561515">,</span>&nbsp;<span class="builtintype" id="4561517">error</span><span class="op" id="4561522">)</span>&nbsp;<span class="op" id="4561524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4561527">//&nbsp;We&nbsp;could&nbsp;use&nbsp;ReadDotBytes&nbsp;and&nbsp;then&nbsp;Split&nbsp;it,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4561576">//&nbsp;but&nbsp;reading&nbsp;a&nbsp;line&nbsp;at&nbsp;a&nbsp;time&nbsp;avoids&nbsp;needing&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4561626">//&nbsp;large&nbsp;contiguous&nbsp;block&nbsp;of&nbsp;memory&nbsp;and&nbsp;is&nbsp;simpler.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4561679">var</span>&nbsp;<span class="ident" id="4561683">v</span>&nbsp;<span class="op" id="4561685">[</span><span class="op" id="4561686">]</span><span class="builtintype" id="4561687">string</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4561695">var</span>&nbsp;<span class="ident" id="4561699">err</span>&nbsp;<span class="builtintype" id="4561703">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4561710">for</span>&nbsp;<span class="op" id="4561714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4561718">var</span>&nbsp;<span class="ident" id="4561722">line</span>&nbsp;<span class="builtintype" id="4561727">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4561736">line</span><span class="op" id="4561740">,</span>&nbsp;<span class="ident" id="4561742">err</span>&nbsp;<span class="op" id="4561746">=</span>&nbsp;<span class="ident" id="4561748">r</span><span class="op" id="4561749">.</span><span class="ident" id="4561750">ReadLine</span><span class="op" id="4561758">(</span><span class="op" id="4561759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4561763">if</span>&nbsp;<span class="ident" id="4561766">err</span>&nbsp;<span class="op" id="4561770">!=</span>&nbsp;<span class="ident" id="4561773">nil</span>&nbsp;<span class="op" id="4561777">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4561782">if</span>&nbsp;<span class="ident" id="4561785">err</span>&nbsp;<span class="op" id="4561789">==</span>&nbsp;<span class="ident" id="4561792">io</span><span class="op" id="4561794">.</span><span class="ident" id="4561795">EOF</span>&nbsp;<span class="op" id="4561799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4561805">err</span>&nbsp;<span class="op" id="4561809">=</span>&nbsp;<span class="ident" id="4561811">io</span><span class="op" id="4561813">.</span><span class="ident" id="4561814">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4561834">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4561839">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4561847">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4561852">//&nbsp;Dot&nbsp;by&nbsp;itself&nbsp;marks&nbsp;end;&nbsp;otherwise&nbsp;cut&nbsp;one&nbsp;dot.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4561905">if</span>&nbsp;<span class="builtinfunc" id="4561908">len</span><span class="op" id="4561911">(</span><span class="ident" id="4561912">line</span><span class="op" id="4561916">)</span>&nbsp;<span class="op" id="4561918">&gt;</span>&nbsp;<span class="num" id="4561920">0</span>&nbsp;<span class="op" id="4561922">&amp;&amp;</span>&nbsp;<span class="ident" id="4561925">line</span><span class="op" id="4561929">[</span><span class="num" id="4561930">0</span><span class="op" id="4561931">]</span>&nbsp;<span class="op" id="4561933">==</span>&nbsp;<span class="string" id="4561936">&#39;.&#39;</span>&nbsp;<span class="op" id="4561940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4561945">if</span>&nbsp;<span class="builtinfunc" id="4561948">len</span><span class="op" id="4561951">(</span><span class="ident" id="4561952">line</span><span class="op" id="4561956">)</span>&nbsp;<span class="op" id="4561958">==</span>&nbsp;<span class="num" id="4561961">1</span>&nbsp;<span class="op" id="4561963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4561969">break</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4561978">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4561983">line</span>&nbsp;<span class="op" id="4561988">=</span>&nbsp;<span class="ident" id="4561990">line</span><span class="op" id="4561994">[</span><span class="num" id="4561995">1</span><span class="op" id="4561996">:</span><span class="op" id="4561997">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4562001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4562005">v</span>&nbsp;<span class="op" id="4562007">=</span>&nbsp;<span class="builtinfunc" id="4562009">append</span><span class="op" id="4562015">(</span><span class="ident" id="4562016">v</span><span class="op" id="4562017">,</span>&nbsp;<span class="ident" id="4562019">line</span><span class="op" id="4562023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4562026">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4562029">return</span>&nbsp;<span class="ident" id="4562036">v</span><span class="op" id="4562037">,</span>&nbsp;<span class="ident" id="4562039">err</span><br>
<span class="lineno"></span><span class="op" id="4562043">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4562046">//&nbsp;ReadMIMEHeader&nbsp;reads&nbsp;a&nbsp;MIME-style&nbsp;header&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="4562098">//&nbsp;The&nbsp;header&nbsp;is&nbsp;a&nbsp;sequence&nbsp;of&nbsp;possibly&nbsp;continued&nbsp;Key:&nbsp;Value&nbsp;lines</span><br>
<span class="lineno">440</span><span class="comment" id="4562165">//&nbsp;ending&nbsp;in&nbsp;a&nbsp;blank&nbsp;line.</span><br>
<span class="lineno"></span><span class="comment" id="4562192">//&nbsp;The&nbsp;returned&nbsp;map&nbsp;m&nbsp;maps&nbsp;CanonicalMIMEHeaderKey(key)&nbsp;to&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4562252">//&nbsp;sequence&nbsp;of&nbsp;values&nbsp;in&nbsp;the&nbsp;same&nbsp;order&nbsp;encountered&nbsp;in&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="comment" id="4562318">//</span><br>
<span class="lineno"></span><span class="comment" id="4562321">//&nbsp;For&nbsp;example,&nbsp;consider&nbsp;this&nbsp;input:</span><br>
<span class="lineno">445</span><span class="comment" id="4562358">//</span><br>
<span class="lineno"></span><span class="comment" id="4562361">//&nbsp;&nbsp;&nbsp;&nbspMy-Key:&nbsp;Value&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="4562380">//&nbsp;&nbsp;&nbsp;&nbspLong-Key:&nbsp;Even</span><br>
<span class="lineno"></span><span class="comment" id="4562398">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Longer&nbsp;Value</span><br>
<span class="lineno"></span><span class="comment" id="4562421">//&nbsp;&nbsp;&nbsp;&nbspMy-Key:&nbsp;Value&nbsp;2</span><br>
<span class="lineno">450</span><span class="comment" id="4562440">//</span><br>
<span class="lineno"></span><span class="comment" id="4562443">//&nbsp;Given&nbsp;that&nbsp;input,&nbsp;ReadMIMEHeader&nbsp;returns&nbsp;the&nbsp;map:</span><br>
<span class="lineno"></span><span class="comment" id="4562496">//</span><br>
<span class="lineno"></span><span class="comment" id="4562499">//&nbsp;&nbsp;&nbsp;&nbspmap[string][]string{</span><br>
<span class="lineno"></span><span class="comment" id="4562523">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&#34;My-Key&#34;:&nbsp;{&#34;Value&nbsp;1&#34;,&nbsp;&#34;Value&nbsp;2&#34;},</span><br>
<span class="lineno">455</span><span class="comment" id="4562561">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&#34;Long-Key&#34;:&nbsp;{&#34;Even&nbsp;Longer&nbsp;Value&#34;},</span><br>
<span class="lineno"></span><span class="comment" id="4562600">//&nbsp;&nbsp;&nbsp;&nbsp}</span><br>
<span class="lineno"></span><span class="comment" id="4562605">//</span><br>
<span class="lineno"></span><span class="keyword" id="4562608">func</span>&nbsp;<span class="op" id="4562613">(</span><span class="ident" id="4562614">r</span>&nbsp;<span class="op" id="4562616">*</span><span class="ident" id="4562617">Reader</span><span class="op" id="4562623">)</span>&nbsp;<span class="ident" id="4562625">ReadMIMEHeader</span><span class="op" id="4562639">(</span><span class="op" id="4562640">)</span>&nbsp;<span class="op" id="4562642">(</span><span class="ident" id="4562643">MIMEHeader</span><span class="op" id="4562653">,</span>&nbsp;<span class="builtintype" id="4562655">error</span><span class="op" id="4562660">)</span>&nbsp;<span class="op" id="4562662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4562665">//&nbsp;Avoid&nbsp;lots&nbsp;of&nbsp;small&nbsp;slice&nbsp;allocations&nbsp;later&nbsp;by&nbsp;allocating&nbsp;one</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4562731">//&nbsp;large&nbsp;one&nbsp;ahead&nbsp;of&nbsp;time&nbsp;which&nbsp;we&#39;ll&nbsp;cut&nbsp;up&nbsp;into&nbsp;smaller</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4562791">//&nbsp;slices.&nbsp;If&nbsp;this&nbsp;isn&#39;t&nbsp;big&nbsp;enough&nbsp;later,&nbsp;we&nbsp;allocate&nbsp;small&nbsp;ones.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4562859">var</span>&nbsp;<span class="ident" id="4562863">strs</span>&nbsp;<span class="op" id="4562868">[</span><span class="op" id="4562869">]</span><span class="builtintype" id="4562870">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4562878">hint</span>&nbsp;<span class="op" id="4562883">:=</span>&nbsp;<span class="ident" id="4562886">r</span><span class="op" id="4562887">.</span><span class="ident" id="4562888">upcomingHeaderNewlines</span><span class="op" id="4562910">(</span><span class="op" id="4562911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4562914">if</span>&nbsp;<span class="ident" id="4562917">hint</span>&nbsp;<span class="op" id="4562922">&gt;</span>&nbsp;<span class="num" id="4562924">0</span>&nbsp;<span class="op" id="4562926">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4562930">strs</span>&nbsp;<span class="op" id="4562935">=</span>&nbsp;<span class="builtinfunc" id="4562937">make</span><span class="op" id="4562941">(</span><span class="op" id="4562942">[</span><span class="op" id="4562943">]</span><span class="builtintype" id="4562944">string</span><span class="op" id="4562950">,</span>&nbsp;<span class="ident" id="4562952">hint</span><span class="op" id="4562956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4562959">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4562963">m</span>&nbsp;<span class="op" id="4562965">:=</span>&nbsp;<span class="builtinfunc" id="4562968">make</span><span class="op" id="4562972">(</span><span class="ident" id="4562973">MIMEHeader</span><span class="op" id="4562983">,</span>&nbsp;<span class="ident" id="4562985">hint</span><span class="op" id="4562989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4562992">for</span>&nbsp;<span class="op" id="4562996">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4563000">kv</span><span class="op" id="4563002">,</span>&nbsp;<span class="ident" id="4563004">err</span>&nbsp;<span class="op" id="4563008">:=</span>&nbsp;<span class="ident" id="4563011">r</span><span class="op" id="4563012">.</span><span class="ident" id="4563013">readContinuedLineSlice</span><span class="op" id="4563035">(</span><span class="op" id="4563036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4563040">if</span>&nbsp;<span class="builtinfunc" id="4563043">len</span><span class="op" id="4563046">(</span><span class="ident" id="4563047">kv</span><span class="op" id="4563049">)</span>&nbsp;<span class="op" id="4563051">==</span>&nbsp;<span class="num" id="4563054">0</span>&nbsp;<span class="op" id="4563056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4563061">return</span>&nbsp;<span class="ident" id="4563068">m</span><span class="op" id="4563069">,</span>&nbsp;<span class="ident" id="4563071">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4563077">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4563082">//&nbsp;Key&nbsp;ends&nbsp;at&nbsp;first&nbsp;colon;&nbsp;should&nbsp;not&nbsp;have&nbsp;spaces&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4563139">//&nbsp;they&nbsp;appear&nbsp;in&nbsp;the&nbsp;wild,&nbsp;violating&nbsp;specs,&nbsp;so&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4563192">//&nbsp;remove&nbsp;them&nbsp;if&nbsp;present.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4563221">i</span>&nbsp;<span class="op" id="4563223">:=</span>&nbsp;<span class="ident" id="4563226">bytes</span><span class="op" id="4563231">.</span><span class="ident" id="4563232">IndexByte</span><span class="op" id="4563241">(</span><span class="ident" id="4563242">kv</span><span class="op" id="4563244">,</span>&nbsp;<span class="string" id="4563246">&#39;:&#39;</span><span class="op" id="4563249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4563253">if</span>&nbsp;<span class="ident" id="4563256">i</span>&nbsp;<span class="op" id="4563258">&lt;</span>&nbsp;<span class="num" id="4563260">0</span>&nbsp;<span class="op" id="4563262">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4563267">return</span>&nbsp;<span class="ident" id="4563274">m</span><span class="op" id="4563275">,</span>&nbsp;<span class="ident" id="4563277">ProtocolError</span><span class="op" id="4563290">(</span><span class="string" id="4563291">&#34;malformed&nbsp;MIME&nbsp;header&nbsp;line:&nbsp;&#34;</span>&nbsp;<span class="op" id="4563322">+</span>&nbsp;<span class="builtintype" id="4563324">string</span><span class="op" id="4563330">(</span><span class="ident" id="4563331">kv</span><span class="op" id="4563333">)</span><span class="op" id="4563334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4563338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4563342">endKey</span>&nbsp;<span class="op" id="4563349">:=</span>&nbsp;<span class="ident" id="4563352">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4563356">for</span>&nbsp;<span class="ident" id="4563360">endKey</span>&nbsp;<span class="op" id="4563367">&gt;</span>&nbsp;<span class="num" id="4563369">0</span>&nbsp;<span class="op" id="4563371">&amp;&amp;</span>&nbsp;<span class="ident" id="4563374">kv</span><span class="op" id="4563376">[</span><span class="ident" id="4563377">endKey</span><span class="op" id="4563383">-</span><span class="num" id="4563384">1</span><span class="op" id="4563385">]</span>&nbsp;<span class="op" id="4563387">==</span>&nbsp;<span class="string" id="4563390">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="4563394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4563399">endKey</span><span class="op" id="4563405">--</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4563410">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4563414">key</span>&nbsp;<span class="op" id="4563418">:=</span>&nbsp;<span class="ident" id="4563421">canonicalMIMEHeaderKey</span><span class="op" id="4563443">(</span><span class="ident" id="4563444">kv</span><span class="op" id="4563446">[</span><span class="op" id="4563447">:</span><span class="ident" id="4563448">endKey</span><span class="op" id="4563454">]</span><span class="op" id="4563455">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4563460">//&nbsp;Skip&nbsp;initial&nbsp;spaces&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4563495">i</span><span class="op" id="4563496">++</span>&nbsp;<span class="comment" id="4563499">//&nbsp;skip&nbsp;colon</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4563515">for</span>&nbsp;<span class="ident" id="4563519">i</span>&nbsp;<span class="op" id="4563521">&lt;</span>&nbsp;<span class="builtinfunc" id="4563523">len</span><span class="op" id="4563526">(</span><span class="ident" id="4563527">kv</span><span class="op" id="4563529">)</span>&nbsp;<span class="op" id="4563531">&amp;&amp;</span>&nbsp;<span class="op" id="4563534">(</span><span class="ident" id="4563535">kv</span><span class="op" id="4563537">[</span><span class="ident" id="4563538">i</span><span class="op" id="4563539">]</span>&nbsp;<span class="op" id="4563541">==</span>&nbsp;<span class="string" id="4563544">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="4563548">||</span>&nbsp;<span class="ident" id="4563551">kv</span><span class="op" id="4563553">[</span><span class="ident" id="4563554">i</span><span class="op" id="4563555">]</span>&nbsp;<span class="op" id="4563557">==</span>&nbsp;<span class="string" id="4563560">&#39;\t&#39;</span><span class="op" id="4563564">)</span>&nbsp;<span class="op" id="4563566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4563571">i</span><span class="op" id="4563572">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4563577">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4563581">value</span>&nbsp;<span class="op" id="4563587">:=</span>&nbsp;<span class="builtintype" id="4563590">string</span><span class="op" id="4563596">(</span><span class="ident" id="4563597">kv</span><span class="op" id="4563599">[</span><span class="ident" id="4563600">i</span><span class="op" id="4563601">:</span><span class="op" id="4563602">]</span><span class="op" id="4563603">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4563608">vv</span>&nbsp;<span class="op" id="4563611">:=</span>&nbsp;<span class="ident" id="4563614">m</span><span class="op" id="4563615">[</span><span class="ident" id="4563616">key</span><span class="op" id="4563619">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4563623">if</span>&nbsp;<span class="ident" id="4563626">vv</span>&nbsp;<span class="op" id="4563629">==</span>&nbsp;<span class="ident" id="4563632">nil</span>&nbsp;<span class="op" id="4563636">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4563639">len</span><span class="op" id="4563642">(</span><span class="ident" id="4563643">strs</span><span class="op" id="4563647">)</span>&nbsp;<span class="op" id="4563649">&gt;</span>&nbsp;<span class="num" id="4563651">0</span>&nbsp;<span class="op" id="4563653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4563658">//&nbsp;More&nbsp;than&nbsp;likely&nbsp;this&nbsp;will&nbsp;be&nbsp;a&nbsp;single-element&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4563716">//&nbsp;Most&nbsp;headers&nbsp;aren&#39;t&nbsp;multi-valued.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4563756">//&nbsp;Set&nbsp;the&nbsp;capacity&nbsp;on&nbsp;strs[0]&nbsp;to&nbsp;1,&nbsp;so&nbsp;any&nbsp;future&nbsp;append</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4563817">//&nbsp;won&#39;t&nbsp;extend&nbsp;the&nbsp;slice&nbsp;into&nbsp;the&nbsp;other&nbsp;strings.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4563870">vv</span><span class="op" id="4563872">,</span>&nbsp;<span class="ident" id="4563874">strs</span>&nbsp;<span class="op" id="4563879">=</span>&nbsp;<span class="ident" id="4563881">strs</span><span class="op" id="4563885">[</span><span class="op" id="4563886">:</span><span class="num" id="4563887">1</span><span class="op" id="4563888">:</span><span class="num" id="4563889">1</span><span class="op" id="4563890">]</span><span class="op" id="4563891">,</span>&nbsp;<span class="ident" id="4563893">strs</span><span class="op" id="4563897">[</span><span class="num" id="4563898">1</span><span class="op" id="4563899">:</span><span class="op" id="4563900">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4563905">vv</span><span class="op" id="4563907">[</span><span class="num" id="4563908">0</span><span class="op" id="4563909">]</span>&nbsp;<span class="op" id="4563911">=</span>&nbsp;<span class="ident" id="4563913">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4563922">m</span><span class="op" id="4563923">[</span><span class="ident" id="4563924">key</span><span class="op" id="4563927">]</span>&nbsp;<span class="op" id="4563929">=</span>&nbsp;<span class="ident" id="4563931">vv</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4563936">}</span>&nbsp;<span class="keyword" id="4563938">else</span>&nbsp;<span class="op" id="4563943">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4563948">m</span><span class="op" id="4563949">[</span><span class="ident" id="4563950">key</span><span class="op" id="4563953">]</span>&nbsp;<span class="op" id="4563955">=</span>&nbsp;<span class="builtinfunc" id="4563957">append</span><span class="op" id="4563963">(</span><span class="ident" id="4563964">vv</span><span class="op" id="4563966">,</span>&nbsp;<span class="ident" id="4563968">value</span><span class="op" id="4563973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4563977">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4563982">if</span>&nbsp;<span class="ident" id="4563985">err</span>&nbsp;<span class="op" id="4563989">!=</span>&nbsp;<span class="ident" id="4563992">nil</span>&nbsp;<span class="op" id="4563996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4564001">return</span>&nbsp;<span class="ident" id="4564008">m</span><span class="op" id="4564009">,</span>&nbsp;<span class="ident" id="4564011">err</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4564017">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4564020">}</span><br>
<span class="lineno"></span><span class="op" id="4564022">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4564025">//&nbsp;upcomingHeaderNewlines&nbsp;returns&nbsp;an&nbsp;approximation&nbsp;of&nbsp;the&nbsp;number&nbsp;of&nbsp;newlines</span><br>
<span class="lineno">515</span><span class="comment" id="4564102">//&nbsp;that&nbsp;will&nbsp;be&nbsp;in&nbsp;this&nbsp;header.&nbsp;If&nbsp;it&nbsp;gets&nbsp;confused,&nbsp;it&nbsp;returns&nbsp;0.</span><br>
<span class="lineno"></span><span class="keyword" id="4564169">func</span>&nbsp;<span class="op" id="4564174">(</span><span class="ident" id="4564175">r</span>&nbsp;<span class="op" id="4564177">*</span><span class="ident" id="4564178">Reader</span><span class="op" id="4564184">)</span>&nbsp;<span class="ident" id="4564186">upcomingHeaderNewlines</span><span class="op" id="4564208">(</span><span class="op" id="4564209">)</span>&nbsp;<span class="op" id="4564211">(</span><span class="ident" id="4564212">n</span>&nbsp;<span class="builtintype" id="4564214">int</span><span class="op" id="4564217">)</span>&nbsp;<span class="op" id="4564219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4564222">//&nbsp;Try&nbsp;to&nbsp;determine&nbsp;the&nbsp;&#39;hint&#39;&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4564260">r</span><span class="op" id="4564261">.</span><span class="ident" id="4564262">R</span><span class="op" id="4564263">.</span><span class="ident" id="4564264">Peek</span><span class="op" id="4564268">(</span><span class="num" id="4564269">1</span><span class="op" id="4564270">)</span>&nbsp;<span class="comment" id="4564272">//&nbsp;force&nbsp;a&nbsp;buffer&nbsp;load&nbsp;if&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4564305">s</span>&nbsp;<span class="op" id="4564307">:=</span>&nbsp;<span class="ident" id="4564310">r</span><span class="op" id="4564311">.</span><span class="ident" id="4564312">R</span><span class="op" id="4564313">.</span><span class="ident" id="4564314">Buffered</span><span class="op" id="4564322">(</span><span class="op" id="4564323">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4564326">if</span>&nbsp;<span class="ident" id="4564329">s</span>&nbsp;<span class="op" id="4564331">==</span>&nbsp;<span class="num" id="4564334">0</span>&nbsp;<span class="op" id="4564336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4564340">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4564348">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4564351">peek</span><span class="op" id="4564355">,</span>&nbsp;<span class="ident" id="4564357">_</span>&nbsp;<span class="op" id="4564359">:=</span>&nbsp;<span class="ident" id="4564362">r</span><span class="op" id="4564363">.</span><span class="ident" id="4564364">R</span><span class="op" id="4564365">.</span><span class="ident" id="4564366">Peek</span><span class="op" id="4564370">(</span><span class="ident" id="4564371">s</span><span class="op" id="4564372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4564375">for</span>&nbsp;<span class="builtinfunc" id="4564379">len</span><span class="op" id="4564382">(</span><span class="ident" id="4564383">peek</span><span class="op" id="4564387">)</span>&nbsp;<span class="op" id="4564389">&gt;</span>&nbsp;<span class="num" id="4564391">0</span>&nbsp;<span class="op" id="4564393">{</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4564397">i</span>&nbsp;<span class="op" id="4564399">:=</span>&nbsp;<span class="ident" id="4564402">bytes</span><span class="op" id="4564407">.</span><span class="ident" id="4564408">IndexByte</span><span class="op" id="4564417">(</span><span class="ident" id="4564418">peek</span><span class="op" id="4564422">,</span>&nbsp;<span class="string" id="4564424">&#39;\n&#39;</span><span class="op" id="4564428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4564432">if</span>&nbsp;<span class="ident" id="4564435">i</span>&nbsp;<span class="op" id="4564437">&lt;</span>&nbsp;<span class="num" id="4564439">3</span>&nbsp;<span class="op" id="4564441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4564446">//&nbsp;Not&nbsp;present&nbsp;(-1)&nbsp;or&nbsp;found&nbsp;within&nbsp;the&nbsp;next&nbsp;few&nbsp;bytes,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4564505">//&nbsp;implying&nbsp;we&#39;re&nbsp;at&nbsp;the&nbsp;end&nbsp;(&#34;\r\n\r\n&#34;&nbsp;or&nbsp;&#34;\n\n&#34;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4564560">return</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4564569">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4564573">n</span><span class="op" id="4564574">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4564579">peek</span>&nbsp;<span class="op" id="4564584">=</span>&nbsp;<span class="ident" id="4564586">peek</span><span class="op" id="4564590">[</span><span class="ident" id="4564591">i</span><span class="op" id="4564592">+</span><span class="num" id="4564593">1</span><span class="op" id="4564594">:</span><span class="op" id="4564595">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4564598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4564601">return</span><br>
<span class="lineno">535</span><span class="op" id="4564608">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4564611">//&nbsp;CanonicalMIMEHeaderKey&nbsp;returns&nbsp;the&nbsp;canonical&nbsp;format&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4564673">//&nbsp;MIME&nbsp;header&nbsp;key&nbsp;s.&nbsp;&nbsp;The&nbsp;canonicalization&nbsp;converts&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span><span class="comment" id="4564736">//&nbsp;letter&nbsp;and&nbsp;any&nbsp;letter&nbsp;following&nbsp;a&nbsp;hyphen&nbsp;to&nbsp;upper&nbsp;case;</span><br>
<span class="lineno">540</span><span class="comment" id="4564795">//&nbsp;the&nbsp;rest&nbsp;are&nbsp;converted&nbsp;to&nbsp;lowercase.&nbsp;&nbsp;For&nbsp;example,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4564853">//&nbsp;canonical&nbsp;key&nbsp;for&nbsp;&#34;accept-encoding&#34;&nbsp;is&nbsp;&#34;Accept-Encoding&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="4564914">//&nbsp;MIME&nbsp;header&nbsp;keys&nbsp;are&nbsp;assumed&nbsp;to&nbsp;be&nbsp;ASCII&nbsp;only.</span><br>
<span class="lineno"></span><span class="keyword" id="4564964">func</span>&nbsp;<span class="ident" id="4564969">CanonicalMIMEHeaderKey</span><span class="op" id="4564991">(</span><span class="ident" id="4564992">s</span>&nbsp;<span class="builtintype" id="4564994">string</span><span class="op" id="4565000">)</span>&nbsp;<span class="builtintype" id="4565002">string</span>&nbsp;<span class="op" id="4565009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4565012">//&nbsp;Quick&nbsp;check&nbsp;for&nbsp;canonical&nbsp;encoding.</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4565052">upper</span>&nbsp;<span class="op" id="4565058">:=</span>&nbsp;<span class="builtintype" id="4565061">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4565067">for</span>&nbsp;<span class="ident" id="4565071">i</span>&nbsp;<span class="op" id="4565073">:=</span>&nbsp;<span class="num" id="4565076">0</span><span class="op" id="4565077">;</span>&nbsp;<span class="ident" id="4565079">i</span>&nbsp;<span class="op" id="4565081">&lt;</span>&nbsp;<span class="builtinfunc" id="4565083">len</span><span class="op" id="4565086">(</span><span class="ident" id="4565087">s</span><span class="op" id="4565088">)</span><span class="op" id="4565089">;</span>&nbsp;<span class="ident" id="4565091">i</span><span class="op" id="4565092">++</span>&nbsp;<span class="op" id="4565095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4565099">c</span>&nbsp;<span class="op" id="4565101">:=</span>&nbsp;<span class="ident" id="4565104">s</span><span class="op" id="4565105">[</span><span class="ident" id="4565106">i</span><span class="op" id="4565107">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4565111">if</span>&nbsp;<span class="ident" id="4565114">upper</span>&nbsp;<span class="op" id="4565120">&amp;&amp;</span>&nbsp;<span class="string" id="4565123">&#39;a&#39;</span>&nbsp;<span class="op" id="4565127">&lt;=</span>&nbsp;<span class="ident" id="4565130">c</span>&nbsp;<span class="op" id="4565132">&amp;&amp;</span>&nbsp;<span class="ident" id="4565135">c</span>&nbsp;<span class="op" id="4565137">&lt;=</span>&nbsp;<span class="string" id="4565140">&#39;z&#39;</span>&nbsp;<span class="op" id="4565144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4565149">return</span>&nbsp;<span class="ident" id="4565156">canonicalMIMEHeaderKey</span><span class="op" id="4565178">(</span><span class="op" id="4565179">[</span><span class="op" id="4565180">]</span><span class="builtintype" id="4565181">byte</span><span class="op" id="4565185">(</span><span class="ident" id="4565186">s</span><span class="op" id="4565187">)</span><span class="op" id="4565188">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4565192">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4565196">if</span>&nbsp;<span class="op" id="4565199">!</span><span class="ident" id="4565200">upper</span>&nbsp;<span class="op" id="4565206">&amp;&amp;</span>&nbsp;<span class="string" id="4565209">&#39;A&#39;</span>&nbsp;<span class="op" id="4565213">&lt;=</span>&nbsp;<span class="ident" id="4565216">c</span>&nbsp;<span class="op" id="4565218">&amp;&amp;</span>&nbsp;<span class="ident" id="4565221">c</span>&nbsp;<span class="op" id="4565223">&lt;=</span>&nbsp;<span class="string" id="4565226">&#39;Z&#39;</span>&nbsp;<span class="op" id="4565230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4565235">return</span>&nbsp;<span class="ident" id="4565242">canonicalMIMEHeaderKey</span><span class="op" id="4565264">(</span><span class="op" id="4565265">[</span><span class="op" id="4565266">]</span><span class="builtintype" id="4565267">byte</span><span class="op" id="4565271">(</span><span class="ident" id="4565272">s</span><span class="op" id="4565273">)</span><span class="op" id="4565274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4565278">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4565282">upper</span>&nbsp;<span class="op" id="4565288">=</span>&nbsp;<span class="ident" id="4565290">c</span>&nbsp;<span class="op" id="4565292">==</span>&nbsp;<span class="string" id="4565295">&#39;-&#39;</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4565300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4565303">return</span>&nbsp;<span class="ident" id="4565310">s</span><br>
<span class="lineno"></span><span class="op" id="4565312">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4565315">const</span>&nbsp;<span class="ident" id="4565321">toLower</span>&nbsp;<span class="op" id="4565329">=</span>&nbsp;<span class="string" id="4565331">&#39;a&#39;</span>&nbsp;<span class="op" id="4565335">-</span>&nbsp;<span class="string" id="4565337">&#39;A&#39;</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span><span class="comment" id="4565342">//&nbsp;canonicalMIMEHeaderKey&nbsp;is&nbsp;like&nbsp;CanonicalMIMEHeaderKey&nbsp;but&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="4565406">//&nbsp;allowed&nbsp;to&nbsp;mutate&nbsp;the&nbsp;provided&nbsp;byte&nbsp;slice&nbsp;before&nbsp;returning&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4565472">//&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="4565483">func</span>&nbsp;<span class="ident" id="4565488">canonicalMIMEHeaderKey</span><span class="op" id="4565510">(</span><span class="ident" id="4565511">a</span>&nbsp;<span class="op" id="4565513">[</span><span class="op" id="4565514">]</span><span class="builtintype" id="4565515">byte</span><span class="op" id="4565519">)</span>&nbsp;<span class="builtintype" id="4565521">string</span>&nbsp;<span class="op" id="4565528">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4565531">upper</span>&nbsp;<span class="op" id="4565537">:=</span>&nbsp;<span class="builtintype" id="4565540">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4565546">for</span>&nbsp;<span class="ident" id="4565550">i</span><span class="op" id="4565551">,</span>&nbsp;<span class="ident" id="4565553">c</span>&nbsp;<span class="op" id="4565555">:=</span>&nbsp;<span class="keyword" id="4565558">range</span>&nbsp;<span class="ident" id="4565564">a</span>&nbsp;<span class="op" id="4565566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4565570">//&nbsp;Canonicalize:&nbsp;first&nbsp;letter&nbsp;upper&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4565613">//&nbsp;and&nbsp;upper&nbsp;case&nbsp;after&nbsp;each&nbsp;dash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4565650">//&nbsp;(Host,&nbsp;User-Agent,&nbsp;If-Modified-Since).</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4565694">//&nbsp;MIME&nbsp;headers&nbsp;are&nbsp;ASCII&nbsp;only,&nbsp;so&nbsp;no&nbsp;Unicode&nbsp;issues.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4565750">if</span>&nbsp;<span class="ident" id="4565753">c</span>&nbsp;<span class="op" id="4565755">==</span>&nbsp;<span class="string" id="4565758">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="4565762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4565767">c</span>&nbsp;<span class="op" id="4565769">=</span>&nbsp;<span class="string" id="4565771">&#39;-&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4565777">}</span>&nbsp;<span class="keyword" id="4565779">else</span>&nbsp;<span class="keyword" id="4565784">if</span>&nbsp;<span class="ident" id="4565787">upper</span>&nbsp;<span class="op" id="4565793">&amp;&amp;</span>&nbsp;<span class="string" id="4565796">&#39;a&#39;</span>&nbsp;<span class="op" id="4565800">&lt;=</span>&nbsp;<span class="ident" id="4565803">c</span>&nbsp;<span class="op" id="4565805">&amp;&amp;</span>&nbsp;<span class="ident" id="4565808">c</span>&nbsp;<span class="op" id="4565810">&lt;=</span>&nbsp;<span class="string" id="4565813">&#39;z&#39;</span>&nbsp;<span class="op" id="4565817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4565822">c</span>&nbsp;<span class="op" id="4565824">-=</span>&nbsp;<span class="ident" id="4565827">toLower</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4565837">}</span>&nbsp;<span class="keyword" id="4565839">else</span>&nbsp;<span class="keyword" id="4565844">if</span>&nbsp;<span class="op" id="4565847">!</span><span class="ident" id="4565848">upper</span>&nbsp;<span class="op" id="4565854">&amp;&amp;</span>&nbsp;<span class="string" id="4565857">&#39;A&#39;</span>&nbsp;<span class="op" id="4565861">&lt;=</span>&nbsp;<span class="ident" id="4565864">c</span>&nbsp;<span class="op" id="4565866">&amp;&amp;</span>&nbsp;<span class="ident" id="4565869">c</span>&nbsp;<span class="op" id="4565871">&lt;=</span>&nbsp;<span class="string" id="4565874">&#39;Z&#39;</span>&nbsp;<span class="op" id="4565878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4565883">c</span>&nbsp;<span class="op" id="4565885">+=</span>&nbsp;<span class="ident" id="4565888">toLower</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4565898">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4565902">a</span><span class="op" id="4565903">[</span><span class="ident" id="4565904">i</span><span class="op" id="4565905">]</span>&nbsp;<span class="op" id="4565907">=</span>&nbsp;<span class="ident" id="4565909">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4565913">upper</span>&nbsp;<span class="op" id="4565919">=</span>&nbsp;<span class="ident" id="4565921">c</span>&nbsp;<span class="op" id="4565923">==</span>&nbsp;<span class="string" id="4565926">&#39;-&#39;</span>&nbsp;<span class="comment" id="4565930">//&nbsp;for&nbsp;next&nbsp;time</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4565948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4565951">//&nbsp;The&nbsp;compiler&nbsp;recognizes&nbsp;m[string(byteSlice)]&nbsp;as&nbsp;a&nbsp;special</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4566013">//&nbsp;case,&nbsp;so&nbsp;a&nbsp;copy&nbsp;of&nbsp;a&#39;s&nbsp;bytes&nbsp;into&nbsp;a&nbsp;new&nbsp;string&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4566073">//&nbsp;happen&nbsp;in&nbsp;this&nbsp;map&nbsp;lookup:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4566104">if</span>&nbsp;<span class="ident" id="4566107">v</span>&nbsp;<span class="op" id="4566109">:=</span>&nbsp;<span class="ident" id="4566112">commonHeader</span><span class="op" id="4566124">[</span><span class="builtintype" id="4566125">string</span><span class="op" id="4566131">(</span><span class="ident" id="4566132">a</span><span class="op" id="4566133">)</span><span class="op" id="4566134">]</span><span class="op" id="4566135">;</span>&nbsp;<span class="ident" id="4566137">v</span>&nbsp;<span class="op" id="4566139">!=</span>&nbsp;<span class="string" id="4566142">&#34;&#34;</span>&nbsp;<span class="op" id="4566145">{</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4566149">return</span>&nbsp;<span class="ident" id="4566156">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4566159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4566162">return</span>&nbsp;<span class="builtintype" id="4566169">string</span><span class="op" id="4566175">(</span><span class="ident" id="4566176">a</span><span class="op" id="4566177">)</span><br>
<span class="lineno"></span><span class="op" id="4566179">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span><span class="comment" id="4566182">//&nbsp;commonHeader&nbsp;interns&nbsp;common&nbsp;header&nbsp;strings.</span><br>
<span class="lineno"></span><span class="keyword" id="4566229">var</span>&nbsp;<span class="ident" id="4566233">commonHeader</span>&nbsp;<span class="op" id="4566246">=</span>&nbsp;<span class="builtinfunc" id="4566248">make</span><span class="op" id="4566252">(</span><span class="keyword" id="4566253">map</span><span class="op" id="4566256">[</span><span class="builtintype" id="4566257">string</span><span class="op" id="4566263">]</span><span class="builtintype" id="4566264">string</span><span class="op" id="4566270">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4566273">func</span>&nbsp;<span class="ident" id="4566278">init</span><span class="op" id="4566282">(</span><span class="op" id="4566283">)</span>&nbsp;<span class="op" id="4566285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4566288">for</span>&nbsp;<span class="ident" id="4566292">_</span><span class="op" id="4566293">,</span>&nbsp;<span class="ident" id="4566295">v</span>&nbsp;<span class="op" id="4566297">:=</span>&nbsp;<span class="keyword" id="4566300">range</span>&nbsp;<span class="op" id="4566306">[</span><span class="op" id="4566307">]</span><span class="builtintype" id="4566308">string</span><span class="op" id="4566314">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4566318">&#34;Accept&#34;</span><span class="op" id="4566326">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4566330">&#34;Accept-Charset&#34;</span><span class="op" id="4566346">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4566350">&#34;Accept-Encoding&#34;</span><span class="op" id="4566367">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4566371">&#34;Accept-Language&#34;</span><span class="op" id="4566388">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4566392">&#34;Accept-Ranges&#34;</span><span class="op" id="4566407">,</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4566411">&#34;Cache-Control&#34;</span><span class="op" id="4566426">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4566430">&#34;Cc&#34;</span><span class="op" id="4566434">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4566438">&#34;Connection&#34;</span><span class="op" id="4566450">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4566454">&#34;Content-Id&#34;</span><span class="op" id="4566466">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4566470">&#34;Content-Language&#34;</span><span class="op" id="4566488">,</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4566492">&#34;Content-Length&#34;</span><span class="op" id="4566508">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4566512">&#34;Content-Transfer-Encoding&#34;</span><span class="op" id="4566539">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4566543">&#34;Content-Type&#34;</span><span class="op" id="4566557">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4566561">&#34;Cookie&#34;</span><span class="op" id="4566569">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4566573">&#34;Date&#34;</span><span class="op" id="4566579">,</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4566583">&#34;Dkim-Signature&#34;</span><span class="op" id="4566599">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4566603">&#34;Etag&#34;</span><span class="op" id="4566609">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4566613">&#34;Expires&#34;</span><span class="op" id="4566622">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4566626">&#34;From&#34;</span><span class="op" id="4566632">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4566636">&#34;Host&#34;</span><span class="op" id="4566642">,</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4566646">&#34;If-Modified-Since&#34;</span><span class="op" id="4566665">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4566669">&#34;If-None-Match&#34;</span><span class="op" id="4566684">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4566688">&#34;In-Reply-To&#34;</span><span class="op" id="4566701">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4566705">&#34;Last-Modified&#34;</span><span class="op" id="4566720">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4566724">&#34;Location&#34;</span><span class="op" id="4566734">,</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4566738">&#34;Message-Id&#34;</span><span class="op" id="4566750">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4566754">&#34;Mime-Version&#34;</span><span class="op" id="4566768">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4566772">&#34;Pragma&#34;</span><span class="op" id="4566780">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4566784">&#34;Received&#34;</span><span class="op" id="4566794">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4566798">&#34;Return-Path&#34;</span><span class="op" id="4566811">,</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4566815">&#34;Server&#34;</span><span class="op" id="4566823">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4566827">&#34;Set-Cookie&#34;</span><span class="op" id="4566839">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4566843">&#34;Subject&#34;</span><span class="op" id="4566852">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4566856">&#34;To&#34;</span><span class="op" id="4566860">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4566864">&#34;User-Agent&#34;</span><span class="op" id="4566876">,</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4566880">&#34;Via&#34;</span><span class="op" id="4566885">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4566889">&#34;X-Forwarded-For&#34;</span><span class="op" id="4566906">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4566910">&#34;X-Imforwards&#34;</span><span class="op" id="4566924">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4566928">&#34;X-Powered-By&#34;</span><span class="op" id="4566942">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4566945">}</span>&nbsp;<span class="op" id="4566947">{</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4566951">commonHeader</span><span class="op" id="4566963">[</span><span class="ident" id="4566964">v</span><span class="op" id="4566965">]</span>&nbsp;<span class="op" id="4566967">=</span>&nbsp;<span class="ident" id="4566969">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4566972">}</span><br>
<span class="lineno"></span><span class="op" id="4566974">}</span>
</div>
</body>
</html>
