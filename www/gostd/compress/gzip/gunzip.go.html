<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/gzip</h2>
<ul>
<li><a href="/gostd/compress/gzip/gunzip.go.html" class="current">gunzip.go</a></li>
<li><a href="/gostd/compress/gzip/gunzip_test.go.html">gunzip_test.go</a></li>
<li><a href="/gostd/compress/gzip/gzip.go.html">gzip.go</a></li>
<li><a href="/gostd/compress/gzip/gzip_test.go.html">gzip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4336232">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4336287">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4336341">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4336392">//&nbsp;Package&nbsp;gzip&nbsp;implements&nbsp;reading&nbsp;and&nbsp;writing&nbsp;of&nbsp;gzip&nbsp;format&nbsp;compressed&nbsp;files,</span><br>
<span class="lineno"></span><span class="comment" id="4336472">//&nbsp;as&nbsp;specified&nbsp;in&nbsp;RFC&nbsp;1952.</span><br>
<span class="lineno"></span><span class="keyword" id="4336501">package</span>&nbsp;<span class="ident" id="4336509">gzip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4336515">import</span>&nbsp;<span class="op" id="4336522">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4336525">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4336534">&#34;compress/flate&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4336552">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4336562">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4336570">&#34;hash/crc32&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4336584">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4336590">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="4336597">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4336600">const</span>&nbsp;<span class="op" id="4336606">(</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4336609">gzipID1</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4336621">=</span>&nbsp;<span class="num" id="4336623">0x1f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4336629">gzipID2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4336641">=</span>&nbsp;<span class="num" id="4336643">0x8b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4336649">gzipDeflate</span>&nbsp;<span class="op" id="4336661">=</span>&nbsp;<span class="num" id="4336663">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4336666">flagText</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4336678">=</span>&nbsp;<span class="num" id="4336680">1</span>&nbsp;<span class="op" id="4336682">&lt;&lt;</span>&nbsp;<span class="num" id="4336685">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4336688">flagHdrCrc</span>&nbsp;&nbsp;<span class="op" id="4336700">=</span>&nbsp;<span class="num" id="4336702">1</span>&nbsp;<span class="op" id="4336704">&lt;&lt;</span>&nbsp;<span class="num" id="4336707">1</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4336710">flagExtra</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4336722">=</span>&nbsp;<span class="num" id="4336724">1</span>&nbsp;<span class="op" id="4336726">&lt;&lt;</span>&nbsp;<span class="num" id="4336729">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4336732">flagName</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4336744">=</span>&nbsp;<span class="num" id="4336746">1</span>&nbsp;<span class="op" id="4336748">&lt;&lt;</span>&nbsp;<span class="num" id="4336751">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4336754">flagComment</span>&nbsp;<span class="op" id="4336766">=</span>&nbsp;<span class="num" id="4336768">1</span>&nbsp;<span class="op" id="4336770">&lt;&lt;</span>&nbsp;<span class="num" id="4336773">4</span><br>
<span class="lineno"></span><span class="op" id="4336775">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="4336778">func</span>&nbsp;<span class="ident" id="4336783">makeReader</span><span class="op" id="4336793">(</span><span class="ident" id="4336794">r</span>&nbsp;<span class="ident" id="4336796">io</span><span class="op" id="4336798">.</span><span class="ident" id="4336799">Reader</span><span class="op" id="4336805">)</span>&nbsp;<span class="ident" id="4336807">flate</span><span class="op" id="4336812">.</span><span class="ident" id="4336813">Reader</span>&nbsp;<span class="op" id="4336820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4336823">if</span>&nbsp;<span class="ident" id="4336826">rr</span><span class="op" id="4336828">,</span>&nbsp;<span class="ident" id="4336830">ok</span>&nbsp;<span class="op" id="4336833">:=</span>&nbsp;<span class="ident" id="4336836">r</span><span class="op" id="4336837">.</span><span class="op" id="4336838">(</span><span class="ident" id="4336839">flate</span><span class="op" id="4336844">.</span><span class="ident" id="4336845">Reader</span><span class="op" id="4336851">)</span><span class="op" id="4336852">;</span>&nbsp;<span class="ident" id="4336854">ok</span>&nbsp;<span class="op" id="4336857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4336861">return</span>&nbsp;<span class="ident" id="4336868">rr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4336872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4336875">return</span>&nbsp;<span class="ident" id="4336882">bufio</span><span class="op" id="4336887">.</span><span class="ident" id="4336888">NewReader</span><span class="op" id="4336897">(</span><span class="ident" id="4336898">r</span><span class="op" id="4336899">)</span><br>
<span class="lineno">35</span><span class="op" id="4336901">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4336904">var</span>&nbsp;<span class="op" id="4336908">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4336911">//&nbsp;ErrChecksum&nbsp;is&nbsp;returned&nbsp;when&nbsp;reading&nbsp;GZIP&nbsp;data&nbsp;that&nbsp;has&nbsp;an&nbsp;invalid&nbsp;checksum.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4336992">ErrChecksum</span>&nbsp;<span class="op" id="4337004">=</span>&nbsp;<span class="ident" id="4337006">errors</span><span class="op" id="4337012">.</span><span class="ident" id="4337013">New</span><span class="op" id="4337016">(</span><span class="string" id="4337017">&#34;gzip:&nbsp;invalid&nbsp;checksum&#34;</span><span class="op" id="4337041">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4337044">//&nbsp;ErrHeader&nbsp;is&nbsp;returned&nbsp;when&nbsp;reading&nbsp;GZIP&nbsp;data&nbsp;that&nbsp;has&nbsp;an&nbsp;invalid&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4337121">ErrHeader</span>&nbsp;<span class="op" id="4337131">=</span>&nbsp;<span class="ident" id="4337133">errors</span><span class="op" id="4337139">.</span><span class="ident" id="4337140">New</span><span class="op" id="4337143">(</span><span class="string" id="4337144">&#34;gzip:&nbsp;invalid&nbsp;header&#34;</span><span class="op" id="4337166">)</span><br>
<span class="lineno"></span><span class="op" id="4337168">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4337171">//&nbsp;The&nbsp;gzip&nbsp;file&nbsp;stores&nbsp;a&nbsp;header&nbsp;giving&nbsp;metadata&nbsp;about&nbsp;the&nbsp;compressed&nbsp;file.</span><br>
<span class="lineno">45</span><span class="comment" id="4337247">//&nbsp;That&nbsp;header&nbsp;is&nbsp;exposed&nbsp;as&nbsp;the&nbsp;fields&nbsp;of&nbsp;the&nbsp;Writer&nbsp;and&nbsp;Reader&nbsp;structs.</span><br>
<span class="lineno"></span><span class="keyword" id="4337321">type</span>&nbsp;<span class="ident" id="4337326">Header</span>&nbsp;<span class="keyword" id="4337333">struct</span>&nbsp;<span class="op" id="4337340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4337343">Comment</span>&nbsp;<span class="builtintype" id="4337351">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4337361">//&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4337373">Extra</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4337381">[</span><span class="op" id="4337382">]</span><span class="builtintype" id="4337383">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4337391">//&nbsp;&#34;extra&nbsp;data&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4337408">ModTime</span>&nbsp;<span class="ident" id="4337416">time</span><span class="op" id="4337420">.</span><span class="ident" id="4337421">Time</span>&nbsp;<span class="comment" id="4337426">//&nbsp;modification&nbsp;time</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4337448">Name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4337456">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4337466">//&nbsp;file&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4337480">OS</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4337488">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4337498">//&nbsp;operating&nbsp;system&nbsp;type</span><br>
<span class="lineno"></span><span class="op" id="4337523">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4337526">//&nbsp;A&nbsp;Reader&nbsp;is&nbsp;an&nbsp;io.Reader&nbsp;that&nbsp;can&nbsp;be&nbsp;read&nbsp;to&nbsp;retrieve</span><br>
<span class="lineno">55</span><span class="comment" id="4337583">//&nbsp;uncompressed&nbsp;data&nbsp;from&nbsp;a&nbsp;gzip-format&nbsp;compressed&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="4337640">//</span><br>
<span class="lineno"></span><span class="comment" id="4337643">//&nbsp;In&nbsp;general,&nbsp;a&nbsp;gzip&nbsp;file&nbsp;can&nbsp;be&nbsp;a&nbsp;concatenation&nbsp;of&nbsp;gzip&nbsp;files,</span><br>
<span class="lineno"></span><span class="comment" id="4337708">//&nbsp;each&nbsp;with&nbsp;its&nbsp;own&nbsp;header.&nbsp;&nbsp;Reads&nbsp;from&nbsp;the&nbsp;Reader</span><br>
<span class="lineno"></span><span class="comment" id="4337760">//&nbsp;return&nbsp;the&nbsp;concatenation&nbsp;of&nbsp;the&nbsp;uncompressed&nbsp;data&nbsp;of&nbsp;each.</span><br>
<span class="lineno">60</span><span class="comment" id="4337822">//&nbsp;Only&nbsp;the&nbsp;first&nbsp;header&nbsp;is&nbsp;recorded&nbsp;in&nbsp;the&nbsp;Reader&nbsp;fields.</span><br>
<span class="lineno"></span><span class="comment" id="4337881">//</span><br>
<span class="lineno"></span><span class="comment" id="4337884">//&nbsp;Gzip&nbsp;files&nbsp;store&nbsp;a&nbsp;length&nbsp;and&nbsp;checksum&nbsp;of&nbsp;the&nbsp;uncompressed&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="4337952">//&nbsp;The&nbsp;Reader&nbsp;will&nbsp;return&nbsp;a&nbsp;ErrChecksum&nbsp;when&nbsp;Read</span><br>
<span class="lineno"></span><span class="comment" id="4338002">//&nbsp;reaches&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;uncompressed&nbsp;data&nbsp;if&nbsp;it&nbsp;does&nbsp;not</span><br>
<span class="lineno">65</span><span class="comment" id="4338061">//&nbsp;have&nbsp;the&nbsp;expected&nbsp;length&nbsp;or&nbsp;checksum.&nbsp;&nbsp;Clients&nbsp;should&nbsp;treat&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="4338129">//&nbsp;returned&nbsp;by&nbsp;Read&nbsp;as&nbsp;tentative&nbsp;until&nbsp;they&nbsp;receive&nbsp;the&nbsp;io.EOF</span><br>
<span class="lineno"></span><span class="comment" id="4338192">//&nbsp;marking&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="4338224">type</span>&nbsp;<span class="ident" id="4338229">Reader</span>&nbsp;<span class="keyword" id="4338236">struct</span>&nbsp;<span class="op" id="4338243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4338246">Header</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4338254">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4338267">flate</span><span class="op" id="4338272">.</span><span class="ident" id="4338273">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4338281">decompressor</span>&nbsp;<span class="ident" id="4338294">io</span><span class="op" id="4338296">.</span><span class="ident" id="4338297">ReadCloser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4338309">digest</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4338322">hash</span><span class="op" id="4338326">.</span><span class="ident" id="4338327">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4338335">size</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4338348">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4338356">flg</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4338369">byte</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4338375">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4338388">[</span><span class="num" id="4338389">512</span><span class="op" id="4338392">]</span><span class="builtintype" id="4338393">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4338399">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4338412">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4338419">multistream</span>&nbsp;&nbsp;<span class="builtintype" id="4338432">bool</span><br>
<span class="lineno"></span><span class="op" id="4338437">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="4338440">//&nbsp;NewReader&nbsp;creates&nbsp;a&nbsp;new&nbsp;Reader&nbsp;reading&nbsp;the&nbsp;given&nbsp;reader.</span><br>
<span class="lineno"></span><span class="comment" id="4338500">//&nbsp;If&nbsp;r&nbsp;does&nbsp;not&nbsp;also&nbsp;implement&nbsp;io.ByteReader,</span><br>
<span class="lineno"></span><span class="comment" id="4338547">//&nbsp;the&nbsp;decompressor&nbsp;may&nbsp;read&nbsp;more&nbsp;data&nbsp;than&nbsp;necessary&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="4338609">//&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;call&nbsp;Close&nbsp;on&nbsp;the&nbsp;Reader&nbsp;when&nbsp;done.</span><br>
<span class="lineno"></span><span class="keyword" id="4338685">func</span>&nbsp;<span class="ident" id="4338690">NewReader</span><span class="op" id="4338699">(</span><span class="ident" id="4338700">r</span>&nbsp;<span class="ident" id="4338702">io</span><span class="op" id="4338704">.</span><span class="ident" id="4338705">Reader</span><span class="op" id="4338711">)</span>&nbsp;<span class="op" id="4338713">(</span><span class="op" id="4338714">*</span><span class="ident" id="4338715">Reader</span><span class="op" id="4338721">,</span>&nbsp;<span class="builtintype" id="4338723">error</span><span class="op" id="4338728">)</span>&nbsp;<span class="op" id="4338730">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4338733">z</span>&nbsp;<span class="op" id="4338735">:=</span>&nbsp;<span class="builtinfunc" id="4338738">new</span><span class="op" id="4338741">(</span><span class="ident" id="4338742">Reader</span><span class="op" id="4338748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4338751">z</span><span class="op" id="4338752">.</span><span class="ident" id="4338753">r</span>&nbsp;<span class="op" id="4338755">=</span>&nbsp;<span class="ident" id="4338757">makeReader</span><span class="op" id="4338767">(</span><span class="ident" id="4338768">r</span><span class="op" id="4338769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4338772">z</span><span class="op" id="4338773">.</span><span class="ident" id="4338774">multistream</span>&nbsp;<span class="op" id="4338786">=</span>&nbsp;<span class="builtintype" id="4338788">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4338794">z</span><span class="op" id="4338795">.</span><span class="ident" id="4338796">digest</span>&nbsp;<span class="op" id="4338803">=</span>&nbsp;<span class="ident" id="4338805">crc32</span><span class="op" id="4338810">.</span><span class="ident" id="4338811">NewIEEE</span><span class="op" id="4338818">(</span><span class="op" id="4338819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4338822">if</span>&nbsp;<span class="ident" id="4338825">err</span>&nbsp;<span class="op" id="4338829">:=</span>&nbsp;<span class="ident" id="4338832">z</span><span class="op" id="4338833">.</span><span class="ident" id="4338834">readHeader</span><span class="op" id="4338844">(</span><span class="builtintype" id="4338845">true</span><span class="op" id="4338849">)</span><span class="op" id="4338850">;</span>&nbsp;<span class="ident" id="4338852">err</span>&nbsp;<span class="op" id="4338856">!=</span>&nbsp;<span class="ident" id="4338859">nil</span>&nbsp;<span class="op" id="4338863">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4338867">return</span>&nbsp;<span class="ident" id="4338874">nil</span><span class="op" id="4338877">,</span>&nbsp;<span class="ident" id="4338879">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4338884">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4338887">return</span>&nbsp;<span class="ident" id="4338894">z</span><span class="op" id="4338895">,</span>&nbsp;<span class="ident" id="4338897">nil</span><br>
<span class="lineno"></span><span class="op" id="4338901">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="4338904">//&nbsp;Reset&nbsp;discards&nbsp;the&nbsp;Reader&nbsp;z&#39;s&nbsp;state&nbsp;and&nbsp;makes&nbsp;it&nbsp;equivalent&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4338974">//&nbsp;result&nbsp;of&nbsp;its&nbsp;original&nbsp;state&nbsp;from&nbsp;NewReader,&nbsp;but&nbsp;reading&nbsp;from&nbsp;r&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="4339050">//&nbsp;This&nbsp;permits&nbsp;reusing&nbsp;a&nbsp;Reader&nbsp;rather&nbsp;than&nbsp;allocating&nbsp;a&nbsp;new&nbsp;one.</span><br>
<span class="lineno"></span><span class="keyword" id="4339117">func</span>&nbsp;<span class="op" id="4339122">(</span><span class="ident" id="4339123">z</span>&nbsp;<span class="op" id="4339125">*</span><span class="ident" id="4339126">Reader</span><span class="op" id="4339132">)</span>&nbsp;<span class="ident" id="4339134">Reset</span><span class="op" id="4339139">(</span><span class="ident" id="4339140">r</span>&nbsp;<span class="ident" id="4339142">io</span><span class="op" id="4339144">.</span><span class="ident" id="4339145">Reader</span><span class="op" id="4339151">)</span>&nbsp;<span class="builtintype" id="4339153">error</span>&nbsp;<span class="op" id="4339159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4339162">z</span><span class="op" id="4339163">.</span><span class="ident" id="4339164">r</span>&nbsp;<span class="op" id="4339166">=</span>&nbsp;<span class="ident" id="4339168">makeReader</span><span class="op" id="4339178">(</span><span class="ident" id="4339179">r</span><span class="op" id="4339180">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4339183">if</span>&nbsp;<span class="ident" id="4339186">z</span><span class="op" id="4339187">.</span><span class="ident" id="4339188">digest</span>&nbsp;<span class="op" id="4339195">==</span>&nbsp;<span class="ident" id="4339198">nil</span>&nbsp;<span class="op" id="4339202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4339206">z</span><span class="op" id="4339207">.</span><span class="ident" id="4339208">digest</span>&nbsp;<span class="op" id="4339215">=</span>&nbsp;<span class="ident" id="4339217">crc32</span><span class="op" id="4339222">.</span><span class="ident" id="4339223">NewIEEE</span><span class="op" id="4339230">(</span><span class="op" id="4339231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4339234">}</span>&nbsp;<span class="keyword" id="4339236">else</span>&nbsp;<span class="op" id="4339241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4339245">z</span><span class="op" id="4339246">.</span><span class="ident" id="4339247">digest</span><span class="op" id="4339253">.</span><span class="ident" id="4339254">Reset</span><span class="op" id="4339259">(</span><span class="op" id="4339260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4339263">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4339266">z</span><span class="op" id="4339267">.</span><span class="ident" id="4339268">size</span>&nbsp;<span class="op" id="4339273">=</span>&nbsp;<span class="num" id="4339275">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4339278">z</span><span class="op" id="4339279">.</span><span class="ident" id="4339280">err</span>&nbsp;<span class="op" id="4339284">=</span>&nbsp;<span class="ident" id="4339286">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4339291">z</span><span class="op" id="4339292">.</span><span class="ident" id="4339293">multistream</span>&nbsp;<span class="op" id="4339305">=</span>&nbsp;<span class="builtintype" id="4339307">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4339313">return</span>&nbsp;<span class="ident" id="4339320">z</span><span class="op" id="4339321">.</span><span class="ident" id="4339322">readHeader</span><span class="op" id="4339332">(</span><span class="builtintype" id="4339333">true</span><span class="op" id="4339337">)</span><br>
<span class="lineno"></span><span class="op" id="4339339">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="comment" id="4339342">//&nbsp;Multistream&nbsp;controls&nbsp;whether&nbsp;the&nbsp;reader&nbsp;supports&nbsp;multistream&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="4339413">//</span><br>
<span class="lineno"></span><span class="comment" id="4339416">//&nbsp;If&nbsp;enabled&nbsp;(the&nbsp;default),&nbsp;the&nbsp;Reader&nbsp;expects&nbsp;the&nbsp;input&nbsp;to&nbsp;be&nbsp;a&nbsp;sequence</span><br>
<span class="lineno"></span><span class="comment" id="4339491">//&nbsp;of&nbsp;individually&nbsp;gzipped&nbsp;data&nbsp;streams,&nbsp;each&nbsp;with&nbsp;its&nbsp;own&nbsp;header&nbsp;and</span><br>
<span class="lineno">115</span><span class="comment" id="4339561">//&nbsp;trailer,&nbsp;ending&nbsp;at&nbsp;EOF.&nbsp;The&nbsp;effect&nbsp;is&nbsp;that&nbsp;the&nbsp;concatenation&nbsp;of&nbsp;a&nbsp;sequence</span><br>
<span class="lineno"></span><span class="comment" id="4339639">//&nbsp;of&nbsp;gzipped&nbsp;files&nbsp;is&nbsp;treated&nbsp;as&nbsp;equivalent&nbsp;to&nbsp;the&nbsp;gzip&nbsp;of&nbsp;the&nbsp;concatenation</span><br>
<span class="lineno"></span><span class="comment" id="4339717">//&nbsp;of&nbsp;the&nbsp;sequence.&nbsp;This&nbsp;is&nbsp;standard&nbsp;behavior&nbsp;for&nbsp;gzip&nbsp;readers.</span><br>
<span class="lineno"></span><span class="comment" id="4339781">//</span><br>
<span class="lineno"></span><span class="comment" id="4339784">//&nbsp;Calling&nbsp;Multistream(false)&nbsp;disables&nbsp;this&nbsp;behavior;&nbsp;disabling&nbsp;the&nbsp;behavior</span><br>
<span class="lineno">120</span><span class="comment" id="4339861">//&nbsp;can&nbsp;be&nbsp;useful&nbsp;when&nbsp;reading&nbsp;file&nbsp;formats&nbsp;that&nbsp;distinguish&nbsp;individual&nbsp;gzip</span><br>
<span class="lineno"></span><span class="comment" id="4339937">//&nbsp;data&nbsp;streams&nbsp;or&nbsp;mix&nbsp;gzip&nbsp;data&nbsp;streams&nbsp;with&nbsp;other&nbsp;data&nbsp;streams.</span><br>
<span class="lineno"></span><span class="comment" id="4340003">//&nbsp;In&nbsp;this&nbsp;mode,&nbsp;when&nbsp;the&nbsp;Reader&nbsp;reaches&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;data&nbsp;stream,</span><br>
<span class="lineno"></span><span class="comment" id="4340072">//&nbsp;Read&nbsp;returns&nbsp;io.EOF.&nbsp;If&nbsp;the&nbsp;underlying&nbsp;reader&nbsp;implements&nbsp;io.ByteReader,</span><br>
<span class="lineno"></span><span class="comment" id="4340147">//&nbsp;it&nbsp;will&nbsp;be&nbsp;left&nbsp;positioned&nbsp;just&nbsp;after&nbsp;the&nbsp;gzip&nbsp;stream.</span><br>
<span class="lineno">125</span><span class="comment" id="4340205">//&nbsp;To&nbsp;start&nbsp;the&nbsp;next&nbsp;stream,&nbsp;call&nbsp;z.Reset(r)&nbsp;followed&nbsp;by&nbsp;z.Multistream(false).</span><br>
<span class="lineno"></span><span class="comment" id="4340284">//&nbsp;If&nbsp;there&nbsp;is&nbsp;no&nbsp;next&nbsp;stream,&nbsp;z.Reset(r)&nbsp;will&nbsp;return&nbsp;io.EOF.</span><br>
<span class="lineno"></span><span class="keyword" id="4340346">func</span>&nbsp;<span class="op" id="4340351">(</span><span class="ident" id="4340352">z</span>&nbsp;<span class="op" id="4340354">*</span><span class="ident" id="4340355">Reader</span><span class="op" id="4340361">)</span>&nbsp;<span class="ident" id="4340363">Multistream</span><span class="op" id="4340374">(</span><span class="ident" id="4340375">ok</span>&nbsp;<span class="builtintype" id="4340378">bool</span><span class="op" id="4340382">)</span>&nbsp;<span class="op" id="4340384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4340387">z</span><span class="op" id="4340388">.</span><span class="ident" id="4340389">multistream</span>&nbsp;<span class="op" id="4340401">=</span>&nbsp;<span class="ident" id="4340403">ok</span><br>
<span class="lineno"></span><span class="op" id="4340406">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="4340409">//&nbsp;GZIP&nbsp;(RFC&nbsp;1952)&nbsp;is&nbsp;little-endian,&nbsp;unlike&nbsp;ZLIB&nbsp;(RFC&nbsp;1950).</span><br>
<span class="lineno"></span><span class="keyword" id="4340470">func</span>&nbsp;<span class="ident" id="4340475">get4</span><span class="op" id="4340479">(</span><span class="ident" id="4340480">p</span>&nbsp;<span class="op" id="4340482">[</span><span class="op" id="4340483">]</span><span class="builtintype" id="4340484">byte</span><span class="op" id="4340488">)</span>&nbsp;<span class="builtintype" id="4340490">uint32</span>&nbsp;<span class="op" id="4340497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4340500">return</span>&nbsp;<span class="builtintype" id="4340507">uint32</span><span class="op" id="4340513">(</span><span class="ident" id="4340514">p</span><span class="op" id="4340515">[</span><span class="num" id="4340516">0</span><span class="op" id="4340517">]</span><span class="op" id="4340518">)</span>&nbsp;<span class="op" id="4340520">|</span>&nbsp;<span class="builtintype" id="4340522">uint32</span><span class="op" id="4340528">(</span><span class="ident" id="4340529">p</span><span class="op" id="4340530">[</span><span class="num" id="4340531">1</span><span class="op" id="4340532">]</span><span class="op" id="4340533">)</span><span class="op" id="4340534">&lt;&lt;</span><span class="num" id="4340536">8</span>&nbsp;<span class="op" id="4340538">|</span>&nbsp;<span class="builtintype" id="4340540">uint32</span><span class="op" id="4340546">(</span><span class="ident" id="4340547">p</span><span class="op" id="4340548">[</span><span class="num" id="4340549">2</span><span class="op" id="4340550">]</span><span class="op" id="4340551">)</span><span class="op" id="4340552">&lt;&lt;</span><span class="num" id="4340554">16</span>&nbsp;<span class="op" id="4340557">|</span>&nbsp;<span class="builtintype" id="4340559">uint32</span><span class="op" id="4340565">(</span><span class="ident" id="4340566">p</span><span class="op" id="4340567">[</span><span class="num" id="4340568">3</span><span class="op" id="4340569">]</span><span class="op" id="4340570">)</span><span class="op" id="4340571">&lt;&lt;</span><span class="num" id="4340573">24</span><br>
<span class="lineno"></span><span class="op" id="4340576">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="keyword" id="4340579">func</span>&nbsp;<span class="op" id="4340584">(</span><span class="ident" id="4340585">z</span>&nbsp;<span class="op" id="4340587">*</span><span class="ident" id="4340588">Reader</span><span class="op" id="4340594">)</span>&nbsp;<span class="ident" id="4340596">readString</span><span class="op" id="4340606">(</span><span class="op" id="4340607">)</span>&nbsp;<span class="op" id="4340609">(</span><span class="builtintype" id="4340610">string</span><span class="op" id="4340616">,</span>&nbsp;<span class="builtintype" id="4340618">error</span><span class="op" id="4340623">)</span>&nbsp;<span class="op" id="4340625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4340628">var</span>&nbsp;<span class="ident" id="4340632">err</span>&nbsp;<span class="builtintype" id="4340636">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4340643">needconv</span>&nbsp;<span class="op" id="4340652">:=</span>&nbsp;<span class="builtintype" id="4340655">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4340662">for</span>&nbsp;<span class="ident" id="4340666">i</span>&nbsp;<span class="op" id="4340668">:=</span>&nbsp;<span class="num" id="4340671">0</span><span class="op" id="4340672">;</span>&nbsp;<span class="op" id="4340674">;</span>&nbsp;<span class="ident" id="4340676">i</span><span class="op" id="4340677">++</span>&nbsp;<span class="op" id="4340680">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4340684">if</span>&nbsp;<span class="ident" id="4340687">i</span>&nbsp;<span class="op" id="4340689">&gt;=</span>&nbsp;<span class="builtinfunc" id="4340692">len</span><span class="op" id="4340695">(</span><span class="ident" id="4340696">z</span><span class="op" id="4340697">.</span><span class="ident" id="4340698">buf</span><span class="op" id="4340701">)</span>&nbsp;<span class="op" id="4340703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4340708">return</span>&nbsp;<span class="string" id="4340715">&#34;&#34;</span><span class="op" id="4340717">,</span>&nbsp;<span class="ident" id="4340719">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4340731">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4340735">z</span><span class="op" id="4340736">.</span><span class="ident" id="4340737">buf</span><span class="op" id="4340740">[</span><span class="ident" id="4340741">i</span><span class="op" id="4340742">]</span><span class="op" id="4340743">,</span>&nbsp;<span class="ident" id="4340745">err</span>&nbsp;<span class="op" id="4340749">=</span>&nbsp;<span class="ident" id="4340751">z</span><span class="op" id="4340752">.</span><span class="ident" id="4340753">r</span><span class="op" id="4340754">.</span><span class="ident" id="4340755">ReadByte</span><span class="op" id="4340763">(</span><span class="op" id="4340764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4340768">if</span>&nbsp;<span class="ident" id="4340771">err</span>&nbsp;<span class="op" id="4340775">!=</span>&nbsp;<span class="ident" id="4340778">nil</span>&nbsp;<span class="op" id="4340782">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4340787">return</span>&nbsp;<span class="string" id="4340794">&#34;&#34;</span><span class="op" id="4340796">,</span>&nbsp;<span class="ident" id="4340798">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4340804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4340808">if</span>&nbsp;<span class="ident" id="4340811">z</span><span class="op" id="4340812">.</span><span class="ident" id="4340813">buf</span><span class="op" id="4340816">[</span><span class="ident" id="4340817">i</span><span class="op" id="4340818">]</span>&nbsp;<span class="op" id="4340820">&gt;</span>&nbsp;<span class="num" id="4340822">0x7f</span>&nbsp;<span class="op" id="4340827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4340832">needconv</span>&nbsp;<span class="op" id="4340841">=</span>&nbsp;<span class="builtintype" id="4340843">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4340850">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4340854">if</span>&nbsp;<span class="ident" id="4340857">z</span><span class="op" id="4340858">.</span><span class="ident" id="4340859">buf</span><span class="op" id="4340862">[</span><span class="ident" id="4340863">i</span><span class="op" id="4340864">]</span>&nbsp;<span class="op" id="4340866">==</span>&nbsp;<span class="num" id="4340869">0</span>&nbsp;<span class="op" id="4340871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4340876">//&nbsp;GZIP&nbsp;(RFC&nbsp;1952)&nbsp;specifies&nbsp;that&nbsp;strings&nbsp;are&nbsp;NUL-terminated&nbsp;ISO&nbsp;8859-1&nbsp;(Latin-1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4340962">if</span>&nbsp;<span class="ident" id="4340965">needconv</span>&nbsp;<span class="op" id="4340974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4340980">s</span>&nbsp;<span class="op" id="4340982">:=</span>&nbsp;<span class="builtinfunc" id="4340985">make</span><span class="op" id="4340989">(</span><span class="op" id="4340990">[</span><span class="op" id="4340991">]</span><span class="builtintype" id="4340992">rune</span><span class="op" id="4340996">,</span>&nbsp;<span class="num" id="4340998">0</span><span class="op" id="4340999">,</span>&nbsp;<span class="ident" id="4341001">i</span><span class="op" id="4341002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4341008">for</span>&nbsp;<span class="ident" id="4341012">_</span><span class="op" id="4341013">,</span>&nbsp;<span class="ident" id="4341015">v</span>&nbsp;<span class="op" id="4341017">:=</span>&nbsp;<span class="keyword" id="4341020">range</span>&nbsp;<span class="ident" id="4341026">z</span><span class="op" id="4341027">.</span><span class="ident" id="4341028">buf</span><span class="op" id="4341031">[</span><span class="num" id="4341032">0</span><span class="op" id="4341033">:</span><span class="ident" id="4341034">i</span><span class="op" id="4341035">]</span>&nbsp;<span class="op" id="4341037">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4341044">s</span>&nbsp;<span class="op" id="4341046">=</span>&nbsp;<span class="builtinfunc" id="4341048">append</span><span class="op" id="4341054">(</span><span class="ident" id="4341055">s</span><span class="op" id="4341056">,</span>&nbsp;<span class="builtintype" id="4341058">rune</span><span class="op" id="4341062">(</span><span class="ident" id="4341063">v</span><span class="op" id="4341064">)</span><span class="op" id="4341065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4341071">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4341077">return</span>&nbsp;<span class="builtintype" id="4341084">string</span><span class="op" id="4341090">(</span><span class="ident" id="4341091">s</span><span class="op" id="4341092">)</span><span class="op" id="4341093">,</span>&nbsp;<span class="ident" id="4341095">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4341102">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4341107">return</span>&nbsp;<span class="builtintype" id="4341114">string</span><span class="op" id="4341120">(</span><span class="ident" id="4341121">z</span><span class="op" id="4341122">.</span><span class="ident" id="4341123">buf</span><span class="op" id="4341126">[</span><span class="num" id="4341127">0</span><span class="op" id="4341128">:</span><span class="ident" id="4341129">i</span><span class="op" id="4341130">]</span><span class="op" id="4341131">)</span><span class="op" id="4341132">,</span>&nbsp;<span class="ident" id="4341134">nil</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4341140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4341143">}</span><br>
<span class="lineno"></span><span class="op" id="4341145">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4341148">func</span>&nbsp;<span class="op" id="4341153">(</span><span class="ident" id="4341154">z</span>&nbsp;<span class="op" id="4341156">*</span><span class="ident" id="4341157">Reader</span><span class="op" id="4341163">)</span>&nbsp;<span class="ident" id="4341165">read2</span><span class="op" id="4341170">(</span><span class="op" id="4341171">)</span>&nbsp;<span class="op" id="4341173">(</span><span class="builtintype" id="4341174">uint32</span><span class="op" id="4341180">,</span>&nbsp;<span class="builtintype" id="4341182">error</span><span class="op" id="4341187">)</span>&nbsp;<span class="op" id="4341189">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4341192">_</span><span class="op" id="4341193">,</span>&nbsp;<span class="ident" id="4341195">err</span>&nbsp;<span class="op" id="4341199">:=</span>&nbsp;<span class="ident" id="4341202">io</span><span class="op" id="4341204">.</span><span class="ident" id="4341205">ReadFull</span><span class="op" id="4341213">(</span><span class="ident" id="4341214">z</span><span class="op" id="4341215">.</span><span class="ident" id="4341216">r</span><span class="op" id="4341217">,</span>&nbsp;<span class="ident" id="4341219">z</span><span class="op" id="4341220">.</span><span class="ident" id="4341221">buf</span><span class="op" id="4341224">[</span><span class="num" id="4341225">0</span><span class="op" id="4341226">:</span><span class="num" id="4341227">2</span><span class="op" id="4341228">]</span><span class="op" id="4341229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4341232">if</span>&nbsp;<span class="ident" id="4341235">err</span>&nbsp;<span class="op" id="4341239">!=</span>&nbsp;<span class="ident" id="4341242">nil</span>&nbsp;<span class="op" id="4341246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4341250">return</span>&nbsp;<span class="num" id="4341257">0</span><span class="op" id="4341258">,</span>&nbsp;<span class="ident" id="4341260">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4341265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4341268">return</span>&nbsp;<span class="builtintype" id="4341275">uint32</span><span class="op" id="4341281">(</span><span class="ident" id="4341282">z</span><span class="op" id="4341283">.</span><span class="ident" id="4341284">buf</span><span class="op" id="4341287">[</span><span class="num" id="4341288">0</span><span class="op" id="4341289">]</span><span class="op" id="4341290">)</span>&nbsp;<span class="op" id="4341292">|</span>&nbsp;<span class="builtintype" id="4341294">uint32</span><span class="op" id="4341300">(</span><span class="ident" id="4341301">z</span><span class="op" id="4341302">.</span><span class="ident" id="4341303">buf</span><span class="op" id="4341306">[</span><span class="num" id="4341307">1</span><span class="op" id="4341308">]</span><span class="op" id="4341309">)</span><span class="op" id="4341310">&lt;&lt;</span><span class="num" id="4341312">8</span><span class="op" id="4341313">,</span>&nbsp;<span class="ident" id="4341315">nil</span><br>
<span class="lineno">170</span><span class="op" id="4341319">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4341322">func</span>&nbsp;<span class="op" id="4341327">(</span><span class="ident" id="4341328">z</span>&nbsp;<span class="op" id="4341330">*</span><span class="ident" id="4341331">Reader</span><span class="op" id="4341337">)</span>&nbsp;<span class="ident" id="4341339">readHeader</span><span class="op" id="4341349">(</span><span class="ident" id="4341350">save</span>&nbsp;<span class="builtintype" id="4341355">bool</span><span class="op" id="4341359">)</span>&nbsp;<span class="builtintype" id="4341361">error</span>&nbsp;<span class="op" id="4341367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4341370">_</span><span class="op" id="4341371">,</span>&nbsp;<span class="ident" id="4341373">err</span>&nbsp;<span class="op" id="4341377">:=</span>&nbsp;<span class="ident" id="4341380">io</span><span class="op" id="4341382">.</span><span class="ident" id="4341383">ReadFull</span><span class="op" id="4341391">(</span><span class="ident" id="4341392">z</span><span class="op" id="4341393">.</span><span class="ident" id="4341394">r</span><span class="op" id="4341395">,</span>&nbsp;<span class="ident" id="4341397">z</span><span class="op" id="4341398">.</span><span class="ident" id="4341399">buf</span><span class="op" id="4341402">[</span><span class="num" id="4341403">0</span><span class="op" id="4341404">:</span><span class="num" id="4341405">10</span><span class="op" id="4341407">]</span><span class="op" id="4341408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4341411">if</span>&nbsp;<span class="ident" id="4341414">err</span>&nbsp;<span class="op" id="4341418">!=</span>&nbsp;<span class="ident" id="4341421">nil</span>&nbsp;<span class="op" id="4341425">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4341429">return</span>&nbsp;<span class="ident" id="4341436">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4341441">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4341444">if</span>&nbsp;<span class="ident" id="4341447">z</span><span class="op" id="4341448">.</span><span class="ident" id="4341449">buf</span><span class="op" id="4341452">[</span><span class="num" id="4341453">0</span><span class="op" id="4341454">]</span>&nbsp;<span class="op" id="4341456">!=</span>&nbsp;<span class="ident" id="4341459">gzipID1</span>&nbsp;<span class="op" id="4341467">||</span>&nbsp;<span class="ident" id="4341470">z</span><span class="op" id="4341471">.</span><span class="ident" id="4341472">buf</span><span class="op" id="4341475">[</span><span class="num" id="4341476">1</span><span class="op" id="4341477">]</span>&nbsp;<span class="op" id="4341479">!=</span>&nbsp;<span class="ident" id="4341482">gzipID2</span>&nbsp;<span class="op" id="4341490">||</span>&nbsp;<span class="ident" id="4341493">z</span><span class="op" id="4341494">.</span><span class="ident" id="4341495">buf</span><span class="op" id="4341498">[</span><span class="num" id="4341499">2</span><span class="op" id="4341500">]</span>&nbsp;<span class="op" id="4341502">!=</span>&nbsp;<span class="ident" id="4341505">gzipDeflate</span>&nbsp;<span class="op" id="4341517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4341521">return</span>&nbsp;<span class="ident" id="4341528">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4341539">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4341542">z</span><span class="op" id="4341543">.</span><span class="ident" id="4341544">flg</span>&nbsp;<span class="op" id="4341548">=</span>&nbsp;<span class="ident" id="4341550">z</span><span class="op" id="4341551">.</span><span class="ident" id="4341552">buf</span><span class="op" id="4341555">[</span><span class="num" id="4341556">3</span><span class="op" id="4341557">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4341560">if</span>&nbsp;<span class="ident" id="4341563">save</span>&nbsp;<span class="op" id="4341568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4341572">z</span><span class="op" id="4341573">.</span><span class="ident" id="4341574">ModTime</span>&nbsp;<span class="op" id="4341582">=</span>&nbsp;<span class="ident" id="4341584">time</span><span class="op" id="4341588">.</span><span class="ident" id="4341589">Unix</span><span class="op" id="4341593">(</span><span class="ident" id="4341594">int64</span><span class="op" id="4341599">(</span><span class="ident" id="4341600">get4</span><span class="op" id="4341604">(</span><span class="ident" id="4341605">z</span><span class="op" id="4341606">.</span><span class="ident" id="4341607">buf</span><span class="op" id="4341610">[</span><span class="num" id="4341611">4</span><span class="op" id="4341612">:</span><span class="num" id="4341613">8</span><span class="op" id="4341614">]</span><span class="op" id="4341615">)</span><span class="op" id="4341616">)</span><span class="op" id="4341617">,</span>&nbsp;<span class="num" id="4341619">0</span><span class="op" id="4341620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4341624">//&nbsp;z.buf[8]&nbsp;is&nbsp;xfl,&nbsp;ignored</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4341654">z</span><span class="op" id="4341655">.</span><span class="ident" id="4341656">OS</span>&nbsp;<span class="op" id="4341659">=</span>&nbsp;<span class="ident" id="4341661">z</span><span class="op" id="4341662">.</span><span class="ident" id="4341663">buf</span><span class="op" id="4341666">[</span><span class="num" id="4341667">9</span><span class="op" id="4341668">]</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4341671">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4341674">z</span><span class="op" id="4341675">.</span><span class="ident" id="4341676">digest</span><span class="op" id="4341682">.</span><span class="ident" id="4341683">Reset</span><span class="op" id="4341688">(</span><span class="op" id="4341689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4341692">z</span><span class="op" id="4341693">.</span><span class="ident" id="4341694">digest</span><span class="op" id="4341700">.</span><span class="ident" id="4341701">Write</span><span class="op" id="4341706">(</span><span class="ident" id="4341707">z</span><span class="op" id="4341708">.</span><span class="ident" id="4341709">buf</span><span class="op" id="4341712">[</span><span class="num" id="4341713">0</span><span class="op" id="4341714">:</span><span class="num" id="4341715">10</span><span class="op" id="4341717">]</span><span class="op" id="4341718">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4341722">if</span>&nbsp;<span class="ident" id="4341725">z</span><span class="op" id="4341726">.</span><span class="ident" id="4341727">flg</span><span class="op" id="4341730">&amp;</span><span class="ident" id="4341731">flagExtra</span>&nbsp;<span class="op" id="4341741">!=</span>&nbsp;<span class="num" id="4341744">0</span>&nbsp;<span class="op" id="4341746">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4341750">n</span><span class="op" id="4341751">,</span>&nbsp;<span class="ident" id="4341753">err</span>&nbsp;<span class="op" id="4341757">:=</span>&nbsp;<span class="ident" id="4341760">z</span><span class="op" id="4341761">.</span><span class="ident" id="4341762">read2</span><span class="op" id="4341767">(</span><span class="op" id="4341768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4341772">if</span>&nbsp;<span class="ident" id="4341775">err</span>&nbsp;<span class="op" id="4341779">!=</span>&nbsp;<span class="ident" id="4341782">nil</span>&nbsp;<span class="op" id="4341786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4341791">return</span>&nbsp;<span class="ident" id="4341798">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4341804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4341808">data</span>&nbsp;<span class="op" id="4341813">:=</span>&nbsp;<span class="builtinfunc" id="4341816">make</span><span class="op" id="4341820">(</span><span class="op" id="4341821">[</span><span class="op" id="4341822">]</span><span class="builtintype" id="4341823">byte</span><span class="op" id="4341827">,</span>&nbsp;<span class="ident" id="4341829">n</span><span class="op" id="4341830">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4341834">if</span>&nbsp;<span class="ident" id="4341837">_</span><span class="op" id="4341838">,</span>&nbsp;<span class="ident" id="4341840">err</span>&nbsp;<span class="op" id="4341844">=</span>&nbsp;<span class="ident" id="4341846">io</span><span class="op" id="4341848">.</span><span class="ident" id="4341849">ReadFull</span><span class="op" id="4341857">(</span><span class="ident" id="4341858">z</span><span class="op" id="4341859">.</span><span class="ident" id="4341860">r</span><span class="op" id="4341861">,</span>&nbsp;<span class="ident" id="4341863">data</span><span class="op" id="4341867">)</span><span class="op" id="4341868">;</span>&nbsp;<span class="ident" id="4341870">err</span>&nbsp;<span class="op" id="4341874">!=</span>&nbsp;<span class="ident" id="4341877">nil</span>&nbsp;<span class="op" id="4341881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4341886">return</span>&nbsp;<span class="ident" id="4341893">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4341899">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4341903">if</span>&nbsp;<span class="ident" id="4341906">save</span>&nbsp;<span class="op" id="4341911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4341916">z</span><span class="op" id="4341917">.</span><span class="ident" id="4341918">Extra</span>&nbsp;<span class="op" id="4341924">=</span>&nbsp;<span class="ident" id="4341926">data</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4341933">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4341936">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4341940">var</span>&nbsp;<span class="ident" id="4341944">s</span>&nbsp;<span class="builtintype" id="4341946">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4341954">if</span>&nbsp;<span class="ident" id="4341957">z</span><span class="op" id="4341958">.</span><span class="ident" id="4341959">flg</span><span class="op" id="4341962">&amp;</span><span class="ident" id="4341963">flagName</span>&nbsp;<span class="op" id="4341972">!=</span>&nbsp;<span class="num" id="4341975">0</span>&nbsp;<span class="op" id="4341977">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4341981">if</span>&nbsp;<span class="ident" id="4341984">s</span><span class="op" id="4341985">,</span>&nbsp;<span class="ident" id="4341987">err</span>&nbsp;<span class="op" id="4341991">=</span>&nbsp;<span class="ident" id="4341993">z</span><span class="op" id="4341994">.</span><span class="ident" id="4341995">readString</span><span class="op" id="4342005">(</span><span class="op" id="4342006">)</span><span class="op" id="4342007">;</span>&nbsp;<span class="ident" id="4342009">err</span>&nbsp;<span class="op" id="4342013">!=</span>&nbsp;<span class="ident" id="4342016">nil</span>&nbsp;<span class="op" id="4342020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4342025">return</span>&nbsp;<span class="ident" id="4342032">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4342038">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4342042">if</span>&nbsp;<span class="ident" id="4342045">save</span>&nbsp;<span class="op" id="4342050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4342055">z</span><span class="op" id="4342056">.</span><span class="ident" id="4342057">Name</span>&nbsp;<span class="op" id="4342062">=</span>&nbsp;<span class="ident" id="4342064">s</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4342068">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4342071">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4342075">if</span>&nbsp;<span class="ident" id="4342078">z</span><span class="op" id="4342079">.</span><span class="ident" id="4342080">flg</span><span class="op" id="4342083">&amp;</span><span class="ident" id="4342084">flagComment</span>&nbsp;<span class="op" id="4342096">!=</span>&nbsp;<span class="num" id="4342099">0</span>&nbsp;<span class="op" id="4342101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4342105">if</span>&nbsp;<span class="ident" id="4342108">s</span><span class="op" id="4342109">,</span>&nbsp;<span class="ident" id="4342111">err</span>&nbsp;<span class="op" id="4342115">=</span>&nbsp;<span class="ident" id="4342117">z</span><span class="op" id="4342118">.</span><span class="ident" id="4342119">readString</span><span class="op" id="4342129">(</span><span class="op" id="4342130">)</span><span class="op" id="4342131">;</span>&nbsp;<span class="ident" id="4342133">err</span>&nbsp;<span class="op" id="4342137">!=</span>&nbsp;<span class="ident" id="4342140">nil</span>&nbsp;<span class="op" id="4342144">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4342149">return</span>&nbsp;<span class="ident" id="4342156">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4342162">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4342166">if</span>&nbsp;<span class="ident" id="4342169">save</span>&nbsp;<span class="op" id="4342174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4342179">z</span><span class="op" id="4342180">.</span><span class="ident" id="4342181">Comment</span>&nbsp;<span class="op" id="4342189">=</span>&nbsp;<span class="ident" id="4342191">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4342195">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4342198">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4342202">if</span>&nbsp;<span class="ident" id="4342205">z</span><span class="op" id="4342206">.</span><span class="ident" id="4342207">flg</span><span class="op" id="4342210">&amp;</span><span class="ident" id="4342211">flagHdrCrc</span>&nbsp;<span class="op" id="4342222">!=</span>&nbsp;<span class="num" id="4342225">0</span>&nbsp;<span class="op" id="4342227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4342231">n</span><span class="op" id="4342232">,</span>&nbsp;<span class="ident" id="4342234">err</span>&nbsp;<span class="op" id="4342238">:=</span>&nbsp;<span class="ident" id="4342241">z</span><span class="op" id="4342242">.</span><span class="ident" id="4342243">read2</span><span class="op" id="4342248">(</span><span class="op" id="4342249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4342253">if</span>&nbsp;<span class="ident" id="4342256">err</span>&nbsp;<span class="op" id="4342260">!=</span>&nbsp;<span class="ident" id="4342263">nil</span>&nbsp;<span class="op" id="4342267">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4342272">return</span>&nbsp;<span class="ident" id="4342279">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4342285">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4342289">sum</span>&nbsp;<span class="op" id="4342293">:=</span>&nbsp;<span class="ident" id="4342296">z</span><span class="op" id="4342297">.</span><span class="ident" id="4342298">digest</span><span class="op" id="4342304">.</span><span class="ident" id="4342305">Sum32</span><span class="op" id="4342310">(</span><span class="op" id="4342311">)</span>&nbsp;<span class="op" id="4342313">&amp;</span>&nbsp;<span class="num" id="4342315">0xFFFF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4342324">if</span>&nbsp;<span class="ident" id="4342327">n</span>&nbsp;<span class="op" id="4342329">!=</span>&nbsp;<span class="ident" id="4342332">sum</span>&nbsp;<span class="op" id="4342336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4342341">return</span>&nbsp;<span class="ident" id="4342348">ErrHeader</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4342360">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4342363">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4342367">z</span><span class="op" id="4342368">.</span><span class="ident" id="4342369">digest</span><span class="op" id="4342375">.</span><span class="ident" id="4342376">Reset</span><span class="op" id="4342381">(</span><span class="op" id="4342382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4342385">if</span>&nbsp;<span class="ident" id="4342388">z</span><span class="op" id="4342389">.</span><span class="ident" id="4342390">decompressor</span>&nbsp;<span class="op" id="4342403">==</span>&nbsp;<span class="ident" id="4342406">nil</span>&nbsp;<span class="op" id="4342410">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4342414">z</span><span class="op" id="4342415">.</span><span class="ident" id="4342416">decompressor</span>&nbsp;<span class="op" id="4342429">=</span>&nbsp;<span class="ident" id="4342431">flate</span><span class="op" id="4342436">.</span><span class="ident" id="4342437">NewReader</span><span class="op" id="4342446">(</span><span class="ident" id="4342447">z</span><span class="op" id="4342448">.</span><span class="ident" id="4342449">r</span><span class="op" id="4342450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4342453">}</span>&nbsp;<span class="keyword" id="4342455">else</span>&nbsp;<span class="op" id="4342460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4342464">z</span><span class="op" id="4342465">.</span><span class="ident" id="4342466">decompressor</span><span class="op" id="4342478">.</span><span class="op" id="4342479">(</span><span class="ident" id="4342480">flate</span><span class="op" id="4342485">.</span><span class="ident" id="4342486">Resetter</span><span class="op" id="4342494">)</span><span class="op" id="4342495">.</span><span class="ident" id="4342496">Reset</span><span class="op" id="4342501">(</span><span class="ident" id="4342502">z</span><span class="op" id="4342503">.</span><span class="ident" id="4342504">r</span><span class="op" id="4342505">,</span>&nbsp;<span class="ident" id="4342507">nil</span><span class="op" id="4342510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4342513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4342516">return</span>&nbsp;<span class="ident" id="4342523">nil</span><br>
<span class="lineno">240</span><span class="op" id="4342527">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4342530">func</span>&nbsp;<span class="op" id="4342535">(</span><span class="ident" id="4342536">z</span>&nbsp;<span class="op" id="4342538">*</span><span class="ident" id="4342539">Reader</span><span class="op" id="4342545">)</span>&nbsp;<span class="ident" id="4342547">Read</span><span class="op" id="4342551">(</span><span class="ident" id="4342552">p</span>&nbsp;<span class="op" id="4342554">[</span><span class="op" id="4342555">]</span><span class="builtintype" id="4342556">byte</span><span class="op" id="4342560">)</span>&nbsp;<span class="op" id="4342562">(</span><span class="ident" id="4342563">n</span>&nbsp;<span class="builtintype" id="4342565">int</span><span class="op" id="4342568">,</span>&nbsp;<span class="ident" id="4342570">err</span>&nbsp;<span class="builtintype" id="4342574">error</span><span class="op" id="4342579">)</span>&nbsp;<span class="op" id="4342581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4342584">if</span>&nbsp;<span class="ident" id="4342587">z</span><span class="op" id="4342588">.</span><span class="ident" id="4342589">err</span>&nbsp;<span class="op" id="4342593">!=</span>&nbsp;<span class="ident" id="4342596">nil</span>&nbsp;<span class="op" id="4342600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4342604">return</span>&nbsp;<span class="num" id="4342611">0</span><span class="op" id="4342612">,</span>&nbsp;<span class="ident" id="4342614">z</span><span class="op" id="4342615">.</span><span class="ident" id="4342616">err</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4342621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4342624">if</span>&nbsp;<span class="builtinfunc" id="4342627">len</span><span class="op" id="4342630">(</span><span class="ident" id="4342631">p</span><span class="op" id="4342632">)</span>&nbsp;<span class="op" id="4342634">==</span>&nbsp;<span class="num" id="4342637">0</span>&nbsp;<span class="op" id="4342639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4342643">return</span>&nbsp;<span class="num" id="4342650">0</span><span class="op" id="4342651">,</span>&nbsp;<span class="ident" id="4342653">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4342658">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4342662">n</span><span class="op" id="4342663">,</span>&nbsp;<span class="ident" id="4342665">err</span>&nbsp;<span class="op" id="4342669">=</span>&nbsp;<span class="ident" id="4342671">z</span><span class="op" id="4342672">.</span><span class="ident" id="4342673">decompressor</span><span class="op" id="4342685">.</span><span class="ident" id="4342686">Read</span><span class="op" id="4342690">(</span><span class="ident" id="4342691">p</span><span class="op" id="4342692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4342695">z</span><span class="op" id="4342696">.</span><span class="ident" id="4342697">digest</span><span class="op" id="4342703">.</span><span class="ident" id="4342704">Write</span><span class="op" id="4342709">(</span><span class="ident" id="4342710">p</span><span class="op" id="4342711">[</span><span class="num" id="4342712">0</span><span class="op" id="4342713">:</span><span class="ident" id="4342714">n</span><span class="op" id="4342715">]</span><span class="op" id="4342716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4342719">z</span><span class="op" id="4342720">.</span><span class="ident" id="4342721">size</span>&nbsp;<span class="op" id="4342726">+=</span>&nbsp;<span class="builtintype" id="4342729">uint32</span><span class="op" id="4342735">(</span><span class="ident" id="4342736">n</span><span class="op" id="4342737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4342740">if</span>&nbsp;<span class="ident" id="4342743">n</span>&nbsp;<span class="op" id="4342745">!=</span>&nbsp;<span class="num" id="4342748">0</span>&nbsp;<span class="op" id="4342750">||</span>&nbsp;<span class="ident" id="4342753">err</span>&nbsp;<span class="op" id="4342757">!=</span>&nbsp;<span class="ident" id="4342760">io</span><span class="op" id="4342762">.</span><span class="ident" id="4342763">EOF</span>&nbsp;<span class="op" id="4342767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4342771">z</span><span class="op" id="4342772">.</span><span class="ident" id="4342773">err</span>&nbsp;<span class="op" id="4342777">=</span>&nbsp;<span class="ident" id="4342779">err</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4342785">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4342793">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4342797">//&nbsp;Finished&nbsp;file;&nbsp;check&nbsp;checksum&nbsp;+&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4342839">if</span>&nbsp;<span class="ident" id="4342842">_</span><span class="op" id="4342843">,</span>&nbsp;<span class="ident" id="4342845">err</span>&nbsp;<span class="op" id="4342849">:=</span>&nbsp;<span class="ident" id="4342852">io</span><span class="op" id="4342854">.</span><span class="ident" id="4342855">ReadFull</span><span class="op" id="4342863">(</span><span class="ident" id="4342864">z</span><span class="op" id="4342865">.</span><span class="ident" id="4342866">r</span><span class="op" id="4342867">,</span>&nbsp;<span class="ident" id="4342869">z</span><span class="op" id="4342870">.</span><span class="ident" id="4342871">buf</span><span class="op" id="4342874">[</span><span class="num" id="4342875">0</span><span class="op" id="4342876">:</span><span class="num" id="4342877">8</span><span class="op" id="4342878">]</span><span class="op" id="4342879">)</span><span class="op" id="4342880">;</span>&nbsp;<span class="ident" id="4342882">err</span>&nbsp;<span class="op" id="4342886">!=</span>&nbsp;<span class="ident" id="4342889">nil</span>&nbsp;<span class="op" id="4342893">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4342897">z</span><span class="op" id="4342898">.</span><span class="ident" id="4342899">err</span>&nbsp;<span class="op" id="4342903">=</span>&nbsp;<span class="ident" id="4342905">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4342911">return</span>&nbsp;<span class="num" id="4342918">0</span><span class="op" id="4342919">,</span>&nbsp;<span class="ident" id="4342921">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4342926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4342929">crc32</span><span class="op" id="4342934">,</span>&nbsp;<span class="ident" id="4342936">isize</span>&nbsp;<span class="op" id="4342942">:=</span>&nbsp;<span class="ident" id="4342945">get4</span><span class="op" id="4342949">(</span><span class="ident" id="4342950">z</span><span class="op" id="4342951">.</span><span class="ident" id="4342952">buf</span><span class="op" id="4342955">[</span><span class="num" id="4342956">0</span><span class="op" id="4342957">:</span><span class="num" id="4342958">4</span><span class="op" id="4342959">]</span><span class="op" id="4342960">)</span><span class="op" id="4342961">,</span>&nbsp;<span class="ident" id="4342963">get4</span><span class="op" id="4342967">(</span><span class="ident" id="4342968">z</span><span class="op" id="4342969">.</span><span class="ident" id="4342970">buf</span><span class="op" id="4342973">[</span><span class="num" id="4342974">4</span><span class="op" id="4342975">:</span><span class="num" id="4342976">8</span><span class="op" id="4342977">]</span><span class="op" id="4342978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4342981">sum</span>&nbsp;<span class="op" id="4342985">:=</span>&nbsp;<span class="ident" id="4342988">z</span><span class="op" id="4342989">.</span><span class="ident" id="4342990">digest</span><span class="op" id="4342996">.</span><span class="ident" id="4342997">Sum32</span><span class="op" id="4343002">(</span><span class="op" id="4343003">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4343006">if</span>&nbsp;<span class="ident" id="4343009">sum</span>&nbsp;<span class="op" id="4343013">!=</span>&nbsp;<span class="ident" id="4343016">crc32</span>&nbsp;<span class="op" id="4343022">||</span>&nbsp;<span class="ident" id="4343025">isize</span>&nbsp;<span class="op" id="4343031">!=</span>&nbsp;<span class="ident" id="4343034">z</span><span class="op" id="4343035">.</span><span class="ident" id="4343036">size</span>&nbsp;<span class="op" id="4343041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4343045">z</span><span class="op" id="4343046">.</span><span class="ident" id="4343047">err</span>&nbsp;<span class="op" id="4343051">=</span>&nbsp;<span class="ident" id="4343053">ErrChecksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4343067">return</span>&nbsp;<span class="num" id="4343074">0</span><span class="op" id="4343075">,</span>&nbsp;<span class="ident" id="4343077">z</span><span class="op" id="4343078">.</span><span class="ident" id="4343079">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4343084">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4343088">//&nbsp;File&nbsp;is&nbsp;ok;&nbsp;is&nbsp;there&nbsp;another?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4343122">if</span>&nbsp;<span class="op" id="4343125">!</span><span class="ident" id="4343126">z</span><span class="op" id="4343127">.</span><span class="ident" id="4343128">multistream</span>&nbsp;<span class="op" id="4343140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4343144">return</span>&nbsp;<span class="num" id="4343151">0</span><span class="op" id="4343152">,</span>&nbsp;<span class="ident" id="4343154">io</span><span class="op" id="4343156">.</span><span class="ident" id="4343157">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4343162">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4343166">if</span>&nbsp;<span class="ident" id="4343169">err</span>&nbsp;<span class="op" id="4343173">=</span>&nbsp;<span class="ident" id="4343175">z</span><span class="op" id="4343176">.</span><span class="ident" id="4343177">readHeader</span><span class="op" id="4343187">(</span><span class="builtintype" id="4343188">false</span><span class="op" id="4343193">)</span><span class="op" id="4343194">;</span>&nbsp;<span class="ident" id="4343196">err</span>&nbsp;<span class="op" id="4343200">!=</span>&nbsp;<span class="ident" id="4343203">nil</span>&nbsp;<span class="op" id="4343207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4343211">z</span><span class="op" id="4343212">.</span><span class="ident" id="4343213">err</span>&nbsp;<span class="op" id="4343217">=</span>&nbsp;<span class="ident" id="4343219">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4343225">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4343233">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4343237">//&nbsp;Yes.&nbsp;&nbsp;Reset&nbsp;and&nbsp;read&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4343271">z</span><span class="op" id="4343272">.</span><span class="ident" id="4343273">digest</span><span class="op" id="4343279">.</span><span class="ident" id="4343280">Reset</span><span class="op" id="4343285">(</span><span class="op" id="4343286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4343289">z</span><span class="op" id="4343290">.</span><span class="ident" id="4343291">size</span>&nbsp;<span class="op" id="4343296">=</span>&nbsp;<span class="num" id="4343298">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4343301">return</span>&nbsp;<span class="ident" id="4343308">z</span><span class="op" id="4343309">.</span><span class="ident" id="4343310">Read</span><span class="op" id="4343314">(</span><span class="ident" id="4343315">p</span><span class="op" id="4343316">)</span><br>
<span class="lineno"></span><span class="op" id="4343318">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="comment" id="4343321">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;Reader.&nbsp;It&nbsp;does&nbsp;not&nbsp;close&nbsp;the&nbsp;underlying&nbsp;io.Reader.</span><br>
<span class="lineno"></span><span class="keyword" id="4343393">func</span>&nbsp;<span class="op" id="4343398">(</span><span class="ident" id="4343399">z</span>&nbsp;<span class="op" id="4343401">*</span><span class="ident" id="4343402">Reader</span><span class="op" id="4343408">)</span>&nbsp;<span class="ident" id="4343410">Close</span><span class="op" id="4343415">(</span><span class="op" id="4343416">)</span>&nbsp;<span class="builtintype" id="4343418">error</span>&nbsp;<span class="op" id="4343424">{</span>&nbsp;<span class="keyword" id="4343426">return</span>&nbsp;<span class="ident" id="4343433">z</span><span class="op" id="4343434">.</span><span class="ident" id="4343435">decompressor</span><span class="op" id="4343447">.</span><span class="ident" id="4343448">Close</span><span class="op" id="4343453">(</span><span class="op" id="4343454">)</span>&nbsp;<span class="op" id="4343456">}</span>
</div>
</body>
</html>
