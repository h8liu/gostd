<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http</h2>
<ul>
<li><a href="/gostd/net/http/client.go.html">client.go</a></li>
<li><a href="/gostd/net/http/client_test.go.html">client_test.go</a></li>
<li><a href="/gostd/net/http/cookie.go.html">cookie.go</a></li>
<li><a href="/gostd/net/http/cookie_test.go.html">cookie_test.go</a></li>
<li><a href="/gostd/net/http/doc.go.html">doc.go</a></li>
<li><a href="/gostd/net/http/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/http/export_test.go.html" class="current">export_test.go</a></li>
<li><a href="/gostd/net/http/filetransport.go.html">filetransport.go</a></li>
<li><a href="/gostd/net/http/filetransport_test.go.html">filetransport_test.go</a></li>
<li><a href="/gostd/net/http/fs.go.html">fs.go</a></li>
<li><a href="/gostd/net/http/fs_test.go.html">fs_test.go</a></li>
<li><a href="/gostd/net/http/header.go.html">header.go</a></li>
<li><a href="/gostd/net/http/header_test.go.html">header_test.go</a></li>
<li><a href="/gostd/net/http/jar.go.html">jar.go</a></li>
<li><a href="/gostd/net/http/lex.go.html">lex.go</a></li>
<li><a href="/gostd/net/http/lex_test.go.html">lex_test.go</a></li>
<li><a href="/gostd/net/http/main_test.go.html">main_test.go</a></li>
<li><a href="/gostd/net/http/npn_test.go.html">npn_test.go</a></li>
<li><a href="/gostd/net/http/proxy_test.go.html">proxy_test.go</a></li>
<li><a href="/gostd/net/http/range_test.go.html">range_test.go</a></li>
<li><a href="/gostd/net/http/readrequest_test.go.html">readrequest_test.go</a></li>
<li><a href="/gostd/net/http/request.go.html">request.go</a></li>
<li><a href="/gostd/net/http/request_test.go.html">request_test.go</a></li>
<li><a href="/gostd/net/http/requestwrite_test.go.html">requestwrite_test.go</a></li>
<li><a href="/gostd/net/http/response.go.html">response.go</a></li>
<li><a href="/gostd/net/http/response_test.go.html">response_test.go</a></li>
<li><a href="/gostd/net/http/responsewrite_test.go.html">responsewrite_test.go</a></li>
<li><a href="/gostd/net/http/serve_test.go.html">serve_test.go</a></li>
<li><a href="/gostd/net/http/server.go.html">server.go</a></li>
<li><a href="/gostd/net/http/sniff.go.html">sniff.go</a></li>
<li><a href="/gostd/net/http/sniff_test.go.html">sniff_test.go</a></li>
<li><a href="/gostd/net/http/status.go.html">status.go</a></li>
<li><a href="/gostd/net/http/transfer.go.html">transfer.go</a></li>
<li><a href="/gostd/net/http/transfer_test.go.html">transfer_test.go</a></li>
<li><a href="/gostd/net/http/transport.go.html">transport.go</a></li>
<li><a href="/gostd/net/http/transport_test.go.html">transport_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8231215">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8231271">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8231325">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="8231376">//&nbsp;Bridge&nbsp;package&nbsp;to&nbsp;expose&nbsp;http&nbsp;internals&nbsp;to&nbsp;tests&nbsp;in&nbsp;the&nbsp;http_test</span><br>
<span class="lineno"></span><span class="comment" id="8231445">//&nbsp;package.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8231458">package</span>&nbsp;<span class="ident" id="8231466">http</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="8231472">import</span>&nbsp;<span class="op" id="8231479">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8231482">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8231489">&#34;net/url&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8231500">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="8231507">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="8231510">func</span>&nbsp;<span class="ident" id="8231515">NewLoggingConn</span><span class="op" id="8231529">(</span><span class="ident" id="8231530">baseName</span>&nbsp;<span class="builtintype" id="8231539">string</span><span class="op" id="8231545">,</span>&nbsp;<span class="ident" id="8231547">c</span>&nbsp;<span class="ident" id="8231549">net</span><span class="op" id="8231552">.</span><span class="ident" id="8231553">Conn</span><span class="op" id="8231557">)</span>&nbsp;<span class="ident" id="8231559">net</span><span class="op" id="8231562">.</span><span class="ident" id="8231563">Conn</span>&nbsp;<span class="op" id="8231568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8231571">return</span>&nbsp;<span class="ident" id="8231578">newLoggingConn</span><span class="op" id="8231592">(</span><span class="ident" id="8231593">baseName</span><span class="op" id="8231601">,</span>&nbsp;<span class="ident" id="8231603">c</span><span class="op" id="8231604">)</span><br>
<span class="lineno"></span><span class="op" id="8231606">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="8231609">var</span>&nbsp;<span class="ident" id="8231613">ExportAppendTime</span>&nbsp;<span class="op" id="8231630">=</span>&nbsp;<span class="ident" id="8231632">appendTime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8231644">func</span>&nbsp;<span class="op" id="8231649">(</span><span class="ident" id="8231650">t</span>&nbsp;<span class="op" id="8231652">*</span><span class="ident" id="8231653">Transport</span><span class="op" id="8231662">)</span>&nbsp;<span class="ident" id="8231664">NumPendingRequestsForTesting</span><span class="op" id="8231692">(</span><span class="op" id="8231693">)</span>&nbsp;<span class="builtintype" id="8231695">int</span>&nbsp;<span class="op" id="8231699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8231702">t</span><span class="op" id="8231703">.</span><span class="ident" id="8231704">reqMu</span><span class="op" id="8231709">.</span><span class="ident" id="8231710">Lock</span><span class="op" id="8231714">(</span><span class="op" id="8231715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8231718">defer</span>&nbsp;<span class="ident" id="8231724">t</span><span class="op" id="8231725">.</span><span class="ident" id="8231726">reqMu</span><span class="op" id="8231731">.</span><span class="ident" id="8231732">Unlock</span><span class="op" id="8231738">(</span><span class="op" id="8231739">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8231742">return</span>&nbsp;<span class="builtinfunc" id="8231749">len</span><span class="op" id="8231752">(</span><span class="ident" id="8231753">t</span><span class="op" id="8231754">.</span><span class="ident" id="8231755">reqCanceler</span><span class="op" id="8231766">)</span><br>
<span class="lineno"></span><span class="op" id="8231768">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8231771">func</span>&nbsp;<span class="op" id="8231776">(</span><span class="ident" id="8231777">t</span>&nbsp;<span class="op" id="8231779">*</span><span class="ident" id="8231780">Transport</span><span class="op" id="8231789">)</span>&nbsp;<span class="ident" id="8231791">IdleConnKeysForTesting</span><span class="op" id="8231813">(</span><span class="op" id="8231814">)</span>&nbsp;<span class="op" id="8231816">(</span><span class="ident" id="8231817">keys</span>&nbsp;<span class="op" id="8231822">[</span><span class="op" id="8231823">]</span><span class="builtintype" id="8231824">string</span><span class="op" id="8231830">)</span>&nbsp;<span class="op" id="8231832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8231835">keys</span>&nbsp;<span class="op" id="8231840">=</span>&nbsp;<span class="builtinfunc" id="8231842">make</span><span class="op" id="8231846">(</span><span class="op" id="8231847">[</span><span class="op" id="8231848">]</span><span class="builtintype" id="8231849">string</span><span class="op" id="8231855">,</span>&nbsp;<span class="num" id="8231857">0</span><span class="op" id="8231858">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8231861">t</span><span class="op" id="8231862">.</span><span class="ident" id="8231863">idleMu</span><span class="op" id="8231869">.</span><span class="ident" id="8231870">Lock</span><span class="op" id="8231874">(</span><span class="op" id="8231875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8231878">defer</span>&nbsp;<span class="ident" id="8231884">t</span><span class="op" id="8231885">.</span><span class="ident" id="8231886">idleMu</span><span class="op" id="8231892">.</span><span class="ident" id="8231893">Unlock</span><span class="op" id="8231899">(</span><span class="op" id="8231900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8231903">if</span>&nbsp;<span class="ident" id="8231906">t</span><span class="op" id="8231907">.</span><span class="ident" id="8231908">idleConn</span>&nbsp;<span class="op" id="8231917">==</span>&nbsp;<span class="ident" id="8231920">nil</span>&nbsp;<span class="op" id="8231924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8231928">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8231936">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8231939">for</span>&nbsp;<span class="ident" id="8231943">key</span>&nbsp;<span class="op" id="8231947">:=</span>&nbsp;<span class="keyword" id="8231950">range</span>&nbsp;<span class="ident" id="8231956">t</span><span class="op" id="8231957">.</span><span class="ident" id="8231958">idleConn</span>&nbsp;<span class="op" id="8231967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8231971">keys</span>&nbsp;<span class="op" id="8231976">=</span>&nbsp;<span class="builtinfunc" id="8231978">append</span><span class="op" id="8231984">(</span><span class="ident" id="8231985">keys</span><span class="op" id="8231989">,</span>&nbsp;<span class="ident" id="8231991">key</span><span class="op" id="8231994">.</span><span class="ident" id="8231995">String</span><span class="op" id="8232001">(</span><span class="op" id="8232002">)</span><span class="op" id="8232003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8232006">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8232009">return</span><br>
<span class="lineno"></span><span class="op" id="8232016">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="8232019">func</span>&nbsp;<span class="op" id="8232024">(</span><span class="ident" id="8232025">t</span>&nbsp;<span class="op" id="8232027">*</span><span class="ident" id="8232028">Transport</span><span class="op" id="8232037">)</span>&nbsp;<span class="ident" id="8232039">IdleConnCountForTesting</span><span class="op" id="8232062">(</span><span class="ident" id="8232063">cacheKey</span>&nbsp;<span class="builtintype" id="8232072">string</span><span class="op" id="8232078">)</span>&nbsp;<span class="builtintype" id="8232080">int</span>&nbsp;<span class="op" id="8232084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8232087">t</span><span class="op" id="8232088">.</span><span class="ident" id="8232089">idleMu</span><span class="op" id="8232095">.</span><span class="ident" id="8232096">Lock</span><span class="op" id="8232100">(</span><span class="op" id="8232101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8232104">defer</span>&nbsp;<span class="ident" id="8232110">t</span><span class="op" id="8232111">.</span><span class="ident" id="8232112">idleMu</span><span class="op" id="8232118">.</span><span class="ident" id="8232119">Unlock</span><span class="op" id="8232125">(</span><span class="op" id="8232126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8232129">if</span>&nbsp;<span class="ident" id="8232132">t</span><span class="op" id="8232133">.</span><span class="ident" id="8232134">idleConn</span>&nbsp;<span class="op" id="8232143">==</span>&nbsp;<span class="ident" id="8232146">nil</span>&nbsp;<span class="op" id="8232150">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8232154">return</span>&nbsp;<span class="num" id="8232161">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8232164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8232167">for</span>&nbsp;<span class="ident" id="8232171">k</span><span class="op" id="8232172">,</span>&nbsp;<span class="ident" id="8232174">conns</span>&nbsp;<span class="op" id="8232180">:=</span>&nbsp;<span class="keyword" id="8232183">range</span>&nbsp;<span class="ident" id="8232189">t</span><span class="op" id="8232190">.</span><span class="ident" id="8232191">idleConn</span>&nbsp;<span class="op" id="8232200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8232204">if</span>&nbsp;<span class="ident" id="8232207">k</span><span class="op" id="8232208">.</span><span class="ident" id="8232209">String</span><span class="op" id="8232215">(</span><span class="op" id="8232216">)</span>&nbsp;<span class="op" id="8232218">==</span>&nbsp;<span class="ident" id="8232221">cacheKey</span>&nbsp;<span class="op" id="8232230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8232235">return</span>&nbsp;<span class="builtinfunc" id="8232242">len</span><span class="op" id="8232245">(</span><span class="ident" id="8232246">conns</span><span class="op" id="8232251">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8232255">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8232258">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8232261">return</span>&nbsp;<span class="num" id="8232268">0</span><br>
<span class="lineno"></span><span class="op" id="8232270">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="8232273">func</span>&nbsp;<span class="op" id="8232278">(</span><span class="ident" id="8232279">t</span>&nbsp;<span class="op" id="8232281">*</span><span class="ident" id="8232282">Transport</span><span class="op" id="8232291">)</span>&nbsp;<span class="ident" id="8232293">IdleConnChMapSizeForTesting</span><span class="op" id="8232320">(</span><span class="op" id="8232321">)</span>&nbsp;<span class="builtintype" id="8232323">int</span>&nbsp;<span class="op" id="8232327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8232330">t</span><span class="op" id="8232331">.</span><span class="ident" id="8232332">idleMu</span><span class="op" id="8232338">.</span><span class="ident" id="8232339">Lock</span><span class="op" id="8232343">(</span><span class="op" id="8232344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8232347">defer</span>&nbsp;<span class="ident" id="8232353">t</span><span class="op" id="8232354">.</span><span class="ident" id="8232355">idleMu</span><span class="op" id="8232361">.</span><span class="ident" id="8232362">Unlock</span><span class="op" id="8232368">(</span><span class="op" id="8232369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8232372">return</span>&nbsp;<span class="builtinfunc" id="8232379">len</span><span class="op" id="8232382">(</span><span class="ident" id="8232383">t</span><span class="op" id="8232384">.</span><span class="ident" id="8232385">idleConnCh</span><span class="op" id="8232395">)</span><br>
<span class="lineno"></span><span class="op" id="8232397">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="8232400">func</span>&nbsp;<span class="op" id="8232405">(</span><span class="ident" id="8232406">t</span>&nbsp;<span class="op" id="8232408">*</span><span class="ident" id="8232409">Transport</span><span class="op" id="8232418">)</span>&nbsp;<span class="ident" id="8232420">IsIdleForTesting</span><span class="op" id="8232436">(</span><span class="op" id="8232437">)</span>&nbsp;<span class="builtintype" id="8232439">bool</span>&nbsp;<span class="op" id="8232444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8232447">t</span><span class="op" id="8232448">.</span><span class="ident" id="8232449">idleMu</span><span class="op" id="8232455">.</span><span class="ident" id="8232456">Lock</span><span class="op" id="8232460">(</span><span class="op" id="8232461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8232464">defer</span>&nbsp;<span class="ident" id="8232470">t</span><span class="op" id="8232471">.</span><span class="ident" id="8232472">idleMu</span><span class="op" id="8232478">.</span><span class="ident" id="8232479">Unlock</span><span class="op" id="8232485">(</span><span class="op" id="8232486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8232489">return</span>&nbsp;<span class="ident" id="8232496">t</span><span class="op" id="8232497">.</span><span class="ident" id="8232498">wantIdle</span><br>
<span class="lineno">65</span><span class="op" id="8232507">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8232510">func</span>&nbsp;<span class="op" id="8232515">(</span><span class="ident" id="8232516">t</span>&nbsp;<span class="op" id="8232518">*</span><span class="ident" id="8232519">Transport</span><span class="op" id="8232528">)</span>&nbsp;<span class="ident" id="8232530">RequestIdleConnChForTesting</span><span class="op" id="8232557">(</span><span class="op" id="8232558">)</span>&nbsp;<span class="op" id="8232560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8232563">t</span><span class="op" id="8232564">.</span><span class="ident" id="8232565">getIdleConnCh</span><span class="op" id="8232578">(</span><span class="ident" id="8232579">connectMethod</span><span class="op" id="8232592">{</span><span class="ident" id="8232593">nil</span><span class="op" id="8232596">,</span>&nbsp;<span class="string" id="8232598">&#34;http&#34;</span><span class="op" id="8232604">,</span>&nbsp;<span class="string" id="8232606">&#34;example.com&#34;</span><span class="op" id="8232619">}</span><span class="op" id="8232620">)</span><br>
<span class="lineno"></span><span class="op" id="8232622">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="8232625">func</span>&nbsp;<span class="op" id="8232630">(</span><span class="ident" id="8232631">t</span>&nbsp;<span class="op" id="8232633">*</span><span class="ident" id="8232634">Transport</span><span class="op" id="8232643">)</span>&nbsp;<span class="ident" id="8232645">PutIdleTestConn</span><span class="op" id="8232660">(</span><span class="op" id="8232661">)</span>&nbsp;<span class="builtintype" id="8232663">bool</span>&nbsp;<span class="op" id="8232668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8232671">c</span><span class="op" id="8232672">,</span>&nbsp;<span class="ident" id="8232674">_</span>&nbsp;<span class="op" id="8232676">:=</span>&nbsp;<span class="ident" id="8232679">net</span><span class="op" id="8232682">.</span><span class="ident" id="8232683">Pipe</span><span class="op" id="8232687">(</span><span class="op" id="8232688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8232691">return</span>&nbsp;<span class="ident" id="8232698">t</span><span class="op" id="8232699">.</span><span class="ident" id="8232700">putIdleConn</span><span class="op" id="8232711">(</span><span class="op" id="8232712">&amp;</span><span class="ident" id="8232713">persistConn</span><span class="op" id="8232724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8232728">t</span><span class="op" id="8232729">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8232738">t</span><span class="op" id="8232739">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8232743">conn</span><span class="op" id="8232747">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8232753">c</span><span class="op" id="8232754">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8232774">//&nbsp;dummy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8232785">closech</span><span class="op" id="8232792">:</span>&nbsp;&nbsp;<span class="builtinfunc" id="8232795">make</span><span class="op" id="8232799">(</span><span class="keyword" id="8232800">chan</span>&nbsp;<span class="keyword" id="8232805">struct</span><span class="op" id="8232811">{</span><span class="op" id="8232812">}</span><span class="op" id="8232813">)</span><span class="op" id="8232814">,</span>&nbsp;<span class="comment" id="8232816">//&nbsp;so&nbsp;it&nbsp;can&nbsp;be&nbsp;closed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8232841">cacheKey</span><span class="op" id="8232849">:</span>&nbsp;<span class="ident" id="8232851">connectMethodKey</span><span class="op" id="8232867">{</span><span class="string" id="8232868">&#34;&#34;</span><span class="op" id="8232870">,</span>&nbsp;<span class="string" id="8232872">&#34;http&#34;</span><span class="op" id="8232878">,</span>&nbsp;<span class="string" id="8232880">&#34;example.com&#34;</span><span class="op" id="8232893">}</span><span class="op" id="8232894">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8232897">}</span><span class="op" id="8232898">)</span><br>
<span class="lineno"></span><span class="op" id="8232900">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="keyword" id="8232903">func</span>&nbsp;<span class="ident" id="8232908">NewTestTimeoutHandler</span><span class="op" id="8232929">(</span><span class="ident" id="8232930">handler</span>&nbsp;<span class="ident" id="8232938">Handler</span><span class="op" id="8232945">,</span>&nbsp;<span class="ident" id="8232947">ch</span>&nbsp;<span class="op" id="8232950">&lt;-</span><span class="keyword" id="8232952">chan</span>&nbsp;<span class="ident" id="8232957">time</span><span class="op" id="8232961">.</span><span class="ident" id="8232962">Time</span><span class="op" id="8232966">)</span>&nbsp;<span class="ident" id="8232968">Handler</span>&nbsp;<span class="op" id="8232976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8232979">f</span>&nbsp;<span class="op" id="8232981">:=</span>&nbsp;<span class="keyword" id="8232984">func</span><span class="op" id="8232988">(</span><span class="op" id="8232989">)</span>&nbsp;<span class="op" id="8232991">&lt;-</span><span class="keyword" id="8232993">chan</span>&nbsp;<span class="ident" id="8232998">time</span><span class="op" id="8233002">.</span><span class="ident" id="8233003">Time</span>&nbsp;<span class="op" id="8233008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8233012">return</span>&nbsp;<span class="ident" id="8233019">ch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8233023">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8233026">return</span>&nbsp;<span class="op" id="8233033">&amp;</span><span class="ident" id="8233034">timeoutHandler</span><span class="op" id="8233048">{</span><span class="ident" id="8233049">handler</span><span class="op" id="8233056">,</span>&nbsp;<span class="ident" id="8233058">f</span><span class="op" id="8233059">,</span>&nbsp;<span class="string" id="8233061">&#34;&#34;</span><span class="op" id="8233063">}</span><br>
<span class="lineno"></span><span class="op" id="8233065">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8233068">func</span>&nbsp;<span class="ident" id="8233073">ResetCachedEnvironment</span><span class="op" id="8233095">(</span><span class="op" id="8233096">)</span>&nbsp;<span class="op" id="8233098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8233101">httpProxyEnv</span><span class="op" id="8233113">.</span><span class="ident" id="8233114">reset</span><span class="op" id="8233119">(</span><span class="op" id="8233120">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8233123">httpsProxyEnv</span><span class="op" id="8233136">.</span><span class="ident" id="8233137">reset</span><span class="op" id="8233142">(</span><span class="op" id="8233143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8233146">noProxyEnv</span><span class="op" id="8233156">.</span><span class="ident" id="8233157">reset</span><span class="op" id="8233162">(</span><span class="op" id="8233163">)</span><br>
<span class="lineno"></span><span class="op" id="8233165">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8233168">var</span>&nbsp;<span class="ident" id="8233172">DefaultUserAgent</span>&nbsp;<span class="op" id="8233189">=</span>&nbsp;<span class="ident" id="8233191">defaultUserAgent</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="keyword" id="8233209">func</span>&nbsp;<span class="ident" id="8233214">ExportRefererForURL</span><span class="op" id="8233233">(</span><span class="ident" id="8233234">lastReq</span><span class="op" id="8233241">,</span>&nbsp;<span class="ident" id="8233243">newReq</span>&nbsp;<span class="op" id="8233250">*</span><span class="ident" id="8233251">url</span><span class="op" id="8233254">.</span><span class="ident" id="8233255">URL</span><span class="op" id="8233258">)</span>&nbsp;<span class="builtintype" id="8233260">string</span>&nbsp;<span class="op" id="8233267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8233270">return</span>&nbsp;<span class="ident" id="8233277">refererForURL</span><span class="op" id="8233290">(</span><span class="ident" id="8233291">lastReq</span><span class="op" id="8233298">,</span>&nbsp;<span class="ident" id="8233300">newReq</span><span class="op" id="8233306">)</span><br>
<span class="lineno"></span><span class="op" id="8233308">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="8233311">//&nbsp;SetPendingDialHooks&nbsp;sets&nbsp;the&nbsp;hooks&nbsp;that&nbsp;run&nbsp;before&nbsp;and&nbsp;after&nbsp;handling</span><br>
<span class="lineno"></span><span class="comment" id="8233384">//&nbsp;pending&nbsp;dials.</span><br>
<span class="lineno"></span><span class="keyword" id="8233402">func</span>&nbsp;<span class="ident" id="8233407">SetPendingDialHooks</span><span class="op" id="8233426">(</span><span class="ident" id="8233427">before</span><span class="op" id="8233433">,</span>&nbsp;<span class="ident" id="8233435">after</span>&nbsp;<span class="keyword" id="8233441">func</span><span class="op" id="8233445">(</span><span class="op" id="8233446">)</span><span class="op" id="8233447">)</span>&nbsp;<span class="op" id="8233449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8233452">prePendingDial</span><span class="op" id="8233466">,</span>&nbsp;<span class="ident" id="8233468">postPendingDial</span>&nbsp;<span class="op" id="8233484">=</span>&nbsp;<span class="ident" id="8233486">before</span><span class="op" id="8233492">,</span>&nbsp;<span class="ident" id="8233494">after</span><br>
<span class="lineno"></span><span class="op" id="8233500">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="8233503">var</span>&nbsp;<span class="ident" id="8233507">ExportServerNewConn</span>&nbsp;<span class="op" id="8233527">=</span>&nbsp;<span class="op" id="8233529">(</span><span class="op" id="8233530">*</span><span class="ident" id="8233531">Server</span><span class="op" id="8233537">)</span><span class="op" id="8233538">.</span><span class="ident" id="8233539">newConn</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8233548">var</span>&nbsp;<span class="ident" id="8233552">ExportCloseWriteAndWait</span>&nbsp;<span class="op" id="8233576">=</span>&nbsp;<span class="op" id="8233578">(</span><span class="op" id="8233579">*</span><span class="ident" id="8233580">conn</span><span class="op" id="8233584">)</span><span class="op" id="8233585">.</span><span class="ident" id="8233586">closeWriteAndWait</span>
</div>
</body>
</html>
