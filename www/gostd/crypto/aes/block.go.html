<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/aes</h2>
<ul>
<li><a href="/gostd/crypto/aes/aes_test.go.html">aes_test.go</a></li>
<li><a href="/gostd/crypto/aes/block.go.html">block.go</a></li>
<li><a href="/gostd/crypto/aes/cipher.go.html">cipher.go</a></li>
<li><a href="/gostd/crypto/aes/cipher_asm.go.html">cipher_asm.go</a></li>
<li><a href="/gostd/crypto/aes/const.go.html">const.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3482332">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3482387">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3482441">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3482492">//&nbsp;This&nbsp;Go&nbsp;implementation&nbsp;is&nbsp;derived&nbsp;in&nbsp;part&nbsp;from&nbsp;the&nbsp;reference</span><br>
<span class="lineno"></span><span class="comment" id="3482556">//&nbsp;ANSI&nbsp;C&nbsp;implementation,&nbsp;which&nbsp;carries&nbsp;the&nbsp;following&nbsp;notice:</span><br>
<span class="lineno"></span><span class="comment" id="3482618">//</span><br>
<span class="lineno"></span><span class="comment" id="3482621">//&nbsp;&nbsp;&nbsp;&nbsprijndael-alg-fst.c</span><br>
<span class="lineno"></span><span class="comment" id="3482643">//</span><br>
<span class="lineno">10</span><span class="comment" id="3482646">//&nbsp;&nbsp;&nbsp;&nbsp@version&nbsp;3.0&nbsp;(December&nbsp;2000)</span><br>
<span class="lineno"></span><span class="comment" id="3482678">//</span><br>
<span class="lineno"></span><span class="comment" id="3482681">//&nbsp;&nbsp;&nbsp;&nbspOptimised&nbsp;ANSI&nbsp;C&nbsp;code&nbsp;for&nbsp;the&nbsp;Rijndael&nbsp;cipher&nbsp;(now&nbsp;AES)</span><br>
<span class="lineno"></span><span class="comment" id="3482740">//</span><br>
<span class="lineno"></span><span class="comment" id="3482743">//&nbsp;&nbsp;&nbsp;&nbsp@author&nbsp;Vincent&nbsp;Rijmen&nbsp;&lt;vincent.rijmen@esat.kuleuven.ac.be&gt;</span><br>
<span class="lineno">15</span><span class="comment" id="3482806">//&nbsp;&nbsp;&nbsp;&nbsp@author&nbsp;Antoon&nbsp;Bosselaers&nbsp;&lt;antoon.bosselaers@esat.kuleuven.ac.be&gt;</span><br>
<span class="lineno"></span><span class="comment" id="3482875">//&nbsp;&nbsp;&nbsp;&nbsp@author&nbsp;Paulo&nbsp;Barreto&nbsp;&lt;paulo.barreto@terra.com.br&gt;</span><br>
<span class="lineno"></span><span class="comment" id="3482929">//</span><br>
<span class="lineno"></span><span class="comment" id="3482932">//&nbsp;&nbsp;&nbsp;&nbspThis&nbsp;code&nbsp;is&nbsp;hereby&nbsp;placed&nbsp;in&nbsp;the&nbsp;public&nbsp;domain.</span><br>
<span class="lineno"></span><span class="comment" id="3482984">//</span><br>
<span class="lineno">20</span><span class="comment" id="3482987">//&nbsp;&nbsp;&nbsp;&nbspTHIS&nbsp;SOFTWARE&nbsp;IS&nbsp;PROVIDED&nbsp;BY&nbsp;THE&nbsp;AUTHORS&nbsp;&#39;&#39;AS&nbsp;IS&#39;&#39;&nbsp;AND&nbsp;ANY&nbsp;EXPRESS</span><br>
<span class="lineno"></span><span class="comment" id="3483057">//&nbsp;&nbsp;&nbsp;&nbspOR&nbsp;IMPLIED&nbsp;WARRANTIES,&nbsp;INCLUDING,&nbsp;BUT&nbsp;NOT&nbsp;LIMITED&nbsp;TO,&nbsp;THE&nbsp;IMPLIED</span><br>
<span class="lineno"></span><span class="comment" id="3483126">//&nbsp;&nbsp;&nbsp;&nbspWARRANTIES&nbsp;OF&nbsp;MERCHANTABILITY&nbsp;AND&nbsp;FITNESS&nbsp;FOR&nbsp;A&nbsp;PARTICULAR&nbsp;PURPOSE</span><br>
<span class="lineno"></span><span class="comment" id="3483196">//&nbsp;&nbsp;&nbsp;&nbspARE&nbsp;DISCLAIMED.&nbsp;&nbsp;IN&nbsp;NO&nbsp;EVENT&nbsp;SHALL&nbsp;THE&nbsp;AUTHORS&nbsp;OR&nbsp;CONTRIBUTORS&nbsp;BE</span><br>
<span class="lineno"></span><span class="comment" id="3483265">//&nbsp;&nbsp;&nbsp;&nbspLIABLE&nbsp;FOR&nbsp;ANY&nbsp;DIRECT,&nbsp;INDIRECT,&nbsp;INCIDENTAL,&nbsp;SPECIAL,&nbsp;EXEMPLARY,&nbsp;OR</span><br>
<span class="lineno">25</span><span class="comment" id="3483336">//&nbsp;&nbsp;&nbsp;&nbspCONSEQUENTIAL&nbsp;DAMAGES&nbsp;(INCLUDING,&nbsp;BUT&nbsp;NOT&nbsp;LIMITED&nbsp;TO,&nbsp;PROCUREMENT&nbsp;OF</span><br>
<span class="lineno"></span><span class="comment" id="3483408">//&nbsp;&nbsp;&nbsp;&nbspSUBSTITUTE&nbsp;GOODS&nbsp;OR&nbsp;SERVICES;&nbsp;LOSS&nbsp;OF&nbsp;USE,&nbsp;DATA,&nbsp;OR&nbsp;PROFITS;&nbsp;OR</span><br>
<span class="lineno"></span><span class="comment" id="3483475">//&nbsp;&nbsp;&nbsp;&nbspBUSINESS&nbsp;INTERRUPTION)&nbsp;HOWEVER&nbsp;CAUSED&nbsp;AND&nbsp;ON&nbsp;ANY&nbsp;THEORY&nbsp;OF&nbsp;LIABILITY,</span><br>
<span class="lineno"></span><span class="comment" id="3483548">//&nbsp;&nbsp;&nbsp;&nbspWHETHER&nbsp;IN&nbsp;CONTRACT,&nbsp;STRICT&nbsp;LIABILITY,&nbsp;OR&nbsp;TORT&nbsp;(INCLUDING&nbsp;NEGLIGENCE</span><br>
<span class="lineno"></span><span class="comment" id="3483620">//&nbsp;&nbsp;&nbsp;&nbspOR&nbsp;OTHERWISE)&nbsp;ARISING&nbsp;IN&nbsp;ANY&nbsp;WAY&nbsp;OUT&nbsp;OF&nbsp;THE&nbsp;USE&nbsp;OF&nbsp;THIS&nbsp;SOFTWARE,</span><br>
<span class="lineno">30</span><span class="comment" id="3483689">//&nbsp;&nbsp;&nbsp;&nbspEVEN&nbsp;IF&nbsp;ADVISED&nbsp;OF&nbsp;THE&nbsp;POSSIBILITY&nbsp;OF&nbsp;SUCH&nbsp;DAMAGE.</span><br>
<span class="lineno"></span><span class="comment" id="3483743">//</span><br>
<span class="lineno"></span><span class="comment" id="3483746">//&nbsp;See&nbsp;FIPS&nbsp;197&nbsp;for&nbsp;specification,&nbsp;and&nbsp;see&nbsp;Daemen&nbsp;and&nbsp;Rijmen&#39;s&nbsp;Rijndael&nbsp;submission</span><br>
<span class="lineno"></span><span class="comment" id="3483829">//&nbsp;for&nbsp;implementation&nbsp;details.</span><br>
<span class="lineno"></span><span class="comment" id="3483860">//&nbsp;&nbsp;&nbsp;&nbsphttp://www.csrc.nist.gov/publications/fips/fips197/fips-197.pdf</span><br>
<span class="lineno">35</span><span class="comment" id="3483927">//&nbsp;&nbsp;&nbsp;&nbsphttp://csrc.nist.gov/archive/aes/rijndael/Rijndael-ammended.pdf</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3483995">package</span>&nbsp;<span class="ident" id="3484003">aes</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3484008">//&nbsp;Encrypt&nbsp;one&nbsp;block&nbsp;from&nbsp;src&nbsp;into&nbsp;dst,&nbsp;using&nbsp;the&nbsp;expanded&nbsp;key&nbsp;xk.</span><br>
<span class="lineno">40</span><span class="keyword" id="3484075">func</span>&nbsp;<span class="ident" id="3484080">encryptBlockGo</span><span class="op" id="3484094">(</span><span class="ident" id="3484095">xk</span>&nbsp;<span class="op" id="3484098">[</span><span class="op" id="3484099">]</span><span class="builtintype" id="3484100">uint32</span><span class="op" id="3484106">,</span>&nbsp;<span class="ident" id="3484108">dst</span><span class="op" id="3484111">,</span>&nbsp;<span class="ident" id="3484113">src</span>&nbsp;<span class="op" id="3484117">[</span><span class="op" id="3484118">]</span><span class="builtintype" id="3484119">byte</span><span class="op" id="3484123">)</span>&nbsp;<span class="op" id="3484125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3484128">var</span>&nbsp;<span class="ident" id="3484132">s0</span><span class="op" id="3484134">,</span>&nbsp;<span class="ident" id="3484136">s1</span><span class="op" id="3484138">,</span>&nbsp;<span class="ident" id="3484140">s2</span><span class="op" id="3484142">,</span>&nbsp;<span class="ident" id="3484144">s3</span><span class="op" id="3484146">,</span>&nbsp;<span class="ident" id="3484148">t0</span><span class="op" id="3484150">,</span>&nbsp;<span class="ident" id="3484152">t1</span><span class="op" id="3484154">,</span>&nbsp;<span class="ident" id="3484156">t2</span><span class="op" id="3484158">,</span>&nbsp;<span class="ident" id="3484160">t3</span>&nbsp;<span class="builtintype" id="3484163">uint32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3484172">s0</span>&nbsp;<span class="op" id="3484175">=</span>&nbsp;<span class="builtintype" id="3484177">uint32</span><span class="op" id="3484183">(</span><span class="ident" id="3484184">src</span><span class="op" id="3484187">[</span><span class="num" id="3484188">0</span><span class="op" id="3484189">]</span><span class="op" id="3484190">)</span><span class="op" id="3484191">&lt;&lt;</span><span class="num" id="3484193">24</span>&nbsp;<span class="op" id="3484196">|</span>&nbsp;<span class="builtintype" id="3484198">uint32</span><span class="op" id="3484204">(</span><span class="ident" id="3484205">src</span><span class="op" id="3484208">[</span><span class="num" id="3484209">1</span><span class="op" id="3484210">]</span><span class="op" id="3484211">)</span><span class="op" id="3484212">&lt;&lt;</span><span class="num" id="3484214">16</span>&nbsp;<span class="op" id="3484217">|</span>&nbsp;<span class="builtintype" id="3484219">uint32</span><span class="op" id="3484225">(</span><span class="ident" id="3484226">src</span><span class="op" id="3484229">[</span><span class="num" id="3484230">2</span><span class="op" id="3484231">]</span><span class="op" id="3484232">)</span><span class="op" id="3484233">&lt;&lt;</span><span class="num" id="3484235">8</span>&nbsp;<span class="op" id="3484237">|</span>&nbsp;<span class="builtintype" id="3484239">uint32</span><span class="op" id="3484245">(</span><span class="ident" id="3484246">src</span><span class="op" id="3484249">[</span><span class="num" id="3484250">3</span><span class="op" id="3484251">]</span><span class="op" id="3484252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3484255">s1</span>&nbsp;<span class="op" id="3484258">=</span>&nbsp;<span class="builtintype" id="3484260">uint32</span><span class="op" id="3484266">(</span><span class="ident" id="3484267">src</span><span class="op" id="3484270">[</span><span class="num" id="3484271">4</span><span class="op" id="3484272">]</span><span class="op" id="3484273">)</span><span class="op" id="3484274">&lt;&lt;</span><span class="num" id="3484276">24</span>&nbsp;<span class="op" id="3484279">|</span>&nbsp;<span class="builtintype" id="3484281">uint32</span><span class="op" id="3484287">(</span><span class="ident" id="3484288">src</span><span class="op" id="3484291">[</span><span class="num" id="3484292">5</span><span class="op" id="3484293">]</span><span class="op" id="3484294">)</span><span class="op" id="3484295">&lt;&lt;</span><span class="num" id="3484297">16</span>&nbsp;<span class="op" id="3484300">|</span>&nbsp;<span class="builtintype" id="3484302">uint32</span><span class="op" id="3484308">(</span><span class="ident" id="3484309">src</span><span class="op" id="3484312">[</span><span class="num" id="3484313">6</span><span class="op" id="3484314">]</span><span class="op" id="3484315">)</span><span class="op" id="3484316">&lt;&lt;</span><span class="num" id="3484318">8</span>&nbsp;<span class="op" id="3484320">|</span>&nbsp;<span class="builtintype" id="3484322">uint32</span><span class="op" id="3484328">(</span><span class="ident" id="3484329">src</span><span class="op" id="3484332">[</span><span class="num" id="3484333">7</span><span class="op" id="3484334">]</span><span class="op" id="3484335">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3484338">s2</span>&nbsp;<span class="op" id="3484341">=</span>&nbsp;<span class="builtintype" id="3484343">uint32</span><span class="op" id="3484349">(</span><span class="ident" id="3484350">src</span><span class="op" id="3484353">[</span><span class="num" id="3484354">8</span><span class="op" id="3484355">]</span><span class="op" id="3484356">)</span><span class="op" id="3484357">&lt;&lt;</span><span class="num" id="3484359">24</span>&nbsp;<span class="op" id="3484362">|</span>&nbsp;<span class="builtintype" id="3484364">uint32</span><span class="op" id="3484370">(</span><span class="ident" id="3484371">src</span><span class="op" id="3484374">[</span><span class="num" id="3484375">9</span><span class="op" id="3484376">]</span><span class="op" id="3484377">)</span><span class="op" id="3484378">&lt;&lt;</span><span class="num" id="3484380">16</span>&nbsp;<span class="op" id="3484383">|</span>&nbsp;<span class="builtintype" id="3484385">uint32</span><span class="op" id="3484391">(</span><span class="ident" id="3484392">src</span><span class="op" id="3484395">[</span><span class="num" id="3484396">10</span><span class="op" id="3484398">]</span><span class="op" id="3484399">)</span><span class="op" id="3484400">&lt;&lt;</span><span class="num" id="3484402">8</span>&nbsp;<span class="op" id="3484404">|</span>&nbsp;<span class="builtintype" id="3484406">uint32</span><span class="op" id="3484412">(</span><span class="ident" id="3484413">src</span><span class="op" id="3484416">[</span><span class="num" id="3484417">11</span><span class="op" id="3484419">]</span><span class="op" id="3484420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3484423">s3</span>&nbsp;<span class="op" id="3484426">=</span>&nbsp;<span class="builtintype" id="3484428">uint32</span><span class="op" id="3484434">(</span><span class="ident" id="3484435">src</span><span class="op" id="3484438">[</span><span class="num" id="3484439">12</span><span class="op" id="3484441">]</span><span class="op" id="3484442">)</span><span class="op" id="3484443">&lt;&lt;</span><span class="num" id="3484445">24</span>&nbsp;<span class="op" id="3484448">|</span>&nbsp;<span class="builtintype" id="3484450">uint32</span><span class="op" id="3484456">(</span><span class="ident" id="3484457">src</span><span class="op" id="3484460">[</span><span class="num" id="3484461">13</span><span class="op" id="3484463">]</span><span class="op" id="3484464">)</span><span class="op" id="3484465">&lt;&lt;</span><span class="num" id="3484467">16</span>&nbsp;<span class="op" id="3484470">|</span>&nbsp;<span class="builtintype" id="3484472">uint32</span><span class="op" id="3484478">(</span><span class="ident" id="3484479">src</span><span class="op" id="3484482">[</span><span class="num" id="3484483">14</span><span class="op" id="3484485">]</span><span class="op" id="3484486">)</span><span class="op" id="3484487">&lt;&lt;</span><span class="num" id="3484489">8</span>&nbsp;<span class="op" id="3484491">|</span>&nbsp;<span class="builtintype" id="3484493">uint32</span><span class="op" id="3484499">(</span><span class="ident" id="3484500">src</span><span class="op" id="3484503">[</span><span class="num" id="3484504">15</span><span class="op" id="3484506">]</span><span class="op" id="3484507">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3484511">//&nbsp;First&nbsp;round&nbsp;just&nbsp;XORs&nbsp;input&nbsp;with&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3484553">s0</span>&nbsp;<span class="op" id="3484556">^=</span>&nbsp;<span class="ident" id="3484559">xk</span><span class="op" id="3484561">[</span><span class="num" id="3484562">0</span><span class="op" id="3484563">]</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3484566">s1</span>&nbsp;<span class="op" id="3484569">^=</span>&nbsp;<span class="ident" id="3484572">xk</span><span class="op" id="3484574">[</span><span class="num" id="3484575">1</span><span class="op" id="3484576">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3484579">s2</span>&nbsp;<span class="op" id="3484582">^=</span>&nbsp;<span class="ident" id="3484585">xk</span><span class="op" id="3484587">[</span><span class="num" id="3484588">2</span><span class="op" id="3484589">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3484592">s3</span>&nbsp;<span class="op" id="3484595">^=</span>&nbsp;<span class="ident" id="3484598">xk</span><span class="op" id="3484600">[</span><span class="num" id="3484601">3</span><span class="op" id="3484602">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3484606">//&nbsp;Middle&nbsp;rounds&nbsp;shuffle&nbsp;using&nbsp;tables.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3484646">//&nbsp;Number&nbsp;of&nbsp;rounds&nbsp;is&nbsp;set&nbsp;by&nbsp;length&nbsp;of&nbsp;expanded&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3484701">nr</span>&nbsp;<span class="op" id="3484704">:=</span>&nbsp;<span class="builtinfunc" id="3484707">len</span><span class="op" id="3484710">(</span><span class="ident" id="3484711">xk</span><span class="op" id="3484713">)</span><span class="op" id="3484714">/</span><span class="num" id="3484715">4</span>&nbsp;<span class="op" id="3484717">-</span>&nbsp;<span class="num" id="3484719">2</span>&nbsp;<span class="comment" id="3484721">//&nbsp;-&nbsp;2:&nbsp;one&nbsp;above,&nbsp;one&nbsp;more&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3484756">k</span>&nbsp;<span class="op" id="3484758">:=</span>&nbsp;<span class="num" id="3484761">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3484764">for</span>&nbsp;<span class="ident" id="3484768">r</span>&nbsp;<span class="op" id="3484770">:=</span>&nbsp;<span class="num" id="3484773">0</span><span class="op" id="3484774">;</span>&nbsp;<span class="ident" id="3484776">r</span>&nbsp;<span class="op" id="3484778">&lt;</span>&nbsp;<span class="ident" id="3484780">nr</span><span class="op" id="3484782">;</span>&nbsp;<span class="ident" id="3484784">r</span><span class="op" id="3484785">++</span>&nbsp;<span class="op" id="3484788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3484792">t0</span>&nbsp;<span class="op" id="3484795">=</span>&nbsp;<span class="ident" id="3484797">xk</span><span class="op" id="3484799">[</span><span class="ident" id="3484800">k</span><span class="op" id="3484801">+</span><span class="num" id="3484802">0</span><span class="op" id="3484803">]</span>&nbsp;<span class="op" id="3484805">^</span>&nbsp;<span class="ident" id="3484807">te0</span><span class="op" id="3484810">[</span><span class="builtintype" id="3484811">uint8</span><span class="op" id="3484816">(</span><span class="ident" id="3484817">s0</span><span class="op" id="3484819">&gt;&gt;</span><span class="num" id="3484821">24</span><span class="op" id="3484823">)</span><span class="op" id="3484824">]</span>&nbsp;<span class="op" id="3484826">^</span>&nbsp;<span class="ident" id="3484828">te1</span><span class="op" id="3484831">[</span><span class="builtintype" id="3484832">uint8</span><span class="op" id="3484837">(</span><span class="ident" id="3484838">s1</span><span class="op" id="3484840">&gt;&gt;</span><span class="num" id="3484842">16</span><span class="op" id="3484844">)</span><span class="op" id="3484845">]</span>&nbsp;<span class="op" id="3484847">^</span>&nbsp;<span class="ident" id="3484849">te2</span><span class="op" id="3484852">[</span><span class="builtintype" id="3484853">uint8</span><span class="op" id="3484858">(</span><span class="ident" id="3484859">s2</span><span class="op" id="3484861">&gt;&gt;</span><span class="num" id="3484863">8</span><span class="op" id="3484864">)</span><span class="op" id="3484865">]</span>&nbsp;<span class="op" id="3484867">^</span>&nbsp;<span class="ident" id="3484869">te3</span><span class="op" id="3484872">[</span><span class="builtintype" id="3484873">uint8</span><span class="op" id="3484878">(</span><span class="ident" id="3484879">s3</span><span class="op" id="3484881">)</span><span class="op" id="3484882">]</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3484886">t1</span>&nbsp;<span class="op" id="3484889">=</span>&nbsp;<span class="ident" id="3484891">xk</span><span class="op" id="3484893">[</span><span class="ident" id="3484894">k</span><span class="op" id="3484895">+</span><span class="num" id="3484896">1</span><span class="op" id="3484897">]</span>&nbsp;<span class="op" id="3484899">^</span>&nbsp;<span class="ident" id="3484901">te0</span><span class="op" id="3484904">[</span><span class="builtintype" id="3484905">uint8</span><span class="op" id="3484910">(</span><span class="ident" id="3484911">s1</span><span class="op" id="3484913">&gt;&gt;</span><span class="num" id="3484915">24</span><span class="op" id="3484917">)</span><span class="op" id="3484918">]</span>&nbsp;<span class="op" id="3484920">^</span>&nbsp;<span class="ident" id="3484922">te1</span><span class="op" id="3484925">[</span><span class="builtintype" id="3484926">uint8</span><span class="op" id="3484931">(</span><span class="ident" id="3484932">s2</span><span class="op" id="3484934">&gt;&gt;</span><span class="num" id="3484936">16</span><span class="op" id="3484938">)</span><span class="op" id="3484939">]</span>&nbsp;<span class="op" id="3484941">^</span>&nbsp;<span class="ident" id="3484943">te2</span><span class="op" id="3484946">[</span><span class="builtintype" id="3484947">uint8</span><span class="op" id="3484952">(</span><span class="ident" id="3484953">s3</span><span class="op" id="3484955">&gt;&gt;</span><span class="num" id="3484957">8</span><span class="op" id="3484958">)</span><span class="op" id="3484959">]</span>&nbsp;<span class="op" id="3484961">^</span>&nbsp;<span class="ident" id="3484963">te3</span><span class="op" id="3484966">[</span><span class="builtintype" id="3484967">uint8</span><span class="op" id="3484972">(</span><span class="ident" id="3484973">s0</span><span class="op" id="3484975">)</span><span class="op" id="3484976">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3484980">t2</span>&nbsp;<span class="op" id="3484983">=</span>&nbsp;<span class="ident" id="3484985">xk</span><span class="op" id="3484987">[</span><span class="ident" id="3484988">k</span><span class="op" id="3484989">+</span><span class="num" id="3484990">2</span><span class="op" id="3484991">]</span>&nbsp;<span class="op" id="3484993">^</span>&nbsp;<span class="ident" id="3484995">te0</span><span class="op" id="3484998">[</span><span class="builtintype" id="3484999">uint8</span><span class="op" id="3485004">(</span><span class="ident" id="3485005">s2</span><span class="op" id="3485007">&gt;&gt;</span><span class="num" id="3485009">24</span><span class="op" id="3485011">)</span><span class="op" id="3485012">]</span>&nbsp;<span class="op" id="3485014">^</span>&nbsp;<span class="ident" id="3485016">te1</span><span class="op" id="3485019">[</span><span class="builtintype" id="3485020">uint8</span><span class="op" id="3485025">(</span><span class="ident" id="3485026">s3</span><span class="op" id="3485028">&gt;&gt;</span><span class="num" id="3485030">16</span><span class="op" id="3485032">)</span><span class="op" id="3485033">]</span>&nbsp;<span class="op" id="3485035">^</span>&nbsp;<span class="ident" id="3485037">te2</span><span class="op" id="3485040">[</span><span class="builtintype" id="3485041">uint8</span><span class="op" id="3485046">(</span><span class="ident" id="3485047">s0</span><span class="op" id="3485049">&gt;&gt;</span><span class="num" id="3485051">8</span><span class="op" id="3485052">)</span><span class="op" id="3485053">]</span>&nbsp;<span class="op" id="3485055">^</span>&nbsp;<span class="ident" id="3485057">te3</span><span class="op" id="3485060">[</span><span class="builtintype" id="3485061">uint8</span><span class="op" id="3485066">(</span><span class="ident" id="3485067">s1</span><span class="op" id="3485069">)</span><span class="op" id="3485070">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3485074">t3</span>&nbsp;<span class="op" id="3485077">=</span>&nbsp;<span class="ident" id="3485079">xk</span><span class="op" id="3485081">[</span><span class="ident" id="3485082">k</span><span class="op" id="3485083">+</span><span class="num" id="3485084">3</span><span class="op" id="3485085">]</span>&nbsp;<span class="op" id="3485087">^</span>&nbsp;<span class="ident" id="3485089">te0</span><span class="op" id="3485092">[</span><span class="builtintype" id="3485093">uint8</span><span class="op" id="3485098">(</span><span class="ident" id="3485099">s3</span><span class="op" id="3485101">&gt;&gt;</span><span class="num" id="3485103">24</span><span class="op" id="3485105">)</span><span class="op" id="3485106">]</span>&nbsp;<span class="op" id="3485108">^</span>&nbsp;<span class="ident" id="3485110">te1</span><span class="op" id="3485113">[</span><span class="builtintype" id="3485114">uint8</span><span class="op" id="3485119">(</span><span class="ident" id="3485120">s0</span><span class="op" id="3485122">&gt;&gt;</span><span class="num" id="3485124">16</span><span class="op" id="3485126">)</span><span class="op" id="3485127">]</span>&nbsp;<span class="op" id="3485129">^</span>&nbsp;<span class="ident" id="3485131">te2</span><span class="op" id="3485134">[</span><span class="builtintype" id="3485135">uint8</span><span class="op" id="3485140">(</span><span class="ident" id="3485141">s1</span><span class="op" id="3485143">&gt;&gt;</span><span class="num" id="3485145">8</span><span class="op" id="3485146">)</span><span class="op" id="3485147">]</span>&nbsp;<span class="op" id="3485149">^</span>&nbsp;<span class="ident" id="3485151">te3</span><span class="op" id="3485154">[</span><span class="builtintype" id="3485155">uint8</span><span class="op" id="3485160">(</span><span class="ident" id="3485161">s2</span><span class="op" id="3485163">)</span><span class="op" id="3485164">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3485168">k</span>&nbsp;<span class="op" id="3485170">+=</span>&nbsp;<span class="num" id="3485173">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3485177">s0</span><span class="op" id="3485179">,</span>&nbsp;<span class="ident" id="3485181">s1</span><span class="op" id="3485183">,</span>&nbsp;<span class="ident" id="3485185">s2</span><span class="op" id="3485187">,</span>&nbsp;<span class="ident" id="3485189">s3</span>&nbsp;<span class="op" id="3485192">=</span>&nbsp;<span class="ident" id="3485194">t0</span><span class="op" id="3485196">,</span>&nbsp;<span class="ident" id="3485198">t1</span><span class="op" id="3485200">,</span>&nbsp;<span class="ident" id="3485202">t2</span><span class="op" id="3485204">,</span>&nbsp;<span class="ident" id="3485206">t3</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3485210">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3485214">//&nbsp;Last&nbsp;round&nbsp;uses&nbsp;s-box&nbsp;directly&nbsp;and&nbsp;XORs&nbsp;to&nbsp;produce&nbsp;output.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3485277">s0</span>&nbsp;<span class="op" id="3485280">=</span>&nbsp;<span class="builtintype" id="3485282">uint32</span><span class="op" id="3485288">(</span><span class="ident" id="3485289">sbox0</span><span class="op" id="3485294">[</span><span class="ident" id="3485295">t0</span><span class="op" id="3485297">&gt;&gt;</span><span class="num" id="3485299">24</span><span class="op" id="3485301">]</span><span class="op" id="3485302">)</span><span class="op" id="3485303">&lt;&lt;</span><span class="num" id="3485305">24</span>&nbsp;<span class="op" id="3485308">|</span>&nbsp;<span class="builtintype" id="3485310">uint32</span><span class="op" id="3485316">(</span><span class="ident" id="3485317">sbox0</span><span class="op" id="3485322">[</span><span class="ident" id="3485323">t1</span><span class="op" id="3485325">&gt;&gt;</span><span class="num" id="3485327">16</span><span class="op" id="3485329">&amp;</span><span class="num" id="3485330">0xff</span><span class="op" id="3485334">]</span><span class="op" id="3485335">)</span><span class="op" id="3485336">&lt;&lt;</span><span class="num" id="3485338">16</span>&nbsp;<span class="op" id="3485341">|</span>&nbsp;<span class="builtintype" id="3485343">uint32</span><span class="op" id="3485349">(</span><span class="ident" id="3485350">sbox0</span><span class="op" id="3485355">[</span><span class="ident" id="3485356">t2</span><span class="op" id="3485358">&gt;&gt;</span><span class="num" id="3485360">8</span><span class="op" id="3485361">&amp;</span><span class="num" id="3485362">0xff</span><span class="op" id="3485366">]</span><span class="op" id="3485367">)</span><span class="op" id="3485368">&lt;&lt;</span><span class="num" id="3485370">8</span>&nbsp;<span class="op" id="3485372">|</span>&nbsp;<span class="builtintype" id="3485374">uint32</span><span class="op" id="3485380">(</span><span class="ident" id="3485381">sbox0</span><span class="op" id="3485386">[</span><span class="ident" id="3485387">t3</span><span class="op" id="3485389">&amp;</span><span class="num" id="3485390">0xff</span><span class="op" id="3485394">]</span><span class="op" id="3485395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3485398">s1</span>&nbsp;<span class="op" id="3485401">=</span>&nbsp;<span class="builtintype" id="3485403">uint32</span><span class="op" id="3485409">(</span><span class="ident" id="3485410">sbox0</span><span class="op" id="3485415">[</span><span class="ident" id="3485416">t1</span><span class="op" id="3485418">&gt;&gt;</span><span class="num" id="3485420">24</span><span class="op" id="3485422">]</span><span class="op" id="3485423">)</span><span class="op" id="3485424">&lt;&lt;</span><span class="num" id="3485426">24</span>&nbsp;<span class="op" id="3485429">|</span>&nbsp;<span class="builtintype" id="3485431">uint32</span><span class="op" id="3485437">(</span><span class="ident" id="3485438">sbox0</span><span class="op" id="3485443">[</span><span class="ident" id="3485444">t2</span><span class="op" id="3485446">&gt;&gt;</span><span class="num" id="3485448">16</span><span class="op" id="3485450">&amp;</span><span class="num" id="3485451">0xff</span><span class="op" id="3485455">]</span><span class="op" id="3485456">)</span><span class="op" id="3485457">&lt;&lt;</span><span class="num" id="3485459">16</span>&nbsp;<span class="op" id="3485462">|</span>&nbsp;<span class="builtintype" id="3485464">uint32</span><span class="op" id="3485470">(</span><span class="ident" id="3485471">sbox0</span><span class="op" id="3485476">[</span><span class="ident" id="3485477">t3</span><span class="op" id="3485479">&gt;&gt;</span><span class="num" id="3485481">8</span><span class="op" id="3485482">&amp;</span><span class="num" id="3485483">0xff</span><span class="op" id="3485487">]</span><span class="op" id="3485488">)</span><span class="op" id="3485489">&lt;&lt;</span><span class="num" id="3485491">8</span>&nbsp;<span class="op" id="3485493">|</span>&nbsp;<span class="builtintype" id="3485495">uint32</span><span class="op" id="3485501">(</span><span class="ident" id="3485502">sbox0</span><span class="op" id="3485507">[</span><span class="ident" id="3485508">t0</span><span class="op" id="3485510">&amp;</span><span class="num" id="3485511">0xff</span><span class="op" id="3485515">]</span><span class="op" id="3485516">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3485519">s2</span>&nbsp;<span class="op" id="3485522">=</span>&nbsp;<span class="builtintype" id="3485524">uint32</span><span class="op" id="3485530">(</span><span class="ident" id="3485531">sbox0</span><span class="op" id="3485536">[</span><span class="ident" id="3485537">t2</span><span class="op" id="3485539">&gt;&gt;</span><span class="num" id="3485541">24</span><span class="op" id="3485543">]</span><span class="op" id="3485544">)</span><span class="op" id="3485545">&lt;&lt;</span><span class="num" id="3485547">24</span>&nbsp;<span class="op" id="3485550">|</span>&nbsp;<span class="builtintype" id="3485552">uint32</span><span class="op" id="3485558">(</span><span class="ident" id="3485559">sbox0</span><span class="op" id="3485564">[</span><span class="ident" id="3485565">t3</span><span class="op" id="3485567">&gt;&gt;</span><span class="num" id="3485569">16</span><span class="op" id="3485571">&amp;</span><span class="num" id="3485572">0xff</span><span class="op" id="3485576">]</span><span class="op" id="3485577">)</span><span class="op" id="3485578">&lt;&lt;</span><span class="num" id="3485580">16</span>&nbsp;<span class="op" id="3485583">|</span>&nbsp;<span class="builtintype" id="3485585">uint32</span><span class="op" id="3485591">(</span><span class="ident" id="3485592">sbox0</span><span class="op" id="3485597">[</span><span class="ident" id="3485598">t0</span><span class="op" id="3485600">&gt;&gt;</span><span class="num" id="3485602">8</span><span class="op" id="3485603">&amp;</span><span class="num" id="3485604">0xff</span><span class="op" id="3485608">]</span><span class="op" id="3485609">)</span><span class="op" id="3485610">&lt;&lt;</span><span class="num" id="3485612">8</span>&nbsp;<span class="op" id="3485614">|</span>&nbsp;<span class="builtintype" id="3485616">uint32</span><span class="op" id="3485622">(</span><span class="ident" id="3485623">sbox0</span><span class="op" id="3485628">[</span><span class="ident" id="3485629">t1</span><span class="op" id="3485631">&amp;</span><span class="num" id="3485632">0xff</span><span class="op" id="3485636">]</span><span class="op" id="3485637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3485640">s3</span>&nbsp;<span class="op" id="3485643">=</span>&nbsp;<span class="builtintype" id="3485645">uint32</span><span class="op" id="3485651">(</span><span class="ident" id="3485652">sbox0</span><span class="op" id="3485657">[</span><span class="ident" id="3485658">t3</span><span class="op" id="3485660">&gt;&gt;</span><span class="num" id="3485662">24</span><span class="op" id="3485664">]</span><span class="op" id="3485665">)</span><span class="op" id="3485666">&lt;&lt;</span><span class="num" id="3485668">24</span>&nbsp;<span class="op" id="3485671">|</span>&nbsp;<span class="builtintype" id="3485673">uint32</span><span class="op" id="3485679">(</span><span class="ident" id="3485680">sbox0</span><span class="op" id="3485685">[</span><span class="ident" id="3485686">t0</span><span class="op" id="3485688">&gt;&gt;</span><span class="num" id="3485690">16</span><span class="op" id="3485692">&amp;</span><span class="num" id="3485693">0xff</span><span class="op" id="3485697">]</span><span class="op" id="3485698">)</span><span class="op" id="3485699">&lt;&lt;</span><span class="num" id="3485701">16</span>&nbsp;<span class="op" id="3485704">|</span>&nbsp;<span class="builtintype" id="3485706">uint32</span><span class="op" id="3485712">(</span><span class="ident" id="3485713">sbox0</span><span class="op" id="3485718">[</span><span class="ident" id="3485719">t1</span><span class="op" id="3485721">&gt;&gt;</span><span class="num" id="3485723">8</span><span class="op" id="3485724">&amp;</span><span class="num" id="3485725">0xff</span><span class="op" id="3485729">]</span><span class="op" id="3485730">)</span><span class="op" id="3485731">&lt;&lt;</span><span class="num" id="3485733">8</span>&nbsp;<span class="op" id="3485735">|</span>&nbsp;<span class="builtintype" id="3485737">uint32</span><span class="op" id="3485743">(</span><span class="ident" id="3485744">sbox0</span><span class="op" id="3485749">[</span><span class="ident" id="3485750">t2</span><span class="op" id="3485752">&amp;</span><span class="num" id="3485753">0xff</span><span class="op" id="3485757">]</span><span class="op" id="3485758">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3485762">s0</span>&nbsp;<span class="op" id="3485765">^=</span>&nbsp;<span class="ident" id="3485768">xk</span><span class="op" id="3485770">[</span><span class="ident" id="3485771">k</span><span class="op" id="3485772">+</span><span class="num" id="3485773">0</span><span class="op" id="3485774">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3485777">s1</span>&nbsp;<span class="op" id="3485780">^=</span>&nbsp;<span class="ident" id="3485783">xk</span><span class="op" id="3485785">[</span><span class="ident" id="3485786">k</span><span class="op" id="3485787">+</span><span class="num" id="3485788">1</span><span class="op" id="3485789">]</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3485792">s2</span>&nbsp;<span class="op" id="3485795">^=</span>&nbsp;<span class="ident" id="3485798">xk</span><span class="op" id="3485800">[</span><span class="ident" id="3485801">k</span><span class="op" id="3485802">+</span><span class="num" id="3485803">2</span><span class="op" id="3485804">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3485807">s3</span>&nbsp;<span class="op" id="3485810">^=</span>&nbsp;<span class="ident" id="3485813">xk</span><span class="op" id="3485815">[</span><span class="ident" id="3485816">k</span><span class="op" id="3485817">+</span><span class="num" id="3485818">3</span><span class="op" id="3485819">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3485823">dst</span><span class="op" id="3485826">[</span><span class="num" id="3485827">0</span><span class="op" id="3485828">]</span><span class="op" id="3485829">,</span>&nbsp;<span class="ident" id="3485831">dst</span><span class="op" id="3485834">[</span><span class="num" id="3485835">1</span><span class="op" id="3485836">]</span><span class="op" id="3485837">,</span>&nbsp;<span class="ident" id="3485839">dst</span><span class="op" id="3485842">[</span><span class="num" id="3485843">2</span><span class="op" id="3485844">]</span><span class="op" id="3485845">,</span>&nbsp;<span class="ident" id="3485847">dst</span><span class="op" id="3485850">[</span><span class="num" id="3485851">3</span><span class="op" id="3485852">]</span>&nbsp;<span class="op" id="3485854">=</span>&nbsp;<span class="builtintype" id="3485856">byte</span><span class="op" id="3485860">(</span><span class="ident" id="3485861">s0</span><span class="op" id="3485863">&gt;&gt;</span><span class="num" id="3485865">24</span><span class="op" id="3485867">)</span><span class="op" id="3485868">,</span>&nbsp;<span class="builtintype" id="3485870">byte</span><span class="op" id="3485874">(</span><span class="ident" id="3485875">s0</span><span class="op" id="3485877">&gt;&gt;</span><span class="num" id="3485879">16</span><span class="op" id="3485881">)</span><span class="op" id="3485882">,</span>&nbsp;<span class="builtintype" id="3485884">byte</span><span class="op" id="3485888">(</span><span class="ident" id="3485889">s0</span><span class="op" id="3485891">&gt;&gt;</span><span class="num" id="3485893">8</span><span class="op" id="3485894">)</span><span class="op" id="3485895">,</span>&nbsp;<span class="builtintype" id="3485897">byte</span><span class="op" id="3485901">(</span><span class="ident" id="3485902">s0</span><span class="op" id="3485904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3485907">dst</span><span class="op" id="3485910">[</span><span class="num" id="3485911">4</span><span class="op" id="3485912">]</span><span class="op" id="3485913">,</span>&nbsp;<span class="ident" id="3485915">dst</span><span class="op" id="3485918">[</span><span class="num" id="3485919">5</span><span class="op" id="3485920">]</span><span class="op" id="3485921">,</span>&nbsp;<span class="ident" id="3485923">dst</span><span class="op" id="3485926">[</span><span class="num" id="3485927">6</span><span class="op" id="3485928">]</span><span class="op" id="3485929">,</span>&nbsp;<span class="ident" id="3485931">dst</span><span class="op" id="3485934">[</span><span class="num" id="3485935">7</span><span class="op" id="3485936">]</span>&nbsp;<span class="op" id="3485938">=</span>&nbsp;<span class="builtintype" id="3485940">byte</span><span class="op" id="3485944">(</span><span class="ident" id="3485945">s1</span><span class="op" id="3485947">&gt;&gt;</span><span class="num" id="3485949">24</span><span class="op" id="3485951">)</span><span class="op" id="3485952">,</span>&nbsp;<span class="builtintype" id="3485954">byte</span><span class="op" id="3485958">(</span><span class="ident" id="3485959">s1</span><span class="op" id="3485961">&gt;&gt;</span><span class="num" id="3485963">16</span><span class="op" id="3485965">)</span><span class="op" id="3485966">,</span>&nbsp;<span class="builtintype" id="3485968">byte</span><span class="op" id="3485972">(</span><span class="ident" id="3485973">s1</span><span class="op" id="3485975">&gt;&gt;</span><span class="num" id="3485977">8</span><span class="op" id="3485978">)</span><span class="op" id="3485979">,</span>&nbsp;<span class="builtintype" id="3485981">byte</span><span class="op" id="3485985">(</span><span class="ident" id="3485986">s1</span><span class="op" id="3485988">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3485991">dst</span><span class="op" id="3485994">[</span><span class="num" id="3485995">8</span><span class="op" id="3485996">]</span><span class="op" id="3485997">,</span>&nbsp;<span class="ident" id="3485999">dst</span><span class="op" id="3486002">[</span><span class="num" id="3486003">9</span><span class="op" id="3486004">]</span><span class="op" id="3486005">,</span>&nbsp;<span class="ident" id="3486007">dst</span><span class="op" id="3486010">[</span><span class="num" id="3486011">10</span><span class="op" id="3486013">]</span><span class="op" id="3486014">,</span>&nbsp;<span class="ident" id="3486016">dst</span><span class="op" id="3486019">[</span><span class="num" id="3486020">11</span><span class="op" id="3486022">]</span>&nbsp;<span class="op" id="3486024">=</span>&nbsp;<span class="builtintype" id="3486026">byte</span><span class="op" id="3486030">(</span><span class="ident" id="3486031">s2</span><span class="op" id="3486033">&gt;&gt;</span><span class="num" id="3486035">24</span><span class="op" id="3486037">)</span><span class="op" id="3486038">,</span>&nbsp;<span class="builtintype" id="3486040">byte</span><span class="op" id="3486044">(</span><span class="ident" id="3486045">s2</span><span class="op" id="3486047">&gt;&gt;</span><span class="num" id="3486049">16</span><span class="op" id="3486051">)</span><span class="op" id="3486052">,</span>&nbsp;<span class="builtintype" id="3486054">byte</span><span class="op" id="3486058">(</span><span class="ident" id="3486059">s2</span><span class="op" id="3486061">&gt;&gt;</span><span class="num" id="3486063">8</span><span class="op" id="3486064">)</span><span class="op" id="3486065">,</span>&nbsp;<span class="builtintype" id="3486067">byte</span><span class="op" id="3486071">(</span><span class="ident" id="3486072">s2</span><span class="op" id="3486074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3486077">dst</span><span class="op" id="3486080">[</span><span class="num" id="3486081">12</span><span class="op" id="3486083">]</span><span class="op" id="3486084">,</span>&nbsp;<span class="ident" id="3486086">dst</span><span class="op" id="3486089">[</span><span class="num" id="3486090">13</span><span class="op" id="3486092">]</span><span class="op" id="3486093">,</span>&nbsp;<span class="ident" id="3486095">dst</span><span class="op" id="3486098">[</span><span class="num" id="3486099">14</span><span class="op" id="3486101">]</span><span class="op" id="3486102">,</span>&nbsp;<span class="ident" id="3486104">dst</span><span class="op" id="3486107">[</span><span class="num" id="3486108">15</span><span class="op" id="3486110">]</span>&nbsp;<span class="op" id="3486112">=</span>&nbsp;<span class="builtintype" id="3486114">byte</span><span class="op" id="3486118">(</span><span class="ident" id="3486119">s3</span><span class="op" id="3486121">&gt;&gt;</span><span class="num" id="3486123">24</span><span class="op" id="3486125">)</span><span class="op" id="3486126">,</span>&nbsp;<span class="builtintype" id="3486128">byte</span><span class="op" id="3486132">(</span><span class="ident" id="3486133">s3</span><span class="op" id="3486135">&gt;&gt;</span><span class="num" id="3486137">16</span><span class="op" id="3486139">)</span><span class="op" id="3486140">,</span>&nbsp;<span class="builtintype" id="3486142">byte</span><span class="op" id="3486146">(</span><span class="ident" id="3486147">s3</span><span class="op" id="3486149">&gt;&gt;</span><span class="num" id="3486151">8</span><span class="op" id="3486152">)</span><span class="op" id="3486153">,</span>&nbsp;<span class="builtintype" id="3486155">byte</span><span class="op" id="3486159">(</span><span class="ident" id="3486160">s3</span><span class="op" id="3486162">)</span><br>
<span class="lineno"></span><span class="op" id="3486164">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3486167">//&nbsp;Decrypt&nbsp;one&nbsp;block&nbsp;from&nbsp;src&nbsp;into&nbsp;dst,&nbsp;using&nbsp;the&nbsp;expanded&nbsp;key&nbsp;xk.</span><br>
<span class="lineno">85</span><span class="keyword" id="3486234">func</span>&nbsp;<span class="ident" id="3486239">decryptBlockGo</span><span class="op" id="3486253">(</span><span class="ident" id="3486254">xk</span>&nbsp;<span class="op" id="3486257">[</span><span class="op" id="3486258">]</span><span class="builtintype" id="3486259">uint32</span><span class="op" id="3486265">,</span>&nbsp;<span class="ident" id="3486267">dst</span><span class="op" id="3486270">,</span>&nbsp;<span class="ident" id="3486272">src</span>&nbsp;<span class="op" id="3486276">[</span><span class="op" id="3486277">]</span><span class="builtintype" id="3486278">byte</span><span class="op" id="3486282">)</span>&nbsp;<span class="op" id="3486284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3486287">var</span>&nbsp;<span class="ident" id="3486291">s0</span><span class="op" id="3486293">,</span>&nbsp;<span class="ident" id="3486295">s1</span><span class="op" id="3486297">,</span>&nbsp;<span class="ident" id="3486299">s2</span><span class="op" id="3486301">,</span>&nbsp;<span class="ident" id="3486303">s3</span><span class="op" id="3486305">,</span>&nbsp;<span class="ident" id="3486307">t0</span><span class="op" id="3486309">,</span>&nbsp;<span class="ident" id="3486311">t1</span><span class="op" id="3486313">,</span>&nbsp;<span class="ident" id="3486315">t2</span><span class="op" id="3486317">,</span>&nbsp;<span class="ident" id="3486319">t3</span>&nbsp;<span class="builtintype" id="3486322">uint32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3486331">s0</span>&nbsp;<span class="op" id="3486334">=</span>&nbsp;<span class="builtintype" id="3486336">uint32</span><span class="op" id="3486342">(</span><span class="ident" id="3486343">src</span><span class="op" id="3486346">[</span><span class="num" id="3486347">0</span><span class="op" id="3486348">]</span><span class="op" id="3486349">)</span><span class="op" id="3486350">&lt;&lt;</span><span class="num" id="3486352">24</span>&nbsp;<span class="op" id="3486355">|</span>&nbsp;<span class="builtintype" id="3486357">uint32</span><span class="op" id="3486363">(</span><span class="ident" id="3486364">src</span><span class="op" id="3486367">[</span><span class="num" id="3486368">1</span><span class="op" id="3486369">]</span><span class="op" id="3486370">)</span><span class="op" id="3486371">&lt;&lt;</span><span class="num" id="3486373">16</span>&nbsp;<span class="op" id="3486376">|</span>&nbsp;<span class="builtintype" id="3486378">uint32</span><span class="op" id="3486384">(</span><span class="ident" id="3486385">src</span><span class="op" id="3486388">[</span><span class="num" id="3486389">2</span><span class="op" id="3486390">]</span><span class="op" id="3486391">)</span><span class="op" id="3486392">&lt;&lt;</span><span class="num" id="3486394">8</span>&nbsp;<span class="op" id="3486396">|</span>&nbsp;<span class="builtintype" id="3486398">uint32</span><span class="op" id="3486404">(</span><span class="ident" id="3486405">src</span><span class="op" id="3486408">[</span><span class="num" id="3486409">3</span><span class="op" id="3486410">]</span><span class="op" id="3486411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3486414">s1</span>&nbsp;<span class="op" id="3486417">=</span>&nbsp;<span class="builtintype" id="3486419">uint32</span><span class="op" id="3486425">(</span><span class="ident" id="3486426">src</span><span class="op" id="3486429">[</span><span class="num" id="3486430">4</span><span class="op" id="3486431">]</span><span class="op" id="3486432">)</span><span class="op" id="3486433">&lt;&lt;</span><span class="num" id="3486435">24</span>&nbsp;<span class="op" id="3486438">|</span>&nbsp;<span class="builtintype" id="3486440">uint32</span><span class="op" id="3486446">(</span><span class="ident" id="3486447">src</span><span class="op" id="3486450">[</span><span class="num" id="3486451">5</span><span class="op" id="3486452">]</span><span class="op" id="3486453">)</span><span class="op" id="3486454">&lt;&lt;</span><span class="num" id="3486456">16</span>&nbsp;<span class="op" id="3486459">|</span>&nbsp;<span class="builtintype" id="3486461">uint32</span><span class="op" id="3486467">(</span><span class="ident" id="3486468">src</span><span class="op" id="3486471">[</span><span class="num" id="3486472">6</span><span class="op" id="3486473">]</span><span class="op" id="3486474">)</span><span class="op" id="3486475">&lt;&lt;</span><span class="num" id="3486477">8</span>&nbsp;<span class="op" id="3486479">|</span>&nbsp;<span class="builtintype" id="3486481">uint32</span><span class="op" id="3486487">(</span><span class="ident" id="3486488">src</span><span class="op" id="3486491">[</span><span class="num" id="3486492">7</span><span class="op" id="3486493">]</span><span class="op" id="3486494">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3486497">s2</span>&nbsp;<span class="op" id="3486500">=</span>&nbsp;<span class="builtintype" id="3486502">uint32</span><span class="op" id="3486508">(</span><span class="ident" id="3486509">src</span><span class="op" id="3486512">[</span><span class="num" id="3486513">8</span><span class="op" id="3486514">]</span><span class="op" id="3486515">)</span><span class="op" id="3486516">&lt;&lt;</span><span class="num" id="3486518">24</span>&nbsp;<span class="op" id="3486521">|</span>&nbsp;<span class="builtintype" id="3486523">uint32</span><span class="op" id="3486529">(</span><span class="ident" id="3486530">src</span><span class="op" id="3486533">[</span><span class="num" id="3486534">9</span><span class="op" id="3486535">]</span><span class="op" id="3486536">)</span><span class="op" id="3486537">&lt;&lt;</span><span class="num" id="3486539">16</span>&nbsp;<span class="op" id="3486542">|</span>&nbsp;<span class="builtintype" id="3486544">uint32</span><span class="op" id="3486550">(</span><span class="ident" id="3486551">src</span><span class="op" id="3486554">[</span><span class="num" id="3486555">10</span><span class="op" id="3486557">]</span><span class="op" id="3486558">)</span><span class="op" id="3486559">&lt;&lt;</span><span class="num" id="3486561">8</span>&nbsp;<span class="op" id="3486563">|</span>&nbsp;<span class="builtintype" id="3486565">uint32</span><span class="op" id="3486571">(</span><span class="ident" id="3486572">src</span><span class="op" id="3486575">[</span><span class="num" id="3486576">11</span><span class="op" id="3486578">]</span><span class="op" id="3486579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3486582">s3</span>&nbsp;<span class="op" id="3486585">=</span>&nbsp;<span class="builtintype" id="3486587">uint32</span><span class="op" id="3486593">(</span><span class="ident" id="3486594">src</span><span class="op" id="3486597">[</span><span class="num" id="3486598">12</span><span class="op" id="3486600">]</span><span class="op" id="3486601">)</span><span class="op" id="3486602">&lt;&lt;</span><span class="num" id="3486604">24</span>&nbsp;<span class="op" id="3486607">|</span>&nbsp;<span class="builtintype" id="3486609">uint32</span><span class="op" id="3486615">(</span><span class="ident" id="3486616">src</span><span class="op" id="3486619">[</span><span class="num" id="3486620">13</span><span class="op" id="3486622">]</span><span class="op" id="3486623">)</span><span class="op" id="3486624">&lt;&lt;</span><span class="num" id="3486626">16</span>&nbsp;<span class="op" id="3486629">|</span>&nbsp;<span class="builtintype" id="3486631">uint32</span><span class="op" id="3486637">(</span><span class="ident" id="3486638">src</span><span class="op" id="3486641">[</span><span class="num" id="3486642">14</span><span class="op" id="3486644">]</span><span class="op" id="3486645">)</span><span class="op" id="3486646">&lt;&lt;</span><span class="num" id="3486648">8</span>&nbsp;<span class="op" id="3486650">|</span>&nbsp;<span class="builtintype" id="3486652">uint32</span><span class="op" id="3486658">(</span><span class="ident" id="3486659">src</span><span class="op" id="3486662">[</span><span class="num" id="3486663">15</span><span class="op" id="3486665">]</span><span class="op" id="3486666">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3486670">//&nbsp;First&nbsp;round&nbsp;just&nbsp;XORs&nbsp;input&nbsp;with&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3486712">s0</span>&nbsp;<span class="op" id="3486715">^=</span>&nbsp;<span class="ident" id="3486718">xk</span><span class="op" id="3486720">[</span><span class="num" id="3486721">0</span><span class="op" id="3486722">]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3486725">s1</span>&nbsp;<span class="op" id="3486728">^=</span>&nbsp;<span class="ident" id="3486731">xk</span><span class="op" id="3486733">[</span><span class="num" id="3486734">1</span><span class="op" id="3486735">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3486738">s2</span>&nbsp;<span class="op" id="3486741">^=</span>&nbsp;<span class="ident" id="3486744">xk</span><span class="op" id="3486746">[</span><span class="num" id="3486747">2</span><span class="op" id="3486748">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3486751">s3</span>&nbsp;<span class="op" id="3486754">^=</span>&nbsp;<span class="ident" id="3486757">xk</span><span class="op" id="3486759">[</span><span class="num" id="3486760">3</span><span class="op" id="3486761">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3486765">//&nbsp;Middle&nbsp;rounds&nbsp;shuffle&nbsp;using&nbsp;tables.</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3486805">//&nbsp;Number&nbsp;of&nbsp;rounds&nbsp;is&nbsp;set&nbsp;by&nbsp;length&nbsp;of&nbsp;expanded&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3486860">nr</span>&nbsp;<span class="op" id="3486863">:=</span>&nbsp;<span class="builtinfunc" id="3486866">len</span><span class="op" id="3486869">(</span><span class="ident" id="3486870">xk</span><span class="op" id="3486872">)</span><span class="op" id="3486873">/</span><span class="num" id="3486874">4</span>&nbsp;<span class="op" id="3486876">-</span>&nbsp;<span class="num" id="3486878">2</span>&nbsp;<span class="comment" id="3486880">//&nbsp;-&nbsp;2:&nbsp;one&nbsp;above,&nbsp;one&nbsp;more&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3486915">k</span>&nbsp;<span class="op" id="3486917">:=</span>&nbsp;<span class="num" id="3486920">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3486923">for</span>&nbsp;<span class="ident" id="3486927">r</span>&nbsp;<span class="op" id="3486929">:=</span>&nbsp;<span class="num" id="3486932">0</span><span class="op" id="3486933">;</span>&nbsp;<span class="ident" id="3486935">r</span>&nbsp;<span class="op" id="3486937">&lt;</span>&nbsp;<span class="ident" id="3486939">nr</span><span class="op" id="3486941">;</span>&nbsp;<span class="ident" id="3486943">r</span><span class="op" id="3486944">++</span>&nbsp;<span class="op" id="3486947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3486951">t0</span>&nbsp;<span class="op" id="3486954">=</span>&nbsp;<span class="ident" id="3486956">xk</span><span class="op" id="3486958">[</span><span class="ident" id="3486959">k</span><span class="op" id="3486960">+</span><span class="num" id="3486961">0</span><span class="op" id="3486962">]</span>&nbsp;<span class="op" id="3486964">^</span>&nbsp;<span class="ident" id="3486966">td0</span><span class="op" id="3486969">[</span><span class="builtintype" id="3486970">uint8</span><span class="op" id="3486975">(</span><span class="ident" id="3486976">s0</span><span class="op" id="3486978">&gt;&gt;</span><span class="num" id="3486980">24</span><span class="op" id="3486982">)</span><span class="op" id="3486983">]</span>&nbsp;<span class="op" id="3486985">^</span>&nbsp;<span class="ident" id="3486987">td1</span><span class="op" id="3486990">[</span><span class="builtintype" id="3486991">uint8</span><span class="op" id="3486996">(</span><span class="ident" id="3486997">s3</span><span class="op" id="3486999">&gt;&gt;</span><span class="num" id="3487001">16</span><span class="op" id="3487003">)</span><span class="op" id="3487004">]</span>&nbsp;<span class="op" id="3487006">^</span>&nbsp;<span class="ident" id="3487008">td2</span><span class="op" id="3487011">[</span><span class="builtintype" id="3487012">uint8</span><span class="op" id="3487017">(</span><span class="ident" id="3487018">s2</span><span class="op" id="3487020">&gt;&gt;</span><span class="num" id="3487022">8</span><span class="op" id="3487023">)</span><span class="op" id="3487024">]</span>&nbsp;<span class="op" id="3487026">^</span>&nbsp;<span class="ident" id="3487028">td3</span><span class="op" id="3487031">[</span><span class="builtintype" id="3487032">uint8</span><span class="op" id="3487037">(</span><span class="ident" id="3487038">s1</span><span class="op" id="3487040">)</span><span class="op" id="3487041">]</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3487045">t1</span>&nbsp;<span class="op" id="3487048">=</span>&nbsp;<span class="ident" id="3487050">xk</span><span class="op" id="3487052">[</span><span class="ident" id="3487053">k</span><span class="op" id="3487054">+</span><span class="num" id="3487055">1</span><span class="op" id="3487056">]</span>&nbsp;<span class="op" id="3487058">^</span>&nbsp;<span class="ident" id="3487060">td0</span><span class="op" id="3487063">[</span><span class="builtintype" id="3487064">uint8</span><span class="op" id="3487069">(</span><span class="ident" id="3487070">s1</span><span class="op" id="3487072">&gt;&gt;</span><span class="num" id="3487074">24</span><span class="op" id="3487076">)</span><span class="op" id="3487077">]</span>&nbsp;<span class="op" id="3487079">^</span>&nbsp;<span class="ident" id="3487081">td1</span><span class="op" id="3487084">[</span><span class="builtintype" id="3487085">uint8</span><span class="op" id="3487090">(</span><span class="ident" id="3487091">s0</span><span class="op" id="3487093">&gt;&gt;</span><span class="num" id="3487095">16</span><span class="op" id="3487097">)</span><span class="op" id="3487098">]</span>&nbsp;<span class="op" id="3487100">^</span>&nbsp;<span class="ident" id="3487102">td2</span><span class="op" id="3487105">[</span><span class="builtintype" id="3487106">uint8</span><span class="op" id="3487111">(</span><span class="ident" id="3487112">s3</span><span class="op" id="3487114">&gt;&gt;</span><span class="num" id="3487116">8</span><span class="op" id="3487117">)</span><span class="op" id="3487118">]</span>&nbsp;<span class="op" id="3487120">^</span>&nbsp;<span class="ident" id="3487122">td3</span><span class="op" id="3487125">[</span><span class="builtintype" id="3487126">uint8</span><span class="op" id="3487131">(</span><span class="ident" id="3487132">s2</span><span class="op" id="3487134">)</span><span class="op" id="3487135">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3487139">t2</span>&nbsp;<span class="op" id="3487142">=</span>&nbsp;<span class="ident" id="3487144">xk</span><span class="op" id="3487146">[</span><span class="ident" id="3487147">k</span><span class="op" id="3487148">+</span><span class="num" id="3487149">2</span><span class="op" id="3487150">]</span>&nbsp;<span class="op" id="3487152">^</span>&nbsp;<span class="ident" id="3487154">td0</span><span class="op" id="3487157">[</span><span class="builtintype" id="3487158">uint8</span><span class="op" id="3487163">(</span><span class="ident" id="3487164">s2</span><span class="op" id="3487166">&gt;&gt;</span><span class="num" id="3487168">24</span><span class="op" id="3487170">)</span><span class="op" id="3487171">]</span>&nbsp;<span class="op" id="3487173">^</span>&nbsp;<span class="ident" id="3487175">td1</span><span class="op" id="3487178">[</span><span class="builtintype" id="3487179">uint8</span><span class="op" id="3487184">(</span><span class="ident" id="3487185">s1</span><span class="op" id="3487187">&gt;&gt;</span><span class="num" id="3487189">16</span><span class="op" id="3487191">)</span><span class="op" id="3487192">]</span>&nbsp;<span class="op" id="3487194">^</span>&nbsp;<span class="ident" id="3487196">td2</span><span class="op" id="3487199">[</span><span class="builtintype" id="3487200">uint8</span><span class="op" id="3487205">(</span><span class="ident" id="3487206">s0</span><span class="op" id="3487208">&gt;&gt;</span><span class="num" id="3487210">8</span><span class="op" id="3487211">)</span><span class="op" id="3487212">]</span>&nbsp;<span class="op" id="3487214">^</span>&nbsp;<span class="ident" id="3487216">td3</span><span class="op" id="3487219">[</span><span class="builtintype" id="3487220">uint8</span><span class="op" id="3487225">(</span><span class="ident" id="3487226">s3</span><span class="op" id="3487228">)</span><span class="op" id="3487229">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3487233">t3</span>&nbsp;<span class="op" id="3487236">=</span>&nbsp;<span class="ident" id="3487238">xk</span><span class="op" id="3487240">[</span><span class="ident" id="3487241">k</span><span class="op" id="3487242">+</span><span class="num" id="3487243">3</span><span class="op" id="3487244">]</span>&nbsp;<span class="op" id="3487246">^</span>&nbsp;<span class="ident" id="3487248">td0</span><span class="op" id="3487251">[</span><span class="builtintype" id="3487252">uint8</span><span class="op" id="3487257">(</span><span class="ident" id="3487258">s3</span><span class="op" id="3487260">&gt;&gt;</span><span class="num" id="3487262">24</span><span class="op" id="3487264">)</span><span class="op" id="3487265">]</span>&nbsp;<span class="op" id="3487267">^</span>&nbsp;<span class="ident" id="3487269">td1</span><span class="op" id="3487272">[</span><span class="builtintype" id="3487273">uint8</span><span class="op" id="3487278">(</span><span class="ident" id="3487279">s2</span><span class="op" id="3487281">&gt;&gt;</span><span class="num" id="3487283">16</span><span class="op" id="3487285">)</span><span class="op" id="3487286">]</span>&nbsp;<span class="op" id="3487288">^</span>&nbsp;<span class="ident" id="3487290">td2</span><span class="op" id="3487293">[</span><span class="builtintype" id="3487294">uint8</span><span class="op" id="3487299">(</span><span class="ident" id="3487300">s1</span><span class="op" id="3487302">&gt;&gt;</span><span class="num" id="3487304">8</span><span class="op" id="3487305">)</span><span class="op" id="3487306">]</span>&nbsp;<span class="op" id="3487308">^</span>&nbsp;<span class="ident" id="3487310">td3</span><span class="op" id="3487313">[</span><span class="builtintype" id="3487314">uint8</span><span class="op" id="3487319">(</span><span class="ident" id="3487320">s0</span><span class="op" id="3487322">)</span><span class="op" id="3487323">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3487327">k</span>&nbsp;<span class="op" id="3487329">+=</span>&nbsp;<span class="num" id="3487332">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3487336">s0</span><span class="op" id="3487338">,</span>&nbsp;<span class="ident" id="3487340">s1</span><span class="op" id="3487342">,</span>&nbsp;<span class="ident" id="3487344">s2</span><span class="op" id="3487346">,</span>&nbsp;<span class="ident" id="3487348">s3</span>&nbsp;<span class="op" id="3487351">=</span>&nbsp;<span class="ident" id="3487353">t0</span><span class="op" id="3487355">,</span>&nbsp;<span class="ident" id="3487357">t1</span><span class="op" id="3487359">,</span>&nbsp;<span class="ident" id="3487361">t2</span><span class="op" id="3487363">,</span>&nbsp;<span class="ident" id="3487365">t3</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3487369">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3487373">//&nbsp;Last&nbsp;round&nbsp;uses&nbsp;s-box&nbsp;directly&nbsp;and&nbsp;XORs&nbsp;to&nbsp;produce&nbsp;output.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3487436">s0</span>&nbsp;<span class="op" id="3487439">=</span>&nbsp;<span class="builtintype" id="3487441">uint32</span><span class="op" id="3487447">(</span><span class="ident" id="3487448">sbox1</span><span class="op" id="3487453">[</span><span class="ident" id="3487454">t0</span><span class="op" id="3487456">&gt;&gt;</span><span class="num" id="3487458">24</span><span class="op" id="3487460">]</span><span class="op" id="3487461">)</span><span class="op" id="3487462">&lt;&lt;</span><span class="num" id="3487464">24</span>&nbsp;<span class="op" id="3487467">|</span>&nbsp;<span class="builtintype" id="3487469">uint32</span><span class="op" id="3487475">(</span><span class="ident" id="3487476">sbox1</span><span class="op" id="3487481">[</span><span class="ident" id="3487482">t3</span><span class="op" id="3487484">&gt;&gt;</span><span class="num" id="3487486">16</span><span class="op" id="3487488">&amp;</span><span class="num" id="3487489">0xff</span><span class="op" id="3487493">]</span><span class="op" id="3487494">)</span><span class="op" id="3487495">&lt;&lt;</span><span class="num" id="3487497">16</span>&nbsp;<span class="op" id="3487500">|</span>&nbsp;<span class="builtintype" id="3487502">uint32</span><span class="op" id="3487508">(</span><span class="ident" id="3487509">sbox1</span><span class="op" id="3487514">[</span><span class="ident" id="3487515">t2</span><span class="op" id="3487517">&gt;&gt;</span><span class="num" id="3487519">8</span><span class="op" id="3487520">&amp;</span><span class="num" id="3487521">0xff</span><span class="op" id="3487525">]</span><span class="op" id="3487526">)</span><span class="op" id="3487527">&lt;&lt;</span><span class="num" id="3487529">8</span>&nbsp;<span class="op" id="3487531">|</span>&nbsp;<span class="builtintype" id="3487533">uint32</span><span class="op" id="3487539">(</span><span class="ident" id="3487540">sbox1</span><span class="op" id="3487545">[</span><span class="ident" id="3487546">t1</span><span class="op" id="3487548">&amp;</span><span class="num" id="3487549">0xff</span><span class="op" id="3487553">]</span><span class="op" id="3487554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3487557">s1</span>&nbsp;<span class="op" id="3487560">=</span>&nbsp;<span class="builtintype" id="3487562">uint32</span><span class="op" id="3487568">(</span><span class="ident" id="3487569">sbox1</span><span class="op" id="3487574">[</span><span class="ident" id="3487575">t1</span><span class="op" id="3487577">&gt;&gt;</span><span class="num" id="3487579">24</span><span class="op" id="3487581">]</span><span class="op" id="3487582">)</span><span class="op" id="3487583">&lt;&lt;</span><span class="num" id="3487585">24</span>&nbsp;<span class="op" id="3487588">|</span>&nbsp;<span class="builtintype" id="3487590">uint32</span><span class="op" id="3487596">(</span><span class="ident" id="3487597">sbox1</span><span class="op" id="3487602">[</span><span class="ident" id="3487603">t0</span><span class="op" id="3487605">&gt;&gt;</span><span class="num" id="3487607">16</span><span class="op" id="3487609">&amp;</span><span class="num" id="3487610">0xff</span><span class="op" id="3487614">]</span><span class="op" id="3487615">)</span><span class="op" id="3487616">&lt;&lt;</span><span class="num" id="3487618">16</span>&nbsp;<span class="op" id="3487621">|</span>&nbsp;<span class="builtintype" id="3487623">uint32</span><span class="op" id="3487629">(</span><span class="ident" id="3487630">sbox1</span><span class="op" id="3487635">[</span><span class="ident" id="3487636">t3</span><span class="op" id="3487638">&gt;&gt;</span><span class="num" id="3487640">8</span><span class="op" id="3487641">&amp;</span><span class="num" id="3487642">0xff</span><span class="op" id="3487646">]</span><span class="op" id="3487647">)</span><span class="op" id="3487648">&lt;&lt;</span><span class="num" id="3487650">8</span>&nbsp;<span class="op" id="3487652">|</span>&nbsp;<span class="builtintype" id="3487654">uint32</span><span class="op" id="3487660">(</span><span class="ident" id="3487661">sbox1</span><span class="op" id="3487666">[</span><span class="ident" id="3487667">t2</span><span class="op" id="3487669">&amp;</span><span class="num" id="3487670">0xff</span><span class="op" id="3487674">]</span><span class="op" id="3487675">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3487678">s2</span>&nbsp;<span class="op" id="3487681">=</span>&nbsp;<span class="builtintype" id="3487683">uint32</span><span class="op" id="3487689">(</span><span class="ident" id="3487690">sbox1</span><span class="op" id="3487695">[</span><span class="ident" id="3487696">t2</span><span class="op" id="3487698">&gt;&gt;</span><span class="num" id="3487700">24</span><span class="op" id="3487702">]</span><span class="op" id="3487703">)</span><span class="op" id="3487704">&lt;&lt;</span><span class="num" id="3487706">24</span>&nbsp;<span class="op" id="3487709">|</span>&nbsp;<span class="builtintype" id="3487711">uint32</span><span class="op" id="3487717">(</span><span class="ident" id="3487718">sbox1</span><span class="op" id="3487723">[</span><span class="ident" id="3487724">t1</span><span class="op" id="3487726">&gt;&gt;</span><span class="num" id="3487728">16</span><span class="op" id="3487730">&amp;</span><span class="num" id="3487731">0xff</span><span class="op" id="3487735">]</span><span class="op" id="3487736">)</span><span class="op" id="3487737">&lt;&lt;</span><span class="num" id="3487739">16</span>&nbsp;<span class="op" id="3487742">|</span>&nbsp;<span class="builtintype" id="3487744">uint32</span><span class="op" id="3487750">(</span><span class="ident" id="3487751">sbox1</span><span class="op" id="3487756">[</span><span class="ident" id="3487757">t0</span><span class="op" id="3487759">&gt;&gt;</span><span class="num" id="3487761">8</span><span class="op" id="3487762">&amp;</span><span class="num" id="3487763">0xff</span><span class="op" id="3487767">]</span><span class="op" id="3487768">)</span><span class="op" id="3487769">&lt;&lt;</span><span class="num" id="3487771">8</span>&nbsp;<span class="op" id="3487773">|</span>&nbsp;<span class="builtintype" id="3487775">uint32</span><span class="op" id="3487781">(</span><span class="ident" id="3487782">sbox1</span><span class="op" id="3487787">[</span><span class="ident" id="3487788">t3</span><span class="op" id="3487790">&amp;</span><span class="num" id="3487791">0xff</span><span class="op" id="3487795">]</span><span class="op" id="3487796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3487799">s3</span>&nbsp;<span class="op" id="3487802">=</span>&nbsp;<span class="builtintype" id="3487804">uint32</span><span class="op" id="3487810">(</span><span class="ident" id="3487811">sbox1</span><span class="op" id="3487816">[</span><span class="ident" id="3487817">t3</span><span class="op" id="3487819">&gt;&gt;</span><span class="num" id="3487821">24</span><span class="op" id="3487823">]</span><span class="op" id="3487824">)</span><span class="op" id="3487825">&lt;&lt;</span><span class="num" id="3487827">24</span>&nbsp;<span class="op" id="3487830">|</span>&nbsp;<span class="builtintype" id="3487832">uint32</span><span class="op" id="3487838">(</span><span class="ident" id="3487839">sbox1</span><span class="op" id="3487844">[</span><span class="ident" id="3487845">t2</span><span class="op" id="3487847">&gt;&gt;</span><span class="num" id="3487849">16</span><span class="op" id="3487851">&amp;</span><span class="num" id="3487852">0xff</span><span class="op" id="3487856">]</span><span class="op" id="3487857">)</span><span class="op" id="3487858">&lt;&lt;</span><span class="num" id="3487860">16</span>&nbsp;<span class="op" id="3487863">|</span>&nbsp;<span class="builtintype" id="3487865">uint32</span><span class="op" id="3487871">(</span><span class="ident" id="3487872">sbox1</span><span class="op" id="3487877">[</span><span class="ident" id="3487878">t1</span><span class="op" id="3487880">&gt;&gt;</span><span class="num" id="3487882">8</span><span class="op" id="3487883">&amp;</span><span class="num" id="3487884">0xff</span><span class="op" id="3487888">]</span><span class="op" id="3487889">)</span><span class="op" id="3487890">&lt;&lt;</span><span class="num" id="3487892">8</span>&nbsp;<span class="op" id="3487894">|</span>&nbsp;<span class="builtintype" id="3487896">uint32</span><span class="op" id="3487902">(</span><span class="ident" id="3487903">sbox1</span><span class="op" id="3487908">[</span><span class="ident" id="3487909">t0</span><span class="op" id="3487911">&amp;</span><span class="num" id="3487912">0xff</span><span class="op" id="3487916">]</span><span class="op" id="3487917">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3487921">s0</span>&nbsp;<span class="op" id="3487924">^=</span>&nbsp;<span class="ident" id="3487927">xk</span><span class="op" id="3487929">[</span><span class="ident" id="3487930">k</span><span class="op" id="3487931">+</span><span class="num" id="3487932">0</span><span class="op" id="3487933">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3487936">s1</span>&nbsp;<span class="op" id="3487939">^=</span>&nbsp;<span class="ident" id="3487942">xk</span><span class="op" id="3487944">[</span><span class="ident" id="3487945">k</span><span class="op" id="3487946">+</span><span class="num" id="3487947">1</span><span class="op" id="3487948">]</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3487951">s2</span>&nbsp;<span class="op" id="3487954">^=</span>&nbsp;<span class="ident" id="3487957">xk</span><span class="op" id="3487959">[</span><span class="ident" id="3487960">k</span><span class="op" id="3487961">+</span><span class="num" id="3487962">2</span><span class="op" id="3487963">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3487966">s3</span>&nbsp;<span class="op" id="3487969">^=</span>&nbsp;<span class="ident" id="3487972">xk</span><span class="op" id="3487974">[</span><span class="ident" id="3487975">k</span><span class="op" id="3487976">+</span><span class="num" id="3487977">3</span><span class="op" id="3487978">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3487982">dst</span><span class="op" id="3487985">[</span><span class="num" id="3487986">0</span><span class="op" id="3487987">]</span><span class="op" id="3487988">,</span>&nbsp;<span class="ident" id="3487990">dst</span><span class="op" id="3487993">[</span><span class="num" id="3487994">1</span><span class="op" id="3487995">]</span><span class="op" id="3487996">,</span>&nbsp;<span class="ident" id="3487998">dst</span><span class="op" id="3488001">[</span><span class="num" id="3488002">2</span><span class="op" id="3488003">]</span><span class="op" id="3488004">,</span>&nbsp;<span class="ident" id="3488006">dst</span><span class="op" id="3488009">[</span><span class="num" id="3488010">3</span><span class="op" id="3488011">]</span>&nbsp;<span class="op" id="3488013">=</span>&nbsp;<span class="builtintype" id="3488015">byte</span><span class="op" id="3488019">(</span><span class="ident" id="3488020">s0</span><span class="op" id="3488022">&gt;&gt;</span><span class="num" id="3488024">24</span><span class="op" id="3488026">)</span><span class="op" id="3488027">,</span>&nbsp;<span class="builtintype" id="3488029">byte</span><span class="op" id="3488033">(</span><span class="ident" id="3488034">s0</span><span class="op" id="3488036">&gt;&gt;</span><span class="num" id="3488038">16</span><span class="op" id="3488040">)</span><span class="op" id="3488041">,</span>&nbsp;<span class="builtintype" id="3488043">byte</span><span class="op" id="3488047">(</span><span class="ident" id="3488048">s0</span><span class="op" id="3488050">&gt;&gt;</span><span class="num" id="3488052">8</span><span class="op" id="3488053">)</span><span class="op" id="3488054">,</span>&nbsp;<span class="builtintype" id="3488056">byte</span><span class="op" id="3488060">(</span><span class="ident" id="3488061">s0</span><span class="op" id="3488063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3488066">dst</span><span class="op" id="3488069">[</span><span class="num" id="3488070">4</span><span class="op" id="3488071">]</span><span class="op" id="3488072">,</span>&nbsp;<span class="ident" id="3488074">dst</span><span class="op" id="3488077">[</span><span class="num" id="3488078">5</span><span class="op" id="3488079">]</span><span class="op" id="3488080">,</span>&nbsp;<span class="ident" id="3488082">dst</span><span class="op" id="3488085">[</span><span class="num" id="3488086">6</span><span class="op" id="3488087">]</span><span class="op" id="3488088">,</span>&nbsp;<span class="ident" id="3488090">dst</span><span class="op" id="3488093">[</span><span class="num" id="3488094">7</span><span class="op" id="3488095">]</span>&nbsp;<span class="op" id="3488097">=</span>&nbsp;<span class="builtintype" id="3488099">byte</span><span class="op" id="3488103">(</span><span class="ident" id="3488104">s1</span><span class="op" id="3488106">&gt;&gt;</span><span class="num" id="3488108">24</span><span class="op" id="3488110">)</span><span class="op" id="3488111">,</span>&nbsp;<span class="builtintype" id="3488113">byte</span><span class="op" id="3488117">(</span><span class="ident" id="3488118">s1</span><span class="op" id="3488120">&gt;&gt;</span><span class="num" id="3488122">16</span><span class="op" id="3488124">)</span><span class="op" id="3488125">,</span>&nbsp;<span class="builtintype" id="3488127">byte</span><span class="op" id="3488131">(</span><span class="ident" id="3488132">s1</span><span class="op" id="3488134">&gt;&gt;</span><span class="num" id="3488136">8</span><span class="op" id="3488137">)</span><span class="op" id="3488138">,</span>&nbsp;<span class="builtintype" id="3488140">byte</span><span class="op" id="3488144">(</span><span class="ident" id="3488145">s1</span><span class="op" id="3488147">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3488150">dst</span><span class="op" id="3488153">[</span><span class="num" id="3488154">8</span><span class="op" id="3488155">]</span><span class="op" id="3488156">,</span>&nbsp;<span class="ident" id="3488158">dst</span><span class="op" id="3488161">[</span><span class="num" id="3488162">9</span><span class="op" id="3488163">]</span><span class="op" id="3488164">,</span>&nbsp;<span class="ident" id="3488166">dst</span><span class="op" id="3488169">[</span><span class="num" id="3488170">10</span><span class="op" id="3488172">]</span><span class="op" id="3488173">,</span>&nbsp;<span class="ident" id="3488175">dst</span><span class="op" id="3488178">[</span><span class="num" id="3488179">11</span><span class="op" id="3488181">]</span>&nbsp;<span class="op" id="3488183">=</span>&nbsp;<span class="builtintype" id="3488185">byte</span><span class="op" id="3488189">(</span><span class="ident" id="3488190">s2</span><span class="op" id="3488192">&gt;&gt;</span><span class="num" id="3488194">24</span><span class="op" id="3488196">)</span><span class="op" id="3488197">,</span>&nbsp;<span class="builtintype" id="3488199">byte</span><span class="op" id="3488203">(</span><span class="ident" id="3488204">s2</span><span class="op" id="3488206">&gt;&gt;</span><span class="num" id="3488208">16</span><span class="op" id="3488210">)</span><span class="op" id="3488211">,</span>&nbsp;<span class="builtintype" id="3488213">byte</span><span class="op" id="3488217">(</span><span class="ident" id="3488218">s2</span><span class="op" id="3488220">&gt;&gt;</span><span class="num" id="3488222">8</span><span class="op" id="3488223">)</span><span class="op" id="3488224">,</span>&nbsp;<span class="builtintype" id="3488226">byte</span><span class="op" id="3488230">(</span><span class="ident" id="3488231">s2</span><span class="op" id="3488233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3488236">dst</span><span class="op" id="3488239">[</span><span class="num" id="3488240">12</span><span class="op" id="3488242">]</span><span class="op" id="3488243">,</span>&nbsp;<span class="ident" id="3488245">dst</span><span class="op" id="3488248">[</span><span class="num" id="3488249">13</span><span class="op" id="3488251">]</span><span class="op" id="3488252">,</span>&nbsp;<span class="ident" id="3488254">dst</span><span class="op" id="3488257">[</span><span class="num" id="3488258">14</span><span class="op" id="3488260">]</span><span class="op" id="3488261">,</span>&nbsp;<span class="ident" id="3488263">dst</span><span class="op" id="3488266">[</span><span class="num" id="3488267">15</span><span class="op" id="3488269">]</span>&nbsp;<span class="op" id="3488271">=</span>&nbsp;<span class="builtintype" id="3488273">byte</span><span class="op" id="3488277">(</span><span class="ident" id="3488278">s3</span><span class="op" id="3488280">&gt;&gt;</span><span class="num" id="3488282">24</span><span class="op" id="3488284">)</span><span class="op" id="3488285">,</span>&nbsp;<span class="builtintype" id="3488287">byte</span><span class="op" id="3488291">(</span><span class="ident" id="3488292">s3</span><span class="op" id="3488294">&gt;&gt;</span><span class="num" id="3488296">16</span><span class="op" id="3488298">)</span><span class="op" id="3488299">,</span>&nbsp;<span class="builtintype" id="3488301">byte</span><span class="op" id="3488305">(</span><span class="ident" id="3488306">s3</span><span class="op" id="3488308">&gt;&gt;</span><span class="num" id="3488310">8</span><span class="op" id="3488311">)</span><span class="op" id="3488312">,</span>&nbsp;<span class="builtintype" id="3488314">byte</span><span class="op" id="3488318">(</span><span class="ident" id="3488319">s3</span><span class="op" id="3488321">)</span><br>
<span class="lineno"></span><span class="op" id="3488323">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3488326">//&nbsp;Apply&nbsp;sbox0&nbsp;to&nbsp;each&nbsp;byte&nbsp;in&nbsp;w.</span><br>
<span class="lineno">130</span><span class="keyword" id="3488360">func</span>&nbsp;<span class="ident" id="3488365">subw</span><span class="op" id="3488369">(</span><span class="ident" id="3488370">w</span>&nbsp;<span class="builtintype" id="3488372">uint32</span><span class="op" id="3488378">)</span>&nbsp;<span class="builtintype" id="3488380">uint32</span>&nbsp;<span class="op" id="3488387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3488390">return</span>&nbsp;<span class="builtintype" id="3488397">uint32</span><span class="op" id="3488403">(</span><span class="ident" id="3488404">sbox0</span><span class="op" id="3488409">[</span><span class="ident" id="3488410">w</span><span class="op" id="3488411">&gt;&gt;</span><span class="num" id="3488413">24</span><span class="op" id="3488415">]</span><span class="op" id="3488416">)</span><span class="op" id="3488417">&lt;&lt;</span><span class="num" id="3488419">24</span>&nbsp;<span class="op" id="3488422">|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="3488426">uint32</span><span class="op" id="3488432">(</span><span class="ident" id="3488433">sbox0</span><span class="op" id="3488438">[</span><span class="ident" id="3488439">w</span><span class="op" id="3488440">&gt;&gt;</span><span class="num" id="3488442">16</span><span class="op" id="3488444">&amp;</span><span class="num" id="3488445">0xff</span><span class="op" id="3488449">]</span><span class="op" id="3488450">)</span><span class="op" id="3488451">&lt;&lt;</span><span class="num" id="3488453">16</span>&nbsp;<span class="op" id="3488456">|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="3488460">uint32</span><span class="op" id="3488466">(</span><span class="ident" id="3488467">sbox0</span><span class="op" id="3488472">[</span><span class="ident" id="3488473">w</span><span class="op" id="3488474">&gt;&gt;</span><span class="num" id="3488476">8</span><span class="op" id="3488477">&amp;</span><span class="num" id="3488478">0xff</span><span class="op" id="3488482">]</span><span class="op" id="3488483">)</span><span class="op" id="3488484">&lt;&lt;</span><span class="num" id="3488486">8</span>&nbsp;<span class="op" id="3488488">|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="3488492">uint32</span><span class="op" id="3488498">(</span><span class="ident" id="3488499">sbox0</span><span class="op" id="3488504">[</span><span class="ident" id="3488505">w</span><span class="op" id="3488506">&amp;</span><span class="num" id="3488507">0xff</span><span class="op" id="3488511">]</span><span class="op" id="3488512">)</span><br>
<span class="lineno">135</span><span class="op" id="3488514">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3488517">//&nbsp;Rotate</span><br>
<span class="lineno"></span><span class="keyword" id="3488527">func</span>&nbsp;<span class="ident" id="3488532">rotw</span><span class="op" id="3488536">(</span><span class="ident" id="3488537">w</span>&nbsp;<span class="builtintype" id="3488539">uint32</span><span class="op" id="3488545">)</span>&nbsp;<span class="builtintype" id="3488547">uint32</span>&nbsp;<span class="op" id="3488554">{</span>&nbsp;<span class="keyword" id="3488556">return</span>&nbsp;<span class="ident" id="3488563">w</span><span class="op" id="3488564">&lt;&lt;</span><span class="num" id="3488566">8</span>&nbsp;<span class="op" id="3488568">|</span>&nbsp;<span class="ident" id="3488570">w</span><span class="op" id="3488571">&gt;&gt;</span><span class="num" id="3488573">24</span>&nbsp;<span class="op" id="3488576">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="comment" id="3488579">//&nbsp;Key&nbsp;expansion&nbsp;algorithm.&nbsp;&nbsp;See&nbsp;FIPS-197,&nbsp;Figure&nbsp;11.</span><br>
<span class="lineno"></span><span class="comment" id="3488633">//&nbsp;Their&nbsp;rcon[i]&nbsp;is&nbsp;our&nbsp;powx[i-1]&nbsp;&lt;&lt;&nbsp;24.</span><br>
<span class="lineno"></span><span class="keyword" id="3488674">func</span>&nbsp;<span class="ident" id="3488679">expandKeyGo</span><span class="op" id="3488690">(</span><span class="ident" id="3488691">key</span>&nbsp;<span class="op" id="3488695">[</span><span class="op" id="3488696">]</span><span class="builtintype" id="3488697">byte</span><span class="op" id="3488701">,</span>&nbsp;<span class="ident" id="3488703">enc</span><span class="op" id="3488706">,</span>&nbsp;<span class="ident" id="3488708">dec</span>&nbsp;<span class="op" id="3488712">[</span><span class="op" id="3488713">]</span><span class="builtintype" id="3488714">uint32</span><span class="op" id="3488720">)</span>&nbsp;<span class="op" id="3488722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3488725">//&nbsp;Encryption&nbsp;key&nbsp;setup.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3488751">var</span>&nbsp;<span class="ident" id="3488755">i</span>&nbsp;<span class="builtintype" id="3488757">int</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3488762">nk</span>&nbsp;<span class="op" id="3488765">:=</span>&nbsp;<span class="builtinfunc" id="3488768">len</span><span class="op" id="3488771">(</span><span class="ident" id="3488772">key</span><span class="op" id="3488775">)</span>&nbsp;<span class="op" id="3488777">/</span>&nbsp;<span class="num" id="3488779">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3488782">for</span>&nbsp;<span class="ident" id="3488786">i</span>&nbsp;<span class="op" id="3488788">=</span>&nbsp;<span class="num" id="3488790">0</span><span class="op" id="3488791">;</span>&nbsp;<span class="ident" id="3488793">i</span>&nbsp;<span class="op" id="3488795">&lt;</span>&nbsp;<span class="ident" id="3488797">nk</span><span class="op" id="3488799">;</span>&nbsp;<span class="ident" id="3488801">i</span><span class="op" id="3488802">++</span>&nbsp;<span class="op" id="3488805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3488809">enc</span><span class="op" id="3488812">[</span><span class="ident" id="3488813">i</span><span class="op" id="3488814">]</span>&nbsp;<span class="op" id="3488816">=</span>&nbsp;<span class="builtintype" id="3488818">uint32</span><span class="op" id="3488824">(</span><span class="ident" id="3488825">key</span><span class="op" id="3488828">[</span><span class="num" id="3488829">4</span><span class="op" id="3488830">*</span><span class="ident" id="3488831">i</span><span class="op" id="3488832">]</span><span class="op" id="3488833">)</span><span class="op" id="3488834">&lt;&lt;</span><span class="num" id="3488836">24</span>&nbsp;<span class="op" id="3488839">|</span>&nbsp;<span class="builtintype" id="3488841">uint32</span><span class="op" id="3488847">(</span><span class="ident" id="3488848">key</span><span class="op" id="3488851">[</span><span class="num" id="3488852">4</span><span class="op" id="3488853">*</span><span class="ident" id="3488854">i</span><span class="op" id="3488855">+</span><span class="num" id="3488856">1</span><span class="op" id="3488857">]</span><span class="op" id="3488858">)</span><span class="op" id="3488859">&lt;&lt;</span><span class="num" id="3488861">16</span>&nbsp;<span class="op" id="3488864">|</span>&nbsp;<span class="builtintype" id="3488866">uint32</span><span class="op" id="3488872">(</span><span class="ident" id="3488873">key</span><span class="op" id="3488876">[</span><span class="num" id="3488877">4</span><span class="op" id="3488878">*</span><span class="ident" id="3488879">i</span><span class="op" id="3488880">+</span><span class="num" id="3488881">2</span><span class="op" id="3488882">]</span><span class="op" id="3488883">)</span><span class="op" id="3488884">&lt;&lt;</span><span class="num" id="3488886">8</span>&nbsp;<span class="op" id="3488888">|</span>&nbsp;<span class="builtintype" id="3488890">uint32</span><span class="op" id="3488896">(</span><span class="ident" id="3488897">key</span><span class="op" id="3488900">[</span><span class="num" id="3488901">4</span><span class="op" id="3488902">*</span><span class="ident" id="3488903">i</span><span class="op" id="3488904">+</span><span class="num" id="3488905">3</span><span class="op" id="3488906">]</span><span class="op" id="3488907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3488910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3488913">for</span>&nbsp;<span class="op" id="3488917">;</span>&nbsp;<span class="ident" id="3488919">i</span>&nbsp;<span class="op" id="3488921">&lt;</span>&nbsp;<span class="builtinfunc" id="3488923">len</span><span class="op" id="3488926">(</span><span class="ident" id="3488927">enc</span><span class="op" id="3488930">)</span><span class="op" id="3488931">;</span>&nbsp;<span class="ident" id="3488933">i</span><span class="op" id="3488934">++</span>&nbsp;<span class="op" id="3488937">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3488941">t</span>&nbsp;<span class="op" id="3488943">:=</span>&nbsp;<span class="ident" id="3488946">enc</span><span class="op" id="3488949">[</span><span class="ident" id="3488950">i</span><span class="op" id="3488951">-</span><span class="num" id="3488952">1</span><span class="op" id="3488953">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3488957">if</span>&nbsp;<span class="ident" id="3488960">i</span><span class="op" id="3488961">%</span><span class="ident" id="3488962">nk</span>&nbsp;<span class="op" id="3488965">==</span>&nbsp;<span class="num" id="3488968">0</span>&nbsp;<span class="op" id="3488970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3488975">t</span>&nbsp;<span class="op" id="3488977">=</span>&nbsp;<span class="ident" id="3488979">subw</span><span class="op" id="3488983">(</span><span class="ident" id="3488984">rotw</span><span class="op" id="3488988">(</span><span class="ident" id="3488989">t</span><span class="op" id="3488990">)</span><span class="op" id="3488991">)</span>&nbsp;<span class="op" id="3488993">^</span>&nbsp;<span class="op" id="3488995">(</span><span class="builtintype" id="3488996">uint32</span><span class="op" id="3489002">(</span><span class="ident" id="3489003">powx</span><span class="op" id="3489007">[</span><span class="ident" id="3489008">i</span><span class="op" id="3489009">/</span><span class="ident" id="3489010">nk</span><span class="op" id="3489012">-</span><span class="num" id="3489013">1</span><span class="op" id="3489014">]</span><span class="op" id="3489015">)</span>&nbsp;<span class="op" id="3489017">&lt;&lt;</span>&nbsp;<span class="num" id="3489020">24</span><span class="op" id="3489022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3489026">}</span>&nbsp;<span class="keyword" id="3489028">else</span>&nbsp;<span class="keyword" id="3489033">if</span>&nbsp;<span class="ident" id="3489036">nk</span>&nbsp;<span class="op" id="3489039">&gt;</span>&nbsp;<span class="num" id="3489041">6</span>&nbsp;<span class="op" id="3489043">&amp;&amp;</span>&nbsp;<span class="ident" id="3489046">i</span><span class="op" id="3489047">%</span><span class="ident" id="3489048">nk</span>&nbsp;<span class="op" id="3489051">==</span>&nbsp;<span class="num" id="3489054">4</span>&nbsp;<span class="op" id="3489056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3489061">t</span>&nbsp;<span class="op" id="3489063">=</span>&nbsp;<span class="ident" id="3489065">subw</span><span class="op" id="3489069">(</span><span class="ident" id="3489070">t</span><span class="op" id="3489071">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3489075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3489079">enc</span><span class="op" id="3489082">[</span><span class="ident" id="3489083">i</span><span class="op" id="3489084">]</span>&nbsp;<span class="op" id="3489086">=</span>&nbsp;<span class="ident" id="3489088">enc</span><span class="op" id="3489091">[</span><span class="ident" id="3489092">i</span><span class="op" id="3489093">-</span><span class="ident" id="3489094">nk</span><span class="op" id="3489096">]</span>&nbsp;<span class="op" id="3489098">^</span>&nbsp;<span class="ident" id="3489100">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3489103">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3489107">//&nbsp;Derive&nbsp;decryption&nbsp;key&nbsp;from&nbsp;encryption&nbsp;key.</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3489154">//&nbsp;Reverse&nbsp;the&nbsp;4-word&nbsp;round&nbsp;key&nbsp;sets&nbsp;from&nbsp;enc&nbsp;to&nbsp;produce&nbsp;dec.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3489217">//&nbsp;All&nbsp;sets&nbsp;but&nbsp;the&nbsp;first&nbsp;and&nbsp;last&nbsp;get&nbsp;the&nbsp;MixColumn&nbsp;transform&nbsp;applied.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3489290">if</span>&nbsp;<span class="ident" id="3489293">dec</span>&nbsp;<span class="op" id="3489297">==</span>&nbsp;<span class="ident" id="3489300">nil</span>&nbsp;<span class="op" id="3489304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3489308">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3489316">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3489319">n</span>&nbsp;<span class="op" id="3489321">:=</span>&nbsp;<span class="builtinfunc" id="3489324">len</span><span class="op" id="3489327">(</span><span class="ident" id="3489328">enc</span><span class="op" id="3489331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3489334">for</span>&nbsp;<span class="ident" id="3489338">i</span>&nbsp;<span class="op" id="3489340">:=</span>&nbsp;<span class="num" id="3489343">0</span><span class="op" id="3489344">;</span>&nbsp;<span class="ident" id="3489346">i</span>&nbsp;<span class="op" id="3489348">&lt;</span>&nbsp;<span class="ident" id="3489350">n</span><span class="op" id="3489351">;</span>&nbsp;<span class="ident" id="3489353">i</span>&nbsp;<span class="op" id="3489355">+=</span>&nbsp;<span class="num" id="3489358">4</span>&nbsp;<span class="op" id="3489360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3489364">ei</span>&nbsp;<span class="op" id="3489367">:=</span>&nbsp;<span class="ident" id="3489370">n</span>&nbsp;<span class="op" id="3489372">-</span>&nbsp;<span class="ident" id="3489374">i</span>&nbsp;<span class="op" id="3489376">-</span>&nbsp;<span class="num" id="3489378">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3489382">for</span>&nbsp;<span class="ident" id="3489386">j</span>&nbsp;<span class="op" id="3489388">:=</span>&nbsp;<span class="num" id="3489391">0</span><span class="op" id="3489392">;</span>&nbsp;<span class="ident" id="3489394">j</span>&nbsp;<span class="op" id="3489396">&lt;</span>&nbsp;<span class="num" id="3489398">4</span><span class="op" id="3489399">;</span>&nbsp;<span class="ident" id="3489401">j</span><span class="op" id="3489402">++</span>&nbsp;<span class="op" id="3489405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3489410">x</span>&nbsp;<span class="op" id="3489412">:=</span>&nbsp;<span class="ident" id="3489415">enc</span><span class="op" id="3489418">[</span><span class="ident" id="3489419">ei</span><span class="op" id="3489421">+</span><span class="ident" id="3489422">j</span><span class="op" id="3489423">]</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3489428">if</span>&nbsp;<span class="ident" id="3489431">i</span>&nbsp;<span class="op" id="3489433">&gt;</span>&nbsp;<span class="num" id="3489435">0</span>&nbsp;<span class="op" id="3489437">&amp;&amp;</span>&nbsp;<span class="ident" id="3489440">i</span><span class="op" id="3489441">+</span><span class="num" id="3489442">4</span>&nbsp;<span class="op" id="3489444">&lt;</span>&nbsp;<span class="ident" id="3489446">n</span>&nbsp;<span class="op" id="3489448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3489454">x</span>&nbsp;<span class="op" id="3489456">=</span>&nbsp;<span class="ident" id="3489458">td0</span><span class="op" id="3489461">[</span><span class="ident" id="3489462">sbox0</span><span class="op" id="3489467">[</span><span class="ident" id="3489468">x</span><span class="op" id="3489469">&gt;&gt;</span><span class="num" id="3489471">24</span><span class="op" id="3489473">]</span><span class="op" id="3489474">]</span>&nbsp;<span class="op" id="3489476">^</span>&nbsp;<span class="ident" id="3489478">td1</span><span class="op" id="3489481">[</span><span class="ident" id="3489482">sbox0</span><span class="op" id="3489487">[</span><span class="ident" id="3489488">x</span><span class="op" id="3489489">&gt;&gt;</span><span class="num" id="3489491">16</span><span class="op" id="3489493">&amp;</span><span class="num" id="3489494">0xff</span><span class="op" id="3489498">]</span><span class="op" id="3489499">]</span>&nbsp;<span class="op" id="3489501">^</span>&nbsp;<span class="ident" id="3489503">td2</span><span class="op" id="3489506">[</span><span class="ident" id="3489507">sbox0</span><span class="op" id="3489512">[</span><span class="ident" id="3489513">x</span><span class="op" id="3489514">&gt;&gt;</span><span class="num" id="3489516">8</span><span class="op" id="3489517">&amp;</span><span class="num" id="3489518">0xff</span><span class="op" id="3489522">]</span><span class="op" id="3489523">]</span>&nbsp;<span class="op" id="3489525">^</span>&nbsp;<span class="ident" id="3489527">td3</span><span class="op" id="3489530">[</span><span class="ident" id="3489531">sbox0</span><span class="op" id="3489536">[</span><span class="ident" id="3489537">x</span><span class="op" id="3489538">&amp;</span><span class="num" id="3489539">0xff</span><span class="op" id="3489543">]</span><span class="op" id="3489544">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3489549">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3489554">dec</span><span class="op" id="3489557">[</span><span class="ident" id="3489558">i</span><span class="op" id="3489559">+</span><span class="ident" id="3489560">j</span><span class="op" id="3489561">]</span>&nbsp;<span class="op" id="3489563">=</span>&nbsp;<span class="ident" id="3489565">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3489569">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3489572">}</span><br>
<span class="lineno"></span><span class="op" id="3489574">}</span>
</div>
</body>
</html>
