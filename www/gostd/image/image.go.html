<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image</h2>
<ul>
<li><a href="/gostd/image/decode_example_test.go.html">decode_example_test.go</a></li>
<li><a href="/gostd/image/decode_test.go.html">decode_test.go</a></li>
<li><a href="/gostd/image/format.go.html">format.go</a></li>
<li><a href="/gostd/image/geom.go.html">geom.go</a></li>
<li><a href="/gostd/image/image.go.html" class="current">image.go</a></li>
<li><a href="/gostd/image/image_test.go.html">image_test.go</a></li>
<li><a href="/gostd/image/names.go.html">names.go</a></li>
<li><a href="/gostd/image/ycbcr.go.html">ycbcr.go</a></li>
<li><a href="/gostd/image/ycbcr_test.go.html">ycbcr_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5633623">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5633678">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5633732">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5633783">//&nbsp;Package&nbsp;image&nbsp;implements&nbsp;a&nbsp;basic&nbsp;2-D&nbsp;image&nbsp;library.</span><br>
<span class="lineno"></span><span class="comment" id="5633838">//</span><br>
<span class="lineno"></span><span class="comment" id="5633841">//&nbsp;The&nbsp;fundamental&nbsp;interface&nbsp;is&nbsp;called&nbsp;Image.&nbsp;An&nbsp;Image&nbsp;contains&nbsp;colors,&nbsp;which</span><br>
<span class="lineno"></span><span class="comment" id="5633919">//&nbsp;are&nbsp;described&nbsp;in&nbsp;the&nbsp;image/color&nbsp;package.</span><br>
<span class="lineno"></span><span class="comment" id="5633964">//</span><br>
<span class="lineno">10</span><span class="comment" id="5633967">//&nbsp;Values&nbsp;of&nbsp;the&nbsp;Image&nbsp;interface&nbsp;are&nbsp;created&nbsp;either&nbsp;by&nbsp;calling&nbsp;functions&nbsp;such</span><br>
<span class="lineno"></span><span class="comment" id="5634045">//&nbsp;as&nbsp;NewRGBA&nbsp;and&nbsp;NewPaletted,&nbsp;or&nbsp;by&nbsp;calling&nbsp;Decode&nbsp;on&nbsp;an&nbsp;io.Reader&nbsp;containing</span><br>
<span class="lineno"></span><span class="comment" id="5634124">//&nbsp;image&nbsp;data&nbsp;in&nbsp;a&nbsp;format&nbsp;such&nbsp;as&nbsp;GIF,&nbsp;JPEG&nbsp;or&nbsp;PNG.&nbsp;Decoding&nbsp;any&nbsp;particular</span><br>
<span class="lineno"></span><span class="comment" id="5634200">//&nbsp;image&nbsp;format&nbsp;requires&nbsp;the&nbsp;prior&nbsp;registration&nbsp;of&nbsp;a&nbsp;decoder&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="5634271">//&nbsp;Registration&nbsp;is&nbsp;typically&nbsp;automatic&nbsp;as&nbsp;a&nbsp;side&nbsp;effect&nbsp;of&nbsp;initializing&nbsp;that</span><br>
<span class="lineno">15</span><span class="comment" id="5634348">//&nbsp;format&#39;s&nbsp;package&nbsp;so&nbsp;that,&nbsp;to&nbsp;decode&nbsp;a&nbsp;PNG&nbsp;image,&nbsp;it&nbsp;suffices&nbsp;to&nbsp;have</span><br>
<span class="lineno"></span><span class="comment" id="5634420">//&nbsp;&nbsp;&nbsp;&nbsp;import&nbsp;_&nbsp;&#34;image/png&#34;</span><br>
<span class="lineno"></span><span class="comment" id="5634444">//&nbsp;in&nbsp;a&nbsp;program&#39;s&nbsp;main&nbsp;package.&nbsp;The&nbsp;_&nbsp;means&nbsp;to&nbsp;import&nbsp;a&nbsp;package&nbsp;purely&nbsp;for&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="5634523">//&nbsp;initialization&nbsp;side&nbsp;effects.</span><br>
<span class="lineno"></span><span class="comment" id="5634555">//</span><br>
<span class="lineno">20</span><span class="comment" id="5634558">//&nbsp;See&nbsp;&#34;The&nbsp;Go&nbsp;image&nbsp;package&#34;&nbsp;for&nbsp;more&nbsp;details:</span><br>
<span class="lineno"></span><span class="comment" id="5634606">//&nbsp;http://golang.org/doc/articles/image_package.html</span><br>
<span class="lineno"></span><span class="keyword" id="5634659">package</span>&nbsp;<span class="ident" id="5634667">image</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5634674">import</span>&nbsp;<span class="op" id="5634681">(</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5634684">&#34;image/color&#34;</span><br>
<span class="lineno"></span><span class="op" id="5634698">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5634701">//&nbsp;Config&nbsp;holds&nbsp;an&nbsp;image&#39;s&nbsp;color&nbsp;model&nbsp;and&nbsp;dimensions.</span><br>
<span class="lineno"></span><span class="keyword" id="5634756">type</span>&nbsp;<span class="ident" id="5634761">Config</span>&nbsp;<span class="keyword" id="5634768">struct</span>&nbsp;<span class="op" id="5634775">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5634778">ColorModel</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5634792">color</span><span class="op" id="5634797">.</span><span class="ident" id="5634798">Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5634805">Width</span><span class="op" id="5634810">,</span>&nbsp;<span class="ident" id="5634812">Height</span>&nbsp;<span class="builtintype" id="5634819">int</span><br>
<span class="lineno"></span><span class="op" id="5634823">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5634826">//&nbsp;Image&nbsp;is&nbsp;a&nbsp;finite&nbsp;rectangular&nbsp;grid&nbsp;of&nbsp;color.Color&nbsp;values&nbsp;taken&nbsp;from&nbsp;a&nbsp;color</span><br>
<span class="lineno">35</span><span class="comment" id="5634905">//&nbsp;model.</span><br>
<span class="lineno"></span><span class="keyword" id="5634915">type</span>&nbsp;<span class="ident" id="5634920">Image</span>&nbsp;<span class="keyword" id="5634926">interface</span>&nbsp;<span class="op" id="5634936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5634939">//&nbsp;ColorModel&nbsp;returns&nbsp;the&nbsp;Image&#39;s&nbsp;color&nbsp;model.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5634987">ColorModel</span><span class="op" id="5634997">(</span><span class="op" id="5634998">)</span>&nbsp;<span class="ident" id="5635000">color</span><span class="op" id="5635005">.</span><span class="ident" id="5635006">Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5635013">//&nbsp;Bounds&nbsp;returns&nbsp;the&nbsp;domain&nbsp;for&nbsp;which&nbsp;At&nbsp;can&nbsp;return&nbsp;non-zero&nbsp;color.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5635083">//&nbsp;The&nbsp;bounds&nbsp;do&nbsp;not&nbsp;necessarily&nbsp;contain&nbsp;the&nbsp;point&nbsp;(0,&nbsp;0).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5635143">Bounds</span><span class="op" id="5635149">(</span><span class="op" id="5635150">)</span>&nbsp;<span class="ident" id="5635152">Rectangle</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5635163">//&nbsp;At&nbsp;returns&nbsp;the&nbsp;color&nbsp;of&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5635212">//&nbsp;At(Bounds().Min.X,&nbsp;Bounds().Min.Y)&nbsp;returns&nbsp;the&nbsp;upper-left&nbsp;pixel&nbsp;of&nbsp;the&nbsp;grid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5635293">//&nbsp;At(Bounds().Max.X-1,&nbsp;Bounds().Max.Y-1)&nbsp;returns&nbsp;the&nbsp;lower-right&nbsp;one.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5635365">At</span><span class="op" id="5635367">(</span><span class="ident" id="5635368">x</span><span class="op" id="5635369">,</span>&nbsp;<span class="ident" id="5635371">y</span>&nbsp;<span class="builtintype" id="5635373">int</span><span class="op" id="5635376">)</span>&nbsp;<span class="ident" id="5635378">color</span><span class="op" id="5635383">.</span><span class="ident" id="5635384">Color</span><br>
<span class="lineno"></span><span class="op" id="5635390">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5635393">//&nbsp;PalettedImage&nbsp;is&nbsp;an&nbsp;image&nbsp;whose&nbsp;colors&nbsp;may&nbsp;come&nbsp;from&nbsp;a&nbsp;limited&nbsp;palette.</span><br>
<span class="lineno"></span><span class="comment" id="5635468">//&nbsp;If&nbsp;m&nbsp;is&nbsp;a&nbsp;PalettedImage&nbsp;and&nbsp;m.ColorModel()&nbsp;returns&nbsp;a&nbsp;PalettedColorModel&nbsp;p,</span><br>
<span class="lineno">50</span><span class="comment" id="5635546">//&nbsp;then&nbsp;m.At(x,&nbsp;y)&nbsp;should&nbsp;be&nbsp;equivalent&nbsp;to&nbsp;p[m.ColorIndexAt(x,&nbsp;y)].&nbsp;If&nbsp;m&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="5635621">//&nbsp;color&nbsp;model&nbsp;is&nbsp;not&nbsp;a&nbsp;PalettedColorModel,&nbsp;then&nbsp;ColorIndexAt&#39;s&nbsp;behavior&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5635697">//&nbsp;undefined.</span><br>
<span class="lineno"></span><span class="keyword" id="5635711">type</span>&nbsp;<span class="ident" id="5635716">PalettedImage</span>&nbsp;<span class="keyword" id="5635730">interface</span>&nbsp;<span class="op" id="5635740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5635743">//&nbsp;ColorIndexAt&nbsp;returns&nbsp;the&nbsp;palette&nbsp;index&nbsp;of&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5635810">ColorIndexAt</span><span class="op" id="5635822">(</span><span class="ident" id="5635823">x</span><span class="op" id="5635824">,</span>&nbsp;<span class="ident" id="5635826">y</span>&nbsp;<span class="builtintype" id="5635828">int</span><span class="op" id="5635831">)</span>&nbsp;<span class="builtintype" id="5635833">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5635840">Image</span><br>
<span class="lineno"></span><span class="op" id="5635846">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5635849">//&nbsp;RGBA&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.RGBA&nbsp;values.</span><br>
<span class="lineno">60</span><span class="keyword" id="5635922">type</span>&nbsp;<span class="ident" id="5635927">RGBA</span>&nbsp;<span class="keyword" id="5635932">struct</span>&nbsp;<span class="op" id="5635939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5635942">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;in&nbsp;R,&nbsp;G,&nbsp;B,&nbsp;A&nbsp;order.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5636010">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*4].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5636078">Pix</span>&nbsp;<span class="op" id="5636082">[</span><span class="op" id="5636083">]</span><span class="builtintype" id="5636084">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5636091">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5636167">Stride</span>&nbsp;<span class="builtintype" id="5636174">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5636179">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5636211">Rect</span>&nbsp;<span class="ident" id="5636216">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="5636226">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="5636229">func</span>&nbsp;<span class="op" id="5636234">(</span><span class="ident" id="5636235">p</span>&nbsp;<span class="op" id="5636237">*</span><span class="ident" id="5636238">RGBA</span><span class="op" id="5636242">)</span>&nbsp;<span class="ident" id="5636244">ColorModel</span><span class="op" id="5636254">(</span><span class="op" id="5636255">)</span>&nbsp;<span class="ident" id="5636257">color</span><span class="op" id="5636262">.</span><span class="ident" id="5636263">Model</span>&nbsp;<span class="op" id="5636269">{</span>&nbsp;<span class="keyword" id="5636271">return</span>&nbsp;<span class="ident" id="5636278">color</span><span class="op" id="5636283">.</span><span class="ident" id="5636284">RGBAModel</span>&nbsp;<span class="op" id="5636294">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5636297">func</span>&nbsp;<span class="op" id="5636302">(</span><span class="ident" id="5636303">p</span>&nbsp;<span class="op" id="5636305">*</span><span class="ident" id="5636306">RGBA</span><span class="op" id="5636310">)</span>&nbsp;<span class="ident" id="5636312">Bounds</span><span class="op" id="5636318">(</span><span class="op" id="5636319">)</span>&nbsp;<span class="ident" id="5636321">Rectangle</span>&nbsp;<span class="op" id="5636331">{</span>&nbsp;<span class="keyword" id="5636333">return</span>&nbsp;<span class="ident" id="5636340">p</span><span class="op" id="5636341">.</span><span class="ident" id="5636342">Rect</span>&nbsp;<span class="op" id="5636347">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5636350">func</span>&nbsp;<span class="op" id="5636355">(</span><span class="ident" id="5636356">p</span>&nbsp;<span class="op" id="5636358">*</span><span class="ident" id="5636359">RGBA</span><span class="op" id="5636363">)</span>&nbsp;<span class="ident" id="5636365">At</span><span class="op" id="5636367">(</span><span class="ident" id="5636368">x</span><span class="op" id="5636369">,</span>&nbsp;<span class="ident" id="5636371">y</span>&nbsp;<span class="builtintype" id="5636373">int</span><span class="op" id="5636376">)</span>&nbsp;<span class="ident" id="5636378">color</span><span class="op" id="5636383">.</span><span class="ident" id="5636384">Color</span>&nbsp;<span class="op" id="5636390">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5636393">return</span>&nbsp;<span class="ident" id="5636400">p</span><span class="op" id="5636401">.</span><span class="ident" id="5636402">RGBAAt</span><span class="op" id="5636408">(</span><span class="ident" id="5636409">x</span><span class="op" id="5636410">,</span>&nbsp;<span class="ident" id="5636412">y</span><span class="op" id="5636413">)</span><br>
<span class="lineno"></span><span class="op" id="5636415">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5636418">func</span>&nbsp;<span class="op" id="5636423">(</span><span class="ident" id="5636424">p</span>&nbsp;<span class="op" id="5636426">*</span><span class="ident" id="5636427">RGBA</span><span class="op" id="5636431">)</span>&nbsp;<span class="ident" id="5636433">RGBAAt</span><span class="op" id="5636439">(</span><span class="ident" id="5636440">x</span><span class="op" id="5636441">,</span>&nbsp;<span class="ident" id="5636443">y</span>&nbsp;<span class="builtintype" id="5636445">int</span><span class="op" id="5636448">)</span>&nbsp;<span class="ident" id="5636450">color</span><span class="op" id="5636455">.</span><span class="ident" id="5636456">RGBA</span>&nbsp;<span class="op" id="5636461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5636464">if</span>&nbsp;<span class="op" id="5636467">!</span><span class="op" id="5636468">(</span><span class="ident" id="5636469">Point</span><span class="op" id="5636474">{</span><span class="ident" id="5636475">x</span><span class="op" id="5636476">,</span>&nbsp;<span class="ident" id="5636478">y</span><span class="op" id="5636479">}</span><span class="op" id="5636480">.</span><span class="ident" id="5636481">In</span><span class="op" id="5636483">(</span><span class="ident" id="5636484">p</span><span class="op" id="5636485">.</span><span class="ident" id="5636486">Rect</span><span class="op" id="5636490">)</span><span class="op" id="5636491">)</span>&nbsp;<span class="op" id="5636493">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5636497">return</span>&nbsp;<span class="ident" id="5636504">color</span><span class="op" id="5636509">.</span><span class="ident" id="5636510">RGBA</span><span class="op" id="5636514">{</span><span class="op" id="5636515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5636518">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5636521">i</span>&nbsp;<span class="op" id="5636523">:=</span>&nbsp;<span class="ident" id="5636526">p</span><span class="op" id="5636527">.</span><span class="ident" id="5636528">PixOffset</span><span class="op" id="5636537">(</span><span class="ident" id="5636538">x</span><span class="op" id="5636539">,</span>&nbsp;<span class="ident" id="5636541">y</span><span class="op" id="5636542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5636545">return</span>&nbsp;<span class="ident" id="5636552">color</span><span class="op" id="5636557">.</span><span class="ident" id="5636558">RGBA</span><span class="op" id="5636562">{</span><span class="ident" id="5636563">p</span><span class="op" id="5636564">.</span><span class="ident" id="5636565">Pix</span><span class="op" id="5636568">[</span><span class="ident" id="5636569">i</span><span class="op" id="5636570">+</span><span class="num" id="5636571">0</span><span class="op" id="5636572">]</span><span class="op" id="5636573">,</span>&nbsp;<span class="ident" id="5636575">p</span><span class="op" id="5636576">.</span><span class="ident" id="5636577">Pix</span><span class="op" id="5636580">[</span><span class="ident" id="5636581">i</span><span class="op" id="5636582">+</span><span class="num" id="5636583">1</span><span class="op" id="5636584">]</span><span class="op" id="5636585">,</span>&nbsp;<span class="ident" id="5636587">p</span><span class="op" id="5636588">.</span><span class="ident" id="5636589">Pix</span><span class="op" id="5636592">[</span><span class="ident" id="5636593">i</span><span class="op" id="5636594">+</span><span class="num" id="5636595">2</span><span class="op" id="5636596">]</span><span class="op" id="5636597">,</span>&nbsp;<span class="ident" id="5636599">p</span><span class="op" id="5636600">.</span><span class="ident" id="5636601">Pix</span><span class="op" id="5636604">[</span><span class="ident" id="5636605">i</span><span class="op" id="5636606">+</span><span class="num" id="5636607">3</span><span class="op" id="5636608">]</span><span class="op" id="5636609">}</span><br>
<span class="lineno"></span><span class="op" id="5636611">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="5636614">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5636693">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5636717">func</span>&nbsp;<span class="op" id="5636722">(</span><span class="ident" id="5636723">p</span>&nbsp;<span class="op" id="5636725">*</span><span class="ident" id="5636726">RGBA</span><span class="op" id="5636730">)</span>&nbsp;<span class="ident" id="5636732">PixOffset</span><span class="op" id="5636741">(</span><span class="ident" id="5636742">x</span><span class="op" id="5636743">,</span>&nbsp;<span class="ident" id="5636745">y</span>&nbsp;<span class="builtintype" id="5636747">int</span><span class="op" id="5636750">)</span>&nbsp;<span class="builtintype" id="5636752">int</span>&nbsp;<span class="op" id="5636756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5636759">return</span>&nbsp;<span class="op" id="5636766">(</span><span class="ident" id="5636767">y</span><span class="op" id="5636768">-</span><span class="ident" id="5636769">p</span><span class="op" id="5636770">.</span><span class="ident" id="5636771">Rect</span><span class="op" id="5636775">.</span><span class="ident" id="5636776">Min</span><span class="op" id="5636779">.</span><span class="ident" id="5636780">Y</span><span class="op" id="5636781">)</span><span class="op" id="5636782">*</span><span class="ident" id="5636783">p</span><span class="op" id="5636784">.</span><span class="ident" id="5636785">Stride</span>&nbsp;<span class="op" id="5636792">+</span>&nbsp;<span class="op" id="5636794">(</span><span class="ident" id="5636795">x</span><span class="op" id="5636796">-</span><span class="ident" id="5636797">p</span><span class="op" id="5636798">.</span><span class="ident" id="5636799">Rect</span><span class="op" id="5636803">.</span><span class="ident" id="5636804">Min</span><span class="op" id="5636807">.</span><span class="ident" id="5636808">X</span><span class="op" id="5636809">)</span><span class="op" id="5636810">*</span><span class="num" id="5636811">4</span><br>
<span class="lineno">90</span><span class="op" id="5636813">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5636816">func</span>&nbsp;<span class="op" id="5636821">(</span><span class="ident" id="5636822">p</span>&nbsp;<span class="op" id="5636824">*</span><span class="ident" id="5636825">RGBA</span><span class="op" id="5636829">)</span>&nbsp;<span class="ident" id="5636831">Set</span><span class="op" id="5636834">(</span><span class="ident" id="5636835">x</span><span class="op" id="5636836">,</span>&nbsp;<span class="ident" id="5636838">y</span>&nbsp;<span class="builtintype" id="5636840">int</span><span class="op" id="5636843">,</span>&nbsp;<span class="ident" id="5636845">c</span>&nbsp;<span class="ident" id="5636847">color</span><span class="op" id="5636852">.</span><span class="ident" id="5636853">Color</span><span class="op" id="5636858">)</span>&nbsp;<span class="op" id="5636860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5636863">if</span>&nbsp;<span class="op" id="5636866">!</span><span class="op" id="5636867">(</span><span class="ident" id="5636868">Point</span><span class="op" id="5636873">{</span><span class="ident" id="5636874">x</span><span class="op" id="5636875">,</span>&nbsp;<span class="ident" id="5636877">y</span><span class="op" id="5636878">}</span><span class="op" id="5636879">.</span><span class="ident" id="5636880">In</span><span class="op" id="5636882">(</span><span class="ident" id="5636883">p</span><span class="op" id="5636884">.</span><span class="ident" id="5636885">Rect</span><span class="op" id="5636889">)</span><span class="op" id="5636890">)</span>&nbsp;<span class="op" id="5636892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5636896">return</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5636904">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5636907">i</span>&nbsp;<span class="op" id="5636909">:=</span>&nbsp;<span class="ident" id="5636912">p</span><span class="op" id="5636913">.</span><span class="ident" id="5636914">PixOffset</span><span class="op" id="5636923">(</span><span class="ident" id="5636924">x</span><span class="op" id="5636925">,</span>&nbsp;<span class="ident" id="5636927">y</span><span class="op" id="5636928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5636931">c1</span>&nbsp;<span class="op" id="5636934">:=</span>&nbsp;<span class="ident" id="5636937">color</span><span class="op" id="5636942">.</span><span class="ident" id="5636943">RGBAModel</span><span class="op" id="5636952">.</span><span class="ident" id="5636953">Convert</span><span class="op" id="5636960">(</span><span class="ident" id="5636961">c</span><span class="op" id="5636962">)</span><span class="op" id="5636963">.</span><span class="op" id="5636964">(</span><span class="ident" id="5636965">color</span><span class="op" id="5636970">.</span><span class="ident" id="5636971">RGBA</span><span class="op" id="5636975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5636978">p</span><span class="op" id="5636979">.</span><span class="ident" id="5636980">Pix</span><span class="op" id="5636983">[</span><span class="ident" id="5636984">i</span><span class="op" id="5636985">+</span><span class="num" id="5636986">0</span><span class="op" id="5636987">]</span>&nbsp;<span class="op" id="5636989">=</span>&nbsp;<span class="ident" id="5636991">c1</span><span class="op" id="5636993">.</span><span class="ident" id="5636994">R</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5636997">p</span><span class="op" id="5636998">.</span><span class="ident" id="5636999">Pix</span><span class="op" id="5637002">[</span><span class="ident" id="5637003">i</span><span class="op" id="5637004">+</span><span class="num" id="5637005">1</span><span class="op" id="5637006">]</span>&nbsp;<span class="op" id="5637008">=</span>&nbsp;<span class="ident" id="5637010">c1</span><span class="op" id="5637012">.</span><span class="ident" id="5637013">G</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5637016">p</span><span class="op" id="5637017">.</span><span class="ident" id="5637018">Pix</span><span class="op" id="5637021">[</span><span class="ident" id="5637022">i</span><span class="op" id="5637023">+</span><span class="num" id="5637024">2</span><span class="op" id="5637025">]</span>&nbsp;<span class="op" id="5637027">=</span>&nbsp;<span class="ident" id="5637029">c1</span><span class="op" id="5637031">.</span><span class="ident" id="5637032">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5637035">p</span><span class="op" id="5637036">.</span><span class="ident" id="5637037">Pix</span><span class="op" id="5637040">[</span><span class="ident" id="5637041">i</span><span class="op" id="5637042">+</span><span class="num" id="5637043">3</span><span class="op" id="5637044">]</span>&nbsp;<span class="op" id="5637046">=</span>&nbsp;<span class="ident" id="5637048">c1</span><span class="op" id="5637050">.</span><span class="ident" id="5637051">A</span><br>
<span class="lineno"></span><span class="op" id="5637053">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5637056">func</span>&nbsp;<span class="op" id="5637061">(</span><span class="ident" id="5637062">p</span>&nbsp;<span class="op" id="5637064">*</span><span class="ident" id="5637065">RGBA</span><span class="op" id="5637069">)</span>&nbsp;<span class="ident" id="5637071">SetRGBA</span><span class="op" id="5637078">(</span><span class="ident" id="5637079">x</span><span class="op" id="5637080">,</span>&nbsp;<span class="ident" id="5637082">y</span>&nbsp;<span class="builtintype" id="5637084">int</span><span class="op" id="5637087">,</span>&nbsp;<span class="ident" id="5637089">c</span>&nbsp;<span class="ident" id="5637091">color</span><span class="op" id="5637096">.</span><span class="ident" id="5637097">RGBA</span><span class="op" id="5637101">)</span>&nbsp;<span class="op" id="5637103">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5637106">if</span>&nbsp;<span class="op" id="5637109">!</span><span class="op" id="5637110">(</span><span class="ident" id="5637111">Point</span><span class="op" id="5637116">{</span><span class="ident" id="5637117">x</span><span class="op" id="5637118">,</span>&nbsp;<span class="ident" id="5637120">y</span><span class="op" id="5637121">}</span><span class="op" id="5637122">.</span><span class="ident" id="5637123">In</span><span class="op" id="5637125">(</span><span class="ident" id="5637126">p</span><span class="op" id="5637127">.</span><span class="ident" id="5637128">Rect</span><span class="op" id="5637132">)</span><span class="op" id="5637133">)</span>&nbsp;<span class="op" id="5637135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5637139">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5637147">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5637150">i</span>&nbsp;<span class="op" id="5637152">:=</span>&nbsp;<span class="ident" id="5637155">p</span><span class="op" id="5637156">.</span><span class="ident" id="5637157">PixOffset</span><span class="op" id="5637166">(</span><span class="ident" id="5637167">x</span><span class="op" id="5637168">,</span>&nbsp;<span class="ident" id="5637170">y</span><span class="op" id="5637171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5637174">p</span><span class="op" id="5637175">.</span><span class="ident" id="5637176">Pix</span><span class="op" id="5637179">[</span><span class="ident" id="5637180">i</span><span class="op" id="5637181">+</span><span class="num" id="5637182">0</span><span class="op" id="5637183">]</span>&nbsp;<span class="op" id="5637185">=</span>&nbsp;<span class="ident" id="5637187">c</span><span class="op" id="5637188">.</span><span class="ident" id="5637189">R</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5637192">p</span><span class="op" id="5637193">.</span><span class="ident" id="5637194">Pix</span><span class="op" id="5637197">[</span><span class="ident" id="5637198">i</span><span class="op" id="5637199">+</span><span class="num" id="5637200">1</span><span class="op" id="5637201">]</span>&nbsp;<span class="op" id="5637203">=</span>&nbsp;<span class="ident" id="5637205">c</span><span class="op" id="5637206">.</span><span class="ident" id="5637207">G</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5637210">p</span><span class="op" id="5637211">.</span><span class="ident" id="5637212">Pix</span><span class="op" id="5637215">[</span><span class="ident" id="5637216">i</span><span class="op" id="5637217">+</span><span class="num" id="5637218">2</span><span class="op" id="5637219">]</span>&nbsp;<span class="op" id="5637221">=</span>&nbsp;<span class="ident" id="5637223">c</span><span class="op" id="5637224">.</span><span class="ident" id="5637225">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5637228">p</span><span class="op" id="5637229">.</span><span class="ident" id="5637230">Pix</span><span class="op" id="5637233">[</span><span class="ident" id="5637234">i</span><span class="op" id="5637235">+</span><span class="num" id="5637236">3</span><span class="op" id="5637237">]</span>&nbsp;<span class="op" id="5637239">=</span>&nbsp;<span class="ident" id="5637241">c</span><span class="op" id="5637242">.</span><span class="ident" id="5637243">A</span><br>
<span class="lineno"></span><span class="op" id="5637245">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="5637248">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5637325">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5637397">func</span>&nbsp;<span class="op" id="5637402">(</span><span class="ident" id="5637403">p</span>&nbsp;<span class="op" id="5637405">*</span><span class="ident" id="5637406">RGBA</span><span class="op" id="5637410">)</span>&nbsp;<span class="ident" id="5637412">SubImage</span><span class="op" id="5637420">(</span><span class="ident" id="5637421">r</span>&nbsp;<span class="ident" id="5637423">Rectangle</span><span class="op" id="5637432">)</span>&nbsp;<span class="ident" id="5637434">Image</span>&nbsp;<span class="op" id="5637440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5637443">r</span>&nbsp;<span class="op" id="5637445">=</span>&nbsp;<span class="ident" id="5637447">r</span><span class="op" id="5637448">.</span><span class="ident" id="5637449">Intersect</span><span class="op" id="5637458">(</span><span class="ident" id="5637459">p</span><span class="op" id="5637460">.</span><span class="ident" id="5637461">Rect</span><span class="op" id="5637465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5637468">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5637549">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5637631">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5637681">if</span>&nbsp;<span class="ident" id="5637684">r</span><span class="op" id="5637685">.</span><span class="ident" id="5637686">Empty</span><span class="op" id="5637691">(</span><span class="op" id="5637692">)</span>&nbsp;<span class="op" id="5637694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5637698">return</span>&nbsp;<span class="op" id="5637705">&amp;</span><span class="ident" id="5637706">RGBA</span><span class="op" id="5637710">{</span><span class="op" id="5637711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5637714">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5637717">i</span>&nbsp;<span class="op" id="5637719">:=</span>&nbsp;<span class="ident" id="5637722">p</span><span class="op" id="5637723">.</span><span class="ident" id="5637724">PixOffset</span><span class="op" id="5637733">(</span><span class="ident" id="5637734">r</span><span class="op" id="5637735">.</span><span class="ident" id="5637736">Min</span><span class="op" id="5637739">.</span><span class="ident" id="5637740">X</span><span class="op" id="5637741">,</span>&nbsp;<span class="ident" id="5637743">r</span><span class="op" id="5637744">.</span><span class="ident" id="5637745">Min</span><span class="op" id="5637748">.</span><span class="ident" id="5637749">Y</span><span class="op" id="5637750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5637753">return</span>&nbsp;<span class="op" id="5637760">&amp;</span><span class="ident" id="5637761">RGBA</span><span class="op" id="5637765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5637769">Pix</span><span class="op" id="5637772">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5637777">p</span><span class="op" id="5637778">.</span><span class="ident" id="5637779">Pix</span><span class="op" id="5637782">[</span><span class="ident" id="5637783">i</span><span class="op" id="5637784">:</span><span class="op" id="5637785">]</span><span class="op" id="5637786">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5637790">Stride</span><span class="op" id="5637796">:</span>&nbsp;<span class="ident" id="5637798">p</span><span class="op" id="5637799">.</span><span class="ident" id="5637800">Stride</span><span class="op" id="5637806">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5637810">Rect</span><span class="op" id="5637814">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5637818">r</span><span class="op" id="5637819">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5637822">}</span><br>
<span class="lineno"></span><span class="op" id="5637824">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5637827">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5637900">func</span>&nbsp;<span class="op" id="5637905">(</span><span class="ident" id="5637906">p</span>&nbsp;<span class="op" id="5637908">*</span><span class="ident" id="5637909">RGBA</span><span class="op" id="5637913">)</span>&nbsp;<span class="ident" id="5637915">Opaque</span><span class="op" id="5637921">(</span><span class="op" id="5637922">)</span>&nbsp;<span class="builtintype" id="5637924">bool</span>&nbsp;<span class="op" id="5637929">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5637932">if</span>&nbsp;<span class="ident" id="5637935">p</span><span class="op" id="5637936">.</span><span class="ident" id="5637937">Rect</span><span class="op" id="5637941">.</span><span class="ident" id="5637942">Empty</span><span class="op" id="5637947">(</span><span class="op" id="5637948">)</span>&nbsp;<span class="op" id="5637950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5637954">return</span>&nbsp;<span class="builtintype" id="5637961">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5637967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5637970">i0</span><span class="op" id="5637972">,</span>&nbsp;<span class="ident" id="5637974">i1</span>&nbsp;<span class="op" id="5637977">:=</span>&nbsp;<span class="num" id="5637980">3</span><span class="op" id="5637981">,</span>&nbsp;<span class="ident" id="5637983">p</span><span class="op" id="5637984">.</span><span class="ident" id="5637985">Rect</span><span class="op" id="5637989">.</span><span class="ident" id="5637990">Dx</span><span class="op" id="5637992">(</span><span class="op" id="5637993">)</span><span class="op" id="5637994">*</span><span class="num" id="5637995">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5637998">for</span>&nbsp;<span class="ident" id="5638002">y</span>&nbsp;<span class="op" id="5638004">:=</span>&nbsp;<span class="ident" id="5638007">p</span><span class="op" id="5638008">.</span><span class="ident" id="5638009">Rect</span><span class="op" id="5638013">.</span><span class="ident" id="5638014">Min</span><span class="op" id="5638017">.</span><span class="ident" id="5638018">Y</span><span class="op" id="5638019">;</span>&nbsp;<span class="ident" id="5638021">y</span>&nbsp;<span class="op" id="5638023">&lt;</span>&nbsp;<span class="ident" id="5638025">p</span><span class="op" id="5638026">.</span><span class="ident" id="5638027">Rect</span><span class="op" id="5638031">.</span><span class="ident" id="5638032">Max</span><span class="op" id="5638035">.</span><span class="ident" id="5638036">Y</span><span class="op" id="5638037">;</span>&nbsp;<span class="ident" id="5638039">y</span><span class="op" id="5638040">++</span>&nbsp;<span class="op" id="5638043">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5638047">for</span>&nbsp;<span class="ident" id="5638051">i</span>&nbsp;<span class="op" id="5638053">:=</span>&nbsp;<span class="ident" id="5638056">i0</span><span class="op" id="5638058">;</span>&nbsp;<span class="ident" id="5638060">i</span>&nbsp;<span class="op" id="5638062">&lt;</span>&nbsp;<span class="ident" id="5638064">i1</span><span class="op" id="5638066">;</span>&nbsp;<span class="ident" id="5638068">i</span>&nbsp;<span class="op" id="5638070">+=</span>&nbsp;<span class="num" id="5638073">4</span>&nbsp;<span class="op" id="5638075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5638080">if</span>&nbsp;<span class="ident" id="5638083">p</span><span class="op" id="5638084">.</span><span class="ident" id="5638085">Pix</span><span class="op" id="5638088">[</span><span class="ident" id="5638089">i</span><span class="op" id="5638090">]</span>&nbsp;<span class="op" id="5638092">!=</span>&nbsp;<span class="num" id="5638095">0xff</span>&nbsp;<span class="op" id="5638100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5638106">return</span>&nbsp;<span class="builtintype" id="5638113">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5638122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5638126">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5638130">i0</span>&nbsp;<span class="op" id="5638133">+=</span>&nbsp;<span class="ident" id="5638136">p</span><span class="op" id="5638137">.</span><span class="ident" id="5638138">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5638147">i1</span>&nbsp;<span class="op" id="5638150">+=</span>&nbsp;<span class="ident" id="5638153">p</span><span class="op" id="5638154">.</span><span class="ident" id="5638155">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5638163">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5638166">return</span>&nbsp;<span class="builtintype" id="5638173">true</span><br>
<span class="lineno"></span><span class="op" id="5638178">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="comment" id="5638181">//&nbsp;NewRGBA&nbsp;returns&nbsp;a&nbsp;new&nbsp;RGBA&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="5638234">func</span>&nbsp;<span class="ident" id="5638239">NewRGBA</span><span class="op" id="5638246">(</span><span class="ident" id="5638247">r</span>&nbsp;<span class="ident" id="5638249">Rectangle</span><span class="op" id="5638258">)</span>&nbsp;<span class="op" id="5638260">*</span><span class="ident" id="5638261">RGBA</span>&nbsp;<span class="op" id="5638266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5638269">w</span><span class="op" id="5638270">,</span>&nbsp;<span class="ident" id="5638272">h</span>&nbsp;<span class="op" id="5638274">:=</span>&nbsp;<span class="ident" id="5638277">r</span><span class="op" id="5638278">.</span><span class="ident" id="5638279">Dx</span><span class="op" id="5638281">(</span><span class="op" id="5638282">)</span><span class="op" id="5638283">,</span>&nbsp;<span class="ident" id="5638285">r</span><span class="op" id="5638286">.</span><span class="ident" id="5638287">Dy</span><span class="op" id="5638289">(</span><span class="op" id="5638290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5638293">buf</span>&nbsp;<span class="op" id="5638297">:=</span>&nbsp;<span class="builtinfunc" id="5638300">make</span><span class="op" id="5638304">(</span><span class="op" id="5638305">[</span><span class="op" id="5638306">]</span><span class="builtintype" id="5638307">uint8</span><span class="op" id="5638312">,</span>&nbsp;<span class="num" id="5638314">4</span><span class="op" id="5638315">*</span><span class="ident" id="5638316">w</span><span class="op" id="5638317">*</span><span class="ident" id="5638318">h</span><span class="op" id="5638319">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5638322">return</span>&nbsp;<span class="op" id="5638329">&amp;</span><span class="ident" id="5638330">RGBA</span><span class="op" id="5638334">{</span><span class="ident" id="5638335">buf</span><span class="op" id="5638338">,</span>&nbsp;<span class="num" id="5638340">4</span>&nbsp;<span class="op" id="5638342">*</span>&nbsp;<span class="ident" id="5638344">w</span><span class="op" id="5638345">,</span>&nbsp;<span class="ident" id="5638347">r</span><span class="op" id="5638348">}</span><br>
<span class="lineno"></span><span class="op" id="5638350">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5638353">//&nbsp;RGBA64&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.RGBA64&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5638430">type</span>&nbsp;<span class="ident" id="5638435">RGBA64</span>&nbsp;<span class="keyword" id="5638442">struct</span>&nbsp;<span class="op" id="5638449">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5638452">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;in&nbsp;R,&nbsp;G,&nbsp;B,&nbsp;A&nbsp;order&nbsp;and&nbsp;big-endian&nbsp;format.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5638542">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*8].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5638610">Pix</span>&nbsp;<span class="op" id="5638614">[</span><span class="op" id="5638615">]</span><span class="builtintype" id="5638616">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5638623">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5638699">Stride</span>&nbsp;<span class="builtintype" id="5638706">int</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5638711">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5638743">Rect</span>&nbsp;<span class="ident" id="5638748">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="5638758">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5638761">func</span>&nbsp;<span class="op" id="5638766">(</span><span class="ident" id="5638767">p</span>&nbsp;<span class="op" id="5638769">*</span><span class="ident" id="5638770">RGBA64</span><span class="op" id="5638776">)</span>&nbsp;<span class="ident" id="5638778">ColorModel</span><span class="op" id="5638788">(</span><span class="op" id="5638789">)</span>&nbsp;<span class="ident" id="5638791">color</span><span class="op" id="5638796">.</span><span class="ident" id="5638797">Model</span>&nbsp;<span class="op" id="5638803">{</span>&nbsp;<span class="keyword" id="5638805">return</span>&nbsp;<span class="ident" id="5638812">color</span><span class="op" id="5638817">.</span><span class="ident" id="5638818">RGBA64Model</span>&nbsp;<span class="op" id="5638830">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="5638833">func</span>&nbsp;<span class="op" id="5638838">(</span><span class="ident" id="5638839">p</span>&nbsp;<span class="op" id="5638841">*</span><span class="ident" id="5638842">RGBA64</span><span class="op" id="5638848">)</span>&nbsp;<span class="ident" id="5638850">Bounds</span><span class="op" id="5638856">(</span><span class="op" id="5638857">)</span>&nbsp;<span class="ident" id="5638859">Rectangle</span>&nbsp;<span class="op" id="5638869">{</span>&nbsp;<span class="keyword" id="5638871">return</span>&nbsp;<span class="ident" id="5638878">p</span><span class="op" id="5638879">.</span><span class="ident" id="5638880">Rect</span>&nbsp;<span class="op" id="5638885">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5638888">func</span>&nbsp;<span class="op" id="5638893">(</span><span class="ident" id="5638894">p</span>&nbsp;<span class="op" id="5638896">*</span><span class="ident" id="5638897">RGBA64</span><span class="op" id="5638903">)</span>&nbsp;<span class="ident" id="5638905">At</span><span class="op" id="5638907">(</span><span class="ident" id="5638908">x</span><span class="op" id="5638909">,</span>&nbsp;<span class="ident" id="5638911">y</span>&nbsp;<span class="builtintype" id="5638913">int</span><span class="op" id="5638916">)</span>&nbsp;<span class="ident" id="5638918">color</span><span class="op" id="5638923">.</span><span class="ident" id="5638924">Color</span>&nbsp;<span class="op" id="5638930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5638933">return</span>&nbsp;<span class="ident" id="5638940">p</span><span class="op" id="5638941">.</span><span class="ident" id="5638942">RGBA64At</span><span class="op" id="5638950">(</span><span class="ident" id="5638951">x</span><span class="op" id="5638952">,</span>&nbsp;<span class="ident" id="5638954">y</span><span class="op" id="5638955">)</span><br>
<span class="lineno">175</span><span class="op" id="5638957">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5638960">func</span>&nbsp;<span class="op" id="5638965">(</span><span class="ident" id="5638966">p</span>&nbsp;<span class="op" id="5638968">*</span><span class="ident" id="5638969">RGBA64</span><span class="op" id="5638975">)</span>&nbsp;<span class="ident" id="5638977">RGBA64At</span><span class="op" id="5638985">(</span><span class="ident" id="5638986">x</span><span class="op" id="5638987">,</span>&nbsp;<span class="ident" id="5638989">y</span>&nbsp;<span class="builtintype" id="5638991">int</span><span class="op" id="5638994">)</span>&nbsp;<span class="ident" id="5638996">color</span><span class="op" id="5639001">.</span><span class="ident" id="5639002">RGBA64</span>&nbsp;<span class="op" id="5639009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5639012">if</span>&nbsp;<span class="op" id="5639015">!</span><span class="op" id="5639016">(</span><span class="ident" id="5639017">Point</span><span class="op" id="5639022">{</span><span class="ident" id="5639023">x</span><span class="op" id="5639024">,</span>&nbsp;<span class="ident" id="5639026">y</span><span class="op" id="5639027">}</span><span class="op" id="5639028">.</span><span class="ident" id="5639029">In</span><span class="op" id="5639031">(</span><span class="ident" id="5639032">p</span><span class="op" id="5639033">.</span><span class="ident" id="5639034">Rect</span><span class="op" id="5639038">)</span><span class="op" id="5639039">)</span>&nbsp;<span class="op" id="5639041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5639045">return</span>&nbsp;<span class="ident" id="5639052">color</span><span class="op" id="5639057">.</span><span class="ident" id="5639058">RGBA64</span><span class="op" id="5639064">{</span><span class="op" id="5639065">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5639068">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5639071">i</span>&nbsp;<span class="op" id="5639073">:=</span>&nbsp;<span class="ident" id="5639076">p</span><span class="op" id="5639077">.</span><span class="ident" id="5639078">PixOffset</span><span class="op" id="5639087">(</span><span class="ident" id="5639088">x</span><span class="op" id="5639089">,</span>&nbsp;<span class="ident" id="5639091">y</span><span class="op" id="5639092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5639095">return</span>&nbsp;<span class="ident" id="5639102">color</span><span class="op" id="5639107">.</span><span class="ident" id="5639108">RGBA64</span><span class="op" id="5639114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5639118">uint16</span><span class="op" id="5639124">(</span><span class="ident" id="5639125">p</span><span class="op" id="5639126">.</span><span class="ident" id="5639127">Pix</span><span class="op" id="5639130">[</span><span class="ident" id="5639131">i</span><span class="op" id="5639132">+</span><span class="num" id="5639133">0</span><span class="op" id="5639134">]</span><span class="op" id="5639135">)</span><span class="op" id="5639136">&lt;&lt;</span><span class="num" id="5639138">8</span>&nbsp;<span class="op" id="5639140">|</span>&nbsp;<span class="builtintype" id="5639142">uint16</span><span class="op" id="5639148">(</span><span class="ident" id="5639149">p</span><span class="op" id="5639150">.</span><span class="ident" id="5639151">Pix</span><span class="op" id="5639154">[</span><span class="ident" id="5639155">i</span><span class="op" id="5639156">+</span><span class="num" id="5639157">1</span><span class="op" id="5639158">]</span><span class="op" id="5639159">)</span><span class="op" id="5639160">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5639164">uint16</span><span class="op" id="5639170">(</span><span class="ident" id="5639171">p</span><span class="op" id="5639172">.</span><span class="ident" id="5639173">Pix</span><span class="op" id="5639176">[</span><span class="ident" id="5639177">i</span><span class="op" id="5639178">+</span><span class="num" id="5639179">2</span><span class="op" id="5639180">]</span><span class="op" id="5639181">)</span><span class="op" id="5639182">&lt;&lt;</span><span class="num" id="5639184">8</span>&nbsp;<span class="op" id="5639186">|</span>&nbsp;<span class="builtintype" id="5639188">uint16</span><span class="op" id="5639194">(</span><span class="ident" id="5639195">p</span><span class="op" id="5639196">.</span><span class="ident" id="5639197">Pix</span><span class="op" id="5639200">[</span><span class="ident" id="5639201">i</span><span class="op" id="5639202">+</span><span class="num" id="5639203">3</span><span class="op" id="5639204">]</span><span class="op" id="5639205">)</span><span class="op" id="5639206">,</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5639210">uint16</span><span class="op" id="5639216">(</span><span class="ident" id="5639217">p</span><span class="op" id="5639218">.</span><span class="ident" id="5639219">Pix</span><span class="op" id="5639222">[</span><span class="ident" id="5639223">i</span><span class="op" id="5639224">+</span><span class="num" id="5639225">4</span><span class="op" id="5639226">]</span><span class="op" id="5639227">)</span><span class="op" id="5639228">&lt;&lt;</span><span class="num" id="5639230">8</span>&nbsp;<span class="op" id="5639232">|</span>&nbsp;<span class="builtintype" id="5639234">uint16</span><span class="op" id="5639240">(</span><span class="ident" id="5639241">p</span><span class="op" id="5639242">.</span><span class="ident" id="5639243">Pix</span><span class="op" id="5639246">[</span><span class="ident" id="5639247">i</span><span class="op" id="5639248">+</span><span class="num" id="5639249">5</span><span class="op" id="5639250">]</span><span class="op" id="5639251">)</span><span class="op" id="5639252">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5639256">uint16</span><span class="op" id="5639262">(</span><span class="ident" id="5639263">p</span><span class="op" id="5639264">.</span><span class="ident" id="5639265">Pix</span><span class="op" id="5639268">[</span><span class="ident" id="5639269">i</span><span class="op" id="5639270">+</span><span class="num" id="5639271">6</span><span class="op" id="5639272">]</span><span class="op" id="5639273">)</span><span class="op" id="5639274">&lt;&lt;</span><span class="num" id="5639276">8</span>&nbsp;<span class="op" id="5639278">|</span>&nbsp;<span class="builtintype" id="5639280">uint16</span><span class="op" id="5639286">(</span><span class="ident" id="5639287">p</span><span class="op" id="5639288">.</span><span class="ident" id="5639289">Pix</span><span class="op" id="5639292">[</span><span class="ident" id="5639293">i</span><span class="op" id="5639294">+</span><span class="num" id="5639295">7</span><span class="op" id="5639296">]</span><span class="op" id="5639297">)</span><span class="op" id="5639298">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5639301">}</span><br>
<span class="lineno"></span><span class="op" id="5639303">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="comment" id="5639306">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5639385">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5639409">func</span>&nbsp;<span class="op" id="5639414">(</span><span class="ident" id="5639415">p</span>&nbsp;<span class="op" id="5639417">*</span><span class="ident" id="5639418">RGBA64</span><span class="op" id="5639424">)</span>&nbsp;<span class="ident" id="5639426">PixOffset</span><span class="op" id="5639435">(</span><span class="ident" id="5639436">x</span><span class="op" id="5639437">,</span>&nbsp;<span class="ident" id="5639439">y</span>&nbsp;<span class="builtintype" id="5639441">int</span><span class="op" id="5639444">)</span>&nbsp;<span class="builtintype" id="5639446">int</span>&nbsp;<span class="op" id="5639450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5639453">return</span>&nbsp;<span class="op" id="5639460">(</span><span class="ident" id="5639461">y</span><span class="op" id="5639462">-</span><span class="ident" id="5639463">p</span><span class="op" id="5639464">.</span><span class="ident" id="5639465">Rect</span><span class="op" id="5639469">.</span><span class="ident" id="5639470">Min</span><span class="op" id="5639473">.</span><span class="ident" id="5639474">Y</span><span class="op" id="5639475">)</span><span class="op" id="5639476">*</span><span class="ident" id="5639477">p</span><span class="op" id="5639478">.</span><span class="ident" id="5639479">Stride</span>&nbsp;<span class="op" id="5639486">+</span>&nbsp;<span class="op" id="5639488">(</span><span class="ident" id="5639489">x</span><span class="op" id="5639490">-</span><span class="ident" id="5639491">p</span><span class="op" id="5639492">.</span><span class="ident" id="5639493">Rect</span><span class="op" id="5639497">.</span><span class="ident" id="5639498">Min</span><span class="op" id="5639501">.</span><span class="ident" id="5639502">X</span><span class="op" id="5639503">)</span><span class="op" id="5639504">*</span><span class="num" id="5639505">8</span><br>
<span class="lineno"></span><span class="op" id="5639507">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="keyword" id="5639510">func</span>&nbsp;<span class="op" id="5639515">(</span><span class="ident" id="5639516">p</span>&nbsp;<span class="op" id="5639518">*</span><span class="ident" id="5639519">RGBA64</span><span class="op" id="5639525">)</span>&nbsp;<span class="ident" id="5639527">Set</span><span class="op" id="5639530">(</span><span class="ident" id="5639531">x</span><span class="op" id="5639532">,</span>&nbsp;<span class="ident" id="5639534">y</span>&nbsp;<span class="builtintype" id="5639536">int</span><span class="op" id="5639539">,</span>&nbsp;<span class="ident" id="5639541">c</span>&nbsp;<span class="ident" id="5639543">color</span><span class="op" id="5639548">.</span><span class="ident" id="5639549">Color</span><span class="op" id="5639554">)</span>&nbsp;<span class="op" id="5639556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5639559">if</span>&nbsp;<span class="op" id="5639562">!</span><span class="op" id="5639563">(</span><span class="ident" id="5639564">Point</span><span class="op" id="5639569">{</span><span class="ident" id="5639570">x</span><span class="op" id="5639571">,</span>&nbsp;<span class="ident" id="5639573">y</span><span class="op" id="5639574">}</span><span class="op" id="5639575">.</span><span class="ident" id="5639576">In</span><span class="op" id="5639578">(</span><span class="ident" id="5639579">p</span><span class="op" id="5639580">.</span><span class="ident" id="5639581">Rect</span><span class="op" id="5639585">)</span><span class="op" id="5639586">)</span>&nbsp;<span class="op" id="5639588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5639592">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5639600">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5639603">i</span>&nbsp;<span class="op" id="5639605">:=</span>&nbsp;<span class="ident" id="5639608">p</span><span class="op" id="5639609">.</span><span class="ident" id="5639610">PixOffset</span><span class="op" id="5639619">(</span><span class="ident" id="5639620">x</span><span class="op" id="5639621">,</span>&nbsp;<span class="ident" id="5639623">y</span><span class="op" id="5639624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5639627">c1</span>&nbsp;<span class="op" id="5639630">:=</span>&nbsp;<span class="ident" id="5639633">color</span><span class="op" id="5639638">.</span><span class="ident" id="5639639">RGBA64Model</span><span class="op" id="5639650">.</span><span class="ident" id="5639651">Convert</span><span class="op" id="5639658">(</span><span class="ident" id="5639659">c</span><span class="op" id="5639660">)</span><span class="op" id="5639661">.</span><span class="op" id="5639662">(</span><span class="ident" id="5639663">color</span><span class="op" id="5639668">.</span><span class="ident" id="5639669">RGBA64</span><span class="op" id="5639675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5639678">p</span><span class="op" id="5639679">.</span><span class="ident" id="5639680">Pix</span><span class="op" id="5639683">[</span><span class="ident" id="5639684">i</span><span class="op" id="5639685">+</span><span class="num" id="5639686">0</span><span class="op" id="5639687">]</span>&nbsp;<span class="op" id="5639689">=</span>&nbsp;<span class="builtintype" id="5639691">uint8</span><span class="op" id="5639696">(</span><span class="ident" id="5639697">c1</span><span class="op" id="5639699">.</span><span class="ident" id="5639700">R</span>&nbsp;<span class="op" id="5639702">&gt;&gt;</span>&nbsp;<span class="num" id="5639705">8</span><span class="op" id="5639706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5639709">p</span><span class="op" id="5639710">.</span><span class="ident" id="5639711">Pix</span><span class="op" id="5639714">[</span><span class="ident" id="5639715">i</span><span class="op" id="5639716">+</span><span class="num" id="5639717">1</span><span class="op" id="5639718">]</span>&nbsp;<span class="op" id="5639720">=</span>&nbsp;<span class="builtintype" id="5639722">uint8</span><span class="op" id="5639727">(</span><span class="ident" id="5639728">c1</span><span class="op" id="5639730">.</span><span class="ident" id="5639731">R</span><span class="op" id="5639732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5639735">p</span><span class="op" id="5639736">.</span><span class="ident" id="5639737">Pix</span><span class="op" id="5639740">[</span><span class="ident" id="5639741">i</span><span class="op" id="5639742">+</span><span class="num" id="5639743">2</span><span class="op" id="5639744">]</span>&nbsp;<span class="op" id="5639746">=</span>&nbsp;<span class="builtintype" id="5639748">uint8</span><span class="op" id="5639753">(</span><span class="ident" id="5639754">c1</span><span class="op" id="5639756">.</span><span class="ident" id="5639757">G</span>&nbsp;<span class="op" id="5639759">&gt;&gt;</span>&nbsp;<span class="num" id="5639762">8</span><span class="op" id="5639763">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5639766">p</span><span class="op" id="5639767">.</span><span class="ident" id="5639768">Pix</span><span class="op" id="5639771">[</span><span class="ident" id="5639772">i</span><span class="op" id="5639773">+</span><span class="num" id="5639774">3</span><span class="op" id="5639775">]</span>&nbsp;<span class="op" id="5639777">=</span>&nbsp;<span class="builtintype" id="5639779">uint8</span><span class="op" id="5639784">(</span><span class="ident" id="5639785">c1</span><span class="op" id="5639787">.</span><span class="ident" id="5639788">G</span><span class="op" id="5639789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5639792">p</span><span class="op" id="5639793">.</span><span class="ident" id="5639794">Pix</span><span class="op" id="5639797">[</span><span class="ident" id="5639798">i</span><span class="op" id="5639799">+</span><span class="num" id="5639800">4</span><span class="op" id="5639801">]</span>&nbsp;<span class="op" id="5639803">=</span>&nbsp;<span class="builtintype" id="5639805">uint8</span><span class="op" id="5639810">(</span><span class="ident" id="5639811">c1</span><span class="op" id="5639813">.</span><span class="ident" id="5639814">B</span>&nbsp;<span class="op" id="5639816">&gt;&gt;</span>&nbsp;<span class="num" id="5639819">8</span><span class="op" id="5639820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5639823">p</span><span class="op" id="5639824">.</span><span class="ident" id="5639825">Pix</span><span class="op" id="5639828">[</span><span class="ident" id="5639829">i</span><span class="op" id="5639830">+</span><span class="num" id="5639831">5</span><span class="op" id="5639832">]</span>&nbsp;<span class="op" id="5639834">=</span>&nbsp;<span class="builtintype" id="5639836">uint8</span><span class="op" id="5639841">(</span><span class="ident" id="5639842">c1</span><span class="op" id="5639844">.</span><span class="ident" id="5639845">B</span><span class="op" id="5639846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5639849">p</span><span class="op" id="5639850">.</span><span class="ident" id="5639851">Pix</span><span class="op" id="5639854">[</span><span class="ident" id="5639855">i</span><span class="op" id="5639856">+</span><span class="num" id="5639857">6</span><span class="op" id="5639858">]</span>&nbsp;<span class="op" id="5639860">=</span>&nbsp;<span class="builtintype" id="5639862">uint8</span><span class="op" id="5639867">(</span><span class="ident" id="5639868">c1</span><span class="op" id="5639870">.</span><span class="ident" id="5639871">A</span>&nbsp;<span class="op" id="5639873">&gt;&gt;</span>&nbsp;<span class="num" id="5639876">8</span><span class="op" id="5639877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5639880">p</span><span class="op" id="5639881">.</span><span class="ident" id="5639882">Pix</span><span class="op" id="5639885">[</span><span class="ident" id="5639886">i</span><span class="op" id="5639887">+</span><span class="num" id="5639888">7</span><span class="op" id="5639889">]</span>&nbsp;<span class="op" id="5639891">=</span>&nbsp;<span class="builtintype" id="5639893">uint8</span><span class="op" id="5639898">(</span><span class="ident" id="5639899">c1</span><span class="op" id="5639901">.</span><span class="ident" id="5639902">A</span><span class="op" id="5639903">)</span><br>
<span class="lineno">210</span><span class="op" id="5639905">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5639908">func</span>&nbsp;<span class="op" id="5639913">(</span><span class="ident" id="5639914">p</span>&nbsp;<span class="op" id="5639916">*</span><span class="ident" id="5639917">RGBA64</span><span class="op" id="5639923">)</span>&nbsp;<span class="ident" id="5639925">SetRGBA64</span><span class="op" id="5639934">(</span><span class="ident" id="5639935">x</span><span class="op" id="5639936">,</span>&nbsp;<span class="ident" id="5639938">y</span>&nbsp;<span class="builtintype" id="5639940">int</span><span class="op" id="5639943">,</span>&nbsp;<span class="ident" id="5639945">c</span>&nbsp;<span class="ident" id="5639947">color</span><span class="op" id="5639952">.</span><span class="ident" id="5639953">RGBA64</span><span class="op" id="5639959">)</span>&nbsp;<span class="op" id="5639961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5639964">if</span>&nbsp;<span class="op" id="5639967">!</span><span class="op" id="5639968">(</span><span class="ident" id="5639969">Point</span><span class="op" id="5639974">{</span><span class="ident" id="5639975">x</span><span class="op" id="5639976">,</span>&nbsp;<span class="ident" id="5639978">y</span><span class="op" id="5639979">}</span><span class="op" id="5639980">.</span><span class="ident" id="5639981">In</span><span class="op" id="5639983">(</span><span class="ident" id="5639984">p</span><span class="op" id="5639985">.</span><span class="ident" id="5639986">Rect</span><span class="op" id="5639990">)</span><span class="op" id="5639991">)</span>&nbsp;<span class="op" id="5639993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5639997">return</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5640005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5640008">i</span>&nbsp;<span class="op" id="5640010">:=</span>&nbsp;<span class="ident" id="5640013">p</span><span class="op" id="5640014">.</span><span class="ident" id="5640015">PixOffset</span><span class="op" id="5640024">(</span><span class="ident" id="5640025">x</span><span class="op" id="5640026">,</span>&nbsp;<span class="ident" id="5640028">y</span><span class="op" id="5640029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5640032">p</span><span class="op" id="5640033">.</span><span class="ident" id="5640034">Pix</span><span class="op" id="5640037">[</span><span class="ident" id="5640038">i</span><span class="op" id="5640039">+</span><span class="num" id="5640040">0</span><span class="op" id="5640041">]</span>&nbsp;<span class="op" id="5640043">=</span>&nbsp;<span class="builtintype" id="5640045">uint8</span><span class="op" id="5640050">(</span><span class="ident" id="5640051">c</span><span class="op" id="5640052">.</span><span class="ident" id="5640053">R</span>&nbsp;<span class="op" id="5640055">&gt;&gt;</span>&nbsp;<span class="num" id="5640058">8</span><span class="op" id="5640059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5640062">p</span><span class="op" id="5640063">.</span><span class="ident" id="5640064">Pix</span><span class="op" id="5640067">[</span><span class="ident" id="5640068">i</span><span class="op" id="5640069">+</span><span class="num" id="5640070">1</span><span class="op" id="5640071">]</span>&nbsp;<span class="op" id="5640073">=</span>&nbsp;<span class="builtintype" id="5640075">uint8</span><span class="op" id="5640080">(</span><span class="ident" id="5640081">c</span><span class="op" id="5640082">.</span><span class="ident" id="5640083">R</span><span class="op" id="5640084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5640087">p</span><span class="op" id="5640088">.</span><span class="ident" id="5640089">Pix</span><span class="op" id="5640092">[</span><span class="ident" id="5640093">i</span><span class="op" id="5640094">+</span><span class="num" id="5640095">2</span><span class="op" id="5640096">]</span>&nbsp;<span class="op" id="5640098">=</span>&nbsp;<span class="builtintype" id="5640100">uint8</span><span class="op" id="5640105">(</span><span class="ident" id="5640106">c</span><span class="op" id="5640107">.</span><span class="ident" id="5640108">G</span>&nbsp;<span class="op" id="5640110">&gt;&gt;</span>&nbsp;<span class="num" id="5640113">8</span><span class="op" id="5640114">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5640117">p</span><span class="op" id="5640118">.</span><span class="ident" id="5640119">Pix</span><span class="op" id="5640122">[</span><span class="ident" id="5640123">i</span><span class="op" id="5640124">+</span><span class="num" id="5640125">3</span><span class="op" id="5640126">]</span>&nbsp;<span class="op" id="5640128">=</span>&nbsp;<span class="builtintype" id="5640130">uint8</span><span class="op" id="5640135">(</span><span class="ident" id="5640136">c</span><span class="op" id="5640137">.</span><span class="ident" id="5640138">G</span><span class="op" id="5640139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5640142">p</span><span class="op" id="5640143">.</span><span class="ident" id="5640144">Pix</span><span class="op" id="5640147">[</span><span class="ident" id="5640148">i</span><span class="op" id="5640149">+</span><span class="num" id="5640150">4</span><span class="op" id="5640151">]</span>&nbsp;<span class="op" id="5640153">=</span>&nbsp;<span class="builtintype" id="5640155">uint8</span><span class="op" id="5640160">(</span><span class="ident" id="5640161">c</span><span class="op" id="5640162">.</span><span class="ident" id="5640163">B</span>&nbsp;<span class="op" id="5640165">&gt;&gt;</span>&nbsp;<span class="num" id="5640168">8</span><span class="op" id="5640169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5640172">p</span><span class="op" id="5640173">.</span><span class="ident" id="5640174">Pix</span><span class="op" id="5640177">[</span><span class="ident" id="5640178">i</span><span class="op" id="5640179">+</span><span class="num" id="5640180">5</span><span class="op" id="5640181">]</span>&nbsp;<span class="op" id="5640183">=</span>&nbsp;<span class="builtintype" id="5640185">uint8</span><span class="op" id="5640190">(</span><span class="ident" id="5640191">c</span><span class="op" id="5640192">.</span><span class="ident" id="5640193">B</span><span class="op" id="5640194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5640197">p</span><span class="op" id="5640198">.</span><span class="ident" id="5640199">Pix</span><span class="op" id="5640202">[</span><span class="ident" id="5640203">i</span><span class="op" id="5640204">+</span><span class="num" id="5640205">6</span><span class="op" id="5640206">]</span>&nbsp;<span class="op" id="5640208">=</span>&nbsp;<span class="builtintype" id="5640210">uint8</span><span class="op" id="5640215">(</span><span class="ident" id="5640216">c</span><span class="op" id="5640217">.</span><span class="ident" id="5640218">A</span>&nbsp;<span class="op" id="5640220">&gt;&gt;</span>&nbsp;<span class="num" id="5640223">8</span><span class="op" id="5640224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5640227">p</span><span class="op" id="5640228">.</span><span class="ident" id="5640229">Pix</span><span class="op" id="5640232">[</span><span class="ident" id="5640233">i</span><span class="op" id="5640234">+</span><span class="num" id="5640235">7</span><span class="op" id="5640236">]</span>&nbsp;<span class="op" id="5640238">=</span>&nbsp;<span class="builtintype" id="5640240">uint8</span><span class="op" id="5640245">(</span><span class="ident" id="5640246">c</span><span class="op" id="5640247">.</span><span class="ident" id="5640248">A</span><span class="op" id="5640249">)</span><br>
<span class="lineno">225</span><span class="op" id="5640251">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5640254">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5640331">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5640403">func</span>&nbsp;<span class="op" id="5640408">(</span><span class="ident" id="5640409">p</span>&nbsp;<span class="op" id="5640411">*</span><span class="ident" id="5640412">RGBA64</span><span class="op" id="5640418">)</span>&nbsp;<span class="ident" id="5640420">SubImage</span><span class="op" id="5640428">(</span><span class="ident" id="5640429">r</span>&nbsp;<span class="ident" id="5640431">Rectangle</span><span class="op" id="5640440">)</span>&nbsp;<span class="ident" id="5640442">Image</span>&nbsp;<span class="op" id="5640448">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5640451">r</span>&nbsp;<span class="op" id="5640453">=</span>&nbsp;<span class="ident" id="5640455">r</span><span class="op" id="5640456">.</span><span class="ident" id="5640457">Intersect</span><span class="op" id="5640466">(</span><span class="ident" id="5640467">p</span><span class="op" id="5640468">.</span><span class="ident" id="5640469">Rect</span><span class="op" id="5640473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5640476">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5640557">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5640639">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5640689">if</span>&nbsp;<span class="ident" id="5640692">r</span><span class="op" id="5640693">.</span><span class="ident" id="5640694">Empty</span><span class="op" id="5640699">(</span><span class="op" id="5640700">)</span>&nbsp;<span class="op" id="5640702">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5640706">return</span>&nbsp;<span class="op" id="5640713">&amp;</span><span class="ident" id="5640714">RGBA64</span><span class="op" id="5640720">{</span><span class="op" id="5640721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5640724">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5640727">i</span>&nbsp;<span class="op" id="5640729">:=</span>&nbsp;<span class="ident" id="5640732">p</span><span class="op" id="5640733">.</span><span class="ident" id="5640734">PixOffset</span><span class="op" id="5640743">(</span><span class="ident" id="5640744">r</span><span class="op" id="5640745">.</span><span class="ident" id="5640746">Min</span><span class="op" id="5640749">.</span><span class="ident" id="5640750">X</span><span class="op" id="5640751">,</span>&nbsp;<span class="ident" id="5640753">r</span><span class="op" id="5640754">.</span><span class="ident" id="5640755">Min</span><span class="op" id="5640758">.</span><span class="ident" id="5640759">Y</span><span class="op" id="5640760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5640763">return</span>&nbsp;<span class="op" id="5640770">&amp;</span><span class="ident" id="5640771">RGBA64</span><span class="op" id="5640777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5640781">Pix</span><span class="op" id="5640784">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5640789">p</span><span class="op" id="5640790">.</span><span class="ident" id="5640791">Pix</span><span class="op" id="5640794">[</span><span class="ident" id="5640795">i</span><span class="op" id="5640796">:</span><span class="op" id="5640797">]</span><span class="op" id="5640798">,</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5640802">Stride</span><span class="op" id="5640808">:</span>&nbsp;<span class="ident" id="5640810">p</span><span class="op" id="5640811">.</span><span class="ident" id="5640812">Stride</span><span class="op" id="5640818">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5640822">Rect</span><span class="op" id="5640826">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5640830">r</span><span class="op" id="5640831">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5640834">}</span><br>
<span class="lineno"></span><span class="op" id="5640836">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span><span class="comment" id="5640839">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5640912">func</span>&nbsp;<span class="op" id="5640917">(</span><span class="ident" id="5640918">p</span>&nbsp;<span class="op" id="5640920">*</span><span class="ident" id="5640921">RGBA64</span><span class="op" id="5640927">)</span>&nbsp;<span class="ident" id="5640929">Opaque</span><span class="op" id="5640935">(</span><span class="op" id="5640936">)</span>&nbsp;<span class="builtintype" id="5640938">bool</span>&nbsp;<span class="op" id="5640943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5640946">if</span>&nbsp;<span class="ident" id="5640949">p</span><span class="op" id="5640950">.</span><span class="ident" id="5640951">Rect</span><span class="op" id="5640955">.</span><span class="ident" id="5640956">Empty</span><span class="op" id="5640961">(</span><span class="op" id="5640962">)</span>&nbsp;<span class="op" id="5640964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5640968">return</span>&nbsp;<span class="builtintype" id="5640975">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5640981">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5640984">i0</span><span class="op" id="5640986">,</span>&nbsp;<span class="ident" id="5640988">i1</span>&nbsp;<span class="op" id="5640991">:=</span>&nbsp;<span class="num" id="5640994">6</span><span class="op" id="5640995">,</span>&nbsp;<span class="ident" id="5640997">p</span><span class="op" id="5640998">.</span><span class="ident" id="5640999">Rect</span><span class="op" id="5641003">.</span><span class="ident" id="5641004">Dx</span><span class="op" id="5641006">(</span><span class="op" id="5641007">)</span><span class="op" id="5641008">*</span><span class="num" id="5641009">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5641012">for</span>&nbsp;<span class="ident" id="5641016">y</span>&nbsp;<span class="op" id="5641018">:=</span>&nbsp;<span class="ident" id="5641021">p</span><span class="op" id="5641022">.</span><span class="ident" id="5641023">Rect</span><span class="op" id="5641027">.</span><span class="ident" id="5641028">Min</span><span class="op" id="5641031">.</span><span class="ident" id="5641032">Y</span><span class="op" id="5641033">;</span>&nbsp;<span class="ident" id="5641035">y</span>&nbsp;<span class="op" id="5641037">&lt;</span>&nbsp;<span class="ident" id="5641039">p</span><span class="op" id="5641040">.</span><span class="ident" id="5641041">Rect</span><span class="op" id="5641045">.</span><span class="ident" id="5641046">Max</span><span class="op" id="5641049">.</span><span class="ident" id="5641050">Y</span><span class="op" id="5641051">;</span>&nbsp;<span class="ident" id="5641053">y</span><span class="op" id="5641054">++</span>&nbsp;<span class="op" id="5641057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5641061">for</span>&nbsp;<span class="ident" id="5641065">i</span>&nbsp;<span class="op" id="5641067">:=</span>&nbsp;<span class="ident" id="5641070">i0</span><span class="op" id="5641072">;</span>&nbsp;<span class="ident" id="5641074">i</span>&nbsp;<span class="op" id="5641076">&lt;</span>&nbsp;<span class="ident" id="5641078">i1</span><span class="op" id="5641080">;</span>&nbsp;<span class="ident" id="5641082">i</span>&nbsp;<span class="op" id="5641084">+=</span>&nbsp;<span class="num" id="5641087">8</span>&nbsp;<span class="op" id="5641089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5641094">if</span>&nbsp;<span class="ident" id="5641097">p</span><span class="op" id="5641098">.</span><span class="ident" id="5641099">Pix</span><span class="op" id="5641102">[</span><span class="ident" id="5641103">i</span><span class="op" id="5641104">+</span><span class="num" id="5641105">0</span><span class="op" id="5641106">]</span>&nbsp;<span class="op" id="5641108">!=</span>&nbsp;<span class="num" id="5641111">0xff</span>&nbsp;<span class="op" id="5641116">||</span>&nbsp;<span class="ident" id="5641119">p</span><span class="op" id="5641120">.</span><span class="ident" id="5641121">Pix</span><span class="op" id="5641124">[</span><span class="ident" id="5641125">i</span><span class="op" id="5641126">+</span><span class="num" id="5641127">1</span><span class="op" id="5641128">]</span>&nbsp;<span class="op" id="5641130">!=</span>&nbsp;<span class="num" id="5641133">0xff</span>&nbsp;<span class="op" id="5641138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5641144">return</span>&nbsp;<span class="builtintype" id="5641151">false</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5641160">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5641164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5641168">i0</span>&nbsp;<span class="op" id="5641171">+=</span>&nbsp;<span class="ident" id="5641174">p</span><span class="op" id="5641175">.</span><span class="ident" id="5641176">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5641185">i1</span>&nbsp;<span class="op" id="5641188">+=</span>&nbsp;<span class="ident" id="5641191">p</span><span class="op" id="5641192">.</span><span class="ident" id="5641193">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5641201">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5641204">return</span>&nbsp;<span class="builtintype" id="5641211">true</span><br>
<span class="lineno"></span><span class="op" id="5641216">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5641219">//&nbsp;NewRGBA64&nbsp;returns&nbsp;a&nbsp;new&nbsp;RGBA64&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="5641276">func</span>&nbsp;<span class="ident" id="5641281">NewRGBA64</span><span class="op" id="5641290">(</span><span class="ident" id="5641291">r</span>&nbsp;<span class="ident" id="5641293">Rectangle</span><span class="op" id="5641302">)</span>&nbsp;<span class="op" id="5641304">*</span><span class="ident" id="5641305">RGBA64</span>&nbsp;<span class="op" id="5641312">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5641315">w</span><span class="op" id="5641316">,</span>&nbsp;<span class="ident" id="5641318">h</span>&nbsp;<span class="op" id="5641320">:=</span>&nbsp;<span class="ident" id="5641323">r</span><span class="op" id="5641324">.</span><span class="ident" id="5641325">Dx</span><span class="op" id="5641327">(</span><span class="op" id="5641328">)</span><span class="op" id="5641329">,</span>&nbsp;<span class="ident" id="5641331">r</span><span class="op" id="5641332">.</span><span class="ident" id="5641333">Dy</span><span class="op" id="5641335">(</span><span class="op" id="5641336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5641339">pix</span>&nbsp;<span class="op" id="5641343">:=</span>&nbsp;<span class="builtinfunc" id="5641346">make</span><span class="op" id="5641350">(</span><span class="op" id="5641351">[</span><span class="op" id="5641352">]</span><span class="builtintype" id="5641353">uint8</span><span class="op" id="5641358">,</span>&nbsp;<span class="num" id="5641360">8</span><span class="op" id="5641361">*</span><span class="ident" id="5641362">w</span><span class="op" id="5641363">*</span><span class="ident" id="5641364">h</span><span class="op" id="5641365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5641368">return</span>&nbsp;<span class="op" id="5641375">&amp;</span><span class="ident" id="5641376">RGBA64</span><span class="op" id="5641382">{</span><span class="ident" id="5641383">pix</span><span class="op" id="5641386">,</span>&nbsp;<span class="num" id="5641388">8</span>&nbsp;<span class="op" id="5641390">*</span>&nbsp;<span class="ident" id="5641392">w</span><span class="op" id="5641393">,</span>&nbsp;<span class="ident" id="5641395">r</span><span class="op" id="5641396">}</span><br>
<span class="lineno"></span><span class="op" id="5641398">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="5641401">//&nbsp;NRGBA&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.NRGBA&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5641476">type</span>&nbsp;<span class="ident" id="5641481">NRGBA</span>&nbsp;<span class="keyword" id="5641487">struct</span>&nbsp;<span class="op" id="5641494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5641497">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;in&nbsp;R,&nbsp;G,&nbsp;B,&nbsp;A&nbsp;order.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5641565">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*4].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5641633">Pix</span>&nbsp;<span class="op" id="5641637">[</span><span class="op" id="5641638">]</span><span class="builtintype" id="5641639">uint8</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5641646">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5641722">Stride</span>&nbsp;<span class="builtintype" id="5641729">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5641734">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5641766">Rect</span>&nbsp;<span class="ident" id="5641771">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="5641781">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="keyword" id="5641784">func</span>&nbsp;<span class="op" id="5641789">(</span><span class="ident" id="5641790">p</span>&nbsp;<span class="op" id="5641792">*</span><span class="ident" id="5641793">NRGBA</span><span class="op" id="5641798">)</span>&nbsp;<span class="ident" id="5641800">ColorModel</span><span class="op" id="5641810">(</span><span class="op" id="5641811">)</span>&nbsp;<span class="ident" id="5641813">color</span><span class="op" id="5641818">.</span><span class="ident" id="5641819">Model</span>&nbsp;<span class="op" id="5641825">{</span>&nbsp;<span class="keyword" id="5641827">return</span>&nbsp;<span class="ident" id="5641834">color</span><span class="op" id="5641839">.</span><span class="ident" id="5641840">NRGBAModel</span>&nbsp;<span class="op" id="5641851">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5641854">func</span>&nbsp;<span class="op" id="5641859">(</span><span class="ident" id="5641860">p</span>&nbsp;<span class="op" id="5641862">*</span><span class="ident" id="5641863">NRGBA</span><span class="op" id="5641868">)</span>&nbsp;<span class="ident" id="5641870">Bounds</span><span class="op" id="5641876">(</span><span class="op" id="5641877">)</span>&nbsp;<span class="ident" id="5641879">Rectangle</span>&nbsp;<span class="op" id="5641889">{</span>&nbsp;<span class="keyword" id="5641891">return</span>&nbsp;<span class="ident" id="5641898">p</span><span class="op" id="5641899">.</span><span class="ident" id="5641900">Rect</span>&nbsp;<span class="op" id="5641905">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="keyword" id="5641908">func</span>&nbsp;<span class="op" id="5641913">(</span><span class="ident" id="5641914">p</span>&nbsp;<span class="op" id="5641916">*</span><span class="ident" id="5641917">NRGBA</span><span class="op" id="5641922">)</span>&nbsp;<span class="ident" id="5641924">At</span><span class="op" id="5641926">(</span><span class="ident" id="5641927">x</span><span class="op" id="5641928">,</span>&nbsp;<span class="ident" id="5641930">y</span>&nbsp;<span class="builtintype" id="5641932">int</span><span class="op" id="5641935">)</span>&nbsp;<span class="ident" id="5641937">color</span><span class="op" id="5641942">.</span><span class="ident" id="5641943">Color</span>&nbsp;<span class="op" id="5641949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5641952">return</span>&nbsp;<span class="ident" id="5641959">p</span><span class="op" id="5641960">.</span><span class="ident" id="5641961">NRGBAAt</span><span class="op" id="5641968">(</span><span class="ident" id="5641969">x</span><span class="op" id="5641970">,</span>&nbsp;<span class="ident" id="5641972">y</span><span class="op" id="5641973">)</span><br>
<span class="lineno"></span><span class="op" id="5641975">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5641978">func</span>&nbsp;<span class="op" id="5641983">(</span><span class="ident" id="5641984">p</span>&nbsp;<span class="op" id="5641986">*</span><span class="ident" id="5641987">NRGBA</span><span class="op" id="5641992">)</span>&nbsp;<span class="ident" id="5641994">NRGBAAt</span><span class="op" id="5642001">(</span><span class="ident" id="5642002">x</span><span class="op" id="5642003">,</span>&nbsp;<span class="ident" id="5642005">y</span>&nbsp;<span class="builtintype" id="5642007">int</span><span class="op" id="5642010">)</span>&nbsp;<span class="ident" id="5642012">color</span><span class="op" id="5642017">.</span><span class="ident" id="5642018">NRGBA</span>&nbsp;<span class="op" id="5642024">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5642027">if</span>&nbsp;<span class="op" id="5642030">!</span><span class="op" id="5642031">(</span><span class="ident" id="5642032">Point</span><span class="op" id="5642037">{</span><span class="ident" id="5642038">x</span><span class="op" id="5642039">,</span>&nbsp;<span class="ident" id="5642041">y</span><span class="op" id="5642042">}</span><span class="op" id="5642043">.</span><span class="ident" id="5642044">In</span><span class="op" id="5642046">(</span><span class="ident" id="5642047">p</span><span class="op" id="5642048">.</span><span class="ident" id="5642049">Rect</span><span class="op" id="5642053">)</span><span class="op" id="5642054">)</span>&nbsp;<span class="op" id="5642056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5642060">return</span>&nbsp;<span class="ident" id="5642067">color</span><span class="op" id="5642072">.</span><span class="ident" id="5642073">NRGBA</span><span class="op" id="5642078">{</span><span class="op" id="5642079">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5642082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5642085">i</span>&nbsp;<span class="op" id="5642087">:=</span>&nbsp;<span class="ident" id="5642090">p</span><span class="op" id="5642091">.</span><span class="ident" id="5642092">PixOffset</span><span class="op" id="5642101">(</span><span class="ident" id="5642102">x</span><span class="op" id="5642103">,</span>&nbsp;<span class="ident" id="5642105">y</span><span class="op" id="5642106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5642109">return</span>&nbsp;<span class="ident" id="5642116">color</span><span class="op" id="5642121">.</span><span class="ident" id="5642122">NRGBA</span><span class="op" id="5642127">{</span><span class="ident" id="5642128">p</span><span class="op" id="5642129">.</span><span class="ident" id="5642130">Pix</span><span class="op" id="5642133">[</span><span class="ident" id="5642134">i</span><span class="op" id="5642135">+</span><span class="num" id="5642136">0</span><span class="op" id="5642137">]</span><span class="op" id="5642138">,</span>&nbsp;<span class="ident" id="5642140">p</span><span class="op" id="5642141">.</span><span class="ident" id="5642142">Pix</span><span class="op" id="5642145">[</span><span class="ident" id="5642146">i</span><span class="op" id="5642147">+</span><span class="num" id="5642148">1</span><span class="op" id="5642149">]</span><span class="op" id="5642150">,</span>&nbsp;<span class="ident" id="5642152">p</span><span class="op" id="5642153">.</span><span class="ident" id="5642154">Pix</span><span class="op" id="5642157">[</span><span class="ident" id="5642158">i</span><span class="op" id="5642159">+</span><span class="num" id="5642160">2</span><span class="op" id="5642161">]</span><span class="op" id="5642162">,</span>&nbsp;<span class="ident" id="5642164">p</span><span class="op" id="5642165">.</span><span class="ident" id="5642166">Pix</span><span class="op" id="5642169">[</span><span class="ident" id="5642170">i</span><span class="op" id="5642171">+</span><span class="num" id="5642172">3</span><span class="op" id="5642173">]</span><span class="op" id="5642174">}</span><br>
<span class="lineno">295</span><span class="op" id="5642176">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5642179">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5642258">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5642282">func</span>&nbsp;<span class="op" id="5642287">(</span><span class="ident" id="5642288">p</span>&nbsp;<span class="op" id="5642290">*</span><span class="ident" id="5642291">NRGBA</span><span class="op" id="5642296">)</span>&nbsp;<span class="ident" id="5642298">PixOffset</span><span class="op" id="5642307">(</span><span class="ident" id="5642308">x</span><span class="op" id="5642309">,</span>&nbsp;<span class="ident" id="5642311">y</span>&nbsp;<span class="builtintype" id="5642313">int</span><span class="op" id="5642316">)</span>&nbsp;<span class="builtintype" id="5642318">int</span>&nbsp;<span class="op" id="5642322">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5642325">return</span>&nbsp;<span class="op" id="5642332">(</span><span class="ident" id="5642333">y</span><span class="op" id="5642334">-</span><span class="ident" id="5642335">p</span><span class="op" id="5642336">.</span><span class="ident" id="5642337">Rect</span><span class="op" id="5642341">.</span><span class="ident" id="5642342">Min</span><span class="op" id="5642345">.</span><span class="ident" id="5642346">Y</span><span class="op" id="5642347">)</span><span class="op" id="5642348">*</span><span class="ident" id="5642349">p</span><span class="op" id="5642350">.</span><span class="ident" id="5642351">Stride</span>&nbsp;<span class="op" id="5642358">+</span>&nbsp;<span class="op" id="5642360">(</span><span class="ident" id="5642361">x</span><span class="op" id="5642362">-</span><span class="ident" id="5642363">p</span><span class="op" id="5642364">.</span><span class="ident" id="5642365">Rect</span><span class="op" id="5642369">.</span><span class="ident" id="5642370">Min</span><span class="op" id="5642373">.</span><span class="ident" id="5642374">X</span><span class="op" id="5642375">)</span><span class="op" id="5642376">*</span><span class="num" id="5642377">4</span><br>
<span class="lineno"></span><span class="op" id="5642379">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5642382">func</span>&nbsp;<span class="op" id="5642387">(</span><span class="ident" id="5642388">p</span>&nbsp;<span class="op" id="5642390">*</span><span class="ident" id="5642391">NRGBA</span><span class="op" id="5642396">)</span>&nbsp;<span class="ident" id="5642398">Set</span><span class="op" id="5642401">(</span><span class="ident" id="5642402">x</span><span class="op" id="5642403">,</span>&nbsp;<span class="ident" id="5642405">y</span>&nbsp;<span class="builtintype" id="5642407">int</span><span class="op" id="5642410">,</span>&nbsp;<span class="ident" id="5642412">c</span>&nbsp;<span class="ident" id="5642414">color</span><span class="op" id="5642419">.</span><span class="ident" id="5642420">Color</span><span class="op" id="5642425">)</span>&nbsp;<span class="op" id="5642427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5642430">if</span>&nbsp;<span class="op" id="5642433">!</span><span class="op" id="5642434">(</span><span class="ident" id="5642435">Point</span><span class="op" id="5642440">{</span><span class="ident" id="5642441">x</span><span class="op" id="5642442">,</span>&nbsp;<span class="ident" id="5642444">y</span><span class="op" id="5642445">}</span><span class="op" id="5642446">.</span><span class="ident" id="5642447">In</span><span class="op" id="5642449">(</span><span class="ident" id="5642450">p</span><span class="op" id="5642451">.</span><span class="ident" id="5642452">Rect</span><span class="op" id="5642456">)</span><span class="op" id="5642457">)</span>&nbsp;<span class="op" id="5642459">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5642463">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5642471">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5642474">i</span>&nbsp;<span class="op" id="5642476">:=</span>&nbsp;<span class="ident" id="5642479">p</span><span class="op" id="5642480">.</span><span class="ident" id="5642481">PixOffset</span><span class="op" id="5642490">(</span><span class="ident" id="5642491">x</span><span class="op" id="5642492">,</span>&nbsp;<span class="ident" id="5642494">y</span><span class="op" id="5642495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5642498">c1</span>&nbsp;<span class="op" id="5642501">:=</span>&nbsp;<span class="ident" id="5642504">color</span><span class="op" id="5642509">.</span><span class="ident" id="5642510">NRGBAModel</span><span class="op" id="5642520">.</span><span class="ident" id="5642521">Convert</span><span class="op" id="5642528">(</span><span class="ident" id="5642529">c</span><span class="op" id="5642530">)</span><span class="op" id="5642531">.</span><span class="op" id="5642532">(</span><span class="ident" id="5642533">color</span><span class="op" id="5642538">.</span><span class="ident" id="5642539">NRGBA</span><span class="op" id="5642544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5642547">p</span><span class="op" id="5642548">.</span><span class="ident" id="5642549">Pix</span><span class="op" id="5642552">[</span><span class="ident" id="5642553">i</span><span class="op" id="5642554">+</span><span class="num" id="5642555">0</span><span class="op" id="5642556">]</span>&nbsp;<span class="op" id="5642558">=</span>&nbsp;<span class="ident" id="5642560">c1</span><span class="op" id="5642562">.</span><span class="ident" id="5642563">R</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5642566">p</span><span class="op" id="5642567">.</span><span class="ident" id="5642568">Pix</span><span class="op" id="5642571">[</span><span class="ident" id="5642572">i</span><span class="op" id="5642573">+</span><span class="num" id="5642574">1</span><span class="op" id="5642575">]</span>&nbsp;<span class="op" id="5642577">=</span>&nbsp;<span class="ident" id="5642579">c1</span><span class="op" id="5642581">.</span><span class="ident" id="5642582">G</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5642585">p</span><span class="op" id="5642586">.</span><span class="ident" id="5642587">Pix</span><span class="op" id="5642590">[</span><span class="ident" id="5642591">i</span><span class="op" id="5642592">+</span><span class="num" id="5642593">2</span><span class="op" id="5642594">]</span>&nbsp;<span class="op" id="5642596">=</span>&nbsp;<span class="ident" id="5642598">c1</span><span class="op" id="5642600">.</span><span class="ident" id="5642601">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5642604">p</span><span class="op" id="5642605">.</span><span class="ident" id="5642606">Pix</span><span class="op" id="5642609">[</span><span class="ident" id="5642610">i</span><span class="op" id="5642611">+</span><span class="num" id="5642612">3</span><span class="op" id="5642613">]</span>&nbsp;<span class="op" id="5642615">=</span>&nbsp;<span class="ident" id="5642617">c1</span><span class="op" id="5642619">.</span><span class="ident" id="5642620">A</span><br>
<span class="lineno"></span><span class="op" id="5642622">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="keyword" id="5642625">func</span>&nbsp;<span class="op" id="5642630">(</span><span class="ident" id="5642631">p</span>&nbsp;<span class="op" id="5642633">*</span><span class="ident" id="5642634">NRGBA</span><span class="op" id="5642639">)</span>&nbsp;<span class="ident" id="5642641">SetNRGBA</span><span class="op" id="5642649">(</span><span class="ident" id="5642650">x</span><span class="op" id="5642651">,</span>&nbsp;<span class="ident" id="5642653">y</span>&nbsp;<span class="builtintype" id="5642655">int</span><span class="op" id="5642658">,</span>&nbsp;<span class="ident" id="5642660">c</span>&nbsp;<span class="ident" id="5642662">color</span><span class="op" id="5642667">.</span><span class="ident" id="5642668">NRGBA</span><span class="op" id="5642673">)</span>&nbsp;<span class="op" id="5642675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5642678">if</span>&nbsp;<span class="op" id="5642681">!</span><span class="op" id="5642682">(</span><span class="ident" id="5642683">Point</span><span class="op" id="5642688">{</span><span class="ident" id="5642689">x</span><span class="op" id="5642690">,</span>&nbsp;<span class="ident" id="5642692">y</span><span class="op" id="5642693">}</span><span class="op" id="5642694">.</span><span class="ident" id="5642695">In</span><span class="op" id="5642697">(</span><span class="ident" id="5642698">p</span><span class="op" id="5642699">.</span><span class="ident" id="5642700">Rect</span><span class="op" id="5642704">)</span><span class="op" id="5642705">)</span>&nbsp;<span class="op" id="5642707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5642711">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5642719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5642722">i</span>&nbsp;<span class="op" id="5642724">:=</span>&nbsp;<span class="ident" id="5642727">p</span><span class="op" id="5642728">.</span><span class="ident" id="5642729">PixOffset</span><span class="op" id="5642738">(</span><span class="ident" id="5642739">x</span><span class="op" id="5642740">,</span>&nbsp;<span class="ident" id="5642742">y</span><span class="op" id="5642743">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5642746">p</span><span class="op" id="5642747">.</span><span class="ident" id="5642748">Pix</span><span class="op" id="5642751">[</span><span class="ident" id="5642752">i</span><span class="op" id="5642753">+</span><span class="num" id="5642754">0</span><span class="op" id="5642755">]</span>&nbsp;<span class="op" id="5642757">=</span>&nbsp;<span class="ident" id="5642759">c</span><span class="op" id="5642760">.</span><span class="ident" id="5642761">R</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5642764">p</span><span class="op" id="5642765">.</span><span class="ident" id="5642766">Pix</span><span class="op" id="5642769">[</span><span class="ident" id="5642770">i</span><span class="op" id="5642771">+</span><span class="num" id="5642772">1</span><span class="op" id="5642773">]</span>&nbsp;<span class="op" id="5642775">=</span>&nbsp;<span class="ident" id="5642777">c</span><span class="op" id="5642778">.</span><span class="ident" id="5642779">G</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5642782">p</span><span class="op" id="5642783">.</span><span class="ident" id="5642784">Pix</span><span class="op" id="5642787">[</span><span class="ident" id="5642788">i</span><span class="op" id="5642789">+</span><span class="num" id="5642790">2</span><span class="op" id="5642791">]</span>&nbsp;<span class="op" id="5642793">=</span>&nbsp;<span class="ident" id="5642795">c</span><span class="op" id="5642796">.</span><span class="ident" id="5642797">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5642800">p</span><span class="op" id="5642801">.</span><span class="ident" id="5642802">Pix</span><span class="op" id="5642805">[</span><span class="ident" id="5642806">i</span><span class="op" id="5642807">+</span><span class="num" id="5642808">3</span><span class="op" id="5642809">]</span>&nbsp;<span class="op" id="5642811">=</span>&nbsp;<span class="ident" id="5642813">c</span><span class="op" id="5642814">.</span><span class="ident" id="5642815">A</span><br>
<span class="lineno"></span><span class="op" id="5642817">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="comment" id="5642820">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5642897">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5642969">func</span>&nbsp;<span class="op" id="5642974">(</span><span class="ident" id="5642975">p</span>&nbsp;<span class="op" id="5642977">*</span><span class="ident" id="5642978">NRGBA</span><span class="op" id="5642983">)</span>&nbsp;<span class="ident" id="5642985">SubImage</span><span class="op" id="5642993">(</span><span class="ident" id="5642994">r</span>&nbsp;<span class="ident" id="5642996">Rectangle</span><span class="op" id="5643005">)</span>&nbsp;<span class="ident" id="5643007">Image</span>&nbsp;<span class="op" id="5643013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5643016">r</span>&nbsp;<span class="op" id="5643018">=</span>&nbsp;<span class="ident" id="5643020">r</span><span class="op" id="5643021">.</span><span class="ident" id="5643022">Intersect</span><span class="op" id="5643031">(</span><span class="ident" id="5643032">p</span><span class="op" id="5643033">.</span><span class="ident" id="5643034">Rect</span><span class="op" id="5643038">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5643041">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5643122">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5643204">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5643254">if</span>&nbsp;<span class="ident" id="5643257">r</span><span class="op" id="5643258">.</span><span class="ident" id="5643259">Empty</span><span class="op" id="5643264">(</span><span class="op" id="5643265">)</span>&nbsp;<span class="op" id="5643267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5643271">return</span>&nbsp;<span class="op" id="5643278">&amp;</span><span class="ident" id="5643279">NRGBA</span><span class="op" id="5643284">{</span><span class="op" id="5643285">}</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5643288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5643291">i</span>&nbsp;<span class="op" id="5643293">:=</span>&nbsp;<span class="ident" id="5643296">p</span><span class="op" id="5643297">.</span><span class="ident" id="5643298">PixOffset</span><span class="op" id="5643307">(</span><span class="ident" id="5643308">r</span><span class="op" id="5643309">.</span><span class="ident" id="5643310">Min</span><span class="op" id="5643313">.</span><span class="ident" id="5643314">X</span><span class="op" id="5643315">,</span>&nbsp;<span class="ident" id="5643317">r</span><span class="op" id="5643318">.</span><span class="ident" id="5643319">Min</span><span class="op" id="5643322">.</span><span class="ident" id="5643323">Y</span><span class="op" id="5643324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5643327">return</span>&nbsp;<span class="op" id="5643334">&amp;</span><span class="ident" id="5643335">NRGBA</span><span class="op" id="5643340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5643344">Pix</span><span class="op" id="5643347">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5643352">p</span><span class="op" id="5643353">.</span><span class="ident" id="5643354">Pix</span><span class="op" id="5643357">[</span><span class="ident" id="5643358">i</span><span class="op" id="5643359">:</span><span class="op" id="5643360">]</span><span class="op" id="5643361">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5643365">Stride</span><span class="op" id="5643371">:</span>&nbsp;<span class="ident" id="5643373">p</span><span class="op" id="5643374">.</span><span class="ident" id="5643375">Stride</span><span class="op" id="5643381">,</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5643385">Rect</span><span class="op" id="5643389">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5643393">r</span><span class="op" id="5643394">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5643397">}</span><br>
<span class="lineno"></span><span class="op" id="5643399">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5643402">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno">345</span><span class="keyword" id="5643475">func</span>&nbsp;<span class="op" id="5643480">(</span><span class="ident" id="5643481">p</span>&nbsp;<span class="op" id="5643483">*</span><span class="ident" id="5643484">NRGBA</span><span class="op" id="5643489">)</span>&nbsp;<span class="ident" id="5643491">Opaque</span><span class="op" id="5643497">(</span><span class="op" id="5643498">)</span>&nbsp;<span class="builtintype" id="5643500">bool</span>&nbsp;<span class="op" id="5643505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5643508">if</span>&nbsp;<span class="ident" id="5643511">p</span><span class="op" id="5643512">.</span><span class="ident" id="5643513">Rect</span><span class="op" id="5643517">.</span><span class="ident" id="5643518">Empty</span><span class="op" id="5643523">(</span><span class="op" id="5643524">)</span>&nbsp;<span class="op" id="5643526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5643530">return</span>&nbsp;<span class="builtintype" id="5643537">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5643543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5643546">i0</span><span class="op" id="5643548">,</span>&nbsp;<span class="ident" id="5643550">i1</span>&nbsp;<span class="op" id="5643553">:=</span>&nbsp;<span class="num" id="5643556">3</span><span class="op" id="5643557">,</span>&nbsp;<span class="ident" id="5643559">p</span><span class="op" id="5643560">.</span><span class="ident" id="5643561">Rect</span><span class="op" id="5643565">.</span><span class="ident" id="5643566">Dx</span><span class="op" id="5643568">(</span><span class="op" id="5643569">)</span><span class="op" id="5643570">*</span><span class="num" id="5643571">4</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5643574">for</span>&nbsp;<span class="ident" id="5643578">y</span>&nbsp;<span class="op" id="5643580">:=</span>&nbsp;<span class="ident" id="5643583">p</span><span class="op" id="5643584">.</span><span class="ident" id="5643585">Rect</span><span class="op" id="5643589">.</span><span class="ident" id="5643590">Min</span><span class="op" id="5643593">.</span><span class="ident" id="5643594">Y</span><span class="op" id="5643595">;</span>&nbsp;<span class="ident" id="5643597">y</span>&nbsp;<span class="op" id="5643599">&lt;</span>&nbsp;<span class="ident" id="5643601">p</span><span class="op" id="5643602">.</span><span class="ident" id="5643603">Rect</span><span class="op" id="5643607">.</span><span class="ident" id="5643608">Max</span><span class="op" id="5643611">.</span><span class="ident" id="5643612">Y</span><span class="op" id="5643613">;</span>&nbsp;<span class="ident" id="5643615">y</span><span class="op" id="5643616">++</span>&nbsp;<span class="op" id="5643619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5643623">for</span>&nbsp;<span class="ident" id="5643627">i</span>&nbsp;<span class="op" id="5643629">:=</span>&nbsp;<span class="ident" id="5643632">i0</span><span class="op" id="5643634">;</span>&nbsp;<span class="ident" id="5643636">i</span>&nbsp;<span class="op" id="5643638">&lt;</span>&nbsp;<span class="ident" id="5643640">i1</span><span class="op" id="5643642">;</span>&nbsp;<span class="ident" id="5643644">i</span>&nbsp;<span class="op" id="5643646">+=</span>&nbsp;<span class="num" id="5643649">4</span>&nbsp;<span class="op" id="5643651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5643656">if</span>&nbsp;<span class="ident" id="5643659">p</span><span class="op" id="5643660">.</span><span class="ident" id="5643661">Pix</span><span class="op" id="5643664">[</span><span class="ident" id="5643665">i</span><span class="op" id="5643666">]</span>&nbsp;<span class="op" id="5643668">!=</span>&nbsp;<span class="num" id="5643671">0xff</span>&nbsp;<span class="op" id="5643676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5643682">return</span>&nbsp;<span class="builtintype" id="5643689">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5643698">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5643702">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5643706">i0</span>&nbsp;<span class="op" id="5643709">+=</span>&nbsp;<span class="ident" id="5643712">p</span><span class="op" id="5643713">.</span><span class="ident" id="5643714">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5643723">i1</span>&nbsp;<span class="op" id="5643726">+=</span>&nbsp;<span class="ident" id="5643729">p</span><span class="op" id="5643730">.</span><span class="ident" id="5643731">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5643739">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5643742">return</span>&nbsp;<span class="builtintype" id="5643749">true</span><br>
<span class="lineno">360</span><span class="op" id="5643754">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5643757">//&nbsp;NewNRGBA&nbsp;returns&nbsp;a&nbsp;new&nbsp;NRGBA&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="5643812">func</span>&nbsp;<span class="ident" id="5643817">NewNRGBA</span><span class="op" id="5643825">(</span><span class="ident" id="5643826">r</span>&nbsp;<span class="ident" id="5643828">Rectangle</span><span class="op" id="5643837">)</span>&nbsp;<span class="op" id="5643839">*</span><span class="ident" id="5643840">NRGBA</span>&nbsp;<span class="op" id="5643846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5643849">w</span><span class="op" id="5643850">,</span>&nbsp;<span class="ident" id="5643852">h</span>&nbsp;<span class="op" id="5643854">:=</span>&nbsp;<span class="ident" id="5643857">r</span><span class="op" id="5643858">.</span><span class="ident" id="5643859">Dx</span><span class="op" id="5643861">(</span><span class="op" id="5643862">)</span><span class="op" id="5643863">,</span>&nbsp;<span class="ident" id="5643865">r</span><span class="op" id="5643866">.</span><span class="ident" id="5643867">Dy</span><span class="op" id="5643869">(</span><span class="op" id="5643870">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5643873">pix</span>&nbsp;<span class="op" id="5643877">:=</span>&nbsp;<span class="builtinfunc" id="5643880">make</span><span class="op" id="5643884">(</span><span class="op" id="5643885">[</span><span class="op" id="5643886">]</span><span class="builtintype" id="5643887">uint8</span><span class="op" id="5643892">,</span>&nbsp;<span class="num" id="5643894">4</span><span class="op" id="5643895">*</span><span class="ident" id="5643896">w</span><span class="op" id="5643897">*</span><span class="ident" id="5643898">h</span><span class="op" id="5643899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5643902">return</span>&nbsp;<span class="op" id="5643909">&amp;</span><span class="ident" id="5643910">NRGBA</span><span class="op" id="5643915">{</span><span class="ident" id="5643916">pix</span><span class="op" id="5643919">,</span>&nbsp;<span class="num" id="5643921">4</span>&nbsp;<span class="op" id="5643923">*</span>&nbsp;<span class="ident" id="5643925">w</span><span class="op" id="5643926">,</span>&nbsp;<span class="ident" id="5643928">r</span><span class="op" id="5643929">}</span><br>
<span class="lineno"></span><span class="op" id="5643931">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5643934">//&nbsp;NRGBA64&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.NRGBA64&nbsp;values.</span><br>
<span class="lineno">370</span><span class="keyword" id="5644013">type</span>&nbsp;<span class="ident" id="5644018">NRGBA64</span>&nbsp;<span class="keyword" id="5644026">struct</span>&nbsp;<span class="op" id="5644033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5644036">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;in&nbsp;R,&nbsp;G,&nbsp;B,&nbsp;A&nbsp;order&nbsp;and&nbsp;big-endian&nbsp;format.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5644126">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*8].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5644194">Pix</span>&nbsp;<span class="op" id="5644198">[</span><span class="op" id="5644199">]</span><span class="builtintype" id="5644200">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5644207">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5644283">Stride</span>&nbsp;<span class="builtintype" id="5644290">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5644295">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5644327">Rect</span>&nbsp;<span class="ident" id="5644332">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="5644342">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span><span class="keyword" id="5644345">func</span>&nbsp;<span class="op" id="5644350">(</span><span class="ident" id="5644351">p</span>&nbsp;<span class="op" id="5644353">*</span><span class="ident" id="5644354">NRGBA64</span><span class="op" id="5644361">)</span>&nbsp;<span class="ident" id="5644363">ColorModel</span><span class="op" id="5644373">(</span><span class="op" id="5644374">)</span>&nbsp;<span class="ident" id="5644376">color</span><span class="op" id="5644381">.</span><span class="ident" id="5644382">Model</span>&nbsp;<span class="op" id="5644388">{</span>&nbsp;<span class="keyword" id="5644390">return</span>&nbsp;<span class="ident" id="5644397">color</span><span class="op" id="5644402">.</span><span class="ident" id="5644403">NRGBA64Model</span>&nbsp;<span class="op" id="5644416">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5644419">func</span>&nbsp;<span class="op" id="5644424">(</span><span class="ident" id="5644425">p</span>&nbsp;<span class="op" id="5644427">*</span><span class="ident" id="5644428">NRGBA64</span><span class="op" id="5644435">)</span>&nbsp;<span class="ident" id="5644437">Bounds</span><span class="op" id="5644443">(</span><span class="op" id="5644444">)</span>&nbsp;<span class="ident" id="5644446">Rectangle</span>&nbsp;<span class="op" id="5644456">{</span>&nbsp;<span class="keyword" id="5644458">return</span>&nbsp;<span class="ident" id="5644465">p</span><span class="op" id="5644466">.</span><span class="ident" id="5644467">Rect</span>&nbsp;<span class="op" id="5644472">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5644475">func</span>&nbsp;<span class="op" id="5644480">(</span><span class="ident" id="5644481">p</span>&nbsp;<span class="op" id="5644483">*</span><span class="ident" id="5644484">NRGBA64</span><span class="op" id="5644491">)</span>&nbsp;<span class="ident" id="5644493">At</span><span class="op" id="5644495">(</span><span class="ident" id="5644496">x</span><span class="op" id="5644497">,</span>&nbsp;<span class="ident" id="5644499">y</span>&nbsp;<span class="builtintype" id="5644501">int</span><span class="op" id="5644504">)</span>&nbsp;<span class="ident" id="5644506">color</span><span class="op" id="5644511">.</span><span class="ident" id="5644512">Color</span>&nbsp;<span class="op" id="5644518">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5644521">return</span>&nbsp;<span class="ident" id="5644528">p</span><span class="op" id="5644529">.</span><span class="ident" id="5644530">NRGBA64At</span><span class="op" id="5644539">(</span><span class="ident" id="5644540">x</span><span class="op" id="5644541">,</span>&nbsp;<span class="ident" id="5644543">y</span><span class="op" id="5644544">)</span><br>
<span class="lineno"></span><span class="op" id="5644546">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5644549">func</span>&nbsp;<span class="op" id="5644554">(</span><span class="ident" id="5644555">p</span>&nbsp;<span class="op" id="5644557">*</span><span class="ident" id="5644558">NRGBA64</span><span class="op" id="5644565">)</span>&nbsp;<span class="ident" id="5644567">NRGBA64At</span><span class="op" id="5644576">(</span><span class="ident" id="5644577">x</span><span class="op" id="5644578">,</span>&nbsp;<span class="ident" id="5644580">y</span>&nbsp;<span class="builtintype" id="5644582">int</span><span class="op" id="5644585">)</span>&nbsp;<span class="ident" id="5644587">color</span><span class="op" id="5644592">.</span><span class="ident" id="5644593">NRGBA64</span>&nbsp;<span class="op" id="5644601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5644604">if</span>&nbsp;<span class="op" id="5644607">!</span><span class="op" id="5644608">(</span><span class="ident" id="5644609">Point</span><span class="op" id="5644614">{</span><span class="ident" id="5644615">x</span><span class="op" id="5644616">,</span>&nbsp;<span class="ident" id="5644618">y</span><span class="op" id="5644619">}</span><span class="op" id="5644620">.</span><span class="ident" id="5644621">In</span><span class="op" id="5644623">(</span><span class="ident" id="5644624">p</span><span class="op" id="5644625">.</span><span class="ident" id="5644626">Rect</span><span class="op" id="5644630">)</span><span class="op" id="5644631">)</span>&nbsp;<span class="op" id="5644633">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5644637">return</span>&nbsp;<span class="ident" id="5644644">color</span><span class="op" id="5644649">.</span><span class="ident" id="5644650">NRGBA64</span><span class="op" id="5644657">{</span><span class="op" id="5644658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5644661">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5644664">i</span>&nbsp;<span class="op" id="5644666">:=</span>&nbsp;<span class="ident" id="5644669">p</span><span class="op" id="5644670">.</span><span class="ident" id="5644671">PixOffset</span><span class="op" id="5644680">(</span><span class="ident" id="5644681">x</span><span class="op" id="5644682">,</span>&nbsp;<span class="ident" id="5644684">y</span><span class="op" id="5644685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5644688">return</span>&nbsp;<span class="ident" id="5644695">color</span><span class="op" id="5644700">.</span><span class="ident" id="5644701">NRGBA64</span><span class="op" id="5644708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5644712">uint16</span><span class="op" id="5644718">(</span><span class="ident" id="5644719">p</span><span class="op" id="5644720">.</span><span class="ident" id="5644721">Pix</span><span class="op" id="5644724">[</span><span class="ident" id="5644725">i</span><span class="op" id="5644726">+</span><span class="num" id="5644727">0</span><span class="op" id="5644728">]</span><span class="op" id="5644729">)</span><span class="op" id="5644730">&lt;&lt;</span><span class="num" id="5644732">8</span>&nbsp;<span class="op" id="5644734">|</span>&nbsp;<span class="builtintype" id="5644736">uint16</span><span class="op" id="5644742">(</span><span class="ident" id="5644743">p</span><span class="op" id="5644744">.</span><span class="ident" id="5644745">Pix</span><span class="op" id="5644748">[</span><span class="ident" id="5644749">i</span><span class="op" id="5644750">+</span><span class="num" id="5644751">1</span><span class="op" id="5644752">]</span><span class="op" id="5644753">)</span><span class="op" id="5644754">,</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5644758">uint16</span><span class="op" id="5644764">(</span><span class="ident" id="5644765">p</span><span class="op" id="5644766">.</span><span class="ident" id="5644767">Pix</span><span class="op" id="5644770">[</span><span class="ident" id="5644771">i</span><span class="op" id="5644772">+</span><span class="num" id="5644773">2</span><span class="op" id="5644774">]</span><span class="op" id="5644775">)</span><span class="op" id="5644776">&lt;&lt;</span><span class="num" id="5644778">8</span>&nbsp;<span class="op" id="5644780">|</span>&nbsp;<span class="builtintype" id="5644782">uint16</span><span class="op" id="5644788">(</span><span class="ident" id="5644789">p</span><span class="op" id="5644790">.</span><span class="ident" id="5644791">Pix</span><span class="op" id="5644794">[</span><span class="ident" id="5644795">i</span><span class="op" id="5644796">+</span><span class="num" id="5644797">3</span><span class="op" id="5644798">]</span><span class="op" id="5644799">)</span><span class="op" id="5644800">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5644804">uint16</span><span class="op" id="5644810">(</span><span class="ident" id="5644811">p</span><span class="op" id="5644812">.</span><span class="ident" id="5644813">Pix</span><span class="op" id="5644816">[</span><span class="ident" id="5644817">i</span><span class="op" id="5644818">+</span><span class="num" id="5644819">4</span><span class="op" id="5644820">]</span><span class="op" id="5644821">)</span><span class="op" id="5644822">&lt;&lt;</span><span class="num" id="5644824">8</span>&nbsp;<span class="op" id="5644826">|</span>&nbsp;<span class="builtintype" id="5644828">uint16</span><span class="op" id="5644834">(</span><span class="ident" id="5644835">p</span><span class="op" id="5644836">.</span><span class="ident" id="5644837">Pix</span><span class="op" id="5644840">[</span><span class="ident" id="5644841">i</span><span class="op" id="5644842">+</span><span class="num" id="5644843">5</span><span class="op" id="5644844">]</span><span class="op" id="5644845">)</span><span class="op" id="5644846">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5644850">uint16</span><span class="op" id="5644856">(</span><span class="ident" id="5644857">p</span><span class="op" id="5644858">.</span><span class="ident" id="5644859">Pix</span><span class="op" id="5644862">[</span><span class="ident" id="5644863">i</span><span class="op" id="5644864">+</span><span class="num" id="5644865">6</span><span class="op" id="5644866">]</span><span class="op" id="5644867">)</span><span class="op" id="5644868">&lt;&lt;</span><span class="num" id="5644870">8</span>&nbsp;<span class="op" id="5644872">|</span>&nbsp;<span class="builtintype" id="5644874">uint16</span><span class="op" id="5644880">(</span><span class="ident" id="5644881">p</span><span class="op" id="5644882">.</span><span class="ident" id="5644883">Pix</span><span class="op" id="5644886">[</span><span class="ident" id="5644887">i</span><span class="op" id="5644888">+</span><span class="num" id="5644889">7</span><span class="op" id="5644890">]</span><span class="op" id="5644891">)</span><span class="op" id="5644892">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5644895">}</span><br>
<span class="lineno"></span><span class="op" id="5644897">}</span><br>
<span class="lineno">400</span><br>
<span class="lineno"></span><span class="comment" id="5644900">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5644979">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5645003">func</span>&nbsp;<span class="op" id="5645008">(</span><span class="ident" id="5645009">p</span>&nbsp;<span class="op" id="5645011">*</span><span class="ident" id="5645012">NRGBA64</span><span class="op" id="5645019">)</span>&nbsp;<span class="ident" id="5645021">PixOffset</span><span class="op" id="5645030">(</span><span class="ident" id="5645031">x</span><span class="op" id="5645032">,</span>&nbsp;<span class="ident" id="5645034">y</span>&nbsp;<span class="builtintype" id="5645036">int</span><span class="op" id="5645039">)</span>&nbsp;<span class="builtintype" id="5645041">int</span>&nbsp;<span class="op" id="5645045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5645048">return</span>&nbsp;<span class="op" id="5645055">(</span><span class="ident" id="5645056">y</span><span class="op" id="5645057">-</span><span class="ident" id="5645058">p</span><span class="op" id="5645059">.</span><span class="ident" id="5645060">Rect</span><span class="op" id="5645064">.</span><span class="ident" id="5645065">Min</span><span class="op" id="5645068">.</span><span class="ident" id="5645069">Y</span><span class="op" id="5645070">)</span><span class="op" id="5645071">*</span><span class="ident" id="5645072">p</span><span class="op" id="5645073">.</span><span class="ident" id="5645074">Stride</span>&nbsp;<span class="op" id="5645081">+</span>&nbsp;<span class="op" id="5645083">(</span><span class="ident" id="5645084">x</span><span class="op" id="5645085">-</span><span class="ident" id="5645086">p</span><span class="op" id="5645087">.</span><span class="ident" id="5645088">Rect</span><span class="op" id="5645092">.</span><span class="ident" id="5645093">Min</span><span class="op" id="5645096">.</span><span class="ident" id="5645097">X</span><span class="op" id="5645098">)</span><span class="op" id="5645099">*</span><span class="num" id="5645100">8</span><br>
<span class="lineno">405</span><span class="op" id="5645102">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5645105">func</span>&nbsp;<span class="op" id="5645110">(</span><span class="ident" id="5645111">p</span>&nbsp;<span class="op" id="5645113">*</span><span class="ident" id="5645114">NRGBA64</span><span class="op" id="5645121">)</span>&nbsp;<span class="ident" id="5645123">Set</span><span class="op" id="5645126">(</span><span class="ident" id="5645127">x</span><span class="op" id="5645128">,</span>&nbsp;<span class="ident" id="5645130">y</span>&nbsp;<span class="builtintype" id="5645132">int</span><span class="op" id="5645135">,</span>&nbsp;<span class="ident" id="5645137">c</span>&nbsp;<span class="ident" id="5645139">color</span><span class="op" id="5645144">.</span><span class="ident" id="5645145">Color</span><span class="op" id="5645150">)</span>&nbsp;<span class="op" id="5645152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5645155">if</span>&nbsp;<span class="op" id="5645158">!</span><span class="op" id="5645159">(</span><span class="ident" id="5645160">Point</span><span class="op" id="5645165">{</span><span class="ident" id="5645166">x</span><span class="op" id="5645167">,</span>&nbsp;<span class="ident" id="5645169">y</span><span class="op" id="5645170">}</span><span class="op" id="5645171">.</span><span class="ident" id="5645172">In</span><span class="op" id="5645174">(</span><span class="ident" id="5645175">p</span><span class="op" id="5645176">.</span><span class="ident" id="5645177">Rect</span><span class="op" id="5645181">)</span><span class="op" id="5645182">)</span>&nbsp;<span class="op" id="5645184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5645188">return</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5645196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5645199">i</span>&nbsp;<span class="op" id="5645201">:=</span>&nbsp;<span class="ident" id="5645204">p</span><span class="op" id="5645205">.</span><span class="ident" id="5645206">PixOffset</span><span class="op" id="5645215">(</span><span class="ident" id="5645216">x</span><span class="op" id="5645217">,</span>&nbsp;<span class="ident" id="5645219">y</span><span class="op" id="5645220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5645223">c1</span>&nbsp;<span class="op" id="5645226">:=</span>&nbsp;<span class="ident" id="5645229">color</span><span class="op" id="5645234">.</span><span class="ident" id="5645235">NRGBA64Model</span><span class="op" id="5645247">.</span><span class="ident" id="5645248">Convert</span><span class="op" id="5645255">(</span><span class="ident" id="5645256">c</span><span class="op" id="5645257">)</span><span class="op" id="5645258">.</span><span class="op" id="5645259">(</span><span class="ident" id="5645260">color</span><span class="op" id="5645265">.</span><span class="ident" id="5645266">NRGBA64</span><span class="op" id="5645273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5645276">p</span><span class="op" id="5645277">.</span><span class="ident" id="5645278">Pix</span><span class="op" id="5645281">[</span><span class="ident" id="5645282">i</span><span class="op" id="5645283">+</span><span class="num" id="5645284">0</span><span class="op" id="5645285">]</span>&nbsp;<span class="op" id="5645287">=</span>&nbsp;<span class="builtintype" id="5645289">uint8</span><span class="op" id="5645294">(</span><span class="ident" id="5645295">c1</span><span class="op" id="5645297">.</span><span class="ident" id="5645298">R</span>&nbsp;<span class="op" id="5645300">&gt;&gt;</span>&nbsp;<span class="num" id="5645303">8</span><span class="op" id="5645304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5645307">p</span><span class="op" id="5645308">.</span><span class="ident" id="5645309">Pix</span><span class="op" id="5645312">[</span><span class="ident" id="5645313">i</span><span class="op" id="5645314">+</span><span class="num" id="5645315">1</span><span class="op" id="5645316">]</span>&nbsp;<span class="op" id="5645318">=</span>&nbsp;<span class="builtintype" id="5645320">uint8</span><span class="op" id="5645325">(</span><span class="ident" id="5645326">c1</span><span class="op" id="5645328">.</span><span class="ident" id="5645329">R</span><span class="op" id="5645330">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5645333">p</span><span class="op" id="5645334">.</span><span class="ident" id="5645335">Pix</span><span class="op" id="5645338">[</span><span class="ident" id="5645339">i</span><span class="op" id="5645340">+</span><span class="num" id="5645341">2</span><span class="op" id="5645342">]</span>&nbsp;<span class="op" id="5645344">=</span>&nbsp;<span class="builtintype" id="5645346">uint8</span><span class="op" id="5645351">(</span><span class="ident" id="5645352">c1</span><span class="op" id="5645354">.</span><span class="ident" id="5645355">G</span>&nbsp;<span class="op" id="5645357">&gt;&gt;</span>&nbsp;<span class="num" id="5645360">8</span><span class="op" id="5645361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5645364">p</span><span class="op" id="5645365">.</span><span class="ident" id="5645366">Pix</span><span class="op" id="5645369">[</span><span class="ident" id="5645370">i</span><span class="op" id="5645371">+</span><span class="num" id="5645372">3</span><span class="op" id="5645373">]</span>&nbsp;<span class="op" id="5645375">=</span>&nbsp;<span class="builtintype" id="5645377">uint8</span><span class="op" id="5645382">(</span><span class="ident" id="5645383">c1</span><span class="op" id="5645385">.</span><span class="ident" id="5645386">G</span><span class="op" id="5645387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5645390">p</span><span class="op" id="5645391">.</span><span class="ident" id="5645392">Pix</span><span class="op" id="5645395">[</span><span class="ident" id="5645396">i</span><span class="op" id="5645397">+</span><span class="num" id="5645398">4</span><span class="op" id="5645399">]</span>&nbsp;<span class="op" id="5645401">=</span>&nbsp;<span class="builtintype" id="5645403">uint8</span><span class="op" id="5645408">(</span><span class="ident" id="5645409">c1</span><span class="op" id="5645411">.</span><span class="ident" id="5645412">B</span>&nbsp;<span class="op" id="5645414">&gt;&gt;</span>&nbsp;<span class="num" id="5645417">8</span><span class="op" id="5645418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5645421">p</span><span class="op" id="5645422">.</span><span class="ident" id="5645423">Pix</span><span class="op" id="5645426">[</span><span class="ident" id="5645427">i</span><span class="op" id="5645428">+</span><span class="num" id="5645429">5</span><span class="op" id="5645430">]</span>&nbsp;<span class="op" id="5645432">=</span>&nbsp;<span class="builtintype" id="5645434">uint8</span><span class="op" id="5645439">(</span><span class="ident" id="5645440">c1</span><span class="op" id="5645442">.</span><span class="ident" id="5645443">B</span><span class="op" id="5645444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5645447">p</span><span class="op" id="5645448">.</span><span class="ident" id="5645449">Pix</span><span class="op" id="5645452">[</span><span class="ident" id="5645453">i</span><span class="op" id="5645454">+</span><span class="num" id="5645455">6</span><span class="op" id="5645456">]</span>&nbsp;<span class="op" id="5645458">=</span>&nbsp;<span class="builtintype" id="5645460">uint8</span><span class="op" id="5645465">(</span><span class="ident" id="5645466">c1</span><span class="op" id="5645468">.</span><span class="ident" id="5645469">A</span>&nbsp;<span class="op" id="5645471">&gt;&gt;</span>&nbsp;<span class="num" id="5645474">8</span><span class="op" id="5645475">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5645478">p</span><span class="op" id="5645479">.</span><span class="ident" id="5645480">Pix</span><span class="op" id="5645483">[</span><span class="ident" id="5645484">i</span><span class="op" id="5645485">+</span><span class="num" id="5645486">7</span><span class="op" id="5645487">]</span>&nbsp;<span class="op" id="5645489">=</span>&nbsp;<span class="builtintype" id="5645491">uint8</span><span class="op" id="5645496">(</span><span class="ident" id="5645497">c1</span><span class="op" id="5645499">.</span><span class="ident" id="5645500">A</span><span class="op" id="5645501">)</span><br>
<span class="lineno"></span><span class="op" id="5645503">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5645506">func</span>&nbsp;<span class="op" id="5645511">(</span><span class="ident" id="5645512">p</span>&nbsp;<span class="op" id="5645514">*</span><span class="ident" id="5645515">NRGBA64</span><span class="op" id="5645522">)</span>&nbsp;<span class="ident" id="5645524">SetNRGBA64</span><span class="op" id="5645534">(</span><span class="ident" id="5645535">x</span><span class="op" id="5645536">,</span>&nbsp;<span class="ident" id="5645538">y</span>&nbsp;<span class="builtintype" id="5645540">int</span><span class="op" id="5645543">,</span>&nbsp;<span class="ident" id="5645545">c</span>&nbsp;<span class="ident" id="5645547">color</span><span class="op" id="5645552">.</span><span class="ident" id="5645553">NRGBA64</span><span class="op" id="5645560">)</span>&nbsp;<span class="op" id="5645562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5645565">if</span>&nbsp;<span class="op" id="5645568">!</span><span class="op" id="5645569">(</span><span class="ident" id="5645570">Point</span><span class="op" id="5645575">{</span><span class="ident" id="5645576">x</span><span class="op" id="5645577">,</span>&nbsp;<span class="ident" id="5645579">y</span><span class="op" id="5645580">}</span><span class="op" id="5645581">.</span><span class="ident" id="5645582">In</span><span class="op" id="5645584">(</span><span class="ident" id="5645585">p</span><span class="op" id="5645586">.</span><span class="ident" id="5645587">Rect</span><span class="op" id="5645591">)</span><span class="op" id="5645592">)</span>&nbsp;<span class="op" id="5645594">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5645598">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5645606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5645609">i</span>&nbsp;<span class="op" id="5645611">:=</span>&nbsp;<span class="ident" id="5645614">p</span><span class="op" id="5645615">.</span><span class="ident" id="5645616">PixOffset</span><span class="op" id="5645625">(</span><span class="ident" id="5645626">x</span><span class="op" id="5645627">,</span>&nbsp;<span class="ident" id="5645629">y</span><span class="op" id="5645630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5645633">p</span><span class="op" id="5645634">.</span><span class="ident" id="5645635">Pix</span><span class="op" id="5645638">[</span><span class="ident" id="5645639">i</span><span class="op" id="5645640">+</span><span class="num" id="5645641">0</span><span class="op" id="5645642">]</span>&nbsp;<span class="op" id="5645644">=</span>&nbsp;<span class="builtintype" id="5645646">uint8</span><span class="op" id="5645651">(</span><span class="ident" id="5645652">c</span><span class="op" id="5645653">.</span><span class="ident" id="5645654">R</span>&nbsp;<span class="op" id="5645656">&gt;&gt;</span>&nbsp;<span class="num" id="5645659">8</span><span class="op" id="5645660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5645663">p</span><span class="op" id="5645664">.</span><span class="ident" id="5645665">Pix</span><span class="op" id="5645668">[</span><span class="ident" id="5645669">i</span><span class="op" id="5645670">+</span><span class="num" id="5645671">1</span><span class="op" id="5645672">]</span>&nbsp;<span class="op" id="5645674">=</span>&nbsp;<span class="builtintype" id="5645676">uint8</span><span class="op" id="5645681">(</span><span class="ident" id="5645682">c</span><span class="op" id="5645683">.</span><span class="ident" id="5645684">R</span><span class="op" id="5645685">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5645688">p</span><span class="op" id="5645689">.</span><span class="ident" id="5645690">Pix</span><span class="op" id="5645693">[</span><span class="ident" id="5645694">i</span><span class="op" id="5645695">+</span><span class="num" id="5645696">2</span><span class="op" id="5645697">]</span>&nbsp;<span class="op" id="5645699">=</span>&nbsp;<span class="builtintype" id="5645701">uint8</span><span class="op" id="5645706">(</span><span class="ident" id="5645707">c</span><span class="op" id="5645708">.</span><span class="ident" id="5645709">G</span>&nbsp;<span class="op" id="5645711">&gt;&gt;</span>&nbsp;<span class="num" id="5645714">8</span><span class="op" id="5645715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5645718">p</span><span class="op" id="5645719">.</span><span class="ident" id="5645720">Pix</span><span class="op" id="5645723">[</span><span class="ident" id="5645724">i</span><span class="op" id="5645725">+</span><span class="num" id="5645726">3</span><span class="op" id="5645727">]</span>&nbsp;<span class="op" id="5645729">=</span>&nbsp;<span class="builtintype" id="5645731">uint8</span><span class="op" id="5645736">(</span><span class="ident" id="5645737">c</span><span class="op" id="5645738">.</span><span class="ident" id="5645739">G</span><span class="op" id="5645740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5645743">p</span><span class="op" id="5645744">.</span><span class="ident" id="5645745">Pix</span><span class="op" id="5645748">[</span><span class="ident" id="5645749">i</span><span class="op" id="5645750">+</span><span class="num" id="5645751">4</span><span class="op" id="5645752">]</span>&nbsp;<span class="op" id="5645754">=</span>&nbsp;<span class="builtintype" id="5645756">uint8</span><span class="op" id="5645761">(</span><span class="ident" id="5645762">c</span><span class="op" id="5645763">.</span><span class="ident" id="5645764">B</span>&nbsp;<span class="op" id="5645766">&gt;&gt;</span>&nbsp;<span class="num" id="5645769">8</span><span class="op" id="5645770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5645773">p</span><span class="op" id="5645774">.</span><span class="ident" id="5645775">Pix</span><span class="op" id="5645778">[</span><span class="ident" id="5645779">i</span><span class="op" id="5645780">+</span><span class="num" id="5645781">5</span><span class="op" id="5645782">]</span>&nbsp;<span class="op" id="5645784">=</span>&nbsp;<span class="builtintype" id="5645786">uint8</span><span class="op" id="5645791">(</span><span class="ident" id="5645792">c</span><span class="op" id="5645793">.</span><span class="ident" id="5645794">B</span><span class="op" id="5645795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5645798">p</span><span class="op" id="5645799">.</span><span class="ident" id="5645800">Pix</span><span class="op" id="5645803">[</span><span class="ident" id="5645804">i</span><span class="op" id="5645805">+</span><span class="num" id="5645806">6</span><span class="op" id="5645807">]</span>&nbsp;<span class="op" id="5645809">=</span>&nbsp;<span class="builtintype" id="5645811">uint8</span><span class="op" id="5645816">(</span><span class="ident" id="5645817">c</span><span class="op" id="5645818">.</span><span class="ident" id="5645819">A</span>&nbsp;<span class="op" id="5645821">&gt;&gt;</span>&nbsp;<span class="num" id="5645824">8</span><span class="op" id="5645825">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5645828">p</span><span class="op" id="5645829">.</span><span class="ident" id="5645830">Pix</span><span class="op" id="5645833">[</span><span class="ident" id="5645834">i</span><span class="op" id="5645835">+</span><span class="num" id="5645836">7</span><span class="op" id="5645837">]</span>&nbsp;<span class="op" id="5645839">=</span>&nbsp;<span class="builtintype" id="5645841">uint8</span><span class="op" id="5645846">(</span><span class="ident" id="5645847">c</span><span class="op" id="5645848">.</span><span class="ident" id="5645849">A</span><span class="op" id="5645850">)</span><br>
<span class="lineno"></span><span class="op" id="5645852">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5645855">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5645932">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno">440</span><span class="keyword" id="5646004">func</span>&nbsp;<span class="op" id="5646009">(</span><span class="ident" id="5646010">p</span>&nbsp;<span class="op" id="5646012">*</span><span class="ident" id="5646013">NRGBA64</span><span class="op" id="5646020">)</span>&nbsp;<span class="ident" id="5646022">SubImage</span><span class="op" id="5646030">(</span><span class="ident" id="5646031">r</span>&nbsp;<span class="ident" id="5646033">Rectangle</span><span class="op" id="5646042">)</span>&nbsp;<span class="ident" id="5646044">Image</span>&nbsp;<span class="op" id="5646050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5646053">r</span>&nbsp;<span class="op" id="5646055">=</span>&nbsp;<span class="ident" id="5646057">r</span><span class="op" id="5646058">.</span><span class="ident" id="5646059">Intersect</span><span class="op" id="5646068">(</span><span class="ident" id="5646069">p</span><span class="op" id="5646070">.</span><span class="ident" id="5646071">Rect</span><span class="op" id="5646075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5646078">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5646159">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5646241">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5646291">if</span>&nbsp;<span class="ident" id="5646294">r</span><span class="op" id="5646295">.</span><span class="ident" id="5646296">Empty</span><span class="op" id="5646301">(</span><span class="op" id="5646302">)</span>&nbsp;<span class="op" id="5646304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5646308">return</span>&nbsp;<span class="op" id="5646315">&amp;</span><span class="ident" id="5646316">NRGBA64</span><span class="op" id="5646323">{</span><span class="op" id="5646324">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5646327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5646330">i</span>&nbsp;<span class="op" id="5646332">:=</span>&nbsp;<span class="ident" id="5646335">p</span><span class="op" id="5646336">.</span><span class="ident" id="5646337">PixOffset</span><span class="op" id="5646346">(</span><span class="ident" id="5646347">r</span><span class="op" id="5646348">.</span><span class="ident" id="5646349">Min</span><span class="op" id="5646352">.</span><span class="ident" id="5646353">X</span><span class="op" id="5646354">,</span>&nbsp;<span class="ident" id="5646356">r</span><span class="op" id="5646357">.</span><span class="ident" id="5646358">Min</span><span class="op" id="5646361">.</span><span class="ident" id="5646362">Y</span><span class="op" id="5646363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5646366">return</span>&nbsp;<span class="op" id="5646373">&amp;</span><span class="ident" id="5646374">NRGBA64</span><span class="op" id="5646381">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5646385">Pix</span><span class="op" id="5646388">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5646393">p</span><span class="op" id="5646394">.</span><span class="ident" id="5646395">Pix</span><span class="op" id="5646398">[</span><span class="ident" id="5646399">i</span><span class="op" id="5646400">:</span><span class="op" id="5646401">]</span><span class="op" id="5646402">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5646406">Stride</span><span class="op" id="5646412">:</span>&nbsp;<span class="ident" id="5646414">p</span><span class="op" id="5646415">.</span><span class="ident" id="5646416">Stride</span><span class="op" id="5646422">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5646426">Rect</span><span class="op" id="5646430">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5646434">r</span><span class="op" id="5646435">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5646438">}</span><br>
<span class="lineno"></span><span class="op" id="5646440">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="comment" id="5646443">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5646516">func</span>&nbsp;<span class="op" id="5646521">(</span><span class="ident" id="5646522">p</span>&nbsp;<span class="op" id="5646524">*</span><span class="ident" id="5646525">NRGBA64</span><span class="op" id="5646532">)</span>&nbsp;<span class="ident" id="5646534">Opaque</span><span class="op" id="5646540">(</span><span class="op" id="5646541">)</span>&nbsp;<span class="builtintype" id="5646543">bool</span>&nbsp;<span class="op" id="5646548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5646551">if</span>&nbsp;<span class="ident" id="5646554">p</span><span class="op" id="5646555">.</span><span class="ident" id="5646556">Rect</span><span class="op" id="5646560">.</span><span class="ident" id="5646561">Empty</span><span class="op" id="5646566">(</span><span class="op" id="5646567">)</span>&nbsp;<span class="op" id="5646569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5646573">return</span>&nbsp;<span class="builtintype" id="5646580">true</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5646586">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5646589">i0</span><span class="op" id="5646591">,</span>&nbsp;<span class="ident" id="5646593">i1</span>&nbsp;<span class="op" id="5646596">:=</span>&nbsp;<span class="num" id="5646599">6</span><span class="op" id="5646600">,</span>&nbsp;<span class="ident" id="5646602">p</span><span class="op" id="5646603">.</span><span class="ident" id="5646604">Rect</span><span class="op" id="5646608">.</span><span class="ident" id="5646609">Dx</span><span class="op" id="5646611">(</span><span class="op" id="5646612">)</span><span class="op" id="5646613">*</span><span class="num" id="5646614">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5646617">for</span>&nbsp;<span class="ident" id="5646621">y</span>&nbsp;<span class="op" id="5646623">:=</span>&nbsp;<span class="ident" id="5646626">p</span><span class="op" id="5646627">.</span><span class="ident" id="5646628">Rect</span><span class="op" id="5646632">.</span><span class="ident" id="5646633">Min</span><span class="op" id="5646636">.</span><span class="ident" id="5646637">Y</span><span class="op" id="5646638">;</span>&nbsp;<span class="ident" id="5646640">y</span>&nbsp;<span class="op" id="5646642">&lt;</span>&nbsp;<span class="ident" id="5646644">p</span><span class="op" id="5646645">.</span><span class="ident" id="5646646">Rect</span><span class="op" id="5646650">.</span><span class="ident" id="5646651">Max</span><span class="op" id="5646654">.</span><span class="ident" id="5646655">Y</span><span class="op" id="5646656">;</span>&nbsp;<span class="ident" id="5646658">y</span><span class="op" id="5646659">++</span>&nbsp;<span class="op" id="5646662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5646666">for</span>&nbsp;<span class="ident" id="5646670">i</span>&nbsp;<span class="op" id="5646672">:=</span>&nbsp;<span class="ident" id="5646675">i0</span><span class="op" id="5646677">;</span>&nbsp;<span class="ident" id="5646679">i</span>&nbsp;<span class="op" id="5646681">&lt;</span>&nbsp;<span class="ident" id="5646683">i1</span><span class="op" id="5646685">;</span>&nbsp;<span class="ident" id="5646687">i</span>&nbsp;<span class="op" id="5646689">+=</span>&nbsp;<span class="num" id="5646692">8</span>&nbsp;<span class="op" id="5646694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5646699">if</span>&nbsp;<span class="ident" id="5646702">p</span><span class="op" id="5646703">.</span><span class="ident" id="5646704">Pix</span><span class="op" id="5646707">[</span><span class="ident" id="5646708">i</span><span class="op" id="5646709">+</span><span class="num" id="5646710">0</span><span class="op" id="5646711">]</span>&nbsp;<span class="op" id="5646713">!=</span>&nbsp;<span class="num" id="5646716">0xff</span>&nbsp;<span class="op" id="5646721">||</span>&nbsp;<span class="ident" id="5646724">p</span><span class="op" id="5646725">.</span><span class="ident" id="5646726">Pix</span><span class="op" id="5646729">[</span><span class="ident" id="5646730">i</span><span class="op" id="5646731">+</span><span class="num" id="5646732">1</span><span class="op" id="5646733">]</span>&nbsp;<span class="op" id="5646735">!=</span>&nbsp;<span class="num" id="5646738">0xff</span>&nbsp;<span class="op" id="5646743">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5646749">return</span>&nbsp;<span class="builtintype" id="5646756">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5646765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5646769">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5646773">i0</span>&nbsp;<span class="op" id="5646776">+=</span>&nbsp;<span class="ident" id="5646779">p</span><span class="op" id="5646780">.</span><span class="ident" id="5646781">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5646790">i1</span>&nbsp;<span class="op" id="5646793">+=</span>&nbsp;<span class="ident" id="5646796">p</span><span class="op" id="5646797">.</span><span class="ident" id="5646798">Stride</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5646806">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5646809">return</span>&nbsp;<span class="builtintype" id="5646816">true</span><br>
<span class="lineno"></span><span class="op" id="5646821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5646824">//&nbsp;NewNRGBA64&nbsp;returns&nbsp;a&nbsp;new&nbsp;NRGBA64&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno">475</span><span class="keyword" id="5646883">func</span>&nbsp;<span class="ident" id="5646888">NewNRGBA64</span><span class="op" id="5646898">(</span><span class="ident" id="5646899">r</span>&nbsp;<span class="ident" id="5646901">Rectangle</span><span class="op" id="5646910">)</span>&nbsp;<span class="op" id="5646912">*</span><span class="ident" id="5646913">NRGBA64</span>&nbsp;<span class="op" id="5646921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5646924">w</span><span class="op" id="5646925">,</span>&nbsp;<span class="ident" id="5646927">h</span>&nbsp;<span class="op" id="5646929">:=</span>&nbsp;<span class="ident" id="5646932">r</span><span class="op" id="5646933">.</span><span class="ident" id="5646934">Dx</span><span class="op" id="5646936">(</span><span class="op" id="5646937">)</span><span class="op" id="5646938">,</span>&nbsp;<span class="ident" id="5646940">r</span><span class="op" id="5646941">.</span><span class="ident" id="5646942">Dy</span><span class="op" id="5646944">(</span><span class="op" id="5646945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5646948">pix</span>&nbsp;<span class="op" id="5646952">:=</span>&nbsp;<span class="builtinfunc" id="5646955">make</span><span class="op" id="5646959">(</span><span class="op" id="5646960">[</span><span class="op" id="5646961">]</span><span class="builtintype" id="5646962">uint8</span><span class="op" id="5646967">,</span>&nbsp;<span class="num" id="5646969">8</span><span class="op" id="5646970">*</span><span class="ident" id="5646971">w</span><span class="op" id="5646972">*</span><span class="ident" id="5646973">h</span><span class="op" id="5646974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5646977">return</span>&nbsp;<span class="op" id="5646984">&amp;</span><span class="ident" id="5646985">NRGBA64</span><span class="op" id="5646992">{</span><span class="ident" id="5646993">pix</span><span class="op" id="5646996">,</span>&nbsp;<span class="num" id="5646998">8</span>&nbsp;<span class="op" id="5647000">*</span>&nbsp;<span class="ident" id="5647002">w</span><span class="op" id="5647003">,</span>&nbsp;<span class="ident" id="5647005">r</span><span class="op" id="5647006">}</span><br>
<span class="lineno"></span><span class="op" id="5647008">}</span><br>
<span class="lineno">480</span><br>
<span class="lineno"></span><span class="comment" id="5647011">//&nbsp;Alpha&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.Alpha&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5647086">type</span>&nbsp;<span class="ident" id="5647091">Alpha</span>&nbsp;<span class="keyword" id="5647097">struct</span>&nbsp;<span class="op" id="5647104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5647107">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;alpha&nbsp;values.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5647171">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*1].</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5647239">Pix</span>&nbsp;<span class="op" id="5647243">[</span><span class="op" id="5647244">]</span><span class="builtintype" id="5647245">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5647252">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5647328">Stride</span>&nbsp;<span class="builtintype" id="5647335">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5647340">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5647372">Rect</span>&nbsp;<span class="ident" id="5647377">Rectangle</span><br>
<span class="lineno">490</span><span class="op" id="5647387">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5647390">func</span>&nbsp;<span class="op" id="5647395">(</span><span class="ident" id="5647396">p</span>&nbsp;<span class="op" id="5647398">*</span><span class="ident" id="5647399">Alpha</span><span class="op" id="5647404">)</span>&nbsp;<span class="ident" id="5647406">ColorModel</span><span class="op" id="5647416">(</span><span class="op" id="5647417">)</span>&nbsp;<span class="ident" id="5647419">color</span><span class="op" id="5647424">.</span><span class="ident" id="5647425">Model</span>&nbsp;<span class="op" id="5647431">{</span>&nbsp;<span class="keyword" id="5647433">return</span>&nbsp;<span class="ident" id="5647440">color</span><span class="op" id="5647445">.</span><span class="ident" id="5647446">AlphaModel</span>&nbsp;<span class="op" id="5647457">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5647460">func</span>&nbsp;<span class="op" id="5647465">(</span><span class="ident" id="5647466">p</span>&nbsp;<span class="op" id="5647468">*</span><span class="ident" id="5647469">Alpha</span><span class="op" id="5647474">)</span>&nbsp;<span class="ident" id="5647476">Bounds</span><span class="op" id="5647482">(</span><span class="op" id="5647483">)</span>&nbsp;<span class="ident" id="5647485">Rectangle</span>&nbsp;<span class="op" id="5647495">{</span>&nbsp;<span class="keyword" id="5647497">return</span>&nbsp;<span class="ident" id="5647504">p</span><span class="op" id="5647505">.</span><span class="ident" id="5647506">Rect</span>&nbsp;<span class="op" id="5647511">}</span><br>
<span class="lineno">495</span><br>
<span class="lineno"></span><span class="keyword" id="5647514">func</span>&nbsp;<span class="op" id="5647519">(</span><span class="ident" id="5647520">p</span>&nbsp;<span class="op" id="5647522">*</span><span class="ident" id="5647523">Alpha</span><span class="op" id="5647528">)</span>&nbsp;<span class="ident" id="5647530">At</span><span class="op" id="5647532">(</span><span class="ident" id="5647533">x</span><span class="op" id="5647534">,</span>&nbsp;<span class="ident" id="5647536">y</span>&nbsp;<span class="builtintype" id="5647538">int</span><span class="op" id="5647541">)</span>&nbsp;<span class="ident" id="5647543">color</span><span class="op" id="5647548">.</span><span class="ident" id="5647549">Color</span>&nbsp;<span class="op" id="5647555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5647558">return</span>&nbsp;<span class="ident" id="5647565">p</span><span class="op" id="5647566">.</span><span class="ident" id="5647567">AlphaAt</span><span class="op" id="5647574">(</span><span class="ident" id="5647575">x</span><span class="op" id="5647576">,</span>&nbsp;<span class="ident" id="5647578">y</span><span class="op" id="5647579">)</span><br>
<span class="lineno"></span><span class="op" id="5647581">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">500</span><span class="keyword" id="5647584">func</span>&nbsp;<span class="op" id="5647589">(</span><span class="ident" id="5647590">p</span>&nbsp;<span class="op" id="5647592">*</span><span class="ident" id="5647593">Alpha</span><span class="op" id="5647598">)</span>&nbsp;<span class="ident" id="5647600">AlphaAt</span><span class="op" id="5647607">(</span><span class="ident" id="5647608">x</span><span class="op" id="5647609">,</span>&nbsp;<span class="ident" id="5647611">y</span>&nbsp;<span class="builtintype" id="5647613">int</span><span class="op" id="5647616">)</span>&nbsp;<span class="ident" id="5647618">color</span><span class="op" id="5647623">.</span><span class="ident" id="5647624">Alpha</span>&nbsp;<span class="op" id="5647630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5647633">if</span>&nbsp;<span class="op" id="5647636">!</span><span class="op" id="5647637">(</span><span class="ident" id="5647638">Point</span><span class="op" id="5647643">{</span><span class="ident" id="5647644">x</span><span class="op" id="5647645">,</span>&nbsp;<span class="ident" id="5647647">y</span><span class="op" id="5647648">}</span><span class="op" id="5647649">.</span><span class="ident" id="5647650">In</span><span class="op" id="5647652">(</span><span class="ident" id="5647653">p</span><span class="op" id="5647654">.</span><span class="ident" id="5647655">Rect</span><span class="op" id="5647659">)</span><span class="op" id="5647660">)</span>&nbsp;<span class="op" id="5647662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5647666">return</span>&nbsp;<span class="ident" id="5647673">color</span><span class="op" id="5647678">.</span><span class="ident" id="5647679">Alpha</span><span class="op" id="5647684">{</span><span class="op" id="5647685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5647688">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5647691">i</span>&nbsp;<span class="op" id="5647693">:=</span>&nbsp;<span class="ident" id="5647696">p</span><span class="op" id="5647697">.</span><span class="ident" id="5647698">PixOffset</span><span class="op" id="5647707">(</span><span class="ident" id="5647708">x</span><span class="op" id="5647709">,</span>&nbsp;<span class="ident" id="5647711">y</span><span class="op" id="5647712">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5647715">return</span>&nbsp;<span class="ident" id="5647722">color</span><span class="op" id="5647727">.</span><span class="ident" id="5647728">Alpha</span><span class="op" id="5647733">{</span><span class="ident" id="5647734">p</span><span class="op" id="5647735">.</span><span class="ident" id="5647736">Pix</span><span class="op" id="5647739">[</span><span class="ident" id="5647740">i</span><span class="op" id="5647741">]</span><span class="op" id="5647742">}</span><br>
<span class="lineno"></span><span class="op" id="5647744">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5647747">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5647826">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno">510</span><span class="keyword" id="5647850">func</span>&nbsp;<span class="op" id="5647855">(</span><span class="ident" id="5647856">p</span>&nbsp;<span class="op" id="5647858">*</span><span class="ident" id="5647859">Alpha</span><span class="op" id="5647864">)</span>&nbsp;<span class="ident" id="5647866">PixOffset</span><span class="op" id="5647875">(</span><span class="ident" id="5647876">x</span><span class="op" id="5647877">,</span>&nbsp;<span class="ident" id="5647879">y</span>&nbsp;<span class="builtintype" id="5647881">int</span><span class="op" id="5647884">)</span>&nbsp;<span class="builtintype" id="5647886">int</span>&nbsp;<span class="op" id="5647890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5647893">return</span>&nbsp;<span class="op" id="5647900">(</span><span class="ident" id="5647901">y</span><span class="op" id="5647902">-</span><span class="ident" id="5647903">p</span><span class="op" id="5647904">.</span><span class="ident" id="5647905">Rect</span><span class="op" id="5647909">.</span><span class="ident" id="5647910">Min</span><span class="op" id="5647913">.</span><span class="ident" id="5647914">Y</span><span class="op" id="5647915">)</span><span class="op" id="5647916">*</span><span class="ident" id="5647917">p</span><span class="op" id="5647918">.</span><span class="ident" id="5647919">Stride</span>&nbsp;<span class="op" id="5647926">+</span>&nbsp;<span class="op" id="5647928">(</span><span class="ident" id="5647929">x</span><span class="op" id="5647930">-</span><span class="ident" id="5647931">p</span><span class="op" id="5647932">.</span><span class="ident" id="5647933">Rect</span><span class="op" id="5647937">.</span><span class="ident" id="5647938">Min</span><span class="op" id="5647941">.</span><span class="ident" id="5647942">X</span><span class="op" id="5647943">)</span><span class="op" id="5647944">*</span><span class="num" id="5647945">1</span><br>
<span class="lineno"></span><span class="op" id="5647947">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5647950">func</span>&nbsp;<span class="op" id="5647955">(</span><span class="ident" id="5647956">p</span>&nbsp;<span class="op" id="5647958">*</span><span class="ident" id="5647959">Alpha</span><span class="op" id="5647964">)</span>&nbsp;<span class="ident" id="5647966">Set</span><span class="op" id="5647969">(</span><span class="ident" id="5647970">x</span><span class="op" id="5647971">,</span>&nbsp;<span class="ident" id="5647973">y</span>&nbsp;<span class="builtintype" id="5647975">int</span><span class="op" id="5647978">,</span>&nbsp;<span class="ident" id="5647980">c</span>&nbsp;<span class="ident" id="5647982">color</span><span class="op" id="5647987">.</span><span class="ident" id="5647988">Color</span><span class="op" id="5647993">)</span>&nbsp;<span class="op" id="5647995">{</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5647998">if</span>&nbsp;<span class="op" id="5648001">!</span><span class="op" id="5648002">(</span><span class="ident" id="5648003">Point</span><span class="op" id="5648008">{</span><span class="ident" id="5648009">x</span><span class="op" id="5648010">,</span>&nbsp;<span class="ident" id="5648012">y</span><span class="op" id="5648013">}</span><span class="op" id="5648014">.</span><span class="ident" id="5648015">In</span><span class="op" id="5648017">(</span><span class="ident" id="5648018">p</span><span class="op" id="5648019">.</span><span class="ident" id="5648020">Rect</span><span class="op" id="5648024">)</span><span class="op" id="5648025">)</span>&nbsp;<span class="op" id="5648027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5648031">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5648039">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5648042">i</span>&nbsp;<span class="op" id="5648044">:=</span>&nbsp;<span class="ident" id="5648047">p</span><span class="op" id="5648048">.</span><span class="ident" id="5648049">PixOffset</span><span class="op" id="5648058">(</span><span class="ident" id="5648059">x</span><span class="op" id="5648060">,</span>&nbsp;<span class="ident" id="5648062">y</span><span class="op" id="5648063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5648066">p</span><span class="op" id="5648067">.</span><span class="ident" id="5648068">Pix</span><span class="op" id="5648071">[</span><span class="ident" id="5648072">i</span><span class="op" id="5648073">]</span>&nbsp;<span class="op" id="5648075">=</span>&nbsp;<span class="ident" id="5648077">color</span><span class="op" id="5648082">.</span><span class="ident" id="5648083">AlphaModel</span><span class="op" id="5648093">.</span><span class="ident" id="5648094">Convert</span><span class="op" id="5648101">(</span><span class="ident" id="5648102">c</span><span class="op" id="5648103">)</span><span class="op" id="5648104">.</span><span class="op" id="5648105">(</span><span class="ident" id="5648106">color</span><span class="op" id="5648111">.</span><span class="ident" id="5648112">Alpha</span><span class="op" id="5648117">)</span><span class="op" id="5648118">.</span><span class="ident" id="5648119">A</span><br>
<span class="lineno">520</span><span class="op" id="5648121">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5648124">func</span>&nbsp;<span class="op" id="5648129">(</span><span class="ident" id="5648130">p</span>&nbsp;<span class="op" id="5648132">*</span><span class="ident" id="5648133">Alpha</span><span class="op" id="5648138">)</span>&nbsp;<span class="ident" id="5648140">SetAlpha</span><span class="op" id="5648148">(</span><span class="ident" id="5648149">x</span><span class="op" id="5648150">,</span>&nbsp;<span class="ident" id="5648152">y</span>&nbsp;<span class="builtintype" id="5648154">int</span><span class="op" id="5648157">,</span>&nbsp;<span class="ident" id="5648159">c</span>&nbsp;<span class="ident" id="5648161">color</span><span class="op" id="5648166">.</span><span class="ident" id="5648167">Alpha</span><span class="op" id="5648172">)</span>&nbsp;<span class="op" id="5648174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5648177">if</span>&nbsp;<span class="op" id="5648180">!</span><span class="op" id="5648181">(</span><span class="ident" id="5648182">Point</span><span class="op" id="5648187">{</span><span class="ident" id="5648188">x</span><span class="op" id="5648189">,</span>&nbsp;<span class="ident" id="5648191">y</span><span class="op" id="5648192">}</span><span class="op" id="5648193">.</span><span class="ident" id="5648194">In</span><span class="op" id="5648196">(</span><span class="ident" id="5648197">p</span><span class="op" id="5648198">.</span><span class="ident" id="5648199">Rect</span><span class="op" id="5648203">)</span><span class="op" id="5648204">)</span>&nbsp;<span class="op" id="5648206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5648210">return</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5648218">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5648221">i</span>&nbsp;<span class="op" id="5648223">:=</span>&nbsp;<span class="ident" id="5648226">p</span><span class="op" id="5648227">.</span><span class="ident" id="5648228">PixOffset</span><span class="op" id="5648237">(</span><span class="ident" id="5648238">x</span><span class="op" id="5648239">,</span>&nbsp;<span class="ident" id="5648241">y</span><span class="op" id="5648242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5648245">p</span><span class="op" id="5648246">.</span><span class="ident" id="5648247">Pix</span><span class="op" id="5648250">[</span><span class="ident" id="5648251">i</span><span class="op" id="5648252">]</span>&nbsp;<span class="op" id="5648254">=</span>&nbsp;<span class="ident" id="5648256">c</span><span class="op" id="5648257">.</span><span class="ident" id="5648258">A</span><br>
<span class="lineno"></span><span class="op" id="5648260">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span><span class="comment" id="5648263">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5648340">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5648412">func</span>&nbsp;<span class="op" id="5648417">(</span><span class="ident" id="5648418">p</span>&nbsp;<span class="op" id="5648420">*</span><span class="ident" id="5648421">Alpha</span><span class="op" id="5648426">)</span>&nbsp;<span class="ident" id="5648428">SubImage</span><span class="op" id="5648436">(</span><span class="ident" id="5648437">r</span>&nbsp;<span class="ident" id="5648439">Rectangle</span><span class="op" id="5648448">)</span>&nbsp;<span class="ident" id="5648450">Image</span>&nbsp;<span class="op" id="5648456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5648459">r</span>&nbsp;<span class="op" id="5648461">=</span>&nbsp;<span class="ident" id="5648463">r</span><span class="op" id="5648464">.</span><span class="ident" id="5648465">Intersect</span><span class="op" id="5648474">(</span><span class="ident" id="5648475">p</span><span class="op" id="5648476">.</span><span class="ident" id="5648477">Rect</span><span class="op" id="5648481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5648484">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5648565">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5648647">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5648697">if</span>&nbsp;<span class="ident" id="5648700">r</span><span class="op" id="5648701">.</span><span class="ident" id="5648702">Empty</span><span class="op" id="5648707">(</span><span class="op" id="5648708">)</span>&nbsp;<span class="op" id="5648710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5648714">return</span>&nbsp;<span class="op" id="5648721">&amp;</span><span class="ident" id="5648722">Alpha</span><span class="op" id="5648727">{</span><span class="op" id="5648728">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5648731">}</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5648734">i</span>&nbsp;<span class="op" id="5648736">:=</span>&nbsp;<span class="ident" id="5648739">p</span><span class="op" id="5648740">.</span><span class="ident" id="5648741">PixOffset</span><span class="op" id="5648750">(</span><span class="ident" id="5648751">r</span><span class="op" id="5648752">.</span><span class="ident" id="5648753">Min</span><span class="op" id="5648756">.</span><span class="ident" id="5648757">X</span><span class="op" id="5648758">,</span>&nbsp;<span class="ident" id="5648760">r</span><span class="op" id="5648761">.</span><span class="ident" id="5648762">Min</span><span class="op" id="5648765">.</span><span class="ident" id="5648766">Y</span><span class="op" id="5648767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5648770">return</span>&nbsp;<span class="op" id="5648777">&amp;</span><span class="ident" id="5648778">Alpha</span><span class="op" id="5648783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5648787">Pix</span><span class="op" id="5648790">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5648795">p</span><span class="op" id="5648796">.</span><span class="ident" id="5648797">Pix</span><span class="op" id="5648800">[</span><span class="ident" id="5648801">i</span><span class="op" id="5648802">:</span><span class="op" id="5648803">]</span><span class="op" id="5648804">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5648808">Stride</span><span class="op" id="5648814">:</span>&nbsp;<span class="ident" id="5648816">p</span><span class="op" id="5648817">.</span><span class="ident" id="5648818">Stride</span><span class="op" id="5648824">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5648828">Rect</span><span class="op" id="5648832">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5648836">r</span><span class="op" id="5648837">,</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5648840">}</span><br>
<span class="lineno"></span><span class="op" id="5648842">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5648845">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5648918">func</span>&nbsp;<span class="op" id="5648923">(</span><span class="ident" id="5648924">p</span>&nbsp;<span class="op" id="5648926">*</span><span class="ident" id="5648927">Alpha</span><span class="op" id="5648932">)</span>&nbsp;<span class="ident" id="5648934">Opaque</span><span class="op" id="5648940">(</span><span class="op" id="5648941">)</span>&nbsp;<span class="builtintype" id="5648943">bool</span>&nbsp;<span class="op" id="5648948">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5648951">if</span>&nbsp;<span class="ident" id="5648954">p</span><span class="op" id="5648955">.</span><span class="ident" id="5648956">Rect</span><span class="op" id="5648960">.</span><span class="ident" id="5648961">Empty</span><span class="op" id="5648966">(</span><span class="op" id="5648967">)</span>&nbsp;<span class="op" id="5648969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5648973">return</span>&nbsp;<span class="builtintype" id="5648980">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5648986">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5648989">i0</span><span class="op" id="5648991">,</span>&nbsp;<span class="ident" id="5648993">i1</span>&nbsp;<span class="op" id="5648996">:=</span>&nbsp;<span class="num" id="5648999">0</span><span class="op" id="5649000">,</span>&nbsp;<span class="ident" id="5649002">p</span><span class="op" id="5649003">.</span><span class="ident" id="5649004">Rect</span><span class="op" id="5649008">.</span><span class="ident" id="5649009">Dx</span><span class="op" id="5649011">(</span><span class="op" id="5649012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5649015">for</span>&nbsp;<span class="ident" id="5649019">y</span>&nbsp;<span class="op" id="5649021">:=</span>&nbsp;<span class="ident" id="5649024">p</span><span class="op" id="5649025">.</span><span class="ident" id="5649026">Rect</span><span class="op" id="5649030">.</span><span class="ident" id="5649031">Min</span><span class="op" id="5649034">.</span><span class="ident" id="5649035">Y</span><span class="op" id="5649036">;</span>&nbsp;<span class="ident" id="5649038">y</span>&nbsp;<span class="op" id="5649040">&lt;</span>&nbsp;<span class="ident" id="5649042">p</span><span class="op" id="5649043">.</span><span class="ident" id="5649044">Rect</span><span class="op" id="5649048">.</span><span class="ident" id="5649049">Max</span><span class="op" id="5649052">.</span><span class="ident" id="5649053">Y</span><span class="op" id="5649054">;</span>&nbsp;<span class="ident" id="5649056">y</span><span class="op" id="5649057">++</span>&nbsp;<span class="op" id="5649060">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5649064">for</span>&nbsp;<span class="ident" id="5649068">i</span>&nbsp;<span class="op" id="5649070">:=</span>&nbsp;<span class="ident" id="5649073">i0</span><span class="op" id="5649075">;</span>&nbsp;<span class="ident" id="5649077">i</span>&nbsp;<span class="op" id="5649079">&lt;</span>&nbsp;<span class="ident" id="5649081">i1</span><span class="op" id="5649083">;</span>&nbsp;<span class="ident" id="5649085">i</span><span class="op" id="5649086">++</span>&nbsp;<span class="op" id="5649089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5649094">if</span>&nbsp;<span class="ident" id="5649097">p</span><span class="op" id="5649098">.</span><span class="ident" id="5649099">Pix</span><span class="op" id="5649102">[</span><span class="ident" id="5649103">i</span><span class="op" id="5649104">]</span>&nbsp;<span class="op" id="5649106">!=</span>&nbsp;<span class="num" id="5649109">0xff</span>&nbsp;<span class="op" id="5649114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5649120">return</span>&nbsp;<span class="builtintype" id="5649127">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5649136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5649140">}</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5649144">i0</span>&nbsp;<span class="op" id="5649147">+=</span>&nbsp;<span class="ident" id="5649150">p</span><span class="op" id="5649151">.</span><span class="ident" id="5649152">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5649161">i1</span>&nbsp;<span class="op" id="5649164">+=</span>&nbsp;<span class="ident" id="5649167">p</span><span class="op" id="5649168">.</span><span class="ident" id="5649169">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5649177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5649180">return</span>&nbsp;<span class="builtintype" id="5649187">true</span><br>
<span class="lineno"></span><span class="op" id="5649192">}</span><br>
<span class="lineno">565</span><br>
<span class="lineno"></span><span class="comment" id="5649195">//&nbsp;NewAlpha&nbsp;returns&nbsp;a&nbsp;new&nbsp;Alpha&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="5649250">func</span>&nbsp;<span class="ident" id="5649255">NewAlpha</span><span class="op" id="5649263">(</span><span class="ident" id="5649264">r</span>&nbsp;<span class="ident" id="5649266">Rectangle</span><span class="op" id="5649275">)</span>&nbsp;<span class="op" id="5649277">*</span><span class="ident" id="5649278">Alpha</span>&nbsp;<span class="op" id="5649284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5649287">w</span><span class="op" id="5649288">,</span>&nbsp;<span class="ident" id="5649290">h</span>&nbsp;<span class="op" id="5649292">:=</span>&nbsp;<span class="ident" id="5649295">r</span><span class="op" id="5649296">.</span><span class="ident" id="5649297">Dx</span><span class="op" id="5649299">(</span><span class="op" id="5649300">)</span><span class="op" id="5649301">,</span>&nbsp;<span class="ident" id="5649303">r</span><span class="op" id="5649304">.</span><span class="ident" id="5649305">Dy</span><span class="op" id="5649307">(</span><span class="op" id="5649308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5649311">pix</span>&nbsp;<span class="op" id="5649315">:=</span>&nbsp;<span class="builtinfunc" id="5649318">make</span><span class="op" id="5649322">(</span><span class="op" id="5649323">[</span><span class="op" id="5649324">]</span><span class="builtintype" id="5649325">uint8</span><span class="op" id="5649330">,</span>&nbsp;<span class="num" id="5649332">1</span><span class="op" id="5649333">*</span><span class="ident" id="5649334">w</span><span class="op" id="5649335">*</span><span class="ident" id="5649336">h</span><span class="op" id="5649337">)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5649340">return</span>&nbsp;<span class="op" id="5649347">&amp;</span><span class="ident" id="5649348">Alpha</span><span class="op" id="5649353">{</span><span class="ident" id="5649354">pix</span><span class="op" id="5649357">,</span>&nbsp;<span class="num" id="5649359">1</span>&nbsp;<span class="op" id="5649361">*</span>&nbsp;<span class="ident" id="5649363">w</span><span class="op" id="5649364">,</span>&nbsp;<span class="ident" id="5649366">r</span><span class="op" id="5649367">}</span><br>
<span class="lineno"></span><span class="op" id="5649369">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5649372">//&nbsp;Alpha16&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.Alpha64&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5649451">type</span>&nbsp;<span class="ident" id="5649456">Alpha16</span>&nbsp;<span class="keyword" id="5649464">struct</span>&nbsp;<span class="op" id="5649471">{</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5649474">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;alpha&nbsp;values&nbsp;in&nbsp;big-endian&nbsp;format.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5649559">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*2].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5649627">Pix</span>&nbsp;<span class="op" id="5649631">[</span><span class="op" id="5649632">]</span><span class="builtintype" id="5649633">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5649640">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5649716">Stride</span>&nbsp;<span class="builtintype" id="5649723">int</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5649728">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5649760">Rect</span>&nbsp;<span class="ident" id="5649765">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="5649775">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5649778">func</span>&nbsp;<span class="op" id="5649783">(</span><span class="ident" id="5649784">p</span>&nbsp;<span class="op" id="5649786">*</span><span class="ident" id="5649787">Alpha16</span><span class="op" id="5649794">)</span>&nbsp;<span class="ident" id="5649796">ColorModel</span><span class="op" id="5649806">(</span><span class="op" id="5649807">)</span>&nbsp;<span class="ident" id="5649809">color</span><span class="op" id="5649814">.</span><span class="ident" id="5649815">Model</span>&nbsp;<span class="op" id="5649821">{</span>&nbsp;<span class="keyword" id="5649823">return</span>&nbsp;<span class="ident" id="5649830">color</span><span class="op" id="5649835">.</span><span class="ident" id="5649836">Alpha16Model</span>&nbsp;<span class="op" id="5649849">}</span><br>
<span class="lineno">585</span><br>
<span class="lineno"></span><span class="keyword" id="5649852">func</span>&nbsp;<span class="op" id="5649857">(</span><span class="ident" id="5649858">p</span>&nbsp;<span class="op" id="5649860">*</span><span class="ident" id="5649861">Alpha16</span><span class="op" id="5649868">)</span>&nbsp;<span class="ident" id="5649870">Bounds</span><span class="op" id="5649876">(</span><span class="op" id="5649877">)</span>&nbsp;<span class="ident" id="5649879">Rectangle</span>&nbsp;<span class="op" id="5649889">{</span>&nbsp;<span class="keyword" id="5649891">return</span>&nbsp;<span class="ident" id="5649898">p</span><span class="op" id="5649899">.</span><span class="ident" id="5649900">Rect</span>&nbsp;<span class="op" id="5649905">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5649908">func</span>&nbsp;<span class="op" id="5649913">(</span><span class="ident" id="5649914">p</span>&nbsp;<span class="op" id="5649916">*</span><span class="ident" id="5649917">Alpha16</span><span class="op" id="5649924">)</span>&nbsp;<span class="ident" id="5649926">At</span><span class="op" id="5649928">(</span><span class="ident" id="5649929">x</span><span class="op" id="5649930">,</span>&nbsp;<span class="ident" id="5649932">y</span>&nbsp;<span class="builtintype" id="5649934">int</span><span class="op" id="5649937">)</span>&nbsp;<span class="ident" id="5649939">color</span><span class="op" id="5649944">.</span><span class="ident" id="5649945">Color</span>&nbsp;<span class="op" id="5649951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5649954">return</span>&nbsp;<span class="ident" id="5649961">p</span><span class="op" id="5649962">.</span><span class="ident" id="5649963">Alpha16At</span><span class="op" id="5649972">(</span><span class="ident" id="5649973">x</span><span class="op" id="5649974">,</span>&nbsp;<span class="ident" id="5649976">y</span><span class="op" id="5649977">)</span><br>
<span class="lineno">590</span><span class="op" id="5649979">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5649982">func</span>&nbsp;<span class="op" id="5649987">(</span><span class="ident" id="5649988">p</span>&nbsp;<span class="op" id="5649990">*</span><span class="ident" id="5649991">Alpha16</span><span class="op" id="5649998">)</span>&nbsp;<span class="ident" id="5650000">Alpha16At</span><span class="op" id="5650009">(</span><span class="ident" id="5650010">x</span><span class="op" id="5650011">,</span>&nbsp;<span class="ident" id="5650013">y</span>&nbsp;<span class="builtintype" id="5650015">int</span><span class="op" id="5650018">)</span>&nbsp;<span class="ident" id="5650020">color</span><span class="op" id="5650025">.</span><span class="ident" id="5650026">Alpha16</span>&nbsp;<span class="op" id="5650034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5650037">if</span>&nbsp;<span class="op" id="5650040">!</span><span class="op" id="5650041">(</span><span class="ident" id="5650042">Point</span><span class="op" id="5650047">{</span><span class="ident" id="5650048">x</span><span class="op" id="5650049">,</span>&nbsp;<span class="ident" id="5650051">y</span><span class="op" id="5650052">}</span><span class="op" id="5650053">.</span><span class="ident" id="5650054">In</span><span class="op" id="5650056">(</span><span class="ident" id="5650057">p</span><span class="op" id="5650058">.</span><span class="ident" id="5650059">Rect</span><span class="op" id="5650063">)</span><span class="op" id="5650064">)</span>&nbsp;<span class="op" id="5650066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5650070">return</span>&nbsp;<span class="ident" id="5650077">color</span><span class="op" id="5650082">.</span><span class="ident" id="5650083">Alpha16</span><span class="op" id="5650090">{</span><span class="op" id="5650091">}</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5650094">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5650097">i</span>&nbsp;<span class="op" id="5650099">:=</span>&nbsp;<span class="ident" id="5650102">p</span><span class="op" id="5650103">.</span><span class="ident" id="5650104">PixOffset</span><span class="op" id="5650113">(</span><span class="ident" id="5650114">x</span><span class="op" id="5650115">,</span>&nbsp;<span class="ident" id="5650117">y</span><span class="op" id="5650118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5650121">return</span>&nbsp;<span class="ident" id="5650128">color</span><span class="op" id="5650133">.</span><span class="ident" id="5650134">Alpha16</span><span class="op" id="5650141">{</span><span class="builtintype" id="5650142">uint16</span><span class="op" id="5650148">(</span><span class="ident" id="5650149">p</span><span class="op" id="5650150">.</span><span class="ident" id="5650151">Pix</span><span class="op" id="5650154">[</span><span class="ident" id="5650155">i</span><span class="op" id="5650156">+</span><span class="num" id="5650157">0</span><span class="op" id="5650158">]</span><span class="op" id="5650159">)</span><span class="op" id="5650160">&lt;&lt;</span><span class="num" id="5650162">8</span>&nbsp;<span class="op" id="5650164">|</span>&nbsp;<span class="builtintype" id="5650166">uint16</span><span class="op" id="5650172">(</span><span class="ident" id="5650173">p</span><span class="op" id="5650174">.</span><span class="ident" id="5650175">Pix</span><span class="op" id="5650178">[</span><span class="ident" id="5650179">i</span><span class="op" id="5650180">+</span><span class="num" id="5650181">1</span><span class="op" id="5650182">]</span><span class="op" id="5650183">)</span><span class="op" id="5650184">}</span><br>
<span class="lineno"></span><span class="op" id="5650186">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">600</span><span class="comment" id="5650189">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5650268">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5650292">func</span>&nbsp;<span class="op" id="5650297">(</span><span class="ident" id="5650298">p</span>&nbsp;<span class="op" id="5650300">*</span><span class="ident" id="5650301">Alpha16</span><span class="op" id="5650308">)</span>&nbsp;<span class="ident" id="5650310">PixOffset</span><span class="op" id="5650319">(</span><span class="ident" id="5650320">x</span><span class="op" id="5650321">,</span>&nbsp;<span class="ident" id="5650323">y</span>&nbsp;<span class="builtintype" id="5650325">int</span><span class="op" id="5650328">)</span>&nbsp;<span class="builtintype" id="5650330">int</span>&nbsp;<span class="op" id="5650334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5650337">return</span>&nbsp;<span class="op" id="5650344">(</span><span class="ident" id="5650345">y</span><span class="op" id="5650346">-</span><span class="ident" id="5650347">p</span><span class="op" id="5650348">.</span><span class="ident" id="5650349">Rect</span><span class="op" id="5650353">.</span><span class="ident" id="5650354">Min</span><span class="op" id="5650357">.</span><span class="ident" id="5650358">Y</span><span class="op" id="5650359">)</span><span class="op" id="5650360">*</span><span class="ident" id="5650361">p</span><span class="op" id="5650362">.</span><span class="ident" id="5650363">Stride</span>&nbsp;<span class="op" id="5650370">+</span>&nbsp;<span class="op" id="5650372">(</span><span class="ident" id="5650373">x</span><span class="op" id="5650374">-</span><span class="ident" id="5650375">p</span><span class="op" id="5650376">.</span><span class="ident" id="5650377">Rect</span><span class="op" id="5650381">.</span><span class="ident" id="5650382">Min</span><span class="op" id="5650385">.</span><span class="ident" id="5650386">X</span><span class="op" id="5650387">)</span><span class="op" id="5650388">*</span><span class="num" id="5650389">2</span><br>
<span class="lineno"></span><span class="op" id="5650391">}</span><br>
<span class="lineno">605</span><br>
<span class="lineno"></span><span class="keyword" id="5650394">func</span>&nbsp;<span class="op" id="5650399">(</span><span class="ident" id="5650400">p</span>&nbsp;<span class="op" id="5650402">*</span><span class="ident" id="5650403">Alpha16</span><span class="op" id="5650410">)</span>&nbsp;<span class="ident" id="5650412">Set</span><span class="op" id="5650415">(</span><span class="ident" id="5650416">x</span><span class="op" id="5650417">,</span>&nbsp;<span class="ident" id="5650419">y</span>&nbsp;<span class="builtintype" id="5650421">int</span><span class="op" id="5650424">,</span>&nbsp;<span class="ident" id="5650426">c</span>&nbsp;<span class="ident" id="5650428">color</span><span class="op" id="5650433">.</span><span class="ident" id="5650434">Color</span><span class="op" id="5650439">)</span>&nbsp;<span class="op" id="5650441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5650444">if</span>&nbsp;<span class="op" id="5650447">!</span><span class="op" id="5650448">(</span><span class="ident" id="5650449">Point</span><span class="op" id="5650454">{</span><span class="ident" id="5650455">x</span><span class="op" id="5650456">,</span>&nbsp;<span class="ident" id="5650458">y</span><span class="op" id="5650459">}</span><span class="op" id="5650460">.</span><span class="ident" id="5650461">In</span><span class="op" id="5650463">(</span><span class="ident" id="5650464">p</span><span class="op" id="5650465">.</span><span class="ident" id="5650466">Rect</span><span class="op" id="5650470">)</span><span class="op" id="5650471">)</span>&nbsp;<span class="op" id="5650473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5650477">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5650485">}</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5650488">i</span>&nbsp;<span class="op" id="5650490">:=</span>&nbsp;<span class="ident" id="5650493">p</span><span class="op" id="5650494">.</span><span class="ident" id="5650495">PixOffset</span><span class="op" id="5650504">(</span><span class="ident" id="5650505">x</span><span class="op" id="5650506">,</span>&nbsp;<span class="ident" id="5650508">y</span><span class="op" id="5650509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5650512">c1</span>&nbsp;<span class="op" id="5650515">:=</span>&nbsp;<span class="ident" id="5650518">color</span><span class="op" id="5650523">.</span><span class="ident" id="5650524">Alpha16Model</span><span class="op" id="5650536">.</span><span class="ident" id="5650537">Convert</span><span class="op" id="5650544">(</span><span class="ident" id="5650545">c</span><span class="op" id="5650546">)</span><span class="op" id="5650547">.</span><span class="op" id="5650548">(</span><span class="ident" id="5650549">color</span><span class="op" id="5650554">.</span><span class="ident" id="5650555">Alpha16</span><span class="op" id="5650562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5650565">p</span><span class="op" id="5650566">.</span><span class="ident" id="5650567">Pix</span><span class="op" id="5650570">[</span><span class="ident" id="5650571">i</span><span class="op" id="5650572">+</span><span class="num" id="5650573">0</span><span class="op" id="5650574">]</span>&nbsp;<span class="op" id="5650576">=</span>&nbsp;<span class="builtintype" id="5650578">uint8</span><span class="op" id="5650583">(</span><span class="ident" id="5650584">c1</span><span class="op" id="5650586">.</span><span class="ident" id="5650587">A</span>&nbsp;<span class="op" id="5650589">&gt;&gt;</span>&nbsp;<span class="num" id="5650592">8</span><span class="op" id="5650593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5650596">p</span><span class="op" id="5650597">.</span><span class="ident" id="5650598">Pix</span><span class="op" id="5650601">[</span><span class="ident" id="5650602">i</span><span class="op" id="5650603">+</span><span class="num" id="5650604">1</span><span class="op" id="5650605">]</span>&nbsp;<span class="op" id="5650607">=</span>&nbsp;<span class="builtintype" id="5650609">uint8</span><span class="op" id="5650614">(</span><span class="ident" id="5650615">c1</span><span class="op" id="5650617">.</span><span class="ident" id="5650618">A</span><span class="op" id="5650619">)</span><br>
<span class="lineno"></span><span class="op" id="5650621">}</span><br>
<span class="lineno">615</span><br>
<span class="lineno"></span><span class="keyword" id="5650624">func</span>&nbsp;<span class="op" id="5650629">(</span><span class="ident" id="5650630">p</span>&nbsp;<span class="op" id="5650632">*</span><span class="ident" id="5650633">Alpha16</span><span class="op" id="5650640">)</span>&nbsp;<span class="ident" id="5650642">SetAlpha16</span><span class="op" id="5650652">(</span><span class="ident" id="5650653">x</span><span class="op" id="5650654">,</span>&nbsp;<span class="ident" id="5650656">y</span>&nbsp;<span class="builtintype" id="5650658">int</span><span class="op" id="5650661">,</span>&nbsp;<span class="ident" id="5650663">c</span>&nbsp;<span class="ident" id="5650665">color</span><span class="op" id="5650670">.</span><span class="ident" id="5650671">Alpha16</span><span class="op" id="5650678">)</span>&nbsp;<span class="op" id="5650680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5650683">if</span>&nbsp;<span class="op" id="5650686">!</span><span class="op" id="5650687">(</span><span class="ident" id="5650688">Point</span><span class="op" id="5650693">{</span><span class="ident" id="5650694">x</span><span class="op" id="5650695">,</span>&nbsp;<span class="ident" id="5650697">y</span><span class="op" id="5650698">}</span><span class="op" id="5650699">.</span><span class="ident" id="5650700">In</span><span class="op" id="5650702">(</span><span class="ident" id="5650703">p</span><span class="op" id="5650704">.</span><span class="ident" id="5650705">Rect</span><span class="op" id="5650709">)</span><span class="op" id="5650710">)</span>&nbsp;<span class="op" id="5650712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5650716">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5650724">}</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5650727">i</span>&nbsp;<span class="op" id="5650729">:=</span>&nbsp;<span class="ident" id="5650732">p</span><span class="op" id="5650733">.</span><span class="ident" id="5650734">PixOffset</span><span class="op" id="5650743">(</span><span class="ident" id="5650744">x</span><span class="op" id="5650745">,</span>&nbsp;<span class="ident" id="5650747">y</span><span class="op" id="5650748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5650751">p</span><span class="op" id="5650752">.</span><span class="ident" id="5650753">Pix</span><span class="op" id="5650756">[</span><span class="ident" id="5650757">i</span><span class="op" id="5650758">+</span><span class="num" id="5650759">0</span><span class="op" id="5650760">]</span>&nbsp;<span class="op" id="5650762">=</span>&nbsp;<span class="builtintype" id="5650764">uint8</span><span class="op" id="5650769">(</span><span class="ident" id="5650770">c</span><span class="op" id="5650771">.</span><span class="ident" id="5650772">A</span>&nbsp;<span class="op" id="5650774">&gt;&gt;</span>&nbsp;<span class="num" id="5650777">8</span><span class="op" id="5650778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5650781">p</span><span class="op" id="5650782">.</span><span class="ident" id="5650783">Pix</span><span class="op" id="5650786">[</span><span class="ident" id="5650787">i</span><span class="op" id="5650788">+</span><span class="num" id="5650789">1</span><span class="op" id="5650790">]</span>&nbsp;<span class="op" id="5650792">=</span>&nbsp;<span class="builtintype" id="5650794">uint8</span><span class="op" id="5650799">(</span><span class="ident" id="5650800">c</span><span class="op" id="5650801">.</span><span class="ident" id="5650802">A</span><span class="op" id="5650803">)</span><br>
<span class="lineno"></span><span class="op" id="5650805">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">625</span><span class="comment" id="5650808">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5650885">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5650957">func</span>&nbsp;<span class="op" id="5650962">(</span><span class="ident" id="5650963">p</span>&nbsp;<span class="op" id="5650965">*</span><span class="ident" id="5650966">Alpha16</span><span class="op" id="5650973">)</span>&nbsp;<span class="ident" id="5650975">SubImage</span><span class="op" id="5650983">(</span><span class="ident" id="5650984">r</span>&nbsp;<span class="ident" id="5650986">Rectangle</span><span class="op" id="5650995">)</span>&nbsp;<span class="ident" id="5650997">Image</span>&nbsp;<span class="op" id="5651003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5651006">r</span>&nbsp;<span class="op" id="5651008">=</span>&nbsp;<span class="ident" id="5651010">r</span><span class="op" id="5651011">.</span><span class="ident" id="5651012">Intersect</span><span class="op" id="5651021">(</span><span class="ident" id="5651022">p</span><span class="op" id="5651023">.</span><span class="ident" id="5651024">Rect</span><span class="op" id="5651028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5651031">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5651112">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5651194">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5651244">if</span>&nbsp;<span class="ident" id="5651247">r</span><span class="op" id="5651248">.</span><span class="ident" id="5651249">Empty</span><span class="op" id="5651254">(</span><span class="op" id="5651255">)</span>&nbsp;<span class="op" id="5651257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5651261">return</span>&nbsp;<span class="op" id="5651268">&amp;</span><span class="ident" id="5651269">Alpha16</span><span class="op" id="5651276">{</span><span class="op" id="5651277">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5651280">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5651283">i</span>&nbsp;<span class="op" id="5651285">:=</span>&nbsp;<span class="ident" id="5651288">p</span><span class="op" id="5651289">.</span><span class="ident" id="5651290">PixOffset</span><span class="op" id="5651299">(</span><span class="ident" id="5651300">r</span><span class="op" id="5651301">.</span><span class="ident" id="5651302">Min</span><span class="op" id="5651305">.</span><span class="ident" id="5651306">X</span><span class="op" id="5651307">,</span>&nbsp;<span class="ident" id="5651309">r</span><span class="op" id="5651310">.</span><span class="ident" id="5651311">Min</span><span class="op" id="5651314">.</span><span class="ident" id="5651315">Y</span><span class="op" id="5651316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5651319">return</span>&nbsp;<span class="op" id="5651326">&amp;</span><span class="ident" id="5651327">Alpha16</span><span class="op" id="5651334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5651338">Pix</span><span class="op" id="5651341">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5651346">p</span><span class="op" id="5651347">.</span><span class="ident" id="5651348">Pix</span><span class="op" id="5651351">[</span><span class="ident" id="5651352">i</span><span class="op" id="5651353">:</span><span class="op" id="5651354">]</span><span class="op" id="5651355">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5651359">Stride</span><span class="op" id="5651365">:</span>&nbsp;<span class="ident" id="5651367">p</span><span class="op" id="5651368">.</span><span class="ident" id="5651369">Stride</span><span class="op" id="5651375">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5651379">Rect</span><span class="op" id="5651383">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5651387">r</span><span class="op" id="5651388">,</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5651391">}</span><br>
<span class="lineno"></span><span class="op" id="5651393">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5651396">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5651469">func</span>&nbsp;<span class="op" id="5651474">(</span><span class="ident" id="5651475">p</span>&nbsp;<span class="op" id="5651477">*</span><span class="ident" id="5651478">Alpha16</span><span class="op" id="5651485">)</span>&nbsp;<span class="ident" id="5651487">Opaque</span><span class="op" id="5651493">(</span><span class="op" id="5651494">)</span>&nbsp;<span class="builtintype" id="5651496">bool</span>&nbsp;<span class="op" id="5651501">{</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5651504">if</span>&nbsp;<span class="ident" id="5651507">p</span><span class="op" id="5651508">.</span><span class="ident" id="5651509">Rect</span><span class="op" id="5651513">.</span><span class="ident" id="5651514">Empty</span><span class="op" id="5651519">(</span><span class="op" id="5651520">)</span>&nbsp;<span class="op" id="5651522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5651526">return</span>&nbsp;<span class="builtintype" id="5651533">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5651539">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5651542">i0</span><span class="op" id="5651544">,</span>&nbsp;<span class="ident" id="5651546">i1</span>&nbsp;<span class="op" id="5651549">:=</span>&nbsp;<span class="num" id="5651552">0</span><span class="op" id="5651553">,</span>&nbsp;<span class="ident" id="5651555">p</span><span class="op" id="5651556">.</span><span class="ident" id="5651557">Rect</span><span class="op" id="5651561">.</span><span class="ident" id="5651562">Dx</span><span class="op" id="5651564">(</span><span class="op" id="5651565">)</span><span class="op" id="5651566">*</span><span class="num" id="5651567">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5651570">for</span>&nbsp;<span class="ident" id="5651574">y</span>&nbsp;<span class="op" id="5651576">:=</span>&nbsp;<span class="ident" id="5651579">p</span><span class="op" id="5651580">.</span><span class="ident" id="5651581">Rect</span><span class="op" id="5651585">.</span><span class="ident" id="5651586">Min</span><span class="op" id="5651589">.</span><span class="ident" id="5651590">Y</span><span class="op" id="5651591">;</span>&nbsp;<span class="ident" id="5651593">y</span>&nbsp;<span class="op" id="5651595">&lt;</span>&nbsp;<span class="ident" id="5651597">p</span><span class="op" id="5651598">.</span><span class="ident" id="5651599">Rect</span><span class="op" id="5651603">.</span><span class="ident" id="5651604">Max</span><span class="op" id="5651607">.</span><span class="ident" id="5651608">Y</span><span class="op" id="5651609">;</span>&nbsp;<span class="ident" id="5651611">y</span><span class="op" id="5651612">++</span>&nbsp;<span class="op" id="5651615">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5651619">for</span>&nbsp;<span class="ident" id="5651623">i</span>&nbsp;<span class="op" id="5651625">:=</span>&nbsp;<span class="ident" id="5651628">i0</span><span class="op" id="5651630">;</span>&nbsp;<span class="ident" id="5651632">i</span>&nbsp;<span class="op" id="5651634">&lt;</span>&nbsp;<span class="ident" id="5651636">i1</span><span class="op" id="5651638">;</span>&nbsp;<span class="ident" id="5651640">i</span>&nbsp;<span class="op" id="5651642">+=</span>&nbsp;<span class="num" id="5651645">2</span>&nbsp;<span class="op" id="5651647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5651652">if</span>&nbsp;<span class="ident" id="5651655">p</span><span class="op" id="5651656">.</span><span class="ident" id="5651657">Pix</span><span class="op" id="5651660">[</span><span class="ident" id="5651661">i</span><span class="op" id="5651662">+</span><span class="num" id="5651663">0</span><span class="op" id="5651664">]</span>&nbsp;<span class="op" id="5651666">!=</span>&nbsp;<span class="num" id="5651669">0xff</span>&nbsp;<span class="op" id="5651674">||</span>&nbsp;<span class="ident" id="5651677">p</span><span class="op" id="5651678">.</span><span class="ident" id="5651679">Pix</span><span class="op" id="5651682">[</span><span class="ident" id="5651683">i</span><span class="op" id="5651684">+</span><span class="num" id="5651685">1</span><span class="op" id="5651686">]</span>&nbsp;<span class="op" id="5651688">!=</span>&nbsp;<span class="num" id="5651691">0xff</span>&nbsp;<span class="op" id="5651696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5651702">return</span>&nbsp;<span class="builtintype" id="5651709">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5651718">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5651722">}</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5651726">i0</span>&nbsp;<span class="op" id="5651729">+=</span>&nbsp;<span class="ident" id="5651732">p</span><span class="op" id="5651733">.</span><span class="ident" id="5651734">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5651743">i1</span>&nbsp;<span class="op" id="5651746">+=</span>&nbsp;<span class="ident" id="5651749">p</span><span class="op" id="5651750">.</span><span class="ident" id="5651751">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5651759">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5651762">return</span>&nbsp;<span class="builtintype" id="5651769">true</span><br>
<span class="lineno"></span><span class="op" id="5651774">}</span><br>
<span class="lineno">660</span><br>
<span class="lineno"></span><span class="comment" id="5651777">//&nbsp;NewAlpha16&nbsp;returns&nbsp;a&nbsp;new&nbsp;Alpha16&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="5651836">func</span>&nbsp;<span class="ident" id="5651841">NewAlpha16</span><span class="op" id="5651851">(</span><span class="ident" id="5651852">r</span>&nbsp;<span class="ident" id="5651854">Rectangle</span><span class="op" id="5651863">)</span>&nbsp;<span class="op" id="5651865">*</span><span class="ident" id="5651866">Alpha16</span>&nbsp;<span class="op" id="5651874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5651877">w</span><span class="op" id="5651878">,</span>&nbsp;<span class="ident" id="5651880">h</span>&nbsp;<span class="op" id="5651882">:=</span>&nbsp;<span class="ident" id="5651885">r</span><span class="op" id="5651886">.</span><span class="ident" id="5651887">Dx</span><span class="op" id="5651889">(</span><span class="op" id="5651890">)</span><span class="op" id="5651891">,</span>&nbsp;<span class="ident" id="5651893">r</span><span class="op" id="5651894">.</span><span class="ident" id="5651895">Dy</span><span class="op" id="5651897">(</span><span class="op" id="5651898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5651901">pix</span>&nbsp;<span class="op" id="5651905">:=</span>&nbsp;<span class="builtinfunc" id="5651908">make</span><span class="op" id="5651912">(</span><span class="op" id="5651913">[</span><span class="op" id="5651914">]</span><span class="builtintype" id="5651915">uint8</span><span class="op" id="5651920">,</span>&nbsp;<span class="num" id="5651922">2</span><span class="op" id="5651923">*</span><span class="ident" id="5651924">w</span><span class="op" id="5651925">*</span><span class="ident" id="5651926">h</span><span class="op" id="5651927">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5651930">return</span>&nbsp;<span class="op" id="5651937">&amp;</span><span class="ident" id="5651938">Alpha16</span><span class="op" id="5651945">{</span><span class="ident" id="5651946">pix</span><span class="op" id="5651949">,</span>&nbsp;<span class="num" id="5651951">2</span>&nbsp;<span class="op" id="5651953">*</span>&nbsp;<span class="ident" id="5651955">w</span><span class="op" id="5651956">,</span>&nbsp;<span class="ident" id="5651958">r</span><span class="op" id="5651959">}</span><br>
<span class="lineno"></span><span class="op" id="5651961">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5651964">//&nbsp;Gray&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.Gray&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5652037">type</span>&nbsp;<span class="ident" id="5652042">Gray</span>&nbsp;<span class="keyword" id="5652047">struct</span>&nbsp;<span class="op" id="5652054">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5652057">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;gray&nbsp;values.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5652120">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*1].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5652188">Pix</span>&nbsp;<span class="op" id="5652192">[</span><span class="op" id="5652193">]</span><span class="builtintype" id="5652194">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5652201">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5652277">Stride</span>&nbsp;<span class="builtintype" id="5652284">int</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5652289">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5652321">Rect</span>&nbsp;<span class="ident" id="5652326">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="5652336">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5652339">func</span>&nbsp;<span class="op" id="5652344">(</span><span class="ident" id="5652345">p</span>&nbsp;<span class="op" id="5652347">*</span><span class="ident" id="5652348">Gray</span><span class="op" id="5652352">)</span>&nbsp;<span class="ident" id="5652354">ColorModel</span><span class="op" id="5652364">(</span><span class="op" id="5652365">)</span>&nbsp;<span class="ident" id="5652367">color</span><span class="op" id="5652372">.</span><span class="ident" id="5652373">Model</span>&nbsp;<span class="op" id="5652379">{</span>&nbsp;<span class="keyword" id="5652381">return</span>&nbsp;<span class="ident" id="5652388">color</span><span class="op" id="5652393">.</span><span class="ident" id="5652394">GrayModel</span>&nbsp;<span class="op" id="5652404">}</span><br>
<span class="lineno">680</span><br>
<span class="lineno"></span><span class="keyword" id="5652407">func</span>&nbsp;<span class="op" id="5652412">(</span><span class="ident" id="5652413">p</span>&nbsp;<span class="op" id="5652415">*</span><span class="ident" id="5652416">Gray</span><span class="op" id="5652420">)</span>&nbsp;<span class="ident" id="5652422">Bounds</span><span class="op" id="5652428">(</span><span class="op" id="5652429">)</span>&nbsp;<span class="ident" id="5652431">Rectangle</span>&nbsp;<span class="op" id="5652441">{</span>&nbsp;<span class="keyword" id="5652443">return</span>&nbsp;<span class="ident" id="5652450">p</span><span class="op" id="5652451">.</span><span class="ident" id="5652452">Rect</span>&nbsp;<span class="op" id="5652457">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5652460">func</span>&nbsp;<span class="op" id="5652465">(</span><span class="ident" id="5652466">p</span>&nbsp;<span class="op" id="5652468">*</span><span class="ident" id="5652469">Gray</span><span class="op" id="5652473">)</span>&nbsp;<span class="ident" id="5652475">At</span><span class="op" id="5652477">(</span><span class="ident" id="5652478">x</span><span class="op" id="5652479">,</span>&nbsp;<span class="ident" id="5652481">y</span>&nbsp;<span class="builtintype" id="5652483">int</span><span class="op" id="5652486">)</span>&nbsp;<span class="ident" id="5652488">color</span><span class="op" id="5652493">.</span><span class="ident" id="5652494">Color</span>&nbsp;<span class="op" id="5652500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5652503">return</span>&nbsp;<span class="ident" id="5652510">p</span><span class="op" id="5652511">.</span><span class="ident" id="5652512">GrayAt</span><span class="op" id="5652518">(</span><span class="ident" id="5652519">x</span><span class="op" id="5652520">,</span>&nbsp;<span class="ident" id="5652522">y</span><span class="op" id="5652523">)</span><br>
<span class="lineno">685</span><span class="op" id="5652525">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5652528">func</span>&nbsp;<span class="op" id="5652533">(</span><span class="ident" id="5652534">p</span>&nbsp;<span class="op" id="5652536">*</span><span class="ident" id="5652537">Gray</span><span class="op" id="5652541">)</span>&nbsp;<span class="ident" id="5652543">GrayAt</span><span class="op" id="5652549">(</span><span class="ident" id="5652550">x</span><span class="op" id="5652551">,</span>&nbsp;<span class="ident" id="5652553">y</span>&nbsp;<span class="builtintype" id="5652555">int</span><span class="op" id="5652558">)</span>&nbsp;<span class="ident" id="5652560">color</span><span class="op" id="5652565">.</span><span class="ident" id="5652566">Gray</span>&nbsp;<span class="op" id="5652571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5652574">if</span>&nbsp;<span class="op" id="5652577">!</span><span class="op" id="5652578">(</span><span class="ident" id="5652579">Point</span><span class="op" id="5652584">{</span><span class="ident" id="5652585">x</span><span class="op" id="5652586">,</span>&nbsp;<span class="ident" id="5652588">y</span><span class="op" id="5652589">}</span><span class="op" id="5652590">.</span><span class="ident" id="5652591">In</span><span class="op" id="5652593">(</span><span class="ident" id="5652594">p</span><span class="op" id="5652595">.</span><span class="ident" id="5652596">Rect</span><span class="op" id="5652600">)</span><span class="op" id="5652601">)</span>&nbsp;<span class="op" id="5652603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5652607">return</span>&nbsp;<span class="ident" id="5652614">color</span><span class="op" id="5652619">.</span><span class="ident" id="5652620">Gray</span><span class="op" id="5652624">{</span><span class="op" id="5652625">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5652628">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5652631">i</span>&nbsp;<span class="op" id="5652633">:=</span>&nbsp;<span class="ident" id="5652636">p</span><span class="op" id="5652637">.</span><span class="ident" id="5652638">PixOffset</span><span class="op" id="5652647">(</span><span class="ident" id="5652648">x</span><span class="op" id="5652649">,</span>&nbsp;<span class="ident" id="5652651">y</span><span class="op" id="5652652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5652655">return</span>&nbsp;<span class="ident" id="5652662">color</span><span class="op" id="5652667">.</span><span class="ident" id="5652668">Gray</span><span class="op" id="5652672">{</span><span class="ident" id="5652673">p</span><span class="op" id="5652674">.</span><span class="ident" id="5652675">Pix</span><span class="op" id="5652678">[</span><span class="ident" id="5652679">i</span><span class="op" id="5652680">]</span><span class="op" id="5652681">}</span><br>
<span class="lineno"></span><span class="op" id="5652683">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">695</span><span class="comment" id="5652686">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5652765">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5652789">func</span>&nbsp;<span class="op" id="5652794">(</span><span class="ident" id="5652795">p</span>&nbsp;<span class="op" id="5652797">*</span><span class="ident" id="5652798">Gray</span><span class="op" id="5652802">)</span>&nbsp;<span class="ident" id="5652804">PixOffset</span><span class="op" id="5652813">(</span><span class="ident" id="5652814">x</span><span class="op" id="5652815">,</span>&nbsp;<span class="ident" id="5652817">y</span>&nbsp;<span class="builtintype" id="5652819">int</span><span class="op" id="5652822">)</span>&nbsp;<span class="builtintype" id="5652824">int</span>&nbsp;<span class="op" id="5652828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5652831">return</span>&nbsp;<span class="op" id="5652838">(</span><span class="ident" id="5652839">y</span><span class="op" id="5652840">-</span><span class="ident" id="5652841">p</span><span class="op" id="5652842">.</span><span class="ident" id="5652843">Rect</span><span class="op" id="5652847">.</span><span class="ident" id="5652848">Min</span><span class="op" id="5652851">.</span><span class="ident" id="5652852">Y</span><span class="op" id="5652853">)</span><span class="op" id="5652854">*</span><span class="ident" id="5652855">p</span><span class="op" id="5652856">.</span><span class="ident" id="5652857">Stride</span>&nbsp;<span class="op" id="5652864">+</span>&nbsp;<span class="op" id="5652866">(</span><span class="ident" id="5652867">x</span><span class="op" id="5652868">-</span><span class="ident" id="5652869">p</span><span class="op" id="5652870">.</span><span class="ident" id="5652871">Rect</span><span class="op" id="5652875">.</span><span class="ident" id="5652876">Min</span><span class="op" id="5652879">.</span><span class="ident" id="5652880">X</span><span class="op" id="5652881">)</span><span class="op" id="5652882">*</span><span class="num" id="5652883">1</span><br>
<span class="lineno"></span><span class="op" id="5652885">}</span><br>
<span class="lineno">700</span><br>
<span class="lineno"></span><span class="keyword" id="5652888">func</span>&nbsp;<span class="op" id="5652893">(</span><span class="ident" id="5652894">p</span>&nbsp;<span class="op" id="5652896">*</span><span class="ident" id="5652897">Gray</span><span class="op" id="5652901">)</span>&nbsp;<span class="ident" id="5652903">Set</span><span class="op" id="5652906">(</span><span class="ident" id="5652907">x</span><span class="op" id="5652908">,</span>&nbsp;<span class="ident" id="5652910">y</span>&nbsp;<span class="builtintype" id="5652912">int</span><span class="op" id="5652915">,</span>&nbsp;<span class="ident" id="5652917">c</span>&nbsp;<span class="ident" id="5652919">color</span><span class="op" id="5652924">.</span><span class="ident" id="5652925">Color</span><span class="op" id="5652930">)</span>&nbsp;<span class="op" id="5652932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5652935">if</span>&nbsp;<span class="op" id="5652938">!</span><span class="op" id="5652939">(</span><span class="ident" id="5652940">Point</span><span class="op" id="5652945">{</span><span class="ident" id="5652946">x</span><span class="op" id="5652947">,</span>&nbsp;<span class="ident" id="5652949">y</span><span class="op" id="5652950">}</span><span class="op" id="5652951">.</span><span class="ident" id="5652952">In</span><span class="op" id="5652954">(</span><span class="ident" id="5652955">p</span><span class="op" id="5652956">.</span><span class="ident" id="5652957">Rect</span><span class="op" id="5652961">)</span><span class="op" id="5652962">)</span>&nbsp;<span class="op" id="5652964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5652968">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5652976">}</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5652979">i</span>&nbsp;<span class="op" id="5652981">:=</span>&nbsp;<span class="ident" id="5652984">p</span><span class="op" id="5652985">.</span><span class="ident" id="5652986">PixOffset</span><span class="op" id="5652995">(</span><span class="ident" id="5652996">x</span><span class="op" id="5652997">,</span>&nbsp;<span class="ident" id="5652999">y</span><span class="op" id="5653000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5653003">p</span><span class="op" id="5653004">.</span><span class="ident" id="5653005">Pix</span><span class="op" id="5653008">[</span><span class="ident" id="5653009">i</span><span class="op" id="5653010">]</span>&nbsp;<span class="op" id="5653012">=</span>&nbsp;<span class="ident" id="5653014">color</span><span class="op" id="5653019">.</span><span class="ident" id="5653020">GrayModel</span><span class="op" id="5653029">.</span><span class="ident" id="5653030">Convert</span><span class="op" id="5653037">(</span><span class="ident" id="5653038">c</span><span class="op" id="5653039">)</span><span class="op" id="5653040">.</span><span class="op" id="5653041">(</span><span class="ident" id="5653042">color</span><span class="op" id="5653047">.</span><span class="ident" id="5653048">Gray</span><span class="op" id="5653052">)</span><span class="op" id="5653053">.</span><span class="ident" id="5653054">Y</span><br>
<span class="lineno"></span><span class="op" id="5653056">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5653059">func</span>&nbsp;<span class="op" id="5653064">(</span><span class="ident" id="5653065">p</span>&nbsp;<span class="op" id="5653067">*</span><span class="ident" id="5653068">Gray</span><span class="op" id="5653072">)</span>&nbsp;<span class="ident" id="5653074">SetGray</span><span class="op" id="5653081">(</span><span class="ident" id="5653082">x</span><span class="op" id="5653083">,</span>&nbsp;<span class="ident" id="5653085">y</span>&nbsp;<span class="builtintype" id="5653087">int</span><span class="op" id="5653090">,</span>&nbsp;<span class="ident" id="5653092">c</span>&nbsp;<span class="ident" id="5653094">color</span><span class="op" id="5653099">.</span><span class="ident" id="5653100">Gray</span><span class="op" id="5653104">)</span>&nbsp;<span class="op" id="5653106">{</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5653109">if</span>&nbsp;<span class="op" id="5653112">!</span><span class="op" id="5653113">(</span><span class="ident" id="5653114">Point</span><span class="op" id="5653119">{</span><span class="ident" id="5653120">x</span><span class="op" id="5653121">,</span>&nbsp;<span class="ident" id="5653123">y</span><span class="op" id="5653124">}</span><span class="op" id="5653125">.</span><span class="ident" id="5653126">In</span><span class="op" id="5653128">(</span><span class="ident" id="5653129">p</span><span class="op" id="5653130">.</span><span class="ident" id="5653131">Rect</span><span class="op" id="5653135">)</span><span class="op" id="5653136">)</span>&nbsp;<span class="op" id="5653138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5653142">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5653150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5653153">i</span>&nbsp;<span class="op" id="5653155">:=</span>&nbsp;<span class="ident" id="5653158">p</span><span class="op" id="5653159">.</span><span class="ident" id="5653160">PixOffset</span><span class="op" id="5653169">(</span><span class="ident" id="5653170">x</span><span class="op" id="5653171">,</span>&nbsp;<span class="ident" id="5653173">y</span><span class="op" id="5653174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5653177">p</span><span class="op" id="5653178">.</span><span class="ident" id="5653179">Pix</span><span class="op" id="5653182">[</span><span class="ident" id="5653183">i</span><span class="op" id="5653184">]</span>&nbsp;<span class="op" id="5653186">=</span>&nbsp;<span class="ident" id="5653188">c</span><span class="op" id="5653189">.</span><span class="ident" id="5653190">Y</span><br>
<span class="lineno">715</span><span class="op" id="5653192">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5653195">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5653272">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5653344">func</span>&nbsp;<span class="op" id="5653349">(</span><span class="ident" id="5653350">p</span>&nbsp;<span class="op" id="5653352">*</span><span class="ident" id="5653353">Gray</span><span class="op" id="5653357">)</span>&nbsp;<span class="ident" id="5653359">SubImage</span><span class="op" id="5653367">(</span><span class="ident" id="5653368">r</span>&nbsp;<span class="ident" id="5653370">Rectangle</span><span class="op" id="5653379">)</span>&nbsp;<span class="ident" id="5653381">Image</span>&nbsp;<span class="op" id="5653387">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5653390">r</span>&nbsp;<span class="op" id="5653392">=</span>&nbsp;<span class="ident" id="5653394">r</span><span class="op" id="5653395">.</span><span class="ident" id="5653396">Intersect</span><span class="op" id="5653405">(</span><span class="ident" id="5653406">p</span><span class="op" id="5653407">.</span><span class="ident" id="5653408">Rect</span><span class="op" id="5653412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5653415">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5653496">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5653578">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5653628">if</span>&nbsp;<span class="ident" id="5653631">r</span><span class="op" id="5653632">.</span><span class="ident" id="5653633">Empty</span><span class="op" id="5653638">(</span><span class="op" id="5653639">)</span>&nbsp;<span class="op" id="5653641">{</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5653645">return</span>&nbsp;<span class="op" id="5653652">&amp;</span><span class="ident" id="5653653">Gray</span><span class="op" id="5653657">{</span><span class="op" id="5653658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5653661">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5653664">i</span>&nbsp;<span class="op" id="5653666">:=</span>&nbsp;<span class="ident" id="5653669">p</span><span class="op" id="5653670">.</span><span class="ident" id="5653671">PixOffset</span><span class="op" id="5653680">(</span><span class="ident" id="5653681">r</span><span class="op" id="5653682">.</span><span class="ident" id="5653683">Min</span><span class="op" id="5653686">.</span><span class="ident" id="5653687">X</span><span class="op" id="5653688">,</span>&nbsp;<span class="ident" id="5653690">r</span><span class="op" id="5653691">.</span><span class="ident" id="5653692">Min</span><span class="op" id="5653695">.</span><span class="ident" id="5653696">Y</span><span class="op" id="5653697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5653700">return</span>&nbsp;<span class="op" id="5653707">&amp;</span><span class="ident" id="5653708">Gray</span><span class="op" id="5653712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5653716">Pix</span><span class="op" id="5653719">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5653724">p</span><span class="op" id="5653725">.</span><span class="ident" id="5653726">Pix</span><span class="op" id="5653729">[</span><span class="ident" id="5653730">i</span><span class="op" id="5653731">:</span><span class="op" id="5653732">]</span><span class="op" id="5653733">,</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5653737">Stride</span><span class="op" id="5653743">:</span>&nbsp;<span class="ident" id="5653745">p</span><span class="op" id="5653746">.</span><span class="ident" id="5653747">Stride</span><span class="op" id="5653753">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5653757">Rect</span><span class="op" id="5653761">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5653765">r</span><span class="op" id="5653766">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5653769">}</span><br>
<span class="lineno"></span><span class="op" id="5653771">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">735</span><span class="comment" id="5653774">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5653847">func</span>&nbsp;<span class="op" id="5653852">(</span><span class="ident" id="5653853">p</span>&nbsp;<span class="op" id="5653855">*</span><span class="ident" id="5653856">Gray</span><span class="op" id="5653860">)</span>&nbsp;<span class="ident" id="5653862">Opaque</span><span class="op" id="5653868">(</span><span class="op" id="5653869">)</span>&nbsp;<span class="builtintype" id="5653871">bool</span>&nbsp;<span class="op" id="5653876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5653879">return</span>&nbsp;<span class="builtintype" id="5653886">true</span><br>
<span class="lineno"></span><span class="op" id="5653891">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">740</span><span class="comment" id="5653894">//&nbsp;NewGray&nbsp;returns&nbsp;a&nbsp;new&nbsp;Gray&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="5653947">func</span>&nbsp;<span class="ident" id="5653952">NewGray</span><span class="op" id="5653959">(</span><span class="ident" id="5653960">r</span>&nbsp;<span class="ident" id="5653962">Rectangle</span><span class="op" id="5653971">)</span>&nbsp;<span class="op" id="5653973">*</span><span class="ident" id="5653974">Gray</span>&nbsp;<span class="op" id="5653979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5653982">w</span><span class="op" id="5653983">,</span>&nbsp;<span class="ident" id="5653985">h</span>&nbsp;<span class="op" id="5653987">:=</span>&nbsp;<span class="ident" id="5653990">r</span><span class="op" id="5653991">.</span><span class="ident" id="5653992">Dx</span><span class="op" id="5653994">(</span><span class="op" id="5653995">)</span><span class="op" id="5653996">,</span>&nbsp;<span class="ident" id="5653998">r</span><span class="op" id="5653999">.</span><span class="ident" id="5654000">Dy</span><span class="op" id="5654002">(</span><span class="op" id="5654003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5654006">pix</span>&nbsp;<span class="op" id="5654010">:=</span>&nbsp;<span class="builtinfunc" id="5654013">make</span><span class="op" id="5654017">(</span><span class="op" id="5654018">[</span><span class="op" id="5654019">]</span><span class="builtintype" id="5654020">uint8</span><span class="op" id="5654025">,</span>&nbsp;<span class="num" id="5654027">1</span><span class="op" id="5654028">*</span><span class="ident" id="5654029">w</span><span class="op" id="5654030">*</span><span class="ident" id="5654031">h</span><span class="op" id="5654032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5654035">return</span>&nbsp;<span class="op" id="5654042">&amp;</span><span class="ident" id="5654043">Gray</span><span class="op" id="5654047">{</span><span class="ident" id="5654048">pix</span><span class="op" id="5654051">,</span>&nbsp;<span class="num" id="5654053">1</span>&nbsp;<span class="op" id="5654055">*</span>&nbsp;<span class="ident" id="5654057">w</span><span class="op" id="5654058">,</span>&nbsp;<span class="ident" id="5654060">r</span><span class="op" id="5654061">}</span><br>
<span class="lineno">745</span><span class="op" id="5654063">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5654066">//&nbsp;Gray16&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.Gray16&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5654143">type</span>&nbsp;<span class="ident" id="5654148">Gray16</span>&nbsp;<span class="keyword" id="5654155">struct</span>&nbsp;<span class="op" id="5654162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5654165">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;gray&nbsp;values&nbsp;in&nbsp;big-endian&nbsp;format.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5654249">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*2].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5654317">Pix</span>&nbsp;<span class="op" id="5654321">[</span><span class="op" id="5654322">]</span><span class="builtintype" id="5654323">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5654330">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5654406">Stride</span>&nbsp;<span class="builtintype" id="5654413">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5654418">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5654450">Rect</span>&nbsp;<span class="ident" id="5654455">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="5654465">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5654468">func</span>&nbsp;<span class="op" id="5654473">(</span><span class="ident" id="5654474">p</span>&nbsp;<span class="op" id="5654476">*</span><span class="ident" id="5654477">Gray16</span><span class="op" id="5654483">)</span>&nbsp;<span class="ident" id="5654485">ColorModel</span><span class="op" id="5654495">(</span><span class="op" id="5654496">)</span>&nbsp;<span class="ident" id="5654498">color</span><span class="op" id="5654503">.</span><span class="ident" id="5654504">Model</span>&nbsp;<span class="op" id="5654510">{</span>&nbsp;<span class="keyword" id="5654512">return</span>&nbsp;<span class="ident" id="5654519">color</span><span class="op" id="5654524">.</span><span class="ident" id="5654525">Gray16Model</span>&nbsp;<span class="op" id="5654537">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">760</span><span class="keyword" id="5654540">func</span>&nbsp;<span class="op" id="5654545">(</span><span class="ident" id="5654546">p</span>&nbsp;<span class="op" id="5654548">*</span><span class="ident" id="5654549">Gray16</span><span class="op" id="5654555">)</span>&nbsp;<span class="ident" id="5654557">Bounds</span><span class="op" id="5654563">(</span><span class="op" id="5654564">)</span>&nbsp;<span class="ident" id="5654566">Rectangle</span>&nbsp;<span class="op" id="5654576">{</span>&nbsp;<span class="keyword" id="5654578">return</span>&nbsp;<span class="ident" id="5654585">p</span><span class="op" id="5654586">.</span><span class="ident" id="5654587">Rect</span>&nbsp;<span class="op" id="5654592">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5654595">func</span>&nbsp;<span class="op" id="5654600">(</span><span class="ident" id="5654601">p</span>&nbsp;<span class="op" id="5654603">*</span><span class="ident" id="5654604">Gray16</span><span class="op" id="5654610">)</span>&nbsp;<span class="ident" id="5654612">At</span><span class="op" id="5654614">(</span><span class="ident" id="5654615">x</span><span class="op" id="5654616">,</span>&nbsp;<span class="ident" id="5654618">y</span>&nbsp;<span class="builtintype" id="5654620">int</span><span class="op" id="5654623">)</span>&nbsp;<span class="ident" id="5654625">color</span><span class="op" id="5654630">.</span><span class="ident" id="5654631">Color</span>&nbsp;<span class="op" id="5654637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5654640">return</span>&nbsp;<span class="ident" id="5654647">p</span><span class="op" id="5654648">.</span><span class="ident" id="5654649">Gray16At</span><span class="op" id="5654657">(</span><span class="ident" id="5654658">x</span><span class="op" id="5654659">,</span>&nbsp;<span class="ident" id="5654661">y</span><span class="op" id="5654662">)</span><br>
<span class="lineno"></span><span class="op" id="5654664">}</span><br>
<span class="lineno">765</span><br>
<span class="lineno"></span><span class="keyword" id="5654667">func</span>&nbsp;<span class="op" id="5654672">(</span><span class="ident" id="5654673">p</span>&nbsp;<span class="op" id="5654675">*</span><span class="ident" id="5654676">Gray16</span><span class="op" id="5654682">)</span>&nbsp;<span class="ident" id="5654684">Gray16At</span><span class="op" id="5654692">(</span><span class="ident" id="5654693">x</span><span class="op" id="5654694">,</span>&nbsp;<span class="ident" id="5654696">y</span>&nbsp;<span class="builtintype" id="5654698">int</span><span class="op" id="5654701">)</span>&nbsp;<span class="ident" id="5654703">color</span><span class="op" id="5654708">.</span><span class="ident" id="5654709">Gray16</span>&nbsp;<span class="op" id="5654716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5654719">if</span>&nbsp;<span class="op" id="5654722">!</span><span class="op" id="5654723">(</span><span class="ident" id="5654724">Point</span><span class="op" id="5654729">{</span><span class="ident" id="5654730">x</span><span class="op" id="5654731">,</span>&nbsp;<span class="ident" id="5654733">y</span><span class="op" id="5654734">}</span><span class="op" id="5654735">.</span><span class="ident" id="5654736">In</span><span class="op" id="5654738">(</span><span class="ident" id="5654739">p</span><span class="op" id="5654740">.</span><span class="ident" id="5654741">Rect</span><span class="op" id="5654745">)</span><span class="op" id="5654746">)</span>&nbsp;<span class="op" id="5654748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5654752">return</span>&nbsp;<span class="ident" id="5654759">color</span><span class="op" id="5654764">.</span><span class="ident" id="5654765">Gray16</span><span class="op" id="5654771">{</span><span class="op" id="5654772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5654775">}</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5654778">i</span>&nbsp;<span class="op" id="5654780">:=</span>&nbsp;<span class="ident" id="5654783">p</span><span class="op" id="5654784">.</span><span class="ident" id="5654785">PixOffset</span><span class="op" id="5654794">(</span><span class="ident" id="5654795">x</span><span class="op" id="5654796">,</span>&nbsp;<span class="ident" id="5654798">y</span><span class="op" id="5654799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5654802">return</span>&nbsp;<span class="ident" id="5654809">color</span><span class="op" id="5654814">.</span><span class="ident" id="5654815">Gray16</span><span class="op" id="5654821">{</span><span class="builtintype" id="5654822">uint16</span><span class="op" id="5654828">(</span><span class="ident" id="5654829">p</span><span class="op" id="5654830">.</span><span class="ident" id="5654831">Pix</span><span class="op" id="5654834">[</span><span class="ident" id="5654835">i</span><span class="op" id="5654836">+</span><span class="num" id="5654837">0</span><span class="op" id="5654838">]</span><span class="op" id="5654839">)</span><span class="op" id="5654840">&lt;&lt;</span><span class="num" id="5654842">8</span>&nbsp;<span class="op" id="5654844">|</span>&nbsp;<span class="builtintype" id="5654846">uint16</span><span class="op" id="5654852">(</span><span class="ident" id="5654853">p</span><span class="op" id="5654854">.</span><span class="ident" id="5654855">Pix</span><span class="op" id="5654858">[</span><span class="ident" id="5654859">i</span><span class="op" id="5654860">+</span><span class="num" id="5654861">1</span><span class="op" id="5654862">]</span><span class="op" id="5654863">)</span><span class="op" id="5654864">}</span><br>
<span class="lineno"></span><span class="op" id="5654866">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5654869">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno">775</span><span class="comment" id="5654948">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5654972">func</span>&nbsp;<span class="op" id="5654977">(</span><span class="ident" id="5654978">p</span>&nbsp;<span class="op" id="5654980">*</span><span class="ident" id="5654981">Gray16</span><span class="op" id="5654987">)</span>&nbsp;<span class="ident" id="5654989">PixOffset</span><span class="op" id="5654998">(</span><span class="ident" id="5654999">x</span><span class="op" id="5655000">,</span>&nbsp;<span class="ident" id="5655002">y</span>&nbsp;<span class="builtintype" id="5655004">int</span><span class="op" id="5655007">)</span>&nbsp;<span class="builtintype" id="5655009">int</span>&nbsp;<span class="op" id="5655013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5655016">return</span>&nbsp;<span class="op" id="5655023">(</span><span class="ident" id="5655024">y</span><span class="op" id="5655025">-</span><span class="ident" id="5655026">p</span><span class="op" id="5655027">.</span><span class="ident" id="5655028">Rect</span><span class="op" id="5655032">.</span><span class="ident" id="5655033">Min</span><span class="op" id="5655036">.</span><span class="ident" id="5655037">Y</span><span class="op" id="5655038">)</span><span class="op" id="5655039">*</span><span class="ident" id="5655040">p</span><span class="op" id="5655041">.</span><span class="ident" id="5655042">Stride</span>&nbsp;<span class="op" id="5655049">+</span>&nbsp;<span class="op" id="5655051">(</span><span class="ident" id="5655052">x</span><span class="op" id="5655053">-</span><span class="ident" id="5655054">p</span><span class="op" id="5655055">.</span><span class="ident" id="5655056">Rect</span><span class="op" id="5655060">.</span><span class="ident" id="5655061">Min</span><span class="op" id="5655064">.</span><span class="ident" id="5655065">X</span><span class="op" id="5655066">)</span><span class="op" id="5655067">*</span><span class="num" id="5655068">2</span><br>
<span class="lineno"></span><span class="op" id="5655070">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">780</span><span class="keyword" id="5655073">func</span>&nbsp;<span class="op" id="5655078">(</span><span class="ident" id="5655079">p</span>&nbsp;<span class="op" id="5655081">*</span><span class="ident" id="5655082">Gray16</span><span class="op" id="5655088">)</span>&nbsp;<span class="ident" id="5655090">Set</span><span class="op" id="5655093">(</span><span class="ident" id="5655094">x</span><span class="op" id="5655095">,</span>&nbsp;<span class="ident" id="5655097">y</span>&nbsp;<span class="builtintype" id="5655099">int</span><span class="op" id="5655102">,</span>&nbsp;<span class="ident" id="5655104">c</span>&nbsp;<span class="ident" id="5655106">color</span><span class="op" id="5655111">.</span><span class="ident" id="5655112">Color</span><span class="op" id="5655117">)</span>&nbsp;<span class="op" id="5655119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5655122">if</span>&nbsp;<span class="op" id="5655125">!</span><span class="op" id="5655126">(</span><span class="ident" id="5655127">Point</span><span class="op" id="5655132">{</span><span class="ident" id="5655133">x</span><span class="op" id="5655134">,</span>&nbsp;<span class="ident" id="5655136">y</span><span class="op" id="5655137">}</span><span class="op" id="5655138">.</span><span class="ident" id="5655139">In</span><span class="op" id="5655141">(</span><span class="ident" id="5655142">p</span><span class="op" id="5655143">.</span><span class="ident" id="5655144">Rect</span><span class="op" id="5655148">)</span><span class="op" id="5655149">)</span>&nbsp;<span class="op" id="5655151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5655155">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5655163">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5655166">i</span>&nbsp;<span class="op" id="5655168">:=</span>&nbsp;<span class="ident" id="5655171">p</span><span class="op" id="5655172">.</span><span class="ident" id="5655173">PixOffset</span><span class="op" id="5655182">(</span><span class="ident" id="5655183">x</span><span class="op" id="5655184">,</span>&nbsp;<span class="ident" id="5655186">y</span><span class="op" id="5655187">)</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5655190">c1</span>&nbsp;<span class="op" id="5655193">:=</span>&nbsp;<span class="ident" id="5655196">color</span><span class="op" id="5655201">.</span><span class="ident" id="5655202">Gray16Model</span><span class="op" id="5655213">.</span><span class="ident" id="5655214">Convert</span><span class="op" id="5655221">(</span><span class="ident" id="5655222">c</span><span class="op" id="5655223">)</span><span class="op" id="5655224">.</span><span class="op" id="5655225">(</span><span class="ident" id="5655226">color</span><span class="op" id="5655231">.</span><span class="ident" id="5655232">Gray16</span><span class="op" id="5655238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5655241">p</span><span class="op" id="5655242">.</span><span class="ident" id="5655243">Pix</span><span class="op" id="5655246">[</span><span class="ident" id="5655247">i</span><span class="op" id="5655248">+</span><span class="num" id="5655249">0</span><span class="op" id="5655250">]</span>&nbsp;<span class="op" id="5655252">=</span>&nbsp;<span class="builtintype" id="5655254">uint8</span><span class="op" id="5655259">(</span><span class="ident" id="5655260">c1</span><span class="op" id="5655262">.</span><span class="ident" id="5655263">Y</span>&nbsp;<span class="op" id="5655265">&gt;&gt;</span>&nbsp;<span class="num" id="5655268">8</span><span class="op" id="5655269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5655272">p</span><span class="op" id="5655273">.</span><span class="ident" id="5655274">Pix</span><span class="op" id="5655277">[</span><span class="ident" id="5655278">i</span><span class="op" id="5655279">+</span><span class="num" id="5655280">1</span><span class="op" id="5655281">]</span>&nbsp;<span class="op" id="5655283">=</span>&nbsp;<span class="builtintype" id="5655285">uint8</span><span class="op" id="5655290">(</span><span class="ident" id="5655291">c1</span><span class="op" id="5655293">.</span><span class="ident" id="5655294">Y</span><span class="op" id="5655295">)</span><br>
<span class="lineno"></span><span class="op" id="5655297">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">790</span><span class="keyword" id="5655300">func</span>&nbsp;<span class="op" id="5655305">(</span><span class="ident" id="5655306">p</span>&nbsp;<span class="op" id="5655308">*</span><span class="ident" id="5655309">Gray16</span><span class="op" id="5655315">)</span>&nbsp;<span class="ident" id="5655317">SetGray16</span><span class="op" id="5655326">(</span><span class="ident" id="5655327">x</span><span class="op" id="5655328">,</span>&nbsp;<span class="ident" id="5655330">y</span>&nbsp;<span class="builtintype" id="5655332">int</span><span class="op" id="5655335">,</span>&nbsp;<span class="ident" id="5655337">c</span>&nbsp;<span class="ident" id="5655339">color</span><span class="op" id="5655344">.</span><span class="ident" id="5655345">Gray16</span><span class="op" id="5655351">)</span>&nbsp;<span class="op" id="5655353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5655356">if</span>&nbsp;<span class="op" id="5655359">!</span><span class="op" id="5655360">(</span><span class="ident" id="5655361">Point</span><span class="op" id="5655366">{</span><span class="ident" id="5655367">x</span><span class="op" id="5655368">,</span>&nbsp;<span class="ident" id="5655370">y</span><span class="op" id="5655371">}</span><span class="op" id="5655372">.</span><span class="ident" id="5655373">In</span><span class="op" id="5655375">(</span><span class="ident" id="5655376">p</span><span class="op" id="5655377">.</span><span class="ident" id="5655378">Rect</span><span class="op" id="5655382">)</span><span class="op" id="5655383">)</span>&nbsp;<span class="op" id="5655385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5655389">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5655397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5655400">i</span>&nbsp;<span class="op" id="5655402">:=</span>&nbsp;<span class="ident" id="5655405">p</span><span class="op" id="5655406">.</span><span class="ident" id="5655407">PixOffset</span><span class="op" id="5655416">(</span><span class="ident" id="5655417">x</span><span class="op" id="5655418">,</span>&nbsp;<span class="ident" id="5655420">y</span><span class="op" id="5655421">)</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5655424">p</span><span class="op" id="5655425">.</span><span class="ident" id="5655426">Pix</span><span class="op" id="5655429">[</span><span class="ident" id="5655430">i</span><span class="op" id="5655431">+</span><span class="num" id="5655432">0</span><span class="op" id="5655433">]</span>&nbsp;<span class="op" id="5655435">=</span>&nbsp;<span class="builtintype" id="5655437">uint8</span><span class="op" id="5655442">(</span><span class="ident" id="5655443">c</span><span class="op" id="5655444">.</span><span class="ident" id="5655445">Y</span>&nbsp;<span class="op" id="5655447">&gt;&gt;</span>&nbsp;<span class="num" id="5655450">8</span><span class="op" id="5655451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5655454">p</span><span class="op" id="5655455">.</span><span class="ident" id="5655456">Pix</span><span class="op" id="5655459">[</span><span class="ident" id="5655460">i</span><span class="op" id="5655461">+</span><span class="num" id="5655462">1</span><span class="op" id="5655463">]</span>&nbsp;<span class="op" id="5655465">=</span>&nbsp;<span class="builtintype" id="5655467">uint8</span><span class="op" id="5655472">(</span><span class="ident" id="5655473">c</span><span class="op" id="5655474">.</span><span class="ident" id="5655475">Y</span><span class="op" id="5655476">)</span><br>
<span class="lineno"></span><span class="op" id="5655478">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5655481">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno">800</span><span class="comment" id="5655558">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5655630">func</span>&nbsp;<span class="op" id="5655635">(</span><span class="ident" id="5655636">p</span>&nbsp;<span class="op" id="5655638">*</span><span class="ident" id="5655639">Gray16</span><span class="op" id="5655645">)</span>&nbsp;<span class="ident" id="5655647">SubImage</span><span class="op" id="5655655">(</span><span class="ident" id="5655656">r</span>&nbsp;<span class="ident" id="5655658">Rectangle</span><span class="op" id="5655667">)</span>&nbsp;<span class="ident" id="5655669">Image</span>&nbsp;<span class="op" id="5655675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5655678">r</span>&nbsp;<span class="op" id="5655680">=</span>&nbsp;<span class="ident" id="5655682">r</span><span class="op" id="5655683">.</span><span class="ident" id="5655684">Intersect</span><span class="op" id="5655693">(</span><span class="ident" id="5655694">p</span><span class="op" id="5655695">.</span><span class="ident" id="5655696">Rect</span><span class="op" id="5655700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5655703">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5655784">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5655866">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5655916">if</span>&nbsp;<span class="ident" id="5655919">r</span><span class="op" id="5655920">.</span><span class="ident" id="5655921">Empty</span><span class="op" id="5655926">(</span><span class="op" id="5655927">)</span>&nbsp;<span class="op" id="5655929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5655933">return</span>&nbsp;<span class="op" id="5655940">&amp;</span><span class="ident" id="5655941">Gray16</span><span class="op" id="5655947">{</span><span class="op" id="5655948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5655951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5655954">i</span>&nbsp;<span class="op" id="5655956">:=</span>&nbsp;<span class="ident" id="5655959">p</span><span class="op" id="5655960">.</span><span class="ident" id="5655961">PixOffset</span><span class="op" id="5655970">(</span><span class="ident" id="5655971">r</span><span class="op" id="5655972">.</span><span class="ident" id="5655973">Min</span><span class="op" id="5655976">.</span><span class="ident" id="5655977">X</span><span class="op" id="5655978">,</span>&nbsp;<span class="ident" id="5655980">r</span><span class="op" id="5655981">.</span><span class="ident" id="5655982">Min</span><span class="op" id="5655985">.</span><span class="ident" id="5655986">Y</span><span class="op" id="5655987">)</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5655990">return</span>&nbsp;<span class="op" id="5655997">&amp;</span><span class="ident" id="5655998">Gray16</span><span class="op" id="5656004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5656008">Pix</span><span class="op" id="5656011">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5656016">p</span><span class="op" id="5656017">.</span><span class="ident" id="5656018">Pix</span><span class="op" id="5656021">[</span><span class="ident" id="5656022">i</span><span class="op" id="5656023">:</span><span class="op" id="5656024">]</span><span class="op" id="5656025">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5656029">Stride</span><span class="op" id="5656035">:</span>&nbsp;<span class="ident" id="5656037">p</span><span class="op" id="5656038">.</span><span class="ident" id="5656039">Stride</span><span class="op" id="5656045">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5656049">Rect</span><span class="op" id="5656053">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5656057">r</span><span class="op" id="5656058">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5656061">}</span><br>
<span class="lineno">815</span><span class="op" id="5656063">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5656066">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5656139">func</span>&nbsp;<span class="op" id="5656144">(</span><span class="ident" id="5656145">p</span>&nbsp;<span class="op" id="5656147">*</span><span class="ident" id="5656148">Gray16</span><span class="op" id="5656154">)</span>&nbsp;<span class="ident" id="5656156">Opaque</span><span class="op" id="5656162">(</span><span class="op" id="5656163">)</span>&nbsp;<span class="builtintype" id="5656165">bool</span>&nbsp;<span class="op" id="5656170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5656173">return</span>&nbsp;<span class="builtintype" id="5656180">true</span><br>
<span class="lineno">820</span><span class="op" id="5656185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5656188">//&nbsp;NewGray16&nbsp;returns&nbsp;a&nbsp;new&nbsp;Gray16&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="5656245">func</span>&nbsp;<span class="ident" id="5656250">NewGray16</span><span class="op" id="5656259">(</span><span class="ident" id="5656260">r</span>&nbsp;<span class="ident" id="5656262">Rectangle</span><span class="op" id="5656271">)</span>&nbsp;<span class="op" id="5656273">*</span><span class="ident" id="5656274">Gray16</span>&nbsp;<span class="op" id="5656281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5656284">w</span><span class="op" id="5656285">,</span>&nbsp;<span class="ident" id="5656287">h</span>&nbsp;<span class="op" id="5656289">:=</span>&nbsp;<span class="ident" id="5656292">r</span><span class="op" id="5656293">.</span><span class="ident" id="5656294">Dx</span><span class="op" id="5656296">(</span><span class="op" id="5656297">)</span><span class="op" id="5656298">,</span>&nbsp;<span class="ident" id="5656300">r</span><span class="op" id="5656301">.</span><span class="ident" id="5656302">Dy</span><span class="op" id="5656304">(</span><span class="op" id="5656305">)</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5656308">pix</span>&nbsp;<span class="op" id="5656312">:=</span>&nbsp;<span class="builtinfunc" id="5656315">make</span><span class="op" id="5656319">(</span><span class="op" id="5656320">[</span><span class="op" id="5656321">]</span><span class="builtintype" id="5656322">uint8</span><span class="op" id="5656327">,</span>&nbsp;<span class="num" id="5656329">2</span><span class="op" id="5656330">*</span><span class="ident" id="5656331">w</span><span class="op" id="5656332">*</span><span class="ident" id="5656333">h</span><span class="op" id="5656334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5656337">return</span>&nbsp;<span class="op" id="5656344">&amp;</span><span class="ident" id="5656345">Gray16</span><span class="op" id="5656351">{</span><span class="ident" id="5656352">pix</span><span class="op" id="5656355">,</span>&nbsp;<span class="num" id="5656357">2</span>&nbsp;<span class="op" id="5656359">*</span>&nbsp;<span class="ident" id="5656361">w</span><span class="op" id="5656362">,</span>&nbsp;<span class="ident" id="5656364">r</span><span class="op" id="5656365">}</span><br>
<span class="lineno"></span><span class="op" id="5656367">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5656370">//&nbsp;Paletted&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;of&nbsp;uint8&nbsp;indices&nbsp;into&nbsp;a&nbsp;given&nbsp;palette.</span><br>
<span class="lineno">830</span><span class="keyword" id="5656443">type</span>&nbsp;<span class="ident" id="5656448">Paletted</span>&nbsp;<span class="keyword" id="5656457">struct</span>&nbsp;<span class="op" id="5656464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5656467">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;palette&nbsp;indices.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5656534">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*1].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5656602">Pix</span>&nbsp;<span class="op" id="5656606">[</span><span class="op" id="5656607">]</span><span class="builtintype" id="5656608">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5656615">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5656691">Stride</span>&nbsp;<span class="builtintype" id="5656698">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5656703">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5656735">Rect</span>&nbsp;<span class="ident" id="5656740">Rectangle</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5656751">//&nbsp;Palette&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5656787">Palette</span>&nbsp;<span class="ident" id="5656795">color</span><span class="op" id="5656800">.</span><span class="ident" id="5656801">Palette</span><br>
<span class="lineno">840</span><span class="op" id="5656809">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5656812">func</span>&nbsp;<span class="op" id="5656817">(</span><span class="ident" id="5656818">p</span>&nbsp;<span class="op" id="5656820">*</span><span class="ident" id="5656821">Paletted</span><span class="op" id="5656829">)</span>&nbsp;<span class="ident" id="5656831">ColorModel</span><span class="op" id="5656841">(</span><span class="op" id="5656842">)</span>&nbsp;<span class="ident" id="5656844">color</span><span class="op" id="5656849">.</span><span class="ident" id="5656850">Model</span>&nbsp;<span class="op" id="5656856">{</span>&nbsp;<span class="keyword" id="5656858">return</span>&nbsp;<span class="ident" id="5656865">p</span><span class="op" id="5656866">.</span><span class="ident" id="5656867">Palette</span>&nbsp;<span class="op" id="5656875">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5656878">func</span>&nbsp;<span class="op" id="5656883">(</span><span class="ident" id="5656884">p</span>&nbsp;<span class="op" id="5656886">*</span><span class="ident" id="5656887">Paletted</span><span class="op" id="5656895">)</span>&nbsp;<span class="ident" id="5656897">Bounds</span><span class="op" id="5656903">(</span><span class="op" id="5656904">)</span>&nbsp;<span class="ident" id="5656906">Rectangle</span>&nbsp;<span class="op" id="5656916">{</span>&nbsp;<span class="keyword" id="5656918">return</span>&nbsp;<span class="ident" id="5656925">p</span><span class="op" id="5656926">.</span><span class="ident" id="5656927">Rect</span>&nbsp;<span class="op" id="5656932">}</span><br>
<span class="lineno">845</span><br>
<span class="lineno"></span><span class="keyword" id="5656935">func</span>&nbsp;<span class="op" id="5656940">(</span><span class="ident" id="5656941">p</span>&nbsp;<span class="op" id="5656943">*</span><span class="ident" id="5656944">Paletted</span><span class="op" id="5656952">)</span>&nbsp;<span class="ident" id="5656954">At</span><span class="op" id="5656956">(</span><span class="ident" id="5656957">x</span><span class="op" id="5656958">,</span>&nbsp;<span class="ident" id="5656960">y</span>&nbsp;<span class="builtintype" id="5656962">int</span><span class="op" id="5656965">)</span>&nbsp;<span class="ident" id="5656967">color</span><span class="op" id="5656972">.</span><span class="ident" id="5656973">Color</span>&nbsp;<span class="op" id="5656979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5656982">if</span>&nbsp;<span class="builtinfunc" id="5656985">len</span><span class="op" id="5656988">(</span><span class="ident" id="5656989">p</span><span class="op" id="5656990">.</span><span class="ident" id="5656991">Palette</span><span class="op" id="5656998">)</span>&nbsp;<span class="op" id="5657000">==</span>&nbsp;<span class="num" id="5657003">0</span>&nbsp;<span class="op" id="5657005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5657009">return</span>&nbsp;<span class="builtintype" id="5657016">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5657021">}</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5657024">if</span>&nbsp;<span class="op" id="5657027">!</span><span class="op" id="5657028">(</span><span class="ident" id="5657029">Point</span><span class="op" id="5657034">{</span><span class="ident" id="5657035">x</span><span class="op" id="5657036">,</span>&nbsp;<span class="ident" id="5657038">y</span><span class="op" id="5657039">}</span><span class="op" id="5657040">.</span><span class="ident" id="5657041">In</span><span class="op" id="5657043">(</span><span class="ident" id="5657044">p</span><span class="op" id="5657045">.</span><span class="ident" id="5657046">Rect</span><span class="op" id="5657050">)</span><span class="op" id="5657051">)</span>&nbsp;<span class="op" id="5657053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5657057">return</span>&nbsp;<span class="ident" id="5657064">p</span><span class="op" id="5657065">.</span><span class="ident" id="5657066">Palette</span><span class="op" id="5657073">[</span><span class="num" id="5657074">0</span><span class="op" id="5657075">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5657078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5657081">i</span>&nbsp;<span class="op" id="5657083">:=</span>&nbsp;<span class="ident" id="5657086">p</span><span class="op" id="5657087">.</span><span class="ident" id="5657088">PixOffset</span><span class="op" id="5657097">(</span><span class="ident" id="5657098">x</span><span class="op" id="5657099">,</span>&nbsp;<span class="ident" id="5657101">y</span><span class="op" id="5657102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5657105">return</span>&nbsp;<span class="ident" id="5657112">p</span><span class="op" id="5657113">.</span><span class="ident" id="5657114">Palette</span><span class="op" id="5657121">[</span><span class="ident" id="5657122">p</span><span class="op" id="5657123">.</span><span class="ident" id="5657124">Pix</span><span class="op" id="5657127">[</span><span class="ident" id="5657128">i</span><span class="op" id="5657129">]</span><span class="op" id="5657130">]</span><br>
<span class="lineno">855</span><span class="op" id="5657132">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5657135">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5657214">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5657238">func</span>&nbsp;<span class="op" id="5657243">(</span><span class="ident" id="5657244">p</span>&nbsp;<span class="op" id="5657246">*</span><span class="ident" id="5657247">Paletted</span><span class="op" id="5657255">)</span>&nbsp;<span class="ident" id="5657257">PixOffset</span><span class="op" id="5657266">(</span><span class="ident" id="5657267">x</span><span class="op" id="5657268">,</span>&nbsp;<span class="ident" id="5657270">y</span>&nbsp;<span class="builtintype" id="5657272">int</span><span class="op" id="5657275">)</span>&nbsp;<span class="builtintype" id="5657277">int</span>&nbsp;<span class="op" id="5657281">{</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5657284">return</span>&nbsp;<span class="op" id="5657291">(</span><span class="ident" id="5657292">y</span><span class="op" id="5657293">-</span><span class="ident" id="5657294">p</span><span class="op" id="5657295">.</span><span class="ident" id="5657296">Rect</span><span class="op" id="5657300">.</span><span class="ident" id="5657301">Min</span><span class="op" id="5657304">.</span><span class="ident" id="5657305">Y</span><span class="op" id="5657306">)</span><span class="op" id="5657307">*</span><span class="ident" id="5657308">p</span><span class="op" id="5657309">.</span><span class="ident" id="5657310">Stride</span>&nbsp;<span class="op" id="5657317">+</span>&nbsp;<span class="op" id="5657319">(</span><span class="ident" id="5657320">x</span><span class="op" id="5657321">-</span><span class="ident" id="5657322">p</span><span class="op" id="5657323">.</span><span class="ident" id="5657324">Rect</span><span class="op" id="5657328">.</span><span class="ident" id="5657329">Min</span><span class="op" id="5657332">.</span><span class="ident" id="5657333">X</span><span class="op" id="5657334">)</span><span class="op" id="5657335">*</span><span class="num" id="5657336">1</span><br>
<span class="lineno"></span><span class="op" id="5657338">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5657341">func</span>&nbsp;<span class="op" id="5657346">(</span><span class="ident" id="5657347">p</span>&nbsp;<span class="op" id="5657349">*</span><span class="ident" id="5657350">Paletted</span><span class="op" id="5657358">)</span>&nbsp;<span class="ident" id="5657360">Set</span><span class="op" id="5657363">(</span><span class="ident" id="5657364">x</span><span class="op" id="5657365">,</span>&nbsp;<span class="ident" id="5657367">y</span>&nbsp;<span class="builtintype" id="5657369">int</span><span class="op" id="5657372">,</span>&nbsp;<span class="ident" id="5657374">c</span>&nbsp;<span class="ident" id="5657376">color</span><span class="op" id="5657381">.</span><span class="ident" id="5657382">Color</span><span class="op" id="5657387">)</span>&nbsp;<span class="op" id="5657389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5657392">if</span>&nbsp;<span class="op" id="5657395">!</span><span class="op" id="5657396">(</span><span class="ident" id="5657397">Point</span><span class="op" id="5657402">{</span><span class="ident" id="5657403">x</span><span class="op" id="5657404">,</span>&nbsp;<span class="ident" id="5657406">y</span><span class="op" id="5657407">}</span><span class="op" id="5657408">.</span><span class="ident" id="5657409">In</span><span class="op" id="5657411">(</span><span class="ident" id="5657412">p</span><span class="op" id="5657413">.</span><span class="ident" id="5657414">Rect</span><span class="op" id="5657418">)</span><span class="op" id="5657419">)</span>&nbsp;<span class="op" id="5657421">{</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5657425">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5657433">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5657436">i</span>&nbsp;<span class="op" id="5657438">:=</span>&nbsp;<span class="ident" id="5657441">p</span><span class="op" id="5657442">.</span><span class="ident" id="5657443">PixOffset</span><span class="op" id="5657452">(</span><span class="ident" id="5657453">x</span><span class="op" id="5657454">,</span>&nbsp;<span class="ident" id="5657456">y</span><span class="op" id="5657457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5657460">p</span><span class="op" id="5657461">.</span><span class="ident" id="5657462">Pix</span><span class="op" id="5657465">[</span><span class="ident" id="5657466">i</span><span class="op" id="5657467">]</span>&nbsp;<span class="op" id="5657469">=</span>&nbsp;<span class="builtintype" id="5657471">uint8</span><span class="op" id="5657476">(</span><span class="ident" id="5657477">p</span><span class="op" id="5657478">.</span><span class="ident" id="5657479">Palette</span><span class="op" id="5657486">.</span><span class="ident" id="5657487">Index</span><span class="op" id="5657492">(</span><span class="ident" id="5657493">c</span><span class="op" id="5657494">)</span><span class="op" id="5657495">)</span><br>
<span class="lineno"></span><span class="op" id="5657497">}</span><br>
<span class="lineno">870</span><br>
<span class="lineno"></span><span class="keyword" id="5657500">func</span>&nbsp;<span class="op" id="5657505">(</span><span class="ident" id="5657506">p</span>&nbsp;<span class="op" id="5657508">*</span><span class="ident" id="5657509">Paletted</span><span class="op" id="5657517">)</span>&nbsp;<span class="ident" id="5657519">ColorIndexAt</span><span class="op" id="5657531">(</span><span class="ident" id="5657532">x</span><span class="op" id="5657533">,</span>&nbsp;<span class="ident" id="5657535">y</span>&nbsp;<span class="builtintype" id="5657537">int</span><span class="op" id="5657540">)</span>&nbsp;<span class="builtintype" id="5657542">uint8</span>&nbsp;<span class="op" id="5657548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5657551">if</span>&nbsp;<span class="op" id="5657554">!</span><span class="op" id="5657555">(</span><span class="ident" id="5657556">Point</span><span class="op" id="5657561">{</span><span class="ident" id="5657562">x</span><span class="op" id="5657563">,</span>&nbsp;<span class="ident" id="5657565">y</span><span class="op" id="5657566">}</span><span class="op" id="5657567">.</span><span class="ident" id="5657568">In</span><span class="op" id="5657570">(</span><span class="ident" id="5657571">p</span><span class="op" id="5657572">.</span><span class="ident" id="5657573">Rect</span><span class="op" id="5657577">)</span><span class="op" id="5657578">)</span>&nbsp;<span class="op" id="5657580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5657584">return</span>&nbsp;<span class="num" id="5657591">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5657594">}</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5657597">i</span>&nbsp;<span class="op" id="5657599">:=</span>&nbsp;<span class="ident" id="5657602">p</span><span class="op" id="5657603">.</span><span class="ident" id="5657604">PixOffset</span><span class="op" id="5657613">(</span><span class="ident" id="5657614">x</span><span class="op" id="5657615">,</span>&nbsp;<span class="ident" id="5657617">y</span><span class="op" id="5657618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5657621">return</span>&nbsp;<span class="ident" id="5657628">p</span><span class="op" id="5657629">.</span><span class="ident" id="5657630">Pix</span><span class="op" id="5657633">[</span><span class="ident" id="5657634">i</span><span class="op" id="5657635">]</span><br>
<span class="lineno"></span><span class="op" id="5657637">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5657640">func</span>&nbsp;<span class="op" id="5657645">(</span><span class="ident" id="5657646">p</span>&nbsp;<span class="op" id="5657648">*</span><span class="ident" id="5657649">Paletted</span><span class="op" id="5657657">)</span>&nbsp;<span class="ident" id="5657659">SetColorIndex</span><span class="op" id="5657672">(</span><span class="ident" id="5657673">x</span><span class="op" id="5657674">,</span>&nbsp;<span class="ident" id="5657676">y</span>&nbsp;<span class="builtintype" id="5657678">int</span><span class="op" id="5657681">,</span>&nbsp;<span class="ident" id="5657683">index</span>&nbsp;<span class="builtintype" id="5657689">uint8</span><span class="op" id="5657694">)</span>&nbsp;<span class="op" id="5657696">{</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5657699">if</span>&nbsp;<span class="op" id="5657702">!</span><span class="op" id="5657703">(</span><span class="ident" id="5657704">Point</span><span class="op" id="5657709">{</span><span class="ident" id="5657710">x</span><span class="op" id="5657711">,</span>&nbsp;<span class="ident" id="5657713">y</span><span class="op" id="5657714">}</span><span class="op" id="5657715">.</span><span class="ident" id="5657716">In</span><span class="op" id="5657718">(</span><span class="ident" id="5657719">p</span><span class="op" id="5657720">.</span><span class="ident" id="5657721">Rect</span><span class="op" id="5657725">)</span><span class="op" id="5657726">)</span>&nbsp;<span class="op" id="5657728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5657732">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5657740">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5657743">i</span>&nbsp;<span class="op" id="5657745">:=</span>&nbsp;<span class="ident" id="5657748">p</span><span class="op" id="5657749">.</span><span class="ident" id="5657750">PixOffset</span><span class="op" id="5657759">(</span><span class="ident" id="5657760">x</span><span class="op" id="5657761">,</span>&nbsp;<span class="ident" id="5657763">y</span><span class="op" id="5657764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5657767">p</span><span class="op" id="5657768">.</span><span class="ident" id="5657769">Pix</span><span class="op" id="5657772">[</span><span class="ident" id="5657773">i</span><span class="op" id="5657774">]</span>&nbsp;<span class="op" id="5657776">=</span>&nbsp;<span class="ident" id="5657778">index</span><br>
<span class="lineno">885</span><span class="op" id="5657784">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5657787">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5657864">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5657936">func</span>&nbsp;<span class="op" id="5657941">(</span><span class="ident" id="5657942">p</span>&nbsp;<span class="op" id="5657944">*</span><span class="ident" id="5657945">Paletted</span><span class="op" id="5657953">)</span>&nbsp;<span class="ident" id="5657955">SubImage</span><span class="op" id="5657963">(</span><span class="ident" id="5657964">r</span>&nbsp;<span class="ident" id="5657966">Rectangle</span><span class="op" id="5657975">)</span>&nbsp;<span class="ident" id="5657977">Image</span>&nbsp;<span class="op" id="5657983">{</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5657986">r</span>&nbsp;<span class="op" id="5657988">=</span>&nbsp;<span class="ident" id="5657990">r</span><span class="op" id="5657991">.</span><span class="ident" id="5657992">Intersect</span><span class="op" id="5658001">(</span><span class="ident" id="5658002">p</span><span class="op" id="5658003">.</span><span class="ident" id="5658004">Rect</span><span class="op" id="5658008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5658011">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5658092">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5658174">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5658224">if</span>&nbsp;<span class="ident" id="5658227">r</span><span class="op" id="5658228">.</span><span class="ident" id="5658229">Empty</span><span class="op" id="5658234">(</span><span class="op" id="5658235">)</span>&nbsp;<span class="op" id="5658237">{</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5658241">return</span>&nbsp;<span class="op" id="5658248">&amp;</span><span class="ident" id="5658249">Paletted</span><span class="op" id="5658257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5658262">Palette</span><span class="op" id="5658269">:</span>&nbsp;<span class="ident" id="5658271">p</span><span class="op" id="5658272">.</span><span class="ident" id="5658273">Palette</span><span class="op" id="5658280">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5658284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5658287">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5658290">i</span>&nbsp;<span class="op" id="5658292">:=</span>&nbsp;<span class="ident" id="5658295">p</span><span class="op" id="5658296">.</span><span class="ident" id="5658297">PixOffset</span><span class="op" id="5658306">(</span><span class="ident" id="5658307">r</span><span class="op" id="5658308">.</span><span class="ident" id="5658309">Min</span><span class="op" id="5658312">.</span><span class="ident" id="5658313">X</span><span class="op" id="5658314">,</span>&nbsp;<span class="ident" id="5658316">r</span><span class="op" id="5658317">.</span><span class="ident" id="5658318">Min</span><span class="op" id="5658321">.</span><span class="ident" id="5658322">Y</span><span class="op" id="5658323">)</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5658326">return</span>&nbsp;<span class="op" id="5658333">&amp;</span><span class="ident" id="5658334">Paletted</span><span class="op" id="5658342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5658346">Pix</span><span class="op" id="5658349">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5658355">p</span><span class="op" id="5658356">.</span><span class="ident" id="5658357">Pix</span><span class="op" id="5658360">[</span><span class="ident" id="5658361">i</span><span class="op" id="5658362">:</span><span class="op" id="5658363">]</span><span class="op" id="5658364">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5658368">Stride</span><span class="op" id="5658374">:</span>&nbsp;&nbsp;<span class="ident" id="5658377">p</span><span class="op" id="5658378">.</span><span class="ident" id="5658379">Stride</span><span class="op" id="5658385">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5658389">Rect</span><span class="op" id="5658393">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5658398">p</span><span class="op" id="5658399">.</span><span class="ident" id="5658400">Rect</span><span class="op" id="5658404">.</span><span class="ident" id="5658405">Intersect</span><span class="op" id="5658414">(</span><span class="ident" id="5658415">r</span><span class="op" id="5658416">)</span><span class="op" id="5658417">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5658421">Palette</span><span class="op" id="5658428">:</span>&nbsp;<span class="ident" id="5658430">p</span><span class="op" id="5658431">.</span><span class="ident" id="5658432">Palette</span><span class="op" id="5658439">,</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5658442">}</span><br>
<span class="lineno"></span><span class="op" id="5658444">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5658447">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5658520">func</span>&nbsp;<span class="op" id="5658525">(</span><span class="ident" id="5658526">p</span>&nbsp;<span class="op" id="5658528">*</span><span class="ident" id="5658529">Paletted</span><span class="op" id="5658537">)</span>&nbsp;<span class="ident" id="5658539">Opaque</span><span class="op" id="5658545">(</span><span class="op" id="5658546">)</span>&nbsp;<span class="builtintype" id="5658548">bool</span>&nbsp;<span class="op" id="5658553">{</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5658556">var</span>&nbsp;<span class="ident" id="5658560">present</span>&nbsp;<span class="op" id="5658568">[</span><span class="num" id="5658569">256</span><span class="op" id="5658572">]</span><span class="builtintype" id="5658573">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5658579">i0</span><span class="op" id="5658581">,</span>&nbsp;<span class="ident" id="5658583">i1</span>&nbsp;<span class="op" id="5658586">:=</span>&nbsp;<span class="num" id="5658589">0</span><span class="op" id="5658590">,</span>&nbsp;<span class="ident" id="5658592">p</span><span class="op" id="5658593">.</span><span class="ident" id="5658594">Rect</span><span class="op" id="5658598">.</span><span class="ident" id="5658599">Dx</span><span class="op" id="5658601">(</span><span class="op" id="5658602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5658605">for</span>&nbsp;<span class="ident" id="5658609">y</span>&nbsp;<span class="op" id="5658611">:=</span>&nbsp;<span class="ident" id="5658614">p</span><span class="op" id="5658615">.</span><span class="ident" id="5658616">Rect</span><span class="op" id="5658620">.</span><span class="ident" id="5658621">Min</span><span class="op" id="5658624">.</span><span class="ident" id="5658625">Y</span><span class="op" id="5658626">;</span>&nbsp;<span class="ident" id="5658628">y</span>&nbsp;<span class="op" id="5658630">&lt;</span>&nbsp;<span class="ident" id="5658632">p</span><span class="op" id="5658633">.</span><span class="ident" id="5658634">Rect</span><span class="op" id="5658638">.</span><span class="ident" id="5658639">Max</span><span class="op" id="5658642">.</span><span class="ident" id="5658643">Y</span><span class="op" id="5658644">;</span>&nbsp;<span class="ident" id="5658646">y</span><span class="op" id="5658647">++</span>&nbsp;<span class="op" id="5658650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5658654">for</span>&nbsp;<span class="ident" id="5658658">_</span><span class="op" id="5658659">,</span>&nbsp;<span class="ident" id="5658661">c</span>&nbsp;<span class="op" id="5658663">:=</span>&nbsp;<span class="keyword" id="5658666">range</span>&nbsp;<span class="ident" id="5658672">p</span><span class="op" id="5658673">.</span><span class="ident" id="5658674">Pix</span><span class="op" id="5658677">[</span><span class="ident" id="5658678">i0</span><span class="op" id="5658680">:</span><span class="ident" id="5658681">i1</span><span class="op" id="5658683">]</span>&nbsp;<span class="op" id="5658685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5658690">present</span><span class="op" id="5658697">[</span><span class="ident" id="5658698">c</span><span class="op" id="5658699">]</span>&nbsp;<span class="op" id="5658701">=</span>&nbsp;<span class="builtintype" id="5658703">true</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5658710">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5658714">i0</span>&nbsp;<span class="op" id="5658717">+=</span>&nbsp;<span class="ident" id="5658720">p</span><span class="op" id="5658721">.</span><span class="ident" id="5658722">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5658731">i1</span>&nbsp;<span class="op" id="5658734">+=</span>&nbsp;<span class="ident" id="5658737">p</span><span class="op" id="5658738">.</span><span class="ident" id="5658739">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5658747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5658750">for</span>&nbsp;<span class="ident" id="5658754">i</span><span class="op" id="5658755">,</span>&nbsp;<span class="ident" id="5658757">c</span>&nbsp;<span class="op" id="5658759">:=</span>&nbsp;<span class="keyword" id="5658762">range</span>&nbsp;<span class="ident" id="5658768">p</span><span class="op" id="5658769">.</span><span class="ident" id="5658770">Palette</span>&nbsp;<span class="op" id="5658778">{</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5658782">if</span>&nbsp;<span class="op" id="5658785">!</span><span class="ident" id="5658786">present</span><span class="op" id="5658793">[</span><span class="ident" id="5658794">i</span><span class="op" id="5658795">]</span>&nbsp;<span class="op" id="5658797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5658802">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5658813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5658817">_</span><span class="op" id="5658818">,</span>&nbsp;<span class="ident" id="5658820">_</span><span class="op" id="5658821">,</span>&nbsp;<span class="ident" id="5658823">_</span><span class="op" id="5658824">,</span>&nbsp;<span class="ident" id="5658826">a</span>&nbsp;<span class="op" id="5658828">:=</span>&nbsp;<span class="ident" id="5658831">c</span><span class="op" id="5658832">.</span><span class="ident" id="5658833">RGBA</span><span class="op" id="5658837">(</span><span class="op" id="5658838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5658842">if</span>&nbsp;<span class="ident" id="5658845">a</span>&nbsp;<span class="op" id="5658847">!=</span>&nbsp;<span class="num" id="5658850">0xffff</span>&nbsp;<span class="op" id="5658857">{</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5658862">return</span>&nbsp;<span class="builtintype" id="5658869">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5658877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5658880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5658883">return</span>&nbsp;<span class="builtintype" id="5658890">true</span><br>
<span class="lineno"></span><span class="op" id="5658895">}</span><br>
<span class="lineno">930</span><br>
<span class="lineno"></span><span class="comment" id="5658898">//&nbsp;NewPaletted&nbsp;returns&nbsp;a&nbsp;new&nbsp;Paletted&nbsp;with&nbsp;the&nbsp;given&nbsp;width,&nbsp;height&nbsp;and&nbsp;palette.</span><br>
<span class="lineno"></span><span class="keyword" id="5658978">func</span>&nbsp;<span class="ident" id="5658983">NewPaletted</span><span class="op" id="5658994">(</span><span class="ident" id="5658995">r</span>&nbsp;<span class="ident" id="5658997">Rectangle</span><span class="op" id="5659006">,</span>&nbsp;<span class="ident" id="5659008">p</span>&nbsp;<span class="ident" id="5659010">color</span><span class="op" id="5659015">.</span><span class="ident" id="5659016">Palette</span><span class="op" id="5659023">)</span>&nbsp;<span class="op" id="5659025">*</span><span class="ident" id="5659026">Paletted</span>&nbsp;<span class="op" id="5659035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5659038">w</span><span class="op" id="5659039">,</span>&nbsp;<span class="ident" id="5659041">h</span>&nbsp;<span class="op" id="5659043">:=</span>&nbsp;<span class="ident" id="5659046">r</span><span class="op" id="5659047">.</span><span class="ident" id="5659048">Dx</span><span class="op" id="5659050">(</span><span class="op" id="5659051">)</span><span class="op" id="5659052">,</span>&nbsp;<span class="ident" id="5659054">r</span><span class="op" id="5659055">.</span><span class="ident" id="5659056">Dy</span><span class="op" id="5659058">(</span><span class="op" id="5659059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5659062">pix</span>&nbsp;<span class="op" id="5659066">:=</span>&nbsp;<span class="builtinfunc" id="5659069">make</span><span class="op" id="5659073">(</span><span class="op" id="5659074">[</span><span class="op" id="5659075">]</span><span class="builtintype" id="5659076">uint8</span><span class="op" id="5659081">,</span>&nbsp;<span class="num" id="5659083">1</span><span class="op" id="5659084">*</span><span class="ident" id="5659085">w</span><span class="op" id="5659086">*</span><span class="ident" id="5659087">h</span><span class="op" id="5659088">)</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5659091">return</span>&nbsp;<span class="op" id="5659098">&amp;</span><span class="ident" id="5659099">Paletted</span><span class="op" id="5659107">{</span><span class="ident" id="5659108">pix</span><span class="op" id="5659111">,</span>&nbsp;<span class="num" id="5659113">1</span>&nbsp;<span class="op" id="5659115">*</span>&nbsp;<span class="ident" id="5659117">w</span><span class="op" id="5659118">,</span>&nbsp;<span class="ident" id="5659120">r</span><span class="op" id="5659121">,</span>&nbsp;<span class="ident" id="5659123">p</span><span class="op" id="5659124">}</span><br>
<span class="lineno"></span><span class="op" id="5659126">}</span>
</div>
</body>
</html>
