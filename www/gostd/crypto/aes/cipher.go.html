<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/aes</h2>
<ul>
<li><a href="/gostd/crypto/aes/aes_test.go.html">aes_test.go</a></li>
<li><a href="/gostd/crypto/aes/block.go.html">block.go</a></li>
<li><a href="/gostd/crypto/aes/cipher.go.html" class="current">cipher.go</a></li>
<li><a href="/gostd/crypto/aes/cipher_asm.go.html">cipher_asm.go</a></li>
<li><a href="/gostd/crypto/aes/const.go.html">const.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3083954">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3084009">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3084063">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3084114">package</span>&nbsp;<span class="ident" id="3084122">aes</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3084127">import</span>&nbsp;<span class="op" id="3084134">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3084137">&#34;crypto/cipher&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3084154">&#34;strconv&#34;</span><br>
<span class="lineno">10</span><span class="op" id="3084164">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3084167">//&nbsp;The&nbsp;AES&nbsp;block&nbsp;size&nbsp;in&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="3084199">const</span>&nbsp;<span class="ident" id="3084205">BlockSize</span>&nbsp;<span class="op" id="3084215">=</span>&nbsp;<span class="num" id="3084217">16</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="3084221">//&nbsp;A&nbsp;cipher&nbsp;is&nbsp;an&nbsp;instance&nbsp;of&nbsp;AES&nbsp;encryption&nbsp;using&nbsp;a&nbsp;particular&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="3084290">type</span>&nbsp;<span class="ident" id="3084295">aesCipher</span>&nbsp;<span class="keyword" id="3084305">struct</span>&nbsp;<span class="op" id="3084312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3084315">enc</span>&nbsp;<span class="op" id="3084319">[</span><span class="op" id="3084320">]</span><span class="builtintype" id="3084321">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3084329">dec</span>&nbsp;<span class="op" id="3084333">[</span><span class="op" id="3084334">]</span><span class="builtintype" id="3084335">uint32</span><br>
<span class="lineno"></span><span class="op" id="3084342">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="3084345">type</span>&nbsp;<span class="ident" id="3084350">KeySizeError</span>&nbsp;<span class="builtintype" id="3084363">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3084368">func</span>&nbsp;<span class="op" id="3084373">(</span><span class="ident" id="3084374">k</span>&nbsp;<span class="ident" id="3084376">KeySizeError</span><span class="op" id="3084388">)</span>&nbsp;<span class="ident" id="3084390">Error</span><span class="op" id="3084395">(</span><span class="op" id="3084396">)</span>&nbsp;<span class="builtintype" id="3084398">string</span>&nbsp;<span class="op" id="3084405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3084408">return</span>&nbsp;<span class="string" id="3084415">&#34;crypto/aes:&nbsp;invalid&nbsp;key&nbsp;size&nbsp;&#34;</span>&nbsp;<span class="op" id="3084447">+</span>&nbsp;<span class="ident" id="3084449">strconv</span><span class="op" id="3084456">.</span><span class="ident" id="3084457">Itoa</span><span class="op" id="3084461">(</span><span class="builtintype" id="3084462">int</span><span class="op" id="3084465">(</span><span class="ident" id="3084466">k</span><span class="op" id="3084467">)</span><span class="op" id="3084468">)</span><br>
<span class="lineno">25</span><span class="op" id="3084470">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3084473">//&nbsp;NewCipher&nbsp;creates&nbsp;and&nbsp;returns&nbsp;a&nbsp;new&nbsp;cipher.Block.</span><br>
<span class="lineno"></span><span class="comment" id="3084526">//&nbsp;The&nbsp;key&nbsp;argument&nbsp;should&nbsp;be&nbsp;the&nbsp;AES&nbsp;key,</span><br>
<span class="lineno"></span><span class="comment" id="3084569">//&nbsp;either&nbsp;16,&nbsp;24,&nbsp;or&nbsp;32&nbsp;bytes&nbsp;to&nbsp;select</span><br>
<span class="lineno">30</span><span class="comment" id="3084609">//&nbsp;AES-128,&nbsp;AES-192,&nbsp;or&nbsp;AES-256.</span><br>
<span class="lineno"></span><span class="keyword" id="3084642">func</span>&nbsp;<span class="ident" id="3084647">NewCipher</span><span class="op" id="3084656">(</span><span class="ident" id="3084657">key</span>&nbsp;<span class="op" id="3084661">[</span><span class="op" id="3084662">]</span><span class="builtintype" id="3084663">byte</span><span class="op" id="3084667">)</span>&nbsp;<span class="op" id="3084669">(</span><span class="ident" id="3084670">cipher</span><span class="op" id="3084676">.</span><span class="ident" id="3084677">Block</span><span class="op" id="3084682">,</span>&nbsp;<span class="builtintype" id="3084684">error</span><span class="op" id="3084689">)</span>&nbsp;<span class="op" id="3084691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3084694">k</span>&nbsp;<span class="op" id="3084696">:=</span>&nbsp;<span class="builtinfunc" id="3084699">len</span><span class="op" id="3084702">(</span><span class="ident" id="3084703">key</span><span class="op" id="3084706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3084709">switch</span>&nbsp;<span class="ident" id="3084716">k</span>&nbsp;<span class="op" id="3084718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3084721">default</span><span class="op" id="3084728">:</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3084732">return</span>&nbsp;<span class="builtintype" id="3084739">nil</span><span class="op" id="3084742">,</span>&nbsp;<span class="ident" id="3084744">KeySizeError</span><span class="op" id="3084756">(</span><span class="ident" id="3084757">k</span><span class="op" id="3084758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3084761">case</span>&nbsp;<span class="num" id="3084766">16</span><span class="op" id="3084768">,</span>&nbsp;<span class="num" id="3084770">24</span><span class="op" id="3084772">,</span>&nbsp;<span class="num" id="3084774">32</span><span class="op" id="3084776">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3084780">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3084787">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3084791">n</span>&nbsp;<span class="op" id="3084793">:=</span>&nbsp;<span class="ident" id="3084796">k</span>&nbsp;<span class="op" id="3084798">+</span>&nbsp;<span class="num" id="3084800">28</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3084804">c</span>&nbsp;<span class="op" id="3084806">:=</span>&nbsp;<span class="op" id="3084809">&amp;</span><span class="ident" id="3084810">aesCipher</span><span class="op" id="3084819">{</span><span class="builtinfunc" id="3084820">make</span><span class="op" id="3084824">(</span><span class="op" id="3084825">[</span><span class="op" id="3084826">]</span><span class="builtintype" id="3084827">uint32</span><span class="op" id="3084833">,</span>&nbsp;<span class="ident" id="3084835">n</span><span class="op" id="3084836">)</span><span class="op" id="3084837">,</span>&nbsp;<span class="builtinfunc" id="3084839">make</span><span class="op" id="3084843">(</span><span class="op" id="3084844">[</span><span class="op" id="3084845">]</span><span class="builtintype" id="3084846">uint32</span><span class="op" id="3084852">,</span>&nbsp;<span class="ident" id="3084854">n</span><span class="op" id="3084855">)</span><span class="op" id="3084856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3084859">expandKey</span><span class="op" id="3084868">(</span><span class="ident" id="3084869">key</span><span class="op" id="3084872">,</span>&nbsp;<span class="ident" id="3084874">c</span><span class="op" id="3084875">.</span><span class="ident" id="3084876">enc</span><span class="op" id="3084879">,</span>&nbsp;<span class="ident" id="3084881">c</span><span class="op" id="3084882">.</span><span class="ident" id="3084883">dec</span><span class="op" id="3084886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3084889">return</span>&nbsp;<span class="ident" id="3084896">c</span><span class="op" id="3084897">,</span>&nbsp;<span class="builtintype" id="3084899">nil</span><br>
<span class="lineno"></span><span class="op" id="3084903">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="3084906">func</span>&nbsp;<span class="op" id="3084911">(</span><span class="ident" id="3084912">c</span>&nbsp;<span class="op" id="3084914">*</span><span class="ident" id="3084915">aesCipher</span><span class="op" id="3084924">)</span>&nbsp;<span class="ident" id="3084926">BlockSize</span><span class="op" id="3084935">(</span><span class="op" id="3084936">)</span>&nbsp;<span class="builtintype" id="3084938">int</span>&nbsp;<span class="op" id="3084942">{</span>&nbsp;<span class="keyword" id="3084944">return</span>&nbsp;<span class="ident" id="3084951">BlockSize</span>&nbsp;<span class="op" id="3084961">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3084964">func</span>&nbsp;<span class="op" id="3084969">(</span><span class="ident" id="3084970">c</span>&nbsp;<span class="op" id="3084972">*</span><span class="ident" id="3084973">aesCipher</span><span class="op" id="3084982">)</span>&nbsp;<span class="ident" id="3084984">Encrypt</span><span class="op" id="3084991">(</span><span class="ident" id="3084992">dst</span><span class="op" id="3084995">,</span>&nbsp;<span class="ident" id="3084997">src</span>&nbsp;<span class="op" id="3085001">[</span><span class="op" id="3085002">]</span><span class="builtintype" id="3085003">byte</span><span class="op" id="3085007">)</span>&nbsp;<span class="op" id="3085009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3085012">if</span>&nbsp;<span class="builtinfunc" id="3085015">len</span><span class="op" id="3085018">(</span><span class="ident" id="3085019">src</span><span class="op" id="3085022">)</span>&nbsp;<span class="op" id="3085024">&lt;</span>&nbsp;<span class="ident" id="3085026">BlockSize</span>&nbsp;<span class="op" id="3085036">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3085040">panic</span><span class="op" id="3085045">(</span><span class="string" id="3085046">&#34;crypto/aes:&nbsp;input&nbsp;not&nbsp;full&nbsp;block&#34;</span><span class="op" id="3085080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3085083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3085086">if</span>&nbsp;<span class="builtinfunc" id="3085089">len</span><span class="op" id="3085092">(</span><span class="ident" id="3085093">dst</span><span class="op" id="3085096">)</span>&nbsp;<span class="op" id="3085098">&lt;</span>&nbsp;<span class="ident" id="3085100">BlockSize</span>&nbsp;<span class="op" id="3085110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3085114">panic</span><span class="op" id="3085119">(</span><span class="string" id="3085120">&#34;crypto/aes:&nbsp;output&nbsp;not&nbsp;full&nbsp;block&#34;</span><span class="op" id="3085155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3085158">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3085161">encryptBlock</span><span class="op" id="3085173">(</span><span class="ident" id="3085174">c</span><span class="op" id="3085175">.</span><span class="ident" id="3085176">enc</span><span class="op" id="3085179">,</span>&nbsp;<span class="ident" id="3085181">dst</span><span class="op" id="3085184">,</span>&nbsp;<span class="ident" id="3085186">src</span><span class="op" id="3085189">)</span><br>
<span class="lineno"></span><span class="op" id="3085191">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3085194">func</span>&nbsp;<span class="op" id="3085199">(</span><span class="ident" id="3085200">c</span>&nbsp;<span class="op" id="3085202">*</span><span class="ident" id="3085203">aesCipher</span><span class="op" id="3085212">)</span>&nbsp;<span class="ident" id="3085214">Decrypt</span><span class="op" id="3085221">(</span><span class="ident" id="3085222">dst</span><span class="op" id="3085225">,</span>&nbsp;<span class="ident" id="3085227">src</span>&nbsp;<span class="op" id="3085231">[</span><span class="op" id="3085232">]</span><span class="builtintype" id="3085233">byte</span><span class="op" id="3085237">)</span>&nbsp;<span class="op" id="3085239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3085242">if</span>&nbsp;<span class="builtinfunc" id="3085245">len</span><span class="op" id="3085248">(</span><span class="ident" id="3085249">src</span><span class="op" id="3085252">)</span>&nbsp;<span class="op" id="3085254">&lt;</span>&nbsp;<span class="ident" id="3085256">BlockSize</span>&nbsp;<span class="op" id="3085266">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3085270">panic</span><span class="op" id="3085275">(</span><span class="string" id="3085276">&#34;crypto/aes:&nbsp;input&nbsp;not&nbsp;full&nbsp;block&#34;</span><span class="op" id="3085310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3085313">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3085316">if</span>&nbsp;<span class="builtinfunc" id="3085319">len</span><span class="op" id="3085322">(</span><span class="ident" id="3085323">dst</span><span class="op" id="3085326">)</span>&nbsp;<span class="op" id="3085328">&lt;</span>&nbsp;<span class="ident" id="3085330">BlockSize</span>&nbsp;<span class="op" id="3085340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3085344">panic</span><span class="op" id="3085349">(</span><span class="string" id="3085350">&#34;crypto/aes:&nbsp;output&nbsp;not&nbsp;full&nbsp;block&#34;</span><span class="op" id="3085385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3085388">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3085391">decryptBlock</span><span class="op" id="3085403">(</span><span class="ident" id="3085404">c</span><span class="op" id="3085405">.</span><span class="ident" id="3085406">dec</span><span class="op" id="3085409">,</span>&nbsp;<span class="ident" id="3085411">dst</span><span class="op" id="3085414">,</span>&nbsp;<span class="ident" id="3085416">src</span><span class="op" id="3085419">)</span><br>
<span class="lineno"></span><span class="op" id="3085421">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
