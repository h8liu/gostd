<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image</h2>
<ul>
<li><a href="/gostd/image/decode_example_test.go.html">decode_example_test.go</a></li>
<li><a href="/gostd/image/decode_test.go.html">decode_test.go</a></li>
<li><a href="/gostd/image/format.go.html">format.go</a></li>
<li><a href="/gostd/image/geom.go.html">geom.go</a></li>
<li><a href="/gostd/image/image.go.html" class="current">image.go</a></li>
<li><a href="/gostd/image/image_test.go.html">image_test.go</a></li>
<li><a href="/gostd/image/names.go.html">names.go</a></li>
<li><a href="/gostd/image/ycbcr.go.html">ycbcr.go</a></li>
<li><a href="/gostd/image/ycbcr_test.go.html">ycbcr_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5511953">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5512008">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5512062">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5512113">//&nbsp;Package&nbsp;image&nbsp;implements&nbsp;a&nbsp;basic&nbsp;2-D&nbsp;image&nbsp;library.</span><br>
<span class="lineno"></span><span class="comment" id="5512168">//</span><br>
<span class="lineno"></span><span class="comment" id="5512171">//&nbsp;The&nbsp;fundamental&nbsp;interface&nbsp;is&nbsp;called&nbsp;Image.&nbsp;An&nbsp;Image&nbsp;contains&nbsp;colors,&nbsp;which</span><br>
<span class="lineno"></span><span class="comment" id="5512249">//&nbsp;are&nbsp;described&nbsp;in&nbsp;the&nbsp;image/color&nbsp;package.</span><br>
<span class="lineno"></span><span class="comment" id="5512294">//</span><br>
<span class="lineno">10</span><span class="comment" id="5512297">//&nbsp;Values&nbsp;of&nbsp;the&nbsp;Image&nbsp;interface&nbsp;are&nbsp;created&nbsp;either&nbsp;by&nbsp;calling&nbsp;functions&nbsp;such</span><br>
<span class="lineno"></span><span class="comment" id="5512375">//&nbsp;as&nbsp;NewRGBA&nbsp;and&nbsp;NewPaletted,&nbsp;or&nbsp;by&nbsp;calling&nbsp;Decode&nbsp;on&nbsp;an&nbsp;io.Reader&nbsp;containing</span><br>
<span class="lineno"></span><span class="comment" id="5512454">//&nbsp;image&nbsp;data&nbsp;in&nbsp;a&nbsp;format&nbsp;such&nbsp;as&nbsp;GIF,&nbsp;JPEG&nbsp;or&nbsp;PNG.&nbsp;Decoding&nbsp;any&nbsp;particular</span><br>
<span class="lineno"></span><span class="comment" id="5512530">//&nbsp;image&nbsp;format&nbsp;requires&nbsp;the&nbsp;prior&nbsp;registration&nbsp;of&nbsp;a&nbsp;decoder&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="5512601">//&nbsp;Registration&nbsp;is&nbsp;typically&nbsp;automatic&nbsp;as&nbsp;a&nbsp;side&nbsp;effect&nbsp;of&nbsp;initializing&nbsp;that</span><br>
<span class="lineno">15</span><span class="comment" id="5512678">//&nbsp;format&#39;s&nbsp;package&nbsp;so&nbsp;that,&nbsp;to&nbsp;decode&nbsp;a&nbsp;PNG&nbsp;image,&nbsp;it&nbsp;suffices&nbsp;to&nbsp;have</span><br>
<span class="lineno"></span><span class="comment" id="5512750">//&nbsp;&nbsp;&nbsp;&nbspimport&nbsp;_&nbsp;&#34;image/png&#34;</span><br>
<span class="lineno"></span><span class="comment" id="5512774">//&nbsp;in&nbsp;a&nbsp;program&#39;s&nbsp;main&nbsp;package.&nbsp;The&nbsp;_&nbsp;means&nbsp;to&nbsp;import&nbsp;a&nbsp;package&nbsp;purely&nbsp;for&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="5512853">//&nbsp;initialization&nbsp;side&nbsp;effects.</span><br>
<span class="lineno"></span><span class="comment" id="5512885">//</span><br>
<span class="lineno">20</span><span class="comment" id="5512888">//&nbsp;See&nbsp;&#34;The&nbsp;Go&nbsp;image&nbsp;package&#34;&nbsp;for&nbsp;more&nbsp;details:</span><br>
<span class="lineno"></span><span class="comment" id="5512936">//&nbsp;http://golang.org/doc/articles/image_package.html</span><br>
<span class="lineno"></span><span class="keyword" id="5512989">package</span>&nbsp;<span class="ident" id="5512997">image</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5513004">import</span>&nbsp;<span class="op" id="5513011">(</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5513014">&#34;image/color&#34;</span><br>
<span class="lineno"></span><span class="op" id="5513028">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5513031">//&nbsp;Config&nbsp;holds&nbsp;an&nbsp;image&#39;s&nbsp;color&nbsp;model&nbsp;and&nbsp;dimensions.</span><br>
<span class="lineno"></span><span class="keyword" id="5513086">type</span>&nbsp;<span class="ident" id="5513091">Config</span>&nbsp;<span class="keyword" id="5513098">struct</span>&nbsp;<span class="op" id="5513105">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5513108">ColorModel</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5513122">color</span><span class="op" id="5513127">.</span><span class="ident" id="5513128">Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5513135">Width</span><span class="op" id="5513140">,</span>&nbsp;<span class="ident" id="5513142">Height</span>&nbsp;<span class="builtintype" id="5513149">int</span><br>
<span class="lineno"></span><span class="op" id="5513153">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5513156">//&nbsp;Image&nbsp;is&nbsp;a&nbsp;finite&nbsp;rectangular&nbsp;grid&nbsp;of&nbsp;color.Color&nbsp;values&nbsp;taken&nbsp;from&nbsp;a&nbsp;color</span><br>
<span class="lineno">35</span><span class="comment" id="5513235">//&nbsp;model.</span><br>
<span class="lineno"></span><span class="keyword" id="5513245">type</span>&nbsp;<span class="ident" id="5513250">Image</span>&nbsp;<span class="keyword" id="5513256">interface</span>&nbsp;<span class="op" id="5513266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5513269">//&nbsp;ColorModel&nbsp;returns&nbsp;the&nbsp;Image&#39;s&nbsp;color&nbsp;model.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5513317">ColorModel</span><span class="op" id="5513327">(</span><span class="op" id="5513328">)</span>&nbsp;<span class="ident" id="5513330">color</span><span class="op" id="5513335">.</span><span class="ident" id="5513336">Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5513343">//&nbsp;Bounds&nbsp;returns&nbsp;the&nbsp;domain&nbsp;for&nbsp;which&nbsp;At&nbsp;can&nbsp;return&nbsp;non-zero&nbsp;color.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5513413">//&nbsp;The&nbsp;bounds&nbsp;do&nbsp;not&nbsp;necessarily&nbsp;contain&nbsp;the&nbsp;point&nbsp;(0,&nbsp;0).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5513473">Bounds</span><span class="op" id="5513479">(</span><span class="op" id="5513480">)</span>&nbsp;<span class="ident" id="5513482">Rectangle</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5513493">//&nbsp;At&nbsp;returns&nbsp;the&nbsp;color&nbsp;of&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5513542">//&nbsp;At(Bounds().Min.X,&nbsp;Bounds().Min.Y)&nbsp;returns&nbsp;the&nbsp;upper-left&nbsp;pixel&nbsp;of&nbsp;the&nbsp;grid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5513623">//&nbsp;At(Bounds().Max.X-1,&nbsp;Bounds().Max.Y-1)&nbsp;returns&nbsp;the&nbsp;lower-right&nbsp;one.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5513695">At</span><span class="op" id="5513697">(</span><span class="ident" id="5513698">x</span><span class="op" id="5513699">,</span>&nbsp;<span class="ident" id="5513701">y</span>&nbsp;<span class="builtintype" id="5513703">int</span><span class="op" id="5513706">)</span>&nbsp;<span class="ident" id="5513708">color</span><span class="op" id="5513713">.</span><span class="ident" id="5513714">Color</span><br>
<span class="lineno"></span><span class="op" id="5513720">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5513723">//&nbsp;PalettedImage&nbsp;is&nbsp;an&nbsp;image&nbsp;whose&nbsp;colors&nbsp;may&nbsp;come&nbsp;from&nbsp;a&nbsp;limited&nbsp;palette.</span><br>
<span class="lineno"></span><span class="comment" id="5513798">//&nbsp;If&nbsp;m&nbsp;is&nbsp;a&nbsp;PalettedImage&nbsp;and&nbsp;m.ColorModel()&nbsp;returns&nbsp;a&nbsp;PalettedColorModel&nbsp;p,</span><br>
<span class="lineno">50</span><span class="comment" id="5513876">//&nbsp;then&nbsp;m.At(x,&nbsp;y)&nbsp;should&nbsp;be&nbsp;equivalent&nbsp;to&nbsp;p[m.ColorIndexAt(x,&nbsp;y)].&nbsp;If&nbsp;m&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="5513951">//&nbsp;color&nbsp;model&nbsp;is&nbsp;not&nbsp;a&nbsp;PalettedColorModel,&nbsp;then&nbsp;ColorIndexAt&#39;s&nbsp;behavior&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5514027">//&nbsp;undefined.</span><br>
<span class="lineno"></span><span class="keyword" id="5514041">type</span>&nbsp;<span class="ident" id="5514046">PalettedImage</span>&nbsp;<span class="keyword" id="5514060">interface</span>&nbsp;<span class="op" id="5514070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5514073">//&nbsp;ColorIndexAt&nbsp;returns&nbsp;the&nbsp;palette&nbsp;index&nbsp;of&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5514140">ColorIndexAt</span><span class="op" id="5514152">(</span><span class="ident" id="5514153">x</span><span class="op" id="5514154">,</span>&nbsp;<span class="ident" id="5514156">y</span>&nbsp;<span class="builtintype" id="5514158">int</span><span class="op" id="5514161">)</span>&nbsp;<span class="builtintype" id="5514163">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5514170">Image</span><br>
<span class="lineno"></span><span class="op" id="5514176">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5514179">//&nbsp;RGBA&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.RGBA&nbsp;values.</span><br>
<span class="lineno">60</span><span class="keyword" id="5514252">type</span>&nbsp;<span class="ident" id="5514257">RGBA</span>&nbsp;<span class="keyword" id="5514262">struct</span>&nbsp;<span class="op" id="5514269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5514272">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;in&nbsp;R,&nbsp;G,&nbsp;B,&nbsp;A&nbsp;order.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5514340">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*4].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5514408">Pix</span>&nbsp;<span class="op" id="5514412">[</span><span class="op" id="5514413">]</span><span class="builtintype" id="5514414">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5514421">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5514497">Stride</span>&nbsp;<span class="builtintype" id="5514504">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5514509">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5514541">Rect</span>&nbsp;<span class="ident" id="5514546">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="5514556">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="5514559">func</span>&nbsp;<span class="op" id="5514564">(</span><span class="ident" id="5514565">p</span>&nbsp;<span class="op" id="5514567">*</span><span class="ident" id="5514568">RGBA</span><span class="op" id="5514572">)</span>&nbsp;<span class="ident" id="5514574">ColorModel</span><span class="op" id="5514584">(</span><span class="op" id="5514585">)</span>&nbsp;<span class="ident" id="5514587">color</span><span class="op" id="5514592">.</span><span class="ident" id="5514593">Model</span>&nbsp;<span class="op" id="5514599">{</span>&nbsp;<span class="keyword" id="5514601">return</span>&nbsp;<span class="ident" id="5514608">color</span><span class="op" id="5514613">.</span><span class="ident" id="5514614">RGBAModel</span>&nbsp;<span class="op" id="5514624">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5514627">func</span>&nbsp;<span class="op" id="5514632">(</span><span class="ident" id="5514633">p</span>&nbsp;<span class="op" id="5514635">*</span><span class="ident" id="5514636">RGBA</span><span class="op" id="5514640">)</span>&nbsp;<span class="ident" id="5514642">Bounds</span><span class="op" id="5514648">(</span><span class="op" id="5514649">)</span>&nbsp;<span class="ident" id="5514651">Rectangle</span>&nbsp;<span class="op" id="5514661">{</span>&nbsp;<span class="keyword" id="5514663">return</span>&nbsp;<span class="ident" id="5514670">p</span><span class="op" id="5514671">.</span><span class="ident" id="5514672">Rect</span>&nbsp;<span class="op" id="5514677">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5514680">func</span>&nbsp;<span class="op" id="5514685">(</span><span class="ident" id="5514686">p</span>&nbsp;<span class="op" id="5514688">*</span><span class="ident" id="5514689">RGBA</span><span class="op" id="5514693">)</span>&nbsp;<span class="ident" id="5514695">At</span><span class="op" id="5514697">(</span><span class="ident" id="5514698">x</span><span class="op" id="5514699">,</span>&nbsp;<span class="ident" id="5514701">y</span>&nbsp;<span class="builtintype" id="5514703">int</span><span class="op" id="5514706">)</span>&nbsp;<span class="ident" id="5514708">color</span><span class="op" id="5514713">.</span><span class="ident" id="5514714">Color</span>&nbsp;<span class="op" id="5514720">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5514723">return</span>&nbsp;<span class="ident" id="5514730">p</span><span class="op" id="5514731">.</span><span class="ident" id="5514732">RGBAAt</span><span class="op" id="5514738">(</span><span class="ident" id="5514739">x</span><span class="op" id="5514740">,</span>&nbsp;<span class="ident" id="5514742">y</span><span class="op" id="5514743">)</span><br>
<span class="lineno"></span><span class="op" id="5514745">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5514748">func</span>&nbsp;<span class="op" id="5514753">(</span><span class="ident" id="5514754">p</span>&nbsp;<span class="op" id="5514756">*</span><span class="ident" id="5514757">RGBA</span><span class="op" id="5514761">)</span>&nbsp;<span class="ident" id="5514763">RGBAAt</span><span class="op" id="5514769">(</span><span class="ident" id="5514770">x</span><span class="op" id="5514771">,</span>&nbsp;<span class="ident" id="5514773">y</span>&nbsp;<span class="builtintype" id="5514775">int</span><span class="op" id="5514778">)</span>&nbsp;<span class="ident" id="5514780">color</span><span class="op" id="5514785">.</span><span class="ident" id="5514786">RGBA</span>&nbsp;<span class="op" id="5514791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5514794">if</span>&nbsp;<span class="op" id="5514797">!</span><span class="op" id="5514798">(</span><span class="ident" id="5514799">Point</span><span class="op" id="5514804">{</span><span class="ident" id="5514805">x</span><span class="op" id="5514806">,</span>&nbsp;<span class="ident" id="5514808">y</span><span class="op" id="5514809">}</span><span class="op" id="5514810">.</span><span class="ident" id="5514811">In</span><span class="op" id="5514813">(</span><span class="ident" id="5514814">p</span><span class="op" id="5514815">.</span><span class="ident" id="5514816">Rect</span><span class="op" id="5514820">)</span><span class="op" id="5514821">)</span>&nbsp;<span class="op" id="5514823">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5514827">return</span>&nbsp;<span class="ident" id="5514834">color</span><span class="op" id="5514839">.</span><span class="ident" id="5514840">RGBA</span><span class="op" id="5514844">{</span><span class="op" id="5514845">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5514848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5514851">i</span>&nbsp;<span class="op" id="5514853">:=</span>&nbsp;<span class="ident" id="5514856">p</span><span class="op" id="5514857">.</span><span class="ident" id="5514858">PixOffset</span><span class="op" id="5514867">(</span><span class="ident" id="5514868">x</span><span class="op" id="5514869">,</span>&nbsp;<span class="ident" id="5514871">y</span><span class="op" id="5514872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5514875">return</span>&nbsp;<span class="ident" id="5514882">color</span><span class="op" id="5514887">.</span><span class="ident" id="5514888">RGBA</span><span class="op" id="5514892">{</span><span class="ident" id="5514893">p</span><span class="op" id="5514894">.</span><span class="ident" id="5514895">Pix</span><span class="op" id="5514898">[</span><span class="ident" id="5514899">i</span><span class="op" id="5514900">+</span><span class="num" id="5514901">0</span><span class="op" id="5514902">]</span><span class="op" id="5514903">,</span>&nbsp;<span class="ident" id="5514905">p</span><span class="op" id="5514906">.</span><span class="ident" id="5514907">Pix</span><span class="op" id="5514910">[</span><span class="ident" id="5514911">i</span><span class="op" id="5514912">+</span><span class="num" id="5514913">1</span><span class="op" id="5514914">]</span><span class="op" id="5514915">,</span>&nbsp;<span class="ident" id="5514917">p</span><span class="op" id="5514918">.</span><span class="ident" id="5514919">Pix</span><span class="op" id="5514922">[</span><span class="ident" id="5514923">i</span><span class="op" id="5514924">+</span><span class="num" id="5514925">2</span><span class="op" id="5514926">]</span><span class="op" id="5514927">,</span>&nbsp;<span class="ident" id="5514929">p</span><span class="op" id="5514930">.</span><span class="ident" id="5514931">Pix</span><span class="op" id="5514934">[</span><span class="ident" id="5514935">i</span><span class="op" id="5514936">+</span><span class="num" id="5514937">3</span><span class="op" id="5514938">]</span><span class="op" id="5514939">}</span><br>
<span class="lineno"></span><span class="op" id="5514941">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="5514944">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5515023">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5515047">func</span>&nbsp;<span class="op" id="5515052">(</span><span class="ident" id="5515053">p</span>&nbsp;<span class="op" id="5515055">*</span><span class="ident" id="5515056">RGBA</span><span class="op" id="5515060">)</span>&nbsp;<span class="ident" id="5515062">PixOffset</span><span class="op" id="5515071">(</span><span class="ident" id="5515072">x</span><span class="op" id="5515073">,</span>&nbsp;<span class="ident" id="5515075">y</span>&nbsp;<span class="builtintype" id="5515077">int</span><span class="op" id="5515080">)</span>&nbsp;<span class="builtintype" id="5515082">int</span>&nbsp;<span class="op" id="5515086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5515089">return</span>&nbsp;<span class="op" id="5515096">(</span><span class="ident" id="5515097">y</span><span class="op" id="5515098">-</span><span class="ident" id="5515099">p</span><span class="op" id="5515100">.</span><span class="ident" id="5515101">Rect</span><span class="op" id="5515105">.</span><span class="ident" id="5515106">Min</span><span class="op" id="5515109">.</span><span class="ident" id="5515110">Y</span><span class="op" id="5515111">)</span><span class="op" id="5515112">*</span><span class="ident" id="5515113">p</span><span class="op" id="5515114">.</span><span class="ident" id="5515115">Stride</span>&nbsp;<span class="op" id="5515122">+</span>&nbsp;<span class="op" id="5515124">(</span><span class="ident" id="5515125">x</span><span class="op" id="5515126">-</span><span class="ident" id="5515127">p</span><span class="op" id="5515128">.</span><span class="ident" id="5515129">Rect</span><span class="op" id="5515133">.</span><span class="ident" id="5515134">Min</span><span class="op" id="5515137">.</span><span class="ident" id="5515138">X</span><span class="op" id="5515139">)</span><span class="op" id="5515140">*</span><span class="num" id="5515141">4</span><br>
<span class="lineno">90</span><span class="op" id="5515143">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5515146">func</span>&nbsp;<span class="op" id="5515151">(</span><span class="ident" id="5515152">p</span>&nbsp;<span class="op" id="5515154">*</span><span class="ident" id="5515155">RGBA</span><span class="op" id="5515159">)</span>&nbsp;<span class="ident" id="5515161">Set</span><span class="op" id="5515164">(</span><span class="ident" id="5515165">x</span><span class="op" id="5515166">,</span>&nbsp;<span class="ident" id="5515168">y</span>&nbsp;<span class="builtintype" id="5515170">int</span><span class="op" id="5515173">,</span>&nbsp;<span class="ident" id="5515175">c</span>&nbsp;<span class="ident" id="5515177">color</span><span class="op" id="5515182">.</span><span class="ident" id="5515183">Color</span><span class="op" id="5515188">)</span>&nbsp;<span class="op" id="5515190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5515193">if</span>&nbsp;<span class="op" id="5515196">!</span><span class="op" id="5515197">(</span><span class="ident" id="5515198">Point</span><span class="op" id="5515203">{</span><span class="ident" id="5515204">x</span><span class="op" id="5515205">,</span>&nbsp;<span class="ident" id="5515207">y</span><span class="op" id="5515208">}</span><span class="op" id="5515209">.</span><span class="ident" id="5515210">In</span><span class="op" id="5515212">(</span><span class="ident" id="5515213">p</span><span class="op" id="5515214">.</span><span class="ident" id="5515215">Rect</span><span class="op" id="5515219">)</span><span class="op" id="5515220">)</span>&nbsp;<span class="op" id="5515222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5515226">return</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5515234">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5515237">i</span>&nbsp;<span class="op" id="5515239">:=</span>&nbsp;<span class="ident" id="5515242">p</span><span class="op" id="5515243">.</span><span class="ident" id="5515244">PixOffset</span><span class="op" id="5515253">(</span><span class="ident" id="5515254">x</span><span class="op" id="5515255">,</span>&nbsp;<span class="ident" id="5515257">y</span><span class="op" id="5515258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5515261">c1</span>&nbsp;<span class="op" id="5515264">:=</span>&nbsp;<span class="ident" id="5515267">color</span><span class="op" id="5515272">.</span><span class="ident" id="5515273">RGBAModel</span><span class="op" id="5515282">.</span><span class="ident" id="5515283">Convert</span><span class="op" id="5515290">(</span><span class="ident" id="5515291">c</span><span class="op" id="5515292">)</span><span class="op" id="5515293">.</span><span class="op" id="5515294">(</span><span class="ident" id="5515295">color</span><span class="op" id="5515300">.</span><span class="ident" id="5515301">RGBA</span><span class="op" id="5515305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5515308">p</span><span class="op" id="5515309">.</span><span class="ident" id="5515310">Pix</span><span class="op" id="5515313">[</span><span class="ident" id="5515314">i</span><span class="op" id="5515315">+</span><span class="num" id="5515316">0</span><span class="op" id="5515317">]</span>&nbsp;<span class="op" id="5515319">=</span>&nbsp;<span class="ident" id="5515321">c1</span><span class="op" id="5515323">.</span><span class="ident" id="5515324">R</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5515327">p</span><span class="op" id="5515328">.</span><span class="ident" id="5515329">Pix</span><span class="op" id="5515332">[</span><span class="ident" id="5515333">i</span><span class="op" id="5515334">+</span><span class="num" id="5515335">1</span><span class="op" id="5515336">]</span>&nbsp;<span class="op" id="5515338">=</span>&nbsp;<span class="ident" id="5515340">c1</span><span class="op" id="5515342">.</span><span class="ident" id="5515343">G</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5515346">p</span><span class="op" id="5515347">.</span><span class="ident" id="5515348">Pix</span><span class="op" id="5515351">[</span><span class="ident" id="5515352">i</span><span class="op" id="5515353">+</span><span class="num" id="5515354">2</span><span class="op" id="5515355">]</span>&nbsp;<span class="op" id="5515357">=</span>&nbsp;<span class="ident" id="5515359">c1</span><span class="op" id="5515361">.</span><span class="ident" id="5515362">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5515365">p</span><span class="op" id="5515366">.</span><span class="ident" id="5515367">Pix</span><span class="op" id="5515370">[</span><span class="ident" id="5515371">i</span><span class="op" id="5515372">+</span><span class="num" id="5515373">3</span><span class="op" id="5515374">]</span>&nbsp;<span class="op" id="5515376">=</span>&nbsp;<span class="ident" id="5515378">c1</span><span class="op" id="5515380">.</span><span class="ident" id="5515381">A</span><br>
<span class="lineno"></span><span class="op" id="5515383">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5515386">func</span>&nbsp;<span class="op" id="5515391">(</span><span class="ident" id="5515392">p</span>&nbsp;<span class="op" id="5515394">*</span><span class="ident" id="5515395">RGBA</span><span class="op" id="5515399">)</span>&nbsp;<span class="ident" id="5515401">SetRGBA</span><span class="op" id="5515408">(</span><span class="ident" id="5515409">x</span><span class="op" id="5515410">,</span>&nbsp;<span class="ident" id="5515412">y</span>&nbsp;<span class="builtintype" id="5515414">int</span><span class="op" id="5515417">,</span>&nbsp;<span class="ident" id="5515419">c</span>&nbsp;<span class="ident" id="5515421">color</span><span class="op" id="5515426">.</span><span class="ident" id="5515427">RGBA</span><span class="op" id="5515431">)</span>&nbsp;<span class="op" id="5515433">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5515436">if</span>&nbsp;<span class="op" id="5515439">!</span><span class="op" id="5515440">(</span><span class="ident" id="5515441">Point</span><span class="op" id="5515446">{</span><span class="ident" id="5515447">x</span><span class="op" id="5515448">,</span>&nbsp;<span class="ident" id="5515450">y</span><span class="op" id="5515451">}</span><span class="op" id="5515452">.</span><span class="ident" id="5515453">In</span><span class="op" id="5515455">(</span><span class="ident" id="5515456">p</span><span class="op" id="5515457">.</span><span class="ident" id="5515458">Rect</span><span class="op" id="5515462">)</span><span class="op" id="5515463">)</span>&nbsp;<span class="op" id="5515465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5515469">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5515477">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5515480">i</span>&nbsp;<span class="op" id="5515482">:=</span>&nbsp;<span class="ident" id="5515485">p</span><span class="op" id="5515486">.</span><span class="ident" id="5515487">PixOffset</span><span class="op" id="5515496">(</span><span class="ident" id="5515497">x</span><span class="op" id="5515498">,</span>&nbsp;<span class="ident" id="5515500">y</span><span class="op" id="5515501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5515504">p</span><span class="op" id="5515505">.</span><span class="ident" id="5515506">Pix</span><span class="op" id="5515509">[</span><span class="ident" id="5515510">i</span><span class="op" id="5515511">+</span><span class="num" id="5515512">0</span><span class="op" id="5515513">]</span>&nbsp;<span class="op" id="5515515">=</span>&nbsp;<span class="ident" id="5515517">c</span><span class="op" id="5515518">.</span><span class="ident" id="5515519">R</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5515522">p</span><span class="op" id="5515523">.</span><span class="ident" id="5515524">Pix</span><span class="op" id="5515527">[</span><span class="ident" id="5515528">i</span><span class="op" id="5515529">+</span><span class="num" id="5515530">1</span><span class="op" id="5515531">]</span>&nbsp;<span class="op" id="5515533">=</span>&nbsp;<span class="ident" id="5515535">c</span><span class="op" id="5515536">.</span><span class="ident" id="5515537">G</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5515540">p</span><span class="op" id="5515541">.</span><span class="ident" id="5515542">Pix</span><span class="op" id="5515545">[</span><span class="ident" id="5515546">i</span><span class="op" id="5515547">+</span><span class="num" id="5515548">2</span><span class="op" id="5515549">]</span>&nbsp;<span class="op" id="5515551">=</span>&nbsp;<span class="ident" id="5515553">c</span><span class="op" id="5515554">.</span><span class="ident" id="5515555">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5515558">p</span><span class="op" id="5515559">.</span><span class="ident" id="5515560">Pix</span><span class="op" id="5515563">[</span><span class="ident" id="5515564">i</span><span class="op" id="5515565">+</span><span class="num" id="5515566">3</span><span class="op" id="5515567">]</span>&nbsp;<span class="op" id="5515569">=</span>&nbsp;<span class="ident" id="5515571">c</span><span class="op" id="5515572">.</span><span class="ident" id="5515573">A</span><br>
<span class="lineno"></span><span class="op" id="5515575">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="5515578">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5515655">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5515727">func</span>&nbsp;<span class="op" id="5515732">(</span><span class="ident" id="5515733">p</span>&nbsp;<span class="op" id="5515735">*</span><span class="ident" id="5515736">RGBA</span><span class="op" id="5515740">)</span>&nbsp;<span class="ident" id="5515742">SubImage</span><span class="op" id="5515750">(</span><span class="ident" id="5515751">r</span>&nbsp;<span class="ident" id="5515753">Rectangle</span><span class="op" id="5515762">)</span>&nbsp;<span class="ident" id="5515764">Image</span>&nbsp;<span class="op" id="5515770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5515773">r</span>&nbsp;<span class="op" id="5515775">=</span>&nbsp;<span class="ident" id="5515777">r</span><span class="op" id="5515778">.</span><span class="ident" id="5515779">Intersect</span><span class="op" id="5515788">(</span><span class="ident" id="5515789">p</span><span class="op" id="5515790">.</span><span class="ident" id="5515791">Rect</span><span class="op" id="5515795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5515798">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5515879">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5515961">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5516011">if</span>&nbsp;<span class="ident" id="5516014">r</span><span class="op" id="5516015">.</span><span class="ident" id="5516016">Empty</span><span class="op" id="5516021">(</span><span class="op" id="5516022">)</span>&nbsp;<span class="op" id="5516024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5516028">return</span>&nbsp;<span class="op" id="5516035">&amp;</span><span class="ident" id="5516036">RGBA</span><span class="op" id="5516040">{</span><span class="op" id="5516041">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5516044">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5516047">i</span>&nbsp;<span class="op" id="5516049">:=</span>&nbsp;<span class="ident" id="5516052">p</span><span class="op" id="5516053">.</span><span class="ident" id="5516054">PixOffset</span><span class="op" id="5516063">(</span><span class="ident" id="5516064">r</span><span class="op" id="5516065">.</span><span class="ident" id="5516066">Min</span><span class="op" id="5516069">.</span><span class="ident" id="5516070">X</span><span class="op" id="5516071">,</span>&nbsp;<span class="ident" id="5516073">r</span><span class="op" id="5516074">.</span><span class="ident" id="5516075">Min</span><span class="op" id="5516078">.</span><span class="ident" id="5516079">Y</span><span class="op" id="5516080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5516083">return</span>&nbsp;<span class="op" id="5516090">&amp;</span><span class="ident" id="5516091">RGBA</span><span class="op" id="5516095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5516099">Pix</span><span class="op" id="5516102">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5516107">p</span><span class="op" id="5516108">.</span><span class="ident" id="5516109">Pix</span><span class="op" id="5516112">[</span><span class="ident" id="5516113">i</span><span class="op" id="5516114">:</span><span class="op" id="5516115">]</span><span class="op" id="5516116">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5516120">Stride</span><span class="op" id="5516126">:</span>&nbsp;<span class="ident" id="5516128">p</span><span class="op" id="5516129">.</span><span class="ident" id="5516130">Stride</span><span class="op" id="5516136">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5516140">Rect</span><span class="op" id="5516144">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5516148">r</span><span class="op" id="5516149">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5516152">}</span><br>
<span class="lineno"></span><span class="op" id="5516154">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5516157">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5516230">func</span>&nbsp;<span class="op" id="5516235">(</span><span class="ident" id="5516236">p</span>&nbsp;<span class="op" id="5516238">*</span><span class="ident" id="5516239">RGBA</span><span class="op" id="5516243">)</span>&nbsp;<span class="ident" id="5516245">Opaque</span><span class="op" id="5516251">(</span><span class="op" id="5516252">)</span>&nbsp;<span class="builtintype" id="5516254">bool</span>&nbsp;<span class="op" id="5516259">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5516262">if</span>&nbsp;<span class="ident" id="5516265">p</span><span class="op" id="5516266">.</span><span class="ident" id="5516267">Rect</span><span class="op" id="5516271">.</span><span class="ident" id="5516272">Empty</span><span class="op" id="5516277">(</span><span class="op" id="5516278">)</span>&nbsp;<span class="op" id="5516280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5516284">return</span>&nbsp;<span class="builtintype" id="5516291">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5516297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5516300">i0</span><span class="op" id="5516302">,</span>&nbsp;<span class="ident" id="5516304">i1</span>&nbsp;<span class="op" id="5516307">:=</span>&nbsp;<span class="num" id="5516310">3</span><span class="op" id="5516311">,</span>&nbsp;<span class="ident" id="5516313">p</span><span class="op" id="5516314">.</span><span class="ident" id="5516315">Rect</span><span class="op" id="5516319">.</span><span class="ident" id="5516320">Dx</span><span class="op" id="5516322">(</span><span class="op" id="5516323">)</span><span class="op" id="5516324">*</span><span class="num" id="5516325">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5516328">for</span>&nbsp;<span class="ident" id="5516332">y</span>&nbsp;<span class="op" id="5516334">:=</span>&nbsp;<span class="ident" id="5516337">p</span><span class="op" id="5516338">.</span><span class="ident" id="5516339">Rect</span><span class="op" id="5516343">.</span><span class="ident" id="5516344">Min</span><span class="op" id="5516347">.</span><span class="ident" id="5516348">Y</span><span class="op" id="5516349">;</span>&nbsp;<span class="ident" id="5516351">y</span>&nbsp;<span class="op" id="5516353">&lt;</span>&nbsp;<span class="ident" id="5516355">p</span><span class="op" id="5516356">.</span><span class="ident" id="5516357">Rect</span><span class="op" id="5516361">.</span><span class="ident" id="5516362">Max</span><span class="op" id="5516365">.</span><span class="ident" id="5516366">Y</span><span class="op" id="5516367">;</span>&nbsp;<span class="ident" id="5516369">y</span><span class="op" id="5516370">++</span>&nbsp;<span class="op" id="5516373">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5516377">for</span>&nbsp;<span class="ident" id="5516381">i</span>&nbsp;<span class="op" id="5516383">:=</span>&nbsp;<span class="ident" id="5516386">i0</span><span class="op" id="5516388">;</span>&nbsp;<span class="ident" id="5516390">i</span>&nbsp;<span class="op" id="5516392">&lt;</span>&nbsp;<span class="ident" id="5516394">i1</span><span class="op" id="5516396">;</span>&nbsp;<span class="ident" id="5516398">i</span>&nbsp;<span class="op" id="5516400">+=</span>&nbsp;<span class="num" id="5516403">4</span>&nbsp;<span class="op" id="5516405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5516410">if</span>&nbsp;<span class="ident" id="5516413">p</span><span class="op" id="5516414">.</span><span class="ident" id="5516415">Pix</span><span class="op" id="5516418">[</span><span class="ident" id="5516419">i</span><span class="op" id="5516420">]</span>&nbsp;<span class="op" id="5516422">!=</span>&nbsp;<span class="num" id="5516425">0xff</span>&nbsp;<span class="op" id="5516430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5516436">return</span>&nbsp;<span class="builtintype" id="5516443">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5516452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5516456">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5516460">i0</span>&nbsp;<span class="op" id="5516463">+=</span>&nbsp;<span class="ident" id="5516466">p</span><span class="op" id="5516467">.</span><span class="ident" id="5516468">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5516477">i1</span>&nbsp;<span class="op" id="5516480">+=</span>&nbsp;<span class="ident" id="5516483">p</span><span class="op" id="5516484">.</span><span class="ident" id="5516485">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5516493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5516496">return</span>&nbsp;<span class="builtintype" id="5516503">true</span><br>
<span class="lineno"></span><span class="op" id="5516508">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="comment" id="5516511">//&nbsp;NewRGBA&nbsp;returns&nbsp;a&nbsp;new&nbsp;RGBA&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="5516564">func</span>&nbsp;<span class="ident" id="5516569">NewRGBA</span><span class="op" id="5516576">(</span><span class="ident" id="5516577">r</span>&nbsp;<span class="ident" id="5516579">Rectangle</span><span class="op" id="5516588">)</span>&nbsp;<span class="op" id="5516590">*</span><span class="ident" id="5516591">RGBA</span>&nbsp;<span class="op" id="5516596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5516599">w</span><span class="op" id="5516600">,</span>&nbsp;<span class="ident" id="5516602">h</span>&nbsp;<span class="op" id="5516604">:=</span>&nbsp;<span class="ident" id="5516607">r</span><span class="op" id="5516608">.</span><span class="ident" id="5516609">Dx</span><span class="op" id="5516611">(</span><span class="op" id="5516612">)</span><span class="op" id="5516613">,</span>&nbsp;<span class="ident" id="5516615">r</span><span class="op" id="5516616">.</span><span class="ident" id="5516617">Dy</span><span class="op" id="5516619">(</span><span class="op" id="5516620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5516623">buf</span>&nbsp;<span class="op" id="5516627">:=</span>&nbsp;<span class="builtinfunc" id="5516630">make</span><span class="op" id="5516634">(</span><span class="op" id="5516635">[</span><span class="op" id="5516636">]</span><span class="builtintype" id="5516637">uint8</span><span class="op" id="5516642">,</span>&nbsp;<span class="num" id="5516644">4</span><span class="op" id="5516645">*</span><span class="ident" id="5516646">w</span><span class="op" id="5516647">*</span><span class="ident" id="5516648">h</span><span class="op" id="5516649">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5516652">return</span>&nbsp;<span class="op" id="5516659">&amp;</span><span class="ident" id="5516660">RGBA</span><span class="op" id="5516664">{</span><span class="ident" id="5516665">buf</span><span class="op" id="5516668">,</span>&nbsp;<span class="num" id="5516670">4</span>&nbsp;<span class="op" id="5516672">*</span>&nbsp;<span class="ident" id="5516674">w</span><span class="op" id="5516675">,</span>&nbsp;<span class="ident" id="5516677">r</span><span class="op" id="5516678">}</span><br>
<span class="lineno"></span><span class="op" id="5516680">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5516683">//&nbsp;RGBA64&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.RGBA64&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5516760">type</span>&nbsp;<span class="ident" id="5516765">RGBA64</span>&nbsp;<span class="keyword" id="5516772">struct</span>&nbsp;<span class="op" id="5516779">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5516782">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;in&nbsp;R,&nbsp;G,&nbsp;B,&nbsp;A&nbsp;order&nbsp;and&nbsp;big-endian&nbsp;format.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5516872">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*8].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5516940">Pix</span>&nbsp;<span class="op" id="5516944">[</span><span class="op" id="5516945">]</span><span class="builtintype" id="5516946">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5516953">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5517029">Stride</span>&nbsp;<span class="builtintype" id="5517036">int</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5517041">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5517073">Rect</span>&nbsp;<span class="ident" id="5517078">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="5517088">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5517091">func</span>&nbsp;<span class="op" id="5517096">(</span><span class="ident" id="5517097">p</span>&nbsp;<span class="op" id="5517099">*</span><span class="ident" id="5517100">RGBA64</span><span class="op" id="5517106">)</span>&nbsp;<span class="ident" id="5517108">ColorModel</span><span class="op" id="5517118">(</span><span class="op" id="5517119">)</span>&nbsp;<span class="ident" id="5517121">color</span><span class="op" id="5517126">.</span><span class="ident" id="5517127">Model</span>&nbsp;<span class="op" id="5517133">{</span>&nbsp;<span class="keyword" id="5517135">return</span>&nbsp;<span class="ident" id="5517142">color</span><span class="op" id="5517147">.</span><span class="ident" id="5517148">RGBA64Model</span>&nbsp;<span class="op" id="5517160">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="5517163">func</span>&nbsp;<span class="op" id="5517168">(</span><span class="ident" id="5517169">p</span>&nbsp;<span class="op" id="5517171">*</span><span class="ident" id="5517172">RGBA64</span><span class="op" id="5517178">)</span>&nbsp;<span class="ident" id="5517180">Bounds</span><span class="op" id="5517186">(</span><span class="op" id="5517187">)</span>&nbsp;<span class="ident" id="5517189">Rectangle</span>&nbsp;<span class="op" id="5517199">{</span>&nbsp;<span class="keyword" id="5517201">return</span>&nbsp;<span class="ident" id="5517208">p</span><span class="op" id="5517209">.</span><span class="ident" id="5517210">Rect</span>&nbsp;<span class="op" id="5517215">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5517218">func</span>&nbsp;<span class="op" id="5517223">(</span><span class="ident" id="5517224">p</span>&nbsp;<span class="op" id="5517226">*</span><span class="ident" id="5517227">RGBA64</span><span class="op" id="5517233">)</span>&nbsp;<span class="ident" id="5517235">At</span><span class="op" id="5517237">(</span><span class="ident" id="5517238">x</span><span class="op" id="5517239">,</span>&nbsp;<span class="ident" id="5517241">y</span>&nbsp;<span class="builtintype" id="5517243">int</span><span class="op" id="5517246">)</span>&nbsp;<span class="ident" id="5517248">color</span><span class="op" id="5517253">.</span><span class="ident" id="5517254">Color</span>&nbsp;<span class="op" id="5517260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5517263">return</span>&nbsp;<span class="ident" id="5517270">p</span><span class="op" id="5517271">.</span><span class="ident" id="5517272">RGBA64At</span><span class="op" id="5517280">(</span><span class="ident" id="5517281">x</span><span class="op" id="5517282">,</span>&nbsp;<span class="ident" id="5517284">y</span><span class="op" id="5517285">)</span><br>
<span class="lineno">175</span><span class="op" id="5517287">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5517290">func</span>&nbsp;<span class="op" id="5517295">(</span><span class="ident" id="5517296">p</span>&nbsp;<span class="op" id="5517298">*</span><span class="ident" id="5517299">RGBA64</span><span class="op" id="5517305">)</span>&nbsp;<span class="ident" id="5517307">RGBA64At</span><span class="op" id="5517315">(</span><span class="ident" id="5517316">x</span><span class="op" id="5517317">,</span>&nbsp;<span class="ident" id="5517319">y</span>&nbsp;<span class="builtintype" id="5517321">int</span><span class="op" id="5517324">)</span>&nbsp;<span class="ident" id="5517326">color</span><span class="op" id="5517331">.</span><span class="ident" id="5517332">RGBA64</span>&nbsp;<span class="op" id="5517339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5517342">if</span>&nbsp;<span class="op" id="5517345">!</span><span class="op" id="5517346">(</span><span class="ident" id="5517347">Point</span><span class="op" id="5517352">{</span><span class="ident" id="5517353">x</span><span class="op" id="5517354">,</span>&nbsp;<span class="ident" id="5517356">y</span><span class="op" id="5517357">}</span><span class="op" id="5517358">.</span><span class="ident" id="5517359">In</span><span class="op" id="5517361">(</span><span class="ident" id="5517362">p</span><span class="op" id="5517363">.</span><span class="ident" id="5517364">Rect</span><span class="op" id="5517368">)</span><span class="op" id="5517369">)</span>&nbsp;<span class="op" id="5517371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5517375">return</span>&nbsp;<span class="ident" id="5517382">color</span><span class="op" id="5517387">.</span><span class="ident" id="5517388">RGBA64</span><span class="op" id="5517394">{</span><span class="op" id="5517395">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5517398">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5517401">i</span>&nbsp;<span class="op" id="5517403">:=</span>&nbsp;<span class="ident" id="5517406">p</span><span class="op" id="5517407">.</span><span class="ident" id="5517408">PixOffset</span><span class="op" id="5517417">(</span><span class="ident" id="5517418">x</span><span class="op" id="5517419">,</span>&nbsp;<span class="ident" id="5517421">y</span><span class="op" id="5517422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5517425">return</span>&nbsp;<span class="ident" id="5517432">color</span><span class="op" id="5517437">.</span><span class="ident" id="5517438">RGBA64</span><span class="op" id="5517444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5517448">uint16</span><span class="op" id="5517454">(</span><span class="ident" id="5517455">p</span><span class="op" id="5517456">.</span><span class="ident" id="5517457">Pix</span><span class="op" id="5517460">[</span><span class="ident" id="5517461">i</span><span class="op" id="5517462">+</span><span class="num" id="5517463">0</span><span class="op" id="5517464">]</span><span class="op" id="5517465">)</span><span class="op" id="5517466">&lt;&lt;</span><span class="num" id="5517468">8</span>&nbsp;<span class="op" id="5517470">|</span>&nbsp;<span class="builtintype" id="5517472">uint16</span><span class="op" id="5517478">(</span><span class="ident" id="5517479">p</span><span class="op" id="5517480">.</span><span class="ident" id="5517481">Pix</span><span class="op" id="5517484">[</span><span class="ident" id="5517485">i</span><span class="op" id="5517486">+</span><span class="num" id="5517487">1</span><span class="op" id="5517488">]</span><span class="op" id="5517489">)</span><span class="op" id="5517490">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5517494">uint16</span><span class="op" id="5517500">(</span><span class="ident" id="5517501">p</span><span class="op" id="5517502">.</span><span class="ident" id="5517503">Pix</span><span class="op" id="5517506">[</span><span class="ident" id="5517507">i</span><span class="op" id="5517508">+</span><span class="num" id="5517509">2</span><span class="op" id="5517510">]</span><span class="op" id="5517511">)</span><span class="op" id="5517512">&lt;&lt;</span><span class="num" id="5517514">8</span>&nbsp;<span class="op" id="5517516">|</span>&nbsp;<span class="builtintype" id="5517518">uint16</span><span class="op" id="5517524">(</span><span class="ident" id="5517525">p</span><span class="op" id="5517526">.</span><span class="ident" id="5517527">Pix</span><span class="op" id="5517530">[</span><span class="ident" id="5517531">i</span><span class="op" id="5517532">+</span><span class="num" id="5517533">3</span><span class="op" id="5517534">]</span><span class="op" id="5517535">)</span><span class="op" id="5517536">,</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5517540">uint16</span><span class="op" id="5517546">(</span><span class="ident" id="5517547">p</span><span class="op" id="5517548">.</span><span class="ident" id="5517549">Pix</span><span class="op" id="5517552">[</span><span class="ident" id="5517553">i</span><span class="op" id="5517554">+</span><span class="num" id="5517555">4</span><span class="op" id="5517556">]</span><span class="op" id="5517557">)</span><span class="op" id="5517558">&lt;&lt;</span><span class="num" id="5517560">8</span>&nbsp;<span class="op" id="5517562">|</span>&nbsp;<span class="builtintype" id="5517564">uint16</span><span class="op" id="5517570">(</span><span class="ident" id="5517571">p</span><span class="op" id="5517572">.</span><span class="ident" id="5517573">Pix</span><span class="op" id="5517576">[</span><span class="ident" id="5517577">i</span><span class="op" id="5517578">+</span><span class="num" id="5517579">5</span><span class="op" id="5517580">]</span><span class="op" id="5517581">)</span><span class="op" id="5517582">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5517586">uint16</span><span class="op" id="5517592">(</span><span class="ident" id="5517593">p</span><span class="op" id="5517594">.</span><span class="ident" id="5517595">Pix</span><span class="op" id="5517598">[</span><span class="ident" id="5517599">i</span><span class="op" id="5517600">+</span><span class="num" id="5517601">6</span><span class="op" id="5517602">]</span><span class="op" id="5517603">)</span><span class="op" id="5517604">&lt;&lt;</span><span class="num" id="5517606">8</span>&nbsp;<span class="op" id="5517608">|</span>&nbsp;<span class="builtintype" id="5517610">uint16</span><span class="op" id="5517616">(</span><span class="ident" id="5517617">p</span><span class="op" id="5517618">.</span><span class="ident" id="5517619">Pix</span><span class="op" id="5517622">[</span><span class="ident" id="5517623">i</span><span class="op" id="5517624">+</span><span class="num" id="5517625">7</span><span class="op" id="5517626">]</span><span class="op" id="5517627">)</span><span class="op" id="5517628">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5517631">}</span><br>
<span class="lineno"></span><span class="op" id="5517633">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="comment" id="5517636">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5517715">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5517739">func</span>&nbsp;<span class="op" id="5517744">(</span><span class="ident" id="5517745">p</span>&nbsp;<span class="op" id="5517747">*</span><span class="ident" id="5517748">RGBA64</span><span class="op" id="5517754">)</span>&nbsp;<span class="ident" id="5517756">PixOffset</span><span class="op" id="5517765">(</span><span class="ident" id="5517766">x</span><span class="op" id="5517767">,</span>&nbsp;<span class="ident" id="5517769">y</span>&nbsp;<span class="builtintype" id="5517771">int</span><span class="op" id="5517774">)</span>&nbsp;<span class="builtintype" id="5517776">int</span>&nbsp;<span class="op" id="5517780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5517783">return</span>&nbsp;<span class="op" id="5517790">(</span><span class="ident" id="5517791">y</span><span class="op" id="5517792">-</span><span class="ident" id="5517793">p</span><span class="op" id="5517794">.</span><span class="ident" id="5517795">Rect</span><span class="op" id="5517799">.</span><span class="ident" id="5517800">Min</span><span class="op" id="5517803">.</span><span class="ident" id="5517804">Y</span><span class="op" id="5517805">)</span><span class="op" id="5517806">*</span><span class="ident" id="5517807">p</span><span class="op" id="5517808">.</span><span class="ident" id="5517809">Stride</span>&nbsp;<span class="op" id="5517816">+</span>&nbsp;<span class="op" id="5517818">(</span><span class="ident" id="5517819">x</span><span class="op" id="5517820">-</span><span class="ident" id="5517821">p</span><span class="op" id="5517822">.</span><span class="ident" id="5517823">Rect</span><span class="op" id="5517827">.</span><span class="ident" id="5517828">Min</span><span class="op" id="5517831">.</span><span class="ident" id="5517832">X</span><span class="op" id="5517833">)</span><span class="op" id="5517834">*</span><span class="num" id="5517835">8</span><br>
<span class="lineno"></span><span class="op" id="5517837">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="keyword" id="5517840">func</span>&nbsp;<span class="op" id="5517845">(</span><span class="ident" id="5517846">p</span>&nbsp;<span class="op" id="5517848">*</span><span class="ident" id="5517849">RGBA64</span><span class="op" id="5517855">)</span>&nbsp;<span class="ident" id="5517857">Set</span><span class="op" id="5517860">(</span><span class="ident" id="5517861">x</span><span class="op" id="5517862">,</span>&nbsp;<span class="ident" id="5517864">y</span>&nbsp;<span class="builtintype" id="5517866">int</span><span class="op" id="5517869">,</span>&nbsp;<span class="ident" id="5517871">c</span>&nbsp;<span class="ident" id="5517873">color</span><span class="op" id="5517878">.</span><span class="ident" id="5517879">Color</span><span class="op" id="5517884">)</span>&nbsp;<span class="op" id="5517886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5517889">if</span>&nbsp;<span class="op" id="5517892">!</span><span class="op" id="5517893">(</span><span class="ident" id="5517894">Point</span><span class="op" id="5517899">{</span><span class="ident" id="5517900">x</span><span class="op" id="5517901">,</span>&nbsp;<span class="ident" id="5517903">y</span><span class="op" id="5517904">}</span><span class="op" id="5517905">.</span><span class="ident" id="5517906">In</span><span class="op" id="5517908">(</span><span class="ident" id="5517909">p</span><span class="op" id="5517910">.</span><span class="ident" id="5517911">Rect</span><span class="op" id="5517915">)</span><span class="op" id="5517916">)</span>&nbsp;<span class="op" id="5517918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5517922">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5517930">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5517933">i</span>&nbsp;<span class="op" id="5517935">:=</span>&nbsp;<span class="ident" id="5517938">p</span><span class="op" id="5517939">.</span><span class="ident" id="5517940">PixOffset</span><span class="op" id="5517949">(</span><span class="ident" id="5517950">x</span><span class="op" id="5517951">,</span>&nbsp;<span class="ident" id="5517953">y</span><span class="op" id="5517954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5517957">c1</span>&nbsp;<span class="op" id="5517960">:=</span>&nbsp;<span class="ident" id="5517963">color</span><span class="op" id="5517968">.</span><span class="ident" id="5517969">RGBA64Model</span><span class="op" id="5517980">.</span><span class="ident" id="5517981">Convert</span><span class="op" id="5517988">(</span><span class="ident" id="5517989">c</span><span class="op" id="5517990">)</span><span class="op" id="5517991">.</span><span class="op" id="5517992">(</span><span class="ident" id="5517993">color</span><span class="op" id="5517998">.</span><span class="ident" id="5517999">RGBA64</span><span class="op" id="5518005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5518008">p</span><span class="op" id="5518009">.</span><span class="ident" id="5518010">Pix</span><span class="op" id="5518013">[</span><span class="ident" id="5518014">i</span><span class="op" id="5518015">+</span><span class="num" id="5518016">0</span><span class="op" id="5518017">]</span>&nbsp;<span class="op" id="5518019">=</span>&nbsp;<span class="builtintype" id="5518021">uint8</span><span class="op" id="5518026">(</span><span class="ident" id="5518027">c1</span><span class="op" id="5518029">.</span><span class="ident" id="5518030">R</span>&nbsp;<span class="op" id="5518032">&gt;&gt;</span>&nbsp;<span class="num" id="5518035">8</span><span class="op" id="5518036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5518039">p</span><span class="op" id="5518040">.</span><span class="ident" id="5518041">Pix</span><span class="op" id="5518044">[</span><span class="ident" id="5518045">i</span><span class="op" id="5518046">+</span><span class="num" id="5518047">1</span><span class="op" id="5518048">]</span>&nbsp;<span class="op" id="5518050">=</span>&nbsp;<span class="builtintype" id="5518052">uint8</span><span class="op" id="5518057">(</span><span class="ident" id="5518058">c1</span><span class="op" id="5518060">.</span><span class="ident" id="5518061">R</span><span class="op" id="5518062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5518065">p</span><span class="op" id="5518066">.</span><span class="ident" id="5518067">Pix</span><span class="op" id="5518070">[</span><span class="ident" id="5518071">i</span><span class="op" id="5518072">+</span><span class="num" id="5518073">2</span><span class="op" id="5518074">]</span>&nbsp;<span class="op" id="5518076">=</span>&nbsp;<span class="builtintype" id="5518078">uint8</span><span class="op" id="5518083">(</span><span class="ident" id="5518084">c1</span><span class="op" id="5518086">.</span><span class="ident" id="5518087">G</span>&nbsp;<span class="op" id="5518089">&gt;&gt;</span>&nbsp;<span class="num" id="5518092">8</span><span class="op" id="5518093">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5518096">p</span><span class="op" id="5518097">.</span><span class="ident" id="5518098">Pix</span><span class="op" id="5518101">[</span><span class="ident" id="5518102">i</span><span class="op" id="5518103">+</span><span class="num" id="5518104">3</span><span class="op" id="5518105">]</span>&nbsp;<span class="op" id="5518107">=</span>&nbsp;<span class="builtintype" id="5518109">uint8</span><span class="op" id="5518114">(</span><span class="ident" id="5518115">c1</span><span class="op" id="5518117">.</span><span class="ident" id="5518118">G</span><span class="op" id="5518119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5518122">p</span><span class="op" id="5518123">.</span><span class="ident" id="5518124">Pix</span><span class="op" id="5518127">[</span><span class="ident" id="5518128">i</span><span class="op" id="5518129">+</span><span class="num" id="5518130">4</span><span class="op" id="5518131">]</span>&nbsp;<span class="op" id="5518133">=</span>&nbsp;<span class="builtintype" id="5518135">uint8</span><span class="op" id="5518140">(</span><span class="ident" id="5518141">c1</span><span class="op" id="5518143">.</span><span class="ident" id="5518144">B</span>&nbsp;<span class="op" id="5518146">&gt;&gt;</span>&nbsp;<span class="num" id="5518149">8</span><span class="op" id="5518150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5518153">p</span><span class="op" id="5518154">.</span><span class="ident" id="5518155">Pix</span><span class="op" id="5518158">[</span><span class="ident" id="5518159">i</span><span class="op" id="5518160">+</span><span class="num" id="5518161">5</span><span class="op" id="5518162">]</span>&nbsp;<span class="op" id="5518164">=</span>&nbsp;<span class="builtintype" id="5518166">uint8</span><span class="op" id="5518171">(</span><span class="ident" id="5518172">c1</span><span class="op" id="5518174">.</span><span class="ident" id="5518175">B</span><span class="op" id="5518176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5518179">p</span><span class="op" id="5518180">.</span><span class="ident" id="5518181">Pix</span><span class="op" id="5518184">[</span><span class="ident" id="5518185">i</span><span class="op" id="5518186">+</span><span class="num" id="5518187">6</span><span class="op" id="5518188">]</span>&nbsp;<span class="op" id="5518190">=</span>&nbsp;<span class="builtintype" id="5518192">uint8</span><span class="op" id="5518197">(</span><span class="ident" id="5518198">c1</span><span class="op" id="5518200">.</span><span class="ident" id="5518201">A</span>&nbsp;<span class="op" id="5518203">&gt;&gt;</span>&nbsp;<span class="num" id="5518206">8</span><span class="op" id="5518207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5518210">p</span><span class="op" id="5518211">.</span><span class="ident" id="5518212">Pix</span><span class="op" id="5518215">[</span><span class="ident" id="5518216">i</span><span class="op" id="5518217">+</span><span class="num" id="5518218">7</span><span class="op" id="5518219">]</span>&nbsp;<span class="op" id="5518221">=</span>&nbsp;<span class="builtintype" id="5518223">uint8</span><span class="op" id="5518228">(</span><span class="ident" id="5518229">c1</span><span class="op" id="5518231">.</span><span class="ident" id="5518232">A</span><span class="op" id="5518233">)</span><br>
<span class="lineno">210</span><span class="op" id="5518235">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5518238">func</span>&nbsp;<span class="op" id="5518243">(</span><span class="ident" id="5518244">p</span>&nbsp;<span class="op" id="5518246">*</span><span class="ident" id="5518247">RGBA64</span><span class="op" id="5518253">)</span>&nbsp;<span class="ident" id="5518255">SetRGBA64</span><span class="op" id="5518264">(</span><span class="ident" id="5518265">x</span><span class="op" id="5518266">,</span>&nbsp;<span class="ident" id="5518268">y</span>&nbsp;<span class="builtintype" id="5518270">int</span><span class="op" id="5518273">,</span>&nbsp;<span class="ident" id="5518275">c</span>&nbsp;<span class="ident" id="5518277">color</span><span class="op" id="5518282">.</span><span class="ident" id="5518283">RGBA64</span><span class="op" id="5518289">)</span>&nbsp;<span class="op" id="5518291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5518294">if</span>&nbsp;<span class="op" id="5518297">!</span><span class="op" id="5518298">(</span><span class="ident" id="5518299">Point</span><span class="op" id="5518304">{</span><span class="ident" id="5518305">x</span><span class="op" id="5518306">,</span>&nbsp;<span class="ident" id="5518308">y</span><span class="op" id="5518309">}</span><span class="op" id="5518310">.</span><span class="ident" id="5518311">In</span><span class="op" id="5518313">(</span><span class="ident" id="5518314">p</span><span class="op" id="5518315">.</span><span class="ident" id="5518316">Rect</span><span class="op" id="5518320">)</span><span class="op" id="5518321">)</span>&nbsp;<span class="op" id="5518323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5518327">return</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5518335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5518338">i</span>&nbsp;<span class="op" id="5518340">:=</span>&nbsp;<span class="ident" id="5518343">p</span><span class="op" id="5518344">.</span><span class="ident" id="5518345">PixOffset</span><span class="op" id="5518354">(</span><span class="ident" id="5518355">x</span><span class="op" id="5518356">,</span>&nbsp;<span class="ident" id="5518358">y</span><span class="op" id="5518359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5518362">p</span><span class="op" id="5518363">.</span><span class="ident" id="5518364">Pix</span><span class="op" id="5518367">[</span><span class="ident" id="5518368">i</span><span class="op" id="5518369">+</span><span class="num" id="5518370">0</span><span class="op" id="5518371">]</span>&nbsp;<span class="op" id="5518373">=</span>&nbsp;<span class="builtintype" id="5518375">uint8</span><span class="op" id="5518380">(</span><span class="ident" id="5518381">c</span><span class="op" id="5518382">.</span><span class="ident" id="5518383">R</span>&nbsp;<span class="op" id="5518385">&gt;&gt;</span>&nbsp;<span class="num" id="5518388">8</span><span class="op" id="5518389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5518392">p</span><span class="op" id="5518393">.</span><span class="ident" id="5518394">Pix</span><span class="op" id="5518397">[</span><span class="ident" id="5518398">i</span><span class="op" id="5518399">+</span><span class="num" id="5518400">1</span><span class="op" id="5518401">]</span>&nbsp;<span class="op" id="5518403">=</span>&nbsp;<span class="builtintype" id="5518405">uint8</span><span class="op" id="5518410">(</span><span class="ident" id="5518411">c</span><span class="op" id="5518412">.</span><span class="ident" id="5518413">R</span><span class="op" id="5518414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5518417">p</span><span class="op" id="5518418">.</span><span class="ident" id="5518419">Pix</span><span class="op" id="5518422">[</span><span class="ident" id="5518423">i</span><span class="op" id="5518424">+</span><span class="num" id="5518425">2</span><span class="op" id="5518426">]</span>&nbsp;<span class="op" id="5518428">=</span>&nbsp;<span class="builtintype" id="5518430">uint8</span><span class="op" id="5518435">(</span><span class="ident" id="5518436">c</span><span class="op" id="5518437">.</span><span class="ident" id="5518438">G</span>&nbsp;<span class="op" id="5518440">&gt;&gt;</span>&nbsp;<span class="num" id="5518443">8</span><span class="op" id="5518444">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5518447">p</span><span class="op" id="5518448">.</span><span class="ident" id="5518449">Pix</span><span class="op" id="5518452">[</span><span class="ident" id="5518453">i</span><span class="op" id="5518454">+</span><span class="num" id="5518455">3</span><span class="op" id="5518456">]</span>&nbsp;<span class="op" id="5518458">=</span>&nbsp;<span class="builtintype" id="5518460">uint8</span><span class="op" id="5518465">(</span><span class="ident" id="5518466">c</span><span class="op" id="5518467">.</span><span class="ident" id="5518468">G</span><span class="op" id="5518469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5518472">p</span><span class="op" id="5518473">.</span><span class="ident" id="5518474">Pix</span><span class="op" id="5518477">[</span><span class="ident" id="5518478">i</span><span class="op" id="5518479">+</span><span class="num" id="5518480">4</span><span class="op" id="5518481">]</span>&nbsp;<span class="op" id="5518483">=</span>&nbsp;<span class="builtintype" id="5518485">uint8</span><span class="op" id="5518490">(</span><span class="ident" id="5518491">c</span><span class="op" id="5518492">.</span><span class="ident" id="5518493">B</span>&nbsp;<span class="op" id="5518495">&gt;&gt;</span>&nbsp;<span class="num" id="5518498">8</span><span class="op" id="5518499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5518502">p</span><span class="op" id="5518503">.</span><span class="ident" id="5518504">Pix</span><span class="op" id="5518507">[</span><span class="ident" id="5518508">i</span><span class="op" id="5518509">+</span><span class="num" id="5518510">5</span><span class="op" id="5518511">]</span>&nbsp;<span class="op" id="5518513">=</span>&nbsp;<span class="builtintype" id="5518515">uint8</span><span class="op" id="5518520">(</span><span class="ident" id="5518521">c</span><span class="op" id="5518522">.</span><span class="ident" id="5518523">B</span><span class="op" id="5518524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5518527">p</span><span class="op" id="5518528">.</span><span class="ident" id="5518529">Pix</span><span class="op" id="5518532">[</span><span class="ident" id="5518533">i</span><span class="op" id="5518534">+</span><span class="num" id="5518535">6</span><span class="op" id="5518536">]</span>&nbsp;<span class="op" id="5518538">=</span>&nbsp;<span class="builtintype" id="5518540">uint8</span><span class="op" id="5518545">(</span><span class="ident" id="5518546">c</span><span class="op" id="5518547">.</span><span class="ident" id="5518548">A</span>&nbsp;<span class="op" id="5518550">&gt;&gt;</span>&nbsp;<span class="num" id="5518553">8</span><span class="op" id="5518554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5518557">p</span><span class="op" id="5518558">.</span><span class="ident" id="5518559">Pix</span><span class="op" id="5518562">[</span><span class="ident" id="5518563">i</span><span class="op" id="5518564">+</span><span class="num" id="5518565">7</span><span class="op" id="5518566">]</span>&nbsp;<span class="op" id="5518568">=</span>&nbsp;<span class="builtintype" id="5518570">uint8</span><span class="op" id="5518575">(</span><span class="ident" id="5518576">c</span><span class="op" id="5518577">.</span><span class="ident" id="5518578">A</span><span class="op" id="5518579">)</span><br>
<span class="lineno">225</span><span class="op" id="5518581">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5518584">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5518661">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5518733">func</span>&nbsp;<span class="op" id="5518738">(</span><span class="ident" id="5518739">p</span>&nbsp;<span class="op" id="5518741">*</span><span class="ident" id="5518742">RGBA64</span><span class="op" id="5518748">)</span>&nbsp;<span class="ident" id="5518750">SubImage</span><span class="op" id="5518758">(</span><span class="ident" id="5518759">r</span>&nbsp;<span class="ident" id="5518761">Rectangle</span><span class="op" id="5518770">)</span>&nbsp;<span class="ident" id="5518772">Image</span>&nbsp;<span class="op" id="5518778">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5518781">r</span>&nbsp;<span class="op" id="5518783">=</span>&nbsp;<span class="ident" id="5518785">r</span><span class="op" id="5518786">.</span><span class="ident" id="5518787">Intersect</span><span class="op" id="5518796">(</span><span class="ident" id="5518797">p</span><span class="op" id="5518798">.</span><span class="ident" id="5518799">Rect</span><span class="op" id="5518803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5518806">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5518887">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5518969">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5519019">if</span>&nbsp;<span class="ident" id="5519022">r</span><span class="op" id="5519023">.</span><span class="ident" id="5519024">Empty</span><span class="op" id="5519029">(</span><span class="op" id="5519030">)</span>&nbsp;<span class="op" id="5519032">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5519036">return</span>&nbsp;<span class="op" id="5519043">&amp;</span><span class="ident" id="5519044">RGBA64</span><span class="op" id="5519050">{</span><span class="op" id="5519051">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5519054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5519057">i</span>&nbsp;<span class="op" id="5519059">:=</span>&nbsp;<span class="ident" id="5519062">p</span><span class="op" id="5519063">.</span><span class="ident" id="5519064">PixOffset</span><span class="op" id="5519073">(</span><span class="ident" id="5519074">r</span><span class="op" id="5519075">.</span><span class="ident" id="5519076">Min</span><span class="op" id="5519079">.</span><span class="ident" id="5519080">X</span><span class="op" id="5519081">,</span>&nbsp;<span class="ident" id="5519083">r</span><span class="op" id="5519084">.</span><span class="ident" id="5519085">Min</span><span class="op" id="5519088">.</span><span class="ident" id="5519089">Y</span><span class="op" id="5519090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5519093">return</span>&nbsp;<span class="op" id="5519100">&amp;</span><span class="ident" id="5519101">RGBA64</span><span class="op" id="5519107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5519111">Pix</span><span class="op" id="5519114">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5519119">p</span><span class="op" id="5519120">.</span><span class="ident" id="5519121">Pix</span><span class="op" id="5519124">[</span><span class="ident" id="5519125">i</span><span class="op" id="5519126">:</span><span class="op" id="5519127">]</span><span class="op" id="5519128">,</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5519132">Stride</span><span class="op" id="5519138">:</span>&nbsp;<span class="ident" id="5519140">p</span><span class="op" id="5519141">.</span><span class="ident" id="5519142">Stride</span><span class="op" id="5519148">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5519152">Rect</span><span class="op" id="5519156">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5519160">r</span><span class="op" id="5519161">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5519164">}</span><br>
<span class="lineno"></span><span class="op" id="5519166">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span><span class="comment" id="5519169">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5519242">func</span>&nbsp;<span class="op" id="5519247">(</span><span class="ident" id="5519248">p</span>&nbsp;<span class="op" id="5519250">*</span><span class="ident" id="5519251">RGBA64</span><span class="op" id="5519257">)</span>&nbsp;<span class="ident" id="5519259">Opaque</span><span class="op" id="5519265">(</span><span class="op" id="5519266">)</span>&nbsp;<span class="builtintype" id="5519268">bool</span>&nbsp;<span class="op" id="5519273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5519276">if</span>&nbsp;<span class="ident" id="5519279">p</span><span class="op" id="5519280">.</span><span class="ident" id="5519281">Rect</span><span class="op" id="5519285">.</span><span class="ident" id="5519286">Empty</span><span class="op" id="5519291">(</span><span class="op" id="5519292">)</span>&nbsp;<span class="op" id="5519294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5519298">return</span>&nbsp;<span class="builtintype" id="5519305">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5519311">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5519314">i0</span><span class="op" id="5519316">,</span>&nbsp;<span class="ident" id="5519318">i1</span>&nbsp;<span class="op" id="5519321">:=</span>&nbsp;<span class="num" id="5519324">6</span><span class="op" id="5519325">,</span>&nbsp;<span class="ident" id="5519327">p</span><span class="op" id="5519328">.</span><span class="ident" id="5519329">Rect</span><span class="op" id="5519333">.</span><span class="ident" id="5519334">Dx</span><span class="op" id="5519336">(</span><span class="op" id="5519337">)</span><span class="op" id="5519338">*</span><span class="num" id="5519339">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5519342">for</span>&nbsp;<span class="ident" id="5519346">y</span>&nbsp;<span class="op" id="5519348">:=</span>&nbsp;<span class="ident" id="5519351">p</span><span class="op" id="5519352">.</span><span class="ident" id="5519353">Rect</span><span class="op" id="5519357">.</span><span class="ident" id="5519358">Min</span><span class="op" id="5519361">.</span><span class="ident" id="5519362">Y</span><span class="op" id="5519363">;</span>&nbsp;<span class="ident" id="5519365">y</span>&nbsp;<span class="op" id="5519367">&lt;</span>&nbsp;<span class="ident" id="5519369">p</span><span class="op" id="5519370">.</span><span class="ident" id="5519371">Rect</span><span class="op" id="5519375">.</span><span class="ident" id="5519376">Max</span><span class="op" id="5519379">.</span><span class="ident" id="5519380">Y</span><span class="op" id="5519381">;</span>&nbsp;<span class="ident" id="5519383">y</span><span class="op" id="5519384">++</span>&nbsp;<span class="op" id="5519387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5519391">for</span>&nbsp;<span class="ident" id="5519395">i</span>&nbsp;<span class="op" id="5519397">:=</span>&nbsp;<span class="ident" id="5519400">i0</span><span class="op" id="5519402">;</span>&nbsp;<span class="ident" id="5519404">i</span>&nbsp;<span class="op" id="5519406">&lt;</span>&nbsp;<span class="ident" id="5519408">i1</span><span class="op" id="5519410">;</span>&nbsp;<span class="ident" id="5519412">i</span>&nbsp;<span class="op" id="5519414">+=</span>&nbsp;<span class="num" id="5519417">8</span>&nbsp;<span class="op" id="5519419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5519424">if</span>&nbsp;<span class="ident" id="5519427">p</span><span class="op" id="5519428">.</span><span class="ident" id="5519429">Pix</span><span class="op" id="5519432">[</span><span class="ident" id="5519433">i</span><span class="op" id="5519434">+</span><span class="num" id="5519435">0</span><span class="op" id="5519436">]</span>&nbsp;<span class="op" id="5519438">!=</span>&nbsp;<span class="num" id="5519441">0xff</span>&nbsp;<span class="op" id="5519446">||</span>&nbsp;<span class="ident" id="5519449">p</span><span class="op" id="5519450">.</span><span class="ident" id="5519451">Pix</span><span class="op" id="5519454">[</span><span class="ident" id="5519455">i</span><span class="op" id="5519456">+</span><span class="num" id="5519457">1</span><span class="op" id="5519458">]</span>&nbsp;<span class="op" id="5519460">!=</span>&nbsp;<span class="num" id="5519463">0xff</span>&nbsp;<span class="op" id="5519468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5519474">return</span>&nbsp;<span class="builtintype" id="5519481">false</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5519490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5519494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5519498">i0</span>&nbsp;<span class="op" id="5519501">+=</span>&nbsp;<span class="ident" id="5519504">p</span><span class="op" id="5519505">.</span><span class="ident" id="5519506">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5519515">i1</span>&nbsp;<span class="op" id="5519518">+=</span>&nbsp;<span class="ident" id="5519521">p</span><span class="op" id="5519522">.</span><span class="ident" id="5519523">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5519531">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5519534">return</span>&nbsp;<span class="builtintype" id="5519541">true</span><br>
<span class="lineno"></span><span class="op" id="5519546">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5519549">//&nbsp;NewRGBA64&nbsp;returns&nbsp;a&nbsp;new&nbsp;RGBA64&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="5519606">func</span>&nbsp;<span class="ident" id="5519611">NewRGBA64</span><span class="op" id="5519620">(</span><span class="ident" id="5519621">r</span>&nbsp;<span class="ident" id="5519623">Rectangle</span><span class="op" id="5519632">)</span>&nbsp;<span class="op" id="5519634">*</span><span class="ident" id="5519635">RGBA64</span>&nbsp;<span class="op" id="5519642">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5519645">w</span><span class="op" id="5519646">,</span>&nbsp;<span class="ident" id="5519648">h</span>&nbsp;<span class="op" id="5519650">:=</span>&nbsp;<span class="ident" id="5519653">r</span><span class="op" id="5519654">.</span><span class="ident" id="5519655">Dx</span><span class="op" id="5519657">(</span><span class="op" id="5519658">)</span><span class="op" id="5519659">,</span>&nbsp;<span class="ident" id="5519661">r</span><span class="op" id="5519662">.</span><span class="ident" id="5519663">Dy</span><span class="op" id="5519665">(</span><span class="op" id="5519666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5519669">pix</span>&nbsp;<span class="op" id="5519673">:=</span>&nbsp;<span class="builtinfunc" id="5519676">make</span><span class="op" id="5519680">(</span><span class="op" id="5519681">[</span><span class="op" id="5519682">]</span><span class="builtintype" id="5519683">uint8</span><span class="op" id="5519688">,</span>&nbsp;<span class="num" id="5519690">8</span><span class="op" id="5519691">*</span><span class="ident" id="5519692">w</span><span class="op" id="5519693">*</span><span class="ident" id="5519694">h</span><span class="op" id="5519695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5519698">return</span>&nbsp;<span class="op" id="5519705">&amp;</span><span class="ident" id="5519706">RGBA64</span><span class="op" id="5519712">{</span><span class="ident" id="5519713">pix</span><span class="op" id="5519716">,</span>&nbsp;<span class="num" id="5519718">8</span>&nbsp;<span class="op" id="5519720">*</span>&nbsp;<span class="ident" id="5519722">w</span><span class="op" id="5519723">,</span>&nbsp;<span class="ident" id="5519725">r</span><span class="op" id="5519726">}</span><br>
<span class="lineno"></span><span class="op" id="5519728">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="5519731">//&nbsp;NRGBA&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.NRGBA&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5519806">type</span>&nbsp;<span class="ident" id="5519811">NRGBA</span>&nbsp;<span class="keyword" id="5519817">struct</span>&nbsp;<span class="op" id="5519824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5519827">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;in&nbsp;R,&nbsp;G,&nbsp;B,&nbsp;A&nbsp;order.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5519895">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*4].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5519963">Pix</span>&nbsp;<span class="op" id="5519967">[</span><span class="op" id="5519968">]</span><span class="builtintype" id="5519969">uint8</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5519976">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520052">Stride</span>&nbsp;<span class="builtintype" id="5520059">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5520064">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520096">Rect</span>&nbsp;<span class="ident" id="5520101">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="5520111">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="keyword" id="5520114">func</span>&nbsp;<span class="op" id="5520119">(</span><span class="ident" id="5520120">p</span>&nbsp;<span class="op" id="5520122">*</span><span class="ident" id="5520123">NRGBA</span><span class="op" id="5520128">)</span>&nbsp;<span class="ident" id="5520130">ColorModel</span><span class="op" id="5520140">(</span><span class="op" id="5520141">)</span>&nbsp;<span class="ident" id="5520143">color</span><span class="op" id="5520148">.</span><span class="ident" id="5520149">Model</span>&nbsp;<span class="op" id="5520155">{</span>&nbsp;<span class="keyword" id="5520157">return</span>&nbsp;<span class="ident" id="5520164">color</span><span class="op" id="5520169">.</span><span class="ident" id="5520170">NRGBAModel</span>&nbsp;<span class="op" id="5520181">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5520184">func</span>&nbsp;<span class="op" id="5520189">(</span><span class="ident" id="5520190">p</span>&nbsp;<span class="op" id="5520192">*</span><span class="ident" id="5520193">NRGBA</span><span class="op" id="5520198">)</span>&nbsp;<span class="ident" id="5520200">Bounds</span><span class="op" id="5520206">(</span><span class="op" id="5520207">)</span>&nbsp;<span class="ident" id="5520209">Rectangle</span>&nbsp;<span class="op" id="5520219">{</span>&nbsp;<span class="keyword" id="5520221">return</span>&nbsp;<span class="ident" id="5520228">p</span><span class="op" id="5520229">.</span><span class="ident" id="5520230">Rect</span>&nbsp;<span class="op" id="5520235">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="keyword" id="5520238">func</span>&nbsp;<span class="op" id="5520243">(</span><span class="ident" id="5520244">p</span>&nbsp;<span class="op" id="5520246">*</span><span class="ident" id="5520247">NRGBA</span><span class="op" id="5520252">)</span>&nbsp;<span class="ident" id="5520254">At</span><span class="op" id="5520256">(</span><span class="ident" id="5520257">x</span><span class="op" id="5520258">,</span>&nbsp;<span class="ident" id="5520260">y</span>&nbsp;<span class="builtintype" id="5520262">int</span><span class="op" id="5520265">)</span>&nbsp;<span class="ident" id="5520267">color</span><span class="op" id="5520272">.</span><span class="ident" id="5520273">Color</span>&nbsp;<span class="op" id="5520279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5520282">return</span>&nbsp;<span class="ident" id="5520289">p</span><span class="op" id="5520290">.</span><span class="ident" id="5520291">NRGBAAt</span><span class="op" id="5520298">(</span><span class="ident" id="5520299">x</span><span class="op" id="5520300">,</span>&nbsp;<span class="ident" id="5520302">y</span><span class="op" id="5520303">)</span><br>
<span class="lineno"></span><span class="op" id="5520305">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5520308">func</span>&nbsp;<span class="op" id="5520313">(</span><span class="ident" id="5520314">p</span>&nbsp;<span class="op" id="5520316">*</span><span class="ident" id="5520317">NRGBA</span><span class="op" id="5520322">)</span>&nbsp;<span class="ident" id="5520324">NRGBAAt</span><span class="op" id="5520331">(</span><span class="ident" id="5520332">x</span><span class="op" id="5520333">,</span>&nbsp;<span class="ident" id="5520335">y</span>&nbsp;<span class="builtintype" id="5520337">int</span><span class="op" id="5520340">)</span>&nbsp;<span class="ident" id="5520342">color</span><span class="op" id="5520347">.</span><span class="ident" id="5520348">NRGBA</span>&nbsp;<span class="op" id="5520354">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5520357">if</span>&nbsp;<span class="op" id="5520360">!</span><span class="op" id="5520361">(</span><span class="ident" id="5520362">Point</span><span class="op" id="5520367">{</span><span class="ident" id="5520368">x</span><span class="op" id="5520369">,</span>&nbsp;<span class="ident" id="5520371">y</span><span class="op" id="5520372">}</span><span class="op" id="5520373">.</span><span class="ident" id="5520374">In</span><span class="op" id="5520376">(</span><span class="ident" id="5520377">p</span><span class="op" id="5520378">.</span><span class="ident" id="5520379">Rect</span><span class="op" id="5520383">)</span><span class="op" id="5520384">)</span>&nbsp;<span class="op" id="5520386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5520390">return</span>&nbsp;<span class="ident" id="5520397">color</span><span class="op" id="5520402">.</span><span class="ident" id="5520403">NRGBA</span><span class="op" id="5520408">{</span><span class="op" id="5520409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5520412">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520415">i</span>&nbsp;<span class="op" id="5520417">:=</span>&nbsp;<span class="ident" id="5520420">p</span><span class="op" id="5520421">.</span><span class="ident" id="5520422">PixOffset</span><span class="op" id="5520431">(</span><span class="ident" id="5520432">x</span><span class="op" id="5520433">,</span>&nbsp;<span class="ident" id="5520435">y</span><span class="op" id="5520436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5520439">return</span>&nbsp;<span class="ident" id="5520446">color</span><span class="op" id="5520451">.</span><span class="ident" id="5520452">NRGBA</span><span class="op" id="5520457">{</span><span class="ident" id="5520458">p</span><span class="op" id="5520459">.</span><span class="ident" id="5520460">Pix</span><span class="op" id="5520463">[</span><span class="ident" id="5520464">i</span><span class="op" id="5520465">+</span><span class="num" id="5520466">0</span><span class="op" id="5520467">]</span><span class="op" id="5520468">,</span>&nbsp;<span class="ident" id="5520470">p</span><span class="op" id="5520471">.</span><span class="ident" id="5520472">Pix</span><span class="op" id="5520475">[</span><span class="ident" id="5520476">i</span><span class="op" id="5520477">+</span><span class="num" id="5520478">1</span><span class="op" id="5520479">]</span><span class="op" id="5520480">,</span>&nbsp;<span class="ident" id="5520482">p</span><span class="op" id="5520483">.</span><span class="ident" id="5520484">Pix</span><span class="op" id="5520487">[</span><span class="ident" id="5520488">i</span><span class="op" id="5520489">+</span><span class="num" id="5520490">2</span><span class="op" id="5520491">]</span><span class="op" id="5520492">,</span>&nbsp;<span class="ident" id="5520494">p</span><span class="op" id="5520495">.</span><span class="ident" id="5520496">Pix</span><span class="op" id="5520499">[</span><span class="ident" id="5520500">i</span><span class="op" id="5520501">+</span><span class="num" id="5520502">3</span><span class="op" id="5520503">]</span><span class="op" id="5520504">}</span><br>
<span class="lineno">295</span><span class="op" id="5520506">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5520509">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5520588">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5520612">func</span>&nbsp;<span class="op" id="5520617">(</span><span class="ident" id="5520618">p</span>&nbsp;<span class="op" id="5520620">*</span><span class="ident" id="5520621">NRGBA</span><span class="op" id="5520626">)</span>&nbsp;<span class="ident" id="5520628">PixOffset</span><span class="op" id="5520637">(</span><span class="ident" id="5520638">x</span><span class="op" id="5520639">,</span>&nbsp;<span class="ident" id="5520641">y</span>&nbsp;<span class="builtintype" id="5520643">int</span><span class="op" id="5520646">)</span>&nbsp;<span class="builtintype" id="5520648">int</span>&nbsp;<span class="op" id="5520652">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5520655">return</span>&nbsp;<span class="op" id="5520662">(</span><span class="ident" id="5520663">y</span><span class="op" id="5520664">-</span><span class="ident" id="5520665">p</span><span class="op" id="5520666">.</span><span class="ident" id="5520667">Rect</span><span class="op" id="5520671">.</span><span class="ident" id="5520672">Min</span><span class="op" id="5520675">.</span><span class="ident" id="5520676">Y</span><span class="op" id="5520677">)</span><span class="op" id="5520678">*</span><span class="ident" id="5520679">p</span><span class="op" id="5520680">.</span><span class="ident" id="5520681">Stride</span>&nbsp;<span class="op" id="5520688">+</span>&nbsp;<span class="op" id="5520690">(</span><span class="ident" id="5520691">x</span><span class="op" id="5520692">-</span><span class="ident" id="5520693">p</span><span class="op" id="5520694">.</span><span class="ident" id="5520695">Rect</span><span class="op" id="5520699">.</span><span class="ident" id="5520700">Min</span><span class="op" id="5520703">.</span><span class="ident" id="5520704">X</span><span class="op" id="5520705">)</span><span class="op" id="5520706">*</span><span class="num" id="5520707">4</span><br>
<span class="lineno"></span><span class="op" id="5520709">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5520712">func</span>&nbsp;<span class="op" id="5520717">(</span><span class="ident" id="5520718">p</span>&nbsp;<span class="op" id="5520720">*</span><span class="ident" id="5520721">NRGBA</span><span class="op" id="5520726">)</span>&nbsp;<span class="ident" id="5520728">Set</span><span class="op" id="5520731">(</span><span class="ident" id="5520732">x</span><span class="op" id="5520733">,</span>&nbsp;<span class="ident" id="5520735">y</span>&nbsp;<span class="builtintype" id="5520737">int</span><span class="op" id="5520740">,</span>&nbsp;<span class="ident" id="5520742">c</span>&nbsp;<span class="ident" id="5520744">color</span><span class="op" id="5520749">.</span><span class="ident" id="5520750">Color</span><span class="op" id="5520755">)</span>&nbsp;<span class="op" id="5520757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5520760">if</span>&nbsp;<span class="op" id="5520763">!</span><span class="op" id="5520764">(</span><span class="ident" id="5520765">Point</span><span class="op" id="5520770">{</span><span class="ident" id="5520771">x</span><span class="op" id="5520772">,</span>&nbsp;<span class="ident" id="5520774">y</span><span class="op" id="5520775">}</span><span class="op" id="5520776">.</span><span class="ident" id="5520777">In</span><span class="op" id="5520779">(</span><span class="ident" id="5520780">p</span><span class="op" id="5520781">.</span><span class="ident" id="5520782">Rect</span><span class="op" id="5520786">)</span><span class="op" id="5520787">)</span>&nbsp;<span class="op" id="5520789">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5520793">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5520801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520804">i</span>&nbsp;<span class="op" id="5520806">:=</span>&nbsp;<span class="ident" id="5520809">p</span><span class="op" id="5520810">.</span><span class="ident" id="5520811">PixOffset</span><span class="op" id="5520820">(</span><span class="ident" id="5520821">x</span><span class="op" id="5520822">,</span>&nbsp;<span class="ident" id="5520824">y</span><span class="op" id="5520825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520828">c1</span>&nbsp;<span class="op" id="5520831">:=</span>&nbsp;<span class="ident" id="5520834">color</span><span class="op" id="5520839">.</span><span class="ident" id="5520840">NRGBAModel</span><span class="op" id="5520850">.</span><span class="ident" id="5520851">Convert</span><span class="op" id="5520858">(</span><span class="ident" id="5520859">c</span><span class="op" id="5520860">)</span><span class="op" id="5520861">.</span><span class="op" id="5520862">(</span><span class="ident" id="5520863">color</span><span class="op" id="5520868">.</span><span class="ident" id="5520869">NRGBA</span><span class="op" id="5520874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520877">p</span><span class="op" id="5520878">.</span><span class="ident" id="5520879">Pix</span><span class="op" id="5520882">[</span><span class="ident" id="5520883">i</span><span class="op" id="5520884">+</span><span class="num" id="5520885">0</span><span class="op" id="5520886">]</span>&nbsp;<span class="op" id="5520888">=</span>&nbsp;<span class="ident" id="5520890">c1</span><span class="op" id="5520892">.</span><span class="ident" id="5520893">R</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520896">p</span><span class="op" id="5520897">.</span><span class="ident" id="5520898">Pix</span><span class="op" id="5520901">[</span><span class="ident" id="5520902">i</span><span class="op" id="5520903">+</span><span class="num" id="5520904">1</span><span class="op" id="5520905">]</span>&nbsp;<span class="op" id="5520907">=</span>&nbsp;<span class="ident" id="5520909">c1</span><span class="op" id="5520911">.</span><span class="ident" id="5520912">G</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520915">p</span><span class="op" id="5520916">.</span><span class="ident" id="5520917">Pix</span><span class="op" id="5520920">[</span><span class="ident" id="5520921">i</span><span class="op" id="5520922">+</span><span class="num" id="5520923">2</span><span class="op" id="5520924">]</span>&nbsp;<span class="op" id="5520926">=</span>&nbsp;<span class="ident" id="5520928">c1</span><span class="op" id="5520930">.</span><span class="ident" id="5520931">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520934">p</span><span class="op" id="5520935">.</span><span class="ident" id="5520936">Pix</span><span class="op" id="5520939">[</span><span class="ident" id="5520940">i</span><span class="op" id="5520941">+</span><span class="num" id="5520942">3</span><span class="op" id="5520943">]</span>&nbsp;<span class="op" id="5520945">=</span>&nbsp;<span class="ident" id="5520947">c1</span><span class="op" id="5520949">.</span><span class="ident" id="5520950">A</span><br>
<span class="lineno"></span><span class="op" id="5520952">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="keyword" id="5520955">func</span>&nbsp;<span class="op" id="5520960">(</span><span class="ident" id="5520961">p</span>&nbsp;<span class="op" id="5520963">*</span><span class="ident" id="5520964">NRGBA</span><span class="op" id="5520969">)</span>&nbsp;<span class="ident" id="5520971">SetNRGBA</span><span class="op" id="5520979">(</span><span class="ident" id="5520980">x</span><span class="op" id="5520981">,</span>&nbsp;<span class="ident" id="5520983">y</span>&nbsp;<span class="builtintype" id="5520985">int</span><span class="op" id="5520988">,</span>&nbsp;<span class="ident" id="5520990">c</span>&nbsp;<span class="ident" id="5520992">color</span><span class="op" id="5520997">.</span><span class="ident" id="5520998">NRGBA</span><span class="op" id="5521003">)</span>&nbsp;<span class="op" id="5521005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5521008">if</span>&nbsp;<span class="op" id="5521011">!</span><span class="op" id="5521012">(</span><span class="ident" id="5521013">Point</span><span class="op" id="5521018">{</span><span class="ident" id="5521019">x</span><span class="op" id="5521020">,</span>&nbsp;<span class="ident" id="5521022">y</span><span class="op" id="5521023">}</span><span class="op" id="5521024">.</span><span class="ident" id="5521025">In</span><span class="op" id="5521027">(</span><span class="ident" id="5521028">p</span><span class="op" id="5521029">.</span><span class="ident" id="5521030">Rect</span><span class="op" id="5521034">)</span><span class="op" id="5521035">)</span>&nbsp;<span class="op" id="5521037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5521041">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5521049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5521052">i</span>&nbsp;<span class="op" id="5521054">:=</span>&nbsp;<span class="ident" id="5521057">p</span><span class="op" id="5521058">.</span><span class="ident" id="5521059">PixOffset</span><span class="op" id="5521068">(</span><span class="ident" id="5521069">x</span><span class="op" id="5521070">,</span>&nbsp;<span class="ident" id="5521072">y</span><span class="op" id="5521073">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5521076">p</span><span class="op" id="5521077">.</span><span class="ident" id="5521078">Pix</span><span class="op" id="5521081">[</span><span class="ident" id="5521082">i</span><span class="op" id="5521083">+</span><span class="num" id="5521084">0</span><span class="op" id="5521085">]</span>&nbsp;<span class="op" id="5521087">=</span>&nbsp;<span class="ident" id="5521089">c</span><span class="op" id="5521090">.</span><span class="ident" id="5521091">R</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5521094">p</span><span class="op" id="5521095">.</span><span class="ident" id="5521096">Pix</span><span class="op" id="5521099">[</span><span class="ident" id="5521100">i</span><span class="op" id="5521101">+</span><span class="num" id="5521102">1</span><span class="op" id="5521103">]</span>&nbsp;<span class="op" id="5521105">=</span>&nbsp;<span class="ident" id="5521107">c</span><span class="op" id="5521108">.</span><span class="ident" id="5521109">G</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5521112">p</span><span class="op" id="5521113">.</span><span class="ident" id="5521114">Pix</span><span class="op" id="5521117">[</span><span class="ident" id="5521118">i</span><span class="op" id="5521119">+</span><span class="num" id="5521120">2</span><span class="op" id="5521121">]</span>&nbsp;<span class="op" id="5521123">=</span>&nbsp;<span class="ident" id="5521125">c</span><span class="op" id="5521126">.</span><span class="ident" id="5521127">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5521130">p</span><span class="op" id="5521131">.</span><span class="ident" id="5521132">Pix</span><span class="op" id="5521135">[</span><span class="ident" id="5521136">i</span><span class="op" id="5521137">+</span><span class="num" id="5521138">3</span><span class="op" id="5521139">]</span>&nbsp;<span class="op" id="5521141">=</span>&nbsp;<span class="ident" id="5521143">c</span><span class="op" id="5521144">.</span><span class="ident" id="5521145">A</span><br>
<span class="lineno"></span><span class="op" id="5521147">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="comment" id="5521150">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5521227">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5521299">func</span>&nbsp;<span class="op" id="5521304">(</span><span class="ident" id="5521305">p</span>&nbsp;<span class="op" id="5521307">*</span><span class="ident" id="5521308">NRGBA</span><span class="op" id="5521313">)</span>&nbsp;<span class="ident" id="5521315">SubImage</span><span class="op" id="5521323">(</span><span class="ident" id="5521324">r</span>&nbsp;<span class="ident" id="5521326">Rectangle</span><span class="op" id="5521335">)</span>&nbsp;<span class="ident" id="5521337">Image</span>&nbsp;<span class="op" id="5521343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5521346">r</span>&nbsp;<span class="op" id="5521348">=</span>&nbsp;<span class="ident" id="5521350">r</span><span class="op" id="5521351">.</span><span class="ident" id="5521352">Intersect</span><span class="op" id="5521361">(</span><span class="ident" id="5521362">p</span><span class="op" id="5521363">.</span><span class="ident" id="5521364">Rect</span><span class="op" id="5521368">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5521371">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5521452">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5521534">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5521584">if</span>&nbsp;<span class="ident" id="5521587">r</span><span class="op" id="5521588">.</span><span class="ident" id="5521589">Empty</span><span class="op" id="5521594">(</span><span class="op" id="5521595">)</span>&nbsp;<span class="op" id="5521597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5521601">return</span>&nbsp;<span class="op" id="5521608">&amp;</span><span class="ident" id="5521609">NRGBA</span><span class="op" id="5521614">{</span><span class="op" id="5521615">}</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5521618">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5521621">i</span>&nbsp;<span class="op" id="5521623">:=</span>&nbsp;<span class="ident" id="5521626">p</span><span class="op" id="5521627">.</span><span class="ident" id="5521628">PixOffset</span><span class="op" id="5521637">(</span><span class="ident" id="5521638">r</span><span class="op" id="5521639">.</span><span class="ident" id="5521640">Min</span><span class="op" id="5521643">.</span><span class="ident" id="5521644">X</span><span class="op" id="5521645">,</span>&nbsp;<span class="ident" id="5521647">r</span><span class="op" id="5521648">.</span><span class="ident" id="5521649">Min</span><span class="op" id="5521652">.</span><span class="ident" id="5521653">Y</span><span class="op" id="5521654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5521657">return</span>&nbsp;<span class="op" id="5521664">&amp;</span><span class="ident" id="5521665">NRGBA</span><span class="op" id="5521670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5521674">Pix</span><span class="op" id="5521677">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5521682">p</span><span class="op" id="5521683">.</span><span class="ident" id="5521684">Pix</span><span class="op" id="5521687">[</span><span class="ident" id="5521688">i</span><span class="op" id="5521689">:</span><span class="op" id="5521690">]</span><span class="op" id="5521691">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5521695">Stride</span><span class="op" id="5521701">:</span>&nbsp;<span class="ident" id="5521703">p</span><span class="op" id="5521704">.</span><span class="ident" id="5521705">Stride</span><span class="op" id="5521711">,</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5521715">Rect</span><span class="op" id="5521719">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5521723">r</span><span class="op" id="5521724">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5521727">}</span><br>
<span class="lineno"></span><span class="op" id="5521729">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5521732">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno">345</span><span class="keyword" id="5521805">func</span>&nbsp;<span class="op" id="5521810">(</span><span class="ident" id="5521811">p</span>&nbsp;<span class="op" id="5521813">*</span><span class="ident" id="5521814">NRGBA</span><span class="op" id="5521819">)</span>&nbsp;<span class="ident" id="5521821">Opaque</span><span class="op" id="5521827">(</span><span class="op" id="5521828">)</span>&nbsp;<span class="builtintype" id="5521830">bool</span>&nbsp;<span class="op" id="5521835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5521838">if</span>&nbsp;<span class="ident" id="5521841">p</span><span class="op" id="5521842">.</span><span class="ident" id="5521843">Rect</span><span class="op" id="5521847">.</span><span class="ident" id="5521848">Empty</span><span class="op" id="5521853">(</span><span class="op" id="5521854">)</span>&nbsp;<span class="op" id="5521856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5521860">return</span>&nbsp;<span class="builtintype" id="5521867">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5521873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5521876">i0</span><span class="op" id="5521878">,</span>&nbsp;<span class="ident" id="5521880">i1</span>&nbsp;<span class="op" id="5521883">:=</span>&nbsp;<span class="num" id="5521886">3</span><span class="op" id="5521887">,</span>&nbsp;<span class="ident" id="5521889">p</span><span class="op" id="5521890">.</span><span class="ident" id="5521891">Rect</span><span class="op" id="5521895">.</span><span class="ident" id="5521896">Dx</span><span class="op" id="5521898">(</span><span class="op" id="5521899">)</span><span class="op" id="5521900">*</span><span class="num" id="5521901">4</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5521904">for</span>&nbsp;<span class="ident" id="5521908">y</span>&nbsp;<span class="op" id="5521910">:=</span>&nbsp;<span class="ident" id="5521913">p</span><span class="op" id="5521914">.</span><span class="ident" id="5521915">Rect</span><span class="op" id="5521919">.</span><span class="ident" id="5521920">Min</span><span class="op" id="5521923">.</span><span class="ident" id="5521924">Y</span><span class="op" id="5521925">;</span>&nbsp;<span class="ident" id="5521927">y</span>&nbsp;<span class="op" id="5521929">&lt;</span>&nbsp;<span class="ident" id="5521931">p</span><span class="op" id="5521932">.</span><span class="ident" id="5521933">Rect</span><span class="op" id="5521937">.</span><span class="ident" id="5521938">Max</span><span class="op" id="5521941">.</span><span class="ident" id="5521942">Y</span><span class="op" id="5521943">;</span>&nbsp;<span class="ident" id="5521945">y</span><span class="op" id="5521946">++</span>&nbsp;<span class="op" id="5521949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5521953">for</span>&nbsp;<span class="ident" id="5521957">i</span>&nbsp;<span class="op" id="5521959">:=</span>&nbsp;<span class="ident" id="5521962">i0</span><span class="op" id="5521964">;</span>&nbsp;<span class="ident" id="5521966">i</span>&nbsp;<span class="op" id="5521968">&lt;</span>&nbsp;<span class="ident" id="5521970">i1</span><span class="op" id="5521972">;</span>&nbsp;<span class="ident" id="5521974">i</span>&nbsp;<span class="op" id="5521976">+=</span>&nbsp;<span class="num" id="5521979">4</span>&nbsp;<span class="op" id="5521981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5521986">if</span>&nbsp;<span class="ident" id="5521989">p</span><span class="op" id="5521990">.</span><span class="ident" id="5521991">Pix</span><span class="op" id="5521994">[</span><span class="ident" id="5521995">i</span><span class="op" id="5521996">]</span>&nbsp;<span class="op" id="5521998">!=</span>&nbsp;<span class="num" id="5522001">0xff</span>&nbsp;<span class="op" id="5522006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5522012">return</span>&nbsp;<span class="builtintype" id="5522019">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5522028">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5522032">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522036">i0</span>&nbsp;<span class="op" id="5522039">+=</span>&nbsp;<span class="ident" id="5522042">p</span><span class="op" id="5522043">.</span><span class="ident" id="5522044">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522053">i1</span>&nbsp;<span class="op" id="5522056">+=</span>&nbsp;<span class="ident" id="5522059">p</span><span class="op" id="5522060">.</span><span class="ident" id="5522061">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5522069">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5522072">return</span>&nbsp;<span class="builtintype" id="5522079">true</span><br>
<span class="lineno">360</span><span class="op" id="5522084">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5522087">//&nbsp;NewNRGBA&nbsp;returns&nbsp;a&nbsp;new&nbsp;NRGBA&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="5522142">func</span>&nbsp;<span class="ident" id="5522147">NewNRGBA</span><span class="op" id="5522155">(</span><span class="ident" id="5522156">r</span>&nbsp;<span class="ident" id="5522158">Rectangle</span><span class="op" id="5522167">)</span>&nbsp;<span class="op" id="5522169">*</span><span class="ident" id="5522170">NRGBA</span>&nbsp;<span class="op" id="5522176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522179">w</span><span class="op" id="5522180">,</span>&nbsp;<span class="ident" id="5522182">h</span>&nbsp;<span class="op" id="5522184">:=</span>&nbsp;<span class="ident" id="5522187">r</span><span class="op" id="5522188">.</span><span class="ident" id="5522189">Dx</span><span class="op" id="5522191">(</span><span class="op" id="5522192">)</span><span class="op" id="5522193">,</span>&nbsp;<span class="ident" id="5522195">r</span><span class="op" id="5522196">.</span><span class="ident" id="5522197">Dy</span><span class="op" id="5522199">(</span><span class="op" id="5522200">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522203">pix</span>&nbsp;<span class="op" id="5522207">:=</span>&nbsp;<span class="builtinfunc" id="5522210">make</span><span class="op" id="5522214">(</span><span class="op" id="5522215">[</span><span class="op" id="5522216">]</span><span class="builtintype" id="5522217">uint8</span><span class="op" id="5522222">,</span>&nbsp;<span class="num" id="5522224">4</span><span class="op" id="5522225">*</span><span class="ident" id="5522226">w</span><span class="op" id="5522227">*</span><span class="ident" id="5522228">h</span><span class="op" id="5522229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5522232">return</span>&nbsp;<span class="op" id="5522239">&amp;</span><span class="ident" id="5522240">NRGBA</span><span class="op" id="5522245">{</span><span class="ident" id="5522246">pix</span><span class="op" id="5522249">,</span>&nbsp;<span class="num" id="5522251">4</span>&nbsp;<span class="op" id="5522253">*</span>&nbsp;<span class="ident" id="5522255">w</span><span class="op" id="5522256">,</span>&nbsp;<span class="ident" id="5522258">r</span><span class="op" id="5522259">}</span><br>
<span class="lineno"></span><span class="op" id="5522261">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5522264">//&nbsp;NRGBA64&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.NRGBA64&nbsp;values.</span><br>
<span class="lineno">370</span><span class="keyword" id="5522343">type</span>&nbsp;<span class="ident" id="5522348">NRGBA64</span>&nbsp;<span class="keyword" id="5522356">struct</span>&nbsp;<span class="op" id="5522363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5522366">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;in&nbsp;R,&nbsp;G,&nbsp;B,&nbsp;A&nbsp;order&nbsp;and&nbsp;big-endian&nbsp;format.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5522456">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*8].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522524">Pix</span>&nbsp;<span class="op" id="5522528">[</span><span class="op" id="5522529">]</span><span class="builtintype" id="5522530">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5522537">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522613">Stride</span>&nbsp;<span class="builtintype" id="5522620">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5522625">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522657">Rect</span>&nbsp;<span class="ident" id="5522662">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="5522672">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span><span class="keyword" id="5522675">func</span>&nbsp;<span class="op" id="5522680">(</span><span class="ident" id="5522681">p</span>&nbsp;<span class="op" id="5522683">*</span><span class="ident" id="5522684">NRGBA64</span><span class="op" id="5522691">)</span>&nbsp;<span class="ident" id="5522693">ColorModel</span><span class="op" id="5522703">(</span><span class="op" id="5522704">)</span>&nbsp;<span class="ident" id="5522706">color</span><span class="op" id="5522711">.</span><span class="ident" id="5522712">Model</span>&nbsp;<span class="op" id="5522718">{</span>&nbsp;<span class="keyword" id="5522720">return</span>&nbsp;<span class="ident" id="5522727">color</span><span class="op" id="5522732">.</span><span class="ident" id="5522733">NRGBA64Model</span>&nbsp;<span class="op" id="5522746">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5522749">func</span>&nbsp;<span class="op" id="5522754">(</span><span class="ident" id="5522755">p</span>&nbsp;<span class="op" id="5522757">*</span><span class="ident" id="5522758">NRGBA64</span><span class="op" id="5522765">)</span>&nbsp;<span class="ident" id="5522767">Bounds</span><span class="op" id="5522773">(</span><span class="op" id="5522774">)</span>&nbsp;<span class="ident" id="5522776">Rectangle</span>&nbsp;<span class="op" id="5522786">{</span>&nbsp;<span class="keyword" id="5522788">return</span>&nbsp;<span class="ident" id="5522795">p</span><span class="op" id="5522796">.</span><span class="ident" id="5522797">Rect</span>&nbsp;<span class="op" id="5522802">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5522805">func</span>&nbsp;<span class="op" id="5522810">(</span><span class="ident" id="5522811">p</span>&nbsp;<span class="op" id="5522813">*</span><span class="ident" id="5522814">NRGBA64</span><span class="op" id="5522821">)</span>&nbsp;<span class="ident" id="5522823">At</span><span class="op" id="5522825">(</span><span class="ident" id="5522826">x</span><span class="op" id="5522827">,</span>&nbsp;<span class="ident" id="5522829">y</span>&nbsp;<span class="builtintype" id="5522831">int</span><span class="op" id="5522834">)</span>&nbsp;<span class="ident" id="5522836">color</span><span class="op" id="5522841">.</span><span class="ident" id="5522842">Color</span>&nbsp;<span class="op" id="5522848">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5522851">return</span>&nbsp;<span class="ident" id="5522858">p</span><span class="op" id="5522859">.</span><span class="ident" id="5522860">NRGBA64At</span><span class="op" id="5522869">(</span><span class="ident" id="5522870">x</span><span class="op" id="5522871">,</span>&nbsp;<span class="ident" id="5522873">y</span><span class="op" id="5522874">)</span><br>
<span class="lineno"></span><span class="op" id="5522876">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5522879">func</span>&nbsp;<span class="op" id="5522884">(</span><span class="ident" id="5522885">p</span>&nbsp;<span class="op" id="5522887">*</span><span class="ident" id="5522888">NRGBA64</span><span class="op" id="5522895">)</span>&nbsp;<span class="ident" id="5522897">NRGBA64At</span><span class="op" id="5522906">(</span><span class="ident" id="5522907">x</span><span class="op" id="5522908">,</span>&nbsp;<span class="ident" id="5522910">y</span>&nbsp;<span class="builtintype" id="5522912">int</span><span class="op" id="5522915">)</span>&nbsp;<span class="ident" id="5522917">color</span><span class="op" id="5522922">.</span><span class="ident" id="5522923">NRGBA64</span>&nbsp;<span class="op" id="5522931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5522934">if</span>&nbsp;<span class="op" id="5522937">!</span><span class="op" id="5522938">(</span><span class="ident" id="5522939">Point</span><span class="op" id="5522944">{</span><span class="ident" id="5522945">x</span><span class="op" id="5522946">,</span>&nbsp;<span class="ident" id="5522948">y</span><span class="op" id="5522949">}</span><span class="op" id="5522950">.</span><span class="ident" id="5522951">In</span><span class="op" id="5522953">(</span><span class="ident" id="5522954">p</span><span class="op" id="5522955">.</span><span class="ident" id="5522956">Rect</span><span class="op" id="5522960">)</span><span class="op" id="5522961">)</span>&nbsp;<span class="op" id="5522963">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5522967">return</span>&nbsp;<span class="ident" id="5522974">color</span><span class="op" id="5522979">.</span><span class="ident" id="5522980">NRGBA64</span><span class="op" id="5522987">{</span><span class="op" id="5522988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5522991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522994">i</span>&nbsp;<span class="op" id="5522996">:=</span>&nbsp;<span class="ident" id="5522999">p</span><span class="op" id="5523000">.</span><span class="ident" id="5523001">PixOffset</span><span class="op" id="5523010">(</span><span class="ident" id="5523011">x</span><span class="op" id="5523012">,</span>&nbsp;<span class="ident" id="5523014">y</span><span class="op" id="5523015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5523018">return</span>&nbsp;<span class="ident" id="5523025">color</span><span class="op" id="5523030">.</span><span class="ident" id="5523031">NRGBA64</span><span class="op" id="5523038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5523042">uint16</span><span class="op" id="5523048">(</span><span class="ident" id="5523049">p</span><span class="op" id="5523050">.</span><span class="ident" id="5523051">Pix</span><span class="op" id="5523054">[</span><span class="ident" id="5523055">i</span><span class="op" id="5523056">+</span><span class="num" id="5523057">0</span><span class="op" id="5523058">]</span><span class="op" id="5523059">)</span><span class="op" id="5523060">&lt;&lt;</span><span class="num" id="5523062">8</span>&nbsp;<span class="op" id="5523064">|</span>&nbsp;<span class="builtintype" id="5523066">uint16</span><span class="op" id="5523072">(</span><span class="ident" id="5523073">p</span><span class="op" id="5523074">.</span><span class="ident" id="5523075">Pix</span><span class="op" id="5523078">[</span><span class="ident" id="5523079">i</span><span class="op" id="5523080">+</span><span class="num" id="5523081">1</span><span class="op" id="5523082">]</span><span class="op" id="5523083">)</span><span class="op" id="5523084">,</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5523088">uint16</span><span class="op" id="5523094">(</span><span class="ident" id="5523095">p</span><span class="op" id="5523096">.</span><span class="ident" id="5523097">Pix</span><span class="op" id="5523100">[</span><span class="ident" id="5523101">i</span><span class="op" id="5523102">+</span><span class="num" id="5523103">2</span><span class="op" id="5523104">]</span><span class="op" id="5523105">)</span><span class="op" id="5523106">&lt;&lt;</span><span class="num" id="5523108">8</span>&nbsp;<span class="op" id="5523110">|</span>&nbsp;<span class="builtintype" id="5523112">uint16</span><span class="op" id="5523118">(</span><span class="ident" id="5523119">p</span><span class="op" id="5523120">.</span><span class="ident" id="5523121">Pix</span><span class="op" id="5523124">[</span><span class="ident" id="5523125">i</span><span class="op" id="5523126">+</span><span class="num" id="5523127">3</span><span class="op" id="5523128">]</span><span class="op" id="5523129">)</span><span class="op" id="5523130">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5523134">uint16</span><span class="op" id="5523140">(</span><span class="ident" id="5523141">p</span><span class="op" id="5523142">.</span><span class="ident" id="5523143">Pix</span><span class="op" id="5523146">[</span><span class="ident" id="5523147">i</span><span class="op" id="5523148">+</span><span class="num" id="5523149">4</span><span class="op" id="5523150">]</span><span class="op" id="5523151">)</span><span class="op" id="5523152">&lt;&lt;</span><span class="num" id="5523154">8</span>&nbsp;<span class="op" id="5523156">|</span>&nbsp;<span class="builtintype" id="5523158">uint16</span><span class="op" id="5523164">(</span><span class="ident" id="5523165">p</span><span class="op" id="5523166">.</span><span class="ident" id="5523167">Pix</span><span class="op" id="5523170">[</span><span class="ident" id="5523171">i</span><span class="op" id="5523172">+</span><span class="num" id="5523173">5</span><span class="op" id="5523174">]</span><span class="op" id="5523175">)</span><span class="op" id="5523176">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5523180">uint16</span><span class="op" id="5523186">(</span><span class="ident" id="5523187">p</span><span class="op" id="5523188">.</span><span class="ident" id="5523189">Pix</span><span class="op" id="5523192">[</span><span class="ident" id="5523193">i</span><span class="op" id="5523194">+</span><span class="num" id="5523195">6</span><span class="op" id="5523196">]</span><span class="op" id="5523197">)</span><span class="op" id="5523198">&lt;&lt;</span><span class="num" id="5523200">8</span>&nbsp;<span class="op" id="5523202">|</span>&nbsp;<span class="builtintype" id="5523204">uint16</span><span class="op" id="5523210">(</span><span class="ident" id="5523211">p</span><span class="op" id="5523212">.</span><span class="ident" id="5523213">Pix</span><span class="op" id="5523216">[</span><span class="ident" id="5523217">i</span><span class="op" id="5523218">+</span><span class="num" id="5523219">7</span><span class="op" id="5523220">]</span><span class="op" id="5523221">)</span><span class="op" id="5523222">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5523225">}</span><br>
<span class="lineno"></span><span class="op" id="5523227">}</span><br>
<span class="lineno">400</span><br>
<span class="lineno"></span><span class="comment" id="5523230">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5523309">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5523333">func</span>&nbsp;<span class="op" id="5523338">(</span><span class="ident" id="5523339">p</span>&nbsp;<span class="op" id="5523341">*</span><span class="ident" id="5523342">NRGBA64</span><span class="op" id="5523349">)</span>&nbsp;<span class="ident" id="5523351">PixOffset</span><span class="op" id="5523360">(</span><span class="ident" id="5523361">x</span><span class="op" id="5523362">,</span>&nbsp;<span class="ident" id="5523364">y</span>&nbsp;<span class="builtintype" id="5523366">int</span><span class="op" id="5523369">)</span>&nbsp;<span class="builtintype" id="5523371">int</span>&nbsp;<span class="op" id="5523375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5523378">return</span>&nbsp;<span class="op" id="5523385">(</span><span class="ident" id="5523386">y</span><span class="op" id="5523387">-</span><span class="ident" id="5523388">p</span><span class="op" id="5523389">.</span><span class="ident" id="5523390">Rect</span><span class="op" id="5523394">.</span><span class="ident" id="5523395">Min</span><span class="op" id="5523398">.</span><span class="ident" id="5523399">Y</span><span class="op" id="5523400">)</span><span class="op" id="5523401">*</span><span class="ident" id="5523402">p</span><span class="op" id="5523403">.</span><span class="ident" id="5523404">Stride</span>&nbsp;<span class="op" id="5523411">+</span>&nbsp;<span class="op" id="5523413">(</span><span class="ident" id="5523414">x</span><span class="op" id="5523415">-</span><span class="ident" id="5523416">p</span><span class="op" id="5523417">.</span><span class="ident" id="5523418">Rect</span><span class="op" id="5523422">.</span><span class="ident" id="5523423">Min</span><span class="op" id="5523426">.</span><span class="ident" id="5523427">X</span><span class="op" id="5523428">)</span><span class="op" id="5523429">*</span><span class="num" id="5523430">8</span><br>
<span class="lineno">405</span><span class="op" id="5523432">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5523435">func</span>&nbsp;<span class="op" id="5523440">(</span><span class="ident" id="5523441">p</span>&nbsp;<span class="op" id="5523443">*</span><span class="ident" id="5523444">NRGBA64</span><span class="op" id="5523451">)</span>&nbsp;<span class="ident" id="5523453">Set</span><span class="op" id="5523456">(</span><span class="ident" id="5523457">x</span><span class="op" id="5523458">,</span>&nbsp;<span class="ident" id="5523460">y</span>&nbsp;<span class="builtintype" id="5523462">int</span><span class="op" id="5523465">,</span>&nbsp;<span class="ident" id="5523467">c</span>&nbsp;<span class="ident" id="5523469">color</span><span class="op" id="5523474">.</span><span class="ident" id="5523475">Color</span><span class="op" id="5523480">)</span>&nbsp;<span class="op" id="5523482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5523485">if</span>&nbsp;<span class="op" id="5523488">!</span><span class="op" id="5523489">(</span><span class="ident" id="5523490">Point</span><span class="op" id="5523495">{</span><span class="ident" id="5523496">x</span><span class="op" id="5523497">,</span>&nbsp;<span class="ident" id="5523499">y</span><span class="op" id="5523500">}</span><span class="op" id="5523501">.</span><span class="ident" id="5523502">In</span><span class="op" id="5523504">(</span><span class="ident" id="5523505">p</span><span class="op" id="5523506">.</span><span class="ident" id="5523507">Rect</span><span class="op" id="5523511">)</span><span class="op" id="5523512">)</span>&nbsp;<span class="op" id="5523514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5523518">return</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5523526">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523529">i</span>&nbsp;<span class="op" id="5523531">:=</span>&nbsp;<span class="ident" id="5523534">p</span><span class="op" id="5523535">.</span><span class="ident" id="5523536">PixOffset</span><span class="op" id="5523545">(</span><span class="ident" id="5523546">x</span><span class="op" id="5523547">,</span>&nbsp;<span class="ident" id="5523549">y</span><span class="op" id="5523550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523553">c1</span>&nbsp;<span class="op" id="5523556">:=</span>&nbsp;<span class="ident" id="5523559">color</span><span class="op" id="5523564">.</span><span class="ident" id="5523565">NRGBA64Model</span><span class="op" id="5523577">.</span><span class="ident" id="5523578">Convert</span><span class="op" id="5523585">(</span><span class="ident" id="5523586">c</span><span class="op" id="5523587">)</span><span class="op" id="5523588">.</span><span class="op" id="5523589">(</span><span class="ident" id="5523590">color</span><span class="op" id="5523595">.</span><span class="ident" id="5523596">NRGBA64</span><span class="op" id="5523603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523606">p</span><span class="op" id="5523607">.</span><span class="ident" id="5523608">Pix</span><span class="op" id="5523611">[</span><span class="ident" id="5523612">i</span><span class="op" id="5523613">+</span><span class="num" id="5523614">0</span><span class="op" id="5523615">]</span>&nbsp;<span class="op" id="5523617">=</span>&nbsp;<span class="builtintype" id="5523619">uint8</span><span class="op" id="5523624">(</span><span class="ident" id="5523625">c1</span><span class="op" id="5523627">.</span><span class="ident" id="5523628">R</span>&nbsp;<span class="op" id="5523630">&gt;&gt;</span>&nbsp;<span class="num" id="5523633">8</span><span class="op" id="5523634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523637">p</span><span class="op" id="5523638">.</span><span class="ident" id="5523639">Pix</span><span class="op" id="5523642">[</span><span class="ident" id="5523643">i</span><span class="op" id="5523644">+</span><span class="num" id="5523645">1</span><span class="op" id="5523646">]</span>&nbsp;<span class="op" id="5523648">=</span>&nbsp;<span class="builtintype" id="5523650">uint8</span><span class="op" id="5523655">(</span><span class="ident" id="5523656">c1</span><span class="op" id="5523658">.</span><span class="ident" id="5523659">R</span><span class="op" id="5523660">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523663">p</span><span class="op" id="5523664">.</span><span class="ident" id="5523665">Pix</span><span class="op" id="5523668">[</span><span class="ident" id="5523669">i</span><span class="op" id="5523670">+</span><span class="num" id="5523671">2</span><span class="op" id="5523672">]</span>&nbsp;<span class="op" id="5523674">=</span>&nbsp;<span class="builtintype" id="5523676">uint8</span><span class="op" id="5523681">(</span><span class="ident" id="5523682">c1</span><span class="op" id="5523684">.</span><span class="ident" id="5523685">G</span>&nbsp;<span class="op" id="5523687">&gt;&gt;</span>&nbsp;<span class="num" id="5523690">8</span><span class="op" id="5523691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523694">p</span><span class="op" id="5523695">.</span><span class="ident" id="5523696">Pix</span><span class="op" id="5523699">[</span><span class="ident" id="5523700">i</span><span class="op" id="5523701">+</span><span class="num" id="5523702">3</span><span class="op" id="5523703">]</span>&nbsp;<span class="op" id="5523705">=</span>&nbsp;<span class="builtintype" id="5523707">uint8</span><span class="op" id="5523712">(</span><span class="ident" id="5523713">c1</span><span class="op" id="5523715">.</span><span class="ident" id="5523716">G</span><span class="op" id="5523717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523720">p</span><span class="op" id="5523721">.</span><span class="ident" id="5523722">Pix</span><span class="op" id="5523725">[</span><span class="ident" id="5523726">i</span><span class="op" id="5523727">+</span><span class="num" id="5523728">4</span><span class="op" id="5523729">]</span>&nbsp;<span class="op" id="5523731">=</span>&nbsp;<span class="builtintype" id="5523733">uint8</span><span class="op" id="5523738">(</span><span class="ident" id="5523739">c1</span><span class="op" id="5523741">.</span><span class="ident" id="5523742">B</span>&nbsp;<span class="op" id="5523744">&gt;&gt;</span>&nbsp;<span class="num" id="5523747">8</span><span class="op" id="5523748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523751">p</span><span class="op" id="5523752">.</span><span class="ident" id="5523753">Pix</span><span class="op" id="5523756">[</span><span class="ident" id="5523757">i</span><span class="op" id="5523758">+</span><span class="num" id="5523759">5</span><span class="op" id="5523760">]</span>&nbsp;<span class="op" id="5523762">=</span>&nbsp;<span class="builtintype" id="5523764">uint8</span><span class="op" id="5523769">(</span><span class="ident" id="5523770">c1</span><span class="op" id="5523772">.</span><span class="ident" id="5523773">B</span><span class="op" id="5523774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523777">p</span><span class="op" id="5523778">.</span><span class="ident" id="5523779">Pix</span><span class="op" id="5523782">[</span><span class="ident" id="5523783">i</span><span class="op" id="5523784">+</span><span class="num" id="5523785">6</span><span class="op" id="5523786">]</span>&nbsp;<span class="op" id="5523788">=</span>&nbsp;<span class="builtintype" id="5523790">uint8</span><span class="op" id="5523795">(</span><span class="ident" id="5523796">c1</span><span class="op" id="5523798">.</span><span class="ident" id="5523799">A</span>&nbsp;<span class="op" id="5523801">&gt;&gt;</span>&nbsp;<span class="num" id="5523804">8</span><span class="op" id="5523805">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523808">p</span><span class="op" id="5523809">.</span><span class="ident" id="5523810">Pix</span><span class="op" id="5523813">[</span><span class="ident" id="5523814">i</span><span class="op" id="5523815">+</span><span class="num" id="5523816">7</span><span class="op" id="5523817">]</span>&nbsp;<span class="op" id="5523819">=</span>&nbsp;<span class="builtintype" id="5523821">uint8</span><span class="op" id="5523826">(</span><span class="ident" id="5523827">c1</span><span class="op" id="5523829">.</span><span class="ident" id="5523830">A</span><span class="op" id="5523831">)</span><br>
<span class="lineno"></span><span class="op" id="5523833">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5523836">func</span>&nbsp;<span class="op" id="5523841">(</span><span class="ident" id="5523842">p</span>&nbsp;<span class="op" id="5523844">*</span><span class="ident" id="5523845">NRGBA64</span><span class="op" id="5523852">)</span>&nbsp;<span class="ident" id="5523854">SetNRGBA64</span><span class="op" id="5523864">(</span><span class="ident" id="5523865">x</span><span class="op" id="5523866">,</span>&nbsp;<span class="ident" id="5523868">y</span>&nbsp;<span class="builtintype" id="5523870">int</span><span class="op" id="5523873">,</span>&nbsp;<span class="ident" id="5523875">c</span>&nbsp;<span class="ident" id="5523877">color</span><span class="op" id="5523882">.</span><span class="ident" id="5523883">NRGBA64</span><span class="op" id="5523890">)</span>&nbsp;<span class="op" id="5523892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5523895">if</span>&nbsp;<span class="op" id="5523898">!</span><span class="op" id="5523899">(</span><span class="ident" id="5523900">Point</span><span class="op" id="5523905">{</span><span class="ident" id="5523906">x</span><span class="op" id="5523907">,</span>&nbsp;<span class="ident" id="5523909">y</span><span class="op" id="5523910">}</span><span class="op" id="5523911">.</span><span class="ident" id="5523912">In</span><span class="op" id="5523914">(</span><span class="ident" id="5523915">p</span><span class="op" id="5523916">.</span><span class="ident" id="5523917">Rect</span><span class="op" id="5523921">)</span><span class="op" id="5523922">)</span>&nbsp;<span class="op" id="5523924">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5523928">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5523936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523939">i</span>&nbsp;<span class="op" id="5523941">:=</span>&nbsp;<span class="ident" id="5523944">p</span><span class="op" id="5523945">.</span><span class="ident" id="5523946">PixOffset</span><span class="op" id="5523955">(</span><span class="ident" id="5523956">x</span><span class="op" id="5523957">,</span>&nbsp;<span class="ident" id="5523959">y</span><span class="op" id="5523960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523963">p</span><span class="op" id="5523964">.</span><span class="ident" id="5523965">Pix</span><span class="op" id="5523968">[</span><span class="ident" id="5523969">i</span><span class="op" id="5523970">+</span><span class="num" id="5523971">0</span><span class="op" id="5523972">]</span>&nbsp;<span class="op" id="5523974">=</span>&nbsp;<span class="builtintype" id="5523976">uint8</span><span class="op" id="5523981">(</span><span class="ident" id="5523982">c</span><span class="op" id="5523983">.</span><span class="ident" id="5523984">R</span>&nbsp;<span class="op" id="5523986">&gt;&gt;</span>&nbsp;<span class="num" id="5523989">8</span><span class="op" id="5523990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523993">p</span><span class="op" id="5523994">.</span><span class="ident" id="5523995">Pix</span><span class="op" id="5523998">[</span><span class="ident" id="5523999">i</span><span class="op" id="5524000">+</span><span class="num" id="5524001">1</span><span class="op" id="5524002">]</span>&nbsp;<span class="op" id="5524004">=</span>&nbsp;<span class="builtintype" id="5524006">uint8</span><span class="op" id="5524011">(</span><span class="ident" id="5524012">c</span><span class="op" id="5524013">.</span><span class="ident" id="5524014">R</span><span class="op" id="5524015">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5524018">p</span><span class="op" id="5524019">.</span><span class="ident" id="5524020">Pix</span><span class="op" id="5524023">[</span><span class="ident" id="5524024">i</span><span class="op" id="5524025">+</span><span class="num" id="5524026">2</span><span class="op" id="5524027">]</span>&nbsp;<span class="op" id="5524029">=</span>&nbsp;<span class="builtintype" id="5524031">uint8</span><span class="op" id="5524036">(</span><span class="ident" id="5524037">c</span><span class="op" id="5524038">.</span><span class="ident" id="5524039">G</span>&nbsp;<span class="op" id="5524041">&gt;&gt;</span>&nbsp;<span class="num" id="5524044">8</span><span class="op" id="5524045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5524048">p</span><span class="op" id="5524049">.</span><span class="ident" id="5524050">Pix</span><span class="op" id="5524053">[</span><span class="ident" id="5524054">i</span><span class="op" id="5524055">+</span><span class="num" id="5524056">3</span><span class="op" id="5524057">]</span>&nbsp;<span class="op" id="5524059">=</span>&nbsp;<span class="builtintype" id="5524061">uint8</span><span class="op" id="5524066">(</span><span class="ident" id="5524067">c</span><span class="op" id="5524068">.</span><span class="ident" id="5524069">G</span><span class="op" id="5524070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5524073">p</span><span class="op" id="5524074">.</span><span class="ident" id="5524075">Pix</span><span class="op" id="5524078">[</span><span class="ident" id="5524079">i</span><span class="op" id="5524080">+</span><span class="num" id="5524081">4</span><span class="op" id="5524082">]</span>&nbsp;<span class="op" id="5524084">=</span>&nbsp;<span class="builtintype" id="5524086">uint8</span><span class="op" id="5524091">(</span><span class="ident" id="5524092">c</span><span class="op" id="5524093">.</span><span class="ident" id="5524094">B</span>&nbsp;<span class="op" id="5524096">&gt;&gt;</span>&nbsp;<span class="num" id="5524099">8</span><span class="op" id="5524100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5524103">p</span><span class="op" id="5524104">.</span><span class="ident" id="5524105">Pix</span><span class="op" id="5524108">[</span><span class="ident" id="5524109">i</span><span class="op" id="5524110">+</span><span class="num" id="5524111">5</span><span class="op" id="5524112">]</span>&nbsp;<span class="op" id="5524114">=</span>&nbsp;<span class="builtintype" id="5524116">uint8</span><span class="op" id="5524121">(</span><span class="ident" id="5524122">c</span><span class="op" id="5524123">.</span><span class="ident" id="5524124">B</span><span class="op" id="5524125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5524128">p</span><span class="op" id="5524129">.</span><span class="ident" id="5524130">Pix</span><span class="op" id="5524133">[</span><span class="ident" id="5524134">i</span><span class="op" id="5524135">+</span><span class="num" id="5524136">6</span><span class="op" id="5524137">]</span>&nbsp;<span class="op" id="5524139">=</span>&nbsp;<span class="builtintype" id="5524141">uint8</span><span class="op" id="5524146">(</span><span class="ident" id="5524147">c</span><span class="op" id="5524148">.</span><span class="ident" id="5524149">A</span>&nbsp;<span class="op" id="5524151">&gt;&gt;</span>&nbsp;<span class="num" id="5524154">8</span><span class="op" id="5524155">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5524158">p</span><span class="op" id="5524159">.</span><span class="ident" id="5524160">Pix</span><span class="op" id="5524163">[</span><span class="ident" id="5524164">i</span><span class="op" id="5524165">+</span><span class="num" id="5524166">7</span><span class="op" id="5524167">]</span>&nbsp;<span class="op" id="5524169">=</span>&nbsp;<span class="builtintype" id="5524171">uint8</span><span class="op" id="5524176">(</span><span class="ident" id="5524177">c</span><span class="op" id="5524178">.</span><span class="ident" id="5524179">A</span><span class="op" id="5524180">)</span><br>
<span class="lineno"></span><span class="op" id="5524182">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5524185">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5524262">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno">440</span><span class="keyword" id="5524334">func</span>&nbsp;<span class="op" id="5524339">(</span><span class="ident" id="5524340">p</span>&nbsp;<span class="op" id="5524342">*</span><span class="ident" id="5524343">NRGBA64</span><span class="op" id="5524350">)</span>&nbsp;<span class="ident" id="5524352">SubImage</span><span class="op" id="5524360">(</span><span class="ident" id="5524361">r</span>&nbsp;<span class="ident" id="5524363">Rectangle</span><span class="op" id="5524372">)</span>&nbsp;<span class="ident" id="5524374">Image</span>&nbsp;<span class="op" id="5524380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5524383">r</span>&nbsp;<span class="op" id="5524385">=</span>&nbsp;<span class="ident" id="5524387">r</span><span class="op" id="5524388">.</span><span class="ident" id="5524389">Intersect</span><span class="op" id="5524398">(</span><span class="ident" id="5524399">p</span><span class="op" id="5524400">.</span><span class="ident" id="5524401">Rect</span><span class="op" id="5524405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5524408">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5524489">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5524571">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5524621">if</span>&nbsp;<span class="ident" id="5524624">r</span><span class="op" id="5524625">.</span><span class="ident" id="5524626">Empty</span><span class="op" id="5524631">(</span><span class="op" id="5524632">)</span>&nbsp;<span class="op" id="5524634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5524638">return</span>&nbsp;<span class="op" id="5524645">&amp;</span><span class="ident" id="5524646">NRGBA64</span><span class="op" id="5524653">{</span><span class="op" id="5524654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5524657">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5524660">i</span>&nbsp;<span class="op" id="5524662">:=</span>&nbsp;<span class="ident" id="5524665">p</span><span class="op" id="5524666">.</span><span class="ident" id="5524667">PixOffset</span><span class="op" id="5524676">(</span><span class="ident" id="5524677">r</span><span class="op" id="5524678">.</span><span class="ident" id="5524679">Min</span><span class="op" id="5524682">.</span><span class="ident" id="5524683">X</span><span class="op" id="5524684">,</span>&nbsp;<span class="ident" id="5524686">r</span><span class="op" id="5524687">.</span><span class="ident" id="5524688">Min</span><span class="op" id="5524691">.</span><span class="ident" id="5524692">Y</span><span class="op" id="5524693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5524696">return</span>&nbsp;<span class="op" id="5524703">&amp;</span><span class="ident" id="5524704">NRGBA64</span><span class="op" id="5524711">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5524715">Pix</span><span class="op" id="5524718">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5524723">p</span><span class="op" id="5524724">.</span><span class="ident" id="5524725">Pix</span><span class="op" id="5524728">[</span><span class="ident" id="5524729">i</span><span class="op" id="5524730">:</span><span class="op" id="5524731">]</span><span class="op" id="5524732">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5524736">Stride</span><span class="op" id="5524742">:</span>&nbsp;<span class="ident" id="5524744">p</span><span class="op" id="5524745">.</span><span class="ident" id="5524746">Stride</span><span class="op" id="5524752">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5524756">Rect</span><span class="op" id="5524760">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5524764">r</span><span class="op" id="5524765">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5524768">}</span><br>
<span class="lineno"></span><span class="op" id="5524770">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="comment" id="5524773">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5524846">func</span>&nbsp;<span class="op" id="5524851">(</span><span class="ident" id="5524852">p</span>&nbsp;<span class="op" id="5524854">*</span><span class="ident" id="5524855">NRGBA64</span><span class="op" id="5524862">)</span>&nbsp;<span class="ident" id="5524864">Opaque</span><span class="op" id="5524870">(</span><span class="op" id="5524871">)</span>&nbsp;<span class="builtintype" id="5524873">bool</span>&nbsp;<span class="op" id="5524878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5524881">if</span>&nbsp;<span class="ident" id="5524884">p</span><span class="op" id="5524885">.</span><span class="ident" id="5524886">Rect</span><span class="op" id="5524890">.</span><span class="ident" id="5524891">Empty</span><span class="op" id="5524896">(</span><span class="op" id="5524897">)</span>&nbsp;<span class="op" id="5524899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5524903">return</span>&nbsp;<span class="builtintype" id="5524910">true</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5524916">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5524919">i0</span><span class="op" id="5524921">,</span>&nbsp;<span class="ident" id="5524923">i1</span>&nbsp;<span class="op" id="5524926">:=</span>&nbsp;<span class="num" id="5524929">6</span><span class="op" id="5524930">,</span>&nbsp;<span class="ident" id="5524932">p</span><span class="op" id="5524933">.</span><span class="ident" id="5524934">Rect</span><span class="op" id="5524938">.</span><span class="ident" id="5524939">Dx</span><span class="op" id="5524941">(</span><span class="op" id="5524942">)</span><span class="op" id="5524943">*</span><span class="num" id="5524944">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5524947">for</span>&nbsp;<span class="ident" id="5524951">y</span>&nbsp;<span class="op" id="5524953">:=</span>&nbsp;<span class="ident" id="5524956">p</span><span class="op" id="5524957">.</span><span class="ident" id="5524958">Rect</span><span class="op" id="5524962">.</span><span class="ident" id="5524963">Min</span><span class="op" id="5524966">.</span><span class="ident" id="5524967">Y</span><span class="op" id="5524968">;</span>&nbsp;<span class="ident" id="5524970">y</span>&nbsp;<span class="op" id="5524972">&lt;</span>&nbsp;<span class="ident" id="5524974">p</span><span class="op" id="5524975">.</span><span class="ident" id="5524976">Rect</span><span class="op" id="5524980">.</span><span class="ident" id="5524981">Max</span><span class="op" id="5524984">.</span><span class="ident" id="5524985">Y</span><span class="op" id="5524986">;</span>&nbsp;<span class="ident" id="5524988">y</span><span class="op" id="5524989">++</span>&nbsp;<span class="op" id="5524992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5524996">for</span>&nbsp;<span class="ident" id="5525000">i</span>&nbsp;<span class="op" id="5525002">:=</span>&nbsp;<span class="ident" id="5525005">i0</span><span class="op" id="5525007">;</span>&nbsp;<span class="ident" id="5525009">i</span>&nbsp;<span class="op" id="5525011">&lt;</span>&nbsp;<span class="ident" id="5525013">i1</span><span class="op" id="5525015">;</span>&nbsp;<span class="ident" id="5525017">i</span>&nbsp;<span class="op" id="5525019">+=</span>&nbsp;<span class="num" id="5525022">8</span>&nbsp;<span class="op" id="5525024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5525029">if</span>&nbsp;<span class="ident" id="5525032">p</span><span class="op" id="5525033">.</span><span class="ident" id="5525034">Pix</span><span class="op" id="5525037">[</span><span class="ident" id="5525038">i</span><span class="op" id="5525039">+</span><span class="num" id="5525040">0</span><span class="op" id="5525041">]</span>&nbsp;<span class="op" id="5525043">!=</span>&nbsp;<span class="num" id="5525046">0xff</span>&nbsp;<span class="op" id="5525051">||</span>&nbsp;<span class="ident" id="5525054">p</span><span class="op" id="5525055">.</span><span class="ident" id="5525056">Pix</span><span class="op" id="5525059">[</span><span class="ident" id="5525060">i</span><span class="op" id="5525061">+</span><span class="num" id="5525062">1</span><span class="op" id="5525063">]</span>&nbsp;<span class="op" id="5525065">!=</span>&nbsp;<span class="num" id="5525068">0xff</span>&nbsp;<span class="op" id="5525073">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5525079">return</span>&nbsp;<span class="builtintype" id="5525086">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5525095">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5525099">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5525103">i0</span>&nbsp;<span class="op" id="5525106">+=</span>&nbsp;<span class="ident" id="5525109">p</span><span class="op" id="5525110">.</span><span class="ident" id="5525111">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5525120">i1</span>&nbsp;<span class="op" id="5525123">+=</span>&nbsp;<span class="ident" id="5525126">p</span><span class="op" id="5525127">.</span><span class="ident" id="5525128">Stride</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5525136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5525139">return</span>&nbsp;<span class="builtintype" id="5525146">true</span><br>
<span class="lineno"></span><span class="op" id="5525151">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5525154">//&nbsp;NewNRGBA64&nbsp;returns&nbsp;a&nbsp;new&nbsp;NRGBA64&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno">475</span><span class="keyword" id="5525213">func</span>&nbsp;<span class="ident" id="5525218">NewNRGBA64</span><span class="op" id="5525228">(</span><span class="ident" id="5525229">r</span>&nbsp;<span class="ident" id="5525231">Rectangle</span><span class="op" id="5525240">)</span>&nbsp;<span class="op" id="5525242">*</span><span class="ident" id="5525243">NRGBA64</span>&nbsp;<span class="op" id="5525251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5525254">w</span><span class="op" id="5525255">,</span>&nbsp;<span class="ident" id="5525257">h</span>&nbsp;<span class="op" id="5525259">:=</span>&nbsp;<span class="ident" id="5525262">r</span><span class="op" id="5525263">.</span><span class="ident" id="5525264">Dx</span><span class="op" id="5525266">(</span><span class="op" id="5525267">)</span><span class="op" id="5525268">,</span>&nbsp;<span class="ident" id="5525270">r</span><span class="op" id="5525271">.</span><span class="ident" id="5525272">Dy</span><span class="op" id="5525274">(</span><span class="op" id="5525275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5525278">pix</span>&nbsp;<span class="op" id="5525282">:=</span>&nbsp;<span class="builtinfunc" id="5525285">make</span><span class="op" id="5525289">(</span><span class="op" id="5525290">[</span><span class="op" id="5525291">]</span><span class="builtintype" id="5525292">uint8</span><span class="op" id="5525297">,</span>&nbsp;<span class="num" id="5525299">8</span><span class="op" id="5525300">*</span><span class="ident" id="5525301">w</span><span class="op" id="5525302">*</span><span class="ident" id="5525303">h</span><span class="op" id="5525304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5525307">return</span>&nbsp;<span class="op" id="5525314">&amp;</span><span class="ident" id="5525315">NRGBA64</span><span class="op" id="5525322">{</span><span class="ident" id="5525323">pix</span><span class="op" id="5525326">,</span>&nbsp;<span class="num" id="5525328">8</span>&nbsp;<span class="op" id="5525330">*</span>&nbsp;<span class="ident" id="5525332">w</span><span class="op" id="5525333">,</span>&nbsp;<span class="ident" id="5525335">r</span><span class="op" id="5525336">}</span><br>
<span class="lineno"></span><span class="op" id="5525338">}</span><br>
<span class="lineno">480</span><br>
<span class="lineno"></span><span class="comment" id="5525341">//&nbsp;Alpha&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.Alpha&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5525416">type</span>&nbsp;<span class="ident" id="5525421">Alpha</span>&nbsp;<span class="keyword" id="5525427">struct</span>&nbsp;<span class="op" id="5525434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5525437">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;alpha&nbsp;values.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5525501">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*1].</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5525569">Pix</span>&nbsp;<span class="op" id="5525573">[</span><span class="op" id="5525574">]</span><span class="builtintype" id="5525575">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5525582">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5525658">Stride</span>&nbsp;<span class="builtintype" id="5525665">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5525670">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5525702">Rect</span>&nbsp;<span class="ident" id="5525707">Rectangle</span><br>
<span class="lineno">490</span><span class="op" id="5525717">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5525720">func</span>&nbsp;<span class="op" id="5525725">(</span><span class="ident" id="5525726">p</span>&nbsp;<span class="op" id="5525728">*</span><span class="ident" id="5525729">Alpha</span><span class="op" id="5525734">)</span>&nbsp;<span class="ident" id="5525736">ColorModel</span><span class="op" id="5525746">(</span><span class="op" id="5525747">)</span>&nbsp;<span class="ident" id="5525749">color</span><span class="op" id="5525754">.</span><span class="ident" id="5525755">Model</span>&nbsp;<span class="op" id="5525761">{</span>&nbsp;<span class="keyword" id="5525763">return</span>&nbsp;<span class="ident" id="5525770">color</span><span class="op" id="5525775">.</span><span class="ident" id="5525776">AlphaModel</span>&nbsp;<span class="op" id="5525787">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5525790">func</span>&nbsp;<span class="op" id="5525795">(</span><span class="ident" id="5525796">p</span>&nbsp;<span class="op" id="5525798">*</span><span class="ident" id="5525799">Alpha</span><span class="op" id="5525804">)</span>&nbsp;<span class="ident" id="5525806">Bounds</span><span class="op" id="5525812">(</span><span class="op" id="5525813">)</span>&nbsp;<span class="ident" id="5525815">Rectangle</span>&nbsp;<span class="op" id="5525825">{</span>&nbsp;<span class="keyword" id="5525827">return</span>&nbsp;<span class="ident" id="5525834">p</span><span class="op" id="5525835">.</span><span class="ident" id="5525836">Rect</span>&nbsp;<span class="op" id="5525841">}</span><br>
<span class="lineno">495</span><br>
<span class="lineno"></span><span class="keyword" id="5525844">func</span>&nbsp;<span class="op" id="5525849">(</span><span class="ident" id="5525850">p</span>&nbsp;<span class="op" id="5525852">*</span><span class="ident" id="5525853">Alpha</span><span class="op" id="5525858">)</span>&nbsp;<span class="ident" id="5525860">At</span><span class="op" id="5525862">(</span><span class="ident" id="5525863">x</span><span class="op" id="5525864">,</span>&nbsp;<span class="ident" id="5525866">y</span>&nbsp;<span class="builtintype" id="5525868">int</span><span class="op" id="5525871">)</span>&nbsp;<span class="ident" id="5525873">color</span><span class="op" id="5525878">.</span><span class="ident" id="5525879">Color</span>&nbsp;<span class="op" id="5525885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5525888">return</span>&nbsp;<span class="ident" id="5525895">p</span><span class="op" id="5525896">.</span><span class="ident" id="5525897">AlphaAt</span><span class="op" id="5525904">(</span><span class="ident" id="5525905">x</span><span class="op" id="5525906">,</span>&nbsp;<span class="ident" id="5525908">y</span><span class="op" id="5525909">)</span><br>
<span class="lineno"></span><span class="op" id="5525911">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">500</span><span class="keyword" id="5525914">func</span>&nbsp;<span class="op" id="5525919">(</span><span class="ident" id="5525920">p</span>&nbsp;<span class="op" id="5525922">*</span><span class="ident" id="5525923">Alpha</span><span class="op" id="5525928">)</span>&nbsp;<span class="ident" id="5525930">AlphaAt</span><span class="op" id="5525937">(</span><span class="ident" id="5525938">x</span><span class="op" id="5525939">,</span>&nbsp;<span class="ident" id="5525941">y</span>&nbsp;<span class="builtintype" id="5525943">int</span><span class="op" id="5525946">)</span>&nbsp;<span class="ident" id="5525948">color</span><span class="op" id="5525953">.</span><span class="ident" id="5525954">Alpha</span>&nbsp;<span class="op" id="5525960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5525963">if</span>&nbsp;<span class="op" id="5525966">!</span><span class="op" id="5525967">(</span><span class="ident" id="5525968">Point</span><span class="op" id="5525973">{</span><span class="ident" id="5525974">x</span><span class="op" id="5525975">,</span>&nbsp;<span class="ident" id="5525977">y</span><span class="op" id="5525978">}</span><span class="op" id="5525979">.</span><span class="ident" id="5525980">In</span><span class="op" id="5525982">(</span><span class="ident" id="5525983">p</span><span class="op" id="5525984">.</span><span class="ident" id="5525985">Rect</span><span class="op" id="5525989">)</span><span class="op" id="5525990">)</span>&nbsp;<span class="op" id="5525992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5525996">return</span>&nbsp;<span class="ident" id="5526003">color</span><span class="op" id="5526008">.</span><span class="ident" id="5526009">Alpha</span><span class="op" id="5526014">{</span><span class="op" id="5526015">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5526018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5526021">i</span>&nbsp;<span class="op" id="5526023">:=</span>&nbsp;<span class="ident" id="5526026">p</span><span class="op" id="5526027">.</span><span class="ident" id="5526028">PixOffset</span><span class="op" id="5526037">(</span><span class="ident" id="5526038">x</span><span class="op" id="5526039">,</span>&nbsp;<span class="ident" id="5526041">y</span><span class="op" id="5526042">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5526045">return</span>&nbsp;<span class="ident" id="5526052">color</span><span class="op" id="5526057">.</span><span class="ident" id="5526058">Alpha</span><span class="op" id="5526063">{</span><span class="ident" id="5526064">p</span><span class="op" id="5526065">.</span><span class="ident" id="5526066">Pix</span><span class="op" id="5526069">[</span><span class="ident" id="5526070">i</span><span class="op" id="5526071">]</span><span class="op" id="5526072">}</span><br>
<span class="lineno"></span><span class="op" id="5526074">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5526077">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5526156">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno">510</span><span class="keyword" id="5526180">func</span>&nbsp;<span class="op" id="5526185">(</span><span class="ident" id="5526186">p</span>&nbsp;<span class="op" id="5526188">*</span><span class="ident" id="5526189">Alpha</span><span class="op" id="5526194">)</span>&nbsp;<span class="ident" id="5526196">PixOffset</span><span class="op" id="5526205">(</span><span class="ident" id="5526206">x</span><span class="op" id="5526207">,</span>&nbsp;<span class="ident" id="5526209">y</span>&nbsp;<span class="builtintype" id="5526211">int</span><span class="op" id="5526214">)</span>&nbsp;<span class="builtintype" id="5526216">int</span>&nbsp;<span class="op" id="5526220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5526223">return</span>&nbsp;<span class="op" id="5526230">(</span><span class="ident" id="5526231">y</span><span class="op" id="5526232">-</span><span class="ident" id="5526233">p</span><span class="op" id="5526234">.</span><span class="ident" id="5526235">Rect</span><span class="op" id="5526239">.</span><span class="ident" id="5526240">Min</span><span class="op" id="5526243">.</span><span class="ident" id="5526244">Y</span><span class="op" id="5526245">)</span><span class="op" id="5526246">*</span><span class="ident" id="5526247">p</span><span class="op" id="5526248">.</span><span class="ident" id="5526249">Stride</span>&nbsp;<span class="op" id="5526256">+</span>&nbsp;<span class="op" id="5526258">(</span><span class="ident" id="5526259">x</span><span class="op" id="5526260">-</span><span class="ident" id="5526261">p</span><span class="op" id="5526262">.</span><span class="ident" id="5526263">Rect</span><span class="op" id="5526267">.</span><span class="ident" id="5526268">Min</span><span class="op" id="5526271">.</span><span class="ident" id="5526272">X</span><span class="op" id="5526273">)</span><span class="op" id="5526274">*</span><span class="num" id="5526275">1</span><br>
<span class="lineno"></span><span class="op" id="5526277">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5526280">func</span>&nbsp;<span class="op" id="5526285">(</span><span class="ident" id="5526286">p</span>&nbsp;<span class="op" id="5526288">*</span><span class="ident" id="5526289">Alpha</span><span class="op" id="5526294">)</span>&nbsp;<span class="ident" id="5526296">Set</span><span class="op" id="5526299">(</span><span class="ident" id="5526300">x</span><span class="op" id="5526301">,</span>&nbsp;<span class="ident" id="5526303">y</span>&nbsp;<span class="builtintype" id="5526305">int</span><span class="op" id="5526308">,</span>&nbsp;<span class="ident" id="5526310">c</span>&nbsp;<span class="ident" id="5526312">color</span><span class="op" id="5526317">.</span><span class="ident" id="5526318">Color</span><span class="op" id="5526323">)</span>&nbsp;<span class="op" id="5526325">{</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5526328">if</span>&nbsp;<span class="op" id="5526331">!</span><span class="op" id="5526332">(</span><span class="ident" id="5526333">Point</span><span class="op" id="5526338">{</span><span class="ident" id="5526339">x</span><span class="op" id="5526340">,</span>&nbsp;<span class="ident" id="5526342">y</span><span class="op" id="5526343">}</span><span class="op" id="5526344">.</span><span class="ident" id="5526345">In</span><span class="op" id="5526347">(</span><span class="ident" id="5526348">p</span><span class="op" id="5526349">.</span><span class="ident" id="5526350">Rect</span><span class="op" id="5526354">)</span><span class="op" id="5526355">)</span>&nbsp;<span class="op" id="5526357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5526361">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5526369">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5526372">i</span>&nbsp;<span class="op" id="5526374">:=</span>&nbsp;<span class="ident" id="5526377">p</span><span class="op" id="5526378">.</span><span class="ident" id="5526379">PixOffset</span><span class="op" id="5526388">(</span><span class="ident" id="5526389">x</span><span class="op" id="5526390">,</span>&nbsp;<span class="ident" id="5526392">y</span><span class="op" id="5526393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5526396">p</span><span class="op" id="5526397">.</span><span class="ident" id="5526398">Pix</span><span class="op" id="5526401">[</span><span class="ident" id="5526402">i</span><span class="op" id="5526403">]</span>&nbsp;<span class="op" id="5526405">=</span>&nbsp;<span class="ident" id="5526407">color</span><span class="op" id="5526412">.</span><span class="ident" id="5526413">AlphaModel</span><span class="op" id="5526423">.</span><span class="ident" id="5526424">Convert</span><span class="op" id="5526431">(</span><span class="ident" id="5526432">c</span><span class="op" id="5526433">)</span><span class="op" id="5526434">.</span><span class="op" id="5526435">(</span><span class="ident" id="5526436">color</span><span class="op" id="5526441">.</span><span class="ident" id="5526442">Alpha</span><span class="op" id="5526447">)</span><span class="op" id="5526448">.</span><span class="ident" id="5526449">A</span><br>
<span class="lineno">520</span><span class="op" id="5526451">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5526454">func</span>&nbsp;<span class="op" id="5526459">(</span><span class="ident" id="5526460">p</span>&nbsp;<span class="op" id="5526462">*</span><span class="ident" id="5526463">Alpha</span><span class="op" id="5526468">)</span>&nbsp;<span class="ident" id="5526470">SetAlpha</span><span class="op" id="5526478">(</span><span class="ident" id="5526479">x</span><span class="op" id="5526480">,</span>&nbsp;<span class="ident" id="5526482">y</span>&nbsp;<span class="builtintype" id="5526484">int</span><span class="op" id="5526487">,</span>&nbsp;<span class="ident" id="5526489">c</span>&nbsp;<span class="ident" id="5526491">color</span><span class="op" id="5526496">.</span><span class="ident" id="5526497">Alpha</span><span class="op" id="5526502">)</span>&nbsp;<span class="op" id="5526504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5526507">if</span>&nbsp;<span class="op" id="5526510">!</span><span class="op" id="5526511">(</span><span class="ident" id="5526512">Point</span><span class="op" id="5526517">{</span><span class="ident" id="5526518">x</span><span class="op" id="5526519">,</span>&nbsp;<span class="ident" id="5526521">y</span><span class="op" id="5526522">}</span><span class="op" id="5526523">.</span><span class="ident" id="5526524">In</span><span class="op" id="5526526">(</span><span class="ident" id="5526527">p</span><span class="op" id="5526528">.</span><span class="ident" id="5526529">Rect</span><span class="op" id="5526533">)</span><span class="op" id="5526534">)</span>&nbsp;<span class="op" id="5526536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5526540">return</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5526548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5526551">i</span>&nbsp;<span class="op" id="5526553">:=</span>&nbsp;<span class="ident" id="5526556">p</span><span class="op" id="5526557">.</span><span class="ident" id="5526558">PixOffset</span><span class="op" id="5526567">(</span><span class="ident" id="5526568">x</span><span class="op" id="5526569">,</span>&nbsp;<span class="ident" id="5526571">y</span><span class="op" id="5526572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5526575">p</span><span class="op" id="5526576">.</span><span class="ident" id="5526577">Pix</span><span class="op" id="5526580">[</span><span class="ident" id="5526581">i</span><span class="op" id="5526582">]</span>&nbsp;<span class="op" id="5526584">=</span>&nbsp;<span class="ident" id="5526586">c</span><span class="op" id="5526587">.</span><span class="ident" id="5526588">A</span><br>
<span class="lineno"></span><span class="op" id="5526590">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span><span class="comment" id="5526593">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5526670">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5526742">func</span>&nbsp;<span class="op" id="5526747">(</span><span class="ident" id="5526748">p</span>&nbsp;<span class="op" id="5526750">*</span><span class="ident" id="5526751">Alpha</span><span class="op" id="5526756">)</span>&nbsp;<span class="ident" id="5526758">SubImage</span><span class="op" id="5526766">(</span><span class="ident" id="5526767">r</span>&nbsp;<span class="ident" id="5526769">Rectangle</span><span class="op" id="5526778">)</span>&nbsp;<span class="ident" id="5526780">Image</span>&nbsp;<span class="op" id="5526786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5526789">r</span>&nbsp;<span class="op" id="5526791">=</span>&nbsp;<span class="ident" id="5526793">r</span><span class="op" id="5526794">.</span><span class="ident" id="5526795">Intersect</span><span class="op" id="5526804">(</span><span class="ident" id="5526805">p</span><span class="op" id="5526806">.</span><span class="ident" id="5526807">Rect</span><span class="op" id="5526811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5526814">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5526895">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5526977">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5527027">if</span>&nbsp;<span class="ident" id="5527030">r</span><span class="op" id="5527031">.</span><span class="ident" id="5527032">Empty</span><span class="op" id="5527037">(</span><span class="op" id="5527038">)</span>&nbsp;<span class="op" id="5527040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5527044">return</span>&nbsp;<span class="op" id="5527051">&amp;</span><span class="ident" id="5527052">Alpha</span><span class="op" id="5527057">{</span><span class="op" id="5527058">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5527061">}</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5527064">i</span>&nbsp;<span class="op" id="5527066">:=</span>&nbsp;<span class="ident" id="5527069">p</span><span class="op" id="5527070">.</span><span class="ident" id="5527071">PixOffset</span><span class="op" id="5527080">(</span><span class="ident" id="5527081">r</span><span class="op" id="5527082">.</span><span class="ident" id="5527083">Min</span><span class="op" id="5527086">.</span><span class="ident" id="5527087">X</span><span class="op" id="5527088">,</span>&nbsp;<span class="ident" id="5527090">r</span><span class="op" id="5527091">.</span><span class="ident" id="5527092">Min</span><span class="op" id="5527095">.</span><span class="ident" id="5527096">Y</span><span class="op" id="5527097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5527100">return</span>&nbsp;<span class="op" id="5527107">&amp;</span><span class="ident" id="5527108">Alpha</span><span class="op" id="5527113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5527117">Pix</span><span class="op" id="5527120">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5527125">p</span><span class="op" id="5527126">.</span><span class="ident" id="5527127">Pix</span><span class="op" id="5527130">[</span><span class="ident" id="5527131">i</span><span class="op" id="5527132">:</span><span class="op" id="5527133">]</span><span class="op" id="5527134">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5527138">Stride</span><span class="op" id="5527144">:</span>&nbsp;<span class="ident" id="5527146">p</span><span class="op" id="5527147">.</span><span class="ident" id="5527148">Stride</span><span class="op" id="5527154">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5527158">Rect</span><span class="op" id="5527162">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5527166">r</span><span class="op" id="5527167">,</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5527170">}</span><br>
<span class="lineno"></span><span class="op" id="5527172">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5527175">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5527248">func</span>&nbsp;<span class="op" id="5527253">(</span><span class="ident" id="5527254">p</span>&nbsp;<span class="op" id="5527256">*</span><span class="ident" id="5527257">Alpha</span><span class="op" id="5527262">)</span>&nbsp;<span class="ident" id="5527264">Opaque</span><span class="op" id="5527270">(</span><span class="op" id="5527271">)</span>&nbsp;<span class="builtintype" id="5527273">bool</span>&nbsp;<span class="op" id="5527278">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5527281">if</span>&nbsp;<span class="ident" id="5527284">p</span><span class="op" id="5527285">.</span><span class="ident" id="5527286">Rect</span><span class="op" id="5527290">.</span><span class="ident" id="5527291">Empty</span><span class="op" id="5527296">(</span><span class="op" id="5527297">)</span>&nbsp;<span class="op" id="5527299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5527303">return</span>&nbsp;<span class="builtintype" id="5527310">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5527316">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5527319">i0</span><span class="op" id="5527321">,</span>&nbsp;<span class="ident" id="5527323">i1</span>&nbsp;<span class="op" id="5527326">:=</span>&nbsp;<span class="num" id="5527329">0</span><span class="op" id="5527330">,</span>&nbsp;<span class="ident" id="5527332">p</span><span class="op" id="5527333">.</span><span class="ident" id="5527334">Rect</span><span class="op" id="5527338">.</span><span class="ident" id="5527339">Dx</span><span class="op" id="5527341">(</span><span class="op" id="5527342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5527345">for</span>&nbsp;<span class="ident" id="5527349">y</span>&nbsp;<span class="op" id="5527351">:=</span>&nbsp;<span class="ident" id="5527354">p</span><span class="op" id="5527355">.</span><span class="ident" id="5527356">Rect</span><span class="op" id="5527360">.</span><span class="ident" id="5527361">Min</span><span class="op" id="5527364">.</span><span class="ident" id="5527365">Y</span><span class="op" id="5527366">;</span>&nbsp;<span class="ident" id="5527368">y</span>&nbsp;<span class="op" id="5527370">&lt;</span>&nbsp;<span class="ident" id="5527372">p</span><span class="op" id="5527373">.</span><span class="ident" id="5527374">Rect</span><span class="op" id="5527378">.</span><span class="ident" id="5527379">Max</span><span class="op" id="5527382">.</span><span class="ident" id="5527383">Y</span><span class="op" id="5527384">;</span>&nbsp;<span class="ident" id="5527386">y</span><span class="op" id="5527387">++</span>&nbsp;<span class="op" id="5527390">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5527394">for</span>&nbsp;<span class="ident" id="5527398">i</span>&nbsp;<span class="op" id="5527400">:=</span>&nbsp;<span class="ident" id="5527403">i0</span><span class="op" id="5527405">;</span>&nbsp;<span class="ident" id="5527407">i</span>&nbsp;<span class="op" id="5527409">&lt;</span>&nbsp;<span class="ident" id="5527411">i1</span><span class="op" id="5527413">;</span>&nbsp;<span class="ident" id="5527415">i</span><span class="op" id="5527416">++</span>&nbsp;<span class="op" id="5527419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5527424">if</span>&nbsp;<span class="ident" id="5527427">p</span><span class="op" id="5527428">.</span><span class="ident" id="5527429">Pix</span><span class="op" id="5527432">[</span><span class="ident" id="5527433">i</span><span class="op" id="5527434">]</span>&nbsp;<span class="op" id="5527436">!=</span>&nbsp;<span class="num" id="5527439">0xff</span>&nbsp;<span class="op" id="5527444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5527450">return</span>&nbsp;<span class="builtintype" id="5527457">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5527466">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5527470">}</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5527474">i0</span>&nbsp;<span class="op" id="5527477">+=</span>&nbsp;<span class="ident" id="5527480">p</span><span class="op" id="5527481">.</span><span class="ident" id="5527482">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5527491">i1</span>&nbsp;<span class="op" id="5527494">+=</span>&nbsp;<span class="ident" id="5527497">p</span><span class="op" id="5527498">.</span><span class="ident" id="5527499">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5527507">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5527510">return</span>&nbsp;<span class="builtintype" id="5527517">true</span><br>
<span class="lineno"></span><span class="op" id="5527522">}</span><br>
<span class="lineno">565</span><br>
<span class="lineno"></span><span class="comment" id="5527525">//&nbsp;NewAlpha&nbsp;returns&nbsp;a&nbsp;new&nbsp;Alpha&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="5527580">func</span>&nbsp;<span class="ident" id="5527585">NewAlpha</span><span class="op" id="5527593">(</span><span class="ident" id="5527594">r</span>&nbsp;<span class="ident" id="5527596">Rectangle</span><span class="op" id="5527605">)</span>&nbsp;<span class="op" id="5527607">*</span><span class="ident" id="5527608">Alpha</span>&nbsp;<span class="op" id="5527614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5527617">w</span><span class="op" id="5527618">,</span>&nbsp;<span class="ident" id="5527620">h</span>&nbsp;<span class="op" id="5527622">:=</span>&nbsp;<span class="ident" id="5527625">r</span><span class="op" id="5527626">.</span><span class="ident" id="5527627">Dx</span><span class="op" id="5527629">(</span><span class="op" id="5527630">)</span><span class="op" id="5527631">,</span>&nbsp;<span class="ident" id="5527633">r</span><span class="op" id="5527634">.</span><span class="ident" id="5527635">Dy</span><span class="op" id="5527637">(</span><span class="op" id="5527638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5527641">pix</span>&nbsp;<span class="op" id="5527645">:=</span>&nbsp;<span class="builtinfunc" id="5527648">make</span><span class="op" id="5527652">(</span><span class="op" id="5527653">[</span><span class="op" id="5527654">]</span><span class="builtintype" id="5527655">uint8</span><span class="op" id="5527660">,</span>&nbsp;<span class="num" id="5527662">1</span><span class="op" id="5527663">*</span><span class="ident" id="5527664">w</span><span class="op" id="5527665">*</span><span class="ident" id="5527666">h</span><span class="op" id="5527667">)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5527670">return</span>&nbsp;<span class="op" id="5527677">&amp;</span><span class="ident" id="5527678">Alpha</span><span class="op" id="5527683">{</span><span class="ident" id="5527684">pix</span><span class="op" id="5527687">,</span>&nbsp;<span class="num" id="5527689">1</span>&nbsp;<span class="op" id="5527691">*</span>&nbsp;<span class="ident" id="5527693">w</span><span class="op" id="5527694">,</span>&nbsp;<span class="ident" id="5527696">r</span><span class="op" id="5527697">}</span><br>
<span class="lineno"></span><span class="op" id="5527699">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5527702">//&nbsp;Alpha16&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.Alpha64&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5527781">type</span>&nbsp;<span class="ident" id="5527786">Alpha16</span>&nbsp;<span class="keyword" id="5527794">struct</span>&nbsp;<span class="op" id="5527801">{</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5527804">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;alpha&nbsp;values&nbsp;in&nbsp;big-endian&nbsp;format.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5527889">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*2].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5527957">Pix</span>&nbsp;<span class="op" id="5527961">[</span><span class="op" id="5527962">]</span><span class="builtintype" id="5527963">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5527970">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5528046">Stride</span>&nbsp;<span class="builtintype" id="5528053">int</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5528058">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5528090">Rect</span>&nbsp;<span class="ident" id="5528095">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="5528105">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5528108">func</span>&nbsp;<span class="op" id="5528113">(</span><span class="ident" id="5528114">p</span>&nbsp;<span class="op" id="5528116">*</span><span class="ident" id="5528117">Alpha16</span><span class="op" id="5528124">)</span>&nbsp;<span class="ident" id="5528126">ColorModel</span><span class="op" id="5528136">(</span><span class="op" id="5528137">)</span>&nbsp;<span class="ident" id="5528139">color</span><span class="op" id="5528144">.</span><span class="ident" id="5528145">Model</span>&nbsp;<span class="op" id="5528151">{</span>&nbsp;<span class="keyword" id="5528153">return</span>&nbsp;<span class="ident" id="5528160">color</span><span class="op" id="5528165">.</span><span class="ident" id="5528166">Alpha16Model</span>&nbsp;<span class="op" id="5528179">}</span><br>
<span class="lineno">585</span><br>
<span class="lineno"></span><span class="keyword" id="5528182">func</span>&nbsp;<span class="op" id="5528187">(</span><span class="ident" id="5528188">p</span>&nbsp;<span class="op" id="5528190">*</span><span class="ident" id="5528191">Alpha16</span><span class="op" id="5528198">)</span>&nbsp;<span class="ident" id="5528200">Bounds</span><span class="op" id="5528206">(</span><span class="op" id="5528207">)</span>&nbsp;<span class="ident" id="5528209">Rectangle</span>&nbsp;<span class="op" id="5528219">{</span>&nbsp;<span class="keyword" id="5528221">return</span>&nbsp;<span class="ident" id="5528228">p</span><span class="op" id="5528229">.</span><span class="ident" id="5528230">Rect</span>&nbsp;<span class="op" id="5528235">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5528238">func</span>&nbsp;<span class="op" id="5528243">(</span><span class="ident" id="5528244">p</span>&nbsp;<span class="op" id="5528246">*</span><span class="ident" id="5528247">Alpha16</span><span class="op" id="5528254">)</span>&nbsp;<span class="ident" id="5528256">At</span><span class="op" id="5528258">(</span><span class="ident" id="5528259">x</span><span class="op" id="5528260">,</span>&nbsp;<span class="ident" id="5528262">y</span>&nbsp;<span class="builtintype" id="5528264">int</span><span class="op" id="5528267">)</span>&nbsp;<span class="ident" id="5528269">color</span><span class="op" id="5528274">.</span><span class="ident" id="5528275">Color</span>&nbsp;<span class="op" id="5528281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5528284">return</span>&nbsp;<span class="ident" id="5528291">p</span><span class="op" id="5528292">.</span><span class="ident" id="5528293">Alpha16At</span><span class="op" id="5528302">(</span><span class="ident" id="5528303">x</span><span class="op" id="5528304">,</span>&nbsp;<span class="ident" id="5528306">y</span><span class="op" id="5528307">)</span><br>
<span class="lineno">590</span><span class="op" id="5528309">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5528312">func</span>&nbsp;<span class="op" id="5528317">(</span><span class="ident" id="5528318">p</span>&nbsp;<span class="op" id="5528320">*</span><span class="ident" id="5528321">Alpha16</span><span class="op" id="5528328">)</span>&nbsp;<span class="ident" id="5528330">Alpha16At</span><span class="op" id="5528339">(</span><span class="ident" id="5528340">x</span><span class="op" id="5528341">,</span>&nbsp;<span class="ident" id="5528343">y</span>&nbsp;<span class="builtintype" id="5528345">int</span><span class="op" id="5528348">)</span>&nbsp;<span class="ident" id="5528350">color</span><span class="op" id="5528355">.</span><span class="ident" id="5528356">Alpha16</span>&nbsp;<span class="op" id="5528364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5528367">if</span>&nbsp;<span class="op" id="5528370">!</span><span class="op" id="5528371">(</span><span class="ident" id="5528372">Point</span><span class="op" id="5528377">{</span><span class="ident" id="5528378">x</span><span class="op" id="5528379">,</span>&nbsp;<span class="ident" id="5528381">y</span><span class="op" id="5528382">}</span><span class="op" id="5528383">.</span><span class="ident" id="5528384">In</span><span class="op" id="5528386">(</span><span class="ident" id="5528387">p</span><span class="op" id="5528388">.</span><span class="ident" id="5528389">Rect</span><span class="op" id="5528393">)</span><span class="op" id="5528394">)</span>&nbsp;<span class="op" id="5528396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5528400">return</span>&nbsp;<span class="ident" id="5528407">color</span><span class="op" id="5528412">.</span><span class="ident" id="5528413">Alpha16</span><span class="op" id="5528420">{</span><span class="op" id="5528421">}</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5528424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5528427">i</span>&nbsp;<span class="op" id="5528429">:=</span>&nbsp;<span class="ident" id="5528432">p</span><span class="op" id="5528433">.</span><span class="ident" id="5528434">PixOffset</span><span class="op" id="5528443">(</span><span class="ident" id="5528444">x</span><span class="op" id="5528445">,</span>&nbsp;<span class="ident" id="5528447">y</span><span class="op" id="5528448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5528451">return</span>&nbsp;<span class="ident" id="5528458">color</span><span class="op" id="5528463">.</span><span class="ident" id="5528464">Alpha16</span><span class="op" id="5528471">{</span><span class="builtintype" id="5528472">uint16</span><span class="op" id="5528478">(</span><span class="ident" id="5528479">p</span><span class="op" id="5528480">.</span><span class="ident" id="5528481">Pix</span><span class="op" id="5528484">[</span><span class="ident" id="5528485">i</span><span class="op" id="5528486">+</span><span class="num" id="5528487">0</span><span class="op" id="5528488">]</span><span class="op" id="5528489">)</span><span class="op" id="5528490">&lt;&lt;</span><span class="num" id="5528492">8</span>&nbsp;<span class="op" id="5528494">|</span>&nbsp;<span class="builtintype" id="5528496">uint16</span><span class="op" id="5528502">(</span><span class="ident" id="5528503">p</span><span class="op" id="5528504">.</span><span class="ident" id="5528505">Pix</span><span class="op" id="5528508">[</span><span class="ident" id="5528509">i</span><span class="op" id="5528510">+</span><span class="num" id="5528511">1</span><span class="op" id="5528512">]</span><span class="op" id="5528513">)</span><span class="op" id="5528514">}</span><br>
<span class="lineno"></span><span class="op" id="5528516">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">600</span><span class="comment" id="5528519">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5528598">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5528622">func</span>&nbsp;<span class="op" id="5528627">(</span><span class="ident" id="5528628">p</span>&nbsp;<span class="op" id="5528630">*</span><span class="ident" id="5528631">Alpha16</span><span class="op" id="5528638">)</span>&nbsp;<span class="ident" id="5528640">PixOffset</span><span class="op" id="5528649">(</span><span class="ident" id="5528650">x</span><span class="op" id="5528651">,</span>&nbsp;<span class="ident" id="5528653">y</span>&nbsp;<span class="builtintype" id="5528655">int</span><span class="op" id="5528658">)</span>&nbsp;<span class="builtintype" id="5528660">int</span>&nbsp;<span class="op" id="5528664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5528667">return</span>&nbsp;<span class="op" id="5528674">(</span><span class="ident" id="5528675">y</span><span class="op" id="5528676">-</span><span class="ident" id="5528677">p</span><span class="op" id="5528678">.</span><span class="ident" id="5528679">Rect</span><span class="op" id="5528683">.</span><span class="ident" id="5528684">Min</span><span class="op" id="5528687">.</span><span class="ident" id="5528688">Y</span><span class="op" id="5528689">)</span><span class="op" id="5528690">*</span><span class="ident" id="5528691">p</span><span class="op" id="5528692">.</span><span class="ident" id="5528693">Stride</span>&nbsp;<span class="op" id="5528700">+</span>&nbsp;<span class="op" id="5528702">(</span><span class="ident" id="5528703">x</span><span class="op" id="5528704">-</span><span class="ident" id="5528705">p</span><span class="op" id="5528706">.</span><span class="ident" id="5528707">Rect</span><span class="op" id="5528711">.</span><span class="ident" id="5528712">Min</span><span class="op" id="5528715">.</span><span class="ident" id="5528716">X</span><span class="op" id="5528717">)</span><span class="op" id="5528718">*</span><span class="num" id="5528719">2</span><br>
<span class="lineno"></span><span class="op" id="5528721">}</span><br>
<span class="lineno">605</span><br>
<span class="lineno"></span><span class="keyword" id="5528724">func</span>&nbsp;<span class="op" id="5528729">(</span><span class="ident" id="5528730">p</span>&nbsp;<span class="op" id="5528732">*</span><span class="ident" id="5528733">Alpha16</span><span class="op" id="5528740">)</span>&nbsp;<span class="ident" id="5528742">Set</span><span class="op" id="5528745">(</span><span class="ident" id="5528746">x</span><span class="op" id="5528747">,</span>&nbsp;<span class="ident" id="5528749">y</span>&nbsp;<span class="builtintype" id="5528751">int</span><span class="op" id="5528754">,</span>&nbsp;<span class="ident" id="5528756">c</span>&nbsp;<span class="ident" id="5528758">color</span><span class="op" id="5528763">.</span><span class="ident" id="5528764">Color</span><span class="op" id="5528769">)</span>&nbsp;<span class="op" id="5528771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5528774">if</span>&nbsp;<span class="op" id="5528777">!</span><span class="op" id="5528778">(</span><span class="ident" id="5528779">Point</span><span class="op" id="5528784">{</span><span class="ident" id="5528785">x</span><span class="op" id="5528786">,</span>&nbsp;<span class="ident" id="5528788">y</span><span class="op" id="5528789">}</span><span class="op" id="5528790">.</span><span class="ident" id="5528791">In</span><span class="op" id="5528793">(</span><span class="ident" id="5528794">p</span><span class="op" id="5528795">.</span><span class="ident" id="5528796">Rect</span><span class="op" id="5528800">)</span><span class="op" id="5528801">)</span>&nbsp;<span class="op" id="5528803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5528807">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5528815">}</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5528818">i</span>&nbsp;<span class="op" id="5528820">:=</span>&nbsp;<span class="ident" id="5528823">p</span><span class="op" id="5528824">.</span><span class="ident" id="5528825">PixOffset</span><span class="op" id="5528834">(</span><span class="ident" id="5528835">x</span><span class="op" id="5528836">,</span>&nbsp;<span class="ident" id="5528838">y</span><span class="op" id="5528839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5528842">c1</span>&nbsp;<span class="op" id="5528845">:=</span>&nbsp;<span class="ident" id="5528848">color</span><span class="op" id="5528853">.</span><span class="ident" id="5528854">Alpha16Model</span><span class="op" id="5528866">.</span><span class="ident" id="5528867">Convert</span><span class="op" id="5528874">(</span><span class="ident" id="5528875">c</span><span class="op" id="5528876">)</span><span class="op" id="5528877">.</span><span class="op" id="5528878">(</span><span class="ident" id="5528879">color</span><span class="op" id="5528884">.</span><span class="ident" id="5528885">Alpha16</span><span class="op" id="5528892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5528895">p</span><span class="op" id="5528896">.</span><span class="ident" id="5528897">Pix</span><span class="op" id="5528900">[</span><span class="ident" id="5528901">i</span><span class="op" id="5528902">+</span><span class="num" id="5528903">0</span><span class="op" id="5528904">]</span>&nbsp;<span class="op" id="5528906">=</span>&nbsp;<span class="builtintype" id="5528908">uint8</span><span class="op" id="5528913">(</span><span class="ident" id="5528914">c1</span><span class="op" id="5528916">.</span><span class="ident" id="5528917">A</span>&nbsp;<span class="op" id="5528919">&gt;&gt;</span>&nbsp;<span class="num" id="5528922">8</span><span class="op" id="5528923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5528926">p</span><span class="op" id="5528927">.</span><span class="ident" id="5528928">Pix</span><span class="op" id="5528931">[</span><span class="ident" id="5528932">i</span><span class="op" id="5528933">+</span><span class="num" id="5528934">1</span><span class="op" id="5528935">]</span>&nbsp;<span class="op" id="5528937">=</span>&nbsp;<span class="builtintype" id="5528939">uint8</span><span class="op" id="5528944">(</span><span class="ident" id="5528945">c1</span><span class="op" id="5528947">.</span><span class="ident" id="5528948">A</span><span class="op" id="5528949">)</span><br>
<span class="lineno"></span><span class="op" id="5528951">}</span><br>
<span class="lineno">615</span><br>
<span class="lineno"></span><span class="keyword" id="5528954">func</span>&nbsp;<span class="op" id="5528959">(</span><span class="ident" id="5528960">p</span>&nbsp;<span class="op" id="5528962">*</span><span class="ident" id="5528963">Alpha16</span><span class="op" id="5528970">)</span>&nbsp;<span class="ident" id="5528972">SetAlpha16</span><span class="op" id="5528982">(</span><span class="ident" id="5528983">x</span><span class="op" id="5528984">,</span>&nbsp;<span class="ident" id="5528986">y</span>&nbsp;<span class="builtintype" id="5528988">int</span><span class="op" id="5528991">,</span>&nbsp;<span class="ident" id="5528993">c</span>&nbsp;<span class="ident" id="5528995">color</span><span class="op" id="5529000">.</span><span class="ident" id="5529001">Alpha16</span><span class="op" id="5529008">)</span>&nbsp;<span class="op" id="5529010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5529013">if</span>&nbsp;<span class="op" id="5529016">!</span><span class="op" id="5529017">(</span><span class="ident" id="5529018">Point</span><span class="op" id="5529023">{</span><span class="ident" id="5529024">x</span><span class="op" id="5529025">,</span>&nbsp;<span class="ident" id="5529027">y</span><span class="op" id="5529028">}</span><span class="op" id="5529029">.</span><span class="ident" id="5529030">In</span><span class="op" id="5529032">(</span><span class="ident" id="5529033">p</span><span class="op" id="5529034">.</span><span class="ident" id="5529035">Rect</span><span class="op" id="5529039">)</span><span class="op" id="5529040">)</span>&nbsp;<span class="op" id="5529042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5529046">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5529054">}</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5529057">i</span>&nbsp;<span class="op" id="5529059">:=</span>&nbsp;<span class="ident" id="5529062">p</span><span class="op" id="5529063">.</span><span class="ident" id="5529064">PixOffset</span><span class="op" id="5529073">(</span><span class="ident" id="5529074">x</span><span class="op" id="5529075">,</span>&nbsp;<span class="ident" id="5529077">y</span><span class="op" id="5529078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5529081">p</span><span class="op" id="5529082">.</span><span class="ident" id="5529083">Pix</span><span class="op" id="5529086">[</span><span class="ident" id="5529087">i</span><span class="op" id="5529088">+</span><span class="num" id="5529089">0</span><span class="op" id="5529090">]</span>&nbsp;<span class="op" id="5529092">=</span>&nbsp;<span class="builtintype" id="5529094">uint8</span><span class="op" id="5529099">(</span><span class="ident" id="5529100">c</span><span class="op" id="5529101">.</span><span class="ident" id="5529102">A</span>&nbsp;<span class="op" id="5529104">&gt;&gt;</span>&nbsp;<span class="num" id="5529107">8</span><span class="op" id="5529108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5529111">p</span><span class="op" id="5529112">.</span><span class="ident" id="5529113">Pix</span><span class="op" id="5529116">[</span><span class="ident" id="5529117">i</span><span class="op" id="5529118">+</span><span class="num" id="5529119">1</span><span class="op" id="5529120">]</span>&nbsp;<span class="op" id="5529122">=</span>&nbsp;<span class="builtintype" id="5529124">uint8</span><span class="op" id="5529129">(</span><span class="ident" id="5529130">c</span><span class="op" id="5529131">.</span><span class="ident" id="5529132">A</span><span class="op" id="5529133">)</span><br>
<span class="lineno"></span><span class="op" id="5529135">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">625</span><span class="comment" id="5529138">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5529215">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5529287">func</span>&nbsp;<span class="op" id="5529292">(</span><span class="ident" id="5529293">p</span>&nbsp;<span class="op" id="5529295">*</span><span class="ident" id="5529296">Alpha16</span><span class="op" id="5529303">)</span>&nbsp;<span class="ident" id="5529305">SubImage</span><span class="op" id="5529313">(</span><span class="ident" id="5529314">r</span>&nbsp;<span class="ident" id="5529316">Rectangle</span><span class="op" id="5529325">)</span>&nbsp;<span class="ident" id="5529327">Image</span>&nbsp;<span class="op" id="5529333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5529336">r</span>&nbsp;<span class="op" id="5529338">=</span>&nbsp;<span class="ident" id="5529340">r</span><span class="op" id="5529341">.</span><span class="ident" id="5529342">Intersect</span><span class="op" id="5529351">(</span><span class="ident" id="5529352">p</span><span class="op" id="5529353">.</span><span class="ident" id="5529354">Rect</span><span class="op" id="5529358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5529361">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5529442">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5529524">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5529574">if</span>&nbsp;<span class="ident" id="5529577">r</span><span class="op" id="5529578">.</span><span class="ident" id="5529579">Empty</span><span class="op" id="5529584">(</span><span class="op" id="5529585">)</span>&nbsp;<span class="op" id="5529587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5529591">return</span>&nbsp;<span class="op" id="5529598">&amp;</span><span class="ident" id="5529599">Alpha16</span><span class="op" id="5529606">{</span><span class="op" id="5529607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5529610">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5529613">i</span>&nbsp;<span class="op" id="5529615">:=</span>&nbsp;<span class="ident" id="5529618">p</span><span class="op" id="5529619">.</span><span class="ident" id="5529620">PixOffset</span><span class="op" id="5529629">(</span><span class="ident" id="5529630">r</span><span class="op" id="5529631">.</span><span class="ident" id="5529632">Min</span><span class="op" id="5529635">.</span><span class="ident" id="5529636">X</span><span class="op" id="5529637">,</span>&nbsp;<span class="ident" id="5529639">r</span><span class="op" id="5529640">.</span><span class="ident" id="5529641">Min</span><span class="op" id="5529644">.</span><span class="ident" id="5529645">Y</span><span class="op" id="5529646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5529649">return</span>&nbsp;<span class="op" id="5529656">&amp;</span><span class="ident" id="5529657">Alpha16</span><span class="op" id="5529664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5529668">Pix</span><span class="op" id="5529671">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5529676">p</span><span class="op" id="5529677">.</span><span class="ident" id="5529678">Pix</span><span class="op" id="5529681">[</span><span class="ident" id="5529682">i</span><span class="op" id="5529683">:</span><span class="op" id="5529684">]</span><span class="op" id="5529685">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5529689">Stride</span><span class="op" id="5529695">:</span>&nbsp;<span class="ident" id="5529697">p</span><span class="op" id="5529698">.</span><span class="ident" id="5529699">Stride</span><span class="op" id="5529705">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5529709">Rect</span><span class="op" id="5529713">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5529717">r</span><span class="op" id="5529718">,</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5529721">}</span><br>
<span class="lineno"></span><span class="op" id="5529723">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5529726">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5529799">func</span>&nbsp;<span class="op" id="5529804">(</span><span class="ident" id="5529805">p</span>&nbsp;<span class="op" id="5529807">*</span><span class="ident" id="5529808">Alpha16</span><span class="op" id="5529815">)</span>&nbsp;<span class="ident" id="5529817">Opaque</span><span class="op" id="5529823">(</span><span class="op" id="5529824">)</span>&nbsp;<span class="builtintype" id="5529826">bool</span>&nbsp;<span class="op" id="5529831">{</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5529834">if</span>&nbsp;<span class="ident" id="5529837">p</span><span class="op" id="5529838">.</span><span class="ident" id="5529839">Rect</span><span class="op" id="5529843">.</span><span class="ident" id="5529844">Empty</span><span class="op" id="5529849">(</span><span class="op" id="5529850">)</span>&nbsp;<span class="op" id="5529852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5529856">return</span>&nbsp;<span class="builtintype" id="5529863">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5529869">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5529872">i0</span><span class="op" id="5529874">,</span>&nbsp;<span class="ident" id="5529876">i1</span>&nbsp;<span class="op" id="5529879">:=</span>&nbsp;<span class="num" id="5529882">0</span><span class="op" id="5529883">,</span>&nbsp;<span class="ident" id="5529885">p</span><span class="op" id="5529886">.</span><span class="ident" id="5529887">Rect</span><span class="op" id="5529891">.</span><span class="ident" id="5529892">Dx</span><span class="op" id="5529894">(</span><span class="op" id="5529895">)</span><span class="op" id="5529896">*</span><span class="num" id="5529897">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5529900">for</span>&nbsp;<span class="ident" id="5529904">y</span>&nbsp;<span class="op" id="5529906">:=</span>&nbsp;<span class="ident" id="5529909">p</span><span class="op" id="5529910">.</span><span class="ident" id="5529911">Rect</span><span class="op" id="5529915">.</span><span class="ident" id="5529916">Min</span><span class="op" id="5529919">.</span><span class="ident" id="5529920">Y</span><span class="op" id="5529921">;</span>&nbsp;<span class="ident" id="5529923">y</span>&nbsp;<span class="op" id="5529925">&lt;</span>&nbsp;<span class="ident" id="5529927">p</span><span class="op" id="5529928">.</span><span class="ident" id="5529929">Rect</span><span class="op" id="5529933">.</span><span class="ident" id="5529934">Max</span><span class="op" id="5529937">.</span><span class="ident" id="5529938">Y</span><span class="op" id="5529939">;</span>&nbsp;<span class="ident" id="5529941">y</span><span class="op" id="5529942">++</span>&nbsp;<span class="op" id="5529945">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5529949">for</span>&nbsp;<span class="ident" id="5529953">i</span>&nbsp;<span class="op" id="5529955">:=</span>&nbsp;<span class="ident" id="5529958">i0</span><span class="op" id="5529960">;</span>&nbsp;<span class="ident" id="5529962">i</span>&nbsp;<span class="op" id="5529964">&lt;</span>&nbsp;<span class="ident" id="5529966">i1</span><span class="op" id="5529968">;</span>&nbsp;<span class="ident" id="5529970">i</span>&nbsp;<span class="op" id="5529972">+=</span>&nbsp;<span class="num" id="5529975">2</span>&nbsp;<span class="op" id="5529977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5529982">if</span>&nbsp;<span class="ident" id="5529985">p</span><span class="op" id="5529986">.</span><span class="ident" id="5529987">Pix</span><span class="op" id="5529990">[</span><span class="ident" id="5529991">i</span><span class="op" id="5529992">+</span><span class="num" id="5529993">0</span><span class="op" id="5529994">]</span>&nbsp;<span class="op" id="5529996">!=</span>&nbsp;<span class="num" id="5529999">0xff</span>&nbsp;<span class="op" id="5530004">||</span>&nbsp;<span class="ident" id="5530007">p</span><span class="op" id="5530008">.</span><span class="ident" id="5530009">Pix</span><span class="op" id="5530012">[</span><span class="ident" id="5530013">i</span><span class="op" id="5530014">+</span><span class="num" id="5530015">1</span><span class="op" id="5530016">]</span>&nbsp;<span class="op" id="5530018">!=</span>&nbsp;<span class="num" id="5530021">0xff</span>&nbsp;<span class="op" id="5530026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5530032">return</span>&nbsp;<span class="builtintype" id="5530039">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5530048">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5530052">}</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5530056">i0</span>&nbsp;<span class="op" id="5530059">+=</span>&nbsp;<span class="ident" id="5530062">p</span><span class="op" id="5530063">.</span><span class="ident" id="5530064">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5530073">i1</span>&nbsp;<span class="op" id="5530076">+=</span>&nbsp;<span class="ident" id="5530079">p</span><span class="op" id="5530080">.</span><span class="ident" id="5530081">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5530089">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5530092">return</span>&nbsp;<span class="builtintype" id="5530099">true</span><br>
<span class="lineno"></span><span class="op" id="5530104">}</span><br>
<span class="lineno">660</span><br>
<span class="lineno"></span><span class="comment" id="5530107">//&nbsp;NewAlpha16&nbsp;returns&nbsp;a&nbsp;new&nbsp;Alpha16&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="5530166">func</span>&nbsp;<span class="ident" id="5530171">NewAlpha16</span><span class="op" id="5530181">(</span><span class="ident" id="5530182">r</span>&nbsp;<span class="ident" id="5530184">Rectangle</span><span class="op" id="5530193">)</span>&nbsp;<span class="op" id="5530195">*</span><span class="ident" id="5530196">Alpha16</span>&nbsp;<span class="op" id="5530204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5530207">w</span><span class="op" id="5530208">,</span>&nbsp;<span class="ident" id="5530210">h</span>&nbsp;<span class="op" id="5530212">:=</span>&nbsp;<span class="ident" id="5530215">r</span><span class="op" id="5530216">.</span><span class="ident" id="5530217">Dx</span><span class="op" id="5530219">(</span><span class="op" id="5530220">)</span><span class="op" id="5530221">,</span>&nbsp;<span class="ident" id="5530223">r</span><span class="op" id="5530224">.</span><span class="ident" id="5530225">Dy</span><span class="op" id="5530227">(</span><span class="op" id="5530228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5530231">pix</span>&nbsp;<span class="op" id="5530235">:=</span>&nbsp;<span class="builtinfunc" id="5530238">make</span><span class="op" id="5530242">(</span><span class="op" id="5530243">[</span><span class="op" id="5530244">]</span><span class="builtintype" id="5530245">uint8</span><span class="op" id="5530250">,</span>&nbsp;<span class="num" id="5530252">2</span><span class="op" id="5530253">*</span><span class="ident" id="5530254">w</span><span class="op" id="5530255">*</span><span class="ident" id="5530256">h</span><span class="op" id="5530257">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5530260">return</span>&nbsp;<span class="op" id="5530267">&amp;</span><span class="ident" id="5530268">Alpha16</span><span class="op" id="5530275">{</span><span class="ident" id="5530276">pix</span><span class="op" id="5530279">,</span>&nbsp;<span class="num" id="5530281">2</span>&nbsp;<span class="op" id="5530283">*</span>&nbsp;<span class="ident" id="5530285">w</span><span class="op" id="5530286">,</span>&nbsp;<span class="ident" id="5530288">r</span><span class="op" id="5530289">}</span><br>
<span class="lineno"></span><span class="op" id="5530291">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5530294">//&nbsp;Gray&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.Gray&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5530367">type</span>&nbsp;<span class="ident" id="5530372">Gray</span>&nbsp;<span class="keyword" id="5530377">struct</span>&nbsp;<span class="op" id="5530384">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5530387">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;gray&nbsp;values.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5530450">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*1].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5530518">Pix</span>&nbsp;<span class="op" id="5530522">[</span><span class="op" id="5530523">]</span><span class="builtintype" id="5530524">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5530531">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5530607">Stride</span>&nbsp;<span class="builtintype" id="5530614">int</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5530619">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5530651">Rect</span>&nbsp;<span class="ident" id="5530656">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="5530666">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5530669">func</span>&nbsp;<span class="op" id="5530674">(</span><span class="ident" id="5530675">p</span>&nbsp;<span class="op" id="5530677">*</span><span class="ident" id="5530678">Gray</span><span class="op" id="5530682">)</span>&nbsp;<span class="ident" id="5530684">ColorModel</span><span class="op" id="5530694">(</span><span class="op" id="5530695">)</span>&nbsp;<span class="ident" id="5530697">color</span><span class="op" id="5530702">.</span><span class="ident" id="5530703">Model</span>&nbsp;<span class="op" id="5530709">{</span>&nbsp;<span class="keyword" id="5530711">return</span>&nbsp;<span class="ident" id="5530718">color</span><span class="op" id="5530723">.</span><span class="ident" id="5530724">GrayModel</span>&nbsp;<span class="op" id="5530734">}</span><br>
<span class="lineno">680</span><br>
<span class="lineno"></span><span class="keyword" id="5530737">func</span>&nbsp;<span class="op" id="5530742">(</span><span class="ident" id="5530743">p</span>&nbsp;<span class="op" id="5530745">*</span><span class="ident" id="5530746">Gray</span><span class="op" id="5530750">)</span>&nbsp;<span class="ident" id="5530752">Bounds</span><span class="op" id="5530758">(</span><span class="op" id="5530759">)</span>&nbsp;<span class="ident" id="5530761">Rectangle</span>&nbsp;<span class="op" id="5530771">{</span>&nbsp;<span class="keyword" id="5530773">return</span>&nbsp;<span class="ident" id="5530780">p</span><span class="op" id="5530781">.</span><span class="ident" id="5530782">Rect</span>&nbsp;<span class="op" id="5530787">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5530790">func</span>&nbsp;<span class="op" id="5530795">(</span><span class="ident" id="5530796">p</span>&nbsp;<span class="op" id="5530798">*</span><span class="ident" id="5530799">Gray</span><span class="op" id="5530803">)</span>&nbsp;<span class="ident" id="5530805">At</span><span class="op" id="5530807">(</span><span class="ident" id="5530808">x</span><span class="op" id="5530809">,</span>&nbsp;<span class="ident" id="5530811">y</span>&nbsp;<span class="builtintype" id="5530813">int</span><span class="op" id="5530816">)</span>&nbsp;<span class="ident" id="5530818">color</span><span class="op" id="5530823">.</span><span class="ident" id="5530824">Color</span>&nbsp;<span class="op" id="5530830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5530833">return</span>&nbsp;<span class="ident" id="5530840">p</span><span class="op" id="5530841">.</span><span class="ident" id="5530842">GrayAt</span><span class="op" id="5530848">(</span><span class="ident" id="5530849">x</span><span class="op" id="5530850">,</span>&nbsp;<span class="ident" id="5530852">y</span><span class="op" id="5530853">)</span><br>
<span class="lineno">685</span><span class="op" id="5530855">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5530858">func</span>&nbsp;<span class="op" id="5530863">(</span><span class="ident" id="5530864">p</span>&nbsp;<span class="op" id="5530866">*</span><span class="ident" id="5530867">Gray</span><span class="op" id="5530871">)</span>&nbsp;<span class="ident" id="5530873">GrayAt</span><span class="op" id="5530879">(</span><span class="ident" id="5530880">x</span><span class="op" id="5530881">,</span>&nbsp;<span class="ident" id="5530883">y</span>&nbsp;<span class="builtintype" id="5530885">int</span><span class="op" id="5530888">)</span>&nbsp;<span class="ident" id="5530890">color</span><span class="op" id="5530895">.</span><span class="ident" id="5530896">Gray</span>&nbsp;<span class="op" id="5530901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5530904">if</span>&nbsp;<span class="op" id="5530907">!</span><span class="op" id="5530908">(</span><span class="ident" id="5530909">Point</span><span class="op" id="5530914">{</span><span class="ident" id="5530915">x</span><span class="op" id="5530916">,</span>&nbsp;<span class="ident" id="5530918">y</span><span class="op" id="5530919">}</span><span class="op" id="5530920">.</span><span class="ident" id="5530921">In</span><span class="op" id="5530923">(</span><span class="ident" id="5530924">p</span><span class="op" id="5530925">.</span><span class="ident" id="5530926">Rect</span><span class="op" id="5530930">)</span><span class="op" id="5530931">)</span>&nbsp;<span class="op" id="5530933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5530937">return</span>&nbsp;<span class="ident" id="5530944">color</span><span class="op" id="5530949">.</span><span class="ident" id="5530950">Gray</span><span class="op" id="5530954">{</span><span class="op" id="5530955">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5530958">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5530961">i</span>&nbsp;<span class="op" id="5530963">:=</span>&nbsp;<span class="ident" id="5530966">p</span><span class="op" id="5530967">.</span><span class="ident" id="5530968">PixOffset</span><span class="op" id="5530977">(</span><span class="ident" id="5530978">x</span><span class="op" id="5530979">,</span>&nbsp;<span class="ident" id="5530981">y</span><span class="op" id="5530982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5530985">return</span>&nbsp;<span class="ident" id="5530992">color</span><span class="op" id="5530997">.</span><span class="ident" id="5530998">Gray</span><span class="op" id="5531002">{</span><span class="ident" id="5531003">p</span><span class="op" id="5531004">.</span><span class="ident" id="5531005">Pix</span><span class="op" id="5531008">[</span><span class="ident" id="5531009">i</span><span class="op" id="5531010">]</span><span class="op" id="5531011">}</span><br>
<span class="lineno"></span><span class="op" id="5531013">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">695</span><span class="comment" id="5531016">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5531095">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5531119">func</span>&nbsp;<span class="op" id="5531124">(</span><span class="ident" id="5531125">p</span>&nbsp;<span class="op" id="5531127">*</span><span class="ident" id="5531128">Gray</span><span class="op" id="5531132">)</span>&nbsp;<span class="ident" id="5531134">PixOffset</span><span class="op" id="5531143">(</span><span class="ident" id="5531144">x</span><span class="op" id="5531145">,</span>&nbsp;<span class="ident" id="5531147">y</span>&nbsp;<span class="builtintype" id="5531149">int</span><span class="op" id="5531152">)</span>&nbsp;<span class="builtintype" id="5531154">int</span>&nbsp;<span class="op" id="5531158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5531161">return</span>&nbsp;<span class="op" id="5531168">(</span><span class="ident" id="5531169">y</span><span class="op" id="5531170">-</span><span class="ident" id="5531171">p</span><span class="op" id="5531172">.</span><span class="ident" id="5531173">Rect</span><span class="op" id="5531177">.</span><span class="ident" id="5531178">Min</span><span class="op" id="5531181">.</span><span class="ident" id="5531182">Y</span><span class="op" id="5531183">)</span><span class="op" id="5531184">*</span><span class="ident" id="5531185">p</span><span class="op" id="5531186">.</span><span class="ident" id="5531187">Stride</span>&nbsp;<span class="op" id="5531194">+</span>&nbsp;<span class="op" id="5531196">(</span><span class="ident" id="5531197">x</span><span class="op" id="5531198">-</span><span class="ident" id="5531199">p</span><span class="op" id="5531200">.</span><span class="ident" id="5531201">Rect</span><span class="op" id="5531205">.</span><span class="ident" id="5531206">Min</span><span class="op" id="5531209">.</span><span class="ident" id="5531210">X</span><span class="op" id="5531211">)</span><span class="op" id="5531212">*</span><span class="num" id="5531213">1</span><br>
<span class="lineno"></span><span class="op" id="5531215">}</span><br>
<span class="lineno">700</span><br>
<span class="lineno"></span><span class="keyword" id="5531218">func</span>&nbsp;<span class="op" id="5531223">(</span><span class="ident" id="5531224">p</span>&nbsp;<span class="op" id="5531226">*</span><span class="ident" id="5531227">Gray</span><span class="op" id="5531231">)</span>&nbsp;<span class="ident" id="5531233">Set</span><span class="op" id="5531236">(</span><span class="ident" id="5531237">x</span><span class="op" id="5531238">,</span>&nbsp;<span class="ident" id="5531240">y</span>&nbsp;<span class="builtintype" id="5531242">int</span><span class="op" id="5531245">,</span>&nbsp;<span class="ident" id="5531247">c</span>&nbsp;<span class="ident" id="5531249">color</span><span class="op" id="5531254">.</span><span class="ident" id="5531255">Color</span><span class="op" id="5531260">)</span>&nbsp;<span class="op" id="5531262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5531265">if</span>&nbsp;<span class="op" id="5531268">!</span><span class="op" id="5531269">(</span><span class="ident" id="5531270">Point</span><span class="op" id="5531275">{</span><span class="ident" id="5531276">x</span><span class="op" id="5531277">,</span>&nbsp;<span class="ident" id="5531279">y</span><span class="op" id="5531280">}</span><span class="op" id="5531281">.</span><span class="ident" id="5531282">In</span><span class="op" id="5531284">(</span><span class="ident" id="5531285">p</span><span class="op" id="5531286">.</span><span class="ident" id="5531287">Rect</span><span class="op" id="5531291">)</span><span class="op" id="5531292">)</span>&nbsp;<span class="op" id="5531294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5531298">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5531306">}</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5531309">i</span>&nbsp;<span class="op" id="5531311">:=</span>&nbsp;<span class="ident" id="5531314">p</span><span class="op" id="5531315">.</span><span class="ident" id="5531316">PixOffset</span><span class="op" id="5531325">(</span><span class="ident" id="5531326">x</span><span class="op" id="5531327">,</span>&nbsp;<span class="ident" id="5531329">y</span><span class="op" id="5531330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5531333">p</span><span class="op" id="5531334">.</span><span class="ident" id="5531335">Pix</span><span class="op" id="5531338">[</span><span class="ident" id="5531339">i</span><span class="op" id="5531340">]</span>&nbsp;<span class="op" id="5531342">=</span>&nbsp;<span class="ident" id="5531344">color</span><span class="op" id="5531349">.</span><span class="ident" id="5531350">GrayModel</span><span class="op" id="5531359">.</span><span class="ident" id="5531360">Convert</span><span class="op" id="5531367">(</span><span class="ident" id="5531368">c</span><span class="op" id="5531369">)</span><span class="op" id="5531370">.</span><span class="op" id="5531371">(</span><span class="ident" id="5531372">color</span><span class="op" id="5531377">.</span><span class="ident" id="5531378">Gray</span><span class="op" id="5531382">)</span><span class="op" id="5531383">.</span><span class="ident" id="5531384">Y</span><br>
<span class="lineno"></span><span class="op" id="5531386">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5531389">func</span>&nbsp;<span class="op" id="5531394">(</span><span class="ident" id="5531395">p</span>&nbsp;<span class="op" id="5531397">*</span><span class="ident" id="5531398">Gray</span><span class="op" id="5531402">)</span>&nbsp;<span class="ident" id="5531404">SetGray</span><span class="op" id="5531411">(</span><span class="ident" id="5531412">x</span><span class="op" id="5531413">,</span>&nbsp;<span class="ident" id="5531415">y</span>&nbsp;<span class="builtintype" id="5531417">int</span><span class="op" id="5531420">,</span>&nbsp;<span class="ident" id="5531422">c</span>&nbsp;<span class="ident" id="5531424">color</span><span class="op" id="5531429">.</span><span class="ident" id="5531430">Gray</span><span class="op" id="5531434">)</span>&nbsp;<span class="op" id="5531436">{</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5531439">if</span>&nbsp;<span class="op" id="5531442">!</span><span class="op" id="5531443">(</span><span class="ident" id="5531444">Point</span><span class="op" id="5531449">{</span><span class="ident" id="5531450">x</span><span class="op" id="5531451">,</span>&nbsp;<span class="ident" id="5531453">y</span><span class="op" id="5531454">}</span><span class="op" id="5531455">.</span><span class="ident" id="5531456">In</span><span class="op" id="5531458">(</span><span class="ident" id="5531459">p</span><span class="op" id="5531460">.</span><span class="ident" id="5531461">Rect</span><span class="op" id="5531465">)</span><span class="op" id="5531466">)</span>&nbsp;<span class="op" id="5531468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5531472">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5531480">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5531483">i</span>&nbsp;<span class="op" id="5531485">:=</span>&nbsp;<span class="ident" id="5531488">p</span><span class="op" id="5531489">.</span><span class="ident" id="5531490">PixOffset</span><span class="op" id="5531499">(</span><span class="ident" id="5531500">x</span><span class="op" id="5531501">,</span>&nbsp;<span class="ident" id="5531503">y</span><span class="op" id="5531504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5531507">p</span><span class="op" id="5531508">.</span><span class="ident" id="5531509">Pix</span><span class="op" id="5531512">[</span><span class="ident" id="5531513">i</span><span class="op" id="5531514">]</span>&nbsp;<span class="op" id="5531516">=</span>&nbsp;<span class="ident" id="5531518">c</span><span class="op" id="5531519">.</span><span class="ident" id="5531520">Y</span><br>
<span class="lineno">715</span><span class="op" id="5531522">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5531525">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5531602">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5531674">func</span>&nbsp;<span class="op" id="5531679">(</span><span class="ident" id="5531680">p</span>&nbsp;<span class="op" id="5531682">*</span><span class="ident" id="5531683">Gray</span><span class="op" id="5531687">)</span>&nbsp;<span class="ident" id="5531689">SubImage</span><span class="op" id="5531697">(</span><span class="ident" id="5531698">r</span>&nbsp;<span class="ident" id="5531700">Rectangle</span><span class="op" id="5531709">)</span>&nbsp;<span class="ident" id="5531711">Image</span>&nbsp;<span class="op" id="5531717">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5531720">r</span>&nbsp;<span class="op" id="5531722">=</span>&nbsp;<span class="ident" id="5531724">r</span><span class="op" id="5531725">.</span><span class="ident" id="5531726">Intersect</span><span class="op" id="5531735">(</span><span class="ident" id="5531736">p</span><span class="op" id="5531737">.</span><span class="ident" id="5531738">Rect</span><span class="op" id="5531742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5531745">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5531826">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5531908">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5531958">if</span>&nbsp;<span class="ident" id="5531961">r</span><span class="op" id="5531962">.</span><span class="ident" id="5531963">Empty</span><span class="op" id="5531968">(</span><span class="op" id="5531969">)</span>&nbsp;<span class="op" id="5531971">{</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5531975">return</span>&nbsp;<span class="op" id="5531982">&amp;</span><span class="ident" id="5531983">Gray</span><span class="op" id="5531987">{</span><span class="op" id="5531988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5531991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5531994">i</span>&nbsp;<span class="op" id="5531996">:=</span>&nbsp;<span class="ident" id="5531999">p</span><span class="op" id="5532000">.</span><span class="ident" id="5532001">PixOffset</span><span class="op" id="5532010">(</span><span class="ident" id="5532011">r</span><span class="op" id="5532012">.</span><span class="ident" id="5532013">Min</span><span class="op" id="5532016">.</span><span class="ident" id="5532017">X</span><span class="op" id="5532018">,</span>&nbsp;<span class="ident" id="5532020">r</span><span class="op" id="5532021">.</span><span class="ident" id="5532022">Min</span><span class="op" id="5532025">.</span><span class="ident" id="5532026">Y</span><span class="op" id="5532027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5532030">return</span>&nbsp;<span class="op" id="5532037">&amp;</span><span class="ident" id="5532038">Gray</span><span class="op" id="5532042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5532046">Pix</span><span class="op" id="5532049">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5532054">p</span><span class="op" id="5532055">.</span><span class="ident" id="5532056">Pix</span><span class="op" id="5532059">[</span><span class="ident" id="5532060">i</span><span class="op" id="5532061">:</span><span class="op" id="5532062">]</span><span class="op" id="5532063">,</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5532067">Stride</span><span class="op" id="5532073">:</span>&nbsp;<span class="ident" id="5532075">p</span><span class="op" id="5532076">.</span><span class="ident" id="5532077">Stride</span><span class="op" id="5532083">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5532087">Rect</span><span class="op" id="5532091">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5532095">r</span><span class="op" id="5532096">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5532099">}</span><br>
<span class="lineno"></span><span class="op" id="5532101">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">735</span><span class="comment" id="5532104">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5532177">func</span>&nbsp;<span class="op" id="5532182">(</span><span class="ident" id="5532183">p</span>&nbsp;<span class="op" id="5532185">*</span><span class="ident" id="5532186">Gray</span><span class="op" id="5532190">)</span>&nbsp;<span class="ident" id="5532192">Opaque</span><span class="op" id="5532198">(</span><span class="op" id="5532199">)</span>&nbsp;<span class="builtintype" id="5532201">bool</span>&nbsp;<span class="op" id="5532206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5532209">return</span>&nbsp;<span class="builtintype" id="5532216">true</span><br>
<span class="lineno"></span><span class="op" id="5532221">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">740</span><span class="comment" id="5532224">//&nbsp;NewGray&nbsp;returns&nbsp;a&nbsp;new&nbsp;Gray&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="5532277">func</span>&nbsp;<span class="ident" id="5532282">NewGray</span><span class="op" id="5532289">(</span><span class="ident" id="5532290">r</span>&nbsp;<span class="ident" id="5532292">Rectangle</span><span class="op" id="5532301">)</span>&nbsp;<span class="op" id="5532303">*</span><span class="ident" id="5532304">Gray</span>&nbsp;<span class="op" id="5532309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5532312">w</span><span class="op" id="5532313">,</span>&nbsp;<span class="ident" id="5532315">h</span>&nbsp;<span class="op" id="5532317">:=</span>&nbsp;<span class="ident" id="5532320">r</span><span class="op" id="5532321">.</span><span class="ident" id="5532322">Dx</span><span class="op" id="5532324">(</span><span class="op" id="5532325">)</span><span class="op" id="5532326">,</span>&nbsp;<span class="ident" id="5532328">r</span><span class="op" id="5532329">.</span><span class="ident" id="5532330">Dy</span><span class="op" id="5532332">(</span><span class="op" id="5532333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5532336">pix</span>&nbsp;<span class="op" id="5532340">:=</span>&nbsp;<span class="builtinfunc" id="5532343">make</span><span class="op" id="5532347">(</span><span class="op" id="5532348">[</span><span class="op" id="5532349">]</span><span class="builtintype" id="5532350">uint8</span><span class="op" id="5532355">,</span>&nbsp;<span class="num" id="5532357">1</span><span class="op" id="5532358">*</span><span class="ident" id="5532359">w</span><span class="op" id="5532360">*</span><span class="ident" id="5532361">h</span><span class="op" id="5532362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5532365">return</span>&nbsp;<span class="op" id="5532372">&amp;</span><span class="ident" id="5532373">Gray</span><span class="op" id="5532377">{</span><span class="ident" id="5532378">pix</span><span class="op" id="5532381">,</span>&nbsp;<span class="num" id="5532383">1</span>&nbsp;<span class="op" id="5532385">*</span>&nbsp;<span class="ident" id="5532387">w</span><span class="op" id="5532388">,</span>&nbsp;<span class="ident" id="5532390">r</span><span class="op" id="5532391">}</span><br>
<span class="lineno">745</span><span class="op" id="5532393">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5532396">//&nbsp;Gray16&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.Gray16&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5532473">type</span>&nbsp;<span class="ident" id="5532478">Gray16</span>&nbsp;<span class="keyword" id="5532485">struct</span>&nbsp;<span class="op" id="5532492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5532495">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;gray&nbsp;values&nbsp;in&nbsp;big-endian&nbsp;format.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5532579">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*2].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5532647">Pix</span>&nbsp;<span class="op" id="5532651">[</span><span class="op" id="5532652">]</span><span class="builtintype" id="5532653">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5532660">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5532736">Stride</span>&nbsp;<span class="builtintype" id="5532743">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5532748">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5532780">Rect</span>&nbsp;<span class="ident" id="5532785">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="5532795">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5532798">func</span>&nbsp;<span class="op" id="5532803">(</span><span class="ident" id="5532804">p</span>&nbsp;<span class="op" id="5532806">*</span><span class="ident" id="5532807">Gray16</span><span class="op" id="5532813">)</span>&nbsp;<span class="ident" id="5532815">ColorModel</span><span class="op" id="5532825">(</span><span class="op" id="5532826">)</span>&nbsp;<span class="ident" id="5532828">color</span><span class="op" id="5532833">.</span><span class="ident" id="5532834">Model</span>&nbsp;<span class="op" id="5532840">{</span>&nbsp;<span class="keyword" id="5532842">return</span>&nbsp;<span class="ident" id="5532849">color</span><span class="op" id="5532854">.</span><span class="ident" id="5532855">Gray16Model</span>&nbsp;<span class="op" id="5532867">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">760</span><span class="keyword" id="5532870">func</span>&nbsp;<span class="op" id="5532875">(</span><span class="ident" id="5532876">p</span>&nbsp;<span class="op" id="5532878">*</span><span class="ident" id="5532879">Gray16</span><span class="op" id="5532885">)</span>&nbsp;<span class="ident" id="5532887">Bounds</span><span class="op" id="5532893">(</span><span class="op" id="5532894">)</span>&nbsp;<span class="ident" id="5532896">Rectangle</span>&nbsp;<span class="op" id="5532906">{</span>&nbsp;<span class="keyword" id="5532908">return</span>&nbsp;<span class="ident" id="5532915">p</span><span class="op" id="5532916">.</span><span class="ident" id="5532917">Rect</span>&nbsp;<span class="op" id="5532922">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5532925">func</span>&nbsp;<span class="op" id="5532930">(</span><span class="ident" id="5532931">p</span>&nbsp;<span class="op" id="5532933">*</span><span class="ident" id="5532934">Gray16</span><span class="op" id="5532940">)</span>&nbsp;<span class="ident" id="5532942">At</span><span class="op" id="5532944">(</span><span class="ident" id="5532945">x</span><span class="op" id="5532946">,</span>&nbsp;<span class="ident" id="5532948">y</span>&nbsp;<span class="builtintype" id="5532950">int</span><span class="op" id="5532953">)</span>&nbsp;<span class="ident" id="5532955">color</span><span class="op" id="5532960">.</span><span class="ident" id="5532961">Color</span>&nbsp;<span class="op" id="5532967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5532970">return</span>&nbsp;<span class="ident" id="5532977">p</span><span class="op" id="5532978">.</span><span class="ident" id="5532979">Gray16At</span><span class="op" id="5532987">(</span><span class="ident" id="5532988">x</span><span class="op" id="5532989">,</span>&nbsp;<span class="ident" id="5532991">y</span><span class="op" id="5532992">)</span><br>
<span class="lineno"></span><span class="op" id="5532994">}</span><br>
<span class="lineno">765</span><br>
<span class="lineno"></span><span class="keyword" id="5532997">func</span>&nbsp;<span class="op" id="5533002">(</span><span class="ident" id="5533003">p</span>&nbsp;<span class="op" id="5533005">*</span><span class="ident" id="5533006">Gray16</span><span class="op" id="5533012">)</span>&nbsp;<span class="ident" id="5533014">Gray16At</span><span class="op" id="5533022">(</span><span class="ident" id="5533023">x</span><span class="op" id="5533024">,</span>&nbsp;<span class="ident" id="5533026">y</span>&nbsp;<span class="builtintype" id="5533028">int</span><span class="op" id="5533031">)</span>&nbsp;<span class="ident" id="5533033">color</span><span class="op" id="5533038">.</span><span class="ident" id="5533039">Gray16</span>&nbsp;<span class="op" id="5533046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5533049">if</span>&nbsp;<span class="op" id="5533052">!</span><span class="op" id="5533053">(</span><span class="ident" id="5533054">Point</span><span class="op" id="5533059">{</span><span class="ident" id="5533060">x</span><span class="op" id="5533061">,</span>&nbsp;<span class="ident" id="5533063">y</span><span class="op" id="5533064">}</span><span class="op" id="5533065">.</span><span class="ident" id="5533066">In</span><span class="op" id="5533068">(</span><span class="ident" id="5533069">p</span><span class="op" id="5533070">.</span><span class="ident" id="5533071">Rect</span><span class="op" id="5533075">)</span><span class="op" id="5533076">)</span>&nbsp;<span class="op" id="5533078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5533082">return</span>&nbsp;<span class="ident" id="5533089">color</span><span class="op" id="5533094">.</span><span class="ident" id="5533095">Gray16</span><span class="op" id="5533101">{</span><span class="op" id="5533102">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5533105">}</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5533108">i</span>&nbsp;<span class="op" id="5533110">:=</span>&nbsp;<span class="ident" id="5533113">p</span><span class="op" id="5533114">.</span><span class="ident" id="5533115">PixOffset</span><span class="op" id="5533124">(</span><span class="ident" id="5533125">x</span><span class="op" id="5533126">,</span>&nbsp;<span class="ident" id="5533128">y</span><span class="op" id="5533129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5533132">return</span>&nbsp;<span class="ident" id="5533139">color</span><span class="op" id="5533144">.</span><span class="ident" id="5533145">Gray16</span><span class="op" id="5533151">{</span><span class="builtintype" id="5533152">uint16</span><span class="op" id="5533158">(</span><span class="ident" id="5533159">p</span><span class="op" id="5533160">.</span><span class="ident" id="5533161">Pix</span><span class="op" id="5533164">[</span><span class="ident" id="5533165">i</span><span class="op" id="5533166">+</span><span class="num" id="5533167">0</span><span class="op" id="5533168">]</span><span class="op" id="5533169">)</span><span class="op" id="5533170">&lt;&lt;</span><span class="num" id="5533172">8</span>&nbsp;<span class="op" id="5533174">|</span>&nbsp;<span class="builtintype" id="5533176">uint16</span><span class="op" id="5533182">(</span><span class="ident" id="5533183">p</span><span class="op" id="5533184">.</span><span class="ident" id="5533185">Pix</span><span class="op" id="5533188">[</span><span class="ident" id="5533189">i</span><span class="op" id="5533190">+</span><span class="num" id="5533191">1</span><span class="op" id="5533192">]</span><span class="op" id="5533193">)</span><span class="op" id="5533194">}</span><br>
<span class="lineno"></span><span class="op" id="5533196">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5533199">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno">775</span><span class="comment" id="5533278">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5533302">func</span>&nbsp;<span class="op" id="5533307">(</span><span class="ident" id="5533308">p</span>&nbsp;<span class="op" id="5533310">*</span><span class="ident" id="5533311">Gray16</span><span class="op" id="5533317">)</span>&nbsp;<span class="ident" id="5533319">PixOffset</span><span class="op" id="5533328">(</span><span class="ident" id="5533329">x</span><span class="op" id="5533330">,</span>&nbsp;<span class="ident" id="5533332">y</span>&nbsp;<span class="builtintype" id="5533334">int</span><span class="op" id="5533337">)</span>&nbsp;<span class="builtintype" id="5533339">int</span>&nbsp;<span class="op" id="5533343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5533346">return</span>&nbsp;<span class="op" id="5533353">(</span><span class="ident" id="5533354">y</span><span class="op" id="5533355">-</span><span class="ident" id="5533356">p</span><span class="op" id="5533357">.</span><span class="ident" id="5533358">Rect</span><span class="op" id="5533362">.</span><span class="ident" id="5533363">Min</span><span class="op" id="5533366">.</span><span class="ident" id="5533367">Y</span><span class="op" id="5533368">)</span><span class="op" id="5533369">*</span><span class="ident" id="5533370">p</span><span class="op" id="5533371">.</span><span class="ident" id="5533372">Stride</span>&nbsp;<span class="op" id="5533379">+</span>&nbsp;<span class="op" id="5533381">(</span><span class="ident" id="5533382">x</span><span class="op" id="5533383">-</span><span class="ident" id="5533384">p</span><span class="op" id="5533385">.</span><span class="ident" id="5533386">Rect</span><span class="op" id="5533390">.</span><span class="ident" id="5533391">Min</span><span class="op" id="5533394">.</span><span class="ident" id="5533395">X</span><span class="op" id="5533396">)</span><span class="op" id="5533397">*</span><span class="num" id="5533398">2</span><br>
<span class="lineno"></span><span class="op" id="5533400">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">780</span><span class="keyword" id="5533403">func</span>&nbsp;<span class="op" id="5533408">(</span><span class="ident" id="5533409">p</span>&nbsp;<span class="op" id="5533411">*</span><span class="ident" id="5533412">Gray16</span><span class="op" id="5533418">)</span>&nbsp;<span class="ident" id="5533420">Set</span><span class="op" id="5533423">(</span><span class="ident" id="5533424">x</span><span class="op" id="5533425">,</span>&nbsp;<span class="ident" id="5533427">y</span>&nbsp;<span class="builtintype" id="5533429">int</span><span class="op" id="5533432">,</span>&nbsp;<span class="ident" id="5533434">c</span>&nbsp;<span class="ident" id="5533436">color</span><span class="op" id="5533441">.</span><span class="ident" id="5533442">Color</span><span class="op" id="5533447">)</span>&nbsp;<span class="op" id="5533449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5533452">if</span>&nbsp;<span class="op" id="5533455">!</span><span class="op" id="5533456">(</span><span class="ident" id="5533457">Point</span><span class="op" id="5533462">{</span><span class="ident" id="5533463">x</span><span class="op" id="5533464">,</span>&nbsp;<span class="ident" id="5533466">y</span><span class="op" id="5533467">}</span><span class="op" id="5533468">.</span><span class="ident" id="5533469">In</span><span class="op" id="5533471">(</span><span class="ident" id="5533472">p</span><span class="op" id="5533473">.</span><span class="ident" id="5533474">Rect</span><span class="op" id="5533478">)</span><span class="op" id="5533479">)</span>&nbsp;<span class="op" id="5533481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5533485">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5533493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5533496">i</span>&nbsp;<span class="op" id="5533498">:=</span>&nbsp;<span class="ident" id="5533501">p</span><span class="op" id="5533502">.</span><span class="ident" id="5533503">PixOffset</span><span class="op" id="5533512">(</span><span class="ident" id="5533513">x</span><span class="op" id="5533514">,</span>&nbsp;<span class="ident" id="5533516">y</span><span class="op" id="5533517">)</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5533520">c1</span>&nbsp;<span class="op" id="5533523">:=</span>&nbsp;<span class="ident" id="5533526">color</span><span class="op" id="5533531">.</span><span class="ident" id="5533532">Gray16Model</span><span class="op" id="5533543">.</span><span class="ident" id="5533544">Convert</span><span class="op" id="5533551">(</span><span class="ident" id="5533552">c</span><span class="op" id="5533553">)</span><span class="op" id="5533554">.</span><span class="op" id="5533555">(</span><span class="ident" id="5533556">color</span><span class="op" id="5533561">.</span><span class="ident" id="5533562">Gray16</span><span class="op" id="5533568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5533571">p</span><span class="op" id="5533572">.</span><span class="ident" id="5533573">Pix</span><span class="op" id="5533576">[</span><span class="ident" id="5533577">i</span><span class="op" id="5533578">+</span><span class="num" id="5533579">0</span><span class="op" id="5533580">]</span>&nbsp;<span class="op" id="5533582">=</span>&nbsp;<span class="builtintype" id="5533584">uint8</span><span class="op" id="5533589">(</span><span class="ident" id="5533590">c1</span><span class="op" id="5533592">.</span><span class="ident" id="5533593">Y</span>&nbsp;<span class="op" id="5533595">&gt;&gt;</span>&nbsp;<span class="num" id="5533598">8</span><span class="op" id="5533599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5533602">p</span><span class="op" id="5533603">.</span><span class="ident" id="5533604">Pix</span><span class="op" id="5533607">[</span><span class="ident" id="5533608">i</span><span class="op" id="5533609">+</span><span class="num" id="5533610">1</span><span class="op" id="5533611">]</span>&nbsp;<span class="op" id="5533613">=</span>&nbsp;<span class="builtintype" id="5533615">uint8</span><span class="op" id="5533620">(</span><span class="ident" id="5533621">c1</span><span class="op" id="5533623">.</span><span class="ident" id="5533624">Y</span><span class="op" id="5533625">)</span><br>
<span class="lineno"></span><span class="op" id="5533627">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">790</span><span class="keyword" id="5533630">func</span>&nbsp;<span class="op" id="5533635">(</span><span class="ident" id="5533636">p</span>&nbsp;<span class="op" id="5533638">*</span><span class="ident" id="5533639">Gray16</span><span class="op" id="5533645">)</span>&nbsp;<span class="ident" id="5533647">SetGray16</span><span class="op" id="5533656">(</span><span class="ident" id="5533657">x</span><span class="op" id="5533658">,</span>&nbsp;<span class="ident" id="5533660">y</span>&nbsp;<span class="builtintype" id="5533662">int</span><span class="op" id="5533665">,</span>&nbsp;<span class="ident" id="5533667">c</span>&nbsp;<span class="ident" id="5533669">color</span><span class="op" id="5533674">.</span><span class="ident" id="5533675">Gray16</span><span class="op" id="5533681">)</span>&nbsp;<span class="op" id="5533683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5533686">if</span>&nbsp;<span class="op" id="5533689">!</span><span class="op" id="5533690">(</span><span class="ident" id="5533691">Point</span><span class="op" id="5533696">{</span><span class="ident" id="5533697">x</span><span class="op" id="5533698">,</span>&nbsp;<span class="ident" id="5533700">y</span><span class="op" id="5533701">}</span><span class="op" id="5533702">.</span><span class="ident" id="5533703">In</span><span class="op" id="5533705">(</span><span class="ident" id="5533706">p</span><span class="op" id="5533707">.</span><span class="ident" id="5533708">Rect</span><span class="op" id="5533712">)</span><span class="op" id="5533713">)</span>&nbsp;<span class="op" id="5533715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5533719">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5533727">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5533730">i</span>&nbsp;<span class="op" id="5533732">:=</span>&nbsp;<span class="ident" id="5533735">p</span><span class="op" id="5533736">.</span><span class="ident" id="5533737">PixOffset</span><span class="op" id="5533746">(</span><span class="ident" id="5533747">x</span><span class="op" id="5533748">,</span>&nbsp;<span class="ident" id="5533750">y</span><span class="op" id="5533751">)</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5533754">p</span><span class="op" id="5533755">.</span><span class="ident" id="5533756">Pix</span><span class="op" id="5533759">[</span><span class="ident" id="5533760">i</span><span class="op" id="5533761">+</span><span class="num" id="5533762">0</span><span class="op" id="5533763">]</span>&nbsp;<span class="op" id="5533765">=</span>&nbsp;<span class="builtintype" id="5533767">uint8</span><span class="op" id="5533772">(</span><span class="ident" id="5533773">c</span><span class="op" id="5533774">.</span><span class="ident" id="5533775">Y</span>&nbsp;<span class="op" id="5533777">&gt;&gt;</span>&nbsp;<span class="num" id="5533780">8</span><span class="op" id="5533781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5533784">p</span><span class="op" id="5533785">.</span><span class="ident" id="5533786">Pix</span><span class="op" id="5533789">[</span><span class="ident" id="5533790">i</span><span class="op" id="5533791">+</span><span class="num" id="5533792">1</span><span class="op" id="5533793">]</span>&nbsp;<span class="op" id="5533795">=</span>&nbsp;<span class="builtintype" id="5533797">uint8</span><span class="op" id="5533802">(</span><span class="ident" id="5533803">c</span><span class="op" id="5533804">.</span><span class="ident" id="5533805">Y</span><span class="op" id="5533806">)</span><br>
<span class="lineno"></span><span class="op" id="5533808">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5533811">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno">800</span><span class="comment" id="5533888">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5533960">func</span>&nbsp;<span class="op" id="5533965">(</span><span class="ident" id="5533966">p</span>&nbsp;<span class="op" id="5533968">*</span><span class="ident" id="5533969">Gray16</span><span class="op" id="5533975">)</span>&nbsp;<span class="ident" id="5533977">SubImage</span><span class="op" id="5533985">(</span><span class="ident" id="5533986">r</span>&nbsp;<span class="ident" id="5533988">Rectangle</span><span class="op" id="5533997">)</span>&nbsp;<span class="ident" id="5533999">Image</span>&nbsp;<span class="op" id="5534005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5534008">r</span>&nbsp;<span class="op" id="5534010">=</span>&nbsp;<span class="ident" id="5534012">r</span><span class="op" id="5534013">.</span><span class="ident" id="5534014">Intersect</span><span class="op" id="5534023">(</span><span class="ident" id="5534024">p</span><span class="op" id="5534025">.</span><span class="ident" id="5534026">Rect</span><span class="op" id="5534030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5534033">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5534114">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5534196">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5534246">if</span>&nbsp;<span class="ident" id="5534249">r</span><span class="op" id="5534250">.</span><span class="ident" id="5534251">Empty</span><span class="op" id="5534256">(</span><span class="op" id="5534257">)</span>&nbsp;<span class="op" id="5534259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5534263">return</span>&nbsp;<span class="op" id="5534270">&amp;</span><span class="ident" id="5534271">Gray16</span><span class="op" id="5534277">{</span><span class="op" id="5534278">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5534281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5534284">i</span>&nbsp;<span class="op" id="5534286">:=</span>&nbsp;<span class="ident" id="5534289">p</span><span class="op" id="5534290">.</span><span class="ident" id="5534291">PixOffset</span><span class="op" id="5534300">(</span><span class="ident" id="5534301">r</span><span class="op" id="5534302">.</span><span class="ident" id="5534303">Min</span><span class="op" id="5534306">.</span><span class="ident" id="5534307">X</span><span class="op" id="5534308">,</span>&nbsp;<span class="ident" id="5534310">r</span><span class="op" id="5534311">.</span><span class="ident" id="5534312">Min</span><span class="op" id="5534315">.</span><span class="ident" id="5534316">Y</span><span class="op" id="5534317">)</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5534320">return</span>&nbsp;<span class="op" id="5534327">&amp;</span><span class="ident" id="5534328">Gray16</span><span class="op" id="5534334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5534338">Pix</span><span class="op" id="5534341">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5534346">p</span><span class="op" id="5534347">.</span><span class="ident" id="5534348">Pix</span><span class="op" id="5534351">[</span><span class="ident" id="5534352">i</span><span class="op" id="5534353">:</span><span class="op" id="5534354">]</span><span class="op" id="5534355">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5534359">Stride</span><span class="op" id="5534365">:</span>&nbsp;<span class="ident" id="5534367">p</span><span class="op" id="5534368">.</span><span class="ident" id="5534369">Stride</span><span class="op" id="5534375">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5534379">Rect</span><span class="op" id="5534383">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5534387">r</span><span class="op" id="5534388">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5534391">}</span><br>
<span class="lineno">815</span><span class="op" id="5534393">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5534396">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5534469">func</span>&nbsp;<span class="op" id="5534474">(</span><span class="ident" id="5534475">p</span>&nbsp;<span class="op" id="5534477">*</span><span class="ident" id="5534478">Gray16</span><span class="op" id="5534484">)</span>&nbsp;<span class="ident" id="5534486">Opaque</span><span class="op" id="5534492">(</span><span class="op" id="5534493">)</span>&nbsp;<span class="builtintype" id="5534495">bool</span>&nbsp;<span class="op" id="5534500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5534503">return</span>&nbsp;<span class="builtintype" id="5534510">true</span><br>
<span class="lineno">820</span><span class="op" id="5534515">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5534518">//&nbsp;NewGray16&nbsp;returns&nbsp;a&nbsp;new&nbsp;Gray16&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="5534575">func</span>&nbsp;<span class="ident" id="5534580">NewGray16</span><span class="op" id="5534589">(</span><span class="ident" id="5534590">r</span>&nbsp;<span class="ident" id="5534592">Rectangle</span><span class="op" id="5534601">)</span>&nbsp;<span class="op" id="5534603">*</span><span class="ident" id="5534604">Gray16</span>&nbsp;<span class="op" id="5534611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5534614">w</span><span class="op" id="5534615">,</span>&nbsp;<span class="ident" id="5534617">h</span>&nbsp;<span class="op" id="5534619">:=</span>&nbsp;<span class="ident" id="5534622">r</span><span class="op" id="5534623">.</span><span class="ident" id="5534624">Dx</span><span class="op" id="5534626">(</span><span class="op" id="5534627">)</span><span class="op" id="5534628">,</span>&nbsp;<span class="ident" id="5534630">r</span><span class="op" id="5534631">.</span><span class="ident" id="5534632">Dy</span><span class="op" id="5534634">(</span><span class="op" id="5534635">)</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5534638">pix</span>&nbsp;<span class="op" id="5534642">:=</span>&nbsp;<span class="builtinfunc" id="5534645">make</span><span class="op" id="5534649">(</span><span class="op" id="5534650">[</span><span class="op" id="5534651">]</span><span class="builtintype" id="5534652">uint8</span><span class="op" id="5534657">,</span>&nbsp;<span class="num" id="5534659">2</span><span class="op" id="5534660">*</span><span class="ident" id="5534661">w</span><span class="op" id="5534662">*</span><span class="ident" id="5534663">h</span><span class="op" id="5534664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5534667">return</span>&nbsp;<span class="op" id="5534674">&amp;</span><span class="ident" id="5534675">Gray16</span><span class="op" id="5534681">{</span><span class="ident" id="5534682">pix</span><span class="op" id="5534685">,</span>&nbsp;<span class="num" id="5534687">2</span>&nbsp;<span class="op" id="5534689">*</span>&nbsp;<span class="ident" id="5534691">w</span><span class="op" id="5534692">,</span>&nbsp;<span class="ident" id="5534694">r</span><span class="op" id="5534695">}</span><br>
<span class="lineno"></span><span class="op" id="5534697">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5534700">//&nbsp;Paletted&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;of&nbsp;uint8&nbsp;indices&nbsp;into&nbsp;a&nbsp;given&nbsp;palette.</span><br>
<span class="lineno">830</span><span class="keyword" id="5534773">type</span>&nbsp;<span class="ident" id="5534778">Paletted</span>&nbsp;<span class="keyword" id="5534787">struct</span>&nbsp;<span class="op" id="5534794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5534797">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;palette&nbsp;indices.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5534864">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*1].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5534932">Pix</span>&nbsp;<span class="op" id="5534936">[</span><span class="op" id="5534937">]</span><span class="builtintype" id="5534938">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5534945">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5535021">Stride</span>&nbsp;<span class="builtintype" id="5535028">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5535033">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5535065">Rect</span>&nbsp;<span class="ident" id="5535070">Rectangle</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5535081">//&nbsp;Palette&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5535117">Palette</span>&nbsp;<span class="ident" id="5535125">color</span><span class="op" id="5535130">.</span><span class="ident" id="5535131">Palette</span><br>
<span class="lineno">840</span><span class="op" id="5535139">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5535142">func</span>&nbsp;<span class="op" id="5535147">(</span><span class="ident" id="5535148">p</span>&nbsp;<span class="op" id="5535150">*</span><span class="ident" id="5535151">Paletted</span><span class="op" id="5535159">)</span>&nbsp;<span class="ident" id="5535161">ColorModel</span><span class="op" id="5535171">(</span><span class="op" id="5535172">)</span>&nbsp;<span class="ident" id="5535174">color</span><span class="op" id="5535179">.</span><span class="ident" id="5535180">Model</span>&nbsp;<span class="op" id="5535186">{</span>&nbsp;<span class="keyword" id="5535188">return</span>&nbsp;<span class="ident" id="5535195">p</span><span class="op" id="5535196">.</span><span class="ident" id="5535197">Palette</span>&nbsp;<span class="op" id="5535205">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5535208">func</span>&nbsp;<span class="op" id="5535213">(</span><span class="ident" id="5535214">p</span>&nbsp;<span class="op" id="5535216">*</span><span class="ident" id="5535217">Paletted</span><span class="op" id="5535225">)</span>&nbsp;<span class="ident" id="5535227">Bounds</span><span class="op" id="5535233">(</span><span class="op" id="5535234">)</span>&nbsp;<span class="ident" id="5535236">Rectangle</span>&nbsp;<span class="op" id="5535246">{</span>&nbsp;<span class="keyword" id="5535248">return</span>&nbsp;<span class="ident" id="5535255">p</span><span class="op" id="5535256">.</span><span class="ident" id="5535257">Rect</span>&nbsp;<span class="op" id="5535262">}</span><br>
<span class="lineno">845</span><br>
<span class="lineno"></span><span class="keyword" id="5535265">func</span>&nbsp;<span class="op" id="5535270">(</span><span class="ident" id="5535271">p</span>&nbsp;<span class="op" id="5535273">*</span><span class="ident" id="5535274">Paletted</span><span class="op" id="5535282">)</span>&nbsp;<span class="ident" id="5535284">At</span><span class="op" id="5535286">(</span><span class="ident" id="5535287">x</span><span class="op" id="5535288">,</span>&nbsp;<span class="ident" id="5535290">y</span>&nbsp;<span class="builtintype" id="5535292">int</span><span class="op" id="5535295">)</span>&nbsp;<span class="ident" id="5535297">color</span><span class="op" id="5535302">.</span><span class="ident" id="5535303">Color</span>&nbsp;<span class="op" id="5535309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5535312">if</span>&nbsp;<span class="builtinfunc" id="5535315">len</span><span class="op" id="5535318">(</span><span class="ident" id="5535319">p</span><span class="op" id="5535320">.</span><span class="ident" id="5535321">Palette</span><span class="op" id="5535328">)</span>&nbsp;<span class="op" id="5535330">==</span>&nbsp;<span class="num" id="5535333">0</span>&nbsp;<span class="op" id="5535335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5535339">return</span>&nbsp;<span class="ident" id="5535346">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5535351">}</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5535354">if</span>&nbsp;<span class="op" id="5535357">!</span><span class="op" id="5535358">(</span><span class="ident" id="5535359">Point</span><span class="op" id="5535364">{</span><span class="ident" id="5535365">x</span><span class="op" id="5535366">,</span>&nbsp;<span class="ident" id="5535368">y</span><span class="op" id="5535369">}</span><span class="op" id="5535370">.</span><span class="ident" id="5535371">In</span><span class="op" id="5535373">(</span><span class="ident" id="5535374">p</span><span class="op" id="5535375">.</span><span class="ident" id="5535376">Rect</span><span class="op" id="5535380">)</span><span class="op" id="5535381">)</span>&nbsp;<span class="op" id="5535383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5535387">return</span>&nbsp;<span class="ident" id="5535394">p</span><span class="op" id="5535395">.</span><span class="ident" id="5535396">Palette</span><span class="op" id="5535403">[</span><span class="num" id="5535404">0</span><span class="op" id="5535405">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5535408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5535411">i</span>&nbsp;<span class="op" id="5535413">:=</span>&nbsp;<span class="ident" id="5535416">p</span><span class="op" id="5535417">.</span><span class="ident" id="5535418">PixOffset</span><span class="op" id="5535427">(</span><span class="ident" id="5535428">x</span><span class="op" id="5535429">,</span>&nbsp;<span class="ident" id="5535431">y</span><span class="op" id="5535432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5535435">return</span>&nbsp;<span class="ident" id="5535442">p</span><span class="op" id="5535443">.</span><span class="ident" id="5535444">Palette</span><span class="op" id="5535451">[</span><span class="ident" id="5535452">p</span><span class="op" id="5535453">.</span><span class="ident" id="5535454">Pix</span><span class="op" id="5535457">[</span><span class="ident" id="5535458">i</span><span class="op" id="5535459">]</span><span class="op" id="5535460">]</span><br>
<span class="lineno">855</span><span class="op" id="5535462">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5535465">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5535544">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5535568">func</span>&nbsp;<span class="op" id="5535573">(</span><span class="ident" id="5535574">p</span>&nbsp;<span class="op" id="5535576">*</span><span class="ident" id="5535577">Paletted</span><span class="op" id="5535585">)</span>&nbsp;<span class="ident" id="5535587">PixOffset</span><span class="op" id="5535596">(</span><span class="ident" id="5535597">x</span><span class="op" id="5535598">,</span>&nbsp;<span class="ident" id="5535600">y</span>&nbsp;<span class="builtintype" id="5535602">int</span><span class="op" id="5535605">)</span>&nbsp;<span class="builtintype" id="5535607">int</span>&nbsp;<span class="op" id="5535611">{</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5535614">return</span>&nbsp;<span class="op" id="5535621">(</span><span class="ident" id="5535622">y</span><span class="op" id="5535623">-</span><span class="ident" id="5535624">p</span><span class="op" id="5535625">.</span><span class="ident" id="5535626">Rect</span><span class="op" id="5535630">.</span><span class="ident" id="5535631">Min</span><span class="op" id="5535634">.</span><span class="ident" id="5535635">Y</span><span class="op" id="5535636">)</span><span class="op" id="5535637">*</span><span class="ident" id="5535638">p</span><span class="op" id="5535639">.</span><span class="ident" id="5535640">Stride</span>&nbsp;<span class="op" id="5535647">+</span>&nbsp;<span class="op" id="5535649">(</span><span class="ident" id="5535650">x</span><span class="op" id="5535651">-</span><span class="ident" id="5535652">p</span><span class="op" id="5535653">.</span><span class="ident" id="5535654">Rect</span><span class="op" id="5535658">.</span><span class="ident" id="5535659">Min</span><span class="op" id="5535662">.</span><span class="ident" id="5535663">X</span><span class="op" id="5535664">)</span><span class="op" id="5535665">*</span><span class="num" id="5535666">1</span><br>
<span class="lineno"></span><span class="op" id="5535668">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5535671">func</span>&nbsp;<span class="op" id="5535676">(</span><span class="ident" id="5535677">p</span>&nbsp;<span class="op" id="5535679">*</span><span class="ident" id="5535680">Paletted</span><span class="op" id="5535688">)</span>&nbsp;<span class="ident" id="5535690">Set</span><span class="op" id="5535693">(</span><span class="ident" id="5535694">x</span><span class="op" id="5535695">,</span>&nbsp;<span class="ident" id="5535697">y</span>&nbsp;<span class="builtintype" id="5535699">int</span><span class="op" id="5535702">,</span>&nbsp;<span class="ident" id="5535704">c</span>&nbsp;<span class="ident" id="5535706">color</span><span class="op" id="5535711">.</span><span class="ident" id="5535712">Color</span><span class="op" id="5535717">)</span>&nbsp;<span class="op" id="5535719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5535722">if</span>&nbsp;<span class="op" id="5535725">!</span><span class="op" id="5535726">(</span><span class="ident" id="5535727">Point</span><span class="op" id="5535732">{</span><span class="ident" id="5535733">x</span><span class="op" id="5535734">,</span>&nbsp;<span class="ident" id="5535736">y</span><span class="op" id="5535737">}</span><span class="op" id="5535738">.</span><span class="ident" id="5535739">In</span><span class="op" id="5535741">(</span><span class="ident" id="5535742">p</span><span class="op" id="5535743">.</span><span class="ident" id="5535744">Rect</span><span class="op" id="5535748">)</span><span class="op" id="5535749">)</span>&nbsp;<span class="op" id="5535751">{</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5535755">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5535763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5535766">i</span>&nbsp;<span class="op" id="5535768">:=</span>&nbsp;<span class="ident" id="5535771">p</span><span class="op" id="5535772">.</span><span class="ident" id="5535773">PixOffset</span><span class="op" id="5535782">(</span><span class="ident" id="5535783">x</span><span class="op" id="5535784">,</span>&nbsp;<span class="ident" id="5535786">y</span><span class="op" id="5535787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5535790">p</span><span class="op" id="5535791">.</span><span class="ident" id="5535792">Pix</span><span class="op" id="5535795">[</span><span class="ident" id="5535796">i</span><span class="op" id="5535797">]</span>&nbsp;<span class="op" id="5535799">=</span>&nbsp;<span class="builtintype" id="5535801">uint8</span><span class="op" id="5535806">(</span><span class="ident" id="5535807">p</span><span class="op" id="5535808">.</span><span class="ident" id="5535809">Palette</span><span class="op" id="5535816">.</span><span class="ident" id="5535817">Index</span><span class="op" id="5535822">(</span><span class="ident" id="5535823">c</span><span class="op" id="5535824">)</span><span class="op" id="5535825">)</span><br>
<span class="lineno"></span><span class="op" id="5535827">}</span><br>
<span class="lineno">870</span><br>
<span class="lineno"></span><span class="keyword" id="5535830">func</span>&nbsp;<span class="op" id="5535835">(</span><span class="ident" id="5535836">p</span>&nbsp;<span class="op" id="5535838">*</span><span class="ident" id="5535839">Paletted</span><span class="op" id="5535847">)</span>&nbsp;<span class="ident" id="5535849">ColorIndexAt</span><span class="op" id="5535861">(</span><span class="ident" id="5535862">x</span><span class="op" id="5535863">,</span>&nbsp;<span class="ident" id="5535865">y</span>&nbsp;<span class="builtintype" id="5535867">int</span><span class="op" id="5535870">)</span>&nbsp;<span class="builtintype" id="5535872">uint8</span>&nbsp;<span class="op" id="5535878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5535881">if</span>&nbsp;<span class="op" id="5535884">!</span><span class="op" id="5535885">(</span><span class="ident" id="5535886">Point</span><span class="op" id="5535891">{</span><span class="ident" id="5535892">x</span><span class="op" id="5535893">,</span>&nbsp;<span class="ident" id="5535895">y</span><span class="op" id="5535896">}</span><span class="op" id="5535897">.</span><span class="ident" id="5535898">In</span><span class="op" id="5535900">(</span><span class="ident" id="5535901">p</span><span class="op" id="5535902">.</span><span class="ident" id="5535903">Rect</span><span class="op" id="5535907">)</span><span class="op" id="5535908">)</span>&nbsp;<span class="op" id="5535910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5535914">return</span>&nbsp;<span class="num" id="5535921">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5535924">}</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5535927">i</span>&nbsp;<span class="op" id="5535929">:=</span>&nbsp;<span class="ident" id="5535932">p</span><span class="op" id="5535933">.</span><span class="ident" id="5535934">PixOffset</span><span class="op" id="5535943">(</span><span class="ident" id="5535944">x</span><span class="op" id="5535945">,</span>&nbsp;<span class="ident" id="5535947">y</span><span class="op" id="5535948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5535951">return</span>&nbsp;<span class="ident" id="5535958">p</span><span class="op" id="5535959">.</span><span class="ident" id="5535960">Pix</span><span class="op" id="5535963">[</span><span class="ident" id="5535964">i</span><span class="op" id="5535965">]</span><br>
<span class="lineno"></span><span class="op" id="5535967">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5535970">func</span>&nbsp;<span class="op" id="5535975">(</span><span class="ident" id="5535976">p</span>&nbsp;<span class="op" id="5535978">*</span><span class="ident" id="5535979">Paletted</span><span class="op" id="5535987">)</span>&nbsp;<span class="ident" id="5535989">SetColorIndex</span><span class="op" id="5536002">(</span><span class="ident" id="5536003">x</span><span class="op" id="5536004">,</span>&nbsp;<span class="ident" id="5536006">y</span>&nbsp;<span class="builtintype" id="5536008">int</span><span class="op" id="5536011">,</span>&nbsp;<span class="ident" id="5536013">index</span>&nbsp;<span class="builtintype" id="5536019">uint8</span><span class="op" id="5536024">)</span>&nbsp;<span class="op" id="5536026">{</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5536029">if</span>&nbsp;<span class="op" id="5536032">!</span><span class="op" id="5536033">(</span><span class="ident" id="5536034">Point</span><span class="op" id="5536039">{</span><span class="ident" id="5536040">x</span><span class="op" id="5536041">,</span>&nbsp;<span class="ident" id="5536043">y</span><span class="op" id="5536044">}</span><span class="op" id="5536045">.</span><span class="ident" id="5536046">In</span><span class="op" id="5536048">(</span><span class="ident" id="5536049">p</span><span class="op" id="5536050">.</span><span class="ident" id="5536051">Rect</span><span class="op" id="5536055">)</span><span class="op" id="5536056">)</span>&nbsp;<span class="op" id="5536058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5536062">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5536070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5536073">i</span>&nbsp;<span class="op" id="5536075">:=</span>&nbsp;<span class="ident" id="5536078">p</span><span class="op" id="5536079">.</span><span class="ident" id="5536080">PixOffset</span><span class="op" id="5536089">(</span><span class="ident" id="5536090">x</span><span class="op" id="5536091">,</span>&nbsp;<span class="ident" id="5536093">y</span><span class="op" id="5536094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5536097">p</span><span class="op" id="5536098">.</span><span class="ident" id="5536099">Pix</span><span class="op" id="5536102">[</span><span class="ident" id="5536103">i</span><span class="op" id="5536104">]</span>&nbsp;<span class="op" id="5536106">=</span>&nbsp;<span class="ident" id="5536108">index</span><br>
<span class="lineno">885</span><span class="op" id="5536114">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5536117">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5536194">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5536266">func</span>&nbsp;<span class="op" id="5536271">(</span><span class="ident" id="5536272">p</span>&nbsp;<span class="op" id="5536274">*</span><span class="ident" id="5536275">Paletted</span><span class="op" id="5536283">)</span>&nbsp;<span class="ident" id="5536285">SubImage</span><span class="op" id="5536293">(</span><span class="ident" id="5536294">r</span>&nbsp;<span class="ident" id="5536296">Rectangle</span><span class="op" id="5536305">)</span>&nbsp;<span class="ident" id="5536307">Image</span>&nbsp;<span class="op" id="5536313">{</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5536316">r</span>&nbsp;<span class="op" id="5536318">=</span>&nbsp;<span class="ident" id="5536320">r</span><span class="op" id="5536321">.</span><span class="ident" id="5536322">Intersect</span><span class="op" id="5536331">(</span><span class="ident" id="5536332">p</span><span class="op" id="5536333">.</span><span class="ident" id="5536334">Rect</span><span class="op" id="5536338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5536341">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5536422">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5536504">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5536554">if</span>&nbsp;<span class="ident" id="5536557">r</span><span class="op" id="5536558">.</span><span class="ident" id="5536559">Empty</span><span class="op" id="5536564">(</span><span class="op" id="5536565">)</span>&nbsp;<span class="op" id="5536567">{</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5536571">return</span>&nbsp;<span class="op" id="5536578">&amp;</span><span class="ident" id="5536579">Paletted</span><span class="op" id="5536587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5536592">Palette</span><span class="op" id="5536599">:</span>&nbsp;<span class="ident" id="5536601">p</span><span class="op" id="5536602">.</span><span class="ident" id="5536603">Palette</span><span class="op" id="5536610">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5536614">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5536617">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5536620">i</span>&nbsp;<span class="op" id="5536622">:=</span>&nbsp;<span class="ident" id="5536625">p</span><span class="op" id="5536626">.</span><span class="ident" id="5536627">PixOffset</span><span class="op" id="5536636">(</span><span class="ident" id="5536637">r</span><span class="op" id="5536638">.</span><span class="ident" id="5536639">Min</span><span class="op" id="5536642">.</span><span class="ident" id="5536643">X</span><span class="op" id="5536644">,</span>&nbsp;<span class="ident" id="5536646">r</span><span class="op" id="5536647">.</span><span class="ident" id="5536648">Min</span><span class="op" id="5536651">.</span><span class="ident" id="5536652">Y</span><span class="op" id="5536653">)</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5536656">return</span>&nbsp;<span class="op" id="5536663">&amp;</span><span class="ident" id="5536664">Paletted</span><span class="op" id="5536672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5536676">Pix</span><span class="op" id="5536679">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5536685">p</span><span class="op" id="5536686">.</span><span class="ident" id="5536687">Pix</span><span class="op" id="5536690">[</span><span class="ident" id="5536691">i</span><span class="op" id="5536692">:</span><span class="op" id="5536693">]</span><span class="op" id="5536694">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5536698">Stride</span><span class="op" id="5536704">:</span>&nbsp;&nbsp;<span class="ident" id="5536707">p</span><span class="op" id="5536708">.</span><span class="ident" id="5536709">Stride</span><span class="op" id="5536715">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5536719">Rect</span><span class="op" id="5536723">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5536728">p</span><span class="op" id="5536729">.</span><span class="ident" id="5536730">Rect</span><span class="op" id="5536734">.</span><span class="ident" id="5536735">Intersect</span><span class="op" id="5536744">(</span><span class="ident" id="5536745">r</span><span class="op" id="5536746">)</span><span class="op" id="5536747">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5536751">Palette</span><span class="op" id="5536758">:</span>&nbsp;<span class="ident" id="5536760">p</span><span class="op" id="5536761">.</span><span class="ident" id="5536762">Palette</span><span class="op" id="5536769">,</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5536772">}</span><br>
<span class="lineno"></span><span class="op" id="5536774">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5536777">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5536850">func</span>&nbsp;<span class="op" id="5536855">(</span><span class="ident" id="5536856">p</span>&nbsp;<span class="op" id="5536858">*</span><span class="ident" id="5536859">Paletted</span><span class="op" id="5536867">)</span>&nbsp;<span class="ident" id="5536869">Opaque</span><span class="op" id="5536875">(</span><span class="op" id="5536876">)</span>&nbsp;<span class="builtintype" id="5536878">bool</span>&nbsp;<span class="op" id="5536883">{</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5536886">var</span>&nbsp;<span class="ident" id="5536890">present</span>&nbsp;<span class="op" id="5536898">[</span><span class="num" id="5536899">256</span><span class="op" id="5536902">]</span><span class="builtintype" id="5536903">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5536909">i0</span><span class="op" id="5536911">,</span>&nbsp;<span class="ident" id="5536913">i1</span>&nbsp;<span class="op" id="5536916">:=</span>&nbsp;<span class="num" id="5536919">0</span><span class="op" id="5536920">,</span>&nbsp;<span class="ident" id="5536922">p</span><span class="op" id="5536923">.</span><span class="ident" id="5536924">Rect</span><span class="op" id="5536928">.</span><span class="ident" id="5536929">Dx</span><span class="op" id="5536931">(</span><span class="op" id="5536932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5536935">for</span>&nbsp;<span class="ident" id="5536939">y</span>&nbsp;<span class="op" id="5536941">:=</span>&nbsp;<span class="ident" id="5536944">p</span><span class="op" id="5536945">.</span><span class="ident" id="5536946">Rect</span><span class="op" id="5536950">.</span><span class="ident" id="5536951">Min</span><span class="op" id="5536954">.</span><span class="ident" id="5536955">Y</span><span class="op" id="5536956">;</span>&nbsp;<span class="ident" id="5536958">y</span>&nbsp;<span class="op" id="5536960">&lt;</span>&nbsp;<span class="ident" id="5536962">p</span><span class="op" id="5536963">.</span><span class="ident" id="5536964">Rect</span><span class="op" id="5536968">.</span><span class="ident" id="5536969">Max</span><span class="op" id="5536972">.</span><span class="ident" id="5536973">Y</span><span class="op" id="5536974">;</span>&nbsp;<span class="ident" id="5536976">y</span><span class="op" id="5536977">++</span>&nbsp;<span class="op" id="5536980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5536984">for</span>&nbsp;<span class="ident" id="5536988">_</span><span class="op" id="5536989">,</span>&nbsp;<span class="ident" id="5536991">c</span>&nbsp;<span class="op" id="5536993">:=</span>&nbsp;<span class="keyword" id="5536996">range</span>&nbsp;<span class="ident" id="5537002">p</span><span class="op" id="5537003">.</span><span class="ident" id="5537004">Pix</span><span class="op" id="5537007">[</span><span class="ident" id="5537008">i0</span><span class="op" id="5537010">:</span><span class="ident" id="5537011">i1</span><span class="op" id="5537013">]</span>&nbsp;<span class="op" id="5537015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5537020">present</span><span class="op" id="5537027">[</span><span class="ident" id="5537028">c</span><span class="op" id="5537029">]</span>&nbsp;<span class="op" id="5537031">=</span>&nbsp;<span class="builtintype" id="5537033">true</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5537040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5537044">i0</span>&nbsp;<span class="op" id="5537047">+=</span>&nbsp;<span class="ident" id="5537050">p</span><span class="op" id="5537051">.</span><span class="ident" id="5537052">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5537061">i1</span>&nbsp;<span class="op" id="5537064">+=</span>&nbsp;<span class="ident" id="5537067">p</span><span class="op" id="5537068">.</span><span class="ident" id="5537069">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5537077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5537080">for</span>&nbsp;<span class="ident" id="5537084">i</span><span class="op" id="5537085">,</span>&nbsp;<span class="ident" id="5537087">c</span>&nbsp;<span class="op" id="5537089">:=</span>&nbsp;<span class="keyword" id="5537092">range</span>&nbsp;<span class="ident" id="5537098">p</span><span class="op" id="5537099">.</span><span class="ident" id="5537100">Palette</span>&nbsp;<span class="op" id="5537108">{</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5537112">if</span>&nbsp;<span class="op" id="5537115">!</span><span class="ident" id="5537116">present</span><span class="op" id="5537123">[</span><span class="ident" id="5537124">i</span><span class="op" id="5537125">]</span>&nbsp;<span class="op" id="5537127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5537132">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5537143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5537147">_</span><span class="op" id="5537148">,</span>&nbsp;<span class="ident" id="5537150">_</span><span class="op" id="5537151">,</span>&nbsp;<span class="ident" id="5537153">_</span><span class="op" id="5537154">,</span>&nbsp;<span class="ident" id="5537156">a</span>&nbsp;<span class="op" id="5537158">:=</span>&nbsp;<span class="ident" id="5537161">c</span><span class="op" id="5537162">.</span><span class="ident" id="5537163">RGBA</span><span class="op" id="5537167">(</span><span class="op" id="5537168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5537172">if</span>&nbsp;<span class="ident" id="5537175">a</span>&nbsp;<span class="op" id="5537177">!=</span>&nbsp;<span class="num" id="5537180">0xffff</span>&nbsp;<span class="op" id="5537187">{</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5537192">return</span>&nbsp;<span class="builtintype" id="5537199">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5537207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5537210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5537213">return</span>&nbsp;<span class="builtintype" id="5537220">true</span><br>
<span class="lineno"></span><span class="op" id="5537225">}</span><br>
<span class="lineno">930</span><br>
<span class="lineno"></span><span class="comment" id="5537228">//&nbsp;NewPaletted&nbsp;returns&nbsp;a&nbsp;new&nbsp;Paletted&nbsp;with&nbsp;the&nbsp;given&nbsp;width,&nbsp;height&nbsp;and&nbsp;palette.</span><br>
<span class="lineno"></span><span class="keyword" id="5537308">func</span>&nbsp;<span class="ident" id="5537313">NewPaletted</span><span class="op" id="5537324">(</span><span class="ident" id="5537325">r</span>&nbsp;<span class="ident" id="5537327">Rectangle</span><span class="op" id="5537336">,</span>&nbsp;<span class="ident" id="5537338">p</span>&nbsp;<span class="ident" id="5537340">color</span><span class="op" id="5537345">.</span><span class="ident" id="5537346">Palette</span><span class="op" id="5537353">)</span>&nbsp;<span class="op" id="5537355">*</span><span class="ident" id="5537356">Paletted</span>&nbsp;<span class="op" id="5537365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5537368">w</span><span class="op" id="5537369">,</span>&nbsp;<span class="ident" id="5537371">h</span>&nbsp;<span class="op" id="5537373">:=</span>&nbsp;<span class="ident" id="5537376">r</span><span class="op" id="5537377">.</span><span class="ident" id="5537378">Dx</span><span class="op" id="5537380">(</span><span class="op" id="5537381">)</span><span class="op" id="5537382">,</span>&nbsp;<span class="ident" id="5537384">r</span><span class="op" id="5537385">.</span><span class="ident" id="5537386">Dy</span><span class="op" id="5537388">(</span><span class="op" id="5537389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5537392">pix</span>&nbsp;<span class="op" id="5537396">:=</span>&nbsp;<span class="builtinfunc" id="5537399">make</span><span class="op" id="5537403">(</span><span class="op" id="5537404">[</span><span class="op" id="5537405">]</span><span class="builtintype" id="5537406">uint8</span><span class="op" id="5537411">,</span>&nbsp;<span class="num" id="5537413">1</span><span class="op" id="5537414">*</span><span class="ident" id="5537415">w</span><span class="op" id="5537416">*</span><span class="ident" id="5537417">h</span><span class="op" id="5537418">)</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5537421">return</span>&nbsp;<span class="op" id="5537428">&amp;</span><span class="ident" id="5537429">Paletted</span><span class="op" id="5537437">{</span><span class="ident" id="5537438">pix</span><span class="op" id="5537441">,</span>&nbsp;<span class="num" id="5537443">1</span>&nbsp;<span class="op" id="5537445">*</span>&nbsp;<span class="ident" id="5537447">w</span><span class="op" id="5537448">,</span>&nbsp;<span class="ident" id="5537450">r</span><span class="op" id="5537451">,</span>&nbsp;<span class="ident" id="5537453">p</span><span class="op" id="5537454">}</span><br>
<span class="lineno"></span><span class="op" id="5537456">}</span>
</div>
</body>
</html>
