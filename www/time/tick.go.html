<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2331940">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2331995">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2332049">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2332100">package</span>&nbsp;<span class="ident" id="2332108">time</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2332114">import</span>&nbsp;<span class="string" id="2332121">&#34;errors&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2332131">//&nbsp;A&nbsp;Ticker&nbsp;holds&nbsp;a&nbsp;channel&nbsp;that&nbsp;delivers&nbsp;`ticks&#39;&nbsp;of&nbsp;a&nbsp;clock</span><br>
<span class="lineno">10</span><span class="comment" id="2332192">//&nbsp;at&nbsp;intervals.</span><br>
<span class="lineno"></span><span class="keyword" id="2332209">type</span>&nbsp;<span class="ident" id="2332214">Ticker</span>&nbsp;<span class="keyword" id="2332221">struct</span>&nbsp;<span class="op" id="2332228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2332231">C</span>&nbsp;<span class="op" id="2332233">&lt;-</span><span class="keyword" id="2332235">chan</span>&nbsp;<span class="ident" id="2332240"><a href="/time/time.go.html#2335415">Time</a></span>&nbsp;<span class="comment" id="2332245">//&nbsp;The&nbsp;channel&nbsp;on&nbsp;which&nbsp;the&nbsp;ticks&nbsp;are&nbsp;delivered.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2332295">r</span>&nbsp;<span class="ident" id="2332297"><a href="/time/sleep.go.html#2327512">runtimeTimer</a></span><br>
<span class="lineno"></span><span class="op" id="2332310">}</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="2332313">//&nbsp;NewTicker&nbsp;returns&nbsp;a&nbsp;new&nbsp;Ticker&nbsp;containing&nbsp;a&nbsp;channel&nbsp;that&nbsp;will&nbsp;send&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2332387">//&nbsp;time&nbsp;with&nbsp;a&nbsp;period&nbsp;specified&nbsp;by&nbsp;the&nbsp;duration&nbsp;argument.</span><br>
<span class="lineno"></span><span class="comment" id="2332445">//&nbsp;It&nbsp;adjusts&nbsp;the&nbsp;intervals&nbsp;or&nbsp;drops&nbsp;ticks&nbsp;to&nbsp;make&nbsp;up&nbsp;for&nbsp;slow&nbsp;receivers.</span><br>
<span class="lineno"></span><span class="comment" id="2332519">//&nbsp;The&nbsp;duration&nbsp;d&nbsp;must&nbsp;be&nbsp;greater&nbsp;than&nbsp;zero;&nbsp;if&nbsp;not,&nbsp;NewTicker&nbsp;will&nbsp;panic.</span><br>
<span class="lineno">20</span><span class="comment" id="2332594">//&nbsp;Stop&nbsp;the&nbsp;ticker&nbsp;to&nbsp;release&nbsp;associated&nbsp;resources.</span><br>
<span class="lineno"></span><span class="keyword" id="2332646">func</span>&nbsp;<span class="ident" id="2332651">NewTicker</span><span class="op" id="2332660">(</span><span class="ident" id="2332661">d</span>&nbsp;<span class="ident" id="2332663"><a href="/time/time.go.html#2347540">Duration</a></span><span class="op" id="2332671">)</span>&nbsp;<span class="op" id="2332673">*</span><span class="ident" id="2332674"><a href="/time/tick.go.html#2332214">Ticker</a></span>&nbsp;<span class="op" id="2332681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2332684">if</span>&nbsp;<span class="ident" id="2332687"><a href="/time/tick.go.html#2332661">d</a></span>&nbsp;<span class="op" id="2332689">&lt;=</span>&nbsp;<span class="num" id="2332692">0</span>&nbsp;<span class="op" id="2332694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2332698">panic</span><span class="op" id="2332703">(</span><span class="ident" id="2332704"><a href="/time/tick.go.html#2332121">errors</a></span><span class="op" id="2332710">.</span><span class="ident" id="2332711">New</span><span class="op" id="2332714">(</span><span class="string" id="2332715">&#34;non-positive&nbsp;interval&nbsp;for&nbsp;NewTicker&#34;</span><span class="op" id="2332752">)</span><span class="op" id="2332753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2332756">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2332759">//&nbsp;Give&nbsp;the&nbsp;channel&nbsp;a&nbsp;1-element&nbsp;time&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2332805">//&nbsp;If&nbsp;the&nbsp;client&nbsp;falls&nbsp;behind&nbsp;while&nbsp;reading,&nbsp;we&nbsp;drop&nbsp;ticks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2332865">//&nbsp;on&nbsp;the&nbsp;floor&nbsp;until&nbsp;the&nbsp;client&nbsp;catches&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2332911">c</span>&nbsp;<span class="op" id="2332913">:=</span>&nbsp;<span class="builtinfunc" id="2332916">make</span><span class="op" id="2332920">(</span><span class="keyword" id="2332921">chan</span>&nbsp;<span class="ident" id="2332926"><a href="/time/time.go.html#2335415">Time</a></span><span class="op" id="2332930">,</span>&nbsp;<span class="num" id="2332932">1</span><span class="op" id="2332933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2332936">t</span>&nbsp;<span class="op" id="2332938">:=</span>&nbsp;<span class="op" id="2332941">&amp;</span><span class="ident" id="2332942"><a href="/time/tick.go.html#2332214">Ticker</a></span><span class="op" id="2332948">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2332952">C</span><span class="op" id="2332953">:</span>&nbsp;<span class="ident" id="2332955"><a href="/time/tick.go.html#2332911">c</a></span><span class="op" id="2332956">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2332960">r</span><span class="op" id="2332961">:</span>&nbsp;<span class="ident" id="2332963"><a href="/time/sleep.go.html#2327512">runtimeTimer</a></span><span class="op" id="2332975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2332980">when</span><span class="op" id="2332984">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="2332988"><a href="/time/sleep.go.html#2327970">when</a></span><span class="op" id="2332992">(</span><span class="ident" id="2332993"><a href="/time/tick.go.html#2332661">d</a></span><span class="op" id="2332994">)</span><span class="op" id="2332995">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2333000">period</span><span class="op" id="2333006">:</span>&nbsp;<span class="ident" id="2333008">int64</span><span class="op" id="2333013">(</span><span class="ident" id="2333014"><a href="/time/tick.go.html#2332661">d</a></span><span class="op" id="2333015">)</span><span class="op" id="2333016">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2333021">f</span><span class="op" id="2333022">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2333029"><a href="/time/sleep.go.html#2329497">sendTime</a></span><span class="op" id="2333037">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2333042">arg</span><span class="op" id="2333045">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2333050"><a href="/time/tick.go.html#2332911">c</a></span><span class="op" id="2333051">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2333055">}</span><span class="op" id="2333056">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2333059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2333062"><a href="/time/sleep.go.html#2328131">startTimer</a></span><span class="op" id="2333072">(</span><span class="op" id="2333073">&amp;</span><span class="ident" id="2333074"><a href="/time/tick.go.html#2332936">t</a></span><span class="op" id="2333075">.</span><span class="ident" id="2333076">r</span><span class="op" id="2333077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2333080">return</span>&nbsp;<span class="ident" id="2333087"><a href="/time/tick.go.html#2332936">t</a></span><br>
<span class="lineno">40</span><span class="op" id="2333089">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2333092">//&nbsp;Stop&nbsp;turns&nbsp;off&nbsp;a&nbsp;ticker.&nbsp;&nbsp;After&nbsp;Stop,&nbsp;no&nbsp;more&nbsp;ticks&nbsp;will&nbsp;be&nbsp;sent.</span><br>
<span class="lineno"></span><span class="comment" id="2333161">//&nbsp;Stop&nbsp;does&nbsp;not&nbsp;close&nbsp;the&nbsp;channel,&nbsp;to&nbsp;prevent&nbsp;a&nbsp;read&nbsp;from&nbsp;the&nbsp;channel&nbsp;succeeding</span><br>
<span class="lineno"></span><span class="comment" id="2333243">//&nbsp;incorrectly.</span><br>
<span class="lineno">45</span><span class="keyword" id="2333259">func</span>&nbsp;<span class="op" id="2333264">(</span><span class="ident" id="2333265">t</span>&nbsp;<span class="op" id="2333267">*</span><span class="ident" id="2333268"><a href="/time/tick.go.html#2332214">Ticker</a></span><span class="op" id="2333274">)</span>&nbsp;<span class="ident" id="2333276">Stop</span><span class="op" id="2333280">(</span><span class="op" id="2333281">)</span>&nbsp;<span class="op" id="2333283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2333286"><a href="/time/sleep.go.html#2328162">stopTimer</a></span><span class="op" id="2333295">(</span><span class="op" id="2333296">&amp;</span><span class="ident" id="2333297"><a href="/time/tick.go.html#2333265">t</a></span><span class="op" id="2333298">.</span><span class="ident" id="2333299">r</span><span class="op" id="2333300">)</span><br>
<span class="lineno"></span><span class="op" id="2333302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2333305">//&nbsp;Tick&nbsp;is&nbsp;a&nbsp;convenience&nbsp;wrapper&nbsp;for&nbsp;NewTicker&nbsp;providing&nbsp;access&nbsp;to&nbsp;the&nbsp;ticking</span><br>
<span class="lineno">50</span><span class="comment" id="2333384">//&nbsp;channel&nbsp;only.&nbsp;&nbsp;Useful&nbsp;for&nbsp;clients&nbsp;that&nbsp;have&nbsp;no&nbsp;need&nbsp;to&nbsp;shut&nbsp;down&nbsp;the&nbsp;ticker.</span><br>
<span class="lineno"></span><span class="keyword" id="2333464">func</span>&nbsp;<span class="ident" id="2333469">Tick</span><span class="op" id="2333473">(</span><span class="ident" id="2333474">d</span>&nbsp;<span class="ident" id="2333476"><a href="/time/time.go.html#2347540">Duration</a></span><span class="op" id="2333484">)</span>&nbsp;<span class="op" id="2333486">&lt;-</span><span class="keyword" id="2333488">chan</span>&nbsp;<span class="ident" id="2333493"><a href="/time/time.go.html#2335415">Time</a></span>&nbsp;<span class="op" id="2333498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2333501">if</span>&nbsp;<span class="ident" id="2333504"><a href="/time/tick.go.html#2333474">d</a></span>&nbsp;<span class="op" id="2333506">&lt;=</span>&nbsp;<span class="num" id="2333509">0</span>&nbsp;<span class="op" id="2333511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2333515">return</span>&nbsp;<span class="ident" id="2333522">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2333527">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2333530">return</span>&nbsp;<span class="ident" id="2333537"><a href="/time/tick.go.html#2332651">NewTicker</a></span><span class="op" id="2333546">(</span><span class="ident" id="2333547"><a href="/time/tick.go.html#2333474">d</a></span><span class="op" id="2333548">)</span><span class="op" id="2333549">.</span><span class="ident" id="2333550">C</span><br>
<span class="lineno"></span><span class="op" id="2333552">}</span>
</div>
</body>
</html>
