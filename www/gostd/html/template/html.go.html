<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>html/template</h2>
<ul>
<li><a href="/gostd/html/template/attr.go.html">attr.go</a></li>
<li><a href="/gostd/html/template/clone_test.go.html">clone_test.go</a></li>
<li><a href="/gostd/html/template/content.go.html">content.go</a></li>
<li><a href="/gostd/html/template/content_test.go.html">content_test.go</a></li>
<li><a href="/gostd/html/template/context.go.html">context.go</a></li>
<li><a href="/gostd/html/template/css.go.html">css.go</a></li>
<li><a href="/gostd/html/template/css_test.go.html">css_test.go</a></li>
<li><a href="/gostd/html/template/doc.go.html">doc.go</a></li>
<li><a href="/gostd/html/template/error.go.html">error.go</a></li>
<li><a href="/gostd/html/template/escape.go.html">escape.go</a></li>
<li><a href="/gostd/html/template/escape_test.go.html">escape_test.go</a></li>
<li><a href="/gostd/html/template/html.go.html" class="current">html.go</a></li>
<li><a href="/gostd/html/template/html_test.go.html">html_test.go</a></li>
<li><a href="/gostd/html/template/js.go.html">js.go</a></li>
<li><a href="/gostd/html/template/js_test.go.html">js_test.go</a></li>
<li><a href="/gostd/html/template/template.go.html">template.go</a></li>
<li><a href="/gostd/html/template/transition.go.html">transition.go</a></li>
<li><a href="/gostd/html/template/url.go.html">url.go</a></li>
<li><a href="/gostd/html/template/url_test.go.html">url_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5081324">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5081379">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5081433">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5081484">package</span>&nbsp;<span class="ident" id="5081492">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5081502">import</span>&nbsp;<span class="op" id="5081509">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5081512">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5081521">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5081528">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5081539">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="5081554">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5081557">//&nbsp;htmlNospaceEscaper&nbsp;escapes&nbsp;for&nbsp;inclusion&nbsp;in&nbsp;unquoted&nbsp;attribute&nbsp;values.</span><br>
<span class="lineno">15</span><span class="keyword" id="5081631">func</span>&nbsp;<span class="ident" id="5081636">htmlNospaceEscaper</span><span class="op" id="5081654">(</span><span class="ident" id="5081655">args</span>&nbsp;<span class="op" id="5081660">...</span><span class="keyword" id="5081663">interface</span><span class="op" id="5081672">{</span><span class="op" id="5081673">}</span><span class="op" id="5081674">)</span>&nbsp;<span class="builtintype" id="5081676">string</span>&nbsp;<span class="op" id="5081683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5081686">s</span><span class="op" id="5081687">,</span>&nbsp;<span class="ident" id="5081689">t</span>&nbsp;<span class="op" id="5081691">:=</span>&nbsp;<span class="ident" id="5081694">stringify</span><span class="op" id="5081703">(</span><span class="ident" id="5081704">args</span><span class="op" id="5081708">...</span><span class="op" id="5081711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5081714">if</span>&nbsp;<span class="ident" id="5081717">t</span>&nbsp;<span class="op" id="5081719">==</span>&nbsp;<span class="ident" id="5081722">contentTypeHTML</span>&nbsp;<span class="op" id="5081738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5081742">return</span>&nbsp;<span class="ident" id="5081749">htmlReplacer</span><span class="op" id="5081761">(</span><span class="ident" id="5081762">stripTags</span><span class="op" id="5081771">(</span><span class="ident" id="5081772">s</span><span class="op" id="5081773">)</span><span class="op" id="5081774">,</span>&nbsp;<span class="ident" id="5081776">htmlNospaceNormReplacementTable</span><span class="op" id="5081807">,</span>&nbsp;<span class="builtintype" id="5081809">false</span><span class="op" id="5081814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5081817">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5081820">return</span>&nbsp;<span class="ident" id="5081827">htmlReplacer</span><span class="op" id="5081839">(</span><span class="ident" id="5081840">s</span><span class="op" id="5081841">,</span>&nbsp;<span class="ident" id="5081843">htmlNospaceReplacementTable</span><span class="op" id="5081870">,</span>&nbsp;<span class="builtintype" id="5081872">false</span><span class="op" id="5081877">)</span><br>
<span class="lineno"></span><span class="op" id="5081879">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5081882">//&nbsp;attrEscaper&nbsp;escapes&nbsp;for&nbsp;inclusion&nbsp;in&nbsp;quoted&nbsp;attribute&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5081947">func</span>&nbsp;<span class="ident" id="5081952">attrEscaper</span><span class="op" id="5081963">(</span><span class="ident" id="5081964">args</span>&nbsp;<span class="op" id="5081969">...</span><span class="keyword" id="5081972">interface</span><span class="op" id="5081981">{</span><span class="op" id="5081982">}</span><span class="op" id="5081983">)</span>&nbsp;<span class="builtintype" id="5081985">string</span>&nbsp;<span class="op" id="5081992">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5081995">s</span><span class="op" id="5081996">,</span>&nbsp;<span class="ident" id="5081998">t</span>&nbsp;<span class="op" id="5082000">:=</span>&nbsp;<span class="ident" id="5082003">stringify</span><span class="op" id="5082012">(</span><span class="ident" id="5082013">args</span><span class="op" id="5082017">...</span><span class="op" id="5082020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5082023">if</span>&nbsp;<span class="ident" id="5082026">t</span>&nbsp;<span class="op" id="5082028">==</span>&nbsp;<span class="ident" id="5082031">contentTypeHTML</span>&nbsp;<span class="op" id="5082047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5082051">return</span>&nbsp;<span class="ident" id="5082058">htmlReplacer</span><span class="op" id="5082070">(</span><span class="ident" id="5082071">stripTags</span><span class="op" id="5082080">(</span><span class="ident" id="5082081">s</span><span class="op" id="5082082">)</span><span class="op" id="5082083">,</span>&nbsp;<span class="ident" id="5082085">htmlNormReplacementTable</span><span class="op" id="5082109">,</span>&nbsp;<span class="builtintype" id="5082111">true</span><span class="op" id="5082115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5082118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5082121">return</span>&nbsp;<span class="ident" id="5082128">htmlReplacer</span><span class="op" id="5082140">(</span><span class="ident" id="5082141">s</span><span class="op" id="5082142">,</span>&nbsp;<span class="ident" id="5082144">htmlReplacementTable</span><span class="op" id="5082164">,</span>&nbsp;<span class="builtintype" id="5082166">true</span><span class="op" id="5082170">)</span><br>
<span class="lineno">30</span><span class="op" id="5082172">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5082175">//&nbsp;rcdataEscaper&nbsp;escapes&nbsp;for&nbsp;inclusion&nbsp;in&nbsp;an&nbsp;RCDATA&nbsp;element&nbsp;body.</span><br>
<span class="lineno"></span><span class="keyword" id="5082241">func</span>&nbsp;<span class="ident" id="5082246">rcdataEscaper</span><span class="op" id="5082259">(</span><span class="ident" id="5082260">args</span>&nbsp;<span class="op" id="5082265">...</span><span class="keyword" id="5082268">interface</span><span class="op" id="5082277">{</span><span class="op" id="5082278">}</span><span class="op" id="5082279">)</span>&nbsp;<span class="builtintype" id="5082281">string</span>&nbsp;<span class="op" id="5082288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5082291">s</span><span class="op" id="5082292">,</span>&nbsp;<span class="ident" id="5082294">t</span>&nbsp;<span class="op" id="5082296">:=</span>&nbsp;<span class="ident" id="5082299">stringify</span><span class="op" id="5082308">(</span><span class="ident" id="5082309">args</span><span class="op" id="5082313">...</span><span class="op" id="5082316">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5082319">if</span>&nbsp;<span class="ident" id="5082322">t</span>&nbsp;<span class="op" id="5082324">==</span>&nbsp;<span class="ident" id="5082327">contentTypeHTML</span>&nbsp;<span class="op" id="5082343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5082347">return</span>&nbsp;<span class="ident" id="5082354">htmlReplacer</span><span class="op" id="5082366">(</span><span class="ident" id="5082367">s</span><span class="op" id="5082368">,</span>&nbsp;<span class="ident" id="5082370">htmlNormReplacementTable</span><span class="op" id="5082394">,</span>&nbsp;<span class="builtintype" id="5082396">true</span><span class="op" id="5082400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5082403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5082406">return</span>&nbsp;<span class="ident" id="5082413">htmlReplacer</span><span class="op" id="5082425">(</span><span class="ident" id="5082426">s</span><span class="op" id="5082427">,</span>&nbsp;<span class="ident" id="5082429">htmlReplacementTable</span><span class="op" id="5082449">,</span>&nbsp;<span class="builtintype" id="5082451">true</span><span class="op" id="5082455">)</span><br>
<span class="lineno"></span><span class="op" id="5082457">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="5082460">//&nbsp;htmlEscaper&nbsp;escapes&nbsp;for&nbsp;inclusion&nbsp;in&nbsp;HTML&nbsp;text.</span><br>
<span class="lineno"></span><span class="keyword" id="5082511">func</span>&nbsp;<span class="ident" id="5082516">htmlEscaper</span><span class="op" id="5082527">(</span><span class="ident" id="5082528">args</span>&nbsp;<span class="op" id="5082533">...</span><span class="keyword" id="5082536">interface</span><span class="op" id="5082545">{</span><span class="op" id="5082546">}</span><span class="op" id="5082547">)</span>&nbsp;<span class="builtintype" id="5082549">string</span>&nbsp;<span class="op" id="5082556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5082559">s</span><span class="op" id="5082560">,</span>&nbsp;<span class="ident" id="5082562">t</span>&nbsp;<span class="op" id="5082564">:=</span>&nbsp;<span class="ident" id="5082567">stringify</span><span class="op" id="5082576">(</span><span class="ident" id="5082577">args</span><span class="op" id="5082581">...</span><span class="op" id="5082584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5082587">if</span>&nbsp;<span class="ident" id="5082590">t</span>&nbsp;<span class="op" id="5082592">==</span>&nbsp;<span class="ident" id="5082595">contentTypeHTML</span>&nbsp;<span class="op" id="5082611">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5082615">return</span>&nbsp;<span class="ident" id="5082622">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5082625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5082628">return</span>&nbsp;<span class="ident" id="5082635">htmlReplacer</span><span class="op" id="5082647">(</span><span class="ident" id="5082648">s</span><span class="op" id="5082649">,</span>&nbsp;<span class="ident" id="5082651">htmlReplacementTable</span><span class="op" id="5082671">,</span>&nbsp;<span class="builtintype" id="5082673">true</span><span class="op" id="5082677">)</span><br>
<span class="lineno"></span><span class="op" id="5082679">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="5082682">//&nbsp;htmlReplacementTable&nbsp;contains&nbsp;the&nbsp;runes&nbsp;that&nbsp;need&nbsp;to&nbsp;be&nbsp;escaped</span><br>
<span class="lineno"></span><span class="comment" id="5082749">//&nbsp;inside&nbsp;a&nbsp;quoted&nbsp;attribute&nbsp;value&nbsp;or&nbsp;in&nbsp;a&nbsp;text&nbsp;node.</span><br>
<span class="lineno"></span><span class="keyword" id="5082803">var</span>&nbsp;<span class="ident" id="5082807">htmlReplacementTable</span>&nbsp;<span class="op" id="5082828">=</span>&nbsp;<span class="op" id="5082830">[</span><span class="op" id="5082831">]</span><span class="builtintype" id="5082832">string</span><span class="op" id="5082838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5082841">//&nbsp;http://www.w3.org/TR/html5/syntax.html#attribute-value-(unquoted)-state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5082917">//&nbsp;U+0000&nbsp;NULL&nbsp;Parse&nbsp;error.&nbsp;Append&nbsp;a&nbsp;U+FFFD&nbsp;REPLACEMENT</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5082974">//&nbsp;CHARACTER&nbsp;character&nbsp;to&nbsp;the&nbsp;current&nbsp;attribute&#39;s&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5083032">//&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5083038">//&nbsp;and&nbsp;similarly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5083056">//&nbsp;http://www.w3.org/TR/html5/syntax.html#before-attribute-value-state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5083128">0</span><span class="op" id="5083129">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5083134">&#34;\uFFFD&#34;</span><span class="op" id="5083142">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5083145">&#39;&#34;&#39;</span><span class="op" id="5083148">:</span>&nbsp;&nbsp;<span class="string" id="5083151">&#34;&amp;#34;&#34;</span><span class="op" id="5083158">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5083161">&#39;&amp;&#39;</span><span class="op" id="5083164">:</span>&nbsp;&nbsp;<span class="string" id="5083167">&#34;&amp;amp;&#34;</span><span class="op" id="5083174">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5083177">&#39;\&#39;&#39;</span><span class="op" id="5083181">:</span>&nbsp;<span class="string" id="5083183">&#34;&amp;#39;&#34;</span><span class="op" id="5083190">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5083193">&#39;+&#39;</span><span class="op" id="5083196">:</span>&nbsp;&nbsp;<span class="string" id="5083199">&#34;&amp;#43;&#34;</span><span class="op" id="5083206">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5083209">&#39;&lt;&#39;</span><span class="op" id="5083212">:</span>&nbsp;&nbsp;<span class="string" id="5083215">&#34;&amp;lt;&#34;</span><span class="op" id="5083221">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5083224">&#39;&gt;&#39;</span><span class="op" id="5083227">:</span>&nbsp;&nbsp;<span class="string" id="5083230">&#34;&amp;gt;&#34;</span><span class="op" id="5083236">,</span><br>
<span class="lineno"></span><span class="op" id="5083238">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5083241">//&nbsp;htmlNormReplacementTable&nbsp;is&nbsp;like&nbsp;htmlReplacementTable&nbsp;but&nbsp;without&nbsp;&#39;&amp;&#39;&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5083317">//&nbsp;avoid&nbsp;over-encoding&nbsp;existing&nbsp;entities.</span><br>
<span class="lineno">70</span><span class="keyword" id="5083359">var</span>&nbsp;<span class="ident" id="5083363">htmlNormReplacementTable</span>&nbsp;<span class="op" id="5083388">=</span>&nbsp;<span class="op" id="5083390">[</span><span class="op" id="5083391">]</span><span class="builtintype" id="5083392">string</span><span class="op" id="5083398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5083401">0</span><span class="op" id="5083402">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5083407">&#34;\uFFFD&#34;</span><span class="op" id="5083415">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5083418">&#39;&#34;&#39;</span><span class="op" id="5083421">:</span>&nbsp;&nbsp;<span class="string" id="5083424">&#34;&amp;#34;&#34;</span><span class="op" id="5083431">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5083434">&#39;\&#39;&#39;</span><span class="op" id="5083438">:</span>&nbsp;<span class="string" id="5083440">&#34;&amp;#39;&#34;</span><span class="op" id="5083447">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5083450">&#39;+&#39;</span><span class="op" id="5083453">:</span>&nbsp;&nbsp;<span class="string" id="5083456">&#34;&amp;#43;&#34;</span><span class="op" id="5083463">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5083466">&#39;&lt;&#39;</span><span class="op" id="5083469">:</span>&nbsp;&nbsp;<span class="string" id="5083472">&#34;&amp;lt;&#34;</span><span class="op" id="5083478">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5083481">&#39;&gt;&#39;</span><span class="op" id="5083484">:</span>&nbsp;&nbsp;<span class="string" id="5083487">&#34;&amp;gt;&#34;</span><span class="op" id="5083493">,</span><br>
<span class="lineno"></span><span class="op" id="5083495">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5083498">//&nbsp;htmlNospaceReplacementTable&nbsp;contains&nbsp;the&nbsp;runes&nbsp;that&nbsp;need&nbsp;to&nbsp;be&nbsp;escaped</span><br>
<span class="lineno">80</span><span class="comment" id="5083572">//&nbsp;inside&nbsp;an&nbsp;unquoted&nbsp;attribute&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="5083611">//&nbsp;The&nbsp;set&nbsp;of&nbsp;runes&nbsp;escaped&nbsp;is&nbsp;the&nbsp;union&nbsp;of&nbsp;the&nbsp;HTML&nbsp;specials&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5083677">//&nbsp;those&nbsp;determined&nbsp;by&nbsp;running&nbsp;the&nbsp;JS&nbsp;below&nbsp;in&nbsp;browsers:</span><br>
<span class="lineno"></span><span class="comment" id="5083734">//&nbsp;&lt;div&nbsp;id=d&gt;&lt;/div&gt;</span><br>
<span class="lineno"></span><span class="comment" id="5083754">//&nbsp;&lt;script&gt;(function&nbsp;()&nbsp;{</span><br>
<span class="lineno">85</span><span class="comment" id="5083780">//&nbsp;var&nbsp;a&nbsp;=&nbsp;[],&nbsp;d&nbsp;=&nbsp;document.getElementById(&#34;d&#34;),&nbsp;i,&nbsp;c,&nbsp;s;</span><br>
<span class="lineno"></span><span class="comment" id="5083838">//&nbsp;for&nbsp;(i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;0x10000;&nbsp;++i)&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="5083873">//&nbsp;&nbsp;&nbsp;c&nbsp;=&nbsp;String.fromCharCode(i);</span><br>
<span class="lineno"></span><span class="comment" id="5083906">//&nbsp;&nbsp;&nbsp;d.innerHTML&nbsp;=&nbsp;&#34;&lt;span&nbsp;title=&#34;&nbsp;+&nbsp;c&nbsp;+&nbsp;&#34;lt&#34;&nbsp;+&nbsp;c&nbsp;+&nbsp;&#34;&gt;&lt;/span&gt;&#34;</span><br>
<span class="lineno"></span><span class="comment" id="5083968">//&nbsp;&nbsp;&nbsp;s&nbsp;=&nbsp;d.getElementsByTagName(&#34;SPAN&#34;)[0];</span><br>
<span class="lineno">90</span><span class="comment" id="5084012">//&nbsp;&nbsp;&nbsp;if&nbsp;(!s&nbsp;||&nbsp;s.title&nbsp;!==&nbsp;c&nbsp;+&nbsp;&#34;lt&#34;&nbsp;+&nbsp;c)&nbsp;{&nbsp;a.push(i.toString(16));&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="5084081">//&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="5084086">//&nbsp;document.write(a.join(&#34;,&nbsp;&#34;));</span><br>
<span class="lineno"></span><span class="comment" id="5084119">//&nbsp;})()&lt;/script&gt;</span><br>
<span class="lineno"></span><span class="keyword" id="5084136">var</span>&nbsp;<span class="ident" id="5084140">htmlNospaceReplacementTable</span>&nbsp;<span class="op" id="5084168">=</span>&nbsp;<span class="op" id="5084170">[</span><span class="op" id="5084171">]</span><span class="builtintype" id="5084172">string</span><span class="op" id="5084178">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5084181">0</span><span class="op" id="5084182">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5084187">&#34;&amp;#xfffd;&#34;</span><span class="op" id="5084197">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5084200">&#39;\t&#39;</span><span class="op" id="5084204">:</span>&nbsp;<span class="string" id="5084206">&#34;&amp;#9;&#34;</span><span class="op" id="5084212">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5084215">&#39;\n&#39;</span><span class="op" id="5084219">:</span>&nbsp;<span class="string" id="5084221">&#34;&amp;#10;&#34;</span><span class="op" id="5084228">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5084231">&#39;\v&#39;</span><span class="op" id="5084235">:</span>&nbsp;<span class="string" id="5084237">&#34;&amp;#11;&#34;</span><span class="op" id="5084244">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5084247">&#39;\f&#39;</span><span class="op" id="5084251">:</span>&nbsp;<span class="string" id="5084253">&#34;&amp;#12;&#34;</span><span class="op" id="5084260">,</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5084263">&#39;\r&#39;</span><span class="op" id="5084267">:</span>&nbsp;<span class="string" id="5084269">&#34;&amp;#13;&#34;</span><span class="op" id="5084276">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5084279">&#39;&nbsp;&#39;</span><span class="op" id="5084282">:</span>&nbsp;&nbsp;<span class="string" id="5084285">&#34;&amp;#32;&#34;</span><span class="op" id="5084292">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5084295">&#39;&#34;&#39;</span><span class="op" id="5084298">:</span>&nbsp;&nbsp;<span class="string" id="5084301">&#34;&amp;#34;&#34;</span><span class="op" id="5084308">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5084311">&#39;&amp;&#39;</span><span class="op" id="5084314">:</span>&nbsp;&nbsp;<span class="string" id="5084317">&#34;&amp;amp;&#34;</span><span class="op" id="5084324">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5084327">&#39;\&#39;&#39;</span><span class="op" id="5084331">:</span>&nbsp;<span class="string" id="5084333">&#34;&amp;#39;&#34;</span><span class="op" id="5084340">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5084343">&#39;+&#39;</span><span class="op" id="5084346">:</span>&nbsp;&nbsp;<span class="string" id="5084349">&#34;&amp;#43;&#34;</span><span class="op" id="5084356">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5084359">&#39;&lt;&#39;</span><span class="op" id="5084362">:</span>&nbsp;&nbsp;<span class="string" id="5084365">&#34;&amp;lt;&#34;</span><span class="op" id="5084371">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5084374">&#39;=&#39;</span><span class="op" id="5084377">:</span>&nbsp;&nbsp;<span class="string" id="5084380">&#34;&amp;#61;&#34;</span><span class="op" id="5084387">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5084390">&#39;&gt;&#39;</span><span class="op" id="5084393">:</span>&nbsp;&nbsp;<span class="string" id="5084396">&#34;&amp;gt;&#34;</span><span class="op" id="5084402">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5084405">//&nbsp;A&nbsp;parse&nbsp;error&nbsp;in&nbsp;the&nbsp;attribute&nbsp;value&nbsp;(unquoted)&nbsp;and</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5084461">//&nbsp;before&nbsp;attribute&nbsp;value&nbsp;states.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5084496">//&nbsp;Treated&nbsp;as&nbsp;a&nbsp;quoting&nbsp;character&nbsp;by&nbsp;IE.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5084538">&#39;`&#39;</span><span class="op" id="5084541">:</span>&nbsp;<span class="string" id="5084543">&#34;&amp;#96;&#34;</span><span class="op" id="5084550">,</span><br>
<span class="lineno"></span><span class="op" id="5084552">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="5084555">//&nbsp;htmlNospaceNormReplacementTable&nbsp;is&nbsp;like&nbsp;htmlNospaceReplacementTable&nbsp;but</span><br>
<span class="lineno"></span><span class="comment" id="5084630">//&nbsp;without&nbsp;&#39;&amp;&#39;&nbsp;to&nbsp;avoid&nbsp;over-encoding&nbsp;existing&nbsp;entities.</span><br>
<span class="lineno"></span><span class="keyword" id="5084687">var</span>&nbsp;<span class="ident" id="5084691">htmlNospaceNormReplacementTable</span>&nbsp;<span class="op" id="5084723">=</span>&nbsp;<span class="op" id="5084725">[</span><span class="op" id="5084726">]</span><span class="builtintype" id="5084727">string</span><span class="op" id="5084733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5084736">0</span><span class="op" id="5084737">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5084742">&#34;&amp;#xfffd;&#34;</span><span class="op" id="5084752">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5084755">&#39;\t&#39;</span><span class="op" id="5084759">:</span>&nbsp;<span class="string" id="5084761">&#34;&amp;#9;&#34;</span><span class="op" id="5084767">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5084770">&#39;\n&#39;</span><span class="op" id="5084774">:</span>&nbsp;<span class="string" id="5084776">&#34;&amp;#10;&#34;</span><span class="op" id="5084783">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5084786">&#39;\v&#39;</span><span class="op" id="5084790">:</span>&nbsp;<span class="string" id="5084792">&#34;&amp;#11;&#34;</span><span class="op" id="5084799">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5084802">&#39;\f&#39;</span><span class="op" id="5084806">:</span>&nbsp;<span class="string" id="5084808">&#34;&amp;#12;&#34;</span><span class="op" id="5084815">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5084818">&#39;\r&#39;</span><span class="op" id="5084822">:</span>&nbsp;<span class="string" id="5084824">&#34;&amp;#13;&#34;</span><span class="op" id="5084831">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5084834">&#39;&nbsp;&#39;</span><span class="op" id="5084837">:</span>&nbsp;&nbsp;<span class="string" id="5084840">&#34;&amp;#32;&#34;</span><span class="op" id="5084847">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5084850">&#39;&#34;&#39;</span><span class="op" id="5084853">:</span>&nbsp;&nbsp;<span class="string" id="5084856">&#34;&amp;#34;&#34;</span><span class="op" id="5084863">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5084866">&#39;\&#39;&#39;</span><span class="op" id="5084870">:</span>&nbsp;<span class="string" id="5084872">&#34;&amp;#39;&#34;</span><span class="op" id="5084879">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5084882">&#39;+&#39;</span><span class="op" id="5084885">:</span>&nbsp;&nbsp;<span class="string" id="5084888">&#34;&amp;#43;&#34;</span><span class="op" id="5084895">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5084898">&#39;&lt;&#39;</span><span class="op" id="5084901">:</span>&nbsp;&nbsp;<span class="string" id="5084904">&#34;&amp;lt;&#34;</span><span class="op" id="5084910">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5084913">&#39;=&#39;</span><span class="op" id="5084916">:</span>&nbsp;&nbsp;<span class="string" id="5084919">&#34;&amp;#61;&#34;</span><span class="op" id="5084926">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5084929">&#39;&gt;&#39;</span><span class="op" id="5084932">:</span>&nbsp;&nbsp;<span class="string" id="5084935">&#34;&amp;gt;&#34;</span><span class="op" id="5084941">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5084944">//&nbsp;A&nbsp;parse&nbsp;error&nbsp;in&nbsp;the&nbsp;attribute&nbsp;value&nbsp;(unquoted)&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5085000">//&nbsp;before&nbsp;attribute&nbsp;value&nbsp;states.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5085035">//&nbsp;Treated&nbsp;as&nbsp;a&nbsp;quoting&nbsp;character&nbsp;by&nbsp;IE.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5085077">&#39;`&#39;</span><span class="op" id="5085080">:</span>&nbsp;<span class="string" id="5085082">&#34;&amp;#96;&#34;</span><span class="op" id="5085089">,</span><br>
<span class="lineno">135</span><span class="op" id="5085091">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5085094">//&nbsp;htmlReplacer&nbsp;returns&nbsp;s&nbsp;with&nbsp;runes&nbsp;replaced&nbsp;according&nbsp;to&nbsp;replacementTable</span><br>
<span class="lineno"></span><span class="comment" id="5085170">//&nbsp;and&nbsp;when&nbsp;badRunes&nbsp;is&nbsp;true,&nbsp;certain&nbsp;bad&nbsp;runes&nbsp;are&nbsp;allowed&nbsp;through&nbsp;unescaped.</span><br>
<span class="lineno"></span><span class="keyword" id="5085249">func</span>&nbsp;<span class="ident" id="5085254">htmlReplacer</span><span class="op" id="5085266">(</span><span class="ident" id="5085267">s</span>&nbsp;<span class="builtintype" id="5085269">string</span><span class="op" id="5085275">,</span>&nbsp;<span class="ident" id="5085277">replacementTable</span>&nbsp;<span class="op" id="5085294">[</span><span class="op" id="5085295">]</span><span class="builtintype" id="5085296">string</span><span class="op" id="5085302">,</span>&nbsp;<span class="ident" id="5085304">badRunes</span>&nbsp;<span class="builtintype" id="5085313">bool</span><span class="op" id="5085317">)</span>&nbsp;<span class="builtintype" id="5085319">string</span>&nbsp;<span class="op" id="5085326">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5085329">written</span><span class="op" id="5085336">,</span>&nbsp;<span class="ident" id="5085338">b</span>&nbsp;<span class="op" id="5085340">:=</span>&nbsp;<span class="num" id="5085343">0</span><span class="op" id="5085344">,</span>&nbsp;<span class="builtinfunc" id="5085346">new</span><span class="op" id="5085349">(</span><span class="ident" id="5085350">bytes</span><span class="op" id="5085355">.</span><span class="ident" id="5085356">Buffer</span><span class="op" id="5085362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5085365">for</span>&nbsp;<span class="ident" id="5085369">i</span><span class="op" id="5085370">,</span>&nbsp;<span class="ident" id="5085372">r</span>&nbsp;<span class="op" id="5085374">:=</span>&nbsp;<span class="keyword" id="5085377">range</span>&nbsp;<span class="ident" id="5085383">s</span>&nbsp;<span class="op" id="5085385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5085389">if</span>&nbsp;<span class="builtintype" id="5085392">int</span><span class="op" id="5085395">(</span><span class="ident" id="5085396">r</span><span class="op" id="5085397">)</span>&nbsp;<span class="op" id="5085399">&lt;</span>&nbsp;<span class="builtinfunc" id="5085401">len</span><span class="op" id="5085404">(</span><span class="ident" id="5085405">replacementTable</span><span class="op" id="5085421">)</span>&nbsp;<span class="op" id="5085423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5085428">if</span>&nbsp;<span class="ident" id="5085431">repl</span>&nbsp;<span class="op" id="5085436">:=</span>&nbsp;<span class="ident" id="5085439">replacementTable</span><span class="op" id="5085455">[</span><span class="ident" id="5085456">r</span><span class="op" id="5085457">]</span><span class="op" id="5085458">;</span>&nbsp;<span class="builtinfunc" id="5085460">len</span><span class="op" id="5085463">(</span><span class="ident" id="5085464">repl</span><span class="op" id="5085468">)</span>&nbsp;<span class="op" id="5085470">!=</span>&nbsp;<span class="num" id="5085473">0</span>&nbsp;<span class="op" id="5085475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5085481">b</span><span class="op" id="5085482">.</span><span class="ident" id="5085483">WriteString</span><span class="op" id="5085494">(</span><span class="ident" id="5085495">s</span><span class="op" id="5085496">[</span><span class="ident" id="5085497">written</span><span class="op" id="5085504">:</span><span class="ident" id="5085505">i</span><span class="op" id="5085506">]</span><span class="op" id="5085507">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5085513">b</span><span class="op" id="5085514">.</span><span class="ident" id="5085515">WriteString</span><span class="op" id="5085526">(</span><span class="ident" id="5085527">repl</span><span class="op" id="5085531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5085537">//&nbsp;Valid&nbsp;as&nbsp;long&nbsp;as&nbsp;replacementTable&nbsp;doesn&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5085586">//&nbsp;include&nbsp;anything&nbsp;above&nbsp;0x7f.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5085622">written</span>&nbsp;<span class="op" id="5085630">=</span>&nbsp;<span class="ident" id="5085632">i</span>&nbsp;<span class="op" id="5085634">+</span>&nbsp;<span class="ident" id="5085636">utf8</span><span class="op" id="5085640">.</span><span class="ident" id="5085641">RuneLen</span><span class="op" id="5085648">(</span><span class="ident" id="5085649">r</span><span class="op" id="5085650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5085655">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5085659">}</span>&nbsp;<span class="keyword" id="5085661">else</span>&nbsp;<span class="keyword" id="5085666">if</span>&nbsp;<span class="ident" id="5085669">badRunes</span>&nbsp;<span class="op" id="5085678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5085683">//&nbsp;No-op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5085696">//&nbsp;IE&nbsp;does&nbsp;not&nbsp;allow&nbsp;these&nbsp;ranges&nbsp;in&nbsp;unquoted&nbsp;attrs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5085751">}</span>&nbsp;<span class="keyword" id="5085753">else</span>&nbsp;<span class="keyword" id="5085758">if</span>&nbsp;<span class="num" id="5085761">0xfdd0</span>&nbsp;<span class="op" id="5085768">&lt;=</span>&nbsp;<span class="ident" id="5085771">r</span>&nbsp;<span class="op" id="5085773">&amp;&amp;</span>&nbsp;<span class="ident" id="5085776">r</span>&nbsp;<span class="op" id="5085778">&lt;=</span>&nbsp;<span class="num" id="5085781">0xfdef</span>&nbsp;<span class="op" id="5085788">||</span>&nbsp;<span class="num" id="5085791">0xfff0</span>&nbsp;<span class="op" id="5085798">&lt;=</span>&nbsp;<span class="ident" id="5085801">r</span>&nbsp;<span class="op" id="5085803">&amp;&amp;</span>&nbsp;<span class="ident" id="5085806">r</span>&nbsp;<span class="op" id="5085808">&lt;=</span>&nbsp;<span class="num" id="5085811">0xffff</span>&nbsp;<span class="op" id="5085818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5085823">fmt</span><span class="op" id="5085826">.</span><span class="ident" id="5085827">Fprintf</span><span class="op" id="5085834">(</span><span class="ident" id="5085835">b</span><span class="op" id="5085836">,</span>&nbsp;<span class="string" id="5085838">&#34;%s&amp;#x%x;&#34;</span><span class="op" id="5085848">,</span>&nbsp;<span class="ident" id="5085850">s</span><span class="op" id="5085851">[</span><span class="ident" id="5085852">written</span><span class="op" id="5085859">:</span><span class="ident" id="5085860">i</span><span class="op" id="5085861">]</span><span class="op" id="5085862">,</span>&nbsp;<span class="ident" id="5085864">r</span><span class="op" id="5085865">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5085870">written</span>&nbsp;<span class="op" id="5085878">=</span>&nbsp;<span class="ident" id="5085880">i</span>&nbsp;<span class="op" id="5085882">+</span>&nbsp;<span class="ident" id="5085884">utf8</span><span class="op" id="5085888">.</span><span class="ident" id="5085889">RuneLen</span><span class="op" id="5085896">(</span><span class="ident" id="5085897">r</span><span class="op" id="5085898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5085902">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5085905">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5085908">if</span>&nbsp;<span class="ident" id="5085911">written</span>&nbsp;<span class="op" id="5085919">==</span>&nbsp;<span class="num" id="5085922">0</span>&nbsp;<span class="op" id="5085924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5085928">return</span>&nbsp;<span class="ident" id="5085935">s</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5085938">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5085941">b</span><span class="op" id="5085942">.</span><span class="ident" id="5085943">WriteString</span><span class="op" id="5085954">(</span><span class="ident" id="5085955">s</span><span class="op" id="5085956">[</span><span class="ident" id="5085957">written</span><span class="op" id="5085964">:</span><span class="op" id="5085965">]</span><span class="op" id="5085966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5085969">return</span>&nbsp;<span class="ident" id="5085976">b</span><span class="op" id="5085977">.</span><span class="ident" id="5085978">String</span><span class="op" id="5085984">(</span><span class="op" id="5085985">)</span><br>
<span class="lineno"></span><span class="op" id="5085987">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="5085990">//&nbsp;stripTags&nbsp;takes&nbsp;a&nbsp;snippet&nbsp;of&nbsp;HTML&nbsp;and&nbsp;returns&nbsp;only&nbsp;the&nbsp;text&nbsp;content.</span><br>
<span class="lineno"></span><span class="comment" id="5086062">//&nbsp;For&nbsp;example,&nbsp;`&lt;b&gt;&amp;iexcl;Hi!&lt;/b&gt;&nbsp;&lt;script&gt;...&lt;/script&gt;`&nbsp;-&gt;&nbsp;`&amp;iexcl;Hi!&nbsp;`.</span><br>
<span class="lineno"></span><span class="keyword" id="5086137">func</span>&nbsp;<span class="ident" id="5086142">stripTags</span><span class="op" id="5086151">(</span><span class="ident" id="5086152">html</span>&nbsp;<span class="builtintype" id="5086157">string</span><span class="op" id="5086163">)</span>&nbsp;<span class="builtintype" id="5086165">string</span>&nbsp;<span class="op" id="5086172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5086175">var</span>&nbsp;<span class="ident" id="5086179">b</span>&nbsp;<span class="ident" id="5086181">bytes</span><span class="op" id="5086186">.</span><span class="ident" id="5086187">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5086195">s</span><span class="op" id="5086196">,</span>&nbsp;<span class="ident" id="5086198">c</span><span class="op" id="5086199">,</span>&nbsp;<span class="ident" id="5086201">i</span><span class="op" id="5086202">,</span>&nbsp;<span class="ident" id="5086204">allText</span>&nbsp;<span class="op" id="5086212">:=</span>&nbsp;<span class="op" id="5086215">[</span><span class="op" id="5086216">]</span><span class="builtintype" id="5086217">byte</span><span class="op" id="5086221">(</span><span class="ident" id="5086222">html</span><span class="op" id="5086226">)</span><span class="op" id="5086227">,</span>&nbsp;<span class="ident" id="5086229">context</span><span class="op" id="5086236">{</span><span class="op" id="5086237">}</span><span class="op" id="5086238">,</span>&nbsp;<span class="num" id="5086240">0</span><span class="op" id="5086241">,</span>&nbsp;<span class="builtintype" id="5086243">true</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5086249">//&nbsp;Using&nbsp;the&nbsp;transition&nbsp;funcs&nbsp;helps&nbsp;us&nbsp;avoid&nbsp;mangling</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5086304">//&nbsp;`&lt;div&nbsp;title=&#34;1&gt;2&#34;&gt;`&nbsp;or&nbsp;`I&nbsp;&lt;3&nbsp;Ponies!`.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5086347">for</span>&nbsp;<span class="ident" id="5086351">i</span>&nbsp;<span class="op" id="5086353">!=</span>&nbsp;<span class="builtinfunc" id="5086356">len</span><span class="op" id="5086359">(</span><span class="ident" id="5086360">s</span><span class="op" id="5086361">)</span>&nbsp;<span class="op" id="5086363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5086367">if</span>&nbsp;<span class="ident" id="5086370">c</span><span class="op" id="5086371">.</span><span class="ident" id="5086372">delim</span>&nbsp;<span class="op" id="5086378">==</span>&nbsp;<span class="ident" id="5086381">delimNone</span>&nbsp;<span class="op" id="5086391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5086396">st</span>&nbsp;<span class="op" id="5086399">:=</span>&nbsp;<span class="ident" id="5086402">c</span><span class="op" id="5086403">.</span><span class="ident" id="5086404">state</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5086413">//&nbsp;Use&nbsp;RCDATA&nbsp;instead&nbsp;of&nbsp;parsing&nbsp;into&nbsp;JS&nbsp;or&nbsp;CSS&nbsp;styles.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5086472">if</span>&nbsp;<span class="ident" id="5086475">c</span><span class="op" id="5086476">.</span><span class="ident" id="5086477">element</span>&nbsp;<span class="op" id="5086485">!=</span>&nbsp;<span class="ident" id="5086488">elementNone</span>&nbsp;<span class="op" id="5086500">&amp;&amp;</span>&nbsp;<span class="op" id="5086503">!</span><span class="ident" id="5086504">isInTag</span><span class="op" id="5086511">(</span><span class="ident" id="5086512">st</span><span class="op" id="5086514">)</span>&nbsp;<span class="op" id="5086516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5086522">st</span>&nbsp;<span class="op" id="5086525">=</span>&nbsp;<span class="ident" id="5086527">stateRCDATA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5086542">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5086547">d</span><span class="op" id="5086548">,</span>&nbsp;<span class="ident" id="5086550">nread</span>&nbsp;<span class="op" id="5086556">:=</span>&nbsp;<span class="ident" id="5086559">transitionFunc</span><span class="op" id="5086573">[</span><span class="ident" id="5086574">st</span><span class="op" id="5086576">]</span><span class="op" id="5086577">(</span><span class="ident" id="5086578">c</span><span class="op" id="5086579">,</span>&nbsp;<span class="ident" id="5086581">s</span><span class="op" id="5086582">[</span><span class="ident" id="5086583">i</span><span class="op" id="5086584">:</span><span class="op" id="5086585">]</span><span class="op" id="5086586">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5086591">i1</span>&nbsp;<span class="op" id="5086594">:=</span>&nbsp;<span class="ident" id="5086597">i</span>&nbsp;<span class="op" id="5086599">+</span>&nbsp;<span class="ident" id="5086601">nread</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5086610">if</span>&nbsp;<span class="ident" id="5086613">c</span><span class="op" id="5086614">.</span><span class="ident" id="5086615">state</span>&nbsp;<span class="op" id="5086621">==</span>&nbsp;<span class="ident" id="5086624">stateText</span>&nbsp;<span class="op" id="5086634">||</span>&nbsp;<span class="ident" id="5086637">c</span><span class="op" id="5086638">.</span><span class="ident" id="5086639">state</span>&nbsp;<span class="op" id="5086645">==</span>&nbsp;<span class="ident" id="5086648">stateRCDATA</span>&nbsp;<span class="op" id="5086660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5086666">//&nbsp;Emit&nbsp;text&nbsp;up&nbsp;to&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;tag&nbsp;or&nbsp;comment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5086722">j</span>&nbsp;<span class="op" id="5086724">:=</span>&nbsp;<span class="ident" id="5086727">i1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5086734">if</span>&nbsp;<span class="ident" id="5086737">d</span><span class="op" id="5086738">.</span><span class="ident" id="5086739">state</span>&nbsp;<span class="op" id="5086745">!=</span>&nbsp;<span class="ident" id="5086748">c</span><span class="op" id="5086749">.</span><span class="ident" id="5086750">state</span>&nbsp;<span class="op" id="5086756">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5086763">for</span>&nbsp;<span class="ident" id="5086767">j1</span>&nbsp;<span class="op" id="5086770">:=</span>&nbsp;<span class="ident" id="5086773">j</span>&nbsp;<span class="op" id="5086775">-</span>&nbsp;<span class="num" id="5086777">1</span><span class="op" id="5086778">;</span>&nbsp;<span class="ident" id="5086780">j1</span>&nbsp;<span class="op" id="5086783">&gt;=</span>&nbsp;<span class="ident" id="5086786">i</span><span class="op" id="5086787">;</span>&nbsp;<span class="ident" id="5086789">j1</span><span class="op" id="5086791">--</span>&nbsp;<span class="op" id="5086794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5086802">if</span>&nbsp;<span class="ident" id="5086805">s</span><span class="op" id="5086806">[</span><span class="ident" id="5086807">j1</span><span class="op" id="5086809">]</span>&nbsp;<span class="op" id="5086811">==</span>&nbsp;<span class="string" id="5086814">&#39;&lt;&#39;</span>&nbsp;<span class="op" id="5086818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5086827">j</span>&nbsp;<span class="op" id="5086829">=</span>&nbsp;<span class="ident" id="5086831">j1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5086841">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5086853">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5086860">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5086866">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5086872">b</span><span class="op" id="5086873">.</span><span class="ident" id="5086874">Write</span><span class="op" id="5086879">(</span><span class="ident" id="5086880">s</span><span class="op" id="5086881">[</span><span class="ident" id="5086882">i</span><span class="op" id="5086883">:</span><span class="ident" id="5086884">j</span><span class="op" id="5086885">]</span><span class="op" id="5086886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5086891">}</span>&nbsp;<span class="keyword" id="5086893">else</span>&nbsp;<span class="op" id="5086898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5086904">allText</span>&nbsp;<span class="op" id="5086912">=</span>&nbsp;<span class="builtintype" id="5086914">false</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5086923">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5086928">c</span><span class="op" id="5086929">,</span>&nbsp;<span class="ident" id="5086931">i</span>&nbsp;<span class="op" id="5086933">=</span>&nbsp;<span class="ident" id="5086935">d</span><span class="op" id="5086936">,</span>&nbsp;<span class="ident" id="5086938">i1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5086944">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5086955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5086959">i1</span>&nbsp;<span class="op" id="5086962">:=</span>&nbsp;<span class="ident" id="5086965">i</span>&nbsp;<span class="op" id="5086967">+</span>&nbsp;<span class="ident" id="5086969">bytes</span><span class="op" id="5086974">.</span><span class="ident" id="5086975">IndexAny</span><span class="op" id="5086983">(</span><span class="ident" id="5086984">s</span><span class="op" id="5086985">[</span><span class="ident" id="5086986">i</span><span class="op" id="5086987">:</span><span class="op" id="5086988">]</span><span class="op" id="5086989">,</span>&nbsp;<span class="ident" id="5086991">delimEnds</span><span class="op" id="5087000">[</span><span class="ident" id="5087001">c</span><span class="op" id="5087002">.</span><span class="ident" id="5087003">delim</span><span class="op" id="5087008">]</span><span class="op" id="5087009">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5087013">if</span>&nbsp;<span class="ident" id="5087016">i1</span>&nbsp;<span class="op" id="5087019">&lt;</span>&nbsp;<span class="ident" id="5087021">i</span>&nbsp;<span class="op" id="5087023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5087028">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5087036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5087040">if</span>&nbsp;<span class="ident" id="5087043">c</span><span class="op" id="5087044">.</span><span class="ident" id="5087045">delim</span>&nbsp;<span class="op" id="5087051">!=</span>&nbsp;<span class="ident" id="5087054">delimSpaceOrTagEnd</span>&nbsp;<span class="op" id="5087073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5087078">//&nbsp;Consume&nbsp;any&nbsp;quote.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5087103">i1</span><span class="op" id="5087105">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5087110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5087114">c</span><span class="op" id="5087115">,</span>&nbsp;<span class="ident" id="5087117">i</span>&nbsp;<span class="op" id="5087119">=</span>&nbsp;<span class="ident" id="5087121">context</span><span class="op" id="5087128">{</span><span class="ident" id="5087129">state</span><span class="op" id="5087134">:</span>&nbsp;<span class="ident" id="5087136">stateTag</span><span class="op" id="5087144">,</span>&nbsp;<span class="ident" id="5087146">element</span><span class="op" id="5087153">:</span>&nbsp;<span class="ident" id="5087155">c</span><span class="op" id="5087156">.</span><span class="ident" id="5087157">element</span><span class="op" id="5087164">}</span><span class="op" id="5087165">,</span>&nbsp;<span class="ident" id="5087167">i1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5087171">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5087174">if</span>&nbsp;<span class="ident" id="5087177">allText</span>&nbsp;<span class="op" id="5087185">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5087189">return</span>&nbsp;<span class="ident" id="5087196">html</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5087202">}</span>&nbsp;<span class="keyword" id="5087204">else</span>&nbsp;<span class="keyword" id="5087209">if</span>&nbsp;<span class="ident" id="5087212">c</span><span class="op" id="5087213">.</span><span class="ident" id="5087214">state</span>&nbsp;<span class="op" id="5087220">==</span>&nbsp;<span class="ident" id="5087223">stateText</span>&nbsp;<span class="op" id="5087233">||</span>&nbsp;<span class="ident" id="5087236">c</span><span class="op" id="5087237">.</span><span class="ident" id="5087238">state</span>&nbsp;<span class="op" id="5087244">==</span>&nbsp;<span class="ident" id="5087247">stateRCDATA</span>&nbsp;<span class="op" id="5087259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5087263">b</span><span class="op" id="5087264">.</span><span class="ident" id="5087265">Write</span><span class="op" id="5087270">(</span><span class="ident" id="5087271">s</span><span class="op" id="5087272">[</span><span class="ident" id="5087273">i</span><span class="op" id="5087274">:</span><span class="op" id="5087275">]</span><span class="op" id="5087276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5087279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5087282">return</span>&nbsp;<span class="ident" id="5087289">b</span><span class="op" id="5087290">.</span><span class="ident" id="5087291">String</span><span class="op" id="5087297">(</span><span class="op" id="5087298">)</span><br>
<span class="lineno">215</span><span class="op" id="5087300">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5087303">//&nbsp;htmlNameFilter&nbsp;accepts&nbsp;valid&nbsp;parts&nbsp;of&nbsp;an&nbsp;HTML&nbsp;attribute&nbsp;or&nbsp;tag&nbsp;name&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="5087377">//&nbsp;a&nbsp;known-safe&nbsp;HTML&nbsp;attribute.</span><br>
<span class="lineno"></span><span class="keyword" id="5087409">func</span>&nbsp;<span class="ident" id="5087414">htmlNameFilter</span><span class="op" id="5087428">(</span><span class="ident" id="5087429">args</span>&nbsp;<span class="op" id="5087434">...</span><span class="keyword" id="5087437">interface</span><span class="op" id="5087446">{</span><span class="op" id="5087447">}</span><span class="op" id="5087448">)</span>&nbsp;<span class="builtintype" id="5087450">string</span>&nbsp;<span class="op" id="5087457">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5087460">s</span><span class="op" id="5087461">,</span>&nbsp;<span class="ident" id="5087463">t</span>&nbsp;<span class="op" id="5087465">:=</span>&nbsp;<span class="ident" id="5087468">stringify</span><span class="op" id="5087477">(</span><span class="ident" id="5087478">args</span><span class="op" id="5087482">...</span><span class="op" id="5087485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5087488">if</span>&nbsp;<span class="ident" id="5087491">t</span>&nbsp;<span class="op" id="5087493">==</span>&nbsp;<span class="ident" id="5087496">contentTypeHTMLAttr</span>&nbsp;<span class="op" id="5087516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5087520">return</span>&nbsp;<span class="ident" id="5087527">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5087530">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5087533">if</span>&nbsp;<span class="builtinfunc" id="5087536">len</span><span class="op" id="5087539">(</span><span class="ident" id="5087540">s</span><span class="op" id="5087541">)</span>&nbsp;<span class="op" id="5087543">==</span>&nbsp;<span class="num" id="5087546">0</span>&nbsp;<span class="op" id="5087548">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5087552">//&nbsp;Avoid&nbsp;violation&nbsp;of&nbsp;structure&nbsp;preservation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5087600">//&nbsp;&lt;input&nbsp;checked&nbsp;{{.K}}={{.V}}&gt;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5087636">//&nbsp;Without&nbsp;this,&nbsp;if&nbsp;.K&nbsp;is&nbsp;empty&nbsp;then&nbsp;.V&nbsp;is&nbsp;the&nbsp;value&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5087694">//&nbsp;checked,&nbsp;but&nbsp;otherwise&nbsp;.V&nbsp;is&nbsp;the&nbsp;value&nbsp;of&nbsp;the&nbsp;attribute</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5087755">//&nbsp;named&nbsp;.K.</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5087770">return</span>&nbsp;<span class="ident" id="5087777">filterFailsafe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5087793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5087796">s</span>&nbsp;<span class="op" id="5087798">=</span>&nbsp;<span class="ident" id="5087800">strings</span><span class="op" id="5087807">.</span><span class="ident" id="5087808">ToLower</span><span class="op" id="5087815">(</span><span class="ident" id="5087816">s</span><span class="op" id="5087817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5087820">if</span>&nbsp;<span class="ident" id="5087823">t</span>&nbsp;<span class="op" id="5087825">:=</span>&nbsp;<span class="ident" id="5087828">attrType</span><span class="op" id="5087836">(</span><span class="ident" id="5087837">s</span><span class="op" id="5087838">)</span><span class="op" id="5087839">;</span>&nbsp;<span class="ident" id="5087841">t</span>&nbsp;<span class="op" id="5087843">!=</span>&nbsp;<span class="ident" id="5087846">contentTypePlain</span>&nbsp;<span class="op" id="5087863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5087867">//&nbsp;TODO:&nbsp;Split&nbsp;attr&nbsp;and&nbsp;element&nbsp;name&nbsp;part&nbsp;filters&nbsp;so&nbsp;we&nbsp;can&nbsp;whitelist</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5087939">//&nbsp;attributes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5087956">return</span>&nbsp;<span class="ident" id="5087963">filterFailsafe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5087979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5087982">for</span>&nbsp;<span class="ident" id="5087986">_</span><span class="op" id="5087987">,</span>&nbsp;<span class="ident" id="5087989">r</span>&nbsp;<span class="op" id="5087991">:=</span>&nbsp;<span class="keyword" id="5087994">range</span>&nbsp;<span class="ident" id="5088000">s</span>&nbsp;<span class="op" id="5088002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5088006">switch</span>&nbsp;<span class="op" id="5088013">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5088017">case</span>&nbsp;<span class="string" id="5088022">&#39;0&#39;</span>&nbsp;<span class="op" id="5088026">&lt;=</span>&nbsp;<span class="ident" id="5088029">r</span>&nbsp;<span class="op" id="5088031">&amp;&amp;</span>&nbsp;<span class="ident" id="5088034">r</span>&nbsp;<span class="op" id="5088036">&lt;=</span>&nbsp;<span class="string" id="5088039">&#39;9&#39;</span><span class="op" id="5088042">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5088046">case</span>&nbsp;<span class="string" id="5088051">&#39;a&#39;</span>&nbsp;<span class="op" id="5088055">&lt;=</span>&nbsp;<span class="ident" id="5088058">r</span>&nbsp;<span class="op" id="5088060">&amp;&amp;</span>&nbsp;<span class="ident" id="5088063">r</span>&nbsp;<span class="op" id="5088065">&lt;=</span>&nbsp;<span class="string" id="5088068">&#39;z&#39;</span><span class="op" id="5088071">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5088075">default</span><span class="op" id="5088082">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5088087">return</span>&nbsp;<span class="ident" id="5088094">filterFailsafe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5088111">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5088114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5088117">return</span>&nbsp;<span class="ident" id="5088124">s</span><br>
<span class="lineno"></span><span class="op" id="5088126">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5088129">//&nbsp;commentEscaper&nbsp;returns&nbsp;the&nbsp;empty&nbsp;string&nbsp;regardless&nbsp;of&nbsp;input.</span><br>
<span class="lineno">250</span><span class="comment" id="5088193">//&nbsp;Comment&nbsp;content&nbsp;does&nbsp;not&nbsp;correspond&nbsp;to&nbsp;any&nbsp;parsed&nbsp;structure&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="5088259">//&nbsp;human-readable&nbsp;content,&nbsp;so&nbsp;the&nbsp;simplest&nbsp;and&nbsp;most&nbsp;secure&nbsp;policy&nbsp;is&nbsp;to&nbsp;drop</span><br>
<span class="lineno"></span><span class="comment" id="5088336">//&nbsp;content&nbsp;interpolated&nbsp;into&nbsp;comments.</span><br>
<span class="lineno"></span><span class="comment" id="5088375">//&nbsp;This&nbsp;approach&nbsp;is&nbsp;equally&nbsp;valid&nbsp;whether&nbsp;or&nbsp;not&nbsp;static&nbsp;comment&nbsp;content&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5088450">//&nbsp;removed&nbsp;from&nbsp;the&nbsp;template.</span><br>
<span class="lineno">255</span><span class="keyword" id="5088480">func</span>&nbsp;<span class="ident" id="5088485">commentEscaper</span><span class="op" id="5088499">(</span><span class="ident" id="5088500">args</span>&nbsp;<span class="op" id="5088505">...</span><span class="keyword" id="5088508">interface</span><span class="op" id="5088517">{</span><span class="op" id="5088518">}</span><span class="op" id="5088519">)</span>&nbsp;<span class="builtintype" id="5088521">string</span>&nbsp;<span class="op" id="5088528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5088531">return</span>&nbsp;<span class="string" id="5088538">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="5088541">}</span>
</div>
</body>
</html>
