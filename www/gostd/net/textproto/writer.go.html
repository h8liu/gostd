<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/textproto</h2>
<ul>
<li><a href="/gostd/net/textproto/header.go.html">header.go</a></li>
<li><a href="/gostd/net/textproto/pipeline.go.html">pipeline.go</a></li>
<li><a href="/gostd/net/textproto/reader.go.html">reader.go</a></li>
<li><a href="/gostd/net/textproto/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/net/textproto/textproto.go.html">textproto.go</a></li>
<li><a href="/gostd/net/textproto/writer.go.html" class="current">writer.go</a></li>
<li><a href="/gostd/net/textproto/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3419560">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3419616">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3419670">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3419721">package</span>&nbsp;<span class="ident" id="3419729">textproto</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3419740">import</span>&nbsp;<span class="op" id="3419747">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3419750">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3419759">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3419766">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="3419771">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3419774">//&nbsp;A&nbsp;Writer&nbsp;implements&nbsp;convenience&nbsp;methods&nbsp;for&nbsp;writing</span><br>
<span class="lineno"></span><span class="comment" id="3419829">//&nbsp;requests&nbsp;or&nbsp;responses&nbsp;to&nbsp;a&nbsp;text&nbsp;protocol&nbsp;network&nbsp;connection.</span><br>
<span class="lineno">15</span><span class="keyword" id="3419893">type</span>&nbsp;<span class="ident" id="3419898">Writer</span>&nbsp;<span class="keyword" id="3419905">struct</span>&nbsp;<span class="op" id="3419912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3419915">W</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3419919">*</span><span class="ident" id="3419920">bufio</span><span class="op" id="3419925">.</span><span class="ident" id="3419926">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3419934">dot</span>&nbsp;<span class="op" id="3419938">*</span><span class="ident" id="3419939">dotWriter</span><br>
<span class="lineno"></span><span class="op" id="3419949">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="3419952">//&nbsp;NewWriter&nbsp;returns&nbsp;a&nbsp;new&nbsp;Writer&nbsp;writing&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="3420000">func</span>&nbsp;<span class="ident" id="3420005">NewWriter</span><span class="op" id="3420014">(</span><span class="ident" id="3420015">w</span>&nbsp;<span class="op" id="3420017">*</span><span class="ident" id="3420018">bufio</span><span class="op" id="3420023">.</span><span class="ident" id="3420024">Writer</span><span class="op" id="3420030">)</span>&nbsp;<span class="op" id="3420032">*</span><span class="ident" id="3420033">Writer</span>&nbsp;<span class="op" id="3420040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3420043">return</span>&nbsp;<span class="op" id="3420050">&amp;</span><span class="ident" id="3420051">Writer</span><span class="op" id="3420057">{</span><span class="ident" id="3420058">W</span><span class="op" id="3420059">:</span>&nbsp;<span class="ident" id="3420061">w</span><span class="op" id="3420062">}</span><br>
<span class="lineno"></span><span class="op" id="3420064">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="3420067">var</span>&nbsp;<span class="ident" id="3420071">crnl</span>&nbsp;<span class="op" id="3420076">=</span>&nbsp;<span class="op" id="3420078">[</span><span class="op" id="3420079">]</span><span class="builtintype" id="3420080">byte</span><span class="op" id="3420084">{</span><span class="string" id="3420085">&#39;\r&#39;</span><span class="op" id="3420089">,</span>&nbsp;<span class="string" id="3420091">&#39;\n&#39;</span><span class="op" id="3420095">}</span><br>
<span class="lineno"></span><span class="keyword" id="3420097">var</span>&nbsp;<span class="ident" id="3420101">dotcrnl</span>&nbsp;<span class="op" id="3420109">=</span>&nbsp;<span class="op" id="3420111">[</span><span class="op" id="3420112">]</span><span class="builtintype" id="3420113">byte</span><span class="op" id="3420117">{</span><span class="string" id="3420118">&#39;.&#39;</span><span class="op" id="3420121">,</span>&nbsp;<span class="string" id="3420123">&#39;\r&#39;</span><span class="op" id="3420127">,</span>&nbsp;<span class="string" id="3420129">&#39;\n&#39;</span><span class="op" id="3420133">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3420136">//&nbsp;PrintfLine&nbsp;writes&nbsp;the&nbsp;formatted&nbsp;output&nbsp;followed&nbsp;by&nbsp;\r\n.</span><br>
<span class="lineno"></span><span class="keyword" id="3420196">func</span>&nbsp;<span class="op" id="3420201">(</span><span class="ident" id="3420202">w</span>&nbsp;<span class="op" id="3420204">*</span><span class="ident" id="3420205">Writer</span><span class="op" id="3420211">)</span>&nbsp;<span class="ident" id="3420213">PrintfLine</span><span class="op" id="3420223">(</span><span class="ident" id="3420224">format</span>&nbsp;<span class="builtintype" id="3420231">string</span><span class="op" id="3420237">,</span>&nbsp;<span class="ident" id="3420239">args</span>&nbsp;<span class="op" id="3420244">...</span><span class="keyword" id="3420247">interface</span><span class="op" id="3420256">{</span><span class="op" id="3420257">}</span><span class="op" id="3420258">)</span>&nbsp;<span class="builtintype" id="3420260">error</span>&nbsp;<span class="op" id="3420266">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3420269">w</span><span class="op" id="3420270">.</span><span class="ident" id="3420271">closeDot</span><span class="op" id="3420279">(</span><span class="op" id="3420280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3420283">fmt</span><span class="op" id="3420286">.</span><span class="ident" id="3420287">Fprintf</span><span class="op" id="3420294">(</span><span class="ident" id="3420295">w</span><span class="op" id="3420296">.</span><span class="ident" id="3420297">W</span><span class="op" id="3420298">,</span>&nbsp;<span class="ident" id="3420300">format</span><span class="op" id="3420306">,</span>&nbsp;<span class="ident" id="3420308">args</span><span class="op" id="3420312">...</span><span class="op" id="3420315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3420318">w</span><span class="op" id="3420319">.</span><span class="ident" id="3420320">W</span><span class="op" id="3420321">.</span><span class="ident" id="3420322">Write</span><span class="op" id="3420327">(</span><span class="ident" id="3420328">crnl</span><span class="op" id="3420332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3420335">return</span>&nbsp;<span class="ident" id="3420342">w</span><span class="op" id="3420343">.</span><span class="ident" id="3420344">W</span><span class="op" id="3420345">.</span><span class="ident" id="3420346">Flush</span><span class="op" id="3420351">(</span><span class="op" id="3420352">)</span><br>
<span class="lineno"></span><span class="op" id="3420354">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="comment" id="3420357">//&nbsp;DotWriter&nbsp;returns&nbsp;a&nbsp;writer&nbsp;that&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;write&nbsp;a&nbsp;dot-encoding&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="3420434">//&nbsp;It&nbsp;takes&nbsp;care&nbsp;of&nbsp;inserting&nbsp;leading&nbsp;dots&nbsp;when&nbsp;necessary,</span><br>
<span class="lineno"></span><span class="comment" id="3420493">//&nbsp;translating&nbsp;line-ending&nbsp;\n&nbsp;into&nbsp;\r\n,&nbsp;and&nbsp;adding&nbsp;the&nbsp;final&nbsp;.\r\n&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="3420566">//&nbsp;when&nbsp;the&nbsp;DotWriter&nbsp;is&nbsp;closed.&nbsp;&nbsp;The&nbsp;caller&nbsp;should&nbsp;close&nbsp;the</span><br>
<span class="lineno">40</span><span class="comment" id="3420628">//&nbsp;DotWriter&nbsp;before&nbsp;the&nbsp;next&nbsp;call&nbsp;to&nbsp;a&nbsp;method&nbsp;on&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="3420680">//</span><br>
<span class="lineno"></span><span class="comment" id="3420683">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;Reader&#39;s&nbsp;DotReader&nbsp;method&nbsp;for&nbsp;details&nbsp;about&nbsp;dot-encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="3420770">func</span>&nbsp;<span class="op" id="3420775">(</span><span class="ident" id="3420776">w</span>&nbsp;<span class="op" id="3420778">*</span><span class="ident" id="3420779">Writer</span><span class="op" id="3420785">)</span>&nbsp;<span class="ident" id="3420787">DotWriter</span><span class="op" id="3420796">(</span><span class="op" id="3420797">)</span>&nbsp;<span class="ident" id="3420799">io</span><span class="op" id="3420801">.</span><span class="ident" id="3420802">WriteCloser</span>&nbsp;<span class="op" id="3420814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3420817">w</span><span class="op" id="3420818">.</span><span class="ident" id="3420819">closeDot</span><span class="op" id="3420827">(</span><span class="op" id="3420828">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3420831">w</span><span class="op" id="3420832">.</span><span class="ident" id="3420833">dot</span>&nbsp;<span class="op" id="3420837">=</span>&nbsp;<span class="op" id="3420839">&amp;</span><span class="ident" id="3420840">dotWriter</span><span class="op" id="3420849">{</span><span class="ident" id="3420850">w</span><span class="op" id="3420851">:</span>&nbsp;<span class="ident" id="3420853">w</span><span class="op" id="3420854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3420857">return</span>&nbsp;<span class="ident" id="3420864">w</span><span class="op" id="3420865">.</span><span class="ident" id="3420866">dot</span><br>
<span class="lineno"></span><span class="op" id="3420870">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3420873">func</span>&nbsp;<span class="op" id="3420878">(</span><span class="ident" id="3420879">w</span>&nbsp;<span class="op" id="3420881">*</span><span class="ident" id="3420882">Writer</span><span class="op" id="3420888">)</span>&nbsp;<span class="ident" id="3420890">closeDot</span><span class="op" id="3420898">(</span><span class="op" id="3420899">)</span>&nbsp;<span class="op" id="3420901">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3420904">if</span>&nbsp;<span class="ident" id="3420907">w</span><span class="op" id="3420908">.</span><span class="ident" id="3420909">dot</span>&nbsp;<span class="op" id="3420913">!=</span>&nbsp;<span class="ident" id="3420916">nil</span>&nbsp;<span class="op" id="3420920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3420924">w</span><span class="op" id="3420925">.</span><span class="ident" id="3420926">dot</span><span class="op" id="3420929">.</span><span class="ident" id="3420930">Close</span><span class="op" id="3420935">(</span><span class="op" id="3420936">)</span>&nbsp;<span class="comment" id="3420938">//&nbsp;sets&nbsp;w.dot&nbsp;=&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3420959">}</span><br>
<span class="lineno"></span><span class="op" id="3420961">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="3420964">type</span>&nbsp;<span class="ident" id="3420969">dotWriter</span>&nbsp;<span class="keyword" id="3420979">struct</span>&nbsp;<span class="op" id="3420986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3420989">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3420995">*</span><span class="ident" id="3420996">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3421004">state</span>&nbsp;<span class="builtintype" id="3421010">int</span><br>
<span class="lineno"></span><span class="op" id="3421014">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="keyword" id="3421017">const</span>&nbsp;<span class="op" id="3421023">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3421026">wstateBeginLine</span>&nbsp;<span class="op" id="3421042">=</span>&nbsp;<span class="ident" id="3421044">iota</span>&nbsp;<span class="comment" id="3421049">//&nbsp;beginning&nbsp;of&nbsp;line;&nbsp;initial&nbsp;state;&nbsp;must&nbsp;be&nbsp;zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3421100">wstateCR</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3421123">//&nbsp;wrote&nbsp;\r&nbsp;(possibly&nbsp;at&nbsp;end&nbsp;of&nbsp;line)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3421162">wstateData</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3421185">//&nbsp;writing&nbsp;data&nbsp;in&nbsp;middle&nbsp;of&nbsp;line</span><br>
<span class="lineno"></span><span class="op" id="3421219">)</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="3421222">func</span>&nbsp;<span class="op" id="3421227">(</span><span class="ident" id="3421228">d</span>&nbsp;<span class="op" id="3421230">*</span><span class="ident" id="3421231">dotWriter</span><span class="op" id="3421240">)</span>&nbsp;<span class="ident" id="3421242">Write</span><span class="op" id="3421247">(</span><span class="ident" id="3421248">b</span>&nbsp;<span class="op" id="3421250">[</span><span class="op" id="3421251">]</span><span class="builtintype" id="3421252">byte</span><span class="op" id="3421256">)</span>&nbsp;<span class="op" id="3421258">(</span><span class="ident" id="3421259">n</span>&nbsp;<span class="builtintype" id="3421261">int</span><span class="op" id="3421264">,</span>&nbsp;<span class="ident" id="3421266">err</span>&nbsp;<span class="builtintype" id="3421270">error</span><span class="op" id="3421275">)</span>&nbsp;<span class="op" id="3421277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3421280">bw</span>&nbsp;<span class="op" id="3421283">:=</span>&nbsp;<span class="ident" id="3421286">d</span><span class="op" id="3421287">.</span><span class="ident" id="3421288">w</span><span class="op" id="3421289">.</span><span class="ident" id="3421290">W</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3421293">for</span>&nbsp;<span class="ident" id="3421297">n</span>&nbsp;<span class="op" id="3421299">&lt;</span>&nbsp;<span class="builtinfunc" id="3421301">len</span><span class="op" id="3421304">(</span><span class="ident" id="3421305">b</span><span class="op" id="3421306">)</span>&nbsp;<span class="op" id="3421308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3421312">c</span>&nbsp;<span class="op" id="3421314">:=</span>&nbsp;<span class="ident" id="3421317">b</span><span class="op" id="3421318">[</span><span class="ident" id="3421319">n</span><span class="op" id="3421320">]</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3421324">switch</span>&nbsp;<span class="ident" id="3421331">d</span><span class="op" id="3421332">.</span><span class="ident" id="3421333">state</span>&nbsp;<span class="op" id="3421339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3421343">case</span>&nbsp;<span class="ident" id="3421348">wstateBeginLine</span><span class="op" id="3421363">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3421368">d</span><span class="op" id="3421369">.</span><span class="ident" id="3421370">state</span>&nbsp;<span class="op" id="3421376">=</span>&nbsp;<span class="ident" id="3421378">wstateData</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3421392">if</span>&nbsp;<span class="ident" id="3421395">c</span>&nbsp;<span class="op" id="3421397">==</span>&nbsp;<span class="string" id="3421400">&#39;.&#39;</span>&nbsp;<span class="op" id="3421404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3421410">//&nbsp;escape&nbsp;leading&nbsp;dot</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3421436">bw</span><span class="op" id="3421438">.</span><span class="ident" id="3421439">WriteByte</span><span class="op" id="3421448">(</span><span class="string" id="3421449">&#39;.&#39;</span><span class="op" id="3421452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3421457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3421462">fallthrough</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3421477">case</span>&nbsp;<span class="ident" id="3421482">wstateData</span><span class="op" id="3421492">:</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3421497">if</span>&nbsp;<span class="ident" id="3421500">c</span>&nbsp;<span class="op" id="3421502">==</span>&nbsp;<span class="string" id="3421505">&#39;\r&#39;</span>&nbsp;<span class="op" id="3421510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3421516">d</span><span class="op" id="3421517">.</span><span class="ident" id="3421518">state</span>&nbsp;<span class="op" id="3421524">=</span>&nbsp;<span class="ident" id="3421526">wstateCR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3421538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3421543">if</span>&nbsp;<span class="ident" id="3421546">c</span>&nbsp;<span class="op" id="3421548">==</span>&nbsp;<span class="string" id="3421551">&#39;\n&#39;</span>&nbsp;<span class="op" id="3421556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3421562">bw</span><span class="op" id="3421564">.</span><span class="ident" id="3421565">WriteByte</span><span class="op" id="3421574">(</span><span class="string" id="3421575">&#39;\r&#39;</span><span class="op" id="3421579">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3421585">d</span><span class="op" id="3421586">.</span><span class="ident" id="3421587">state</span>&nbsp;<span class="op" id="3421593">=</span>&nbsp;<span class="ident" id="3421595">wstateBeginLine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3421614">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3421619">case</span>&nbsp;<span class="ident" id="3421624">wstateCR</span><span class="op" id="3421632">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3421637">d</span><span class="op" id="3421638">.</span><span class="ident" id="3421639">state</span>&nbsp;<span class="op" id="3421645">=</span>&nbsp;<span class="ident" id="3421647">wstateData</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3421661">if</span>&nbsp;<span class="ident" id="3421664">c</span>&nbsp;<span class="op" id="3421666">==</span>&nbsp;<span class="string" id="3421669">&#39;\n&#39;</span>&nbsp;<span class="op" id="3421674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3421680">d</span><span class="op" id="3421681">.</span><span class="ident" id="3421682">state</span>&nbsp;<span class="op" id="3421688">=</span>&nbsp;<span class="ident" id="3421690">wstateBeginLine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3421709">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3421713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3421717">if</span>&nbsp;<span class="ident" id="3421720">err</span>&nbsp;<span class="op" id="3421724">=</span>&nbsp;<span class="ident" id="3421726">bw</span><span class="op" id="3421728">.</span><span class="ident" id="3421729">WriteByte</span><span class="op" id="3421738">(</span><span class="ident" id="3421739">c</span><span class="op" id="3421740">)</span><span class="op" id="3421741">;</span>&nbsp;<span class="ident" id="3421743">err</span>&nbsp;<span class="op" id="3421747">!=</span>&nbsp;<span class="ident" id="3421750">nil</span>&nbsp;<span class="op" id="3421754">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3421759">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3421767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3421771">n</span><span class="op" id="3421772">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3421776">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3421779">return</span><br>
<span class="lineno">100</span><span class="op" id="3421786">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3421789">func</span>&nbsp;<span class="op" id="3421794">(</span><span class="ident" id="3421795">d</span>&nbsp;<span class="op" id="3421797">*</span><span class="ident" id="3421798">dotWriter</span><span class="op" id="3421807">)</span>&nbsp;<span class="ident" id="3421809">Close</span><span class="op" id="3421814">(</span><span class="op" id="3421815">)</span>&nbsp;<span class="builtintype" id="3421817">error</span>&nbsp;<span class="op" id="3421823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3421826">if</span>&nbsp;<span class="ident" id="3421829">d</span><span class="op" id="3421830">.</span><span class="ident" id="3421831">w</span><span class="op" id="3421832">.</span><span class="ident" id="3421833">dot</span>&nbsp;<span class="op" id="3421837">==</span>&nbsp;<span class="ident" id="3421840">d</span>&nbsp;<span class="op" id="3421842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3421846">d</span><span class="op" id="3421847">.</span><span class="ident" id="3421848">w</span><span class="op" id="3421849">.</span><span class="ident" id="3421850">dot</span>&nbsp;<span class="op" id="3421854">=</span>&nbsp;<span class="ident" id="3421856">nil</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3421861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3421864">bw</span>&nbsp;<span class="op" id="3421867">:=</span>&nbsp;<span class="ident" id="3421870">d</span><span class="op" id="3421871">.</span><span class="ident" id="3421872">w</span><span class="op" id="3421873">.</span><span class="ident" id="3421874">W</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3421877">switch</span>&nbsp;<span class="ident" id="3421884">d</span><span class="op" id="3421885">.</span><span class="ident" id="3421886">state</span>&nbsp;<span class="op" id="3421892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3421895">default</span><span class="op" id="3421902">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3421906">bw</span><span class="op" id="3421908">.</span><span class="ident" id="3421909">WriteByte</span><span class="op" id="3421918">(</span><span class="string" id="3421919">&#39;\r&#39;</span><span class="op" id="3421923">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3421927">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3421940">case</span>&nbsp;<span class="ident" id="3421945">wstateCR</span><span class="op" id="3421953">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3421957">bw</span><span class="op" id="3421959">.</span><span class="ident" id="3421960">WriteByte</span><span class="op" id="3421969">(</span><span class="string" id="3421970">&#39;\n&#39;</span><span class="op" id="3421974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3421978">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3421991">case</span>&nbsp;<span class="ident" id="3421996">wstateBeginLine</span><span class="op" id="3422011">:</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3422015">bw</span><span class="op" id="3422017">.</span><span class="ident" id="3422018">Write</span><span class="op" id="3422023">(</span><span class="ident" id="3422024">dotcrnl</span><span class="op" id="3422031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3422034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3422037">return</span>&nbsp;<span class="ident" id="3422044">bw</span><span class="op" id="3422046">.</span><span class="ident" id="3422047">Flush</span><span class="op" id="3422052">(</span><span class="op" id="3422053">)</span><br>
<span class="lineno"></span><span class="op" id="3422055">}</span>
</div>
</body>
</html>
