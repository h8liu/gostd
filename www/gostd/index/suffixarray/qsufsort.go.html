<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>index/suffixarray</h2>
<ul>
<li><a href="/gostd/index/suffixarray/qsufsort.go.html">qsufsort.go</a></li>
<li><a href="/gostd/index/suffixarray/suffixarray.go.html">suffixarray.go</a></li>
<li><a href="/gostd/index/suffixarray/suffixarray_test.go.html">suffixarray_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6200639">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6200694">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6200748">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6200799">//&nbsp;This&nbsp;algorithm&nbsp;is&nbsp;based&nbsp;on&nbsp;&#34;Faster&nbsp;Suffix&nbsp;Sorting&#34;</span><br>
<span class="lineno"></span><span class="comment" id="6200853">//&nbsp;&nbsp;&nbsp;by&nbsp;N.&nbsp;Jesper&nbsp;Larsson&nbsp;and&nbsp;Kunihiko&nbsp;Sadakane</span><br>
<span class="lineno"></span><span class="comment" id="6200901">//&nbsp;paper:&nbsp;http://www.larsson.dogma.net/ssrev-tr.pdf</span><br>
<span class="lineno"></span><span class="comment" id="6200953">//&nbsp;code:&nbsp;&nbsp;http://www.larsson.dogma.net/qsufsort.c</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="comment" id="6201004">//&nbsp;This&nbsp;algorithm&nbsp;computes&nbsp;the&nbsp;suffix&nbsp;array&nbsp;sa&nbsp;by&nbsp;computing&nbsp;its&nbsp;inverse.</span><br>
<span class="lineno"></span><span class="comment" id="6201077">//&nbsp;Consecutive&nbsp;groups&nbsp;of&nbsp;suffixes&nbsp;in&nbsp;sa&nbsp;are&nbsp;labeled&nbsp;as&nbsp;sorted&nbsp;groups&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="6201149">//&nbsp;unsorted&nbsp;groups.&nbsp;For&nbsp;a&nbsp;given&nbsp;pass&nbsp;of&nbsp;the&nbsp;sorter,&nbsp;all&nbsp;suffixes&nbsp;are&nbsp;ordered</span><br>
<span class="lineno"></span><span class="comment" id="6201226">//&nbsp;up&nbsp;to&nbsp;their&nbsp;first&nbsp;h&nbsp;characters,&nbsp;and&nbsp;sa&nbsp;is&nbsp;h-ordered.&nbsp;Suffixes&nbsp;in&nbsp;their</span><br>
<span class="lineno"></span><span class="comment" id="6201300">//&nbsp;final&nbsp;positions&nbsp;and&nbsp;unambiguously&nbsp;sorted&nbsp;in&nbsp;h-order&nbsp;are&nbsp;in&nbsp;a&nbsp;sorted&nbsp;group.</span><br>
<span class="lineno">15</span><span class="comment" id="6201378">//&nbsp;Consecutive&nbsp;groups&nbsp;of&nbsp;suffixes&nbsp;with&nbsp;identical&nbsp;first&nbsp;h&nbsp;characters&nbsp;are&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="6201453">//&nbsp;unsorted&nbsp;group.&nbsp;In&nbsp;each&nbsp;pass&nbsp;of&nbsp;the&nbsp;algorithm,&nbsp;unsorted&nbsp;groups&nbsp;are&nbsp;sorted</span><br>
<span class="lineno"></span><span class="comment" id="6201530">//&nbsp;according&nbsp;to&nbsp;the&nbsp;group&nbsp;number&nbsp;of&nbsp;their&nbsp;following&nbsp;suffix.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6201591">//&nbsp;In&nbsp;the&nbsp;implementation,&nbsp;if&nbsp;sa[i]&nbsp;is&nbsp;negative,&nbsp;it&nbsp;indicates&nbsp;that&nbsp;i&nbsp;is</span><br>
<span class="lineno">20</span><span class="comment" id="6201662">//&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;a&nbsp;sorted&nbsp;group&nbsp;of&nbsp;length&nbsp;-sa[i],&nbsp;and&nbsp;can&nbsp;be&nbsp;skipped.</span><br>
<span class="lineno"></span><span class="comment" id="6201739">//&nbsp;An&nbsp;unsorted&nbsp;group&nbsp;sa[i:k]&nbsp;is&nbsp;given&nbsp;the&nbsp;group&nbsp;number&nbsp;of&nbsp;the&nbsp;index&nbsp;of&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="6201814">//&nbsp;last&nbsp;element,&nbsp;k-1.&nbsp;The&nbsp;group&nbsp;numbers&nbsp;are&nbsp;stored&nbsp;in&nbsp;the&nbsp;inverse&nbsp;slice&nbsp;(inv),</span><br>
<span class="lineno"></span><span class="comment" id="6201893">//&nbsp;and&nbsp;when&nbsp;all&nbsp;groups&nbsp;are&nbsp;sorted,&nbsp;this&nbsp;slice&nbsp;is&nbsp;the&nbsp;inverse&nbsp;suffix&nbsp;array.</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="6201969">package</span>&nbsp;<span class="ident" id="6201977">suffixarray</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6201990">import</span>&nbsp;<span class="string" id="6201997">&#34;sort&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6202005">func</span>&nbsp;<span class="ident" id="6202010">qsufsort</span><span class="op" id="6202018">(</span><span class="ident" id="6202019">data</span>&nbsp;<span class="op" id="6202024">[</span><span class="op" id="6202025">]</span><span class="builtintype" id="6202026">byte</span><span class="op" id="6202030">)</span>&nbsp;<span class="op" id="6202032">[</span><span class="op" id="6202033">]</span><span class="builtintype" id="6202034">int</span>&nbsp;<span class="op" id="6202038">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6202041">//&nbsp;initial&nbsp;sorting&nbsp;by&nbsp;first&nbsp;byte&nbsp;of&nbsp;suffix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6202085">sa</span>&nbsp;<span class="op" id="6202088">:=</span>&nbsp;<span class="ident" id="6202091">sortedByFirstByte</span><span class="op" id="6202108">(</span><span class="ident" id="6202109">data</span><span class="op" id="6202113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6202116">if</span>&nbsp;<span class="builtinfunc" id="6202119">len</span><span class="op" id="6202122">(</span><span class="ident" id="6202123">sa</span><span class="op" id="6202125">)</span>&nbsp;<span class="op" id="6202127">&lt;</span>&nbsp;<span class="num" id="6202129">2</span>&nbsp;<span class="op" id="6202131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6202135">return</span>&nbsp;<span class="ident" id="6202142">sa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6202146">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6202149">//&nbsp;initialize&nbsp;the&nbsp;group&nbsp;lookup&nbsp;table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6202187">//&nbsp;this&nbsp;becomes&nbsp;the&nbsp;inverse&nbsp;of&nbsp;the&nbsp;suffix&nbsp;array&nbsp;when&nbsp;all&nbsp;groups&nbsp;are&nbsp;sorted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6202263">inv</span>&nbsp;<span class="op" id="6202267">:=</span>&nbsp;<span class="ident" id="6202270">initGroups</span><span class="op" id="6202280">(</span><span class="ident" id="6202281">sa</span><span class="op" id="6202283">,</span>&nbsp;<span class="ident" id="6202285">data</span><span class="op" id="6202289">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6202293">//&nbsp;the&nbsp;index&nbsp;starts&nbsp;1-ordered</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6202324">sufSortable</span>&nbsp;<span class="op" id="6202336">:=</span>&nbsp;<span class="op" id="6202339">&amp;</span><span class="ident" id="6202340">suffixSortable</span><span class="op" id="6202354">{</span><span class="ident" id="6202355">sa</span><span class="op" id="6202357">:</span>&nbsp;<span class="ident" id="6202359">sa</span><span class="op" id="6202361">,</span>&nbsp;<span class="ident" id="6202363">inv</span><span class="op" id="6202366">:</span>&nbsp;<span class="ident" id="6202368">inv</span><span class="op" id="6202371">,</span>&nbsp;<span class="ident" id="6202373">h</span><span class="op" id="6202374">:</span>&nbsp;<span class="num" id="6202376">1</span><span class="op" id="6202377">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6202381">for</span>&nbsp;<span class="ident" id="6202385">sa</span><span class="op" id="6202387">[</span><span class="num" id="6202388">0</span><span class="op" id="6202389">]</span>&nbsp;<span class="op" id="6202391">&gt;</span>&nbsp;<span class="op" id="6202393">-</span><span class="builtinfunc" id="6202394">len</span><span class="op" id="6202397">(</span><span class="ident" id="6202398">sa</span><span class="op" id="6202400">)</span>&nbsp;<span class="op" id="6202402">{</span>&nbsp;<span class="comment" id="6202404">//&nbsp;until&nbsp;all&nbsp;suffixes&nbsp;are&nbsp;one&nbsp;big&nbsp;sorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6202453">//&nbsp;The&nbsp;suffixes&nbsp;are&nbsp;h-ordered,&nbsp;make&nbsp;them&nbsp;2*h-ordered</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6202508">pi</span>&nbsp;<span class="op" id="6202511">:=</span>&nbsp;<span class="num" id="6202514">0</span>&nbsp;<span class="comment" id="6202516">//&nbsp;pi&nbsp;is&nbsp;first&nbsp;position&nbsp;of&nbsp;first&nbsp;group</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6202557">sl</span>&nbsp;<span class="op" id="6202560">:=</span>&nbsp;<span class="num" id="6202563">0</span>&nbsp;<span class="comment" id="6202565">//&nbsp;sl&nbsp;is&nbsp;negated&nbsp;length&nbsp;of&nbsp;sorted&nbsp;groups</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6202608">for</span>&nbsp;<span class="ident" id="6202612">pi</span>&nbsp;<span class="op" id="6202615">&lt;</span>&nbsp;<span class="builtinfunc" id="6202617">len</span><span class="op" id="6202620">(</span><span class="ident" id="6202621">sa</span><span class="op" id="6202623">)</span>&nbsp;<span class="op" id="6202625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6202630">if</span>&nbsp;<span class="ident" id="6202633">s</span>&nbsp;<span class="op" id="6202635">:=</span>&nbsp;<span class="ident" id="6202638">sa</span><span class="op" id="6202640">[</span><span class="ident" id="6202641">pi</span><span class="op" id="6202643">]</span><span class="op" id="6202644">;</span>&nbsp;<span class="ident" id="6202646">s</span>&nbsp;<span class="op" id="6202648">&lt;</span>&nbsp;<span class="num" id="6202650">0</span>&nbsp;<span class="op" id="6202652">{</span>&nbsp;<span class="comment" id="6202654">//&nbsp;if&nbsp;pi&nbsp;starts&nbsp;sorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6202687">pi</span>&nbsp;<span class="op" id="6202690">-=</span>&nbsp;<span class="ident" id="6202693">s</span>&nbsp;<span class="comment" id="6202695">//&nbsp;skip&nbsp;over&nbsp;sorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6202725">sl</span>&nbsp;<span class="op" id="6202728">+=</span>&nbsp;<span class="ident" id="6202731">s</span>&nbsp;<span class="comment" id="6202733">//&nbsp;add&nbsp;negated&nbsp;length&nbsp;to&nbsp;sl</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6202764">}</span>&nbsp;<span class="keyword" id="6202766">else</span>&nbsp;<span class="op" id="6202771">{</span>&nbsp;<span class="comment" id="6202773">//&nbsp;if&nbsp;pi&nbsp;starts&nbsp;unsorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6202808">if</span>&nbsp;<span class="ident" id="6202811">sl</span>&nbsp;<span class="op" id="6202814">!=</span>&nbsp;<span class="num" id="6202817">0</span>&nbsp;<span class="op" id="6202819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6202826">sa</span><span class="op" id="6202828">[</span><span class="ident" id="6202829">pi</span><span class="op" id="6202831">+</span><span class="ident" id="6202832">sl</span><span class="op" id="6202834">]</span>&nbsp;<span class="op" id="6202836">=</span>&nbsp;<span class="ident" id="6202838">sl</span>&nbsp;<span class="comment" id="6202841">//&nbsp;combine&nbsp;sorted&nbsp;groups&nbsp;before&nbsp;pi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6202881">sl</span>&nbsp;<span class="op" id="6202884">=</span>&nbsp;<span class="num" id="6202886">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6202892">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6202898">pk</span>&nbsp;<span class="op" id="6202901">:=</span>&nbsp;<span class="ident" id="6202904">inv</span><span class="op" id="6202907">[</span><span class="ident" id="6202908">s</span><span class="op" id="6202909">]</span>&nbsp;<span class="op" id="6202911">+</span>&nbsp;<span class="num" id="6202913">1</span>&nbsp;<span class="comment" id="6202915">//&nbsp;pk-1&nbsp;is&nbsp;last&nbsp;position&nbsp;of&nbsp;unsorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6202962">sufSortable</span><span class="op" id="6202973">.</span><span class="ident" id="6202974">sa</span>&nbsp;<span class="op" id="6202977">=</span>&nbsp;<span class="ident" id="6202979">sa</span><span class="op" id="6202981">[</span><span class="ident" id="6202982">pi</span><span class="op" id="6202984">:</span><span class="ident" id="6202985">pk</span><span class="op" id="6202987">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6202993">sort</span><span class="op" id="6202997">.</span><span class="ident" id="6202998">Sort</span><span class="op" id="6203002">(</span><span class="ident" id="6203003">sufSortable</span><span class="op" id="6203014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6203020">sufSortable</span><span class="op" id="6203031">.</span><span class="ident" id="6203032">updateGroups</span><span class="op" id="6203044">(</span><span class="ident" id="6203045">pi</span><span class="op" id="6203047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6203053">pi</span>&nbsp;<span class="op" id="6203056">=</span>&nbsp;<span class="ident" id="6203058">pk</span>&nbsp;<span class="comment" id="6203061">//&nbsp;next&nbsp;group</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6203078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6203082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6203086">if</span>&nbsp;<span class="ident" id="6203089">sl</span>&nbsp;<span class="op" id="6203092">!=</span>&nbsp;<span class="num" id="6203095">0</span>&nbsp;<span class="op" id="6203097">{</span>&nbsp;<span class="comment" id="6203099">//&nbsp;if&nbsp;the&nbsp;array&nbsp;ends&nbsp;with&nbsp;a&nbsp;sorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6203143">sa</span><span class="op" id="6203145">[</span><span class="ident" id="6203146">pi</span><span class="op" id="6203148">+</span><span class="ident" id="6203149">sl</span><span class="op" id="6203151">]</span>&nbsp;<span class="op" id="6203153">=</span>&nbsp;<span class="ident" id="6203155">sl</span>&nbsp;<span class="comment" id="6203158">//&nbsp;combine&nbsp;sorted&nbsp;groups&nbsp;at&nbsp;end&nbsp;of&nbsp;sa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6203198">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6203203">sufSortable</span><span class="op" id="6203214">.</span><span class="ident" id="6203215">h</span>&nbsp;<span class="op" id="6203217">*=</span>&nbsp;<span class="num" id="6203220">2</span>&nbsp;<span class="comment" id="6203222">//&nbsp;double&nbsp;sorted&nbsp;depth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6203246">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6203250">for</span>&nbsp;<span class="ident" id="6203254">i</span>&nbsp;<span class="op" id="6203256">:=</span>&nbsp;<span class="keyword" id="6203259">range</span>&nbsp;<span class="ident" id="6203265">sa</span>&nbsp;<span class="op" id="6203268">{</span>&nbsp;<span class="comment" id="6203270">//&nbsp;reconstruct&nbsp;suffix&nbsp;array&nbsp;from&nbsp;inverse</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6203313">sa</span><span class="op" id="6203315">[</span><span class="ident" id="6203316">inv</span><span class="op" id="6203319">[</span><span class="ident" id="6203320">i</span><span class="op" id="6203321">]</span><span class="op" id="6203322">]</span>&nbsp;<span class="op" id="6203324">=</span>&nbsp;<span class="ident" id="6203326">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6203329">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6203332">return</span>&nbsp;<span class="ident" id="6203339">sa</span><br>
<span class="lineno"></span><span class="op" id="6203342">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="6203345">func</span>&nbsp;<span class="ident" id="6203350">sortedByFirstByte</span><span class="op" id="6203367">(</span><span class="ident" id="6203368">data</span>&nbsp;<span class="op" id="6203373">[</span><span class="op" id="6203374">]</span><span class="builtintype" id="6203375">byte</span><span class="op" id="6203379">)</span>&nbsp;<span class="op" id="6203381">[</span><span class="op" id="6203382">]</span><span class="builtintype" id="6203383">int</span>&nbsp;<span class="op" id="6203387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6203390">//&nbsp;total&nbsp;byte&nbsp;counts</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6203412">var</span>&nbsp;<span class="ident" id="6203416">count</span>&nbsp;<span class="op" id="6203422">[</span><span class="num" id="6203423">256</span><span class="op" id="6203426">]</span><span class="builtintype" id="6203427">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6203432">for</span>&nbsp;<span class="ident" id="6203436">_</span><span class="op" id="6203437">,</span>&nbsp;<span class="ident" id="6203439">b</span>&nbsp;<span class="op" id="6203441">:=</span>&nbsp;<span class="keyword" id="6203444">range</span>&nbsp;<span class="ident" id="6203450">data</span>&nbsp;<span class="op" id="6203455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6203459">count</span><span class="op" id="6203464">[</span><span class="ident" id="6203465">b</span><span class="op" id="6203466">]</span><span class="op" id="6203467">++</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6203471">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6203474">//&nbsp;make&nbsp;count[b]&nbsp;equal&nbsp;index&nbsp;of&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;b&nbsp;in&nbsp;sorted&nbsp;array</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6203545">sum</span>&nbsp;<span class="op" id="6203549">:=</span>&nbsp;<span class="num" id="6203552">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6203555">for</span>&nbsp;<span class="ident" id="6203559">b</span>&nbsp;<span class="op" id="6203561">:=</span>&nbsp;<span class="keyword" id="6203564">range</span>&nbsp;<span class="ident" id="6203570">count</span>&nbsp;<span class="op" id="6203576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6203580">count</span><span class="op" id="6203585">[</span><span class="ident" id="6203586">b</span><span class="op" id="6203587">]</span><span class="op" id="6203588">,</span>&nbsp;<span class="ident" id="6203590">sum</span>&nbsp;<span class="op" id="6203594">=</span>&nbsp;<span class="ident" id="6203596">sum</span><span class="op" id="6203599">,</span>&nbsp;<span class="ident" id="6203601">count</span><span class="op" id="6203606">[</span><span class="ident" id="6203607">b</span><span class="op" id="6203608">]</span><span class="op" id="6203609">+</span><span class="ident" id="6203610">sum</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6203615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6203618">//&nbsp;iterate&nbsp;through&nbsp;bytes,&nbsp;placing&nbsp;index&nbsp;into&nbsp;the&nbsp;correct&nbsp;spot&nbsp;in&nbsp;sa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6203687">sa</span>&nbsp;<span class="op" id="6203690">:=</span>&nbsp;<span class="builtinfunc" id="6203693">make</span><span class="op" id="6203697">(</span><span class="op" id="6203698">[</span><span class="op" id="6203699">]</span><span class="builtintype" id="6203700">int</span><span class="op" id="6203703">,</span>&nbsp;<span class="builtinfunc" id="6203705">len</span><span class="op" id="6203708">(</span><span class="ident" id="6203709">data</span><span class="op" id="6203713">)</span><span class="op" id="6203714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6203717">for</span>&nbsp;<span class="ident" id="6203721">i</span><span class="op" id="6203722">,</span>&nbsp;<span class="ident" id="6203724">b</span>&nbsp;<span class="op" id="6203726">:=</span>&nbsp;<span class="keyword" id="6203729">range</span>&nbsp;<span class="ident" id="6203735">data</span>&nbsp;<span class="op" id="6203740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6203744">sa</span><span class="op" id="6203746">[</span><span class="ident" id="6203747">count</span><span class="op" id="6203752">[</span><span class="ident" id="6203753">b</span><span class="op" id="6203754">]</span><span class="op" id="6203755">]</span>&nbsp;<span class="op" id="6203757">=</span>&nbsp;<span class="ident" id="6203759">i</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6203763">count</span><span class="op" id="6203768">[</span><span class="ident" id="6203769">b</span><span class="op" id="6203770">]</span><span class="op" id="6203771">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6203775">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6203778">return</span>&nbsp;<span class="ident" id="6203785">sa</span><br>
<span class="lineno"></span><span class="op" id="6203788">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="6203791">func</span>&nbsp;<span class="ident" id="6203796">initGroups</span><span class="op" id="6203806">(</span><span class="ident" id="6203807">sa</span>&nbsp;<span class="op" id="6203810">[</span><span class="op" id="6203811">]</span><span class="builtintype" id="6203812">int</span><span class="op" id="6203815">,</span>&nbsp;<span class="ident" id="6203817">data</span>&nbsp;<span class="op" id="6203822">[</span><span class="op" id="6203823">]</span><span class="builtintype" id="6203824">byte</span><span class="op" id="6203828">)</span>&nbsp;<span class="op" id="6203830">[</span><span class="op" id="6203831">]</span><span class="builtintype" id="6203832">int</span>&nbsp;<span class="op" id="6203836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6203839">//&nbsp;label&nbsp;contiguous&nbsp;same-letter&nbsp;groups&nbsp;with&nbsp;the&nbsp;same&nbsp;group&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6203906">inv</span>&nbsp;<span class="op" id="6203910">:=</span>&nbsp;<span class="builtinfunc" id="6203913">make</span><span class="op" id="6203917">(</span><span class="op" id="6203918">[</span><span class="op" id="6203919">]</span><span class="builtintype" id="6203920">int</span><span class="op" id="6203923">,</span>&nbsp;<span class="builtinfunc" id="6203925">len</span><span class="op" id="6203928">(</span><span class="ident" id="6203929">data</span><span class="op" id="6203933">)</span><span class="op" id="6203934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6203937">prevGroup</span>&nbsp;<span class="op" id="6203947">:=</span>&nbsp;<span class="builtinfunc" id="6203950">len</span><span class="op" id="6203953">(</span><span class="ident" id="6203954">sa</span><span class="op" id="6203956">)</span>&nbsp;<span class="op" id="6203958">-</span>&nbsp;<span class="num" id="6203960">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6203963">groupByte</span>&nbsp;<span class="op" id="6203973">:=</span>&nbsp;<span class="ident" id="6203976">data</span><span class="op" id="6203980">[</span><span class="ident" id="6203981">sa</span><span class="op" id="6203983">[</span><span class="ident" id="6203984">prevGroup</span><span class="op" id="6203993">]</span><span class="op" id="6203994">]</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6203997">for</span>&nbsp;<span class="ident" id="6204001">i</span>&nbsp;<span class="op" id="6204003">:=</span>&nbsp;<span class="builtinfunc" id="6204006">len</span><span class="op" id="6204009">(</span><span class="ident" id="6204010">sa</span><span class="op" id="6204012">)</span>&nbsp;<span class="op" id="6204014">-</span>&nbsp;<span class="num" id="6204016">1</span><span class="op" id="6204017">;</span>&nbsp;<span class="ident" id="6204019">i</span>&nbsp;<span class="op" id="6204021">&gt;=</span>&nbsp;<span class="num" id="6204024">0</span><span class="op" id="6204025">;</span>&nbsp;<span class="ident" id="6204027">i</span><span class="op" id="6204028">--</span>&nbsp;<span class="op" id="6204031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6204035">if</span>&nbsp;<span class="ident" id="6204038">b</span>&nbsp;<span class="op" id="6204040">:=</span>&nbsp;<span class="ident" id="6204043">data</span><span class="op" id="6204047">[</span><span class="ident" id="6204048">sa</span><span class="op" id="6204050">[</span><span class="ident" id="6204051">i</span><span class="op" id="6204052">]</span><span class="op" id="6204053">]</span><span class="op" id="6204054">;</span>&nbsp;<span class="ident" id="6204056">b</span>&nbsp;<span class="op" id="6204058">&lt;</span>&nbsp;<span class="ident" id="6204060">groupByte</span>&nbsp;<span class="op" id="6204070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6204075">if</span>&nbsp;<span class="ident" id="6204078">prevGroup</span>&nbsp;<span class="op" id="6204088">==</span>&nbsp;<span class="ident" id="6204091">i</span><span class="op" id="6204092">+</span><span class="num" id="6204093">1</span>&nbsp;<span class="op" id="6204095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6204101">sa</span><span class="op" id="6204103">[</span><span class="ident" id="6204104">i</span><span class="op" id="6204105">+</span><span class="num" id="6204106">1</span><span class="op" id="6204107">]</span>&nbsp;<span class="op" id="6204109">=</span>&nbsp;<span class="op" id="6204111">-</span><span class="num" id="6204112">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6204117">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6204122">groupByte</span>&nbsp;<span class="op" id="6204132">=</span>&nbsp;<span class="ident" id="6204134">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6204139">prevGroup</span>&nbsp;<span class="op" id="6204149">=</span>&nbsp;<span class="ident" id="6204151">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6204155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6204159">inv</span><span class="op" id="6204162">[</span><span class="ident" id="6204163">sa</span><span class="op" id="6204165">[</span><span class="ident" id="6204166">i</span><span class="op" id="6204167">]</span><span class="op" id="6204168">]</span>&nbsp;<span class="op" id="6204170">=</span>&nbsp;<span class="ident" id="6204172">prevGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6204184">if</span>&nbsp;<span class="ident" id="6204187">prevGroup</span>&nbsp;<span class="op" id="6204197">==</span>&nbsp;<span class="num" id="6204200">0</span>&nbsp;<span class="op" id="6204202">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6204207">sa</span><span class="op" id="6204209">[</span><span class="num" id="6204210">0</span><span class="op" id="6204211">]</span>&nbsp;<span class="op" id="6204213">=</span>&nbsp;<span class="op" id="6204215">-</span><span class="num" id="6204216">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6204220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6204223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6204226">//&nbsp;Separate&nbsp;out&nbsp;the&nbsp;final&nbsp;suffix&nbsp;to&nbsp;the&nbsp;start&nbsp;of&nbsp;its&nbsp;group.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6204287">//&nbsp;This&nbsp;is&nbsp;necessary&nbsp;to&nbsp;ensure&nbsp;the&nbsp;suffix&nbsp;&#34;a&#34;&nbsp;is&nbsp;before&nbsp;&#34;aba&#34;</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6204350">//&nbsp;when&nbsp;using&nbsp;a&nbsp;potentially&nbsp;unstable&nbsp;sort.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6204394">lastByte</span>&nbsp;<span class="op" id="6204403">:=</span>&nbsp;<span class="ident" id="6204406">data</span><span class="op" id="6204410">[</span><span class="builtinfunc" id="6204411">len</span><span class="op" id="6204414">(</span><span class="ident" id="6204415">data</span><span class="op" id="6204419">)</span><span class="op" id="6204420">-</span><span class="num" id="6204421">1</span><span class="op" id="6204422">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6204425">s</span>&nbsp;<span class="op" id="6204427">:=</span>&nbsp;<span class="op" id="6204430">-</span><span class="num" id="6204431">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6204434">for</span>&nbsp;<span class="ident" id="6204438">i</span>&nbsp;<span class="op" id="6204440">:=</span>&nbsp;<span class="keyword" id="6204443">range</span>&nbsp;<span class="ident" id="6204449">sa</span>&nbsp;<span class="op" id="6204452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6204456">if</span>&nbsp;<span class="ident" id="6204459">sa</span><span class="op" id="6204461">[</span><span class="ident" id="6204462">i</span><span class="op" id="6204463">]</span>&nbsp;<span class="op" id="6204465">&gt;=</span>&nbsp;<span class="num" id="6204468">0</span>&nbsp;<span class="op" id="6204470">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6204475">if</span>&nbsp;<span class="ident" id="6204478">data</span><span class="op" id="6204482">[</span><span class="ident" id="6204483">sa</span><span class="op" id="6204485">[</span><span class="ident" id="6204486">i</span><span class="op" id="6204487">]</span><span class="op" id="6204488">]</span>&nbsp;<span class="op" id="6204490">==</span>&nbsp;<span class="ident" id="6204493">lastByte</span>&nbsp;<span class="op" id="6204502">&amp;&amp;</span>&nbsp;<span class="ident" id="6204505">s</span>&nbsp;<span class="op" id="6204507">==</span>&nbsp;<span class="op" id="6204510">-</span><span class="num" id="6204511">1</span>&nbsp;<span class="op" id="6204513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6204519">s</span>&nbsp;<span class="op" id="6204521">=</span>&nbsp;<span class="ident" id="6204523">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6204528">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6204533">if</span>&nbsp;<span class="ident" id="6204536">sa</span><span class="op" id="6204538">[</span><span class="ident" id="6204539">i</span><span class="op" id="6204540">]</span>&nbsp;<span class="op" id="6204542">==</span>&nbsp;<span class="builtinfunc" id="6204545">len</span><span class="op" id="6204548">(</span><span class="ident" id="6204549">sa</span><span class="op" id="6204551">)</span><span class="op" id="6204552">-</span><span class="num" id="6204553">1</span>&nbsp;<span class="op" id="6204555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6204561">sa</span><span class="op" id="6204563">[</span><span class="ident" id="6204564">i</span><span class="op" id="6204565">]</span><span class="op" id="6204566">,</span>&nbsp;<span class="ident" id="6204568">sa</span><span class="op" id="6204570">[</span><span class="ident" id="6204571">s</span><span class="op" id="6204572">]</span>&nbsp;<span class="op" id="6204574">=</span>&nbsp;<span class="ident" id="6204576">sa</span><span class="op" id="6204578">[</span><span class="ident" id="6204579">s</span><span class="op" id="6204580">]</span><span class="op" id="6204581">,</span>&nbsp;<span class="ident" id="6204583">sa</span><span class="op" id="6204585">[</span><span class="ident" id="6204586">i</span><span class="op" id="6204587">]</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6204593">inv</span><span class="op" id="6204596">[</span><span class="ident" id="6204597">sa</span><span class="op" id="6204599">[</span><span class="ident" id="6204600">s</span><span class="op" id="6204601">]</span><span class="op" id="6204602">]</span>&nbsp;<span class="op" id="6204604">=</span>&nbsp;<span class="ident" id="6204606">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6204612">sa</span><span class="op" id="6204614">[</span><span class="ident" id="6204615">s</span><span class="op" id="6204616">]</span>&nbsp;<span class="op" id="6204618">=</span>&nbsp;<span class="op" id="6204620">-</span><span class="num" id="6204621">1</span>&nbsp;<span class="comment" id="6204623">//&nbsp;mark&nbsp;it&nbsp;as&nbsp;an&nbsp;isolated&nbsp;sorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6204666">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6204675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6204679">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6204682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6204685">return</span>&nbsp;<span class="ident" id="6204692">inv</span><br>
<span class="lineno"></span><span class="op" id="6204696">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6204699">type</span>&nbsp;<span class="ident" id="6204704">suffixSortable</span>&nbsp;<span class="keyword" id="6204719">struct</span>&nbsp;<span class="op" id="6204726">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6204729">sa</span>&nbsp;&nbsp;<span class="op" id="6204733">[</span><span class="op" id="6204734">]</span><span class="builtintype" id="6204735">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6204740">inv</span>&nbsp;<span class="op" id="6204744">[</span><span class="op" id="6204745">]</span><span class="builtintype" id="6204746">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6204751">h</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6204755">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6204760">buf</span>&nbsp;<span class="op" id="6204764">[</span><span class="op" id="6204765">]</span><span class="builtintype" id="6204766">int</span>&nbsp;<span class="comment" id="6204770">//&nbsp;common&nbsp;scratch&nbsp;space</span><br>
<span class="lineno"></span><span class="op" id="6204794">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="keyword" id="6204797">func</span>&nbsp;<span class="op" id="6204802">(</span><span class="ident" id="6204803">x</span>&nbsp;<span class="op" id="6204805">*</span><span class="ident" id="6204806">suffixSortable</span><span class="op" id="6204820">)</span>&nbsp;<span class="ident" id="6204822">Len</span><span class="op" id="6204825">(</span><span class="op" id="6204826">)</span>&nbsp;<span class="builtintype" id="6204828">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6204842">{</span>&nbsp;<span class="keyword" id="6204844">return</span>&nbsp;<span class="builtinfunc" id="6204851">len</span><span class="op" id="6204854">(</span><span class="ident" id="6204855">x</span><span class="op" id="6204856">.</span><span class="ident" id="6204857">sa</span><span class="op" id="6204859">)</span>&nbsp;<span class="op" id="6204861">}</span><br>
<span class="lineno"></span><span class="keyword" id="6204863">func</span>&nbsp;<span class="op" id="6204868">(</span><span class="ident" id="6204869">x</span>&nbsp;<span class="op" id="6204871">*</span><span class="ident" id="6204872">suffixSortable</span><span class="op" id="6204886">)</span>&nbsp;<span class="ident" id="6204888">Less</span><span class="op" id="6204892">(</span><span class="ident" id="6204893">i</span><span class="op" id="6204894">,</span>&nbsp;<span class="ident" id="6204896">j</span>&nbsp;<span class="builtintype" id="6204898">int</span><span class="op" id="6204901">)</span>&nbsp;<span class="builtintype" id="6204903">bool</span>&nbsp;<span class="op" id="6204908">{</span>&nbsp;<span class="keyword" id="6204910">return</span>&nbsp;<span class="ident" id="6204917">x</span><span class="op" id="6204918">.</span><span class="ident" id="6204919">inv</span><span class="op" id="6204922">[</span><span class="ident" id="6204923">x</span><span class="op" id="6204924">.</span><span class="ident" id="6204925">sa</span><span class="op" id="6204927">[</span><span class="ident" id="6204928">i</span><span class="op" id="6204929">]</span><span class="op" id="6204930">+</span><span class="ident" id="6204931">x</span><span class="op" id="6204932">.</span><span class="ident" id="6204933">h</span><span class="op" id="6204934">]</span>&nbsp;<span class="op" id="6204936">&lt;</span>&nbsp;<span class="ident" id="6204938">x</span><span class="op" id="6204939">.</span><span class="ident" id="6204940">inv</span><span class="op" id="6204943">[</span><span class="ident" id="6204944">x</span><span class="op" id="6204945">.</span><span class="ident" id="6204946">sa</span><span class="op" id="6204948">[</span><span class="ident" id="6204949">j</span><span class="op" id="6204950">]</span><span class="op" id="6204951">+</span><span class="ident" id="6204952">x</span><span class="op" id="6204953">.</span><span class="ident" id="6204954">h</span><span class="op" id="6204955">]</span>&nbsp;<span class="op" id="6204957">}</span><br>
<span class="lineno"></span><span class="keyword" id="6204959">func</span>&nbsp;<span class="op" id="6204964">(</span><span class="ident" id="6204965">x</span>&nbsp;<span class="op" id="6204967">*</span><span class="ident" id="6204968">suffixSortable</span><span class="op" id="6204982">)</span>&nbsp;<span class="ident" id="6204984">Swap</span><span class="op" id="6204988">(</span><span class="ident" id="6204989">i</span><span class="op" id="6204990">,</span>&nbsp;<span class="ident" id="6204992">j</span>&nbsp;<span class="builtintype" id="6204994">int</span><span class="op" id="6204997">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6205004">{</span>&nbsp;<span class="ident" id="6205006">x</span><span class="op" id="6205007">.</span><span class="ident" id="6205008">sa</span><span class="op" id="6205010">[</span><span class="ident" id="6205011">i</span><span class="op" id="6205012">]</span><span class="op" id="6205013">,</span>&nbsp;<span class="ident" id="6205015">x</span><span class="op" id="6205016">.</span><span class="ident" id="6205017">sa</span><span class="op" id="6205019">[</span><span class="ident" id="6205020">j</span><span class="op" id="6205021">]</span>&nbsp;<span class="op" id="6205023">=</span>&nbsp;<span class="ident" id="6205025">x</span><span class="op" id="6205026">.</span><span class="ident" id="6205027">sa</span><span class="op" id="6205029">[</span><span class="ident" id="6205030">j</span><span class="op" id="6205031">]</span><span class="op" id="6205032">,</span>&nbsp;<span class="ident" id="6205034">x</span><span class="op" id="6205035">.</span><span class="ident" id="6205036">sa</span><span class="op" id="6205038">[</span><span class="ident" id="6205039">i</span><span class="op" id="6205040">]</span>&nbsp;<span class="op" id="6205042">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="keyword" id="6205045">func</span>&nbsp;<span class="op" id="6205050">(</span><span class="ident" id="6205051">x</span>&nbsp;<span class="op" id="6205053">*</span><span class="ident" id="6205054">suffixSortable</span><span class="op" id="6205068">)</span>&nbsp;<span class="ident" id="6205070">updateGroups</span><span class="op" id="6205082">(</span><span class="ident" id="6205083">offset</span>&nbsp;<span class="builtintype" id="6205090">int</span><span class="op" id="6205093">)</span>&nbsp;<span class="op" id="6205095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6205098">bounds</span>&nbsp;<span class="op" id="6205105">:=</span>&nbsp;<span class="ident" id="6205108">x</span><span class="op" id="6205109">.</span><span class="ident" id="6205110">buf</span><span class="op" id="6205113">[</span><span class="num" id="6205114">0</span><span class="op" id="6205115">:</span><span class="num" id="6205116">0</span><span class="op" id="6205117">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6205120">group</span>&nbsp;<span class="op" id="6205126">:=</span>&nbsp;<span class="ident" id="6205129">x</span><span class="op" id="6205130">.</span><span class="ident" id="6205131">inv</span><span class="op" id="6205134">[</span><span class="ident" id="6205135">x</span><span class="op" id="6205136">.</span><span class="ident" id="6205137">sa</span><span class="op" id="6205139">[</span><span class="num" id="6205140">0</span><span class="op" id="6205141">]</span><span class="op" id="6205142">+</span><span class="ident" id="6205143">x</span><span class="op" id="6205144">.</span><span class="ident" id="6205145">h</span><span class="op" id="6205146">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6205149">for</span>&nbsp;<span class="ident" id="6205153">i</span>&nbsp;<span class="op" id="6205155">:=</span>&nbsp;<span class="num" id="6205158">1</span><span class="op" id="6205159">;</span>&nbsp;<span class="ident" id="6205161">i</span>&nbsp;<span class="op" id="6205163">&lt;</span>&nbsp;<span class="builtinfunc" id="6205165">len</span><span class="op" id="6205168">(</span><span class="ident" id="6205169">x</span><span class="op" id="6205170">.</span><span class="ident" id="6205171">sa</span><span class="op" id="6205173">)</span><span class="op" id="6205174">;</span>&nbsp;<span class="ident" id="6205176">i</span><span class="op" id="6205177">++</span>&nbsp;<span class="op" id="6205180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6205184">if</span>&nbsp;<span class="ident" id="6205187">g</span>&nbsp;<span class="op" id="6205189">:=</span>&nbsp;<span class="ident" id="6205192">x</span><span class="op" id="6205193">.</span><span class="ident" id="6205194">inv</span><span class="op" id="6205197">[</span><span class="ident" id="6205198">x</span><span class="op" id="6205199">.</span><span class="ident" id="6205200">sa</span><span class="op" id="6205202">[</span><span class="ident" id="6205203">i</span><span class="op" id="6205204">]</span><span class="op" id="6205205">+</span><span class="ident" id="6205206">x</span><span class="op" id="6205207">.</span><span class="ident" id="6205208">h</span><span class="op" id="6205209">]</span><span class="op" id="6205210">;</span>&nbsp;<span class="ident" id="6205212">g</span>&nbsp;<span class="op" id="6205214">&gt;</span>&nbsp;<span class="ident" id="6205216">group</span>&nbsp;<span class="op" id="6205222">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6205227">bounds</span>&nbsp;<span class="op" id="6205234">=</span>&nbsp;<span class="builtinfunc" id="6205236">append</span><span class="op" id="6205242">(</span><span class="ident" id="6205243">bounds</span><span class="op" id="6205249">,</span>&nbsp;<span class="ident" id="6205251">i</span><span class="op" id="6205252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6205257">group</span>&nbsp;<span class="op" id="6205263">=</span>&nbsp;<span class="ident" id="6205265">g</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6205269">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6205272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6205275">bounds</span>&nbsp;<span class="op" id="6205282">=</span>&nbsp;<span class="builtinfunc" id="6205284">append</span><span class="op" id="6205290">(</span><span class="ident" id="6205291">bounds</span><span class="op" id="6205297">,</span>&nbsp;<span class="builtinfunc" id="6205299">len</span><span class="op" id="6205302">(</span><span class="ident" id="6205303">x</span><span class="op" id="6205304">.</span><span class="ident" id="6205305">sa</span><span class="op" id="6205307">)</span><span class="op" id="6205308">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6205311">x</span><span class="op" id="6205312">.</span><span class="ident" id="6205313">buf</span>&nbsp;<span class="op" id="6205317">=</span>&nbsp;<span class="ident" id="6205319">bounds</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6205328">//&nbsp;update&nbsp;the&nbsp;group&nbsp;numberings&nbsp;after&nbsp;all&nbsp;new&nbsp;groups&nbsp;are&nbsp;determined</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6205396">prev</span>&nbsp;<span class="op" id="6205401">:=</span>&nbsp;<span class="num" id="6205404">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6205407">for</span>&nbsp;<span class="ident" id="6205411">_</span><span class="op" id="6205412">,</span>&nbsp;<span class="ident" id="6205414">b</span>&nbsp;<span class="op" id="6205416">:=</span>&nbsp;<span class="keyword" id="6205419">range</span>&nbsp;<span class="ident" id="6205425">bounds</span>&nbsp;<span class="op" id="6205432">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6205436">for</span>&nbsp;<span class="ident" id="6205440">i</span>&nbsp;<span class="op" id="6205442">:=</span>&nbsp;<span class="ident" id="6205445">prev</span><span class="op" id="6205449">;</span>&nbsp;<span class="ident" id="6205451">i</span>&nbsp;<span class="op" id="6205453">&lt;</span>&nbsp;<span class="ident" id="6205455">b</span><span class="op" id="6205456">;</span>&nbsp;<span class="ident" id="6205458">i</span><span class="op" id="6205459">++</span>&nbsp;<span class="op" id="6205462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6205467">x</span><span class="op" id="6205468">.</span><span class="ident" id="6205469">inv</span><span class="op" id="6205472">[</span><span class="ident" id="6205473">x</span><span class="op" id="6205474">.</span><span class="ident" id="6205475">sa</span><span class="op" id="6205477">[</span><span class="ident" id="6205478">i</span><span class="op" id="6205479">]</span><span class="op" id="6205480">]</span>&nbsp;<span class="op" id="6205482">=</span>&nbsp;<span class="ident" id="6205484">offset</span>&nbsp;<span class="op" id="6205491">+</span>&nbsp;<span class="ident" id="6205493">b</span>&nbsp;<span class="op" id="6205495">-</span>&nbsp;<span class="num" id="6205497">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6205501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6205505">if</span>&nbsp;<span class="ident" id="6205508">b</span><span class="op" id="6205509">-</span><span class="ident" id="6205510">prev</span>&nbsp;<span class="op" id="6205515">==</span>&nbsp;<span class="num" id="6205518">1</span>&nbsp;<span class="op" id="6205520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6205525">x</span><span class="op" id="6205526">.</span><span class="ident" id="6205527">sa</span><span class="op" id="6205529">[</span><span class="ident" id="6205530">prev</span><span class="op" id="6205534">]</span>&nbsp;<span class="op" id="6205536">=</span>&nbsp;<span class="op" id="6205538">-</span><span class="num" id="6205539">1</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6205543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6205547">prev</span>&nbsp;<span class="op" id="6205552">=</span>&nbsp;<span class="ident" id="6205554">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6205557">}</span><br>
<span class="lineno"></span><span class="op" id="6205559">}</span>
</div>
</body>
</html>
