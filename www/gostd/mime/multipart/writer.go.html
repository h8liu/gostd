<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>mime/multipart</h2>
<ul>
<li><a href="/gostd/mime/multipart/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/mime/multipart/formdata.go.html">formdata.go</a></li>
<li><a href="/gostd/mime/multipart/formdata_test.go.html">formdata_test.go</a></li>
<li><a href="/gostd/mime/multipart/multipart.go.html">multipart.go</a></li>
<li><a href="/gostd/mime/multipart/multipart_test.go.html">multipart_test.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable.go.html">quotedprintable.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable_test.go.html">quotedprintable_test.go</a></li>
<li><a href="/gostd/mime/multipart/writer.go.html">writer.go</a></li>
<li><a href="/gostd/mime/multipart/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4960534">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4960589">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4960643">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4960694">package</span>&nbsp;<span class="ident" id="4960702">multipart</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4960713">import</span>&nbsp;<span class="op" id="4960720">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4960723">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4960732">&#34;crypto/rand&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4960747">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4960757">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4960764">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4960770">&#34;net/textproto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4960787">&#34;strings&#34;</span><br>
<span class="lineno">15</span><span class="op" id="4960797">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4960800">//&nbsp;A&nbsp;Writer&nbsp;generates&nbsp;multipart&nbsp;messages.</span><br>
<span class="lineno"></span><span class="keyword" id="4960842">type</span>&nbsp;<span class="ident" id="4960847">Writer</span>&nbsp;<span class="keyword" id="4960854">struct</span>&nbsp;<span class="op" id="4960861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4960864">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4960873">io</span><span class="op" id="4960875">.</span><span class="ident" id="4960876">Writer</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4960884">boundary</span>&nbsp;<span class="builtintype" id="4960893">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4960901">lastpart</span>&nbsp;<span class="op" id="4960910">*</span><span class="ident" id="4960911">part</span><br>
<span class="lineno"></span><span class="op" id="4960916">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4960919">//&nbsp;NewWriter&nbsp;returns&nbsp;a&nbsp;new&nbsp;multipart&nbsp;Writer&nbsp;with&nbsp;a&nbsp;random&nbsp;boundary,</span><br>
<span class="lineno">25</span><span class="comment" id="4960987">//&nbsp;writing&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="4961004">func</span>&nbsp;<span class="ident" id="4961009">NewWriter</span><span class="op" id="4961018">(</span><span class="ident" id="4961019">w</span>&nbsp;<span class="ident" id="4961021">io</span><span class="op" id="4961023">.</span><span class="ident" id="4961024">Writer</span><span class="op" id="4961030">)</span>&nbsp;<span class="op" id="4961032">*</span><span class="ident" id="4961033">Writer</span>&nbsp;<span class="op" id="4961040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4961043">return</span>&nbsp;<span class="op" id="4961050">&amp;</span><span class="ident" id="4961051">Writer</span><span class="op" id="4961057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4961061">w</span><span class="op" id="4961062">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4961071">w</span><span class="op" id="4961072">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4961076">boundary</span><span class="op" id="4961084">:</span>&nbsp;<span class="ident" id="4961086">randomBoundary</span><span class="op" id="4961100">(</span><span class="op" id="4961101">)</span><span class="op" id="4961102">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4961105">}</span><br>
<span class="lineno"></span><span class="op" id="4961107">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4961110">//&nbsp;Boundary&nbsp;returns&nbsp;the&nbsp;Writer&#39;s&nbsp;boundary.</span><br>
<span class="lineno"></span><span class="keyword" id="4961153">func</span>&nbsp;<span class="op" id="4961158">(</span><span class="ident" id="4961159">w</span>&nbsp;<span class="op" id="4961161">*</span><span class="ident" id="4961162">Writer</span><span class="op" id="4961168">)</span>&nbsp;<span class="ident" id="4961170">Boundary</span><span class="op" id="4961178">(</span><span class="op" id="4961179">)</span>&nbsp;<span class="builtintype" id="4961181">string</span>&nbsp;<span class="op" id="4961188">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4961191">return</span>&nbsp;<span class="ident" id="4961198">w</span><span class="op" id="4961199">.</span><span class="ident" id="4961200">boundary</span><br>
<span class="lineno"></span><span class="op" id="4961209">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4961212">//&nbsp;SetBoundary&nbsp;overrides&nbsp;the&nbsp;Writer&#39;s&nbsp;default&nbsp;randomly-generated</span><br>
<span class="lineno"></span><span class="comment" id="4961277">//&nbsp;boundary&nbsp;separator&nbsp;with&nbsp;an&nbsp;explicit&nbsp;value.</span><br>
<span class="lineno">40</span><span class="comment" id="4961323">//</span><br>
<span class="lineno"></span><span class="comment" id="4961326">//&nbsp;SetBoundary&nbsp;must&nbsp;be&nbsp;called&nbsp;before&nbsp;any&nbsp;parts&nbsp;are&nbsp;created,&nbsp;may&nbsp;only</span><br>
<span class="lineno"></span><span class="comment" id="4961395">//&nbsp;contain&nbsp;certain&nbsp;ASCII&nbsp;characters,&nbsp;and&nbsp;must&nbsp;be&nbsp;1-69&nbsp;bytes&nbsp;long.</span><br>
<span class="lineno"></span><span class="keyword" id="4961461">func</span>&nbsp;<span class="op" id="4961466">(</span><span class="ident" id="4961467">w</span>&nbsp;<span class="op" id="4961469">*</span><span class="ident" id="4961470">Writer</span><span class="op" id="4961476">)</span>&nbsp;<span class="ident" id="4961478">SetBoundary</span><span class="op" id="4961489">(</span><span class="ident" id="4961490">boundary</span>&nbsp;<span class="builtintype" id="4961499">string</span><span class="op" id="4961505">)</span>&nbsp;<span class="builtintype" id="4961507">error</span>&nbsp;<span class="op" id="4961513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4961516">if</span>&nbsp;<span class="ident" id="4961519">w</span><span class="op" id="4961520">.</span><span class="ident" id="4961521">lastpart</span>&nbsp;<span class="op" id="4961530">!=</span>&nbsp;<span class="ident" id="4961533">nil</span>&nbsp;<span class="op" id="4961537">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4961541">return</span>&nbsp;<span class="ident" id="4961548">errors</span><span class="op" id="4961554">.</span><span class="ident" id="4961555">New</span><span class="op" id="4961558">(</span><span class="string" id="4961559">&#34;mime:&nbsp;SetBoundary&nbsp;called&nbsp;after&nbsp;write&#34;</span><span class="op" id="4961597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4961600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4961603">//&nbsp;rfc2046#section-5.1.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4961629">if</span>&nbsp;<span class="builtinfunc" id="4961632">len</span><span class="op" id="4961635">(</span><span class="ident" id="4961636">boundary</span><span class="op" id="4961644">)</span>&nbsp;<span class="op" id="4961646">&lt;</span>&nbsp;<span class="num" id="4961648">1</span>&nbsp;<span class="op" id="4961650">||</span>&nbsp;<span class="builtinfunc" id="4961653">len</span><span class="op" id="4961656">(</span><span class="ident" id="4961657">boundary</span><span class="op" id="4961665">)</span>&nbsp;<span class="op" id="4961667">&gt;</span>&nbsp;<span class="num" id="4961669">69</span>&nbsp;<span class="op" id="4961672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4961676">return</span>&nbsp;<span class="ident" id="4961683">errors</span><span class="op" id="4961689">.</span><span class="ident" id="4961690">New</span><span class="op" id="4961693">(</span><span class="string" id="4961694">&#34;mime:&nbsp;invalid&nbsp;boundary&nbsp;length&#34;</span><span class="op" id="4961725">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4961728">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4961731">for</span>&nbsp;<span class="ident" id="4961735">_</span><span class="op" id="4961736">,</span>&nbsp;<span class="ident" id="4961738">b</span>&nbsp;<span class="op" id="4961740">:=</span>&nbsp;<span class="keyword" id="4961743">range</span>&nbsp;<span class="ident" id="4961749">boundary</span>&nbsp;<span class="op" id="4961758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4961762">if</span>&nbsp;<span class="string" id="4961765">&#39;A&#39;</span>&nbsp;<span class="op" id="4961769">&lt;=</span>&nbsp;<span class="ident" id="4961772">b</span>&nbsp;<span class="op" id="4961774">&amp;&amp;</span>&nbsp;<span class="ident" id="4961777">b</span>&nbsp;<span class="op" id="4961779">&lt;=</span>&nbsp;<span class="string" id="4961782">&#39;Z&#39;</span>&nbsp;<span class="op" id="4961786">||</span>&nbsp;<span class="string" id="4961789">&#39;a&#39;</span>&nbsp;<span class="op" id="4961793">&lt;=</span>&nbsp;<span class="ident" id="4961796">b</span>&nbsp;<span class="op" id="4961798">&amp;&amp;</span>&nbsp;<span class="ident" id="4961801">b</span>&nbsp;<span class="op" id="4961803">&lt;=</span>&nbsp;<span class="string" id="4961806">&#39;z&#39;</span>&nbsp;<span class="op" id="4961810">||</span>&nbsp;<span class="string" id="4961813">&#39;0&#39;</span>&nbsp;<span class="op" id="4961817">&lt;=</span>&nbsp;<span class="ident" id="4961820">b</span>&nbsp;<span class="op" id="4961822">&amp;&amp;</span>&nbsp;<span class="ident" id="4961825">b</span>&nbsp;<span class="op" id="4961827">&lt;=</span>&nbsp;<span class="string" id="4961830">&#39;9&#39;</span>&nbsp;<span class="op" id="4961834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4961839">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4961850">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4961854">switch</span>&nbsp;<span class="ident" id="4961861">b</span>&nbsp;<span class="op" id="4961863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4961867">case</span>&nbsp;<span class="string" id="4961872">&#39;\&#39;&#39;</span><span class="op" id="4961876">,</span>&nbsp;<span class="string" id="4961878">&#39;(&#39;</span><span class="op" id="4961881">,</span>&nbsp;<span class="string" id="4961883">&#39;)&#39;</span><span class="op" id="4961886">,</span>&nbsp;<span class="string" id="4961888">&#39;+&#39;</span><span class="op" id="4961891">,</span>&nbsp;<span class="string" id="4961893">&#39;_&#39;</span><span class="op" id="4961896">,</span>&nbsp;<span class="string" id="4961898">&#39;,&#39;</span><span class="op" id="4961901">,</span>&nbsp;<span class="string" id="4961903">&#39;-&#39;</span><span class="op" id="4961906">,</span>&nbsp;<span class="string" id="4961908">&#39;.&#39;</span><span class="op" id="4961911">,</span>&nbsp;<span class="string" id="4961913">&#39;/&#39;</span><span class="op" id="4961916">,</span>&nbsp;<span class="string" id="4961918">&#39;:&#39;</span><span class="op" id="4961921">,</span>&nbsp;<span class="string" id="4961923">&#39;=&#39;</span><span class="op" id="4961926">,</span>&nbsp;<span class="string" id="4961928">&#39;?&#39;</span><span class="op" id="4961931">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4961936">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4961947">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4961951">return</span>&nbsp;<span class="ident" id="4961958">errors</span><span class="op" id="4961964">.</span><span class="ident" id="4961965">New</span><span class="op" id="4961968">(</span><span class="string" id="4961969">&#34;mime:&nbsp;invalid&nbsp;boundary&nbsp;character&#34;</span><span class="op" id="4962003">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4962006">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4962009">w</span><span class="op" id="4962010">.</span><span class="ident" id="4962011">boundary</span>&nbsp;<span class="op" id="4962020">=</span>&nbsp;<span class="ident" id="4962022">boundary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4962032">return</span>&nbsp;<span class="ident" id="4962039">nil</span><br>
<span class="lineno"></span><span class="op" id="4962043">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="4962046">//&nbsp;FormDataContentType&nbsp;returns&nbsp;the&nbsp;Content-Type&nbsp;for&nbsp;an&nbsp;HTTP</span><br>
<span class="lineno"></span><span class="comment" id="4962106">//&nbsp;multipart/form-data&nbsp;with&nbsp;this&nbsp;Writer&#39;s&nbsp;Boundary.</span><br>
<span class="lineno"></span><span class="keyword" id="4962158">func</span>&nbsp;<span class="op" id="4962163">(</span><span class="ident" id="4962164">w</span>&nbsp;<span class="op" id="4962166">*</span><span class="ident" id="4962167">Writer</span><span class="op" id="4962173">)</span>&nbsp;<span class="ident" id="4962175">FormDataContentType</span><span class="op" id="4962194">(</span><span class="op" id="4962195">)</span>&nbsp;<span class="builtintype" id="4962197">string</span>&nbsp;<span class="op" id="4962204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4962207">return</span>&nbsp;<span class="string" id="4962214">&#34;multipart/form-data;&nbsp;boundary=&#34;</span>&nbsp;<span class="op" id="4962247">+</span>&nbsp;<span class="ident" id="4962249">w</span><span class="op" id="4962250">.</span><span class="ident" id="4962251">boundary</span><br>
<span class="lineno"></span><span class="op" id="4962260">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="4962263">func</span>&nbsp;<span class="ident" id="4962268">randomBoundary</span><span class="op" id="4962282">(</span><span class="op" id="4962283">)</span>&nbsp;<span class="builtintype" id="4962285">string</span>&nbsp;<span class="op" id="4962292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4962295">var</span>&nbsp;<span class="ident" id="4962299">buf</span>&nbsp;<span class="op" id="4962303">[</span><span class="num" id="4962304">30</span><span class="op" id="4962306">]</span><span class="builtintype" id="4962307">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4962313">_</span><span class="op" id="4962314">,</span>&nbsp;<span class="ident" id="4962316">err</span>&nbsp;<span class="op" id="4962320">:=</span>&nbsp;<span class="ident" id="4962323">io</span><span class="op" id="4962325">.</span><span class="ident" id="4962326">ReadFull</span><span class="op" id="4962334">(</span><span class="ident" id="4962335">rand</span><span class="op" id="4962339">.</span><span class="ident" id="4962340">Reader</span><span class="op" id="4962346">,</span>&nbsp;<span class="ident" id="4962348">buf</span><span class="op" id="4962351">[</span><span class="op" id="4962352">:</span><span class="op" id="4962353">]</span><span class="op" id="4962354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4962357">if</span>&nbsp;<span class="ident" id="4962360">err</span>&nbsp;<span class="op" id="4962364">!=</span>&nbsp;<span class="ident" id="4962367">nil</span>&nbsp;<span class="op" id="4962371">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4962375">panic</span><span class="op" id="4962380">(</span><span class="ident" id="4962381">err</span><span class="op" id="4962384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4962387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4962390">return</span>&nbsp;<span class="ident" id="4962397">fmt</span><span class="op" id="4962400">.</span><span class="ident" id="4962401">Sprintf</span><span class="op" id="4962408">(</span><span class="string" id="4962409">&#34;%x&#34;</span><span class="op" id="4962413">,</span>&nbsp;<span class="ident" id="4962415">buf</span><span class="op" id="4962418">[</span><span class="op" id="4962419">:</span><span class="op" id="4962420">]</span><span class="op" id="4962421">)</span><br>
<span class="lineno"></span><span class="op" id="4962423">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="4962426">//&nbsp;CreatePart&nbsp;creates&nbsp;a&nbsp;new&nbsp;multipart&nbsp;section&nbsp;with&nbsp;the&nbsp;provided</span><br>
<span class="lineno"></span><span class="comment" id="4962490">//&nbsp;header.&nbsp;The&nbsp;body&nbsp;of&nbsp;the&nbsp;part&nbsp;should&nbsp;be&nbsp;written&nbsp;to&nbsp;the&nbsp;returned</span><br>
<span class="lineno"></span><span class="comment" id="4962556">//&nbsp;Writer.&nbsp;After&nbsp;calling&nbsp;CreatePart,&nbsp;any&nbsp;previous&nbsp;part&nbsp;may&nbsp;no&nbsp;longer</span><br>
<span class="lineno"></span><span class="comment" id="4962625">//&nbsp;be&nbsp;written&nbsp;to.</span><br>
<span class="lineno"></span><span class="keyword" id="4962643">func</span>&nbsp;<span class="op" id="4962648">(</span><span class="ident" id="4962649">w</span>&nbsp;<span class="op" id="4962651">*</span><span class="ident" id="4962652">Writer</span><span class="op" id="4962658">)</span>&nbsp;<span class="ident" id="4962660">CreatePart</span><span class="op" id="4962670">(</span><span class="ident" id="4962671">header</span>&nbsp;<span class="ident" id="4962678">textproto</span><span class="op" id="4962687">.</span><span class="ident" id="4962688">MIMEHeader</span><span class="op" id="4962698">)</span>&nbsp;<span class="op" id="4962700">(</span><span class="ident" id="4962701">io</span><span class="op" id="4962703">.</span><span class="ident" id="4962704">Writer</span><span class="op" id="4962710">,</span>&nbsp;<span class="builtintype" id="4962712">error</span><span class="op" id="4962717">)</span>&nbsp;<span class="op" id="4962719">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4962722">if</span>&nbsp;<span class="ident" id="4962725">w</span><span class="op" id="4962726">.</span><span class="ident" id="4962727">lastpart</span>&nbsp;<span class="op" id="4962736">!=</span>&nbsp;<span class="ident" id="4962739">nil</span>&nbsp;<span class="op" id="4962743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4962747">if</span>&nbsp;<span class="ident" id="4962750">err</span>&nbsp;<span class="op" id="4962754">:=</span>&nbsp;<span class="ident" id="4962757">w</span><span class="op" id="4962758">.</span><span class="ident" id="4962759">lastpart</span><span class="op" id="4962767">.</span><span class="builtinfunc" id="4962768">close</span><span class="op" id="4962773">(</span><span class="op" id="4962774">)</span><span class="op" id="4962775">;</span>&nbsp;<span class="ident" id="4962777">err</span>&nbsp;<span class="op" id="4962781">!=</span>&nbsp;<span class="ident" id="4962784">nil</span>&nbsp;<span class="op" id="4962788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4962793">return</span>&nbsp;<span class="ident" id="4962800">nil</span><span class="op" id="4962803">,</span>&nbsp;<span class="ident" id="4962805">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4962811">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4962814">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4962817">var</span>&nbsp;<span class="ident" id="4962821">b</span>&nbsp;<span class="ident" id="4962823">bytes</span><span class="op" id="4962828">.</span><span class="ident" id="4962829">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4962837">if</span>&nbsp;<span class="ident" id="4962840">w</span><span class="op" id="4962841">.</span><span class="ident" id="4962842">lastpart</span>&nbsp;<span class="op" id="4962851">!=</span>&nbsp;<span class="ident" id="4962854">nil</span>&nbsp;<span class="op" id="4962858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4962862">fmt</span><span class="op" id="4962865">.</span><span class="ident" id="4962866">Fprintf</span><span class="op" id="4962873">(</span><span class="op" id="4962874">&amp;</span><span class="ident" id="4962875">b</span><span class="op" id="4962876">,</span>&nbsp;<span class="string" id="4962878">&#34;\r\n--%s\r\n&#34;</span><span class="op" id="4962892">,</span>&nbsp;<span class="ident" id="4962894">w</span><span class="op" id="4962895">.</span><span class="ident" id="4962896">boundary</span><span class="op" id="4962904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4962907">}</span>&nbsp;<span class="keyword" id="4962909">else</span>&nbsp;<span class="op" id="4962914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4962918">fmt</span><span class="op" id="4962921">.</span><span class="ident" id="4962922">Fprintf</span><span class="op" id="4962929">(</span><span class="op" id="4962930">&amp;</span><span class="ident" id="4962931">b</span><span class="op" id="4962932">,</span>&nbsp;<span class="string" id="4962934">&#34;--%s\r\n&#34;</span><span class="op" id="4962944">,</span>&nbsp;<span class="ident" id="4962946">w</span><span class="op" id="4962947">.</span><span class="ident" id="4962948">boundary</span><span class="op" id="4962956">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4962959">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4962962">//&nbsp;TODO(bradfitz):&nbsp;move&nbsp;this&nbsp;to&nbsp;textproto.MimeHeader.Write(w),&nbsp;have&nbsp;it&nbsp;sort</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4963039">//&nbsp;and&nbsp;clean,&nbsp;like&nbsp;http.Header.Write(w)&nbsp;does.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4963086">for</span>&nbsp;<span class="ident" id="4963090">k</span><span class="op" id="4963091">,</span>&nbsp;<span class="ident" id="4963093">vv</span>&nbsp;<span class="op" id="4963096">:=</span>&nbsp;<span class="keyword" id="4963099">range</span>&nbsp;<span class="ident" id="4963105">header</span>&nbsp;<span class="op" id="4963112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4963116">for</span>&nbsp;<span class="ident" id="4963120">_</span><span class="op" id="4963121">,</span>&nbsp;<span class="ident" id="4963123">v</span>&nbsp;<span class="op" id="4963125">:=</span>&nbsp;<span class="keyword" id="4963128">range</span>&nbsp;<span class="ident" id="4963134">vv</span>&nbsp;<span class="op" id="4963137">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4963142">fmt</span><span class="op" id="4963145">.</span><span class="ident" id="4963146">Fprintf</span><span class="op" id="4963153">(</span><span class="op" id="4963154">&amp;</span><span class="ident" id="4963155">b</span><span class="op" id="4963156">,</span>&nbsp;<span class="string" id="4963158">&#34;%s:&nbsp;%s\r\n&#34;</span><span class="op" id="4963170">,</span>&nbsp;<span class="ident" id="4963172">k</span><span class="op" id="4963173">,</span>&nbsp;<span class="ident" id="4963175">v</span><span class="op" id="4963176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4963180">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4963183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4963186">fmt</span><span class="op" id="4963189">.</span><span class="ident" id="4963190">Fprintf</span><span class="op" id="4963197">(</span><span class="op" id="4963198">&amp;</span><span class="ident" id="4963199">b</span><span class="op" id="4963200">,</span>&nbsp;<span class="string" id="4963202">&#34;\r\n&#34;</span><span class="op" id="4963208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4963211">_</span><span class="op" id="4963212">,</span>&nbsp;<span class="ident" id="4963214">err</span>&nbsp;<span class="op" id="4963218">:=</span>&nbsp;<span class="ident" id="4963221">io</span><span class="op" id="4963223">.</span><span class="ident" id="4963224">Copy</span><span class="op" id="4963228">(</span><span class="ident" id="4963229">w</span><span class="op" id="4963230">.</span><span class="ident" id="4963231">w</span><span class="op" id="4963232">,</span>&nbsp;<span class="op" id="4963234">&amp;</span><span class="ident" id="4963235">b</span><span class="op" id="4963236">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4963239">if</span>&nbsp;<span class="ident" id="4963242">err</span>&nbsp;<span class="op" id="4963246">!=</span>&nbsp;<span class="ident" id="4963249">nil</span>&nbsp;<span class="op" id="4963253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4963257">return</span>&nbsp;<span class="ident" id="4963264">nil</span><span class="op" id="4963267">,</span>&nbsp;<span class="ident" id="4963269">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4963274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4963277">p</span>&nbsp;<span class="op" id="4963279">:=</span>&nbsp;<span class="op" id="4963282">&amp;</span><span class="ident" id="4963283">part</span><span class="op" id="4963287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4963291">mw</span><span class="op" id="4963293">:</span>&nbsp;<span class="ident" id="4963295">w</span><span class="op" id="4963296">,</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4963299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4963302">w</span><span class="op" id="4963303">.</span><span class="ident" id="4963304">lastpart</span>&nbsp;<span class="op" id="4963313">=</span>&nbsp;<span class="ident" id="4963315">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4963318">return</span>&nbsp;<span class="ident" id="4963325">p</span><span class="op" id="4963326">,</span>&nbsp;<span class="ident" id="4963328">nil</span><br>
<span class="lineno"></span><span class="op" id="4963332">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="4963335">var</span>&nbsp;<span class="ident" id="4963339">quoteEscaper</span>&nbsp;<span class="op" id="4963352">=</span>&nbsp;<span class="ident" id="4963354">strings</span><span class="op" id="4963361">.</span><span class="ident" id="4963362">NewReplacer</span><span class="op" id="4963373">(</span><span class="string" id="4963374">&#34;\\&#34;</span><span class="op" id="4963378">,</span>&nbsp;<span class="string" id="4963380">&#34;\\\\&#34;</span><span class="op" id="4963386">,</span>&nbsp;<span class="string" id="4963388">`&#34;`</span><span class="op" id="4963391">,</span>&nbsp;<span class="string" id="4963393">&#34;\\\&#34;&#34;</span><span class="op" id="4963399">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4963402">func</span>&nbsp;<span class="ident" id="4963407">escapeQuotes</span><span class="op" id="4963419">(</span><span class="ident" id="4963420">s</span>&nbsp;<span class="builtintype" id="4963422">string</span><span class="op" id="4963428">)</span>&nbsp;<span class="builtintype" id="4963430">string</span>&nbsp;<span class="op" id="4963437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4963440">return</span>&nbsp;<span class="ident" id="4963447">quoteEscaper</span><span class="op" id="4963459">.</span><span class="ident" id="4963460">Replace</span><span class="op" id="4963467">(</span><span class="ident" id="4963468">s</span><span class="op" id="4963469">)</span><br>
<span class="lineno"></span><span class="op" id="4963471">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="comment" id="4963474">//&nbsp;CreateFormFile&nbsp;is&nbsp;a&nbsp;convenience&nbsp;wrapper&nbsp;around&nbsp;CreatePart.&nbsp;It&nbsp;creates</span><br>
<span class="lineno"></span><span class="comment" id="4963547">//&nbsp;a&nbsp;new&nbsp;form-data&nbsp;header&nbsp;with&nbsp;the&nbsp;provided&nbsp;field&nbsp;name&nbsp;and&nbsp;file&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="4963617">func</span>&nbsp;<span class="op" id="4963622">(</span><span class="ident" id="4963623">w</span>&nbsp;<span class="op" id="4963625">*</span><span class="ident" id="4963626">Writer</span><span class="op" id="4963632">)</span>&nbsp;<span class="ident" id="4963634">CreateFormFile</span><span class="op" id="4963648">(</span><span class="ident" id="4963649">fieldname</span><span class="op" id="4963658">,</span>&nbsp;<span class="ident" id="4963660">filename</span>&nbsp;<span class="builtintype" id="4963669">string</span><span class="op" id="4963675">)</span>&nbsp;<span class="op" id="4963677">(</span><span class="ident" id="4963678">io</span><span class="op" id="4963680">.</span><span class="ident" id="4963681">Writer</span><span class="op" id="4963687">,</span>&nbsp;<span class="builtintype" id="4963689">error</span><span class="op" id="4963694">)</span>&nbsp;<span class="op" id="4963696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4963699">h</span>&nbsp;<span class="op" id="4963701">:=</span>&nbsp;<span class="builtinfunc" id="4963704">make</span><span class="op" id="4963708">(</span><span class="ident" id="4963709">textproto</span><span class="op" id="4963718">.</span><span class="ident" id="4963719">MIMEHeader</span><span class="op" id="4963729">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4963732">h</span><span class="op" id="4963733">.</span><span class="ident" id="4963734">Set</span><span class="op" id="4963737">(</span><span class="string" id="4963738">&#34;Content-Disposition&#34;</span><span class="op" id="4963759">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4963763">fmt</span><span class="op" id="4963766">.</span><span class="ident" id="4963767">Sprintf</span><span class="op" id="4963774">(</span><span class="string" id="4963775">`form-data;&nbsp;name=&#34;%s&#34;;&nbsp;filename=&#34;%s&#34;`</span><span class="op" id="4963812">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4963817">escapeQuotes</span><span class="op" id="4963829">(</span><span class="ident" id="4963830">fieldname</span><span class="op" id="4963839">)</span><span class="op" id="4963840">,</span>&nbsp;<span class="ident" id="4963842">escapeQuotes</span><span class="op" id="4963854">(</span><span class="ident" id="4963855">filename</span><span class="op" id="4963863">)</span><span class="op" id="4963864">)</span><span class="op" id="4963865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4963868">h</span><span class="op" id="4963869">.</span><span class="ident" id="4963870">Set</span><span class="op" id="4963873">(</span><span class="string" id="4963874">&#34;Content-Type&#34;</span><span class="op" id="4963888">,</span>&nbsp;<span class="string" id="4963890">&#34;application/octet-stream&#34;</span><span class="op" id="4963916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4963919">return</span>&nbsp;<span class="ident" id="4963926">w</span><span class="op" id="4963927">.</span><span class="ident" id="4963928">CreatePart</span><span class="op" id="4963938">(</span><span class="ident" id="4963939">h</span><span class="op" id="4963940">)</span><br>
<span class="lineno">130</span><span class="op" id="4963942">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4963945">//&nbsp;CreateFormField&nbsp;calls&nbsp;CreatePart&nbsp;with&nbsp;a&nbsp;header&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4964005">//&nbsp;given&nbsp;field&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="4964026">func</span>&nbsp;<span class="op" id="4964031">(</span><span class="ident" id="4964032">w</span>&nbsp;<span class="op" id="4964034">*</span><span class="ident" id="4964035">Writer</span><span class="op" id="4964041">)</span>&nbsp;<span class="ident" id="4964043">CreateFormField</span><span class="op" id="4964058">(</span><span class="ident" id="4964059">fieldname</span>&nbsp;<span class="builtintype" id="4964069">string</span><span class="op" id="4964075">)</span>&nbsp;<span class="op" id="4964077">(</span><span class="ident" id="4964078">io</span><span class="op" id="4964080">.</span><span class="ident" id="4964081">Writer</span><span class="op" id="4964087">,</span>&nbsp;<span class="builtintype" id="4964089">error</span><span class="op" id="4964094">)</span>&nbsp;<span class="op" id="4964096">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4964099">h</span>&nbsp;<span class="op" id="4964101">:=</span>&nbsp;<span class="builtinfunc" id="4964104">make</span><span class="op" id="4964108">(</span><span class="ident" id="4964109">textproto</span><span class="op" id="4964118">.</span><span class="ident" id="4964119">MIMEHeader</span><span class="op" id="4964129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4964132">h</span><span class="op" id="4964133">.</span><span class="ident" id="4964134">Set</span><span class="op" id="4964137">(</span><span class="string" id="4964138">&#34;Content-Disposition&#34;</span><span class="op" id="4964159">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4964163">fmt</span><span class="op" id="4964166">.</span><span class="ident" id="4964167">Sprintf</span><span class="op" id="4964174">(</span><span class="string" id="4964175">`form-data;&nbsp;name=&#34;%s&#34;`</span><span class="op" id="4964197">,</span>&nbsp;<span class="ident" id="4964199">escapeQuotes</span><span class="op" id="4964211">(</span><span class="ident" id="4964212">fieldname</span><span class="op" id="4964221">)</span><span class="op" id="4964222">)</span><span class="op" id="4964223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4964226">return</span>&nbsp;<span class="ident" id="4964233">w</span><span class="op" id="4964234">.</span><span class="ident" id="4964235">CreatePart</span><span class="op" id="4964245">(</span><span class="ident" id="4964246">h</span><span class="op" id="4964247">)</span><br>
<span class="lineno"></span><span class="op" id="4964249">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="comment" id="4964252">//&nbsp;WriteField&nbsp;calls&nbsp;CreateFormField&nbsp;and&nbsp;then&nbsp;writes&nbsp;the&nbsp;given&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="4964321">func</span>&nbsp;<span class="op" id="4964326">(</span><span class="ident" id="4964327">w</span>&nbsp;<span class="op" id="4964329">*</span><span class="ident" id="4964330">Writer</span><span class="op" id="4964336">)</span>&nbsp;<span class="ident" id="4964338">WriteField</span><span class="op" id="4964348">(</span><span class="ident" id="4964349">fieldname</span><span class="op" id="4964358">,</span>&nbsp;<span class="ident" id="4964360">value</span>&nbsp;<span class="builtintype" id="4964366">string</span><span class="op" id="4964372">)</span>&nbsp;<span class="builtintype" id="4964374">error</span>&nbsp;<span class="op" id="4964380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4964383">p</span><span class="op" id="4964384">,</span>&nbsp;<span class="ident" id="4964386">err</span>&nbsp;<span class="op" id="4964390">:=</span>&nbsp;<span class="ident" id="4964393">w</span><span class="op" id="4964394">.</span><span class="ident" id="4964395">CreateFormField</span><span class="op" id="4964410">(</span><span class="ident" id="4964411">fieldname</span><span class="op" id="4964420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4964423">if</span>&nbsp;<span class="ident" id="4964426">err</span>&nbsp;<span class="op" id="4964430">!=</span>&nbsp;<span class="ident" id="4964433">nil</span>&nbsp;<span class="op" id="4964437">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4964441">return</span>&nbsp;<span class="ident" id="4964448">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4964453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4964456">_</span><span class="op" id="4964457">,</span>&nbsp;<span class="ident" id="4964459">err</span>&nbsp;<span class="op" id="4964463">=</span>&nbsp;<span class="ident" id="4964465">p</span><span class="op" id="4964466">.</span><span class="ident" id="4964467">Write</span><span class="op" id="4964472">(</span><span class="op" id="4964473">[</span><span class="op" id="4964474">]</span><span class="builtintype" id="4964475">byte</span><span class="op" id="4964479">(</span><span class="ident" id="4964480">value</span><span class="op" id="4964485">)</span><span class="op" id="4964486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4964489">return</span>&nbsp;<span class="ident" id="4964496">err</span><br>
<span class="lineno"></span><span class="op" id="4964500">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="comment" id="4964503">//&nbsp;Close&nbsp;finishes&nbsp;the&nbsp;multipart&nbsp;message&nbsp;and&nbsp;writes&nbsp;the&nbsp;trailing</span><br>
<span class="lineno"></span><span class="comment" id="4964567">//&nbsp;boundary&nbsp;end&nbsp;line&nbsp;to&nbsp;the&nbsp;output.</span><br>
<span class="lineno"></span><span class="keyword" id="4964603">func</span>&nbsp;<span class="op" id="4964608">(</span><span class="ident" id="4964609">w</span>&nbsp;<span class="op" id="4964611">*</span><span class="ident" id="4964612">Writer</span><span class="op" id="4964618">)</span>&nbsp;<span class="ident" id="4964620">Close</span><span class="op" id="4964625">(</span><span class="op" id="4964626">)</span>&nbsp;<span class="builtintype" id="4964628">error</span>&nbsp;<span class="op" id="4964634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4964637">if</span>&nbsp;<span class="ident" id="4964640">w</span><span class="op" id="4964641">.</span><span class="ident" id="4964642">lastpart</span>&nbsp;<span class="op" id="4964651">!=</span>&nbsp;<span class="ident" id="4964654">nil</span>&nbsp;<span class="op" id="4964658">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4964662">if</span>&nbsp;<span class="ident" id="4964665">err</span>&nbsp;<span class="op" id="4964669">:=</span>&nbsp;<span class="ident" id="4964672">w</span><span class="op" id="4964673">.</span><span class="ident" id="4964674">lastpart</span><span class="op" id="4964682">.</span><span class="builtinfunc" id="4964683">close</span><span class="op" id="4964688">(</span><span class="op" id="4964689">)</span><span class="op" id="4964690">;</span>&nbsp;<span class="ident" id="4964692">err</span>&nbsp;<span class="op" id="4964696">!=</span>&nbsp;<span class="ident" id="4964699">nil</span>&nbsp;<span class="op" id="4964703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4964708">return</span>&nbsp;<span class="ident" id="4964715">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4964721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4964725">w</span><span class="op" id="4964726">.</span><span class="ident" id="4964727">lastpart</span>&nbsp;<span class="op" id="4964736">=</span>&nbsp;<span class="ident" id="4964738">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4964743">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4964746">_</span><span class="op" id="4964747">,</span>&nbsp;<span class="ident" id="4964749">err</span>&nbsp;<span class="op" id="4964753">:=</span>&nbsp;<span class="ident" id="4964756">fmt</span><span class="op" id="4964759">.</span><span class="ident" id="4964760">Fprintf</span><span class="op" id="4964767">(</span><span class="ident" id="4964768">w</span><span class="op" id="4964769">.</span><span class="ident" id="4964770">w</span><span class="op" id="4964771">,</span>&nbsp;<span class="string" id="4964773">&#34;\r\n--%s--\r\n&#34;</span><span class="op" id="4964789">,</span>&nbsp;<span class="ident" id="4964791">w</span><span class="op" id="4964792">.</span><span class="ident" id="4964793">boundary</span><span class="op" id="4964801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4964804">return</span>&nbsp;<span class="ident" id="4964811">err</span><br>
<span class="lineno"></span><span class="op" id="4964815">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4964818">type</span>&nbsp;<span class="ident" id="4964823">part</span>&nbsp;<span class="keyword" id="4964828">struct</span>&nbsp;<span class="op" id="4964835">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4964838">mw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4964845">*</span><span class="ident" id="4964846">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4964854">closed</span>&nbsp;<span class="builtintype" id="4964861">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4964867">we</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4964874">error</span>&nbsp;<span class="comment" id="4964880">//&nbsp;last&nbsp;error&nbsp;that&nbsp;occurred&nbsp;writing</span><br>
<span class="lineno"></span><span class="op" id="4964916">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="4964919">func</span>&nbsp;<span class="op" id="4964924">(</span><span class="ident" id="4964925">p</span>&nbsp;<span class="op" id="4964927">*</span><span class="ident" id="4964928">part</span><span class="op" id="4964932">)</span>&nbsp;<span class="builtinfunc" id="4964934">close</span><span class="op" id="4964939">(</span><span class="op" id="4964940">)</span>&nbsp;<span class="builtintype" id="4964942">error</span>&nbsp;<span class="op" id="4964948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4964951">p</span><span class="op" id="4964952">.</span><span class="ident" id="4964953">closed</span>&nbsp;<span class="op" id="4964960">=</span>&nbsp;<span class="builtintype" id="4964962">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4964968">return</span>&nbsp;<span class="ident" id="4964975">p</span><span class="op" id="4964976">.</span><span class="ident" id="4964977">we</span><br>
<span class="lineno"></span><span class="op" id="4964980">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="keyword" id="4964983">func</span>&nbsp;<span class="op" id="4964988">(</span><span class="ident" id="4964989">p</span>&nbsp;<span class="op" id="4964991">*</span><span class="ident" id="4964992">part</span><span class="op" id="4964996">)</span>&nbsp;<span class="ident" id="4964998">Write</span><span class="op" id="4965003">(</span><span class="ident" id="4965004">d</span>&nbsp;<span class="op" id="4965006">[</span><span class="op" id="4965007">]</span><span class="builtintype" id="4965008">byte</span><span class="op" id="4965012">)</span>&nbsp;<span class="op" id="4965014">(</span><span class="ident" id="4965015">n</span>&nbsp;<span class="builtintype" id="4965017">int</span><span class="op" id="4965020">,</span>&nbsp;<span class="ident" id="4965022">err</span>&nbsp;<span class="builtintype" id="4965026">error</span><span class="op" id="4965031">)</span>&nbsp;<span class="op" id="4965033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4965036">if</span>&nbsp;<span class="ident" id="4965039">p</span><span class="op" id="4965040">.</span><span class="ident" id="4965041">closed</span>&nbsp;<span class="op" id="4965048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4965052">return</span>&nbsp;<span class="num" id="4965059">0</span><span class="op" id="4965060">,</span>&nbsp;<span class="ident" id="4965062">errors</span><span class="op" id="4965068">.</span><span class="ident" id="4965069">New</span><span class="op" id="4965072">(</span><span class="string" id="4965073">&#34;multipart:&nbsp;can&#39;t&nbsp;write&nbsp;to&nbsp;finished&nbsp;part&#34;</span><span class="op" id="4965114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4965117">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4965120">n</span><span class="op" id="4965121">,</span>&nbsp;<span class="ident" id="4965123">err</span>&nbsp;<span class="op" id="4965127">=</span>&nbsp;<span class="ident" id="4965129">p</span><span class="op" id="4965130">.</span><span class="ident" id="4965131">mw</span><span class="op" id="4965133">.</span><span class="ident" id="4965134">w</span><span class="op" id="4965135">.</span><span class="ident" id="4965136">Write</span><span class="op" id="4965141">(</span><span class="ident" id="4965142">d</span><span class="op" id="4965143">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4965146">if</span>&nbsp;<span class="ident" id="4965149">err</span>&nbsp;<span class="op" id="4965153">!=</span>&nbsp;<span class="ident" id="4965156">nil</span>&nbsp;<span class="op" id="4965160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4965164">p</span><span class="op" id="4965165">.</span><span class="ident" id="4965166">we</span>&nbsp;<span class="op" id="4965169">=</span>&nbsp;<span class="ident" id="4965171">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4965176">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4965179">return</span><br>
<span class="lineno"></span><span class="op" id="4965186">}</span>
</div>
</body>
</html>
