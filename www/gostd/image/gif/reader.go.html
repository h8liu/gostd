<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/gif</h2>
<ul>
<li><a href="/gostd/image/gif/reader.go.html" class="current">reader.go</a></li>
<li><a href="/gostd/image/gif/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/gif/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/gif/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6068326">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6068381">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6068435">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6068486">//&nbsp;Package&nbsp;gif&nbsp;implements&nbsp;a&nbsp;GIF&nbsp;image&nbsp;decoder&nbsp;and&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="comment" id="6068545">//</span><br>
<span class="lineno"></span><span class="comment" id="6068548">//&nbsp;The&nbsp;GIF&nbsp;specification&nbsp;is&nbsp;at&nbsp;http://www.w3.org/Graphics/GIF/spec-gif89a.txt.</span><br>
<span class="lineno"></span><span class="keyword" id="6068627">package</span>&nbsp;<span class="ident" id="6068635">gif</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="6068640">import</span>&nbsp;<span class="op" id="6068647">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6068650">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6068659">&#34;compress/lzw&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6068675">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6068685">&#34;fmt&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6068692">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6068701">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6068716">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="6068721">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="6068724">var</span>&nbsp;<span class="op" id="6068728">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6068731">errNotEnough</span>&nbsp;<span class="op" id="6068744">=</span>&nbsp;<span class="ident" id="6068746">errors</span><span class="op" id="6068752">.</span><span class="ident" id="6068753">New</span><span class="op" id="6068756">(</span><span class="string" id="6068757">&#34;gif:&nbsp;not&nbsp;enough&nbsp;image&nbsp;data&#34;</span><span class="op" id="6068785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6068788">errTooMuch</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6068801">=</span>&nbsp;<span class="ident" id="6068803">errors</span><span class="op" id="6068809">.</span><span class="ident" id="6068810">New</span><span class="op" id="6068813">(</span><span class="string" id="6068814">&#34;gif:&nbsp;too&nbsp;much&nbsp;image&nbsp;data&#34;</span><span class="op" id="6068840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6068843">errBadPixel</span>&nbsp;&nbsp;<span class="op" id="6068856">=</span>&nbsp;<span class="ident" id="6068858">errors</span><span class="op" id="6068864">.</span><span class="ident" id="6068865">New</span><span class="op" id="6068868">(</span><span class="string" id="6068869">&#34;gif:&nbsp;invalid&nbsp;pixel&nbsp;value&#34;</span><span class="op" id="6068895">)</span><br>
<span class="lineno"></span><span class="op" id="6068897">)</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="6068900">//&nbsp;If&nbsp;the&nbsp;io.Reader&nbsp;does&nbsp;not&nbsp;also&nbsp;have&nbsp;ReadByte,&nbsp;then&nbsp;decode&nbsp;will&nbsp;introduce&nbsp;its&nbsp;own&nbsp;buffering.</span><br>
<span class="lineno"></span><span class="keyword" id="6068995">type</span>&nbsp;<span class="ident" id="6069000">reader</span>&nbsp;<span class="keyword" id="6069007">interface</span>&nbsp;<span class="op" id="6069017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6069020">io</span><span class="op" id="6069022">.</span><span class="ident" id="6069023">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6069031">io</span><span class="op" id="6069033">.</span><span class="ident" id="6069034">ByteReader</span><br>
<span class="lineno">30</span><span class="op" id="6069045">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6069048">//&nbsp;Masks&nbsp;etc.</span><br>
<span class="lineno"></span><span class="keyword" id="6069062">const</span>&nbsp;<span class="op" id="6069068">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6069071">//&nbsp;Fields.</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6069083">fColorMapFollows</span>&nbsp;<span class="op" id="6069100">=</span>&nbsp;<span class="num" id="6069102">1</span>&nbsp;<span class="op" id="6069104">&lt;&lt;</span>&nbsp;<span class="num" id="6069107">7</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6069111">//&nbsp;Image&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6069129">ifLocalColorTable</span>&nbsp;<span class="op" id="6069147">=</span>&nbsp;<span class="num" id="6069149">1</span>&nbsp;<span class="op" id="6069151">&lt;&lt;</span>&nbsp;<span class="num" id="6069154">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6069157">ifInterlace</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6069175">=</span>&nbsp;<span class="num" id="6069177">1</span>&nbsp;<span class="op" id="6069179">&lt;&lt;</span>&nbsp;<span class="num" id="6069182">6</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6069185">ifPixelSizeMask</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6069203">=</span>&nbsp;<span class="num" id="6069205">7</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6069209">//&nbsp;Graphic&nbsp;control&nbsp;flags.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6069236">gcTransparentColorSet</span>&nbsp;<span class="op" id="6069258">=</span>&nbsp;<span class="num" id="6069260">1</span>&nbsp;<span class="op" id="6069262">&lt;&lt;</span>&nbsp;<span class="num" id="6069265">0</span><br>
<span class="lineno"></span><span class="op" id="6069267">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="6069270">//&nbsp;Section&nbsp;indicators.</span><br>
<span class="lineno"></span><span class="keyword" id="6069293">const</span>&nbsp;<span class="op" id="6069299">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6069302">sExtension</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6069319">=</span>&nbsp;<span class="num" id="6069321">0x21</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6069327">sImageDescriptor</span>&nbsp;<span class="op" id="6069344">=</span>&nbsp;<span class="num" id="6069346">0x2C</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6069352">sTrailer</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6069369">=</span>&nbsp;<span class="num" id="6069371">0x3B</span><br>
<span class="lineno"></span><span class="op" id="6069376">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6069379">//&nbsp;Extensions.</span><br>
<span class="lineno"></span><span class="keyword" id="6069394">const</span>&nbsp;<span class="op" id="6069400">(</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6069403">eText</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6069419">=</span>&nbsp;<span class="num" id="6069421">0x01</span>&nbsp;<span class="comment" id="6069426">//&nbsp;Plain&nbsp;Text</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6069441">eGraphicControl</span>&nbsp;<span class="op" id="6069457">=</span>&nbsp;<span class="num" id="6069459">0xF9</span>&nbsp;<span class="comment" id="6069464">//&nbsp;Graphic&nbsp;Control</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6069484">eComment</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6069500">=</span>&nbsp;<span class="num" id="6069502">0xFE</span>&nbsp;<span class="comment" id="6069507">//&nbsp;Comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6069519">eApplication</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6069535">=</span>&nbsp;<span class="num" id="6069537">0xFF</span>&nbsp;<span class="comment" id="6069542">//&nbsp;Application</span><br>
<span class="lineno"></span><span class="op" id="6069557">)</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="comment" id="6069560">//&nbsp;decoder&nbsp;is&nbsp;the&nbsp;type&nbsp;used&nbsp;to&nbsp;decode&nbsp;a&nbsp;GIF&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="6069610">type</span>&nbsp;<span class="ident" id="6069615">decoder</span>&nbsp;<span class="keyword" id="6069623">struct</span>&nbsp;<span class="op" id="6069630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6069633">r</span>&nbsp;<span class="ident" id="6069635">reader</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6069644">//&nbsp;From&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6069661">vers</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6069677">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6069685">width</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6069701">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6069706">height</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6069722">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6069727">flags</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6069743">byte</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6069749">headerFields</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6069765">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6069771">backgroundIndex</span>&nbsp;<span class="builtintype" id="6069787">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6069793">loopCount</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6069809">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6069814">delayTime</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6069830">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6069836">//&nbsp;Unused&nbsp;from&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6069860">aspect</span>&nbsp;<span class="builtintype" id="6069867">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6069874">//&nbsp;From&nbsp;image&nbsp;descriptor.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6069901">imageFields</span>&nbsp;<span class="builtintype" id="6069913">byte</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6069920">//&nbsp;From&nbsp;graphics&nbsp;control.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6069947">transparentIndex</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6069967">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6069973">hasTransparentIndex</span>&nbsp;<span class="builtintype" id="6069993">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6070000">//&nbsp;Computed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6070014">pixelSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6070029">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6070035">globalColorMap</span>&nbsp;<span class="ident" id="6070050">color</span><span class="op" id="6070055">.</span><span class="ident" id="6070056">Palette</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6070066">//&nbsp;Used&nbsp;when&nbsp;decoding.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6070090">delay</span>&nbsp;<span class="op" id="6070096">[</span><span class="op" id="6070097">]</span><span class="builtintype" id="6070098">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6070103">image</span>&nbsp;<span class="op" id="6070109">[</span><span class="op" id="6070110">]</span><span class="op" id="6070111">*</span><span class="ident" id="6070112">image</span><span class="op" id="6070117">.</span><span class="ident" id="6070118">Paletted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6070128">tmp</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6070134">[</span><span class="num" id="6070135">1024</span><span class="op" id="6070139">]</span><span class="builtintype" id="6070140">byte</span>&nbsp;<span class="comment" id="6070145">//&nbsp;must&nbsp;be&nbsp;at&nbsp;least&nbsp;768&nbsp;so&nbsp;we&nbsp;can&nbsp;read&nbsp;color&nbsp;map</span><br>
<span class="lineno"></span><span class="op" id="6070194">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="6070197">//&nbsp;blockReader&nbsp;parses&nbsp;the&nbsp;block&nbsp;structure&nbsp;of&nbsp;GIF&nbsp;image&nbsp;data,&nbsp;which</span><br>
<span class="lineno"></span><span class="comment" id="6070264">//&nbsp;comprises&nbsp;(n,&nbsp;(n&nbsp;bytes))&nbsp;blocks,&nbsp;with&nbsp;1&nbsp;&lt;=&nbsp;n&nbsp;&lt;=&nbsp;255.&nbsp;&nbsp;It&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6070331">//&nbsp;reader&nbsp;given&nbsp;to&nbsp;the&nbsp;LZW&nbsp;decoder,&nbsp;which&nbsp;is&nbsp;thus&nbsp;immune&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6070395">//&nbsp;blocking.&nbsp;&nbsp;After&nbsp;the&nbsp;LZW&nbsp;decoder&nbsp;completes,&nbsp;there&nbsp;will&nbsp;be&nbsp;a&nbsp;0-byte</span><br>
<span class="lineno"></span><span class="comment" id="6070465">//&nbsp;block&nbsp;remaining&nbsp;(0,&nbsp;()),&nbsp;which&nbsp;is&nbsp;consumed&nbsp;when&nbsp;checking&nbsp;that&nbsp;the</span><br>
<span class="lineno">100</span><span class="comment" id="6070534">//&nbsp;blockReader&nbsp;is&nbsp;exhausted.</span><br>
<span class="lineno"></span><span class="keyword" id="6070563">type</span>&nbsp;<span class="ident" id="6070568">blockReader</span>&nbsp;<span class="keyword" id="6070580">struct</span>&nbsp;<span class="op" id="6070587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6070590">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6070596">reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6070604">slice</span>&nbsp;<span class="op" id="6070610">[</span><span class="op" id="6070611">]</span><span class="builtintype" id="6070612">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6070618">err</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6070624">error</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6070631">tmp</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6070637">[</span><span class="num" id="6070638">256</span><span class="op" id="6070641">]</span><span class="builtintype" id="6070642">byte</span><br>
<span class="lineno"></span><span class="op" id="6070647">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6070650">func</span>&nbsp;<span class="op" id="6070655">(</span><span class="ident" id="6070656">b</span>&nbsp;<span class="op" id="6070658">*</span><span class="ident" id="6070659">blockReader</span><span class="op" id="6070670">)</span>&nbsp;<span class="ident" id="6070672">Read</span><span class="op" id="6070676">(</span><span class="ident" id="6070677">p</span>&nbsp;<span class="op" id="6070679">[</span><span class="op" id="6070680">]</span><span class="builtintype" id="6070681">byte</span><span class="op" id="6070685">)</span>&nbsp;<span class="op" id="6070687">(</span><span class="builtintype" id="6070688">int</span><span class="op" id="6070691">,</span>&nbsp;<span class="builtintype" id="6070693">error</span><span class="op" id="6070698">)</span>&nbsp;<span class="op" id="6070700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6070703">if</span>&nbsp;<span class="ident" id="6070706">b</span><span class="op" id="6070707">.</span><span class="ident" id="6070708">err</span>&nbsp;<span class="op" id="6070712">!=</span>&nbsp;<span class="builtintype" id="6070715">nil</span>&nbsp;<span class="op" id="6070719">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6070723">return</span>&nbsp;<span class="num" id="6070730">0</span><span class="op" id="6070731">,</span>&nbsp;<span class="ident" id="6070733">b</span><span class="op" id="6070734">.</span><span class="ident" id="6070735">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6070740">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6070743">if</span>&nbsp;<span class="builtinfunc" id="6070746">len</span><span class="op" id="6070749">(</span><span class="ident" id="6070750">p</span><span class="op" id="6070751">)</span>&nbsp;<span class="op" id="6070753">==</span>&nbsp;<span class="num" id="6070756">0</span>&nbsp;<span class="op" id="6070758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6070762">return</span>&nbsp;<span class="num" id="6070769">0</span><span class="op" id="6070770">,</span>&nbsp;<span class="builtintype" id="6070772">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6070777">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6070780">if</span>&nbsp;<span class="builtinfunc" id="6070783">len</span><span class="op" id="6070786">(</span><span class="ident" id="6070787">b</span><span class="op" id="6070788">.</span><span class="ident" id="6070789">slice</span><span class="op" id="6070794">)</span>&nbsp;<span class="op" id="6070796">==</span>&nbsp;<span class="num" id="6070799">0</span>&nbsp;<span class="op" id="6070801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6070805">var</span>&nbsp;<span class="ident" id="6070809">blockLen</span>&nbsp;<span class="builtintype" id="6070818">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6070826">blockLen</span><span class="op" id="6070834">,</span>&nbsp;<span class="ident" id="6070836">b</span><span class="op" id="6070837">.</span><span class="ident" id="6070838">err</span>&nbsp;<span class="op" id="6070842">=</span>&nbsp;<span class="ident" id="6070844">b</span><span class="op" id="6070845">.</span><span class="ident" id="6070846">r</span><span class="op" id="6070847">.</span><span class="ident" id="6070848">ReadByte</span><span class="op" id="6070856">(</span><span class="op" id="6070857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6070861">if</span>&nbsp;<span class="ident" id="6070864">b</span><span class="op" id="6070865">.</span><span class="ident" id="6070866">err</span>&nbsp;<span class="op" id="6070870">!=</span>&nbsp;<span class="builtintype" id="6070873">nil</span>&nbsp;<span class="op" id="6070877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6070882">return</span>&nbsp;<span class="num" id="6070889">0</span><span class="op" id="6070890">,</span>&nbsp;<span class="ident" id="6070892">b</span><span class="op" id="6070893">.</span><span class="ident" id="6070894">err</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6070900">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6070904">if</span>&nbsp;<span class="ident" id="6070907">blockLen</span>&nbsp;<span class="op" id="6070916">==</span>&nbsp;<span class="num" id="6070919">0</span>&nbsp;<span class="op" id="6070921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6070926">b</span><span class="op" id="6070927">.</span><span class="ident" id="6070928">err</span>&nbsp;<span class="op" id="6070932">=</span>&nbsp;<span class="ident" id="6070934">io</span><span class="op" id="6070936">.</span><span class="ident" id="6070937">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6070944">return</span>&nbsp;<span class="num" id="6070951">0</span><span class="op" id="6070952">,</span>&nbsp;<span class="ident" id="6070954">b</span><span class="op" id="6070955">.</span><span class="ident" id="6070956">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6070962">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6070966">b</span><span class="op" id="6070967">.</span><span class="ident" id="6070968">slice</span>&nbsp;<span class="op" id="6070974">=</span>&nbsp;<span class="ident" id="6070976">b</span><span class="op" id="6070977">.</span><span class="ident" id="6070978">tmp</span><span class="op" id="6070981">[</span><span class="num" id="6070982">0</span><span class="op" id="6070983">:</span><span class="ident" id="6070984">blockLen</span><span class="op" id="6070992">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6070996">if</span>&nbsp;<span class="ident" id="6070999">_</span><span class="op" id="6071000">,</span>&nbsp;<span class="ident" id="6071002">b</span><span class="op" id="6071003">.</span><span class="ident" id="6071004">err</span>&nbsp;<span class="op" id="6071008">=</span>&nbsp;<span class="ident" id="6071010">io</span><span class="op" id="6071012">.</span><span class="ident" id="6071013">ReadFull</span><span class="op" id="6071021">(</span><span class="ident" id="6071022">b</span><span class="op" id="6071023">.</span><span class="ident" id="6071024">r</span><span class="op" id="6071025">,</span>&nbsp;<span class="ident" id="6071027">b</span><span class="op" id="6071028">.</span><span class="ident" id="6071029">slice</span><span class="op" id="6071034">)</span><span class="op" id="6071035">;</span>&nbsp;<span class="ident" id="6071037">b</span><span class="op" id="6071038">.</span><span class="ident" id="6071039">err</span>&nbsp;<span class="op" id="6071043">!=</span>&nbsp;<span class="builtintype" id="6071046">nil</span>&nbsp;<span class="op" id="6071050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6071055">return</span>&nbsp;<span class="num" id="6071062">0</span><span class="op" id="6071063">,</span>&nbsp;<span class="ident" id="6071065">b</span><span class="op" id="6071066">.</span><span class="ident" id="6071067">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6071073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6071076">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6071079">n</span>&nbsp;<span class="op" id="6071081">:=</span>&nbsp;<span class="builtinfunc" id="6071084">copy</span><span class="op" id="6071088">(</span><span class="ident" id="6071089">p</span><span class="op" id="6071090">,</span>&nbsp;<span class="ident" id="6071092">b</span><span class="op" id="6071093">.</span><span class="ident" id="6071094">slice</span><span class="op" id="6071099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6071102">b</span><span class="op" id="6071103">.</span><span class="ident" id="6071104">slice</span>&nbsp;<span class="op" id="6071110">=</span>&nbsp;<span class="ident" id="6071112">b</span><span class="op" id="6071113">.</span><span class="ident" id="6071114">slice</span><span class="op" id="6071119">[</span><span class="ident" id="6071120">n</span><span class="op" id="6071121">:</span><span class="op" id="6071122">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6071125">return</span>&nbsp;<span class="ident" id="6071132">n</span><span class="op" id="6071133">,</span>&nbsp;<span class="builtintype" id="6071135">nil</span><br>
<span class="lineno"></span><span class="op" id="6071139">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="comment" id="6071142">//&nbsp;decode&nbsp;reads&nbsp;a&nbsp;GIF&nbsp;image&nbsp;from&nbsp;r&nbsp;and&nbsp;stores&nbsp;the&nbsp;result&nbsp;in&nbsp;d.</span><br>
<span class="lineno"></span><span class="keyword" id="6071205">func</span>&nbsp;<span class="op" id="6071210">(</span><span class="ident" id="6071211">d</span>&nbsp;<span class="op" id="6071213">*</span><span class="ident" id="6071214">decoder</span><span class="op" id="6071221">)</span>&nbsp;<span class="ident" id="6071223">decode</span><span class="op" id="6071229">(</span><span class="ident" id="6071230">r</span>&nbsp;<span class="ident" id="6071232">io</span><span class="op" id="6071234">.</span><span class="ident" id="6071235">Reader</span><span class="op" id="6071241">,</span>&nbsp;<span class="ident" id="6071243">configOnly</span>&nbsp;<span class="builtintype" id="6071254">bool</span><span class="op" id="6071258">)</span>&nbsp;<span class="builtintype" id="6071260">error</span>&nbsp;<span class="op" id="6071266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6071269">//&nbsp;Add&nbsp;buffering&nbsp;if&nbsp;r&nbsp;does&nbsp;not&nbsp;provide&nbsp;ReadByte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6071319">if</span>&nbsp;<span class="ident" id="6071322">rr</span><span class="op" id="6071324">,</span>&nbsp;<span class="ident" id="6071326">ok</span>&nbsp;<span class="op" id="6071329">:=</span>&nbsp;<span class="ident" id="6071332">r</span><span class="op" id="6071333">.</span><span class="op" id="6071334">(</span><span class="ident" id="6071335">reader</span><span class="op" id="6071341">)</span><span class="op" id="6071342">;</span>&nbsp;<span class="ident" id="6071344">ok</span>&nbsp;<span class="op" id="6071347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6071351">d</span><span class="op" id="6071352">.</span><span class="ident" id="6071353">r</span>&nbsp;<span class="op" id="6071355">=</span>&nbsp;<span class="ident" id="6071357">rr</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6071361">}</span>&nbsp;<span class="keyword" id="6071363">else</span>&nbsp;<span class="op" id="6071368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6071372">d</span><span class="op" id="6071373">.</span><span class="ident" id="6071374">r</span>&nbsp;<span class="op" id="6071376">=</span>&nbsp;<span class="ident" id="6071378">bufio</span><span class="op" id="6071383">.</span><span class="ident" id="6071384">NewReader</span><span class="op" id="6071393">(</span><span class="ident" id="6071394">r</span><span class="op" id="6071395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6071398">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6071402">err</span>&nbsp;<span class="op" id="6071406">:=</span>&nbsp;<span class="ident" id="6071409">d</span><span class="op" id="6071410">.</span><span class="ident" id="6071411">readHeaderAndScreenDescriptor</span><span class="op" id="6071440">(</span><span class="op" id="6071441">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6071444">if</span>&nbsp;<span class="ident" id="6071447">err</span>&nbsp;<span class="op" id="6071451">!=</span>&nbsp;<span class="builtintype" id="6071454">nil</span>&nbsp;<span class="op" id="6071458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6071462">return</span>&nbsp;<span class="ident" id="6071469">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6071474">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6071477">if</span>&nbsp;<span class="ident" id="6071480">configOnly</span>&nbsp;<span class="op" id="6071491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6071495">return</span>&nbsp;<span class="builtintype" id="6071502">nil</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6071507">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6071511">if</span>&nbsp;<span class="ident" id="6071514">d</span><span class="op" id="6071515">.</span><span class="ident" id="6071516">headerFields</span><span class="op" id="6071528">&amp;</span><span class="ident" id="6071529">fColorMapFollows</span>&nbsp;<span class="op" id="6071546">!=</span>&nbsp;<span class="num" id="6071549">0</span>&nbsp;<span class="op" id="6071551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6071555">if</span>&nbsp;<span class="ident" id="6071558">d</span><span class="op" id="6071559">.</span><span class="ident" id="6071560">globalColorMap</span><span class="op" id="6071574">,</span>&nbsp;<span class="ident" id="6071576">err</span>&nbsp;<span class="op" id="6071580">=</span>&nbsp;<span class="ident" id="6071582">d</span><span class="op" id="6071583">.</span><span class="ident" id="6071584">readColorMap</span><span class="op" id="6071596">(</span><span class="op" id="6071597">)</span><span class="op" id="6071598">;</span>&nbsp;<span class="ident" id="6071600">err</span>&nbsp;<span class="op" id="6071604">!=</span>&nbsp;<span class="builtintype" id="6071607">nil</span>&nbsp;<span class="op" id="6071611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6071616">return</span>&nbsp;<span class="ident" id="6071623">err</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6071629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6071632">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6071636">for</span>&nbsp;<span class="op" id="6071640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6071644">c</span><span class="op" id="6071645">,</span>&nbsp;<span class="ident" id="6071647">err</span>&nbsp;<span class="op" id="6071651">:=</span>&nbsp;<span class="ident" id="6071654">d</span><span class="op" id="6071655">.</span><span class="ident" id="6071656">r</span><span class="op" id="6071657">.</span><span class="ident" id="6071658">ReadByte</span><span class="op" id="6071666">(</span><span class="op" id="6071667">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6071671">if</span>&nbsp;<span class="ident" id="6071674">err</span>&nbsp;<span class="op" id="6071678">!=</span>&nbsp;<span class="builtintype" id="6071681">nil</span>&nbsp;<span class="op" id="6071685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6071690">return</span>&nbsp;<span class="ident" id="6071697">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6071703">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6071707">switch</span>&nbsp;<span class="ident" id="6071714">c</span>&nbsp;<span class="op" id="6071716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6071720">case</span>&nbsp;<span class="ident" id="6071725">sExtension</span><span class="op" id="6071735">:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6071740">if</span>&nbsp;<span class="ident" id="6071743">err</span>&nbsp;<span class="op" id="6071747">=</span>&nbsp;<span class="ident" id="6071749">d</span><span class="op" id="6071750">.</span><span class="ident" id="6071751">readExtension</span><span class="op" id="6071764">(</span><span class="op" id="6071765">)</span><span class="op" id="6071766">;</span>&nbsp;<span class="ident" id="6071768">err</span>&nbsp;<span class="op" id="6071772">!=</span>&nbsp;<span class="builtintype" id="6071775">nil</span>&nbsp;<span class="op" id="6071779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6071785">return</span>&nbsp;<span class="ident" id="6071792">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6071799">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6071804">case</span>&nbsp;<span class="ident" id="6071809">sImageDescriptor</span><span class="op" id="6071825">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6071830">m</span><span class="op" id="6071831">,</span>&nbsp;<span class="ident" id="6071833">err</span>&nbsp;<span class="op" id="6071837">:=</span>&nbsp;<span class="ident" id="6071840">d</span><span class="op" id="6071841">.</span><span class="ident" id="6071842">newImageFromDescriptor</span><span class="op" id="6071864">(</span><span class="op" id="6071865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6071870">if</span>&nbsp;<span class="ident" id="6071873">err</span>&nbsp;<span class="op" id="6071877">!=</span>&nbsp;<span class="builtintype" id="6071880">nil</span>&nbsp;<span class="op" id="6071884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6071890">return</span>&nbsp;<span class="ident" id="6071897">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6071904">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6071909">useLocalColorMap</span>&nbsp;<span class="op" id="6071926">:=</span>&nbsp;<span class="ident" id="6071929">d</span><span class="op" id="6071930">.</span><span class="ident" id="6071931">imageFields</span><span class="op" id="6071942">&amp;</span><span class="ident" id="6071943">fColorMapFollows</span>&nbsp;<span class="op" id="6071960">!=</span>&nbsp;<span class="num" id="6071963">0</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6071968">if</span>&nbsp;<span class="ident" id="6071971">useLocalColorMap</span>&nbsp;<span class="op" id="6071988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6071994">m</span><span class="op" id="6071995">.</span><span class="ident" id="6071996">Palette</span><span class="op" id="6072003">,</span>&nbsp;<span class="ident" id="6072005">err</span>&nbsp;<span class="op" id="6072009">=</span>&nbsp;<span class="ident" id="6072011">d</span><span class="op" id="6072012">.</span><span class="ident" id="6072013">readColorMap</span><span class="op" id="6072025">(</span><span class="op" id="6072026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6072032">if</span>&nbsp;<span class="ident" id="6072035">err</span>&nbsp;<span class="op" id="6072039">!=</span>&nbsp;<span class="builtintype" id="6072042">nil</span>&nbsp;<span class="op" id="6072046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6072053">return</span>&nbsp;<span class="ident" id="6072060">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6072068">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6072073">}</span>&nbsp;<span class="keyword" id="6072075">else</span>&nbsp;<span class="op" id="6072080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6072086">m</span><span class="op" id="6072087">.</span><span class="ident" id="6072088">Palette</span>&nbsp;<span class="op" id="6072096">=</span>&nbsp;<span class="ident" id="6072098">d</span><span class="op" id="6072099">.</span><span class="ident" id="6072100">globalColorMap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6072118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6072123">if</span>&nbsp;<span class="ident" id="6072126">d</span><span class="op" id="6072127">.</span><span class="ident" id="6072128">hasTransparentIndex</span>&nbsp;<span class="op" id="6072148">&amp;&amp;</span>&nbsp;<span class="builtintype" id="6072151">int</span><span class="op" id="6072154">(</span><span class="ident" id="6072155">d</span><span class="op" id="6072156">.</span><span class="ident" id="6072157">transparentIndex</span><span class="op" id="6072173">)</span>&nbsp;<span class="op" id="6072175">&lt;</span>&nbsp;<span class="builtinfunc" id="6072177">len</span><span class="op" id="6072180">(</span><span class="ident" id="6072181">m</span><span class="op" id="6072182">.</span><span class="ident" id="6072183">Palette</span><span class="op" id="6072190">)</span>&nbsp;<span class="op" id="6072192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6072198">if</span>&nbsp;<span class="op" id="6072201">!</span><span class="ident" id="6072202">useLocalColorMap</span>&nbsp;<span class="op" id="6072219">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6072226">//&nbsp;Clone&nbsp;the&nbsp;global&nbsp;color&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6072262">m</span><span class="op" id="6072263">.</span><span class="ident" id="6072264">Palette</span>&nbsp;<span class="op" id="6072272">=</span>&nbsp;<span class="builtinfunc" id="6072274">append</span><span class="op" id="6072280">(</span><span class="ident" id="6072281">color</span><span class="op" id="6072286">.</span><span class="ident" id="6072287">Palette</span><span class="op" id="6072294">(</span><span class="builtintype" id="6072295">nil</span><span class="op" id="6072298">)</span><span class="op" id="6072299">,</span>&nbsp;<span class="ident" id="6072301">d</span><span class="op" id="6072302">.</span><span class="ident" id="6072303">globalColorMap</span><span class="op" id="6072317">...</span><span class="op" id="6072320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6072326">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6072332">m</span><span class="op" id="6072333">.</span><span class="ident" id="6072334">Palette</span><span class="op" id="6072341">[</span><span class="ident" id="6072342">d</span><span class="op" id="6072343">.</span><span class="ident" id="6072344">transparentIndex</span><span class="op" id="6072360">]</span>&nbsp;<span class="op" id="6072362">=</span>&nbsp;<span class="ident" id="6072364">color</span><span class="op" id="6072369">.</span><span class="ident" id="6072370">RGBA</span><span class="op" id="6072374">{</span><span class="op" id="6072375">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6072380">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6072385">litWidth</span><span class="op" id="6072393">,</span>&nbsp;<span class="ident" id="6072395">err</span>&nbsp;<span class="op" id="6072399">:=</span>&nbsp;<span class="ident" id="6072402">d</span><span class="op" id="6072403">.</span><span class="ident" id="6072404">r</span><span class="op" id="6072405">.</span><span class="ident" id="6072406">ReadByte</span><span class="op" id="6072414">(</span><span class="op" id="6072415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6072420">if</span>&nbsp;<span class="ident" id="6072423">err</span>&nbsp;<span class="op" id="6072427">!=</span>&nbsp;<span class="builtintype" id="6072430">nil</span>&nbsp;<span class="op" id="6072434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6072440">return</span>&nbsp;<span class="ident" id="6072447">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6072454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6072459">if</span>&nbsp;<span class="ident" id="6072462">litWidth</span>&nbsp;<span class="op" id="6072471">&lt;</span>&nbsp;<span class="num" id="6072473">2</span>&nbsp;<span class="op" id="6072475">||</span>&nbsp;<span class="ident" id="6072478">litWidth</span>&nbsp;<span class="op" id="6072487">&gt;</span>&nbsp;<span class="num" id="6072489">8</span>&nbsp;<span class="op" id="6072491">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6072497">return</span>&nbsp;<span class="ident" id="6072504">fmt</span><span class="op" id="6072507">.</span><span class="ident" id="6072508">Errorf</span><span class="op" id="6072514">(</span><span class="string" id="6072515">&#34;gif:&nbsp;pixel&nbsp;size&nbsp;in&nbsp;decode&nbsp;out&nbsp;of&nbsp;range:&nbsp;%d&#34;</span><span class="op" id="6072559">,</span>&nbsp;<span class="ident" id="6072561">litWidth</span><span class="op" id="6072569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6072574">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6072579">//&nbsp;A&nbsp;wonderfully&nbsp;Go-like&nbsp;piece&nbsp;of&nbsp;magic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6072623">br</span>&nbsp;<span class="op" id="6072626">:=</span>&nbsp;<span class="op" id="6072629">&amp;</span><span class="ident" id="6072630">blockReader</span><span class="op" id="6072641">{</span><span class="ident" id="6072642">r</span><span class="op" id="6072643">:</span>&nbsp;<span class="ident" id="6072645">d</span><span class="op" id="6072646">.</span><span class="ident" id="6072647">r</span><span class="op" id="6072648">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6072653">lzwr</span>&nbsp;<span class="op" id="6072658">:=</span>&nbsp;<span class="ident" id="6072661">lzw</span><span class="op" id="6072664">.</span><span class="ident" id="6072665">NewReader</span><span class="op" id="6072674">(</span><span class="ident" id="6072675">br</span><span class="op" id="6072677">,</span>&nbsp;<span class="ident" id="6072679">lzw</span><span class="op" id="6072682">.</span><span class="ident" id="6072683">LSB</span><span class="op" id="6072686">,</span>&nbsp;<span class="builtintype" id="6072688">int</span><span class="op" id="6072691">(</span><span class="ident" id="6072692">litWidth</span><span class="op" id="6072700">)</span><span class="op" id="6072701">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6072706">defer</span>&nbsp;<span class="ident" id="6072712">lzwr</span><span class="op" id="6072716">.</span><span class="ident" id="6072717">Close</span><span class="op" id="6072722">(</span><span class="op" id="6072723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6072728">if</span>&nbsp;<span class="ident" id="6072731">_</span><span class="op" id="6072732">,</span>&nbsp;<span class="ident" id="6072734">err</span>&nbsp;<span class="op" id="6072738">=</span>&nbsp;<span class="ident" id="6072740">io</span><span class="op" id="6072742">.</span><span class="ident" id="6072743">ReadFull</span><span class="op" id="6072751">(</span><span class="ident" id="6072752">lzwr</span><span class="op" id="6072756">,</span>&nbsp;<span class="ident" id="6072758">m</span><span class="op" id="6072759">.</span><span class="ident" id="6072760">Pix</span><span class="op" id="6072763">)</span><span class="op" id="6072764">;</span>&nbsp;<span class="ident" id="6072766">err</span>&nbsp;<span class="op" id="6072770">!=</span>&nbsp;<span class="builtintype" id="6072773">nil</span>&nbsp;<span class="op" id="6072777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6072783">if</span>&nbsp;<span class="ident" id="6072786">err</span>&nbsp;<span class="op" id="6072790">!=</span>&nbsp;<span class="ident" id="6072793">io</span><span class="op" id="6072795">.</span><span class="ident" id="6072796">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="6072813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6072820">return</span>&nbsp;<span class="ident" id="6072827">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6072835">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6072841">return</span>&nbsp;<span class="ident" id="6072848">errNotEnough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6072864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6072869">//&nbsp;Both&nbsp;lzwr&nbsp;and&nbsp;br&nbsp;should&nbsp;be&nbsp;exhausted.&nbsp;Reading&nbsp;from&nbsp;them</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6072931">//&nbsp;should&nbsp;yield&nbsp;(0,&nbsp;io.EOF).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6072963">if</span>&nbsp;<span class="ident" id="6072966">n</span><span class="op" id="6072967">,</span>&nbsp;<span class="ident" id="6072969">err</span>&nbsp;<span class="op" id="6072973">:=</span>&nbsp;<span class="ident" id="6072976">lzwr</span><span class="op" id="6072980">.</span><span class="ident" id="6072981">Read</span><span class="op" id="6072985">(</span><span class="ident" id="6072986">d</span><span class="op" id="6072987">.</span><span class="ident" id="6072988">tmp</span><span class="op" id="6072991">[</span><span class="op" id="6072992">:</span><span class="num" id="6072993">1</span><span class="op" id="6072994">]</span><span class="op" id="6072995">)</span><span class="op" id="6072996">;</span>&nbsp;<span class="ident" id="6072998">n</span>&nbsp;<span class="op" id="6073000">!=</span>&nbsp;<span class="num" id="6073003">0</span>&nbsp;<span class="op" id="6073005">||</span>&nbsp;<span class="ident" id="6073008">err</span>&nbsp;<span class="op" id="6073012">!=</span>&nbsp;<span class="ident" id="6073015">io</span><span class="op" id="6073017">.</span><span class="ident" id="6073018">EOF</span>&nbsp;<span class="op" id="6073022">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6073028">if</span>&nbsp;<span class="ident" id="6073031">err</span>&nbsp;<span class="op" id="6073035">!=</span>&nbsp;<span class="builtintype" id="6073038">nil</span>&nbsp;<span class="op" id="6073042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6073049">return</span>&nbsp;<span class="ident" id="6073056">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6073064">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6073070">return</span>&nbsp;<span class="ident" id="6073077">errTooMuch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6073091">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6073096">if</span>&nbsp;<span class="ident" id="6073099">n</span><span class="op" id="6073100">,</span>&nbsp;<span class="ident" id="6073102">err</span>&nbsp;<span class="op" id="6073106">:=</span>&nbsp;<span class="ident" id="6073109">br</span><span class="op" id="6073111">.</span><span class="ident" id="6073112">Read</span><span class="op" id="6073116">(</span><span class="ident" id="6073117">d</span><span class="op" id="6073118">.</span><span class="ident" id="6073119">tmp</span><span class="op" id="6073122">[</span><span class="op" id="6073123">:</span><span class="num" id="6073124">1</span><span class="op" id="6073125">]</span><span class="op" id="6073126">)</span><span class="op" id="6073127">;</span>&nbsp;<span class="ident" id="6073129">n</span>&nbsp;<span class="op" id="6073131">!=</span>&nbsp;<span class="num" id="6073134">0</span>&nbsp;<span class="op" id="6073136">||</span>&nbsp;<span class="ident" id="6073139">err</span>&nbsp;<span class="op" id="6073143">!=</span>&nbsp;<span class="ident" id="6073146">io</span><span class="op" id="6073148">.</span><span class="ident" id="6073149">EOF</span>&nbsp;<span class="op" id="6073153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6073159">if</span>&nbsp;<span class="ident" id="6073162">err</span>&nbsp;<span class="op" id="6073166">!=</span>&nbsp;<span class="builtintype" id="6073169">nil</span>&nbsp;<span class="op" id="6073173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6073180">return</span>&nbsp;<span class="ident" id="6073187">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6073195">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6073201">return</span>&nbsp;<span class="ident" id="6073208">errTooMuch</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6073222">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6073228">//&nbsp;Check&nbsp;that&nbsp;the&nbsp;color&nbsp;indexes&nbsp;are&nbsp;inside&nbsp;the&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6073287">if</span>&nbsp;<span class="builtinfunc" id="6073290">len</span><span class="op" id="6073293">(</span><span class="ident" id="6073294">m</span><span class="op" id="6073295">.</span><span class="ident" id="6073296">Palette</span><span class="op" id="6073303">)</span>&nbsp;<span class="op" id="6073305">&lt;</span>&nbsp;<span class="num" id="6073307">256</span>&nbsp;<span class="op" id="6073311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6073317">for</span>&nbsp;<span class="ident" id="6073321">_</span><span class="op" id="6073322">,</span>&nbsp;<span class="ident" id="6073324">pixel</span>&nbsp;<span class="op" id="6073330">:=</span>&nbsp;<span class="keyword" id="6073333">range</span>&nbsp;<span class="ident" id="6073339">m</span><span class="op" id="6073340">.</span><span class="ident" id="6073341">Pix</span>&nbsp;<span class="op" id="6073345">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6073352">if</span>&nbsp;<span class="builtintype" id="6073355">int</span><span class="op" id="6073358">(</span><span class="ident" id="6073359">pixel</span><span class="op" id="6073364">)</span>&nbsp;<span class="op" id="6073366">&gt;=</span>&nbsp;<span class="builtinfunc" id="6073369">len</span><span class="op" id="6073372">(</span><span class="ident" id="6073373">m</span><span class="op" id="6073374">.</span><span class="ident" id="6073375">Palette</span><span class="op" id="6073382">)</span>&nbsp;<span class="op" id="6073384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6073392">return</span>&nbsp;<span class="ident" id="6073399">errBadPixel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6073416">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6073422">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6073427">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6073433">//&nbsp;Undo&nbsp;the&nbsp;interlacing&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6073474">if</span>&nbsp;<span class="ident" id="6073477">d</span><span class="op" id="6073478">.</span><span class="ident" id="6073479">imageFields</span><span class="op" id="6073490">&amp;</span><span class="ident" id="6073491">ifInterlace</span>&nbsp;<span class="op" id="6073503">!=</span>&nbsp;<span class="num" id="6073506">0</span>&nbsp;<span class="op" id="6073508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6073514">uninterlace</span><span class="op" id="6073525">(</span><span class="ident" id="6073526">m</span><span class="op" id="6073527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6073532">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6073538">d</span><span class="op" id="6073539">.</span><span class="ident" id="6073540">image</span>&nbsp;<span class="op" id="6073546">=</span>&nbsp;<span class="builtinfunc" id="6073548">append</span><span class="op" id="6073554">(</span><span class="ident" id="6073555">d</span><span class="op" id="6073556">.</span><span class="ident" id="6073557">image</span><span class="op" id="6073562">,</span>&nbsp;<span class="ident" id="6073564">m</span><span class="op" id="6073565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6073570">d</span><span class="op" id="6073571">.</span><span class="ident" id="6073572">delay</span>&nbsp;<span class="op" id="6073578">=</span>&nbsp;<span class="builtinfunc" id="6073580">append</span><span class="op" id="6073586">(</span><span class="ident" id="6073587">d</span><span class="op" id="6073588">.</span><span class="ident" id="6073589">delay</span><span class="op" id="6073594">,</span>&nbsp;<span class="ident" id="6073596">d</span><span class="op" id="6073597">.</span><span class="ident" id="6073598">delayTime</span><span class="op" id="6073607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6073612">//&nbsp;The&nbsp;GIF89a&nbsp;spec,&nbsp;Section&nbsp;23&nbsp;(Graphic&nbsp;Control&nbsp;Extension)&nbsp;says:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6073680">//&nbsp;&#34;The&nbsp;scope&nbsp;of&nbsp;this&nbsp;extension&nbsp;is&nbsp;the&nbsp;first&nbsp;graphic&nbsp;rendering&nbsp;block</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6073752">//&nbsp;to&nbsp;follow.&#34;&nbsp;We&nbsp;therefore&nbsp;reset&nbsp;the&nbsp;GCE&nbsp;fields&nbsp;to&nbsp;zero.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6073813">d</span><span class="op" id="6073814">.</span><span class="ident" id="6073815">delayTime</span>&nbsp;<span class="op" id="6073825">=</span>&nbsp;<span class="num" id="6073827">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6073832">d</span><span class="op" id="6073833">.</span><span class="ident" id="6073834">hasTransparentIndex</span>&nbsp;<span class="op" id="6073854">=</span>&nbsp;<span class="builtintype" id="6073856">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6073865">case</span>&nbsp;<span class="ident" id="6073870">sTrailer</span><span class="op" id="6073878">:</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6073883">if</span>&nbsp;<span class="builtinfunc" id="6073886">len</span><span class="op" id="6073889">(</span><span class="ident" id="6073890">d</span><span class="op" id="6073891">.</span><span class="ident" id="6073892">image</span><span class="op" id="6073897">)</span>&nbsp;<span class="op" id="6073899">==</span>&nbsp;<span class="num" id="6073902">0</span>&nbsp;<span class="op" id="6073904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6073910">return</span>&nbsp;<span class="ident" id="6073917">io</span><span class="op" id="6073919">.</span><span class="ident" id="6073920">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6073940">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6073945">return</span>&nbsp;<span class="builtintype" id="6073952">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6073959">default</span><span class="op" id="6073966">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6073971">return</span>&nbsp;<span class="ident" id="6073978">fmt</span><span class="op" id="6073981">.</span><span class="ident" id="6073982">Errorf</span><span class="op" id="6073988">(</span><span class="string" id="6073989">&#34;gif:&nbsp;unknown&nbsp;block&nbsp;type:&nbsp;0x%.2x&#34;</span><span class="op" id="6074022">,</span>&nbsp;<span class="ident" id="6074024">c</span><span class="op" id="6074025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6074029">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6074032">}</span><br>
<span class="lineno"></span><span class="op" id="6074034">}</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span><span class="keyword" id="6074037">func</span>&nbsp;<span class="op" id="6074042">(</span><span class="ident" id="6074043">d</span>&nbsp;<span class="op" id="6074045">*</span><span class="ident" id="6074046">decoder</span><span class="op" id="6074053">)</span>&nbsp;<span class="ident" id="6074055">readHeaderAndScreenDescriptor</span><span class="op" id="6074084">(</span><span class="op" id="6074085">)</span>&nbsp;<span class="builtintype" id="6074087">error</span>&nbsp;<span class="op" id="6074093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6074096">_</span><span class="op" id="6074097">,</span>&nbsp;<span class="ident" id="6074099">err</span>&nbsp;<span class="op" id="6074103">:=</span>&nbsp;<span class="ident" id="6074106">io</span><span class="op" id="6074108">.</span><span class="ident" id="6074109">ReadFull</span><span class="op" id="6074117">(</span><span class="ident" id="6074118">d</span><span class="op" id="6074119">.</span><span class="ident" id="6074120">r</span><span class="op" id="6074121">,</span>&nbsp;<span class="ident" id="6074123">d</span><span class="op" id="6074124">.</span><span class="ident" id="6074125">tmp</span><span class="op" id="6074128">[</span><span class="num" id="6074129">0</span><span class="op" id="6074130">:</span><span class="num" id="6074131">13</span><span class="op" id="6074133">]</span><span class="op" id="6074134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6074137">if</span>&nbsp;<span class="ident" id="6074140">err</span>&nbsp;<span class="op" id="6074144">!=</span>&nbsp;<span class="builtintype" id="6074147">nil</span>&nbsp;<span class="op" id="6074151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6074155">return</span>&nbsp;<span class="ident" id="6074162">err</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6074167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6074170">d</span><span class="op" id="6074171">.</span><span class="ident" id="6074172">vers</span>&nbsp;<span class="op" id="6074177">=</span>&nbsp;<span class="builtintype" id="6074179">string</span><span class="op" id="6074185">(</span><span class="ident" id="6074186">d</span><span class="op" id="6074187">.</span><span class="ident" id="6074188">tmp</span><span class="op" id="6074191">[</span><span class="num" id="6074192">0</span><span class="op" id="6074193">:</span><span class="num" id="6074194">6</span><span class="op" id="6074195">]</span><span class="op" id="6074196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6074199">if</span>&nbsp;<span class="ident" id="6074202">d</span><span class="op" id="6074203">.</span><span class="ident" id="6074204">vers</span>&nbsp;<span class="op" id="6074209">!=</span>&nbsp;<span class="string" id="6074212">&#34;GIF87a&#34;</span>&nbsp;<span class="op" id="6074221">&amp;&amp;</span>&nbsp;<span class="ident" id="6074224">d</span><span class="op" id="6074225">.</span><span class="ident" id="6074226">vers</span>&nbsp;<span class="op" id="6074231">!=</span>&nbsp;<span class="string" id="6074234">&#34;GIF89a&#34;</span>&nbsp;<span class="op" id="6074243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6074247">return</span>&nbsp;<span class="ident" id="6074254">fmt</span><span class="op" id="6074257">.</span><span class="ident" id="6074258">Errorf</span><span class="op" id="6074264">(</span><span class="string" id="6074265">&#34;gif:&nbsp;can&#39;t&nbsp;recognize&nbsp;format&nbsp;%s&#34;</span><span class="op" id="6074297">,</span>&nbsp;<span class="ident" id="6074299">d</span><span class="op" id="6074300">.</span><span class="ident" id="6074301">vers</span><span class="op" id="6074305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6074308">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6074311">d</span><span class="op" id="6074312">.</span><span class="ident" id="6074313">width</span>&nbsp;<span class="op" id="6074319">=</span>&nbsp;<span class="builtintype" id="6074321">int</span><span class="op" id="6074324">(</span><span class="ident" id="6074325">d</span><span class="op" id="6074326">.</span><span class="ident" id="6074327">tmp</span><span class="op" id="6074330">[</span><span class="num" id="6074331">6</span><span class="op" id="6074332">]</span><span class="op" id="6074333">)</span>&nbsp;<span class="op" id="6074335">+</span>&nbsp;<span class="builtintype" id="6074337">int</span><span class="op" id="6074340">(</span><span class="ident" id="6074341">d</span><span class="op" id="6074342">.</span><span class="ident" id="6074343">tmp</span><span class="op" id="6074346">[</span><span class="num" id="6074347">7</span><span class="op" id="6074348">]</span><span class="op" id="6074349">)</span><span class="op" id="6074350">&lt;&lt;</span><span class="num" id="6074352">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6074355">d</span><span class="op" id="6074356">.</span><span class="ident" id="6074357">height</span>&nbsp;<span class="op" id="6074364">=</span>&nbsp;<span class="builtintype" id="6074366">int</span><span class="op" id="6074369">(</span><span class="ident" id="6074370">d</span><span class="op" id="6074371">.</span><span class="ident" id="6074372">tmp</span><span class="op" id="6074375">[</span><span class="num" id="6074376">8</span><span class="op" id="6074377">]</span><span class="op" id="6074378">)</span>&nbsp;<span class="op" id="6074380">+</span>&nbsp;<span class="builtintype" id="6074382">int</span><span class="op" id="6074385">(</span><span class="ident" id="6074386">d</span><span class="op" id="6074387">.</span><span class="ident" id="6074388">tmp</span><span class="op" id="6074391">[</span><span class="num" id="6074392">9</span><span class="op" id="6074393">]</span><span class="op" id="6074394">)</span><span class="op" id="6074395">&lt;&lt;</span><span class="num" id="6074397">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6074400">d</span><span class="op" id="6074401">.</span><span class="ident" id="6074402">headerFields</span>&nbsp;<span class="op" id="6074415">=</span>&nbsp;<span class="ident" id="6074417">d</span><span class="op" id="6074418">.</span><span class="ident" id="6074419">tmp</span><span class="op" id="6074422">[</span><span class="num" id="6074423">10</span><span class="op" id="6074425">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6074428">d</span><span class="op" id="6074429">.</span><span class="ident" id="6074430">backgroundIndex</span>&nbsp;<span class="op" id="6074446">=</span>&nbsp;<span class="ident" id="6074448">d</span><span class="op" id="6074449">.</span><span class="ident" id="6074450">tmp</span><span class="op" id="6074453">[</span><span class="num" id="6074454">11</span><span class="op" id="6074456">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6074459">d</span><span class="op" id="6074460">.</span><span class="ident" id="6074461">aspect</span>&nbsp;<span class="op" id="6074468">=</span>&nbsp;<span class="ident" id="6074470">d</span><span class="op" id="6074471">.</span><span class="ident" id="6074472">tmp</span><span class="op" id="6074475">[</span><span class="num" id="6074476">12</span><span class="op" id="6074478">]</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6074481">d</span><span class="op" id="6074482">.</span><span class="ident" id="6074483">loopCount</span>&nbsp;<span class="op" id="6074493">=</span>&nbsp;<span class="op" id="6074495">-</span><span class="num" id="6074496">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6074499">d</span><span class="op" id="6074500">.</span><span class="ident" id="6074501">pixelSize</span>&nbsp;<span class="op" id="6074511">=</span>&nbsp;<span class="builtintype" id="6074513">uint</span><span class="op" id="6074517">(</span><span class="ident" id="6074518">d</span><span class="op" id="6074519">.</span><span class="ident" id="6074520">headerFields</span><span class="op" id="6074532">&amp;</span><span class="num" id="6074533">7</span><span class="op" id="6074534">)</span>&nbsp;<span class="op" id="6074536">+</span>&nbsp;<span class="num" id="6074538">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6074541">return</span>&nbsp;<span class="builtintype" id="6074548">nil</span><br>
<span class="lineno"></span><span class="op" id="6074552">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span><span class="keyword" id="6074555">func</span>&nbsp;<span class="op" id="6074560">(</span><span class="ident" id="6074561">d</span>&nbsp;<span class="op" id="6074563">*</span><span class="ident" id="6074564">decoder</span><span class="op" id="6074571">)</span>&nbsp;<span class="ident" id="6074573">readColorMap</span><span class="op" id="6074585">(</span><span class="op" id="6074586">)</span>&nbsp;<span class="op" id="6074588">(</span><span class="ident" id="6074589">color</span><span class="op" id="6074594">.</span><span class="ident" id="6074595">Palette</span><span class="op" id="6074602">,</span>&nbsp;<span class="builtintype" id="6074604">error</span><span class="op" id="6074609">)</span>&nbsp;<span class="op" id="6074611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6074614">if</span>&nbsp;<span class="ident" id="6074617">d</span><span class="op" id="6074618">.</span><span class="ident" id="6074619">pixelSize</span>&nbsp;<span class="op" id="6074629">&gt;</span>&nbsp;<span class="num" id="6074631">8</span>&nbsp;<span class="op" id="6074633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6074637">return</span>&nbsp;<span class="builtintype" id="6074644">nil</span><span class="op" id="6074647">,</span>&nbsp;<span class="ident" id="6074649">fmt</span><span class="op" id="6074652">.</span><span class="ident" id="6074653">Errorf</span><span class="op" id="6074659">(</span><span class="string" id="6074660">&#34;gif:&nbsp;can&#39;t&nbsp;handle&nbsp;%d&nbsp;bits&nbsp;per&nbsp;pixel&#34;</span><span class="op" id="6074697">,</span>&nbsp;<span class="ident" id="6074699">d</span><span class="op" id="6074700">.</span><span class="ident" id="6074701">pixelSize</span><span class="op" id="6074710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6074713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6074716">numColors</span>&nbsp;<span class="op" id="6074726">:=</span>&nbsp;<span class="num" id="6074729">1</span>&nbsp;<span class="op" id="6074731">&lt;&lt;</span>&nbsp;<span class="ident" id="6074734">d</span><span class="op" id="6074735">.</span><span class="ident" id="6074736">pixelSize</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6074747">if</span>&nbsp;<span class="ident" id="6074750">d</span><span class="op" id="6074751">.</span><span class="ident" id="6074752">imageFields</span><span class="op" id="6074763">&amp;</span><span class="ident" id="6074764">ifLocalColorTable</span>&nbsp;<span class="op" id="6074782">!=</span>&nbsp;<span class="num" id="6074785">0</span>&nbsp;<span class="op" id="6074787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6074791">numColors</span>&nbsp;<span class="op" id="6074801">=</span>&nbsp;<span class="num" id="6074803">1</span>&nbsp;<span class="op" id="6074805">&lt;&lt;</span>&nbsp;<span class="op" id="6074808">(</span><span class="op" id="6074809">(</span><span class="ident" id="6074810">d</span><span class="op" id="6074811">.</span><span class="ident" id="6074812">imageFields</span>&nbsp;<span class="op" id="6074824">&amp;</span>&nbsp;<span class="ident" id="6074826">ifPixelSizeMask</span><span class="op" id="6074841">)</span>&nbsp;<span class="op" id="6074843">+</span>&nbsp;<span class="num" id="6074845">1</span><span class="op" id="6074846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6074849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6074852">numValues</span>&nbsp;<span class="op" id="6074862">:=</span>&nbsp;<span class="num" id="6074865">3</span>&nbsp;<span class="op" id="6074867">*</span>&nbsp;<span class="ident" id="6074869">numColors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6074880">_</span><span class="op" id="6074881">,</span>&nbsp;<span class="ident" id="6074883">err</span>&nbsp;<span class="op" id="6074887">:=</span>&nbsp;<span class="ident" id="6074890">io</span><span class="op" id="6074892">.</span><span class="ident" id="6074893">ReadFull</span><span class="op" id="6074901">(</span><span class="ident" id="6074902">d</span><span class="op" id="6074903">.</span><span class="ident" id="6074904">r</span><span class="op" id="6074905">,</span>&nbsp;<span class="ident" id="6074907">d</span><span class="op" id="6074908">.</span><span class="ident" id="6074909">tmp</span><span class="op" id="6074912">[</span><span class="num" id="6074913">0</span><span class="op" id="6074914">:</span><span class="ident" id="6074915">numValues</span><span class="op" id="6074924">]</span><span class="op" id="6074925">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6074928">if</span>&nbsp;<span class="ident" id="6074931">err</span>&nbsp;<span class="op" id="6074935">!=</span>&nbsp;<span class="builtintype" id="6074938">nil</span>&nbsp;<span class="op" id="6074942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6074946">return</span>&nbsp;<span class="builtintype" id="6074953">nil</span><span class="op" id="6074956">,</span>&nbsp;<span class="ident" id="6074958">fmt</span><span class="op" id="6074961">.</span><span class="ident" id="6074962">Errorf</span><span class="op" id="6074968">(</span><span class="string" id="6074969">&#34;gif:&nbsp;short&nbsp;read&nbsp;on&nbsp;color&nbsp;map:&nbsp;%s&#34;</span><span class="op" id="6075003">,</span>&nbsp;<span class="ident" id="6075005">err</span><span class="op" id="6075008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6075011">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6075014">colorMap</span>&nbsp;<span class="op" id="6075023">:=</span>&nbsp;<span class="builtinfunc" id="6075026">make</span><span class="op" id="6075030">(</span><span class="ident" id="6075031">color</span><span class="op" id="6075036">.</span><span class="ident" id="6075037">Palette</span><span class="op" id="6075044">,</span>&nbsp;<span class="ident" id="6075046">numColors</span><span class="op" id="6075055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6075058">j</span>&nbsp;<span class="op" id="6075060">:=</span>&nbsp;<span class="num" id="6075063">0</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6075066">for</span>&nbsp;<span class="ident" id="6075070">i</span>&nbsp;<span class="op" id="6075072">:=</span>&nbsp;<span class="keyword" id="6075075">range</span>&nbsp;<span class="ident" id="6075081">colorMap</span>&nbsp;<span class="op" id="6075090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6075094">colorMap</span><span class="op" id="6075102">[</span><span class="ident" id="6075103">i</span><span class="op" id="6075104">]</span>&nbsp;<span class="op" id="6075106">=</span>&nbsp;<span class="ident" id="6075108">color</span><span class="op" id="6075113">.</span><span class="ident" id="6075114">RGBA</span><span class="op" id="6075118">{</span><span class="ident" id="6075119">d</span><span class="op" id="6075120">.</span><span class="ident" id="6075121">tmp</span><span class="op" id="6075124">[</span><span class="ident" id="6075125">j</span><span class="op" id="6075126">+</span><span class="num" id="6075127">0</span><span class="op" id="6075128">]</span><span class="op" id="6075129">,</span>&nbsp;<span class="ident" id="6075131">d</span><span class="op" id="6075132">.</span><span class="ident" id="6075133">tmp</span><span class="op" id="6075136">[</span><span class="ident" id="6075137">j</span><span class="op" id="6075138">+</span><span class="num" id="6075139">1</span><span class="op" id="6075140">]</span><span class="op" id="6075141">,</span>&nbsp;<span class="ident" id="6075143">d</span><span class="op" id="6075144">.</span><span class="ident" id="6075145">tmp</span><span class="op" id="6075148">[</span><span class="ident" id="6075149">j</span><span class="op" id="6075150">+</span><span class="num" id="6075151">2</span><span class="op" id="6075152">]</span><span class="op" id="6075153">,</span>&nbsp;<span class="num" id="6075155">0xFF</span><span class="op" id="6075159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6075163">j</span>&nbsp;<span class="op" id="6075165">+=</span>&nbsp;<span class="num" id="6075168">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6075171">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6075174">return</span>&nbsp;<span class="ident" id="6075181">colorMap</span><span class="op" id="6075189">,</span>&nbsp;<span class="builtintype" id="6075191">nil</span><br>
<span class="lineno">295</span><span class="op" id="6075195">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6075198">func</span>&nbsp;<span class="op" id="6075203">(</span><span class="ident" id="6075204">d</span>&nbsp;<span class="op" id="6075206">*</span><span class="ident" id="6075207">decoder</span><span class="op" id="6075214">)</span>&nbsp;<span class="ident" id="6075216">readExtension</span><span class="op" id="6075229">(</span><span class="op" id="6075230">)</span>&nbsp;<span class="builtintype" id="6075232">error</span>&nbsp;<span class="op" id="6075238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6075241">extension</span><span class="op" id="6075250">,</span>&nbsp;<span class="ident" id="6075252">err</span>&nbsp;<span class="op" id="6075256">:=</span>&nbsp;<span class="ident" id="6075259">d</span><span class="op" id="6075260">.</span><span class="ident" id="6075261">r</span><span class="op" id="6075262">.</span><span class="ident" id="6075263">ReadByte</span><span class="op" id="6075271">(</span><span class="op" id="6075272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6075275">if</span>&nbsp;<span class="ident" id="6075278">err</span>&nbsp;<span class="op" id="6075282">!=</span>&nbsp;<span class="builtintype" id="6075285">nil</span>&nbsp;<span class="op" id="6075289">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6075293">return</span>&nbsp;<span class="ident" id="6075300">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6075305">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6075308">size</span>&nbsp;<span class="op" id="6075313">:=</span>&nbsp;<span class="num" id="6075316">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6075319">switch</span>&nbsp;<span class="ident" id="6075326">extension</span>&nbsp;<span class="op" id="6075336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6075339">case</span>&nbsp;<span class="ident" id="6075344">eText</span><span class="op" id="6075349">:</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6075353">size</span>&nbsp;<span class="op" id="6075358">=</span>&nbsp;<span class="num" id="6075360">13</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6075364">case</span>&nbsp;<span class="ident" id="6075369">eGraphicControl</span><span class="op" id="6075384">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6075388">return</span>&nbsp;<span class="ident" id="6075395">d</span><span class="op" id="6075396">.</span><span class="ident" id="6075397">readGraphicControl</span><span class="op" id="6075415">(</span><span class="op" id="6075416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6075419">case</span>&nbsp;<span class="ident" id="6075424">eComment</span><span class="op" id="6075432">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6075436">//&nbsp;nothing&nbsp;to&nbsp;do&nbsp;but&nbsp;read&nbsp;the&nbsp;data.</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6075473">case</span>&nbsp;<span class="ident" id="6075478">eApplication</span><span class="op" id="6075490">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6075494">b</span><span class="op" id="6075495">,</span>&nbsp;<span class="ident" id="6075497">err</span>&nbsp;<span class="op" id="6075501">:=</span>&nbsp;<span class="ident" id="6075504">d</span><span class="op" id="6075505">.</span><span class="ident" id="6075506">r</span><span class="op" id="6075507">.</span><span class="ident" id="6075508">ReadByte</span><span class="op" id="6075516">(</span><span class="op" id="6075517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6075521">if</span>&nbsp;<span class="ident" id="6075524">err</span>&nbsp;<span class="op" id="6075528">!=</span>&nbsp;<span class="builtintype" id="6075531">nil</span>&nbsp;<span class="op" id="6075535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6075540">return</span>&nbsp;<span class="ident" id="6075547">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6075553">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6075557">//&nbsp;The&nbsp;spec&nbsp;requires&nbsp;size&nbsp;be&nbsp;11,&nbsp;but&nbsp;Adobe&nbsp;sometimes&nbsp;uses&nbsp;10.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6075621">size</span>&nbsp;<span class="op" id="6075626">=</span>&nbsp;<span class="builtintype" id="6075628">int</span><span class="op" id="6075631">(</span><span class="ident" id="6075632">b</span><span class="op" id="6075633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6075636">default</span><span class="op" id="6075643">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6075647">return</span>&nbsp;<span class="ident" id="6075654">fmt</span><span class="op" id="6075657">.</span><span class="ident" id="6075658">Errorf</span><span class="op" id="6075664">(</span><span class="string" id="6075665">&#34;gif:&nbsp;unknown&nbsp;extension&nbsp;0x%.2x&#34;</span><span class="op" id="6075696">,</span>&nbsp;<span class="ident" id="6075698">extension</span><span class="op" id="6075707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6075710">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6075713">if</span>&nbsp;<span class="ident" id="6075716">size</span>&nbsp;<span class="op" id="6075721">&gt;</span>&nbsp;<span class="num" id="6075723">0</span>&nbsp;<span class="op" id="6075725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6075729">if</span>&nbsp;<span class="ident" id="6075732">_</span><span class="op" id="6075733">,</span>&nbsp;<span class="ident" id="6075735">err</span>&nbsp;<span class="op" id="6075739">:=</span>&nbsp;<span class="ident" id="6075742">io</span><span class="op" id="6075744">.</span><span class="ident" id="6075745">ReadFull</span><span class="op" id="6075753">(</span><span class="ident" id="6075754">d</span><span class="op" id="6075755">.</span><span class="ident" id="6075756">r</span><span class="op" id="6075757">,</span>&nbsp;<span class="ident" id="6075759">d</span><span class="op" id="6075760">.</span><span class="ident" id="6075761">tmp</span><span class="op" id="6075764">[</span><span class="num" id="6075765">0</span><span class="op" id="6075766">:</span><span class="ident" id="6075767">size</span><span class="op" id="6075771">]</span><span class="op" id="6075772">)</span><span class="op" id="6075773">;</span>&nbsp;<span class="ident" id="6075775">err</span>&nbsp;<span class="op" id="6075779">!=</span>&nbsp;<span class="builtintype" id="6075782">nil</span>&nbsp;<span class="op" id="6075786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6075791">return</span>&nbsp;<span class="ident" id="6075798">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6075804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6075807">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6075811">//&nbsp;Application&nbsp;Extension&nbsp;with&nbsp;&#34;NETSCAPE2.0&#34;&nbsp;as&nbsp;string&nbsp;and&nbsp;1&nbsp;in&nbsp;data&nbsp;means</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6075886">//&nbsp;this&nbsp;extension&nbsp;defines&nbsp;a&nbsp;loop&nbsp;count.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6075927">if</span>&nbsp;<span class="ident" id="6075930">extension</span>&nbsp;<span class="op" id="6075940">==</span>&nbsp;<span class="ident" id="6075943">eApplication</span>&nbsp;<span class="op" id="6075956">&amp;&amp;</span>&nbsp;<span class="builtintype" id="6075959">string</span><span class="op" id="6075965">(</span><span class="ident" id="6075966">d</span><span class="op" id="6075967">.</span><span class="ident" id="6075968">tmp</span><span class="op" id="6075971">[</span><span class="op" id="6075972">:</span><span class="ident" id="6075973">size</span><span class="op" id="6075977">]</span><span class="op" id="6075978">)</span>&nbsp;<span class="op" id="6075980">==</span>&nbsp;<span class="string" id="6075983">&#34;NETSCAPE2.0&#34;</span>&nbsp;<span class="op" id="6075997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6076001">n</span><span class="op" id="6076002">,</span>&nbsp;<span class="ident" id="6076004">err</span>&nbsp;<span class="op" id="6076008">:=</span>&nbsp;<span class="ident" id="6076011">d</span><span class="op" id="6076012">.</span><span class="ident" id="6076013">readBlock</span><span class="op" id="6076022">(</span><span class="op" id="6076023">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6076027">if</span>&nbsp;<span class="ident" id="6076030">n</span>&nbsp;<span class="op" id="6076032">==</span>&nbsp;<span class="num" id="6076035">0</span>&nbsp;<span class="op" id="6076037">||</span>&nbsp;<span class="ident" id="6076040">err</span>&nbsp;<span class="op" id="6076044">!=</span>&nbsp;<span class="builtintype" id="6076047">nil</span>&nbsp;<span class="op" id="6076051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6076056">return</span>&nbsp;<span class="ident" id="6076063">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6076069">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6076073">if</span>&nbsp;<span class="ident" id="6076076">n</span>&nbsp;<span class="op" id="6076078">==</span>&nbsp;<span class="num" id="6076081">3</span>&nbsp;<span class="op" id="6076083">&amp;&amp;</span>&nbsp;<span class="ident" id="6076086">d</span><span class="op" id="6076087">.</span><span class="ident" id="6076088">tmp</span><span class="op" id="6076091">[</span><span class="num" id="6076092">0</span><span class="op" id="6076093">]</span>&nbsp;<span class="op" id="6076095">==</span>&nbsp;<span class="num" id="6076098">1</span>&nbsp;<span class="op" id="6076100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6076105">d</span><span class="op" id="6076106">.</span><span class="ident" id="6076107">loopCount</span>&nbsp;<span class="op" id="6076117">=</span>&nbsp;<span class="builtintype" id="6076119">int</span><span class="op" id="6076122">(</span><span class="ident" id="6076123">d</span><span class="op" id="6076124">.</span><span class="ident" id="6076125">tmp</span><span class="op" id="6076128">[</span><span class="num" id="6076129">1</span><span class="op" id="6076130">]</span><span class="op" id="6076131">)</span>&nbsp;<span class="op" id="6076133">|</span>&nbsp;<span class="builtintype" id="6076135">int</span><span class="op" id="6076138">(</span><span class="ident" id="6076139">d</span><span class="op" id="6076140">.</span><span class="ident" id="6076141">tmp</span><span class="op" id="6076144">[</span><span class="num" id="6076145">2</span><span class="op" id="6076146">]</span><span class="op" id="6076147">)</span><span class="op" id="6076148">&lt;&lt;</span><span class="num" id="6076150">8</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6076154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6076157">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6076160">for</span>&nbsp;<span class="op" id="6076164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6076168">n</span><span class="op" id="6076169">,</span>&nbsp;<span class="ident" id="6076171">err</span>&nbsp;<span class="op" id="6076175">:=</span>&nbsp;<span class="ident" id="6076178">d</span><span class="op" id="6076179">.</span><span class="ident" id="6076180">readBlock</span><span class="op" id="6076189">(</span><span class="op" id="6076190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6076194">if</span>&nbsp;<span class="ident" id="6076197">n</span>&nbsp;<span class="op" id="6076199">==</span>&nbsp;<span class="num" id="6076202">0</span>&nbsp;<span class="op" id="6076204">||</span>&nbsp;<span class="ident" id="6076207">err</span>&nbsp;<span class="op" id="6076211">!=</span>&nbsp;<span class="builtintype" id="6076214">nil</span>&nbsp;<span class="op" id="6076218">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6076223">return</span>&nbsp;<span class="ident" id="6076230">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6076236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6076239">}</span><br>
<span class="lineno"></span><span class="op" id="6076241">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span><span class="keyword" id="6076244">func</span>&nbsp;<span class="op" id="6076249">(</span><span class="ident" id="6076250">d</span>&nbsp;<span class="op" id="6076252">*</span><span class="ident" id="6076253">decoder</span><span class="op" id="6076260">)</span>&nbsp;<span class="ident" id="6076262">readGraphicControl</span><span class="op" id="6076280">(</span><span class="op" id="6076281">)</span>&nbsp;<span class="builtintype" id="6076283">error</span>&nbsp;<span class="op" id="6076289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6076292">if</span>&nbsp;<span class="ident" id="6076295">_</span><span class="op" id="6076296">,</span>&nbsp;<span class="ident" id="6076298">err</span>&nbsp;<span class="op" id="6076302">:=</span>&nbsp;<span class="ident" id="6076305">io</span><span class="op" id="6076307">.</span><span class="ident" id="6076308">ReadFull</span><span class="op" id="6076316">(</span><span class="ident" id="6076317">d</span><span class="op" id="6076318">.</span><span class="ident" id="6076319">r</span><span class="op" id="6076320">,</span>&nbsp;<span class="ident" id="6076322">d</span><span class="op" id="6076323">.</span><span class="ident" id="6076324">tmp</span><span class="op" id="6076327">[</span><span class="num" id="6076328">0</span><span class="op" id="6076329">:</span><span class="num" id="6076330">6</span><span class="op" id="6076331">]</span><span class="op" id="6076332">)</span><span class="op" id="6076333">;</span>&nbsp;<span class="ident" id="6076335">err</span>&nbsp;<span class="op" id="6076339">!=</span>&nbsp;<span class="builtintype" id="6076342">nil</span>&nbsp;<span class="op" id="6076346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6076350">return</span>&nbsp;<span class="ident" id="6076357">fmt</span><span class="op" id="6076360">.</span><span class="ident" id="6076361">Errorf</span><span class="op" id="6076367">(</span><span class="string" id="6076368">&#34;gif:&nbsp;can&#39;t&nbsp;read&nbsp;graphic&nbsp;control:&nbsp;%s&#34;</span><span class="op" id="6076405">,</span>&nbsp;<span class="ident" id="6076407">err</span><span class="op" id="6076410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6076413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6076416">d</span><span class="op" id="6076417">.</span><span class="ident" id="6076418">flags</span>&nbsp;<span class="op" id="6076424">=</span>&nbsp;<span class="ident" id="6076426">d</span><span class="op" id="6076427">.</span><span class="ident" id="6076428">tmp</span><span class="op" id="6076431">[</span><span class="num" id="6076432">1</span><span class="op" id="6076433">]</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6076436">d</span><span class="op" id="6076437">.</span><span class="ident" id="6076438">delayTime</span>&nbsp;<span class="op" id="6076448">=</span>&nbsp;<span class="builtintype" id="6076450">int</span><span class="op" id="6076453">(</span><span class="ident" id="6076454">d</span><span class="op" id="6076455">.</span><span class="ident" id="6076456">tmp</span><span class="op" id="6076459">[</span><span class="num" id="6076460">2</span><span class="op" id="6076461">]</span><span class="op" id="6076462">)</span>&nbsp;<span class="op" id="6076464">|</span>&nbsp;<span class="builtintype" id="6076466">int</span><span class="op" id="6076469">(</span><span class="ident" id="6076470">d</span><span class="op" id="6076471">.</span><span class="ident" id="6076472">tmp</span><span class="op" id="6076475">[</span><span class="num" id="6076476">3</span><span class="op" id="6076477">]</span><span class="op" id="6076478">)</span><span class="op" id="6076479">&lt;&lt;</span><span class="num" id="6076481">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6076484">if</span>&nbsp;<span class="ident" id="6076487">d</span><span class="op" id="6076488">.</span><span class="ident" id="6076489">flags</span><span class="op" id="6076494">&amp;</span><span class="ident" id="6076495">gcTransparentColorSet</span>&nbsp;<span class="op" id="6076517">!=</span>&nbsp;<span class="num" id="6076520">0</span>&nbsp;<span class="op" id="6076522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6076526">d</span><span class="op" id="6076527">.</span><span class="ident" id="6076528">transparentIndex</span>&nbsp;<span class="op" id="6076545">=</span>&nbsp;<span class="ident" id="6076547">d</span><span class="op" id="6076548">.</span><span class="ident" id="6076549">tmp</span><span class="op" id="6076552">[</span><span class="num" id="6076553">4</span><span class="op" id="6076554">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6076558">d</span><span class="op" id="6076559">.</span><span class="ident" id="6076560">hasTransparentIndex</span>&nbsp;<span class="op" id="6076580">=</span>&nbsp;<span class="builtintype" id="6076582">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6076588">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6076591">return</span>&nbsp;<span class="builtintype" id="6076598">nil</span><br>
<span class="lineno"></span><span class="op" id="6076602">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6076605">func</span>&nbsp;<span class="op" id="6076610">(</span><span class="ident" id="6076611">d</span>&nbsp;<span class="op" id="6076613">*</span><span class="ident" id="6076614">decoder</span><span class="op" id="6076621">)</span>&nbsp;<span class="ident" id="6076623">newImageFromDescriptor</span><span class="op" id="6076645">(</span><span class="op" id="6076646">)</span>&nbsp;<span class="op" id="6076648">(</span><span class="op" id="6076649">*</span><span class="ident" id="6076650">image</span><span class="op" id="6076655">.</span><span class="ident" id="6076656">Paletted</span><span class="op" id="6076664">,</span>&nbsp;<span class="builtintype" id="6076666">error</span><span class="op" id="6076671">)</span>&nbsp;<span class="op" id="6076673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6076676">if</span>&nbsp;<span class="ident" id="6076679">_</span><span class="op" id="6076680">,</span>&nbsp;<span class="ident" id="6076682">err</span>&nbsp;<span class="op" id="6076686">:=</span>&nbsp;<span class="ident" id="6076689">io</span><span class="op" id="6076691">.</span><span class="ident" id="6076692">ReadFull</span><span class="op" id="6076700">(</span><span class="ident" id="6076701">d</span><span class="op" id="6076702">.</span><span class="ident" id="6076703">r</span><span class="op" id="6076704">,</span>&nbsp;<span class="ident" id="6076706">d</span><span class="op" id="6076707">.</span><span class="ident" id="6076708">tmp</span><span class="op" id="6076711">[</span><span class="num" id="6076712">0</span><span class="op" id="6076713">:</span><span class="num" id="6076714">9</span><span class="op" id="6076715">]</span><span class="op" id="6076716">)</span><span class="op" id="6076717">;</span>&nbsp;<span class="ident" id="6076719">err</span>&nbsp;<span class="op" id="6076723">!=</span>&nbsp;<span class="builtintype" id="6076726">nil</span>&nbsp;<span class="op" id="6076730">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6076734">return</span>&nbsp;<span class="builtintype" id="6076741">nil</span><span class="op" id="6076744">,</span>&nbsp;<span class="ident" id="6076746">fmt</span><span class="op" id="6076749">.</span><span class="ident" id="6076750">Errorf</span><span class="op" id="6076756">(</span><span class="string" id="6076757">&#34;gif:&nbsp;can&#39;t&nbsp;read&nbsp;image&nbsp;descriptor:&nbsp;%s&#34;</span><span class="op" id="6076795">,</span>&nbsp;<span class="ident" id="6076797">err</span><span class="op" id="6076800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6076803">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6076806">left</span>&nbsp;<span class="op" id="6076811">:=</span>&nbsp;<span class="builtintype" id="6076814">int</span><span class="op" id="6076817">(</span><span class="ident" id="6076818">d</span><span class="op" id="6076819">.</span><span class="ident" id="6076820">tmp</span><span class="op" id="6076823">[</span><span class="num" id="6076824">0</span><span class="op" id="6076825">]</span><span class="op" id="6076826">)</span>&nbsp;<span class="op" id="6076828">+</span>&nbsp;<span class="builtintype" id="6076830">int</span><span class="op" id="6076833">(</span><span class="ident" id="6076834">d</span><span class="op" id="6076835">.</span><span class="ident" id="6076836">tmp</span><span class="op" id="6076839">[</span><span class="num" id="6076840">1</span><span class="op" id="6076841">]</span><span class="op" id="6076842">)</span><span class="op" id="6076843">&lt;&lt;</span><span class="num" id="6076845">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6076848">top</span>&nbsp;<span class="op" id="6076852">:=</span>&nbsp;<span class="builtintype" id="6076855">int</span><span class="op" id="6076858">(</span><span class="ident" id="6076859">d</span><span class="op" id="6076860">.</span><span class="ident" id="6076861">tmp</span><span class="op" id="6076864">[</span><span class="num" id="6076865">2</span><span class="op" id="6076866">]</span><span class="op" id="6076867">)</span>&nbsp;<span class="op" id="6076869">+</span>&nbsp;<span class="builtintype" id="6076871">int</span><span class="op" id="6076874">(</span><span class="ident" id="6076875">d</span><span class="op" id="6076876">.</span><span class="ident" id="6076877">tmp</span><span class="op" id="6076880">[</span><span class="num" id="6076881">3</span><span class="op" id="6076882">]</span><span class="op" id="6076883">)</span><span class="op" id="6076884">&lt;&lt;</span><span class="num" id="6076886">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6076889">width</span>&nbsp;<span class="op" id="6076895">:=</span>&nbsp;<span class="builtintype" id="6076898">int</span><span class="op" id="6076901">(</span><span class="ident" id="6076902">d</span><span class="op" id="6076903">.</span><span class="ident" id="6076904">tmp</span><span class="op" id="6076907">[</span><span class="num" id="6076908">4</span><span class="op" id="6076909">]</span><span class="op" id="6076910">)</span>&nbsp;<span class="op" id="6076912">+</span>&nbsp;<span class="builtintype" id="6076914">int</span><span class="op" id="6076917">(</span><span class="ident" id="6076918">d</span><span class="op" id="6076919">.</span><span class="ident" id="6076920">tmp</span><span class="op" id="6076923">[</span><span class="num" id="6076924">5</span><span class="op" id="6076925">]</span><span class="op" id="6076926">)</span><span class="op" id="6076927">&lt;&lt;</span><span class="num" id="6076929">8</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6076932">height</span>&nbsp;<span class="op" id="6076939">:=</span>&nbsp;<span class="builtintype" id="6076942">int</span><span class="op" id="6076945">(</span><span class="ident" id="6076946">d</span><span class="op" id="6076947">.</span><span class="ident" id="6076948">tmp</span><span class="op" id="6076951">[</span><span class="num" id="6076952">6</span><span class="op" id="6076953">]</span><span class="op" id="6076954">)</span>&nbsp;<span class="op" id="6076956">+</span>&nbsp;<span class="builtintype" id="6076958">int</span><span class="op" id="6076961">(</span><span class="ident" id="6076962">d</span><span class="op" id="6076963">.</span><span class="ident" id="6076964">tmp</span><span class="op" id="6076967">[</span><span class="num" id="6076968">7</span><span class="op" id="6076969">]</span><span class="op" id="6076970">)</span><span class="op" id="6076971">&lt;&lt;</span><span class="num" id="6076973">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6076976">d</span><span class="op" id="6076977">.</span><span class="ident" id="6076978">imageFields</span>&nbsp;<span class="op" id="6076990">=</span>&nbsp;<span class="ident" id="6076992">d</span><span class="op" id="6076993">.</span><span class="ident" id="6076994">tmp</span><span class="op" id="6076997">[</span><span class="num" id="6076998">8</span><span class="op" id="6076999">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6077003">//&nbsp;The&nbsp;GIF89a&nbsp;spec,&nbsp;Section&nbsp;20&nbsp;(Image&nbsp;Descriptor)&nbsp;says:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6077060">//&nbsp;&#34;Each&nbsp;image&nbsp;must&nbsp;fit&nbsp;within&nbsp;the&nbsp;boundaries&nbsp;of&nbsp;the&nbsp;Logical</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6077122">//&nbsp;Screen,&nbsp;as&nbsp;defined&nbsp;in&nbsp;the&nbsp;Logical&nbsp;Screen&nbsp;Descriptor.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6077180">bounds</span>&nbsp;<span class="op" id="6077187">:=</span>&nbsp;<span class="ident" id="6077190">image</span><span class="op" id="6077195">.</span><span class="ident" id="6077196">Rect</span><span class="op" id="6077200">(</span><span class="ident" id="6077201">left</span><span class="op" id="6077205">,</span>&nbsp;<span class="ident" id="6077207">top</span><span class="op" id="6077210">,</span>&nbsp;<span class="ident" id="6077212">left</span><span class="op" id="6077216">+</span><span class="ident" id="6077217">width</span><span class="op" id="6077222">,</span>&nbsp;<span class="ident" id="6077224">top</span><span class="op" id="6077227">+</span><span class="ident" id="6077228">height</span><span class="op" id="6077234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6077237">if</span>&nbsp;<span class="ident" id="6077240">bounds</span>&nbsp;<span class="op" id="6077247">!=</span>&nbsp;<span class="ident" id="6077250">bounds</span><span class="op" id="6077256">.</span><span class="ident" id="6077257">Intersect</span><span class="op" id="6077266">(</span><span class="ident" id="6077267">image</span><span class="op" id="6077272">.</span><span class="ident" id="6077273">Rect</span><span class="op" id="6077277">(</span><span class="num" id="6077278">0</span><span class="op" id="6077279">,</span>&nbsp;<span class="num" id="6077281">0</span><span class="op" id="6077282">,</span>&nbsp;<span class="ident" id="6077284">d</span><span class="op" id="6077285">.</span><span class="ident" id="6077286">width</span><span class="op" id="6077291">,</span>&nbsp;<span class="ident" id="6077293">d</span><span class="op" id="6077294">.</span><span class="ident" id="6077295">height</span><span class="op" id="6077301">)</span><span class="op" id="6077302">)</span>&nbsp;<span class="op" id="6077304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6077308">return</span>&nbsp;<span class="builtintype" id="6077315">nil</span><span class="op" id="6077318">,</span>&nbsp;<span class="ident" id="6077320">errors</span><span class="op" id="6077326">.</span><span class="ident" id="6077327">New</span><span class="op" id="6077330">(</span><span class="string" id="6077331">&#34;gif:&nbsp;frame&nbsp;bounds&nbsp;larger&nbsp;than&nbsp;image&nbsp;bounds&#34;</span><span class="op" id="6077375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6077378">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6077381">return</span>&nbsp;<span class="ident" id="6077388">image</span><span class="op" id="6077393">.</span><span class="ident" id="6077394">NewPaletted</span><span class="op" id="6077405">(</span><span class="ident" id="6077406">bounds</span><span class="op" id="6077412">,</span>&nbsp;<span class="builtintype" id="6077414">nil</span><span class="op" id="6077417">)</span><span class="op" id="6077418">,</span>&nbsp;<span class="builtintype" id="6077420">nil</span><br>
<span class="lineno"></span><span class="op" id="6077424">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6077427">func</span>&nbsp;<span class="op" id="6077432">(</span><span class="ident" id="6077433">d</span>&nbsp;<span class="op" id="6077435">*</span><span class="ident" id="6077436">decoder</span><span class="op" id="6077443">)</span>&nbsp;<span class="ident" id="6077445">readBlock</span><span class="op" id="6077454">(</span><span class="op" id="6077455">)</span>&nbsp;<span class="op" id="6077457">(</span><span class="builtintype" id="6077458">int</span><span class="op" id="6077461">,</span>&nbsp;<span class="builtintype" id="6077463">error</span><span class="op" id="6077468">)</span>&nbsp;<span class="op" id="6077470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6077473">n</span><span class="op" id="6077474">,</span>&nbsp;<span class="ident" id="6077476">err</span>&nbsp;<span class="op" id="6077480">:=</span>&nbsp;<span class="ident" id="6077483">d</span><span class="op" id="6077484">.</span><span class="ident" id="6077485">r</span><span class="op" id="6077486">.</span><span class="ident" id="6077487">ReadByte</span><span class="op" id="6077495">(</span><span class="op" id="6077496">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6077499">if</span>&nbsp;<span class="ident" id="6077502">n</span>&nbsp;<span class="op" id="6077504">==</span>&nbsp;<span class="num" id="6077507">0</span>&nbsp;<span class="op" id="6077509">||</span>&nbsp;<span class="ident" id="6077512">err</span>&nbsp;<span class="op" id="6077516">!=</span>&nbsp;<span class="builtintype" id="6077519">nil</span>&nbsp;<span class="op" id="6077523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6077527">return</span>&nbsp;<span class="num" id="6077534">0</span><span class="op" id="6077535">,</span>&nbsp;<span class="ident" id="6077537">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6077542">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6077545">return</span>&nbsp;<span class="ident" id="6077552">io</span><span class="op" id="6077554">.</span><span class="ident" id="6077555">ReadFull</span><span class="op" id="6077563">(</span><span class="ident" id="6077564">d</span><span class="op" id="6077565">.</span><span class="ident" id="6077566">r</span><span class="op" id="6077567">,</span>&nbsp;<span class="ident" id="6077569">d</span><span class="op" id="6077570">.</span><span class="ident" id="6077571">tmp</span><span class="op" id="6077574">[</span><span class="num" id="6077575">0</span><span class="op" id="6077576">:</span><span class="ident" id="6077577">n</span><span class="op" id="6077578">]</span><span class="op" id="6077579">)</span><br>
<span class="lineno"></span><span class="op" id="6077581">}</span><br>
<span class="lineno">385</span><br>
<span class="lineno"></span><span class="comment" id="6077584">//&nbsp;interlaceScan&nbsp;defines&nbsp;the&nbsp;ordering&nbsp;for&nbsp;a&nbsp;pass&nbsp;of&nbsp;the&nbsp;interlace&nbsp;algorithm.</span><br>
<span class="lineno"></span><span class="keyword" id="6077661">type</span>&nbsp;<span class="ident" id="6077666">interlaceScan</span>&nbsp;<span class="keyword" id="6077680">struct</span>&nbsp;<span class="op" id="6077687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6077690">skip</span><span class="op" id="6077694">,</span>&nbsp;<span class="ident" id="6077696">start</span>&nbsp;<span class="builtintype" id="6077702">int</span><br>
<span class="lineno"></span><span class="op" id="6077706">}</span><br>
<span class="lineno">390</span><br>
<span class="lineno"></span><span class="comment" id="6077709">//&nbsp;interlacing&nbsp;represents&nbsp;the&nbsp;set&nbsp;of&nbsp;scans&nbsp;in&nbsp;an&nbsp;interlaced&nbsp;GIF&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="6077780">var</span>&nbsp;<span class="ident" id="6077784">interlacing</span>&nbsp;<span class="op" id="6077796">=</span>&nbsp;<span class="op" id="6077798">[</span><span class="op" id="6077799">]</span><span class="ident" id="6077800">interlaceScan</span><span class="op" id="6077813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6077816">{</span><span class="num" id="6077817">8</span><span class="op" id="6077818">,</span>&nbsp;<span class="num" id="6077820">0</span><span class="op" id="6077821">}</span><span class="op" id="6077822">,</span>&nbsp;<span class="comment" id="6077824">//&nbsp;Group&nbsp;1&nbsp;:&nbsp;Every&nbsp;8th.&nbsp;row,&nbsp;starting&nbsp;with&nbsp;row&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6077875">{</span><span class="num" id="6077876">8</span><span class="op" id="6077877">,</span>&nbsp;<span class="num" id="6077879">4</span><span class="op" id="6077880">}</span><span class="op" id="6077881">,</span>&nbsp;<span class="comment" id="6077883">//&nbsp;Group&nbsp;2&nbsp;:&nbsp;Every&nbsp;8th.&nbsp;row,&nbsp;starting&nbsp;with&nbsp;row&nbsp;4.</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6077934">{</span><span class="num" id="6077935">4</span><span class="op" id="6077936">,</span>&nbsp;<span class="num" id="6077938">2</span><span class="op" id="6077939">}</span><span class="op" id="6077940">,</span>&nbsp;<span class="comment" id="6077942">//&nbsp;Group&nbsp;3&nbsp;:&nbsp;Every&nbsp;4th.&nbsp;row,&nbsp;starting&nbsp;with&nbsp;row&nbsp;2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6077993">{</span><span class="num" id="6077994">2</span><span class="op" id="6077995">,</span>&nbsp;<span class="num" id="6077997">1</span><span class="op" id="6077998">}</span><span class="op" id="6077999">,</span>&nbsp;<span class="comment" id="6078001">//&nbsp;Group&nbsp;4&nbsp;:&nbsp;Every&nbsp;2nd.&nbsp;row,&nbsp;starting&nbsp;with&nbsp;row&nbsp;1.</span><br>
<span class="lineno"></span><span class="op" id="6078051">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6078054">//&nbsp;uninterlace&nbsp;rearranges&nbsp;the&nbsp;pixels&nbsp;in&nbsp;m&nbsp;to&nbsp;account&nbsp;for&nbsp;interlaced&nbsp;input.</span><br>
<span class="lineno">400</span><span class="keyword" id="6078129">func</span>&nbsp;<span class="ident" id="6078134">uninterlace</span><span class="op" id="6078145">(</span><span class="ident" id="6078146">m</span>&nbsp;<span class="op" id="6078148">*</span><span class="ident" id="6078149">image</span><span class="op" id="6078154">.</span><span class="ident" id="6078155">Paletted</span><span class="op" id="6078163">)</span>&nbsp;<span class="op" id="6078165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6078168">var</span>&nbsp;<span class="ident" id="6078172">nPix</span>&nbsp;<span class="op" id="6078177">[</span><span class="op" id="6078178">]</span><span class="builtintype" id="6078179">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6078186">dx</span>&nbsp;<span class="op" id="6078189">:=</span>&nbsp;<span class="ident" id="6078192">m</span><span class="op" id="6078193">.</span><span class="ident" id="6078194">Bounds</span><span class="op" id="6078200">(</span><span class="op" id="6078201">)</span><span class="op" id="6078202">.</span><span class="ident" id="6078203">Dx</span><span class="op" id="6078205">(</span><span class="op" id="6078206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6078209">dy</span>&nbsp;<span class="op" id="6078212">:=</span>&nbsp;<span class="ident" id="6078215">m</span><span class="op" id="6078216">.</span><span class="ident" id="6078217">Bounds</span><span class="op" id="6078223">(</span><span class="op" id="6078224">)</span><span class="op" id="6078225">.</span><span class="ident" id="6078226">Dy</span><span class="op" id="6078228">(</span><span class="op" id="6078229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6078232">nPix</span>&nbsp;<span class="op" id="6078237">=</span>&nbsp;<span class="builtinfunc" id="6078239">make</span><span class="op" id="6078243">(</span><span class="op" id="6078244">[</span><span class="op" id="6078245">]</span><span class="builtintype" id="6078246">uint8</span><span class="op" id="6078251">,</span>&nbsp;<span class="ident" id="6078253">dx</span><span class="op" id="6078255">*</span><span class="ident" id="6078256">dy</span><span class="op" id="6078258">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6078261">offset</span>&nbsp;<span class="op" id="6078268">:=</span>&nbsp;<span class="num" id="6078271">0</span>&nbsp;<span class="comment" id="6078273">//&nbsp;steps&nbsp;through&nbsp;the&nbsp;input&nbsp;by&nbsp;sequential&nbsp;scan&nbsp;lines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6078327">for</span>&nbsp;<span class="ident" id="6078331">_</span><span class="op" id="6078332">,</span>&nbsp;<span class="ident" id="6078334">pass</span>&nbsp;<span class="op" id="6078339">:=</span>&nbsp;<span class="keyword" id="6078342">range</span>&nbsp;<span class="ident" id="6078348">interlacing</span>&nbsp;<span class="op" id="6078360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6078364">nOffset</span>&nbsp;<span class="op" id="6078372">:=</span>&nbsp;<span class="ident" id="6078375">pass</span><span class="op" id="6078379">.</span><span class="ident" id="6078380">start</span>&nbsp;<span class="op" id="6078386">*</span>&nbsp;<span class="ident" id="6078388">dx</span>&nbsp;<span class="comment" id="6078391">//&nbsp;steps&nbsp;through&nbsp;the&nbsp;output&nbsp;as&nbsp;defined&nbsp;by&nbsp;pass.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6078441">for</span>&nbsp;<span class="ident" id="6078445">y</span>&nbsp;<span class="op" id="6078447">:=</span>&nbsp;<span class="ident" id="6078450">pass</span><span class="op" id="6078454">.</span><span class="ident" id="6078455">start</span><span class="op" id="6078460">;</span>&nbsp;<span class="ident" id="6078462">y</span>&nbsp;<span class="op" id="6078464">&lt;</span>&nbsp;<span class="ident" id="6078466">dy</span><span class="op" id="6078468">;</span>&nbsp;<span class="ident" id="6078470">y</span>&nbsp;<span class="op" id="6078472">+=</span>&nbsp;<span class="ident" id="6078475">pass</span><span class="op" id="6078479">.</span><span class="ident" id="6078480">skip</span>&nbsp;<span class="op" id="6078485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6078490">copy</span><span class="op" id="6078494">(</span><span class="ident" id="6078495">nPix</span><span class="op" id="6078499">[</span><span class="ident" id="6078500">nOffset</span><span class="op" id="6078507">:</span><span class="ident" id="6078508">nOffset</span><span class="op" id="6078515">+</span><span class="ident" id="6078516">dx</span><span class="op" id="6078518">]</span><span class="op" id="6078519">,</span>&nbsp;<span class="ident" id="6078521">m</span><span class="op" id="6078522">.</span><span class="ident" id="6078523">Pix</span><span class="op" id="6078526">[</span><span class="ident" id="6078527">offset</span><span class="op" id="6078533">:</span><span class="ident" id="6078534">offset</span><span class="op" id="6078540">+</span><span class="ident" id="6078541">dx</span><span class="op" id="6078543">]</span><span class="op" id="6078544">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6078549">offset</span>&nbsp;<span class="op" id="6078556">+=</span>&nbsp;<span class="ident" id="6078559">dx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6078565">nOffset</span>&nbsp;<span class="op" id="6078573">+=</span>&nbsp;<span class="ident" id="6078576">dx</span>&nbsp;<span class="op" id="6078579">*</span>&nbsp;<span class="ident" id="6078581">pass</span><span class="op" id="6078585">.</span><span class="ident" id="6078586">skip</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6078593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6078596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6078599">m</span><span class="op" id="6078600">.</span><span class="ident" id="6078601">Pix</span>&nbsp;<span class="op" id="6078605">=</span>&nbsp;<span class="ident" id="6078607">nPix</span><br>
<span class="lineno">415</span><span class="op" id="6078612">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6078615">//&nbsp;Decode&nbsp;reads&nbsp;a&nbsp;GIF&nbsp;image&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;the&nbsp;first&nbsp;embedded</span><br>
<span class="lineno"></span><span class="comment" id="6078681">//&nbsp;image&nbsp;as&nbsp;an&nbsp;image.Image.</span><br>
<span class="lineno"></span><span class="keyword" id="6078709">func</span>&nbsp;<span class="ident" id="6078714">Decode</span><span class="op" id="6078720">(</span><span class="ident" id="6078721">r</span>&nbsp;<span class="ident" id="6078723">io</span><span class="op" id="6078725">.</span><span class="ident" id="6078726">Reader</span><span class="op" id="6078732">)</span>&nbsp;<span class="op" id="6078734">(</span><span class="ident" id="6078735">image</span><span class="op" id="6078740">.</span><span class="ident" id="6078741">Image</span><span class="op" id="6078746">,</span>&nbsp;<span class="builtintype" id="6078748">error</span><span class="op" id="6078753">)</span>&nbsp;<span class="op" id="6078755">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6078758">var</span>&nbsp;<span class="ident" id="6078762">d</span>&nbsp;<span class="ident" id="6078764">decoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6078773">if</span>&nbsp;<span class="ident" id="6078776">err</span>&nbsp;<span class="op" id="6078780">:=</span>&nbsp;<span class="ident" id="6078783">d</span><span class="op" id="6078784">.</span><span class="ident" id="6078785">decode</span><span class="op" id="6078791">(</span><span class="ident" id="6078792">r</span><span class="op" id="6078793">,</span>&nbsp;<span class="builtintype" id="6078795">false</span><span class="op" id="6078800">)</span><span class="op" id="6078801">;</span>&nbsp;<span class="ident" id="6078803">err</span>&nbsp;<span class="op" id="6078807">!=</span>&nbsp;<span class="builtintype" id="6078810">nil</span>&nbsp;<span class="op" id="6078814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6078818">return</span>&nbsp;<span class="builtintype" id="6078825">nil</span><span class="op" id="6078828">,</span>&nbsp;<span class="ident" id="6078830">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6078835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6078838">return</span>&nbsp;<span class="ident" id="6078845">d</span><span class="op" id="6078846">.</span><span class="ident" id="6078847">image</span><span class="op" id="6078852">[</span><span class="num" id="6078853">0</span><span class="op" id="6078854">]</span><span class="op" id="6078855">,</span>&nbsp;<span class="builtintype" id="6078857">nil</span><br>
<span class="lineno">425</span><span class="op" id="6078861">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6078864">//&nbsp;GIF&nbsp;represents&nbsp;the&nbsp;possibly&nbsp;multiple&nbsp;images&nbsp;stored&nbsp;in&nbsp;a&nbsp;GIF&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="6078933">type</span>&nbsp;<span class="ident" id="6078938">GIF</span>&nbsp;<span class="keyword" id="6078942">struct</span>&nbsp;<span class="op" id="6078949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6078952">Image</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6078962">[</span><span class="op" id="6078963">]</span><span class="op" id="6078964">*</span><span class="ident" id="6078965">image</span><span class="op" id="6078970">.</span><span class="ident" id="6078971">Paletted</span>&nbsp;<span class="comment" id="6078980">//&nbsp;The&nbsp;successive&nbsp;images.</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6079007">Delay</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6079017">[</span><span class="op" id="6079018">]</span><span class="builtintype" id="6079019">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6079035">//&nbsp;The&nbsp;successive&nbsp;delay&nbsp;times,&nbsp;one&nbsp;per&nbsp;frame,&nbsp;in&nbsp;100ths&nbsp;of&nbsp;a&nbsp;second.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6079105">LoopCount</span>&nbsp;<span class="builtintype" id="6079115">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6079133">//&nbsp;The&nbsp;loop&nbsp;count.</span><br>
<span class="lineno"></span><span class="op" id="6079152">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6079155">//&nbsp;DecodeAll&nbsp;reads&nbsp;a&nbsp;GIF&nbsp;image&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;the&nbsp;sequential&nbsp;frames</span><br>
<span class="lineno">435</span><span class="comment" id="6079227">//&nbsp;and&nbsp;timing&nbsp;information.</span><br>
<span class="lineno"></span><span class="keyword" id="6079254">func</span>&nbsp;<span class="ident" id="6079259">DecodeAll</span><span class="op" id="6079268">(</span><span class="ident" id="6079269">r</span>&nbsp;<span class="ident" id="6079271">io</span><span class="op" id="6079273">.</span><span class="ident" id="6079274">Reader</span><span class="op" id="6079280">)</span>&nbsp;<span class="op" id="6079282">(</span><span class="op" id="6079283">*</span><span class="ident" id="6079284">GIF</span><span class="op" id="6079287">,</span>&nbsp;<span class="builtintype" id="6079289">error</span><span class="op" id="6079294">)</span>&nbsp;<span class="op" id="6079296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6079299">var</span>&nbsp;<span class="ident" id="6079303">d</span>&nbsp;<span class="ident" id="6079305">decoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6079314">if</span>&nbsp;<span class="ident" id="6079317">err</span>&nbsp;<span class="op" id="6079321">:=</span>&nbsp;<span class="ident" id="6079324">d</span><span class="op" id="6079325">.</span><span class="ident" id="6079326">decode</span><span class="op" id="6079332">(</span><span class="ident" id="6079333">r</span><span class="op" id="6079334">,</span>&nbsp;<span class="builtintype" id="6079336">false</span><span class="op" id="6079341">)</span><span class="op" id="6079342">;</span>&nbsp;<span class="ident" id="6079344">err</span>&nbsp;<span class="op" id="6079348">!=</span>&nbsp;<span class="builtintype" id="6079351">nil</span>&nbsp;<span class="op" id="6079355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6079359">return</span>&nbsp;<span class="builtintype" id="6079366">nil</span><span class="op" id="6079369">,</span>&nbsp;<span class="ident" id="6079371">err</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6079376">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6079379">gif</span>&nbsp;<span class="op" id="6079383">:=</span>&nbsp;<span class="op" id="6079386">&amp;</span><span class="ident" id="6079387">GIF</span><span class="op" id="6079390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6079394">Image</span><span class="op" id="6079399">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6079405">d</span><span class="op" id="6079406">.</span><span class="ident" id="6079407">image</span><span class="op" id="6079412">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6079416">LoopCount</span><span class="op" id="6079425">:</span>&nbsp;<span class="ident" id="6079427">d</span><span class="op" id="6079428">.</span><span class="ident" id="6079429">loopCount</span><span class="op" id="6079438">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6079442">Delay</span><span class="op" id="6079447">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6079453">d</span><span class="op" id="6079454">.</span><span class="ident" id="6079455">delay</span><span class="op" id="6079460">,</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6079463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6079466">return</span>&nbsp;<span class="ident" id="6079473">gif</span><span class="op" id="6079476">,</span>&nbsp;<span class="builtintype" id="6079478">nil</span><br>
<span class="lineno"></span><span class="op" id="6079482">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6079485">//&nbsp;DecodeConfig&nbsp;returns&nbsp;the&nbsp;global&nbsp;color&nbsp;model&nbsp;and&nbsp;dimensions&nbsp;of&nbsp;a&nbsp;GIF&nbsp;image</span><br>
<span class="lineno">450</span><span class="comment" id="6079562">//&nbsp;without&nbsp;decoding&nbsp;the&nbsp;entire&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="6079600">func</span>&nbsp;<span class="ident" id="6079605">DecodeConfig</span><span class="op" id="6079617">(</span><span class="ident" id="6079618">r</span>&nbsp;<span class="ident" id="6079620">io</span><span class="op" id="6079622">.</span><span class="ident" id="6079623">Reader</span><span class="op" id="6079629">)</span>&nbsp;<span class="op" id="6079631">(</span><span class="ident" id="6079632">image</span><span class="op" id="6079637">.</span><span class="ident" id="6079638">Config</span><span class="op" id="6079644">,</span>&nbsp;<span class="builtintype" id="6079646">error</span><span class="op" id="6079651">)</span>&nbsp;<span class="op" id="6079653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6079656">var</span>&nbsp;<span class="ident" id="6079660">d</span>&nbsp;<span class="ident" id="6079662">decoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6079671">if</span>&nbsp;<span class="ident" id="6079674">err</span>&nbsp;<span class="op" id="6079678">:=</span>&nbsp;<span class="ident" id="6079681">d</span><span class="op" id="6079682">.</span><span class="ident" id="6079683">decode</span><span class="op" id="6079689">(</span><span class="ident" id="6079690">r</span><span class="op" id="6079691">,</span>&nbsp;<span class="builtintype" id="6079693">true</span><span class="op" id="6079697">)</span><span class="op" id="6079698">;</span>&nbsp;<span class="ident" id="6079700">err</span>&nbsp;<span class="op" id="6079704">!=</span>&nbsp;<span class="builtintype" id="6079707">nil</span>&nbsp;<span class="op" id="6079711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6079715">return</span>&nbsp;<span class="ident" id="6079722">image</span><span class="op" id="6079727">.</span><span class="ident" id="6079728">Config</span><span class="op" id="6079734">{</span><span class="op" id="6079735">}</span><span class="op" id="6079736">,</span>&nbsp;<span class="ident" id="6079738">err</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6079743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6079746">return</span>&nbsp;<span class="ident" id="6079753">image</span><span class="op" id="6079758">.</span><span class="ident" id="6079759">Config</span><span class="op" id="6079765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6079769">ColorModel</span><span class="op" id="6079779">:</span>&nbsp;<span class="ident" id="6079781">d</span><span class="op" id="6079782">.</span><span class="ident" id="6079783">globalColorMap</span><span class="op" id="6079797">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6079801">Width</span><span class="op" id="6079806">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6079813">d</span><span class="op" id="6079814">.</span><span class="ident" id="6079815">width</span><span class="op" id="6079820">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6079824">Height</span><span class="op" id="6079830">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6079836">d</span><span class="op" id="6079837">.</span><span class="ident" id="6079838">height</span><span class="op" id="6079844">,</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6079847">}</span><span class="op" id="6079848">,</span>&nbsp;<span class="builtintype" id="6079850">nil</span><br>
<span class="lineno"></span><span class="op" id="6079854">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6079857">func</span>&nbsp;<span class="ident" id="6079862">init</span><span class="op" id="6079866">(</span><span class="op" id="6079867">)</span>&nbsp;<span class="op" id="6079869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6079872">image</span><span class="op" id="6079877">.</span><span class="ident" id="6079878">RegisterFormat</span><span class="op" id="6079892">(</span><span class="string" id="6079893">&#34;gif&#34;</span><span class="op" id="6079898">,</span>&nbsp;<span class="string" id="6079900">&#34;GIF8?a&#34;</span><span class="op" id="6079908">,</span>&nbsp;<span class="ident" id="6079910">Decode</span><span class="op" id="6079916">,</span>&nbsp;<span class="ident" id="6079918">DecodeConfig</span><span class="op" id="6079930">)</span><br>
<span class="lineno">465</span><span class="op" id="6079932">}</span>
</div>
</body>
</html>
