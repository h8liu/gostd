<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/dsa</h2>
<ul>
<li><a href="/gostd/crypto/dsa/dsa.go.html">dsa.go</a></li>
<li><a href="/gostd/crypto/dsa/dsa_test.go.html">dsa_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4967276">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4967331">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4967385">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4967436">//&nbsp;Package&nbsp;dsa&nbsp;implements&nbsp;the&nbsp;Digital&nbsp;Signature&nbsp;Algorithm,&nbsp;as&nbsp;defined&nbsp;in&nbsp;FIPS&nbsp;186-3.</span><br>
<span class="lineno"></span><span class="keyword" id="4967521">package</span>&nbsp;<span class="ident" id="4967529">dsa</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4967534">import</span>&nbsp;<span class="op" id="4967541">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4967544">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4967554">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4967560">&#34;math/big&#34;</span><br>
<span class="lineno"></span><span class="op" id="4967571">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4967574">//&nbsp;Parameters&nbsp;represents&nbsp;the&nbsp;domain&nbsp;parameters&nbsp;for&nbsp;a&nbsp;key.&nbsp;These&nbsp;parameters&nbsp;can</span><br>
<span class="lineno">15</span><span class="comment" id="4967653">//&nbsp;be&nbsp;shared&nbsp;across&nbsp;many&nbsp;keys.&nbsp;The&nbsp;bit&nbsp;length&nbsp;of&nbsp;Q&nbsp;must&nbsp;be&nbsp;a&nbsp;multiple&nbsp;of&nbsp;8.</span><br>
<span class="lineno"></span><span class="keyword" id="4967729">type</span>&nbsp;<span class="ident" id="4967734">Parameters</span>&nbsp;<span class="keyword" id="4967745">struct</span>&nbsp;<span class="op" id="4967752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4967755">P</span><span class="op" id="4967756">,</span>&nbsp;<span class="ident" id="4967758">Q</span><span class="op" id="4967759">,</span>&nbsp;<span class="ident" id="4967761">G</span>&nbsp;<span class="op" id="4967763">*</span><span class="ident" id="4967764">big</span><span class="op" id="4967767">.</span><span class="ident" id="4967768">Int</span><br>
<span class="lineno"></span><span class="op" id="4967772">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="4967775">//&nbsp;PublicKey&nbsp;represents&nbsp;a&nbsp;DSA&nbsp;public&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4967817">type</span>&nbsp;<span class="ident" id="4967822">PublicKey</span>&nbsp;<span class="keyword" id="4967832">struct</span>&nbsp;<span class="op" id="4967839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4967842">Parameters</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4967854">Y</span>&nbsp;<span class="op" id="4967856">*</span><span class="ident" id="4967857">big</span><span class="op" id="4967860">.</span><span class="ident" id="4967861">Int</span><br>
<span class="lineno"></span><span class="op" id="4967865">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="4967868">//&nbsp;PrivateKey&nbsp;represents&nbsp;a&nbsp;DSA&nbsp;private&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4967912">type</span>&nbsp;<span class="ident" id="4967917">PrivateKey</span>&nbsp;<span class="keyword" id="4967928">struct</span>&nbsp;<span class="op" id="4967935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4967938">PublicKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4967949">X</span>&nbsp;<span class="op" id="4967951">*</span><span class="ident" id="4967952">big</span><span class="op" id="4967955">.</span><span class="ident" id="4967956">Int</span><br>
<span class="lineno">30</span><span class="op" id="4967960">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4967963">//&nbsp;ErrInvalidPublicKey&nbsp;results&nbsp;when&nbsp;a&nbsp;public&nbsp;key&nbsp;is&nbsp;not&nbsp;usable&nbsp;by&nbsp;this&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="4968040">//&nbsp;FIPS&nbsp;is&nbsp;quite&nbsp;strict&nbsp;about&nbsp;the&nbsp;format&nbsp;of&nbsp;DSA&nbsp;keys,&nbsp;but&nbsp;other&nbsp;code&nbsp;may&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="4968116">//&nbsp;less&nbsp;so.&nbsp;Thus,&nbsp;when&nbsp;using&nbsp;keys&nbsp;which&nbsp;may&nbsp;have&nbsp;been&nbsp;generated&nbsp;by&nbsp;other&nbsp;code,</span><br>
<span class="lineno">35</span><span class="comment" id="4968195">//&nbsp;this&nbsp;error&nbsp;must&nbsp;be&nbsp;handled.</span><br>
<span class="lineno"></span><span class="keyword" id="4968226">var</span>&nbsp;<span class="ident" id="4968230">ErrInvalidPublicKey</span>&nbsp;<span class="op" id="4968250">=</span>&nbsp;<span class="ident" id="4968252">errors</span><span class="op" id="4968258">.</span><span class="ident" id="4968259">New</span><span class="op" id="4968262">(</span><span class="string" id="4968263">&#34;crypto/dsa:&nbsp;invalid&nbsp;public&nbsp;key&#34;</span><span class="op" id="4968295">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4968298">//&nbsp;ParameterSizes&nbsp;is&nbsp;a&nbsp;enumeration&nbsp;of&nbsp;the&nbsp;acceptable&nbsp;bit&nbsp;lengths&nbsp;of&nbsp;the&nbsp;primes</span><br>
<span class="lineno"></span><span class="comment" id="4968377">//&nbsp;in&nbsp;a&nbsp;set&nbsp;of&nbsp;DSA&nbsp;parameters.&nbsp;See&nbsp;FIPS&nbsp;186-3,&nbsp;section&nbsp;4.2.</span><br>
<span class="lineno">40</span><span class="keyword" id="4968437">type</span>&nbsp;<span class="ident" id="4968442">ParameterSizes</span>&nbsp;<span class="builtintype" id="4968457">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4968462">const</span>&nbsp;<span class="op" id="4968468">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4968471">L1024N160</span>&nbsp;<span class="ident" id="4968481">ParameterSizes</span>&nbsp;<span class="op" id="4968496">=</span>&nbsp;<span class="ident" id="4968498">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4968504">L2048N224</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4968515">L2048N256</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4968526">L3072N256</span><br>
<span class="lineno"></span><span class="op" id="4968536">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4968539">//&nbsp;numMRTests&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;Miller-Rabin&nbsp;primality&nbsp;tests&nbsp;that&nbsp;we&nbsp;perform.&nbsp;We</span><br>
<span class="lineno">50</span><span class="comment" id="4968619">//&nbsp;pick&nbsp;the&nbsp;largest&nbsp;recommended&nbsp;number&nbsp;from&nbsp;table&nbsp;C.1&nbsp;of&nbsp;FIPS&nbsp;186-3.</span><br>
<span class="lineno"></span><span class="keyword" id="4968688">const</span>&nbsp;<span class="ident" id="4968694">numMRTests</span>&nbsp;<span class="op" id="4968705">=</span>&nbsp;<span class="num" id="4968707">64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4968711">//&nbsp;GenerateParameters&nbsp;puts&nbsp;a&nbsp;random,&nbsp;valid&nbsp;set&nbsp;of&nbsp;DSA&nbsp;parameters&nbsp;into&nbsp;params.</span><br>
<span class="lineno"></span><span class="comment" id="4968789">//&nbsp;This&nbsp;function&nbsp;takes&nbsp;many&nbsp;seconds,&nbsp;even&nbsp;on&nbsp;fast&nbsp;machines.</span><br>
<span class="lineno">55</span><span class="keyword" id="4968849">func</span>&nbsp;<span class="ident" id="4968854">GenerateParameters</span><span class="op" id="4968872">(</span><span class="ident" id="4968873">params</span>&nbsp;<span class="op" id="4968880">*</span><span class="ident" id="4968881">Parameters</span><span class="op" id="4968891">,</span>&nbsp;<span class="ident" id="4968893">rand</span>&nbsp;<span class="ident" id="4968898">io</span><span class="op" id="4968900">.</span><span class="ident" id="4968901">Reader</span><span class="op" id="4968907">,</span>&nbsp;<span class="ident" id="4968909">sizes</span>&nbsp;<span class="ident" id="4968915">ParameterSizes</span><span class="op" id="4968929">)</span>&nbsp;<span class="op" id="4968931">(</span><span class="ident" id="4968932">err</span>&nbsp;<span class="builtintype" id="4968936">error</span><span class="op" id="4968941">)</span>&nbsp;<span class="op" id="4968943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4968946">//&nbsp;This&nbsp;function&nbsp;doesn&#39;t&nbsp;follow&nbsp;FIPS&nbsp;186-3&nbsp;exactly&nbsp;in&nbsp;that&nbsp;it&nbsp;doesn&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4969017">//&nbsp;use&nbsp;a&nbsp;verification&nbsp;seed&nbsp;to&nbsp;generate&nbsp;the&nbsp;primes.&nbsp;The&nbsp;verification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4969086">//&nbsp;seed&nbsp;doesn&#39;t&nbsp;appear&nbsp;to&nbsp;be&nbsp;exported&nbsp;or&nbsp;used&nbsp;by&nbsp;other&nbsp;code&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4969151">//&nbsp;omitting&nbsp;it&nbsp;makes&nbsp;the&nbsp;code&nbsp;cleaner.</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4969192">var</span>&nbsp;<span class="ident" id="4969196">L</span><span class="op" id="4969197">,</span>&nbsp;<span class="ident" id="4969199">N</span>&nbsp;<span class="builtintype" id="4969201">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4969206">switch</span>&nbsp;<span class="ident" id="4969213">sizes</span>&nbsp;<span class="op" id="4969219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4969222">case</span>&nbsp;<span class="ident" id="4969227">L1024N160</span><span class="op" id="4969236">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4969240">L</span>&nbsp;<span class="op" id="4969242">=</span>&nbsp;<span class="num" id="4969244">1024</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4969251">N</span>&nbsp;<span class="op" id="4969253">=</span>&nbsp;<span class="num" id="4969255">160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4969260">case</span>&nbsp;<span class="ident" id="4969265">L2048N224</span><span class="op" id="4969274">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4969278">L</span>&nbsp;<span class="op" id="4969280">=</span>&nbsp;<span class="num" id="4969282">2048</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4969289">N</span>&nbsp;<span class="op" id="4969291">=</span>&nbsp;<span class="num" id="4969293">224</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4969298">case</span>&nbsp;<span class="ident" id="4969303">L2048N256</span><span class="op" id="4969312">:</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4969316">L</span>&nbsp;<span class="op" id="4969318">=</span>&nbsp;<span class="num" id="4969320">2048</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4969327">N</span>&nbsp;<span class="op" id="4969329">=</span>&nbsp;<span class="num" id="4969331">256</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4969336">case</span>&nbsp;<span class="ident" id="4969341">L3072N256</span><span class="op" id="4969350">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4969354">L</span>&nbsp;<span class="op" id="4969356">=</span>&nbsp;<span class="num" id="4969358">3072</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4969365">N</span>&nbsp;<span class="op" id="4969367">=</span>&nbsp;<span class="num" id="4969369">256</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4969374">default</span><span class="op" id="4969381">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4969385">return</span>&nbsp;<span class="ident" id="4969392">errors</span><span class="op" id="4969398">.</span><span class="ident" id="4969399">New</span><span class="op" id="4969402">(</span><span class="string" id="4969403">&#34;crypto/dsa:&nbsp;invalid&nbsp;ParameterSizes&#34;</span><span class="op" id="4969439">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4969442">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4969446">qBytes</span>&nbsp;<span class="op" id="4969453">:=</span>&nbsp;<span class="builtinfunc" id="4969456">make</span><span class="op" id="4969460">(</span><span class="op" id="4969461">[</span><span class="op" id="4969462">]</span><span class="builtintype" id="4969463">byte</span><span class="op" id="4969467">,</span>&nbsp;<span class="ident" id="4969469">N</span><span class="op" id="4969470">/</span><span class="num" id="4969471">8</span><span class="op" id="4969472">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4969475">pBytes</span>&nbsp;<span class="op" id="4969482">:=</span>&nbsp;<span class="builtinfunc" id="4969485">make</span><span class="op" id="4969489">(</span><span class="op" id="4969490">[</span><span class="op" id="4969491">]</span><span class="builtintype" id="4969492">byte</span><span class="op" id="4969496">,</span>&nbsp;<span class="ident" id="4969498">L</span><span class="op" id="4969499">/</span><span class="num" id="4969500">8</span><span class="op" id="4969501">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4969505">q</span>&nbsp;<span class="op" id="4969507">:=</span>&nbsp;<span class="builtinfunc" id="4969510">new</span><span class="op" id="4969513">(</span><span class="ident" id="4969514">big</span><span class="op" id="4969517">.</span><span class="ident" id="4969518">Int</span><span class="op" id="4969521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4969524">p</span>&nbsp;<span class="op" id="4969526">:=</span>&nbsp;<span class="builtinfunc" id="4969529">new</span><span class="op" id="4969532">(</span><span class="ident" id="4969533">big</span><span class="op" id="4969536">.</span><span class="ident" id="4969537">Int</span><span class="op" id="4969540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4969543">rem</span>&nbsp;<span class="op" id="4969547">:=</span>&nbsp;<span class="builtinfunc" id="4969550">new</span><span class="op" id="4969553">(</span><span class="ident" id="4969554">big</span><span class="op" id="4969557">.</span><span class="ident" id="4969558">Int</span><span class="op" id="4969561">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4969564">one</span>&nbsp;<span class="op" id="4969568">:=</span>&nbsp;<span class="builtinfunc" id="4969571">new</span><span class="op" id="4969574">(</span><span class="ident" id="4969575">big</span><span class="op" id="4969578">.</span><span class="ident" id="4969579">Int</span><span class="op" id="4969582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4969585">one</span><span class="op" id="4969588">.</span><span class="ident" id="4969589">SetInt64</span><span class="op" id="4969597">(</span><span class="num" id="4969598">1</span><span class="op" id="4969599">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="4969602">GeneratePrimes</span><span class="op" id="4969616">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4969619">for</span>&nbsp;<span class="op" id="4969623">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4969627">_</span><span class="op" id="4969628">,</span>&nbsp;<span class="ident" id="4969630">err</span>&nbsp;<span class="op" id="4969634">=</span>&nbsp;<span class="ident" id="4969636">io</span><span class="op" id="4969638">.</span><span class="ident" id="4969639">ReadFull</span><span class="op" id="4969647">(</span><span class="ident" id="4969648">rand</span><span class="op" id="4969652">,</span>&nbsp;<span class="ident" id="4969654">qBytes</span><span class="op" id="4969660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4969664">if</span>&nbsp;<span class="ident" id="4969667">err</span>&nbsp;<span class="op" id="4969671">!=</span>&nbsp;<span class="ident" id="4969674">nil</span>&nbsp;<span class="op" id="4969678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4969683">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4969692">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4969697">qBytes</span><span class="op" id="4969703">[</span><span class="builtinfunc" id="4969704">len</span><span class="op" id="4969707">(</span><span class="ident" id="4969708">qBytes</span><span class="op" id="4969714">)</span><span class="op" id="4969715">-</span><span class="num" id="4969716">1</span><span class="op" id="4969717">]</span>&nbsp;<span class="op" id="4969719">|=</span>&nbsp;<span class="num" id="4969722">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4969726">qBytes</span><span class="op" id="4969732">[</span><span class="num" id="4969733">0</span><span class="op" id="4969734">]</span>&nbsp;<span class="op" id="4969736">|=</span>&nbsp;<span class="num" id="4969739">0x80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4969746">q</span><span class="op" id="4969747">.</span><span class="ident" id="4969748">SetBytes</span><span class="op" id="4969756">(</span><span class="ident" id="4969757">qBytes</span><span class="op" id="4969763">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4969768">if</span>&nbsp;<span class="op" id="4969771">!</span><span class="ident" id="4969772">q</span><span class="op" id="4969773">.</span><span class="ident" id="4969774">ProbablyPrime</span><span class="op" id="4969787">(</span><span class="ident" id="4969788">numMRTests</span><span class="op" id="4969798">)</span>&nbsp;<span class="op" id="4969800">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4969805">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4969816">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4969821">for</span>&nbsp;<span class="ident" id="4969825">i</span>&nbsp;<span class="op" id="4969827">:=</span>&nbsp;<span class="num" id="4969830">0</span><span class="op" id="4969831">;</span>&nbsp;<span class="ident" id="4969833">i</span>&nbsp;<span class="op" id="4969835">&lt;</span>&nbsp;<span class="num" id="4969837">4</span><span class="op" id="4969838">*</span><span class="ident" id="4969839">L</span><span class="op" id="4969840">;</span>&nbsp;<span class="ident" id="4969842">i</span><span class="op" id="4969843">++</span>&nbsp;<span class="op" id="4969846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4969851">_</span><span class="op" id="4969852">,</span>&nbsp;<span class="ident" id="4969854">err</span>&nbsp;<span class="op" id="4969858">=</span>&nbsp;<span class="ident" id="4969860">io</span><span class="op" id="4969862">.</span><span class="ident" id="4969863">ReadFull</span><span class="op" id="4969871">(</span><span class="ident" id="4969872">rand</span><span class="op" id="4969876">,</span>&nbsp;<span class="ident" id="4969878">pBytes</span><span class="op" id="4969884">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4969889">if</span>&nbsp;<span class="ident" id="4969892">err</span>&nbsp;<span class="op" id="4969896">!=</span>&nbsp;<span class="ident" id="4969899">nil</span>&nbsp;<span class="op" id="4969903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4969909">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4969919">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4969925">pBytes</span><span class="op" id="4969931">[</span><span class="builtinfunc" id="4969932">len</span><span class="op" id="4969935">(</span><span class="ident" id="4969936">pBytes</span><span class="op" id="4969942">)</span><span class="op" id="4969943">-</span><span class="num" id="4969944">1</span><span class="op" id="4969945">]</span>&nbsp;<span class="op" id="4969947">|=</span>&nbsp;<span class="num" id="4969950">1</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4969955">pBytes</span><span class="op" id="4969961">[</span><span class="num" id="4969962">0</span><span class="op" id="4969963">]</span>&nbsp;<span class="op" id="4969965">|=</span>&nbsp;<span class="num" id="4969968">0x80</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4969977">p</span><span class="op" id="4969978">.</span><span class="ident" id="4969979">SetBytes</span><span class="op" id="4969987">(</span><span class="ident" id="4969988">pBytes</span><span class="op" id="4969994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4969999">rem</span><span class="op" id="4970002">.</span><span class="ident" id="4970003">Mod</span><span class="op" id="4970006">(</span><span class="ident" id="4970007">p</span><span class="op" id="4970008">,</span>&nbsp;<span class="ident" id="4970010">q</span><span class="op" id="4970011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4970016">rem</span><span class="op" id="4970019">.</span><span class="ident" id="4970020">Sub</span><span class="op" id="4970023">(</span><span class="ident" id="4970024">rem</span><span class="op" id="4970027">,</span>&nbsp;<span class="ident" id="4970029">one</span><span class="op" id="4970032">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4970037">p</span><span class="op" id="4970038">.</span><span class="ident" id="4970039">Sub</span><span class="op" id="4970042">(</span><span class="ident" id="4970043">p</span><span class="op" id="4970044">,</span>&nbsp;<span class="ident" id="4970046">rem</span><span class="op" id="4970049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4970054">if</span>&nbsp;<span class="ident" id="4970057">p</span><span class="op" id="4970058">.</span><span class="ident" id="4970059">BitLen</span><span class="op" id="4970065">(</span><span class="op" id="4970066">)</span>&nbsp;<span class="op" id="4970068">&lt;</span>&nbsp;<span class="ident" id="4970070">L</span>&nbsp;<span class="op" id="4970072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4970078">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4970090">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4970096">if</span>&nbsp;<span class="op" id="4970099">!</span><span class="ident" id="4970100">p</span><span class="op" id="4970101">.</span><span class="ident" id="4970102">ProbablyPrime</span><span class="op" id="4970115">(</span><span class="ident" id="4970116">numMRTests</span><span class="op" id="4970126">)</span>&nbsp;<span class="op" id="4970128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4970134">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4970146">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4970152">params</span><span class="op" id="4970158">.</span><span class="ident" id="4970159">P</span>&nbsp;<span class="op" id="4970161">=</span>&nbsp;<span class="ident" id="4970163">p</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4970168">params</span><span class="op" id="4970174">.</span><span class="ident" id="4970175">Q</span>&nbsp;<span class="op" id="4970177">=</span>&nbsp;<span class="ident" id="4970179">q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4970184">break</span>&nbsp;<span class="ident" id="4970190">GeneratePrimes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4970207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4970210">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4970214">h</span>&nbsp;<span class="op" id="4970216">:=</span>&nbsp;<span class="builtinfunc" id="4970219">new</span><span class="op" id="4970222">(</span><span class="ident" id="4970223">big</span><span class="op" id="4970226">.</span><span class="ident" id="4970227">Int</span><span class="op" id="4970230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4970233">h</span><span class="op" id="4970234">.</span><span class="ident" id="4970235">SetInt64</span><span class="op" id="4970243">(</span><span class="num" id="4970244">2</span><span class="op" id="4970245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4970248">g</span>&nbsp;<span class="op" id="4970250">:=</span>&nbsp;<span class="builtinfunc" id="4970253">new</span><span class="op" id="4970256">(</span><span class="ident" id="4970257">big</span><span class="op" id="4970260">.</span><span class="ident" id="4970261">Int</span><span class="op" id="4970264">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4970268">pm1</span>&nbsp;<span class="op" id="4970272">:=</span>&nbsp;<span class="builtinfunc" id="4970275">new</span><span class="op" id="4970278">(</span><span class="ident" id="4970279">big</span><span class="op" id="4970282">.</span><span class="ident" id="4970283">Int</span><span class="op" id="4970286">)</span><span class="op" id="4970287">.</span><span class="ident" id="4970288">Sub</span><span class="op" id="4970291">(</span><span class="ident" id="4970292">p</span><span class="op" id="4970293">,</span>&nbsp;<span class="ident" id="4970295">one</span><span class="op" id="4970298">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4970301">e</span>&nbsp;<span class="op" id="4970303">:=</span>&nbsp;<span class="builtinfunc" id="4970306">new</span><span class="op" id="4970309">(</span><span class="ident" id="4970310">big</span><span class="op" id="4970313">.</span><span class="ident" id="4970314">Int</span><span class="op" id="4970317">)</span><span class="op" id="4970318">.</span><span class="ident" id="4970319">Div</span><span class="op" id="4970322">(</span><span class="ident" id="4970323">pm1</span><span class="op" id="4970326">,</span>&nbsp;<span class="ident" id="4970328">q</span><span class="op" id="4970329">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4970333">for</span>&nbsp;<span class="op" id="4970337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4970341">g</span><span class="op" id="4970342">.</span><span class="ident" id="4970343">Exp</span><span class="op" id="4970346">(</span><span class="ident" id="4970347">h</span><span class="op" id="4970348">,</span>&nbsp;<span class="ident" id="4970350">e</span><span class="op" id="4970351">,</span>&nbsp;<span class="ident" id="4970353">p</span><span class="op" id="4970354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4970358">if</span>&nbsp;<span class="ident" id="4970361">g</span><span class="op" id="4970362">.</span><span class="ident" id="4970363">Cmp</span><span class="op" id="4970366">(</span><span class="ident" id="4970367">one</span><span class="op" id="4970370">)</span>&nbsp;<span class="op" id="4970372">==</span>&nbsp;<span class="num" id="4970375">0</span>&nbsp;<span class="op" id="4970377">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4970382">h</span><span class="op" id="4970383">.</span><span class="ident" id="4970384">Add</span><span class="op" id="4970387">(</span><span class="ident" id="4970388">h</span><span class="op" id="4970389">,</span>&nbsp;<span class="ident" id="4970391">one</span><span class="op" id="4970394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4970399">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4970410">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4970415">params</span><span class="op" id="4970421">.</span><span class="ident" id="4970422">G</span>&nbsp;<span class="op" id="4970424">=</span>&nbsp;<span class="ident" id="4970426">g</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4970430">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4970438">}</span><br>
<span class="lineno"></span><span class="op" id="4970440">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4970443">//&nbsp;GenerateKey&nbsp;generates&nbsp;a&nbsp;public&amp;private&nbsp;key&nbsp;pair.&nbsp;The&nbsp;Parameters&nbsp;of&nbsp;the</span><br>
<span class="lineno">150</span><span class="comment" id="4970517">//&nbsp;PrivateKey&nbsp;must&nbsp;already&nbsp;be&nbsp;valid&nbsp;(see&nbsp;GenerateParameters).</span><br>
<span class="lineno"></span><span class="keyword" id="4970579">func</span>&nbsp;<span class="ident" id="4970584">GenerateKey</span><span class="op" id="4970595">(</span><span class="ident" id="4970596">priv</span>&nbsp;<span class="op" id="4970601">*</span><span class="ident" id="4970602">PrivateKey</span><span class="op" id="4970612">,</span>&nbsp;<span class="ident" id="4970614">rand</span>&nbsp;<span class="ident" id="4970619">io</span><span class="op" id="4970621">.</span><span class="ident" id="4970622">Reader</span><span class="op" id="4970628">)</span>&nbsp;<span class="builtintype" id="4970630">error</span>&nbsp;<span class="op" id="4970636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4970639">if</span>&nbsp;<span class="ident" id="4970642">priv</span><span class="op" id="4970646">.</span><span class="ident" id="4970647">P</span>&nbsp;<span class="op" id="4970649">==</span>&nbsp;<span class="ident" id="4970652">nil</span>&nbsp;<span class="op" id="4970656">||</span>&nbsp;<span class="ident" id="4970659">priv</span><span class="op" id="4970663">.</span><span class="ident" id="4970664">Q</span>&nbsp;<span class="op" id="4970666">==</span>&nbsp;<span class="ident" id="4970669">nil</span>&nbsp;<span class="op" id="4970673">||</span>&nbsp;<span class="ident" id="4970676">priv</span><span class="op" id="4970680">.</span><span class="ident" id="4970681">G</span>&nbsp;<span class="op" id="4970683">==</span>&nbsp;<span class="ident" id="4970686">nil</span>&nbsp;<span class="op" id="4970690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4970694">return</span>&nbsp;<span class="ident" id="4970701">errors</span><span class="op" id="4970707">.</span><span class="ident" id="4970708">New</span><span class="op" id="4970711">(</span><span class="string" id="4970712">&#34;crypto/dsa:&nbsp;parameters&nbsp;not&nbsp;set&nbsp;up&nbsp;before&nbsp;generating&nbsp;key&#34;</span><span class="op" id="4970769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4970772">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4970776">x</span>&nbsp;<span class="op" id="4970778">:=</span>&nbsp;<span class="builtinfunc" id="4970781">new</span><span class="op" id="4970784">(</span><span class="ident" id="4970785">big</span><span class="op" id="4970788">.</span><span class="ident" id="4970789">Int</span><span class="op" id="4970792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4970795">xBytes</span>&nbsp;<span class="op" id="4970802">:=</span>&nbsp;<span class="builtinfunc" id="4970805">make</span><span class="op" id="4970809">(</span><span class="op" id="4970810">[</span><span class="op" id="4970811">]</span><span class="builtintype" id="4970812">byte</span><span class="op" id="4970816">,</span>&nbsp;<span class="ident" id="4970818">priv</span><span class="op" id="4970822">.</span><span class="ident" id="4970823">Q</span><span class="op" id="4970824">.</span><span class="ident" id="4970825">BitLen</span><span class="op" id="4970831">(</span><span class="op" id="4970832">)</span><span class="op" id="4970833">/</span><span class="num" id="4970834">8</span><span class="op" id="4970835">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4970839">for</span>&nbsp;<span class="op" id="4970843">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4970847">_</span><span class="op" id="4970848">,</span>&nbsp;<span class="ident" id="4970850">err</span>&nbsp;<span class="op" id="4970854">:=</span>&nbsp;<span class="ident" id="4970857">io</span><span class="op" id="4970859">.</span><span class="ident" id="4970860">ReadFull</span><span class="op" id="4970868">(</span><span class="ident" id="4970869">rand</span><span class="op" id="4970873">,</span>&nbsp;<span class="ident" id="4970875">xBytes</span><span class="op" id="4970881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4970885">if</span>&nbsp;<span class="ident" id="4970888">err</span>&nbsp;<span class="op" id="4970892">!=</span>&nbsp;<span class="ident" id="4970895">nil</span>&nbsp;<span class="op" id="4970899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4970904">return</span>&nbsp;<span class="ident" id="4970911">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4970917">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4970921">x</span><span class="op" id="4970922">.</span><span class="ident" id="4970923">SetBytes</span><span class="op" id="4970931">(</span><span class="ident" id="4970932">xBytes</span><span class="op" id="4970938">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4970942">if</span>&nbsp;<span class="ident" id="4970945">x</span><span class="op" id="4970946">.</span><span class="ident" id="4970947">Sign</span><span class="op" id="4970951">(</span><span class="op" id="4970952">)</span>&nbsp;<span class="op" id="4970954">!=</span>&nbsp;<span class="num" id="4970957">0</span>&nbsp;<span class="op" id="4970959">&amp;&amp;</span>&nbsp;<span class="ident" id="4970962">x</span><span class="op" id="4970963">.</span><span class="ident" id="4970964">Cmp</span><span class="op" id="4970967">(</span><span class="ident" id="4970968">priv</span><span class="op" id="4970972">.</span><span class="ident" id="4970973">Q</span><span class="op" id="4970974">)</span>&nbsp;<span class="op" id="4970976">&lt;</span>&nbsp;<span class="num" id="4970978">0</span>&nbsp;<span class="op" id="4970980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4970985">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4970993">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4970996">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4971000">priv</span><span class="op" id="4971004">.</span><span class="ident" id="4971005">X</span>&nbsp;<span class="op" id="4971007">=</span>&nbsp;<span class="ident" id="4971009">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4971012">priv</span><span class="op" id="4971016">.</span><span class="ident" id="4971017">Y</span>&nbsp;<span class="op" id="4971019">=</span>&nbsp;<span class="builtinfunc" id="4971021">new</span><span class="op" id="4971024">(</span><span class="ident" id="4971025">big</span><span class="op" id="4971028">.</span><span class="ident" id="4971029">Int</span><span class="op" id="4971032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4971035">priv</span><span class="op" id="4971039">.</span><span class="ident" id="4971040">Y</span><span class="op" id="4971041">.</span><span class="ident" id="4971042">Exp</span><span class="op" id="4971045">(</span><span class="ident" id="4971046">priv</span><span class="op" id="4971050">.</span><span class="ident" id="4971051">G</span><span class="op" id="4971052">,</span>&nbsp;<span class="ident" id="4971054">x</span><span class="op" id="4971055">,</span>&nbsp;<span class="ident" id="4971057">priv</span><span class="op" id="4971061">.</span><span class="ident" id="4971062">P</span><span class="op" id="4971063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4971066">return</span>&nbsp;<span class="ident" id="4971073">nil</span><br>
<span class="lineno"></span><span class="op" id="4971077">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="comment" id="4971080">//&nbsp;fermatInverse&nbsp;calculates&nbsp;the&nbsp;inverse&nbsp;of&nbsp;k&nbsp;in&nbsp;GF(P)&nbsp;using&nbsp;Fermat&#39;s&nbsp;method.</span><br>
<span class="lineno"></span><span class="comment" id="4971157">//&nbsp;This&nbsp;has&nbsp;better&nbsp;constant-time&nbsp;properties&nbsp;than&nbsp;Euclid&#39;s&nbsp;method&nbsp;(implemented</span><br>
<span class="lineno"></span><span class="comment" id="4971235">//&nbsp;in&nbsp;math/big.Int.ModInverse)&nbsp;although&nbsp;math/big&nbsp;itself&nbsp;isn&#39;t&nbsp;strictly</span><br>
<span class="lineno"></span><span class="comment" id="4971306">//&nbsp;constant-time&nbsp;so&nbsp;it&#39;s&nbsp;not&nbsp;perfect.</span><br>
<span class="lineno">180</span><span class="keyword" id="4971344">func</span>&nbsp;<span class="ident" id="4971349">fermatInverse</span><span class="op" id="4971362">(</span><span class="ident" id="4971363">k</span><span class="op" id="4971364">,</span>&nbsp;<span class="ident" id="4971366">P</span>&nbsp;<span class="op" id="4971368">*</span><span class="ident" id="4971369">big</span><span class="op" id="4971372">.</span><span class="ident" id="4971373">Int</span><span class="op" id="4971376">)</span>&nbsp;<span class="op" id="4971378">*</span><span class="ident" id="4971379">big</span><span class="op" id="4971382">.</span><span class="ident" id="4971383">Int</span>&nbsp;<span class="op" id="4971387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4971390">two</span>&nbsp;<span class="op" id="4971394">:=</span>&nbsp;<span class="ident" id="4971397">big</span><span class="op" id="4971400">.</span><span class="ident" id="4971401">NewInt</span><span class="op" id="4971407">(</span><span class="num" id="4971408">2</span><span class="op" id="4971409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4971412">pMinus2</span>&nbsp;<span class="op" id="4971420">:=</span>&nbsp;<span class="builtinfunc" id="4971423">new</span><span class="op" id="4971426">(</span><span class="ident" id="4971427">big</span><span class="op" id="4971430">.</span><span class="ident" id="4971431">Int</span><span class="op" id="4971434">)</span><span class="op" id="4971435">.</span><span class="ident" id="4971436">Sub</span><span class="op" id="4971439">(</span><span class="ident" id="4971440">P</span><span class="op" id="4971441">,</span>&nbsp;<span class="ident" id="4971443">two</span><span class="op" id="4971446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4971449">return</span>&nbsp;<span class="builtinfunc" id="4971456">new</span><span class="op" id="4971459">(</span><span class="ident" id="4971460">big</span><span class="op" id="4971463">.</span><span class="ident" id="4971464">Int</span><span class="op" id="4971467">)</span><span class="op" id="4971468">.</span><span class="ident" id="4971469">Exp</span><span class="op" id="4971472">(</span><span class="ident" id="4971473">k</span><span class="op" id="4971474">,</span>&nbsp;<span class="ident" id="4971476">pMinus2</span><span class="op" id="4971483">,</span>&nbsp;<span class="ident" id="4971485">P</span><span class="op" id="4971486">)</span><br>
<span class="lineno"></span><span class="op" id="4971488">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span><span class="comment" id="4971491">//&nbsp;Sign&nbsp;signs&nbsp;an&nbsp;arbitrary&nbsp;length&nbsp;hash&nbsp;(which&nbsp;should&nbsp;be&nbsp;the&nbsp;result&nbsp;of&nbsp;hashing&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4971571">//&nbsp;larger&nbsp;message)&nbsp;using&nbsp;the&nbsp;private&nbsp;key,&nbsp;priv.&nbsp;It&nbsp;returns&nbsp;the&nbsp;signature&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4971649">//&nbsp;pair&nbsp;of&nbsp;integers.&nbsp;The&nbsp;security&nbsp;of&nbsp;the&nbsp;private&nbsp;key&nbsp;depends&nbsp;on&nbsp;the&nbsp;entropy&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4971728">//&nbsp;rand.</span><br>
<span class="lineno">190</span><span class="comment" id="4971737">//</span><br>
<span class="lineno"></span><span class="comment" id="4971740">//&nbsp;Note&nbsp;that&nbsp;FIPS&nbsp;186-3&nbsp;section&nbsp;4.6&nbsp;specifies&nbsp;that&nbsp;the&nbsp;hash&nbsp;should&nbsp;be&nbsp;truncated</span><br>
<span class="lineno"></span><span class="comment" id="4971820">//&nbsp;to&nbsp;the&nbsp;byte-length&nbsp;of&nbsp;the&nbsp;subgroup.&nbsp;This&nbsp;function&nbsp;does&nbsp;not&nbsp;perform&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4971895">//&nbsp;truncation&nbsp;itself.</span><br>
<span class="lineno"></span><span class="keyword" id="4971917">func</span>&nbsp;<span class="ident" id="4971922">Sign</span><span class="op" id="4971926">(</span><span class="ident" id="4971927">rand</span>&nbsp;<span class="ident" id="4971932">io</span><span class="op" id="4971934">.</span><span class="ident" id="4971935">Reader</span><span class="op" id="4971941">,</span>&nbsp;<span class="ident" id="4971943">priv</span>&nbsp;<span class="op" id="4971948">*</span><span class="ident" id="4971949">PrivateKey</span><span class="op" id="4971959">,</span>&nbsp;<span class="ident" id="4971961">hash</span>&nbsp;<span class="op" id="4971966">[</span><span class="op" id="4971967">]</span><span class="builtintype" id="4971968">byte</span><span class="op" id="4971972">)</span>&nbsp;<span class="op" id="4971974">(</span><span class="ident" id="4971975">r</span><span class="op" id="4971976">,</span>&nbsp;<span class="ident" id="4971978">s</span>&nbsp;<span class="op" id="4971980">*</span><span class="ident" id="4971981">big</span><span class="op" id="4971984">.</span><span class="ident" id="4971985">Int</span><span class="op" id="4971988">,</span>&nbsp;<span class="ident" id="4971990">err</span>&nbsp;<span class="builtintype" id="4971994">error</span><span class="op" id="4971999">)</span>&nbsp;<span class="op" id="4972001">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4972004">//&nbsp;FIPS&nbsp;186-3,&nbsp;section&nbsp;4.6</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972033">n</span>&nbsp;<span class="op" id="4972035">:=</span>&nbsp;<span class="ident" id="4972038">priv</span><span class="op" id="4972042">.</span><span class="ident" id="4972043">Q</span><span class="op" id="4972044">.</span><span class="ident" id="4972045">BitLen</span><span class="op" id="4972051">(</span><span class="op" id="4972052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4972055">if</span>&nbsp;<span class="ident" id="4972058">n</span><span class="op" id="4972059">&amp;</span><span class="num" id="4972060">7</span>&nbsp;<span class="op" id="4972062">!=</span>&nbsp;<span class="num" id="4972065">0</span>&nbsp;<span class="op" id="4972067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972071">err</span>&nbsp;<span class="op" id="4972075">=</span>&nbsp;<span class="ident" id="4972077">ErrInvalidPublicKey</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4972099">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4972107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972110">n</span>&nbsp;<span class="op" id="4972112">&gt;&gt;=</span>&nbsp;<span class="num" id="4972116">3</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4972120">for</span>&nbsp;<span class="op" id="4972124">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972128">k</span>&nbsp;<span class="op" id="4972130">:=</span>&nbsp;<span class="builtinfunc" id="4972133">new</span><span class="op" id="4972136">(</span><span class="ident" id="4972137">big</span><span class="op" id="4972140">.</span><span class="ident" id="4972141">Int</span><span class="op" id="4972144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972148">buf</span>&nbsp;<span class="op" id="4972152">:=</span>&nbsp;<span class="builtinfunc" id="4972155">make</span><span class="op" id="4972159">(</span><span class="op" id="4972160">[</span><span class="op" id="4972161">]</span><span class="builtintype" id="4972162">byte</span><span class="op" id="4972166">,</span>&nbsp;<span class="ident" id="4972168">n</span><span class="op" id="4972169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4972173">for</span>&nbsp;<span class="op" id="4972177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972182">_</span><span class="op" id="4972183">,</span>&nbsp;<span class="ident" id="4972185">err</span>&nbsp;<span class="op" id="4972189">=</span>&nbsp;<span class="ident" id="4972191">io</span><span class="op" id="4972193">.</span><span class="ident" id="4972194">ReadFull</span><span class="op" id="4972202">(</span><span class="ident" id="4972203">rand</span><span class="op" id="4972207">,</span>&nbsp;<span class="ident" id="4972209">buf</span><span class="op" id="4972212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4972217">if</span>&nbsp;<span class="ident" id="4972220">err</span>&nbsp;<span class="op" id="4972224">!=</span>&nbsp;<span class="ident" id="4972227">nil</span>&nbsp;<span class="op" id="4972231">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4972237">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4972247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972252">k</span><span class="op" id="4972253">.</span><span class="ident" id="4972254">SetBytes</span><span class="op" id="4972262">(</span><span class="ident" id="4972263">buf</span><span class="op" id="4972266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4972271">if</span>&nbsp;<span class="ident" id="4972274">k</span><span class="op" id="4972275">.</span><span class="ident" id="4972276">Sign</span><span class="op" id="4972280">(</span><span class="op" id="4972281">)</span>&nbsp;<span class="op" id="4972283">&gt;</span>&nbsp;<span class="num" id="4972285">0</span>&nbsp;<span class="op" id="4972287">&amp;&amp;</span>&nbsp;<span class="ident" id="4972290">k</span><span class="op" id="4972291">.</span><span class="ident" id="4972292">Cmp</span><span class="op" id="4972295">(</span><span class="ident" id="4972296">priv</span><span class="op" id="4972300">.</span><span class="ident" id="4972301">Q</span><span class="op" id="4972302">)</span>&nbsp;<span class="op" id="4972304">&lt;</span>&nbsp;<span class="num" id="4972306">0</span>&nbsp;<span class="op" id="4972308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4972314">break</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4972323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4972327">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972332">kInv</span>&nbsp;<span class="op" id="4972337">:=</span>&nbsp;<span class="ident" id="4972340">fermatInverse</span><span class="op" id="4972353">(</span><span class="ident" id="4972354">k</span><span class="op" id="4972355">,</span>&nbsp;<span class="ident" id="4972357">priv</span><span class="op" id="4972361">.</span><span class="ident" id="4972362">Q</span><span class="op" id="4972363">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972368">r</span>&nbsp;<span class="op" id="4972370">=</span>&nbsp;<span class="builtinfunc" id="4972372">new</span><span class="op" id="4972375">(</span><span class="ident" id="4972376">big</span><span class="op" id="4972379">.</span><span class="ident" id="4972380">Int</span><span class="op" id="4972383">)</span><span class="op" id="4972384">.</span><span class="ident" id="4972385">Exp</span><span class="op" id="4972388">(</span><span class="ident" id="4972389">priv</span><span class="op" id="4972393">.</span><span class="ident" id="4972394">G</span><span class="op" id="4972395">,</span>&nbsp;<span class="ident" id="4972397">k</span><span class="op" id="4972398">,</span>&nbsp;<span class="ident" id="4972400">priv</span><span class="op" id="4972404">.</span><span class="ident" id="4972405">P</span><span class="op" id="4972406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972410">r</span><span class="op" id="4972411">.</span><span class="ident" id="4972412">Mod</span><span class="op" id="4972415">(</span><span class="ident" id="4972416">r</span><span class="op" id="4972417">,</span>&nbsp;<span class="ident" id="4972419">priv</span><span class="op" id="4972423">.</span><span class="ident" id="4972424">Q</span><span class="op" id="4972425">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4972430">if</span>&nbsp;<span class="ident" id="4972433">r</span><span class="op" id="4972434">.</span><span class="ident" id="4972435">Sign</span><span class="op" id="4972439">(</span><span class="op" id="4972440">)</span>&nbsp;<span class="op" id="4972442">==</span>&nbsp;<span class="num" id="4972445">0</span>&nbsp;<span class="op" id="4972447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4972452">continue</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4972463">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972468">z</span>&nbsp;<span class="op" id="4972470">:=</span>&nbsp;<span class="ident" id="4972473">k</span><span class="op" id="4972474">.</span><span class="ident" id="4972475">SetBytes</span><span class="op" id="4972483">(</span><span class="ident" id="4972484">hash</span><span class="op" id="4972488">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972493">s</span>&nbsp;<span class="op" id="4972495">=</span>&nbsp;<span class="builtinfunc" id="4972497">new</span><span class="op" id="4972500">(</span><span class="ident" id="4972501">big</span><span class="op" id="4972504">.</span><span class="ident" id="4972505">Int</span><span class="op" id="4972508">)</span><span class="op" id="4972509">.</span><span class="ident" id="4972510">Mul</span><span class="op" id="4972513">(</span><span class="ident" id="4972514">priv</span><span class="op" id="4972518">.</span><span class="ident" id="4972519">X</span><span class="op" id="4972520">,</span>&nbsp;<span class="ident" id="4972522">r</span><span class="op" id="4972523">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972527">s</span><span class="op" id="4972528">.</span><span class="ident" id="4972529">Add</span><span class="op" id="4972532">(</span><span class="ident" id="4972533">s</span><span class="op" id="4972534">,</span>&nbsp;<span class="ident" id="4972536">z</span><span class="op" id="4972537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972541">s</span><span class="op" id="4972542">.</span><span class="ident" id="4972543">Mod</span><span class="op" id="4972546">(</span><span class="ident" id="4972547">s</span><span class="op" id="4972548">,</span>&nbsp;<span class="ident" id="4972550">priv</span><span class="op" id="4972554">.</span><span class="ident" id="4972555">Q</span><span class="op" id="4972556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972560">s</span><span class="op" id="4972561">.</span><span class="ident" id="4972562">Mul</span><span class="op" id="4972565">(</span><span class="ident" id="4972566">s</span><span class="op" id="4972567">,</span>&nbsp;<span class="ident" id="4972569">kInv</span><span class="op" id="4972573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972577">s</span><span class="op" id="4972578">.</span><span class="ident" id="4972579">Mod</span><span class="op" id="4972582">(</span><span class="ident" id="4972583">s</span><span class="op" id="4972584">,</span>&nbsp;<span class="ident" id="4972586">priv</span><span class="op" id="4972590">.</span><span class="ident" id="4972591">Q</span><span class="op" id="4972592">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4972597">if</span>&nbsp;<span class="ident" id="4972600">s</span><span class="op" id="4972601">.</span><span class="ident" id="4972602">Sign</span><span class="op" id="4972606">(</span><span class="op" id="4972607">)</span>&nbsp;<span class="op" id="4972609">!=</span>&nbsp;<span class="num" id="4972612">0</span>&nbsp;<span class="op" id="4972614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4972619">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4972627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4972630">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4972634">return</span><br>
<span class="lineno"></span><span class="op" id="4972641">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4972644">//&nbsp;Verify&nbsp;verifies&nbsp;the&nbsp;signature&nbsp;in&nbsp;r,&nbsp;s&nbsp;of&nbsp;hash&nbsp;using&nbsp;the&nbsp;public&nbsp;key,&nbsp;pub.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="4972723">//&nbsp;reports&nbsp;whether&nbsp;the&nbsp;signature&nbsp;is&nbsp;valid.</span><br>
<span class="lineno">245</span><span class="comment" id="4972766">//</span><br>
<span class="lineno"></span><span class="comment" id="4972769">//&nbsp;Note&nbsp;that&nbsp;FIPS&nbsp;186-3&nbsp;section&nbsp;4.6&nbsp;specifies&nbsp;that&nbsp;the&nbsp;hash&nbsp;should&nbsp;be&nbsp;truncated</span><br>
<span class="lineno"></span><span class="comment" id="4972849">//&nbsp;to&nbsp;the&nbsp;byte-length&nbsp;of&nbsp;the&nbsp;subgroup.&nbsp;This&nbsp;function&nbsp;does&nbsp;not&nbsp;perform&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4972924">//&nbsp;truncation&nbsp;itself.</span><br>
<span class="lineno"></span><span class="keyword" id="4972946">func</span>&nbsp;<span class="ident" id="4972951">Verify</span><span class="op" id="4972957">(</span><span class="ident" id="4972958">pub</span>&nbsp;<span class="op" id="4972962">*</span><span class="ident" id="4972963">PublicKey</span><span class="op" id="4972972">,</span>&nbsp;<span class="ident" id="4972974">hash</span>&nbsp;<span class="op" id="4972979">[</span><span class="op" id="4972980">]</span><span class="builtintype" id="4972981">byte</span><span class="op" id="4972985">,</span>&nbsp;<span class="ident" id="4972987">r</span><span class="op" id="4972988">,</span>&nbsp;<span class="ident" id="4972990">s</span>&nbsp;<span class="op" id="4972992">*</span><span class="ident" id="4972993">big</span><span class="op" id="4972996">.</span><span class="ident" id="4972997">Int</span><span class="op" id="4973000">)</span>&nbsp;<span class="builtintype" id="4973002">bool</span>&nbsp;<span class="op" id="4973007">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4973010">//&nbsp;FIPS&nbsp;186-3,&nbsp;section&nbsp;4.7</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4973039">if</span>&nbsp;<span class="ident" id="4973042">r</span><span class="op" id="4973043">.</span><span class="ident" id="4973044">Sign</span><span class="op" id="4973048">(</span><span class="op" id="4973049">)</span>&nbsp;<span class="op" id="4973051">&lt;</span>&nbsp;<span class="num" id="4973053">1</span>&nbsp;<span class="op" id="4973055">||</span>&nbsp;<span class="ident" id="4973058">r</span><span class="op" id="4973059">.</span><span class="ident" id="4973060">Cmp</span><span class="op" id="4973063">(</span><span class="ident" id="4973064">pub</span><span class="op" id="4973067">.</span><span class="ident" id="4973068">Q</span><span class="op" id="4973069">)</span>&nbsp;<span class="op" id="4973071">&gt;=</span>&nbsp;<span class="num" id="4973074">0</span>&nbsp;<span class="op" id="4973076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4973080">return</span>&nbsp;<span class="builtintype" id="4973087">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4973094">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4973097">if</span>&nbsp;<span class="ident" id="4973100">s</span><span class="op" id="4973101">.</span><span class="ident" id="4973102">Sign</span><span class="op" id="4973106">(</span><span class="op" id="4973107">)</span>&nbsp;<span class="op" id="4973109">&lt;</span>&nbsp;<span class="num" id="4973111">1</span>&nbsp;<span class="op" id="4973113">||</span>&nbsp;<span class="ident" id="4973116">s</span><span class="op" id="4973117">.</span><span class="ident" id="4973118">Cmp</span><span class="op" id="4973121">(</span><span class="ident" id="4973122">pub</span><span class="op" id="4973125">.</span><span class="ident" id="4973126">Q</span><span class="op" id="4973127">)</span>&nbsp;<span class="op" id="4973129">&gt;=</span>&nbsp;<span class="num" id="4973132">0</span>&nbsp;<span class="op" id="4973134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4973138">return</span>&nbsp;<span class="builtintype" id="4973145">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4973152">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4973156">w</span>&nbsp;<span class="op" id="4973158">:=</span>&nbsp;<span class="builtinfunc" id="4973161">new</span><span class="op" id="4973164">(</span><span class="ident" id="4973165">big</span><span class="op" id="4973168">.</span><span class="ident" id="4973169">Int</span><span class="op" id="4973172">)</span><span class="op" id="4973173">.</span><span class="ident" id="4973174">ModInverse</span><span class="op" id="4973184">(</span><span class="ident" id="4973185">s</span><span class="op" id="4973186">,</span>&nbsp;<span class="ident" id="4973188">pub</span><span class="op" id="4973191">.</span><span class="ident" id="4973192">Q</span><span class="op" id="4973193">)</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4973197">n</span>&nbsp;<span class="op" id="4973199">:=</span>&nbsp;<span class="ident" id="4973202">pub</span><span class="op" id="4973205">.</span><span class="ident" id="4973206">Q</span><span class="op" id="4973207">.</span><span class="ident" id="4973208">BitLen</span><span class="op" id="4973214">(</span><span class="op" id="4973215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4973218">if</span>&nbsp;<span class="ident" id="4973221">n</span><span class="op" id="4973222">&amp;</span><span class="num" id="4973223">7</span>&nbsp;<span class="op" id="4973225">!=</span>&nbsp;<span class="num" id="4973228">0</span>&nbsp;<span class="op" id="4973230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4973234">return</span>&nbsp;<span class="builtintype" id="4973241">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4973248">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4973251">z</span>&nbsp;<span class="op" id="4973253">:=</span>&nbsp;<span class="builtinfunc" id="4973256">new</span><span class="op" id="4973259">(</span><span class="ident" id="4973260">big</span><span class="op" id="4973263">.</span><span class="ident" id="4973264">Int</span><span class="op" id="4973267">)</span><span class="op" id="4973268">.</span><span class="ident" id="4973269">SetBytes</span><span class="op" id="4973277">(</span><span class="ident" id="4973278">hash</span><span class="op" id="4973282">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4973286">u1</span>&nbsp;<span class="op" id="4973289">:=</span>&nbsp;<span class="builtinfunc" id="4973292">new</span><span class="op" id="4973295">(</span><span class="ident" id="4973296">big</span><span class="op" id="4973299">.</span><span class="ident" id="4973300">Int</span><span class="op" id="4973303">)</span><span class="op" id="4973304">.</span><span class="ident" id="4973305">Mul</span><span class="op" id="4973308">(</span><span class="ident" id="4973309">z</span><span class="op" id="4973310">,</span>&nbsp;<span class="ident" id="4973312">w</span><span class="op" id="4973313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4973316">u1</span><span class="op" id="4973318">.</span><span class="ident" id="4973319">Mod</span><span class="op" id="4973322">(</span><span class="ident" id="4973323">u1</span><span class="op" id="4973325">,</span>&nbsp;<span class="ident" id="4973327">pub</span><span class="op" id="4973330">.</span><span class="ident" id="4973331">Q</span><span class="op" id="4973332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4973335">u2</span>&nbsp;<span class="op" id="4973338">:=</span>&nbsp;<span class="ident" id="4973341">w</span><span class="op" id="4973342">.</span><span class="ident" id="4973343">Mul</span><span class="op" id="4973346">(</span><span class="ident" id="4973347">r</span><span class="op" id="4973348">,</span>&nbsp;<span class="ident" id="4973350">w</span><span class="op" id="4973351">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4973354">u2</span><span class="op" id="4973356">.</span><span class="ident" id="4973357">Mod</span><span class="op" id="4973360">(</span><span class="ident" id="4973361">u2</span><span class="op" id="4973363">,</span>&nbsp;<span class="ident" id="4973365">pub</span><span class="op" id="4973368">.</span><span class="ident" id="4973369">Q</span><span class="op" id="4973370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4973373">v</span>&nbsp;<span class="op" id="4973375">:=</span>&nbsp;<span class="ident" id="4973378">u1</span><span class="op" id="4973380">.</span><span class="ident" id="4973381">Exp</span><span class="op" id="4973384">(</span><span class="ident" id="4973385">pub</span><span class="op" id="4973388">.</span><span class="ident" id="4973389">G</span><span class="op" id="4973390">,</span>&nbsp;<span class="ident" id="4973392">u1</span><span class="op" id="4973394">,</span>&nbsp;<span class="ident" id="4973396">pub</span><span class="op" id="4973399">.</span><span class="ident" id="4973400">P</span><span class="op" id="4973401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4973404">u2</span><span class="op" id="4973406">.</span><span class="ident" id="4973407">Exp</span><span class="op" id="4973410">(</span><span class="ident" id="4973411">pub</span><span class="op" id="4973414">.</span><span class="ident" id="4973415">Y</span><span class="op" id="4973416">,</span>&nbsp;<span class="ident" id="4973418">u2</span><span class="op" id="4973420">,</span>&nbsp;<span class="ident" id="4973422">pub</span><span class="op" id="4973425">.</span><span class="ident" id="4973426">P</span><span class="op" id="4973427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4973430">v</span><span class="op" id="4973431">.</span><span class="ident" id="4973432">Mul</span><span class="op" id="4973435">(</span><span class="ident" id="4973436">v</span><span class="op" id="4973437">,</span>&nbsp;<span class="ident" id="4973439">u2</span><span class="op" id="4973441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4973444">v</span><span class="op" id="4973445">.</span><span class="ident" id="4973446">Mod</span><span class="op" id="4973449">(</span><span class="ident" id="4973450">v</span><span class="op" id="4973451">,</span>&nbsp;<span class="ident" id="4973453">pub</span><span class="op" id="4973456">.</span><span class="ident" id="4973457">P</span><span class="op" id="4973458">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4973461">v</span><span class="op" id="4973462">.</span><span class="ident" id="4973463">Mod</span><span class="op" id="4973466">(</span><span class="ident" id="4973467">v</span><span class="op" id="4973468">,</span>&nbsp;<span class="ident" id="4973470">pub</span><span class="op" id="4973473">.</span><span class="ident" id="4973474">Q</span><span class="op" id="4973475">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4973479">return</span>&nbsp;<span class="ident" id="4973486">v</span><span class="op" id="4973487">.</span><span class="ident" id="4973488">Cmp</span><span class="op" id="4973491">(</span><span class="ident" id="4973492">r</span><span class="op" id="4973493">)</span>&nbsp;<span class="op" id="4973495">==</span>&nbsp;<span class="num" id="4973498">0</span><br>
<span class="lineno"></span><span class="op" id="4973500">}</span>
</div>
</body>
</html>
