<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/cipher</h2>
<ul>
<li><a href="/gostd/crypto/cipher/benchmark_test.go.html">benchmark_test.go</a></li>
<li><a href="/gostd/crypto/cipher/cbc.go.html">cbc.go</a></li>
<li><a href="/gostd/crypto/cipher/cbc_aes_test.go.html">cbc_aes_test.go</a></li>
<li><a href="/gostd/crypto/cipher/cfb.go.html">cfb.go</a></li>
<li><a href="/gostd/crypto/cipher/cfb_test.go.html">cfb_test.go</a></li>
<li><a href="/gostd/crypto/cipher/cipher.go.html">cipher.go</a></li>
<li><a href="/gostd/crypto/cipher/cipher_test.go.html">cipher_test.go</a></li>
<li><a href="/gostd/crypto/cipher/common_test.go.html">common_test.go</a></li>
<li><a href="/gostd/crypto/cipher/ctr.go.html">ctr.go</a></li>
<li><a href="/gostd/crypto/cipher/ctr_aes_test.go.html">ctr_aes_test.go</a></li>
<li><a href="/gostd/crypto/cipher/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/cipher/gcm.go.html" class="current">gcm.go</a></li>
<li><a href="/gostd/crypto/cipher/gcm_test.go.html">gcm_test.go</a></li>
<li><a href="/gostd/crypto/cipher/io.go.html">io.go</a></li>
<li><a href="/gostd/crypto/cipher/ofb.go.html">ofb.go</a></li>
<li><a href="/gostd/crypto/cipher/ofb_test.go.html">ofb_test.go</a></li>
<li><a href="/gostd/crypto/cipher/xor.go.html">xor.go</a></li>
<li><a href="/gostd/crypto/cipher/xor_test.go.html">xor_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3740317">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3740372">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3740426">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3740477">package</span>&nbsp;<span class="ident" id="3740485">cipher</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3740493">import</span>&nbsp;<span class="op" id="3740500">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3740503">&#34;crypto/subtle&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3740520">&#34;errors&#34;</span><br>
<span class="lineno">10</span><span class="op" id="3740529">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3740532">//&nbsp;AEAD&nbsp;is&nbsp;a&nbsp;cipher&nbsp;mode&nbsp;providing&nbsp;authenticated&nbsp;encryption&nbsp;with&nbsp;associated</span><br>
<span class="lineno"></span><span class="comment" id="3740608">//&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="3740617">type</span>&nbsp;<span class="ident" id="3740622">AEAD</span>&nbsp;<span class="keyword" id="3740627">interface</span>&nbsp;<span class="op" id="3740637">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3740640">//&nbsp;NonceSize&nbsp;returns&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;nonce&nbsp;that&nbsp;must&nbsp;be&nbsp;passed&nbsp;to&nbsp;Seal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3740712">//&nbsp;and&nbsp;Open.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3740726">NonceSize</span><span class="op" id="3740735">(</span><span class="op" id="3740736">)</span>&nbsp;<span class="builtintype" id="3740738">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3740744">//&nbsp;Overhead&nbsp;returns&nbsp;the&nbsp;maximum&nbsp;difference&nbsp;between&nbsp;the&nbsp;lengths&nbsp;of&nbsp;a</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3740813">//&nbsp;plaintext&nbsp;and&nbsp;ciphertext.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3740843">Overhead</span><span class="op" id="3740851">(</span><span class="op" id="3740852">)</span>&nbsp;<span class="builtintype" id="3740854">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3740860">//&nbsp;Seal&nbsp;encrypts&nbsp;and&nbsp;authenticates&nbsp;plaintext,&nbsp;authenticates&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3740925">//&nbsp;additional&nbsp;data&nbsp;and&nbsp;appends&nbsp;the&nbsp;result&nbsp;to&nbsp;dst,&nbsp;returning&nbsp;the&nbsp;updated</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3740998">//&nbsp;slice.&nbsp;The&nbsp;nonce&nbsp;must&nbsp;be&nbsp;NonceSize()&nbsp;bytes&nbsp;long&nbsp;and&nbsp;unique&nbsp;for&nbsp;all</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3741069">//&nbsp;time,&nbsp;for&nbsp;a&nbsp;given&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3741096">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3741100">//&nbsp;The&nbsp;plaintext&nbsp;and&nbsp;dst&nbsp;may&nbsp;alias&nbsp;exactly&nbsp;or&nbsp;not&nbsp;at&nbsp;all.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3741159">Seal</span><span class="op" id="3741163">(</span><span class="ident" id="3741164">dst</span><span class="op" id="3741167">,</span>&nbsp;<span class="ident" id="3741169">nonce</span><span class="op" id="3741174">,</span>&nbsp;<span class="ident" id="3741176">plaintext</span><span class="op" id="3741185">,</span>&nbsp;<span class="ident" id="3741187">data</span>&nbsp;<span class="op" id="3741192">[</span><span class="op" id="3741193">]</span><span class="builtintype" id="3741194">byte</span><span class="op" id="3741198">)</span>&nbsp;<span class="op" id="3741200">[</span><span class="op" id="3741201">]</span><span class="builtintype" id="3741202">byte</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3741209">//&nbsp;Open&nbsp;decrypts&nbsp;and&nbsp;authenticates&nbsp;ciphertext,&nbsp;authenticates&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3741275">//&nbsp;additional&nbsp;data&nbsp;and,&nbsp;if&nbsp;successful,&nbsp;appends&nbsp;the&nbsp;resulting&nbsp;plaintext</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3741347">//&nbsp;to&nbsp;dst,&nbsp;returning&nbsp;the&nbsp;updated&nbsp;slice.&nbsp;The&nbsp;nonce&nbsp;must&nbsp;be&nbsp;NonceSize()</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3741418">//&nbsp;bytes&nbsp;long&nbsp;and&nbsp;both&nbsp;it&nbsp;and&nbsp;the&nbsp;additional&nbsp;data&nbsp;must&nbsp;match&nbsp;the</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3741484">//&nbsp;value&nbsp;passed&nbsp;to&nbsp;Seal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3741510">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3741514">//&nbsp;The&nbsp;ciphertext&nbsp;and&nbsp;dst&nbsp;may&nbsp;alias&nbsp;exactly&nbsp;or&nbsp;not&nbsp;at&nbsp;all.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3741574">Open</span><span class="op" id="3741578">(</span><span class="ident" id="3741579">dst</span><span class="op" id="3741582">,</span>&nbsp;<span class="ident" id="3741584">nonce</span><span class="op" id="3741589">,</span>&nbsp;<span class="ident" id="3741591">ciphertext</span><span class="op" id="3741601">,</span>&nbsp;<span class="ident" id="3741603">data</span>&nbsp;<span class="op" id="3741608">[</span><span class="op" id="3741609">]</span><span class="builtintype" id="3741610">byte</span><span class="op" id="3741614">)</span>&nbsp;<span class="op" id="3741616">(</span><span class="op" id="3741617">[</span><span class="op" id="3741618">]</span><span class="builtintype" id="3741619">byte</span><span class="op" id="3741623">,</span>&nbsp;<span class="builtintype" id="3741625">error</span><span class="op" id="3741630">)</span><br>
<span class="lineno"></span><span class="op" id="3741632">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="3741635">//&nbsp;gcmFieldElement&nbsp;represents&nbsp;a&nbsp;value&nbsp;in&nbsp;GF(2¹²⁸).&nbsp;In&nbsp;order&nbsp;to&nbsp;reflect&nbsp;the&nbsp;GCM</span><br>
<span class="lineno"></span><span class="comment" id="3741718">//&nbsp;standard&nbsp;and&nbsp;make&nbsp;getUint64&nbsp;suitable&nbsp;for&nbsp;marshaling&nbsp;these&nbsp;values,&nbsp;the&nbsp;bits</span><br>
<span class="lineno"></span><span class="comment" id="3741796">//&nbsp;are&nbsp;stored&nbsp;backwards.&nbsp;For&nbsp;example:</span><br>
<span class="lineno"></span><span class="comment" id="3741834">//&nbsp;&nbsp;&nbsp;the&nbsp;coefficient&nbsp;of&nbsp;x⁰&nbsp;can&nbsp;be&nbsp;obtained&nbsp;by&nbsp;v.low&nbsp;&gt;&gt;&nbsp;63.</span><br>
<span class="lineno">45</span><span class="comment" id="3741895">//&nbsp;&nbsp;&nbsp;the&nbsp;coefficient&nbsp;of&nbsp;x⁶³&nbsp;can&nbsp;be&nbsp;obtained&nbsp;by&nbsp;v.low&nbsp;&amp;&nbsp;1.</span><br>
<span class="lineno"></span><span class="comment" id="3741956">//&nbsp;&nbsp;&nbsp;the&nbsp;coefficient&nbsp;of&nbsp;x⁶⁴&nbsp;can&nbsp;be&nbsp;obtained&nbsp;by&nbsp;v.high&nbsp;&gt;&gt;&nbsp;63.</span><br>
<span class="lineno"></span><span class="comment" id="3742021">//&nbsp;&nbsp;&nbsp;the&nbsp;coefficient&nbsp;of&nbsp;x¹²⁷&nbsp;can&nbsp;be&nbsp;obtained&nbsp;by&nbsp;v.high&nbsp;&amp;&nbsp;1.</span><br>
<span class="lineno"></span><span class="keyword" id="3742085">type</span>&nbsp;<span class="ident" id="3742090">gcmFieldElement</span>&nbsp;<span class="keyword" id="3742106">struct</span>&nbsp;<span class="op" id="3742113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3742116">low</span><span class="op" id="3742119">,</span>&nbsp;<span class="ident" id="3742121">high</span>&nbsp;<span class="ident" id="3742126">uint64</span><br>
<span class="lineno">50</span><span class="op" id="3742133">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3742136">//&nbsp;gcm&nbsp;represents&nbsp;a&nbsp;Galois&nbsp;Counter&nbsp;Mode&nbsp;with&nbsp;a&nbsp;specific&nbsp;key.&nbsp;See</span><br>
<span class="lineno"></span><span class="comment" id="3742201">//&nbsp;http://csrc.nist.gov/groups/ST/toolkit/BCM/documents/proposedmodes/gcm/gcm-revised-spec.pdf</span><br>
<span class="lineno"></span><span class="keyword" id="3742296">type</span>&nbsp;<span class="ident" id="3742301">gcm</span>&nbsp;<span class="keyword" id="3742305">struct</span>&nbsp;<span class="op" id="3742312">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3742315">cipher</span>&nbsp;<span class="ident" id="3742322">Block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3742329">//&nbsp;productTable&nbsp;contains&nbsp;the&nbsp;first&nbsp;sixteen&nbsp;powers&nbsp;of&nbsp;the&nbsp;key,&nbsp;H.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3742395">//&nbsp;However,&nbsp;they&nbsp;are&nbsp;in&nbsp;bit&nbsp;reversed&nbsp;order.&nbsp;See&nbsp;NewGCM.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3742452">productTable</span>&nbsp;<span class="op" id="3742465">[</span><span class="num" id="3742466">16</span><span class="op" id="3742468">]</span><span class="ident" id="3742469">gcmFieldElement</span><br>
<span class="lineno"></span><span class="op" id="3742485">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="comment" id="3742488">//&nbsp;NewGCM&nbsp;returns&nbsp;the&nbsp;given&nbsp;128-bit,&nbsp;block&nbsp;cipher&nbsp;wrapped&nbsp;in&nbsp;Galois&nbsp;Counter&nbsp;Mode.</span><br>
<span class="lineno"></span><span class="keyword" id="3742570">func</span>&nbsp;<span class="ident" id="3742575">NewGCM</span><span class="op" id="3742581">(</span><span class="ident" id="3742582">cipher</span>&nbsp;<span class="ident" id="3742589">Block</span><span class="op" id="3742594">)</span>&nbsp;<span class="op" id="3742596">(</span><span class="ident" id="3742597">AEAD</span><span class="op" id="3742601">,</span>&nbsp;<span class="builtintype" id="3742603">error</span><span class="op" id="3742608">)</span>&nbsp;<span class="op" id="3742610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3742613">if</span>&nbsp;<span class="ident" id="3742616">cipher</span><span class="op" id="3742622">.</span><span class="ident" id="3742623">BlockSize</span><span class="op" id="3742632">(</span><span class="op" id="3742633">)</span>&nbsp;<span class="op" id="3742635">!=</span>&nbsp;<span class="ident" id="3742638">gcmBlockSize</span>&nbsp;<span class="op" id="3742651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3742655">return</span>&nbsp;<span class="ident" id="3742662">nil</span><span class="op" id="3742665">,</span>&nbsp;<span class="ident" id="3742667">errors</span><span class="op" id="3742673">.</span><span class="ident" id="3742674">New</span><span class="op" id="3742677">(</span><span class="string" id="3742678">&#34;cipher:&nbsp;NewGCM&nbsp;requires&nbsp;128-bit&nbsp;block&nbsp;cipher&#34;</span><span class="op" id="3742724">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3742727">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3742731">var</span>&nbsp;<span class="ident" id="3742735">key</span>&nbsp;<span class="op" id="3742739">[</span><span class="ident" id="3742740">gcmBlockSize</span><span class="op" id="3742752">]</span><span class="builtintype" id="3742753">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3742759">cipher</span><span class="op" id="3742765">.</span><span class="ident" id="3742766">Encrypt</span><span class="op" id="3742773">(</span><span class="ident" id="3742774">key</span><span class="op" id="3742777">[</span><span class="op" id="3742778">:</span><span class="op" id="3742779">]</span><span class="op" id="3742780">,</span>&nbsp;<span class="ident" id="3742782">key</span><span class="op" id="3742785">[</span><span class="op" id="3742786">:</span><span class="op" id="3742787">]</span><span class="op" id="3742788">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3742792">g</span>&nbsp;<span class="op" id="3742794">:=</span>&nbsp;<span class="op" id="3742797">&amp;</span><span class="ident" id="3742798">gcm</span><span class="op" id="3742801">{</span><span class="ident" id="3742802">cipher</span><span class="op" id="3742808">:</span>&nbsp;<span class="ident" id="3742810">cipher</span><span class="op" id="3742816">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3742820">//&nbsp;We&nbsp;precompute&nbsp;16&nbsp;multiples&nbsp;of&nbsp;|key|.&nbsp;However,&nbsp;when&nbsp;we&nbsp;do&nbsp;lookups</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3742889">//&nbsp;into&nbsp;this&nbsp;table&nbsp;we&#39;ll&nbsp;be&nbsp;using&nbsp;bits&nbsp;from&nbsp;a&nbsp;field&nbsp;element&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3742954">//&nbsp;therefore&nbsp;the&nbsp;bits&nbsp;will&nbsp;be&nbsp;in&nbsp;the&nbsp;reverse&nbsp;order.&nbsp;So&nbsp;normally&nbsp;one</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3743023">//&nbsp;would&nbsp;expect,&nbsp;say,&nbsp;4*key&nbsp;to&nbsp;be&nbsp;in&nbsp;index&nbsp;4&nbsp;of&nbsp;the&nbsp;table&nbsp;but&nbsp;due&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3743093">//&nbsp;this&nbsp;bit&nbsp;ordering&nbsp;it&nbsp;will&nbsp;actually&nbsp;be&nbsp;in&nbsp;index&nbsp;0010&nbsp;(base&nbsp;2)&nbsp;=&nbsp;2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3743163">x</span>&nbsp;<span class="op" id="3743165">:=</span>&nbsp;<span class="ident" id="3743168">gcmFieldElement</span><span class="op" id="3743183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3743187">getUint64</span><span class="op" id="3743196">(</span><span class="ident" id="3743197">key</span><span class="op" id="3743200">[</span><span class="op" id="3743201">:</span><span class="num" id="3743202">8</span><span class="op" id="3743203">]</span><span class="op" id="3743204">)</span><span class="op" id="3743205">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3743209">getUint64</span><span class="op" id="3743218">(</span><span class="ident" id="3743219">key</span><span class="op" id="3743222">[</span><span class="num" id="3743223">8</span><span class="op" id="3743224">:</span><span class="op" id="3743225">]</span><span class="op" id="3743226">)</span><span class="op" id="3743227">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3743230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3743233">g</span><span class="op" id="3743234">.</span><span class="ident" id="3743235">productTable</span><span class="op" id="3743247">[</span><span class="ident" id="3743248">reverseBits</span><span class="op" id="3743259">(</span><span class="num" id="3743260">1</span><span class="op" id="3743261">)</span><span class="op" id="3743262">]</span>&nbsp;<span class="op" id="3743264">=</span>&nbsp;<span class="ident" id="3743266">x</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3743270">for</span>&nbsp;<span class="ident" id="3743274">i</span>&nbsp;<span class="op" id="3743276">:=</span>&nbsp;<span class="num" id="3743279">2</span><span class="op" id="3743280">;</span>&nbsp;<span class="ident" id="3743282">i</span>&nbsp;<span class="op" id="3743284">&lt;</span>&nbsp;<span class="num" id="3743286">16</span><span class="op" id="3743288">;</span>&nbsp;<span class="ident" id="3743290">i</span>&nbsp;<span class="op" id="3743292">+=</span>&nbsp;<span class="num" id="3743295">2</span>&nbsp;<span class="op" id="3743297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3743301">g</span><span class="op" id="3743302">.</span><span class="ident" id="3743303">productTable</span><span class="op" id="3743315">[</span><span class="ident" id="3743316">reverseBits</span><span class="op" id="3743327">(</span><span class="ident" id="3743328">i</span><span class="op" id="3743329">)</span><span class="op" id="3743330">]</span>&nbsp;<span class="op" id="3743332">=</span>&nbsp;<span class="ident" id="3743334">gcmDouble</span><span class="op" id="3743343">(</span><span class="op" id="3743344">&amp;</span><span class="ident" id="3743345">g</span><span class="op" id="3743346">.</span><span class="ident" id="3743347">productTable</span><span class="op" id="3743359">[</span><span class="ident" id="3743360">reverseBits</span><span class="op" id="3743371">(</span><span class="ident" id="3743372">i</span><span class="op" id="3743373">/</span><span class="num" id="3743374">2</span><span class="op" id="3743375">)</span><span class="op" id="3743376">]</span><span class="op" id="3743377">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3743381">g</span><span class="op" id="3743382">.</span><span class="ident" id="3743383">productTable</span><span class="op" id="3743395">[</span><span class="ident" id="3743396">reverseBits</span><span class="op" id="3743407">(</span><span class="ident" id="3743408">i</span><span class="op" id="3743409">+</span><span class="num" id="3743410">1</span><span class="op" id="3743411">)</span><span class="op" id="3743412">]</span>&nbsp;<span class="op" id="3743414">=</span>&nbsp;<span class="ident" id="3743416">gcmAdd</span><span class="op" id="3743422">(</span><span class="op" id="3743423">&amp;</span><span class="ident" id="3743424">g</span><span class="op" id="3743425">.</span><span class="ident" id="3743426">productTable</span><span class="op" id="3743438">[</span><span class="ident" id="3743439">reverseBits</span><span class="op" id="3743450">(</span><span class="ident" id="3743451">i</span><span class="op" id="3743452">)</span><span class="op" id="3743453">]</span><span class="op" id="3743454">,</span>&nbsp;<span class="op" id="3743456">&amp;</span><span class="ident" id="3743457">x</span><span class="op" id="3743458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3743461">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3743465">return</span>&nbsp;<span class="ident" id="3743472">g</span><span class="op" id="3743473">,</span>&nbsp;<span class="ident" id="3743475">nil</span><br>
<span class="lineno"></span><span class="op" id="3743479">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="3743482">const</span>&nbsp;<span class="op" id="3743488">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3743491">gcmBlockSize</span>&nbsp;<span class="op" id="3743504">=</span>&nbsp;<span class="num" id="3743506">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3743510">gcmTagSize</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3743523">=</span>&nbsp;<span class="num" id="3743525">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3743529">gcmNonceSize</span>&nbsp;<span class="op" id="3743542">=</span>&nbsp;<span class="num" id="3743544">12</span><br>
<span class="lineno">95</span><span class="op" id="3743547">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3743550">func</span>&nbsp;<span class="op" id="3743555">(</span><span class="op" id="3743556">*</span><span class="ident" id="3743557">gcm</span><span class="op" id="3743560">)</span>&nbsp;<span class="ident" id="3743562">NonceSize</span><span class="op" id="3743571">(</span><span class="op" id="3743572">)</span>&nbsp;<span class="builtintype" id="3743574">int</span>&nbsp;<span class="op" id="3743578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3743581">return</span>&nbsp;<span class="ident" id="3743588">gcmNonceSize</span><br>
<span class="lineno"></span><span class="op" id="3743601">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="keyword" id="3743604">func</span>&nbsp;<span class="op" id="3743609">(</span><span class="op" id="3743610">*</span><span class="ident" id="3743611">gcm</span><span class="op" id="3743614">)</span>&nbsp;<span class="ident" id="3743616">Overhead</span><span class="op" id="3743624">(</span><span class="op" id="3743625">)</span>&nbsp;<span class="builtintype" id="3743627">int</span>&nbsp;<span class="op" id="3743631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3743634">return</span>&nbsp;<span class="ident" id="3743641">gcmTagSize</span><br>
<span class="lineno"></span><span class="op" id="3743652">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="keyword" id="3743655">func</span>&nbsp;<span class="op" id="3743660">(</span><span class="ident" id="3743661">g</span>&nbsp;<span class="op" id="3743663">*</span><span class="ident" id="3743664">gcm</span><span class="op" id="3743667">)</span>&nbsp;<span class="ident" id="3743669">Seal</span><span class="op" id="3743673">(</span><span class="ident" id="3743674">dst</span><span class="op" id="3743677">,</span>&nbsp;<span class="ident" id="3743679">nonce</span><span class="op" id="3743684">,</span>&nbsp;<span class="ident" id="3743686">plaintext</span><span class="op" id="3743695">,</span>&nbsp;<span class="ident" id="3743697">data</span>&nbsp;<span class="op" id="3743702">[</span><span class="op" id="3743703">]</span><span class="builtintype" id="3743704">byte</span><span class="op" id="3743708">)</span>&nbsp;<span class="op" id="3743710">[</span><span class="op" id="3743711">]</span><span class="builtintype" id="3743712">byte</span>&nbsp;<span class="op" id="3743717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3743720">if</span>&nbsp;<span class="builtinfunc" id="3743723">len</span><span class="op" id="3743726">(</span><span class="ident" id="3743727">nonce</span><span class="op" id="3743732">)</span>&nbsp;<span class="op" id="3743734">!=</span>&nbsp;<span class="ident" id="3743737">gcmNonceSize</span>&nbsp;<span class="op" id="3743750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3743754">panic</span><span class="op" id="3743759">(</span><span class="string" id="3743760">&#34;cipher:&nbsp;incorrect&nbsp;nonce&nbsp;length&nbsp;given&nbsp;to&nbsp;GCM&#34;</span><span class="op" id="3743805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3743808">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3743812">ret</span><span class="op" id="3743815">,</span>&nbsp;<span class="ident" id="3743817">out</span>&nbsp;<span class="op" id="3743821">:=</span>&nbsp;<span class="ident" id="3743824">sliceForAppend</span><span class="op" id="3743838">(</span><span class="ident" id="3743839">dst</span><span class="op" id="3743842">,</span>&nbsp;<span class="builtinfunc" id="3743844">len</span><span class="op" id="3743847">(</span><span class="ident" id="3743848">plaintext</span><span class="op" id="3743857">)</span><span class="op" id="3743858">+</span><span class="ident" id="3743859">gcmTagSize</span><span class="op" id="3743869">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3743873">//&nbsp;See&nbsp;GCM&nbsp;spec,&nbsp;section&nbsp;7.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3743904">var</span>&nbsp;<span class="ident" id="3743908">counter</span><span class="op" id="3743915">,</span>&nbsp;<span class="ident" id="3743917">tagMask</span>&nbsp;<span class="op" id="3743925">[</span><span class="ident" id="3743926">gcmBlockSize</span><span class="op" id="3743938">]</span><span class="builtintype" id="3743939">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3743945">copy</span><span class="op" id="3743949">(</span><span class="ident" id="3743950">counter</span><span class="op" id="3743957">[</span><span class="op" id="3743958">:</span><span class="op" id="3743959">]</span><span class="op" id="3743960">,</span>&nbsp;<span class="ident" id="3743962">nonce</span><span class="op" id="3743967">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3743970">counter</span><span class="op" id="3743977">[</span><span class="ident" id="3743978">gcmBlockSize</span><span class="op" id="3743990">-</span><span class="num" id="3743991">1</span><span class="op" id="3743992">]</span>&nbsp;<span class="op" id="3743994">=</span>&nbsp;<span class="num" id="3743996">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3744000">g</span><span class="op" id="3744001">.</span><span class="ident" id="3744002">cipher</span><span class="op" id="3744008">.</span><span class="ident" id="3744009">Encrypt</span><span class="op" id="3744016">(</span><span class="ident" id="3744017">tagMask</span><span class="op" id="3744024">[</span><span class="op" id="3744025">:</span><span class="op" id="3744026">]</span><span class="op" id="3744027">,</span>&nbsp;<span class="ident" id="3744029">counter</span><span class="op" id="3744036">[</span><span class="op" id="3744037">:</span><span class="op" id="3744038">]</span><span class="op" id="3744039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3744042">gcmInc32</span><span class="op" id="3744050">(</span><span class="op" id="3744051">&amp;</span><span class="ident" id="3744052">counter</span><span class="op" id="3744059">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3744063">g</span><span class="op" id="3744064">.</span><span class="ident" id="3744065">counterCrypt</span><span class="op" id="3744077">(</span><span class="ident" id="3744078">out</span><span class="op" id="3744081">,</span>&nbsp;<span class="ident" id="3744083">plaintext</span><span class="op" id="3744092">,</span>&nbsp;<span class="op" id="3744094">&amp;</span><span class="ident" id="3744095">counter</span><span class="op" id="3744102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3744105">g</span><span class="op" id="3744106">.</span><span class="ident" id="3744107">auth</span><span class="op" id="3744111">(</span><span class="ident" id="3744112">out</span><span class="op" id="3744115">[</span><span class="builtinfunc" id="3744116">len</span><span class="op" id="3744119">(</span><span class="ident" id="3744120">plaintext</span><span class="op" id="3744129">)</span><span class="op" id="3744130">:</span><span class="op" id="3744131">]</span><span class="op" id="3744132">,</span>&nbsp;<span class="ident" id="3744134">out</span><span class="op" id="3744137">[</span><span class="op" id="3744138">:</span><span class="builtinfunc" id="3744139">len</span><span class="op" id="3744142">(</span><span class="ident" id="3744143">plaintext</span><span class="op" id="3744152">)</span><span class="op" id="3744153">]</span><span class="op" id="3744154">,</span>&nbsp;<span class="ident" id="3744156">data</span><span class="op" id="3744160">,</span>&nbsp;<span class="op" id="3744162">&amp;</span><span class="ident" id="3744163">tagMask</span><span class="op" id="3744170">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3744174">return</span>&nbsp;<span class="ident" id="3744181">ret</span><br>
<span class="lineno"></span><span class="op" id="3744185">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="3744188">var</span>&nbsp;<span class="ident" id="3744192">errOpen</span>&nbsp;<span class="op" id="3744200">=</span>&nbsp;<span class="ident" id="3744202">errors</span><span class="op" id="3744208">.</span><span class="ident" id="3744209">New</span><span class="op" id="3744212">(</span><span class="string" id="3744213">&#34;cipher:&nbsp;message&nbsp;authentication&nbsp;failed&#34;</span><span class="op" id="3744252">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3744255">func</span>&nbsp;<span class="op" id="3744260">(</span><span class="ident" id="3744261">g</span>&nbsp;<span class="op" id="3744263">*</span><span class="ident" id="3744264">gcm</span><span class="op" id="3744267">)</span>&nbsp;<span class="ident" id="3744269">Open</span><span class="op" id="3744273">(</span><span class="ident" id="3744274">dst</span><span class="op" id="3744277">,</span>&nbsp;<span class="ident" id="3744279">nonce</span><span class="op" id="3744284">,</span>&nbsp;<span class="ident" id="3744286">ciphertext</span><span class="op" id="3744296">,</span>&nbsp;<span class="ident" id="3744298">data</span>&nbsp;<span class="op" id="3744303">[</span><span class="op" id="3744304">]</span><span class="builtintype" id="3744305">byte</span><span class="op" id="3744309">)</span>&nbsp;<span class="op" id="3744311">(</span><span class="op" id="3744312">[</span><span class="op" id="3744313">]</span><span class="builtintype" id="3744314">byte</span><span class="op" id="3744318">,</span>&nbsp;<span class="builtintype" id="3744320">error</span><span class="op" id="3744325">)</span>&nbsp;<span class="op" id="3744327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3744330">if</span>&nbsp;<span class="builtinfunc" id="3744333">len</span><span class="op" id="3744336">(</span><span class="ident" id="3744337">nonce</span><span class="op" id="3744342">)</span>&nbsp;<span class="op" id="3744344">!=</span>&nbsp;<span class="ident" id="3744347">gcmNonceSize</span>&nbsp;<span class="op" id="3744360">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3744364">panic</span><span class="op" id="3744369">(</span><span class="string" id="3744370">&#34;cipher:&nbsp;incorrect&nbsp;nonce&nbsp;length&nbsp;given&nbsp;to&nbsp;GCM&#34;</span><span class="op" id="3744415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3744418">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3744422">if</span>&nbsp;<span class="builtinfunc" id="3744425">len</span><span class="op" id="3744428">(</span><span class="ident" id="3744429">ciphertext</span><span class="op" id="3744439">)</span>&nbsp;<span class="op" id="3744441">&lt;</span>&nbsp;<span class="ident" id="3744443">gcmTagSize</span>&nbsp;<span class="op" id="3744454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3744458">return</span>&nbsp;<span class="ident" id="3744465">nil</span><span class="op" id="3744468">,</span>&nbsp;<span class="ident" id="3744470">errOpen</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3744479">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3744482">tag</span>&nbsp;<span class="op" id="3744486">:=</span>&nbsp;<span class="ident" id="3744489">ciphertext</span><span class="op" id="3744499">[</span><span class="builtinfunc" id="3744500">len</span><span class="op" id="3744503">(</span><span class="ident" id="3744504">ciphertext</span><span class="op" id="3744514">)</span><span class="op" id="3744515">-</span><span class="ident" id="3744516">gcmTagSize</span><span class="op" id="3744526">:</span><span class="op" id="3744527">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3744530">ciphertext</span>&nbsp;<span class="op" id="3744541">=</span>&nbsp;<span class="ident" id="3744543">ciphertext</span><span class="op" id="3744553">[</span><span class="op" id="3744554">:</span><span class="builtinfunc" id="3744555">len</span><span class="op" id="3744558">(</span><span class="ident" id="3744559">ciphertext</span><span class="op" id="3744569">)</span><span class="op" id="3744570">-</span><span class="ident" id="3744571">gcmTagSize</span><span class="op" id="3744581">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3744585">//&nbsp;See&nbsp;GCM&nbsp;spec,&nbsp;section&nbsp;7.1.</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3744616">var</span>&nbsp;<span class="ident" id="3744620">counter</span><span class="op" id="3744627">,</span>&nbsp;<span class="ident" id="3744629">tagMask</span>&nbsp;<span class="op" id="3744637">[</span><span class="ident" id="3744638">gcmBlockSize</span><span class="op" id="3744650">]</span><span class="builtintype" id="3744651">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3744657">copy</span><span class="op" id="3744661">(</span><span class="ident" id="3744662">counter</span><span class="op" id="3744669">[</span><span class="op" id="3744670">:</span><span class="op" id="3744671">]</span><span class="op" id="3744672">,</span>&nbsp;<span class="ident" id="3744674">nonce</span><span class="op" id="3744679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3744682">counter</span><span class="op" id="3744689">[</span><span class="ident" id="3744690">gcmBlockSize</span><span class="op" id="3744702">-</span><span class="num" id="3744703">1</span><span class="op" id="3744704">]</span>&nbsp;<span class="op" id="3744706">=</span>&nbsp;<span class="num" id="3744708">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3744712">g</span><span class="op" id="3744713">.</span><span class="ident" id="3744714">cipher</span><span class="op" id="3744720">.</span><span class="ident" id="3744721">Encrypt</span><span class="op" id="3744728">(</span><span class="ident" id="3744729">tagMask</span><span class="op" id="3744736">[</span><span class="op" id="3744737">:</span><span class="op" id="3744738">]</span><span class="op" id="3744739">,</span>&nbsp;<span class="ident" id="3744741">counter</span><span class="op" id="3744748">[</span><span class="op" id="3744749">:</span><span class="op" id="3744750">]</span><span class="op" id="3744751">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3744754">gcmInc32</span><span class="op" id="3744762">(</span><span class="op" id="3744763">&amp;</span><span class="ident" id="3744764">counter</span><span class="op" id="3744771">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3744775">var</span>&nbsp;<span class="ident" id="3744779">expectedTag</span>&nbsp;<span class="op" id="3744791">[</span><span class="ident" id="3744792">gcmTagSize</span><span class="op" id="3744802">]</span><span class="builtintype" id="3744803">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3744809">g</span><span class="op" id="3744810">.</span><span class="ident" id="3744811">auth</span><span class="op" id="3744815">(</span><span class="ident" id="3744816">expectedTag</span><span class="op" id="3744827">[</span><span class="op" id="3744828">:</span><span class="op" id="3744829">]</span><span class="op" id="3744830">,</span>&nbsp;<span class="ident" id="3744832">ciphertext</span><span class="op" id="3744842">,</span>&nbsp;<span class="ident" id="3744844">data</span><span class="op" id="3744848">,</span>&nbsp;<span class="op" id="3744850">&amp;</span><span class="ident" id="3744851">tagMask</span><span class="op" id="3744858">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3744862">if</span>&nbsp;<span class="ident" id="3744865">subtle</span><span class="op" id="3744871">.</span><span class="ident" id="3744872">ConstantTimeCompare</span><span class="op" id="3744891">(</span><span class="ident" id="3744892">expectedTag</span><span class="op" id="3744903">[</span><span class="op" id="3744904">:</span><span class="op" id="3744905">]</span><span class="op" id="3744906">,</span>&nbsp;<span class="ident" id="3744908">tag</span><span class="op" id="3744911">)</span>&nbsp;<span class="op" id="3744913">!=</span>&nbsp;<span class="num" id="3744916">1</span>&nbsp;<span class="op" id="3744918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3744922">return</span>&nbsp;<span class="ident" id="3744929">nil</span><span class="op" id="3744932">,</span>&nbsp;<span class="ident" id="3744934">errOpen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3744943">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3744947">ret</span><span class="op" id="3744950">,</span>&nbsp;<span class="ident" id="3744952">out</span>&nbsp;<span class="op" id="3744956">:=</span>&nbsp;<span class="ident" id="3744959">sliceForAppend</span><span class="op" id="3744973">(</span><span class="ident" id="3744974">dst</span><span class="op" id="3744977">,</span>&nbsp;<span class="builtinfunc" id="3744979">len</span><span class="op" id="3744982">(</span><span class="ident" id="3744983">ciphertext</span><span class="op" id="3744993">)</span><span class="op" id="3744994">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3744997">g</span><span class="op" id="3744998">.</span><span class="ident" id="3744999">counterCrypt</span><span class="op" id="3745011">(</span><span class="ident" id="3745012">out</span><span class="op" id="3745015">,</span>&nbsp;<span class="ident" id="3745017">ciphertext</span><span class="op" id="3745027">,</span>&nbsp;<span class="op" id="3745029">&amp;</span><span class="ident" id="3745030">counter</span><span class="op" id="3745037">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3745041">return</span>&nbsp;<span class="ident" id="3745048">ret</span><span class="op" id="3745051">,</span>&nbsp;<span class="ident" id="3745053">nil</span><br>
<span class="lineno"></span><span class="op" id="3745057">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="3745060">//&nbsp;reverseBits&nbsp;reverses&nbsp;the&nbsp;order&nbsp;of&nbsp;the&nbsp;bits&nbsp;of&nbsp;4-bit&nbsp;number&nbsp;in&nbsp;i.</span><br>
<span class="lineno"></span><span class="keyword" id="3745128">func</span>&nbsp;<span class="ident" id="3745133">reverseBits</span><span class="op" id="3745144">(</span><span class="ident" id="3745145">i</span>&nbsp;<span class="builtintype" id="3745147">int</span><span class="op" id="3745150">)</span>&nbsp;<span class="builtintype" id="3745152">int</span>&nbsp;<span class="op" id="3745156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3745159">i</span>&nbsp;<span class="op" id="3745161">=</span>&nbsp;<span class="op" id="3745163">(</span><span class="op" id="3745164">(</span><span class="ident" id="3745165">i</span>&nbsp;<span class="op" id="3745167">&lt;&lt;</span>&nbsp;<span class="num" id="3745170">2</span><span class="op" id="3745171">)</span>&nbsp;<span class="op" id="3745173">&amp;</span>&nbsp;<span class="num" id="3745175">0xc</span><span class="op" id="3745178">)</span>&nbsp;<span class="op" id="3745180">|</span>&nbsp;<span class="op" id="3745182">(</span><span class="op" id="3745183">(</span><span class="ident" id="3745184">i</span>&nbsp;<span class="op" id="3745186">&gt;&gt;</span>&nbsp;<span class="num" id="3745189">2</span><span class="op" id="3745190">)</span>&nbsp;<span class="op" id="3745192">&amp;</span>&nbsp;<span class="num" id="3745194">0x3</span><span class="op" id="3745197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3745200">i</span>&nbsp;<span class="op" id="3745202">=</span>&nbsp;<span class="op" id="3745204">(</span><span class="op" id="3745205">(</span><span class="ident" id="3745206">i</span>&nbsp;<span class="op" id="3745208">&lt;&lt;</span>&nbsp;<span class="num" id="3745211">1</span><span class="op" id="3745212">)</span>&nbsp;<span class="op" id="3745214">&amp;</span>&nbsp;<span class="num" id="3745216">0xa</span><span class="op" id="3745219">)</span>&nbsp;<span class="op" id="3745221">|</span>&nbsp;<span class="op" id="3745223">(</span><span class="op" id="3745224">(</span><span class="ident" id="3745225">i</span>&nbsp;<span class="op" id="3745227">&gt;&gt;</span>&nbsp;<span class="num" id="3745230">1</span><span class="op" id="3745231">)</span>&nbsp;<span class="op" id="3745233">&amp;</span>&nbsp;<span class="num" id="3745235">0x5</span><span class="op" id="3745238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3745241">return</span>&nbsp;<span class="ident" id="3745248">i</span><br>
<span class="lineno">165</span><span class="op" id="3745250">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3745253">//&nbsp;gcmAdd&nbsp;adds&nbsp;two&nbsp;elements&nbsp;of&nbsp;GF(2¹²⁸)&nbsp;and&nbsp;returns&nbsp;the&nbsp;sum.</span><br>
<span class="lineno"></span><span class="keyword" id="3745318">func</span>&nbsp;<span class="ident" id="3745323">gcmAdd</span><span class="op" id="3745329">(</span><span class="ident" id="3745330">x</span><span class="op" id="3745331">,</span>&nbsp;<span class="ident" id="3745333">y</span>&nbsp;<span class="op" id="3745335">*</span><span class="ident" id="3745336">gcmFieldElement</span><span class="op" id="3745351">)</span>&nbsp;<span class="ident" id="3745353">gcmFieldElement</span>&nbsp;<span class="op" id="3745369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3745372">//&nbsp;Addition&nbsp;in&nbsp;a&nbsp;characteristic&nbsp;2&nbsp;field&nbsp;is&nbsp;just&nbsp;XOR.</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3745426">return</span>&nbsp;<span class="ident" id="3745433">gcmFieldElement</span><span class="op" id="3745448">{</span><span class="ident" id="3745449">x</span><span class="op" id="3745450">.</span><span class="ident" id="3745451">low</span>&nbsp;<span class="op" id="3745455">^</span>&nbsp;<span class="ident" id="3745457">y</span><span class="op" id="3745458">.</span><span class="ident" id="3745459">low</span><span class="op" id="3745462">,</span>&nbsp;<span class="ident" id="3745464">x</span><span class="op" id="3745465">.</span><span class="ident" id="3745466">high</span>&nbsp;<span class="op" id="3745471">^</span>&nbsp;<span class="ident" id="3745473">y</span><span class="op" id="3745474">.</span><span class="ident" id="3745475">high</span><span class="op" id="3745479">}</span><br>
<span class="lineno"></span><span class="op" id="3745481">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3745484">//&nbsp;gcmDouble&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;doubling&nbsp;an&nbsp;element&nbsp;of&nbsp;GF(2¹²⁸).</span><br>
<span class="lineno"></span><span class="keyword" id="3745556">func</span>&nbsp;<span class="ident" id="3745561">gcmDouble</span><span class="op" id="3745570">(</span><span class="ident" id="3745571">x</span>&nbsp;<span class="op" id="3745573">*</span><span class="ident" id="3745574">gcmFieldElement</span><span class="op" id="3745589">)</span>&nbsp;<span class="op" id="3745591">(</span><span class="ident" id="3745592">double</span>&nbsp;<span class="ident" id="3745599">gcmFieldElement</span><span class="op" id="3745614">)</span>&nbsp;<span class="op" id="3745616">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3745619">msbSet</span>&nbsp;<span class="op" id="3745626">:=</span>&nbsp;<span class="ident" id="3745629">x</span><span class="op" id="3745630">.</span><span class="ident" id="3745631">high</span><span class="op" id="3745635">&amp;</span><span class="num" id="3745636">1</span>&nbsp;<span class="op" id="3745638">==</span>&nbsp;<span class="num" id="3745641">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3745645">//&nbsp;Because&nbsp;of&nbsp;the&nbsp;bit-ordering,&nbsp;doubling&nbsp;is&nbsp;actually&nbsp;a&nbsp;right&nbsp;shift.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3745714">double</span><span class="op" id="3745720">.</span><span class="ident" id="3745721">high</span>&nbsp;<span class="op" id="3745726">=</span>&nbsp;<span class="ident" id="3745728">x</span><span class="op" id="3745729">.</span><span class="ident" id="3745730">high</span>&nbsp;<span class="op" id="3745735">&gt;&gt;</span>&nbsp;<span class="num" id="3745738">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3745741">double</span><span class="op" id="3745747">.</span><span class="ident" id="3745748">high</span>&nbsp;<span class="op" id="3745753">|=</span>&nbsp;<span class="ident" id="3745756">x</span><span class="op" id="3745757">.</span><span class="ident" id="3745758">low</span>&nbsp;<span class="op" id="3745762">&lt;&lt;</span>&nbsp;<span class="num" id="3745765">63</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3745769">double</span><span class="op" id="3745775">.</span><span class="ident" id="3745776">low</span>&nbsp;<span class="op" id="3745780">=</span>&nbsp;<span class="ident" id="3745782">x</span><span class="op" id="3745783">.</span><span class="ident" id="3745784">low</span>&nbsp;<span class="op" id="3745788">&gt;&gt;</span>&nbsp;<span class="num" id="3745791">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3745795">//&nbsp;If&nbsp;the&nbsp;most-significant&nbsp;bit&nbsp;was&nbsp;set&nbsp;before&nbsp;shifting&nbsp;then&nbsp;it,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3745860">//&nbsp;conceptually,&nbsp;becomes&nbsp;a&nbsp;term&nbsp;of&nbsp;x^128.&nbsp;This&nbsp;is&nbsp;greater&nbsp;than&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3745928">//&nbsp;irreducible&nbsp;polynomial&nbsp;so&nbsp;the&nbsp;result&nbsp;has&nbsp;to&nbsp;be&nbsp;reduced.&nbsp;The</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3745992">//&nbsp;irreducible&nbsp;polynomial&nbsp;is&nbsp;1+x+x^2+x^7+x^128.&nbsp;We&nbsp;can&nbsp;subtract&nbsp;that&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3746065">//&nbsp;eliminate&nbsp;the&nbsp;term&nbsp;at&nbsp;x^128&nbsp;which&nbsp;also&nbsp;means&nbsp;subtracting&nbsp;the&nbsp;other</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3746136">//&nbsp;four&nbsp;terms.&nbsp;In&nbsp;characteristic&nbsp;2&nbsp;fields,&nbsp;subtraction&nbsp;==&nbsp;addition&nbsp;==</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3746207">//&nbsp;XOR.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3746216">if</span>&nbsp;<span class="ident" id="3746219">msbSet</span>&nbsp;<span class="op" id="3746226">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3746230">double</span><span class="op" id="3746236">.</span><span class="ident" id="3746237">low</span>&nbsp;<span class="op" id="3746241">^=</span>&nbsp;<span class="num" id="3746244">0xe100000000000000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3746264">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3746268">return</span><br>
<span class="lineno"></span><span class="op" id="3746275">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="keyword" id="3746278">var</span>&nbsp;<span class="ident" id="3746282">gcmReductionTable</span>&nbsp;<span class="op" id="3746300">=</span>&nbsp;<span class="op" id="3746302">[</span><span class="op" id="3746303">]</span><span class="builtintype" id="3746304">uint16</span><span class="op" id="3746310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="3746313">0x0000</span><span class="op" id="3746319">,</span>&nbsp;<span class="num" id="3746321">0x1c20</span><span class="op" id="3746327">,</span>&nbsp;<span class="num" id="3746329">0x3840</span><span class="op" id="3746335">,</span>&nbsp;<span class="num" id="3746337">0x2460</span><span class="op" id="3746343">,</span>&nbsp;<span class="num" id="3746345">0x7080</span><span class="op" id="3746351">,</span>&nbsp;<span class="num" id="3746353">0x6ca0</span><span class="op" id="3746359">,</span>&nbsp;<span class="num" id="3746361">0x48c0</span><span class="op" id="3746367">,</span>&nbsp;<span class="num" id="3746369">0x54e0</span><span class="op" id="3746375">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="3746378">0xe100</span><span class="op" id="3746384">,</span>&nbsp;<span class="num" id="3746386">0xfd20</span><span class="op" id="3746392">,</span>&nbsp;<span class="num" id="3746394">0xd940</span><span class="op" id="3746400">,</span>&nbsp;<span class="num" id="3746402">0xc560</span><span class="op" id="3746408">,</span>&nbsp;<span class="num" id="3746410">0x9180</span><span class="op" id="3746416">,</span>&nbsp;<span class="num" id="3746418">0x8da0</span><span class="op" id="3746424">,</span>&nbsp;<span class="num" id="3746426">0xa9c0</span><span class="op" id="3746432">,</span>&nbsp;<span class="num" id="3746434">0xb5e0</span><span class="op" id="3746440">,</span><br>
<span class="lineno"></span><span class="op" id="3746442">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="comment" id="3746445">//&nbsp;mul&nbsp;sets&nbsp;y&nbsp;to&nbsp;y*H,&nbsp;where&nbsp;H&nbsp;is&nbsp;the&nbsp;GCM&nbsp;key,&nbsp;fixed&nbsp;during&nbsp;NewGCM.</span><br>
<span class="lineno"></span><span class="keyword" id="3746512">func</span>&nbsp;<span class="op" id="3746517">(</span><span class="ident" id="3746518">g</span>&nbsp;<span class="op" id="3746520">*</span><span class="ident" id="3746521">gcm</span><span class="op" id="3746524">)</span>&nbsp;<span class="ident" id="3746526">mul</span><span class="op" id="3746529">(</span><span class="ident" id="3746530">y</span>&nbsp;<span class="op" id="3746532">*</span><span class="ident" id="3746533">gcmFieldElement</span><span class="op" id="3746548">)</span>&nbsp;<span class="op" id="3746550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3746553">var</span>&nbsp;<span class="ident" id="3746557">z</span>&nbsp;<span class="ident" id="3746559">gcmFieldElement</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3746577">for</span>&nbsp;<span class="ident" id="3746581">i</span>&nbsp;<span class="op" id="3746583">:=</span>&nbsp;<span class="num" id="3746586">0</span><span class="op" id="3746587">;</span>&nbsp;<span class="ident" id="3746589">i</span>&nbsp;<span class="op" id="3746591">&lt;</span>&nbsp;<span class="num" id="3746593">2</span><span class="op" id="3746594">;</span>&nbsp;<span class="ident" id="3746596">i</span><span class="op" id="3746597">++</span>&nbsp;<span class="op" id="3746600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3746604">word</span>&nbsp;<span class="op" id="3746609">:=</span>&nbsp;<span class="ident" id="3746612">y</span><span class="op" id="3746613">.</span><span class="ident" id="3746614">high</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3746621">if</span>&nbsp;<span class="ident" id="3746624">i</span>&nbsp;<span class="op" id="3746626">==</span>&nbsp;<span class="num" id="3746629">1</span>&nbsp;<span class="op" id="3746631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3746636">word</span>&nbsp;<span class="op" id="3746641">=</span>&nbsp;<span class="ident" id="3746643">y</span><span class="op" id="3746644">.</span><span class="ident" id="3746645">low</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3746651">}</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3746656">//&nbsp;Multiplication&nbsp;works&nbsp;by&nbsp;multiplying&nbsp;z&nbsp;by&nbsp;16&nbsp;and&nbsp;adding&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3746719">//&nbsp;one&nbsp;of&nbsp;the&nbsp;precomputed&nbsp;multiples&nbsp;of&nbsp;H.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3746763">for</span>&nbsp;<span class="ident" id="3746767">j</span>&nbsp;<span class="op" id="3746769">:=</span>&nbsp;<span class="num" id="3746772">0</span><span class="op" id="3746773">;</span>&nbsp;<span class="ident" id="3746775">j</span>&nbsp;<span class="op" id="3746777">&lt;</span>&nbsp;<span class="num" id="3746779">64</span><span class="op" id="3746781">;</span>&nbsp;<span class="ident" id="3746783">j</span>&nbsp;<span class="op" id="3746785">+=</span>&nbsp;<span class="num" id="3746788">4</span>&nbsp;<span class="op" id="3746790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3746795">msw</span>&nbsp;<span class="op" id="3746799">:=</span>&nbsp;<span class="ident" id="3746802">z</span><span class="op" id="3746803">.</span><span class="ident" id="3746804">high</span>&nbsp;<span class="op" id="3746809">&amp;</span>&nbsp;<span class="num" id="3746811">0xf</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3746818">z</span><span class="op" id="3746819">.</span><span class="ident" id="3746820">high</span>&nbsp;<span class="op" id="3746825">&gt;&gt;=</span>&nbsp;<span class="num" id="3746829">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3746834">z</span><span class="op" id="3746835">.</span><span class="ident" id="3746836">high</span>&nbsp;<span class="op" id="3746841">|=</span>&nbsp;<span class="ident" id="3746844">z</span><span class="op" id="3746845">.</span><span class="ident" id="3746846">low</span>&nbsp;<span class="op" id="3746850">&lt;&lt;</span>&nbsp;<span class="num" id="3746853">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3746859">z</span><span class="op" id="3746860">.</span><span class="ident" id="3746861">low</span>&nbsp;<span class="op" id="3746865">&gt;&gt;=</span>&nbsp;<span class="num" id="3746869">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3746874">z</span><span class="op" id="3746875">.</span><span class="ident" id="3746876">low</span>&nbsp;<span class="op" id="3746880">^=</span>&nbsp;<span class="ident" id="3746883">uint64</span><span class="op" id="3746889">(</span><span class="ident" id="3746890">gcmReductionTable</span><span class="op" id="3746907">[</span><span class="ident" id="3746908">msw</span><span class="op" id="3746911">]</span><span class="op" id="3746912">)</span>&nbsp;<span class="op" id="3746914">&lt;&lt;</span>&nbsp;<span class="num" id="3746917">48</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3746924">//&nbsp;the&nbsp;values&nbsp;in&nbsp;|table|&nbsp;are&nbsp;ordered&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3746968">//&nbsp;little-endian&nbsp;bit&nbsp;positions.&nbsp;See&nbsp;the&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3747019">//&nbsp;in&nbsp;NewGCM.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3747036">t</span>&nbsp;<span class="op" id="3747038">:=</span>&nbsp;<span class="op" id="3747041">&amp;</span><span class="ident" id="3747042">g</span><span class="op" id="3747043">.</span><span class="ident" id="3747044">productTable</span><span class="op" id="3747056">[</span><span class="ident" id="3747057">word</span><span class="op" id="3747061">&amp;</span><span class="num" id="3747062">0xf</span><span class="op" id="3747065">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3747071">z</span><span class="op" id="3747072">.</span><span class="ident" id="3747073">low</span>&nbsp;<span class="op" id="3747077">^=</span>&nbsp;<span class="ident" id="3747080">t</span><span class="op" id="3747081">.</span><span class="ident" id="3747082">low</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3747089">z</span><span class="op" id="3747090">.</span><span class="ident" id="3747091">high</span>&nbsp;<span class="op" id="3747096">^=</span>&nbsp;<span class="ident" id="3747099">t</span><span class="op" id="3747100">.</span><span class="ident" id="3747101">high</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3747109">word</span>&nbsp;<span class="op" id="3747114">&gt;&gt;=</span>&nbsp;<span class="num" id="3747118">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3747122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3747125">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3747129">*</span><span class="ident" id="3747130">y</span>&nbsp;<span class="op" id="3747132">=</span>&nbsp;<span class="ident" id="3747134">z</span><br>
<span class="lineno"></span><span class="op" id="3747136">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3747139">//&nbsp;updateBlocks&nbsp;extends&nbsp;y&nbsp;with&nbsp;more&nbsp;polynomial&nbsp;terms&nbsp;from&nbsp;blocks,&nbsp;based&nbsp;on</span><br>
<span class="lineno">235</span><span class="comment" id="3747214">//&nbsp;Horner&#39;s&nbsp;rule.&nbsp;There&nbsp;must&nbsp;be&nbsp;a&nbsp;multiple&nbsp;of&nbsp;gcmBlockSize&nbsp;bytes&nbsp;in&nbsp;blocks.</span><br>
<span class="lineno"></span><span class="keyword" id="3747290">func</span>&nbsp;<span class="op" id="3747295">(</span><span class="ident" id="3747296">g</span>&nbsp;<span class="op" id="3747298">*</span><span class="ident" id="3747299">gcm</span><span class="op" id="3747302">)</span>&nbsp;<span class="ident" id="3747304">updateBlocks</span><span class="op" id="3747316">(</span><span class="ident" id="3747317">y</span>&nbsp;<span class="op" id="3747319">*</span><span class="ident" id="3747320">gcmFieldElement</span><span class="op" id="3747335">,</span>&nbsp;<span class="ident" id="3747337">blocks</span>&nbsp;<span class="op" id="3747344">[</span><span class="op" id="3747345">]</span><span class="builtintype" id="3747346">byte</span><span class="op" id="3747350">)</span>&nbsp;<span class="op" id="3747352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3747355">for</span>&nbsp;<span class="builtinfunc" id="3747359">len</span><span class="op" id="3747362">(</span><span class="ident" id="3747363">blocks</span><span class="op" id="3747369">)</span>&nbsp;<span class="op" id="3747371">&gt;</span>&nbsp;<span class="num" id="3747373">0</span>&nbsp;<span class="op" id="3747375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3747379">y</span><span class="op" id="3747380">.</span><span class="ident" id="3747381">low</span>&nbsp;<span class="op" id="3747385">^=</span>&nbsp;<span class="ident" id="3747388">getUint64</span><span class="op" id="3747397">(</span><span class="ident" id="3747398">blocks</span><span class="op" id="3747404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3747408">y</span><span class="op" id="3747409">.</span><span class="ident" id="3747410">high</span>&nbsp;<span class="op" id="3747415">^=</span>&nbsp;<span class="ident" id="3747418">getUint64</span><span class="op" id="3747427">(</span><span class="ident" id="3747428">blocks</span><span class="op" id="3747434">[</span><span class="num" id="3747435">8</span><span class="op" id="3747436">:</span><span class="op" id="3747437">]</span><span class="op" id="3747438">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3747442">g</span><span class="op" id="3747443">.</span><span class="ident" id="3747444">mul</span><span class="op" id="3747447">(</span><span class="ident" id="3747448">y</span><span class="op" id="3747449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3747453">blocks</span>&nbsp;<span class="op" id="3747460">=</span>&nbsp;<span class="ident" id="3747462">blocks</span><span class="op" id="3747468">[</span><span class="ident" id="3747469">gcmBlockSize</span><span class="op" id="3747481">:</span><span class="op" id="3747482">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3747485">}</span><br>
<span class="lineno"></span><span class="op" id="3747487">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span><span class="comment" id="3747490">//&nbsp;update&nbsp;extends&nbsp;y&nbsp;with&nbsp;more&nbsp;polynomial&nbsp;terms&nbsp;from&nbsp;data.&nbsp;If&nbsp;data&nbsp;is&nbsp;not&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3747565">//&nbsp;multiple&nbsp;of&nbsp;gcmBlockSize&nbsp;bytes&nbsp;long&nbsp;then&nbsp;the&nbsp;remainder&nbsp;is&nbsp;zero&nbsp;padded.</span><br>
<span class="lineno"></span><span class="keyword" id="3747639">func</span>&nbsp;<span class="op" id="3747644">(</span><span class="ident" id="3747645">g</span>&nbsp;<span class="op" id="3747647">*</span><span class="ident" id="3747648">gcm</span><span class="op" id="3747651">)</span>&nbsp;<span class="ident" id="3747653">update</span><span class="op" id="3747659">(</span><span class="ident" id="3747660">y</span>&nbsp;<span class="op" id="3747662">*</span><span class="ident" id="3747663">gcmFieldElement</span><span class="op" id="3747678">,</span>&nbsp;<span class="ident" id="3747680">data</span>&nbsp;<span class="op" id="3747685">[</span><span class="op" id="3747686">]</span><span class="builtintype" id="3747687">byte</span><span class="op" id="3747691">)</span>&nbsp;<span class="op" id="3747693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3747696">fullBlocks</span>&nbsp;<span class="op" id="3747707">:=</span>&nbsp;<span class="op" id="3747710">(</span><span class="builtinfunc" id="3747711">len</span><span class="op" id="3747714">(</span><span class="ident" id="3747715">data</span><span class="op" id="3747719">)</span>&nbsp;<span class="op" id="3747721">&gt;&gt;</span>&nbsp;<span class="num" id="3747724">4</span><span class="op" id="3747725">)</span>&nbsp;<span class="op" id="3747727">&lt;&lt;</span>&nbsp;<span class="num" id="3747730">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3747733">g</span><span class="op" id="3747734">.</span><span class="ident" id="3747735">updateBlocks</span><span class="op" id="3747747">(</span><span class="ident" id="3747748">y</span><span class="op" id="3747749">,</span>&nbsp;<span class="ident" id="3747751">data</span><span class="op" id="3747755">[</span><span class="op" id="3747756">:</span><span class="ident" id="3747757">fullBlocks</span><span class="op" id="3747767">]</span><span class="op" id="3747768">)</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3747772">if</span>&nbsp;<span class="builtinfunc" id="3747775">len</span><span class="op" id="3747778">(</span><span class="ident" id="3747779">data</span><span class="op" id="3747783">)</span>&nbsp;<span class="op" id="3747785">!=</span>&nbsp;<span class="ident" id="3747788">fullBlocks</span>&nbsp;<span class="op" id="3747799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3747803">var</span>&nbsp;<span class="ident" id="3747807">partialBlock</span>&nbsp;<span class="op" id="3747820">[</span><span class="ident" id="3747821">gcmBlockSize</span><span class="op" id="3747833">]</span><span class="builtintype" id="3747834">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3747841">copy</span><span class="op" id="3747845">(</span><span class="ident" id="3747846">partialBlock</span><span class="op" id="3747858">[</span><span class="op" id="3747859">:</span><span class="op" id="3747860">]</span><span class="op" id="3747861">,</span>&nbsp;<span class="ident" id="3747863">data</span><span class="op" id="3747867">[</span><span class="ident" id="3747868">fullBlocks</span><span class="op" id="3747878">:</span><span class="op" id="3747879">]</span><span class="op" id="3747880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3747884">g</span><span class="op" id="3747885">.</span><span class="ident" id="3747886">updateBlocks</span><span class="op" id="3747898">(</span><span class="ident" id="3747899">y</span><span class="op" id="3747900">,</span>&nbsp;<span class="ident" id="3747902">partialBlock</span><span class="op" id="3747914">[</span><span class="op" id="3747915">:</span><span class="op" id="3747916">]</span><span class="op" id="3747917">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3747920">}</span><br>
<span class="lineno"></span><span class="op" id="3747922">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3747925">//&nbsp;gcmInc32&nbsp;treats&nbsp;the&nbsp;final&nbsp;four&nbsp;bytes&nbsp;of&nbsp;counterBlock&nbsp;as&nbsp;a&nbsp;big-endian&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="3748003">//&nbsp;and&nbsp;increments&nbsp;it.</span><br>
<span class="lineno">260</span><span class="keyword" id="3748025">func</span>&nbsp;<span class="ident" id="3748030">gcmInc32</span><span class="op" id="3748038">(</span><span class="ident" id="3748039">counterBlock</span>&nbsp;<span class="op" id="3748052">*</span><span class="op" id="3748053">[</span><span class="num" id="3748054">16</span><span class="op" id="3748056">]</span><span class="builtintype" id="3748057">byte</span><span class="op" id="3748061">)</span>&nbsp;<span class="op" id="3748063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3748066">for</span>&nbsp;<span class="ident" id="3748070">i</span>&nbsp;<span class="op" id="3748072">:=</span>&nbsp;<span class="ident" id="3748075">gcmBlockSize</span>&nbsp;<span class="op" id="3748088">-</span>&nbsp;<span class="num" id="3748090">1</span><span class="op" id="3748091">;</span>&nbsp;<span class="ident" id="3748093">i</span>&nbsp;<span class="op" id="3748095">&gt;=</span>&nbsp;<span class="ident" id="3748098">gcmBlockSize</span><span class="op" id="3748110">-</span><span class="num" id="3748111">4</span><span class="op" id="3748112">;</span>&nbsp;<span class="ident" id="3748114">i</span><span class="op" id="3748115">--</span>&nbsp;<span class="op" id="3748118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3748122">counterBlock</span><span class="op" id="3748134">[</span><span class="ident" id="3748135">i</span><span class="op" id="3748136">]</span><span class="op" id="3748137">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3748142">if</span>&nbsp;<span class="ident" id="3748145">counterBlock</span><span class="op" id="3748157">[</span><span class="ident" id="3748158">i</span><span class="op" id="3748159">]</span>&nbsp;<span class="op" id="3748161">!=</span>&nbsp;<span class="num" id="3748164">0</span>&nbsp;<span class="op" id="3748166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3748171">break</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3748179">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3748182">}</span><br>
<span class="lineno"></span><span class="op" id="3748184">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3748187">//&nbsp;sliceForAppend&nbsp;takes&nbsp;a&nbsp;slice&nbsp;and&nbsp;a&nbsp;requested&nbsp;number&nbsp;of&nbsp;bytes.&nbsp;It&nbsp;returns&nbsp;a</span><br>
<span class="lineno">270</span><span class="comment" id="3748265">//&nbsp;slice&nbsp;with&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;given&nbsp;slice&nbsp;followed&nbsp;by&nbsp;that&nbsp;many&nbsp;bytes&nbsp;and&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3748345">//&nbsp;second&nbsp;slice&nbsp;that&nbsp;aliases&nbsp;into&nbsp;it&nbsp;and&nbsp;contains&nbsp;only&nbsp;the&nbsp;extra&nbsp;bytes.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3748424">//&nbsp;original&nbsp;slice&nbsp;has&nbsp;sufficient&nbsp;capacity&nbsp;then&nbsp;no&nbsp;allocation&nbsp;is&nbsp;performed.</span><br>
<span class="lineno"></span><span class="keyword" id="3748499">func</span>&nbsp;<span class="ident" id="3748504">sliceForAppend</span><span class="op" id="3748518">(</span><span class="ident" id="3748519">in</span>&nbsp;<span class="op" id="3748522">[</span><span class="op" id="3748523">]</span><span class="builtintype" id="3748524">byte</span><span class="op" id="3748528">,</span>&nbsp;<span class="ident" id="3748530">n</span>&nbsp;<span class="builtintype" id="3748532">int</span><span class="op" id="3748535">)</span>&nbsp;<span class="op" id="3748537">(</span><span class="ident" id="3748538">head</span><span class="op" id="3748542">,</span>&nbsp;<span class="ident" id="3748544">tail</span>&nbsp;<span class="op" id="3748549">[</span><span class="op" id="3748550">]</span><span class="builtintype" id="3748551">byte</span><span class="op" id="3748555">)</span>&nbsp;<span class="op" id="3748557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3748560">if</span>&nbsp;<span class="ident" id="3748563">total</span>&nbsp;<span class="op" id="3748569">:=</span>&nbsp;<span class="builtinfunc" id="3748572">len</span><span class="op" id="3748575">(</span><span class="ident" id="3748576">in</span><span class="op" id="3748578">)</span>&nbsp;<span class="op" id="3748580">+</span>&nbsp;<span class="ident" id="3748582">n</span><span class="op" id="3748583">;</span>&nbsp;<span class="builtinfunc" id="3748585">cap</span><span class="op" id="3748588">(</span><span class="ident" id="3748589">in</span><span class="op" id="3748591">)</span>&nbsp;<span class="op" id="3748593">&gt;=</span>&nbsp;<span class="ident" id="3748596">total</span>&nbsp;<span class="op" id="3748602">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3748606">head</span>&nbsp;<span class="op" id="3748611">=</span>&nbsp;<span class="ident" id="3748613">in</span><span class="op" id="3748615">[</span><span class="op" id="3748616">:</span><span class="ident" id="3748617">total</span><span class="op" id="3748622">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3748625">}</span>&nbsp;<span class="keyword" id="3748627">else</span>&nbsp;<span class="op" id="3748632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3748636">head</span>&nbsp;<span class="op" id="3748641">=</span>&nbsp;<span class="builtinfunc" id="3748643">make</span><span class="op" id="3748647">(</span><span class="op" id="3748648">[</span><span class="op" id="3748649">]</span><span class="builtintype" id="3748650">byte</span><span class="op" id="3748654">,</span>&nbsp;<span class="ident" id="3748656">total</span><span class="op" id="3748661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3748665">copy</span><span class="op" id="3748669">(</span><span class="ident" id="3748670">head</span><span class="op" id="3748674">,</span>&nbsp;<span class="ident" id="3748676">in</span><span class="op" id="3748678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3748681">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3748684">tail</span>&nbsp;<span class="op" id="3748689">=</span>&nbsp;<span class="ident" id="3748691">head</span><span class="op" id="3748695">[</span><span class="builtinfunc" id="3748696">len</span><span class="op" id="3748699">(</span><span class="ident" id="3748700">in</span><span class="op" id="3748702">)</span><span class="op" id="3748703">:</span><span class="op" id="3748704">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3748707">return</span><br>
<span class="lineno"></span><span class="op" id="3748714">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3748717">//&nbsp;counterCrypt&nbsp;crypts&nbsp;in&nbsp;to&nbsp;out&nbsp;using&nbsp;g.cipher&nbsp;in&nbsp;counter&nbsp;mode.</span><br>
<span class="lineno">285</span><span class="keyword" id="3748782">func</span>&nbsp;<span class="op" id="3748787">(</span><span class="ident" id="3748788">g</span>&nbsp;<span class="op" id="3748790">*</span><span class="ident" id="3748791">gcm</span><span class="op" id="3748794">)</span>&nbsp;<span class="ident" id="3748796">counterCrypt</span><span class="op" id="3748808">(</span><span class="ident" id="3748809">out</span><span class="op" id="3748812">,</span>&nbsp;<span class="ident" id="3748814">in</span>&nbsp;<span class="op" id="3748817">[</span><span class="op" id="3748818">]</span><span class="builtintype" id="3748819">byte</span><span class="op" id="3748823">,</span>&nbsp;<span class="ident" id="3748825">counter</span>&nbsp;<span class="op" id="3748833">*</span><span class="op" id="3748834">[</span><span class="ident" id="3748835">gcmBlockSize</span><span class="op" id="3748847">]</span><span class="builtintype" id="3748848">byte</span><span class="op" id="3748852">)</span>&nbsp;<span class="op" id="3748854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3748857">var</span>&nbsp;<span class="ident" id="3748861">mask</span>&nbsp;<span class="op" id="3748866">[</span><span class="ident" id="3748867">gcmBlockSize</span><span class="op" id="3748879">]</span><span class="builtintype" id="3748880">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3748887">for</span>&nbsp;<span class="builtinfunc" id="3748891">len</span><span class="op" id="3748894">(</span><span class="ident" id="3748895">in</span><span class="op" id="3748897">)</span>&nbsp;<span class="op" id="3748899">&gt;=</span>&nbsp;<span class="ident" id="3748902">gcmBlockSize</span>&nbsp;<span class="op" id="3748915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3748919">g</span><span class="op" id="3748920">.</span><span class="ident" id="3748921">cipher</span><span class="op" id="3748927">.</span><span class="ident" id="3748928">Encrypt</span><span class="op" id="3748935">(</span><span class="ident" id="3748936">mask</span><span class="op" id="3748940">[</span><span class="op" id="3748941">:</span><span class="op" id="3748942">]</span><span class="op" id="3748943">,</span>&nbsp;<span class="ident" id="3748945">counter</span><span class="op" id="3748952">[</span><span class="op" id="3748953">:</span><span class="op" id="3748954">]</span><span class="op" id="3748955">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3748959">gcmInc32</span><span class="op" id="3748967">(</span><span class="ident" id="3748968">counter</span><span class="op" id="3748975">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3748980">xorWords</span><span class="op" id="3748988">(</span><span class="ident" id="3748989">out</span><span class="op" id="3748992">,</span>&nbsp;<span class="ident" id="3748994">in</span><span class="op" id="3748996">,</span>&nbsp;<span class="ident" id="3748998">mask</span><span class="op" id="3749002">[</span><span class="op" id="3749003">:</span><span class="op" id="3749004">]</span><span class="op" id="3749005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3749009">out</span>&nbsp;<span class="op" id="3749013">=</span>&nbsp;<span class="ident" id="3749015">out</span><span class="op" id="3749018">[</span><span class="ident" id="3749019">gcmBlockSize</span><span class="op" id="3749031">:</span><span class="op" id="3749032">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3749036">in</span>&nbsp;<span class="op" id="3749039">=</span>&nbsp;<span class="ident" id="3749041">in</span><span class="op" id="3749043">[</span><span class="ident" id="3749044">gcmBlockSize</span><span class="op" id="3749056">:</span><span class="op" id="3749057">]</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3749060">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3749064">if</span>&nbsp;<span class="builtinfunc" id="3749067">len</span><span class="op" id="3749070">(</span><span class="ident" id="3749071">in</span><span class="op" id="3749073">)</span>&nbsp;<span class="op" id="3749075">&gt;</span>&nbsp;<span class="num" id="3749077">0</span>&nbsp;<span class="op" id="3749079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3749083">g</span><span class="op" id="3749084">.</span><span class="ident" id="3749085">cipher</span><span class="op" id="3749091">.</span><span class="ident" id="3749092">Encrypt</span><span class="op" id="3749099">(</span><span class="ident" id="3749100">mask</span><span class="op" id="3749104">[</span><span class="op" id="3749105">:</span><span class="op" id="3749106">]</span><span class="op" id="3749107">,</span>&nbsp;<span class="ident" id="3749109">counter</span><span class="op" id="3749116">[</span><span class="op" id="3749117">:</span><span class="op" id="3749118">]</span><span class="op" id="3749119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3749123">gcmInc32</span><span class="op" id="3749131">(</span><span class="ident" id="3749132">counter</span><span class="op" id="3749139">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3749143">xorBytes</span><span class="op" id="3749151">(</span><span class="ident" id="3749152">out</span><span class="op" id="3749155">,</span>&nbsp;<span class="ident" id="3749157">in</span><span class="op" id="3749159">,</span>&nbsp;<span class="ident" id="3749161">mask</span><span class="op" id="3749165">[</span><span class="op" id="3749166">:</span><span class="op" id="3749167">]</span><span class="op" id="3749168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3749171">}</span><br>
<span class="lineno"></span><span class="op" id="3749173">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3749176">//&nbsp;auth&nbsp;calculates&nbsp;GHASH(ciphertext,&nbsp;additionalData),&nbsp;masks&nbsp;the&nbsp;result&nbsp;with</span><br>
<span class="lineno">305</span><span class="comment" id="3749252">//&nbsp;tagMask&nbsp;and&nbsp;writes&nbsp;the&nbsp;result&nbsp;to&nbsp;out.</span><br>
<span class="lineno"></span><span class="keyword" id="3749293">func</span>&nbsp;<span class="op" id="3749298">(</span><span class="ident" id="3749299">g</span>&nbsp;<span class="op" id="3749301">*</span><span class="ident" id="3749302">gcm</span><span class="op" id="3749305">)</span>&nbsp;<span class="ident" id="3749307">auth</span><span class="op" id="3749311">(</span><span class="ident" id="3749312">out</span><span class="op" id="3749315">,</span>&nbsp;<span class="ident" id="3749317">ciphertext</span><span class="op" id="3749327">,</span>&nbsp;<span class="ident" id="3749329">additionalData</span>&nbsp;<span class="op" id="3749344">[</span><span class="op" id="3749345">]</span><span class="builtintype" id="3749346">byte</span><span class="op" id="3749350">,</span>&nbsp;<span class="ident" id="3749352">tagMask</span>&nbsp;<span class="op" id="3749360">*</span><span class="op" id="3749361">[</span><span class="ident" id="3749362">gcmTagSize</span><span class="op" id="3749372">]</span><span class="builtintype" id="3749373">byte</span><span class="op" id="3749377">)</span>&nbsp;<span class="op" id="3749379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3749382">var</span>&nbsp;<span class="ident" id="3749386">y</span>&nbsp;<span class="ident" id="3749388">gcmFieldElement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3749405">g</span><span class="op" id="3749406">.</span><span class="ident" id="3749407">update</span><span class="op" id="3749413">(</span><span class="op" id="3749414">&amp;</span><span class="ident" id="3749415">y</span><span class="op" id="3749416">,</span>&nbsp;<span class="ident" id="3749418">additionalData</span><span class="op" id="3749432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3749435">g</span><span class="op" id="3749436">.</span><span class="ident" id="3749437">update</span><span class="op" id="3749443">(</span><span class="op" id="3749444">&amp;</span><span class="ident" id="3749445">y</span><span class="op" id="3749446">,</span>&nbsp;<span class="ident" id="3749448">ciphertext</span><span class="op" id="3749458">)</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3749462">y</span><span class="op" id="3749463">.</span><span class="ident" id="3749464">low</span>&nbsp;<span class="op" id="3749468">^=</span>&nbsp;<span class="ident" id="3749471">uint64</span><span class="op" id="3749477">(</span><span class="builtinfunc" id="3749478">len</span><span class="op" id="3749481">(</span><span class="ident" id="3749482">additionalData</span><span class="op" id="3749496">)</span><span class="op" id="3749497">)</span>&nbsp;<span class="op" id="3749499">*</span>&nbsp;<span class="num" id="3749501">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3749504">y</span><span class="op" id="3749505">.</span><span class="ident" id="3749506">high</span>&nbsp;<span class="op" id="3749511">^=</span>&nbsp;<span class="ident" id="3749514">uint64</span><span class="op" id="3749520">(</span><span class="builtinfunc" id="3749521">len</span><span class="op" id="3749524">(</span><span class="ident" id="3749525">ciphertext</span><span class="op" id="3749535">)</span><span class="op" id="3749536">)</span>&nbsp;<span class="op" id="3749538">*</span>&nbsp;<span class="num" id="3749540">8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3749544">g</span><span class="op" id="3749545">.</span><span class="ident" id="3749546">mul</span><span class="op" id="3749549">(</span><span class="op" id="3749550">&amp;</span><span class="ident" id="3749551">y</span><span class="op" id="3749552">)</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3749556">putUint64</span><span class="op" id="3749565">(</span><span class="ident" id="3749566">out</span><span class="op" id="3749569">,</span>&nbsp;<span class="ident" id="3749571">y</span><span class="op" id="3749572">.</span><span class="ident" id="3749573">low</span><span class="op" id="3749576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3749579">putUint64</span><span class="op" id="3749588">(</span><span class="ident" id="3749589">out</span><span class="op" id="3749592">[</span><span class="num" id="3749593">8</span><span class="op" id="3749594">:</span><span class="op" id="3749595">]</span><span class="op" id="3749596">,</span>&nbsp;<span class="ident" id="3749598">y</span><span class="op" id="3749599">.</span><span class="ident" id="3749600">high</span><span class="op" id="3749604">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3749608">xorWords</span><span class="op" id="3749616">(</span><span class="ident" id="3749617">out</span><span class="op" id="3749620">,</span>&nbsp;<span class="ident" id="3749622">out</span><span class="op" id="3749625">,</span>&nbsp;<span class="ident" id="3749627">tagMask</span><span class="op" id="3749634">[</span><span class="op" id="3749635">:</span><span class="op" id="3749636">]</span><span class="op" id="3749637">)</span><br>
<span class="lineno">320</span><span class="op" id="3749639">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3749642">func</span>&nbsp;<span class="ident" id="3749647">getUint64</span><span class="op" id="3749656">(</span><span class="ident" id="3749657">data</span>&nbsp;<span class="op" id="3749662">[</span><span class="op" id="3749663">]</span><span class="builtintype" id="3749664">byte</span><span class="op" id="3749668">)</span>&nbsp;<span class="ident" id="3749670">uint64</span>&nbsp;<span class="op" id="3749677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3749680">r</span>&nbsp;<span class="op" id="3749682">:=</span>&nbsp;<span class="ident" id="3749685">uint64</span><span class="op" id="3749691">(</span><span class="ident" id="3749692">data</span><span class="op" id="3749696">[</span><span class="num" id="3749697">0</span><span class="op" id="3749698">]</span><span class="op" id="3749699">)</span><span class="op" id="3749700">&lt;&lt;</span><span class="num" id="3749702">56</span>&nbsp;<span class="op" id="3749705">|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3749709">uint64</span><span class="op" id="3749715">(</span><span class="ident" id="3749716">data</span><span class="op" id="3749720">[</span><span class="num" id="3749721">1</span><span class="op" id="3749722">]</span><span class="op" id="3749723">)</span><span class="op" id="3749724">&lt;&lt;</span><span class="num" id="3749726">48</span>&nbsp;<span class="op" id="3749729">|</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3749733">uint64</span><span class="op" id="3749739">(</span><span class="ident" id="3749740">data</span><span class="op" id="3749744">[</span><span class="num" id="3749745">2</span><span class="op" id="3749746">]</span><span class="op" id="3749747">)</span><span class="op" id="3749748">&lt;&lt;</span><span class="num" id="3749750">40</span>&nbsp;<span class="op" id="3749753">|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3749757">uint64</span><span class="op" id="3749763">(</span><span class="ident" id="3749764">data</span><span class="op" id="3749768">[</span><span class="num" id="3749769">3</span><span class="op" id="3749770">]</span><span class="op" id="3749771">)</span><span class="op" id="3749772">&lt;&lt;</span><span class="num" id="3749774">32</span>&nbsp;<span class="op" id="3749777">|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3749781">uint64</span><span class="op" id="3749787">(</span><span class="ident" id="3749788">data</span><span class="op" id="3749792">[</span><span class="num" id="3749793">4</span><span class="op" id="3749794">]</span><span class="op" id="3749795">)</span><span class="op" id="3749796">&lt;&lt;</span><span class="num" id="3749798">24</span>&nbsp;<span class="op" id="3749801">|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3749805">uint64</span><span class="op" id="3749811">(</span><span class="ident" id="3749812">data</span><span class="op" id="3749816">[</span><span class="num" id="3749817">5</span><span class="op" id="3749818">]</span><span class="op" id="3749819">)</span><span class="op" id="3749820">&lt;&lt;</span><span class="num" id="3749822">16</span>&nbsp;<span class="op" id="3749825">|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3749829">uint64</span><span class="op" id="3749835">(</span><span class="ident" id="3749836">data</span><span class="op" id="3749840">[</span><span class="num" id="3749841">6</span><span class="op" id="3749842">]</span><span class="op" id="3749843">)</span><span class="op" id="3749844">&lt;&lt;</span><span class="num" id="3749846">8</span>&nbsp;<span class="op" id="3749848">|</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3749852">uint64</span><span class="op" id="3749858">(</span><span class="ident" id="3749859">data</span><span class="op" id="3749863">[</span><span class="num" id="3749864">7</span><span class="op" id="3749865">]</span><span class="op" id="3749866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3749869">return</span>&nbsp;<span class="ident" id="3749876">r</span><br>
<span class="lineno"></span><span class="op" id="3749878">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3749881">func</span>&nbsp;<span class="ident" id="3749886">putUint64</span><span class="op" id="3749895">(</span><span class="ident" id="3749896">out</span>&nbsp;<span class="op" id="3749900">[</span><span class="op" id="3749901">]</span><span class="builtintype" id="3749902">byte</span><span class="op" id="3749906">,</span>&nbsp;<span class="ident" id="3749908">v</span>&nbsp;<span class="ident" id="3749910">uint64</span><span class="op" id="3749916">)</span>&nbsp;<span class="op" id="3749918">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3749921">out</span><span class="op" id="3749924">[</span><span class="num" id="3749925">0</span><span class="op" id="3749926">]</span>&nbsp;<span class="op" id="3749928">=</span>&nbsp;<span class="builtintype" id="3749930">byte</span><span class="op" id="3749934">(</span><span class="ident" id="3749935">v</span>&nbsp;<span class="op" id="3749937">&gt;&gt;</span>&nbsp;<span class="num" id="3749940">56</span><span class="op" id="3749942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3749945">out</span><span class="op" id="3749948">[</span><span class="num" id="3749949">1</span><span class="op" id="3749950">]</span>&nbsp;<span class="op" id="3749952">=</span>&nbsp;<span class="builtintype" id="3749954">byte</span><span class="op" id="3749958">(</span><span class="ident" id="3749959">v</span>&nbsp;<span class="op" id="3749961">&gt;&gt;</span>&nbsp;<span class="num" id="3749964">48</span><span class="op" id="3749966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3749969">out</span><span class="op" id="3749972">[</span><span class="num" id="3749973">2</span><span class="op" id="3749974">]</span>&nbsp;<span class="op" id="3749976">=</span>&nbsp;<span class="builtintype" id="3749978">byte</span><span class="op" id="3749982">(</span><span class="ident" id="3749983">v</span>&nbsp;<span class="op" id="3749985">&gt;&gt;</span>&nbsp;<span class="num" id="3749988">40</span><span class="op" id="3749990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3749993">out</span><span class="op" id="3749996">[</span><span class="num" id="3749997">3</span><span class="op" id="3749998">]</span>&nbsp;<span class="op" id="3750000">=</span>&nbsp;<span class="builtintype" id="3750002">byte</span><span class="op" id="3750006">(</span><span class="ident" id="3750007">v</span>&nbsp;<span class="op" id="3750009">&gt;&gt;</span>&nbsp;<span class="num" id="3750012">32</span><span class="op" id="3750014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3750017">out</span><span class="op" id="3750020">[</span><span class="num" id="3750021">4</span><span class="op" id="3750022">]</span>&nbsp;<span class="op" id="3750024">=</span>&nbsp;<span class="builtintype" id="3750026">byte</span><span class="op" id="3750030">(</span><span class="ident" id="3750031">v</span>&nbsp;<span class="op" id="3750033">&gt;&gt;</span>&nbsp;<span class="num" id="3750036">24</span><span class="op" id="3750038">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3750041">out</span><span class="op" id="3750044">[</span><span class="num" id="3750045">5</span><span class="op" id="3750046">]</span>&nbsp;<span class="op" id="3750048">=</span>&nbsp;<span class="builtintype" id="3750050">byte</span><span class="op" id="3750054">(</span><span class="ident" id="3750055">v</span>&nbsp;<span class="op" id="3750057">&gt;&gt;</span>&nbsp;<span class="num" id="3750060">16</span><span class="op" id="3750062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3750065">out</span><span class="op" id="3750068">[</span><span class="num" id="3750069">6</span><span class="op" id="3750070">]</span>&nbsp;<span class="op" id="3750072">=</span>&nbsp;<span class="builtintype" id="3750074">byte</span><span class="op" id="3750078">(</span><span class="ident" id="3750079">v</span>&nbsp;<span class="op" id="3750081">&gt;&gt;</span>&nbsp;<span class="num" id="3750084">8</span><span class="op" id="3750085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3750088">out</span><span class="op" id="3750091">[</span><span class="num" id="3750092">7</span><span class="op" id="3750093">]</span>&nbsp;<span class="op" id="3750095">=</span>&nbsp;<span class="builtintype" id="3750097">byte</span><span class="op" id="3750101">(</span><span class="ident" id="3750102">v</span><span class="op" id="3750103">)</span><br>
<span class="lineno"></span><span class="op" id="3750105">}</span>
</div>
</body>
</html>
