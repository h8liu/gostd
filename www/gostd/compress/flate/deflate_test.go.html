<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/flate</h2>
<ul>
<li><a href="/gostd/compress/flate/copy.go.html">copy.go</a></li>
<li><a href="/gostd/compress/flate/copy_test.go.html">copy_test.go</a></li>
<li><a href="/gostd/compress/flate/deflate.go.html">deflate.go</a></li>
<li><a href="/gostd/compress/flate/deflate_test.go.html">deflate_test.go</a></li>
<li><a href="/gostd/compress/flate/fixedhuff.go.html">fixedhuff.go</a></li>
<li><a href="/gostd/compress/flate/flate_test.go.html">flate_test.go</a></li>
<li><a href="/gostd/compress/flate/huffman_bit_writer.go.html">huffman_bit_writer.go</a></li>
<li><a href="/gostd/compress/flate/huffman_code.go.html">huffman_code.go</a></li>
<li><a href="/gostd/compress/flate/inflate.go.html">inflate.go</a></li>
<li><a href="/gostd/compress/flate/inflate_test.go.html">inflate_test.go</a></li>
<li><a href="/gostd/compress/flate/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/flate/reverse_bits.go.html">reverse_bits.go</a></li>
<li><a href="/gostd/compress/flate/token.go.html">token.go</a></li>
<li><a href="/gostd/compress/flate/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6690565">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6690620">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6690674">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6690725">package</span>&nbsp;<span class="ident" id="6690733">flate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6690740">import</span>&nbsp;<span class="op" id="6690747">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6690750">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6690759">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6690766">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6690772">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6690785">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6690796">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6690804">&#34;testing&#34;</span><br>
<span class="lineno">15</span><span class="op" id="6690814">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6690817">type</span>&nbsp;<span class="ident" id="6690822">deflateTest</span>&nbsp;<span class="keyword" id="6690834">struct</span>&nbsp;<span class="op" id="6690841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6690844">in</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6690850">[</span><span class="op" id="6690851">]</span><span class="builtintype" id="6690852">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6690858">level</span>&nbsp;<span class="builtintype" id="6690864">int</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6690869">out</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6690875">[</span><span class="op" id="6690876">]</span><span class="builtintype" id="6690877">byte</span><br>
<span class="lineno"></span><span class="op" id="6690882">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6690885">type</span>&nbsp;<span class="ident" id="6690890">deflateInflateTest</span>&nbsp;<span class="keyword" id="6690909">struct</span>&nbsp;<span class="op" id="6690916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6690919">in</span>&nbsp;<span class="op" id="6690922">[</span><span class="op" id="6690923">]</span><span class="builtintype" id="6690924">byte</span><br>
<span class="lineno">25</span><span class="op" id="6690929">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6690932">type</span>&nbsp;<span class="ident" id="6690937">reverseBitsTest</span>&nbsp;<span class="keyword" id="6690953">struct</span>&nbsp;<span class="op" id="6690960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6690963">in</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6690972">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6690980">bitCount</span>&nbsp;<span class="builtintype" id="6690989">uint8</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6690996">out</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6691005">uint16</span><br>
<span class="lineno"></span><span class="op" id="6691012">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6691015">var</span>&nbsp;<span class="ident" id="6691019">deflateTests</span>&nbsp;<span class="op" id="6691032">=</span>&nbsp;<span class="op" id="6691034">[</span><span class="op" id="6691035">]</span><span class="op" id="6691036">*</span><span class="ident" id="6691037">deflateTest</span><span class="op" id="6691048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6691051">{</span><span class="op" id="6691052">[</span><span class="op" id="6691053">]</span><span class="builtintype" id="6691054">byte</span><span class="op" id="6691058">{</span><span class="op" id="6691059">}</span><span class="op" id="6691060">,</span>&nbsp;<span class="num" id="6691062">0</span><span class="op" id="6691063">,</span>&nbsp;<span class="op" id="6691065">[</span><span class="op" id="6691066">]</span><span class="builtintype" id="6691067">byte</span><span class="op" id="6691071">{</span><span class="num" id="6691072">1</span><span class="op" id="6691073">,</span>&nbsp;<span class="num" id="6691075">0</span><span class="op" id="6691076">,</span>&nbsp;<span class="num" id="6691078">0</span><span class="op" id="6691079">,</span>&nbsp;<span class="num" id="6691081">255</span><span class="op" id="6691084">,</span>&nbsp;<span class="num" id="6691086">255</span><span class="op" id="6691089">}</span><span class="op" id="6691090">}</span><span class="op" id="6691091">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6691094">{</span><span class="op" id="6691095">[</span><span class="op" id="6691096">]</span><span class="builtintype" id="6691097">byte</span><span class="op" id="6691101">{</span><span class="num" id="6691102">0x11</span><span class="op" id="6691106">}</span><span class="op" id="6691107">,</span>&nbsp;<span class="op" id="6691109">-</span><span class="num" id="6691110">1</span><span class="op" id="6691111">,</span>&nbsp;<span class="op" id="6691113">[</span><span class="op" id="6691114">]</span><span class="builtintype" id="6691115">byte</span><span class="op" id="6691119">{</span><span class="num" id="6691120">18</span><span class="op" id="6691122">,</span>&nbsp;<span class="num" id="6691124">4</span><span class="op" id="6691125">,</span>&nbsp;<span class="num" id="6691127">4</span><span class="op" id="6691128">,</span>&nbsp;<span class="num" id="6691130">0</span><span class="op" id="6691131">,</span>&nbsp;<span class="num" id="6691133">0</span><span class="op" id="6691134">,</span>&nbsp;<span class="num" id="6691136">255</span><span class="op" id="6691139">,</span>&nbsp;<span class="num" id="6691141">255</span><span class="op" id="6691144">}</span><span class="op" id="6691145">}</span><span class="op" id="6691146">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6691149">{</span><span class="op" id="6691150">[</span><span class="op" id="6691151">]</span><span class="builtintype" id="6691152">byte</span><span class="op" id="6691156">{</span><span class="num" id="6691157">0x11</span><span class="op" id="6691161">}</span><span class="op" id="6691162">,</span>&nbsp;<span class="ident" id="6691164">DefaultCompression</span><span class="op" id="6691182">,</span>&nbsp;<span class="op" id="6691184">[</span><span class="op" id="6691185">]</span><span class="builtintype" id="6691186">byte</span><span class="op" id="6691190">{</span><span class="num" id="6691191">18</span><span class="op" id="6691193">,</span>&nbsp;<span class="num" id="6691195">4</span><span class="op" id="6691196">,</span>&nbsp;<span class="num" id="6691198">4</span><span class="op" id="6691199">,</span>&nbsp;<span class="num" id="6691201">0</span><span class="op" id="6691202">,</span>&nbsp;<span class="num" id="6691204">0</span><span class="op" id="6691205">,</span>&nbsp;<span class="num" id="6691207">255</span><span class="op" id="6691210">,</span>&nbsp;<span class="num" id="6691212">255</span><span class="op" id="6691215">}</span><span class="op" id="6691216">}</span><span class="op" id="6691217">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6691220">{</span><span class="op" id="6691221">[</span><span class="op" id="6691222">]</span><span class="builtintype" id="6691223">byte</span><span class="op" id="6691227">{</span><span class="num" id="6691228">0x11</span><span class="op" id="6691232">}</span><span class="op" id="6691233">,</span>&nbsp;<span class="num" id="6691235">4</span><span class="op" id="6691236">,</span>&nbsp;<span class="op" id="6691238">[</span><span class="op" id="6691239">]</span><span class="builtintype" id="6691240">byte</span><span class="op" id="6691244">{</span><span class="num" id="6691245">18</span><span class="op" id="6691247">,</span>&nbsp;<span class="num" id="6691249">4</span><span class="op" id="6691250">,</span>&nbsp;<span class="num" id="6691252">4</span><span class="op" id="6691253">,</span>&nbsp;<span class="num" id="6691255">0</span><span class="op" id="6691256">,</span>&nbsp;<span class="num" id="6691258">0</span><span class="op" id="6691259">,</span>&nbsp;<span class="num" id="6691261">255</span><span class="op" id="6691264">,</span>&nbsp;<span class="num" id="6691266">255</span><span class="op" id="6691269">}</span><span class="op" id="6691270">}</span><span class="op" id="6691271">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6691275">{</span><span class="op" id="6691276">[</span><span class="op" id="6691277">]</span><span class="builtintype" id="6691278">byte</span><span class="op" id="6691282">{</span><span class="num" id="6691283">0x11</span><span class="op" id="6691287">}</span><span class="op" id="6691288">,</span>&nbsp;<span class="num" id="6691290">0</span><span class="op" id="6691291">,</span>&nbsp;<span class="op" id="6691293">[</span><span class="op" id="6691294">]</span><span class="builtintype" id="6691295">byte</span><span class="op" id="6691299">{</span><span class="num" id="6691300">0</span><span class="op" id="6691301">,</span>&nbsp;<span class="num" id="6691303">1</span><span class="op" id="6691304">,</span>&nbsp;<span class="num" id="6691306">0</span><span class="op" id="6691307">,</span>&nbsp;<span class="num" id="6691309">254</span><span class="op" id="6691312">,</span>&nbsp;<span class="num" id="6691314">255</span><span class="op" id="6691317">,</span>&nbsp;<span class="num" id="6691319">17</span><span class="op" id="6691321">,</span>&nbsp;<span class="num" id="6691323">1</span><span class="op" id="6691324">,</span>&nbsp;<span class="num" id="6691326">0</span><span class="op" id="6691327">,</span>&nbsp;<span class="num" id="6691329">0</span><span class="op" id="6691330">,</span>&nbsp;<span class="num" id="6691332">255</span><span class="op" id="6691335">,</span>&nbsp;<span class="num" id="6691337">255</span><span class="op" id="6691340">}</span><span class="op" id="6691341">}</span><span class="op" id="6691342">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6691345">{</span><span class="op" id="6691346">[</span><span class="op" id="6691347">]</span><span class="builtintype" id="6691348">byte</span><span class="op" id="6691352">{</span><span class="num" id="6691353">0x11</span><span class="op" id="6691357">,</span>&nbsp;<span class="num" id="6691359">0x12</span><span class="op" id="6691363">}</span><span class="op" id="6691364">,</span>&nbsp;<span class="num" id="6691366">0</span><span class="op" id="6691367">,</span>&nbsp;<span class="op" id="6691369">[</span><span class="op" id="6691370">]</span><span class="builtintype" id="6691371">byte</span><span class="op" id="6691375">{</span><span class="num" id="6691376">0</span><span class="op" id="6691377">,</span>&nbsp;<span class="num" id="6691379">2</span><span class="op" id="6691380">,</span>&nbsp;<span class="num" id="6691382">0</span><span class="op" id="6691383">,</span>&nbsp;<span class="num" id="6691385">253</span><span class="op" id="6691388">,</span>&nbsp;<span class="num" id="6691390">255</span><span class="op" id="6691393">,</span>&nbsp;<span class="num" id="6691395">17</span><span class="op" id="6691397">,</span>&nbsp;<span class="num" id="6691399">18</span><span class="op" id="6691401">,</span>&nbsp;<span class="num" id="6691403">1</span><span class="op" id="6691404">,</span>&nbsp;<span class="num" id="6691406">0</span><span class="op" id="6691407">,</span>&nbsp;<span class="num" id="6691409">0</span><span class="op" id="6691410">,</span>&nbsp;<span class="num" id="6691412">255</span><span class="op" id="6691415">,</span>&nbsp;<span class="num" id="6691417">255</span><span class="op" id="6691420">}</span><span class="op" id="6691421">}</span><span class="op" id="6691422">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6691425">{</span><span class="op" id="6691426">[</span><span class="op" id="6691427">]</span><span class="builtintype" id="6691428">byte</span><span class="op" id="6691432">{</span><span class="num" id="6691433">0x11</span><span class="op" id="6691437">,</span>&nbsp;<span class="num" id="6691439">0x11</span><span class="op" id="6691443">,</span>&nbsp;<span class="num" id="6691445">0x11</span><span class="op" id="6691449">,</span>&nbsp;<span class="num" id="6691451">0x11</span><span class="op" id="6691455">,</span>&nbsp;<span class="num" id="6691457">0x11</span><span class="op" id="6691461">,</span>&nbsp;<span class="num" id="6691463">0x11</span><span class="op" id="6691467">,</span>&nbsp;<span class="num" id="6691469">0x11</span><span class="op" id="6691473">,</span>&nbsp;<span class="num" id="6691475">0x11</span><span class="op" id="6691479">}</span><span class="op" id="6691480">,</span>&nbsp;<span class="num" id="6691482">0</span><span class="op" id="6691483">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6691487">[</span><span class="op" id="6691488">]</span><span class="builtintype" id="6691489">byte</span><span class="op" id="6691493">{</span><span class="num" id="6691494">0</span><span class="op" id="6691495">,</span>&nbsp;<span class="num" id="6691497">8</span><span class="op" id="6691498">,</span>&nbsp;<span class="num" id="6691500">0</span><span class="op" id="6691501">,</span>&nbsp;<span class="num" id="6691503">247</span><span class="op" id="6691506">,</span>&nbsp;<span class="num" id="6691508">255</span><span class="op" id="6691511">,</span>&nbsp;<span class="num" id="6691513">17</span><span class="op" id="6691515">,</span>&nbsp;<span class="num" id="6691517">17</span><span class="op" id="6691519">,</span>&nbsp;<span class="num" id="6691521">17</span><span class="op" id="6691523">,</span>&nbsp;<span class="num" id="6691525">17</span><span class="op" id="6691527">,</span>&nbsp;<span class="num" id="6691529">17</span><span class="op" id="6691531">,</span>&nbsp;<span class="num" id="6691533">17</span><span class="op" id="6691535">,</span>&nbsp;<span class="num" id="6691537">17</span><span class="op" id="6691539">,</span>&nbsp;<span class="num" id="6691541">17</span><span class="op" id="6691543">,</span>&nbsp;<span class="num" id="6691545">1</span><span class="op" id="6691546">,</span>&nbsp;<span class="num" id="6691548">0</span><span class="op" id="6691549">,</span>&nbsp;<span class="num" id="6691551">0</span><span class="op" id="6691552">,</span>&nbsp;<span class="num" id="6691554">255</span><span class="op" id="6691557">,</span>&nbsp;<span class="num" id="6691559">255</span><span class="op" id="6691562">}</span><span class="op" id="6691563">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6691566">}</span><span class="op" id="6691567">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6691570">{</span><span class="op" id="6691571">[</span><span class="op" id="6691572">]</span><span class="builtintype" id="6691573">byte</span><span class="op" id="6691577">{</span><span class="op" id="6691578">}</span><span class="op" id="6691579">,</span>&nbsp;<span class="num" id="6691581">1</span><span class="op" id="6691582">,</span>&nbsp;<span class="op" id="6691584">[</span><span class="op" id="6691585">]</span><span class="builtintype" id="6691586">byte</span><span class="op" id="6691590">{</span><span class="num" id="6691591">1</span><span class="op" id="6691592">,</span>&nbsp;<span class="num" id="6691594">0</span><span class="op" id="6691595">,</span>&nbsp;<span class="num" id="6691597">0</span><span class="op" id="6691598">,</span>&nbsp;<span class="num" id="6691600">255</span><span class="op" id="6691603">,</span>&nbsp;<span class="num" id="6691605">255</span><span class="op" id="6691608">}</span><span class="op" id="6691609">}</span><span class="op" id="6691610">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6691613">{</span><span class="op" id="6691614">[</span><span class="op" id="6691615">]</span><span class="builtintype" id="6691616">byte</span><span class="op" id="6691620">{</span><span class="num" id="6691621">0x11</span><span class="op" id="6691625">}</span><span class="op" id="6691626">,</span>&nbsp;<span class="num" id="6691628">1</span><span class="op" id="6691629">,</span>&nbsp;<span class="op" id="6691631">[</span><span class="op" id="6691632">]</span><span class="builtintype" id="6691633">byte</span><span class="op" id="6691637">{</span><span class="num" id="6691638">18</span><span class="op" id="6691640">,</span>&nbsp;<span class="num" id="6691642">4</span><span class="op" id="6691643">,</span>&nbsp;<span class="num" id="6691645">4</span><span class="op" id="6691646">,</span>&nbsp;<span class="num" id="6691648">0</span><span class="op" id="6691649">,</span>&nbsp;<span class="num" id="6691651">0</span><span class="op" id="6691652">,</span>&nbsp;<span class="num" id="6691654">255</span><span class="op" id="6691657">,</span>&nbsp;<span class="num" id="6691659">255</span><span class="op" id="6691662">}</span><span class="op" id="6691663">}</span><span class="op" id="6691664">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6691667">{</span><span class="op" id="6691668">[</span><span class="op" id="6691669">]</span><span class="builtintype" id="6691670">byte</span><span class="op" id="6691674">{</span><span class="num" id="6691675">0x11</span><span class="op" id="6691679">,</span>&nbsp;<span class="num" id="6691681">0x12</span><span class="op" id="6691685">}</span><span class="op" id="6691686">,</span>&nbsp;<span class="num" id="6691688">1</span><span class="op" id="6691689">,</span>&nbsp;<span class="op" id="6691691">[</span><span class="op" id="6691692">]</span><span class="builtintype" id="6691693">byte</span><span class="op" id="6691697">{</span><span class="num" id="6691698">18</span><span class="op" id="6691700">,</span>&nbsp;<span class="num" id="6691702">20</span><span class="op" id="6691704">,</span>&nbsp;<span class="num" id="6691706">2</span><span class="op" id="6691707">,</span>&nbsp;<span class="num" id="6691709">4</span><span class="op" id="6691710">,</span>&nbsp;<span class="num" id="6691712">0</span><span class="op" id="6691713">,</span>&nbsp;<span class="num" id="6691715">0</span><span class="op" id="6691716">,</span>&nbsp;<span class="num" id="6691718">255</span><span class="op" id="6691721">,</span>&nbsp;<span class="num" id="6691723">255</span><span class="op" id="6691726">}</span><span class="op" id="6691727">}</span><span class="op" id="6691728">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6691731">{</span><span class="op" id="6691732">[</span><span class="op" id="6691733">]</span><span class="builtintype" id="6691734">byte</span><span class="op" id="6691738">{</span><span class="num" id="6691739">0x11</span><span class="op" id="6691743">,</span>&nbsp;<span class="num" id="6691745">0x11</span><span class="op" id="6691749">,</span>&nbsp;<span class="num" id="6691751">0x11</span><span class="op" id="6691755">,</span>&nbsp;<span class="num" id="6691757">0x11</span><span class="op" id="6691761">,</span>&nbsp;<span class="num" id="6691763">0x11</span><span class="op" id="6691767">,</span>&nbsp;<span class="num" id="6691769">0x11</span><span class="op" id="6691773">,</span>&nbsp;<span class="num" id="6691775">0x11</span><span class="op" id="6691779">,</span>&nbsp;<span class="num" id="6691781">0x11</span><span class="op" id="6691785">}</span><span class="op" id="6691786">,</span>&nbsp;<span class="num" id="6691788">1</span><span class="op" id="6691789">,</span>&nbsp;<span class="op" id="6691791">[</span><span class="op" id="6691792">]</span><span class="builtintype" id="6691793">byte</span><span class="op" id="6691797">{</span><span class="num" id="6691798">18</span><span class="op" id="6691800">,</span>&nbsp;<span class="num" id="6691802">132</span><span class="op" id="6691805">,</span>&nbsp;<span class="num" id="6691807">2</span><span class="op" id="6691808">,</span>&nbsp;<span class="num" id="6691810">64</span><span class="op" id="6691812">,</span>&nbsp;<span class="num" id="6691814">0</span><span class="op" id="6691815">,</span>&nbsp;<span class="num" id="6691817">0</span><span class="op" id="6691818">,</span>&nbsp;<span class="num" id="6691820">0</span><span class="op" id="6691821">,</span>&nbsp;<span class="num" id="6691823">255</span><span class="op" id="6691826">,</span>&nbsp;<span class="num" id="6691828">255</span><span class="op" id="6691831">}</span><span class="op" id="6691832">}</span><span class="op" id="6691833">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6691836">{</span><span class="op" id="6691837">[</span><span class="op" id="6691838">]</span><span class="builtintype" id="6691839">byte</span><span class="op" id="6691843">{</span><span class="op" id="6691844">}</span><span class="op" id="6691845">,</span>&nbsp;<span class="num" id="6691847">9</span><span class="op" id="6691848">,</span>&nbsp;<span class="op" id="6691850">[</span><span class="op" id="6691851">]</span><span class="builtintype" id="6691852">byte</span><span class="op" id="6691856">{</span><span class="num" id="6691857">1</span><span class="op" id="6691858">,</span>&nbsp;<span class="num" id="6691860">0</span><span class="op" id="6691861">,</span>&nbsp;<span class="num" id="6691863">0</span><span class="op" id="6691864">,</span>&nbsp;<span class="num" id="6691866">255</span><span class="op" id="6691869">,</span>&nbsp;<span class="num" id="6691871">255</span><span class="op" id="6691874">}</span><span class="op" id="6691875">}</span><span class="op" id="6691876">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6691879">{</span><span class="op" id="6691880">[</span><span class="op" id="6691881">]</span><span class="builtintype" id="6691882">byte</span><span class="op" id="6691886">{</span><span class="num" id="6691887">0x11</span><span class="op" id="6691891">}</span><span class="op" id="6691892">,</span>&nbsp;<span class="num" id="6691894">9</span><span class="op" id="6691895">,</span>&nbsp;<span class="op" id="6691897">[</span><span class="op" id="6691898">]</span><span class="builtintype" id="6691899">byte</span><span class="op" id="6691903">{</span><span class="num" id="6691904">18</span><span class="op" id="6691906">,</span>&nbsp;<span class="num" id="6691908">4</span><span class="op" id="6691909">,</span>&nbsp;<span class="num" id="6691911">4</span><span class="op" id="6691912">,</span>&nbsp;<span class="num" id="6691914">0</span><span class="op" id="6691915">,</span>&nbsp;<span class="num" id="6691917">0</span><span class="op" id="6691918">,</span>&nbsp;<span class="num" id="6691920">255</span><span class="op" id="6691923">,</span>&nbsp;<span class="num" id="6691925">255</span><span class="op" id="6691928">}</span><span class="op" id="6691929">}</span><span class="op" id="6691930">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6691933">{</span><span class="op" id="6691934">[</span><span class="op" id="6691935">]</span><span class="builtintype" id="6691936">byte</span><span class="op" id="6691940">{</span><span class="num" id="6691941">0x11</span><span class="op" id="6691945">,</span>&nbsp;<span class="num" id="6691947">0x12</span><span class="op" id="6691951">}</span><span class="op" id="6691952">,</span>&nbsp;<span class="num" id="6691954">9</span><span class="op" id="6691955">,</span>&nbsp;<span class="op" id="6691957">[</span><span class="op" id="6691958">]</span><span class="builtintype" id="6691959">byte</span><span class="op" id="6691963">{</span><span class="num" id="6691964">18</span><span class="op" id="6691966">,</span>&nbsp;<span class="num" id="6691968">20</span><span class="op" id="6691970">,</span>&nbsp;<span class="num" id="6691972">2</span><span class="op" id="6691973">,</span>&nbsp;<span class="num" id="6691975">4</span><span class="op" id="6691976">,</span>&nbsp;<span class="num" id="6691978">0</span><span class="op" id="6691979">,</span>&nbsp;<span class="num" id="6691981">0</span><span class="op" id="6691982">,</span>&nbsp;<span class="num" id="6691984">255</span><span class="op" id="6691987">,</span>&nbsp;<span class="num" id="6691989">255</span><span class="op" id="6691992">}</span><span class="op" id="6691993">}</span><span class="op" id="6691994">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6691997">{</span><span class="op" id="6691998">[</span><span class="op" id="6691999">]</span><span class="builtintype" id="6692000">byte</span><span class="op" id="6692004">{</span><span class="num" id="6692005">0x11</span><span class="op" id="6692009">,</span>&nbsp;<span class="num" id="6692011">0x11</span><span class="op" id="6692015">,</span>&nbsp;<span class="num" id="6692017">0x11</span><span class="op" id="6692021">,</span>&nbsp;<span class="num" id="6692023">0x11</span><span class="op" id="6692027">,</span>&nbsp;<span class="num" id="6692029">0x11</span><span class="op" id="6692033">,</span>&nbsp;<span class="num" id="6692035">0x11</span><span class="op" id="6692039">,</span>&nbsp;<span class="num" id="6692041">0x11</span><span class="op" id="6692045">,</span>&nbsp;<span class="num" id="6692047">0x11</span><span class="op" id="6692051">}</span><span class="op" id="6692052">,</span>&nbsp;<span class="num" id="6692054">9</span><span class="op" id="6692055">,</span>&nbsp;<span class="op" id="6692057">[</span><span class="op" id="6692058">]</span><span class="builtintype" id="6692059">byte</span><span class="op" id="6692063">{</span><span class="num" id="6692064">18</span><span class="op" id="6692066">,</span>&nbsp;<span class="num" id="6692068">132</span><span class="op" id="6692071">,</span>&nbsp;<span class="num" id="6692073">2</span><span class="op" id="6692074">,</span>&nbsp;<span class="num" id="6692076">64</span><span class="op" id="6692078">,</span>&nbsp;<span class="num" id="6692080">0</span><span class="op" id="6692081">,</span>&nbsp;<span class="num" id="6692083">0</span><span class="op" id="6692084">,</span>&nbsp;<span class="num" id="6692086">0</span><span class="op" id="6692087">,</span>&nbsp;<span class="num" id="6692089">255</span><span class="op" id="6692092">,</span>&nbsp;<span class="num" id="6692094">255</span><span class="op" id="6692097">}</span><span class="op" id="6692098">}</span><span class="op" id="6692099">,</span><br>
<span class="lineno"></span><span class="op" id="6692101">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6692104">var</span>&nbsp;<span class="ident" id="6692108">deflateInflateTests</span>&nbsp;<span class="op" id="6692128">=</span>&nbsp;<span class="op" id="6692130">[</span><span class="op" id="6692131">]</span><span class="op" id="6692132">*</span><span class="ident" id="6692133">deflateInflateTest</span><span class="op" id="6692151">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6692154">{</span><span class="op" id="6692155">[</span><span class="op" id="6692156">]</span><span class="builtintype" id="6692157">byte</span><span class="op" id="6692161">{</span><span class="op" id="6692162">}</span><span class="op" id="6692163">}</span><span class="op" id="6692164">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6692167">{</span><span class="op" id="6692168">[</span><span class="op" id="6692169">]</span><span class="builtintype" id="6692170">byte</span><span class="op" id="6692174">{</span><span class="num" id="6692175">0x11</span><span class="op" id="6692179">}</span><span class="op" id="6692180">}</span><span class="op" id="6692181">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6692184">{</span><span class="op" id="6692185">[</span><span class="op" id="6692186">]</span><span class="builtintype" id="6692187">byte</span><span class="op" id="6692191">{</span><span class="num" id="6692192">0x11</span><span class="op" id="6692196">,</span>&nbsp;<span class="num" id="6692198">0x12</span><span class="op" id="6692202">}</span><span class="op" id="6692203">}</span><span class="op" id="6692204">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6692207">{</span><span class="op" id="6692208">[</span><span class="op" id="6692209">]</span><span class="builtintype" id="6692210">byte</span><span class="op" id="6692214">{</span><span class="num" id="6692215">0x11</span><span class="op" id="6692219">,</span>&nbsp;<span class="num" id="6692221">0x11</span><span class="op" id="6692225">,</span>&nbsp;<span class="num" id="6692227">0x11</span><span class="op" id="6692231">,</span>&nbsp;<span class="num" id="6692233">0x11</span><span class="op" id="6692237">,</span>&nbsp;<span class="num" id="6692239">0x11</span><span class="op" id="6692243">,</span>&nbsp;<span class="num" id="6692245">0x11</span><span class="op" id="6692249">,</span>&nbsp;<span class="num" id="6692251">0x11</span><span class="op" id="6692255">,</span>&nbsp;<span class="num" id="6692257">0x11</span><span class="op" id="6692261">}</span><span class="op" id="6692262">}</span><span class="op" id="6692263">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6692266">{</span><span class="op" id="6692267">[</span><span class="op" id="6692268">]</span><span class="builtintype" id="6692269">byte</span><span class="op" id="6692273">{</span><span class="num" id="6692274">0x11</span><span class="op" id="6692278">,</span>&nbsp;<span class="num" id="6692280">0x10</span><span class="op" id="6692284">,</span>&nbsp;<span class="num" id="6692286">0x13</span><span class="op" id="6692290">,</span>&nbsp;<span class="num" id="6692292">0x41</span><span class="op" id="6692296">,</span>&nbsp;<span class="num" id="6692298">0x21</span><span class="op" id="6692302">,</span>&nbsp;<span class="num" id="6692304">0x21</span><span class="op" id="6692308">,</span>&nbsp;<span class="num" id="6692310">0x41</span><span class="op" id="6692314">,</span>&nbsp;<span class="num" id="6692316">0x13</span><span class="op" id="6692320">,</span>&nbsp;<span class="num" id="6692322">0x87</span><span class="op" id="6692326">,</span>&nbsp;<span class="num" id="6692328">0x78</span><span class="op" id="6692332">,</span>&nbsp;<span class="num" id="6692334">0x13</span><span class="op" id="6692338">}</span><span class="op" id="6692339">}</span><span class="op" id="6692340">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6692343">{</span><span class="ident" id="6692344">largeDataChunk</span><span class="op" id="6692358">(</span><span class="op" id="6692359">)</span><span class="op" id="6692360">}</span><span class="op" id="6692361">,</span><br>
<span class="lineno"></span><span class="op" id="6692363">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6692366">var</span>&nbsp;<span class="ident" id="6692370">reverseBitsTests</span>&nbsp;<span class="op" id="6692387">=</span>&nbsp;<span class="op" id="6692389">[</span><span class="op" id="6692390">]</span><span class="op" id="6692391">*</span><span class="ident" id="6692392">reverseBitsTest</span><span class="op" id="6692407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6692410">{</span><span class="num" id="6692411">1</span><span class="op" id="6692412">,</span>&nbsp;<span class="num" id="6692414">1</span><span class="op" id="6692415">,</span>&nbsp;<span class="num" id="6692417">1</span><span class="op" id="6692418">}</span><span class="op" id="6692419">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6692422">{</span><span class="num" id="6692423">1</span><span class="op" id="6692424">,</span>&nbsp;<span class="num" id="6692426">2</span><span class="op" id="6692427">,</span>&nbsp;<span class="num" id="6692429">2</span><span class="op" id="6692430">}</span><span class="op" id="6692431">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6692434">{</span><span class="num" id="6692435">1</span><span class="op" id="6692436">,</span>&nbsp;<span class="num" id="6692438">3</span><span class="op" id="6692439">,</span>&nbsp;<span class="num" id="6692441">4</span><span class="op" id="6692442">}</span><span class="op" id="6692443">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6692446">{</span><span class="num" id="6692447">1</span><span class="op" id="6692448">,</span>&nbsp;<span class="num" id="6692450">4</span><span class="op" id="6692451">,</span>&nbsp;<span class="num" id="6692453">8</span><span class="op" id="6692454">}</span><span class="op" id="6692455">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6692458">{</span><span class="num" id="6692459">1</span><span class="op" id="6692460">,</span>&nbsp;<span class="num" id="6692462">5</span><span class="op" id="6692463">,</span>&nbsp;<span class="num" id="6692465">16</span><span class="op" id="6692467">}</span><span class="op" id="6692468">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6692471">{</span><span class="num" id="6692472">17</span><span class="op" id="6692474">,</span>&nbsp;<span class="num" id="6692476">5</span><span class="op" id="6692477">,</span>&nbsp;<span class="num" id="6692479">17</span><span class="op" id="6692481">}</span><span class="op" id="6692482">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6692485">{</span><span class="num" id="6692486">257</span><span class="op" id="6692489">,</span>&nbsp;<span class="num" id="6692491">9</span><span class="op" id="6692492">,</span>&nbsp;<span class="num" id="6692494">257</span><span class="op" id="6692497">}</span><span class="op" id="6692498">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6692501">{</span><span class="num" id="6692502">29</span><span class="op" id="6692504">,</span>&nbsp;<span class="num" id="6692506">5</span><span class="op" id="6692507">,</span>&nbsp;<span class="num" id="6692509">23</span><span class="op" id="6692511">}</span><span class="op" id="6692512">,</span><br>
<span class="lineno"></span><span class="op" id="6692514">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6692517">func</span>&nbsp;<span class="ident" id="6692522">largeDataChunk</span><span class="op" id="6692536">(</span><span class="op" id="6692537">)</span>&nbsp;<span class="op" id="6692539">[</span><span class="op" id="6692540">]</span><span class="builtintype" id="6692541">byte</span>&nbsp;<span class="op" id="6692546">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6692549">result</span>&nbsp;<span class="op" id="6692556">:=</span>&nbsp;<span class="builtinfunc" id="6692559">make</span><span class="op" id="6692563">(</span><span class="op" id="6692564">[</span><span class="op" id="6692565">]</span><span class="builtintype" id="6692566">byte</span><span class="op" id="6692570">,</span>&nbsp;<span class="num" id="6692572">100000</span><span class="op" id="6692578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6692581">for</span>&nbsp;<span class="ident" id="6692585">i</span>&nbsp;<span class="op" id="6692587">:=</span>&nbsp;<span class="keyword" id="6692590">range</span>&nbsp;<span class="ident" id="6692596">result</span>&nbsp;<span class="op" id="6692603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6692607">result</span><span class="op" id="6692613">[</span><span class="ident" id="6692614">i</span><span class="op" id="6692615">]</span>&nbsp;<span class="op" id="6692617">=</span>&nbsp;<span class="builtintype" id="6692619">byte</span><span class="op" id="6692623">(</span><span class="ident" id="6692624">i</span>&nbsp;<span class="op" id="6692626">*</span>&nbsp;<span class="ident" id="6692628">i</span>&nbsp;<span class="op" id="6692630">&amp;</span>&nbsp;<span class="num" id="6692632">0xFF</span><span class="op" id="6692636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6692639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6692642">return</span>&nbsp;<span class="ident" id="6692649">result</span><br>
<span class="lineno">80</span><span class="op" id="6692656">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6692659">func</span>&nbsp;<span class="ident" id="6692664">TestDeflate</span><span class="op" id="6692675">(</span><span class="ident" id="6692676">t</span>&nbsp;<span class="op" id="6692678">*</span><span class="ident" id="6692679">testing</span><span class="op" id="6692686">.</span><span class="ident" id="6692687">T</span><span class="op" id="6692688">)</span>&nbsp;<span class="op" id="6692690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6692693">for</span>&nbsp;<span class="ident" id="6692697">_</span><span class="op" id="6692698">,</span>&nbsp;<span class="ident" id="6692700">h</span>&nbsp;<span class="op" id="6692702">:=</span>&nbsp;<span class="keyword" id="6692705">range</span>&nbsp;<span class="ident" id="6692711">deflateTests</span>&nbsp;<span class="op" id="6692724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6692728">var</span>&nbsp;<span class="ident" id="6692732">buf</span>&nbsp;<span class="ident" id="6692736">bytes</span><span class="op" id="6692741">.</span><span class="ident" id="6692742">Buffer</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6692751">w</span><span class="op" id="6692752">,</span>&nbsp;<span class="ident" id="6692754">err</span>&nbsp;<span class="op" id="6692758">:=</span>&nbsp;<span class="ident" id="6692761">NewWriter</span><span class="op" id="6692770">(</span><span class="op" id="6692771">&amp;</span><span class="ident" id="6692772">buf</span><span class="op" id="6692775">,</span>&nbsp;<span class="ident" id="6692777">h</span><span class="op" id="6692778">.</span><span class="ident" id="6692779">level</span><span class="op" id="6692784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6692788">if</span>&nbsp;<span class="ident" id="6692791">err</span>&nbsp;<span class="op" id="6692795">!=</span>&nbsp;<span class="ident" id="6692798">nil</span>&nbsp;<span class="op" id="6692802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6692807">t</span><span class="op" id="6692808">.</span><span class="ident" id="6692809">Errorf</span><span class="op" id="6692815">(</span><span class="string" id="6692816">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="6692831">,</span>&nbsp;<span class="ident" id="6692833">err</span><span class="op" id="6692836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6692841">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6692852">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6692856">w</span><span class="op" id="6692857">.</span><span class="ident" id="6692858">Write</span><span class="op" id="6692863">(</span><span class="ident" id="6692864">h</span><span class="op" id="6692865">.</span><span class="ident" id="6692866">in</span><span class="op" id="6692868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6692872">w</span><span class="op" id="6692873">.</span><span class="ident" id="6692874">Close</span><span class="op" id="6692879">(</span><span class="op" id="6692880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6692884">if</span>&nbsp;<span class="op" id="6692887">!</span><span class="ident" id="6692888">bytes</span><span class="op" id="6692893">.</span><span class="ident" id="6692894">Equal</span><span class="op" id="6692899">(</span><span class="ident" id="6692900">buf</span><span class="op" id="6692903">.</span><span class="ident" id="6692904">Bytes</span><span class="op" id="6692909">(</span><span class="op" id="6692910">)</span><span class="op" id="6692911">,</span>&nbsp;<span class="ident" id="6692913">h</span><span class="op" id="6692914">.</span><span class="ident" id="6692915">out</span><span class="op" id="6692918">)</span>&nbsp;<span class="op" id="6692920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6692925">t</span><span class="op" id="6692926">.</span><span class="ident" id="6692927">Errorf</span><span class="op" id="6692933">(</span><span class="string" id="6692934">&#34;Deflate(%d,&nbsp;%x)&nbsp;=&nbsp;%x,&nbsp;want&nbsp;%x&#34;</span><span class="op" id="6692965">,</span>&nbsp;<span class="ident" id="6692967">h</span><span class="op" id="6692968">.</span><span class="ident" id="6692969">level</span><span class="op" id="6692974">,</span>&nbsp;<span class="ident" id="6692976">h</span><span class="op" id="6692977">.</span><span class="ident" id="6692978">in</span><span class="op" id="6692980">,</span>&nbsp;<span class="ident" id="6692982">buf</span><span class="op" id="6692985">.</span><span class="ident" id="6692986">Bytes</span><span class="op" id="6692991">(</span><span class="op" id="6692992">)</span><span class="op" id="6692993">,</span>&nbsp;<span class="ident" id="6692995">h</span><span class="op" id="6692996">.</span><span class="ident" id="6692997">out</span><span class="op" id="6693000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6693004">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6693007">}</span><br>
<span class="lineno"></span><span class="op" id="6693009">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6693012">//&nbsp;A&nbsp;sparseReader&nbsp;returns&nbsp;a&nbsp;stream&nbsp;consisting&nbsp;of&nbsp;0s&nbsp;followed&nbsp;by&nbsp;1&lt;&lt;16&nbsp;1s.</span><br>
<span class="lineno"></span><span class="comment" id="6693086">//&nbsp;This&nbsp;tests&nbsp;missing&nbsp;hash&nbsp;references&nbsp;in&nbsp;a&nbsp;very&nbsp;large&nbsp;input.</span><br>
<span class="lineno">100</span><span class="keyword" id="6693147">type</span>&nbsp;<span class="ident" id="6693152">sparseReader</span>&nbsp;<span class="keyword" id="6693165">struct</span>&nbsp;<span class="op" id="6693172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6693175">l</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6693179">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6693186">cur</span>&nbsp;<span class="ident" id="6693190">int64</span><br>
<span class="lineno"></span><span class="op" id="6693196">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="keyword" id="6693199">func</span>&nbsp;<span class="op" id="6693204">(</span><span class="ident" id="6693205">r</span>&nbsp;<span class="op" id="6693207">*</span><span class="ident" id="6693208">sparseReader</span><span class="op" id="6693220">)</span>&nbsp;<span class="ident" id="6693222">Read</span><span class="op" id="6693226">(</span><span class="ident" id="6693227">b</span>&nbsp;<span class="op" id="6693229">[</span><span class="op" id="6693230">]</span><span class="builtintype" id="6693231">byte</span><span class="op" id="6693235">)</span>&nbsp;<span class="op" id="6693237">(</span><span class="ident" id="6693238">n</span>&nbsp;<span class="builtintype" id="6693240">int</span><span class="op" id="6693243">,</span>&nbsp;<span class="ident" id="6693245">err</span>&nbsp;<span class="builtintype" id="6693249">error</span><span class="op" id="6693254">)</span>&nbsp;<span class="op" id="6693256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6693259">if</span>&nbsp;<span class="ident" id="6693262">r</span><span class="op" id="6693263">.</span><span class="ident" id="6693264">cur</span>&nbsp;<span class="op" id="6693268">&gt;=</span>&nbsp;<span class="ident" id="6693271">r</span><span class="op" id="6693272">.</span><span class="ident" id="6693273">l</span>&nbsp;<span class="op" id="6693275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6693279">return</span>&nbsp;<span class="num" id="6693286">0</span><span class="op" id="6693287">,</span>&nbsp;<span class="ident" id="6693289">io</span><span class="op" id="6693291">.</span><span class="ident" id="6693292">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6693297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6693300">n</span>&nbsp;<span class="op" id="6693302">=</span>&nbsp;<span class="builtinfunc" id="6693304">len</span><span class="op" id="6693307">(</span><span class="ident" id="6693308">b</span><span class="op" id="6693309">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6693312">cur</span>&nbsp;<span class="op" id="6693316">:=</span>&nbsp;<span class="ident" id="6693319">r</span><span class="op" id="6693320">.</span><span class="ident" id="6693321">cur</span>&nbsp;<span class="op" id="6693325">+</span>&nbsp;<span class="ident" id="6693327">int64</span><span class="op" id="6693332">(</span><span class="ident" id="6693333">n</span><span class="op" id="6693334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6693337">if</span>&nbsp;<span class="ident" id="6693340">cur</span>&nbsp;<span class="op" id="6693344">&gt;</span>&nbsp;<span class="ident" id="6693346">r</span><span class="op" id="6693347">.</span><span class="ident" id="6693348">l</span>&nbsp;<span class="op" id="6693350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6693354">n</span>&nbsp;<span class="op" id="6693356">-=</span>&nbsp;<span class="builtintype" id="6693359">int</span><span class="op" id="6693362">(</span><span class="ident" id="6693363">cur</span>&nbsp;<span class="op" id="6693367">-</span>&nbsp;<span class="ident" id="6693369">r</span><span class="op" id="6693370">.</span><span class="ident" id="6693371">l</span><span class="op" id="6693372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6693376">cur</span>&nbsp;<span class="op" id="6693380">=</span>&nbsp;<span class="ident" id="6693382">r</span><span class="op" id="6693383">.</span><span class="ident" id="6693384">l</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6693387">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6693390">for</span>&nbsp;<span class="ident" id="6693394">i</span>&nbsp;<span class="op" id="6693396">:=</span>&nbsp;<span class="keyword" id="6693399">range</span>&nbsp;<span class="ident" id="6693405">b</span><span class="op" id="6693406">[</span><span class="num" id="6693407">0</span><span class="op" id="6693408">:</span><span class="ident" id="6693409">n</span><span class="op" id="6693410">]</span>&nbsp;<span class="op" id="6693412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6693416">if</span>&nbsp;<span class="ident" id="6693419">r</span><span class="op" id="6693420">.</span><span class="ident" id="6693421">cur</span><span class="op" id="6693424">+</span><span class="ident" id="6693425">int64</span><span class="op" id="6693430">(</span><span class="ident" id="6693431">i</span><span class="op" id="6693432">)</span>&nbsp;<span class="op" id="6693434">&gt;=</span>&nbsp;<span class="ident" id="6693437">r</span><span class="op" id="6693438">.</span><span class="ident" id="6693439">l</span><span class="op" id="6693440">-</span><span class="num" id="6693441">1</span><span class="op" id="6693442">&lt;&lt;</span><span class="num" id="6693444">16</span>&nbsp;<span class="op" id="6693447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6693452">b</span><span class="op" id="6693453">[</span><span class="ident" id="6693454">i</span><span class="op" id="6693455">]</span>&nbsp;<span class="op" id="6693457">=</span>&nbsp;<span class="num" id="6693459">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6693463">}</span>&nbsp;<span class="keyword" id="6693465">else</span>&nbsp;<span class="op" id="6693470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6693475">b</span><span class="op" id="6693476">[</span><span class="ident" id="6693477">i</span><span class="op" id="6693478">]</span>&nbsp;<span class="op" id="6693480">=</span>&nbsp;<span class="num" id="6693482">0</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6693486">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6693489">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6693492">r</span><span class="op" id="6693493">.</span><span class="ident" id="6693494">cur</span>&nbsp;<span class="op" id="6693498">=</span>&nbsp;<span class="ident" id="6693500">cur</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6693505">return</span><br>
<span class="lineno"></span><span class="op" id="6693512">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="6693515">func</span>&nbsp;<span class="ident" id="6693520">TestVeryLongSparseChunk</span><span class="op" id="6693543">(</span><span class="ident" id="6693544">t</span>&nbsp;<span class="op" id="6693546">*</span><span class="ident" id="6693547">testing</span><span class="op" id="6693554">.</span><span class="ident" id="6693555">T</span><span class="op" id="6693556">)</span>&nbsp;<span class="op" id="6693558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6693561">if</span>&nbsp;<span class="ident" id="6693564">testing</span><span class="op" id="6693571">.</span><span class="ident" id="6693572">Short</span><span class="op" id="6693577">(</span><span class="op" id="6693578">)</span>&nbsp;<span class="op" id="6693580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6693584">t</span><span class="op" id="6693585">.</span><span class="ident" id="6693586">Skip</span><span class="op" id="6693590">(</span><span class="string" id="6693591">&#34;skipping&nbsp;sparse&nbsp;chunk&nbsp;during&nbsp;short&nbsp;test&#34;</span><span class="op" id="6693632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6693635">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6693638">w</span><span class="op" id="6693639">,</span>&nbsp;<span class="ident" id="6693641">err</span>&nbsp;<span class="op" id="6693645">:=</span>&nbsp;<span class="ident" id="6693648">NewWriter</span><span class="op" id="6693657">(</span><span class="ident" id="6693658">ioutil</span><span class="op" id="6693664">.</span><span class="ident" id="6693665">Discard</span><span class="op" id="6693672">,</span>&nbsp;<span class="num" id="6693674">1</span><span class="op" id="6693675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6693678">if</span>&nbsp;<span class="ident" id="6693681">err</span>&nbsp;<span class="op" id="6693685">!=</span>&nbsp;<span class="ident" id="6693688">nil</span>&nbsp;<span class="op" id="6693692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6693696">t</span><span class="op" id="6693697">.</span><span class="ident" id="6693698">Errorf</span><span class="op" id="6693704">(</span><span class="string" id="6693705">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="6693720">,</span>&nbsp;<span class="ident" id="6693722">err</span><span class="op" id="6693725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6693729">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6693737">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6693740">if</span>&nbsp;<span class="ident" id="6693743">_</span><span class="op" id="6693744">,</span>&nbsp;<span class="ident" id="6693746">err</span>&nbsp;<span class="op" id="6693750">=</span>&nbsp;<span class="ident" id="6693752">io</span><span class="op" id="6693754">.</span><span class="ident" id="6693755">Copy</span><span class="op" id="6693759">(</span><span class="ident" id="6693760">w</span><span class="op" id="6693761">,</span>&nbsp;<span class="op" id="6693763">&amp;</span><span class="ident" id="6693764">sparseReader</span><span class="op" id="6693776">{</span><span class="ident" id="6693777">l</span><span class="op" id="6693778">:</span>&nbsp;<span class="num" id="6693780">23E8</span><span class="op" id="6693784">}</span><span class="op" id="6693785">)</span><span class="op" id="6693786">;</span>&nbsp;<span class="ident" id="6693788">err</span>&nbsp;<span class="op" id="6693792">!=</span>&nbsp;<span class="ident" id="6693795">nil</span>&nbsp;<span class="op" id="6693799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6693803">t</span><span class="op" id="6693804">.</span><span class="ident" id="6693805">Errorf</span><span class="op" id="6693811">(</span><span class="string" id="6693812">&#34;Compress&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6693833">,</span>&nbsp;<span class="ident" id="6693835">err</span><span class="op" id="6693838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6693842">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6693850">}</span><br>
<span class="lineno"></span><span class="op" id="6693852">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="keyword" id="6693855">type</span>&nbsp;<span class="ident" id="6693860">syncBuffer</span>&nbsp;<span class="keyword" id="6693871">struct</span>&nbsp;<span class="op" id="6693878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6693881">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6693888">bytes</span><span class="op" id="6693893">.</span><span class="ident" id="6693894">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6693902">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6693909">sync</span><span class="op" id="6693913">.</span><span class="ident" id="6693914">RWMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6693923">closed</span>&nbsp;<span class="builtintype" id="6693930">bool</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6693936">ready</span>&nbsp;&nbsp;<span class="keyword" id="6693943">chan</span>&nbsp;<span class="builtintype" id="6693948">bool</span><br>
<span class="lineno"></span><span class="op" id="6693953">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6693956">func</span>&nbsp;<span class="ident" id="6693961">newSyncBuffer</span><span class="op" id="6693974">(</span><span class="op" id="6693975">)</span>&nbsp;<span class="op" id="6693977">*</span><span class="ident" id="6693978">syncBuffer</span>&nbsp;<span class="op" id="6693989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6693992">return</span>&nbsp;<span class="op" id="6693999">&amp;</span><span class="ident" id="6694000">syncBuffer</span><span class="op" id="6694010">{</span><span class="ident" id="6694011">ready</span><span class="op" id="6694016">:</span>&nbsp;<span class="builtinfunc" id="6694018">make</span><span class="op" id="6694022">(</span><span class="keyword" id="6694023">chan</span>&nbsp;<span class="builtintype" id="6694028">bool</span><span class="op" id="6694032">,</span>&nbsp;<span class="num" id="6694034">1</span><span class="op" id="6694035">)</span><span class="op" id="6694036">}</span><br>
<span class="lineno">150</span><span class="op" id="6694038">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6694041">func</span>&nbsp;<span class="op" id="6694046">(</span><span class="ident" id="6694047">b</span>&nbsp;<span class="op" id="6694049">*</span><span class="ident" id="6694050">syncBuffer</span><span class="op" id="6694060">)</span>&nbsp;<span class="ident" id="6694062">Read</span><span class="op" id="6694066">(</span><span class="ident" id="6694067">p</span>&nbsp;<span class="op" id="6694069">[</span><span class="op" id="6694070">]</span><span class="builtintype" id="6694071">byte</span><span class="op" id="6694075">)</span>&nbsp;<span class="op" id="6694077">(</span><span class="ident" id="6694078">n</span>&nbsp;<span class="builtintype" id="6694080">int</span><span class="op" id="6694083">,</span>&nbsp;<span class="ident" id="6694085">err</span>&nbsp;<span class="builtintype" id="6694089">error</span><span class="op" id="6694094">)</span>&nbsp;<span class="op" id="6694096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6694099">for</span>&nbsp;<span class="op" id="6694103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6694107">b</span><span class="op" id="6694108">.</span><span class="ident" id="6694109">mu</span><span class="op" id="6694111">.</span><span class="ident" id="6694112">RLock</span><span class="op" id="6694117">(</span><span class="op" id="6694118">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6694122">n</span><span class="op" id="6694123">,</span>&nbsp;<span class="ident" id="6694125">err</span>&nbsp;<span class="op" id="6694129">=</span>&nbsp;<span class="ident" id="6694131">b</span><span class="op" id="6694132">.</span><span class="ident" id="6694133">buf</span><span class="op" id="6694136">.</span><span class="ident" id="6694137">Read</span><span class="op" id="6694141">(</span><span class="ident" id="6694142">p</span><span class="op" id="6694143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6694147">b</span><span class="op" id="6694148">.</span><span class="ident" id="6694149">mu</span><span class="op" id="6694151">.</span><span class="ident" id="6694152">RUnlock</span><span class="op" id="6694159">(</span><span class="op" id="6694160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6694164">if</span>&nbsp;<span class="ident" id="6694167">n</span>&nbsp;<span class="op" id="6694169">&gt;</span>&nbsp;<span class="num" id="6694171">0</span>&nbsp;<span class="op" id="6694173">||</span>&nbsp;<span class="ident" id="6694176">b</span><span class="op" id="6694177">.</span><span class="ident" id="6694178">closed</span>&nbsp;<span class="op" id="6694185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6694190">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6694199">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6694203">&lt;-</span><span class="ident" id="6694205">b</span><span class="op" id="6694206">.</span><span class="ident" id="6694207">ready</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6694214">}</span><br>
<span class="lineno"></span><span class="op" id="6694216">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6694219">func</span>&nbsp;<span class="op" id="6694224">(</span><span class="ident" id="6694225">b</span>&nbsp;<span class="op" id="6694227">*</span><span class="ident" id="6694228">syncBuffer</span><span class="op" id="6694238">)</span>&nbsp;<span class="ident" id="6694240">signal</span><span class="op" id="6694246">(</span><span class="op" id="6694247">)</span>&nbsp;<span class="op" id="6694249">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6694252">select</span>&nbsp;<span class="op" id="6694259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6694262">case</span>&nbsp;<span class="ident" id="6694267">b</span><span class="op" id="6694268">.</span><span class="ident" id="6694269">ready</span>&nbsp;<span class="op" id="6694275">&lt;-</span>&nbsp;<span class="builtintype" id="6694278">true</span><span class="op" id="6694282">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6694285">default</span><span class="op" id="6694292">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6694295">}</span><br>
<span class="lineno"></span><span class="op" id="6694297">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="6694300">func</span>&nbsp;<span class="op" id="6694305">(</span><span class="ident" id="6694306">b</span>&nbsp;<span class="op" id="6694308">*</span><span class="ident" id="6694309">syncBuffer</span><span class="op" id="6694319">)</span>&nbsp;<span class="ident" id="6694321">Write</span><span class="op" id="6694326">(</span><span class="ident" id="6694327">p</span>&nbsp;<span class="op" id="6694329">[</span><span class="op" id="6694330">]</span><span class="builtintype" id="6694331">byte</span><span class="op" id="6694335">)</span>&nbsp;<span class="op" id="6694337">(</span><span class="ident" id="6694338">n</span>&nbsp;<span class="builtintype" id="6694340">int</span><span class="op" id="6694343">,</span>&nbsp;<span class="ident" id="6694345">err</span>&nbsp;<span class="builtintype" id="6694349">error</span><span class="op" id="6694354">)</span>&nbsp;<span class="op" id="6694356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6694359">n</span><span class="op" id="6694360">,</span>&nbsp;<span class="ident" id="6694362">err</span>&nbsp;<span class="op" id="6694366">=</span>&nbsp;<span class="ident" id="6694368">b</span><span class="op" id="6694369">.</span><span class="ident" id="6694370">buf</span><span class="op" id="6694373">.</span><span class="ident" id="6694374">Write</span><span class="op" id="6694379">(</span><span class="ident" id="6694380">p</span><span class="op" id="6694381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6694384">b</span><span class="op" id="6694385">.</span><span class="ident" id="6694386">signal</span><span class="op" id="6694392">(</span><span class="op" id="6694393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6694396">return</span><br>
<span class="lineno">175</span><span class="op" id="6694403">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6694406">func</span>&nbsp;<span class="op" id="6694411">(</span><span class="ident" id="6694412">b</span>&nbsp;<span class="op" id="6694414">*</span><span class="ident" id="6694415">syncBuffer</span><span class="op" id="6694425">)</span>&nbsp;<span class="ident" id="6694427">WriteMode</span><span class="op" id="6694436">(</span><span class="op" id="6694437">)</span>&nbsp;<span class="op" id="6694439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6694442">b</span><span class="op" id="6694443">.</span><span class="ident" id="6694444">mu</span><span class="op" id="6694446">.</span><span class="ident" id="6694447">Lock</span><span class="op" id="6694451">(</span><span class="op" id="6694452">)</span><br>
<span class="lineno"></span><span class="op" id="6694454">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span><span class="keyword" id="6694457">func</span>&nbsp;<span class="op" id="6694462">(</span><span class="ident" id="6694463">b</span>&nbsp;<span class="op" id="6694465">*</span><span class="ident" id="6694466">syncBuffer</span><span class="op" id="6694476">)</span>&nbsp;<span class="ident" id="6694478">ReadMode</span><span class="op" id="6694486">(</span><span class="op" id="6694487">)</span>&nbsp;<span class="op" id="6694489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6694492">b</span><span class="op" id="6694493">.</span><span class="ident" id="6694494">mu</span><span class="op" id="6694496">.</span><span class="ident" id="6694497">Unlock</span><span class="op" id="6694503">(</span><span class="op" id="6694504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6694507">b</span><span class="op" id="6694508">.</span><span class="ident" id="6694509">signal</span><span class="op" id="6694515">(</span><span class="op" id="6694516">)</span><br>
<span class="lineno"></span><span class="op" id="6694518">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span><span class="keyword" id="6694521">func</span>&nbsp;<span class="op" id="6694526">(</span><span class="ident" id="6694527">b</span>&nbsp;<span class="op" id="6694529">*</span><span class="ident" id="6694530">syncBuffer</span><span class="op" id="6694540">)</span>&nbsp;<span class="ident" id="6694542">Close</span><span class="op" id="6694547">(</span><span class="op" id="6694548">)</span>&nbsp;<span class="builtintype" id="6694550">error</span>&nbsp;<span class="op" id="6694556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6694559">b</span><span class="op" id="6694560">.</span><span class="ident" id="6694561">closed</span>&nbsp;<span class="op" id="6694568">=</span>&nbsp;<span class="builtintype" id="6694570">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6694576">b</span><span class="op" id="6694577">.</span><span class="ident" id="6694578">signal</span><span class="op" id="6694584">(</span><span class="op" id="6694585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6694588">return</span>&nbsp;<span class="ident" id="6694595">nil</span><br>
<span class="lineno">190</span><span class="op" id="6694599">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6694602">func</span>&nbsp;<span class="ident" id="6694607">testSync</span><span class="op" id="6694615">(</span><span class="ident" id="6694616">t</span>&nbsp;<span class="op" id="6694618">*</span><span class="ident" id="6694619">testing</span><span class="op" id="6694626">.</span><span class="ident" id="6694627">T</span><span class="op" id="6694628">,</span>&nbsp;<span class="ident" id="6694630">level</span>&nbsp;<span class="builtintype" id="6694636">int</span><span class="op" id="6694639">,</span>&nbsp;<span class="ident" id="6694641">input</span>&nbsp;<span class="op" id="6694647">[</span><span class="op" id="6694648">]</span><span class="builtintype" id="6694649">byte</span><span class="op" id="6694653">,</span>&nbsp;<span class="ident" id="6694655">name</span>&nbsp;<span class="builtintype" id="6694660">string</span><span class="op" id="6694666">)</span>&nbsp;<span class="op" id="6694668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6694671">if</span>&nbsp;<span class="builtinfunc" id="6694674">len</span><span class="op" id="6694677">(</span><span class="ident" id="6694678">input</span><span class="op" id="6694683">)</span>&nbsp;<span class="op" id="6694685">==</span>&nbsp;<span class="num" id="6694688">0</span>&nbsp;<span class="op" id="6694690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6694694">return</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6694702">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6694706">t</span><span class="op" id="6694707">.</span><span class="ident" id="6694708">Logf</span><span class="op" id="6694712">(</span><span class="string" id="6694713">&#34;--testSync&nbsp;%d,&nbsp;%d,&nbsp;%s&#34;</span><span class="op" id="6694736">,</span>&nbsp;<span class="ident" id="6694738">level</span><span class="op" id="6694743">,</span>&nbsp;<span class="builtinfunc" id="6694745">len</span><span class="op" id="6694748">(</span><span class="ident" id="6694749">input</span><span class="op" id="6694754">)</span><span class="op" id="6694755">,</span>&nbsp;<span class="ident" id="6694757">name</span><span class="op" id="6694761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6694764">buf</span>&nbsp;<span class="op" id="6694768">:=</span>&nbsp;<span class="ident" id="6694771">newSyncBuffer</span><span class="op" id="6694784">(</span><span class="op" id="6694785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6694788">buf1</span>&nbsp;<span class="op" id="6694793">:=</span>&nbsp;<span class="builtinfunc" id="6694796">new</span><span class="op" id="6694799">(</span><span class="ident" id="6694800">bytes</span><span class="op" id="6694805">.</span><span class="ident" id="6694806">Buffer</span><span class="op" id="6694812">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6694815">buf</span><span class="op" id="6694818">.</span><span class="ident" id="6694819">WriteMode</span><span class="op" id="6694828">(</span><span class="op" id="6694829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6694832">w</span><span class="op" id="6694833">,</span>&nbsp;<span class="ident" id="6694835">err</span>&nbsp;<span class="op" id="6694839">:=</span>&nbsp;<span class="ident" id="6694842">NewWriter</span><span class="op" id="6694851">(</span><span class="ident" id="6694852">io</span><span class="op" id="6694854">.</span><span class="ident" id="6694855">MultiWriter</span><span class="op" id="6694866">(</span><span class="ident" id="6694867">buf</span><span class="op" id="6694870">,</span>&nbsp;<span class="ident" id="6694872">buf1</span><span class="op" id="6694876">)</span><span class="op" id="6694877">,</span>&nbsp;<span class="ident" id="6694879">level</span><span class="op" id="6694884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6694887">if</span>&nbsp;<span class="ident" id="6694890">err</span>&nbsp;<span class="op" id="6694894">!=</span>&nbsp;<span class="ident" id="6694897">nil</span>&nbsp;<span class="op" id="6694901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6694905">t</span><span class="op" id="6694906">.</span><span class="ident" id="6694907">Errorf</span><span class="op" id="6694913">(</span><span class="string" id="6694914">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="6694929">,</span>&nbsp;<span class="ident" id="6694931">err</span><span class="op" id="6694934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6694938">return</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6694946">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6694949">r</span>&nbsp;<span class="op" id="6694951">:=</span>&nbsp;<span class="ident" id="6694954">NewReader</span><span class="op" id="6694963">(</span><span class="ident" id="6694964">buf</span><span class="op" id="6694967">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6694971">//&nbsp;Write&nbsp;half&nbsp;the&nbsp;input&nbsp;and&nbsp;read&nbsp;back.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6695011">for</span>&nbsp;<span class="ident" id="6695015">i</span>&nbsp;<span class="op" id="6695017">:=</span>&nbsp;<span class="num" id="6695020">0</span><span class="op" id="6695021">;</span>&nbsp;<span class="ident" id="6695023">i</span>&nbsp;<span class="op" id="6695025">&lt;</span>&nbsp;<span class="num" id="6695027">2</span><span class="op" id="6695028">;</span>&nbsp;<span class="ident" id="6695030">i</span><span class="op" id="6695031">++</span>&nbsp;<span class="op" id="6695034">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6695038">var</span>&nbsp;<span class="ident" id="6695042">lo</span><span class="op" id="6695044">,</span>&nbsp;<span class="ident" id="6695046">hi</span>&nbsp;<span class="builtintype" id="6695049">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6695055">if</span>&nbsp;<span class="ident" id="6695058">i</span>&nbsp;<span class="op" id="6695060">==</span>&nbsp;<span class="num" id="6695063">0</span>&nbsp;<span class="op" id="6695065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6695070">lo</span><span class="op" id="6695072">,</span>&nbsp;<span class="ident" id="6695074">hi</span>&nbsp;<span class="op" id="6695077">=</span>&nbsp;<span class="num" id="6695079">0</span><span class="op" id="6695080">,</span>&nbsp;<span class="op" id="6695082">(</span><span class="builtinfunc" id="6695083">len</span><span class="op" id="6695086">(</span><span class="ident" id="6695087">input</span><span class="op" id="6695092">)</span><span class="op" id="6695093">+</span><span class="num" id="6695094">1</span><span class="op" id="6695095">)</span><span class="op" id="6695096">/</span><span class="num" id="6695097">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6695101">}</span>&nbsp;<span class="keyword" id="6695103">else</span>&nbsp;<span class="op" id="6695108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6695113">lo</span><span class="op" id="6695115">,</span>&nbsp;<span class="ident" id="6695117">hi</span>&nbsp;<span class="op" id="6695120">=</span>&nbsp;<span class="op" id="6695122">(</span><span class="builtinfunc" id="6695123">len</span><span class="op" id="6695126">(</span><span class="ident" id="6695127">input</span><span class="op" id="6695132">)</span><span class="op" id="6695133">+</span><span class="num" id="6695134">1</span><span class="op" id="6695135">)</span><span class="op" id="6695136">/</span><span class="num" id="6695137">2</span><span class="op" id="6695138">,</span>&nbsp;<span class="builtinfunc" id="6695140">len</span><span class="op" id="6695143">(</span><span class="ident" id="6695144">input</span><span class="op" id="6695149">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6695153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6695157">t</span><span class="op" id="6695158">.</span><span class="ident" id="6695159">Logf</span><span class="op" id="6695163">(</span><span class="string" id="6695164">&#34;#%d:&nbsp;write&nbsp;%d-%d&#34;</span><span class="op" id="6695182">,</span>&nbsp;<span class="ident" id="6695184">i</span><span class="op" id="6695185">,</span>&nbsp;<span class="ident" id="6695187">lo</span><span class="op" id="6695189">,</span>&nbsp;<span class="ident" id="6695191">hi</span><span class="op" id="6695193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6695197">if</span>&nbsp;<span class="ident" id="6695200">_</span><span class="op" id="6695201">,</span>&nbsp;<span class="ident" id="6695203">err</span>&nbsp;<span class="op" id="6695207">:=</span>&nbsp;<span class="ident" id="6695210">w</span><span class="op" id="6695211">.</span><span class="ident" id="6695212">Write</span><span class="op" id="6695217">(</span><span class="ident" id="6695218">input</span><span class="op" id="6695223">[</span><span class="ident" id="6695224">lo</span><span class="op" id="6695226">:</span><span class="ident" id="6695227">hi</span><span class="op" id="6695229">]</span><span class="op" id="6695230">)</span><span class="op" id="6695231">;</span>&nbsp;<span class="ident" id="6695233">err</span>&nbsp;<span class="op" id="6695237">!=</span>&nbsp;<span class="ident" id="6695240">nil</span>&nbsp;<span class="op" id="6695244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6695249">t</span><span class="op" id="6695250">.</span><span class="ident" id="6695251">Errorf</span><span class="op" id="6695257">(</span><span class="string" id="6695258">&#34;testSync:&nbsp;write:&nbsp;%v&#34;</span><span class="op" id="6695279">,</span>&nbsp;<span class="ident" id="6695281">err</span><span class="op" id="6695284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6695289">return</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6695298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6695302">if</span>&nbsp;<span class="ident" id="6695305">i</span>&nbsp;<span class="op" id="6695307">==</span>&nbsp;<span class="num" id="6695310">0</span>&nbsp;<span class="op" id="6695312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6695317">if</span>&nbsp;<span class="ident" id="6695320">err</span>&nbsp;<span class="op" id="6695324">:=</span>&nbsp;<span class="ident" id="6695327">w</span><span class="op" id="6695328">.</span><span class="ident" id="6695329">Flush</span><span class="op" id="6695334">(</span><span class="op" id="6695335">)</span><span class="op" id="6695336">;</span>&nbsp;<span class="ident" id="6695338">err</span>&nbsp;<span class="op" id="6695342">!=</span>&nbsp;<span class="ident" id="6695345">nil</span>&nbsp;<span class="op" id="6695349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6695355">t</span><span class="op" id="6695356">.</span><span class="ident" id="6695357">Errorf</span><span class="op" id="6695363">(</span><span class="string" id="6695364">&#34;testSync:&nbsp;flush:&nbsp;%v&#34;</span><span class="op" id="6695385">,</span>&nbsp;<span class="ident" id="6695387">err</span><span class="op" id="6695390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6695396">return</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6695406">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6695410">}</span>&nbsp;<span class="keyword" id="6695412">else</span>&nbsp;<span class="op" id="6695417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6695422">if</span>&nbsp;<span class="ident" id="6695425">err</span>&nbsp;<span class="op" id="6695429">:=</span>&nbsp;<span class="ident" id="6695432">w</span><span class="op" id="6695433">.</span><span class="ident" id="6695434">Close</span><span class="op" id="6695439">(</span><span class="op" id="6695440">)</span><span class="op" id="6695441">;</span>&nbsp;<span class="ident" id="6695443">err</span>&nbsp;<span class="op" id="6695447">!=</span>&nbsp;<span class="ident" id="6695450">nil</span>&nbsp;<span class="op" id="6695454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6695460">t</span><span class="op" id="6695461">.</span><span class="ident" id="6695462">Errorf</span><span class="op" id="6695468">(</span><span class="string" id="6695469">&#34;testSync:&nbsp;close:&nbsp;%v&#34;</span><span class="op" id="6695490">,</span>&nbsp;<span class="ident" id="6695492">err</span><span class="op" id="6695495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6695500">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6695504">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6695508">buf</span><span class="op" id="6695511">.</span><span class="ident" id="6695512">ReadMode</span><span class="op" id="6695520">(</span><span class="op" id="6695521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6695525">out</span>&nbsp;<span class="op" id="6695529">:=</span>&nbsp;<span class="builtinfunc" id="6695532">make</span><span class="op" id="6695536">(</span><span class="op" id="6695537">[</span><span class="op" id="6695538">]</span><span class="builtintype" id="6695539">byte</span><span class="op" id="6695543">,</span>&nbsp;<span class="ident" id="6695545">hi</span><span class="op" id="6695547">-</span><span class="ident" id="6695548">lo</span><span class="op" id="6695550">+</span><span class="num" id="6695551">1</span><span class="op" id="6695552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6695556">m</span><span class="op" id="6695557">,</span>&nbsp;<span class="ident" id="6695559">err</span>&nbsp;<span class="op" id="6695563">:=</span>&nbsp;<span class="ident" id="6695566">io</span><span class="op" id="6695568">.</span><span class="ident" id="6695569">ReadAtLeast</span><span class="op" id="6695580">(</span><span class="ident" id="6695581">r</span><span class="op" id="6695582">,</span>&nbsp;<span class="ident" id="6695584">out</span><span class="op" id="6695587">,</span>&nbsp;<span class="ident" id="6695589">hi</span><span class="op" id="6695591">-</span><span class="ident" id="6695592">lo</span><span class="op" id="6695594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6695598">t</span><span class="op" id="6695599">.</span><span class="ident" id="6695600">Logf</span><span class="op" id="6695604">(</span><span class="string" id="6695605">&#34;#%d:&nbsp;read&nbsp;%d&#34;</span><span class="op" id="6695619">,</span>&nbsp;<span class="ident" id="6695621">i</span><span class="op" id="6695622">,</span>&nbsp;<span class="ident" id="6695624">m</span><span class="op" id="6695625">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6695629">if</span>&nbsp;<span class="ident" id="6695632">m</span>&nbsp;<span class="op" id="6695634">!=</span>&nbsp;<span class="ident" id="6695637">hi</span><span class="op" id="6695639">-</span><span class="ident" id="6695640">lo</span>&nbsp;<span class="op" id="6695643">||</span>&nbsp;<span class="ident" id="6695646">err</span>&nbsp;<span class="op" id="6695650">!=</span>&nbsp;<span class="ident" id="6695653">nil</span>&nbsp;<span class="op" id="6695657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6695662">t</span><span class="op" id="6695663">.</span><span class="ident" id="6695664">Errorf</span><span class="op" id="6695670">(</span><span class="string" id="6695671">&#34;testSync/%d&nbsp;(%d,&nbsp;%d,&nbsp;%s):&nbsp;read&nbsp;%d:&nbsp;%d,&nbsp;%v&nbsp;(%d&nbsp;left)&#34;</span><span class="op" id="6695724">,</span>&nbsp;<span class="ident" id="6695726">i</span><span class="op" id="6695727">,</span>&nbsp;<span class="ident" id="6695729">level</span><span class="op" id="6695734">,</span>&nbsp;<span class="builtinfunc" id="6695736">len</span><span class="op" id="6695739">(</span><span class="ident" id="6695740">input</span><span class="op" id="6695745">)</span><span class="op" id="6695746">,</span>&nbsp;<span class="ident" id="6695748">name</span><span class="op" id="6695752">,</span>&nbsp;<span class="ident" id="6695754">hi</span><span class="op" id="6695756">-</span><span class="ident" id="6695757">lo</span><span class="op" id="6695759">,</span>&nbsp;<span class="ident" id="6695761">m</span><span class="op" id="6695762">,</span>&nbsp;<span class="ident" id="6695764">err</span><span class="op" id="6695767">,</span>&nbsp;<span class="ident" id="6695769">buf</span><span class="op" id="6695772">.</span><span class="ident" id="6695773">buf</span><span class="op" id="6695776">.</span><span class="ident" id="6695777">Len</span><span class="op" id="6695780">(</span><span class="op" id="6695781">)</span><span class="op" id="6695782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6695787">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6695796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6695800">if</span>&nbsp;<span class="op" id="6695803">!</span><span class="ident" id="6695804">bytes</span><span class="op" id="6695809">.</span><span class="ident" id="6695810">Equal</span><span class="op" id="6695815">(</span><span class="ident" id="6695816">input</span><span class="op" id="6695821">[</span><span class="ident" id="6695822">lo</span><span class="op" id="6695824">:</span><span class="ident" id="6695825">hi</span><span class="op" id="6695827">]</span><span class="op" id="6695828">,</span>&nbsp;<span class="ident" id="6695830">out</span><span class="op" id="6695833">[</span><span class="op" id="6695834">:</span><span class="ident" id="6695835">hi</span><span class="op" id="6695837">-</span><span class="ident" id="6695838">lo</span><span class="op" id="6695840">]</span><span class="op" id="6695841">)</span>&nbsp;<span class="op" id="6695843">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6695848">t</span><span class="op" id="6695849">.</span><span class="ident" id="6695850">Errorf</span><span class="op" id="6695856">(</span><span class="string" id="6695857">&#34;testSync/%d:&nbsp;read&nbsp;wrong&nbsp;bytes:&nbsp;%x&nbsp;vs&nbsp;%x&#34;</span><span class="op" id="6695898">,</span>&nbsp;<span class="ident" id="6695900">i</span><span class="op" id="6695901">,</span>&nbsp;<span class="ident" id="6695903">input</span><span class="op" id="6695908">[</span><span class="ident" id="6695909">lo</span><span class="op" id="6695911">:</span><span class="ident" id="6695912">hi</span><span class="op" id="6695914">]</span><span class="op" id="6695915">,</span>&nbsp;<span class="ident" id="6695917">out</span><span class="op" id="6695920">[</span><span class="op" id="6695921">:</span><span class="ident" id="6695922">hi</span><span class="op" id="6695924">-</span><span class="ident" id="6695925">lo</span><span class="op" id="6695927">]</span><span class="op" id="6695928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6695933">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6695942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6695946">//&nbsp;This&nbsp;test&nbsp;originally&nbsp;checked&nbsp;that&nbsp;after&nbsp;reading</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6695999">//&nbsp;the&nbsp;first&nbsp;half&nbsp;of&nbsp;the&nbsp;input,&nbsp;there&nbsp;was&nbsp;nothing&nbsp;left</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6696056">//&nbsp;in&nbsp;the&nbsp;read&nbsp;buffer&nbsp;(buf.buf.Len()&nbsp;!=&nbsp;0)&nbsp;but&nbsp;that&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6696113">//&nbsp;not&nbsp;necessarily&nbsp;the&nbsp;case:&nbsp;the&nbsp;write&nbsp;Flush&nbsp;may&nbsp;emit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6696169">//&nbsp;some&nbsp;extra&nbsp;framing&nbsp;bits&nbsp;that&nbsp;are&nbsp;not&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6696221">//&nbsp;to&nbsp;process&nbsp;to&nbsp;obtain&nbsp;the&nbsp;first&nbsp;half&nbsp;of&nbsp;the&nbsp;uncompressed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6696282">//&nbsp;data.&nbsp;&nbsp;The&nbsp;test&nbsp;ran&nbsp;correctly&nbsp;most&nbsp;of&nbsp;the&nbsp;time,&nbsp;because</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6696343">//&nbsp;the&nbsp;background&nbsp;goroutine&nbsp;had&nbsp;usually&nbsp;read&nbsp;even</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6696395">//&nbsp;those&nbsp;extra&nbsp;bits&nbsp;by&nbsp;now,&nbsp;but&nbsp;it&#39;s&nbsp;not&nbsp;a&nbsp;useful&nbsp;thing&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6696456">//&nbsp;check.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6696468">buf</span><span class="op" id="6696471">.</span><span class="ident" id="6696472">WriteMode</span><span class="op" id="6696481">(</span><span class="op" id="6696482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6696485">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6696488">buf</span><span class="op" id="6696491">.</span><span class="ident" id="6696492">ReadMode</span><span class="op" id="6696500">(</span><span class="op" id="6696501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6696504">out</span>&nbsp;<span class="op" id="6696508">:=</span>&nbsp;<span class="builtinfunc" id="6696511">make</span><span class="op" id="6696515">(</span><span class="op" id="6696516">[</span><span class="op" id="6696517">]</span><span class="builtintype" id="6696518">byte</span><span class="op" id="6696522">,</span>&nbsp;<span class="num" id="6696524">10</span><span class="op" id="6696526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6696529">if</span>&nbsp;<span class="ident" id="6696532">n</span><span class="op" id="6696533">,</span>&nbsp;<span class="ident" id="6696535">err</span>&nbsp;<span class="op" id="6696539">:=</span>&nbsp;<span class="ident" id="6696542">r</span><span class="op" id="6696543">.</span><span class="ident" id="6696544">Read</span><span class="op" id="6696548">(</span><span class="ident" id="6696549">out</span><span class="op" id="6696552">)</span><span class="op" id="6696553">;</span>&nbsp;<span class="ident" id="6696555">n</span>&nbsp;<span class="op" id="6696557">&gt;</span>&nbsp;<span class="num" id="6696559">0</span>&nbsp;<span class="op" id="6696561">||</span>&nbsp;<span class="ident" id="6696564">err</span>&nbsp;<span class="op" id="6696568">!=</span>&nbsp;<span class="ident" id="6696571">io</span><span class="op" id="6696573">.</span><span class="ident" id="6696574">EOF</span>&nbsp;<span class="op" id="6696578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6696582">t</span><span class="op" id="6696583">.</span><span class="ident" id="6696584">Errorf</span><span class="op" id="6696590">(</span><span class="string" id="6696591">&#34;testSync&nbsp;(%d,&nbsp;%d,&nbsp;%s):&nbsp;final&nbsp;Read:&nbsp;%d,&nbsp;%v&nbsp;(hex:&nbsp;%x)&#34;</span><span class="op" id="6696644">,</span>&nbsp;<span class="ident" id="6696646">level</span><span class="op" id="6696651">,</span>&nbsp;<span class="builtinfunc" id="6696653">len</span><span class="op" id="6696656">(</span><span class="ident" id="6696657">input</span><span class="op" id="6696662">)</span><span class="op" id="6696663">,</span>&nbsp;<span class="ident" id="6696665">name</span><span class="op" id="6696669">,</span>&nbsp;<span class="ident" id="6696671">n</span><span class="op" id="6696672">,</span>&nbsp;<span class="ident" id="6696674">err</span><span class="op" id="6696677">,</span>&nbsp;<span class="ident" id="6696679">out</span><span class="op" id="6696682">[</span><span class="num" id="6696683">0</span><span class="op" id="6696684">:</span><span class="ident" id="6696685">n</span><span class="op" id="6696686">]</span><span class="op" id="6696687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6696690">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6696693">if</span>&nbsp;<span class="ident" id="6696696">buf</span><span class="op" id="6696699">.</span><span class="ident" id="6696700">buf</span><span class="op" id="6696703">.</span><span class="ident" id="6696704">Len</span><span class="op" id="6696707">(</span><span class="op" id="6696708">)</span>&nbsp;<span class="op" id="6696710">!=</span>&nbsp;<span class="num" id="6696713">0</span>&nbsp;<span class="op" id="6696715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6696719">t</span><span class="op" id="6696720">.</span><span class="ident" id="6696721">Errorf</span><span class="op" id="6696727">(</span><span class="string" id="6696728">&#34;testSync&nbsp;(%d,&nbsp;%d,&nbsp;%s):&nbsp;extra&nbsp;data&nbsp;at&nbsp;end&#34;</span><span class="op" id="6696770">,</span>&nbsp;<span class="ident" id="6696772">level</span><span class="op" id="6696777">,</span>&nbsp;<span class="builtinfunc" id="6696779">len</span><span class="op" id="6696782">(</span><span class="ident" id="6696783">input</span><span class="op" id="6696788">)</span><span class="op" id="6696789">,</span>&nbsp;<span class="ident" id="6696791">name</span><span class="op" id="6696795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6696798">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6696801">r</span><span class="op" id="6696802">.</span><span class="ident" id="6696803">Close</span><span class="op" id="6696808">(</span><span class="op" id="6696809">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6696813">//&nbsp;stream&nbsp;should&nbsp;work&nbsp;for&nbsp;ordinary&nbsp;reader&nbsp;too</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6696860">r</span>&nbsp;<span class="op" id="6696862">=</span>&nbsp;<span class="ident" id="6696864">NewReader</span><span class="op" id="6696873">(</span><span class="ident" id="6696874">buf1</span><span class="op" id="6696878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6696881">out</span><span class="op" id="6696884">,</span>&nbsp;<span class="ident" id="6696886">err</span>&nbsp;<span class="op" id="6696890">=</span>&nbsp;<span class="ident" id="6696892">ioutil</span><span class="op" id="6696898">.</span><span class="ident" id="6696899">ReadAll</span><span class="op" id="6696906">(</span><span class="ident" id="6696907">r</span><span class="op" id="6696908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6696911">if</span>&nbsp;<span class="ident" id="6696914">err</span>&nbsp;<span class="op" id="6696918">!=</span>&nbsp;<span class="ident" id="6696921">nil</span>&nbsp;<span class="op" id="6696925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6696929">t</span><span class="op" id="6696930">.</span><span class="ident" id="6696931">Errorf</span><span class="op" id="6696937">(</span><span class="string" id="6696938">&#34;testSync:&nbsp;read:&nbsp;%s&#34;</span><span class="op" id="6696958">,</span>&nbsp;<span class="ident" id="6696960">err</span><span class="op" id="6696963">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6696967">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6696975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6696978">r</span><span class="op" id="6696979">.</span><span class="ident" id="6696980">Close</span><span class="op" id="6696985">(</span><span class="op" id="6696986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6696989">if</span>&nbsp;<span class="op" id="6696992">!</span><span class="ident" id="6696993">bytes</span><span class="op" id="6696998">.</span><span class="ident" id="6696999">Equal</span><span class="op" id="6697004">(</span><span class="ident" id="6697005">input</span><span class="op" id="6697010">,</span>&nbsp;<span class="ident" id="6697012">out</span><span class="op" id="6697015">)</span>&nbsp;<span class="op" id="6697017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6697021">t</span><span class="op" id="6697022">.</span><span class="ident" id="6697023">Errorf</span><span class="op" id="6697029">(</span><span class="string" id="6697030">&#34;testSync:&nbsp;decompress(compress(data))&nbsp;!=&nbsp;data:&nbsp;level=%d&nbsp;input=%s&#34;</span><span class="op" id="6697095">,</span>&nbsp;<span class="ident" id="6697097">level</span><span class="op" id="6697102">,</span>&nbsp;<span class="ident" id="6697104">name</span><span class="op" id="6697108">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6697111">}</span><br>
<span class="lineno"></span><span class="op" id="6697113">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6697116">func</span>&nbsp;<span class="ident" id="6697121">testToFromWithLevelAndLimit</span><span class="op" id="6697148">(</span><span class="ident" id="6697149">t</span>&nbsp;<span class="op" id="6697151">*</span><span class="ident" id="6697152">testing</span><span class="op" id="6697159">.</span><span class="ident" id="6697160">T</span><span class="op" id="6697161">,</span>&nbsp;<span class="ident" id="6697163">level</span>&nbsp;<span class="builtintype" id="6697169">int</span><span class="op" id="6697172">,</span>&nbsp;<span class="ident" id="6697174">input</span>&nbsp;<span class="op" id="6697180">[</span><span class="op" id="6697181">]</span><span class="builtintype" id="6697182">byte</span><span class="op" id="6697186">,</span>&nbsp;<span class="ident" id="6697188">name</span>&nbsp;<span class="builtintype" id="6697193">string</span><span class="op" id="6697199">,</span>&nbsp;<span class="ident" id="6697201">limit</span>&nbsp;<span class="builtintype" id="6697207">int</span><span class="op" id="6697210">)</span>&nbsp;<span class="op" id="6697212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6697215">var</span>&nbsp;<span class="ident" id="6697219">buffer</span>&nbsp;<span class="ident" id="6697226">bytes</span><span class="op" id="6697231">.</span><span class="ident" id="6697232">Buffer</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6697240">w</span><span class="op" id="6697241">,</span>&nbsp;<span class="ident" id="6697243">err</span>&nbsp;<span class="op" id="6697247">:=</span>&nbsp;<span class="ident" id="6697250">NewWriter</span><span class="op" id="6697259">(</span><span class="op" id="6697260">&amp;</span><span class="ident" id="6697261">buffer</span><span class="op" id="6697267">,</span>&nbsp;<span class="ident" id="6697269">level</span><span class="op" id="6697274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6697277">if</span>&nbsp;<span class="ident" id="6697280">err</span>&nbsp;<span class="op" id="6697284">!=</span>&nbsp;<span class="ident" id="6697287">nil</span>&nbsp;<span class="op" id="6697291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6697295">t</span><span class="op" id="6697296">.</span><span class="ident" id="6697297">Errorf</span><span class="op" id="6697303">(</span><span class="string" id="6697304">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="6697319">,</span>&nbsp;<span class="ident" id="6697321">err</span><span class="op" id="6697324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6697328">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6697336">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6697339">w</span><span class="op" id="6697340">.</span><span class="ident" id="6697341">Write</span><span class="op" id="6697346">(</span><span class="ident" id="6697347">input</span><span class="op" id="6697352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6697355">w</span><span class="op" id="6697356">.</span><span class="ident" id="6697357">Close</span><span class="op" id="6697362">(</span><span class="op" id="6697363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6697366">if</span>&nbsp;<span class="ident" id="6697369">limit</span>&nbsp;<span class="op" id="6697375">&gt;</span>&nbsp;<span class="num" id="6697377">0</span>&nbsp;<span class="op" id="6697379">&amp;&amp;</span>&nbsp;<span class="ident" id="6697382">buffer</span><span class="op" id="6697388">.</span><span class="ident" id="6697389">Len</span><span class="op" id="6697392">(</span><span class="op" id="6697393">)</span>&nbsp;<span class="op" id="6697395">&gt;</span>&nbsp;<span class="ident" id="6697397">limit</span>&nbsp;<span class="op" id="6697403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6697407">t</span><span class="op" id="6697408">.</span><span class="ident" id="6697409">Errorf</span><span class="op" id="6697415">(</span><span class="string" id="6697416">&#34;level:&nbsp;%d,&nbsp;len(compress(data))&nbsp;=&nbsp;%d&nbsp;&gt;&nbsp;limit&nbsp;=&nbsp;%d&#34;</span><span class="op" id="6697466">,</span>&nbsp;<span class="ident" id="6697468">level</span><span class="op" id="6697473">,</span>&nbsp;<span class="ident" id="6697475">buffer</span><span class="op" id="6697481">.</span><span class="ident" id="6697482">Len</span><span class="op" id="6697485">(</span><span class="op" id="6697486">)</span><span class="op" id="6697487">,</span>&nbsp;<span class="ident" id="6697489">limit</span><span class="op" id="6697494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6697498">return</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6697506">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6697509">r</span>&nbsp;<span class="op" id="6697511">:=</span>&nbsp;<span class="ident" id="6697514">NewReader</span><span class="op" id="6697523">(</span><span class="op" id="6697524">&amp;</span><span class="ident" id="6697525">buffer</span><span class="op" id="6697531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6697534">out</span><span class="op" id="6697537">,</span>&nbsp;<span class="ident" id="6697539">err</span>&nbsp;<span class="op" id="6697543">:=</span>&nbsp;<span class="ident" id="6697546">ioutil</span><span class="op" id="6697552">.</span><span class="ident" id="6697553">ReadAll</span><span class="op" id="6697560">(</span><span class="ident" id="6697561">r</span><span class="op" id="6697562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6697565">if</span>&nbsp;<span class="ident" id="6697568">err</span>&nbsp;<span class="op" id="6697572">!=</span>&nbsp;<span class="ident" id="6697575">nil</span>&nbsp;<span class="op" id="6697579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6697583">t</span><span class="op" id="6697584">.</span><span class="ident" id="6697585">Errorf</span><span class="op" id="6697591">(</span><span class="string" id="6697592">&#34;read:&nbsp;%s&#34;</span><span class="op" id="6697602">,</span>&nbsp;<span class="ident" id="6697604">err</span><span class="op" id="6697607">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6697611">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6697619">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6697622">r</span><span class="op" id="6697623">.</span><span class="ident" id="6697624">Close</span><span class="op" id="6697629">(</span><span class="op" id="6697630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6697633">if</span>&nbsp;<span class="op" id="6697636">!</span><span class="ident" id="6697637">bytes</span><span class="op" id="6697642">.</span><span class="ident" id="6697643">Equal</span><span class="op" id="6697648">(</span><span class="ident" id="6697649">input</span><span class="op" id="6697654">,</span>&nbsp;<span class="ident" id="6697656">out</span><span class="op" id="6697659">)</span>&nbsp;<span class="op" id="6697661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6697665">t</span><span class="op" id="6697666">.</span><span class="ident" id="6697667">Errorf</span><span class="op" id="6697673">(</span><span class="string" id="6697674">&#34;decompress(compress(data))&nbsp;!=&nbsp;data:&nbsp;level=%d&nbsp;input=%s&#34;</span><span class="op" id="6697729">,</span>&nbsp;<span class="ident" id="6697731">level</span><span class="op" id="6697736">,</span>&nbsp;<span class="ident" id="6697738">name</span><span class="op" id="6697742">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6697746">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6697754">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6697757">testSync</span><span class="op" id="6697765">(</span><span class="ident" id="6697766">t</span><span class="op" id="6697767">,</span>&nbsp;<span class="ident" id="6697769">level</span><span class="op" id="6697774">,</span>&nbsp;<span class="ident" id="6697776">input</span><span class="op" id="6697781">,</span>&nbsp;<span class="ident" id="6697783">name</span><span class="op" id="6697787">)</span><br>
<span class="lineno"></span><span class="op" id="6697789">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span><span class="keyword" id="6697792">func</span>&nbsp;<span class="ident" id="6697797">testToFromWithLimit</span><span class="op" id="6697816">(</span><span class="ident" id="6697817">t</span>&nbsp;<span class="op" id="6697819">*</span><span class="ident" id="6697820">testing</span><span class="op" id="6697827">.</span><span class="ident" id="6697828">T</span><span class="op" id="6697829">,</span>&nbsp;<span class="ident" id="6697831">input</span>&nbsp;<span class="op" id="6697837">[</span><span class="op" id="6697838">]</span><span class="builtintype" id="6697839">byte</span><span class="op" id="6697843">,</span>&nbsp;<span class="ident" id="6697845">name</span>&nbsp;<span class="builtintype" id="6697850">string</span><span class="op" id="6697856">,</span>&nbsp;<span class="ident" id="6697858">limit</span>&nbsp;<span class="op" id="6697864">[</span><span class="num" id="6697865">10</span><span class="op" id="6697867">]</span><span class="builtintype" id="6697868">int</span><span class="op" id="6697871">)</span>&nbsp;<span class="op" id="6697873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6697876">for</span>&nbsp;<span class="ident" id="6697880">i</span>&nbsp;<span class="op" id="6697882">:=</span>&nbsp;<span class="num" id="6697885">0</span><span class="op" id="6697886">;</span>&nbsp;<span class="ident" id="6697888">i</span>&nbsp;<span class="op" id="6697890">&lt;</span>&nbsp;<span class="num" id="6697892">10</span><span class="op" id="6697894">;</span>&nbsp;<span class="ident" id="6697896">i</span><span class="op" id="6697897">++</span>&nbsp;<span class="op" id="6697900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6697904">testToFromWithLevelAndLimit</span><span class="op" id="6697931">(</span><span class="ident" id="6697932">t</span><span class="op" id="6697933">,</span>&nbsp;<span class="ident" id="6697935">i</span><span class="op" id="6697936">,</span>&nbsp;<span class="ident" id="6697938">input</span><span class="op" id="6697943">,</span>&nbsp;<span class="ident" id="6697945">name</span><span class="op" id="6697949">,</span>&nbsp;<span class="ident" id="6697951">limit</span><span class="op" id="6697956">[</span><span class="ident" id="6697957">i</span><span class="op" id="6697958">]</span><span class="op" id="6697959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6697962">}</span><br>
<span class="lineno"></span><span class="op" id="6697964">}</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span><span class="keyword" id="6697967">func</span>&nbsp;<span class="ident" id="6697972">TestDeflateInflate</span><span class="op" id="6697990">(</span><span class="ident" id="6697991">t</span>&nbsp;<span class="op" id="6697993">*</span><span class="ident" id="6697994">testing</span><span class="op" id="6698001">.</span><span class="ident" id="6698002">T</span><span class="op" id="6698003">)</span>&nbsp;<span class="op" id="6698005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6698008">for</span>&nbsp;<span class="ident" id="6698012">i</span><span class="op" id="6698013">,</span>&nbsp;<span class="ident" id="6698015">h</span>&nbsp;<span class="op" id="6698017">:=</span>&nbsp;<span class="keyword" id="6698020">range</span>&nbsp;<span class="ident" id="6698026">deflateInflateTests</span>&nbsp;<span class="op" id="6698046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6698050">testToFromWithLimit</span><span class="op" id="6698069">(</span><span class="ident" id="6698070">t</span><span class="op" id="6698071">,</span>&nbsp;<span class="ident" id="6698073">h</span><span class="op" id="6698074">.</span><span class="ident" id="6698075">in</span><span class="op" id="6698077">,</span>&nbsp;<span class="ident" id="6698079">fmt</span><span class="op" id="6698082">.</span><span class="ident" id="6698083">Sprintf</span><span class="op" id="6698090">(</span><span class="string" id="6698091">&#34;#%d&#34;</span><span class="op" id="6698096">,</span>&nbsp;<span class="ident" id="6698098">i</span><span class="op" id="6698099">)</span><span class="op" id="6698100">,</span>&nbsp;<span class="op" id="6698102">[</span><span class="num" id="6698103">10</span><span class="op" id="6698105">]</span><span class="builtintype" id="6698106">int</span><span class="op" id="6698109">{</span><span class="op" id="6698110">}</span><span class="op" id="6698111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6698114">}</span><br>
<span class="lineno">315</span><span class="op" id="6698116">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6698119">func</span>&nbsp;<span class="ident" id="6698124">TestReverseBits</span><span class="op" id="6698139">(</span><span class="ident" id="6698140">t</span>&nbsp;<span class="op" id="6698142">*</span><span class="ident" id="6698143">testing</span><span class="op" id="6698150">.</span><span class="ident" id="6698151">T</span><span class="op" id="6698152">)</span>&nbsp;<span class="op" id="6698154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6698157">for</span>&nbsp;<span class="ident" id="6698161">_</span><span class="op" id="6698162">,</span>&nbsp;<span class="ident" id="6698164">h</span>&nbsp;<span class="op" id="6698166">:=</span>&nbsp;<span class="keyword" id="6698169">range</span>&nbsp;<span class="ident" id="6698175">reverseBitsTests</span>&nbsp;<span class="op" id="6698192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6698196">if</span>&nbsp;<span class="ident" id="6698199">v</span>&nbsp;<span class="op" id="6698201">:=</span>&nbsp;<span class="ident" id="6698204">reverseBits</span><span class="op" id="6698215">(</span><span class="ident" id="6698216">h</span><span class="op" id="6698217">.</span><span class="ident" id="6698218">in</span><span class="op" id="6698220">,</span>&nbsp;<span class="ident" id="6698222">h</span><span class="op" id="6698223">.</span><span class="ident" id="6698224">bitCount</span><span class="op" id="6698232">)</span><span class="op" id="6698233">;</span>&nbsp;<span class="ident" id="6698235">v</span>&nbsp;<span class="op" id="6698237">!=</span>&nbsp;<span class="ident" id="6698240">h</span><span class="op" id="6698241">.</span><span class="ident" id="6698242">out</span>&nbsp;<span class="op" id="6698246">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6698251">t</span><span class="op" id="6698252">.</span><span class="ident" id="6698253">Errorf</span><span class="op" id="6698259">(</span><span class="string" id="6698260">&#34;reverseBits(%v,%v)&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6698294">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6698300">h</span><span class="op" id="6698301">.</span><span class="ident" id="6698302">in</span><span class="op" id="6698304">,</span>&nbsp;<span class="ident" id="6698306">h</span><span class="op" id="6698307">.</span><span class="ident" id="6698308">bitCount</span><span class="op" id="6698316">,</span>&nbsp;<span class="ident" id="6698318">v</span><span class="op" id="6698319">,</span>&nbsp;<span class="ident" id="6698321">h</span><span class="op" id="6698322">.</span><span class="ident" id="6698323">out</span><span class="op" id="6698326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6698330">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6698333">}</span><br>
<span class="lineno"></span><span class="op" id="6698335">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="keyword" id="6698338">type</span>&nbsp;<span class="ident" id="6698343">deflateInflateStringTest</span>&nbsp;<span class="keyword" id="6698368">struct</span>&nbsp;<span class="op" id="6698375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6698378">filename</span>&nbsp;<span class="builtintype" id="6698387">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6698395">label</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6698404">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6698412">limit</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6698421">[</span><span class="num" id="6698422">10</span><span class="op" id="6698424">]</span><span class="builtintype" id="6698425">int</span><br>
<span class="lineno">330</span><span class="op" id="6698429">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6698432">var</span>&nbsp;<span class="ident" id="6698436">deflateInflateStringTests</span>&nbsp;<span class="op" id="6698462">=</span>&nbsp;<span class="op" id="6698464">[</span><span class="op" id="6698465">]</span><span class="ident" id="6698466">deflateInflateStringTest</span><span class="op" id="6698490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6698493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6698497">&#34;../testdata/e.txt&#34;</span><span class="op" id="6698516">,</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6698520">&#34;2.718281828...&#34;</span><span class="op" id="6698536">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6698540">[</span><span class="op" id="6698541">...</span><span class="op" id="6698544">]</span><span class="builtintype" id="6698545">int</span><span class="op" id="6698548">{</span><span class="num" id="6698549">100018</span><span class="op" id="6698555">,</span>&nbsp;<span class="num" id="6698557">50650</span><span class="op" id="6698562">,</span>&nbsp;<span class="num" id="6698564">50960</span><span class="op" id="6698569">,</span>&nbsp;<span class="num" id="6698571">51150</span><span class="op" id="6698576">,</span>&nbsp;<span class="num" id="6698578">50930</span><span class="op" id="6698583">,</span>&nbsp;<span class="num" id="6698585">50790</span><span class="op" id="6698590">,</span>&nbsp;<span class="num" id="6698592">50790</span><span class="op" id="6698597">,</span>&nbsp;<span class="num" id="6698599">50790</span><span class="op" id="6698604">,</span>&nbsp;<span class="num" id="6698606">50790</span><span class="op" id="6698611">,</span>&nbsp;<span class="num" id="6698613">50790</span><span class="op" id="6698618">}</span><span class="op" id="6698619">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6698622">}</span><span class="op" id="6698623">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6698626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6698630">&#34;../testdata/Mark.Twain-Tom.Sawyer.txt&#34;</span><span class="op" id="6698669">,</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6698673">&#34;Mark.Twain-Tom.Sawyer&#34;</span><span class="op" id="6698696">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6698700">[</span><span class="op" id="6698701">...</span><span class="op" id="6698704">]</span><span class="builtintype" id="6698705">int</span><span class="op" id="6698708">{</span><span class="num" id="6698709">407330</span><span class="op" id="6698715">,</span>&nbsp;<span class="num" id="6698717">187598</span><span class="op" id="6698723">,</span>&nbsp;<span class="num" id="6698725">180361</span><span class="op" id="6698731">,</span>&nbsp;<span class="num" id="6698733">172974</span><span class="op" id="6698739">,</span>&nbsp;<span class="num" id="6698741">169160</span><span class="op" id="6698747">,</span>&nbsp;<span class="num" id="6698749">163476</span><span class="op" id="6698755">,</span>&nbsp;<span class="num" id="6698757">160936</span><span class="op" id="6698763">,</span>&nbsp;<span class="num" id="6698765">160506</span><span class="op" id="6698771">,</span>&nbsp;<span class="num" id="6698773">160295</span><span class="op" id="6698779">,</span>&nbsp;<span class="num" id="6698781">160295</span><span class="op" id="6698787">}</span><span class="op" id="6698788">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6698791">}</span><span class="op" id="6698792">,</span><br>
<span class="lineno"></span><span class="op" id="6698794">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span><span class="keyword" id="6698797">func</span>&nbsp;<span class="ident" id="6698802">TestDeflateInflateString</span><span class="op" id="6698826">(</span><span class="ident" id="6698827">t</span>&nbsp;<span class="op" id="6698829">*</span><span class="ident" id="6698830">testing</span><span class="op" id="6698837">.</span><span class="ident" id="6698838">T</span><span class="op" id="6698839">)</span>&nbsp;<span class="op" id="6698841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6698844">for</span>&nbsp;<span class="ident" id="6698848">_</span><span class="op" id="6698849">,</span>&nbsp;<span class="ident" id="6698851">test</span>&nbsp;<span class="op" id="6698856">:=</span>&nbsp;<span class="keyword" id="6698859">range</span>&nbsp;<span class="ident" id="6698865">deflateInflateStringTests</span>&nbsp;<span class="op" id="6698891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6698895">gold</span><span class="op" id="6698899">,</span>&nbsp;<span class="ident" id="6698901">err</span>&nbsp;<span class="op" id="6698905">:=</span>&nbsp;<span class="ident" id="6698908">ioutil</span><span class="op" id="6698914">.</span><span class="ident" id="6698915">ReadFile</span><span class="op" id="6698923">(</span><span class="ident" id="6698924">test</span><span class="op" id="6698928">.</span><span class="ident" id="6698929">filename</span><span class="op" id="6698937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6698941">if</span>&nbsp;<span class="ident" id="6698944">err</span>&nbsp;<span class="op" id="6698948">!=</span>&nbsp;<span class="ident" id="6698951">nil</span>&nbsp;<span class="op" id="6698955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6698960">t</span><span class="op" id="6698961">.</span><span class="ident" id="6698962">Error</span><span class="op" id="6698967">(</span><span class="ident" id="6698968">err</span><span class="op" id="6698971">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6698975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6698979">testToFromWithLimit</span><span class="op" id="6698998">(</span><span class="ident" id="6698999">t</span><span class="op" id="6699000">,</span>&nbsp;<span class="ident" id="6699002">gold</span><span class="op" id="6699006">,</span>&nbsp;<span class="ident" id="6699008">test</span><span class="op" id="6699012">.</span><span class="ident" id="6699013">label</span><span class="op" id="6699018">,</span>&nbsp;<span class="ident" id="6699020">test</span><span class="op" id="6699024">.</span><span class="ident" id="6699025">limit</span><span class="op" id="6699030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6699034">if</span>&nbsp;<span class="ident" id="6699037">testing</span><span class="op" id="6699044">.</span><span class="ident" id="6699045">Short</span><span class="op" id="6699050">(</span><span class="op" id="6699051">)</span>&nbsp;<span class="op" id="6699053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6699058">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6699066">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6699069">}</span><br>
<span class="lineno"></span><span class="op" id="6699071">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6699074">func</span>&nbsp;<span class="ident" id="6699079">TestReaderDict</span><span class="op" id="6699093">(</span><span class="ident" id="6699094">t</span>&nbsp;<span class="op" id="6699096">*</span><span class="ident" id="6699097">testing</span><span class="op" id="6699104">.</span><span class="ident" id="6699105">T</span><span class="op" id="6699106">)</span>&nbsp;<span class="op" id="6699108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6699111">const</span>&nbsp;<span class="op" id="6699117">(</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6699121">dict</span>&nbsp;<span class="op" id="6699126">=</span>&nbsp;<span class="string" id="6699128">&#34;hello&nbsp;world&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6699144">text</span>&nbsp;<span class="op" id="6699149">=</span>&nbsp;<span class="string" id="6699151">&#34;hello&nbsp;again&nbsp;world&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6699172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6699175">var</span>&nbsp;<span class="ident" id="6699179">b</span>&nbsp;<span class="ident" id="6699181">bytes</span><span class="op" id="6699186">.</span><span class="ident" id="6699187">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6699195">w</span><span class="op" id="6699196">,</span>&nbsp;<span class="ident" id="6699198">err</span>&nbsp;<span class="op" id="6699202">:=</span>&nbsp;<span class="ident" id="6699205">NewWriter</span><span class="op" id="6699214">(</span><span class="op" id="6699215">&amp;</span><span class="ident" id="6699216">b</span><span class="op" id="6699217">,</span>&nbsp;<span class="num" id="6699219">5</span><span class="op" id="6699220">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6699223">if</span>&nbsp;<span class="ident" id="6699226">err</span>&nbsp;<span class="op" id="6699230">!=</span>&nbsp;<span class="ident" id="6699233">nil</span>&nbsp;<span class="op" id="6699237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6699241">t</span><span class="op" id="6699242">.</span><span class="ident" id="6699243">Fatalf</span><span class="op" id="6699249">(</span><span class="string" id="6699250">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="6699265">,</span>&nbsp;<span class="ident" id="6699267">err</span><span class="op" id="6699270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6699273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6699276">w</span><span class="op" id="6699277">.</span><span class="ident" id="6699278">Write</span><span class="op" id="6699283">(</span><span class="op" id="6699284">[</span><span class="op" id="6699285">]</span><span class="builtintype" id="6699286">byte</span><span class="op" id="6699290">(</span><span class="ident" id="6699291">dict</span><span class="op" id="6699295">)</span><span class="op" id="6699296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6699299">w</span><span class="op" id="6699300">.</span><span class="ident" id="6699301">Flush</span><span class="op" id="6699306">(</span><span class="op" id="6699307">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6699310">b</span><span class="op" id="6699311">.</span><span class="ident" id="6699312">Reset</span><span class="op" id="6699317">(</span><span class="op" id="6699318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6699321">w</span><span class="op" id="6699322">.</span><span class="ident" id="6699323">Write</span><span class="op" id="6699328">(</span><span class="op" id="6699329">[</span><span class="op" id="6699330">]</span><span class="builtintype" id="6699331">byte</span><span class="op" id="6699335">(</span><span class="ident" id="6699336">text</span><span class="op" id="6699340">)</span><span class="op" id="6699341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6699344">w</span><span class="op" id="6699345">.</span><span class="ident" id="6699346">Close</span><span class="op" id="6699351">(</span><span class="op" id="6699352">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6699356">r</span>&nbsp;<span class="op" id="6699358">:=</span>&nbsp;<span class="ident" id="6699361">NewReaderDict</span><span class="op" id="6699374">(</span><span class="op" id="6699375">&amp;</span><span class="ident" id="6699376">b</span><span class="op" id="6699377">,</span>&nbsp;<span class="op" id="6699379">[</span><span class="op" id="6699380">]</span><span class="builtintype" id="6699381">byte</span><span class="op" id="6699385">(</span><span class="ident" id="6699386">dict</span><span class="op" id="6699390">)</span><span class="op" id="6699391">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6699394">data</span><span class="op" id="6699398">,</span>&nbsp;<span class="ident" id="6699400">err</span>&nbsp;<span class="op" id="6699404">:=</span>&nbsp;<span class="ident" id="6699407">ioutil</span><span class="op" id="6699413">.</span><span class="ident" id="6699414">ReadAll</span><span class="op" id="6699421">(</span><span class="ident" id="6699422">r</span><span class="op" id="6699423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6699426">if</span>&nbsp;<span class="ident" id="6699429">err</span>&nbsp;<span class="op" id="6699433">!=</span>&nbsp;<span class="ident" id="6699436">nil</span>&nbsp;<span class="op" id="6699440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6699444">t</span><span class="op" id="6699445">.</span><span class="ident" id="6699446">Fatal</span><span class="op" id="6699451">(</span><span class="ident" id="6699452">err</span><span class="op" id="6699455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6699458">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6699461">if</span>&nbsp;<span class="builtintype" id="6699464">string</span><span class="op" id="6699470">(</span><span class="ident" id="6699471">data</span><span class="op" id="6699475">)</span>&nbsp;<span class="op" id="6699477">!=</span>&nbsp;<span class="string" id="6699480">&#34;hello&nbsp;again&nbsp;world&#34;</span>&nbsp;<span class="op" id="6699500">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6699504">t</span><span class="op" id="6699505">.</span><span class="ident" id="6699506">Fatalf</span><span class="op" id="6699512">(</span><span class="string" id="6699513">&#34;read&nbsp;returned&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6699539">,</span>&nbsp;<span class="builtintype" id="6699541">string</span><span class="op" id="6699547">(</span><span class="ident" id="6699548">data</span><span class="op" id="6699552">)</span><span class="op" id="6699553">,</span>&nbsp;<span class="ident" id="6699555">text</span><span class="op" id="6699559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6699562">}</span><br>
<span class="lineno"></span><span class="op" id="6699564">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6699567">func</span>&nbsp;<span class="ident" id="6699572">TestWriterDict</span><span class="op" id="6699586">(</span><span class="ident" id="6699587">t</span>&nbsp;<span class="op" id="6699589">*</span><span class="ident" id="6699590">testing</span><span class="op" id="6699597">.</span><span class="ident" id="6699598">T</span><span class="op" id="6699599">)</span>&nbsp;<span class="op" id="6699601">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6699604">const</span>&nbsp;<span class="op" id="6699610">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6699614">dict</span>&nbsp;<span class="op" id="6699619">=</span>&nbsp;<span class="string" id="6699621">&#34;hello&nbsp;world&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6699637">text</span>&nbsp;<span class="op" id="6699642">=</span>&nbsp;<span class="string" id="6699644">&#34;hello&nbsp;again&nbsp;world&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6699665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6699668">var</span>&nbsp;<span class="ident" id="6699672">b</span>&nbsp;<span class="ident" id="6699674">bytes</span><span class="op" id="6699679">.</span><span class="ident" id="6699680">Buffer</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6699688">w</span><span class="op" id="6699689">,</span>&nbsp;<span class="ident" id="6699691">err</span>&nbsp;<span class="op" id="6699695">:=</span>&nbsp;<span class="ident" id="6699698">NewWriter</span><span class="op" id="6699707">(</span><span class="op" id="6699708">&amp;</span><span class="ident" id="6699709">b</span><span class="op" id="6699710">,</span>&nbsp;<span class="num" id="6699712">5</span><span class="op" id="6699713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6699716">if</span>&nbsp;<span class="ident" id="6699719">err</span>&nbsp;<span class="op" id="6699723">!=</span>&nbsp;<span class="ident" id="6699726">nil</span>&nbsp;<span class="op" id="6699730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6699734">t</span><span class="op" id="6699735">.</span><span class="ident" id="6699736">Fatalf</span><span class="op" id="6699742">(</span><span class="string" id="6699743">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="6699758">,</span>&nbsp;<span class="ident" id="6699760">err</span><span class="op" id="6699763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6699766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6699769">w</span><span class="op" id="6699770">.</span><span class="ident" id="6699771">Write</span><span class="op" id="6699776">(</span><span class="op" id="6699777">[</span><span class="op" id="6699778">]</span><span class="builtintype" id="6699779">byte</span><span class="op" id="6699783">(</span><span class="ident" id="6699784">dict</span><span class="op" id="6699788">)</span><span class="op" id="6699789">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6699792">w</span><span class="op" id="6699793">.</span><span class="ident" id="6699794">Flush</span><span class="op" id="6699799">(</span><span class="op" id="6699800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6699803">b</span><span class="op" id="6699804">.</span><span class="ident" id="6699805">Reset</span><span class="op" id="6699810">(</span><span class="op" id="6699811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6699814">w</span><span class="op" id="6699815">.</span><span class="ident" id="6699816">Write</span><span class="op" id="6699821">(</span><span class="op" id="6699822">[</span><span class="op" id="6699823">]</span><span class="builtintype" id="6699824">byte</span><span class="op" id="6699828">(</span><span class="ident" id="6699829">text</span><span class="op" id="6699833">)</span><span class="op" id="6699834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6699837">w</span><span class="op" id="6699838">.</span><span class="ident" id="6699839">Close</span><span class="op" id="6699844">(</span><span class="op" id="6699845">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6699849">var</span>&nbsp;<span class="ident" id="6699853">b1</span>&nbsp;<span class="ident" id="6699856">bytes</span><span class="op" id="6699861">.</span><span class="ident" id="6699862">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6699870">w</span><span class="op" id="6699871">,</span>&nbsp;<span class="ident" id="6699873">_</span>&nbsp;<span class="op" id="6699875">=</span>&nbsp;<span class="ident" id="6699877">NewWriterDict</span><span class="op" id="6699890">(</span><span class="op" id="6699891">&amp;</span><span class="ident" id="6699892">b1</span><span class="op" id="6699894">,</span>&nbsp;<span class="num" id="6699896">5</span><span class="op" id="6699897">,</span>&nbsp;<span class="op" id="6699899">[</span><span class="op" id="6699900">]</span><span class="builtintype" id="6699901">byte</span><span class="op" id="6699905">(</span><span class="ident" id="6699906">dict</span><span class="op" id="6699910">)</span><span class="op" id="6699911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6699914">w</span><span class="op" id="6699915">.</span><span class="ident" id="6699916">Write</span><span class="op" id="6699921">(</span><span class="op" id="6699922">[</span><span class="op" id="6699923">]</span><span class="builtintype" id="6699924">byte</span><span class="op" id="6699928">(</span><span class="ident" id="6699929">text</span><span class="op" id="6699933">)</span><span class="op" id="6699934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6699937">w</span><span class="op" id="6699938">.</span><span class="ident" id="6699939">Close</span><span class="op" id="6699944">(</span><span class="op" id="6699945">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6699949">if</span>&nbsp;<span class="op" id="6699952">!</span><span class="ident" id="6699953">bytes</span><span class="op" id="6699958">.</span><span class="ident" id="6699959">Equal</span><span class="op" id="6699964">(</span><span class="ident" id="6699965">b1</span><span class="op" id="6699967">.</span><span class="ident" id="6699968">Bytes</span><span class="op" id="6699973">(</span><span class="op" id="6699974">)</span><span class="op" id="6699975">,</span>&nbsp;<span class="ident" id="6699977">b</span><span class="op" id="6699978">.</span><span class="ident" id="6699979">Bytes</span><span class="op" id="6699984">(</span><span class="op" id="6699985">)</span><span class="op" id="6699986">)</span>&nbsp;<span class="op" id="6699988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6699992">t</span><span class="op" id="6699993">.</span><span class="ident" id="6699994">Fatalf</span><span class="op" id="6700000">(</span><span class="string" id="6700001">&#34;writer&nbsp;wrote&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6700026">,</span>&nbsp;<span class="ident" id="6700028">b1</span><span class="op" id="6700030">.</span><span class="ident" id="6700031">Bytes</span><span class="op" id="6700036">(</span><span class="op" id="6700037">)</span><span class="op" id="6700038">,</span>&nbsp;<span class="ident" id="6700040">b</span><span class="op" id="6700041">.</span><span class="ident" id="6700042">Bytes</span><span class="op" id="6700047">(</span><span class="op" id="6700048">)</span><span class="op" id="6700049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6700052">}</span><br>
<span class="lineno"></span><span class="op" id="6700054">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span><span class="comment" id="6700057">//&nbsp;See&nbsp;http://code.google.com/p/go/issues/detail?id=2508</span><br>
<span class="lineno"></span><span class="keyword" id="6700114">func</span>&nbsp;<span class="ident" id="6700119">TestRegression2508</span><span class="op" id="6700137">(</span><span class="ident" id="6700138">t</span>&nbsp;<span class="op" id="6700140">*</span><span class="ident" id="6700141">testing</span><span class="op" id="6700148">.</span><span class="ident" id="6700149">T</span><span class="op" id="6700150">)</span>&nbsp;<span class="op" id="6700152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6700155">if</span>&nbsp;<span class="ident" id="6700158">testing</span><span class="op" id="6700165">.</span><span class="ident" id="6700166">Short</span><span class="op" id="6700171">(</span><span class="op" id="6700172">)</span>&nbsp;<span class="op" id="6700174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6700178">t</span><span class="op" id="6700179">.</span><span class="ident" id="6700180">Logf</span><span class="op" id="6700184">(</span><span class="string" id="6700185">&#34;test&nbsp;disabled&nbsp;with&nbsp;-short&#34;</span><span class="op" id="6700212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6700216">return</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6700224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6700227">w</span><span class="op" id="6700228">,</span>&nbsp;<span class="ident" id="6700230">err</span>&nbsp;<span class="op" id="6700234">:=</span>&nbsp;<span class="ident" id="6700237">NewWriter</span><span class="op" id="6700246">(</span><span class="ident" id="6700247">ioutil</span><span class="op" id="6700253">.</span><span class="ident" id="6700254">Discard</span><span class="op" id="6700261">,</span>&nbsp;<span class="num" id="6700263">1</span><span class="op" id="6700264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6700267">if</span>&nbsp;<span class="ident" id="6700270">err</span>&nbsp;<span class="op" id="6700274">!=</span>&nbsp;<span class="ident" id="6700277">nil</span>&nbsp;<span class="op" id="6700281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6700285">t</span><span class="op" id="6700286">.</span><span class="ident" id="6700287">Fatalf</span><span class="op" id="6700293">(</span><span class="string" id="6700294">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="6700309">,</span>&nbsp;<span class="ident" id="6700311">err</span><span class="op" id="6700314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6700317">}</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6700320">buf</span>&nbsp;<span class="op" id="6700324">:=</span>&nbsp;<span class="builtinfunc" id="6700327">make</span><span class="op" id="6700331">(</span><span class="op" id="6700332">[</span><span class="op" id="6700333">]</span><span class="builtintype" id="6700334">byte</span><span class="op" id="6700338">,</span>&nbsp;<span class="num" id="6700340">1024</span><span class="op" id="6700344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6700347">for</span>&nbsp;<span class="ident" id="6700351">i</span>&nbsp;<span class="op" id="6700353">:=</span>&nbsp;<span class="num" id="6700356">0</span><span class="op" id="6700357">;</span>&nbsp;<span class="ident" id="6700359">i</span>&nbsp;<span class="op" id="6700361">&lt;</span>&nbsp;<span class="num" id="6700363">131072</span><span class="op" id="6700369">;</span>&nbsp;<span class="ident" id="6700371">i</span><span class="op" id="6700372">++</span>&nbsp;<span class="op" id="6700375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6700379">if</span>&nbsp;<span class="ident" id="6700382">_</span><span class="op" id="6700383">,</span>&nbsp;<span class="ident" id="6700385">err</span>&nbsp;<span class="op" id="6700389">:=</span>&nbsp;<span class="ident" id="6700392">w</span><span class="op" id="6700393">.</span><span class="ident" id="6700394">Write</span><span class="op" id="6700399">(</span><span class="ident" id="6700400">buf</span><span class="op" id="6700403">)</span><span class="op" id="6700404">;</span>&nbsp;<span class="ident" id="6700406">err</span>&nbsp;<span class="op" id="6700410">!=</span>&nbsp;<span class="ident" id="6700413">nil</span>&nbsp;<span class="op" id="6700417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6700422">t</span><span class="op" id="6700423">.</span><span class="ident" id="6700424">Fatalf</span><span class="op" id="6700430">(</span><span class="string" id="6700431">&#34;writer&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6700450">,</span>&nbsp;<span class="ident" id="6700452">err</span><span class="op" id="6700455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6700459">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6700462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6700465">w</span><span class="op" id="6700466">.</span><span class="ident" id="6700467">Close</span><span class="op" id="6700472">(</span><span class="op" id="6700473">)</span><br>
<span class="lineno"></span><span class="op" id="6700475">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6700478">func</span>&nbsp;<span class="ident" id="6700483">TestWriterReset</span><span class="op" id="6700498">(</span><span class="ident" id="6700499">t</span>&nbsp;<span class="op" id="6700501">*</span><span class="ident" id="6700502">testing</span><span class="op" id="6700509">.</span><span class="ident" id="6700510">T</span><span class="op" id="6700511">)</span>&nbsp;<span class="op" id="6700513">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6700516">for</span>&nbsp;<span class="ident" id="6700520">level</span>&nbsp;<span class="op" id="6700526">:=</span>&nbsp;<span class="num" id="6700529">0</span><span class="op" id="6700530">;</span>&nbsp;<span class="ident" id="6700532">level</span>&nbsp;<span class="op" id="6700538">&lt;=</span>&nbsp;<span class="num" id="6700541">9</span><span class="op" id="6700542">;</span>&nbsp;<span class="ident" id="6700544">level</span><span class="op" id="6700549">++</span>&nbsp;<span class="op" id="6700552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6700556">if</span>&nbsp;<span class="ident" id="6700559">testing</span><span class="op" id="6700566">.</span><span class="ident" id="6700567">Short</span><span class="op" id="6700572">(</span><span class="op" id="6700573">)</span>&nbsp;<span class="op" id="6700575">&amp;&amp;</span>&nbsp;<span class="ident" id="6700578">level</span>&nbsp;<span class="op" id="6700584">&gt;</span>&nbsp;<span class="num" id="6700586">1</span>&nbsp;<span class="op" id="6700588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6700593">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6700601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6700605">w</span><span class="op" id="6700606">,</span>&nbsp;<span class="ident" id="6700608">err</span>&nbsp;<span class="op" id="6700612">:=</span>&nbsp;<span class="ident" id="6700615">NewWriter</span><span class="op" id="6700624">(</span><span class="ident" id="6700625">ioutil</span><span class="op" id="6700631">.</span><span class="ident" id="6700632">Discard</span><span class="op" id="6700639">,</span>&nbsp;<span class="ident" id="6700641">level</span><span class="op" id="6700646">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6700650">if</span>&nbsp;<span class="ident" id="6700653">err</span>&nbsp;<span class="op" id="6700657">!=</span>&nbsp;<span class="ident" id="6700660">nil</span>&nbsp;<span class="op" id="6700664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6700669">t</span><span class="op" id="6700670">.</span><span class="ident" id="6700671">Fatalf</span><span class="op" id="6700677">(</span><span class="string" id="6700678">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="6700693">,</span>&nbsp;<span class="ident" id="6700695">err</span><span class="op" id="6700698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6700702">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6700706">buf</span>&nbsp;<span class="op" id="6700710">:=</span>&nbsp;<span class="op" id="6700713">[</span><span class="op" id="6700714">]</span><span class="builtintype" id="6700715">byte</span><span class="op" id="6700719">(</span><span class="string" id="6700720">&#34;hello&nbsp;world&#34;</span><span class="op" id="6700733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6700737">for</span>&nbsp;<span class="ident" id="6700741">i</span>&nbsp;<span class="op" id="6700743">:=</span>&nbsp;<span class="num" id="6700746">0</span><span class="op" id="6700747">;</span>&nbsp;<span class="ident" id="6700749">i</span>&nbsp;<span class="op" id="6700751">&lt;</span>&nbsp;<span class="num" id="6700753">1024</span><span class="op" id="6700757">;</span>&nbsp;<span class="ident" id="6700759">i</span><span class="op" id="6700760">++</span>&nbsp;<span class="op" id="6700763">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6700768">w</span><span class="op" id="6700769">.</span><span class="ident" id="6700770">Write</span><span class="op" id="6700775">(</span><span class="ident" id="6700776">buf</span><span class="op" id="6700779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6700783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6700787">w</span><span class="op" id="6700788">.</span><span class="ident" id="6700789">Reset</span><span class="op" id="6700794">(</span><span class="ident" id="6700795">ioutil</span><span class="op" id="6700801">.</span><span class="ident" id="6700802">Discard</span><span class="op" id="6700809">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6700814">wref</span><span class="op" id="6700818">,</span>&nbsp;<span class="ident" id="6700820">err</span>&nbsp;<span class="op" id="6700824">:=</span>&nbsp;<span class="ident" id="6700827">NewWriter</span><span class="op" id="6700836">(</span><span class="ident" id="6700837">ioutil</span><span class="op" id="6700843">.</span><span class="ident" id="6700844">Discard</span><span class="op" id="6700851">,</span>&nbsp;<span class="ident" id="6700853">level</span><span class="op" id="6700858">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6700862">if</span>&nbsp;<span class="ident" id="6700865">err</span>&nbsp;<span class="op" id="6700869">!=</span>&nbsp;<span class="ident" id="6700872">nil</span>&nbsp;<span class="op" id="6700876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6700881">t</span><span class="op" id="6700882">.</span><span class="ident" id="6700883">Fatalf</span><span class="op" id="6700889">(</span><span class="string" id="6700890">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="6700905">,</span>&nbsp;<span class="ident" id="6700907">err</span><span class="op" id="6700910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6700914">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6700919">//&nbsp;DeepEqual&nbsp;doesn&#39;t&nbsp;compare&nbsp;functions.</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6700961">w</span><span class="op" id="6700962">.</span><span class="ident" id="6700963">d</span><span class="op" id="6700964">.</span><span class="ident" id="6700965">fill</span><span class="op" id="6700969">,</span>&nbsp;<span class="ident" id="6700971">wref</span><span class="op" id="6700975">.</span><span class="ident" id="6700976">d</span><span class="op" id="6700977">.</span><span class="ident" id="6700978">fill</span>&nbsp;<span class="op" id="6700983">=</span>&nbsp;<span class="ident" id="6700985">nil</span><span class="op" id="6700988">,</span>&nbsp;<span class="ident" id="6700990">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6700996">w</span><span class="op" id="6700997">.</span><span class="ident" id="6700998">d</span><span class="op" id="6700999">.</span><span class="ident" id="6701000">step</span><span class="op" id="6701004">,</span>&nbsp;<span class="ident" id="6701006">wref</span><span class="op" id="6701010">.</span><span class="ident" id="6701011">d</span><span class="op" id="6701012">.</span><span class="ident" id="6701013">step</span>&nbsp;<span class="op" id="6701018">=</span>&nbsp;<span class="ident" id="6701020">nil</span><span class="op" id="6701023">,</span>&nbsp;<span class="ident" id="6701025">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6701031">if</span>&nbsp;<span class="op" id="6701034">!</span><span class="ident" id="6701035">reflect</span><span class="op" id="6701042">.</span><span class="ident" id="6701043">DeepEqual</span><span class="op" id="6701052">(</span><span class="ident" id="6701053">w</span><span class="op" id="6701054">,</span>&nbsp;<span class="ident" id="6701056">wref</span><span class="op" id="6701060">)</span>&nbsp;<span class="op" id="6701062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6701067">t</span><span class="op" id="6701068">.</span><span class="ident" id="6701069">Errorf</span><span class="op" id="6701075">(</span><span class="string" id="6701076">&#34;level&nbsp;%d&nbsp;Writer&nbsp;not&nbsp;reset&nbsp;after&nbsp;Reset&#34;</span><span class="op" id="6701115">,</span>&nbsp;<span class="ident" id="6701117">level</span><span class="op" id="6701122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6701126">}</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6701129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6701132">testResetOutput</span><span class="op" id="6701147">(</span><span class="ident" id="6701148">t</span><span class="op" id="6701149">,</span>&nbsp;<span class="keyword" id="6701151">func</span><span class="op" id="6701155">(</span><span class="ident" id="6701156">w</span>&nbsp;<span class="ident" id="6701158">io</span><span class="op" id="6701160">.</span><span class="ident" id="6701161">Writer</span><span class="op" id="6701167">)</span>&nbsp;<span class="op" id="6701169">(</span><span class="op" id="6701170">*</span><span class="ident" id="6701171">Writer</span><span class="op" id="6701177">,</span>&nbsp;<span class="builtintype" id="6701179">error</span><span class="op" id="6701184">)</span>&nbsp;<span class="op" id="6701186">{</span>&nbsp;<span class="keyword" id="6701188">return</span>&nbsp;<span class="ident" id="6701195">NewWriter</span><span class="op" id="6701204">(</span><span class="ident" id="6701205">w</span><span class="op" id="6701206">,</span>&nbsp;<span class="ident" id="6701208">NoCompression</span><span class="op" id="6701221">)</span>&nbsp;<span class="op" id="6701223">}</span><span class="op" id="6701224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6701227">testResetOutput</span><span class="op" id="6701242">(</span><span class="ident" id="6701243">t</span><span class="op" id="6701244">,</span>&nbsp;<span class="keyword" id="6701246">func</span><span class="op" id="6701250">(</span><span class="ident" id="6701251">w</span>&nbsp;<span class="ident" id="6701253">io</span><span class="op" id="6701255">.</span><span class="ident" id="6701256">Writer</span><span class="op" id="6701262">)</span>&nbsp;<span class="op" id="6701264">(</span><span class="op" id="6701265">*</span><span class="ident" id="6701266">Writer</span><span class="op" id="6701272">,</span>&nbsp;<span class="builtintype" id="6701274">error</span><span class="op" id="6701279">)</span>&nbsp;<span class="op" id="6701281">{</span>&nbsp;<span class="keyword" id="6701283">return</span>&nbsp;<span class="ident" id="6701290">NewWriter</span><span class="op" id="6701299">(</span><span class="ident" id="6701300">w</span><span class="op" id="6701301">,</span>&nbsp;<span class="ident" id="6701303">DefaultCompression</span><span class="op" id="6701321">)</span>&nbsp;<span class="op" id="6701323">}</span><span class="op" id="6701324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6701327">testResetOutput</span><span class="op" id="6701342">(</span><span class="ident" id="6701343">t</span><span class="op" id="6701344">,</span>&nbsp;<span class="keyword" id="6701346">func</span><span class="op" id="6701350">(</span><span class="ident" id="6701351">w</span>&nbsp;<span class="ident" id="6701353">io</span><span class="op" id="6701355">.</span><span class="ident" id="6701356">Writer</span><span class="op" id="6701362">)</span>&nbsp;<span class="op" id="6701364">(</span><span class="op" id="6701365">*</span><span class="ident" id="6701366">Writer</span><span class="op" id="6701372">,</span>&nbsp;<span class="builtintype" id="6701374">error</span><span class="op" id="6701379">)</span>&nbsp;<span class="op" id="6701381">{</span>&nbsp;<span class="keyword" id="6701383">return</span>&nbsp;<span class="ident" id="6701390">NewWriter</span><span class="op" id="6701399">(</span><span class="ident" id="6701400">w</span><span class="op" id="6701401">,</span>&nbsp;<span class="ident" id="6701403">BestCompression</span><span class="op" id="6701418">)</span>&nbsp;<span class="op" id="6701420">}</span><span class="op" id="6701421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6701424">dict</span>&nbsp;<span class="op" id="6701429">:=</span>&nbsp;<span class="op" id="6701432">[</span><span class="op" id="6701433">]</span><span class="builtintype" id="6701434">byte</span><span class="op" id="6701438">(</span><span class="string" id="6701439">&#34;we&nbsp;are&nbsp;the&nbsp;world&#34;</span><span class="op" id="6701457">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6701460">testResetOutput</span><span class="op" id="6701475">(</span><span class="ident" id="6701476">t</span><span class="op" id="6701477">,</span>&nbsp;<span class="keyword" id="6701479">func</span><span class="op" id="6701483">(</span><span class="ident" id="6701484">w</span>&nbsp;<span class="ident" id="6701486">io</span><span class="op" id="6701488">.</span><span class="ident" id="6701489">Writer</span><span class="op" id="6701495">)</span>&nbsp;<span class="op" id="6701497">(</span><span class="op" id="6701498">*</span><span class="ident" id="6701499">Writer</span><span class="op" id="6701505">,</span>&nbsp;<span class="builtintype" id="6701507">error</span><span class="op" id="6701512">)</span>&nbsp;<span class="op" id="6701514">{</span>&nbsp;<span class="keyword" id="6701516">return</span>&nbsp;<span class="ident" id="6701523">NewWriterDict</span><span class="op" id="6701536">(</span><span class="ident" id="6701537">w</span><span class="op" id="6701538">,</span>&nbsp;<span class="ident" id="6701540">NoCompression</span><span class="op" id="6701553">,</span>&nbsp;<span class="ident" id="6701555">dict</span><span class="op" id="6701559">)</span>&nbsp;<span class="op" id="6701561">}</span><span class="op" id="6701562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6701565">testResetOutput</span><span class="op" id="6701580">(</span><span class="ident" id="6701581">t</span><span class="op" id="6701582">,</span>&nbsp;<span class="keyword" id="6701584">func</span><span class="op" id="6701588">(</span><span class="ident" id="6701589">w</span>&nbsp;<span class="ident" id="6701591">io</span><span class="op" id="6701593">.</span><span class="ident" id="6701594">Writer</span><span class="op" id="6701600">)</span>&nbsp;<span class="op" id="6701602">(</span><span class="op" id="6701603">*</span><span class="ident" id="6701604">Writer</span><span class="op" id="6701610">,</span>&nbsp;<span class="builtintype" id="6701612">error</span><span class="op" id="6701617">)</span>&nbsp;<span class="op" id="6701619">{</span>&nbsp;<span class="keyword" id="6701621">return</span>&nbsp;<span class="ident" id="6701628">NewWriterDict</span><span class="op" id="6701641">(</span><span class="ident" id="6701642">w</span><span class="op" id="6701643">,</span>&nbsp;<span class="ident" id="6701645">DefaultCompression</span><span class="op" id="6701663">,</span>&nbsp;<span class="ident" id="6701665">dict</span><span class="op" id="6701669">)</span>&nbsp;<span class="op" id="6701671">}</span><span class="op" id="6701672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6701675">testResetOutput</span><span class="op" id="6701690">(</span><span class="ident" id="6701691">t</span><span class="op" id="6701692">,</span>&nbsp;<span class="keyword" id="6701694">func</span><span class="op" id="6701698">(</span><span class="ident" id="6701699">w</span>&nbsp;<span class="ident" id="6701701">io</span><span class="op" id="6701703">.</span><span class="ident" id="6701704">Writer</span><span class="op" id="6701710">)</span>&nbsp;<span class="op" id="6701712">(</span><span class="op" id="6701713">*</span><span class="ident" id="6701714">Writer</span><span class="op" id="6701720">,</span>&nbsp;<span class="builtintype" id="6701722">error</span><span class="op" id="6701727">)</span>&nbsp;<span class="op" id="6701729">{</span>&nbsp;<span class="keyword" id="6701731">return</span>&nbsp;<span class="ident" id="6701738">NewWriterDict</span><span class="op" id="6701751">(</span><span class="ident" id="6701752">w</span><span class="op" id="6701753">,</span>&nbsp;<span class="ident" id="6701755">BestCompression</span><span class="op" id="6701770">,</span>&nbsp;<span class="ident" id="6701772">dict</span><span class="op" id="6701776">)</span>&nbsp;<span class="op" id="6701778">}</span><span class="op" id="6701779">)</span><br>
<span class="lineno"></span><span class="op" id="6701781">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">465</span><span class="keyword" id="6701784">func</span>&nbsp;<span class="ident" id="6701789">testResetOutput</span><span class="op" id="6701804">(</span><span class="ident" id="6701805">t</span>&nbsp;<span class="op" id="6701807">*</span><span class="ident" id="6701808">testing</span><span class="op" id="6701815">.</span><span class="ident" id="6701816">T</span><span class="op" id="6701817">,</span>&nbsp;<span class="ident" id="6701819">newWriter</span>&nbsp;<span class="keyword" id="6701829">func</span><span class="op" id="6701833">(</span><span class="ident" id="6701834">w</span>&nbsp;<span class="ident" id="6701836">io</span><span class="op" id="6701838">.</span><span class="ident" id="6701839">Writer</span><span class="op" id="6701845">)</span>&nbsp;<span class="op" id="6701847">(</span><span class="op" id="6701848">*</span><span class="ident" id="6701849">Writer</span><span class="op" id="6701855">,</span>&nbsp;<span class="builtintype" id="6701857">error</span><span class="op" id="6701862">)</span><span class="op" id="6701863">)</span>&nbsp;<span class="op" id="6701865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6701868">buf</span>&nbsp;<span class="op" id="6701872">:=</span>&nbsp;<span class="builtinfunc" id="6701875">new</span><span class="op" id="6701878">(</span><span class="ident" id="6701879">bytes</span><span class="op" id="6701884">.</span><span class="ident" id="6701885">Buffer</span><span class="op" id="6701891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6701894">w</span><span class="op" id="6701895">,</span>&nbsp;<span class="ident" id="6701897">err</span>&nbsp;<span class="op" id="6701901">:=</span>&nbsp;<span class="ident" id="6701904">newWriter</span><span class="op" id="6701913">(</span><span class="ident" id="6701914">buf</span><span class="op" id="6701917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6701920">if</span>&nbsp;<span class="ident" id="6701923">err</span>&nbsp;<span class="op" id="6701927">!=</span>&nbsp;<span class="ident" id="6701930">nil</span>&nbsp;<span class="op" id="6701934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6701938">t</span><span class="op" id="6701939">.</span><span class="ident" id="6701940">Fatalf</span><span class="op" id="6701946">(</span><span class="string" id="6701947">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="6701962">,</span>&nbsp;<span class="ident" id="6701964">err</span><span class="op" id="6701967">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6701970">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6701973">b</span>&nbsp;<span class="op" id="6701975">:=</span>&nbsp;<span class="op" id="6701978">[</span><span class="op" id="6701979">]</span><span class="builtintype" id="6701980">byte</span><span class="op" id="6701984">(</span><span class="string" id="6701985">&#34;hello&nbsp;world&#34;</span><span class="op" id="6701998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6702001">for</span>&nbsp;<span class="ident" id="6702005">i</span>&nbsp;<span class="op" id="6702007">:=</span>&nbsp;<span class="num" id="6702010">0</span><span class="op" id="6702011">;</span>&nbsp;<span class="ident" id="6702013">i</span>&nbsp;<span class="op" id="6702015">&lt;</span>&nbsp;<span class="num" id="6702017">1024</span><span class="op" id="6702021">;</span>&nbsp;<span class="ident" id="6702023">i</span><span class="op" id="6702024">++</span>&nbsp;<span class="op" id="6702027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6702031">w</span><span class="op" id="6702032">.</span><span class="ident" id="6702033">Write</span><span class="op" id="6702038">(</span><span class="ident" id="6702039">b</span><span class="op" id="6702040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6702043">}</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6702046">w</span><span class="op" id="6702047">.</span><span class="ident" id="6702048">Close</span><span class="op" id="6702053">(</span><span class="op" id="6702054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6702057">out1</span>&nbsp;<span class="op" id="6702062">:=</span>&nbsp;<span class="ident" id="6702065">buf</span><span class="op" id="6702068">.</span><span class="ident" id="6702069">String</span><span class="op" id="6702075">(</span><span class="op" id="6702076">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6702080">buf2</span>&nbsp;<span class="op" id="6702085">:=</span>&nbsp;<span class="builtinfunc" id="6702088">new</span><span class="op" id="6702091">(</span><span class="ident" id="6702092">bytes</span><span class="op" id="6702097">.</span><span class="ident" id="6702098">Buffer</span><span class="op" id="6702104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6702107">w</span><span class="op" id="6702108">.</span><span class="ident" id="6702109">Reset</span><span class="op" id="6702114">(</span><span class="ident" id="6702115">buf2</span><span class="op" id="6702119">)</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6702122">for</span>&nbsp;<span class="ident" id="6702126">i</span>&nbsp;<span class="op" id="6702128">:=</span>&nbsp;<span class="num" id="6702131">0</span><span class="op" id="6702132">;</span>&nbsp;<span class="ident" id="6702134">i</span>&nbsp;<span class="op" id="6702136">&lt;</span>&nbsp;<span class="num" id="6702138">1024</span><span class="op" id="6702142">;</span>&nbsp;<span class="ident" id="6702144">i</span><span class="op" id="6702145">++</span>&nbsp;<span class="op" id="6702148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6702152">w</span><span class="op" id="6702153">.</span><span class="ident" id="6702154">Write</span><span class="op" id="6702159">(</span><span class="ident" id="6702160">b</span><span class="op" id="6702161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6702164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6702167">w</span><span class="op" id="6702168">.</span><span class="ident" id="6702169">Close</span><span class="op" id="6702174">(</span><span class="op" id="6702175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6702178">out2</span>&nbsp;<span class="op" id="6702183">:=</span>&nbsp;<span class="ident" id="6702186">buf2</span><span class="op" id="6702190">.</span><span class="ident" id="6702191">String</span><span class="op" id="6702197">(</span><span class="op" id="6702198">)</span><br>
<span class="lineno">485</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6702202">if</span>&nbsp;<span class="ident" id="6702205">out1</span>&nbsp;<span class="op" id="6702210">!=</span>&nbsp;<span class="ident" id="6702213">out2</span>&nbsp;<span class="op" id="6702218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6702222">t</span><span class="op" id="6702223">.</span><span class="ident" id="6702224">Errorf</span><span class="op" id="6702230">(</span><span class="string" id="6702231">&#34;got&nbsp;%q,&nbsp;expected&nbsp;%q&#34;</span><span class="op" id="6702252">,</span>&nbsp;<span class="ident" id="6702254">out2</span><span class="op" id="6702258">,</span>&nbsp;<span class="ident" id="6702260">out1</span><span class="op" id="6702264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6702267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6702270">t</span><span class="op" id="6702271">.</span><span class="ident" id="6702272">Logf</span><span class="op" id="6702276">(</span><span class="string" id="6702277">&#34;got&nbsp;%d&nbsp;bytes&#34;</span><span class="op" id="6702291">,</span>&nbsp;<span class="builtinfunc" id="6702293">len</span><span class="op" id="6702296">(</span><span class="ident" id="6702297">out1</span><span class="op" id="6702301">)</span><span class="op" id="6702302">)</span><br>
<span class="lineno">490</span><span class="op" id="6702304">}</span>
</div>
</body>
</html>
