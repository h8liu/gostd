<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="keyword" id="4958229">package</span>&nbsp;<span class="ident" id="4958237">dasm8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4958244">import</span>&nbsp;<span class="op" id="4958251">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4958254">&#34;fmt&#34;</span><br>
<span class="lineno">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4958262">&#34;encoding/binary&#34;</span><br>
<span class="lineno"></span><span class="op" id="4958280">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4958283">//&nbsp;Dasm&nbsp;disassembles&nbsp;a&nbsp;byte&nbsp;block.</span><br>
<span class="lineno">10</span><span class="keyword" id="4958318">func</span>&nbsp;<span class="ident" id="4958323">Dasm</span><span class="op" id="4958327">(</span><span class="ident" id="4958328">bs</span>&nbsp;<span class="op" id="4958331">[</span><span class="op" id="4958332">]</span><span class="builtintype" id="4958333">byte</span><span class="op" id="4958337">,</span>&nbsp;<span class="ident" id="4958339">addr</span>&nbsp;<span class="builtintype" id="4958344">uint32</span><span class="op" id="4958350">)</span>&nbsp;<span class="op" id="4958352">[</span><span class="op" id="4958353">]</span><span class="op" id="4958354">*</span><span class="ident" id="4958355">Line</span>&nbsp;<span class="op" id="4958360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4958363">var</span>&nbsp;<span class="ident" id="4958367">ret</span>&nbsp;<span class="op" id="4958371">[</span><span class="op" id="4958372">]</span><span class="op" id="4958373">*</span><span class="ident" id="4958374">Line</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4958381">base</span>&nbsp;<span class="op" id="4958386">:=</span>&nbsp;<span class="ident" id="4958389">addr</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4958396">add</span>&nbsp;<span class="op" id="4958400">:=</span>&nbsp;<span class="keyword" id="4958403">func</span><span class="op" id="4958407">(</span><span class="ident" id="4958408">b</span>&nbsp;<span class="op" id="4958410">[</span><span class="op" id="4958411">]</span><span class="builtintype" id="4958412">byte</span><span class="op" id="4958416">)</span>&nbsp;<span class="op" id="4958418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4958422">inst</span>&nbsp;<span class="op" id="4958427">:=</span>&nbsp;<span class="ident" id="4958430">binary</span><span class="op" id="4958436">.</span><span class="ident" id="4958437">LittleEndian</span><span class="op" id="4958449">.</span><span class="ident" id="4958450">Uint32</span><span class="op" id="4958456">(</span><span class="ident" id="4958457">b</span><span class="op" id="4958458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4958462">ret</span>&nbsp;<span class="op" id="4958466">=</span>&nbsp;<span class="builtinfunc" id="4958468">append</span><span class="op" id="4958474">(</span><span class="ident" id="4958475">ret</span><span class="op" id="4958478">,</span>&nbsp;<span class="ident" id="4958480">NewLine</span><span class="op" id="4958487">(</span><span class="ident" id="4958488">addr</span><span class="op" id="4958492">,</span>&nbsp;<span class="ident" id="4958494">inst</span><span class="op" id="4958498">)</span><span class="op" id="4958499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4958503">addr</span>&nbsp;<span class="op" id="4958508">+=</span>&nbsp;<span class="num" id="4958511">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4958514">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4958518">nline</span>&nbsp;<span class="op" id="4958524">:=</span>&nbsp;<span class="builtinfunc" id="4958527">len</span><span class="op" id="4958530">(</span><span class="ident" id="4958531">bs</span><span class="op" id="4958533">)</span>&nbsp;<span class="op" id="4958535">/</span>&nbsp;<span class="num" id="4958537">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4958540">for</span>&nbsp;<span class="ident" id="4958544">i</span>&nbsp;<span class="op" id="4958546">:=</span>&nbsp;<span class="num" id="4958549">0</span><span class="op" id="4958550">;</span>&nbsp;<span class="ident" id="4958552">i</span>&nbsp;<span class="op" id="4958554">&lt;</span>&nbsp;<span class="ident" id="4958556">nline</span><span class="op" id="4958561">;</span>&nbsp;<span class="ident" id="4958563">i</span><span class="op" id="4958564">++</span>&nbsp;<span class="op" id="4958567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4958571">off</span>&nbsp;<span class="op" id="4958575">:=</span>&nbsp;<span class="ident" id="4958578">i</span>&nbsp;<span class="op" id="4958580">*</span>&nbsp;<span class="num" id="4958582">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4958586">add</span><span class="op" id="4958589">(</span><span class="ident" id="4958590">bs</span><span class="op" id="4958592">[</span><span class="ident" id="4958593">off</span>&nbsp;<span class="op" id="4958597">:</span>&nbsp;<span class="ident" id="4958599">off</span><span class="op" id="4958602">+</span><span class="num" id="4958603">4</span><span class="op" id="4958604">]</span><span class="op" id="4958605">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4958608">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4958612">//&nbsp;residue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4958624">if</span>&nbsp;<span class="builtinfunc" id="4958627">len</span><span class="op" id="4958630">(</span><span class="ident" id="4958631">bs</span><span class="op" id="4958633">)</span><span class="op" id="4958634">%</span><span class="num" id="4958635">4</span>&nbsp;<span class="op" id="4958637">!=</span>&nbsp;<span class="num" id="4958640">0</span>&nbsp;<span class="op" id="4958642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4958646">var</span>&nbsp;<span class="ident" id="4958650">buf</span>&nbsp;<span class="op" id="4958654">[</span><span class="num" id="4958655">4</span><span class="op" id="4958656">]</span><span class="builtintype" id="4958657">byte</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4958664">copy</span><span class="op" id="4958668">(</span><span class="ident" id="4958669">buf</span><span class="op" id="4958672">[</span><span class="op" id="4958673">:</span><span class="op" id="4958674">]</span><span class="op" id="4958675">,</span>&nbsp;<span class="ident" id="4958677">bs</span><span class="op" id="4958679">[</span><span class="ident" id="4958680">nline</span><span class="op" id="4958685">*</span><span class="num" id="4958686">4</span><span class="op" id="4958687">:</span><span class="op" id="4958688">]</span><span class="op" id="4958689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4958693">add</span><span class="op" id="4958696">(</span><span class="ident" id="4958697">buf</span><span class="op" id="4958700">[</span><span class="op" id="4958701">:</span><span class="op" id="4958702">]</span><span class="op" id="4958703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4958706">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4958710">//&nbsp;link&nbsp;the&nbsp;jumps</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4958729">for</span>&nbsp;<span class="ident" id="4958733">_</span><span class="op" id="4958734">,</span>&nbsp;<span class="ident" id="4958736">line</span>&nbsp;<span class="op" id="4958741">:=</span>&nbsp;<span class="keyword" id="4958744">range</span>&nbsp;<span class="ident" id="4958750">ret</span>&nbsp;<span class="op" id="4958754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4958758">if</span>&nbsp;<span class="op" id="4958761">!</span><span class="ident" id="4958762">line</span><span class="op" id="4958766">.</span><span class="ident" id="4958767">IsJump</span>&nbsp;<span class="op" id="4958774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4958779">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4958790">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4958795">index</span>&nbsp;<span class="op" id="4958801">:=</span>&nbsp;<span class="builtintype" id="4958804">int</span><span class="op" id="4958807">(</span><span class="ident" id="4958808">line</span><span class="op" id="4958812">.</span><span class="ident" id="4958813">To</span><span class="op" id="4958815">-</span><span class="ident" id="4958816">base</span><span class="op" id="4958820">)</span>&nbsp;<span class="op" id="4958822">/</span>&nbsp;<span class="num" id="4958824">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4958828">if</span>&nbsp;<span class="ident" id="4958831">index</span>&nbsp;<span class="op" id="4958837">&gt;=</span>&nbsp;<span class="num" id="4958840">0</span>&nbsp;<span class="op" id="4958842">&amp;&amp;</span>&nbsp;<span class="ident" id="4958845">index</span>&nbsp;<span class="op" id="4958851">&lt;</span>&nbsp;<span class="ident" id="4958853">nline</span>&nbsp;<span class="op" id="4958859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4958864">line</span><span class="op" id="4958868">.</span><span class="ident" id="4958869">ToLine</span>&nbsp;<span class="op" id="4958876">=</span>&nbsp;<span class="ident" id="4958878">ret</span><span class="op" id="4958881">[</span><span class="ident" id="4958882">index</span><span class="op" id="4958887">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4958891">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4958894">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4958898">return</span>&nbsp;<span class="ident" id="4958905">ret</span><br>
<span class="lineno"></span><span class="op" id="4958909">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4958912">//&nbsp;Print&nbsp;prints&nbsp;a&nbsp;byte&nbsp;block&nbsp;as&nbsp;assembly&nbsp;lines.</span><br>
<span class="lineno">50</span><span class="keyword" id="4958960">func</span>&nbsp;<span class="ident" id="4958965">Print</span><span class="op" id="4958970">(</span><span class="ident" id="4958971">bs</span>&nbsp;<span class="op" id="4958974">[</span><span class="op" id="4958975">]</span><span class="builtintype" id="4958976">byte</span><span class="op" id="4958980">,</span>&nbsp;<span class="ident" id="4958982">addr</span>&nbsp;<span class="builtintype" id="4958987">uint32</span><span class="op" id="4958993">)</span>&nbsp;<span class="op" id="4958995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4958998">lines</span>&nbsp;<span class="op" id="4959004">:=</span>&nbsp;<span class="ident" id="4959007">Dasm</span><span class="op" id="4959011">(</span><span class="ident" id="4959012">bs</span><span class="op" id="4959014">,</span>&nbsp;<span class="ident" id="4959016">addr</span><span class="op" id="4959020">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4959024">for</span>&nbsp;<span class="ident" id="4959028">_</span><span class="op" id="4959029">,</span>&nbsp;<span class="ident" id="4959031">line</span>&nbsp;<span class="op" id="4959036">:=</span>&nbsp;<span class="keyword" id="4959039">range</span>&nbsp;<span class="ident" id="4959045">lines</span>&nbsp;<span class="op" id="4959051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4959055">fmt</span><span class="op" id="4959058">.</span><span class="ident" id="4959059">Println</span><span class="op" id="4959066">(</span><span class="ident" id="4959067">line</span><span class="op" id="4959071">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4959074">}</span><br>
<span class="lineno"></span><span class="op" id="4959076">}</span>
</div>
</body>
</html>
