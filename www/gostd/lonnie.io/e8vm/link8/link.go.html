<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>lonnie.io/e8vm/link8</h2>
<ul>
<li><a href="/gostd/lonnie.io/e8vm/link8/func.go.html">func.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/layout.go.html">layout.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/link.go.html">link.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/linker.go.html">linker.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/package.go.html">package.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/pkg_sym.go.html">pkg_sym.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/symbol.go.html">symbol.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/trace_used.go.html">trace_used.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/var.go.html">var.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/link8/writer.go.html">writer.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="keyword" id="3674832">package</span>&nbsp;<span class="ident" id="3674840">link8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3674847">import</span>&nbsp;<span class="op" id="3674854">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3674857">&#34;fmt&#34;</span><br>
<span class="lineno">5</span><span class="op" id="3674863">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3674866">//&nbsp;LinkMain&nbsp;produces&nbsp;a&nbsp;image&nbsp;for&nbsp;a&nbsp;main()&nbsp;in&nbsp;a&nbsp;package.</span><br>
<span class="lineno"></span><span class="keyword" id="3674922">func</span>&nbsp;<span class="ident" id="3674927">LinkMain</span><span class="op" id="3674935">(</span><span class="ident" id="3674936">main</span>&nbsp;<span class="op" id="3674941">*</span><span class="ident" id="3674942">Package</span><span class="op" id="3674949">)</span>&nbsp;<span class="op" id="3674951">(</span><span class="op" id="3674952">[</span><span class="op" id="3674953">]</span><span class="builtintype" id="3674954">byte</span><span class="op" id="3674958">,</span>&nbsp;<span class="builtintype" id="3674960">error</span><span class="op" id="3674965">)</span>&nbsp;<span class="op" id="3674967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3674970">lnk</span>&nbsp;<span class="op" id="3674974">:=</span>&nbsp;<span class="ident" id="3674977">NewLinker</span><span class="op" id="3674986">(</span><span class="op" id="3674987">)</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3674990">lnk</span><span class="op" id="3674993">.</span><span class="ident" id="3674994">AddPkgs</span><span class="op" id="3675001">(</span><span class="ident" id="3675002">main</span><span class="op" id="3675006">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3675010">funcMain</span><span class="op" id="3675018">,</span>&nbsp;<span class="ident" id="3675020">index</span>&nbsp;<span class="op" id="3675026">:=</span>&nbsp;<span class="ident" id="3675029">main</span><span class="op" id="3675033">.</span><span class="ident" id="3675034">Query</span><span class="op" id="3675039">(</span><span class="string" id="3675040">&#34;main&#34;</span><span class="op" id="3675046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3675049">if</span>&nbsp;<span class="ident" id="3675052">funcMain</span>&nbsp;<span class="op" id="3675061">==</span>&nbsp;<span class="ident" id="3675064">nil</span>&nbsp;<span class="op" id="3675068">||</span>&nbsp;<span class="ident" id="3675071">funcMain</span><span class="op" id="3675079">.</span><span class="ident" id="3675080">Type</span>&nbsp;<span class="op" id="3675085">!=</span>&nbsp;<span class="ident" id="3675088">SymFunc</span>&nbsp;<span class="op" id="3675096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3675100">return</span>&nbsp;<span class="ident" id="3675107">nil</span><span class="op" id="3675110">,</span>&nbsp;<span class="ident" id="3675112">fmt</span><span class="op" id="3675115">.</span><span class="ident" id="3675116">Errorf</span><span class="op" id="3675122">(</span><span class="string" id="3675123">&#34;main&nbsp;function&nbsp;missing&#34;</span><span class="op" id="3675146">)</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3675149">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3675153">used</span>&nbsp;<span class="op" id="3675158">:=</span>&nbsp;<span class="ident" id="3675161">traceUsed</span><span class="op" id="3675170">(</span><span class="ident" id="3675171">lnk</span><span class="op" id="3675174">,</span>&nbsp;<span class="ident" id="3675176">main</span><span class="op" id="3675180">,</span>&nbsp;<span class="ident" id="3675182">index</span><span class="op" id="3675187">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3675191">funcs</span><span class="op" id="3675196">,</span>&nbsp;<span class="ident" id="3675198">vars</span><span class="op" id="3675202">,</span>&nbsp;<span class="ident" id="3675204">e</span>&nbsp;<span class="op" id="3675206">:=</span>&nbsp;<span class="ident" id="3675209">layout</span><span class="op" id="3675215">(</span><span class="ident" id="3675216">used</span><span class="op" id="3675220">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3675223">if</span>&nbsp;<span class="ident" id="3675226">e</span>&nbsp;<span class="op" id="3675228">!=</span>&nbsp;<span class="ident" id="3675231">nil</span>&nbsp;<span class="op" id="3675235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3675239">return</span>&nbsp;<span class="ident" id="3675246">nil</span><span class="op" id="3675249">,</span>&nbsp;<span class="ident" id="3675251">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3675254">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3675258">w</span>&nbsp;<span class="op" id="3675260">:=</span>&nbsp;<span class="ident" id="3675263">newWriter</span><span class="op" id="3675272">(</span><span class="op" id="3675273">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3675276">for</span>&nbsp;<span class="ident" id="3675280">_</span><span class="op" id="3675281">,</span>&nbsp;<span class="ident" id="3675283">f</span>&nbsp;<span class="op" id="3675285">:=</span>&nbsp;<span class="keyword" id="3675288">range</span>&nbsp;<span class="ident" id="3675294">funcs</span>&nbsp;<span class="op" id="3675300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3675304">writeFunc</span><span class="op" id="3675313">(</span><span class="ident" id="3675314">w</span><span class="op" id="3675315">,</span>&nbsp;<span class="ident" id="3675317">f</span><span class="op" id="3675318">.</span><span class="ident" id="3675319">pkg</span><span class="op" id="3675322">,</span>&nbsp;<span class="ident" id="3675324">f</span><span class="op" id="3675325">.</span><span class="ident" id="3675326">Func</span><span class="op" id="3675330">(</span><span class="op" id="3675331">)</span><span class="op" id="3675332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3675335">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3675339">for</span>&nbsp;<span class="ident" id="3675343">_</span><span class="op" id="3675344">,</span>&nbsp;<span class="ident" id="3675346">v</span>&nbsp;<span class="op" id="3675348">:=</span>&nbsp;<span class="keyword" id="3675351">range</span>&nbsp;<span class="ident" id="3675357">vars</span>&nbsp;<span class="op" id="3675362">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3675366">writeVar</span><span class="op" id="3675374">(</span><span class="ident" id="3675375">w</span><span class="op" id="3675376">,</span>&nbsp;<span class="ident" id="3675378">v</span><span class="op" id="3675379">.</span><span class="ident" id="3675380">Var</span><span class="op" id="3675383">(</span><span class="op" id="3675384">)</span><span class="op" id="3675385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3675388">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3675392">return</span>&nbsp;<span class="ident" id="3675399">w</span><span class="op" id="3675400">.</span><span class="ident" id="3675401">bytes</span><span class="op" id="3675406">(</span><span class="op" id="3675407">)</span><span class="op" id="3675408">,</span>&nbsp;<span class="ident" id="3675410">nil</span><br>
<span class="lineno"></span><span class="op" id="3675414">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="comment" id="3675417">//&nbsp;LinkBareFunc&nbsp;produces&nbsp;a&nbsp;image&nbsp;of&nbsp;a&nbsp;single&nbsp;function&nbsp;that&nbsp;has&nbsp;no&nbsp;links.</span><br>
<span class="lineno"></span><span class="keyword" id="3675490">func</span>&nbsp;<span class="ident" id="3675495">LinkBareFunc</span><span class="op" id="3675507">(</span><span class="ident" id="3675508">f</span>&nbsp;<span class="op" id="3675510">*</span><span class="ident" id="3675511">Func</span><span class="op" id="3675515">)</span>&nbsp;<span class="op" id="3675517">(</span><span class="op" id="3675518">[</span><span class="op" id="3675519">]</span><span class="builtintype" id="3675520">byte</span><span class="op" id="3675524">,</span>&nbsp;<span class="builtintype" id="3675526">error</span><span class="op" id="3675531">)</span>&nbsp;<span class="op" id="3675533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3675536">if</span>&nbsp;<span class="ident" id="3675539">f</span><span class="op" id="3675540">.</span><span class="ident" id="3675541">TooLarge</span><span class="op" id="3675549">(</span><span class="op" id="3675550">)</span>&nbsp;<span class="op" id="3675552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3675556">return</span>&nbsp;<span class="ident" id="3675563">nil</span><span class="op" id="3675566">,</span>&nbsp;<span class="ident" id="3675568">fmt</span><span class="op" id="3675571">.</span><span class="ident" id="3675572">Errorf</span><span class="op" id="3675578">(</span><span class="string" id="3675579">&#34;code&nbsp;section&nbsp;too&nbsp;large&#34;</span><span class="op" id="3675603">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3675606">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3675610">w</span>&nbsp;<span class="op" id="3675612">:=</span>&nbsp;<span class="ident" id="3675615">newWriter</span><span class="op" id="3675624">(</span><span class="op" id="3675625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3675628">w</span><span class="op" id="3675629">.</span><span class="ident" id="3675630">writeBareFunc</span><span class="op" id="3675643">(</span><span class="ident" id="3675644">f</span><span class="op" id="3675645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3675648">return</span>&nbsp;<span class="ident" id="3675655">w</span><span class="op" id="3675656">.</span><span class="ident" id="3675657">bytes</span><span class="op" id="3675662">(</span><span class="op" id="3675663">)</span><span class="op" id="3675664">,</span>&nbsp;<span class="ident" id="3675666">nil</span><br>
<span class="lineno">45</span><span class="op" id="3675670">}</span>
</div>
</body>
</html>
