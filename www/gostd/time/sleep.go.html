<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>time</h2>
<ul>
<li><a href="/gostd/time/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/time/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/time/format.go.html">format.go</a></li>
<li><a href="/gostd/time/format_test.go.html">format_test.go</a></li>
<li><a href="/gostd/time/internal_test.go.html">internal_test.go</a></li>
<li><a href="/gostd/time/sleep.go.html" class="current">sleep.go</a></li>
<li><a href="/gostd/time/sleep_test.go.html">sleep_test.go</a></li>
<li><a href="/gostd/time/sys_unix.go.html">sys_unix.go</a></li>
<li><a href="/gostd/time/tick.go.html">tick.go</a></li>
<li><a href="/gostd/time/tick_test.go.html">tick_test.go</a></li>
<li><a href="/gostd/time/time.go.html">time.go</a></li>
<li><a href="/gostd/time/time_test.go.html">time_test.go</a></li>
<li><a href="/gostd/time/zoneinfo.go.html">zoneinfo.go</a></li>
<li><a href="/gostd/time/zoneinfo_read.go.html">zoneinfo_read.go</a></li>
<li><a href="/gostd/time/zoneinfo_test.go.html">zoneinfo_test.go</a></li>
<li><a href="/gostd/time/zoneinfo_unix.go.html">zoneinfo_unix.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2770771">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2770826">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2770880">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2770931">package</span>&nbsp;<span class="ident" id="2770939">time</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2770945">//&nbsp;Sleep&nbsp;pauses&nbsp;the&nbsp;current&nbsp;goroutine&nbsp;for&nbsp;at&nbsp;least&nbsp;the&nbsp;duration&nbsp;d.</span><br>
<span class="lineno"></span><span class="comment" id="2771012">//&nbsp;A&nbsp;negative&nbsp;or&nbsp;zero&nbsp;duration&nbsp;causes&nbsp;Sleep&nbsp;to&nbsp;return&nbsp;immediately.</span><br>
<span class="lineno"></span><span class="keyword" id="2771079">func</span>&nbsp;<span class="ident" id="2771084">Sleep</span><span class="op" id="2771089">(</span><span class="ident" id="2771090">d</span>&nbsp;<span class="ident" id="2771092">Duration</span><span class="op" id="2771100">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="2771103">//&nbsp;runtimeNano&nbsp;returns&nbsp;the&nbsp;current&nbsp;value&nbsp;of&nbsp;the&nbsp;runtime&nbsp;clock&nbsp;in&nbsp;nanoseconds.</span><br>
<span class="lineno"></span><span class="keyword" id="2771181">func</span>&nbsp;<span class="ident" id="2771186">runtimeNano</span><span class="op" id="2771197">(</span><span class="op" id="2771198">)</span>&nbsp;<span class="ident" id="2771200">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2771207">//&nbsp;Interface&nbsp;to&nbsp;timers&nbsp;implemented&nbsp;in&nbsp;package&nbsp;runtime.</span><br>
<span class="lineno">15</span><span class="comment" id="2771262">//&nbsp;Must&nbsp;be&nbsp;in&nbsp;sync&nbsp;with&nbsp;../runtime/runtime.h:/^struct.Timer$</span><br>
<span class="lineno"></span><span class="keyword" id="2771323">type</span>&nbsp;<span class="ident" id="2771328">runtimeTimer</span>&nbsp;<span class="keyword" id="2771341">struct</span>&nbsp;<span class="op" id="2771348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2771351">i</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2771358">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2771363">when</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="2771370">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2771377">period</span>&nbsp;<span class="ident" id="2771384">int64</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2771391">f</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2771398">func</span><span class="op" id="2771402">(</span><span class="keyword" id="2771403">interface</span><span class="op" id="2771412">{</span><span class="op" id="2771413">}</span><span class="op" id="2771414">,</span>&nbsp;<span class="builtintype" id="2771416">uintptr</span><span class="op" id="2771423">)</span>&nbsp;<span class="comment" id="2771425">//&nbsp;NOTE:&nbsp;must&nbsp;not&nbsp;be&nbsp;closure</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2771455">arg</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2771462">interface</span><span class="op" id="2771471">{</span><span class="op" id="2771472">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2771475">seq</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2771482">uintptr</span><br>
<span class="lineno"></span><span class="op" id="2771490">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="2771493">//&nbsp;when&nbsp;is&nbsp;a&nbsp;helper&nbsp;function&nbsp;for&nbsp;setting&nbsp;the&nbsp;&#39;when&#39;&nbsp;field&nbsp;of&nbsp;a&nbsp;runtimeTimer.</span><br>
<span class="lineno"></span><span class="comment" id="2771570">//&nbsp;It&nbsp;returns&nbsp;what&nbsp;the&nbsp;time&nbsp;will&nbsp;be,&nbsp;in&nbsp;nanoseconds,&nbsp;Duration&nbsp;d&nbsp;in&nbsp;the&nbsp;future.</span><br>
<span class="lineno"></span><span class="comment" id="2771649">//&nbsp;If&nbsp;d&nbsp;is&nbsp;negative,&nbsp;it&nbsp;is&nbsp;ignored.&nbsp;&nbsp;If&nbsp;the&nbsp;returned&nbsp;value&nbsp;would&nbsp;be&nbsp;less&nbsp;than</span><br>
<span class="lineno"></span><span class="comment" id="2771727">//&nbsp;zero&nbsp;because&nbsp;of&nbsp;an&nbsp;overflow,&nbsp;MaxInt64&nbsp;is&nbsp;returned.</span><br>
<span class="lineno"></span><span class="keyword" id="2771781">func</span>&nbsp;<span class="ident" id="2771786">when</span><span class="op" id="2771790">(</span><span class="ident" id="2771791">d</span>&nbsp;<span class="ident" id="2771793">Duration</span><span class="op" id="2771801">)</span>&nbsp;<span class="ident" id="2771803">int64</span>&nbsp;<span class="op" id="2771809">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2771812">if</span>&nbsp;<span class="ident" id="2771815">d</span>&nbsp;<span class="op" id="2771817">&lt;=</span>&nbsp;<span class="num" id="2771820">0</span>&nbsp;<span class="op" id="2771822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2771826">return</span>&nbsp;<span class="ident" id="2771833">runtimeNano</span><span class="op" id="2771844">(</span><span class="op" id="2771845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2771848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2771851">t</span>&nbsp;<span class="op" id="2771853">:=</span>&nbsp;<span class="ident" id="2771856">runtimeNano</span><span class="op" id="2771867">(</span><span class="op" id="2771868">)</span>&nbsp;<span class="op" id="2771870">+</span>&nbsp;<span class="ident" id="2771872">int64</span><span class="op" id="2771877">(</span><span class="ident" id="2771878">d</span><span class="op" id="2771879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2771882">if</span>&nbsp;<span class="ident" id="2771885">t</span>&nbsp;<span class="op" id="2771887">&lt;</span>&nbsp;<span class="num" id="2771889">0</span>&nbsp;<span class="op" id="2771891">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2771895">t</span>&nbsp;<span class="op" id="2771897">=</span>&nbsp;<span class="num" id="2771899">1</span><span class="op" id="2771900">&lt;&lt;</span><span class="num" id="2771902">63</span>&nbsp;<span class="op" id="2771905">-</span>&nbsp;<span class="num" id="2771907">1</span>&nbsp;<span class="comment" id="2771909">//&nbsp;math.MaxInt64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2771927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2771930">return</span>&nbsp;<span class="ident" id="2771937">t</span><br>
<span class="lineno"></span><span class="op" id="2771939">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="2771942">func</span>&nbsp;<span class="ident" id="2771947">startTimer</span><span class="op" id="2771957">(</span><span class="op" id="2771958">*</span><span class="ident" id="2771959">runtimeTimer</span><span class="op" id="2771971">)</span><br>
<span class="lineno"></span><span class="keyword" id="2771973">func</span>&nbsp;<span class="ident" id="2771978">stopTimer</span><span class="op" id="2771987">(</span><span class="op" id="2771988">*</span><span class="ident" id="2771989">runtimeTimer</span><span class="op" id="2772001">)</span>&nbsp;<span class="builtintype" id="2772003">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2772009">//&nbsp;The&nbsp;Timer&nbsp;type&nbsp;represents&nbsp;a&nbsp;single&nbsp;event.</span><br>
<span class="lineno"></span><span class="comment" id="2772054">//&nbsp;When&nbsp;the&nbsp;Timer&nbsp;expires,&nbsp;the&nbsp;current&nbsp;time&nbsp;will&nbsp;be&nbsp;sent&nbsp;on&nbsp;C,</span><br>
<span class="lineno">45</span><span class="comment" id="2772117">//&nbsp;unless&nbsp;the&nbsp;Timer&nbsp;was&nbsp;created&nbsp;by&nbsp;AfterFunc.</span><br>
<span class="lineno"></span><span class="comment" id="2772163">//&nbsp;A&nbsp;Timer&nbsp;must&nbsp;be&nbsp;created&nbsp;with&nbsp;NewTimer&nbsp;or&nbsp;AfterFunc.</span><br>
<span class="lineno"></span><span class="keyword" id="2772218">type</span>&nbsp;<span class="ident" id="2772223">Timer</span>&nbsp;<span class="keyword" id="2772229">struct</span>&nbsp;<span class="op" id="2772236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2772239">C</span>&nbsp;<span class="op" id="2772241">&lt;-</span><span class="keyword" id="2772243">chan</span>&nbsp;<span class="ident" id="2772248">Time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2772254">r</span>&nbsp;<span class="ident" id="2772256">runtimeTimer</span><br>
<span class="lineno">50</span><span class="op" id="2772269">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2772272">//&nbsp;Stop&nbsp;prevents&nbsp;the&nbsp;Timer&nbsp;from&nbsp;firing.</span><br>
<span class="lineno"></span><span class="comment" id="2772312">//&nbsp;It&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;call&nbsp;stops&nbsp;the&nbsp;timer,&nbsp;false&nbsp;if&nbsp;the&nbsp;timer&nbsp;has&nbsp;already</span><br>
<span class="lineno"></span><span class="comment" id="2772391">//&nbsp;expired&nbsp;or&nbsp;been&nbsp;stopped.</span><br>
<span class="lineno">55</span><span class="comment" id="2772419">//&nbsp;Stop&nbsp;does&nbsp;not&nbsp;close&nbsp;the&nbsp;channel,&nbsp;to&nbsp;prevent&nbsp;a&nbsp;read&nbsp;from&nbsp;the&nbsp;channel&nbsp;succeeding</span><br>
<span class="lineno"></span><span class="comment" id="2772501">//&nbsp;incorrectly.</span><br>
<span class="lineno"></span><span class="keyword" id="2772517">func</span>&nbsp;<span class="op" id="2772522">(</span><span class="ident" id="2772523">t</span>&nbsp;<span class="op" id="2772525">*</span><span class="ident" id="2772526">Timer</span><span class="op" id="2772531">)</span>&nbsp;<span class="ident" id="2772533">Stop</span><span class="op" id="2772537">(</span><span class="op" id="2772538">)</span>&nbsp;<span class="builtintype" id="2772540">bool</span>&nbsp;<span class="op" id="2772545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2772548">if</span>&nbsp;<span class="ident" id="2772551">t</span><span class="op" id="2772552">.</span><span class="ident" id="2772553">r</span><span class="op" id="2772554">.</span><span class="ident" id="2772555">f</span>&nbsp;<span class="op" id="2772557">==</span>&nbsp;<span class="ident" id="2772560">nil</span>&nbsp;<span class="op" id="2772564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2772568">panic</span><span class="op" id="2772573">(</span><span class="string" id="2772574">&#34;time:&nbsp;Stop&nbsp;called&nbsp;on&nbsp;uninitialized&nbsp;Timer&#34;</span><span class="op" id="2772616">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2772619">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2772622">return</span>&nbsp;<span class="ident" id="2772629">stopTimer</span><span class="op" id="2772638">(</span><span class="op" id="2772639">&amp;</span><span class="ident" id="2772640">t</span><span class="op" id="2772641">.</span><span class="ident" id="2772642">r</span><span class="op" id="2772643">)</span><br>
<span class="lineno"></span><span class="op" id="2772645">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2772648">//&nbsp;NewTimer&nbsp;creates&nbsp;a&nbsp;new&nbsp;Timer&nbsp;that&nbsp;will&nbsp;send</span><br>
<span class="lineno">65</span><span class="comment" id="2772695">//&nbsp;the&nbsp;current&nbsp;time&nbsp;on&nbsp;its&nbsp;channel&nbsp;after&nbsp;at&nbsp;least&nbsp;duration&nbsp;d.</span><br>
<span class="lineno"></span><span class="keyword" id="2772757">func</span>&nbsp;<span class="ident" id="2772762">NewTimer</span><span class="op" id="2772770">(</span><span class="ident" id="2772771">d</span>&nbsp;<span class="ident" id="2772773">Duration</span><span class="op" id="2772781">)</span>&nbsp;<span class="op" id="2772783">*</span><span class="ident" id="2772784">Timer</span>&nbsp;<span class="op" id="2772790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2772793">c</span>&nbsp;<span class="op" id="2772795">:=</span>&nbsp;<span class="builtinfunc" id="2772798">make</span><span class="op" id="2772802">(</span><span class="keyword" id="2772803">chan</span>&nbsp;<span class="ident" id="2772808">Time</span><span class="op" id="2772812">,</span>&nbsp;<span class="num" id="2772814">1</span><span class="op" id="2772815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2772818">t</span>&nbsp;<span class="op" id="2772820">:=</span>&nbsp;<span class="op" id="2772823">&amp;</span><span class="ident" id="2772824">Timer</span><span class="op" id="2772829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2772833">C</span><span class="op" id="2772834">:</span>&nbsp;<span class="ident" id="2772836">c</span><span class="op" id="2772837">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2772841">r</span><span class="op" id="2772842">:</span>&nbsp;<span class="ident" id="2772844">runtimeTimer</span><span class="op" id="2772856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2772861">when</span><span class="op" id="2772865">:</span>&nbsp;<span class="ident" id="2772867">when</span><span class="op" id="2772871">(</span><span class="ident" id="2772872">d</span><span class="op" id="2772873">)</span><span class="op" id="2772874">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2772879">f</span><span class="op" id="2772880">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2772885">sendTime</span><span class="op" id="2772893">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2772898">arg</span><span class="op" id="2772901">:</span>&nbsp;&nbsp;<span class="ident" id="2772904">c</span><span class="op" id="2772905">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2772909">}</span><span class="op" id="2772910">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2772913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2772916">startTimer</span><span class="op" id="2772926">(</span><span class="op" id="2772927">&amp;</span><span class="ident" id="2772928">t</span><span class="op" id="2772929">.</span><span class="ident" id="2772930">r</span><span class="op" id="2772931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2772934">return</span>&nbsp;<span class="ident" id="2772941">t</span><br>
<span class="lineno"></span><span class="op" id="2772943">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="2772946">//&nbsp;Reset&nbsp;changes&nbsp;the&nbsp;timer&nbsp;to&nbsp;expire&nbsp;after&nbsp;duration&nbsp;d.</span><br>
<span class="lineno"></span><span class="comment" id="2773001">//&nbsp;It&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;timer&nbsp;had&nbsp;been&nbsp;active,&nbsp;false&nbsp;if&nbsp;the&nbsp;timer&nbsp;had</span><br>
<span class="lineno"></span><span class="comment" id="2773073">//&nbsp;expired&nbsp;or&nbsp;been&nbsp;stopped.</span><br>
<span class="lineno"></span><span class="keyword" id="2773101">func</span>&nbsp;<span class="op" id="2773106">(</span><span class="ident" id="2773107">t</span>&nbsp;<span class="op" id="2773109">*</span><span class="ident" id="2773110">Timer</span><span class="op" id="2773115">)</span>&nbsp;<span class="ident" id="2773117">Reset</span><span class="op" id="2773122">(</span><span class="ident" id="2773123">d</span>&nbsp;<span class="ident" id="2773125">Duration</span><span class="op" id="2773133">)</span>&nbsp;<span class="builtintype" id="2773135">bool</span>&nbsp;<span class="op" id="2773140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2773143">if</span>&nbsp;<span class="ident" id="2773146">t</span><span class="op" id="2773147">.</span><span class="ident" id="2773148">r</span><span class="op" id="2773149">.</span><span class="ident" id="2773150">f</span>&nbsp;<span class="op" id="2773152">==</span>&nbsp;<span class="ident" id="2773155">nil</span>&nbsp;<span class="op" id="2773159">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2773163">panic</span><span class="op" id="2773168">(</span><span class="string" id="2773169">&#34;time:&nbsp;Reset&nbsp;called&nbsp;on&nbsp;uninitialized&nbsp;Timer&#34;</span><span class="op" id="2773212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2773215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2773218">w</span>&nbsp;<span class="op" id="2773220">:=</span>&nbsp;<span class="ident" id="2773223">when</span><span class="op" id="2773227">(</span><span class="ident" id="2773228">d</span><span class="op" id="2773229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2773232">active</span>&nbsp;<span class="op" id="2773239">:=</span>&nbsp;<span class="ident" id="2773242">stopTimer</span><span class="op" id="2773251">(</span><span class="op" id="2773252">&amp;</span><span class="ident" id="2773253">t</span><span class="op" id="2773254">.</span><span class="ident" id="2773255">r</span><span class="op" id="2773256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2773259">t</span><span class="op" id="2773260">.</span><span class="ident" id="2773261">r</span><span class="op" id="2773262">.</span><span class="ident" id="2773263">when</span>&nbsp;<span class="op" id="2773268">=</span>&nbsp;<span class="ident" id="2773270">w</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2773273">startTimer</span><span class="op" id="2773283">(</span><span class="op" id="2773284">&amp;</span><span class="ident" id="2773285">t</span><span class="op" id="2773286">.</span><span class="ident" id="2773287">r</span><span class="op" id="2773288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2773291">return</span>&nbsp;<span class="ident" id="2773298">active</span><br>
<span class="lineno"></span><span class="op" id="2773305">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2773308">func</span>&nbsp;<span class="ident" id="2773313">sendTime</span><span class="op" id="2773321">(</span><span class="ident" id="2773322">c</span>&nbsp;<span class="keyword" id="2773324">interface</span><span class="op" id="2773333">{</span><span class="op" id="2773334">}</span><span class="op" id="2773335">,</span>&nbsp;<span class="ident" id="2773337">seq</span>&nbsp;<span class="builtintype" id="2773341">uintptr</span><span class="op" id="2773348">)</span>&nbsp;<span class="op" id="2773350">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2773353">//&nbsp;Non-blocking&nbsp;send&nbsp;of&nbsp;time&nbsp;on&nbsp;c.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2773389">//&nbsp;Used&nbsp;in&nbsp;NewTimer,&nbsp;it&nbsp;cannot&nbsp;block&nbsp;anyway&nbsp;(buffer).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2773444">//&nbsp;Used&nbsp;in&nbsp;NewTicker,&nbsp;dropping&nbsp;sends&nbsp;on&nbsp;the&nbsp;floor&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2773498">//&nbsp;the&nbsp;desired&nbsp;behavior&nbsp;when&nbsp;the&nbsp;reader&nbsp;gets&nbsp;behind,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2773552">//&nbsp;because&nbsp;the&nbsp;sends&nbsp;are&nbsp;periodic.</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2773588">select</span>&nbsp;<span class="op" id="2773595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2773598">case</span>&nbsp;<span class="ident" id="2773603">c</span><span class="op" id="2773604">.</span><span class="op" id="2773605">(</span><span class="keyword" id="2773606">chan</span>&nbsp;<span class="ident" id="2773611">Time</span><span class="op" id="2773615">)</span>&nbsp;<span class="op" id="2773617">&lt;-</span>&nbsp;<span class="ident" id="2773620">Now</span><span class="op" id="2773623">(</span><span class="op" id="2773624">)</span><span class="op" id="2773625">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2773628">default</span><span class="op" id="2773635">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2773638">}</span><br>
<span class="lineno"></span><span class="op" id="2773640">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="comment" id="2773643">//&nbsp;After&nbsp;waits&nbsp;for&nbsp;the&nbsp;duration&nbsp;to&nbsp;elapse&nbsp;and&nbsp;then&nbsp;sends&nbsp;the&nbsp;current&nbsp;time</span><br>
<span class="lineno"></span><span class="comment" id="2773717">//&nbsp;on&nbsp;the&nbsp;returned&nbsp;channel.</span><br>
<span class="lineno"></span><span class="comment" id="2773745">//&nbsp;It&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;NewTimer(d).C.</span><br>
<span class="lineno"></span><span class="keyword" id="2773783">func</span>&nbsp;<span class="ident" id="2773788">After</span><span class="op" id="2773793">(</span><span class="ident" id="2773794">d</span>&nbsp;<span class="ident" id="2773796">Duration</span><span class="op" id="2773804">)</span>&nbsp;<span class="op" id="2773806">&lt;-</span><span class="keyword" id="2773808">chan</span>&nbsp;<span class="ident" id="2773813">Time</span>&nbsp;<span class="op" id="2773818">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2773821">return</span>&nbsp;<span class="ident" id="2773828">NewTimer</span><span class="op" id="2773836">(</span><span class="ident" id="2773837">d</span><span class="op" id="2773838">)</span><span class="op" id="2773839">.</span><span class="ident" id="2773840">C</span><br>
<span class="lineno"></span><span class="op" id="2773842">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2773845">//&nbsp;AfterFunc&nbsp;waits&nbsp;for&nbsp;the&nbsp;duration&nbsp;to&nbsp;elapse&nbsp;and&nbsp;then&nbsp;calls&nbsp;f</span><br>
<span class="lineno"></span><span class="comment" id="2773908">//&nbsp;in&nbsp;its&nbsp;own&nbsp;goroutine.&nbsp;It&nbsp;returns&nbsp;a&nbsp;Timer&nbsp;that&nbsp;can</span><br>
<span class="lineno">115</span><span class="comment" id="2773961">//&nbsp;be&nbsp;used&nbsp;to&nbsp;cancel&nbsp;the&nbsp;call&nbsp;using&nbsp;its&nbsp;Stop&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="2774014">func</span>&nbsp;<span class="ident" id="2774019">AfterFunc</span><span class="op" id="2774028">(</span><span class="ident" id="2774029">d</span>&nbsp;<span class="ident" id="2774031">Duration</span><span class="op" id="2774039">,</span>&nbsp;<span class="ident" id="2774041">f</span>&nbsp;<span class="keyword" id="2774043">func</span><span class="op" id="2774047">(</span><span class="op" id="2774048">)</span><span class="op" id="2774049">)</span>&nbsp;<span class="op" id="2774051">*</span><span class="ident" id="2774052">Timer</span>&nbsp;<span class="op" id="2774058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2774061">t</span>&nbsp;<span class="op" id="2774063">:=</span>&nbsp;<span class="op" id="2774066">&amp;</span><span class="ident" id="2774067">Timer</span><span class="op" id="2774072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2774076">r</span><span class="op" id="2774077">:</span>&nbsp;<span class="ident" id="2774079">runtimeTimer</span><span class="op" id="2774091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2774096">when</span><span class="op" id="2774100">:</span>&nbsp;<span class="ident" id="2774102">when</span><span class="op" id="2774106">(</span><span class="ident" id="2774107">d</span><span class="op" id="2774108">)</span><span class="op" id="2774109">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2774114">f</span><span class="op" id="2774115">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2774120">goFunc</span><span class="op" id="2774126">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2774131">arg</span><span class="op" id="2774134">:</span>&nbsp;&nbsp;<span class="ident" id="2774137">f</span><span class="op" id="2774138">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2774142">}</span><span class="op" id="2774143">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2774146">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2774149">startTimer</span><span class="op" id="2774159">(</span><span class="op" id="2774160">&amp;</span><span class="ident" id="2774161">t</span><span class="op" id="2774162">.</span><span class="ident" id="2774163">r</span><span class="op" id="2774164">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2774167">return</span>&nbsp;<span class="ident" id="2774174">t</span><br>
<span class="lineno"></span><span class="op" id="2774176">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2774179">func</span>&nbsp;<span class="ident" id="2774184">goFunc</span><span class="op" id="2774190">(</span><span class="ident" id="2774191">arg</span>&nbsp;<span class="keyword" id="2774195">interface</span><span class="op" id="2774204">{</span><span class="op" id="2774205">}</span><span class="op" id="2774206">,</span>&nbsp;<span class="ident" id="2774208">seq</span>&nbsp;<span class="builtintype" id="2774212">uintptr</span><span class="op" id="2774219">)</span>&nbsp;<span class="op" id="2774221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2774224">go</span>&nbsp;<span class="ident" id="2774227">arg</span><span class="op" id="2774230">.</span><span class="op" id="2774231">(</span><span class="keyword" id="2774232">func</span><span class="op" id="2774236">(</span><span class="op" id="2774237">)</span><span class="op" id="2774238">)</span><span class="op" id="2774239">(</span><span class="op" id="2774240">)</span><br>
<span class="lineno">130</span><span class="op" id="2774242">}</span>
</div>
</body>
</html>
