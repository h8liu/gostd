<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/gif</h2>
<ul>
<li><a href="/gostd/image/gif/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/gif/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/gif/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/gif/writer_test.go.html" class="current">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8530294">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8530349">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8530403">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8530454">package</span>&nbsp;<span class="ident" id="8530462">gif</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8530467">import</span>&nbsp;<span class="op" id="8530474">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8530477">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8530486">&#34;image&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8530495">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8530510">_</span>&nbsp;<span class="string" id="8530512">&#34;image/png&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8530525">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8530538">&#34;math/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8530551">&#34;os&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8530557">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8530567">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8530570">func</span>&nbsp;<span class="ident" id="8530575">readImg</span><span class="op" id="8530582">(</span><span class="ident" id="8530583">filename</span>&nbsp;<span class="builtintype" id="8530592">string</span><span class="op" id="8530598">)</span>&nbsp;<span class="op" id="8530600">(</span><span class="ident" id="8530601">image</span><span class="op" id="8530606">.</span><span class="ident" id="8530607">Image</span><span class="op" id="8530612">,</span>&nbsp;<span class="builtintype" id="8530614">error</span><span class="op" id="8530619">)</span>&nbsp;<span class="op" id="8530621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8530624">f</span><span class="op" id="8530625">,</span>&nbsp;<span class="ident" id="8530627">err</span>&nbsp;<span class="op" id="8530631">:=</span>&nbsp;<span class="ident" id="8530634">os</span><span class="op" id="8530636">.</span><span class="ident" id="8530637">Open</span><span class="op" id="8530641">(</span><span class="ident" id="8530642">filename</span><span class="op" id="8530650">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8530653">if</span>&nbsp;<span class="ident" id="8530656">err</span>&nbsp;<span class="op" id="8530660">!=</span>&nbsp;<span class="ident" id="8530663">nil</span>&nbsp;<span class="op" id="8530667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8530671">return</span>&nbsp;<span class="ident" id="8530678">nil</span><span class="op" id="8530681">,</span>&nbsp;<span class="ident" id="8530683">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8530688">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8530691">defer</span>&nbsp;<span class="ident" id="8530697">f</span><span class="op" id="8530698">.</span><span class="ident" id="8530699">Close</span><span class="op" id="8530704">(</span><span class="op" id="8530705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8530708">m</span><span class="op" id="8530709">,</span>&nbsp;<span class="ident" id="8530711">_</span><span class="op" id="8530712">,</span>&nbsp;<span class="ident" id="8530714">err</span>&nbsp;<span class="op" id="8530718">:=</span>&nbsp;<span class="ident" id="8530721">image</span><span class="op" id="8530726">.</span><span class="ident" id="8530727">Decode</span><span class="op" id="8530733">(</span><span class="ident" id="8530734">f</span><span class="op" id="8530735">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8530738">return</span>&nbsp;<span class="ident" id="8530745">m</span><span class="op" id="8530746">,</span>&nbsp;<span class="ident" id="8530748">err</span><br>
<span class="lineno"></span><span class="op" id="8530752">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8530755">func</span>&nbsp;<span class="ident" id="8530760">readGIF</span><span class="op" id="8530767">(</span><span class="ident" id="8530768">filename</span>&nbsp;<span class="builtintype" id="8530777">string</span><span class="op" id="8530783">)</span>&nbsp;<span class="op" id="8530785">(</span><span class="op" id="8530786">*</span><span class="ident" id="8530787">GIF</span><span class="op" id="8530790">,</span>&nbsp;<span class="builtintype" id="8530792">error</span><span class="op" id="8530797">)</span>&nbsp;<span class="op" id="8530799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8530802">f</span><span class="op" id="8530803">,</span>&nbsp;<span class="ident" id="8530805">err</span>&nbsp;<span class="op" id="8530809">:=</span>&nbsp;<span class="ident" id="8530812">os</span><span class="op" id="8530814">.</span><span class="ident" id="8530815">Open</span><span class="op" id="8530819">(</span><span class="ident" id="8530820">filename</span><span class="op" id="8530828">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8530831">if</span>&nbsp;<span class="ident" id="8530834">err</span>&nbsp;<span class="op" id="8530838">!=</span>&nbsp;<span class="ident" id="8530841">nil</span>&nbsp;<span class="op" id="8530845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8530849">return</span>&nbsp;<span class="ident" id="8530856">nil</span><span class="op" id="8530859">,</span>&nbsp;<span class="ident" id="8530861">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8530866">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8530869">defer</span>&nbsp;<span class="ident" id="8530875">f</span><span class="op" id="8530876">.</span><span class="ident" id="8530877">Close</span><span class="op" id="8530882">(</span><span class="op" id="8530883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8530886">return</span>&nbsp;<span class="ident" id="8530893">DecodeAll</span><span class="op" id="8530902">(</span><span class="ident" id="8530903">f</span><span class="op" id="8530904">)</span><br>
<span class="lineno">35</span><span class="op" id="8530906">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8530909">func</span>&nbsp;<span class="ident" id="8530914">delta</span><span class="op" id="8530919">(</span><span class="ident" id="8530920">u0</span><span class="op" id="8530922">,</span>&nbsp;<span class="ident" id="8530924">u1</span>&nbsp;<span class="builtintype" id="8530927">uint32</span><span class="op" id="8530933">)</span>&nbsp;<span class="ident" id="8530935">int64</span>&nbsp;<span class="op" id="8530941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8530944">d</span>&nbsp;<span class="op" id="8530946">:=</span>&nbsp;<span class="ident" id="8530949">int64</span><span class="op" id="8530954">(</span><span class="ident" id="8530955">u0</span><span class="op" id="8530957">)</span>&nbsp;<span class="op" id="8530959">-</span>&nbsp;<span class="ident" id="8530961">int64</span><span class="op" id="8530966">(</span><span class="ident" id="8530967">u1</span><span class="op" id="8530969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8530972">if</span>&nbsp;<span class="ident" id="8530975">d</span>&nbsp;<span class="op" id="8530977">&lt;</span>&nbsp;<span class="num" id="8530979">0</span>&nbsp;<span class="op" id="8530981">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8530985">return</span>&nbsp;<span class="op" id="8530992">-</span><span class="ident" id="8530993">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8530996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8530999">return</span>&nbsp;<span class="ident" id="8531006">d</span><br>
<span class="lineno"></span><span class="op" id="8531008">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="8531011">//&nbsp;averageDelta&nbsp;returns&nbsp;the&nbsp;average&nbsp;delta&nbsp;in&nbsp;RGB&nbsp;space.&nbsp;The&nbsp;two&nbsp;images&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="8531087">//&nbsp;have&nbsp;the&nbsp;same&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="8531112">func</span>&nbsp;<span class="ident" id="8531117">averageDelta</span><span class="op" id="8531129">(</span><span class="ident" id="8531130">m0</span><span class="op" id="8531132">,</span>&nbsp;<span class="ident" id="8531134">m1</span>&nbsp;<span class="ident" id="8531137">image</span><span class="op" id="8531142">.</span><span class="ident" id="8531143">Image</span><span class="op" id="8531148">)</span>&nbsp;<span class="ident" id="8531150">int64</span>&nbsp;<span class="op" id="8531156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8531159">b</span>&nbsp;<span class="op" id="8531161">:=</span>&nbsp;<span class="ident" id="8531164">m0</span><span class="op" id="8531166">.</span><span class="ident" id="8531167">Bounds</span><span class="op" id="8531173">(</span><span class="op" id="8531174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8531177">var</span>&nbsp;<span class="ident" id="8531181">sum</span><span class="op" id="8531184">,</span>&nbsp;<span class="ident" id="8531186">n</span>&nbsp;<span class="ident" id="8531188">int64</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8531195">for</span>&nbsp;<span class="ident" id="8531199">y</span>&nbsp;<span class="op" id="8531201">:=</span>&nbsp;<span class="ident" id="8531204">b</span><span class="op" id="8531205">.</span><span class="ident" id="8531206">Min</span><span class="op" id="8531209">.</span><span class="ident" id="8531210">Y</span><span class="op" id="8531211">;</span>&nbsp;<span class="ident" id="8531213">y</span>&nbsp;<span class="op" id="8531215">&lt;</span>&nbsp;<span class="ident" id="8531217">b</span><span class="op" id="8531218">.</span><span class="ident" id="8531219">Max</span><span class="op" id="8531222">.</span><span class="ident" id="8531223">Y</span><span class="op" id="8531224">;</span>&nbsp;<span class="ident" id="8531226">y</span><span class="op" id="8531227">++</span>&nbsp;<span class="op" id="8531230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8531234">for</span>&nbsp;<span class="ident" id="8531238">x</span>&nbsp;<span class="op" id="8531240">:=</span>&nbsp;<span class="ident" id="8531243">b</span><span class="op" id="8531244">.</span><span class="ident" id="8531245">Min</span><span class="op" id="8531248">.</span><span class="ident" id="8531249">X</span><span class="op" id="8531250">;</span>&nbsp;<span class="ident" id="8531252">x</span>&nbsp;<span class="op" id="8531254">&lt;</span>&nbsp;<span class="ident" id="8531256">b</span><span class="op" id="8531257">.</span><span class="ident" id="8531258">Max</span><span class="op" id="8531261">.</span><span class="ident" id="8531262">X</span><span class="op" id="8531263">;</span>&nbsp;<span class="ident" id="8531265">x</span><span class="op" id="8531266">++</span>&nbsp;<span class="op" id="8531269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8531274">c0</span>&nbsp;<span class="op" id="8531277">:=</span>&nbsp;<span class="ident" id="8531280">m0</span><span class="op" id="8531282">.</span><span class="ident" id="8531283">At</span><span class="op" id="8531285">(</span><span class="ident" id="8531286">x</span><span class="op" id="8531287">,</span>&nbsp;<span class="ident" id="8531289">y</span><span class="op" id="8531290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8531295">c1</span>&nbsp;<span class="op" id="8531298">:=</span>&nbsp;<span class="ident" id="8531301">m1</span><span class="op" id="8531303">.</span><span class="ident" id="8531304">At</span><span class="op" id="8531306">(</span><span class="ident" id="8531307">x</span><span class="op" id="8531308">,</span>&nbsp;<span class="ident" id="8531310">y</span><span class="op" id="8531311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8531316">r0</span><span class="op" id="8531318">,</span>&nbsp;<span class="ident" id="8531320">g0</span><span class="op" id="8531322">,</span>&nbsp;<span class="ident" id="8531324">b0</span><span class="op" id="8531326">,</span>&nbsp;<span class="ident" id="8531328">_</span>&nbsp;<span class="op" id="8531330">:=</span>&nbsp;<span class="ident" id="8531333">c0</span><span class="op" id="8531335">.</span><span class="ident" id="8531336">RGBA</span><span class="op" id="8531340">(</span><span class="op" id="8531341">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8531346">r1</span><span class="op" id="8531348">,</span>&nbsp;<span class="ident" id="8531350">g1</span><span class="op" id="8531352">,</span>&nbsp;<span class="ident" id="8531354">b1</span><span class="op" id="8531356">,</span>&nbsp;<span class="ident" id="8531358">_</span>&nbsp;<span class="op" id="8531360">:=</span>&nbsp;<span class="ident" id="8531363">c1</span><span class="op" id="8531365">.</span><span class="ident" id="8531366">RGBA</span><span class="op" id="8531370">(</span><span class="op" id="8531371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8531376">sum</span>&nbsp;<span class="op" id="8531380">+=</span>&nbsp;<span class="ident" id="8531383">delta</span><span class="op" id="8531388">(</span><span class="ident" id="8531389">r0</span><span class="op" id="8531391">,</span>&nbsp;<span class="ident" id="8531393">r1</span><span class="op" id="8531395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8531400">sum</span>&nbsp;<span class="op" id="8531404">+=</span>&nbsp;<span class="ident" id="8531407">delta</span><span class="op" id="8531412">(</span><span class="ident" id="8531413">g0</span><span class="op" id="8531415">,</span>&nbsp;<span class="ident" id="8531417">g1</span><span class="op" id="8531419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8531424">sum</span>&nbsp;<span class="op" id="8531428">+=</span>&nbsp;<span class="ident" id="8531431">delta</span><span class="op" id="8531436">(</span><span class="ident" id="8531437">b0</span><span class="op" id="8531439">,</span>&nbsp;<span class="ident" id="8531441">b1</span><span class="op" id="8531443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8531448">n</span>&nbsp;<span class="op" id="8531450">+=</span>&nbsp;<span class="num" id="8531453">3</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8531457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8531460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8531463">return</span>&nbsp;<span class="ident" id="8531470">sum</span>&nbsp;<span class="op" id="8531474">/</span>&nbsp;<span class="ident" id="8531476">n</span><br>
<span class="lineno"></span><span class="op" id="8531478">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="keyword" id="8531481">var</span>&nbsp;<span class="ident" id="8531485">testCase</span>&nbsp;<span class="op" id="8531494">=</span>&nbsp;<span class="op" id="8531496">[</span><span class="op" id="8531497">]</span><span class="keyword" id="8531498">struct</span>&nbsp;<span class="op" id="8531505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8531508">filename</span>&nbsp;&nbsp;<span class="builtintype" id="8531518">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8531526">tolerance</span>&nbsp;<span class="ident" id="8531536">int64</span><br>
<span class="lineno"></span><span class="op" id="8531542">}</span><span class="op" id="8531543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8531546">{</span><span class="string" id="8531547">&#34;../testdata/video-001.png&#34;</span><span class="op" id="8531574">,</span>&nbsp;<span class="num" id="8531576">1</span>&nbsp;<span class="op" id="8531578">&lt;&lt;</span>&nbsp;<span class="num" id="8531581">12</span><span class="op" id="8531583">}</span><span class="op" id="8531584">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8531587">{</span><span class="string" id="8531588">&#34;../testdata/video-001.gif&#34;</span><span class="op" id="8531615">,</span>&nbsp;<span class="num" id="8531617">0</span><span class="op" id="8531618">}</span><span class="op" id="8531619">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8531622">{</span><span class="string" id="8531623">&#34;../testdata/video-001.interlaced.gif&#34;</span><span class="op" id="8531661">,</span>&nbsp;<span class="num" id="8531663">0</span><span class="op" id="8531664">}</span><span class="op" id="8531665">,</span><br>
<span class="lineno"></span><span class="op" id="8531667">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8531670">func</span>&nbsp;<span class="ident" id="8531675">TestWriter</span><span class="op" id="8531685">(</span><span class="ident" id="8531686">t</span>&nbsp;<span class="op" id="8531688">*</span><span class="ident" id="8531689">testing</span><span class="op" id="8531696">.</span><span class="ident" id="8531697">T</span><span class="op" id="8531698">)</span>&nbsp;<span class="op" id="8531700">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8531703">for</span>&nbsp;<span class="ident" id="8531707">_</span><span class="op" id="8531708">,</span>&nbsp;<span class="ident" id="8531710">tc</span>&nbsp;<span class="op" id="8531713">:=</span>&nbsp;<span class="keyword" id="8531716">range</span>&nbsp;<span class="ident" id="8531722">testCase</span>&nbsp;<span class="op" id="8531731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8531735">m0</span><span class="op" id="8531737">,</span>&nbsp;<span class="ident" id="8531739">err</span>&nbsp;<span class="op" id="8531743">:=</span>&nbsp;<span class="ident" id="8531746">readImg</span><span class="op" id="8531753">(</span><span class="ident" id="8531754">tc</span><span class="op" id="8531756">.</span><span class="ident" id="8531757">filename</span><span class="op" id="8531765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8531769">if</span>&nbsp;<span class="ident" id="8531772">err</span>&nbsp;<span class="op" id="8531776">!=</span>&nbsp;<span class="ident" id="8531779">nil</span>&nbsp;<span class="op" id="8531783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8531788">t</span><span class="op" id="8531789">.</span><span class="ident" id="8531790">Error</span><span class="op" id="8531795">(</span><span class="ident" id="8531796">tc</span><span class="op" id="8531798">.</span><span class="ident" id="8531799">filename</span><span class="op" id="8531807">,</span>&nbsp;<span class="ident" id="8531809">err</span><span class="op" id="8531812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8531817">continue</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8531828">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8531832">var</span>&nbsp;<span class="ident" id="8531836">buf</span>&nbsp;<span class="ident" id="8531840">bytes</span><span class="op" id="8531845">.</span><span class="ident" id="8531846">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8531855">err</span>&nbsp;<span class="op" id="8531859">=</span>&nbsp;<span class="ident" id="8531861">Encode</span><span class="op" id="8531867">(</span><span class="op" id="8531868">&amp;</span><span class="ident" id="8531869">buf</span><span class="op" id="8531872">,</span>&nbsp;<span class="ident" id="8531874">m0</span><span class="op" id="8531876">,</span>&nbsp;<span class="ident" id="8531878">nil</span><span class="op" id="8531881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8531885">if</span>&nbsp;<span class="ident" id="8531888">err</span>&nbsp;<span class="op" id="8531892">!=</span>&nbsp;<span class="ident" id="8531895">nil</span>&nbsp;<span class="op" id="8531899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8531904">t</span><span class="op" id="8531905">.</span><span class="ident" id="8531906">Error</span><span class="op" id="8531911">(</span><span class="ident" id="8531912">tc</span><span class="op" id="8531914">.</span><span class="ident" id="8531915">filename</span><span class="op" id="8531923">,</span>&nbsp;<span class="ident" id="8531925">err</span><span class="op" id="8531928">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8531933">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8531944">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8531948">m1</span><span class="op" id="8531950">,</span>&nbsp;<span class="ident" id="8531952">err</span>&nbsp;<span class="op" id="8531956">:=</span>&nbsp;<span class="ident" id="8531959">Decode</span><span class="op" id="8531965">(</span><span class="op" id="8531966">&amp;</span><span class="ident" id="8531967">buf</span><span class="op" id="8531970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8531974">if</span>&nbsp;<span class="ident" id="8531977">err</span>&nbsp;<span class="op" id="8531981">!=</span>&nbsp;<span class="ident" id="8531984">nil</span>&nbsp;<span class="op" id="8531988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8531993">t</span><span class="op" id="8531994">.</span><span class="ident" id="8531995">Error</span><span class="op" id="8532000">(</span><span class="ident" id="8532001">tc</span><span class="op" id="8532003">.</span><span class="ident" id="8532004">filename</span><span class="op" id="8532012">,</span>&nbsp;<span class="ident" id="8532014">err</span><span class="op" id="8532017">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8532022">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8532033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8532037">if</span>&nbsp;<span class="ident" id="8532040">m0</span><span class="op" id="8532042">.</span><span class="ident" id="8532043">Bounds</span><span class="op" id="8532049">(</span><span class="op" id="8532050">)</span>&nbsp;<span class="op" id="8532052">!=</span>&nbsp;<span class="ident" id="8532055">m1</span><span class="op" id="8532057">.</span><span class="ident" id="8532058">Bounds</span><span class="op" id="8532064">(</span><span class="op" id="8532065">)</span>&nbsp;<span class="op" id="8532067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8532072">t</span><span class="op" id="8532073">.</span><span class="ident" id="8532074">Errorf</span><span class="op" id="8532080">(</span><span class="string" id="8532081">&#34;%s,&nbsp;bounds&nbsp;differ:&nbsp;%v&nbsp;and&nbsp;%v&#34;</span><span class="op" id="8532111">,</span>&nbsp;<span class="ident" id="8532113">tc</span><span class="op" id="8532115">.</span><span class="ident" id="8532116">filename</span><span class="op" id="8532124">,</span>&nbsp;<span class="ident" id="8532126">m0</span><span class="op" id="8532128">.</span><span class="ident" id="8532129">Bounds</span><span class="op" id="8532135">(</span><span class="op" id="8532136">)</span><span class="op" id="8532137">,</span>&nbsp;<span class="ident" id="8532139">m1</span><span class="op" id="8532141">.</span><span class="ident" id="8532142">Bounds</span><span class="op" id="8532148">(</span><span class="op" id="8532149">)</span><span class="op" id="8532150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8532155">continue</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8532166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8532170">//&nbsp;Compare&nbsp;the&nbsp;average&nbsp;delta&nbsp;to&nbsp;the&nbsp;tolerance&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8532225">avgDelta</span>&nbsp;<span class="op" id="8532234">:=</span>&nbsp;<span class="ident" id="8532237">averageDelta</span><span class="op" id="8532249">(</span><span class="ident" id="8532250">m0</span><span class="op" id="8532252">,</span>&nbsp;<span class="ident" id="8532254">m1</span><span class="op" id="8532256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8532260">if</span>&nbsp;<span class="ident" id="8532263">avgDelta</span>&nbsp;<span class="op" id="8532272">&gt;</span>&nbsp;<span class="ident" id="8532274">tc</span><span class="op" id="8532276">.</span><span class="ident" id="8532277">tolerance</span>&nbsp;<span class="op" id="8532287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8532292">t</span><span class="op" id="8532293">.</span><span class="ident" id="8532294">Errorf</span><span class="op" id="8532300">(</span><span class="string" id="8532301">&#34;%s:&nbsp;average&nbsp;delta&nbsp;is&nbsp;too&nbsp;high.&nbsp;expected:&nbsp;%d,&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8532354">,</span>&nbsp;<span class="ident" id="8532356">tc</span><span class="op" id="8532358">.</span><span class="ident" id="8532359">filename</span><span class="op" id="8532367">,</span>&nbsp;<span class="ident" id="8532369">tc</span><span class="op" id="8532371">.</span><span class="ident" id="8532372">tolerance</span><span class="op" id="8532381">,</span>&nbsp;<span class="ident" id="8532383">avgDelta</span><span class="op" id="8532391">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8532396">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8532407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8532410">}</span><br>
<span class="lineno"></span><span class="op" id="8532412">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="keyword" id="8532415">func</span>&nbsp;<span class="ident" id="8532420">TestSubImage</span><span class="op" id="8532432">(</span><span class="ident" id="8532433">t</span>&nbsp;<span class="op" id="8532435">*</span><span class="ident" id="8532436">testing</span><span class="op" id="8532443">.</span><span class="ident" id="8532444">T</span><span class="op" id="8532445">)</span>&nbsp;<span class="op" id="8532447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8532450">m0</span><span class="op" id="8532452">,</span>&nbsp;<span class="ident" id="8532454">err</span>&nbsp;<span class="op" id="8532458">:=</span>&nbsp;<span class="ident" id="8532461">readImg</span><span class="op" id="8532468">(</span><span class="string" id="8532469">&#34;../testdata/video-001.gif&#34;</span><span class="op" id="8532496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8532499">if</span>&nbsp;<span class="ident" id="8532502">err</span>&nbsp;<span class="op" id="8532506">!=</span>&nbsp;<span class="ident" id="8532509">nil</span>&nbsp;<span class="op" id="8532513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8532517">t</span><span class="op" id="8532518">.</span><span class="ident" id="8532519">Fatalf</span><span class="op" id="8532525">(</span><span class="string" id="8532526">&#34;readImg:&nbsp;%v&#34;</span><span class="op" id="8532539">,</span>&nbsp;<span class="ident" id="8532541">err</span><span class="op" id="8532544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8532547">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8532550">m0</span>&nbsp;<span class="op" id="8532553">=</span>&nbsp;<span class="ident" id="8532555">m0</span><span class="op" id="8532557">.</span><span class="op" id="8532558">(</span><span class="op" id="8532559">*</span><span class="ident" id="8532560">image</span><span class="op" id="8532565">.</span><span class="ident" id="8532566">Paletted</span><span class="op" id="8532574">)</span><span class="op" id="8532575">.</span><span class="ident" id="8532576">SubImage</span><span class="op" id="8532584">(</span><span class="ident" id="8532585">image</span><span class="op" id="8532590">.</span><span class="ident" id="8532591">Rect</span><span class="op" id="8532595">(</span><span class="num" id="8532596">0</span><span class="op" id="8532597">,</span>&nbsp;<span class="num" id="8532599">0</span><span class="op" id="8532600">,</span>&nbsp;<span class="num" id="8532602">50</span><span class="op" id="8532604">,</span>&nbsp;<span class="num" id="8532606">30</span><span class="op" id="8532608">)</span><span class="op" id="8532609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8532612">var</span>&nbsp;<span class="ident" id="8532616">buf</span>&nbsp;<span class="ident" id="8532620">bytes</span><span class="op" id="8532625">.</span><span class="ident" id="8532626">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8532634">err</span>&nbsp;<span class="op" id="8532638">=</span>&nbsp;<span class="ident" id="8532640">Encode</span><span class="op" id="8532646">(</span><span class="op" id="8532647">&amp;</span><span class="ident" id="8532648">buf</span><span class="op" id="8532651">,</span>&nbsp;<span class="ident" id="8532653">m0</span><span class="op" id="8532655">,</span>&nbsp;<span class="ident" id="8532657">nil</span><span class="op" id="8532660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8532663">if</span>&nbsp;<span class="ident" id="8532666">err</span>&nbsp;<span class="op" id="8532670">!=</span>&nbsp;<span class="ident" id="8532673">nil</span>&nbsp;<span class="op" id="8532677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8532681">t</span><span class="op" id="8532682">.</span><span class="ident" id="8532683">Fatalf</span><span class="op" id="8532689">(</span><span class="string" id="8532690">&#34;Encode:&nbsp;%v&#34;</span><span class="op" id="8532702">,</span>&nbsp;<span class="ident" id="8532704">err</span><span class="op" id="8532707">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8532710">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8532713">m1</span><span class="op" id="8532715">,</span>&nbsp;<span class="ident" id="8532717">err</span>&nbsp;<span class="op" id="8532721">:=</span>&nbsp;<span class="ident" id="8532724">Decode</span><span class="op" id="8532730">(</span><span class="op" id="8532731">&amp;</span><span class="ident" id="8532732">buf</span><span class="op" id="8532735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8532738">if</span>&nbsp;<span class="ident" id="8532741">err</span>&nbsp;<span class="op" id="8532745">!=</span>&nbsp;<span class="ident" id="8532748">nil</span>&nbsp;<span class="op" id="8532752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8532756">t</span><span class="op" id="8532757">.</span><span class="ident" id="8532758">Fatalf</span><span class="op" id="8532764">(</span><span class="string" id="8532765">&#34;Decode:&nbsp;%v&#34;</span><span class="op" id="8532777">,</span>&nbsp;<span class="ident" id="8532779">err</span><span class="op" id="8532782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8532785">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8532788">if</span>&nbsp;<span class="ident" id="8532791">m0</span><span class="op" id="8532793">.</span><span class="ident" id="8532794">Bounds</span><span class="op" id="8532800">(</span><span class="op" id="8532801">)</span>&nbsp;<span class="op" id="8532803">!=</span>&nbsp;<span class="ident" id="8532806">m1</span><span class="op" id="8532808">.</span><span class="ident" id="8532809">Bounds</span><span class="op" id="8532815">(</span><span class="op" id="8532816">)</span>&nbsp;<span class="op" id="8532818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8532822">t</span><span class="op" id="8532823">.</span><span class="ident" id="8532824">Fatalf</span><span class="op" id="8532830">(</span><span class="string" id="8532831">&#34;bounds&nbsp;differ:&nbsp;%v&nbsp;and&nbsp;%v&#34;</span><span class="op" id="8532857">,</span>&nbsp;<span class="ident" id="8532859">m0</span><span class="op" id="8532861">.</span><span class="ident" id="8532862">Bounds</span><span class="op" id="8532868">(</span><span class="op" id="8532869">)</span><span class="op" id="8532870">,</span>&nbsp;<span class="ident" id="8532872">m1</span><span class="op" id="8532874">.</span><span class="ident" id="8532875">Bounds</span><span class="op" id="8532881">(</span><span class="op" id="8532882">)</span><span class="op" id="8532883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8532886">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8532889">if</span>&nbsp;<span class="ident" id="8532892">averageDelta</span><span class="op" id="8532904">(</span><span class="ident" id="8532905">m0</span><span class="op" id="8532907">,</span>&nbsp;<span class="ident" id="8532909">m1</span><span class="op" id="8532911">)</span>&nbsp;<span class="op" id="8532913">!=</span>&nbsp;<span class="num" id="8532916">0</span>&nbsp;<span class="op" id="8532918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8532922">t</span><span class="op" id="8532923">.</span><span class="ident" id="8532924">Fatalf</span><span class="op" id="8532930">(</span><span class="string" id="8532931">&#34;images&nbsp;differ&#34;</span><span class="op" id="8532946">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8532949">}</span><br>
<span class="lineno"></span><span class="op" id="8532951">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8532954">var</span>&nbsp;<span class="ident" id="8532958">frames</span>&nbsp;<span class="op" id="8532965">=</span>&nbsp;<span class="op" id="8532967">[</span><span class="op" id="8532968">]</span><span class="builtintype" id="8532969">string</span><span class="op" id="8532975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8532978">&#34;../testdata/video-001.gif&#34;</span><span class="op" id="8533005">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8533008">&#34;../testdata/video-005.gray.gif&#34;</span><span class="op" id="8533040">,</span><br>
<span class="lineno"></span><span class="op" id="8533042">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8533045">func</span>&nbsp;<span class="ident" id="8533050">TestEncodeAll</span><span class="op" id="8533063">(</span><span class="ident" id="8533064">t</span>&nbsp;<span class="op" id="8533066">*</span><span class="ident" id="8533067">testing</span><span class="op" id="8533074">.</span><span class="ident" id="8533075">T</span><span class="op" id="8533076">)</span>&nbsp;<span class="op" id="8533078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8533081">g0</span>&nbsp;<span class="op" id="8533084">:=</span>&nbsp;<span class="op" id="8533087">&amp;</span><span class="ident" id="8533088">GIF</span><span class="op" id="8533091">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8533095">Image</span><span class="op" id="8533100">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="8533106">make</span><span class="op" id="8533110">(</span><span class="op" id="8533111">[</span><span class="op" id="8533112">]</span><span class="op" id="8533113">*</span><span class="ident" id="8533114">image</span><span class="op" id="8533119">.</span><span class="ident" id="8533120">Paletted</span><span class="op" id="8533128">,</span>&nbsp;<span class="builtinfunc" id="8533130">len</span><span class="op" id="8533133">(</span><span class="ident" id="8533134">frames</span><span class="op" id="8533140">)</span><span class="op" id="8533141">)</span><span class="op" id="8533142">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8533146">Delay</span><span class="op" id="8533151">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="8533157">make</span><span class="op" id="8533161">(</span><span class="op" id="8533162">[</span><span class="op" id="8533163">]</span><span class="builtintype" id="8533164">int</span><span class="op" id="8533167">,</span>&nbsp;<span class="builtinfunc" id="8533169">len</span><span class="op" id="8533172">(</span><span class="ident" id="8533173">frames</span><span class="op" id="8533179">)</span><span class="op" id="8533180">)</span><span class="op" id="8533181">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8533185">LoopCount</span><span class="op" id="8533194">:</span>&nbsp;<span class="num" id="8533196">5</span><span class="op" id="8533197">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8533200">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8533203">for</span>&nbsp;<span class="ident" id="8533207">i</span><span class="op" id="8533208">,</span>&nbsp;<span class="ident" id="8533210">f</span>&nbsp;<span class="op" id="8533212">:=</span>&nbsp;<span class="keyword" id="8533215">range</span>&nbsp;<span class="ident" id="8533221">frames</span>&nbsp;<span class="op" id="8533228">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8533232">m</span><span class="op" id="8533233">,</span>&nbsp;<span class="ident" id="8533235">err</span>&nbsp;<span class="op" id="8533239">:=</span>&nbsp;<span class="ident" id="8533242">readGIF</span><span class="op" id="8533249">(</span><span class="ident" id="8533250">f</span><span class="op" id="8533251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8533255">if</span>&nbsp;<span class="ident" id="8533258">err</span>&nbsp;<span class="op" id="8533262">!=</span>&nbsp;<span class="ident" id="8533265">nil</span>&nbsp;<span class="op" id="8533269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8533274">t</span><span class="op" id="8533275">.</span><span class="ident" id="8533276">Fatal</span><span class="op" id="8533281">(</span><span class="ident" id="8533282">f</span><span class="op" id="8533283">,</span>&nbsp;<span class="ident" id="8533285">err</span><span class="op" id="8533288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8533292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8533296">g0</span><span class="op" id="8533298">.</span><span class="ident" id="8533299">Image</span><span class="op" id="8533304">[</span><span class="ident" id="8533305">i</span><span class="op" id="8533306">]</span>&nbsp;<span class="op" id="8533308">=</span>&nbsp;<span class="ident" id="8533310">m</span><span class="op" id="8533311">.</span><span class="ident" id="8533312">Image</span><span class="op" id="8533317">[</span><span class="num" id="8533318">0</span><span class="op" id="8533319">]</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8533322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8533325">var</span>&nbsp;<span class="ident" id="8533329">buf</span>&nbsp;<span class="ident" id="8533333">bytes</span><span class="op" id="8533338">.</span><span class="ident" id="8533339">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8533347">if</span>&nbsp;<span class="ident" id="8533350">err</span>&nbsp;<span class="op" id="8533354">:=</span>&nbsp;<span class="ident" id="8533357">EncodeAll</span><span class="op" id="8533366">(</span><span class="op" id="8533367">&amp;</span><span class="ident" id="8533368">buf</span><span class="op" id="8533371">,</span>&nbsp;<span class="ident" id="8533373">g0</span><span class="op" id="8533375">)</span><span class="op" id="8533376">;</span>&nbsp;<span class="ident" id="8533378">err</span>&nbsp;<span class="op" id="8533382">!=</span>&nbsp;<span class="ident" id="8533385">nil</span>&nbsp;<span class="op" id="8533389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8533393">t</span><span class="op" id="8533394">.</span><span class="ident" id="8533395">Fatal</span><span class="op" id="8533400">(</span><span class="string" id="8533401">&#34;EncodeAll:&#34;</span><span class="op" id="8533413">,</span>&nbsp;<span class="ident" id="8533415">err</span><span class="op" id="8533418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8533421">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8533424">g1</span><span class="op" id="8533426">,</span>&nbsp;<span class="ident" id="8533428">err</span>&nbsp;<span class="op" id="8533432">:=</span>&nbsp;<span class="ident" id="8533435">DecodeAll</span><span class="op" id="8533444">(</span><span class="op" id="8533445">&amp;</span><span class="ident" id="8533446">buf</span><span class="op" id="8533449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8533452">if</span>&nbsp;<span class="ident" id="8533455">err</span>&nbsp;<span class="op" id="8533459">!=</span>&nbsp;<span class="ident" id="8533462">nil</span>&nbsp;<span class="op" id="8533466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8533470">t</span><span class="op" id="8533471">.</span><span class="ident" id="8533472">Fatal</span><span class="op" id="8533477">(</span><span class="string" id="8533478">&#34;DecodeAll:&#34;</span><span class="op" id="8533490">,</span>&nbsp;<span class="ident" id="8533492">err</span><span class="op" id="8533495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8533498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8533501">if</span>&nbsp;<span class="ident" id="8533504">g0</span><span class="op" id="8533506">.</span><span class="ident" id="8533507">LoopCount</span>&nbsp;<span class="op" id="8533517">!=</span>&nbsp;<span class="ident" id="8533520">g1</span><span class="op" id="8533522">.</span><span class="ident" id="8533523">LoopCount</span>&nbsp;<span class="op" id="8533533">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8533537">t</span><span class="op" id="8533538">.</span><span class="ident" id="8533539">Errorf</span><span class="op" id="8533545">(</span><span class="string" id="8533546">&#34;loop&nbsp;counts&nbsp;differ:&nbsp;%d&nbsp;and&nbsp;%d&#34;</span><span class="op" id="8533577">,</span>&nbsp;<span class="ident" id="8533579">g0</span><span class="op" id="8533581">.</span><span class="ident" id="8533582">LoopCount</span><span class="op" id="8533591">,</span>&nbsp;<span class="ident" id="8533593">g1</span><span class="op" id="8533595">.</span><span class="ident" id="8533596">LoopCount</span><span class="op" id="8533605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8533608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8533611">for</span>&nbsp;<span class="ident" id="8533615">i</span>&nbsp;<span class="op" id="8533617">:=</span>&nbsp;<span class="keyword" id="8533620">range</span>&nbsp;<span class="ident" id="8533626">g0</span><span class="op" id="8533628">.</span><span class="ident" id="8533629">Image</span>&nbsp;<span class="op" id="8533635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8533639">m0</span><span class="op" id="8533641">,</span>&nbsp;<span class="ident" id="8533643">m1</span>&nbsp;<span class="op" id="8533646">:=</span>&nbsp;<span class="ident" id="8533649">g0</span><span class="op" id="8533651">.</span><span class="ident" id="8533652">Image</span><span class="op" id="8533657">[</span><span class="ident" id="8533658">i</span><span class="op" id="8533659">]</span><span class="op" id="8533660">,</span>&nbsp;<span class="ident" id="8533662">g1</span><span class="op" id="8533664">.</span><span class="ident" id="8533665">Image</span><span class="op" id="8533670">[</span><span class="ident" id="8533671">i</span><span class="op" id="8533672">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8533676">if</span>&nbsp;<span class="ident" id="8533679">m0</span><span class="op" id="8533681">.</span><span class="ident" id="8533682">Bounds</span><span class="op" id="8533688">(</span><span class="op" id="8533689">)</span>&nbsp;<span class="op" id="8533691">!=</span>&nbsp;<span class="ident" id="8533694">m1</span><span class="op" id="8533696">.</span><span class="ident" id="8533697">Bounds</span><span class="op" id="8533703">(</span><span class="op" id="8533704">)</span>&nbsp;<span class="op" id="8533706">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8533711">t</span><span class="op" id="8533712">.</span><span class="ident" id="8533713">Errorf</span><span class="op" id="8533719">(</span><span class="string" id="8533720">&#34;%s,&nbsp;bounds&nbsp;differ:&nbsp;%v&nbsp;and&nbsp;%v&#34;</span><span class="op" id="8533750">,</span>&nbsp;<span class="ident" id="8533752">frames</span><span class="op" id="8533758">[</span><span class="ident" id="8533759">i</span><span class="op" id="8533760">]</span><span class="op" id="8533761">,</span>&nbsp;<span class="ident" id="8533763">m0</span><span class="op" id="8533765">.</span><span class="ident" id="8533766">Bounds</span><span class="op" id="8533772">(</span><span class="op" id="8533773">)</span><span class="op" id="8533774">,</span>&nbsp;<span class="ident" id="8533776">m1</span><span class="op" id="8533778">.</span><span class="ident" id="8533779">Bounds</span><span class="op" id="8533785">(</span><span class="op" id="8533786">)</span><span class="op" id="8533787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8533791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8533795">d0</span><span class="op" id="8533797">,</span>&nbsp;<span class="ident" id="8533799">d1</span>&nbsp;<span class="op" id="8533802">:=</span>&nbsp;<span class="ident" id="8533805">g0</span><span class="op" id="8533807">.</span><span class="ident" id="8533808">Delay</span><span class="op" id="8533813">[</span><span class="ident" id="8533814">i</span><span class="op" id="8533815">]</span><span class="op" id="8533816">,</span>&nbsp;<span class="ident" id="8533818">g1</span><span class="op" id="8533820">.</span><span class="ident" id="8533821">Delay</span><span class="op" id="8533826">[</span><span class="ident" id="8533827">i</span><span class="op" id="8533828">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8533832">if</span>&nbsp;<span class="ident" id="8533835">d0</span>&nbsp;<span class="op" id="8533838">!=</span>&nbsp;<span class="ident" id="8533841">d1</span>&nbsp;<span class="op" id="8533844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8533849">t</span><span class="op" id="8533850">.</span><span class="ident" id="8533851">Errorf</span><span class="op" id="8533857">(</span><span class="string" id="8533858">&#34;%s:&nbsp;delay&nbsp;values&nbsp;differ:&nbsp;%d&nbsp;and&nbsp;%d&#34;</span><span class="op" id="8533894">,</span>&nbsp;<span class="ident" id="8533896">frames</span><span class="op" id="8533902">[</span><span class="ident" id="8533903">i</span><span class="op" id="8533904">]</span><span class="op" id="8533905">,</span>&nbsp;<span class="ident" id="8533907">d0</span><span class="op" id="8533909">,</span>&nbsp;<span class="ident" id="8533911">d1</span><span class="op" id="8533913">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8533917">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8533920">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8533924">g1</span><span class="op" id="8533926">.</span><span class="ident" id="8533927">Delay</span>&nbsp;<span class="op" id="8533933">=</span>&nbsp;<span class="builtinfunc" id="8533935">make</span><span class="op" id="8533939">(</span><span class="op" id="8533940">[</span><span class="op" id="8533941">]</span><span class="builtintype" id="8533942">int</span><span class="op" id="8533945">,</span>&nbsp;<span class="num" id="8533947">1</span><span class="op" id="8533948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8533951">if</span>&nbsp;<span class="ident" id="8533954">err</span>&nbsp;<span class="op" id="8533958">:=</span>&nbsp;<span class="ident" id="8533961">EncodeAll</span><span class="op" id="8533970">(</span><span class="ident" id="8533971">ioutil</span><span class="op" id="8533977">.</span><span class="ident" id="8533978">Discard</span><span class="op" id="8533985">,</span>&nbsp;<span class="ident" id="8533987">g1</span><span class="op" id="8533989">)</span><span class="op" id="8533990">;</span>&nbsp;<span class="ident" id="8533992">err</span>&nbsp;<span class="op" id="8533996">==</span>&nbsp;<span class="ident" id="8533999">nil</span>&nbsp;<span class="op" id="8534003">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8534007">t</span><span class="op" id="8534008">.</span><span class="ident" id="8534009">Error</span><span class="op" id="8534014">(</span><span class="string" id="8534015">&#34;expected&nbsp;error&nbsp;from&nbsp;mismatched&nbsp;delay&nbsp;and&nbsp;image&nbsp;slice&nbsp;lengths&#34;</span><span class="op" id="8534077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8534080">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8534083">if</span>&nbsp;<span class="ident" id="8534086">err</span>&nbsp;<span class="op" id="8534090">:=</span>&nbsp;<span class="ident" id="8534093">EncodeAll</span><span class="op" id="8534102">(</span><span class="ident" id="8534103">ioutil</span><span class="op" id="8534109">.</span><span class="ident" id="8534110">Discard</span><span class="op" id="8534117">,</span>&nbsp;<span class="op" id="8534119">&amp;</span><span class="ident" id="8534120">GIF</span><span class="op" id="8534123">{</span><span class="op" id="8534124">}</span><span class="op" id="8534125">)</span><span class="op" id="8534126">;</span>&nbsp;<span class="ident" id="8534128">err</span>&nbsp;<span class="op" id="8534132">==</span>&nbsp;<span class="ident" id="8534135">nil</span>&nbsp;<span class="op" id="8534139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8534143">t</span><span class="op" id="8534144">.</span><span class="ident" id="8534145">Error</span><span class="op" id="8534150">(</span><span class="string" id="8534151">&#34;expected&nbsp;error&nbsp;from&nbsp;providing&nbsp;empty&nbsp;gif&#34;</span><span class="op" id="8534192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8534195">}</span><br>
<span class="lineno">175</span><span class="op" id="8534197">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8534200">func</span>&nbsp;<span class="ident" id="8534205">BenchmarkEncode</span><span class="op" id="8534220">(</span><span class="ident" id="8534221">b</span>&nbsp;<span class="op" id="8534223">*</span><span class="ident" id="8534224">testing</span><span class="op" id="8534231">.</span><span class="ident" id="8534232">B</span><span class="op" id="8534233">)</span>&nbsp;<span class="op" id="8534235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8534238">b</span><span class="op" id="8534239">.</span><span class="ident" id="8534240">StopTimer</span><span class="op" id="8534249">(</span><span class="op" id="8534250">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8534254">bo</span>&nbsp;<span class="op" id="8534257">:=</span>&nbsp;<span class="ident" id="8534260">image</span><span class="op" id="8534265">.</span><span class="ident" id="8534266">Rect</span><span class="op" id="8534270">(</span><span class="num" id="8534271">0</span><span class="op" id="8534272">,</span>&nbsp;<span class="num" id="8534274">0</span><span class="op" id="8534275">,</span>&nbsp;<span class="num" id="8534277">640</span><span class="op" id="8534280">,</span>&nbsp;<span class="num" id="8534282">480</span><span class="op" id="8534285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8534288">rnd</span>&nbsp;<span class="op" id="8534292">:=</span>&nbsp;<span class="ident" id="8534295">rand</span><span class="op" id="8534299">.</span><span class="ident" id="8534300">New</span><span class="op" id="8534303">(</span><span class="ident" id="8534304">rand</span><span class="op" id="8534308">.</span><span class="ident" id="8534309">NewSource</span><span class="op" id="8534318">(</span><span class="num" id="8534319">123</span><span class="op" id="8534322">)</span><span class="op" id="8534323">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8534327">//&nbsp;Restrict&nbsp;to&nbsp;a&nbsp;256-color&nbsp;paletted&nbsp;image&nbsp;to&nbsp;avoid&nbsp;quantization&nbsp;path.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8534398">palette</span>&nbsp;<span class="op" id="8534406">:=</span>&nbsp;<span class="builtinfunc" id="8534409">make</span><span class="op" id="8534413">(</span><span class="ident" id="8534414">color</span><span class="op" id="8534419">.</span><span class="ident" id="8534420">Palette</span><span class="op" id="8534427">,</span>&nbsp;<span class="num" id="8534429">256</span><span class="op" id="8534432">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8534435">for</span>&nbsp;<span class="ident" id="8534439">i</span>&nbsp;<span class="op" id="8534441">:=</span>&nbsp;<span class="keyword" id="8534444">range</span>&nbsp;<span class="ident" id="8534450">palette</span>&nbsp;<span class="op" id="8534458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8534462">palette</span><span class="op" id="8534469">[</span><span class="ident" id="8534470">i</span><span class="op" id="8534471">]</span>&nbsp;<span class="op" id="8534473">=</span>&nbsp;<span class="ident" id="8534475">color</span><span class="op" id="8534480">.</span><span class="ident" id="8534481">RGBA</span><span class="op" id="8534485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8534490">uint8</span><span class="op" id="8534495">(</span><span class="ident" id="8534496">rnd</span><span class="op" id="8534499">.</span><span class="ident" id="8534500">Intn</span><span class="op" id="8534504">(</span><span class="num" id="8534505">256</span><span class="op" id="8534508">)</span><span class="op" id="8534509">)</span><span class="op" id="8534510">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8534515">uint8</span><span class="op" id="8534520">(</span><span class="ident" id="8534521">rnd</span><span class="op" id="8534524">.</span><span class="ident" id="8534525">Intn</span><span class="op" id="8534529">(</span><span class="num" id="8534530">256</span><span class="op" id="8534533">)</span><span class="op" id="8534534">)</span><span class="op" id="8534535">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8534540">uint8</span><span class="op" id="8534545">(</span><span class="ident" id="8534546">rnd</span><span class="op" id="8534549">.</span><span class="ident" id="8534550">Intn</span><span class="op" id="8534554">(</span><span class="num" id="8534555">256</span><span class="op" id="8534558">)</span><span class="op" id="8534559">)</span><span class="op" id="8534560">,</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8534565">255</span><span class="op" id="8534568">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8534572">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8534575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8534578">img</span>&nbsp;<span class="op" id="8534582">:=</span>&nbsp;<span class="ident" id="8534585">image</span><span class="op" id="8534590">.</span><span class="ident" id="8534591">NewPaletted</span><span class="op" id="8534602">(</span><span class="ident" id="8534603">image</span><span class="op" id="8534608">.</span><span class="ident" id="8534609">Rect</span><span class="op" id="8534613">(</span><span class="num" id="8534614">0</span><span class="op" id="8534615">,</span>&nbsp;<span class="num" id="8534617">0</span><span class="op" id="8534618">,</span>&nbsp;<span class="num" id="8534620">640</span><span class="op" id="8534623">,</span>&nbsp;<span class="num" id="8534625">480</span><span class="op" id="8534628">)</span><span class="op" id="8534629">,</span>&nbsp;<span class="ident" id="8534631">palette</span><span class="op" id="8534638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8534641">for</span>&nbsp;<span class="ident" id="8534645">y</span>&nbsp;<span class="op" id="8534647">:=</span>&nbsp;<span class="ident" id="8534650">bo</span><span class="op" id="8534652">.</span><span class="ident" id="8534653">Min</span><span class="op" id="8534656">.</span><span class="ident" id="8534657">Y</span><span class="op" id="8534658">;</span>&nbsp;<span class="ident" id="8534660">y</span>&nbsp;<span class="op" id="8534662">&lt;</span>&nbsp;<span class="ident" id="8534664">bo</span><span class="op" id="8534666">.</span><span class="ident" id="8534667">Max</span><span class="op" id="8534670">.</span><span class="ident" id="8534671">Y</span><span class="op" id="8534672">;</span>&nbsp;<span class="ident" id="8534674">y</span><span class="op" id="8534675">++</span>&nbsp;<span class="op" id="8534678">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8534682">for</span>&nbsp;<span class="ident" id="8534686">x</span>&nbsp;<span class="op" id="8534688">:=</span>&nbsp;<span class="ident" id="8534691">bo</span><span class="op" id="8534693">.</span><span class="ident" id="8534694">Min</span><span class="op" id="8534697">.</span><span class="ident" id="8534698">X</span><span class="op" id="8534699">;</span>&nbsp;<span class="ident" id="8534701">x</span>&nbsp;<span class="op" id="8534703">&lt;</span>&nbsp;<span class="ident" id="8534705">bo</span><span class="op" id="8534707">.</span><span class="ident" id="8534708">Max</span><span class="op" id="8534711">.</span><span class="ident" id="8534712">X</span><span class="op" id="8534713">;</span>&nbsp;<span class="ident" id="8534715">x</span><span class="op" id="8534716">++</span>&nbsp;<span class="op" id="8534719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8534724">img</span><span class="op" id="8534727">.</span><span class="ident" id="8534728">Set</span><span class="op" id="8534731">(</span><span class="ident" id="8534732">x</span><span class="op" id="8534733">,</span>&nbsp;<span class="ident" id="8534735">y</span><span class="op" id="8534736">,</span>&nbsp;<span class="ident" id="8534738">palette</span><span class="op" id="8534745">[</span><span class="ident" id="8534746">rnd</span><span class="op" id="8534749">.</span><span class="ident" id="8534750">Intn</span><span class="op" id="8534754">(</span><span class="num" id="8534755">256</span><span class="op" id="8534758">)</span><span class="op" id="8534759">]</span><span class="op" id="8534760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8534764">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8534767">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8534771">b</span><span class="op" id="8534772">.</span><span class="ident" id="8534773">SetBytes</span><span class="op" id="8534781">(</span><span class="num" id="8534782">640</span>&nbsp;<span class="op" id="8534786">*</span>&nbsp;<span class="num" id="8534788">480</span>&nbsp;<span class="op" id="8534792">*</span>&nbsp;<span class="num" id="8534794">4</span><span class="op" id="8534795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8534798">b</span><span class="op" id="8534799">.</span><span class="ident" id="8534800">StartTimer</span><span class="op" id="8534810">(</span><span class="op" id="8534811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8534814">for</span>&nbsp;<span class="ident" id="8534818">i</span>&nbsp;<span class="op" id="8534820">:=</span>&nbsp;<span class="num" id="8534823">0</span><span class="op" id="8534824">;</span>&nbsp;<span class="ident" id="8534826">i</span>&nbsp;<span class="op" id="8534828">&lt;</span>&nbsp;<span class="ident" id="8534830">b</span><span class="op" id="8534831">.</span><span class="ident" id="8534832">N</span><span class="op" id="8534833">;</span>&nbsp;<span class="ident" id="8534835">i</span><span class="op" id="8534836">++</span>&nbsp;<span class="op" id="8534839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8534843">Encode</span><span class="op" id="8534849">(</span><span class="ident" id="8534850">ioutil</span><span class="op" id="8534856">.</span><span class="ident" id="8534857">Discard</span><span class="op" id="8534864">,</span>&nbsp;<span class="ident" id="8534866">img</span><span class="op" id="8534869">,</span>&nbsp;<span class="ident" id="8534871">nil</span><span class="op" id="8534874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8534877">}</span><br>
<span class="lineno">205</span><span class="op" id="8534879">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8534882">func</span>&nbsp;<span class="ident" id="8534887">BenchmarkQuantizedEncode</span><span class="op" id="8534911">(</span><span class="ident" id="8534912">b</span>&nbsp;<span class="op" id="8534914">*</span><span class="ident" id="8534915">testing</span><span class="op" id="8534922">.</span><span class="ident" id="8534923">B</span><span class="op" id="8534924">)</span>&nbsp;<span class="op" id="8534926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8534929">b</span><span class="op" id="8534930">.</span><span class="ident" id="8534931">StopTimer</span><span class="op" id="8534940">(</span><span class="op" id="8534941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8534944">img</span>&nbsp;<span class="op" id="8534948">:=</span>&nbsp;<span class="ident" id="8534951">image</span><span class="op" id="8534956">.</span><span class="ident" id="8534957">NewRGBA</span><span class="op" id="8534964">(</span><span class="ident" id="8534965">image</span><span class="op" id="8534970">.</span><span class="ident" id="8534971">Rect</span><span class="op" id="8534975">(</span><span class="num" id="8534976">0</span><span class="op" id="8534977">,</span>&nbsp;<span class="num" id="8534979">0</span><span class="op" id="8534980">,</span>&nbsp;<span class="num" id="8534982">640</span><span class="op" id="8534985">,</span>&nbsp;<span class="num" id="8534987">480</span><span class="op" id="8534990">)</span><span class="op" id="8534991">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8534994">bo</span>&nbsp;<span class="op" id="8534997">:=</span>&nbsp;<span class="ident" id="8535000">img</span><span class="op" id="8535003">.</span><span class="ident" id="8535004">Bounds</span><span class="op" id="8535010">(</span><span class="op" id="8535011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8535014">rnd</span>&nbsp;<span class="op" id="8535018">:=</span>&nbsp;<span class="ident" id="8535021">rand</span><span class="op" id="8535025">.</span><span class="ident" id="8535026">New</span><span class="op" id="8535029">(</span><span class="ident" id="8535030">rand</span><span class="op" id="8535034">.</span><span class="ident" id="8535035">NewSource</span><span class="op" id="8535044">(</span><span class="num" id="8535045">123</span><span class="op" id="8535048">)</span><span class="op" id="8535049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8535052">for</span>&nbsp;<span class="ident" id="8535056">y</span>&nbsp;<span class="op" id="8535058">:=</span>&nbsp;<span class="ident" id="8535061">bo</span><span class="op" id="8535063">.</span><span class="ident" id="8535064">Min</span><span class="op" id="8535067">.</span><span class="ident" id="8535068">Y</span><span class="op" id="8535069">;</span>&nbsp;<span class="ident" id="8535071">y</span>&nbsp;<span class="op" id="8535073">&lt;</span>&nbsp;<span class="ident" id="8535075">bo</span><span class="op" id="8535077">.</span><span class="ident" id="8535078">Max</span><span class="op" id="8535081">.</span><span class="ident" id="8535082">Y</span><span class="op" id="8535083">;</span>&nbsp;<span class="ident" id="8535085">y</span><span class="op" id="8535086">++</span>&nbsp;<span class="op" id="8535089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8535093">for</span>&nbsp;<span class="ident" id="8535097">x</span>&nbsp;<span class="op" id="8535099">:=</span>&nbsp;<span class="ident" id="8535102">bo</span><span class="op" id="8535104">.</span><span class="ident" id="8535105">Min</span><span class="op" id="8535108">.</span><span class="ident" id="8535109">X</span><span class="op" id="8535110">;</span>&nbsp;<span class="ident" id="8535112">x</span>&nbsp;<span class="op" id="8535114">&lt;</span>&nbsp;<span class="ident" id="8535116">bo</span><span class="op" id="8535118">.</span><span class="ident" id="8535119">Max</span><span class="op" id="8535122">.</span><span class="ident" id="8535123">X</span><span class="op" id="8535124">;</span>&nbsp;<span class="ident" id="8535126">x</span><span class="op" id="8535127">++</span>&nbsp;<span class="op" id="8535130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8535135">img</span><span class="op" id="8535138">.</span><span class="ident" id="8535139">SetRGBA</span><span class="op" id="8535146">(</span><span class="ident" id="8535147">x</span><span class="op" id="8535148">,</span>&nbsp;<span class="ident" id="8535150">y</span><span class="op" id="8535151">,</span>&nbsp;<span class="ident" id="8535153">color</span><span class="op" id="8535158">.</span><span class="ident" id="8535159">RGBA</span><span class="op" id="8535163">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8535169">uint8</span><span class="op" id="8535174">(</span><span class="ident" id="8535175">rnd</span><span class="op" id="8535178">.</span><span class="ident" id="8535179">Intn</span><span class="op" id="8535183">(</span><span class="num" id="8535184">256</span><span class="op" id="8535187">)</span><span class="op" id="8535188">)</span><span class="op" id="8535189">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8535195">uint8</span><span class="op" id="8535200">(</span><span class="ident" id="8535201">rnd</span><span class="op" id="8535204">.</span><span class="ident" id="8535205">Intn</span><span class="op" id="8535209">(</span><span class="num" id="8535210">256</span><span class="op" id="8535213">)</span><span class="op" id="8535214">)</span><span class="op" id="8535215">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8535221">uint8</span><span class="op" id="8535226">(</span><span class="ident" id="8535227">rnd</span><span class="op" id="8535230">.</span><span class="ident" id="8535231">Intn</span><span class="op" id="8535235">(</span><span class="num" id="8535236">256</span><span class="op" id="8535239">)</span><span class="op" id="8535240">)</span><span class="op" id="8535241">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8535247">255</span><span class="op" id="8535250">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8535255">}</span><span class="op" id="8535256">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8535260">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8535263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8535266">b</span><span class="op" id="8535267">.</span><span class="ident" id="8535268">SetBytes</span><span class="op" id="8535276">(</span><span class="num" id="8535277">640</span>&nbsp;<span class="op" id="8535281">*</span>&nbsp;<span class="num" id="8535283">480</span>&nbsp;<span class="op" id="8535287">*</span>&nbsp;<span class="num" id="8535289">4</span><span class="op" id="8535290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8535293">b</span><span class="op" id="8535294">.</span><span class="ident" id="8535295">StartTimer</span><span class="op" id="8535305">(</span><span class="op" id="8535306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8535309">for</span>&nbsp;<span class="ident" id="8535313">i</span>&nbsp;<span class="op" id="8535315">:=</span>&nbsp;<span class="num" id="8535318">0</span><span class="op" id="8535319">;</span>&nbsp;<span class="ident" id="8535321">i</span>&nbsp;<span class="op" id="8535323">&lt;</span>&nbsp;<span class="ident" id="8535325">b</span><span class="op" id="8535326">.</span><span class="ident" id="8535327">N</span><span class="op" id="8535328">;</span>&nbsp;<span class="ident" id="8535330">i</span><span class="op" id="8535331">++</span>&nbsp;<span class="op" id="8535334">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8535338">Encode</span><span class="op" id="8535344">(</span><span class="ident" id="8535345">ioutil</span><span class="op" id="8535351">.</span><span class="ident" id="8535352">Discard</span><span class="op" id="8535359">,</span>&nbsp;<span class="ident" id="8535361">img</span><span class="op" id="8535364">,</span>&nbsp;<span class="ident" id="8535366">nil</span><span class="op" id="8535369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8535372">}</span><br>
<span class="lineno"></span><span class="op" id="8535374">}</span>
</div>
</body>
</html>
