<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>index/suffixarray</h2>
<ul>
<li><a href="/gostd/index/suffixarray/qsufsort.go.html">qsufsort.go</a></li>
<li><a href="/gostd/index/suffixarray/suffixarray.go.html" class="current">suffixarray.go</a></li>
<li><a href="/gostd/index/suffixarray/suffixarray_test.go.html">suffixarray_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6050088">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6050143">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6050197">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6050248">//&nbsp;Package&nbsp;suffixarray&nbsp;implements&nbsp;substring&nbsp;search&nbsp;in&nbsp;logarithmic&nbsp;time&nbsp;using</span><br>
<span class="lineno"></span><span class="comment" id="6050325">//&nbsp;an&nbsp;in-memory&nbsp;suffix&nbsp;array.</span><br>
<span class="lineno"></span><span class="comment" id="6050355">//</span><br>
<span class="lineno"></span><span class="comment" id="6050358">//&nbsp;Example&nbsp;use:</span><br>
<span class="lineno"></span><span class="comment" id="6050374">//</span><br>
<span class="lineno">10</span><span class="comment" id="6050377">//&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;create&nbsp;index&nbsp;for&nbsp;some&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="6050410">//&nbsp;&nbsp;&nbsp;&nbsp;index&nbsp;:=&nbsp;suffixarray.New(data)</span><br>
<span class="lineno"></span><span class="comment" id="6050444">//</span><br>
<span class="lineno"></span><span class="comment" id="6050447">//&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;lookup&nbsp;byte&nbsp;slice&nbsp;s</span><br>
<span class="lineno"></span><span class="comment" id="6050473">//&nbsp;&nbsp;&nbsp;&nbsp;offsets1&nbsp;:=&nbsp;index.Lookup(s,&nbsp;-1)&nbsp;//&nbsp;the&nbsp;list&nbsp;of&nbsp;all&nbsp;indices&nbsp;where&nbsp;s&nbsp;occurs&nbsp;in&nbsp;data</span><br>
<span class="lineno">15</span><span class="comment" id="6050558">//&nbsp;&nbsp;&nbsp;&nbsp;offsets2&nbsp;:=&nbsp;index.Lookup(s,&nbsp;3)&nbsp;&nbsp;//&nbsp;the&nbsp;list&nbsp;of&nbsp;at&nbsp;most&nbsp;3&nbsp;indices&nbsp;where&nbsp;s&nbsp;occurs&nbsp;in&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="6050649">//</span><br>
<span class="lineno"></span><span class="keyword" id="6050652">package</span>&nbsp;<span class="ident" id="6050660">suffixarray</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6050673">import</span>&nbsp;<span class="op" id="6050680">(</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6050683">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6050692">&#34;encoding/binary&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6050711">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6050717">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6050727">&#34;sort&#34;</span><br>
<span class="lineno">25</span><span class="op" id="6050734">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6050737">//&nbsp;Index&nbsp;implements&nbsp;a&nbsp;suffix&nbsp;array&nbsp;for&nbsp;fast&nbsp;substring&nbsp;search.</span><br>
<span class="lineno"></span><span class="keyword" id="6050799">type</span>&nbsp;<span class="ident" id="6050804">Index</span>&nbsp;<span class="keyword" id="6050810">struct</span>&nbsp;<span class="op" id="6050817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6050820">data</span>&nbsp;<span class="op" id="6050825">[</span><span class="op" id="6050826">]</span><span class="builtintype" id="6050827">byte</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6050833">sa</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6050838">[</span><span class="op" id="6050839">]</span><span class="builtintype" id="6050840">int</span>&nbsp;<span class="comment" id="6050844">//&nbsp;suffix&nbsp;array&nbsp;for&nbsp;data;&nbsp;len(sa)&nbsp;==&nbsp;len(data)</span><br>
<span class="lineno"></span><span class="op" id="6050891">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6050894">//&nbsp;New&nbsp;creates&nbsp;a&nbsp;new&nbsp;Index&nbsp;for&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="6050931">//&nbsp;Index&nbsp;creation&nbsp;time&nbsp;is&nbsp;O(N*log(N))&nbsp;for&nbsp;N&nbsp;=&nbsp;len(data).</span><br>
<span class="lineno">35</span><span class="keyword" id="6050988">func</span>&nbsp;<span class="ident" id="6050993">New</span><span class="op" id="6050996">(</span><span class="ident" id="6050997">data</span>&nbsp;<span class="op" id="6051002">[</span><span class="op" id="6051003">]</span><span class="builtintype" id="6051004">byte</span><span class="op" id="6051008">)</span>&nbsp;<span class="op" id="6051010">*</span><span class="ident" id="6051011">Index</span>&nbsp;<span class="op" id="6051017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6051020">return</span>&nbsp;<span class="op" id="6051027">&amp;</span><span class="ident" id="6051028">Index</span><span class="op" id="6051033">{</span><span class="ident" id="6051034">data</span><span class="op" id="6051038">,</span>&nbsp;<span class="ident" id="6051040">qsufsort</span><span class="op" id="6051048">(</span><span class="ident" id="6051049">data</span><span class="op" id="6051053">)</span><span class="op" id="6051054">}</span><br>
<span class="lineno"></span><span class="op" id="6051056">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6051059">//&nbsp;writeInt&nbsp;writes&nbsp;an&nbsp;int&nbsp;x&nbsp;to&nbsp;w&nbsp;using&nbsp;buf&nbsp;to&nbsp;buffer&nbsp;the&nbsp;write.</span><br>
<span class="lineno">40</span><span class="keyword" id="6051123">func</span>&nbsp;<span class="ident" id="6051128">writeInt</span><span class="op" id="6051136">(</span><span class="ident" id="6051137">w</span>&nbsp;<span class="ident" id="6051139">io</span><span class="op" id="6051141">.</span><span class="ident" id="6051142">Writer</span><span class="op" id="6051148">,</span>&nbsp;<span class="ident" id="6051150">buf</span>&nbsp;<span class="op" id="6051154">[</span><span class="op" id="6051155">]</span><span class="builtintype" id="6051156">byte</span><span class="op" id="6051160">,</span>&nbsp;<span class="ident" id="6051162">x</span>&nbsp;<span class="builtintype" id="6051164">int</span><span class="op" id="6051167">)</span>&nbsp;<span class="builtintype" id="6051169">error</span>&nbsp;<span class="op" id="6051175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6051178">binary</span><span class="op" id="6051184">.</span><span class="ident" id="6051185">PutVarint</span><span class="op" id="6051194">(</span><span class="ident" id="6051195">buf</span><span class="op" id="6051198">,</span>&nbsp;<span class="ident" id="6051200">int64</span><span class="op" id="6051205">(</span><span class="ident" id="6051206">x</span><span class="op" id="6051207">)</span><span class="op" id="6051208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6051211">_</span><span class="op" id="6051212">,</span>&nbsp;<span class="ident" id="6051214">err</span>&nbsp;<span class="op" id="6051218">:=</span>&nbsp;<span class="ident" id="6051221">w</span><span class="op" id="6051222">.</span><span class="ident" id="6051223">Write</span><span class="op" id="6051228">(</span><span class="ident" id="6051229">buf</span><span class="op" id="6051232">[</span><span class="num" id="6051233">0</span><span class="op" id="6051234">:</span><span class="ident" id="6051235">binary</span><span class="op" id="6051241">.</span><span class="ident" id="6051242">MaxVarintLen64</span><span class="op" id="6051256">]</span><span class="op" id="6051257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6051260">return</span>&nbsp;<span class="ident" id="6051267">err</span><br>
<span class="lineno"></span><span class="op" id="6051271">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="6051274">//&nbsp;readInt&nbsp;reads&nbsp;an&nbsp;int&nbsp;x&nbsp;from&nbsp;r&nbsp;using&nbsp;buf&nbsp;to&nbsp;buffer&nbsp;the&nbsp;read&nbsp;and&nbsp;returns&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="6051351">func</span>&nbsp;<span class="ident" id="6051356">readInt</span><span class="op" id="6051363">(</span><span class="ident" id="6051364">r</span>&nbsp;<span class="ident" id="6051366">io</span><span class="op" id="6051368">.</span><span class="ident" id="6051369">Reader</span><span class="op" id="6051375">,</span>&nbsp;<span class="ident" id="6051377">buf</span>&nbsp;<span class="op" id="6051381">[</span><span class="op" id="6051382">]</span><span class="builtintype" id="6051383">byte</span><span class="op" id="6051387">)</span>&nbsp;<span class="op" id="6051389">(</span><span class="builtintype" id="6051390">int</span><span class="op" id="6051393">,</span>&nbsp;<span class="builtintype" id="6051395">error</span><span class="op" id="6051400">)</span>&nbsp;<span class="op" id="6051402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6051405">_</span><span class="op" id="6051406">,</span>&nbsp;<span class="ident" id="6051408">err</span>&nbsp;<span class="op" id="6051412">:=</span>&nbsp;<span class="ident" id="6051415">io</span><span class="op" id="6051417">.</span><span class="ident" id="6051418">ReadFull</span><span class="op" id="6051426">(</span><span class="ident" id="6051427">r</span><span class="op" id="6051428">,</span>&nbsp;<span class="ident" id="6051430">buf</span><span class="op" id="6051433">[</span><span class="num" id="6051434">0</span><span class="op" id="6051435">:</span><span class="ident" id="6051436">binary</span><span class="op" id="6051442">.</span><span class="ident" id="6051443">MaxVarintLen64</span><span class="op" id="6051457">]</span><span class="op" id="6051458">)</span>&nbsp;<span class="comment" id="6051460">//&nbsp;ok&nbsp;to&nbsp;continue&nbsp;with&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6051490">x</span><span class="op" id="6051491">,</span>&nbsp;<span class="ident" id="6051493">_</span>&nbsp;<span class="op" id="6051495">:=</span>&nbsp;<span class="ident" id="6051498">binary</span><span class="op" id="6051504">.</span><span class="ident" id="6051505">Varint</span><span class="op" id="6051511">(</span><span class="ident" id="6051512">buf</span><span class="op" id="6051515">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6051518">return</span>&nbsp;<span class="builtintype" id="6051525">int</span><span class="op" id="6051528">(</span><span class="ident" id="6051529">x</span><span class="op" id="6051530">)</span><span class="op" id="6051531">,</span>&nbsp;<span class="ident" id="6051533">err</span><br>
<span class="lineno"></span><span class="op" id="6051537">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6051540">//&nbsp;writeSlice&nbsp;writes&nbsp;data[:n]&nbsp;to&nbsp;w&nbsp;and&nbsp;returns&nbsp;n.</span><br>
<span class="lineno"></span><span class="comment" id="6051590">//&nbsp;It&nbsp;uses&nbsp;buf&nbsp;to&nbsp;buffer&nbsp;the&nbsp;write.</span><br>
<span class="lineno">55</span><span class="keyword" id="6051626">func</span>&nbsp;<span class="ident" id="6051631">writeSlice</span><span class="op" id="6051641">(</span><span class="ident" id="6051642">w</span>&nbsp;<span class="ident" id="6051644">io</span><span class="op" id="6051646">.</span><span class="ident" id="6051647">Writer</span><span class="op" id="6051653">,</span>&nbsp;<span class="ident" id="6051655">buf</span>&nbsp;<span class="op" id="6051659">[</span><span class="op" id="6051660">]</span><span class="builtintype" id="6051661">byte</span><span class="op" id="6051665">,</span>&nbsp;<span class="ident" id="6051667">data</span>&nbsp;<span class="op" id="6051672">[</span><span class="op" id="6051673">]</span><span class="builtintype" id="6051674">int</span><span class="op" id="6051677">)</span>&nbsp;<span class="op" id="6051679">(</span><span class="ident" id="6051680">n</span>&nbsp;<span class="builtintype" id="6051682">int</span><span class="op" id="6051685">,</span>&nbsp;<span class="ident" id="6051687">err</span>&nbsp;<span class="builtintype" id="6051691">error</span><span class="op" id="6051696">)</span>&nbsp;<span class="op" id="6051698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6051701">//&nbsp;encode&nbsp;as&nbsp;many&nbsp;elements&nbsp;as&nbsp;fit&nbsp;into&nbsp;buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6051745">p</span>&nbsp;<span class="op" id="6051747">:=</span>&nbsp;<span class="ident" id="6051750">binary</span><span class="op" id="6051756">.</span><span class="ident" id="6051757">MaxVarintLen64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6051773">for</span>&nbsp;<span class="op" id="6051777">;</span>&nbsp;<span class="ident" id="6051779">n</span>&nbsp;<span class="op" id="6051781">&lt;</span>&nbsp;<span class="builtinfunc" id="6051783">len</span><span class="op" id="6051786">(</span><span class="ident" id="6051787">data</span><span class="op" id="6051791">)</span>&nbsp;<span class="op" id="6051793">&amp;&amp;</span>&nbsp;<span class="ident" id="6051796">p</span><span class="op" id="6051797">+</span><span class="ident" id="6051798">binary</span><span class="op" id="6051804">.</span><span class="ident" id="6051805">MaxVarintLen64</span>&nbsp;<span class="op" id="6051820">&lt;=</span>&nbsp;<span class="builtinfunc" id="6051823">len</span><span class="op" id="6051826">(</span><span class="ident" id="6051827">buf</span><span class="op" id="6051830">)</span><span class="op" id="6051831">;</span>&nbsp;<span class="ident" id="6051833">n</span><span class="op" id="6051834">++</span>&nbsp;<span class="op" id="6051837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6051841">p</span>&nbsp;<span class="op" id="6051843">+=</span>&nbsp;<span class="ident" id="6051846">binary</span><span class="op" id="6051852">.</span><span class="ident" id="6051853">PutUvarint</span><span class="op" id="6051863">(</span><span class="ident" id="6051864">buf</span><span class="op" id="6051867">[</span><span class="ident" id="6051868">p</span><span class="op" id="6051869">:</span><span class="op" id="6051870">]</span><span class="op" id="6051871">,</span>&nbsp;<span class="ident" id="6051873">uint64</span><span class="op" id="6051879">(</span><span class="ident" id="6051880">data</span><span class="op" id="6051884">[</span><span class="ident" id="6051885">n</span><span class="op" id="6051886">]</span><span class="op" id="6051887">)</span><span class="op" id="6051888">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6051891">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6051895">//&nbsp;update&nbsp;buffer&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6051918">binary</span><span class="op" id="6051924">.</span><span class="ident" id="6051925">PutVarint</span><span class="op" id="6051934">(</span><span class="ident" id="6051935">buf</span><span class="op" id="6051938">,</span>&nbsp;<span class="ident" id="6051940">int64</span><span class="op" id="6051945">(</span><span class="ident" id="6051946">p</span><span class="op" id="6051947">)</span><span class="op" id="6051948">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6051952">//&nbsp;write&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6051969">_</span><span class="op" id="6051970">,</span>&nbsp;<span class="ident" id="6051972">err</span>&nbsp;<span class="op" id="6051976">=</span>&nbsp;<span class="ident" id="6051978">w</span><span class="op" id="6051979">.</span><span class="ident" id="6051980">Write</span><span class="op" id="6051985">(</span><span class="ident" id="6051986">buf</span><span class="op" id="6051989">[</span><span class="num" id="6051990">0</span><span class="op" id="6051991">:</span><span class="ident" id="6051992">p</span><span class="op" id="6051993">]</span><span class="op" id="6051994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6051997">return</span><br>
<span class="lineno"></span><span class="op" id="6052004">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="comment" id="6052007">//&nbsp;readSlice&nbsp;reads&nbsp;data[:n]&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;n.</span><br>
<span class="lineno"></span><span class="comment" id="6052057">//&nbsp;It&nbsp;uses&nbsp;buf&nbsp;to&nbsp;buffer&nbsp;the&nbsp;read.</span><br>
<span class="lineno"></span><span class="keyword" id="6052092">func</span>&nbsp;<span class="ident" id="6052097">readSlice</span><span class="op" id="6052106">(</span><span class="ident" id="6052107">r</span>&nbsp;<span class="ident" id="6052109">io</span><span class="op" id="6052111">.</span><span class="ident" id="6052112">Reader</span><span class="op" id="6052118">,</span>&nbsp;<span class="ident" id="6052120">buf</span>&nbsp;<span class="op" id="6052124">[</span><span class="op" id="6052125">]</span><span class="builtintype" id="6052126">byte</span><span class="op" id="6052130">,</span>&nbsp;<span class="ident" id="6052132">data</span>&nbsp;<span class="op" id="6052137">[</span><span class="op" id="6052138">]</span><span class="builtintype" id="6052139">int</span><span class="op" id="6052142">)</span>&nbsp;<span class="op" id="6052144">(</span><span class="ident" id="6052145">n</span>&nbsp;<span class="builtintype" id="6052147">int</span><span class="op" id="6052150">,</span>&nbsp;<span class="ident" id="6052152">err</span>&nbsp;<span class="builtintype" id="6052156">error</span><span class="op" id="6052161">)</span>&nbsp;<span class="op" id="6052163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6052166">//&nbsp;read&nbsp;buffer&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6052187">var</span>&nbsp;<span class="ident" id="6052191">size</span>&nbsp;<span class="builtintype" id="6052196">int</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6052201">size</span><span class="op" id="6052205">,</span>&nbsp;<span class="ident" id="6052207">err</span>&nbsp;<span class="op" id="6052211">=</span>&nbsp;<span class="ident" id="6052213">readInt</span><span class="op" id="6052220">(</span><span class="ident" id="6052221">r</span><span class="op" id="6052222">,</span>&nbsp;<span class="ident" id="6052224">buf</span><span class="op" id="6052227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6052230">if</span>&nbsp;<span class="ident" id="6052233">err</span>&nbsp;<span class="op" id="6052237">!=</span>&nbsp;<span class="ident" id="6052240">nil</span>&nbsp;<span class="op" id="6052244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6052248">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6052256">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6052260">//&nbsp;read&nbsp;buffer&nbsp;w/o&nbsp;the&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6052289">if</span>&nbsp;<span class="ident" id="6052292">_</span><span class="op" id="6052293">,</span>&nbsp;<span class="ident" id="6052295">err</span>&nbsp;<span class="op" id="6052299">=</span>&nbsp;<span class="ident" id="6052301">io</span><span class="op" id="6052303">.</span><span class="ident" id="6052304">ReadFull</span><span class="op" id="6052312">(</span><span class="ident" id="6052313">r</span><span class="op" id="6052314">,</span>&nbsp;<span class="ident" id="6052316">buf</span><span class="op" id="6052319">[</span><span class="ident" id="6052320">binary</span><span class="op" id="6052326">.</span><span class="ident" id="6052327">MaxVarintLen64</span><span class="op" id="6052341">:</span><span class="ident" id="6052342">size</span><span class="op" id="6052346">]</span><span class="op" id="6052347">)</span><span class="op" id="6052348">;</span>&nbsp;<span class="ident" id="6052350">err</span>&nbsp;<span class="op" id="6052354">!=</span>&nbsp;<span class="ident" id="6052357">nil</span>&nbsp;<span class="op" id="6052361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6052365">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6052373">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6052377">//&nbsp;decode&nbsp;as&nbsp;many&nbsp;elements&nbsp;as&nbsp;present&nbsp;in&nbsp;buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6052423">for</span>&nbsp;<span class="ident" id="6052427">p</span>&nbsp;<span class="op" id="6052429">:=</span>&nbsp;<span class="ident" id="6052432">binary</span><span class="op" id="6052438">.</span><span class="ident" id="6052439">MaxVarintLen64</span><span class="op" id="6052453">;</span>&nbsp;<span class="ident" id="6052455">p</span>&nbsp;<span class="op" id="6052457">&lt;</span>&nbsp;<span class="ident" id="6052459">size</span><span class="op" id="6052463">;</span>&nbsp;<span class="ident" id="6052465">n</span><span class="op" id="6052466">++</span>&nbsp;<span class="op" id="6052469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6052473">x</span><span class="op" id="6052474">,</span>&nbsp;<span class="ident" id="6052476">w</span>&nbsp;<span class="op" id="6052478">:=</span>&nbsp;<span class="ident" id="6052481">binary</span><span class="op" id="6052487">.</span><span class="ident" id="6052488">Uvarint</span><span class="op" id="6052495">(</span><span class="ident" id="6052496">buf</span><span class="op" id="6052499">[</span><span class="ident" id="6052500">p</span><span class="op" id="6052501">:</span><span class="op" id="6052502">]</span><span class="op" id="6052503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6052507">data</span><span class="op" id="6052511">[</span><span class="ident" id="6052512">n</span><span class="op" id="6052513">]</span>&nbsp;<span class="op" id="6052515">=</span>&nbsp;<span class="builtintype" id="6052517">int</span><span class="op" id="6052520">(</span><span class="ident" id="6052521">x</span><span class="op" id="6052522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6052526">p</span>&nbsp;<span class="op" id="6052528">+=</span>&nbsp;<span class="ident" id="6052531">w</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6052534">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6052538">return</span><br>
<span class="lineno"></span><span class="op" id="6052545">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="6052548">const</span>&nbsp;<span class="ident" id="6052554">bufSize</span>&nbsp;<span class="op" id="6052562">=</span>&nbsp;<span class="num" id="6052564">16</span>&nbsp;<span class="op" id="6052567">&lt;&lt;</span>&nbsp;<span class="num" id="6052570">10</span>&nbsp;<span class="comment" id="6052573">//&nbsp;reasonable&nbsp;for&nbsp;BenchmarkSaveRestore</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6052613">//&nbsp;Read&nbsp;reads&nbsp;the&nbsp;index&nbsp;from&nbsp;r&nbsp;into&nbsp;x;&nbsp;x&nbsp;must&nbsp;not&nbsp;be&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="6052671">func</span>&nbsp;<span class="op" id="6052676">(</span><span class="ident" id="6052677">x</span>&nbsp;<span class="op" id="6052679">*</span><span class="ident" id="6052680">Index</span><span class="op" id="6052685">)</span>&nbsp;<span class="ident" id="6052687">Read</span><span class="op" id="6052691">(</span><span class="ident" id="6052692">r</span>&nbsp;<span class="ident" id="6052694">io</span><span class="op" id="6052696">.</span><span class="ident" id="6052697">Reader</span><span class="op" id="6052703">)</span>&nbsp;<span class="builtintype" id="6052705">error</span>&nbsp;<span class="op" id="6052711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6052714">//&nbsp;buffer&nbsp;for&nbsp;all&nbsp;reads</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6052739">buf</span>&nbsp;<span class="op" id="6052743">:=</span>&nbsp;<span class="builtinfunc" id="6052746">make</span><span class="op" id="6052750">(</span><span class="op" id="6052751">[</span><span class="op" id="6052752">]</span><span class="builtintype" id="6052753">byte</span><span class="op" id="6052757">,</span>&nbsp;<span class="ident" id="6052759">bufSize</span><span class="op" id="6052766">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6052770">//&nbsp;read&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6052786">n</span><span class="op" id="6052787">,</span>&nbsp;<span class="ident" id="6052789">err</span>&nbsp;<span class="op" id="6052793">:=</span>&nbsp;<span class="ident" id="6052796">readInt</span><span class="op" id="6052803">(</span><span class="ident" id="6052804">r</span><span class="op" id="6052805">,</span>&nbsp;<span class="ident" id="6052807">buf</span><span class="op" id="6052810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6052813">if</span>&nbsp;<span class="ident" id="6052816">err</span>&nbsp;<span class="op" id="6052820">!=</span>&nbsp;<span class="ident" id="6052823">nil</span>&nbsp;<span class="op" id="6052827">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6052831">return</span>&nbsp;<span class="ident" id="6052838">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6052843">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6052847">//&nbsp;allocate&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6052866">if</span>&nbsp;<span class="num" id="6052869">2</span><span class="op" id="6052870">*</span><span class="ident" id="6052871">n</span>&nbsp;<span class="op" id="6052873">&lt;</span>&nbsp;<span class="builtinfunc" id="6052875">cap</span><span class="op" id="6052878">(</span><span class="ident" id="6052879">x</span><span class="op" id="6052880">.</span><span class="ident" id="6052881">data</span><span class="op" id="6052885">)</span>&nbsp;<span class="op" id="6052887">||</span>&nbsp;<span class="builtinfunc" id="6052890">cap</span><span class="op" id="6052893">(</span><span class="ident" id="6052894">x</span><span class="op" id="6052895">.</span><span class="ident" id="6052896">data</span><span class="op" id="6052900">)</span>&nbsp;<span class="op" id="6052902">&lt;</span>&nbsp;<span class="ident" id="6052904">n</span>&nbsp;<span class="op" id="6052906">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6052910">//&nbsp;new&nbsp;data&nbsp;is&nbsp;significantly&nbsp;smaller&nbsp;or&nbsp;larger&nbsp;then</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6052964">//&nbsp;existing&nbsp;buffers&nbsp;-&nbsp;allocate&nbsp;new&nbsp;ones</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6053006">x</span><span class="op" id="6053007">.</span><span class="ident" id="6053008">data</span>&nbsp;<span class="op" id="6053013">=</span>&nbsp;<span class="builtinfunc" id="6053015">make</span><span class="op" id="6053019">(</span><span class="op" id="6053020">[</span><span class="op" id="6053021">]</span><span class="builtintype" id="6053022">byte</span><span class="op" id="6053026">,</span>&nbsp;<span class="ident" id="6053028">n</span><span class="op" id="6053029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6053033">x</span><span class="op" id="6053034">.</span><span class="ident" id="6053035">sa</span>&nbsp;<span class="op" id="6053038">=</span>&nbsp;<span class="builtinfunc" id="6053040">make</span><span class="op" id="6053044">(</span><span class="op" id="6053045">[</span><span class="op" id="6053046">]</span><span class="builtintype" id="6053047">int</span><span class="op" id="6053050">,</span>&nbsp;<span class="ident" id="6053052">n</span><span class="op" id="6053053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6053056">}</span>&nbsp;<span class="keyword" id="6053058">else</span>&nbsp;<span class="op" id="6053063">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6053067">//&nbsp;re-use&nbsp;existing&nbsp;buffers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6053096">x</span><span class="op" id="6053097">.</span><span class="ident" id="6053098">data</span>&nbsp;<span class="op" id="6053103">=</span>&nbsp;<span class="ident" id="6053105">x</span><span class="op" id="6053106">.</span><span class="ident" id="6053107">data</span><span class="op" id="6053111">[</span><span class="num" id="6053112">0</span><span class="op" id="6053113">:</span><span class="ident" id="6053114">n</span><span class="op" id="6053115">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6053119">x</span><span class="op" id="6053120">.</span><span class="ident" id="6053121">sa</span>&nbsp;<span class="op" id="6053124">=</span>&nbsp;<span class="ident" id="6053126">x</span><span class="op" id="6053127">.</span><span class="ident" id="6053128">sa</span><span class="op" id="6053130">[</span><span class="num" id="6053131">0</span><span class="op" id="6053132">:</span><span class="ident" id="6053133">n</span><span class="op" id="6053134">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6053137">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6053141">//&nbsp;read&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6053155">if</span>&nbsp;<span class="ident" id="6053158">_</span><span class="op" id="6053159">,</span>&nbsp;<span class="ident" id="6053161">err</span>&nbsp;<span class="op" id="6053165">:=</span>&nbsp;<span class="ident" id="6053168">io</span><span class="op" id="6053170">.</span><span class="ident" id="6053171">ReadFull</span><span class="op" id="6053179">(</span><span class="ident" id="6053180">r</span><span class="op" id="6053181">,</span>&nbsp;<span class="ident" id="6053183">x</span><span class="op" id="6053184">.</span><span class="ident" id="6053185">data</span><span class="op" id="6053189">)</span><span class="op" id="6053190">;</span>&nbsp;<span class="ident" id="6053192">err</span>&nbsp;<span class="op" id="6053196">!=</span>&nbsp;<span class="ident" id="6053199">nil</span>&nbsp;<span class="op" id="6053203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6053207">return</span>&nbsp;<span class="ident" id="6053214">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6053219">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6053223">//&nbsp;read&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6053238">for</span>&nbsp;<span class="ident" id="6053242">sa</span>&nbsp;<span class="op" id="6053245">:=</span>&nbsp;<span class="ident" id="6053248">x</span><span class="op" id="6053249">.</span><span class="ident" id="6053250">sa</span><span class="op" id="6053252">;</span>&nbsp;<span class="builtinfunc" id="6053254">len</span><span class="op" id="6053257">(</span><span class="ident" id="6053258">sa</span><span class="op" id="6053260">)</span>&nbsp;<span class="op" id="6053262">&gt;</span>&nbsp;<span class="num" id="6053264">0</span><span class="op" id="6053265">;</span>&nbsp;<span class="op" id="6053267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6053271">n</span><span class="op" id="6053272">,</span>&nbsp;<span class="ident" id="6053274">err</span>&nbsp;<span class="op" id="6053278">:=</span>&nbsp;<span class="ident" id="6053281">readSlice</span><span class="op" id="6053290">(</span><span class="ident" id="6053291">r</span><span class="op" id="6053292">,</span>&nbsp;<span class="ident" id="6053294">buf</span><span class="op" id="6053297">,</span>&nbsp;<span class="ident" id="6053299">sa</span><span class="op" id="6053301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6053305">if</span>&nbsp;<span class="ident" id="6053308">err</span>&nbsp;<span class="op" id="6053312">!=</span>&nbsp;<span class="ident" id="6053315">nil</span>&nbsp;<span class="op" id="6053319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6053324">return</span>&nbsp;<span class="ident" id="6053331">err</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6053337">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6053341">sa</span>&nbsp;<span class="op" id="6053344">=</span>&nbsp;<span class="ident" id="6053346">sa</span><span class="op" id="6053348">[</span><span class="ident" id="6053349">n</span><span class="op" id="6053350">:</span><span class="op" id="6053351">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6053354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6053357">return</span>&nbsp;<span class="ident" id="6053364">nil</span><br>
<span class="lineno"></span><span class="op" id="6053368">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="comment" id="6053371">//&nbsp;Write&nbsp;writes&nbsp;the&nbsp;index&nbsp;x&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="6053405">func</span>&nbsp;<span class="op" id="6053410">(</span><span class="ident" id="6053411">x</span>&nbsp;<span class="op" id="6053413">*</span><span class="ident" id="6053414">Index</span><span class="op" id="6053419">)</span>&nbsp;<span class="ident" id="6053421">Write</span><span class="op" id="6053426">(</span><span class="ident" id="6053427">w</span>&nbsp;<span class="ident" id="6053429">io</span><span class="op" id="6053431">.</span><span class="ident" id="6053432">Writer</span><span class="op" id="6053438">)</span>&nbsp;<span class="builtintype" id="6053440">error</span>&nbsp;<span class="op" id="6053446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6053449">//&nbsp;buffer&nbsp;for&nbsp;all&nbsp;writes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6053475">buf</span>&nbsp;<span class="op" id="6053479">:=</span>&nbsp;<span class="builtinfunc" id="6053482">make</span><span class="op" id="6053486">(</span><span class="op" id="6053487">[</span><span class="op" id="6053488">]</span><span class="builtintype" id="6053489">byte</span><span class="op" id="6053493">,</span>&nbsp;<span class="ident" id="6053495">bufSize</span><span class="op" id="6053502">)</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6053506">//&nbsp;write&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6053523">if</span>&nbsp;<span class="ident" id="6053526">err</span>&nbsp;<span class="op" id="6053530">:=</span>&nbsp;<span class="ident" id="6053533">writeInt</span><span class="op" id="6053541">(</span><span class="ident" id="6053542">w</span><span class="op" id="6053543">,</span>&nbsp;<span class="ident" id="6053545">buf</span><span class="op" id="6053548">,</span>&nbsp;<span class="builtinfunc" id="6053550">len</span><span class="op" id="6053553">(</span><span class="ident" id="6053554">x</span><span class="op" id="6053555">.</span><span class="ident" id="6053556">data</span><span class="op" id="6053560">)</span><span class="op" id="6053561">)</span><span class="op" id="6053562">;</span>&nbsp;<span class="ident" id="6053564">err</span>&nbsp;<span class="op" id="6053568">!=</span>&nbsp;<span class="ident" id="6053571">nil</span>&nbsp;<span class="op" id="6053575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6053579">return</span>&nbsp;<span class="ident" id="6053586">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6053591">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6053595">//&nbsp;write&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6053610">if</span>&nbsp;<span class="ident" id="6053613">_</span><span class="op" id="6053614">,</span>&nbsp;<span class="ident" id="6053616">err</span>&nbsp;<span class="op" id="6053620">:=</span>&nbsp;<span class="ident" id="6053623">w</span><span class="op" id="6053624">.</span><span class="ident" id="6053625">Write</span><span class="op" id="6053630">(</span><span class="ident" id="6053631">x</span><span class="op" id="6053632">.</span><span class="ident" id="6053633">data</span><span class="op" id="6053637">)</span><span class="op" id="6053638">;</span>&nbsp;<span class="ident" id="6053640">err</span>&nbsp;<span class="op" id="6053644">!=</span>&nbsp;<span class="ident" id="6053647">nil</span>&nbsp;<span class="op" id="6053651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6053655">return</span>&nbsp;<span class="ident" id="6053662">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6053667">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6053671">//&nbsp;write&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6053687">for</span>&nbsp;<span class="ident" id="6053691">sa</span>&nbsp;<span class="op" id="6053694">:=</span>&nbsp;<span class="ident" id="6053697">x</span><span class="op" id="6053698">.</span><span class="ident" id="6053699">sa</span><span class="op" id="6053701">;</span>&nbsp;<span class="builtinfunc" id="6053703">len</span><span class="op" id="6053706">(</span><span class="ident" id="6053707">sa</span><span class="op" id="6053709">)</span>&nbsp;<span class="op" id="6053711">&gt;</span>&nbsp;<span class="num" id="6053713">0</span><span class="op" id="6053714">;</span>&nbsp;<span class="op" id="6053716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6053720">n</span><span class="op" id="6053721">,</span>&nbsp;<span class="ident" id="6053723">err</span>&nbsp;<span class="op" id="6053727">:=</span>&nbsp;<span class="ident" id="6053730">writeSlice</span><span class="op" id="6053740">(</span><span class="ident" id="6053741">w</span><span class="op" id="6053742">,</span>&nbsp;<span class="ident" id="6053744">buf</span><span class="op" id="6053747">,</span>&nbsp;<span class="ident" id="6053749">sa</span><span class="op" id="6053751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6053755">if</span>&nbsp;<span class="ident" id="6053758">err</span>&nbsp;<span class="op" id="6053762">!=</span>&nbsp;<span class="ident" id="6053765">nil</span>&nbsp;<span class="op" id="6053769">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6053774">return</span>&nbsp;<span class="ident" id="6053781">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6053787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6053791">sa</span>&nbsp;<span class="op" id="6053794">=</span>&nbsp;<span class="ident" id="6053796">sa</span><span class="op" id="6053798">[</span><span class="ident" id="6053799">n</span><span class="op" id="6053800">:</span><span class="op" id="6053801">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6053804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6053807">return</span>&nbsp;<span class="ident" id="6053814">nil</span><br>
<span class="lineno">160</span><span class="op" id="6053818">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6053821">//&nbsp;Bytes&nbsp;returns&nbsp;the&nbsp;data&nbsp;over&nbsp;which&nbsp;the&nbsp;index&nbsp;was&nbsp;created.</span><br>
<span class="lineno"></span><span class="comment" id="6053881">//&nbsp;It&nbsp;must&nbsp;not&nbsp;be&nbsp;modified.</span><br>
<span class="lineno"></span><span class="comment" id="6053909">//</span><br>
<span class="lineno">165</span><span class="keyword" id="6053912">func</span>&nbsp;<span class="op" id="6053917">(</span><span class="ident" id="6053918">x</span>&nbsp;<span class="op" id="6053920">*</span><span class="ident" id="6053921">Index</span><span class="op" id="6053926">)</span>&nbsp;<span class="ident" id="6053928">Bytes</span><span class="op" id="6053933">(</span><span class="op" id="6053934">)</span>&nbsp;<span class="op" id="6053936">[</span><span class="op" id="6053937">]</span><span class="builtintype" id="6053938">byte</span>&nbsp;<span class="op" id="6053943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6053946">return</span>&nbsp;<span class="ident" id="6053953">x</span><span class="op" id="6053954">.</span><span class="ident" id="6053955">data</span><br>
<span class="lineno"></span><span class="op" id="6053960">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6053963">func</span>&nbsp;<span class="op" id="6053968">(</span><span class="ident" id="6053969">x</span>&nbsp;<span class="op" id="6053971">*</span><span class="ident" id="6053972">Index</span><span class="op" id="6053977">)</span>&nbsp;<span class="ident" id="6053979">at</span><span class="op" id="6053981">(</span><span class="ident" id="6053982">i</span>&nbsp;<span class="builtintype" id="6053984">int</span><span class="op" id="6053987">)</span>&nbsp;<span class="op" id="6053989">[</span><span class="op" id="6053990">]</span><span class="builtintype" id="6053991">byte</span>&nbsp;<span class="op" id="6053996">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6053999">return</span>&nbsp;<span class="ident" id="6054006">x</span><span class="op" id="6054007">.</span><span class="ident" id="6054008">data</span><span class="op" id="6054012">[</span><span class="ident" id="6054013">x</span><span class="op" id="6054014">.</span><span class="ident" id="6054015">sa</span><span class="op" id="6054017">[</span><span class="ident" id="6054018">i</span><span class="op" id="6054019">]</span><span class="op" id="6054020">:</span><span class="op" id="6054021">]</span><br>
<span class="lineno"></span><span class="op" id="6054023">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6054026">//&nbsp;lookupAll&nbsp;returns&nbsp;a&nbsp;slice&nbsp;into&nbsp;the&nbsp;matching&nbsp;region&nbsp;of&nbsp;the&nbsp;index.</span><br>
<span class="lineno"></span><span class="comment" id="6054094">//&nbsp;The&nbsp;runtime&nbsp;is&nbsp;O(log(N)*len(s)).</span><br>
<span class="lineno">175</span><span class="keyword" id="6054130">func</span>&nbsp;<span class="op" id="6054135">(</span><span class="ident" id="6054136">x</span>&nbsp;<span class="op" id="6054138">*</span><span class="ident" id="6054139">Index</span><span class="op" id="6054144">)</span>&nbsp;<span class="ident" id="6054146">lookupAll</span><span class="op" id="6054155">(</span><span class="ident" id="6054156">s</span>&nbsp;<span class="op" id="6054158">[</span><span class="op" id="6054159">]</span><span class="builtintype" id="6054160">byte</span><span class="op" id="6054164">)</span>&nbsp;<span class="op" id="6054166">[</span><span class="op" id="6054167">]</span><span class="builtintype" id="6054168">int</span>&nbsp;<span class="op" id="6054172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6054175">//&nbsp;find&nbsp;matching&nbsp;suffix&nbsp;index&nbsp;range&nbsp;[i:j]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6054218">//&nbsp;find&nbsp;the&nbsp;first&nbsp;index&nbsp;where&nbsp;s&nbsp;would&nbsp;be&nbsp;the&nbsp;prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6054271">i</span>&nbsp;<span class="op" id="6054273">:=</span>&nbsp;<span class="ident" id="6054276">sort</span><span class="op" id="6054280">.</span><span class="ident" id="6054281">Search</span><span class="op" id="6054287">(</span><span class="builtinfunc" id="6054288">len</span><span class="op" id="6054291">(</span><span class="ident" id="6054292">x</span><span class="op" id="6054293">.</span><span class="ident" id="6054294">sa</span><span class="op" id="6054296">)</span><span class="op" id="6054297">,</span>&nbsp;<span class="keyword" id="6054299">func</span><span class="op" id="6054303">(</span><span class="ident" id="6054304">i</span>&nbsp;<span class="builtintype" id="6054306">int</span><span class="op" id="6054309">)</span>&nbsp;<span class="builtintype" id="6054311">bool</span>&nbsp;<span class="op" id="6054316">{</span>&nbsp;<span class="keyword" id="6054318">return</span>&nbsp;<span class="ident" id="6054325">bytes</span><span class="op" id="6054330">.</span><span class="ident" id="6054331">Compare</span><span class="op" id="6054338">(</span><span class="ident" id="6054339">x</span><span class="op" id="6054340">.</span><span class="ident" id="6054341">at</span><span class="op" id="6054343">(</span><span class="ident" id="6054344">i</span><span class="op" id="6054345">)</span><span class="op" id="6054346">,</span>&nbsp;<span class="ident" id="6054348">s</span><span class="op" id="6054349">)</span>&nbsp;<span class="op" id="6054351">&gt;=</span>&nbsp;<span class="num" id="6054354">0</span>&nbsp;<span class="op" id="6054356">}</span><span class="op" id="6054357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6054360">//&nbsp;starting&nbsp;at&nbsp;i,&nbsp;find&nbsp;the&nbsp;first&nbsp;index&nbsp;at&nbsp;which&nbsp;s&nbsp;is&nbsp;not&nbsp;a&nbsp;prefix</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6054427">j</span>&nbsp;<span class="op" id="6054429">:=</span>&nbsp;<span class="ident" id="6054432">i</span>&nbsp;<span class="op" id="6054434">+</span>&nbsp;<span class="ident" id="6054436">sort</span><span class="op" id="6054440">.</span><span class="ident" id="6054441">Search</span><span class="op" id="6054447">(</span><span class="builtinfunc" id="6054448">len</span><span class="op" id="6054451">(</span><span class="ident" id="6054452">x</span><span class="op" id="6054453">.</span><span class="ident" id="6054454">sa</span><span class="op" id="6054456">)</span><span class="op" id="6054457">-</span><span class="ident" id="6054458">i</span><span class="op" id="6054459">,</span>&nbsp;<span class="keyword" id="6054461">func</span><span class="op" id="6054465">(</span><span class="ident" id="6054466">j</span>&nbsp;<span class="builtintype" id="6054468">int</span><span class="op" id="6054471">)</span>&nbsp;<span class="builtintype" id="6054473">bool</span>&nbsp;<span class="op" id="6054478">{</span>&nbsp;<span class="keyword" id="6054480">return</span>&nbsp;<span class="op" id="6054487">!</span><span class="ident" id="6054488">bytes</span><span class="op" id="6054493">.</span><span class="ident" id="6054494">HasPrefix</span><span class="op" id="6054503">(</span><span class="ident" id="6054504">x</span><span class="op" id="6054505">.</span><span class="ident" id="6054506">at</span><span class="op" id="6054508">(</span><span class="ident" id="6054509">j</span><span class="op" id="6054510">+</span><span class="ident" id="6054511">i</span><span class="op" id="6054512">)</span><span class="op" id="6054513">,</span>&nbsp;<span class="ident" id="6054515">s</span><span class="op" id="6054516">)</span>&nbsp;<span class="op" id="6054518">}</span><span class="op" id="6054519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6054522">return</span>&nbsp;<span class="ident" id="6054529">x</span><span class="op" id="6054530">.</span><span class="ident" id="6054531">sa</span><span class="op" id="6054533">[</span><span class="ident" id="6054534">i</span><span class="op" id="6054535">:</span><span class="ident" id="6054536">j</span><span class="op" id="6054537">]</span><br>
<span class="lineno"></span><span class="op" id="6054539">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6054542">//&nbsp;Lookup&nbsp;returns&nbsp;an&nbsp;unsorted&nbsp;list&nbsp;of&nbsp;at&nbsp;most&nbsp;n&nbsp;indices&nbsp;where&nbsp;the&nbsp;byte&nbsp;string&nbsp;s</span><br>
<span class="lineno">185</span><span class="comment" id="6054622">//&nbsp;occurs&nbsp;in&nbsp;the&nbsp;indexed&nbsp;data.&nbsp;If&nbsp;n&nbsp;&lt;&nbsp;0,&nbsp;all&nbsp;occurrences&nbsp;are&nbsp;returned.</span><br>
<span class="lineno"></span><span class="comment" id="6054693">//&nbsp;The&nbsp;result&nbsp;is&nbsp;nil&nbsp;if&nbsp;s&nbsp;is&nbsp;empty,&nbsp;s&nbsp;is&nbsp;not&nbsp;found,&nbsp;or&nbsp;n&nbsp;==&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="6054756">//&nbsp;Lookup&nbsp;time&nbsp;is&nbsp;O(log(N)*len(s)&nbsp;+&nbsp;len(result))&nbsp;where&nbsp;N&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6054820">//&nbsp;size&nbsp;of&nbsp;the&nbsp;indexed&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="6054849">//</span><br>
<span class="lineno">190</span><span class="keyword" id="6054852">func</span>&nbsp;<span class="op" id="6054857">(</span><span class="ident" id="6054858">x</span>&nbsp;<span class="op" id="6054860">*</span><span class="ident" id="6054861">Index</span><span class="op" id="6054866">)</span>&nbsp;<span class="ident" id="6054868">Lookup</span><span class="op" id="6054874">(</span><span class="ident" id="6054875">s</span>&nbsp;<span class="op" id="6054877">[</span><span class="op" id="6054878">]</span><span class="builtintype" id="6054879">byte</span><span class="op" id="6054883">,</span>&nbsp;<span class="ident" id="6054885">n</span>&nbsp;<span class="builtintype" id="6054887">int</span><span class="op" id="6054890">)</span>&nbsp;<span class="op" id="6054892">(</span><span class="ident" id="6054893">result</span>&nbsp;<span class="op" id="6054900">[</span><span class="op" id="6054901">]</span><span class="builtintype" id="6054902">int</span><span class="op" id="6054905">)</span>&nbsp;<span class="op" id="6054907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6054910">if</span>&nbsp;<span class="builtinfunc" id="6054913">len</span><span class="op" id="6054916">(</span><span class="ident" id="6054917">s</span><span class="op" id="6054918">)</span>&nbsp;<span class="op" id="6054920">&gt;</span>&nbsp;<span class="num" id="6054922">0</span>&nbsp;<span class="op" id="6054924">&amp;&amp;</span>&nbsp;<span class="ident" id="6054927">n</span>&nbsp;<span class="op" id="6054929">!=</span>&nbsp;<span class="num" id="6054932">0</span>&nbsp;<span class="op" id="6054934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6054938">matches</span>&nbsp;<span class="op" id="6054946">:=</span>&nbsp;<span class="ident" id="6054949">x</span><span class="op" id="6054950">.</span><span class="ident" id="6054951">lookupAll</span><span class="op" id="6054960">(</span><span class="ident" id="6054961">s</span><span class="op" id="6054962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6054966">if</span>&nbsp;<span class="ident" id="6054969">n</span>&nbsp;<span class="op" id="6054971">&lt;</span>&nbsp;<span class="num" id="6054973">0</span>&nbsp;<span class="op" id="6054975">||</span>&nbsp;<span class="builtinfunc" id="6054978">len</span><span class="op" id="6054981">(</span><span class="ident" id="6054982">matches</span><span class="op" id="6054989">)</span>&nbsp;<span class="op" id="6054991">&lt;</span>&nbsp;<span class="ident" id="6054993">n</span>&nbsp;<span class="op" id="6054995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6055000">n</span>&nbsp;<span class="op" id="6055002">=</span>&nbsp;<span class="builtinfunc" id="6055004">len</span><span class="op" id="6055007">(</span><span class="ident" id="6055008">matches</span><span class="op" id="6055015">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6055019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6055023">//&nbsp;0&nbsp;&lt;=&nbsp;n&nbsp;&lt;=&nbsp;len(matches)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6055051">if</span>&nbsp;<span class="ident" id="6055054">n</span>&nbsp;<span class="op" id="6055056">&gt;</span>&nbsp;<span class="num" id="6055058">0</span>&nbsp;<span class="op" id="6055060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6055065">result</span>&nbsp;<span class="op" id="6055072">=</span>&nbsp;<span class="builtinfunc" id="6055074">make</span><span class="op" id="6055078">(</span><span class="op" id="6055079">[</span><span class="op" id="6055080">]</span><span class="builtintype" id="6055081">int</span><span class="op" id="6055084">,</span>&nbsp;<span class="ident" id="6055086">n</span><span class="op" id="6055087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6055092">copy</span><span class="op" id="6055096">(</span><span class="ident" id="6055097">result</span><span class="op" id="6055103">,</span>&nbsp;<span class="ident" id="6055105">matches</span><span class="op" id="6055112">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6055116">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6055119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6055122">return</span><br>
<span class="lineno"></span><span class="op" id="6055129">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="comment" id="6055132">//&nbsp;FindAllIndex&nbsp;returns&nbsp;a&nbsp;sorted&nbsp;list&nbsp;of&nbsp;non-overlapping&nbsp;matches&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6055204">//&nbsp;regular&nbsp;expression&nbsp;r,&nbsp;where&nbsp;a&nbsp;match&nbsp;is&nbsp;a&nbsp;pair&nbsp;of&nbsp;indices&nbsp;specifying</span><br>
<span class="lineno"></span><span class="comment" id="6055275">//&nbsp;the&nbsp;matched&nbsp;slice&nbsp;of&nbsp;x.Bytes().&nbsp;If&nbsp;n&nbsp;&lt;&nbsp;0,&nbsp;all&nbsp;matches&nbsp;are&nbsp;returned</span><br>
<span class="lineno"></span><span class="comment" id="6055345">//&nbsp;in&nbsp;successive&nbsp;order.&nbsp;Otherwise,&nbsp;at&nbsp;most&nbsp;n&nbsp;matches&nbsp;are&nbsp;returned&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="6055415">//&nbsp;they&nbsp;may&nbsp;not&nbsp;be&nbsp;successive.&nbsp;The&nbsp;result&nbsp;is&nbsp;nil&nbsp;if&nbsp;there&nbsp;are&nbsp;no&nbsp;matches,</span><br>
<span class="lineno">210</span><span class="comment" id="6055489">//&nbsp;or&nbsp;if&nbsp;n&nbsp;==&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="6055506">//</span><br>
<span class="lineno"></span><span class="keyword" id="6055509">func</span>&nbsp;<span class="op" id="6055514">(</span><span class="ident" id="6055515">x</span>&nbsp;<span class="op" id="6055517">*</span><span class="ident" id="6055518">Index</span><span class="op" id="6055523">)</span>&nbsp;<span class="ident" id="6055525">FindAllIndex</span><span class="op" id="6055537">(</span><span class="ident" id="6055538">r</span>&nbsp;<span class="op" id="6055540">*</span><span class="ident" id="6055541">regexp</span><span class="op" id="6055547">.</span><span class="ident" id="6055548">Regexp</span><span class="op" id="6055554">,</span>&nbsp;<span class="ident" id="6055556">n</span>&nbsp;<span class="builtintype" id="6055558">int</span><span class="op" id="6055561">)</span>&nbsp;<span class="op" id="6055563">(</span><span class="ident" id="6055564">result</span>&nbsp;<span class="op" id="6055571">[</span><span class="op" id="6055572">]</span><span class="op" id="6055573">[</span><span class="op" id="6055574">]</span><span class="builtintype" id="6055575">int</span><span class="op" id="6055578">)</span>&nbsp;<span class="op" id="6055580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6055583">//&nbsp;a&nbsp;non-empty&nbsp;literal&nbsp;prefix&nbsp;is&nbsp;used&nbsp;to&nbsp;determine&nbsp;possible</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6055644">//&nbsp;match&nbsp;start&nbsp;indices&nbsp;with&nbsp;Lookup</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6055680">prefix</span><span class="op" id="6055686">,</span>&nbsp;<span class="ident" id="6055688">complete</span>&nbsp;<span class="op" id="6055697">:=</span>&nbsp;<span class="ident" id="6055700">r</span><span class="op" id="6055701">.</span><span class="ident" id="6055702">LiteralPrefix</span><span class="op" id="6055715">(</span><span class="op" id="6055716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6055719">lit</span>&nbsp;<span class="op" id="6055723">:=</span>&nbsp;<span class="op" id="6055726">[</span><span class="op" id="6055727">]</span><span class="builtintype" id="6055728">byte</span><span class="op" id="6055732">(</span><span class="ident" id="6055733">prefix</span><span class="op" id="6055739">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6055743">//&nbsp;worst-case&nbsp;scenario:&nbsp;no&nbsp;literal&nbsp;prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6055786">if</span>&nbsp;<span class="ident" id="6055789">prefix</span>&nbsp;<span class="op" id="6055796">==</span>&nbsp;<span class="string" id="6055799">&#34;&#34;</span>&nbsp;<span class="op" id="6055802">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6055806">return</span>&nbsp;<span class="ident" id="6055813">r</span><span class="op" id="6055814">.</span><span class="ident" id="6055815">FindAllIndex</span><span class="op" id="6055827">(</span><span class="ident" id="6055828">x</span><span class="op" id="6055829">.</span><span class="ident" id="6055830">data</span><span class="op" id="6055834">,</span>&nbsp;<span class="ident" id="6055836">n</span><span class="op" id="6055837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6055840">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6055844">//&nbsp;if&nbsp;regexp&nbsp;is&nbsp;a&nbsp;literal&nbsp;just&nbsp;use&nbsp;Lookup&nbsp;and&nbsp;convert&nbsp;its</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6055903">//&nbsp;result&nbsp;into&nbsp;match&nbsp;pairs</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6055931">if</span>&nbsp;<span class="ident" id="6055934">complete</span>&nbsp;<span class="op" id="6055943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6055947">//&nbsp;Lookup&nbsp;returns&nbsp;indices&nbsp;that&nbsp;may&nbsp;belong&nbsp;to&nbsp;overlapping&nbsp;matches.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6056015">//&nbsp;After&nbsp;eliminating&nbsp;them,&nbsp;we&nbsp;may&nbsp;end&nbsp;up&nbsp;with&nbsp;fewer&nbsp;than&nbsp;n&nbsp;matches.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6056085">//&nbsp;If&nbsp;we&nbsp;don&#39;t&nbsp;have&nbsp;enough&nbsp;at&nbsp;the&nbsp;end,&nbsp;redo&nbsp;the&nbsp;search&nbsp;with&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6056150">//&nbsp;increased&nbsp;value&nbsp;n1,&nbsp;but&nbsp;only&nbsp;if&nbsp;Lookup&nbsp;returned&nbsp;all&nbsp;the&nbsp;requested</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6056221">//&nbsp;indices&nbsp;in&nbsp;the&nbsp;first&nbsp;place&nbsp;(if&nbsp;it&nbsp;returned&nbsp;fewer&nbsp;than&nbsp;that&nbsp;then</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6056290">//&nbsp;there&nbsp;cannot&nbsp;be&nbsp;more).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6056318">for</span>&nbsp;<span class="ident" id="6056322">n1</span>&nbsp;<span class="op" id="6056325">:=</span>&nbsp;<span class="ident" id="6056328">n</span><span class="op" id="6056329">;</span>&nbsp;<span class="op" id="6056331">;</span>&nbsp;<span class="ident" id="6056333">n1</span>&nbsp;<span class="op" id="6056336">+=</span>&nbsp;<span class="num" id="6056339">2</span>&nbsp;<span class="op" id="6056341">*</span>&nbsp;<span class="op" id="6056343">(</span><span class="ident" id="6056344">n</span>&nbsp;<span class="op" id="6056346">-</span>&nbsp;<span class="builtinfunc" id="6056348">len</span><span class="op" id="6056351">(</span><span class="ident" id="6056352">result</span><span class="op" id="6056358">)</span><span class="op" id="6056359">)</span>&nbsp;<span class="comment" id="6056361">/*&nbsp;overflow&nbsp;ok&nbsp;*/</span>&nbsp;<span class="op" id="6056379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6056384">indices</span>&nbsp;<span class="op" id="6056392">:=</span>&nbsp;<span class="ident" id="6056395">x</span><span class="op" id="6056396">.</span><span class="ident" id="6056397">Lookup</span><span class="op" id="6056403">(</span><span class="ident" id="6056404">lit</span><span class="op" id="6056407">,</span>&nbsp;<span class="ident" id="6056409">n1</span><span class="op" id="6056411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6056416">if</span>&nbsp;<span class="builtinfunc" id="6056419">len</span><span class="op" id="6056422">(</span><span class="ident" id="6056423">indices</span><span class="op" id="6056430">)</span>&nbsp;<span class="op" id="6056432">==</span>&nbsp;<span class="num" id="6056435">0</span>&nbsp;<span class="op" id="6056437">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6056443">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6056453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6056458">sort</span><span class="op" id="6056462">.</span><span class="ident" id="6056463">Ints</span><span class="op" id="6056467">(</span><span class="ident" id="6056468">indices</span><span class="op" id="6056475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6056480">pairs</span>&nbsp;<span class="op" id="6056486">:=</span>&nbsp;<span class="builtinfunc" id="6056489">make</span><span class="op" id="6056493">(</span><span class="op" id="6056494">[</span><span class="op" id="6056495">]</span><span class="builtintype" id="6056496">int</span><span class="op" id="6056499">,</span>&nbsp;<span class="num" id="6056501">2</span><span class="op" id="6056502">*</span><span class="builtinfunc" id="6056503">len</span><span class="op" id="6056506">(</span><span class="ident" id="6056507">indices</span><span class="op" id="6056514">)</span><span class="op" id="6056515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6056520">result</span>&nbsp;<span class="op" id="6056527">=</span>&nbsp;<span class="builtinfunc" id="6056529">make</span><span class="op" id="6056533">(</span><span class="op" id="6056534">[</span><span class="op" id="6056535">]</span><span class="op" id="6056536">[</span><span class="op" id="6056537">]</span><span class="builtintype" id="6056538">int</span><span class="op" id="6056541">,</span>&nbsp;<span class="builtinfunc" id="6056543">len</span><span class="op" id="6056546">(</span><span class="ident" id="6056547">indices</span><span class="op" id="6056554">)</span><span class="op" id="6056555">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6056560">count</span>&nbsp;<span class="op" id="6056566">:=</span>&nbsp;<span class="num" id="6056569">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6056574">prev</span>&nbsp;<span class="op" id="6056579">:=</span>&nbsp;<span class="num" id="6056582">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6056587">for</span>&nbsp;<span class="ident" id="6056591">_</span><span class="op" id="6056592">,</span>&nbsp;<span class="ident" id="6056594">i</span>&nbsp;<span class="op" id="6056596">:=</span>&nbsp;<span class="keyword" id="6056599">range</span>&nbsp;<span class="ident" id="6056605">indices</span>&nbsp;<span class="op" id="6056613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6056619">if</span>&nbsp;<span class="ident" id="6056622">count</span>&nbsp;<span class="op" id="6056628">==</span>&nbsp;<span class="ident" id="6056631">n</span>&nbsp;<span class="op" id="6056633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6056640">break</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6056650">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6056656">//&nbsp;ignore&nbsp;indices&nbsp;leading&nbsp;to&nbsp;overlapping&nbsp;matches</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6056709">if</span>&nbsp;<span class="ident" id="6056712">prev</span>&nbsp;<span class="op" id="6056717">&lt;=</span>&nbsp;<span class="ident" id="6056720">i</span>&nbsp;<span class="op" id="6056722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6056729">j</span>&nbsp;<span class="op" id="6056731">:=</span>&nbsp;<span class="num" id="6056734">2</span>&nbsp;<span class="op" id="6056736">*</span>&nbsp;<span class="ident" id="6056738">count</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6056749">pairs</span><span class="op" id="6056754">[</span><span class="ident" id="6056755">j</span><span class="op" id="6056756">+</span><span class="num" id="6056757">0</span><span class="op" id="6056758">]</span>&nbsp;<span class="op" id="6056760">=</span>&nbsp;<span class="ident" id="6056762">i</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6056769">pairs</span><span class="op" id="6056774">[</span><span class="ident" id="6056775">j</span><span class="op" id="6056776">+</span><span class="num" id="6056777">1</span><span class="op" id="6056778">]</span>&nbsp;<span class="op" id="6056780">=</span>&nbsp;<span class="ident" id="6056782">i</span>&nbsp;<span class="op" id="6056784">+</span>&nbsp;<span class="builtinfunc" id="6056786">len</span><span class="op" id="6056789">(</span><span class="ident" id="6056790">lit</span><span class="op" id="6056793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6056800">result</span><span class="op" id="6056806">[</span><span class="ident" id="6056807">count</span><span class="op" id="6056812">]</span>&nbsp;<span class="op" id="6056814">=</span>&nbsp;<span class="ident" id="6056816">pairs</span><span class="op" id="6056821">[</span><span class="ident" id="6056822">j</span>&nbsp;<span class="op" id="6056824">:</span>&nbsp;<span class="ident" id="6056826">j</span><span class="op" id="6056827">+</span><span class="num" id="6056828">2</span><span class="op" id="6056829">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6056836">count</span><span class="op" id="6056841">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6056849">prev</span>&nbsp;<span class="op" id="6056854">=</span>&nbsp;<span class="ident" id="6056856">i</span>&nbsp;<span class="op" id="6056858">+</span>&nbsp;<span class="builtinfunc" id="6056860">len</span><span class="op" id="6056863">(</span><span class="ident" id="6056864">lit</span><span class="op" id="6056867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6056873">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6056878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6056883">result</span>&nbsp;<span class="op" id="6056890">=</span>&nbsp;<span class="ident" id="6056892">result</span><span class="op" id="6056898">[</span><span class="num" id="6056899">0</span><span class="op" id="6056900">:</span><span class="ident" id="6056901">count</span><span class="op" id="6056906">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6056911">if</span>&nbsp;<span class="builtinfunc" id="6056914">len</span><span class="op" id="6056917">(</span><span class="ident" id="6056918">result</span><span class="op" id="6056924">)</span>&nbsp;<span class="op" id="6056926">&gt;=</span>&nbsp;<span class="ident" id="6056929">n</span>&nbsp;<span class="op" id="6056931">||</span>&nbsp;<span class="builtinfunc" id="6056934">len</span><span class="op" id="6056937">(</span><span class="ident" id="6056938">indices</span><span class="op" id="6056945">)</span>&nbsp;<span class="op" id="6056947">!=</span>&nbsp;<span class="ident" id="6056950">n1</span>&nbsp;<span class="op" id="6056953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6056959">//&nbsp;found&nbsp;all&nbsp;matches&nbsp;or&nbsp;there&#39;s&nbsp;no&nbsp;chance&nbsp;to&nbsp;find&nbsp;more</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6057018">//&nbsp;(n&nbsp;and&nbsp;n1&nbsp;can&nbsp;be&nbsp;negative)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6057052">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6057061">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6057065">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6057069">if</span>&nbsp;<span class="builtinfunc" id="6057072">len</span><span class="op" id="6057075">(</span><span class="ident" id="6057076">result</span><span class="op" id="6057082">)</span>&nbsp;<span class="op" id="6057084">==</span>&nbsp;<span class="num" id="6057087">0</span>&nbsp;<span class="op" id="6057089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6057094">result</span>&nbsp;<span class="op" id="6057101">=</span>&nbsp;<span class="ident" id="6057103">nil</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6057109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6057113">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6057121">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6057125">//&nbsp;regexp&nbsp;has&nbsp;a&nbsp;non-empty&nbsp;literal&nbsp;prefix;&nbsp;Lookup(lit)&nbsp;computes</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6057189">//&nbsp;the&nbsp;indices&nbsp;of&nbsp;possible&nbsp;complete&nbsp;matches;&nbsp;use&nbsp;these&nbsp;as&nbsp;starting</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6057257">//&nbsp;points&nbsp;for&nbsp;anchored&nbsp;searches</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6057290">//&nbsp;(regexp&nbsp;&#34;^&#34;&nbsp;matches&nbsp;beginning&nbsp;of&nbsp;input,&nbsp;not&nbsp;beginning&nbsp;of&nbsp;line)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6057357">r</span>&nbsp;<span class="op" id="6057359">=</span>&nbsp;<span class="ident" id="6057361">regexp</span><span class="op" id="6057367">.</span><span class="ident" id="6057368">MustCompile</span><span class="op" id="6057379">(</span><span class="string" id="6057380">&#34;^&#34;</span>&nbsp;<span class="op" id="6057384">+</span>&nbsp;<span class="ident" id="6057386">r</span><span class="op" id="6057387">.</span><span class="ident" id="6057388">String</span><span class="op" id="6057394">(</span><span class="op" id="6057395">)</span><span class="op" id="6057396">)</span>&nbsp;<span class="comment" id="6057398">//&nbsp;compiles&nbsp;because&nbsp;r&nbsp;compiled</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6057431">//&nbsp;same&nbsp;comment&nbsp;about&nbsp;Lookup&nbsp;applies&nbsp;here&nbsp;as&nbsp;in&nbsp;the&nbsp;loop&nbsp;above</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6057495">for</span>&nbsp;<span class="ident" id="6057499">n1</span>&nbsp;<span class="op" id="6057502">:=</span>&nbsp;<span class="ident" id="6057505">n</span><span class="op" id="6057506">;</span>&nbsp;<span class="op" id="6057508">;</span>&nbsp;<span class="ident" id="6057510">n1</span>&nbsp;<span class="op" id="6057513">+=</span>&nbsp;<span class="num" id="6057516">2</span>&nbsp;<span class="op" id="6057518">*</span>&nbsp;<span class="op" id="6057520">(</span><span class="ident" id="6057521">n</span>&nbsp;<span class="op" id="6057523">-</span>&nbsp;<span class="builtinfunc" id="6057525">len</span><span class="op" id="6057528">(</span><span class="ident" id="6057529">result</span><span class="op" id="6057535">)</span><span class="op" id="6057536">)</span>&nbsp;<span class="comment" id="6057538">/*&nbsp;overflow&nbsp;ok&nbsp;*/</span>&nbsp;<span class="op" id="6057556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6057560">indices</span>&nbsp;<span class="op" id="6057568">:=</span>&nbsp;<span class="ident" id="6057571">x</span><span class="op" id="6057572">.</span><span class="ident" id="6057573">Lookup</span><span class="op" id="6057579">(</span><span class="ident" id="6057580">lit</span><span class="op" id="6057583">,</span>&nbsp;<span class="ident" id="6057585">n1</span><span class="op" id="6057587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6057591">if</span>&nbsp;<span class="builtinfunc" id="6057594">len</span><span class="op" id="6057597">(</span><span class="ident" id="6057598">indices</span><span class="op" id="6057605">)</span>&nbsp;<span class="op" id="6057607">==</span>&nbsp;<span class="num" id="6057610">0</span>&nbsp;<span class="op" id="6057612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6057617">return</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6057626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6057630">sort</span><span class="op" id="6057634">.</span><span class="ident" id="6057635">Ints</span><span class="op" id="6057639">(</span><span class="ident" id="6057640">indices</span><span class="op" id="6057647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6057651">result</span>&nbsp;<span class="op" id="6057658">=</span>&nbsp;<span class="ident" id="6057660">result</span><span class="op" id="6057666">[</span><span class="num" id="6057667">0</span><span class="op" id="6057668">:</span><span class="num" id="6057669">0</span><span class="op" id="6057670">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6057674">prev</span>&nbsp;<span class="op" id="6057679">:=</span>&nbsp;<span class="num" id="6057682">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6057686">for</span>&nbsp;<span class="ident" id="6057690">_</span><span class="op" id="6057691">,</span>&nbsp;<span class="ident" id="6057693">i</span>&nbsp;<span class="op" id="6057695">:=</span>&nbsp;<span class="keyword" id="6057698">range</span>&nbsp;<span class="ident" id="6057704">indices</span>&nbsp;<span class="op" id="6057712">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6057717">if</span>&nbsp;<span class="builtinfunc" id="6057720">len</span><span class="op" id="6057723">(</span><span class="ident" id="6057724">result</span><span class="op" id="6057730">)</span>&nbsp;<span class="op" id="6057732">==</span>&nbsp;<span class="ident" id="6057735">n</span>&nbsp;<span class="op" id="6057737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6057743">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6057752">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6057757">m</span>&nbsp;<span class="op" id="6057759">:=</span>&nbsp;<span class="ident" id="6057762">r</span><span class="op" id="6057763">.</span><span class="ident" id="6057764">FindIndex</span><span class="op" id="6057773">(</span><span class="ident" id="6057774">x</span><span class="op" id="6057775">.</span><span class="ident" id="6057776">data</span><span class="op" id="6057780">[</span><span class="ident" id="6057781">i</span><span class="op" id="6057782">:</span><span class="op" id="6057783">]</span><span class="op" id="6057784">)</span>&nbsp;<span class="comment" id="6057786">//&nbsp;anchored&nbsp;search&nbsp;-&nbsp;will&nbsp;not&nbsp;run&nbsp;off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6057827">//&nbsp;ignore&nbsp;indices&nbsp;leading&nbsp;to&nbsp;overlapping&nbsp;matches</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6057879">if</span>&nbsp;<span class="ident" id="6057882">m</span>&nbsp;<span class="op" id="6057884">!=</span>&nbsp;<span class="ident" id="6057887">nil</span>&nbsp;<span class="op" id="6057891">&amp;&amp;</span>&nbsp;<span class="ident" id="6057894">prev</span>&nbsp;<span class="op" id="6057899">&lt;=</span>&nbsp;<span class="ident" id="6057902">i</span>&nbsp;<span class="op" id="6057904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6057910">m</span><span class="op" id="6057911">[</span><span class="num" id="6057912">0</span><span class="op" id="6057913">]</span>&nbsp;<span class="op" id="6057915">=</span>&nbsp;<span class="ident" id="6057917">i</span>&nbsp;<span class="comment" id="6057919">//&nbsp;correct&nbsp;m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6057936">m</span><span class="op" id="6057937">[</span><span class="num" id="6057938">1</span><span class="op" id="6057939">]</span>&nbsp;<span class="op" id="6057941">+=</span>&nbsp;<span class="ident" id="6057944">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6057950">result</span>&nbsp;<span class="op" id="6057957">=</span>&nbsp;<span class="builtinfunc" id="6057959">append</span><span class="op" id="6057965">(</span><span class="ident" id="6057966">result</span><span class="op" id="6057972">,</span>&nbsp;<span class="ident" id="6057974">m</span><span class="op" id="6057975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6057981">prev</span>&nbsp;<span class="op" id="6057986">=</span>&nbsp;<span class="ident" id="6057988">m</span><span class="op" id="6057989">[</span><span class="num" id="6057990">1</span><span class="op" id="6057991">]</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6057996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6058000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6058004">if</span>&nbsp;<span class="builtinfunc" id="6058007">len</span><span class="op" id="6058010">(</span><span class="ident" id="6058011">result</span><span class="op" id="6058017">)</span>&nbsp;<span class="op" id="6058019">&gt;=</span>&nbsp;<span class="ident" id="6058022">n</span>&nbsp;<span class="op" id="6058024">||</span>&nbsp;<span class="builtinfunc" id="6058027">len</span><span class="op" id="6058030">(</span><span class="ident" id="6058031">indices</span><span class="op" id="6058038">)</span>&nbsp;<span class="op" id="6058040">!=</span>&nbsp;<span class="ident" id="6058043">n1</span>&nbsp;<span class="op" id="6058046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6058051">//&nbsp;found&nbsp;all&nbsp;matches&nbsp;or&nbsp;there&#39;s&nbsp;no&nbsp;chance&nbsp;to&nbsp;find&nbsp;more</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6058109">//&nbsp;(n&nbsp;and&nbsp;n1&nbsp;can&nbsp;be&nbsp;negative)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6058142">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6058150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6058153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6058156">if</span>&nbsp;<span class="builtinfunc" id="6058159">len</span><span class="op" id="6058162">(</span><span class="ident" id="6058163">result</span><span class="op" id="6058169">)</span>&nbsp;<span class="op" id="6058171">==</span>&nbsp;<span class="num" id="6058174">0</span>&nbsp;<span class="op" id="6058176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6058180">result</span>&nbsp;<span class="op" id="6058187">=</span>&nbsp;<span class="ident" id="6058189">nil</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6058194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6058197">return</span><br>
<span class="lineno"></span><span class="op" id="6058204">}</span>
</div>
</body>
</html>
