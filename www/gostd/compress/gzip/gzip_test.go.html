<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/gzip</h2>
<ul>
<li><a href="/gostd/compress/gzip/gunzip.go.html">gunzip.go</a></li>
<li><a href="/gostd/compress/gzip/gunzip_test.go.html">gunzip_test.go</a></li>
<li><a href="/gostd/compress/gzip/gzip.go.html">gzip.go</a></li>
<li><a href="/gostd/compress/gzip/gzip_test.go.html" class="current">gzip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8522173">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8522228">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8522282">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8522333">package</span>&nbsp;<span class="ident" id="8522341">gzip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8522347">import</span>&nbsp;<span class="op" id="8522354">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8522357">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8522366">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8522375">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8522388">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8522399">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="8522406">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="8522409">//&nbsp;TestEmpty&nbsp;tests&nbsp;that&nbsp;an&nbsp;empty&nbsp;payload&nbsp;still&nbsp;forms&nbsp;a&nbsp;valid&nbsp;GZIP&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="8522483">func</span>&nbsp;<span class="ident" id="8522488">TestEmpty</span><span class="op" id="8522497">(</span><span class="ident" id="8522498">t</span>&nbsp;<span class="op" id="8522500">*</span><span class="ident" id="8522501">testing</span><span class="op" id="8522508">.</span><span class="ident" id="8522509">T</span><span class="op" id="8522510">)</span>&nbsp;<span class="op" id="8522512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8522515">buf</span>&nbsp;<span class="op" id="8522519">:=</span>&nbsp;<span class="builtinfunc" id="8522522">new</span><span class="op" id="8522525">(</span><span class="ident" id="8522526">bytes</span><span class="op" id="8522531">.</span><span class="ident" id="8522532">Buffer</span><span class="op" id="8522538">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8522542">if</span>&nbsp;<span class="ident" id="8522545">err</span>&nbsp;<span class="op" id="8522549">:=</span>&nbsp;<span class="ident" id="8522552">NewWriter</span><span class="op" id="8522561">(</span><span class="ident" id="8522562">buf</span><span class="op" id="8522565">)</span><span class="op" id="8522566">.</span><span class="ident" id="8522567">Close</span><span class="op" id="8522572">(</span><span class="op" id="8522573">)</span><span class="op" id="8522574">;</span>&nbsp;<span class="ident" id="8522576">err</span>&nbsp;<span class="op" id="8522580">!=</span>&nbsp;<span class="builtintype" id="8522583">nil</span>&nbsp;<span class="op" id="8522587">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8522591">t</span><span class="op" id="8522592">.</span><span class="ident" id="8522593">Fatalf</span><span class="op" id="8522599">(</span><span class="string" id="8522600">&#34;Writer.Close:&nbsp;%v&#34;</span><span class="op" id="8522618">,</span>&nbsp;<span class="ident" id="8522620">err</span><span class="op" id="8522623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8522626">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8522630">r</span><span class="op" id="8522631">,</span>&nbsp;<span class="ident" id="8522633">err</span>&nbsp;<span class="op" id="8522637">:=</span>&nbsp;<span class="ident" id="8522640">NewReader</span><span class="op" id="8522649">(</span><span class="ident" id="8522650">buf</span><span class="op" id="8522653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8522656">if</span>&nbsp;<span class="ident" id="8522659">err</span>&nbsp;<span class="op" id="8522663">!=</span>&nbsp;<span class="builtintype" id="8522666">nil</span>&nbsp;<span class="op" id="8522670">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8522674">t</span><span class="op" id="8522675">.</span><span class="ident" id="8522676">Fatalf</span><span class="op" id="8522682">(</span><span class="string" id="8522683">&#34;NewReader:&nbsp;%v&#34;</span><span class="op" id="8522698">,</span>&nbsp;<span class="ident" id="8522700">err</span><span class="op" id="8522703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8522706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8522709">b</span><span class="op" id="8522710">,</span>&nbsp;<span class="ident" id="8522712">err</span>&nbsp;<span class="op" id="8522716">:=</span>&nbsp;<span class="ident" id="8522719">ioutil</span><span class="op" id="8522725">.</span><span class="ident" id="8522726">ReadAll</span><span class="op" id="8522733">(</span><span class="ident" id="8522734">r</span><span class="op" id="8522735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8522738">if</span>&nbsp;<span class="ident" id="8522741">err</span>&nbsp;<span class="op" id="8522745">!=</span>&nbsp;<span class="builtintype" id="8522748">nil</span>&nbsp;<span class="op" id="8522752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8522756">t</span><span class="op" id="8522757">.</span><span class="ident" id="8522758">Fatalf</span><span class="op" id="8522764">(</span><span class="string" id="8522765">&#34;ReadAll:&nbsp;%v&#34;</span><span class="op" id="8522778">,</span>&nbsp;<span class="ident" id="8522780">err</span><span class="op" id="8522783">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8522786">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8522789">if</span>&nbsp;<span class="builtinfunc" id="8522792">len</span><span class="op" id="8522795">(</span><span class="ident" id="8522796">b</span><span class="op" id="8522797">)</span>&nbsp;<span class="op" id="8522799">!=</span>&nbsp;<span class="num" id="8522802">0</span>&nbsp;<span class="op" id="8522804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8522808">t</span><span class="op" id="8522809">.</span><span class="ident" id="8522810">Fatalf</span><span class="op" id="8522816">(</span><span class="string" id="8522817">&#34;got&nbsp;%d&nbsp;bytes,&nbsp;want&nbsp;0&#34;</span><span class="op" id="8522839">,</span>&nbsp;<span class="builtinfunc" id="8522841">len</span><span class="op" id="8522844">(</span><span class="ident" id="8522845">b</span><span class="op" id="8522846">)</span><span class="op" id="8522847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8522850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8522853">if</span>&nbsp;<span class="ident" id="8522856">err</span>&nbsp;<span class="op" id="8522860">:=</span>&nbsp;<span class="ident" id="8522863">r</span><span class="op" id="8522864">.</span><span class="ident" id="8522865">Close</span><span class="op" id="8522870">(</span><span class="op" id="8522871">)</span><span class="op" id="8522872">;</span>&nbsp;<span class="ident" id="8522874">err</span>&nbsp;<span class="op" id="8522878">!=</span>&nbsp;<span class="builtintype" id="8522881">nil</span>&nbsp;<span class="op" id="8522885">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8522889">t</span><span class="op" id="8522890">.</span><span class="ident" id="8522891">Fatalf</span><span class="op" id="8522897">(</span><span class="string" id="8522898">&#34;Reader.Close:&nbsp;%v&#34;</span><span class="op" id="8522916">,</span>&nbsp;<span class="ident" id="8522918">err</span><span class="op" id="8522921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8522924">}</span><br>
<span class="lineno"></span><span class="op" id="8522926">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8522929">//&nbsp;TestRoundTrip&nbsp;tests&nbsp;that&nbsp;gzipping&nbsp;and&nbsp;then&nbsp;gunzipping&nbsp;is&nbsp;the&nbsp;identity</span><br>
<span class="lineno">40</span><span class="comment" id="8523002">//&nbsp;function.</span><br>
<span class="lineno"></span><span class="keyword" id="8523015">func</span>&nbsp;<span class="ident" id="8523020">TestRoundTrip</span><span class="op" id="8523033">(</span><span class="ident" id="8523034">t</span>&nbsp;<span class="op" id="8523036">*</span><span class="ident" id="8523037">testing</span><span class="op" id="8523044">.</span><span class="ident" id="8523045">T</span><span class="op" id="8523046">)</span>&nbsp;<span class="op" id="8523048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8523051">buf</span>&nbsp;<span class="op" id="8523055">:=</span>&nbsp;<span class="builtinfunc" id="8523058">new</span><span class="op" id="8523061">(</span><span class="ident" id="8523062">bytes</span><span class="op" id="8523067">.</span><span class="ident" id="8523068">Buffer</span><span class="op" id="8523074">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8523078">w</span>&nbsp;<span class="op" id="8523080">:=</span>&nbsp;<span class="ident" id="8523083">NewWriter</span><span class="op" id="8523092">(</span><span class="ident" id="8523093">buf</span><span class="op" id="8523096">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8523099">w</span><span class="op" id="8523100">.</span><span class="ident" id="8523101">Comment</span>&nbsp;<span class="op" id="8523109">=</span>&nbsp;<span class="string" id="8523111">&#34;comment&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8523122">w</span><span class="op" id="8523123">.</span><span class="ident" id="8523124">Extra</span>&nbsp;<span class="op" id="8523130">=</span>&nbsp;<span class="op" id="8523132">[</span><span class="op" id="8523133">]</span><span class="builtintype" id="8523134">byte</span><span class="op" id="8523138">(</span><span class="string" id="8523139">&#34;extra&#34;</span><span class="op" id="8523146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8523149">w</span><span class="op" id="8523150">.</span><span class="ident" id="8523151">ModTime</span>&nbsp;<span class="op" id="8523159">=</span>&nbsp;<span class="ident" id="8523161">time</span><span class="op" id="8523165">.</span><span class="ident" id="8523166">Unix</span><span class="op" id="8523170">(</span><span class="num" id="8523171">1e8</span><span class="op" id="8523174">,</span>&nbsp;<span class="num" id="8523176">0</span><span class="op" id="8523177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8523180">w</span><span class="op" id="8523181">.</span><span class="ident" id="8523182">Name</span>&nbsp;<span class="op" id="8523187">=</span>&nbsp;<span class="string" id="8523189">&#34;name&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8523197">if</span>&nbsp;<span class="ident" id="8523200">_</span><span class="op" id="8523201">,</span>&nbsp;<span class="ident" id="8523203">err</span>&nbsp;<span class="op" id="8523207">:=</span>&nbsp;<span class="ident" id="8523210">w</span><span class="op" id="8523211">.</span><span class="ident" id="8523212">Write</span><span class="op" id="8523217">(</span><span class="op" id="8523218">[</span><span class="op" id="8523219">]</span><span class="builtintype" id="8523220">byte</span><span class="op" id="8523224">(</span><span class="string" id="8523225">&#34;payload&#34;</span><span class="op" id="8523234">)</span><span class="op" id="8523235">)</span><span class="op" id="8523236">;</span>&nbsp;<span class="ident" id="8523238">err</span>&nbsp;<span class="op" id="8523242">!=</span>&nbsp;<span class="builtintype" id="8523245">nil</span>&nbsp;<span class="op" id="8523249">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8523253">t</span><span class="op" id="8523254">.</span><span class="ident" id="8523255">Fatalf</span><span class="op" id="8523261">(</span><span class="string" id="8523262">&#34;Write:&nbsp;%v&#34;</span><span class="op" id="8523273">,</span>&nbsp;<span class="ident" id="8523275">err</span><span class="op" id="8523278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8523281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8523284">if</span>&nbsp;<span class="ident" id="8523287">err</span>&nbsp;<span class="op" id="8523291">:=</span>&nbsp;<span class="ident" id="8523294">w</span><span class="op" id="8523295">.</span><span class="ident" id="8523296">Close</span><span class="op" id="8523301">(</span><span class="op" id="8523302">)</span><span class="op" id="8523303">;</span>&nbsp;<span class="ident" id="8523305">err</span>&nbsp;<span class="op" id="8523309">!=</span>&nbsp;<span class="builtintype" id="8523312">nil</span>&nbsp;<span class="op" id="8523316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8523320">t</span><span class="op" id="8523321">.</span><span class="ident" id="8523322">Fatalf</span><span class="op" id="8523328">(</span><span class="string" id="8523329">&#34;Writer.Close:&nbsp;%v&#34;</span><span class="op" id="8523347">,</span>&nbsp;<span class="ident" id="8523349">err</span><span class="op" id="8523352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8523355">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8523359">r</span><span class="op" id="8523360">,</span>&nbsp;<span class="ident" id="8523362">err</span>&nbsp;<span class="op" id="8523366">:=</span>&nbsp;<span class="ident" id="8523369">NewReader</span><span class="op" id="8523378">(</span><span class="ident" id="8523379">buf</span><span class="op" id="8523382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8523385">if</span>&nbsp;<span class="ident" id="8523388">err</span>&nbsp;<span class="op" id="8523392">!=</span>&nbsp;<span class="builtintype" id="8523395">nil</span>&nbsp;<span class="op" id="8523399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8523403">t</span><span class="op" id="8523404">.</span><span class="ident" id="8523405">Fatalf</span><span class="op" id="8523411">(</span><span class="string" id="8523412">&#34;NewReader:&nbsp;%v&#34;</span><span class="op" id="8523427">,</span>&nbsp;<span class="ident" id="8523429">err</span><span class="op" id="8523432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8523435">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8523438">b</span><span class="op" id="8523439">,</span>&nbsp;<span class="ident" id="8523441">err</span>&nbsp;<span class="op" id="8523445">:=</span>&nbsp;<span class="ident" id="8523448">ioutil</span><span class="op" id="8523454">.</span><span class="ident" id="8523455">ReadAll</span><span class="op" id="8523462">(</span><span class="ident" id="8523463">r</span><span class="op" id="8523464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8523467">if</span>&nbsp;<span class="ident" id="8523470">err</span>&nbsp;<span class="op" id="8523474">!=</span>&nbsp;<span class="builtintype" id="8523477">nil</span>&nbsp;<span class="op" id="8523481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8523485">t</span><span class="op" id="8523486">.</span><span class="ident" id="8523487">Fatalf</span><span class="op" id="8523493">(</span><span class="string" id="8523494">&#34;ReadAll:&nbsp;%v&#34;</span><span class="op" id="8523507">,</span>&nbsp;<span class="ident" id="8523509">err</span><span class="op" id="8523512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8523515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8523518">if</span>&nbsp;<span class="builtintype" id="8523521">string</span><span class="op" id="8523527">(</span><span class="ident" id="8523528">b</span><span class="op" id="8523529">)</span>&nbsp;<span class="op" id="8523531">!=</span>&nbsp;<span class="string" id="8523534">&#34;payload&#34;</span>&nbsp;<span class="op" id="8523544">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8523548">t</span><span class="op" id="8523549">.</span><span class="ident" id="8523550">Fatalf</span><span class="op" id="8523556">(</span><span class="string" id="8523557">&#34;payload&nbsp;is&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8523581">,</span>&nbsp;<span class="builtintype" id="8523583">string</span><span class="op" id="8523589">(</span><span class="ident" id="8523590">b</span><span class="op" id="8523591">)</span><span class="op" id="8523592">,</span>&nbsp;<span class="string" id="8523594">&#34;payload&#34;</span><span class="op" id="8523603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8523606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8523609">if</span>&nbsp;<span class="ident" id="8523612">r</span><span class="op" id="8523613">.</span><span class="ident" id="8523614">Comment</span>&nbsp;<span class="op" id="8523622">!=</span>&nbsp;<span class="string" id="8523625">&#34;comment&#34;</span>&nbsp;<span class="op" id="8523635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8523639">t</span><span class="op" id="8523640">.</span><span class="ident" id="8523641">Fatalf</span><span class="op" id="8523647">(</span><span class="string" id="8523648">&#34;comment&nbsp;is&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8523672">,</span>&nbsp;<span class="ident" id="8523674">r</span><span class="op" id="8523675">.</span><span class="ident" id="8523676">Comment</span><span class="op" id="8523683">,</span>&nbsp;<span class="string" id="8523685">&#34;comment&#34;</span><span class="op" id="8523694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8523697">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8523700">if</span>&nbsp;<span class="builtintype" id="8523703">string</span><span class="op" id="8523709">(</span><span class="ident" id="8523710">r</span><span class="op" id="8523711">.</span><span class="ident" id="8523712">Extra</span><span class="op" id="8523717">)</span>&nbsp;<span class="op" id="8523719">!=</span>&nbsp;<span class="string" id="8523722">&#34;extra&#34;</span>&nbsp;<span class="op" id="8523730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8523734">t</span><span class="op" id="8523735">.</span><span class="ident" id="8523736">Fatalf</span><span class="op" id="8523742">(</span><span class="string" id="8523743">&#34;extra&nbsp;is&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8523765">,</span>&nbsp;<span class="ident" id="8523767">r</span><span class="op" id="8523768">.</span><span class="ident" id="8523769">Extra</span><span class="op" id="8523774">,</span>&nbsp;<span class="string" id="8523776">&#34;extra&#34;</span><span class="op" id="8523783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8523786">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8523789">if</span>&nbsp;<span class="ident" id="8523792">r</span><span class="op" id="8523793">.</span><span class="ident" id="8523794">ModTime</span><span class="op" id="8523801">.</span><span class="ident" id="8523802">Unix</span><span class="op" id="8523806">(</span><span class="op" id="8523807">)</span>&nbsp;<span class="op" id="8523809">!=</span>&nbsp;<span class="num" id="8523812">1e8</span>&nbsp;<span class="op" id="8523816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8523820">t</span><span class="op" id="8523821">.</span><span class="ident" id="8523822">Fatalf</span><span class="op" id="8523828">(</span><span class="string" id="8523829">&#34;mtime&nbsp;is&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8523851">,</span>&nbsp;<span class="ident" id="8523853">r</span><span class="op" id="8523854">.</span><span class="ident" id="8523855">ModTime</span><span class="op" id="8523862">.</span><span class="ident" id="8523863">Unix</span><span class="op" id="8523867">(</span><span class="op" id="8523868">)</span><span class="op" id="8523869">,</span>&nbsp;<span class="builtintype" id="8523871">uint32</span><span class="op" id="8523877">(</span><span class="num" id="8523878">1e8</span><span class="op" id="8523881">)</span><span class="op" id="8523882">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8523885">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8523888">if</span>&nbsp;<span class="ident" id="8523891">r</span><span class="op" id="8523892">.</span><span class="ident" id="8523893">Name</span>&nbsp;<span class="op" id="8523898">!=</span>&nbsp;<span class="string" id="8523901">&#34;name&#34;</span>&nbsp;<span class="op" id="8523908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8523912">t</span><span class="op" id="8523913">.</span><span class="ident" id="8523914">Fatalf</span><span class="op" id="8523920">(</span><span class="string" id="8523921">&#34;name&nbsp;is&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8523942">,</span>&nbsp;<span class="ident" id="8523944">r</span><span class="op" id="8523945">.</span><span class="ident" id="8523946">Name</span><span class="op" id="8523950">,</span>&nbsp;<span class="string" id="8523952">&#34;name&#34;</span><span class="op" id="8523958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8523961">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8523964">if</span>&nbsp;<span class="ident" id="8523967">err</span>&nbsp;<span class="op" id="8523971">:=</span>&nbsp;<span class="ident" id="8523974">r</span><span class="op" id="8523975">.</span><span class="ident" id="8523976">Close</span><span class="op" id="8523981">(</span><span class="op" id="8523982">)</span><span class="op" id="8523983">;</span>&nbsp;<span class="ident" id="8523985">err</span>&nbsp;<span class="op" id="8523989">!=</span>&nbsp;<span class="builtintype" id="8523992">nil</span>&nbsp;<span class="op" id="8523996">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8524000">t</span><span class="op" id="8524001">.</span><span class="ident" id="8524002">Fatalf</span><span class="op" id="8524008">(</span><span class="string" id="8524009">&#34;Reader.Close:&nbsp;%v&#34;</span><span class="op" id="8524027">,</span>&nbsp;<span class="ident" id="8524029">err</span><span class="op" id="8524032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8524035">}</span><br>
<span class="lineno"></span><span class="op" id="8524037">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8524040">//&nbsp;TestLatin1&nbsp;tests&nbsp;the&nbsp;internal&nbsp;functions&nbsp;for&nbsp;converting&nbsp;to&nbsp;and&nbsp;from&nbsp;Latin-1.</span><br>
<span class="lineno">85</span><span class="keyword" id="8524119">func</span>&nbsp;<span class="ident" id="8524124">TestLatin1</span><span class="op" id="8524134">(</span><span class="ident" id="8524135">t</span>&nbsp;<span class="op" id="8524137">*</span><span class="ident" id="8524138">testing</span><span class="op" id="8524145">.</span><span class="ident" id="8524146">T</span><span class="op" id="8524147">)</span>&nbsp;<span class="op" id="8524149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8524152">latin1</span>&nbsp;<span class="op" id="8524159">:=</span>&nbsp;<span class="op" id="8524162">[</span><span class="op" id="8524163">]</span><span class="builtintype" id="8524164">byte</span><span class="op" id="8524168">{</span><span class="num" id="8524169">0xc4</span><span class="op" id="8524173">,</span>&nbsp;<span class="string" id="8524175">&#39;u&#39;</span><span class="op" id="8524178">,</span>&nbsp;<span class="num" id="8524180">0xdf</span><span class="op" id="8524184">,</span>&nbsp;<span class="string" id="8524186">&#39;e&#39;</span><span class="op" id="8524189">,</span>&nbsp;<span class="string" id="8524191">&#39;r&#39;</span><span class="op" id="8524194">,</span>&nbsp;<span class="string" id="8524196">&#39;u&#39;</span><span class="op" id="8524199">,</span>&nbsp;<span class="string" id="8524201">&#39;n&#39;</span><span class="op" id="8524204">,</span>&nbsp;<span class="string" id="8524206">&#39;g&#39;</span><span class="op" id="8524209">,</span>&nbsp;<span class="num" id="8524211">0</span><span class="op" id="8524212">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8524215">utf8</span>&nbsp;<span class="op" id="8524220">:=</span>&nbsp;<span class="string" id="8524223">&#34;Äußerung&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8524237">z</span>&nbsp;<span class="op" id="8524239">:=</span>&nbsp;<span class="ident" id="8524242">Reader</span><span class="op" id="8524248">{</span><span class="ident" id="8524249">r</span><span class="op" id="8524250">:</span>&nbsp;<span class="ident" id="8524252">bufio</span><span class="op" id="8524257">.</span><span class="ident" id="8524258">NewReader</span><span class="op" id="8524267">(</span><span class="ident" id="8524268">bytes</span><span class="op" id="8524273">.</span><span class="ident" id="8524274">NewReader</span><span class="op" id="8524283">(</span><span class="ident" id="8524284">latin1</span><span class="op" id="8524290">)</span><span class="op" id="8524291">)</span><span class="op" id="8524292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8524295">s</span><span class="op" id="8524296">,</span>&nbsp;<span class="ident" id="8524298">err</span>&nbsp;<span class="op" id="8524302">:=</span>&nbsp;<span class="ident" id="8524305">z</span><span class="op" id="8524306">.</span><span class="ident" id="8524307">readString</span><span class="op" id="8524317">(</span><span class="op" id="8524318">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8524321">if</span>&nbsp;<span class="ident" id="8524324">err</span>&nbsp;<span class="op" id="8524328">!=</span>&nbsp;<span class="builtintype" id="8524331">nil</span>&nbsp;<span class="op" id="8524335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8524339">t</span><span class="op" id="8524340">.</span><span class="ident" id="8524341">Fatalf</span><span class="op" id="8524347">(</span><span class="string" id="8524348">&#34;readString:&nbsp;%v&#34;</span><span class="op" id="8524364">,</span>&nbsp;<span class="ident" id="8524366">err</span><span class="op" id="8524369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8524372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8524375">if</span>&nbsp;<span class="ident" id="8524378">s</span>&nbsp;<span class="op" id="8524380">!=</span>&nbsp;<span class="ident" id="8524383">utf8</span>&nbsp;<span class="op" id="8524388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8524392">t</span><span class="op" id="8524393">.</span><span class="ident" id="8524394">Fatalf</span><span class="op" id="8524400">(</span><span class="string" id="8524401">&#34;read&nbsp;latin-1:&nbsp;got&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8524432">,</span>&nbsp;<span class="ident" id="8524434">s</span><span class="op" id="8524435">,</span>&nbsp;<span class="ident" id="8524437">utf8</span><span class="op" id="8524441">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8524444">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8524448">buf</span>&nbsp;<span class="op" id="8524452">:=</span>&nbsp;<span class="ident" id="8524455">bytes</span><span class="op" id="8524460">.</span><span class="ident" id="8524461">NewBuffer</span><span class="op" id="8524470">(</span><span class="builtinfunc" id="8524471">make</span><span class="op" id="8524475">(</span><span class="op" id="8524476">[</span><span class="op" id="8524477">]</span><span class="builtintype" id="8524478">byte</span><span class="op" id="8524482">,</span>&nbsp;<span class="num" id="8524484">0</span><span class="op" id="8524485">,</span>&nbsp;<span class="builtinfunc" id="8524487">len</span><span class="op" id="8524490">(</span><span class="ident" id="8524491">latin1</span><span class="op" id="8524497">)</span><span class="op" id="8524498">)</span><span class="op" id="8524499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8524502">c</span>&nbsp;<span class="op" id="8524504">:=</span>&nbsp;<span class="ident" id="8524507">Writer</span><span class="op" id="8524513">{</span><span class="ident" id="8524514">w</span><span class="op" id="8524515">:</span>&nbsp;<span class="ident" id="8524517">buf</span><span class="op" id="8524520">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8524523">if</span>&nbsp;<span class="ident" id="8524526">err</span>&nbsp;<span class="op" id="8524530">=</span>&nbsp;<span class="ident" id="8524532">c</span><span class="op" id="8524533">.</span><span class="ident" id="8524534">writeString</span><span class="op" id="8524545">(</span><span class="ident" id="8524546">utf8</span><span class="op" id="8524550">)</span><span class="op" id="8524551">;</span>&nbsp;<span class="ident" id="8524553">err</span>&nbsp;<span class="op" id="8524557">!=</span>&nbsp;<span class="builtintype" id="8524560">nil</span>&nbsp;<span class="op" id="8524564">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8524568">t</span><span class="op" id="8524569">.</span><span class="ident" id="8524570">Fatalf</span><span class="op" id="8524576">(</span><span class="string" id="8524577">&#34;writeString:&nbsp;%v&#34;</span><span class="op" id="8524594">,</span>&nbsp;<span class="ident" id="8524596">err</span><span class="op" id="8524599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8524602">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8524605">s</span>&nbsp;<span class="op" id="8524607">=</span>&nbsp;<span class="ident" id="8524609">buf</span><span class="op" id="8524612">.</span><span class="ident" id="8524613">String</span><span class="op" id="8524619">(</span><span class="op" id="8524620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8524623">if</span>&nbsp;<span class="ident" id="8524626">s</span>&nbsp;<span class="op" id="8524628">!=</span>&nbsp;<span class="builtintype" id="8524631">string</span><span class="op" id="8524637">(</span><span class="ident" id="8524638">latin1</span><span class="op" id="8524644">)</span>&nbsp;<span class="op" id="8524646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8524650">t</span><span class="op" id="8524651">.</span><span class="ident" id="8524652">Fatalf</span><span class="op" id="8524658">(</span><span class="string" id="8524659">&#34;write&nbsp;utf-8:&nbsp;got&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8524689">,</span>&nbsp;<span class="ident" id="8524691">s</span><span class="op" id="8524692">,</span>&nbsp;<span class="builtintype" id="8524694">string</span><span class="op" id="8524700">(</span><span class="ident" id="8524701">latin1</span><span class="op" id="8524707">)</span><span class="op" id="8524708">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8524711">}</span><br>
<span class="lineno"></span><span class="op" id="8524713">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8524716">//&nbsp;TestLatin1RoundTrip&nbsp;tests&nbsp;that&nbsp;metadata&nbsp;that&nbsp;is&nbsp;representable&nbsp;in&nbsp;Latin-1</span><br>
<span class="lineno"></span><span class="comment" id="8524792">//&nbsp;survives&nbsp;a&nbsp;round&nbsp;trip.</span><br>
<span class="lineno">110</span><span class="keyword" id="8524818">func</span>&nbsp;<span class="ident" id="8524823">TestLatin1RoundTrip</span><span class="op" id="8524842">(</span><span class="ident" id="8524843">t</span>&nbsp;<span class="op" id="8524845">*</span><span class="ident" id="8524846">testing</span><span class="op" id="8524853">.</span><span class="ident" id="8524854">T</span><span class="op" id="8524855">)</span>&nbsp;<span class="op" id="8524857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8524860">testCases</span>&nbsp;<span class="op" id="8524870">:=</span>&nbsp;<span class="op" id="8524873">[</span><span class="op" id="8524874">]</span><span class="keyword" id="8524875">struct</span>&nbsp;<span class="op" id="8524882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8524886">name</span>&nbsp;<span class="builtintype" id="8524891">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8524900">ok</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8524905">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8524911">}</span><span class="op" id="8524912">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8524916">{</span><span class="string" id="8524917">&#34;&#34;</span><span class="op" id="8524919">,</span>&nbsp;<span class="builtintype" id="8524921">true</span><span class="op" id="8524925">}</span><span class="op" id="8524926">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8524930">{</span><span class="string" id="8524931">&#34;ASCII&nbsp;is&nbsp;OK&#34;</span><span class="op" id="8524944">,</span>&nbsp;<span class="builtintype" id="8524946">true</span><span class="op" id="8524950">}</span><span class="op" id="8524951">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8524955">{</span><span class="string" id="8524956">&#34;unless&nbsp;it&nbsp;contains&nbsp;a&nbsp;NUL\x00&#34;</span><span class="op" id="8524986">,</span>&nbsp;<span class="builtintype" id="8524988">false</span><span class="op" id="8524993">}</span><span class="op" id="8524994">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8524998">{</span><span class="string" id="8524999">&#34;no&nbsp;matter&nbsp;where&nbsp;\x00&nbsp;occurs&#34;</span><span class="op" id="8525028">,</span>&nbsp;<span class="builtintype" id="8525030">false</span><span class="op" id="8525035">}</span><span class="op" id="8525036">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8525040">{</span><span class="string" id="8525041">&#34;\x00\x00\x00&#34;</span><span class="op" id="8525055">,</span>&nbsp;<span class="builtintype" id="8525057">false</span><span class="op" id="8525062">}</span><span class="op" id="8525063">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8525067">{</span><span class="string" id="8525068">&#34;Látin-1&nbsp;also&nbsp;passes&nbsp;(U+00E1)&#34;</span><span class="op" id="8525099">,</span>&nbsp;<span class="builtintype" id="8525101">true</span><span class="op" id="8525105">}</span><span class="op" id="8525106">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8525110">{</span><span class="string" id="8525111">&#34;but&nbsp;LĀtin&nbsp;Extended-A&nbsp;(U+0100)&nbsp;does&nbsp;not&#34;</span><span class="op" id="8525152">,</span>&nbsp;<span class="builtintype" id="8525154">false</span><span class="op" id="8525159">}</span><span class="op" id="8525160">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8525164">{</span><span class="string" id="8525165">&#34;neither&nbsp;does&nbsp;日本語&#34;</span><span class="op" id="8525189">,</span>&nbsp;<span class="builtintype" id="8525191">false</span><span class="op" id="8525196">}</span><span class="op" id="8525197">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8525201">{</span><span class="string" id="8525202">&#34;invalid&nbsp;UTF-8&nbsp;also&nbsp;\xffails&#34;</span><span class="op" id="8525231">,</span>&nbsp;<span class="builtintype" id="8525233">false</span><span class="op" id="8525238">}</span><span class="op" id="8525239">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8525243">{</span><span class="string" id="8525244">&#34;\x00&nbsp;as&nbsp;does&nbsp;Látin-1&nbsp;with&nbsp;NUL&#34;</span><span class="op" id="8525276">,</span>&nbsp;<span class="builtintype" id="8525278">false</span><span class="op" id="8525283">}</span><span class="op" id="8525284">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8525287">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8525290">for</span>&nbsp;<span class="ident" id="8525294">_</span><span class="op" id="8525295">,</span>&nbsp;<span class="ident" id="8525297">tc</span>&nbsp;<span class="op" id="8525300">:=</span>&nbsp;<span class="keyword" id="8525303">range</span>&nbsp;<span class="ident" id="8525309">testCases</span>&nbsp;<span class="op" id="8525319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8525323">buf</span>&nbsp;<span class="op" id="8525327">:=</span>&nbsp;<span class="builtinfunc" id="8525330">new</span><span class="op" id="8525333">(</span><span class="ident" id="8525334">bytes</span><span class="op" id="8525339">.</span><span class="ident" id="8525340">Buffer</span><span class="op" id="8525346">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8525351">w</span>&nbsp;<span class="op" id="8525353">:=</span>&nbsp;<span class="ident" id="8525356">NewWriter</span><span class="op" id="8525365">(</span><span class="ident" id="8525366">buf</span><span class="op" id="8525369">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8525373">w</span><span class="op" id="8525374">.</span><span class="ident" id="8525375">Name</span>&nbsp;<span class="op" id="8525380">=</span>&nbsp;<span class="ident" id="8525382">tc</span><span class="op" id="8525384">.</span><span class="ident" id="8525385">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8525392">err</span>&nbsp;<span class="op" id="8525396">:=</span>&nbsp;<span class="ident" id="8525399">w</span><span class="op" id="8525400">.</span><span class="ident" id="8525401">Close</span><span class="op" id="8525406">(</span><span class="op" id="8525407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8525411">if</span>&nbsp;<span class="op" id="8525414">(</span><span class="ident" id="8525415">err</span>&nbsp;<span class="op" id="8525419">==</span>&nbsp;<span class="builtintype" id="8525422">nil</span><span class="op" id="8525425">)</span>&nbsp;<span class="op" id="8525427">!=</span>&nbsp;<span class="ident" id="8525430">tc</span><span class="op" id="8525432">.</span><span class="ident" id="8525433">ok</span>&nbsp;<span class="op" id="8525436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8525441">t</span><span class="op" id="8525442">.</span><span class="ident" id="8525443">Errorf</span><span class="op" id="8525449">(</span><span class="string" id="8525450">&#34;Writer.Close:&nbsp;name&nbsp;=&nbsp;%q,&nbsp;err&nbsp;=&nbsp;%v&#34;</span><span class="op" id="8525485">,</span>&nbsp;<span class="ident" id="8525487">tc</span><span class="op" id="8525489">.</span><span class="ident" id="8525490">name</span><span class="op" id="8525494">,</span>&nbsp;<span class="ident" id="8525496">err</span><span class="op" id="8525499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8525504">continue</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8525515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8525519">if</span>&nbsp;<span class="op" id="8525522">!</span><span class="ident" id="8525523">tc</span><span class="op" id="8525525">.</span><span class="ident" id="8525526">ok</span>&nbsp;<span class="op" id="8525529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8525534">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8525545">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8525550">r</span><span class="op" id="8525551">,</span>&nbsp;<span class="ident" id="8525553">err</span>&nbsp;<span class="op" id="8525557">:=</span>&nbsp;<span class="ident" id="8525560">NewReader</span><span class="op" id="8525569">(</span><span class="ident" id="8525570">buf</span><span class="op" id="8525573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8525577">if</span>&nbsp;<span class="ident" id="8525580">err</span>&nbsp;<span class="op" id="8525584">!=</span>&nbsp;<span class="builtintype" id="8525587">nil</span>&nbsp;<span class="op" id="8525591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8525596">t</span><span class="op" id="8525597">.</span><span class="ident" id="8525598">Errorf</span><span class="op" id="8525604">(</span><span class="string" id="8525605">&#34;NewReader:&nbsp;%v&#34;</span><span class="op" id="8525620">,</span>&nbsp;<span class="ident" id="8525622">err</span><span class="op" id="8525625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8525630">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8525641">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8525645">_</span><span class="op" id="8525646">,</span>&nbsp;<span class="ident" id="8525648">err</span>&nbsp;<span class="op" id="8525652">=</span>&nbsp;<span class="ident" id="8525654">ioutil</span><span class="op" id="8525660">.</span><span class="ident" id="8525661">ReadAll</span><span class="op" id="8525668">(</span><span class="ident" id="8525669">r</span><span class="op" id="8525670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8525674">if</span>&nbsp;<span class="ident" id="8525677">err</span>&nbsp;<span class="op" id="8525681">!=</span>&nbsp;<span class="builtintype" id="8525684">nil</span>&nbsp;<span class="op" id="8525688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8525693">t</span><span class="op" id="8525694">.</span><span class="ident" id="8525695">Errorf</span><span class="op" id="8525701">(</span><span class="string" id="8525702">&#34;ReadAll:&nbsp;%v&#34;</span><span class="op" id="8525715">,</span>&nbsp;<span class="ident" id="8525717">err</span><span class="op" id="8525720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8525725">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8525736">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8525740">if</span>&nbsp;<span class="ident" id="8525743">r</span><span class="op" id="8525744">.</span><span class="ident" id="8525745">Name</span>&nbsp;<span class="op" id="8525750">!=</span>&nbsp;<span class="ident" id="8525753">tc</span><span class="op" id="8525755">.</span><span class="ident" id="8525756">name</span>&nbsp;<span class="op" id="8525761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8525766">t</span><span class="op" id="8525767">.</span><span class="ident" id="8525768">Errorf</span><span class="op" id="8525774">(</span><span class="string" id="8525775">&#34;name&nbsp;is&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8525796">,</span>&nbsp;<span class="ident" id="8525798">r</span><span class="op" id="8525799">.</span><span class="ident" id="8525800">Name</span><span class="op" id="8525804">,</span>&nbsp;<span class="ident" id="8525806">tc</span><span class="op" id="8525808">.</span><span class="ident" id="8525809">name</span><span class="op" id="8525813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8525818">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8525829">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8525833">if</span>&nbsp;<span class="ident" id="8525836">err</span>&nbsp;<span class="op" id="8525840">:=</span>&nbsp;<span class="ident" id="8525843">r</span><span class="op" id="8525844">.</span><span class="ident" id="8525845">Close</span><span class="op" id="8525850">(</span><span class="op" id="8525851">)</span><span class="op" id="8525852">;</span>&nbsp;<span class="ident" id="8525854">err</span>&nbsp;<span class="op" id="8525858">!=</span>&nbsp;<span class="builtintype" id="8525861">nil</span>&nbsp;<span class="op" id="8525865">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8525870">t</span><span class="op" id="8525871">.</span><span class="ident" id="8525872">Errorf</span><span class="op" id="8525878">(</span><span class="string" id="8525879">&#34;Reader.Close:&nbsp;%v&#34;</span><span class="op" id="8525897">,</span>&nbsp;<span class="ident" id="8525899">err</span><span class="op" id="8525902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8525907">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8525918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8525921">}</span><br>
<span class="lineno"></span><span class="op" id="8525923">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="keyword" id="8525926">func</span>&nbsp;<span class="ident" id="8525931">TestWriterFlush</span><span class="op" id="8525946">(</span><span class="ident" id="8525947">t</span>&nbsp;<span class="op" id="8525949">*</span><span class="ident" id="8525950">testing</span><span class="op" id="8525957">.</span><span class="ident" id="8525958">T</span><span class="op" id="8525959">)</span>&nbsp;<span class="op" id="8525961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8525964">buf</span>&nbsp;<span class="op" id="8525968">:=</span>&nbsp;<span class="builtinfunc" id="8525971">new</span><span class="op" id="8525974">(</span><span class="ident" id="8525975">bytes</span><span class="op" id="8525980">.</span><span class="ident" id="8525981">Buffer</span><span class="op" id="8525987">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8525991">w</span>&nbsp;<span class="op" id="8525993">:=</span>&nbsp;<span class="ident" id="8525996">NewWriter</span><span class="op" id="8526005">(</span><span class="ident" id="8526006">buf</span><span class="op" id="8526009">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8526012">w</span><span class="op" id="8526013">.</span><span class="ident" id="8526014">Comment</span>&nbsp;<span class="op" id="8526022">=</span>&nbsp;<span class="string" id="8526024">&#34;comment&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8526035">w</span><span class="op" id="8526036">.</span><span class="ident" id="8526037">Extra</span>&nbsp;<span class="op" id="8526043">=</span>&nbsp;<span class="op" id="8526045">[</span><span class="op" id="8526046">]</span><span class="builtintype" id="8526047">byte</span><span class="op" id="8526051">(</span><span class="string" id="8526052">&#34;extra&#34;</span><span class="op" id="8526059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8526062">w</span><span class="op" id="8526063">.</span><span class="ident" id="8526064">ModTime</span>&nbsp;<span class="op" id="8526072">=</span>&nbsp;<span class="ident" id="8526074">time</span><span class="op" id="8526078">.</span><span class="ident" id="8526079">Unix</span><span class="op" id="8526083">(</span><span class="num" id="8526084">1e8</span><span class="op" id="8526087">,</span>&nbsp;<span class="num" id="8526089">0</span><span class="op" id="8526090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8526093">w</span><span class="op" id="8526094">.</span><span class="ident" id="8526095">Name</span>&nbsp;<span class="op" id="8526100">=</span>&nbsp;<span class="string" id="8526102">&#34;name&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8526111">n0</span>&nbsp;<span class="op" id="8526114">:=</span>&nbsp;<span class="ident" id="8526117">buf</span><span class="op" id="8526120">.</span><span class="ident" id="8526121">Len</span><span class="op" id="8526124">(</span><span class="op" id="8526125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8526128">if</span>&nbsp;<span class="ident" id="8526131">n0</span>&nbsp;<span class="op" id="8526134">!=</span>&nbsp;<span class="num" id="8526137">0</span>&nbsp;<span class="op" id="8526139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8526143">t</span><span class="op" id="8526144">.</span><span class="ident" id="8526145">Fatalf</span><span class="op" id="8526151">(</span><span class="string" id="8526152">&#34;buffer&nbsp;size&nbsp;=&nbsp;%d&nbsp;before&nbsp;writes;&nbsp;want&nbsp;0&#34;</span><span class="op" id="8526192">,</span>&nbsp;<span class="ident" id="8526194">n0</span><span class="op" id="8526196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8526199">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8526203">if</span>&nbsp;<span class="ident" id="8526206">err</span>&nbsp;<span class="op" id="8526210">:=</span>&nbsp;<span class="ident" id="8526213">w</span><span class="op" id="8526214">.</span><span class="ident" id="8526215">Flush</span><span class="op" id="8526220">(</span><span class="op" id="8526221">)</span><span class="op" id="8526222">;</span>&nbsp;<span class="ident" id="8526224">err</span>&nbsp;<span class="op" id="8526228">!=</span>&nbsp;<span class="builtintype" id="8526231">nil</span>&nbsp;<span class="op" id="8526235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8526239">t</span><span class="op" id="8526240">.</span><span class="ident" id="8526241">Fatal</span><span class="op" id="8526246">(</span><span class="ident" id="8526247">err</span><span class="op" id="8526250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8526253">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8526257">n1</span>&nbsp;<span class="op" id="8526260">:=</span>&nbsp;<span class="ident" id="8526263">buf</span><span class="op" id="8526266">.</span><span class="ident" id="8526267">Len</span><span class="op" id="8526270">(</span><span class="op" id="8526271">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8526274">if</span>&nbsp;<span class="ident" id="8526277">n1</span>&nbsp;<span class="op" id="8526280">==</span>&nbsp;<span class="num" id="8526283">0</span>&nbsp;<span class="op" id="8526285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8526289">t</span><span class="op" id="8526290">.</span><span class="ident" id="8526291">Fatal</span><span class="op" id="8526296">(</span><span class="string" id="8526297">&#34;no&nbsp;data&nbsp;after&nbsp;first&nbsp;flush&#34;</span><span class="op" id="8526324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8526327">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8526331">w</span><span class="op" id="8526332">.</span><span class="ident" id="8526333">Write</span><span class="op" id="8526338">(</span><span class="op" id="8526339">[</span><span class="op" id="8526340">]</span><span class="builtintype" id="8526341">byte</span><span class="op" id="8526345">(</span><span class="string" id="8526346">&#34;x&#34;</span><span class="op" id="8526349">)</span><span class="op" id="8526350">)</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8526354">n2</span>&nbsp;<span class="op" id="8526357">:=</span>&nbsp;<span class="ident" id="8526360">buf</span><span class="op" id="8526363">.</span><span class="ident" id="8526364">Len</span><span class="op" id="8526367">(</span><span class="op" id="8526368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8526371">if</span>&nbsp;<span class="ident" id="8526374">n1</span>&nbsp;<span class="op" id="8526377">!=</span>&nbsp;<span class="ident" id="8526380">n2</span>&nbsp;<span class="op" id="8526383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8526387">t</span><span class="op" id="8526388">.</span><span class="ident" id="8526389">Fatalf</span><span class="op" id="8526395">(</span><span class="string" id="8526396">&#34;after&nbsp;writing&nbsp;a&nbsp;single&nbsp;byte,&nbsp;size&nbsp;changed&nbsp;from&nbsp;%d&nbsp;to&nbsp;%d;&nbsp;want&nbsp;no&nbsp;change&#34;</span><span class="op" id="8526469">,</span>&nbsp;<span class="ident" id="8526471">n1</span><span class="op" id="8526473">,</span>&nbsp;<span class="ident" id="8526475">n2</span><span class="op" id="8526477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8526480">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8526484">if</span>&nbsp;<span class="ident" id="8526487">err</span>&nbsp;<span class="op" id="8526491">:=</span>&nbsp;<span class="ident" id="8526494">w</span><span class="op" id="8526495">.</span><span class="ident" id="8526496">Flush</span><span class="op" id="8526501">(</span><span class="op" id="8526502">)</span><span class="op" id="8526503">;</span>&nbsp;<span class="ident" id="8526505">err</span>&nbsp;<span class="op" id="8526509">!=</span>&nbsp;<span class="builtintype" id="8526512">nil</span>&nbsp;<span class="op" id="8526516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8526520">t</span><span class="op" id="8526521">.</span><span class="ident" id="8526522">Fatal</span><span class="op" id="8526527">(</span><span class="ident" id="8526528">err</span><span class="op" id="8526531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8526534">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8526538">n3</span>&nbsp;<span class="op" id="8526541">:=</span>&nbsp;<span class="ident" id="8526544">buf</span><span class="op" id="8526547">.</span><span class="ident" id="8526548">Len</span><span class="op" id="8526551">(</span><span class="op" id="8526552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8526555">if</span>&nbsp;<span class="ident" id="8526558">n2</span>&nbsp;<span class="op" id="8526561">==</span>&nbsp;<span class="ident" id="8526564">n3</span>&nbsp;<span class="op" id="8526567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8526571">t</span><span class="op" id="8526572">.</span><span class="ident" id="8526573">Fatal</span><span class="op" id="8526578">(</span><span class="string" id="8526579">&#34;Flush&nbsp;didn&#39;t&nbsp;flush&nbsp;any&nbsp;data&#34;</span><span class="op" id="8526608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8526611">}</span><br>
<span class="lineno"></span><span class="op" id="8526613">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="comment" id="8526616">//&nbsp;Multiple&nbsp;gzip&nbsp;files&nbsp;concatenated&nbsp;form&nbsp;a&nbsp;valid&nbsp;gzip&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="8526676">func</span>&nbsp;<span class="ident" id="8526681">TestConcat</span><span class="op" id="8526691">(</span><span class="ident" id="8526692">t</span>&nbsp;<span class="op" id="8526694">*</span><span class="ident" id="8526695">testing</span><span class="op" id="8526702">.</span><span class="ident" id="8526703">T</span><span class="op" id="8526704">)</span>&nbsp;<span class="op" id="8526706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8526709">var</span>&nbsp;<span class="ident" id="8526713">buf</span>&nbsp;<span class="ident" id="8526717">bytes</span><span class="op" id="8526722">.</span><span class="ident" id="8526723">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8526731">w</span>&nbsp;<span class="op" id="8526733">:=</span>&nbsp;<span class="ident" id="8526736">NewWriter</span><span class="op" id="8526745">(</span><span class="op" id="8526746">&amp;</span><span class="ident" id="8526747">buf</span><span class="op" id="8526750">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8526753">w</span><span class="op" id="8526754">.</span><span class="ident" id="8526755">Write</span><span class="op" id="8526760">(</span><span class="op" id="8526761">[</span><span class="op" id="8526762">]</span><span class="builtintype" id="8526763">byte</span><span class="op" id="8526767">(</span><span class="string" id="8526768">&#34;hello&nbsp;&#34;</span><span class="op" id="8526776">)</span><span class="op" id="8526777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8526780">w</span><span class="op" id="8526781">.</span><span class="ident" id="8526782">Close</span><span class="op" id="8526787">(</span><span class="op" id="8526788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8526791">w</span>&nbsp;<span class="op" id="8526793">=</span>&nbsp;<span class="ident" id="8526795">NewWriter</span><span class="op" id="8526804">(</span><span class="op" id="8526805">&amp;</span><span class="ident" id="8526806">buf</span><span class="op" id="8526809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8526812">w</span><span class="op" id="8526813">.</span><span class="ident" id="8526814">Write</span><span class="op" id="8526819">(</span><span class="op" id="8526820">[</span><span class="op" id="8526821">]</span><span class="builtintype" id="8526822">byte</span><span class="op" id="8526826">(</span><span class="string" id="8526827">&#34;world\n&#34;</span><span class="op" id="8526836">)</span><span class="op" id="8526837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8526840">w</span><span class="op" id="8526841">.</span><span class="ident" id="8526842">Close</span><span class="op" id="8526847">(</span><span class="op" id="8526848">)</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8526852">r</span><span class="op" id="8526853">,</span>&nbsp;<span class="ident" id="8526855">err</span>&nbsp;<span class="op" id="8526859">:=</span>&nbsp;<span class="ident" id="8526862">NewReader</span><span class="op" id="8526871">(</span><span class="op" id="8526872">&amp;</span><span class="ident" id="8526873">buf</span><span class="op" id="8526876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8526879">data</span><span class="op" id="8526883">,</span>&nbsp;<span class="ident" id="8526885">err</span>&nbsp;<span class="op" id="8526889">:=</span>&nbsp;<span class="ident" id="8526892">ioutil</span><span class="op" id="8526898">.</span><span class="ident" id="8526899">ReadAll</span><span class="op" id="8526906">(</span><span class="ident" id="8526907">r</span><span class="op" id="8526908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8526911">if</span>&nbsp;<span class="builtintype" id="8526914">string</span><span class="op" id="8526920">(</span><span class="ident" id="8526921">data</span><span class="op" id="8526925">)</span>&nbsp;<span class="op" id="8526927">!=</span>&nbsp;<span class="string" id="8526930">&#34;hello&nbsp;world\n&#34;</span>&nbsp;<span class="op" id="8526946">||</span>&nbsp;<span class="ident" id="8526949">err</span>&nbsp;<span class="op" id="8526953">!=</span>&nbsp;<span class="builtintype" id="8526956">nil</span>&nbsp;<span class="op" id="8526960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8526964">t</span><span class="op" id="8526965">.</span><span class="ident" id="8526966">Fatalf</span><span class="op" id="8526972">(</span><span class="string" id="8526973">&#34;ReadAll&nbsp;=&nbsp;%q,&nbsp;%v,&nbsp;want&nbsp;%q,&nbsp;nil&#34;</span><span class="op" id="8527005">,</span>&nbsp;<span class="ident" id="8527007">data</span><span class="op" id="8527011">,</span>&nbsp;<span class="ident" id="8527013">err</span><span class="op" id="8527016">,</span>&nbsp;<span class="string" id="8527018">&#34;hello&nbsp;world&#34;</span><span class="op" id="8527031">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8527034">}</span><br>
<span class="lineno"></span><span class="op" id="8527036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8527039">func</span>&nbsp;<span class="ident" id="8527044">TestWriterReset</span><span class="op" id="8527059">(</span><span class="ident" id="8527060">t</span>&nbsp;<span class="op" id="8527062">*</span><span class="ident" id="8527063">testing</span><span class="op" id="8527070">.</span><span class="ident" id="8527071">T</span><span class="op" id="8527072">)</span>&nbsp;<span class="op" id="8527074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8527077">buf</span>&nbsp;<span class="op" id="8527081">:=</span>&nbsp;<span class="builtinfunc" id="8527084">new</span><span class="op" id="8527087">(</span><span class="ident" id="8527088">bytes</span><span class="op" id="8527093">.</span><span class="ident" id="8527094">Buffer</span><span class="op" id="8527100">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8527103">buf2</span>&nbsp;<span class="op" id="8527108">:=</span>&nbsp;<span class="builtinfunc" id="8527111">new</span><span class="op" id="8527114">(</span><span class="ident" id="8527115">bytes</span><span class="op" id="8527120">.</span><span class="ident" id="8527121">Buffer</span><span class="op" id="8527127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8527130">z</span>&nbsp;<span class="op" id="8527132">:=</span>&nbsp;<span class="ident" id="8527135">NewWriter</span><span class="op" id="8527144">(</span><span class="ident" id="8527145">buf</span><span class="op" id="8527148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8527151">msg</span>&nbsp;<span class="op" id="8527155">:=</span>&nbsp;<span class="op" id="8527158">[</span><span class="op" id="8527159">]</span><span class="builtintype" id="8527160">byte</span><span class="op" id="8527164">(</span><span class="string" id="8527165">&#34;hello&nbsp;world&#34;</span><span class="op" id="8527178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8527181">z</span><span class="op" id="8527182">.</span><span class="ident" id="8527183">Write</span><span class="op" id="8527188">(</span><span class="ident" id="8527189">msg</span><span class="op" id="8527192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8527195">z</span><span class="op" id="8527196">.</span><span class="ident" id="8527197">Close</span><span class="op" id="8527202">(</span><span class="op" id="8527203">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8527206">z</span><span class="op" id="8527207">.</span><span class="ident" id="8527208">Reset</span><span class="op" id="8527213">(</span><span class="ident" id="8527214">buf2</span><span class="op" id="8527218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8527221">z</span><span class="op" id="8527222">.</span><span class="ident" id="8527223">Write</span><span class="op" id="8527228">(</span><span class="ident" id="8527229">msg</span><span class="op" id="8527232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8527235">z</span><span class="op" id="8527236">.</span><span class="ident" id="8527237">Close</span><span class="op" id="8527242">(</span><span class="op" id="8527243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8527246">if</span>&nbsp;<span class="ident" id="8527249">buf</span><span class="op" id="8527252">.</span><span class="ident" id="8527253">String</span><span class="op" id="8527259">(</span><span class="op" id="8527260">)</span>&nbsp;<span class="op" id="8527262">!=</span>&nbsp;<span class="ident" id="8527265">buf2</span><span class="op" id="8527269">.</span><span class="ident" id="8527270">String</span><span class="op" id="8527276">(</span><span class="op" id="8527277">)</span>&nbsp;<span class="op" id="8527279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8527283">t</span><span class="op" id="8527284">.</span><span class="ident" id="8527285">Errorf</span><span class="op" id="8527291">(</span><span class="string" id="8527292">&#34;buf2&nbsp;%q&nbsp;!=&nbsp;original&nbsp;buf&nbsp;of&nbsp;%q&#34;</span><span class="op" id="8527323">,</span>&nbsp;<span class="ident" id="8527325">buf2</span><span class="op" id="8527329">.</span><span class="ident" id="8527330">String</span><span class="op" id="8527336">(</span><span class="op" id="8527337">)</span><span class="op" id="8527338">,</span>&nbsp;<span class="ident" id="8527340">buf</span><span class="op" id="8527343">.</span><span class="ident" id="8527344">String</span><span class="op" id="8527350">(</span><span class="op" id="8527351">)</span><span class="op" id="8527352">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8527355">}</span><br>
<span class="lineno"></span><span class="op" id="8527357">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
