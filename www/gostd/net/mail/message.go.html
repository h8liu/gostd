<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/mail</h2>
<ul>
<li><a href="/gostd/net/mail/message.go.html">message.go</a></li>
<li><a href="/gostd/net/mail/message_test.go.html">message_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3783422">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3783477">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3783531">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3783582">/*<br>
<span class="lineno"></span>Package&nbsp;mail&nbsp;implements&nbsp;parsing&nbsp;of&nbsp;mail&nbsp;messages.<br>
<span class="lineno"></span><br>
<span class="lineno"></span>For&nbsp;the&nbsp;most&nbsp;part,&nbsp;this&nbsp;package&nbsp;follows&nbsp;the&nbsp;syntax&nbsp;as&nbsp;specified&nbsp;by&nbsp;RFC&nbsp;5322.<br>
<span class="lineno"></span>Notable&nbsp;divergences:<br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp*&nbsp;Obsolete&nbsp;address&nbsp;formats&nbsp;are&nbsp;not&nbsp;parsed,&nbsp;including&nbsp;addresses&nbsp;with<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;embedded&nbsp;route&nbsp;information.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp*&nbsp;Group&nbsp;addresses&nbsp;are&nbsp;not&nbsp;parsed.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp*&nbsp;The&nbsp;full&nbsp;range&nbsp;of&nbsp;spacing&nbsp;(the&nbsp;CFWS&nbsp;syntax&nbsp;element)&nbsp;is&nbsp;not&nbsp;supported,<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;such&nbsp;as&nbsp;breaking&nbsp;addresses&nbsp;across&nbsp;lines.<br>
<span class="lineno">15</span>*/</span><br>
<span class="lineno"></span><span class="keyword" id="3783989">package</span>&nbsp;<span class="ident" id="3783997">mail</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3784003">import</span>&nbsp;<span class="op" id="3784010">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3784013">&#34;bufio&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3784022">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3784031">&#34;encoding/base64&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3784050">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3784060">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3784067">&#34;io&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3784073">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3784086">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3784093">&#34;net/textproto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3784110">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3784121">&#34;strings&#34;</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3784132">&#34;time&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3784140">&#34;unicode&#34;</span><br>
<span class="lineno"></span><span class="op" id="3784150">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3784153">var</span>&nbsp;<span class="ident" id="3784157">debug</span>&nbsp;<span class="op" id="3784163">=</span>&nbsp;<span class="ident" id="3784165">debugT</span><span class="op" id="3784171">(</span><span class="builtintype" id="3784172">false</span><span class="op" id="3784177">)</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="3784180">type</span>&nbsp;<span class="ident" id="3784185">debugT</span>&nbsp;<span class="builtintype" id="3784192">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3784198">func</span>&nbsp;<span class="op" id="3784203">(</span><span class="ident" id="3784204">d</span>&nbsp;<span class="ident" id="3784206">debugT</span><span class="op" id="3784212">)</span>&nbsp;<span class="ident" id="3784214">Printf</span><span class="op" id="3784220">(</span><span class="ident" id="3784221">format</span>&nbsp;<span class="builtintype" id="3784228">string</span><span class="op" id="3784234">,</span>&nbsp;<span class="ident" id="3784236">args</span>&nbsp;<span class="op" id="3784241">...</span><span class="keyword" id="3784244">interface</span><span class="op" id="3784253">{</span><span class="op" id="3784254">}</span><span class="op" id="3784255">)</span>&nbsp;<span class="op" id="3784257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3784260">if</span>&nbsp;<span class="ident" id="3784263">d</span>&nbsp;<span class="op" id="3784265">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3784269">log</span><span class="op" id="3784272">.</span><span class="ident" id="3784273">Printf</span><span class="op" id="3784279">(</span><span class="ident" id="3784280">format</span><span class="op" id="3784286">,</span>&nbsp;<span class="ident" id="3784288">args</span><span class="op" id="3784292">...</span><span class="op" id="3784295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3784298">}</span><br>
<span class="lineno"></span><span class="op" id="3784300">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3784303">//&nbsp;A&nbsp;Message&nbsp;represents&nbsp;a&nbsp;parsed&nbsp;mail&nbsp;message.</span><br>
<span class="lineno">45</span><span class="keyword" id="3784350">type</span>&nbsp;<span class="ident" id="3784355">Message</span>&nbsp;<span class="keyword" id="3784363">struct</span>&nbsp;<span class="op" id="3784370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3784373">Header</span>&nbsp;<span class="ident" id="3784380">Header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3784388">Body</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3784395">io</span><span class="op" id="3784397">.</span><span class="ident" id="3784398">Reader</span><br>
<span class="lineno"></span><span class="op" id="3784405">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="3784408">//&nbsp;ReadMessage&nbsp;reads&nbsp;a&nbsp;message&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="3784447">//&nbsp;The&nbsp;headers&nbsp;are&nbsp;parsed,&nbsp;and&nbsp;the&nbsp;body&nbsp;of&nbsp;the&nbsp;message&nbsp;will&nbsp;be&nbsp;available</span><br>
<span class="lineno"></span><span class="comment" id="3784520">//&nbsp;for&nbsp;reading&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="3784543">func</span>&nbsp;<span class="ident" id="3784548">ReadMessage</span><span class="op" id="3784559">(</span><span class="ident" id="3784560">r</span>&nbsp;<span class="ident" id="3784562">io</span><span class="op" id="3784564">.</span><span class="ident" id="3784565">Reader</span><span class="op" id="3784571">)</span>&nbsp;<span class="op" id="3784573">(</span><span class="ident" id="3784574">msg</span>&nbsp;<span class="op" id="3784578">*</span><span class="ident" id="3784579">Message</span><span class="op" id="3784586">,</span>&nbsp;<span class="ident" id="3784588">err</span>&nbsp;<span class="builtintype" id="3784592">error</span><span class="op" id="3784597">)</span>&nbsp;<span class="op" id="3784599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3784602">tp</span>&nbsp;<span class="op" id="3784605">:=</span>&nbsp;<span class="ident" id="3784608">textproto</span><span class="op" id="3784617">.</span><span class="ident" id="3784618">NewReader</span><span class="op" id="3784627">(</span><span class="ident" id="3784628">bufio</span><span class="op" id="3784633">.</span><span class="ident" id="3784634">NewReader</span><span class="op" id="3784643">(</span><span class="ident" id="3784644">r</span><span class="op" id="3784645">)</span><span class="op" id="3784646">)</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3784650">hdr</span><span class="op" id="3784653">,</span>&nbsp;<span class="ident" id="3784655">err</span>&nbsp;<span class="op" id="3784659">:=</span>&nbsp;<span class="ident" id="3784662">tp</span><span class="op" id="3784664">.</span><span class="ident" id="3784665">ReadMIMEHeader</span><span class="op" id="3784679">(</span><span class="op" id="3784680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3784683">if</span>&nbsp;<span class="ident" id="3784686">err</span>&nbsp;<span class="op" id="3784690">!=</span>&nbsp;<span class="ident" id="3784693">nil</span>&nbsp;<span class="op" id="3784697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3784701">return</span>&nbsp;<span class="ident" id="3784708">nil</span><span class="op" id="3784711">,</span>&nbsp;<span class="ident" id="3784713">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3784718">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3784722">return</span>&nbsp;<span class="op" id="3784729">&amp;</span><span class="ident" id="3784730">Message</span><span class="op" id="3784737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3784741">Header</span><span class="op" id="3784747">:</span>&nbsp;<span class="ident" id="3784749">Header</span><span class="op" id="3784755">(</span><span class="ident" id="3784756">hdr</span><span class="op" id="3784759">)</span><span class="op" id="3784760">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3784764">Body</span><span class="op" id="3784768">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3784772">tp</span><span class="op" id="3784774">.</span><span class="ident" id="3784775">R</span><span class="op" id="3784776">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3784779">}</span><span class="op" id="3784780">,</span>&nbsp;<span class="ident" id="3784782">nil</span><br>
<span class="lineno">65</span><span class="op" id="3784786">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3784789">//&nbsp;Layouts&nbsp;suitable&nbsp;for&nbsp;passing&nbsp;to&nbsp;time.Parse.</span><br>
<span class="lineno"></span><span class="comment" id="3784836">//&nbsp;These&nbsp;are&nbsp;tried&nbsp;in&nbsp;order.</span><br>
<span class="lineno"></span><span class="keyword" id="3784865">var</span>&nbsp;<span class="ident" id="3784869">dateLayouts</span>&nbsp;<span class="op" id="3784881">[</span><span class="op" id="3784882">]</span><span class="builtintype" id="3784883">string</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="3784891">func</span>&nbsp;<span class="ident" id="3784896">init</span><span class="op" id="3784900">(</span><span class="op" id="3784901">)</span>&nbsp;<span class="op" id="3784903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3784906">//&nbsp;Generate&nbsp;layouts&nbsp;based&nbsp;on&nbsp;RFC&nbsp;5322,&nbsp;section&nbsp;3.3.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3784960">dows</span>&nbsp;<span class="op" id="3784965">:=</span>&nbsp;<span class="op" id="3784968">[</span><span class="op" id="3784969">...</span><span class="op" id="3784972">]</span><span class="builtintype" id="3784973">string</span><span class="op" id="3784979">{</span><span class="string" id="3784980">&#34;&#34;</span><span class="op" id="3784982">,</span>&nbsp;<span class="string" id="3784984">&#34;Mon,&nbsp;&#34;</span><span class="op" id="3784991">}</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="3784995">//&nbsp;day-of-week</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3785011">days</span>&nbsp;<span class="op" id="3785016">:=</span>&nbsp;<span class="op" id="3785019">[</span><span class="op" id="3785020">...</span><span class="op" id="3785023">]</span><span class="builtintype" id="3785024">string</span><span class="op" id="3785030">{</span><span class="string" id="3785031">&#34;2&#34;</span><span class="op" id="3785034">,</span>&nbsp;<span class="string" id="3785036">&#34;02&#34;</span><span class="op" id="3785040">}</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3785046">//&nbsp;day&nbsp;=&nbsp;1*2DIGIT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3785065">years</span>&nbsp;<span class="op" id="3785071">:=</span>&nbsp;<span class="op" id="3785074">[</span><span class="op" id="3785075">...</span><span class="op" id="3785078">]</span><span class="builtintype" id="3785079">string</span><span class="op" id="3785085">{</span><span class="string" id="3785086">&#34;2006&#34;</span><span class="op" id="3785092">,</span>&nbsp;<span class="string" id="3785094">&#34;06&#34;</span><span class="op" id="3785098">}</span>&nbsp;<span class="comment" id="3785100">//&nbsp;year&nbsp;=&nbsp;4*DIGIT&nbsp;/&nbsp;2*DIGIT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3785129">seconds</span>&nbsp;<span class="op" id="3785137">:=</span>&nbsp;<span class="op" id="3785140">[</span><span class="op" id="3785141">...</span><span class="op" id="3785144">]</span><span class="builtintype" id="3785145">string</span><span class="op" id="3785151">{</span><span class="string" id="3785152">&#34;:05&#34;</span><span class="op" id="3785157">,</span>&nbsp;<span class="string" id="3785159">&#34;&#34;</span><span class="op" id="3785161">}</span>&nbsp;&nbsp;<span class="comment" id="3785164">//&nbsp;second</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3785175">//&nbsp;&#34;-0700&nbsp;(MST)&#34;&nbsp;is&nbsp;not&nbsp;in&nbsp;RFC&nbsp;5322,&nbsp;but&nbsp;is&nbsp;common.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3785228">zones</span>&nbsp;<span class="op" id="3785234">:=</span>&nbsp;<span class="op" id="3785237">[</span><span class="op" id="3785238">...</span><span class="op" id="3785241">]</span><span class="builtintype" id="3785242">string</span><span class="op" id="3785248">{</span><span class="string" id="3785249">&#34;-0700&#34;</span><span class="op" id="3785256">,</span>&nbsp;<span class="string" id="3785258">&#34;MST&#34;</span><span class="op" id="3785263">,</span>&nbsp;<span class="string" id="3785265">&#34;-0700&nbsp;(MST)&#34;</span><span class="op" id="3785278">}</span>&nbsp;<span class="comment" id="3785280">//&nbsp;zone&nbsp;=&nbsp;((&#34;+&#34;&nbsp;/&nbsp;&#34;-&#34;)&nbsp;4DIGIT)&nbsp;/&nbsp;&#34;GMT&#34;&nbsp;/&nbsp;...</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3785327">for</span>&nbsp;<span class="ident" id="3785331">_</span><span class="op" id="3785332">,</span>&nbsp;<span class="ident" id="3785334">dow</span>&nbsp;<span class="op" id="3785338">:=</span>&nbsp;<span class="keyword" id="3785341">range</span>&nbsp;<span class="ident" id="3785347">dows</span>&nbsp;<span class="op" id="3785352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3785356">for</span>&nbsp;<span class="ident" id="3785360">_</span><span class="op" id="3785361">,</span>&nbsp;<span class="ident" id="3785363">day</span>&nbsp;<span class="op" id="3785367">:=</span>&nbsp;<span class="keyword" id="3785370">range</span>&nbsp;<span class="ident" id="3785376">days</span>&nbsp;<span class="op" id="3785381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3785386">for</span>&nbsp;<span class="ident" id="3785390">_</span><span class="op" id="3785391">,</span>&nbsp;<span class="ident" id="3785393">year</span>&nbsp;<span class="op" id="3785398">:=</span>&nbsp;<span class="keyword" id="3785401">range</span>&nbsp;<span class="ident" id="3785407">years</span>&nbsp;<span class="op" id="3785413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3785419">for</span>&nbsp;<span class="ident" id="3785423">_</span><span class="op" id="3785424">,</span>&nbsp;<span class="ident" id="3785426">second</span>&nbsp;<span class="op" id="3785433">:=</span>&nbsp;<span class="keyword" id="3785436">range</span>&nbsp;<span class="ident" id="3785442">seconds</span>&nbsp;<span class="op" id="3785450">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3785457">for</span>&nbsp;<span class="ident" id="3785461">_</span><span class="op" id="3785462">,</span>&nbsp;<span class="ident" id="3785464">zone</span>&nbsp;<span class="op" id="3785469">:=</span>&nbsp;<span class="keyword" id="3785472">range</span>&nbsp;<span class="ident" id="3785478">zones</span>&nbsp;<span class="op" id="3785484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3785492">s</span>&nbsp;<span class="op" id="3785494">:=</span>&nbsp;<span class="ident" id="3785497">dow</span>&nbsp;<span class="op" id="3785501">+</span>&nbsp;<span class="ident" id="3785503">day</span>&nbsp;<span class="op" id="3785507">+</span>&nbsp;<span class="string" id="3785509">&#34;&nbsp;Jan&nbsp;&#34;</span>&nbsp;<span class="op" id="3785517">+</span>&nbsp;<span class="ident" id="3785519">year</span>&nbsp;<span class="op" id="3785524">+</span>&nbsp;<span class="string" id="3785526">&#34;&nbsp;15:04&#34;</span>&nbsp;<span class="op" id="3785535">+</span>&nbsp;<span class="ident" id="3785537">second</span>&nbsp;<span class="op" id="3785544">+</span>&nbsp;<span class="string" id="3785546">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="3785550">+</span>&nbsp;<span class="ident" id="3785552">zone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3785563">dateLayouts</span>&nbsp;<span class="op" id="3785575">=</span>&nbsp;<span class="builtinfunc" id="3785577">append</span><span class="op" id="3785583">(</span><span class="ident" id="3785584">dateLayouts</span><span class="op" id="3785595">,</span>&nbsp;<span class="ident" id="3785597">s</span><span class="op" id="3785598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3785605">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3785611">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3785616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3785620">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3785623">}</span><br>
<span class="lineno"></span><span class="op" id="3785625">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="3785628">func</span>&nbsp;<span class="ident" id="3785633">parseDate</span><span class="op" id="3785642">(</span><span class="ident" id="3785643">date</span>&nbsp;<span class="builtintype" id="3785648">string</span><span class="op" id="3785654">)</span>&nbsp;<span class="op" id="3785656">(</span><span class="ident" id="3785657">time</span><span class="op" id="3785661">.</span><span class="ident" id="3785662">Time</span><span class="op" id="3785666">,</span>&nbsp;<span class="builtintype" id="3785668">error</span><span class="op" id="3785673">)</span>&nbsp;<span class="op" id="3785675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3785678">for</span>&nbsp;<span class="ident" id="3785682">_</span><span class="op" id="3785683">,</span>&nbsp;<span class="ident" id="3785685">layout</span>&nbsp;<span class="op" id="3785692">:=</span>&nbsp;<span class="keyword" id="3785695">range</span>&nbsp;<span class="ident" id="3785701">dateLayouts</span>&nbsp;<span class="op" id="3785713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3785717">t</span><span class="op" id="3785718">,</span>&nbsp;<span class="ident" id="3785720">err</span>&nbsp;<span class="op" id="3785724">:=</span>&nbsp;<span class="ident" id="3785727">time</span><span class="op" id="3785731">.</span><span class="ident" id="3785732">Parse</span><span class="op" id="3785737">(</span><span class="ident" id="3785738">layout</span><span class="op" id="3785744">,</span>&nbsp;<span class="ident" id="3785746">date</span><span class="op" id="3785750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3785754">if</span>&nbsp;<span class="ident" id="3785757">err</span>&nbsp;<span class="op" id="3785761">==</span>&nbsp;<span class="ident" id="3785764">nil</span>&nbsp;<span class="op" id="3785768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3785773">return</span>&nbsp;<span class="ident" id="3785780">t</span><span class="op" id="3785781">,</span>&nbsp;<span class="ident" id="3785783">nil</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3785789">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3785792">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3785795">return</span>&nbsp;<span class="ident" id="3785802">time</span><span class="op" id="3785806">.</span><span class="ident" id="3785807">Time</span><span class="op" id="3785811">{</span><span class="op" id="3785812">}</span><span class="op" id="3785813">,</span>&nbsp;<span class="ident" id="3785815">errors</span><span class="op" id="3785821">.</span><span class="ident" id="3785822">New</span><span class="op" id="3785825">(</span><span class="string" id="3785826">&#34;mail:&nbsp;header&nbsp;could&nbsp;not&nbsp;be&nbsp;parsed&#34;</span><span class="op" id="3785860">)</span><br>
<span class="lineno"></span><span class="op" id="3785862">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="3785865">//&nbsp;A&nbsp;Header&nbsp;represents&nbsp;the&nbsp;key-value&nbsp;pairs&nbsp;in&nbsp;a&nbsp;mail&nbsp;message&nbsp;header.</span><br>
<span class="lineno"></span><span class="keyword" id="3785934">type</span>&nbsp;<span class="ident" id="3785939">Header</span>&nbsp;<span class="keyword" id="3785946">map</span><span class="op" id="3785949">[</span><span class="builtintype" id="3785950">string</span><span class="op" id="3785956">]</span><span class="op" id="3785957">[</span><span class="op" id="3785958">]</span><span class="builtintype" id="3785959">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3785967">//&nbsp;Get&nbsp;gets&nbsp;the&nbsp;first&nbsp;value&nbsp;associated&nbsp;with&nbsp;the&nbsp;given&nbsp;key.</span><br>
<span class="lineno"></span><span class="comment" id="3786026">//&nbsp;If&nbsp;there&nbsp;are&nbsp;no&nbsp;values&nbsp;associated&nbsp;with&nbsp;the&nbsp;key,&nbsp;Get&nbsp;returns&nbsp;&#34;&#34;.</span><br>
<span class="lineno">110</span><span class="keyword" id="3786093">func</span>&nbsp;<span class="op" id="3786098">(</span><span class="ident" id="3786099">h</span>&nbsp;<span class="ident" id="3786101">Header</span><span class="op" id="3786107">)</span>&nbsp;<span class="ident" id="3786109">Get</span><span class="op" id="3786112">(</span><span class="ident" id="3786113">key</span>&nbsp;<span class="builtintype" id="3786117">string</span><span class="op" id="3786123">)</span>&nbsp;<span class="builtintype" id="3786125">string</span>&nbsp;<span class="op" id="3786132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3786135">return</span>&nbsp;<span class="ident" id="3786142">textproto</span><span class="op" id="3786151">.</span><span class="ident" id="3786152">MIMEHeader</span><span class="op" id="3786162">(</span><span class="ident" id="3786163">h</span><span class="op" id="3786164">)</span><span class="op" id="3786165">.</span><span class="ident" id="3786166">Get</span><span class="op" id="3786169">(</span><span class="ident" id="3786170">key</span><span class="op" id="3786173">)</span><br>
<span class="lineno"></span><span class="op" id="3786175">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3786178">var</span>&nbsp;<span class="ident" id="3786182">ErrHeaderNotPresent</span>&nbsp;<span class="op" id="3786202">=</span>&nbsp;<span class="ident" id="3786204">errors</span><span class="op" id="3786210">.</span><span class="ident" id="3786211">New</span><span class="op" id="3786214">(</span><span class="string" id="3786215">&#34;mail:&nbsp;header&nbsp;not&nbsp;in&nbsp;message&#34;</span><span class="op" id="3786244">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="3786247">//&nbsp;Date&nbsp;parses&nbsp;the&nbsp;Date&nbsp;header&nbsp;field.</span><br>
<span class="lineno"></span><span class="keyword" id="3786285">func</span>&nbsp;<span class="op" id="3786290">(</span><span class="ident" id="3786291">h</span>&nbsp;<span class="ident" id="3786293">Header</span><span class="op" id="3786299">)</span>&nbsp;<span class="ident" id="3786301">Date</span><span class="op" id="3786305">(</span><span class="op" id="3786306">)</span>&nbsp;<span class="op" id="3786308">(</span><span class="ident" id="3786309">time</span><span class="op" id="3786313">.</span><span class="ident" id="3786314">Time</span><span class="op" id="3786318">,</span>&nbsp;<span class="builtintype" id="3786320">error</span><span class="op" id="3786325">)</span>&nbsp;<span class="op" id="3786327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3786330">hdr</span>&nbsp;<span class="op" id="3786334">:=</span>&nbsp;<span class="ident" id="3786337">h</span><span class="op" id="3786338">.</span><span class="ident" id="3786339">Get</span><span class="op" id="3786342">(</span><span class="string" id="3786343">&#34;Date&#34;</span><span class="op" id="3786349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3786352">if</span>&nbsp;<span class="ident" id="3786355">hdr</span>&nbsp;<span class="op" id="3786359">==</span>&nbsp;<span class="string" id="3786362">&#34;&#34;</span>&nbsp;<span class="op" id="3786365">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3786369">return</span>&nbsp;<span class="ident" id="3786376">time</span><span class="op" id="3786380">.</span><span class="ident" id="3786381">Time</span><span class="op" id="3786385">{</span><span class="op" id="3786386">}</span><span class="op" id="3786387">,</span>&nbsp;<span class="ident" id="3786389">ErrHeaderNotPresent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3786410">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3786413">return</span>&nbsp;<span class="ident" id="3786420">parseDate</span><span class="op" id="3786429">(</span><span class="ident" id="3786430">hdr</span><span class="op" id="3786433">)</span><br>
<span class="lineno"></span><span class="op" id="3786435">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="3786438">//&nbsp;AddressList&nbsp;parses&nbsp;the&nbsp;named&nbsp;header&nbsp;field&nbsp;as&nbsp;a&nbsp;list&nbsp;of&nbsp;addresses.</span><br>
<span class="lineno"></span><span class="keyword" id="3786507">func</span>&nbsp;<span class="op" id="3786512">(</span><span class="ident" id="3786513">h</span>&nbsp;<span class="ident" id="3786515">Header</span><span class="op" id="3786521">)</span>&nbsp;<span class="ident" id="3786523">AddressList</span><span class="op" id="3786534">(</span><span class="ident" id="3786535">key</span>&nbsp;<span class="builtintype" id="3786539">string</span><span class="op" id="3786545">)</span>&nbsp;<span class="op" id="3786547">(</span><span class="op" id="3786548">[</span><span class="op" id="3786549">]</span><span class="op" id="3786550">*</span><span class="ident" id="3786551">Address</span><span class="op" id="3786558">,</span>&nbsp;<span class="builtintype" id="3786560">error</span><span class="op" id="3786565">)</span>&nbsp;<span class="op" id="3786567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3786570">hdr</span>&nbsp;<span class="op" id="3786574">:=</span>&nbsp;<span class="ident" id="3786577">h</span><span class="op" id="3786578">.</span><span class="ident" id="3786579">Get</span><span class="op" id="3786582">(</span><span class="ident" id="3786583">key</span><span class="op" id="3786586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3786589">if</span>&nbsp;<span class="ident" id="3786592">hdr</span>&nbsp;<span class="op" id="3786596">==</span>&nbsp;<span class="string" id="3786599">&#34;&#34;</span>&nbsp;<span class="op" id="3786602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3786606">return</span>&nbsp;<span class="ident" id="3786613">nil</span><span class="op" id="3786616">,</span>&nbsp;<span class="ident" id="3786618">ErrHeaderNotPresent</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3786639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3786642">return</span>&nbsp;<span class="ident" id="3786649">ParseAddressList</span><span class="op" id="3786665">(</span><span class="ident" id="3786666">hdr</span><span class="op" id="3786669">)</span><br>
<span class="lineno"></span><span class="op" id="3786671">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3786674">//&nbsp;Address&nbsp;represents&nbsp;a&nbsp;single&nbsp;mail&nbsp;address.</span><br>
<span class="lineno">135</span><span class="comment" id="3786719">//&nbsp;An&nbsp;address&nbsp;such&nbsp;as&nbsp;&#34;Barry&nbsp;Gibbs&nbsp;&lt;bg@example.com&gt;&#34;&nbsp;is&nbsp;represented</span><br>
<span class="lineno"></span><span class="comment" id="3786787">//&nbsp;as&nbsp;Address{Name:&nbsp;&#34;Barry&nbsp;Gibbs&#34;,&nbsp;Address:&nbsp;&#34;bg@example.com&#34;}.</span><br>
<span class="lineno"></span><span class="keyword" id="3786850">type</span>&nbsp;<span class="ident" id="3786855">Address</span>&nbsp;<span class="keyword" id="3786863">struct</span>&nbsp;<span class="op" id="3786870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3786873">Name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3786881">string</span>&nbsp;<span class="comment" id="3786888">//&nbsp;Proper&nbsp;name;&nbsp;may&nbsp;be&nbsp;empty.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3786919">Address</span>&nbsp;<span class="builtintype" id="3786927">string</span>&nbsp;<span class="comment" id="3786934">//&nbsp;user@domain</span><br>
<span class="lineno">140</span><span class="op" id="3786949">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3786952">//&nbsp;Parses&nbsp;a&nbsp;single&nbsp;RFC&nbsp;5322&nbsp;address,&nbsp;e.g.&nbsp;&#34;Barry&nbsp;Gibbs&nbsp;&lt;bg@example.com&gt;&#34;</span><br>
<span class="lineno"></span><span class="keyword" id="3787025">func</span>&nbsp;<span class="ident" id="3787030">ParseAddress</span><span class="op" id="3787042">(</span><span class="ident" id="3787043">address</span>&nbsp;<span class="builtintype" id="3787051">string</span><span class="op" id="3787057">)</span>&nbsp;<span class="op" id="3787059">(</span><span class="op" id="3787060">*</span><span class="ident" id="3787061">Address</span><span class="op" id="3787068">,</span>&nbsp;<span class="builtintype" id="3787070">error</span><span class="op" id="3787075">)</span>&nbsp;<span class="op" id="3787077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3787080">return</span>&nbsp;<span class="ident" id="3787087">newAddrParser</span><span class="op" id="3787100">(</span><span class="ident" id="3787101">address</span><span class="op" id="3787108">)</span><span class="op" id="3787109">.</span><span class="ident" id="3787110">parseAddress</span><span class="op" id="3787122">(</span><span class="op" id="3787123">)</span><br>
<span class="lineno">145</span><span class="op" id="3787125">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3787128">//&nbsp;ParseAddressList&nbsp;parses&nbsp;the&nbsp;given&nbsp;string&nbsp;as&nbsp;a&nbsp;list&nbsp;of&nbsp;addresses.</span><br>
<span class="lineno"></span><span class="keyword" id="3787196">func</span>&nbsp;<span class="ident" id="3787201">ParseAddressList</span><span class="op" id="3787217">(</span><span class="ident" id="3787218">list</span>&nbsp;<span class="builtintype" id="3787223">string</span><span class="op" id="3787229">)</span>&nbsp;<span class="op" id="3787231">(</span><span class="op" id="3787232">[</span><span class="op" id="3787233">]</span><span class="op" id="3787234">*</span><span class="ident" id="3787235">Address</span><span class="op" id="3787242">,</span>&nbsp;<span class="builtintype" id="3787244">error</span><span class="op" id="3787249">)</span>&nbsp;<span class="op" id="3787251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3787254">return</span>&nbsp;<span class="ident" id="3787261">newAddrParser</span><span class="op" id="3787274">(</span><span class="ident" id="3787275">list</span><span class="op" id="3787279">)</span><span class="op" id="3787280">.</span><span class="ident" id="3787281">parseAddressList</span><span class="op" id="3787297">(</span><span class="op" id="3787298">)</span><br>
<span class="lineno">150</span><span class="op" id="3787300">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3787303">//&nbsp;String&nbsp;formats&nbsp;the&nbsp;address&nbsp;as&nbsp;a&nbsp;valid&nbsp;RFC&nbsp;5322&nbsp;address.</span><br>
<span class="lineno"></span><span class="comment" id="3787362">//&nbsp;If&nbsp;the&nbsp;address&#39;s&nbsp;name&nbsp;contains&nbsp;non-ASCII&nbsp;characters</span><br>
<span class="lineno"></span><span class="comment" id="3787417">//&nbsp;the&nbsp;name&nbsp;will&nbsp;be&nbsp;rendered&nbsp;according&nbsp;to&nbsp;RFC&nbsp;2047.</span><br>
<span class="lineno">155</span><span class="keyword" id="3787469">func</span>&nbsp;<span class="op" id="3787474">(</span><span class="ident" id="3787475">a</span>&nbsp;<span class="op" id="3787477">*</span><span class="ident" id="3787478">Address</span><span class="op" id="3787485">)</span>&nbsp;<span class="ident" id="3787487">String</span><span class="op" id="3787493">(</span><span class="op" id="3787494">)</span>&nbsp;<span class="builtintype" id="3787496">string</span>&nbsp;<span class="op" id="3787503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3787506">s</span>&nbsp;<span class="op" id="3787508">:=</span>&nbsp;<span class="string" id="3787511">&#34;&lt;&#34;</span>&nbsp;<span class="op" id="3787515">+</span>&nbsp;<span class="ident" id="3787517">a</span><span class="op" id="3787518">.</span><span class="ident" id="3787519">Address</span>&nbsp;<span class="op" id="3787527">+</span>&nbsp;<span class="string" id="3787529">&#34;&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3787534">if</span>&nbsp;<span class="ident" id="3787537">a</span><span class="op" id="3787538">.</span><span class="ident" id="3787539">Name</span>&nbsp;<span class="op" id="3787544">==</span>&nbsp;<span class="string" id="3787547">&#34;&#34;</span>&nbsp;<span class="op" id="3787550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3787554">return</span>&nbsp;<span class="ident" id="3787561">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3787564">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3787567">//&nbsp;If&nbsp;every&nbsp;character&nbsp;is&nbsp;printable&nbsp;ASCII,&nbsp;quoting&nbsp;is&nbsp;simple.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3787629">allPrintable</span>&nbsp;<span class="op" id="3787642">:=</span>&nbsp;<span class="builtintype" id="3787645">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3787651">for</span>&nbsp;<span class="ident" id="3787655">i</span>&nbsp;<span class="op" id="3787657">:=</span>&nbsp;<span class="num" id="3787660">0</span><span class="op" id="3787661">;</span>&nbsp;<span class="ident" id="3787663">i</span>&nbsp;<span class="op" id="3787665">&lt;</span>&nbsp;<span class="builtinfunc" id="3787667">len</span><span class="op" id="3787670">(</span><span class="ident" id="3787671">a</span><span class="op" id="3787672">.</span><span class="ident" id="3787673">Name</span><span class="op" id="3787677">)</span><span class="op" id="3787678">;</span>&nbsp;<span class="ident" id="3787680">i</span><span class="op" id="3787681">++</span>&nbsp;<span class="op" id="3787684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3787688">//&nbsp;isWSP&nbsp;here&nbsp;should&nbsp;actually&nbsp;be&nbsp;isFWS,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3787730">//&nbsp;but&nbsp;we&nbsp;don&#39;t&nbsp;support&nbsp;folding&nbsp;yet.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3787769">if</span>&nbsp;<span class="op" id="3787772">!</span><span class="ident" id="3787773">isVchar</span><span class="op" id="3787780">(</span><span class="ident" id="3787781">a</span><span class="op" id="3787782">.</span><span class="ident" id="3787783">Name</span><span class="op" id="3787787">[</span><span class="ident" id="3787788">i</span><span class="op" id="3787789">]</span><span class="op" id="3787790">)</span>&nbsp;<span class="op" id="3787792">&amp;&amp;</span>&nbsp;<span class="op" id="3787795">!</span><span class="ident" id="3787796">isWSP</span><span class="op" id="3787801">(</span><span class="ident" id="3787802">a</span><span class="op" id="3787803">.</span><span class="ident" id="3787804">Name</span><span class="op" id="3787808">[</span><span class="ident" id="3787809">i</span><span class="op" id="3787810">]</span><span class="op" id="3787811">)</span>&nbsp;<span class="op" id="3787813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3787818">allPrintable</span>&nbsp;<span class="op" id="3787831">=</span>&nbsp;<span class="builtintype" id="3787833">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3787842">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3787850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3787853">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3787856">if</span>&nbsp;<span class="ident" id="3787859">allPrintable</span>&nbsp;<span class="op" id="3787872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3787876">b</span>&nbsp;<span class="op" id="3787878">:=</span>&nbsp;<span class="ident" id="3787881">bytes</span><span class="op" id="3787886">.</span><span class="ident" id="3787887">NewBufferString</span><span class="op" id="3787902">(</span><span class="string" id="3787903">`&#34;`</span><span class="op" id="3787906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3787910">for</span>&nbsp;<span class="ident" id="3787914">i</span>&nbsp;<span class="op" id="3787916">:=</span>&nbsp;<span class="num" id="3787919">0</span><span class="op" id="3787920">;</span>&nbsp;<span class="ident" id="3787922">i</span>&nbsp;<span class="op" id="3787924">&lt;</span>&nbsp;<span class="builtinfunc" id="3787926">len</span><span class="op" id="3787929">(</span><span class="ident" id="3787930">a</span><span class="op" id="3787931">.</span><span class="ident" id="3787932">Name</span><span class="op" id="3787936">)</span><span class="op" id="3787937">;</span>&nbsp;<span class="ident" id="3787939">i</span><span class="op" id="3787940">++</span>&nbsp;<span class="op" id="3787943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3787948">if</span>&nbsp;<span class="op" id="3787951">!</span><span class="ident" id="3787952">isQtext</span><span class="op" id="3787959">(</span><span class="ident" id="3787960">a</span><span class="op" id="3787961">.</span><span class="ident" id="3787962">Name</span><span class="op" id="3787966">[</span><span class="ident" id="3787967">i</span><span class="op" id="3787968">]</span><span class="op" id="3787969">)</span>&nbsp;<span class="op" id="3787971">&amp;&amp;</span>&nbsp;<span class="op" id="3787974">!</span><span class="ident" id="3787975">isWSP</span><span class="op" id="3787980">(</span><span class="ident" id="3787981">a</span><span class="op" id="3787982">.</span><span class="ident" id="3787983">Name</span><span class="op" id="3787987">[</span><span class="ident" id="3787988">i</span><span class="op" id="3787989">]</span><span class="op" id="3787990">)</span>&nbsp;<span class="op" id="3787992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3787998">b</span><span class="op" id="3787999">.</span><span class="ident" id="3788000">WriteByte</span><span class="op" id="3788009">(</span><span class="string" id="3788010">&#39;\\&#39;</span><span class="op" id="3788014">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3788019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3788024">b</span><span class="op" id="3788025">.</span><span class="ident" id="3788026">WriteByte</span><span class="op" id="3788035">(</span><span class="ident" id="3788036">a</span><span class="op" id="3788037">.</span><span class="ident" id="3788038">Name</span><span class="op" id="3788042">[</span><span class="ident" id="3788043">i</span><span class="op" id="3788044">]</span><span class="op" id="3788045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3788049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3788053">b</span><span class="op" id="3788054">.</span><span class="ident" id="3788055">WriteString</span><span class="op" id="3788066">(</span><span class="string" id="3788067">`&#34;&nbsp;`</span><span class="op" id="3788071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3788075">b</span><span class="op" id="3788076">.</span><span class="ident" id="3788077">WriteString</span><span class="op" id="3788088">(</span><span class="ident" id="3788089">s</span><span class="op" id="3788090">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3788094">return</span>&nbsp;<span class="ident" id="3788101">b</span><span class="op" id="3788102">.</span><span class="ident" id="3788103">String</span><span class="op" id="3788109">(</span><span class="op" id="3788110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3788113">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3788117">//&nbsp;UTF-8&nbsp;&#34;Q&#34;&nbsp;encoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3788140">b</span>&nbsp;<span class="op" id="3788142">:=</span>&nbsp;<span class="ident" id="3788145">bytes</span><span class="op" id="3788150">.</span><span class="ident" id="3788151">NewBufferString</span><span class="op" id="3788166">(</span><span class="string" id="3788167">&#34;=?utf-8?q?&#34;</span><span class="op" id="3788179">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3788182">for</span>&nbsp;<span class="ident" id="3788186">i</span>&nbsp;<span class="op" id="3788188">:=</span>&nbsp;<span class="num" id="3788191">0</span><span class="op" id="3788192">;</span>&nbsp;<span class="ident" id="3788194">i</span>&nbsp;<span class="op" id="3788196">&lt;</span>&nbsp;<span class="builtinfunc" id="3788198">len</span><span class="op" id="3788201">(</span><span class="ident" id="3788202">a</span><span class="op" id="3788203">.</span><span class="ident" id="3788204">Name</span><span class="op" id="3788208">)</span><span class="op" id="3788209">;</span>&nbsp;<span class="ident" id="3788211">i</span><span class="op" id="3788212">++</span>&nbsp;<span class="op" id="3788215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3788219">switch</span>&nbsp;<span class="ident" id="3788226">c</span>&nbsp;<span class="op" id="3788228">:=</span>&nbsp;<span class="ident" id="3788231">a</span><span class="op" id="3788232">.</span><span class="ident" id="3788233">Name</span><span class="op" id="3788237">[</span><span class="ident" id="3788238">i</span><span class="op" id="3788239">]</span><span class="op" id="3788240">;</span>&nbsp;<span class="op" id="3788242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3788246">case</span>&nbsp;<span class="ident" id="3788251">c</span>&nbsp;<span class="op" id="3788253">==</span>&nbsp;<span class="string" id="3788256">&#39;&nbsp;&#39;</span><span class="op" id="3788259">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3788264">b</span><span class="op" id="3788265">.</span><span class="ident" id="3788266">WriteByte</span><span class="op" id="3788275">(</span><span class="string" id="3788276">&#39;_&#39;</span><span class="op" id="3788279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3788283">case</span>&nbsp;<span class="ident" id="3788288">isVchar</span><span class="op" id="3788295">(</span><span class="ident" id="3788296">c</span><span class="op" id="3788297">)</span>&nbsp;<span class="op" id="3788299">&amp;&amp;</span>&nbsp;<span class="ident" id="3788302">c</span>&nbsp;<span class="op" id="3788304">!=</span>&nbsp;<span class="string" id="3788307">&#39;=&#39;</span>&nbsp;<span class="op" id="3788311">&amp;&amp;</span>&nbsp;<span class="ident" id="3788314">c</span>&nbsp;<span class="op" id="3788316">!=</span>&nbsp;<span class="string" id="3788319">&#39;?&#39;</span>&nbsp;<span class="op" id="3788323">&amp;&amp;</span>&nbsp;<span class="ident" id="3788326">c</span>&nbsp;<span class="op" id="3788328">!=</span>&nbsp;<span class="string" id="3788331">&#39;_&#39;</span><span class="op" id="3788334">:</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3788339">b</span><span class="op" id="3788340">.</span><span class="ident" id="3788341">WriteByte</span><span class="op" id="3788350">(</span><span class="ident" id="3788351">c</span><span class="op" id="3788352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3788356">default</span><span class="op" id="3788363">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3788368">fmt</span><span class="op" id="3788371">.</span><span class="ident" id="3788372">Fprintf</span><span class="op" id="3788379">(</span><span class="ident" id="3788380">b</span><span class="op" id="3788381">,</span>&nbsp;<span class="string" id="3788383">&#34;=%02X&#34;</span><span class="op" id="3788390">,</span>&nbsp;<span class="ident" id="3788392">c</span><span class="op" id="3788393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3788397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3788400">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3788403">b</span><span class="op" id="3788404">.</span><span class="ident" id="3788405">WriteString</span><span class="op" id="3788416">(</span><span class="string" id="3788417">&#34;?=&nbsp;&#34;</span><span class="op" id="3788422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3788425">b</span><span class="op" id="3788426">.</span><span class="ident" id="3788427">WriteString</span><span class="op" id="3788438">(</span><span class="ident" id="3788439">s</span><span class="op" id="3788440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3788443">return</span>&nbsp;<span class="ident" id="3788450">b</span><span class="op" id="3788451">.</span><span class="ident" id="3788452">String</span><span class="op" id="3788458">(</span><span class="op" id="3788459">)</span><br>
<span class="lineno"></span><span class="op" id="3788461">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="keyword" id="3788464">type</span>&nbsp;<span class="ident" id="3788469">addrParser</span>&nbsp;<span class="op" id="3788480">[</span><span class="op" id="3788481">]</span><span class="builtintype" id="3788482">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3788488">func</span>&nbsp;<span class="ident" id="3788493">newAddrParser</span><span class="op" id="3788506">(</span><span class="ident" id="3788507">s</span>&nbsp;<span class="builtintype" id="3788509">string</span><span class="op" id="3788515">)</span>&nbsp;<span class="op" id="3788517">*</span><span class="ident" id="3788518">addrParser</span>&nbsp;<span class="op" id="3788529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3788532">p</span>&nbsp;<span class="op" id="3788534">:=</span>&nbsp;<span class="ident" id="3788537">addrParser</span><span class="op" id="3788547">(</span><span class="ident" id="3788548">s</span><span class="op" id="3788549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3788552">return</span>&nbsp;<span class="op" id="3788559">&amp;</span><span class="ident" id="3788560">p</span><br>
<span class="lineno">205</span><span class="op" id="3788562">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3788565">func</span>&nbsp;<span class="op" id="3788570">(</span><span class="ident" id="3788571">p</span>&nbsp;<span class="op" id="3788573">*</span><span class="ident" id="3788574">addrParser</span><span class="op" id="3788584">)</span>&nbsp;<span class="ident" id="3788586">parseAddressList</span><span class="op" id="3788602">(</span><span class="op" id="3788603">)</span>&nbsp;<span class="op" id="3788605">(</span><span class="op" id="3788606">[</span><span class="op" id="3788607">]</span><span class="op" id="3788608">*</span><span class="ident" id="3788609">Address</span><span class="op" id="3788616">,</span>&nbsp;<span class="builtintype" id="3788618">error</span><span class="op" id="3788623">)</span>&nbsp;<span class="op" id="3788625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3788628">var</span>&nbsp;<span class="ident" id="3788632">list</span>&nbsp;<span class="op" id="3788637">[</span><span class="op" id="3788638">]</span><span class="op" id="3788639">*</span><span class="ident" id="3788640">Address</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3788649">for</span>&nbsp;<span class="op" id="3788653">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3788657">p</span><span class="op" id="3788658">.</span><span class="ident" id="3788659">skipSpace</span><span class="op" id="3788668">(</span><span class="op" id="3788669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3788673">addr</span><span class="op" id="3788677">,</span>&nbsp;<span class="ident" id="3788679">err</span>&nbsp;<span class="op" id="3788683">:=</span>&nbsp;<span class="ident" id="3788686">p</span><span class="op" id="3788687">.</span><span class="ident" id="3788688">parseAddress</span><span class="op" id="3788700">(</span><span class="op" id="3788701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3788705">if</span>&nbsp;<span class="ident" id="3788708">err</span>&nbsp;<span class="op" id="3788712">!=</span>&nbsp;<span class="ident" id="3788715">nil</span>&nbsp;<span class="op" id="3788719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3788724">return</span>&nbsp;<span class="ident" id="3788731">nil</span><span class="op" id="3788734">,</span>&nbsp;<span class="ident" id="3788736">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3788742">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3788746">list</span>&nbsp;<span class="op" id="3788751">=</span>&nbsp;<span class="builtinfunc" id="3788753">append</span><span class="op" id="3788759">(</span><span class="ident" id="3788760">list</span><span class="op" id="3788764">,</span>&nbsp;<span class="ident" id="3788766">addr</span><span class="op" id="3788770">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3788775">p</span><span class="op" id="3788776">.</span><span class="ident" id="3788777">skipSpace</span><span class="op" id="3788786">(</span><span class="op" id="3788787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3788791">if</span>&nbsp;<span class="ident" id="3788794">p</span><span class="op" id="3788795">.</span><span class="ident" id="3788796">empty</span><span class="op" id="3788801">(</span><span class="op" id="3788802">)</span>&nbsp;<span class="op" id="3788804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3788809">break</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3788817">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3788821">if</span>&nbsp;<span class="op" id="3788824">!</span><span class="ident" id="3788825">p</span><span class="op" id="3788826">.</span><span class="ident" id="3788827">consume</span><span class="op" id="3788834">(</span><span class="string" id="3788835">&#39;,&#39;</span><span class="op" id="3788838">)</span>&nbsp;<span class="op" id="3788840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3788845">return</span>&nbsp;<span class="ident" id="3788852">nil</span><span class="op" id="3788855">,</span>&nbsp;<span class="ident" id="3788857">errors</span><span class="op" id="3788863">.</span><span class="ident" id="3788864">New</span><span class="op" id="3788867">(</span><span class="string" id="3788868">&#34;mail:&nbsp;expected&nbsp;comma&#34;</span><span class="op" id="3788890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3788894">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3788897">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3788900">return</span>&nbsp;<span class="ident" id="3788907">list</span><span class="op" id="3788911">,</span>&nbsp;<span class="ident" id="3788913">nil</span><br>
<span class="lineno"></span><span class="op" id="3788917">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3788920">//&nbsp;parseAddress&nbsp;parses&nbsp;a&nbsp;single&nbsp;RFC&nbsp;5322&nbsp;address&nbsp;at&nbsp;the&nbsp;start&nbsp;of&nbsp;p.</span><br>
<span class="lineno"></span><span class="keyword" id="3788988">func</span>&nbsp;<span class="op" id="3788993">(</span><span class="ident" id="3788994">p</span>&nbsp;<span class="op" id="3788996">*</span><span class="ident" id="3788997">addrParser</span><span class="op" id="3789007">)</span>&nbsp;<span class="ident" id="3789009">parseAddress</span><span class="op" id="3789021">(</span><span class="op" id="3789022">)</span>&nbsp;<span class="op" id="3789024">(</span><span class="ident" id="3789025">addr</span>&nbsp;<span class="op" id="3789030">*</span><span class="ident" id="3789031">Address</span><span class="op" id="3789038">,</span>&nbsp;<span class="ident" id="3789040">err</span>&nbsp;<span class="builtintype" id="3789044">error</span><span class="op" id="3789049">)</span>&nbsp;<span class="op" id="3789051">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789054">debug</span><span class="op" id="3789059">.</span><span class="ident" id="3789060">Printf</span><span class="op" id="3789066">(</span><span class="string" id="3789067">&#34;parseAddress:&nbsp;%q&#34;</span><span class="op" id="3789085">,</span>&nbsp;<span class="op" id="3789087">*</span><span class="ident" id="3789088">p</span><span class="op" id="3789089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789092">p</span><span class="op" id="3789093">.</span><span class="ident" id="3789094">skipSpace</span><span class="op" id="3789103">(</span><span class="op" id="3789104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3789107">if</span>&nbsp;<span class="ident" id="3789110">p</span><span class="op" id="3789111">.</span><span class="ident" id="3789112">empty</span><span class="op" id="3789117">(</span><span class="op" id="3789118">)</span>&nbsp;<span class="op" id="3789120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3789124">return</span>&nbsp;<span class="ident" id="3789131">nil</span><span class="op" id="3789134">,</span>&nbsp;<span class="ident" id="3789136">errors</span><span class="op" id="3789142">.</span><span class="ident" id="3789143">New</span><span class="op" id="3789146">(</span><span class="string" id="3789147">&#34;mail:&nbsp;no&nbsp;address&#34;</span><span class="op" id="3789165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3789168">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3789172">//&nbsp;address&nbsp;=&nbsp;name-addr&nbsp;/&nbsp;addr-spec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3789208">//&nbsp;TODO(dsymonds):&nbsp;Support&nbsp;parsing&nbsp;group&nbsp;address.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3789260">//&nbsp;addr-spec&nbsp;has&nbsp;a&nbsp;more&nbsp;restricted&nbsp;grammar&nbsp;than&nbsp;name-addr,</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3789320">//&nbsp;so&nbsp;try&nbsp;parsing&nbsp;it&nbsp;first,&nbsp;and&nbsp;fallback&nbsp;to&nbsp;name-addr.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3789376">//&nbsp;TODO(dsymonds):&nbsp;Is&nbsp;this&nbsp;really&nbsp;correct?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789420">spec</span><span class="op" id="3789424">,</span>&nbsp;<span class="ident" id="3789426">err</span>&nbsp;<span class="op" id="3789430">:=</span>&nbsp;<span class="ident" id="3789433">p</span><span class="op" id="3789434">.</span><span class="ident" id="3789435">consumeAddrSpec</span><span class="op" id="3789450">(</span><span class="op" id="3789451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3789454">if</span>&nbsp;<span class="ident" id="3789457">err</span>&nbsp;<span class="op" id="3789461">==</span>&nbsp;<span class="ident" id="3789464">nil</span>&nbsp;<span class="op" id="3789468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3789472">return</span>&nbsp;<span class="op" id="3789479">&amp;</span><span class="ident" id="3789480">Address</span><span class="op" id="3789487">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789492">Address</span><span class="op" id="3789499">:</span>&nbsp;<span class="ident" id="3789501">spec</span><span class="op" id="3789505">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3789509">}</span><span class="op" id="3789510">,</span>&nbsp;<span class="ident" id="3789512">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3789517">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789520">debug</span><span class="op" id="3789525">.</span><span class="ident" id="3789526">Printf</span><span class="op" id="3789532">(</span><span class="string" id="3789533">&#34;parseAddress:&nbsp;not&nbsp;an&nbsp;addr-spec:&nbsp;%v&#34;</span><span class="op" id="3789569">,</span>&nbsp;<span class="ident" id="3789571">err</span><span class="op" id="3789574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789577">debug</span><span class="op" id="3789582">.</span><span class="ident" id="3789583">Printf</span><span class="op" id="3789589">(</span><span class="string" id="3789590">&#34;parseAddress:&nbsp;state&nbsp;is&nbsp;now&nbsp;%q&#34;</span><span class="op" id="3789621">,</span>&nbsp;<span class="op" id="3789623">*</span><span class="ident" id="3789624">p</span><span class="op" id="3789625">)</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3789629">//&nbsp;display-name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3789646">var</span>&nbsp;<span class="ident" id="3789650">displayName</span>&nbsp;<span class="builtintype" id="3789662">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3789670">if</span>&nbsp;<span class="ident" id="3789673">p</span><span class="op" id="3789674">.</span><span class="ident" id="3789675">peek</span><span class="op" id="3789679">(</span><span class="op" id="3789680">)</span>&nbsp;<span class="op" id="3789682">!=</span>&nbsp;<span class="string" id="3789685">&#39;&lt;&#39;</span>&nbsp;<span class="op" id="3789689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789693">displayName</span><span class="op" id="3789704">,</span>&nbsp;<span class="ident" id="3789706">err</span>&nbsp;<span class="op" id="3789710">=</span>&nbsp;<span class="ident" id="3789712">p</span><span class="op" id="3789713">.</span><span class="ident" id="3789714">consumePhrase</span><span class="op" id="3789727">(</span><span class="op" id="3789728">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3789732">if</span>&nbsp;<span class="ident" id="3789735">err</span>&nbsp;<span class="op" id="3789739">!=</span>&nbsp;<span class="ident" id="3789742">nil</span>&nbsp;<span class="op" id="3789746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3789751">return</span>&nbsp;<span class="ident" id="3789758">nil</span><span class="op" id="3789761">,</span>&nbsp;<span class="ident" id="3789763">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3789769">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3789772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789775">debug</span><span class="op" id="3789780">.</span><span class="ident" id="3789781">Printf</span><span class="op" id="3789787">(</span><span class="string" id="3789788">&#34;parseAddress:&nbsp;displayName=%q&#34;</span><span class="op" id="3789818">,</span>&nbsp;<span class="ident" id="3789820">displayName</span><span class="op" id="3789831">)</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3789835">//&nbsp;angle-addr&nbsp;=&nbsp;&#34;&lt;&#34;&nbsp;addr-spec&nbsp;&#34;&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789870">p</span><span class="op" id="3789871">.</span><span class="ident" id="3789872">skipSpace</span><span class="op" id="3789881">(</span><span class="op" id="3789882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3789885">if</span>&nbsp;<span class="op" id="3789888">!</span><span class="ident" id="3789889">p</span><span class="op" id="3789890">.</span><span class="ident" id="3789891">consume</span><span class="op" id="3789898">(</span><span class="string" id="3789899">&#39;&lt;&#39;</span><span class="op" id="3789902">)</span>&nbsp;<span class="op" id="3789904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3789908">return</span>&nbsp;<span class="ident" id="3789915">nil</span><span class="op" id="3789918">,</span>&nbsp;<span class="ident" id="3789920">errors</span><span class="op" id="3789926">.</span><span class="ident" id="3789927">New</span><span class="op" id="3789930">(</span><span class="string" id="3789931">&#34;mail:&nbsp;no&nbsp;angle-addr&#34;</span><span class="op" id="3789952">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3789955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3789958">spec</span><span class="op" id="3789962">,</span>&nbsp;<span class="ident" id="3789964">err</span>&nbsp;<span class="op" id="3789968">=</span>&nbsp;<span class="ident" id="3789970">p</span><span class="op" id="3789971">.</span><span class="ident" id="3789972">consumeAddrSpec</span><span class="op" id="3789987">(</span><span class="op" id="3789988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3789991">if</span>&nbsp;<span class="ident" id="3789994">err</span>&nbsp;<span class="op" id="3789998">!=</span>&nbsp;<span class="ident" id="3790001">nil</span>&nbsp;<span class="op" id="3790005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3790009">return</span>&nbsp;<span class="ident" id="3790016">nil</span><span class="op" id="3790019">,</span>&nbsp;<span class="ident" id="3790021">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3790026">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3790029">if</span>&nbsp;<span class="op" id="3790032">!</span><span class="ident" id="3790033">p</span><span class="op" id="3790034">.</span><span class="ident" id="3790035">consume</span><span class="op" id="3790042">(</span><span class="string" id="3790043">&#39;&gt;&#39;</span><span class="op" id="3790046">)</span>&nbsp;<span class="op" id="3790048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3790052">return</span>&nbsp;<span class="ident" id="3790059">nil</span><span class="op" id="3790062">,</span>&nbsp;<span class="ident" id="3790064">errors</span><span class="op" id="3790070">.</span><span class="ident" id="3790071">New</span><span class="op" id="3790074">(</span><span class="string" id="3790075">&#34;mail:&nbsp;unclosed&nbsp;angle-addr&#34;</span><span class="op" id="3790102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3790105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3790108">debug</span><span class="op" id="3790113">.</span><span class="ident" id="3790114">Printf</span><span class="op" id="3790120">(</span><span class="string" id="3790121">&#34;parseAddress:&nbsp;spec=%q&#34;</span><span class="op" id="3790144">,</span>&nbsp;<span class="ident" id="3790146">spec</span><span class="op" id="3790150">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3790154">return</span>&nbsp;<span class="op" id="3790161">&amp;</span><span class="ident" id="3790162">Address</span><span class="op" id="3790169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3790173">Name</span><span class="op" id="3790177">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3790182">displayName</span><span class="op" id="3790193">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3790197">Address</span><span class="op" id="3790204">:</span>&nbsp;<span class="ident" id="3790206">spec</span><span class="op" id="3790210">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3790213">}</span><span class="op" id="3790214">,</span>&nbsp;<span class="ident" id="3790216">nil</span><br>
<span class="lineno"></span><span class="op" id="3790220">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="comment" id="3790223">//&nbsp;consumeAddrSpec&nbsp;parses&nbsp;a&nbsp;single&nbsp;RFC&nbsp;5322&nbsp;addr-spec&nbsp;at&nbsp;the&nbsp;start&nbsp;of&nbsp;p.</span><br>
<span class="lineno"></span><span class="keyword" id="3790296">func</span>&nbsp;<span class="op" id="3790301">(</span><span class="ident" id="3790302">p</span>&nbsp;<span class="op" id="3790304">*</span><span class="ident" id="3790305">addrParser</span><span class="op" id="3790315">)</span>&nbsp;<span class="ident" id="3790317">consumeAddrSpec</span><span class="op" id="3790332">(</span><span class="op" id="3790333">)</span>&nbsp;<span class="op" id="3790335">(</span><span class="ident" id="3790336">spec</span>&nbsp;<span class="builtintype" id="3790341">string</span><span class="op" id="3790347">,</span>&nbsp;<span class="ident" id="3790349">err</span>&nbsp;<span class="builtintype" id="3790353">error</span><span class="op" id="3790358">)</span>&nbsp;<span class="op" id="3790360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3790363">debug</span><span class="op" id="3790368">.</span><span class="ident" id="3790369">Printf</span><span class="op" id="3790375">(</span><span class="string" id="3790376">&#34;consumeAddrSpec:&nbsp;%q&#34;</span><span class="op" id="3790397">,</span>&nbsp;<span class="op" id="3790399">*</span><span class="ident" id="3790400">p</span><span class="op" id="3790401">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3790405">orig</span>&nbsp;<span class="op" id="3790410">:=</span>&nbsp;<span class="op" id="3790413">*</span><span class="ident" id="3790414">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3790417">defer</span>&nbsp;<span class="keyword" id="3790423">func</span><span class="op" id="3790427">(</span><span class="op" id="3790428">)</span>&nbsp;<span class="op" id="3790430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3790434">if</span>&nbsp;<span class="ident" id="3790437">err</span>&nbsp;<span class="op" id="3790441">!=</span>&nbsp;<span class="ident" id="3790444">nil</span>&nbsp;<span class="op" id="3790448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3790453">*</span><span class="ident" id="3790454">p</span>&nbsp;<span class="op" id="3790456">=</span>&nbsp;<span class="ident" id="3790458">orig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3790465">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3790468">}</span><span class="op" id="3790469">(</span><span class="op" id="3790470">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3790474">//&nbsp;local-part&nbsp;=&nbsp;dot-atom&nbsp;/&nbsp;quoted-string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3790516">var</span>&nbsp;<span class="ident" id="3790520">localPart</span>&nbsp;<span class="builtintype" id="3790530">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3790538">p</span><span class="op" id="3790539">.</span><span class="ident" id="3790540">skipSpace</span><span class="op" id="3790549">(</span><span class="op" id="3790550">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3790553">if</span>&nbsp;<span class="ident" id="3790556">p</span><span class="op" id="3790557">.</span><span class="ident" id="3790558">empty</span><span class="op" id="3790563">(</span><span class="op" id="3790564">)</span>&nbsp;<span class="op" id="3790566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3790570">return</span>&nbsp;<span class="string" id="3790577">&#34;&#34;</span><span class="op" id="3790579">,</span>&nbsp;<span class="ident" id="3790581">errors</span><span class="op" id="3790587">.</span><span class="ident" id="3790588">New</span><span class="op" id="3790591">(</span><span class="string" id="3790592">&#34;mail:&nbsp;no&nbsp;addr-spec&#34;</span><span class="op" id="3790612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3790615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3790618">if</span>&nbsp;<span class="ident" id="3790621">p</span><span class="op" id="3790622">.</span><span class="ident" id="3790623">peek</span><span class="op" id="3790627">(</span><span class="op" id="3790628">)</span>&nbsp;<span class="op" id="3790630">==</span>&nbsp;<span class="string" id="3790633">&#39;&#34;&#39;</span>&nbsp;<span class="op" id="3790637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3790641">//&nbsp;quoted-string</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3790660">debug</span><span class="op" id="3790665">.</span><span class="ident" id="3790666">Printf</span><span class="op" id="3790672">(</span><span class="string" id="3790673">&#34;consumeAddrSpec:&nbsp;parsing&nbsp;quoted-string&#34;</span><span class="op" id="3790713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3790717">localPart</span><span class="op" id="3790726">,</span>&nbsp;<span class="ident" id="3790728">err</span>&nbsp;<span class="op" id="3790732">=</span>&nbsp;<span class="ident" id="3790734">p</span><span class="op" id="3790735">.</span><span class="ident" id="3790736">consumeQuotedString</span><span class="op" id="3790755">(</span><span class="op" id="3790756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3790759">}</span>&nbsp;<span class="keyword" id="3790761">else</span>&nbsp;<span class="op" id="3790766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3790770">//&nbsp;dot-atom</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3790784">debug</span><span class="op" id="3790789">.</span><span class="ident" id="3790790">Printf</span><span class="op" id="3790796">(</span><span class="string" id="3790797">&#34;consumeAddrSpec:&nbsp;parsing&nbsp;dot-atom&#34;</span><span class="op" id="3790832">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3790836">localPart</span><span class="op" id="3790845">,</span>&nbsp;<span class="ident" id="3790847">err</span>&nbsp;<span class="op" id="3790851">=</span>&nbsp;<span class="ident" id="3790853">p</span><span class="op" id="3790854">.</span><span class="ident" id="3790855">consumeAtom</span><span class="op" id="3790866">(</span><span class="builtintype" id="3790867">true</span><span class="op" id="3790871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3790874">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3790877">if</span>&nbsp;<span class="ident" id="3790880">err</span>&nbsp;<span class="op" id="3790884">!=</span>&nbsp;<span class="ident" id="3790887">nil</span>&nbsp;<span class="op" id="3790891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3790895">debug</span><span class="op" id="3790900">.</span><span class="ident" id="3790901">Printf</span><span class="op" id="3790907">(</span><span class="string" id="3790908">&#34;consumeAddrSpec:&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="3790937">,</span>&nbsp;<span class="ident" id="3790939">err</span><span class="op" id="3790942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3790946">return</span>&nbsp;<span class="string" id="3790953">&#34;&#34;</span><span class="op" id="3790955">,</span>&nbsp;<span class="ident" id="3790957">err</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3790962">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3790966">if</span>&nbsp;<span class="op" id="3790969">!</span><span class="ident" id="3790970">p</span><span class="op" id="3790971">.</span><span class="ident" id="3790972">consume</span><span class="op" id="3790979">(</span><span class="string" id="3790980">&#39;@&#39;</span><span class="op" id="3790983">)</span>&nbsp;<span class="op" id="3790985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3790989">return</span>&nbsp;<span class="string" id="3790996">&#34;&#34;</span><span class="op" id="3790998">,</span>&nbsp;<span class="ident" id="3791000">errors</span><span class="op" id="3791006">.</span><span class="ident" id="3791007">New</span><span class="op" id="3791010">(</span><span class="string" id="3791011">&#34;mail:&nbsp;missing&nbsp;@&nbsp;in&nbsp;addr-spec&#34;</span><span class="op" id="3791041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3791044">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3791048">//&nbsp;domain&nbsp;=&nbsp;dot-atom&nbsp;/&nbsp;domain-literal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3791087">var</span>&nbsp;<span class="ident" id="3791091">domain</span>&nbsp;<span class="builtintype" id="3791098">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3791106">p</span><span class="op" id="3791107">.</span><span class="ident" id="3791108">skipSpace</span><span class="op" id="3791117">(</span><span class="op" id="3791118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3791121">if</span>&nbsp;<span class="ident" id="3791124">p</span><span class="op" id="3791125">.</span><span class="ident" id="3791126">empty</span><span class="op" id="3791131">(</span><span class="op" id="3791132">)</span>&nbsp;<span class="op" id="3791134">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3791138">return</span>&nbsp;<span class="string" id="3791145">&#34;&#34;</span><span class="op" id="3791147">,</span>&nbsp;<span class="ident" id="3791149">errors</span><span class="op" id="3791155">.</span><span class="ident" id="3791156">New</span><span class="op" id="3791159">(</span><span class="string" id="3791160">&#34;mail:&nbsp;no&nbsp;domain&nbsp;in&nbsp;addr-spec&#34;</span><span class="op" id="3791190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3791193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3791196">//&nbsp;TODO(dsymonds):&nbsp;Handle&nbsp;domain-literal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3791238">domain</span><span class="op" id="3791244">,</span>&nbsp;<span class="ident" id="3791246">err</span>&nbsp;<span class="op" id="3791250">=</span>&nbsp;<span class="ident" id="3791252">p</span><span class="op" id="3791253">.</span><span class="ident" id="3791254">consumeAtom</span><span class="op" id="3791265">(</span><span class="builtintype" id="3791266">true</span><span class="op" id="3791270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3791273">if</span>&nbsp;<span class="ident" id="3791276">err</span>&nbsp;<span class="op" id="3791280">!=</span>&nbsp;<span class="ident" id="3791283">nil</span>&nbsp;<span class="op" id="3791287">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3791291">return</span>&nbsp;<span class="string" id="3791298">&#34;&#34;</span><span class="op" id="3791300">,</span>&nbsp;<span class="ident" id="3791302">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3791307">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3791311">return</span>&nbsp;<span class="ident" id="3791318">localPart</span>&nbsp;<span class="op" id="3791328">+</span>&nbsp;<span class="string" id="3791330">&#34;@&#34;</span>&nbsp;<span class="op" id="3791334">+</span>&nbsp;<span class="ident" id="3791336">domain</span><span class="op" id="3791342">,</span>&nbsp;<span class="ident" id="3791344">nil</span><br>
<span class="lineno"></span><span class="op" id="3791348">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="comment" id="3791351">//&nbsp;consumePhrase&nbsp;parses&nbsp;the&nbsp;RFC&nbsp;5322&nbsp;phrase&nbsp;at&nbsp;the&nbsp;start&nbsp;of&nbsp;p.</span><br>
<span class="lineno"></span><span class="keyword" id="3791414">func</span>&nbsp;<span class="op" id="3791419">(</span><span class="ident" id="3791420">p</span>&nbsp;<span class="op" id="3791422">*</span><span class="ident" id="3791423">addrParser</span><span class="op" id="3791433">)</span>&nbsp;<span class="ident" id="3791435">consumePhrase</span><span class="op" id="3791448">(</span><span class="op" id="3791449">)</span>&nbsp;<span class="op" id="3791451">(</span><span class="ident" id="3791452">phrase</span>&nbsp;<span class="builtintype" id="3791459">string</span><span class="op" id="3791465">,</span>&nbsp;<span class="ident" id="3791467">err</span>&nbsp;<span class="builtintype" id="3791471">error</span><span class="op" id="3791476">)</span>&nbsp;<span class="op" id="3791478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3791481">debug</span><span class="op" id="3791486">.</span><span class="ident" id="3791487">Printf</span><span class="op" id="3791493">(</span><span class="string" id="3791494">&#34;consumePhrase:&nbsp;[%s]&#34;</span><span class="op" id="3791515">,</span>&nbsp;<span class="op" id="3791517">*</span><span class="ident" id="3791518">p</span><span class="op" id="3791519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3791522">//&nbsp;phrase&nbsp;=&nbsp;1*word</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3791542">var</span>&nbsp;<span class="ident" id="3791546">words</span>&nbsp;<span class="op" id="3791552">[</span><span class="op" id="3791553">]</span><span class="builtintype" id="3791554">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3791562">for</span>&nbsp;<span class="op" id="3791566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3791570">//&nbsp;word&nbsp;=&nbsp;atom&nbsp;/&nbsp;quoted-string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3791603">var</span>&nbsp;<span class="ident" id="3791607">word</span>&nbsp;<span class="builtintype" id="3791612">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3791621">p</span><span class="op" id="3791622">.</span><span class="ident" id="3791623">skipSpace</span><span class="op" id="3791632">(</span><span class="op" id="3791633">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3791637">if</span>&nbsp;<span class="ident" id="3791640">p</span><span class="op" id="3791641">.</span><span class="ident" id="3791642">empty</span><span class="op" id="3791647">(</span><span class="op" id="3791648">)</span>&nbsp;<span class="op" id="3791650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3791655">return</span>&nbsp;<span class="string" id="3791662">&#34;&#34;</span><span class="op" id="3791664">,</span>&nbsp;<span class="ident" id="3791666">errors</span><span class="op" id="3791672">.</span><span class="ident" id="3791673">New</span><span class="op" id="3791676">(</span><span class="string" id="3791677">&#34;mail:&nbsp;missing&nbsp;phrase&#34;</span><span class="op" id="3791699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3791703">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3791707">if</span>&nbsp;<span class="ident" id="3791710">p</span><span class="op" id="3791711">.</span><span class="ident" id="3791712">peek</span><span class="op" id="3791716">(</span><span class="op" id="3791717">)</span>&nbsp;<span class="op" id="3791719">==</span>&nbsp;<span class="string" id="3791722">&#39;&#34;&#39;</span>&nbsp;<span class="op" id="3791726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3791731">//&nbsp;quoted-string</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3791751">word</span><span class="op" id="3791755">,</span>&nbsp;<span class="ident" id="3791757">err</span>&nbsp;<span class="op" id="3791761">=</span>&nbsp;<span class="ident" id="3791763">p</span><span class="op" id="3791764">.</span><span class="ident" id="3791765">consumeQuotedString</span><span class="op" id="3791784">(</span><span class="op" id="3791785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3791789">}</span>&nbsp;<span class="keyword" id="3791791">else</span>&nbsp;<span class="op" id="3791796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3791801">//&nbsp;atom</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3791812">//&nbsp;We&nbsp;actually&nbsp;parse&nbsp;dot-atom&nbsp;here&nbsp;to&nbsp;be&nbsp;more&nbsp;permissive</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3791872">//&nbsp;than&nbsp;what&nbsp;RFC&nbsp;5322&nbsp;specifies.</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3791908">word</span><span class="op" id="3791912">,</span>&nbsp;<span class="ident" id="3791914">err</span>&nbsp;<span class="op" id="3791918">=</span>&nbsp;<span class="ident" id="3791920">p</span><span class="op" id="3791921">.</span><span class="ident" id="3791922">consumeAtom</span><span class="op" id="3791933">(</span><span class="builtintype" id="3791934">true</span><span class="op" id="3791938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3791942">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3791947">//&nbsp;RFC&nbsp;2047&nbsp;encoded-word&nbsp;starts&nbsp;with&nbsp;=?,&nbsp;ends&nbsp;with&nbsp;?=,&nbsp;and&nbsp;has&nbsp;two&nbsp;other&nbsp;?s.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3792026">if</span>&nbsp;<span class="ident" id="3792029">err</span>&nbsp;<span class="op" id="3792033">==</span>&nbsp;<span class="ident" id="3792036">nil</span>&nbsp;<span class="op" id="3792040">&amp;&amp;</span>&nbsp;<span class="ident" id="3792043">strings</span><span class="op" id="3792050">.</span><span class="ident" id="3792051">HasPrefix</span><span class="op" id="3792060">(</span><span class="ident" id="3792061">word</span><span class="op" id="3792065">,</span>&nbsp;<span class="string" id="3792067">&#34;=?&#34;</span><span class="op" id="3792071">)</span>&nbsp;<span class="op" id="3792073">&amp;&amp;</span>&nbsp;<span class="ident" id="3792076">strings</span><span class="op" id="3792083">.</span><span class="ident" id="3792084">HasSuffix</span><span class="op" id="3792093">(</span><span class="ident" id="3792094">word</span><span class="op" id="3792098">,</span>&nbsp;<span class="string" id="3792100">&#34;?=&#34;</span><span class="op" id="3792104">)</span>&nbsp;<span class="op" id="3792106">&amp;&amp;</span>&nbsp;<span class="ident" id="3792109">strings</span><span class="op" id="3792116">.</span><span class="ident" id="3792117">Count</span><span class="op" id="3792122">(</span><span class="ident" id="3792123">word</span><span class="op" id="3792127">,</span>&nbsp;<span class="string" id="3792129">&#34;?&#34;</span><span class="op" id="3792132">)</span>&nbsp;<span class="op" id="3792134">==</span>&nbsp;<span class="num" id="3792137">4</span>&nbsp;<span class="op" id="3792139">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3792144">word</span><span class="op" id="3792148">,</span>&nbsp;<span class="ident" id="3792150">err</span>&nbsp;<span class="op" id="3792154">=</span>&nbsp;<span class="ident" id="3792156">decodeRFC2047Word</span><span class="op" id="3792173">(</span><span class="ident" id="3792174">word</span><span class="op" id="3792178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3792182">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3792187">if</span>&nbsp;<span class="ident" id="3792190">err</span>&nbsp;<span class="op" id="3792194">!=</span>&nbsp;<span class="ident" id="3792197">nil</span>&nbsp;<span class="op" id="3792201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3792206">break</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3792214">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3792218">debug</span><span class="op" id="3792223">.</span><span class="ident" id="3792224">Printf</span><span class="op" id="3792230">(</span><span class="string" id="3792231">&#34;consumePhrase:&nbsp;consumed&nbsp;%q&#34;</span><span class="op" id="3792259">,</span>&nbsp;<span class="ident" id="3792261">word</span><span class="op" id="3792265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3792269">words</span>&nbsp;<span class="op" id="3792275">=</span>&nbsp;<span class="builtinfunc" id="3792277">append</span><span class="op" id="3792283">(</span><span class="ident" id="3792284">words</span><span class="op" id="3792289">,</span>&nbsp;<span class="ident" id="3792291">word</span><span class="op" id="3792295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3792298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3792301">//&nbsp;Ignore&nbsp;any&nbsp;error&nbsp;if&nbsp;we&nbsp;got&nbsp;at&nbsp;least&nbsp;one&nbsp;word.</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3792351">if</span>&nbsp;<span class="ident" id="3792354">err</span>&nbsp;<span class="op" id="3792358">!=</span>&nbsp;<span class="ident" id="3792361">nil</span>&nbsp;<span class="op" id="3792365">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3792368">len</span><span class="op" id="3792371">(</span><span class="ident" id="3792372">words</span><span class="op" id="3792377">)</span>&nbsp;<span class="op" id="3792379">==</span>&nbsp;<span class="num" id="3792382">0</span>&nbsp;<span class="op" id="3792384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3792388">debug</span><span class="op" id="3792393">.</span><span class="ident" id="3792394">Printf</span><span class="op" id="3792400">(</span><span class="string" id="3792401">&#34;consumePhrase:&nbsp;hit&nbsp;err:&nbsp;%v&#34;</span><span class="op" id="3792429">,</span>&nbsp;<span class="ident" id="3792431">err</span><span class="op" id="3792434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3792438">return</span>&nbsp;<span class="string" id="3792445">&#34;&#34;</span><span class="op" id="3792447">,</span>&nbsp;<span class="ident" id="3792449">fmt</span><span class="op" id="3792452">.</span><span class="ident" id="3792453">Errorf</span><span class="op" id="3792459">(</span><span class="string" id="3792460">&#34;mail:&nbsp;missing&nbsp;word&nbsp;in&nbsp;phrase:&nbsp;%v&#34;</span><span class="op" id="3792494">,</span>&nbsp;<span class="ident" id="3792496">err</span><span class="op" id="3792499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3792502">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3792505">phrase</span>&nbsp;<span class="op" id="3792512">=</span>&nbsp;<span class="ident" id="3792514">strings</span><span class="op" id="3792521">.</span><span class="ident" id="3792522">Join</span><span class="op" id="3792526">(</span><span class="ident" id="3792527">words</span><span class="op" id="3792532">,</span>&nbsp;<span class="string" id="3792534">&#34;&nbsp;&#34;</span><span class="op" id="3792537">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3792540">return</span>&nbsp;<span class="ident" id="3792547">phrase</span><span class="op" id="3792553">,</span>&nbsp;<span class="ident" id="3792555">nil</span><br>
<span class="lineno"></span><span class="op" id="3792559">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3792562">//&nbsp;consumeQuotedString&nbsp;parses&nbsp;the&nbsp;quoted&nbsp;string&nbsp;at&nbsp;the&nbsp;start&nbsp;of&nbsp;p.</span><br>
<span class="lineno"></span><span class="keyword" id="3792629">func</span>&nbsp;<span class="op" id="3792634">(</span><span class="ident" id="3792635">p</span>&nbsp;<span class="op" id="3792637">*</span><span class="ident" id="3792638">addrParser</span><span class="op" id="3792648">)</span>&nbsp;<span class="ident" id="3792650">consumeQuotedString</span><span class="op" id="3792669">(</span><span class="op" id="3792670">)</span>&nbsp;<span class="op" id="3792672">(</span><span class="ident" id="3792673">qs</span>&nbsp;<span class="builtintype" id="3792676">string</span><span class="op" id="3792682">,</span>&nbsp;<span class="ident" id="3792684">err</span>&nbsp;<span class="builtintype" id="3792688">error</span><span class="op" id="3792693">)</span>&nbsp;<span class="op" id="3792695">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3792698">//&nbsp;Assume&nbsp;first&nbsp;byte&nbsp;is&nbsp;&#39;&#34;&#39;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3792728">i</span>&nbsp;<span class="op" id="3792730">:=</span>&nbsp;<span class="num" id="3792733">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3792736">qsb</span>&nbsp;<span class="op" id="3792740">:=</span>&nbsp;<span class="builtinfunc" id="3792743">make</span><span class="op" id="3792747">(</span><span class="op" id="3792748">[</span><span class="op" id="3792749">]</span><span class="builtintype" id="3792750">byte</span><span class="op" id="3792754">,</span>&nbsp;<span class="num" id="3792756">0</span><span class="op" id="3792757">,</span>&nbsp;<span class="num" id="3792759">10</span><span class="op" id="3792761">)</span><br>
<span class="lineno"></span><span class="ident" id="3792763">Loop</span><span class="op" id="3792767">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3792770">for</span>&nbsp;<span class="op" id="3792774">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3792778">if</span>&nbsp;<span class="ident" id="3792781">i</span>&nbsp;<span class="op" id="3792783">&gt;=</span>&nbsp;<span class="ident" id="3792786">p</span><span class="op" id="3792787">.</span><span class="builtinfunc" id="3792788">len</span><span class="op" id="3792791">(</span><span class="op" id="3792792">)</span>&nbsp;<span class="op" id="3792794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3792799">return</span>&nbsp;<span class="string" id="3792806">&#34;&#34;</span><span class="op" id="3792808">,</span>&nbsp;<span class="ident" id="3792810">errors</span><span class="op" id="3792816">.</span><span class="ident" id="3792817">New</span><span class="op" id="3792820">(</span><span class="string" id="3792821">&#34;mail:&nbsp;unclosed&nbsp;quoted-string&#34;</span><span class="op" id="3792851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3792855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3792859">switch</span>&nbsp;<span class="ident" id="3792866">c</span>&nbsp;<span class="op" id="3792868">:=</span>&nbsp;<span class="op" id="3792871">(</span><span class="op" id="3792872">*</span><span class="ident" id="3792873">p</span><span class="op" id="3792874">)</span><span class="op" id="3792875">[</span><span class="ident" id="3792876">i</span><span class="op" id="3792877">]</span><span class="op" id="3792878">;</span>&nbsp;<span class="op" id="3792880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3792884">case</span>&nbsp;<span class="ident" id="3792889">c</span>&nbsp;<span class="op" id="3792891">==</span>&nbsp;<span class="string" id="3792894">&#39;&#34;&#39;</span><span class="op" id="3792897">:</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3792902">break</span>&nbsp;<span class="ident" id="3792908">Loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3792915">case</span>&nbsp;<span class="ident" id="3792920">c</span>&nbsp;<span class="op" id="3792922">==</span>&nbsp;<span class="string" id="3792925">&#39;\\&#39;</span><span class="op" id="3792929">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3792934">if</span>&nbsp;<span class="ident" id="3792937">i</span><span class="op" id="3792938">+</span><span class="num" id="3792939">1</span>&nbsp;<span class="op" id="3792941">==</span>&nbsp;<span class="ident" id="3792944">p</span><span class="op" id="3792945">.</span><span class="builtinfunc" id="3792946">len</span><span class="op" id="3792949">(</span><span class="op" id="3792950">)</span>&nbsp;<span class="op" id="3792952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3792958">return</span>&nbsp;<span class="string" id="3792965">&#34;&#34;</span><span class="op" id="3792967">,</span>&nbsp;<span class="ident" id="3792969">errors</span><span class="op" id="3792975">.</span><span class="ident" id="3792976">New</span><span class="op" id="3792979">(</span><span class="string" id="3792980">&#34;mail:&nbsp;unclosed&nbsp;quoted-string&#34;</span><span class="op" id="3793010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3793015">}</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3793020">qsb</span>&nbsp;<span class="op" id="3793024">=</span>&nbsp;<span class="builtinfunc" id="3793026">append</span><span class="op" id="3793032">(</span><span class="ident" id="3793033">qsb</span><span class="op" id="3793036">,</span>&nbsp;<span class="op" id="3793038">(</span><span class="op" id="3793039">*</span><span class="ident" id="3793040">p</span><span class="op" id="3793041">)</span><span class="op" id="3793042">[</span><span class="ident" id="3793043">i</span><span class="op" id="3793044">+</span><span class="num" id="3793045">1</span><span class="op" id="3793046">]</span><span class="op" id="3793047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3793052">i</span>&nbsp;<span class="op" id="3793054">+=</span>&nbsp;<span class="num" id="3793057">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3793061">case</span>&nbsp;<span class="ident" id="3793066">isQtext</span><span class="op" id="3793073">(</span><span class="ident" id="3793074">c</span><span class="op" id="3793075">)</span><span class="op" id="3793076">,</span>&nbsp;<span class="ident" id="3793078">c</span>&nbsp;<span class="op" id="3793080">==</span>&nbsp;<span class="string" id="3793083">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3793087">||</span>&nbsp;<span class="ident" id="3793090">c</span>&nbsp;<span class="op" id="3793092">==</span>&nbsp;<span class="string" id="3793095">&#39;\t&#39;</span><span class="op" id="3793099">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3793104">//&nbsp;qtext&nbsp;(printable&nbsp;US-ASCII&nbsp;excluding&nbsp;&#34;&nbsp;and&nbsp;\),&nbsp;or</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3793159">//&nbsp;FWS&nbsp;(almost;&nbsp;we&#39;re&nbsp;ignoring&nbsp;CRLF)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3793199">qsb</span>&nbsp;<span class="op" id="3793203">=</span>&nbsp;<span class="builtinfunc" id="3793205">append</span><span class="op" id="3793211">(</span><span class="ident" id="3793212">qsb</span><span class="op" id="3793215">,</span>&nbsp;<span class="ident" id="3793217">c</span><span class="op" id="3793218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3793223">i</span><span class="op" id="3793224">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3793229">default</span><span class="op" id="3793236">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3793241">return</span>&nbsp;<span class="string" id="3793248">&#34;&#34;</span><span class="op" id="3793250">,</span>&nbsp;<span class="ident" id="3793252">fmt</span><span class="op" id="3793255">.</span><span class="ident" id="3793256">Errorf</span><span class="op" id="3793262">(</span><span class="string" id="3793263">&#34;mail:&nbsp;bad&nbsp;character&nbsp;in&nbsp;quoted-string:&nbsp;%q&#34;</span><span class="op" id="3793305">,</span>&nbsp;<span class="ident" id="3793307">c</span><span class="op" id="3793308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3793312">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3793315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3793318">*</span><span class="ident" id="3793319">p</span>&nbsp;<span class="op" id="3793321">=</span>&nbsp;<span class="op" id="3793323">(</span><span class="op" id="3793324">*</span><span class="ident" id="3793325">p</span><span class="op" id="3793326">)</span><span class="op" id="3793327">[</span><span class="ident" id="3793328">i</span><span class="op" id="3793329">+</span><span class="num" id="3793330">1</span><span class="op" id="3793331">:</span><span class="op" id="3793332">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3793335">return</span>&nbsp;<span class="builtintype" id="3793342">string</span><span class="op" id="3793348">(</span><span class="ident" id="3793349">qsb</span><span class="op" id="3793352">)</span><span class="op" id="3793353">,</span>&nbsp;<span class="ident" id="3793355">nil</span><br>
<span class="lineno"></span><span class="op" id="3793359">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span><span class="comment" id="3793362">//&nbsp;consumeAtom&nbsp;parses&nbsp;an&nbsp;RFC&nbsp;5322&nbsp;atom&nbsp;at&nbsp;the&nbsp;start&nbsp;of&nbsp;p.</span><br>
<span class="lineno"></span><span class="comment" id="3793420">//&nbsp;If&nbsp;dot&nbsp;is&nbsp;true,&nbsp;consumeAtom&nbsp;parses&nbsp;an&nbsp;RFC&nbsp;5322&nbsp;dot-atom&nbsp;instead.</span><br>
<span class="lineno"></span><span class="keyword" id="3793488">func</span>&nbsp;<span class="op" id="3793493">(</span><span class="ident" id="3793494">p</span>&nbsp;<span class="op" id="3793496">*</span><span class="ident" id="3793497">addrParser</span><span class="op" id="3793507">)</span>&nbsp;<span class="ident" id="3793509">consumeAtom</span><span class="op" id="3793520">(</span><span class="ident" id="3793521">dot</span>&nbsp;<span class="builtintype" id="3793525">bool</span><span class="op" id="3793529">)</span>&nbsp;<span class="op" id="3793531">(</span><span class="ident" id="3793532">atom</span>&nbsp;<span class="builtintype" id="3793537">string</span><span class="op" id="3793543">,</span>&nbsp;<span class="ident" id="3793545">err</span>&nbsp;<span class="builtintype" id="3793549">error</span><span class="op" id="3793554">)</span>&nbsp;<span class="op" id="3793556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3793559">if</span>&nbsp;<span class="op" id="3793562">!</span><span class="ident" id="3793563">isAtext</span><span class="op" id="3793570">(</span><span class="ident" id="3793571">p</span><span class="op" id="3793572">.</span><span class="ident" id="3793573">peek</span><span class="op" id="3793577">(</span><span class="op" id="3793578">)</span><span class="op" id="3793579">,</span>&nbsp;<span class="builtintype" id="3793581">false</span><span class="op" id="3793586">)</span>&nbsp;<span class="op" id="3793588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3793592">return</span>&nbsp;<span class="string" id="3793599">&#34;&#34;</span><span class="op" id="3793601">,</span>&nbsp;<span class="ident" id="3793603">errors</span><span class="op" id="3793609">.</span><span class="ident" id="3793610">New</span><span class="op" id="3793613">(</span><span class="string" id="3793614">&#34;mail:&nbsp;invalid&nbsp;string&#34;</span><span class="op" id="3793636">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3793639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3793642">i</span>&nbsp;<span class="op" id="3793644">:=</span>&nbsp;<span class="num" id="3793647">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3793650">for</span>&nbsp;<span class="op" id="3793654">;</span>&nbsp;<span class="ident" id="3793656">i</span>&nbsp;<span class="op" id="3793658">&lt;</span>&nbsp;<span class="ident" id="3793660">p</span><span class="op" id="3793661">.</span><span class="builtinfunc" id="3793662">len</span><span class="op" id="3793665">(</span><span class="op" id="3793666">)</span>&nbsp;<span class="op" id="3793668">&amp;&amp;</span>&nbsp;<span class="ident" id="3793671">isAtext</span><span class="op" id="3793678">(</span><span class="op" id="3793679">(</span><span class="op" id="3793680">*</span><span class="ident" id="3793681">p</span><span class="op" id="3793682">)</span><span class="op" id="3793683">[</span><span class="ident" id="3793684">i</span><span class="op" id="3793685">]</span><span class="op" id="3793686">,</span>&nbsp;<span class="ident" id="3793688">dot</span><span class="op" id="3793691">)</span><span class="op" id="3793692">;</span>&nbsp;<span class="ident" id="3793694">i</span><span class="op" id="3793695">++</span>&nbsp;<span class="op" id="3793698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3793701">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3793704">atom</span><span class="op" id="3793708">,</span>&nbsp;<span class="op" id="3793710">*</span><span class="ident" id="3793711">p</span>&nbsp;<span class="op" id="3793713">=</span>&nbsp;<span class="builtintype" id="3793715">string</span><span class="op" id="3793721">(</span><span class="op" id="3793722">(</span><span class="op" id="3793723">*</span><span class="ident" id="3793724">p</span><span class="op" id="3793725">)</span><span class="op" id="3793726">[</span><span class="op" id="3793727">:</span><span class="ident" id="3793728">i</span><span class="op" id="3793729">]</span><span class="op" id="3793730">)</span><span class="op" id="3793731">,</span>&nbsp;<span class="op" id="3793733">(</span><span class="op" id="3793734">*</span><span class="ident" id="3793735">p</span><span class="op" id="3793736">)</span><span class="op" id="3793737">[</span><span class="ident" id="3793738">i</span><span class="op" id="3793739">:</span><span class="op" id="3793740">]</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3793743">return</span>&nbsp;<span class="ident" id="3793750">atom</span><span class="op" id="3793754">,</span>&nbsp;<span class="ident" id="3793756">nil</span><br>
<span class="lineno"></span><span class="op" id="3793760">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3793763">func</span>&nbsp;<span class="op" id="3793768">(</span><span class="ident" id="3793769">p</span>&nbsp;<span class="op" id="3793771">*</span><span class="ident" id="3793772">addrParser</span><span class="op" id="3793782">)</span>&nbsp;<span class="ident" id="3793784">consume</span><span class="op" id="3793791">(</span><span class="ident" id="3793792">c</span>&nbsp;<span class="builtintype" id="3793794">byte</span><span class="op" id="3793798">)</span>&nbsp;<span class="builtintype" id="3793800">bool</span>&nbsp;<span class="op" id="3793805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3793808">if</span>&nbsp;<span class="ident" id="3793811">p</span><span class="op" id="3793812">.</span><span class="ident" id="3793813">empty</span><span class="op" id="3793818">(</span><span class="op" id="3793819">)</span>&nbsp;<span class="op" id="3793821">||</span>&nbsp;<span class="ident" id="3793824">p</span><span class="op" id="3793825">.</span><span class="ident" id="3793826">peek</span><span class="op" id="3793830">(</span><span class="op" id="3793831">)</span>&nbsp;<span class="op" id="3793833">!=</span>&nbsp;<span class="ident" id="3793836">c</span>&nbsp;<span class="op" id="3793838">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3793842">return</span>&nbsp;<span class="builtintype" id="3793849">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3793856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3793859">*</span><span class="ident" id="3793860">p</span>&nbsp;<span class="op" id="3793862">=</span>&nbsp;<span class="op" id="3793864">(</span><span class="op" id="3793865">*</span><span class="ident" id="3793866">p</span><span class="op" id="3793867">)</span><span class="op" id="3793868">[</span><span class="num" id="3793869">1</span><span class="op" id="3793870">:</span><span class="op" id="3793871">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3793874">return</span>&nbsp;<span class="builtintype" id="3793881">true</span><br>
<span class="lineno"></span><span class="op" id="3793886">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span><span class="comment" id="3793889">//&nbsp;skipSpace&nbsp;skips&nbsp;the&nbsp;leading&nbsp;space&nbsp;and&nbsp;tab&nbsp;characters.</span><br>
<span class="lineno"></span><span class="keyword" id="3793946">func</span>&nbsp;<span class="op" id="3793951">(</span><span class="ident" id="3793952">p</span>&nbsp;<span class="op" id="3793954">*</span><span class="ident" id="3793955">addrParser</span><span class="op" id="3793965">)</span>&nbsp;<span class="ident" id="3793967">skipSpace</span><span class="op" id="3793976">(</span><span class="op" id="3793977">)</span>&nbsp;<span class="op" id="3793979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3793982">*</span><span class="ident" id="3793983">p</span>&nbsp;<span class="op" id="3793985">=</span>&nbsp;<span class="ident" id="3793987">bytes</span><span class="op" id="3793992">.</span><span class="ident" id="3793993">TrimLeft</span><span class="op" id="3794001">(</span><span class="op" id="3794002">*</span><span class="ident" id="3794003">p</span><span class="op" id="3794004">,</span>&nbsp;<span class="string" id="3794006">&#34;&nbsp;\t&#34;</span><span class="op" id="3794011">)</span><br>
<span class="lineno"></span><span class="op" id="3794013">}</span><br>
<span class="lineno">430</span><br>
<span class="lineno"></span><span class="keyword" id="3794016">func</span>&nbsp;<span class="op" id="3794021">(</span><span class="ident" id="3794022">p</span>&nbsp;<span class="op" id="3794024">*</span><span class="ident" id="3794025">addrParser</span><span class="op" id="3794035">)</span>&nbsp;<span class="ident" id="3794037">peek</span><span class="op" id="3794041">(</span><span class="op" id="3794042">)</span>&nbsp;<span class="builtintype" id="3794044">byte</span>&nbsp;<span class="op" id="3794049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3794052">return</span>&nbsp;<span class="op" id="3794059">(</span><span class="op" id="3794060">*</span><span class="ident" id="3794061">p</span><span class="op" id="3794062">)</span><span class="op" id="3794063">[</span><span class="num" id="3794064">0</span><span class="op" id="3794065">]</span><br>
<span class="lineno"></span><span class="op" id="3794067">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span><span class="keyword" id="3794070">func</span>&nbsp;<span class="op" id="3794075">(</span><span class="ident" id="3794076">p</span>&nbsp;<span class="op" id="3794078">*</span><span class="ident" id="3794079">addrParser</span><span class="op" id="3794089">)</span>&nbsp;<span class="ident" id="3794091">empty</span><span class="op" id="3794096">(</span><span class="op" id="3794097">)</span>&nbsp;<span class="builtintype" id="3794099">bool</span>&nbsp;<span class="op" id="3794104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3794107">return</span>&nbsp;<span class="ident" id="3794114">p</span><span class="op" id="3794115">.</span><span class="builtinfunc" id="3794116">len</span><span class="op" id="3794119">(</span><span class="op" id="3794120">)</span>&nbsp;<span class="op" id="3794122">==</span>&nbsp;<span class="num" id="3794125">0</span><br>
<span class="lineno"></span><span class="op" id="3794127">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3794130">func</span>&nbsp;<span class="op" id="3794135">(</span><span class="ident" id="3794136">p</span>&nbsp;<span class="op" id="3794138">*</span><span class="ident" id="3794139">addrParser</span><span class="op" id="3794149">)</span>&nbsp;<span class="builtinfunc" id="3794151">len</span><span class="op" id="3794154">(</span><span class="op" id="3794155">)</span>&nbsp;<span class="builtintype" id="3794157">int</span>&nbsp;<span class="op" id="3794161">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3794164">return</span>&nbsp;<span class="builtinfunc" id="3794171">len</span><span class="op" id="3794174">(</span><span class="op" id="3794175">*</span><span class="ident" id="3794176">p</span><span class="op" id="3794177">)</span><br>
<span class="lineno"></span><span class="op" id="3794179">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3794182">func</span>&nbsp;<span class="ident" id="3794187">decodeRFC2047Word</span><span class="op" id="3794204">(</span><span class="ident" id="3794205">s</span>&nbsp;<span class="builtintype" id="3794207">string</span><span class="op" id="3794213">)</span>&nbsp;<span class="op" id="3794215">(</span><span class="builtintype" id="3794216">string</span><span class="op" id="3794222">,</span>&nbsp;<span class="builtintype" id="3794224">error</span><span class="op" id="3794229">)</span>&nbsp;<span class="op" id="3794231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3794234">fields</span>&nbsp;<span class="op" id="3794241">:=</span>&nbsp;<span class="ident" id="3794244">strings</span><span class="op" id="3794251">.</span><span class="ident" id="3794252">Split</span><span class="op" id="3794257">(</span><span class="ident" id="3794258">s</span><span class="op" id="3794259">,</span>&nbsp;<span class="string" id="3794261">&#34;?&#34;</span><span class="op" id="3794264">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3794267">if</span>&nbsp;<span class="builtinfunc" id="3794270">len</span><span class="op" id="3794273">(</span><span class="ident" id="3794274">fields</span><span class="op" id="3794280">)</span>&nbsp;<span class="op" id="3794282">!=</span>&nbsp;<span class="num" id="3794285">5</span>&nbsp;<span class="op" id="3794287">||</span>&nbsp;<span class="ident" id="3794290">fields</span><span class="op" id="3794296">[</span><span class="num" id="3794297">0</span><span class="op" id="3794298">]</span>&nbsp;<span class="op" id="3794300">!=</span>&nbsp;<span class="string" id="3794303">&#34;=&#34;</span>&nbsp;<span class="op" id="3794307">||</span>&nbsp;<span class="ident" id="3794310">fields</span><span class="op" id="3794316">[</span><span class="num" id="3794317">4</span><span class="op" id="3794318">]</span>&nbsp;<span class="op" id="3794320">!=</span>&nbsp;<span class="string" id="3794323">&#34;=&#34;</span>&nbsp;<span class="op" id="3794327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3794331">return</span>&nbsp;<span class="string" id="3794338">&#34;&#34;</span><span class="op" id="3794340">,</span>&nbsp;<span class="ident" id="3794342">errors</span><span class="op" id="3794348">.</span><span class="ident" id="3794349">New</span><span class="op" id="3794352">(</span><span class="string" id="3794353">&#34;address&nbsp;not&nbsp;RFC&nbsp;2047&nbsp;encoded&#34;</span><span class="op" id="3794383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3794386">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3794389">charset</span><span class="op" id="3794396">,</span>&nbsp;<span class="ident" id="3794398">enc</span>&nbsp;<span class="op" id="3794402">:=</span>&nbsp;<span class="ident" id="3794405">strings</span><span class="op" id="3794412">.</span><span class="ident" id="3794413">ToLower</span><span class="op" id="3794420">(</span><span class="ident" id="3794421">fields</span><span class="op" id="3794427">[</span><span class="num" id="3794428">1</span><span class="op" id="3794429">]</span><span class="op" id="3794430">)</span><span class="op" id="3794431">,</span>&nbsp;<span class="ident" id="3794433">strings</span><span class="op" id="3794440">.</span><span class="ident" id="3794441">ToLower</span><span class="op" id="3794448">(</span><span class="ident" id="3794449">fields</span><span class="op" id="3794455">[</span><span class="num" id="3794456">2</span><span class="op" id="3794457">]</span><span class="op" id="3794458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3794461">if</span>&nbsp;<span class="ident" id="3794464">charset</span>&nbsp;<span class="op" id="3794472">!=</span>&nbsp;<span class="string" id="3794475">&#34;us-ascii&#34;</span>&nbsp;<span class="op" id="3794486">&amp;&amp;</span>&nbsp;<span class="ident" id="3794489">charset</span>&nbsp;<span class="op" id="3794497">!=</span>&nbsp;<span class="string" id="3794500">&#34;iso-8859-1&#34;</span>&nbsp;<span class="op" id="3794513">&amp;&amp;</span>&nbsp;<span class="ident" id="3794516">charset</span>&nbsp;<span class="op" id="3794524">!=</span>&nbsp;<span class="string" id="3794527">&#34;utf-8&#34;</span>&nbsp;<span class="op" id="3794535">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3794539">return</span>&nbsp;<span class="string" id="3794546">&#34;&#34;</span><span class="op" id="3794548">,</span>&nbsp;<span class="ident" id="3794550">fmt</span><span class="op" id="3794553">.</span><span class="ident" id="3794554">Errorf</span><span class="op" id="3794560">(</span><span class="string" id="3794561">&#34;charset&nbsp;not&nbsp;supported:&nbsp;%q&#34;</span><span class="op" id="3794588">,</span>&nbsp;<span class="ident" id="3794590">charset</span><span class="op" id="3794597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3794600">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3794604">in</span>&nbsp;<span class="op" id="3794607">:=</span>&nbsp;<span class="ident" id="3794610">bytes</span><span class="op" id="3794615">.</span><span class="ident" id="3794616">NewBufferString</span><span class="op" id="3794631">(</span><span class="ident" id="3794632">fields</span><span class="op" id="3794638">[</span><span class="num" id="3794639">3</span><span class="op" id="3794640">]</span><span class="op" id="3794641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3794644">var</span>&nbsp;<span class="ident" id="3794648">r</span>&nbsp;<span class="ident" id="3794650">io</span><span class="op" id="3794652">.</span><span class="ident" id="3794653">Reader</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3794661">switch</span>&nbsp;<span class="ident" id="3794668">enc</span>&nbsp;<span class="op" id="3794672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3794675">case</span>&nbsp;<span class="string" id="3794680">&#34;b&#34;</span><span class="op" id="3794683">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3794687">r</span>&nbsp;<span class="op" id="3794689">=</span>&nbsp;<span class="ident" id="3794691">base64</span><span class="op" id="3794697">.</span><span class="ident" id="3794698">NewDecoder</span><span class="op" id="3794708">(</span><span class="ident" id="3794709">base64</span><span class="op" id="3794715">.</span><span class="ident" id="3794716">StdEncoding</span><span class="op" id="3794727">,</span>&nbsp;<span class="ident" id="3794729">in</span><span class="op" id="3794731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3794734">case</span>&nbsp;<span class="string" id="3794739">&#34;q&#34;</span><span class="op" id="3794742">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3794746">r</span>&nbsp;<span class="op" id="3794748">=</span>&nbsp;<span class="ident" id="3794750">qDecoder</span><span class="op" id="3794758">{</span><span class="ident" id="3794759">r</span><span class="op" id="3794760">:</span>&nbsp;<span class="ident" id="3794762">in</span><span class="op" id="3794764">}</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3794767">default</span><span class="op" id="3794774">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3794778">return</span>&nbsp;<span class="string" id="3794785">&#34;&#34;</span><span class="op" id="3794787">,</span>&nbsp;<span class="ident" id="3794789">fmt</span><span class="op" id="3794792">.</span><span class="ident" id="3794793">Errorf</span><span class="op" id="3794799">(</span><span class="string" id="3794800">&#34;RFC&nbsp;2047&nbsp;encoding&nbsp;not&nbsp;supported:&nbsp;%q&#34;</span><span class="op" id="3794837">,</span>&nbsp;<span class="ident" id="3794839">enc</span><span class="op" id="3794842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3794845">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3794849">dec</span><span class="op" id="3794852">,</span>&nbsp;<span class="ident" id="3794854">err</span>&nbsp;<span class="op" id="3794858">:=</span>&nbsp;<span class="ident" id="3794861">ioutil</span><span class="op" id="3794867">.</span><span class="ident" id="3794868">ReadAll</span><span class="op" id="3794875">(</span><span class="ident" id="3794876">r</span><span class="op" id="3794877">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3794880">if</span>&nbsp;<span class="ident" id="3794883">err</span>&nbsp;<span class="op" id="3794887">!=</span>&nbsp;<span class="ident" id="3794890">nil</span>&nbsp;<span class="op" id="3794894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3794898">return</span>&nbsp;<span class="string" id="3794905">&#34;&#34;</span><span class="op" id="3794907">,</span>&nbsp;<span class="ident" id="3794909">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3794914">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3794918">switch</span>&nbsp;<span class="ident" id="3794925">charset</span>&nbsp;<span class="op" id="3794933">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3794936">case</span>&nbsp;<span class="string" id="3794941">&#34;us-ascii&#34;</span><span class="op" id="3794951">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3794955">b</span>&nbsp;<span class="op" id="3794957">:=</span>&nbsp;<span class="builtinfunc" id="3794960">new</span><span class="op" id="3794963">(</span><span class="ident" id="3794964">bytes</span><span class="op" id="3794969">.</span><span class="ident" id="3794970">Buffer</span><span class="op" id="3794976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3794980">for</span>&nbsp;<span class="ident" id="3794984">_</span><span class="op" id="3794985">,</span>&nbsp;<span class="ident" id="3794987">c</span>&nbsp;<span class="op" id="3794989">:=</span>&nbsp;<span class="keyword" id="3794992">range</span>&nbsp;<span class="ident" id="3794998">dec</span>&nbsp;<span class="op" id="3795002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3795007">if</span>&nbsp;<span class="ident" id="3795010">c</span>&nbsp;<span class="op" id="3795012">&gt;=</span>&nbsp;<span class="num" id="3795015">0x80</span>&nbsp;<span class="op" id="3795020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3795026">b</span><span class="op" id="3795027">.</span><span class="ident" id="3795028">WriteRune</span><span class="op" id="3795037">(</span><span class="ident" id="3795038">unicode</span><span class="op" id="3795045">.</span><span class="ident" id="3795046">ReplacementChar</span><span class="op" id="3795061">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3795066">}</span>&nbsp;<span class="keyword" id="3795068">else</span>&nbsp;<span class="op" id="3795073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3795079">b</span><span class="op" id="3795080">.</span><span class="ident" id="3795081">WriteRune</span><span class="op" id="3795090">(</span><span class="builtintype" id="3795091">rune</span><span class="op" id="3795095">(</span><span class="ident" id="3795096">c</span><span class="op" id="3795097">)</span><span class="op" id="3795098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3795103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3795107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3795111">return</span>&nbsp;<span class="ident" id="3795118">b</span><span class="op" id="3795119">.</span><span class="ident" id="3795120">String</span><span class="op" id="3795126">(</span><span class="op" id="3795127">)</span><span class="op" id="3795128">,</span>&nbsp;<span class="ident" id="3795130">nil</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3795135">case</span>&nbsp;<span class="string" id="3795140">&#34;iso-8859-1&#34;</span><span class="op" id="3795152">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3795156">b</span>&nbsp;<span class="op" id="3795158">:=</span>&nbsp;<span class="builtinfunc" id="3795161">new</span><span class="op" id="3795164">(</span><span class="ident" id="3795165">bytes</span><span class="op" id="3795170">.</span><span class="ident" id="3795171">Buffer</span><span class="op" id="3795177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3795181">for</span>&nbsp;<span class="ident" id="3795185">_</span><span class="op" id="3795186">,</span>&nbsp;<span class="ident" id="3795188">c</span>&nbsp;<span class="op" id="3795190">:=</span>&nbsp;<span class="keyword" id="3795193">range</span>&nbsp;<span class="ident" id="3795199">dec</span>&nbsp;<span class="op" id="3795203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3795208">b</span><span class="op" id="3795209">.</span><span class="ident" id="3795210">WriteRune</span><span class="op" id="3795219">(</span><span class="builtintype" id="3795220">rune</span><span class="op" id="3795224">(</span><span class="ident" id="3795225">c</span><span class="op" id="3795226">)</span><span class="op" id="3795227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3795231">}</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3795235">return</span>&nbsp;<span class="ident" id="3795242">b</span><span class="op" id="3795243">.</span><span class="ident" id="3795244">String</span><span class="op" id="3795250">(</span><span class="op" id="3795251">)</span><span class="op" id="3795252">,</span>&nbsp;<span class="ident" id="3795254">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3795259">case</span>&nbsp;<span class="string" id="3795264">&#34;utf-8&#34;</span><span class="op" id="3795271">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3795275">return</span>&nbsp;<span class="builtintype" id="3795282">string</span><span class="op" id="3795288">(</span><span class="ident" id="3795289">dec</span><span class="op" id="3795292">)</span><span class="op" id="3795293">,</span>&nbsp;<span class="ident" id="3795295">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3795300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3795303">panic</span><span class="op" id="3795308">(</span><span class="string" id="3795309">&#34;unreachable&#34;</span><span class="op" id="3795322">)</span><br>
<span class="lineno">490</span><span class="op" id="3795324">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3795327">type</span>&nbsp;<span class="ident" id="3795332">qDecoder</span>&nbsp;<span class="keyword" id="3795341">struct</span>&nbsp;<span class="op" id="3795348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3795351">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3795359">io</span><span class="op" id="3795361">.</span><span class="ident" id="3795362">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3795370">scratch</span>&nbsp;<span class="op" id="3795378">[</span><span class="num" id="3795379">2</span><span class="op" id="3795380">]</span><span class="builtintype" id="3795381">byte</span><br>
<span class="lineno">495</span><span class="op" id="3795386">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3795389">func</span>&nbsp;<span class="op" id="3795394">(</span><span class="ident" id="3795395">qd</span>&nbsp;<span class="ident" id="3795398">qDecoder</span><span class="op" id="3795406">)</span>&nbsp;<span class="ident" id="3795408">Read</span><span class="op" id="3795412">(</span><span class="ident" id="3795413">p</span>&nbsp;<span class="op" id="3795415">[</span><span class="op" id="3795416">]</span><span class="builtintype" id="3795417">byte</span><span class="op" id="3795421">)</span>&nbsp;<span class="op" id="3795423">(</span><span class="ident" id="3795424">n</span>&nbsp;<span class="builtintype" id="3795426">int</span><span class="op" id="3795429">,</span>&nbsp;<span class="ident" id="3795431">err</span>&nbsp;<span class="builtintype" id="3795435">error</span><span class="op" id="3795440">)</span>&nbsp;<span class="op" id="3795442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3795445">//&nbsp;This&nbsp;method&nbsp;writes&nbsp;at&nbsp;most&nbsp;one&nbsp;byte&nbsp;into&nbsp;p.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3795493">if</span>&nbsp;<span class="builtinfunc" id="3795496">len</span><span class="op" id="3795499">(</span><span class="ident" id="3795500">p</span><span class="op" id="3795501">)</span>&nbsp;<span class="op" id="3795503">==</span>&nbsp;<span class="num" id="3795506">0</span>&nbsp;<span class="op" id="3795508">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3795512">return</span>&nbsp;<span class="num" id="3795519">0</span><span class="op" id="3795520">,</span>&nbsp;<span class="ident" id="3795522">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3795527">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3795530">if</span>&nbsp;<span class="ident" id="3795533">_</span><span class="op" id="3795534">,</span>&nbsp;<span class="ident" id="3795536">err</span>&nbsp;<span class="op" id="3795540">:=</span>&nbsp;<span class="ident" id="3795543">qd</span><span class="op" id="3795545">.</span><span class="ident" id="3795546">r</span><span class="op" id="3795547">.</span><span class="ident" id="3795548">Read</span><span class="op" id="3795552">(</span><span class="ident" id="3795553">qd</span><span class="op" id="3795555">.</span><span class="ident" id="3795556">scratch</span><span class="op" id="3795563">[</span><span class="op" id="3795564">:</span><span class="num" id="3795565">1</span><span class="op" id="3795566">]</span><span class="op" id="3795567">)</span><span class="op" id="3795568">;</span>&nbsp;<span class="ident" id="3795570">err</span>&nbsp;<span class="op" id="3795574">!=</span>&nbsp;<span class="ident" id="3795577">nil</span>&nbsp;<span class="op" id="3795581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3795585">return</span>&nbsp;<span class="num" id="3795592">0</span><span class="op" id="3795593">,</span>&nbsp;<span class="ident" id="3795595">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3795600">}</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3795603">switch</span>&nbsp;<span class="ident" id="3795610">c</span>&nbsp;<span class="op" id="3795612">:=</span>&nbsp;<span class="ident" id="3795615">qd</span><span class="op" id="3795617">.</span><span class="ident" id="3795618">scratch</span><span class="op" id="3795625">[</span><span class="num" id="3795626">0</span><span class="op" id="3795627">]</span><span class="op" id="3795628">;</span>&nbsp;<span class="op" id="3795630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3795633">case</span>&nbsp;<span class="ident" id="3795638">c</span>&nbsp;<span class="op" id="3795640">==</span>&nbsp;<span class="string" id="3795643">&#39;=&#39;</span><span class="op" id="3795646">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3795650">if</span>&nbsp;<span class="ident" id="3795653">_</span><span class="op" id="3795654">,</span>&nbsp;<span class="ident" id="3795656">err</span>&nbsp;<span class="op" id="3795660">:=</span>&nbsp;<span class="ident" id="3795663">io</span><span class="op" id="3795665">.</span><span class="ident" id="3795666">ReadFull</span><span class="op" id="3795674">(</span><span class="ident" id="3795675">qd</span><span class="op" id="3795677">.</span><span class="ident" id="3795678">r</span><span class="op" id="3795679">,</span>&nbsp;<span class="ident" id="3795681">qd</span><span class="op" id="3795683">.</span><span class="ident" id="3795684">scratch</span><span class="op" id="3795691">[</span><span class="op" id="3795692">:</span><span class="num" id="3795693">2</span><span class="op" id="3795694">]</span><span class="op" id="3795695">)</span><span class="op" id="3795696">;</span>&nbsp;<span class="ident" id="3795698">err</span>&nbsp;<span class="op" id="3795702">!=</span>&nbsp;<span class="ident" id="3795705">nil</span>&nbsp;<span class="op" id="3795709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3795714">return</span>&nbsp;<span class="num" id="3795721">0</span><span class="op" id="3795722">,</span>&nbsp;<span class="ident" id="3795724">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3795730">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3795734">x</span><span class="op" id="3795735">,</span>&nbsp;<span class="ident" id="3795737">err</span>&nbsp;<span class="op" id="3795741">:=</span>&nbsp;<span class="ident" id="3795744">strconv</span><span class="op" id="3795751">.</span><span class="ident" id="3795752">ParseInt</span><span class="op" id="3795760">(</span><span class="builtintype" id="3795761">string</span><span class="op" id="3795767">(</span><span class="ident" id="3795768">qd</span><span class="op" id="3795770">.</span><span class="ident" id="3795771">scratch</span><span class="op" id="3795778">[</span><span class="op" id="3795779">:</span><span class="num" id="3795780">2</span><span class="op" id="3795781">]</span><span class="op" id="3795782">)</span><span class="op" id="3795783">,</span>&nbsp;<span class="num" id="3795785">16</span><span class="op" id="3795787">,</span>&nbsp;<span class="num" id="3795789">64</span><span class="op" id="3795791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3795795">if</span>&nbsp;<span class="ident" id="3795798">err</span>&nbsp;<span class="op" id="3795802">!=</span>&nbsp;<span class="ident" id="3795805">nil</span>&nbsp;<span class="op" id="3795809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3795814">return</span>&nbsp;<span class="num" id="3795821">0</span><span class="op" id="3795822">,</span>&nbsp;<span class="ident" id="3795824">fmt</span><span class="op" id="3795827">.</span><span class="ident" id="3795828">Errorf</span><span class="op" id="3795834">(</span><span class="string" id="3795835">&#34;mail:&nbsp;invalid&nbsp;RFC&nbsp;2047&nbsp;encoding:&nbsp;%q&#34;</span><span class="op" id="3795872">,</span>&nbsp;<span class="ident" id="3795874">qd</span><span class="op" id="3795876">.</span><span class="ident" id="3795877">scratch</span><span class="op" id="3795884">[</span><span class="op" id="3795885">:</span><span class="num" id="3795886">2</span><span class="op" id="3795887">]</span><span class="op" id="3795888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3795892">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3795896">p</span><span class="op" id="3795897">[</span><span class="num" id="3795898">0</span><span class="op" id="3795899">]</span>&nbsp;<span class="op" id="3795901">=</span>&nbsp;<span class="builtintype" id="3795903">byte</span><span class="op" id="3795907">(</span><span class="ident" id="3795908">x</span><span class="op" id="3795909">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3795912">case</span>&nbsp;<span class="ident" id="3795917">c</span>&nbsp;<span class="op" id="3795919">==</span>&nbsp;<span class="string" id="3795922">&#39;_&#39;</span><span class="op" id="3795925">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3795929">p</span><span class="op" id="3795930">[</span><span class="num" id="3795931">0</span><span class="op" id="3795932">]</span>&nbsp;<span class="op" id="3795934">=</span>&nbsp;<span class="string" id="3795936">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3795941">default</span><span class="op" id="3795948">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3795952">p</span><span class="op" id="3795953">[</span><span class="num" id="3795954">0</span><span class="op" id="3795955">]</span>&nbsp;<span class="op" id="3795957">=</span>&nbsp;<span class="ident" id="3795959">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3795962">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3795965">return</span>&nbsp;<span class="num" id="3795972">1</span><span class="op" id="3795973">,</span>&nbsp;<span class="ident" id="3795975">nil</span><br>
<span class="lineno"></span><span class="op" id="3795979">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3795982">var</span>&nbsp;<span class="ident" id="3795986">atextChars</span>&nbsp;<span class="op" id="3795997">=</span>&nbsp;<span class="op" id="3795999">[</span><span class="op" id="3796000">]</span><span class="builtintype" id="3796001">byte</span><span class="op" id="3796005">(</span><span class="string" id="3796006">&#34;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#34;</span>&nbsp;<span class="op" id="3796035">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3796038">&#34;abcdefghijklmnopqrstuvwxyz&#34;</span>&nbsp;<span class="op" id="3796067">+</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3796070">&#34;0123456789&#34;</span>&nbsp;<span class="op" id="3796083">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3796086">&#34;!#$%&amp;&#39;*+-/=?^_`{|}~&#34;</span><span class="op" id="3796107">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3796110">//&nbsp;isAtext&nbsp;returns&nbsp;true&nbsp;if&nbsp;c&nbsp;is&nbsp;an&nbsp;RFC&nbsp;5322&nbsp;atext&nbsp;character.</span><br>
<span class="lineno"></span><span class="comment" id="3796171">//&nbsp;If&nbsp;dot&nbsp;is&nbsp;true,&nbsp;period&nbsp;is&nbsp;included.</span><br>
<span class="lineno">530</span><span class="keyword" id="3796210">func</span>&nbsp;<span class="ident" id="3796215">isAtext</span><span class="op" id="3796222">(</span><span class="ident" id="3796223">c</span>&nbsp;<span class="builtintype" id="3796225">byte</span><span class="op" id="3796229">,</span>&nbsp;<span class="ident" id="3796231">dot</span>&nbsp;<span class="builtintype" id="3796235">bool</span><span class="op" id="3796239">)</span>&nbsp;<span class="builtintype" id="3796241">bool</span>&nbsp;<span class="op" id="3796246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3796249">if</span>&nbsp;<span class="ident" id="3796252">dot</span>&nbsp;<span class="op" id="3796256">&amp;&amp;</span>&nbsp;<span class="ident" id="3796259">c</span>&nbsp;<span class="op" id="3796261">==</span>&nbsp;<span class="string" id="3796264">&#39;.&#39;</span>&nbsp;<span class="op" id="3796268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3796272">return</span>&nbsp;<span class="builtintype" id="3796279">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3796285">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3796288">return</span>&nbsp;<span class="ident" id="3796295">bytes</span><span class="op" id="3796300">.</span><span class="ident" id="3796301">IndexByte</span><span class="op" id="3796310">(</span><span class="ident" id="3796311">atextChars</span><span class="op" id="3796321">,</span>&nbsp;<span class="ident" id="3796323">c</span><span class="op" id="3796324">)</span>&nbsp;<span class="op" id="3796326">&gt;=</span>&nbsp;<span class="num" id="3796329">0</span><br>
<span class="lineno">535</span><span class="op" id="3796331">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3796334">//&nbsp;isQtext&nbsp;returns&nbsp;true&nbsp;if&nbsp;c&nbsp;is&nbsp;an&nbsp;RFC&nbsp;5322&nbsp;qtext&nbsp;character.</span><br>
<span class="lineno"></span><span class="keyword" id="3796395">func</span>&nbsp;<span class="ident" id="3796400">isQtext</span><span class="op" id="3796407">(</span><span class="ident" id="3796408">c</span>&nbsp;<span class="builtintype" id="3796410">byte</span><span class="op" id="3796414">)</span>&nbsp;<span class="builtintype" id="3796416">bool</span>&nbsp;<span class="op" id="3796421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3796424">//&nbsp;Printable&nbsp;US-ASCII,&nbsp;excluding&nbsp;backslash&nbsp;or&nbsp;quote.</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3796478">if</span>&nbsp;<span class="ident" id="3796481">c</span>&nbsp;<span class="op" id="3796483">==</span>&nbsp;<span class="string" id="3796486">&#39;\\&#39;</span>&nbsp;<span class="op" id="3796491">||</span>&nbsp;<span class="ident" id="3796494">c</span>&nbsp;<span class="op" id="3796496">==</span>&nbsp;<span class="string" id="3796499">&#39;&#34;&#39;</span>&nbsp;<span class="op" id="3796503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3796507">return</span>&nbsp;<span class="builtintype" id="3796514">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3796521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3796524">return</span>&nbsp;<span class="string" id="3796531">&#39;!&#39;</span>&nbsp;<span class="op" id="3796535">&lt;=</span>&nbsp;<span class="ident" id="3796538">c</span>&nbsp;<span class="op" id="3796540">&amp;&amp;</span>&nbsp;<span class="ident" id="3796543">c</span>&nbsp;<span class="op" id="3796545">&lt;=</span>&nbsp;<span class="string" id="3796548">&#39;~&#39;</span><br>
<span class="lineno"></span><span class="op" id="3796552">}</span><br>
<span class="lineno">545</span><br>
<span class="lineno"></span><span class="comment" id="3796555">//&nbsp;isVchar&nbsp;returns&nbsp;true&nbsp;if&nbsp;c&nbsp;is&nbsp;an&nbsp;RFC&nbsp;5322&nbsp;VCHAR&nbsp;character.</span><br>
<span class="lineno"></span><span class="keyword" id="3796616">func</span>&nbsp;<span class="ident" id="3796621">isVchar</span><span class="op" id="3796628">(</span><span class="ident" id="3796629">c</span>&nbsp;<span class="builtintype" id="3796631">byte</span><span class="op" id="3796635">)</span>&nbsp;<span class="builtintype" id="3796637">bool</span>&nbsp;<span class="op" id="3796642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3796645">//&nbsp;Visible&nbsp;(printing)&nbsp;characters.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3796680">return</span>&nbsp;<span class="string" id="3796687">&#39;!&#39;</span>&nbsp;<span class="op" id="3796691">&lt;=</span>&nbsp;<span class="ident" id="3796694">c</span>&nbsp;<span class="op" id="3796696">&amp;&amp;</span>&nbsp;<span class="ident" id="3796699">c</span>&nbsp;<span class="op" id="3796701">&lt;=</span>&nbsp;<span class="string" id="3796704">&#39;~&#39;</span><br>
<span class="lineno">550</span><span class="op" id="3796708">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3796711">//&nbsp;isWSP&nbsp;returns&nbsp;true&nbsp;if&nbsp;c&nbsp;is&nbsp;a&nbsp;WSP&nbsp;(white&nbsp;space).</span><br>
<span class="lineno"></span><span class="comment" id="3796762">//&nbsp;WSP&nbsp;is&nbsp;a&nbsp;space&nbsp;or&nbsp;horizontal&nbsp;tab&nbsp;(RFC5234&nbsp;Appendix&nbsp;B).</span><br>
<span class="lineno"></span><span class="keyword" id="3796820">func</span>&nbsp;<span class="ident" id="3796825">isWSP</span><span class="op" id="3796830">(</span><span class="ident" id="3796831">c</span>&nbsp;<span class="builtintype" id="3796833">byte</span><span class="op" id="3796837">)</span>&nbsp;<span class="builtintype" id="3796839">bool</span>&nbsp;<span class="op" id="3796844">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3796847">return</span>&nbsp;<span class="ident" id="3796854">c</span>&nbsp;<span class="op" id="3796856">==</span>&nbsp;<span class="string" id="3796859">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3796863">||</span>&nbsp;<span class="ident" id="3796866">c</span>&nbsp;<span class="op" id="3796868">==</span>&nbsp;<span class="string" id="3796871">&#39;\t&#39;</span><br>
<span class="lineno"></span><span class="op" id="3796876">}</span>
</div>
</body>
</html>
