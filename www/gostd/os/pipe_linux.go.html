<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>os</h2>
<ul>
<li><a href="/gostd/os/dir_unix.go.html">dir_unix.go</a></li>
<li><a href="/gostd/os/doc.go.html">doc.go</a></li>
<li><a href="/gostd/os/env.go.html">env.go</a></li>
<li><a href="/gostd/os/env_test.go.html">env_test.go</a></li>
<li><a href="/gostd/os/env_unix_test.go.html">env_unix_test.go</a></li>
<li><a href="/gostd/os/error.go.html">error.go</a></li>
<li><a href="/gostd/os/error_test.go.html">error_test.go</a></li>
<li><a href="/gostd/os/error_unix.go.html">error_unix.go</a></li>
<li><a href="/gostd/os/exec.go.html">exec.go</a></li>
<li><a href="/gostd/os/exec_posix.go.html">exec_posix.go</a></li>
<li><a href="/gostd/os/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/os/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/os/file.go.html">file.go</a></li>
<li><a href="/gostd/os/file_posix.go.html">file_posix.go</a></li>
<li><a href="/gostd/os/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/os/getwd.go.html">getwd.go</a></li>
<li><a href="/gostd/os/os_test.go.html">os_test.go</a></li>
<li><a href="/gostd/os/os_unix_test.go.html">os_unix_test.go</a></li>
<li><a href="/gostd/os/path.go.html">path.go</a></li>
<li><a href="/gostd/os/path_test.go.html">path_test.go</a></li>
<li><a href="/gostd/os/path_unix.go.html">path_unix.go</a></li>
<li><a href="/gostd/os/pipe_linux.go.html" class="current">pipe_linux.go</a></li>
<li><a href="/gostd/os/proc.go.html">proc.go</a></li>
<li><a href="/gostd/os/stat_linux.go.html">stat_linux.go</a></li>
<li><a href="/gostd/os/sys_linux.go.html">sys_linux.go</a></li>
<li><a href="/gostd/os/sys_unix.go.html">sys_unix.go</a></li>
<li><a href="/gostd/os/types.go.html">types.go</a></li>
<li><a href="/gostd/os/types_notwin.go.html">types_notwin.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2357348">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2357403">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2357457">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2357508">package</span>&nbsp;<span class="ident" id="2357516">os</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2357520">import</span>&nbsp;<span class="string" id="2357527">&#34;syscall&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2357538">//&nbsp;Pipe&nbsp;returns&nbsp;a&nbsp;connected&nbsp;pair&nbsp;of&nbsp;Files;&nbsp;reads&nbsp;from&nbsp;r&nbsp;return&nbsp;bytes&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno">10</span><span class="comment" id="2357621">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;files&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="2357667">func</span>&nbsp;<span class="ident" id="2357672">Pipe</span><span class="op" id="2357676">(</span><span class="op" id="2357677">)</span>&nbsp;<span class="op" id="2357679">(</span><span class="ident" id="2357680">r</span>&nbsp;<span class="op" id="2357682">*</span><span class="ident" id="2357683">File</span><span class="op" id="2357687">,</span>&nbsp;<span class="ident" id="2357689">w</span>&nbsp;<span class="op" id="2357691">*</span><span class="ident" id="2357692">File</span><span class="op" id="2357696">,</span>&nbsp;<span class="ident" id="2357698">err</span>&nbsp;<span class="builtintype" id="2357702">error</span><span class="op" id="2357707">)</span>&nbsp;<span class="op" id="2357709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2357712">var</span>&nbsp;<span class="ident" id="2357716">p</span>&nbsp;<span class="op" id="2357718">[</span><span class="num" id="2357719">2</span><span class="op" id="2357720">]</span><span class="builtintype" id="2357721">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2357727">e</span>&nbsp;<span class="op" id="2357729">:=</span>&nbsp;<span class="ident" id="2357732">syscall</span><span class="op" id="2357739">.</span><span class="ident" id="2357740">Pipe2</span><span class="op" id="2357745">(</span><span class="ident" id="2357746">p</span><span class="op" id="2357747">[</span><span class="num" id="2357748">0</span><span class="op" id="2357749">:</span><span class="op" id="2357750">]</span><span class="op" id="2357751">,</span>&nbsp;<span class="ident" id="2357753">syscall</span><span class="op" id="2357760">.</span><span class="ident" id="2357761">O_CLOEXEC</span><span class="op" id="2357770">)</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2357773">//&nbsp;pipe2&nbsp;was&nbsp;added&nbsp;in&nbsp;2.6.27&nbsp;and&nbsp;our&nbsp;minimum&nbsp;requirement&nbsp;is&nbsp;2.6.23,&nbsp;so&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2357848">//&nbsp;might&nbsp;not&nbsp;be&nbsp;implemented.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2357878">if</span>&nbsp;<span class="ident" id="2357881">e</span>&nbsp;<span class="op" id="2357883">==</span>&nbsp;<span class="ident" id="2357886">syscall</span><span class="op" id="2357893">.</span><span class="ident" id="2357894">ENOSYS</span>&nbsp;<span class="op" id="2357901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2357905">//&nbsp;See&nbsp;../syscall/exec.go&nbsp;for&nbsp;description&nbsp;of&nbsp;lock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2357958">syscall</span><span class="op" id="2357965">.</span><span class="ident" id="2357966">ForkLock</span><span class="op" id="2357974">.</span><span class="ident" id="2357975">RLock</span><span class="op" id="2357980">(</span><span class="op" id="2357981">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2357985">e</span>&nbsp;<span class="op" id="2357987">=</span>&nbsp;<span class="ident" id="2357989">syscall</span><span class="op" id="2357996">.</span><span class="ident" id="2357997">Pipe</span><span class="op" id="2358001">(</span><span class="ident" id="2358002">p</span><span class="op" id="2358003">[</span><span class="num" id="2358004">0</span><span class="op" id="2358005">:</span><span class="op" id="2358006">]</span><span class="op" id="2358007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2358011">if</span>&nbsp;<span class="ident" id="2358014">e</span>&nbsp;<span class="op" id="2358016">!=</span>&nbsp;<span class="ident" id="2358019">nil</span>&nbsp;<span class="op" id="2358023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2358028">syscall</span><span class="op" id="2358035">.</span><span class="ident" id="2358036">ForkLock</span><span class="op" id="2358044">.</span><span class="ident" id="2358045">RUnlock</span><span class="op" id="2358052">(</span><span class="op" id="2358053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2358058">return</span>&nbsp;<span class="ident" id="2358065">nil</span><span class="op" id="2358068">,</span>&nbsp;<span class="ident" id="2358070">nil</span><span class="op" id="2358073">,</span>&nbsp;<span class="ident" id="2358075">NewSyscallError</span><span class="op" id="2358090">(</span><span class="string" id="2358091">&#34;pipe&#34;</span><span class="op" id="2358097">,</span>&nbsp;<span class="ident" id="2358099">e</span><span class="op" id="2358100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2358104">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2358108">syscall</span><span class="op" id="2358115">.</span><span class="ident" id="2358116">CloseOnExec</span><span class="op" id="2358127">(</span><span class="ident" id="2358128">p</span><span class="op" id="2358129">[</span><span class="num" id="2358130">0</span><span class="op" id="2358131">]</span><span class="op" id="2358132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2358136">syscall</span><span class="op" id="2358143">.</span><span class="ident" id="2358144">CloseOnExec</span><span class="op" id="2358155">(</span><span class="ident" id="2358156">p</span><span class="op" id="2358157">[</span><span class="num" id="2358158">1</span><span class="op" id="2358159">]</span><span class="op" id="2358160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2358164">syscall</span><span class="op" id="2358171">.</span><span class="ident" id="2358172">ForkLock</span><span class="op" id="2358180">.</span><span class="ident" id="2358181">RUnlock</span><span class="op" id="2358188">(</span><span class="op" id="2358189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2358192">}</span>&nbsp;<span class="keyword" id="2358194">else</span>&nbsp;<span class="keyword" id="2358199">if</span>&nbsp;<span class="ident" id="2358202">e</span>&nbsp;<span class="op" id="2358204">!=</span>&nbsp;<span class="ident" id="2358207">nil</span>&nbsp;<span class="op" id="2358211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2358215">return</span>&nbsp;<span class="ident" id="2358222">nil</span><span class="op" id="2358225">,</span>&nbsp;<span class="ident" id="2358227">nil</span><span class="op" id="2358230">,</span>&nbsp;<span class="ident" id="2358232">NewSyscallError</span><span class="op" id="2358247">(</span><span class="string" id="2358248">&#34;pipe2&#34;</span><span class="op" id="2358255">,</span>&nbsp;<span class="ident" id="2358257">e</span><span class="op" id="2358258">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2358261">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2358265">return</span>&nbsp;<span class="ident" id="2358272">NewFile</span><span class="op" id="2358279">(</span><span class="builtintype" id="2358280">uintptr</span><span class="op" id="2358287">(</span><span class="ident" id="2358288">p</span><span class="op" id="2358289">[</span><span class="num" id="2358290">0</span><span class="op" id="2358291">]</span><span class="op" id="2358292">)</span><span class="op" id="2358293">,</span>&nbsp;<span class="string" id="2358295">&#34;|0&#34;</span><span class="op" id="2358299">)</span><span class="op" id="2358300">,</span>&nbsp;<span class="ident" id="2358302">NewFile</span><span class="op" id="2358309">(</span><span class="builtintype" id="2358310">uintptr</span><span class="op" id="2358317">(</span><span class="ident" id="2358318">p</span><span class="op" id="2358319">[</span><span class="num" id="2358320">1</span><span class="op" id="2358321">]</span><span class="op" id="2358322">)</span><span class="op" id="2358323">,</span>&nbsp;<span class="string" id="2358325">&#34;|1&#34;</span><span class="op" id="2358329">)</span><span class="op" id="2358330">,</span>&nbsp;<span class="ident" id="2358332">nil</span><br>
<span class="lineno"></span><span class="op" id="2358336">}</span>
</div>
</body>
</html>
